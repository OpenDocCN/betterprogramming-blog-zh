<html>
<head>
<title>React and MobX — Lessons Learned</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React和MobX —经验教训</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/react-and-mobx-lessons-learned-427a8e223c93?source=collection_archive---------5-----------------------#2020-10-01">https://betterprogramming.pub/react-and-mobx-lessons-learned-427a8e223c93?source=collection_archive---------5-----------------------#2020-10-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3439" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">立即开始使用MobX作为您的状态管理库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8d3f7ba59db70c71427e168864ae36d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FFY-8WN4YH2itbdt"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">格雷姆·尼科尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="d738" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">简介</strong></h1><p id="61f0" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">几年前，我面临着组装和开发产品前端的挑战。当我开始的时候，我被告知我应该使用React，但是除此之外，我可以按照我想要的方式构建。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="8cc5" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">Redux？</h1><p id="762c" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在我必须做出的许多其他选择中，我必须决定是否使用<a class="ae ky" href="https://redux.js.org/" rel="noopener ugc nofollow" target="_blank"> Redux </a>，以及如何处理应用程序中的数据。我已经熟悉了Redux和一些<a class="ae ky" href="https://en.wikipedia.org/wiki/Flux_(software)" rel="noopener ugc nofollow" target="_blank"> Flux </a>实现，以及它们的生态系统，但是有一件事让我有点困扰，那就是对于你遇到的每种类型的问题/情况，有越来越多的库和依赖项——而且，由于大多数在线知识都是基于最著名的样板，你最终被迫在项目中插入几个库，甚至不知道你是否真的需要它们。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="e21c" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">MobX</h1><p id="f1ee" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">然后我开始寻找替代品，发现了MobX。起初，我认为这是非常不同的，所以有某种学习曲线，但它会很快过去。有趣的是MobX如何有开发者/公司的良好支持，如何一开始不受企业利益驱动，社区又如何比较大(当然即使它在Redux上什么都没有)。毕竟开始使用MobX是非常容易的。然而，我陷入了一些我在开始时就想更好地了解的陷阱，所以我决定写一些技巧。</p><p id="c208" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在解释MobX如何工作之前，因为我在谈论React，所以有必要简单说一下，我也必须选择是否使用<a class="ae ky" href="https://create-react-app.dev/docs/getting-started/" rel="noopener ugc nofollow" target="_blank"> Create React App </a>。我需要服务器端的渲染，CRA不支持，在脸书自己对SSR的推荐中，有<a class="ae ky" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>和<a class="ae ky" href="https://github.com/jaredpalmer/razzle" rel="noopener ugc nofollow" target="_blank"> Razzle </a>。我真的很喜欢Next和整个Zeit生态系统，但无论如何，你最终都会陷入其中。另一方面，Razzle在定义上非常灵活。这只是项目的基础，几乎所有的东西都是可定制的。由于当时我对我的挑战中的未来知之甚少，所以我选择了它(值得一看)。我只需要将mobx和<a class="ae ky" href="https://github.com/mobxjs/mobx-react" rel="noopener ugc nofollow" target="_blank"> mobx-react </a>安装并导入到项目中，以便将react(通过Razzle)与mobx一起使用。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="91c3" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">工作原理</strong></h1><p id="7adf" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">让我们来看看一些基本的MobX概念。</p><p id="c326" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">该库的重点是应用程序的可伸缩状态管理(像Redux，不一定是React)，这种可伸缩性是通过透明反应性实现的(有趣的名字是TFRP，<em class="mz">透明反应功能编程</em>)。这意味着与应用程序状态相关的一切都必须自动(或自动逻辑地)获得。很快就会变得更清晰。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="b23e" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">可观测量</strong></h1><p id="4660" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">允许这种情况发生的是可观测量的使用。很简单，一个可观察对象增加了现有数据结构被某人“观察”的可能性。它类似于Pub/Sub或Mediator的模式设计，其中A部分要求在B部分发生某些事情时得到通知，但在这里，除了所有这些自动发生(没有“订阅”的必要性)之外，观察到的是其本身的值，而不是您创建的回调。</p><p id="8013" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在MobX中使用decorators是可选的:这只是一种少写一点代码并保持当前结构的方法。每个装饰者都有相应的功能。要启用装饰者，你可能需要改变<a class="ae ky" href="https://mobx.js.org/enabling-decorators.html" rel="noopener ugc nofollow" target="_blank">通天塔设置</a>。</p><p id="a16d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">一个例子是装饰符<code class="fe na nb nc nd b">@observable</code>和<code class="fe na nb nc nd b">@observer</code>的使用:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="5fd7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">请注意，不必写任何具体的东西，当可观察名称改变其值时，观察者将独自做出反应。即使你有很多复杂的可观察对象，MobX内部只记录你在render方法中使用的内容。</p><p id="0f38" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">很酷，对吧？非常简单明了。</p><p id="9fd1" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">没有装饰器的前一个示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0f7a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">你可以在<a class="ae ky" href="https://mobx.js.org/enabling-decorators.html" rel="noopener ugc nofollow" target="_blank">文档</a>中找到更多有或没有装饰程序的例子。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="299c" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">计算值</h1><p id="508d" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">乍一看，使用这个功能似乎有点不必要，但它非常强大。虽然创建一个可观察对象和一个观察者非常容易，但是MobX提供了几个工具，让您能够非常清楚地区分数据层和接口层。计算值是从一个或多个可观察值中得出的值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="f001" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">您可以用它来做很多事情，例如为AJAX请求组装一个对象:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="5d56" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这里我用了一个<code class="fe na nb nc nd b">observable.map</code>。</p><p id="6d3c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">不要在组件或其他模块中将碎片放在一起，问问自己是否可以用计算出的值做到这一点。如果有，那就用吧！</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3e10" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">自定义反应</h1><p id="7f30" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">不仅React组件能够对可观察到的内容做出反应，任何代码都可以。为此有三个功能:<code class="fe na nb nc nd b">autorun</code>、<code class="fe na nb nc nd b">reaction</code>和<code class="fe na nb nc nd b">when</code>。</p><p id="3341" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">考虑前面的例子。如果您真的想在更新搜索过滤器时调用AJAX:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="cb2d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">好吧！就这样，对吧？这至少足够让您玩一会儿，并让您的应用程序工作。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="9d69" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">行动</h1><p id="1f49" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">虽然这不是强制性的，但我强烈建议使用动作。默认情况下，MobX会完成它的工作，每个观察者都会对他们正在使用的可观察对象(只有这些)做出反应。然而，没有什么可以阻止observables从任何地方被改变，包括从它们自己的组件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="f979" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">使用动作是完全可选的，但是除了有助于提高性能之外，它还有助于构建代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6edf" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">好吧！现在我们可以去小费。简单回顾一下:</p><ul class=""><li id="e1d8" class="ng nh it ma b mb mu me mv mh ni ml nj mp nk mt nl nm nn no bi translated">对于一个或多个组件中使用的可变数据——以及导致任何Javascript代码频繁运行的数据——使用<strong class="ma iu">可观察的</strong>。</li><li id="bee3" class="ng nh it ma b mb np me nq mh nr ml ns mp nt mt nl nm nn no bi translated">如果你需要的数据是其他数据的组合，使用<strong class="ma iu">计算值</strong>。</li><li id="3f90" class="ng nh it ma b mb np me nq mh nr ml ns mp nt mt nl nm nn no bi translated">对于对可观察到的事物做出反应的反应组件，使用<code class="fe na nb nc nd b">observer</code>。</li><li id="bbc1" class="ng nh it ma b mb np me nq mh nr ml ns mp nt mt nl nm nn no bi translated">对于任何对可观察事件做出反应的JavaScript代码，使用<code class="fe na nb nc nd b">autorun</code>、<code class="fe na nb nc nd b">reaction</code>或<code class="fe na nb nc nd b">when</code>。</li><li id="6216" class="ng nh it ma b mb np me nq mh nr ml ns mp nt mt nl nm nn no bi translated">为了更好地组织您的代码并维护一个可以修改可观察性的标准，使用<strong class="ma iu">动作</strong>。</li></ul></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="6597" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">第一个提示:使用域存储</strong></h1><p id="9b19" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">按照领域(例如用户、搜索、feed等)在商店中分离你的观察对象和与之相关的逻辑。).</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d536" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">要使用组件中的存储，请使用<code class="fe na nb nc nd b">Provider</code>和<code class="fe na nb nc nd b">inject</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="4181" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">第二个建议:使用强制措施</h1><p id="816d" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">使用<code class="fe na nb nc nd b">enforceActions</code>选项，MobX将仅观察作为所声明的动作的结果而发生的可观察值的变化。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="b02e" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">第三招:暴露自己的行为</strong></h1><p id="77ce" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">选择一种方式<strong class="ma iu">，仅允许访问您的Stores的动作和可观察项</strong>的读数，或者将它们导出到另一个对象，或者明确它们是公共的。某些操作将在Store内部执行，组件不得使用—另一方面，其他操作必须使用。有很多方法可以做到这一点，在MobX文档中，我们被告知对于您想要如何处理事件以及什么触发了动作，该库没有发言权。可以使用一些Flux实现或任何其他库来创建此通信通道。一旦用户动作发生并触发了来自商店的内部动作，MobX就会被动地处理剩下的事情。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="a01b" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">结论</strong></h1><p id="17a7" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">MobX和Redux都是好的，都兑现了自己的承诺。尽管许多基准测试表明，在某些用例中，MobX的性能优于Redux，但我无法否认或确认哪一个更好。就目前而言，它们似乎只是风格不同。我认为理想的情况是:如果要使用Redux，请了解每个库存在的原因，并尝试使用尽可能少的库，使代码尽可能直接。如果使用MobX，请从接口中分离数据和逻辑，并确保遵循简单和冗余的模式。</p><p id="3d3f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果想了解更多，以下两个环节就足够了:</p><ul class=""><li id="a2fa" class="ng nh it ma b mb mu me mv mh ni ml nj mp nk mt nl nm nn no bi translated"><a class="ae ky" href="https://mobx.js.org/" rel="noopener ugc nofollow" target="_blank">https://mobx.js.org/</a></li><li id="14db" class="ng nh it ma b mb np me nq mh nr ml ns mp nt mt nl nm nn no bi translated"><a class="ae ky" href="https://github.com/mobxjs/awesome-mobx" rel="noopener ugc nofollow" target="_blank">https://github.com/mobxjs/awesome-mobx</a></li></ul><p id="05f8" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">以下是使用MobX的项目的一些很好的例子:</p><ul class=""><li id="8384" class="ng nh it ma b mb mu me mv mh ni ml nj mp nk mt nl nm nn no bi translated"><a class="ae ky" href="https://github.com/lionsharecapital/lionshare-desktop" rel="noopener ugc nofollow" target="_blank">https://github.com/lionsharecapital/lionshare-desktop</a></li><li id="a2bb" class="ng nh it ma b mb np me nq mh nr ml ns mp nt mt nl nm nn no bi translated"><a class="ae ky" href="https://github.com/fcsonline/react-transmission" rel="noopener ugc nofollow" target="_blank">https://github.com/fcsonline/react-transmission</a></li><li id="2bab" class="ng nh it ma b mb np me nq mh nr ml ns mp nt mt nl nm nn no bi translated"><a class="ae ky" href="https://github.com/gothinkster/react-mobx-realworld-example-app" rel="noopener ugc nofollow" target="_blank">https://github . com/gothinkster/rear-mobx-real world-example-app</a></li></ul><p id="43ec" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">当然，也不是所有东西都是Mobx，也不是reaction。重要的是要知道如何在合适的时候使用这些工具。</p></div></div>    
</body>
</html>