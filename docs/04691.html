<html>
<head>
<title>How to Manage Traffic Using Istio on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Kubernetes上使用Istio管理流量</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-manage-traffic-using-istio-on-kubernetes-cd4b96e00b57?source=collection_archive---------2-----------------------#2020-04-30">https://betterprogramming.pub/how-to-manage-traffic-using-istio-on-kubernetes-cd4b96e00b57?source=collection_archive---------2-----------------------#2020-04-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="53c9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Kubernetes上使用Istio洞察请求路由、流量分流和基于用户身份的路由</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d4b7dead18f572cbb5003e78c50e719f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VE29ZE70iu00jmBB"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约翰·杰米森在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="5f68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">交通管理是<a class="ae ky" href="https://istio.io/" rel="noopener ugc nofollow" target="_blank"> Istio </a>的核心特色之一。如果您使用Istio来管理您在<a class="ae ky" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>上的<a class="ae ky" href="https://en.wikipedia.org/wiki/Microservices" rel="noopener ugc nofollow" target="_blank">微服务</a>，您可以对它们之间的交互方式进行细粒度控制。这也将帮助您定义流量如何流经您的服务网格。</p><p id="68ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个故事是在Kubernetes 上开始使用Istio<a class="ae ky" href="https://medium.com/better-programming/getting-started-with-istio-on-kubernetes-e582800121ea" rel="noopener">的后续。今天，我们来讨论一下交通管理。</a></p><p id="53a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上一篇文章中，我们在Kubernetes集群上安装了Istio，并在其上部署了一个示例图书信息应用程序。我们已经看到流量以循环方式流过我们的网格，但有了像Istio这样的服务网格，我们可以做得更多。您可以使用的一些流量管理功能如下:</p><ul class=""><li id="603a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">请求路由</li><li id="555b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">故障注入</li><li id="040c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">交通转移</li><li id="034b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">TCP流量转移</li><li id="59e6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">请求超时</li><li id="870d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">断路</li><li id="8a7d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">反映</li></ul><p id="63f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们在上一篇文章中讨论的，我们可以使用入口网关让流量进入我们的网格，然后使用虚拟服务以循环方式路由流量。</p><p id="89ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将了解目的地规则，这些规则将为我们提供对网格行为的细粒度控制。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="d502" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">先决条件</h1><p id="8092" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">确保您有一个正在运行的Kubernetes集群。按照Kubernetes上的<a class="ae ky" href="https://medium.com/better-programming/getting-started-with-istio-on-kubernetes-e582800121ea" rel="noopener">Istio入门指南</a>安装Istio并在集群中部署样本图书信息应用程序。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="a41e" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">什么是目的地规则？</h1><p id="df4a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">目的地规则是Istio中流量路由的重要组成部分。它们是虚拟服务将流量路由到目的地后应用于流量的规则。</p><p id="a2fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虚拟服务匹配规则并评估将流量路由到的目的地，而目的地规则定义发送流量的可用服务子集。</p><p id="8c12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果您的服务同时运行多个版本，您可以创建目标规则来定义到这些版本的路由。然后使用虚拟服务映射到由目标规则定义的特定子集，或将一定比例的流量分配给特定版本。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="5003" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">应用目的地规则</h1><p id="65bb" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">让我们从上一篇文章停止的地方继续，为微服务定义一些目的地规则。</p><p id="246e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本次演示中，我们将为每个版本的<code class="fe nn no np nq b">reviews</code>微服务定义三个子集(<code class="fe nn no np nq b">v1</code>、<code class="fe nn no np nq b">v2</code>和<code class="fe nn no np nq b">v3</code>)，为其他三个微服务定义一个子集(<code class="fe nn no np nq b">v1</code>)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/758f31ab4d9806606386540454498e1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O827wJmY77b3LJ8Un9s7yw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">目的地规则</p></figure><p id="56ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我们将要使用的目标规则YAML文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">目的地-规则-全部. yaml</p></figure><p id="3d6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，在YAML文件中有四种不同的目的地规则。<code class="fe nn no np nq b">reviews</code>微服务定义了三个目的子集(<code class="fe nn no np nq b">v1</code>、<code class="fe nn no np nq b">v2</code>和<code class="fe nn no np nq b">v3</code>，每个子集选择一个标签<code class="fe nn no np nq b">version</code>，指向<code class="fe nn no np nq b">v1</code>、<code class="fe nn no np nq b">v2</code>或<code class="fe nn no np nq b">v3</code>。</p><p id="0377" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着根据虚拟服务选择的目标子集，Istio会将请求路由到所有标有由所选子集指定的版本的微服务pod。</p><p id="4f0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过运行以下命令来定义目标规则:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="5f65" class="ny mr it nq b gy nz oa l ob oc">$ kubectl apply -f samples/bookinfo/networking/destination-rule-all.yaml<br/>destinationrule.networking.istio.io/productpage created<br/>destinationrule.networking.istio.io/reviews created<br/>destinationrule.networking.istio.io/ratings created<br/>destinationrule.networking.istio.io/details created</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="3c92" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">路由到特定版本</h1><p id="41ea" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在上一篇文章中，我们看到流量以循环方式流过我们的网格。</p><p id="b57e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们尝试创建一个简单的路由规则，并为<code class="fe nn no np nq b">reviews</code>微服务选择版本1。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/1ebbb458090eb45c0c678deeb6a9257b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W42yGUdOKnYyh_TI3fDskg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">路由到v1</p></figure><p id="e4f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每次到达终点时，我们应该看到一个没有星星的页面，而不是看到三个不同的评论页面。</p><p id="0dcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一下我们需要用于该路由的虚拟服务清单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">虚拟服务-所有-v1.yaml</p></figure><p id="ab91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，这个虚拟服务是对我们在上一篇文章中使用的虚拟服务的补充。那里的虚拟服务在端口80上监听所有主机上的请求，并根据匹配的URL路径路由到产品页面。</p><p id="6d49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们匹配微服务的主机名，并为每个微服务选择一个特定的目标子集(此处为<code class="fe nn no np nq b">v1</code>)。</p><p id="1571" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用虚拟服务清单:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="0fee" class="ny mr it nq b gy nz oa l ob oc">$ kubectl apply -f samples/bookinfo/networking/virtual-service-all-v1.yaml<br/>virtualservice.networking.istio.io/productpage created<br/>virtualservice.networking.istio.io/reviews created<br/>virtualservice.networking.istio.io/ratings created<br/>virtualservice.networking.istio.io/details created</span></pre><p id="7bb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，尝试访问该网站，您会发现每次刷新时，您都会看到没有星星的页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/9387ae490aa80f401b2b8e0edb3ea504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_kXpkHrBEgKgV1FwCRrEAA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图书信息版本1</p></figure><p id="23c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着我们已经成功地将Istio配置为路由到<code class="fe nn no np nq b">reviews</code>微服务的<code class="fe nn no np nq b">v1</code>版本。</p><p id="d3f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们更改虚拟服务中的版本，将所有请求路由到<code class="fe nn no np nq b">v3</code>上的<code class="fe nn no np nq b">reviews</code>微服务:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">虚拟服务评论v3.yaml</p></figure><p id="6d55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用清单:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="c5b4" class="ny mr it nq b gy nz oa l ob oc">$ kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-v3.yaml<br/>virtualservice.networking.istio.io/reviews configured</span></pre><p id="8cc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尝试重新访问图书信息应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/3ec38eca20978a5673b8926f6c0517ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PxmdhrocxbzNeJSi00rDdw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图书信息版本3</p></figure><p id="8182" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而这一次，你每次刷新都会看到红色的星星。您已经成功地将网格配置为指向特定版本。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="424a" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">流量分流</h1><p id="6e51" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">现在，例如，你有一个新版本的微服务，你想介绍给你的用户。尽管如此，你也不想冒影响整个服务的风险。因此，在全面推出新版本之前，只对少数客户测试功能是很谨慎的。</p><p id="ceb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种部署策略被称为蓝绿色部署，我们慢慢地将流量从旧版本(蓝色)转移到新版本(绿色)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/ee98ea1a29d9af791434c2d967035d81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PW_ZjLoKcAxVTimGJRhXyQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">蓝绿色部署</p></figure><p id="bd51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们尝试在<code class="fe nn no np nq b">reviews</code>微服务的蓝色版本<code class="fe nn no np nq b">v2</code>和绿色版本<code class="fe nn no np nq b">v3</code>之间平均分配流量。</p><p id="66b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们先看看清单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">虚拟服务评论v2-v3.yaml</p></figure><p id="9677" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所看到的，有一个<code class="fe nn no np nq b">weight</code>属性以50-50的值添加到目的地的每个子集。这意味着一半的流量将路由到蓝色版本(<code class="fe nn no np nq b">v2</code>)，另一半路由到绿色版本(<code class="fe nn no np nq b">v3</code>)。</p><p id="5dce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用清单看看会发生什么:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="2d6c" class="ny mr it nq b gy nz oa l ob oc">$ kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-v2-v3.yaml<br/>virtualservice.networking.istio.io/reviews configured</span></pre><p id="627b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">多次刷新页面，您将会看到流量在两个版本(一个有黑色星星，另一个有红色星星)之间平均跳跃:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/baa7decf99f5b7c0dc7af284e5ba3b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A40ufaIMAH0NRcVG5SgOWA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图书信息版本2</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/3ec38eca20978a5673b8926f6c0517ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PxmdhrocxbzNeJSi00rDdw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图书信息版本3</p></figure><p id="1947" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这表明流量分离在两个版本之间正常工作。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="d677" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">基于用户身份的路由</h1><p id="bdd0" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">让我们把路由到下一个级别。假设您不确定新的微服务能否在生产环境中正常工作。因此，您首先想要向业务测试人员推出新服务。一旦业务测试人员满意了，您就可以向所有用户推广它。</p><p id="24df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看虚拟服务清单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">虚拟服务评论测试v2.yaml</p></figure><p id="e69a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，这个虚拟服务在一个名为<code class="fe nn no np nq b">end-user</code>的特定头上匹配。如果<code class="fe nn no np nq b">end-user</code>的名称是<code class="fe nn no np nq b">jason</code>，它会将其路由到<code class="fe nn no np nq b">reviews</code>微服务的版本<code class="fe nn no np nq b">v2</code>。对于其他所有事情，它将请求路由到<code class="fe nn no np nq b">reviews</code>微服务的版本<code class="fe nn no np nq b">v1</code>。</p><p id="b160" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用虚拟服务清单:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="8451" class="ny mr it nq b gy nz oa l ob oc">$ kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-test-v2.yaml</span></pre><p id="c20b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">刷新页面，您应该看到所有请求都被路由到了<code class="fe nn no np nq b">v1</code>微服务，因为您还没有登录:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/3d342ae9792c4eb2b5a051c886eb2f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Pc-PiApgwx2i_nHWsu0Ug.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图书信息版本1</p></figure><p id="a6d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，点击“登录”，以<code class="fe nn no np nq b">jason</code>的身份登录网站。您不需要提供密码。</p><p id="9244" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你现在看到了什么？是有黑色星星的那一页吗？如果是，那么您已经成功地在Istio上配置了基于用户身份的路由。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/2443be185241b6bb2b156a1701736efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*haL2M5Hnn_nmpWmiZg53NQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用户Jason的图书信息版本2</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="a6a5" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="ffb5" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">感谢您通读！我希望你喜欢这篇文章。在下一部分中，我将讨论"<a class="ae ky" href="https://medium.com/better-programming/kubernetes-services-over-https-with-istios-secure-gateways-210b2ce91b71" rel="noopener"> Kubernetes通过Istio的安全网关</a>在HTTPS提供的服务，并进行实际操作演示，下一部分再见！</p></div></div>    
</body>
</html>