<html>
<head>
<title>How I Back Up My Ghost Blog to a Cloud Storage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何将我的Ghost博客备份到云存储中</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-i-back-up-my-ghost-blog-to-a-cloud-storage-387524e3b524?source=collection_archive---------10-----------------------#2022-07-27">https://betterprogramming.pub/how-i-back-up-my-ghost-blog-to-a-cloud-storage-387524e3b524?source=collection_archive---------10-----------------------#2022-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d225" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">分五步做</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/67b2c901d00871810717cb2094216438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j6U7MpvEeD42yHAe"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@siyuan_hu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">胡思远</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="d89e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经在我的<a class="ae ky" href="https://github.com/TryGhost/Ghost" rel="noopener ugc nofollow" target="_blank">自主幽灵</a>博客上写了一段时间了。如果你想知道，这个网站是托管在一个数字海洋上的。</p><p id="32ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在很大程度上，我觉得自己在做一些无关紧要的事情，而这些事情对我自己来说意义重大。今天，这个网站已经发展到一个规模，如果我丢失了我所有的内容，那感觉就像是一记飞向我脸上的耳光。</p><p id="1cba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在寻找“我如何备份我的Ghost博客”的答案对于你的自主幽灵博客，你来对地方了。</p><p id="5b45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">TL；DR:如何像Google Drive一样将自托管Ghost博客备份到云存储，如何恢复</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f8e2" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">语境</h1><p id="cd9f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">开始使用Ghost很容易。您通常会选择:</p><ul class=""><li id="977d" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><a class="ae ky" href="https://ghost.org/pricing/" rel="noopener ugc nofollow" target="_blank"> Ghost (Pro) </a>托管服务</li><li id="ae26" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">自托管在<a class="ae ky" href="https://www.dreamhost.com/blog/beginners-guide-vps/#what-is-vps" rel="noopener ugc nofollow" target="_blank"> VPS </a>或<a class="ae ky" href="https://blog.railway.app/p/ghost" rel="noopener ugc nofollow" target="_blank"> Railway </a>等无服务器平台上</li></ul><p id="d9ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我建议任何人(尤其是非开发人员)选择托管版本。</p><p id="c13f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，相对贵一些；每个托管服务也是如此。然而，这很可能会为你省去一大堆自托管其他网站带来的麻烦(和时间):</p><ul class=""><li id="f319" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">备份</li><li id="9091" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">维护</li><li id="cefd" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">停机恢复</li><li id="010e" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">安全等。</li></ul><p id="5a30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，你晚上会睡得更好。</p><p id="fe25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最重要的是，100%的收入用于资助开源项目本身的开发——这是一个双赢的局面。</p><h2 id="64a3" class="no me it bd mf np nq dn mj nr ns dp mn li nt nu mp lm nv nw mr lq nx ny mt nz bi translated">“呃，那你为什么自己主持幽灵？”</h2><ol class=""><li id="14bf" class="na nb it lb b lc mv lf mw li oa lm ob lq oc lu od ng nh ni bi translated">价格——没有什么比托管在专用服务器上的价格更实惠了</li><li id="9f6c" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated">知识增长——我从托管和管理自己的VP中学到了很多</li></ol><p id="1ea6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自托管的其他好处包括可定制性、控制、隐私等。这些都很好，尽管不是我的主要原因。</p><p id="0c6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最重要的是，所有上述自我托管的麻烦对我来说都是乐趣。</p><p id="00f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想，直到它不是。</p><h2 id="2eb4" class="no me it bd mf np nq dn mj nr ns dp mn li nt nu mp lm nv nw mr lq nx ny mt nz bi translated">备份幽灵的痛苦</h2><p id="3506" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在数字海洋上设置Ghost就像点击按钮一样简单。然而，没有任何合适的内部解决方案来备份您的Ghost站点。</p><p id="f9a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从<a class="ae ky" href="https://ghost.org/docs/faq/manual-backup/" rel="noopener ugc nofollow" target="_blank"> Ghost的文档</a>中，您可以通过Ghost Admin手动备份您的Ghost站点。或者，你可以使用<code class="fe oe of og oh b">ghost backup</code> <a class="ae ky" href="https://ghost.org/docs/ghost-cli/#ghost-backup" rel="noopener ugc nofollow" target="_blank">命令</a>。</p><p id="b5ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管如此，在撰写本文时还没有提到数据库备份。我真希望他们能多谈谈这个。</p><h1 id="d91e" class="md me it bd mf mg oi mi mj mk oj mm mn jz ok ka mp kc ol kd mr kf om kg mt mu bi translated">使用Bash备份</h1><h2 id="b81a" class="no me it bd mf np nq dn mj nr ns dp mn li nt nu mp lm nv nw mr lq nx ny mt nz bi translated">为什么选择<code class="fe oe of og oh b">bash</code></h2><p id="4b6b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">简单。另外，Bash非常适合命令行交互。</p><h2 id="1369" class="no me it bd mf np nq dn mj nr ns dp mn li nt nu mp lm nv nw mr lq nx ny mt nz bi translated">我们在备份什么</h2><p id="940b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">两件事:</p><ul class=""><li id="a20d" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">ghost<code class="fe oe of og oh b">content/</code>——包括JSON中的站点/博客内容、成员CSV导出、主题、图片和一些配置文件</li><li id="c68d" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">MySQL数据库</li></ul><h1 id="d62f" class="md me it bd mf mg oi mi mj mk oj mm mn jz ok ka mp kc ol kd mr kf om kg mt mu bi translated">概观</h1><p id="1d79" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在本文中，我们将编写一个简单的Bash脚本来完成以下所有步骤。</p><p id="e667" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们已经设置了<a class="ae ky" href="https://rclone.org/" rel="noopener ugc nofollow" target="_blank"> Rclone </a>，下面是我们的Bash脚本应该涵盖的内容的概述:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/faff9247fad25ee9450f337e92646b5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C-tUz1CqdmtGNlxo.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">概观</p></figure><ol class=""><li id="3997" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu od ng nh ni bi translated"><em class="lv">可选:</em>运行需求检查，以确保安装了我们需要的CLI。如<code class="fe oe of og oh b">mysqldump</code>、<code class="fe oe of og oh b">rclone</code>等。</li><li id="df37" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated">备份存放鬼帖的<code class="fe oe of og oh b">content/</code>文件夹</li><li id="9bfe" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated">备份我们的MySQL数据库</li><li id="33ec" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated">使用Rclone将备份文件复制到我们的云存储中(例如Google Drive)</li><li id="838e" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated"><em class="lv">可选:</em>清理生成的备份文件</li></ol><h1 id="cc47" class="md me it bd mf mg oi mi mj mk oj mm mn jz ok ka mp kc ol kd mr kf om kg mt mu bi translated">效用函数</h1><p id="7ac5" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">让我们创建<code class="fe oe of og oh b">util.sh</code>，它包含一组备份脚本的帮助函数。</p><p id="31ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我喜欢在日志上打印时间戳，所以:</p><pre class="kj kk kl km gt oo oh op oq aw or bi"><span id="5571" class="no me it oh b gy os ot l ou ov">#!/bin/bash</span><span id="62d5" class="no me it oh b gy ow ot l ou ov">log() {<br/>    echo "$(date -u): $1"<br/>}</span></pre><p id="982a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这个，我们现在可以用<code class="fe oe of og oh b">log</code>代替<code class="fe oe of og oh b">echo</code>来打印文本；时间戳使用:</p><pre class="kj kk kl km gt oo oh op oq aw or bi"><span id="c28c" class="no me it oh b gy os ot l ou ov">$ log 'Hola Jerry!'</span><span id="3d77" class="no me it oh b gy ow ot l ou ov">Sun Jul 22 03:01:52 UTC 2022: Hola Jerry!</span></pre><p id="6db9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将创建一个实用函数来帮助检查是否安装了命令:</p><pre class="kj kk kl km gt oo oh op oq aw or bi"><span id="72d1" class="no me it oh b gy os ot l ou ov"># util.sh</span><span id="595a" class="no me it oh b gy ow ot l ou ov"># ...</span><span id="4b49" class="no me it oh b gy ow ot l ou ov">check_command_installation() {<br/>    if ! command -v $1 &amp;&gt;/dev/null; then<br/>        log "$1 is not installed"<br/>        exit 0<br/>    fi<br/>}</span></pre><p id="4ca8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在步骤1中使用这个函数来确保我们有<code class="fe oe of og oh b">ghost</code>、<code class="fe oe of og oh b">mysqldump</code>等。在我们开始备份过程之前安装。如果没有安装CLI，我们只需登录并退出。</p><h2 id="acce" class="no me it bd mf np nq dn mj nr ns dp mn li nt nu mp lm nv nw mr lq nx ny mt nz bi translated">备份脚本</h2><p id="0056" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在这一节中，我们将创建一个<code class="fe oe of og oh b">backup.sh</code>文件作为我们的主备份Bash脚本。</p><p id="7891" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了保持我们的代码有条理，我们将概述中的步骤分解成单独的函数。</p><p id="13ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们开始之前，我们需要声明一些变量并为我们的<code class="fe oe of og oh b">util.sh</code>提供源，这样我们就可以使用我们之前定义的效用函数:</p><pre class="kj kk kl km gt oo oh op oq aw or bi"><span id="aacd" class="no me it oh b gy os ot l ou ov">#!/bin/bash</span><span id="178b" class="no me it oh b gy ow ot l ou ov">set -e</span><span id="78ab" class="no me it oh b gy ow ot l ou ov">source util.sh</span><span id="0027" class="no me it oh b gy ow ot l ou ov">GHOST_DIR="/var/www/ghost/"</span><span id="4462" class="no me it oh b gy ow ot l ou ov">REMOTE_BACKUP_LOCATION="ghost_backups/"</span><span id="d623" class="no me it oh b gy ow ot l ou ov">TIMESTAMP=$(date +%Y_%m_%d_%H%M)<br/>GHOST_CONTENT_BACKUP_FILENAME="ghost_content_$TIMESTAMP.tar.gz"<br/>GHOST_MYSQL_BACKUP_FILENAME="ghost_mysql_$TIMESTAMP.sql.gz"</span></pre><h2 id="d334" class="no me it bd mf np nq dn mj nr ns dp mn li nt nu mp lm nv nw mr lq nx ny mt nz bi translated"><strong class="ak">步骤1:运行检查</strong></h2><ul class=""><li id="de67" class="na nb it lb b lc mv lf mw li oa lm ob lq oc lu nf ng nh ni bi translated">检查默认的<code class="fe oe of og oh b">/var/www/ghost</code>目录是否存在。CLI只能在安装了Ghost的文件夹中调用</li><li id="3692" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">检查是否安装了运行备份所需的CLI</li></ul><pre class="kj kk kl km gt oo oh op oq aw or bi"><span id="1aab" class="no me it oh b gy os ot l ou ov"># backup.sh</span><span id="2f68" class="no me it oh b gy ow ot l ou ov"># ...</span><span id="c07b" class="no me it oh b gy ow ot l ou ov">pre_backup_checks() {<br/>    if [ ! -d "$GHOST_DIR" ]; then<br/>        log "Ghost directory does not exist"<br/>        exit 0<br/>    fi</span><span id="a081" class="no me it oh b gy ow ot l ou ov">log "Running pre-backup checks"<br/>    cd $GHOST_DIR</span><span id="2d27" class="no me it oh b gy ow ot l ou ov">cli=("tar" "gzip" "mysql" "mysqldump" "ghost" "rclone")<br/>    for c in "${cli[@]}"; do<br/>        check_command_installation "$c"<br/>    done<br/>}</span></pre><h2 id="bc35" class="no me it bd mf np nq dn mj nr ns dp mn li nt nu mp lm nv nw mr lq nx ny mt nz bi translated"><strong class="ak">第二步:备份内容目录</strong></h2><ul class=""><li id="8e45" class="na nb it lb b lc mv lf mw li oa lm ob lq oc lu nf ng nh ni bi translated">将<code class="fe oe of og oh b">content/</code>目录压缩成一个<code class="fe oe of og oh b">.gz</code>文件</li></ul><pre class="kj kk kl km gt oo oh op oq aw or bi"><span id="593b" class="no me it oh b gy os ot l ou ov"># backup.sh</span><span id="a728" class="no me it oh b gy ow ot l ou ov"># ...</span><span id="cdac" class="no me it oh b gy ow ot l ou ov">backup_ghost_content() {<br/>    log "Dumping Ghost content..."<br/>    cd $GHOST_DIR</span><span id="76b7" class="no me it oh b gy ow ot l ou ov">tar -czf "$GHOST_CONTENT_BACKUP_FILENAME" content/<br/>}</span></pre><h2 id="55fd" class="no me it bd mf np nq dn mj nr ns dp mn li nt nu mp lm nv nw mr lq nx ny mt nz bi translated"><strong class="ak">第三步:备份MySQL数据库</strong></h2><ul class=""><li id="93f8" class="na nb it lb b lc mv lf mw li oa lm ob lq oc lu nf ng nh ni bi translated">从Ghost CLI获取所有必要的数据库凭据(用户名、密码、数据库名称)</li><li id="a1b2" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">运行检查以确保我们可以使用上面的凭据连接到MySQL数据库</li><li id="d27a" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">创建一个MySQL转储，并将其压缩成一个<code class="fe oe of og oh b">.gz</code>文件</li></ul><pre class="kj kk kl km gt oo oh op oq aw or bi"><span id="5e84" class="no me it oh b gy os ot l ou ov"># backup.sh</span><span id="aa6b" class="no me it oh b gy ow ot l ou ov"># ...</span><span id="e0c7" class="no me it oh b gy ow ot l ou ov">check_mysql_connection() {<br/>    log "Checking MySQL connection..."<br/>    if ! mysql -u"$mysql_user" -p"$mysql_password" -e ";" &amp;&gt;/dev/null; then<br/>        log "Could not connect to MySQL"<br/>        exit 0<br/>    fi<br/>    log "MySQL connection OK"<br/>}</span><span id="45a8" class="no me it oh b gy ow ot l ou ov">backup_mysql() {<br/>    log "Backing up MySQL database"<br/>    cd $GHOST_DIR</span><span id="91b0" class="no me it oh b gy ow ot l ou ov">mysql_user=$(ghost config get database.connection.user | tail -n1)<br/>    mysql_password=$(ghost config get database.connection.password | tail -n1)<br/>    mysql_database=$(ghost config get database.connection.database | tail -n1)</span><span id="c27a" class="no me it oh b gy ow ot l ou ov">check_mysql_connection</span><span id="5ec2" class="no me it oh b gy ow ot l ou ov">log "Dumping MySQL database..."<br/>    mysqldump -u"$mysql_user" -p"$mysql_password" "$mysql_database" --no-tablespaces | gzip &gt;"$GHOST_MYSQL_BACKUP_FILENAME"<br/>}</span></pre><h2 id="8846" class="no me it bd mf np nq dn mj nr ns dp mn li nt nu mp lm nv nw mr lq nx ny mt nz bi translated"><strong class="ak">第四步:将压缩后的备份文件复制到云存储</strong></h2><pre class="kj kk kl km gt oo oh op oq aw or bi"><span id="ff01" class="no me it oh b gy os ot l ou ov"># backup.sh</span><span id="675e" class="no me it oh b gy ow ot l ou ov"># ...</span><span id="effe" class="no me it oh b gy ow ot l ou ov">rclone_to_cloud_storage() {<br/>    log "Rclone backup..."<br/>    cd $GHOST_DIR</span><span id="0f2b" class="no me it oh b gy ow ot l ou ov">rclone_remote_name="remote"</span><span id="51ab" class="no me it oh b gy ow ot l ou ov">rclone copy "$GHOST_DIR/$GHOST_CONTENT_BACKUP_FILENAME" "$rclone_remote_name:$REMOTE_BACKUP_LOCATION"<br/>    rclone copy "$GHOST_DIR/$GHOST_MYSQL_BACKUP_FILENAME" "$rclone_remote_name:$REMOTE_BACKUP_LOCATION"<br/>}</span></pre><p id="4d3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第五步:清理备份文件</strong></p><pre class="kj kk kl km gt oo oh op oq aw or bi"><span id="8620" class="no me it oh b gy os ot l ou ov"># backup.sh</span><span id="5821" class="no me it oh b gy ow ot l ou ov"># ...</span><span id="d943" class="no me it oh b gy ow ot l ou ov">clean_up() {<br/>    log "Cleaning up old backups..."<br/>    cd $GHOST_DIR</span><span id="74c3" class="no me it oh b gy ow ot l ou ov">rm -r "$GHOST_CONTENT_BACKUP_FILENAME"<br/>    rm -r "$GHOST_MYSQL_BACKUP_FILENAME"<br/>}</span></pre><p id="19e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们将调用为步骤1-5定义的所有函数。</p><pre class="kj kk kl km gt oo oh op oq aw or bi"><span id="e83d" class="no me it oh b gy os ot l ou ov"># At the end of the backup.sh</span><span id="3e12" class="no me it oh b gy ow ot l ou ov"># ...</span><span id="51b1" class="no me it oh b gy ow ot l ou ov">log "Welcome to Wraith"<br/>pre_backup_checks<br/>backup_ghost_content<br/>backup_mysql<br/>rclone_to_cloud_storage<br/>clean_up<br/>log "Completed backup to $REMOTE_BACKUP_LOCATION"</span></pre><p id="35a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后…我们结束了！</p><h2 id="da13" class="no me it bd mf np nq dn mj nr ns dp mn li nt nu mp lm nv nw mr lq nx ny mt nz bi translated">最终代码</h2><p id="aa3b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">你可以在github.com/ngshiheng/wraith找到代码。</p><p id="bd57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要直接使用此项目:</p><ol class=""><li id="cf7f" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu od ng nh ni bi translated">SSH到您的VPS，在那里您托管您的Ghost站点</li><li id="54b6" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated"><a class="ae ky" href="https://github.com/ngshiheng/wraith#set-up-rclone" rel="noopener ugc nofollow" target="_blank">设置Rclone </a>(重要)</li><li id="e245" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated">克隆此存储库</li><li id="da85" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated">从幽灵目录运行<code class="fe oe of og oh b">./backup.sh</code></li></ol><h1 id="ef23" class="md me it bd mf mg oi mi mj mk oj mm mn jz ok ka mp kc ol kd mr kf om kg mt mu bi translated">使用Cron自动备份</h1><p id="867c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我讨厌做手工维护和管理工作。让我们使用Crontab为我们的Ghost站点安排一次定期备份，以减轻我们的痛苦:</p><ol class=""><li id="0457" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu od ng nh ni bi translated">运行<code class="fe oe of og oh b">crontab -e</code></li><li id="16b1" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated">例如，您可以在每周一上午5点运行备份，使用:</li></ol><p id="3c6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在设置Cron计划时，一定要考虑时区。</p><h1 id="8d89" class="md me it bd mf mg oi mi mj mk oj mm mn jz ok ka mp kc ol kd mr kf om kg mt mu bi translated">还原Ghost备份</h1><p id="cb7e" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">除非您已经测试过从备份中恢复，否则备份不是备份。</p><p id="ea1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用<a class="ae ky" href="https://hub.docker.com/_/ghost" rel="noopener ugc nofollow" target="_blank"> Docker </a>在本地测试我们的备份。</p><ol class=""><li id="b2f5" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu od ng nh ni bi translated">在一个新的目录下，复制你的备份文件。使用<code class="fe oe of og oh b">tar -xvf</code>解压备份文件</li><li id="e3e4" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated">使用<code class="fe oe of og oh b">docker run -d --name some-ghost -e url=http://localhost:3001 -p 3001:2368 -v /path/to/images:/var/lib/ghost/content/images ghost</code>在本地运行Ghost来恢复博客图像</li><li id="bf62" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated">访问<code class="fe oe of og oh b"><a class="ae ky" href="http://localhost:3001/ghost" rel="noopener ugc nofollow" target="_blank">localhost:3001/ghost</a></code>创建一个管理员帐户</li><li id="29ba" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated">从Ghost管理界面(<code class="fe oe of og oh b"><a class="ae ky" href="http://localhost:3001/ghost/#/settings/labs" rel="noopener ugc nofollow" target="_blank">localhost:3001/ghost/#/settings/labs</a></code>)，从解压缩的<code class="fe oe of og oh b">data/</code>导入您的JSON Ghost博客内容</li><li id="631f" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu od ng nh ni bi translated">您也可以从成员页面导入您的成员CSV</li></ol><p id="47e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提示:使用<code class="fe oe of og oh b">docker exec -it some-ghost bash</code>在你的Ghost Docker容器中运行<code class="fe oe of og oh b">bash</code></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="70fc" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结束语</h1><p id="1571" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">无论你只是运行一个简单的个人网站还是一个正常的企业，拥有一个适当的备份是至关重要的。</p><p id="e97b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我犯了拖延设置备份的错误。今天，我终于把它从我的待办事项列表中去掉了。</p><blockquote class="ox oy oz"><p id="194b" class="kz la lv lb b lc ld ju le lf lg jx lh pa lj lk ll pb ln lo lp pc lr ls lt lu im bi translated">“这个世界上有两种人——备份文件的人和没有经历过丢失所有文件的人。”</p></blockquote><p id="b0ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">阅读这类文章给了我一点动力，让我避免成为反面教材的一部分。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt oo oh op oq aw or bi"><span id="bc2e" class="no me it oh b gy os ot l ou ov"><strong class="oh iu">Want to Connect?</strong></span><span id="6732" class="no me it oh b gy ow ot l ou ov">This article was originally published at <a class="ae ky" href="https://jerrynsh.com/backing-up-ghost-blog-in-5-steps/" rel="noopener ugc nofollow" target="_blank">jerrynsh.com</a></span></pre></div></div>    
</body>
</html>