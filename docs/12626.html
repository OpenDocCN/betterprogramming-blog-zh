<html>
<head>
<title>A Data Engineer’s Perspective on AWS Managed Airflow vs. AWS Step Function (State Machine)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据工程师对AWS管理气流与AWS阶跃函数(状态机)的观点</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-data-engineers-perspective-on-aws-managed-airflow-and-aws-step-function-state-machine-d4d11517e042?source=collection_archive---------5-----------------------#2022-06-17">https://betterprogramming.pub/a-data-engineers-perspective-on-aws-managed-airflow-and-aws-step-function-state-machine-d4d11517e042?source=collection_archive---------5-----------------------#2022-06-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8701" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">定价、基础架构、规模等</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6511e68a312e7e1c88eec3ff062fdf38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KVy65uJn3SrzDCJE"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">鲁拜图·阿扎德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="cb3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我拍摄我的视角之前，这里有一些背景。我在一家大型流媒体应用的数据团队工作。我们团队的工作是大量的气流，我们有1000多个复杂的气流工作来处理我们的ETL和ML管道。</p><p id="abda" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最近，我和一个新团队开始合作，该团队正在从传统的spark 2.1自管理整体流程转向AWS EMR和无服务器架构(lambda等)。)来改善延迟，摆脱单片Spark ETL过程<em class="ls">(如果你想知道单片结构是什么样子，看我的</em> <a class="ae kv" href="https://github.com/smohanty0714/spark-etl-python" rel="noopener ugc nofollow" target="_blank"> <em class="ls"> repo这里</em> </a> <em class="ls">)。</em></p><p id="2eb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，团队正在考虑将AWS管理的气流作为ETL编排工具。但是，在团队评估合适的选项时，我们引入了AWS状态机，看看它如何帮助AWS管理气流。</p><p id="76d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我对这两个伟大工具的看法。</p><p id="5489" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我不会谈论这两个伟大产品之间的技术差异。相反，我将更多地关注我使用这两种产品的体验，以及它们的适用范围。</p><p id="5469" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，值得一提的是，本文关注的是Step函数ETL和ML pipeline功能——由于Step函数对于许多web应用程序和业务工作流<a class="ae kv" href="https://aws.amazon.com/step-functions/use-cases/" rel="noopener ugc nofollow" target="_blank">用例</a>来说要强大得多，因此我们不在此讨论这些功能，因为Airflow在这些领域没有竞争力。</p><h1 id="639f" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak"> 1。他们最适合的地方</strong></h1><p id="1c93" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">这两种服务最适合用于ETL和ML管道。</p><p id="94e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在构建管道方面，Airflow需要一点学习曲线(Python，Airflow操作符语法)。但同时，它有更多的控制权来编写复杂的管道。</p><p id="3e6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一方面，AWS状态机是一个更容易的开始，可以更快地与您的AWS服务集成——通过利用<a class="ae kv" href="https://docs.aws.amazon.com/step-functions/latest/dg/workflow-studio.html" rel="noopener ugc nofollow" target="_blank">状态机工作流工作室</a>用零代码构建您的管道。</p><p id="df32" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以通过拖放工作流控件来构建您的整个ETL流程，并且您的服务的集成将是完美的。除此之外，它将生成状态机定义JSON，您可以在CF/ SAM模板中使用它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/c68009d2417c2c4fde0d6965496f5647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4EXp2qpcTpJfYlgbug2KXw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">AWS状态机工作流工作室</p></figure><p id="e3e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在构建了我的第一个状态机之后，我发现在ETL和ML管道开发中，通过使用Step函数，你可以比使用Airflow更快地迭代它。</p><p id="5fc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在选择其中一个时，需要考虑的另一个标准是:您打算将哪些系统集成为您的ETL过程的一部分。</p><p id="7b6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当您的资源主要是AWS服务时，状态机是最合适的。但是，使用状态机连接到AWS非托管服务或本地服务并不那么简单。然而，这并不完全是一个障碍，因为您可以看到这里的一个<a class="ae kv" href="https://aws.amazon.com/blogs/big-data/orchestrate-big-data-jobs-on-on-premises-clusters-with-aws-step-functions/" rel="noopener ugc nofollow" target="_blank">实现连接了来自状态机</a>的内部资源。</p><p id="323d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然AWS Managed Airflow也为许多AWS服务提供了插件集成，但在与外部服务交互时，它们的控制更加丰富。然而，如前所述，与所有AWS服务的集成需要编写一些代码。</p><h1 id="d866" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">2.<strong class="ak">它们的功能和特点有什么不同？</strong></h1><p id="58bd" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">就像Airflow为我们提供了丰富的操作符集来控制我们的工作流一样，AWS状态机也提供了许多高级的和丰富的工作流控件来设计你的工作流(Map iterator、Wait和Parallel)。虽然您不能像在Airflow中那样添加自定义操作符。但是，就我个人而言，我没有发现状态机流控制不能实现的用例。</p><p id="055c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，当我要求我的ETL过程有一些人工干预时，我发现状态机很丰富——比如在管道中需要批准才能进行下一步。在这种情况下，状态机为您提供控制，在您的管道中，您可以将控制发送给人，在批准/拒绝后，下一步将随之而来。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/377cb77e1c6f030f17b58f82914f9ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rm1_en0mCUzrRyIpv8wPSg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用状态机的人工干预驱动的工作流</p></figure><p id="8cc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">状态机没有提供的一个特性是状态机的调度，就像气流一样。虽然，有一些方法可以实现，比如AWS EventBridge触发的时间表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/8566a0d23b188c47efa6a4f34257e884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*afrBd1Ob4AG2ypI0-MnzAA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用状态机的ML流水线</p></figure><h1 id="3db5" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">3.<strong class="ak">基础设施和规模</strong></h1><p id="9771" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">气流是一个开源产品。它的安装和管理基础设施开销由AWS负责。然而，它的无服务器选项还不可用，所以你需要注意你的ETL负载，尽管AWS有<a class="ae kv" href="https://aws.amazon.com/managed-workflows-for-apache-airflow/features/" rel="noopener ugc nofollow" target="_blank">自动伸缩功能</a>。</p><p id="f3a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">而Step Function(状态机)是完全无服务器的，您没有管理或配置资源的负担。你按使用付费。</p><h1 id="b5bd" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">4.<strong class="ak">定价</strong></h1><p id="3c53" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">流量定价基于您选择的基础设施，而状态机则是按使用量付费。</p><p id="e985" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在此找到一些价格对比:</p><ul class=""><li id="8d42" class="ms mt iq ky b kz la lc ld lf mu lj mv ln mw lr mx my mz na bi translated"><a class="ae kv" href="https://aws.amazon.com/step-functions/pricing/" rel="noopener ugc nofollow" target="_blank">阶梯函数定价</a></li><li id="a004" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><a class="ae kv" href="https://aws.amazon.com/managed-workflows-for-apache-airflow/pricing/" rel="noopener ugc nofollow" target="_blank"> AWS管理气流定价</a></li></ul><h1 id="3fdf" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结论</h1><p id="3d3a" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我发现状态机是一个更丰富的产品，它使您能够更快地迭代您的ETL开发。</p><p id="c37f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与此同时，AWS Managed Airflow让您能够更好地控制ETL管道——但这需要付出更多的努力和学习曲线。</p><p id="437e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，一些现代和自动化的工作流程可能很难通过气流实现。</p></div></div>    
</body>
</html>