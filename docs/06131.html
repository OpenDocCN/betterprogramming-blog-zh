<html>
<head>
<title>Observe the Completion of 2 Network Requests Using Combine in Swift 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Swift 5中的Combine观察2个网络请求的完成情况</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/observe-the-completion-of-2-network-requests-using-combine-in-swift-5-6fc9e7304e4f?source=collection_archive---------14-----------------------#2020-09-03">https://betterprogramming.pub/observe-the-completion-of-2-network-requests-using-combine-in-swift-5-6fc9e7304e4f?source=collection_archive---------14-----------------------#2020-09-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="99d8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用的力量。邮政运营商</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1a33a6c5823d93ec4bf5eb9f9f8c9ab3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wVVTDhMpShHsE2ZNZQFE0g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">丹尼尔·罗梅罗在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="9fd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑这种情况:应用程序中的一个特定屏幕需要同时发出两个不同的请求。你的目标是在完成后<em class="lv">才更新UI。在本教程中，我们将学习如何使用Combine观察几个网络请求的完成情况。</em></p><p id="3845" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将利用一个强大的<code class="fe lw lx ly lz b">.zip</code>操作符，它允许我们从几个上游<code class="fe lw lx ly lz b">Publishers</code>接收包含事件的元组。</p><p id="a061" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，这些是您将在本教程中掌握的主题:</p><ul class=""><li id="6778" class="ma mb it lb b lc ld lf lg li mc lm md lq me lu mf mg mh mi bi translated">使用<code class="fe lw lx ly lz b">.zip</code>操作器组合几个<code class="fe lw lx ly lz b">Publishers</code>。</li><li id="473c" class="ma mb it lb b lc mj lf mk li ml lm mm lq mn lu mf mg mh mi bi translated">使用内置的<code class="fe lw lx ly lz b">URLSessionDataTask</code>发布器执行网络请求。</li><li id="3ec2" class="ma mb it lb b lc mj lf mk li ml lm mm lq mn lu mf mg mh mi bi translated">使用带有键路径的<code class="fe lw lx ly lz b">.map</code>操作符获得转换后的发布者。</li></ul><p id="ea8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成的Xcode操场的源代码可以在文章的底部找到。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="09d1" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">我们开始吧</h1><p id="9ec6" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">首先，我们需要导入<code class="fe lw lx ly lz b">Combine</code>并创建一个<code class="fe lw lx ly lz b">subscriptions</code>属性:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="1d64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们创建一个从Unsplash获取随机照片的方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="9efe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，Combine为<code class="fe lw lx ly lz b">URLSessionDataTask</code>内置了一个发布器。</p><p id="f96d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lw lx ly lz b">.map(keyPath:)</code>操作符，我们只用一行代码就获得了<code class="fe lw lx ly lz b">Data</code>。</p><p id="7671" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，如果在请求过程中发生任何错误，我们使用<code class="fe lw lx ly lz b">.replaceError</code>操作符用一个空的<code class="fe lw lx ly lz b">Data</code>对象替换错误。</p><p id="7027" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们使用<code class="fe lw lx ly lz b">.eraseToAnyPublisher</code>方法删除发布者的类型。</p><p id="a44b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了！现在我们可以从Unsplash获取一张随机照片。现在让我们再添加一个获取本周特色照片的方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="8f32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们的任务是启动这些请求，并在两个请求都完成时得到通知。通过使用<code class="fe lw lx ly lz b">.zip</code>操作符，我们实现了我们想要的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="8a4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意在<code class="fe lw lx ly lz b">.handleEvents</code>操作符中，我们如何获得包含两个<code class="fe lw lx ly lz b">Data</code>对象的元组:一个来自<code class="fe lw lx ly lz b">randomPhotoPublisher</code>，另一个来自<code class="fe lw lx ly lz b">weeklyPhotoPublisher</code>。</p><p id="555e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们跑操场，我们会注意到两个图像同时打印出来:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/fb66093125745eac7bac432ee0724c4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pZJpMuRilVpUXYK0qfV2iA.png"/></div></div></figure><p id="f4c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经成功地观察到使用Combine完成了几个请求。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="6e98" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">结论</h1><p id="f570" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">感谢阅读！</p><p id="1134" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Xcode游乐场的源代码在<a class="ae ky" href="https://gist.github.com/zafarivaev/41241de9bb4b178950352f92733e4009" rel="noopener ugc nofollow" target="_blank">这个要诀</a>里有。</p></div></div>    
</body>
</html>