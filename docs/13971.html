<html>
<head>
<title>Form Validation in UIKit Made Easy With Combine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">UIKit中的表单验证通过Combine变得简单</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/form-validation-in-uikit-made-easy-with-combine-dd8245bacb6c?source=collection_archive---------1-----------------------#2022-10-21">https://betterprogramming.pub/form-validation-in-uikit-made-easy-with-combine-dd8245bacb6c?source=collection_archive---------1-----------------------#2022-10-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e5b6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过反应式方法简化</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c68e7a0ebdca5ebcf1a118fd383f67bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q1iqDCp7XeOykGOoSDQ_og.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@wesson?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">威森王</a>在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><blockquote class="kw kx ky"><p id="d79a" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">Combine框架提供了一个声明性的Swift API，用于随时处理值。这些值可以表示多种异步事件。—苹果开发者文档</p></blockquote><p id="827e" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/combine" rel="noopener ugc nofollow" target="_blank">联合收割机</a>在WWDC19和iOS13中推出。在Combine中有两个重要的元素，发布者和订阅者。发布者仅用于公开可随时间变化的值，而订阅者用于从发布者接收值。</p><h1 id="b2a5" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">入门指南</h1><p id="1c04" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">在本文中，我们将学习如何:</p><ol class=""><li id="5ac9" class="mw mx iq lc b ld le lg lh lw my lx mz ly na lv nb nc nd ne bi translated">用UITextField和UIButton创建一个简单的登录表单</li><li id="787d" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">使用Combine被动地验证用户输入</li><li id="2002" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">根据用户输入启用或禁用提交按钮</li><li id="6a35" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">连续观察表单的多种状态——加载、成功和失败</li></ol><p id="dd22" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">请注意，这个项目是在Swift 5中用iOS13+和Xcode 13.4开发的。</p><p id="8e9f" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">下面是我们将从本教程实现的应用程序的最终输出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/f866ad0b1700e8c38ac99297e1483091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nMLSPziAEfy0Omz1J0ckHA.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">本教程的最终输出。图片作者。</p></figure><h1 id="4367" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">1.创建新的UIKit项目</h1><p id="e176" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">选择文件&gt;新建&gt;项目。选择一个应用程序，取消选中“包括测试”复选框(在本教程中不使用)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/6b129227ba659921e4880d12b7029f0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p8SBjQgnjoGUbeCApmNxaA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用故事板和Swift创建新的UIKit项目。图片作者。</p></figure><h1 id="7867" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">2.在视图控制器中添加文本字段和按钮</h1><p id="3673" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">我们将使用默认的<code class="fe nm nn no np b">ViewController</code>作为主登录视图控制器。在此示例中，UI对象是以编程方式添加的。如果你愿意，你可以使用故事板。我们将添加两个文本字段(电子邮件和密码)，以及一个提交按钮。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="b5df" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">下面是上面代码的分解:</p><ol class=""><li id="74e0" class="mw mx iq lc b ld le lg lh lw my lx mz ly na lv nb nc nd ne bi translated">使用通用样式和配置定义UI对象(堆栈视图、电子邮件文本字段、密码文本字段和提交按钮)。</li><li id="14cd" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">堆栈视图用作表单元素的主要容器。</li><li id="ba12" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">将堆栈视图的约束垂直设置在视图的中心，水平填充为<code class="fe nm nn no np b">24px</code>。然后，将文本字段和按钮设置为相同的高度，<code class="fe nm nn no np b">48px</code>。</li><li id="2ba4" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated"><code class="fe nm nn no np b">onSubmit()</code>，点击<code class="fe nm nn no np b">submitButton</code>时会调用的功能。</li></ol><p id="5910" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">在下一节完成视图模型之后，我们将再次访问这个视图控制器来更新验证部分。</p><h1 id="b165" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">3.创建视图模型</h1><p id="5b65" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">在本节中，我们将创建登录表单使用的视图模型，其中包含发布者和一些逻辑。</p><p id="2f83" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">创建一个名为<code class="fe nm nn no np b">LoginViewModel.swift</code>的新Swift文件，并插入下面的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="5fd9" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">以下是代码的解释:</p><ol class=""><li id="b2a6" class="mw mx iq lc b ld le lg lh lw my lx mz ly na lv nb nc nd ne bi translated">通过子类化<code class="fe nm nn no np b"><a class="ae kv" href="https://developer.apple.com/documentation/combine/observableobject" rel="noopener ugc nofollow" target="_blank">ObservableObject</a></code>，视图模型能够向订阅者发送其<code class="fe nm nn no np b">@Published</code>属性的更改值。</li><li id="de43" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">枚举来管理视图的不同状态。</li><li id="ac1f" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">每次用户进行更改时将被更新的<code class="fe nm nn no np b">Publishers</code>列表。此外，它还提供了通知订户更新值的能力。</li><li id="e0b5" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated"><code class="fe nm nn no np b">isValidUsernamePublisher</code>和<code class="fe nm nn no np b">isValidPasswordPublisher</code>包含验证用户输入的逻辑，这在<code class="fe nm nn no np b">map</code>闭包中完成。<code class="fe nm nn no np b">eraseToAnyPublisher()</code>用于将最终值返回给任何发布者(在本例中为<code class="fe nm nn no np b">isSubmitEnabled</code>)。</li><li id="b518" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated"><code class="fe nm nn no np b">isSubmitEnabled</code>结合将要订阅<code class="fe nm nn no np b">submitButton</code>的<code class="fe nm nn no np b">isValidUsernamePublisher</code>和<code class="fe nm nn no np b">isValidPasswordPublisher</code>的值来启用或禁用。</li><li id="9527" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">一个用简单的用户名和密码检查来模拟登录请求的功能。</li><li id="0538" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">视图的<code class="fe nm nn no np b">state</code>会在成功或失败时更新。</li><li id="756a" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">验证电子邮件格式的计算属性。</li></ol><p id="61b1" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">很好，让我们更新我们的视图控制器，用我们的视图模型实现验证。</p><h1 id="b982" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">4.更新登录视图控制器</h1><p id="d16e" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">第一个要更新的部分是导入<code class="fe nm nn no np b">Combine</code>框架。然后，初始化视图模型和<code class="fe nm nn no np b">AnyCancellable</code>设置。<a class="ae kv" href="https://developer.apple.com/documentation/combine/anycancellable" rel="noopener ugc nofollow" target="_blank"> AnyCancellable </a>使订阅者可以释放发布者。它将取消订阅并释放所有分配的资源。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="3be1" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">添加一个错误标签，该标签将在登录无效时出现。然后，将标签添加到堆栈视图的底部。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="a38b" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">接下来，我们将添加发布者处理程序和一些助手函数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="efb6" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">下面是上面代码中发生的情况:</p><ol class=""><li id="1546" class="mw mx iq lc b ld le lg lh lw my lx mz ly na lv nb nc nd ne bi translated"><code class="fe nm nn no np b">NotificationCenter</code> publisher用于观察文本字段的变化，并立即处理<code class="fe nm nn no np b">map</code>中的值。然后，在<code class="fe nm nn no np b">assign</code>中，该值被更新到视图模型变量中。</li><li id="4dbb" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated"><code class="fe nm nn no np b">isSubmitEnabled</code>随着<code class="fe nm nn no np b">Bool</code>值被检查一段时间，以启用该视图控制器中的<code class="fe nm nn no np b">submitButton</code>。</li><li id="d3bb" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">正在观察视图模型中<code class="fe nm nn no np b">state</code>的值来更新表单UI，如显示加载、启用按钮、显示错误。</li><li id="7800" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated"><code class="fe nm nn no np b">onSubmit</code>函数更新为调用视图模型提交流程。</li><li id="51f1" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated"><code class="fe nm nn no np b">resetButton</code>主要是设置按钮成功后，加载或出错的状态。</li><li id="bb50" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">在此功能中，错误标签将被隐藏或显示。当错误标签消失时，我们使用<code class="fe nm nn no np b">alpha</code>而不是<code class="fe nm nn no np b">isHidden</code>来保持堆栈视图在相同的高度或大小。</li></ol><h1 id="8c30" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">5.显示成功屏幕</h1><p id="c6d3" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">在最后一部分，我们将创建一个简单的屏幕，一旦表单提交成功，就会显示这个屏幕。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="790a" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">在上面的代码中，我们创建了一个带有标签的视图控制器，并使用<code class="fe nm nn no np b">centerX</code>和<code class="fe nm nn no np b">centerY</code>约束将它放置在屏幕中间。</p><p id="6980" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">确保向故事板添加一个导航控制器。</p><ol class=""><li id="1d10" class="mw mx iq lc b ld le lg lh lw my lx mz ly na lv nb nc nd ne bi translated">打开<code class="fe nm nn no np b">Main.storyboard</code>并选择视图控制器。</li><li id="8e3c" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nb nc nd ne bi translated">在Xcode顶部菜单中，选择编辑器&gt;嵌入&gt;导航控制器。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/e086e8fbd17d4eb263a18e87959bd7b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0Ll2sedOWbQ9M-bV4jpmA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">嵌入导航控制器后查看控制器。图片作者。</p></figure><p id="9f08" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">最后更新<code class="fe nm nn no np b">showResultScreen()</code>函数推<code class="fe nm nn no np b">ResultViewController</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h1 id="746e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">项目已完成</h1><p id="6a47" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">恭喜你！我们已经完成了所有的步骤，项目现在可以运行了。</p><p id="fdb7" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">我们还了解了一些关于将Combine框架与其发布者和订阅者一起使用的知识。</p><p id="78bc" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">完整的源代码可以从我的GitHub <a class="ae kv" href="https://github.com/xmhafiz/medium-form-validation-uikit-combine" rel="noopener ugc nofollow" target="_blank">库</a>下载。你可以试着在你的项目中实现它，也许还可以改进我的代码。</p><p id="5074" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">感谢您的阅读，祝您编码愉快！</p><h1 id="5c9f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">参考</h1><ul class=""><li id="3aa7" class="mw mx iq lc b ld mr lg ms lw nt lx nu ly nv lv nw nc nd ne bi translated">苹果公司的<a class="ae kv" href="https://developer.apple.com/documentation/combine" rel="noopener ugc nofollow" target="_blank">联合</a>文档</li><li id="93c5" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nw nc nd ne bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/combine/observableobject" rel="noopener ugc nofollow" target="_blank">可观察对象</a>文档</li><li id="e6b2" class="mw mx iq lc b ld nf lg ng lw nh lx ni ly nj lv nw nc nd ne bi translated"><a class="ae kv" href="https://github.com/xmhafiz/medium-form-validation-uikit-combine" rel="noopener ugc nofollow" target="_blank"> GitHub项目</a>使用Combine和UIKit进行表单验证</li></ul></div></div>    
</body>
</html>