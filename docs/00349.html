<html>
<head>
<title>Spring Security — User Roles and ThymeLeaf Extras</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Security —用户角色和百里香附加功能</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/spring-security-user-roles-and-thymeleaf-extras-c10113d4ad75?source=collection_archive---------1-----------------------#2019-04-30">https://betterprogramming.pub/spring-security-user-roles-and-thymeleaf-extras-c10113d4ad75?source=collection_archive---------1-----------------------#2019-04-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7225" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">基于spring用户角色显示和隐藏内容</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/db3797ade0d6cff618e17f798c0a74f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T2wdQIJ5AltYubbH"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@aniket940518?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Aniket Bhattacharya </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="3b85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上一课中，我们学习了如何使用spring security构建一个基本的登录表单。今天，我们将看看添加用户角色和百里香图书馆的一些不错的功能，以显示和隐藏基于这些角色的内容。</p><h1 id="e790" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">属国</h1><p id="a0a8" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">与所有Spring boot应用程序一样，一些starter库使得向类路径添加jar变得很容易。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/2.thymeleaf-extras" rel="noopener ugc nofollow" target="_blank"> pom.xml </a></p></figure><h1 id="29d0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">WebSecurityConfig</h1><p id="2c2c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，我们将向应用程序的<code class="fe mu mv mw mx b">WebSecurityConfig.configureGlobal</code>方法添加另一个用户。这次给他们一个新的角色<code class="fe mu mv mw mx b">admin</code>。现有用户被授予用户角色<code class="fe mu mv mw mx b">.roles("USER")</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/2.thymeleaf-extras" rel="noopener ugc nofollow" target="_blank">WebSecurityConfig.java</a></p></figure><p id="892b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们有两个可用的用户可以登录。每个用户都配置了不同的角色，我们现在可以使用这些角色来隐藏和显示不同的内容。</p><p id="c907" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本课程的其余部分保持不变，关键点可以总结为:</p><ul class=""><li id="0257" class="my mz it lb b lc ld lf lg li na lm nb lq nc lu nd ne nf ng bi translated"><code class="fe mu mv mw mx b"><em class="nh">authorizeRequests()</em></code> —允许我们配置web服务器上的哪些资源需要保护。你可以从我们的示例代码中看到，我们允许对CSS、图片目录和favicon进行不安全的访问。所有其他资源都是安全的，只有经过身份验证的用户才能访问。</li><li id="b44b" class="my mz it lb b lc ni lf nj li nk lm nl lq nm lu nd ne nf ng bi translated"><code class="fe mu mv mw mx b">formLogin()</code>告诉spring security我们希望使用一个登录表单。<br/>如果认证成功，我们提供我们想要重定向到的URL，最后，我们允许访问登录和注销端点。</li><li id="747e" class="my mz it lb b lc ni lf nj li nk lm nl lq nm lu nd ne nf ng bi translated">我们正在禁用默认情况下启用的跨站点请求伪造保护。我们将在本系列的后面讨论这一点。</li></ul><h1 id="d16b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">百里香叶:授权</h1><p id="1fee" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">接下来，在我们的index.html页面中呈现div之前，我们将使用百里香属性<code class="fe mu mv mw mx b">sec:authorize</code>来检查用户角色。</p><p id="51b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们首先需要将百里香XML名称空间添加到我们的<a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/blob/2.thymeleaf-extras/src/main/resources/templates/index.html" rel="noopener ugc nofollow" target="_blank">index.html</a>中。</p><pre class="kj kk kl km gt nn mx no np aw nq bi"><span id="bc61" class="nr lw it mx b gy ns nt l nu nv">&lt;html  xmlns:th="http://www.thymeleaf.org"<br/>      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"&gt;</span></pre><p id="97c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们可以使用<code class="fe mu mv mw mx b">sec:authorize</code>属性来检查用户的角色(他们有权查看的内容):</p><pre class="kj kk kl km gt nn mx no np aw nq bi"><span id="96d3" class="nr lw it mx b gy ns nt l nu nv">&lt;div sec:authorize="hasRole('ADMIN')"&gt;<br/>    This content is only shown to administrators.§§<br/>&lt;/div&gt;<br/><br/>&lt;div sec:authorize="hasRole('USER')"&gt;<br/>    This content is only shown to users.<br/>&lt;/div&gt;</span></pre><p id="c0c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，属性<code class="fe mu mv mw mx b">sec:authorize</code>被添加到每个div中，我们使用spring安全方言来检查用户的spring安全角色。只有登录用户拥有该角色时，才会呈现内容。即<em class="nh"> hasRole </em>返回真。</p><p id="71fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值得注意的是，内容不仅是隐藏的，而且当我们的应用服务器将页面返回给浏览器时，内容也不会被呈现。</p><h1 id="3446" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">百里香叶:认证</h1><p id="3c37" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">百里香的另一个有用的特性是<code class="fe mu mv mw mx b">sec:authentication</code>属性。该属性可以返回各种与安全相关的元数据。在下面的例子中，我们可以检索用户的用户名和角色，并在HTML中显示它们。</p><pre class="kj kk kl km gt nn mx no np aw nq bi"><span id="b3ed" class="nr lw it mx b gy ns nt l nu nv">&lt;div&gt;<br/>    User: &lt;span sec:authentication="name"&gt;NOT FOUND&lt;/span&gt;<br/>    Spring Roles: &lt;span sec:authentication="principal.authorities"&gt;NOT FOUND&lt;/span&gt;<br/>&lt;/div&gt;</span></pre><p id="99f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多有用的属性见<a class="ae ky" href="https://github.com/thymeleaf/thymeleaf-extras-springsecurity" rel="noopener ugc nofollow" target="_blank">百里香文档</a></p><h1 id="a0b4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">演示</h1><p id="a16f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要运行演示，<a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/2.thymeleaf-extras" rel="noopener ugc nofollow" target="_blank">检查源代码</a>并打开应用程序类，右键单击run。</p><p id="44f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要开始这个示例，您的机器上需要有端口8080。如果不是，您可以使用以下命令在application.properties文件中更改此默认值:</p><pre class="kj kk kl km gt nn mx no np aw nq bi"><span id="de40" class="nr lw it mx b gy ns nt l nu nv">server.port=8081</span></pre><p id="13e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将它设置为您想要的任何值。</p><p id="d408" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以观看这个短片:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw mt l"/></div></figure><h1 id="debd" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">单元测试</h1><p id="610c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们增加了一些单元测试来涵盖这个新功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/2.thymeleaf-extras" rel="noopener ugc nofollow" target="_blank">ApplicationTests.java</a></p></figure><p id="5844" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经创建了一个小的实用方法<code class="fe mu mv mw mx b">doesNotContainString</code>。使用这个和Hamcrests】方法，我们可以检查内容是否基于特定的用户角色被呈现。</p><p id="6880" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至关重要的是，spring test注释<code class="fe mu mv mw mx b">@WithMockUserp</code>提供了模仿某些用户的能力——在我们的场景中，是一个具有<code class="fe mu mv mw mx b">user</code>或<code class="fe mu mv mw mx b">admin</code>角色的认证用户。</p><p id="11d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我们正在使用的Spring测试支持的快速回顾:</p><ul class=""><li id="346f" class="my mz it lb b lc ld lf lg li na lm nb lq nc lu nd ne nf ng bi translated"><code class="fe mu mv mw mx b">@ExtendWith(SpringExtension.class)</code> —告诉JUnit5在Spring的测试支持下运行单元测试</li><li id="f121" class="my mz it lb b lc ni lf nj li nk lm nl lq nm lu nd ne nf ng bi translated"><code class="fe mu mv mw mx b">@SpringBootTest </code> —作为spring boot app运行。即装载<code class="fe mu mv mw mx b">application.properties</code>和弹簧豆</li><li id="f31c" class="my mz it lb b lc ni lf nj li nk lm nl lq nm lu nd ne nf ng bi translated"><code class="fe mu mv mw mx b">@AutoConfigureMockMvc </code> —创建一个名为MockMvc的测试助手类。我们可以模拟一个前端客户端从这里向服务器发出请求。</li><li id="ac02" class="my mz it lb b lc ni lf nj li nk lm nl lq nm lu nd ne nf ng bi translated"><code class="fe mu mv mw mx b">@WithMockUser </code> —提供模拟某些用户的能力，在我们的例子中是经过身份验证的用户。</li><li id="0253" class="my mz it lb b lc ni lf nj li nk lm nl lq nm lu nd ne nf ng bi translated"><code class="fe mu mv mw mx b">FormLoginRequestBuilder </code> —允许我们创建基于表单的登录请求的实用程序类。</li></ul></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="90de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://mwhyte.dev/spring-security-redirect-based-on-user-roles-cb847ab6df35" rel="noopener ugc nofollow" target="_blank">接下来</a>，我们将继续介绍spring security的用户角色，但这一次我们将把管理员重定向到他们自己的管理页面(<code class="fe mu mv mw mx b">admin.html</code>)，并保护该页面，以便只有管理员用户可以访问它。</p><div class="oe of gp gr og oh"><a rel="noopener  ugc nofollow" target="_blank" href="/spring-security-redirect-based-on-user-roles-cb847ab6df35"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">Spring Security —基于用户角色的重定向</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">基于spring用户角色将用户定向到页面</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">better编程. pub</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ks oh"/></div></div></a></div></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="e401" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不是中等会员？支持我成为其中一员:</p><div class="oe of gp gr og oh"><a href="https://mwhyte.dev/membership" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">通过我的推荐链接加入Medium迈克尔威特</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">mwhyte.dev</p></div></div><div class="oq l"><div class="ow l os ot ou oq ov ks oh"/></div></div></a></div></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="5367" class="lv lw it bd lx ly ox ma mb mc oy me mf jz oz ka mh kc pa kd mj kf pb kg ml mm bi translated">资源</h1><div class="oe of gp gr og oh"><a href="https://github.com/mwhyte-dev/spring-security/tree/2.thymeleaf-extras" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">GitHub-mwhyte-dev/spring-2 . thyme leaf-extras的安全性</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">github.com</p></div></div><div class="oq l"><div class="pc l os ot ou oq ov ks oh"/></div></div></a></div><div class="oe of gp gr og oh"><a href="https://spring.io/projects/spring-security" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">春天安全</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">提高您的Java代码水平，探索Spring能为您做什么。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">spring.io</p></div></div></div></a></div><div class="oe of gp gr og oh"><a href="https://www.thymeleaf.org/doc/articles/springsecurity.html" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">百里香+ Spring安全集成基础</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">你有没有换成百里香，但是你的登录和错误页面还在用JSP？在本文中，我们将了解如何…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">www.thymeleaf.org</p></div></div><div class="oq l"><div class="pd l os ot ou oq ov ks oh"/></div></div></a></div></div></div>    
</body>
</html>