<html>
<head>
<title>Bundle Up a JavaScript Project Using Esbuild</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Esbuild捆绑一个JavaScript项目</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/bundle-up-a-javascript-project-using-esbuild-b2c824ba0d39?source=collection_archive---------3-----------------------#2022-01-26">https://betterprogramming.pub/bundle-up-a-javascript-project-using-esbuild-b2c824ba0d39?source=collection_archive---------3-----------------------#2022-01-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6d67" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">esbuild简介——一个速度极快的JavaScript/CSS捆绑器和迷你器</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a2e3fd4b1ee1ecaf66eb31236d0a950c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MPBmtmWUH2ZSENZk"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@blairyang?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布莱尔杨</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="fc38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">esbuild是一个速度极快的JavaScript/CSS捆绑器和迷你器。它创建于2016年6月，在GitHub上有3万颗星，每周从npm注册表<a class="ae ky" href="https://www.npmjs.com/package/esbuild" rel="noopener ugc nofollow" target="_blank">下载210万次。</a></p><p id="e2de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">esbuild</code>被写入<a class="ae ky" href="https://go.dev/" rel="noopener ugc nofollow" target="_blank"> Go </a>并编译成本机代码。Go是从核心为并行而设计的，esbuild内部的算法经过精心设计，尽可能使所有可用的CPU核心完全饱和。esbuild中的所有内容都是从头开始编写的，内存使用效率很高。这些都有助于esbuild的高性能。</p><p id="6389" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">esbuild</code>是挑战当前标准构建工具的新人，如<a class="ae ky" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> webpack </a>、<a class="ae ky" href="https://rollupjs.org/guide/en/" rel="noopener ugc nofollow" target="_blank"> rollup </a>等。以下基准测试表明，esbuild比其他捆绑器快得多:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lz"><img src="../Images/404e13020e2245a4889aa1ae1f1e4b96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_kNPZqV0DEMg9SLTK2g1eQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://github.com/evanw/esbuild/blob/master/images/benchmark.svg" rel="noopener ugc nofollow" target="_blank">https://github . com/evanw/es build/blob/master/images/benchmark . SVG</a></p></figure><p id="5126" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是比较捆扎机受欢迎程度的npm趋势:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ma"><img src="../Images/8c4dbe4d4e91fa255d8e5181c7863480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sy2Uz9xIpy07Gr7p4nTh0g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4d09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">esbuild</code>仍然是一个1.0之前的软件，还没有功能完整。它已经驱动了<a class="ae ky" href="https://github.com/snowpackjs/snowpack" rel="noopener ugc nofollow" target="_blank"> Snowpack </a>、<a class="ae ky" href="https://github.com/vitejs/vite" rel="noopener ugc nofollow" target="_blank"> Vite </a>、<a class="ae ky" href="https://github.com/sveltejs/kit" rel="noopener ugc nofollow" target="_blank"> SvelteKit </a>、<a class="ae ky" href="https://remix.run/" rel="noopener ugc nofollow" target="_blank"> Remix Run </a>等等。它有可能重塑bundler世界。</p><p id="60f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们详细了解一下如何使用<code class="fe lv lw lx ly b">esbuild</code>。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="e280" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">一个HTML项目</h1><p id="6bbc" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我们使用为<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/bundle-up-a-javascript-project-using-rollup-2f80205f5f5c">汇总文章</a>创建的项目。这是一个用于响应菜单的小型HTML项目。当该应用程序在移动设备上运行时，它会在各种情况下显示以下屏幕。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/55ad604deeea190e23549c5f344abc78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4P0wANGrMoV0YIPD.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3f3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">左侧屏幕是起始页。由于内容比显示区域长，我们需要向下滚动来查看剩余的内容(中间的屏幕)。当点击右上角的汉堡菜单时，会显示一个垂直菜单(右侧屏幕)。</p><p id="172d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当应用程序以最小宽度<code class="fe lv lw lx ly b">768px</code>出现在桌面上时，它会显示一个水平菜单:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/1e9fbbca84e57650258eac4572cfb087.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hz4EHBytfAMCnqld.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0d8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">源代码位于这个<a class="ae ky" href="https://github.com/JenniferFuBook/html-example" rel="noopener ugc nofollow" target="_blank"> GitHub仓库</a>，下面是文件夹结构。</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="6305" class="nk mj it ly b gy nl nm l nn no">$ ls -R<br/>images     index.html style.css./images:<br/>flower.jpg    hamburger.svg./src:<br/>index.js</span></pre><p id="d1ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个典型的HTML项目，带有一个包含一些图片、一个样式表和JavaScript代码的<code class="fe lv lw lx ly b">index.html</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="39d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第7行是到<code class="fe lv lw lx ly b">style.css</code>的链接。</p><p id="0d3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第8行包含JavaScript代码。</p><p id="48be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">14号线是JPG之花。</p><p id="0193" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第17行是汉堡<a class="ae ky" href="https://medium.com/better-programming/create-react-app-and-svgs-70970ac715f2" rel="noopener"> SVG </a>，显示在一个窄屏幕上。</p><p id="f7ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该项目可以通过<a class="ae ky" href="https://medium.com/better-programming/10-useful-plugins-for-visual-studio-code-6ab62c0b14ee" rel="noopener"> VSCode </a>的实时服务器启动。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/2dbde178e9b8deea8d970795c5dc12f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/0*ePQLv32ov_D46hY_.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="f7e3" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">设置esbuild bundler</h1><p id="802c" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">首先，我们将克隆项目:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="1808" class="nk mj it ly b gy nl nm l nn no">git clone <a class="ae ky" href="https://github.com/JenniferFuBook/html-example.git" rel="noopener ugc nofollow" target="_blank">https://github.com/JenniferFuBook/html-example.git</a></span></pre><p id="5390" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用npm管理此项目:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="eb90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面生成的<code class="fe lv lw lx ly b">package.json</code>中，添加一个<code class="fe lv lw lx ly b">build</code>脚本(第7行)。此外，创建一个<code class="fe lv lw lx ly b"><a class="ae ky" href="https://medium.com/better-programming/package-jsons-dependencies-in-depth-a1f0637a3129" rel="noopener">devDependencies</a></code>部分(第21–23行)来下载<code class="fe lv lw lx ly b">esbuild</code>进行开发。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="6490" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是<code class="fe lv lw lx ly b">src/index.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="8908" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行<code class="fe lv lw lx ly b">npm run build</code>生成包输出<code class="fe lv lw lx ly b">dist/bundle.js</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="f388" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">dist/bundle.js</code>是<code class="fe lv lw lx ly b">iife</code>格式，这是一个在浏览器中运行的自执行函数。<code class="fe lv lw lx ly b">iife</code>是默认格式。</p><p id="7411" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建命令也可以作为CLI执行:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="f81e" class="nk mj it ly b gy nl nm l nn no">npx esbuild src/index.js --bundle --outfile=dist/bundle.js</span></pre><p id="6aa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它相当于:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="ff53" class="nk mj it ly b gy nl nm l nn no">npx esbuild src/index.js --bundle --outfile=dist/bundle.js --format=iife</span></pre><p id="625c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了<code class="fe lv lw lx ly b">iife</code>之外，<code class="fe lv lw lx ly b">esbuild</code>还支持<code class="fe lv lw lx ly b">cjs</code>和<code class="fe lv lw lx ly b">esm</code>。</p><p id="8bca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">cjs</code>格式旨在在<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/3-major-features-of-node-js-17-4bee7135df02">节点</a>中运行。它由以下命令生成:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="6aef" class="nk mj it ly b gy nl nm l nn no">npx esbuild src/index.js --bundle --outfile=dist/bundle.js --format=cjs</span></pre><p id="c688" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/what-might-be-coming-in-npm-9-6985cf2678a6">esm</a></code>格式从ES2015开始可用，可用于浏览器和节点。它由以下命令生成:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="84d7" class="nk mj it ly b gy nl nm l nn no"><br/>npx esbuild src/index.js --bundle --outfile=dist/bundle.js --format=esm</span></pre><p id="d194" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个简单的例子，生成的<code class="fe lv lw lx ly b">dist/bundle.js</code>对于<code class="fe lv lw lx ly b">cjs</code>和<code class="fe lv lw lx ly b">esm</code>格式是相同的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="a576" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">index.html</code>可以修改为指向生成的<code class="fe lv lw lx ly b">dist/bundle.js</code>。</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="027d" class="nk mj it ly b gy nl nm l nn no">&lt;script src="dist/bundle.js"&gt;&lt;/script&gt;</span></pre></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="ab7b" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">使用esbuild捆绑多个文件</h1><p id="4586" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">将本文与使用Rollup 捆绑一个JavaScript项目的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/bundle-up-a-javascript-project-using-rollup-2f80205f5f5c">进行比较，我们没有启动<code class="fe lv lw lx ly b">index.html</code>的脚本<code class="fe lv lw lx ly b">start</code>。</a></p><p id="fbae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们已经提到的，<code class="fe lv lw lx ly b">esbuild</code>仍然是一个1.0之前的软件，还没有功能完整。在即将到来的路线图中，使用html作为捆绑的起点是一个潜在的未来特性。</p><p id="9806" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个小的HTML项目，它不需要捆绑器也能工作。我们已经看到了<code class="fe lv lw lx ly b">esbuild</code>的局限性——<code class="fe lv lw lx ly b">esbuild</code>仍然依赖于一个web服务器(比如VSCode的live服务器，或者<code class="fe lv lw lx ly b">http</code>服务器)来启动<code class="fe lv lw lx ly b">index.html</code>。另外，<code class="fe lv lw lx ly b">src/index.js</code>和生成的<code class="fe lv lw lx ly b">dist/bundle.js</code>看起来也差不多。</p><p id="5177" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，我们为什么需要<code class="fe lv lw lx ly b">esbuild</code>？</p><p id="b6ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当项目变得复杂时，会有更多的代码行。对于代码模块化，我们应该把它们放到多个JavaScript/CSS文件中。</p><p id="f3f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<code class="fe lv lw lx ly b">src/index.js</code>分解成两个文件，<code class="fe lv lw lx ly b">src/media.js</code>和<code class="fe lv lw lx ly b">src/index.js</code>。</p><p id="ebe6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">src/media.js</code>包含了<code class="fe lv lw lx ly b">media</code>的定义。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="7395" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">media</code>的这个定义是由<code class="fe lv lw lx ly b">src/index.js</code>导入的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="9846" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用VSCode的live服务器启动<code class="fe lv lw lx ly b">index.html</code>。汉堡菜单不再响应点击，检测控制台显示以下错误:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="7250" class="nk mj it ly b gy nl nm l nn no">Uncaught SyntaxError: Cannot use import statement outside a module</span></pre><p id="66db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们在第1行注释掉import语句，它会显示另一个错误:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="f3b4" class="nk mj it ly b gy nl nm l nn no">Uncaught ReferenceError: media is not defined<br/>    at window.onload (index.js:10:3)</span></pre><p id="9af7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了解决这个问题，我们需要一个捆绑器将小块JavaScript代码与样式表和图像一起编译。这个更大更复杂的文件变成了一个库或应用程序。</p><p id="3e98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行<code class="fe lv lw lx ly b">npm run build</code>、<code class="fe lv lw lx ly b">esbuild</code>将<code class="fe lv lw lx ly b">src/media.js</code>和<code class="fe lv lw lx ly b">src/index.js</code>捆绑成一个文件<code class="fe lv lw lx ly b">dist/index.js</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="4961" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<code class="fe lv lw lx ly b">index.html</code>指向<code class="fe lv lw lx ly b">dist/index.js</code>可以让这个应用程序工作。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="d8ce" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">使用esbuild观看实时重新加载文件</h1><p id="d377" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">在当今的开发环境中，当文件发生变化时，使用实时重载来刷新应用程序是很常见的。我们可以用<code class="fe lv lw lx ly b">esbuild</code>实时重装文件吗？</p><p id="9a90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，我们可以。</p><p id="40a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">package.json</code>中，我们添加了<code class="fe lv lw lx ly b">start</code>脚本，其中设置了<code class="fe lv lw lx ly b">watch</code>标志。当文件改变时，它重新运行<code class="fe lv lw lx ly b">esbuild</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="4fc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">start</code>脚本可以简化为:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="5385" class="nk mj it ly b gy nl nm l nn no">"start": "<!-- -->npm run build -- --watch"</span></pre><p id="1a6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行<code class="fe lv lw lx ly b">npm start</code>，控制台消息显示进程处于监视模式。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="8e54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保<code class="fe lv lw lx ly b">index.html</code>指向生成的<code class="fe lv lw lx ly b">dist/bundle.js</code>。</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="9c96" class="nk mj it ly b gy nl nm l nn no">&lt;script src="dist/bundle.js"&gt;&lt;/script&gt;</span></pre><p id="6adf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">启动VSCode的实时服务器。在<code class="fe lv lw lx ly b">src/index.js</code>里面，我们加一行<code class="fe lv lw lx ly b">console.log('randomly typing…')</code>。保存后，我们可以看到消息是实时更新的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/4d78944603c281257b42ce1897731350.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_UEqvjTtvoobQZ2ObnZAcg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="fc0d" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">使用esbuild提供实时重新加载文件</h1><p id="9868" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">除了<code class="fe lv lw lx ly b">watch</code>之外，我们还可以使用<code class="fe lv lw lx ly b">serve</code>来实时重新加载文件。它通过一个web服务器提供代码，该服务器会根据每个请求进行重建。</p><p id="3023" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">package.json</code>中，我们修改了<code class="fe lv lw lx ly b">start</code>脚本，其中serve端口被设置为<code class="fe lv lw lx ly b">3000</code>。web服务器负责根据每个请求重新构建代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="9cb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">start</code>脚本也可以简化为:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="dd0d" class="nk mj it ly b gy nl nm l nn no">"start": "<!-- -->npm run build -- --serve=3000"</span></pre><p id="ef3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行<code class="fe lv lw lx ly b">npm start</code>，控制台消息显示<code class="fe lv lw lx ly b">http://127.0.0.1:3000</code>有代码送达。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="49f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">连接到<code class="fe lv lw lx ly b">http://127.0.0.1:3000</code>或<code class="fe lv lw lx ly b">http://localhost:3000</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/b0d4ddfc7d2807b75be1999702f308fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*pvm339sNv_w_w-DV6PKrlQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="283c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它显示了托管<code class="fe lv lw lx ly b">bundle.js</code>的目录。放下文件，我们可以查看<code class="fe lv lw lx ly b">bundle.js</code>的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/ff020988a48335800386f180ed79faf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*DbW7PWwZKxG92zVc-0koXA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4067" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">修改<code class="fe lv lw lx ly b">index.html</code>以指向托管的<code class="fe lv lw lx ly b">bundle.js</code>。</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="ee89" class="nk mj it ly b gy nl nm l nn no">&lt;script src="http://localhost:3000/bundle.js"&gt;&lt;/script&gt;</span></pre><p id="1baf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">启动VS代码的活动服务器。</p><p id="5579" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">src/index.js</code>里面，我们加一行<code class="fe lv lw lx ly b">console.log('randomly typing…')</code>。保存后，我们可以看到消息是实时更新的。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="9afd" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">使用esbuild JavaScript</h1><p id="90fd" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated"><code class="fe lv lw lx ly b">esbuild</code>提供了3种完成操作的方式——CLI、JavaScript和GO。到目前为止，所有的例子都是用CLI编写的。</p><p id="c43a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，如果有许多选项，使用<code class="fe lv lw lx ly b">esbuild</code> CLI可能会变得笨拙。对于更复杂的应用，可以使用<code class="fe lv lw lx ly b">esbuild</code> JavaScript API用JavaScript编写一个构建脚本。</p><p id="49e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经在<code class="fe lv lw lx ly b">package.json</code>中展示了下面的<code class="fe lv lw lx ly b">build</code>脚本:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="253c" class="nk mj it ly b gy nl nm l nn no">"build": "esbuild src/index.js --bundle --outfile=dist/bundle.js"</span></pre><p id="e1f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">build</code>脚本可以用JavaScript重写:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="05a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将这个文件命名为<code class="fe lv lw lx ly b">esbuild.config.js</code>，并通过下面的<code class="fe lv lw lx ly b">package.json</code>中的<code class="fe lv lw lx ly b">build</code>脚本调用它:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="3685" class="nk mj it ly b gy nl nm l nn no">"build": "node esbuild.config.js"</span></pre><p id="f247" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，我们可以创建<code class="fe lv lw lx ly b">esbuild.config.watch.js</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="6b6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它可以被下面的<code class="fe lv lw lx ly b">package.json</code>中的<code class="fe lv lw lx ly b">start</code>脚本调用:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="657f" class="nk mj it ly b gy nl nm l nn no">"start": "node esbuild.config.watch.js"</span></pre><p id="a034" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">esbuild中还有其他选项，比如<code class="fe lv lw lx ly b">--sourcemap</code>用于启用源映射，而<code class="fe lv lw lx ly b">--minify</code>用于生产构建。所有选项都可以用JavaScript编写。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="6480" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">结论</h1><p id="5bfe" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我们已经介绍了esbuild。它还没有达到1.0.0版本，仍在积极开发中。它正处于后期测试阶段，为早期用户利用高性能做好了准备。</p><p id="b780" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多详细信息，请查看<a class="ae ky" href="https://esbuild.github.io/" rel="noopener ugc nofollow" target="_blank">es build官方网站</a>。</p><p id="c49b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。我希望这有所帮助。如果你有兴趣，可以看看<a class="ae ky" href="https://jenniferfubook.medium.com/jennifer-fus-web-development-publications-1a887e4454af" rel="noopener">我的其他媒体文章</a>。</p></div></div>    
</body>
</html>