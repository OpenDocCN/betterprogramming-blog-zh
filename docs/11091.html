<html>
<head>
<title>Accessing the Web in Python Using Requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用请求在Python中访问Web</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/accessing-the-web-in-python-using-requests-5fe5bb2bd822?source=collection_archive---------4-----------------------#2022-02-17">https://betterprogramming.pub/accessing-the-web-in-python-using-requests-5fe5bb2bd822?source=collection_archive---------4-----------------------#2022-02-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="158d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用Python制作HTTP请求的快速指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1eda6da3f5e7c45b1b2039c148b844c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*knh4CFQbJzuhXiv0"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@artnok?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">尼古拉斯·皮卡德</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="445d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请求库是一个为Python构建的简单HTTP库。它有很多特性，允许发送带有自定义头和SSL验证的请求。</p><p id="53d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">目录:</strong></p><ol class=""><li id="2189" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><a class="ae kv" href="#3817" rel="noopener ugc nofollow">什么是HTTP？</a></li><li id="c5b3" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="#c3ae" rel="noopener ugc nofollow">获取请求</a></li><li id="6797" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="#1a85" rel="noopener ugc nofollow">分析响应</a></li><li id="1f7c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="#db4e" rel="noopener ugc nofollow">发布请求</a></li><li id="beea" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="#5963" rel="noopener ugc nofollow">饼干</a></li><li id="b920" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="#9ca2" rel="noopener ugc nofollow">会话</a></li></ol><p id="3817" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">什么是HTTP？<br/> </strong> HTTP(超文本传输协议)是一组协议，使用这些协议服务器和客户端之间能够进行通信。它基于请求-响应模型工作。</p><p id="b955" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">交流有不同的方法。以下是最常见的方法:</p><ul class=""><li id="aa88" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated"><strong class="ky ir">获取:</strong>从服务器检索数据</li><li id="5015" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><strong class="ky ir">发布:</strong>发布数据到服务器</li><li id="5431" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><strong class="ky ir"> PUT: </strong>替换服务器上现有的资源</li><li id="25d7" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><strong class="ky ir">删除:</strong>删除指定的资源。</li></ul><p id="4db3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们来看看如何将请求库与不同的HTTP方法一起使用:</p><p id="490d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在开始之前，安装请求库</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="b1c9" class="mm mn iq mi b gy mo mp l mq mr">pip install requests</span></pre><p id="a6e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将请求库导入python脚本，如下所示</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="b588" class="mm mn iq mi b gy mo mp l mq mr">import requests</span></pre></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="c3ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">获取请求:</strong></p><ul class=""><li id="729e" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">一个简单的GET请求:<br/>返回值将是一个包含来自服务器的响应信息的响应对象。</li></ul><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="f684" class="mm mn iq mi b gy mo mp l mq mr">response = requests.get('https://httpbin.org/get')</span></pre><ul class=""><li id="c2f9" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">获取带有参数的请求:</li></ul><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="e9ca" class="mm mn iq mi b gy mo mp l mq mr">parameters = <strong class="mi ir">{</strong>'key1'<strong class="mi ir">:</strong> 'value1'<strong class="mi ir">,</strong> 'key2'<strong class="mi ir">:</strong> 'value2'<strong class="mi ir">}</strong><br/>response = requests.get('https://httpbin.org/get', params=parameters)</span></pre><ul class=""><li id="c10b" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">获取带有自定义标题的请求:</li></ul><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="ed73" class="mm mn iq mi b gy mo mp l mq mr">headers = {'Bearer':<em class="mz">Authorization_token</em>}<br/>response = request.get('https://httpbin.org/get', headers=headers)</span></pre><ul class=""><li id="3855" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">使用<code class="fe na nb nc mi b">stream</code>参数获取请求:<br/>这用于防止大量响应一次全部加载到内存中。</li></ul><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="3f00" class="mm mn iq mi b gy mo mp l mq mr">response = request.get(url_to_download_large_file, stream=True)</span></pre></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="1a85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">分析响应:</strong></p><p id="9eba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">发送的请求将收到来自服务器的响应。它将存储在一个响应对象中。响应对象提供与响应相关的所有信息。让我们看看下面几个:</p><ul class=""><li id="d9c4" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated"><strong class="ky ir">查看来自服务器响应的内容</strong>:</li></ul><p id="0347" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">文本响应:</strong>使用<code class="fe na nb nc mi b">text</code> <strong class="ky ir"> </strong>属性可以访问内容。<br/> Requests使用报头中接收的编码格式来解码内容。</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="b228" class="mm mn iq mi b gy mo mp l mq mr">response = requests.get('https://httpbin.org/get')<br/>print(response.text)</span><span id="c72f" class="mm mn iq mi b gy nd mp l mq mr">#Result<br/>{<br/>  "args": {<br/>    "key1": "value1", <br/>    "key2": "value2"  <br/>  },...</span></pre><p id="a22c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">非文本响应:</strong>可以使用<code class="fe na nb nc mi b">content</code>属性以字节形式访问内容。默认情况下，<strong class="ky ir"> gzip </strong>和<strong class="ky ir"> deflate </strong>编码被解码。</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="1ec1" class="mm mn iq mi b gy mo mp l mq mr">response = requests.get('https://httpbin.org/get')<br/>print(response.content)</span><span id="2a54" class="mm mn iq mi b gy nd mp l mq mr"># Result<br/>b'{\n  "args": {\n    "key1": "value1", \n    "key2": "value2"\n  }, \n  "headers": {\n    "Accept": "*/*", \n <br/>   "Accept-Encoding": "gzip, deflate",...</span></pre><p id="21dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> JSON响应:</strong>如果来自服务器的响应是JSON格式的，那么可以使用<code class="fe na nb nc mi b">json()</code>方法轻松解码</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="dc6b" class="mm mn iq mi b gy mo mp l mq mr">response = requests.get('https://httpbin.org/get')<br/>print(response.json())</span><span id="0c34" class="mm mn iq mi b gy nd mp l mq mr">#Result<br/>{'args': {'key1': 'value1', 'key2': 'value2'}, 'headers': {'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'Host': 'httpbin.org', 'User-Agent'...</span></pre><p id="6dc6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Requests还提供了通过<code class="fe na nb nc mi b">raw</code>属性查看来自服务器的原始响应的选项。为此，我们必须在初始请求中传递<code class="fe na nb nc mi b">stream=True</code>。</p><ul class=""><li id="4ba9" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated"><strong class="ky ir">下载图像或大文件:</strong></li></ul><p id="f79a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了处理响应中发送的大文件，我们可以使用<code class="fe na nb nc mi b">iter_content()</code>方法和<code class="fe na nb nc mi b">chunk_size</code>关键字参数。区块大小指定了一次要读取的字节数。</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="d637" class="mm mn iq mi b gy mo mp l mq mr">response = request.get(url_to_download_large_file, stream=True)<br/>with open<strong class="mi ir">(</strong>filename<strong class="mi ir">,</strong> 'wb'<strong class="mi ir">)</strong> as f<strong class="mi ir">:</strong><br/>    for chunk in response.iter_content<strong class="mi ir">(</strong>chunk_size=128<strong class="mi ir">):</strong><br/>        f.write<strong class="mi ir">(</strong>chunk<strong class="mi ir">)</strong></span></pre><ul class=""><li id="c8a3" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated"><strong class="ky ir">查看编码格式:</strong></li></ul><p id="e75b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe na nb nc mi b">encoding</code>属性提供了所使用的编码方法。我们可以将属性重新分配给不同的编码，每当您调用<code class="fe na nb nc mi b">response.text</code>时，请求将使用新的<code class="fe na nb nc mi b">response.encoding</code>值。</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="c9c8" class="mm mn iq mi b gy mo mp l mq mr">response = requests.get('https://httpbin.org/get')<br/>print(response.encoding)</span><span id="6b96" class="mm mn iq mi b gy nd mp l mq mr">#Result<br/>utf-8</span><span id="9137" class="mm mn iq mi b gy nd mp l mq mr">#Reassign a new encoding<br/>response.encoding = 'ISO-8859-1'</span></pre><p id="3cc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">响应对象中的其他有用属性:</strong></p><ul class=""><li id="f9b6" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated"><code class="fe na nb nc mi b">status_code</code>:提供响应的HTTP状态码。</li><li id="06f9" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe na nb nc mi b">elapsed_time</code>:发送请求到收到响应之间经过的时间。</li><li id="b3ff" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe na nb nc mi b">url</code>:给出发送响应的实际URL。这有助于识别请求是否被重定向。</li><li id="5884" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe na nb nc mi b">cookies</code>:该属性包含服务器发回的cookies。</li><li id="5a8e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe na nb nc mi b">headers</code>:服务器发送的头。</li><li id="6443" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe na nb nc mi b">history</code>:该属性用于检查请求是否被重定向。该属性将包含为完成请求而创建的响应对象列表，从最早的到最新的。<br/> <strong class="ky ir">注意:</strong>为了避免重定向，我们可以在请求中传入<code class="fe na nb nc mi b">allow_redirects=False</code>。</li></ul><p id="d732" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">响应对象还包含请求的细节。这可以使用响应对象的<code class="fe na nb nc mi b">request</code>属性来访问</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="5bca" class="mm mn iq mi b gy mo mp l mq mr">params = {'key1': 'value1', 'key2': 'value2'}<br/>response = requests.get("https://httpbin.org/get", params=params)<br/>print(response.request.__dict__)</span><span id="2fd5" class="mm mn iq mi b gy nd mp l mq mr">#Result <br/>{'method': 'GET', 'url': '<a class="ae kv" href="https://httpbin.org/get?key1=value1&amp;key2=value2'" rel="noopener ugc nofollow" target="_blank">https://httpbin.org/get?key1=value1&amp;key2=value2'</a>, 'headers': {'User-Agent': 'python-requests/2.26.0'...</span></pre></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="db4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">帖子请求:</strong></p><ul class=""><li id="26e5" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">发送表单编码数据的简单POST请求:<br/>要发送表单编码数据，我们将使用<code class="fe na nb nc mi b">data</code>关键字。</li></ul><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="8385" class="mm mn iq mi b gy mo mp l mq mr">data = <strong class="mi ir">{</strong>'key1'<strong class="mi ir">:</strong> 'value1'<strong class="mi ir">,</strong> 'key2'<strong class="mi ir">:</strong> 'value2'<strong class="mi ir">}<br/></strong>response = requests.post<strong class="mi ir">(</strong>"https://httpbin.org/post"<strong class="mi ir">,</strong> data=data<strong class="mi ir">)<br/></strong>print(response.text)</span><span id="d15f" class="mm mn iq mi b gy nd mp l mq mr">#Result<br/>{<br/>  "args": {},<br/>  "data": "",<br/>  "files": {},<br/>  "form": {<br/>    "key1": "value1",<br/>    "key2": "value2"<br/>  },...</span></pre><ul class=""><li id="2467" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">包含一个键的多个值的POST请求:</li></ul><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="f8ab" class="mm mn iq mi b gy mo mp l mq mr">data = <strong class="mi ir">{</strong>'key1'<strong class="mi ir">:</strong> ['value1'<strong class="mi ir">,</strong> 'value2']<strong class="mi ir">} <br/>or<br/></strong>data = [('key1','value1'),('key1','value2')]<br/>response = requests.post<strong class="mi ir">(</strong>"https://httpbin.org/post"<strong class="mi ir">,</strong> data=data<strong class="mi ir">)<br/></strong>print(response.text)</span><span id="e9b3" class="mm mn iq mi b gy nd mp l mq mr">#Result<br/>{<br/>  "args": {},<br/>  "data": "",<br/>  "files": {},<br/>  "form": {<br/>    "key1": [<br/>      "value1",<br/>      "value2"<br/>    ],,,</span></pre><ul class=""><li id="0be5" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">发送多部分编码文件的POST请求:<br/>要发送多部分编码文件，我们使用<code class="fe na nb nc mi b">files</code>关键字。</li></ul><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="c5f4" class="mm mn iq mi b gy mo mp l mq mr">files = <strong class="mi ir">{</strong>'file'<strong class="mi ir">:</strong> open<strong class="mi ir">(</strong>file<strong class="mi ir">,</strong> 'rb'<strong class="mi ir">)}</strong><br/>response = requests.post<strong class="mi ir">(</strong>'https://httpbin.org/post'<strong class="mi ir">,</strong> files=files<strong class="mi ir">)</strong></span></pre><ul class=""><li id="3a5b" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">发送JSON编码数据的POST请求:<br/>可以使用关键字<code class="fe na nb nc mi b">json</code>发送JSON数据</li></ul><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="173f" class="mm mn iq mi b gy mo mp l mq mr">data = <strong class="mi ir">{</strong>'key1'<strong class="mi ir">:</strong> 'value1'<strong class="mi ir">,</strong> 'key2'<strong class="mi ir">:</strong> 'value2'<strong class="mi ir">}<br/></strong>response = requests.post<strong class="mi ir">(</strong>"https://httpbin.org/post"<strong class="mi ir">,</strong> json=data<strong class="mi ir">)<br/></strong>print(response.text)</span></pre><p id="65f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面将发送一个内容类型为<code class="fe na nb nc mi b">application/json</code> <br/> <strong class="ky ir">的POST请求。注意:</strong>如果使用了<code class="fe na nb nc mi b">data</code>或<code class="fe na nb nc mi b">files</code>关键字，将忽略<code class="fe na nb nc mi b">json</code>关键字。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="5963" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">饼干:</strong></p><ul class=""><li id="58ad" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">在请求中发送Cookies:</li></ul><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="205f" class="mm mn iq mi b gy mo mp l mq mr">cookies = {'my-cookie':'value'}<br/>response = requests.get<strong class="mi ir">(</strong>'https://httpbin.org/cookies'<strong class="mi ir">, </strong>cookies=cookies<strong class="mi ir">)<br/></strong>print(response.text)</span><span id="ee8b" class="mm mn iq mi b gy nd mp l mq mr">#Result<br/>{<br/>  "cookies": {<br/>    "my-cookie": "value"<br/>  }<br/>}</span></pre><p id="e3bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Cookie在一个请求Cookie Jar中返回，它的作用就像一个字典，但也提供了一个更完整的接口，适合在多个域或路径上使用。</p><p id="e502" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以创建RequestsCookieJar的一个实例，并将cookies设置为针对特定路由发送。在请求过程中，只会发送这些cookies。</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="4dbf" class="mm mn iq mi b gy mo mp l mq mr">cookie_jar = requests.cookies.RequestsCookieJar()<br/>cookie_jar.set('my-cookie1', 'value1', domain='httpbin.org', path='/cookies')<br/>cookie_jar.set('my-cookie2', 'value2', domain='httpbin.org', path='/anything')<br/>cookie_jar.set('my-cookie3', 'value3', domain='httpbin.org', path='/cookies')<br/>response1 = requests.get('https://httpbin.org/cookies', cookies=cookie_jar)</span><span id="8e59" class="mm mn iq mi b gy nd mp l mq mr">print(response1.text)</span><span id="2e99" class="mm mn iq mi b gy nd mp l mq mr">#Result<br/>{<br/>  "cookies": {<br/>    "my-cookie1": "value1",<br/>    "my-cookie3": "value3"<br/>  }<br/>}</span></pre></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="e6b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">会话:</strong></p><p id="0bfd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">会话用于跨请求保持某些参数。使用会话实例发送的cookies也会跨请求持久化。由于使用了urllib3的连接池，对同一台主机的多个请求会导致性能显著提高。</p><p id="9ca2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">会话对象拥有与请求API相同的所有方法。</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="06d4" class="mm mn iq mi b gy mo mp l mq mr">s = requests.Session()<br/>s.cookies.update({'my_cookie1':'value1'})<br/>response = s.get('http://httpbin.org/cookies')<br/>print(response.text)</span><span id="1428" class="mm mn iq mi b gy nd mp l mq mr">#Result<br/>{<br/>  "cookies": {<br/>    "my_cookie1": "value1"<br/>  }<br/>}</span><span id="b8cb" class="mm mn iq mi b gy nd mp l mq mr">response = s.get('http://httpbin.org/cookies',cookies={'my_cookie2':'value2'})<br/>print(response.text)</span><span id="1639" class="mm mn iq mi b gy nd mp l mq mr">#Result<br/>{<br/>  "cookies": {<br/>    "my_cookie1": "value1",<br/>    "my_cookie2": "value2"<br/>  }<br/>}</span></pre><p id="89ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所看到的，cookie将被设置在会话级，作为请求的一部分发送的任何新cookie都将被附加上会话级cookie。</p><p id="0d0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用会话的通常模式是使用<code class="fe na nb nc mi b">with</code>块，因为一旦退出上下文管理器，会话就会自动关闭</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="49bb" class="mm mn iq mi b gy mo mp l mq mr">with requests.Session() as s:<br/>    s.cookies.update({'my_cookie1':'value1'})<br/>    response = s.get('http://httpbin.org/cookies')<br/>    print(response.text)</span></pre></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="6cd0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经介绍了请求库的基础知识，还研究了如何发送GET和POST请求。类似地，PUT和DELETE请求也可以通过使用请求API上的相应方法来发送。</p><p id="a33e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样，您现在应该能够通过传递cookies、标头以及发送/下载文件向服务器发出基本请求。</p><h2 id="80c8" class="mm mn iq bd ne nf ng dn nh ni nj dp nk lf nl nm nn lj no np nq ln nr ns nt nu bi translated"><strong class="ak">参考资料(官方Python文档)</strong></h2><p id="f5dc" class="pw-post-body-paragraph kw kx iq ky b kz nv jr lb lc nw ju le lf nx lh li lj ny ll lm ln nz lp lq lr ij bi translated"><a class="ae kv" href="https://docs.python-requests.org/en/latest/user/quickstart/" rel="noopener ugc nofollow" target="_blank">请求</a></p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="b524" class="mm mn iq mi b gy mo mp l mq mr"><strong class="mi ir">Want to Connect?</strong></span><span id="2c8b" class="mm mn iq mi b gy nd mp l mq mr">If you like to read more of my articles do follow me on <a class="ae kv" href="https://www.linkedin.com/in/hari-hara-subramanyam-s-b2692636" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</span></pre></div></div>    
</body>
</html>