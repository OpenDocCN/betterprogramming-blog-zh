<html>
<head>
<title>Getting Started With Mapbox GL JS: User Location With Geolocation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Mapbox GL JS入门:使用地理定位的用户位置</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-mapbox-gl-js-user-location-with-geolocation-f32c3e323526?source=collection_archive---------7-----------------------#2019-08-23">https://betterprogramming.pub/getting-started-with-mapbox-gl-js-user-location-with-geolocation-f32c3e323526?source=collection_archive---------7-----------------------#2019-08-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0799" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建一个你可以设置到任何位置的地图，用一个按钮重新定位到用户的位置</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/953048fb27d5d4b7aef91e396314fd49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_sg1PtZPf658y6ZugZKEOA.png"/></div></div></figure><p id="9972" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我很高兴来到这里的新领域。我告诉过你我喜欢地图吗？我希望我能早点进入地图框；作为一个开发者和地理爱好者，这是一个梦想成真。</p><p id="473e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然，在这些文章中，我仅仅是记录了如何开始使用它，就像我一样，并且希望它对某些人有用。也可以阅读第1部分，【React和MapBox GL JS 入门。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="ff58" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">目标:切换到用户的位置</h1><p id="fcae" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">这实际上是一个非常简单的任务。</p><p id="754c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您熟悉React并遵循了之前的教程，那么您将会非常出色。如果你还没有建立一个地图，跟随我上面链接的第一个教程。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="c38d" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">我们需要什么</h1><ol class=""><li id="1a43" class="mv mw it kw b kx mq la mr ld mx lh my ll mz lp na nb nc nd bi translated">我们在上一个教程中建立的地图。</li><li id="835e" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated"><code class="fe nj nk nl nm b">navigator.geolocation.getCurrentPosition()</code></li></ol><p id="f6c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">差不多就是这样。这非常简单，几分钟后，你就可以点击一个按钮，地图就会放大到你所在的位置。</p><p id="e73a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后你会说:“哎呀达拉斯，多么强大的概念。也很容易！”</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="be2a" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">深潜</h1><h2 id="6184" class="nn lz it bd ma no np dn me nq nr dp mi ld ns nt mk lh nu nv mm ll nw nx mo ny bi translated">航海家</h2><p id="74f1" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">除非您已经使用JavaScript有一段时间了，否则您可能没有听说过<code class="fe nj nk nl nm b">navigator</code>对象。当我们找到我们的用户时，这将对我们非常有用。</p><p id="7cf0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一个JavaScript特性，在所有主流浏览器上都可用。我不会详细介绍它，但是如果您检查一个网页，在控制台中键入navigator，然后打开navigator对象，您会看到类似这样的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/a1e2383469bb166edf5fed51c8b2d730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6DoLhsBF6yur8bQUBehTDg.png"/></div></div></figure><p id="e3b7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如w3Schools所说:</p><blockquote class="oa"><p id="62bc" class="ob oc it bd od oe of og oh oi oj lp dk translated">"导航对象包含关于浏览器的信息."</p></blockquote><p id="6429" class="pw-post-body-paragraph ku kv it kw b kx ok ju kz la ol jx lc ld om lf lg lh on lj lk ll oo ln lo lp im bi translated">啊哦，这意味着任何网站都可以通过navigator对象随时访问我的位置？你以后会明白为什么答案是否定的。</p><h2 id="6c19" class="nn lz it bd ma no np dn me nq nr dp mi ld ns nt mk lh nu nv mm ll nw nx mo ny bi translated">导航器.地理定位</h2><p id="ec5c" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">您将注意到导航对象中的一个键，标记为<code class="fe nj nk nl nm b">geolocation</code>。这就指向了一个有键的对象，所有的键我都不知道是什么功能(除了<code class="fe nj nk nl nm b">getCurrentPosition</code>)。</p><h2 id="3631" class="nn lz it bd ma no np dn me nq nr dp mi ld ns nt mk lh nu nv mm ll nw nx mo ny bi translated">navigator . geolocation . getcurrentposition</h2><p id="a5c7" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">现在，在那些开胃菜之后，我们有主菜，即<code class="fe nj nk nl nm b">function</code>。所以，<code class="fe nj nk nl nm b">navigator.geolocation.getCurrentPosition</code>返回一个函数。这个函数是异步的，需要回调。</p><p id="4c98" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">大致结构是这样的:</p><pre class="kj kk kl km gt op nm oq or aw os bi"><span id="8c9d" class="nn lz it nm b gy ot ou l ov ow">navigation.geolocation.getCurrentPosition(position =&gt; {</span><span id="3146" class="nn lz it nm b gy ox ou l ov ow">  // right now "position" is an object<br/>})</span></pre><p id="ac62" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将返回一个位置对象。一个坐标键，这个对象包含了你现在所在位置的纬度和经度。</p><p id="c2f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">看起来是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/9a3a32ed664cc719aca50d65616a1d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ofKPD0jKEGh-2sHsg9kmQ.png"/></div></div></figure><p id="e754" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是你获取用户位置的方法。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="7c02" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">将此应用于我们的应用程序</h1><p id="0668" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">所以，这个概念很简单。在页面加载时(或者你可能想要一个按钮什么的)，我们可以获取用户的当前位置并更新<code class="fe nj nk nl nm b">viewport</code>状态。</p><p id="3541" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于本教程，我们将使用一个按钮。到目前为止，我们有这个(来自上一个教程)。它放大到俄勒冈州格兰特山口的一个点(美丽的地方)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/7138b4520065908b45e9c82fd1fa8e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZV_2w9H_4slspIun.png"/></div></div></figure><p id="a0cc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是，我们更希望它能放大到我们的位置。因此，我们将制作一个按钮，一旦点击，它将放大到我们的位置。</p><pre class="kj kk kl km gt op nm oq or aw os bi"><span id="cebc" class="nn lz it nm b gy ot ou l ov ow">setUserLocation = () =&gt; {<br/>            navigator.geolocation.getCurrentPosition(position =&gt; {<br/>                let newViewport = {<br/>                    height: "100vh",<br/>                    width: "100vw",<br/>                    latitude: position.coords.latitude,<br/>                    longitude: position.coords.longitude,<br/>                    zoom: 12<br/>                }<br/>                this.setState({<br/>                    viewport: newViewport<br/>                })<br/>            })<br/>        }</span></pre><ol class=""><li id="c4af" class="mv mw it kw b kx ky la lb ld pa lh pb ll pc lp na nb nc nd bi translated">在<code class="fe nj nk nl nm b">ReactMapGL</code>组件上方添加一个按钮。</li><li id="3145" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">在里面放一个<code class="fe nj nk nl nm b">onClick</code>，它将改变我们组件的状态。</li></ol><p id="f618" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以，现在我们在<code class="fe nj nk nl nm b">App.js</code>中的渲染是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/7b58dc0896fe1e0d1f04945fe5a14776.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hzR1K_3rmaDwY5L_4NHkOQ.png"/></div></div></figure><h2 id="cf51" class="nn lz it bd ma no np dn me nq nr dp mi ld ns nt mk lh nu nv mm ll nw nx mo ny bi translated">重要说明</h2><p id="92e5" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">还记得之前我说“啊哈这是说任何网站都可以通过navigator object随时访问我的位置？你稍后会明白为什么答案是否定的。</p><p id="b405" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在是以后。</p><p id="5a49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">幸运的是，如果用户不想分享他们的位置，他们不必这样做。它是内置的，浏览器首先请求用户的许可(以警告的形式)。</p><h2 id="448b" class="nn lz it bd ma no np dn me nq nr dp mi ld ns nt mk lh nu nv mm ll nw nx mo ny bi translated"><strong class="ak">点击按钮前的</strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dfa2f79b7b16d1a43a3a24f4ff1252d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JR5odp8Giv1sfL8IMSfSIw.png"/></div></div></figure><h2 id="fb8f" class="nn lz it bd ma no np dn me nq nr dp mi ld ns nt mk lh nu nv mm ll nw nx mo ny bi translated"><strong class="ak">点击按钮后(应该是你所在的位置)</strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c6446b58dc1b3ee72f3a7f7eb8d8d374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dzaC2nRUSqFLX2kxaztuCw.png"/></div></div></figure><p id="6a9a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">是的，我搬到了“世界上最大的小苹果”。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="e524" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">准备好向地图添加标记了吗？</h1><p id="b9c2" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated"><a class="ae lq" href="https://levelup.gitconnected.com/getting-started-with-react-and-mapbox-gl-js-user-location-marker-with-marker-component-716a3f1abf83" rel="noopener ugc nofollow" target="_blank">带有标记组件的用户位置标记</a></p><h1 id="d50d" class="ly lz it bd ma mb pe md me mf pf mh mi jz pg ka mk kc ph kd mm kf pi kg mo mp bi translated"><strong class="ak">结论</strong></h1><p id="8dfa" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">地图是炸弹。我真的很喜欢玩MapBox并写一些关于它的东西。现在你有了一个可以设置到任何你想要的位置的地图和一个可以重定位到用户位置的按钮。</p><p id="50d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读，我希望这是有帮助的。在下一篇文章中，我将介绍如何在地图上添加点。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="2354" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">资源</h1><ul class=""><li id="0e02" class="mv mw it kw b kx mq la mr ld mx lh my ll mz lp pj nb nc nd bi translated"><a class="ae lq" href="https://medium.com/swlh/getting-started-with-react-and-mapbox-gl-js-daa96477dd2c" rel="noopener">之前的地图框教程</a></li><li id="dd7a" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp pj nb nc nd bi translated"><a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/geolocation" rel="noopener ugc nofollow" target="_blank"> MDN地理定位</a></li></ul></div></div>    
</body>
</html>