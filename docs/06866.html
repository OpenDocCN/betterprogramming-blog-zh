<html>
<head>
<title>Handy Python Snippets for Cleaner Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">方便的Python代码片段，代码更简洁</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/handy-python-snippets-for-cleaner-code-a1e2c5d39a0d?source=collection_archive---------4-----------------------#2020-11-12">https://betterprogramming.pub/handy-python-snippets-for-cleaner-code-a1e2c5d39a0d?source=collection_archive---------4-----------------------#2020-11-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5ac5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">动态调用函数，列出函数名称的特定部分，等等</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/82a21613e5e555074b3b0604188aa8c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xyebyMLkE38J5cA3uVY4w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@richtervet?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Rich Tervet </a>在<a class="ae ky" href="https://unsplash.com/s/photos/code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="bf6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有效地重构现有代码是一门艺术。如果你曾经继承过别人的代码，甚至过了一段时间后回头看看自己的代码，你就会知道这个过程有多艰难。通常情况下，在紧张的时间表下开发特性和修复bug，这可能会导致草率、低效的代码。</p><p id="ae12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那就是<em class="lv">完全没事</em>。你可以不时地犯一些糟糕的代码。当务之急是您可以识别坏代码，并总是返回来修复它。</p><p id="45fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将会看到Python代码中的一些小片段，它们使得代码的重构变得更加简单。在大多数情况下，它们使用简单的标准库函数，不会混淆极其复杂的算法或密集的一行程序背后的意图。当你重构代码时，你需要在简洁和可读性之间取得平衡。让我们来看几个例子。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="583b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">动态调用函数</h1><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="ecf3" class="na me it mw b gy nb nc l nd ne">def call_func(name):<br/>    klass = MyClass()<br/>    return getattr(klass, name)()</span><span id="8922" class="na me it mw b gy nf nc l nd ne">call_func('function_name')</span></pre><p id="b979" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您遇到在以后才知道希望调用的函数名的代码段，这就是答案。通过使用内置的Python函数<code class="fe ng nh ni mw b">getattr</code>，可以使用字符串按名称调用函数。这对于减少紧密耦合的代码和提高可扩展性非常有用。如果您减少硬编码的函数名并允许更大的灵活性，那么您的代码很有可能会更少中断。</p><p id="3bc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个简单的方法也减少了其他开发人员向现有代码添加功能的开销。如果你所要做的只是向类中添加一个新函数，并且它马上就可以使用，这就降低了复杂性，使代码更容易使用。</p><p id="422e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在文档中阅读更多关于<code class="fe ng nh ni mw b">getattr</code>功能<a class="ae ky" href="https://docs.python.org/3/library/functions.html#getattr" rel="noopener ugc nofollow" target="_blank">的信息。</a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8472" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用析构赋值</h1><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="5259" class="na me it mw b gy nb nc l nd ne">var_one, var_two = [1, 2]</span></pre><p id="ee0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能已经听过这个概念无数次了，但是它值得重复:尽可能使用析构赋值来更清楚地显示值和表达意图。当您通过索引值访问列表或数组时，您无意中隐藏了您的意图。通过析构赋值用一个明确的变量名来引用值，可以使你的代码更容易阅读。</p><p id="9ab3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，我们有一些关于列表中某个人的数据。这些数据包括个人的姓名、年龄和职业等基本信息。为了这个例子，让我们假设这是我们从一个web请求收到的响应的一部分，我们必须像这样解析多个响应。如果我们想得到这个人的名字，我们可以简单地通过索引值来访问它:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="12a5" class="na me it mw b gy nb nc l nd ne">person = ['Bill', 26, 'Programmer']</span><span id="dec3" class="na me it mw b gy nf nc l nd ne">print(person[0])</span></pre><p id="174b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不止一次地引用它，这是草率的并且隐藏了意图。在你的代码中到处引用<code class="fe ng nh ni mw b">person[0]</code>会使你很难解释<em class="lv">应该是什么值。对此有一个非常简单的解决方法，它不会隐藏您的意图，并使您的代码更具可读性。只需将它赋给一个变量，如果可能的话，将整个列表析构为适当命名的变量。让我们看一个将此付诸实践的例子:</em></p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="dd42" class="na me it mw b gy nb nc l nd ne">person = ['Bill', 26, 'Programmer']</span><span id="a662" class="na me it mw b gy nf nc l nd ne">name, age, profession = person</span><span id="b1b6" class="na me it mw b gy nf nc l nd ne">print(name)</span></pre><p id="bcb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果以后需要引用名称，可以通过命名变量和索引值来实现。对于您可能知道其结构的响应数据，这种方法非常有效。只要这个人的信息总是以同样的顺序排列，你就可以一遍又一遍地析构和赋值，以避免使用索引值。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="9a46" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">以特定模式列出函数</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="3934" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个例子中，我们假设上面的类包含了大量的函数。其中一些函数有特殊的用途，应该可以动态访问。我们希望我们添加到这个类中的任何特殊函数都可以立即被我们代码的其余部分获取，这样它就可以立即开始工作。实现这一点的一种方法是简单地在包含类上使用<code class="fe ng nh ni mw b">dir</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="e5e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您将一个类传递给<code class="fe ng nh ni mw b">dir</code>，它将列出该对象的所有属性。这包括其函数的名称。通过过滤字符串名称中的前缀、后缀或包含的关键字，我们可以将这个类的函数分成不同的类别。这允许我们“挑选”名称中包含关键字的新函数，然后在代码中调用它们或对它们执行其他逻辑。</p><p id="3b5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在文档中查看更多关于内置<code class="fe ng nh ni mw b">dir</code>功能<a class="ae ky" href="https://docs.python.org/3/library/functions.html#dir" rel="noopener ugc nofollow" target="_blank">的信息。</a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="33c8" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">将多个函数参数作为字典传递</h1><p id="5750" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">在重构代码时，您很可能遇到过类似的情况:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="eb0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管这种缩进风格的某些格式在PEP8 中可能在技术上被允许，但我个人并不喜欢看到大量缩进的函数参数。你不得不把你的眼睛一直移到右边，有些ide不太适应这种缩进，使用这种风格会抑制将来的可扩展性。</p><p id="afcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当有大量函数参数时，提高可读性和重用性的一个选择是以dict形式传递它们。这是一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="a1a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在向函数传递dict时，使用dict上的<code class="fe ng nh ni mw b">**</code>操作符可以让您成功地解包所有的参数(而不是意外地传递dict对象本身)。尽管该方法确实添加了另一个变量和一个单独的数据结构，但是当有大量参数时，它提高了整体的可读性。移动函数调用或者用相同的(或稍有改动的)参数引用同一个函数的多个调用现在变得非常容易，并且需要更少的整体修改。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="758d" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="0c19" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">感谢您的阅读！我希望这些代码片段能在下次你发现自己在分析Python代码时帮助你提高效率。</p></div></div>    
</body>
</html>