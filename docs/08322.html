<html>
<head>
<title>An Introduction to JavaScript Compile-Time Processing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript编译时处理简介</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/an-introduction-to-javascript-compile-time-processing-f77571e71dfd?source=collection_archive---------8-----------------------#2021-04-16">https://betterprogramming.pub/an-introduction-to-javascript-compile-time-processing-f77571e71dfd?source=collection_archive---------8-----------------------#2021-04-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="46e5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Babel的插件宏和codegen为我们在编译时操作源代码提供了一个新的维度</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/06656ee38886abe53ecd8f7ff49f4198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E0wXgj2ZyOD2LoYQHTn5zg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片鸣谢:作者。</p></figure><p id="b029" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在JavaScript中，我们可以在源代码中有一个静态值。比如从<code class="fe lu lv lw lx b">0</code>开始的计数器。我们也可以在源代码中有一个动态值。例如，<code class="fe lu lv lw lx b">new Date()</code>会在运行时返回当前时间对象。</p><p id="aef4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是我们能得到一个专门用于编译时处理的值吗(例如，我们想在编译这个版本的代码时显示一个时间戳)？</p><p id="2f25" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">是的，我们可以。<code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/kentcdodds/preval.macro" rel="noopener ugc nofollow" target="_blank">preval.macro</a></code>非常适合这种任务。</p><p id="9993" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Babel是一个JavaScript transpiler。它使我们能够编写现代JavaScript，并将其转换成ES5 JavaScript。此外，Babel插件可以在编译期间执行其他代码转换。对于我们的特定示例，它可以在编译时评估<code class="fe lu lv lw lx b">new Date()</code>，并将生成的值交换到源代码的特定位置。</p><ul class=""><li id="7f19" class="lz ma it la b lb lc le lf lh mb ll mc lp md lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/kentcdodds/babel-plugin-macros" rel="noopener ugc nofollow" target="_blank">babel-plugin-macros</a></code>:定义一个标准接口，供库使用编译时代码转换。</li><li id="e735" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/kentcdodds/babel-plugin-preval" rel="noopener ugc nofollow" target="_blank">babel-plugin-preval</a></code>:提供将编译时生成的值交换到JavaScript文件中的功能。</li><li id="6f30" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/kentcdodds/babel-plugin-codegen" rel="noopener ugc nofollow" target="_blank">babel-plugin-codegen</a></code>:提供将编译时生成的代码交换到JavaScript文件中的能力。</li></ul><p id="fa68" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">preval.macro</code>是<code class="fe lu lv lw lx b">babel-plugin-preval</code>的简单形式，<code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/kentcdodds/codegen.macro" rel="noopener ugc nofollow" target="_blank">codegen.macro</a></code>是<code class="fe lu lv lw lx b">babel-plugin-codegen</code>的简单形式。它们是易于使用的宏——一个用于值，一个用于代码。我们将举例说明如何在JavaScript代码中应用这些宏。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="bedd" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">preval.macro</h1><p id="c6a2" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated"><code class="fe lu lv lw lx b">preval</code>是<em class="nr">预评估代码</em>的简称。</p><p id="9a01" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">macro</code>是在构建阶段定义文本替换的一种方式。</p><p id="e194" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">preval.macro</code>是一个Babel插件，用于在编译期间预先评估代码。</p><p id="3943" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">和往常一样，我们从<a class="ae ly" href="https://medium.com/better-programming/10-fun-facts-about-create-react-app-eb7124aa3785" rel="noopener">创建React应用</a>开始:</p><pre class="kj kk kl km gt ns lx nt nu aw nv bi"><span id="fed1" class="nw mv it lx b gy nx ny l nz oa">npx create-react-app my-app</span></pre><p id="4bf7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，安装<code class="fe lu lv lw lx b">preval.macro</code>:</p><pre class="kj kk kl km gt ns lx nt nu aw nv bi"><span id="a138" class="nw mv it lx b gy nx ny l nz oa">npm install --save-dev preval.macro</span></pre><p id="969d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以在<code class="fe lu lv lw lx b">package.json</code>的<code class="fe lu lv lw lx b"><a class="ae ly" href="https://medium.com/better-programming/package-jsons-dependencies-in-depth-a1f0637a3129" rel="noopener">devDependencies</a></code>中看到新包装:</p><pre class="kj kk kl km gt ns lx nt nu aw nv bi"><span id="ccc0" class="nw mv it lx b gy nx ny l nz oa">"devDependencies": {<br/>  "preval.macro": "^5.0.0"<br/>}</span></pre><p id="da68" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">preval.macro</code>将生成的值交换到源代码的特定位置。这个具体位置标记为<code class="fe lu lv lw lx b">module.exports</code>，如下图修改后的<code class="fe lu lv lw lx b">src/App.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="0ac1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在第12行，<a class="ae ly" rel="noopener ugc nofollow" target="_blank" href="/manipulating-javascript-strings-using-template-literals-f7070412099f">标记的模板文字</a>显示<code class="fe lu lv lw lx b">preval</code>是函数名，模板文字是<code class="fe lu lv lw lx b">module.exports</code>的表达式。时间戳是在编译时计算的。<code class="fe lu lv lw lx b">module.exports</code>与构建时计算的值交换。它在编译后的代码中变成一个静态值。</p><p id="0dd5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在第14行，时间戳在运行时被评估。该值将在程序运行时计算。</p><p id="da0d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于下面的截图，代码是在晚上7:54:12通过<code class="fe lu lv lw lx b">npm run build</code>编译的。它于晚上8点12分44秒通过<code class="fe lu lv lw lx b">serve -s build</code>发射。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/4da9a1a348e8b9963cd048c03d7b1f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u3H0PRpF_ZBhCnjRqahw_A.png"/></div></div></figure><p id="f132" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是另一种改进型<code class="fe lu lv lw lx b">src/App.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="950a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第5-8行在编译时读取<code class="fe lu lv lw lx b">index.js</code>。带标签的模板文本显示<code class="fe lu lv lw lx b">preval</code>是函数名(第5行)，模板文本有一个用于<code class="fe lu lv lw lx b">module.exports</code>的表达式(第7行)。<code class="fe lu lv lw lx b">module.exports</code>在构建期间与文件内容交换。它变成一个静态值并存储在变量<code class="fe lu lv lw lx b">indexFile</code>中。</p><p id="9682" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在运行时，<code class="fe lu lv lw lx b">indexFile</code>值由下面截图中的第15行显示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/3eb9ee4af8351a6f8192fec067716ee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fc9CeIEf4Bdshjhm4cSBWA.png"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="81d3" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">codegen.macro</h1><p id="90ac" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated"><code class="fe lu lv lw lx b">codegen</code>是<em class="nr">代码生成器</em>的简称。</p><p id="4178" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">codegen.macro</code>是一个在编译时生成代码的巴别塔插件。<code class="fe lu lv lw lx b">codegen.macro</code>类似于<code class="fe lu lv lw lx b">preval.macro</code>。<code class="fe lu lv lw lx b">preval.macro</code>为数值，<code class="fe lu lv lw lx b">codegen.macro</code>为代码。</p><p id="6eb0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">安装<code class="fe lu lv lw lx b">codegen.macro</code>:</p><pre class="kj kk kl km gt ns lx nt nu aw nv bi"><span id="cffd" class="nw mv it lx b gy nx ny l nz oa">npm install --save-dev preval.macro</span></pre><p id="e497" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以在<code class="fe lu lv lw lx b">package.json</code>的<code class="fe lu lv lw lx b"><a class="ae ly" href="https://medium.com/better-programming/package-jsons-dependencies-in-depth-a1f0637a3129" rel="noopener">devDependencies</a></code>中看到新的包:</p><pre class="kj kk kl km gt ns lx nt nu aw nv bi"><span id="29e5" class="nw mv it lx b gy nx ny l nz oa">"devDependencies": {<br/>  "codegen.macro": "^4.0.0"<br/>}</span></pre><p id="4c05" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是改装过的<code class="fe lu lv lw lx b">src/App.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="b573" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们重用了第一个<code class="fe lu lv lw lx b">preval.macro</code>示例，并添加了第15-18行。</p><p id="7907" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在第17行，标记的模板文字显示<code class="fe lu lv lw lx b">codegen</code>是函数名，模板文字是<code class="fe lu lv lw lx b">module.exports</code>的表达式。</p><p id="fed0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与<code class="fe lu lv lw lx b">preval</code>不同，<code class="fe lu lv lw lx b">codegen</code>的<code class="fe lu lv lw lx b">module.exports</code>带字符串(代码以字符串引用)。在构建期间，字符串交换<code class="fe lu lv lw lx b">module.exports</code>成为实际的代码。新嵌入的代码将在运行时执行。</p><p id="53a4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于下面的截图，代码是在晚上7:54:38通过<code class="fe lu lv lw lx b">npm run build</code>编译的。晚上8点13分57秒通过<code class="fe lu lv lw lx b">serve -s build</code>发射。</p><p id="b70f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">codegen.macro</code>在晚上7:54:38生成代码。这个生成的代码在晚上8:13:57执行</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/5989a8fbf982d7144063770daf1464c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lnn1ZpDmqIVGa6zu1G0KSQ.png"/></div></div></figure><p id="d533" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">codegen</code>也可以是函数。</p><p id="7a54" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是另一种改进型<code class="fe lu lv lw lx b">src/App.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="4051" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在第5行，标记的模板文字显示<code class="fe lu lv lw lx b">codegen</code>是函数名，模板文字是<code class="fe lu lv lw lx b">module.exports</code>的表达式。它生成<code class="fe lu lv lw lx b">double</code>函数来在编译时替换<code class="fe lu lv lw lx b">module.exports</code>。这个函数在运行时在第12行执行。</p><p id="b444" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是截图。<code class="fe lu lv lw lx b">double</code>函数将五加倍为十:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/b7d7733710e660920ce98d4c4df44e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w2nD5QH0Zw32Xyl39DRaVg.png"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="cf9c" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">牛逼的巴别塔宏</h1><p id="d3cb" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">我们体验过巴别塔宏的威力。<code class="fe lu lv lw lx b">preval.macro</code>和<code class="fe lu lv lw lx b">codegen.macro</code>都很牛逼。</p><p id="f5f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要不要试试更牛逼的宏？</p><p id="fa9e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">查看令人敬畏的巴别塔宏库。</p><h2 id="491f" class="nw mv it bd mw of og dn na oh oi dp ne lh oj ok ng ll ol om ni lp on oo nk op bi translated">一般</h2><ul class=""><li id="f182" class="lz ma it la b lb nm le nn lh oq ll or lp os lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/citycide/param.macro" rel="noopener ugc nofollow" target="_blank">param.macro</a></code>:JavaScript的部分应用语法和lambda参数。灵感来源于Scala的<code class="fe lu lv lw lx b">_</code>和Kotlin的<code class="fe lu lv lw lx b">it</code>。</li><li id="4d66" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/knpwrs/ms.macro" rel="noopener ugc nofollow" target="_blank">ms.macro</a></code>:将各种时间格式转换为毫秒。</li><li id="eea2" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/Andarist/data-uri.macro" rel="noopener ugc nofollow" target="_blank">data-uri.macro</a></code>:将资产转换为<a class="ae ly" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" rel="noopener ugc nofollow" target="_blank">数据URIs </a>。</li><li id="bbe7" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/Andarist/regexgen.macro" rel="noopener ugc nofollow" target="_blank">regexgen.macro</a></code>:将一组字符串转换成优化的正则表达式。</li><li id="4f0b" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/bradlc/tinker.macro" rel="noopener ugc nofollow" target="_blank">tinker.macro</a></code>:评估Laravel代码。</li><li id="c724" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://lingui.js.org/ref/macro.html" rel="noopener ugc nofollow" target="_blank">@lingui/macro</a></code>:LinguiJS<a class="ae ly" href="https://github.com/lingui/js-lingui/" rel="noopener ugc nofollow" target="_blank">中的国际化宏</a>。</li><li id="af5a" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/Andarist/pipeline.macro" rel="noopener ugc nofollow" target="_blank">pipeline.macro</a></code>:类似流水线操作的宏。</li><li id="592f" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/storybookjs/paths.macro" rel="noopener ugc nofollow" target="_blank">paths.macro</a></code>:将<code class="fe lu lv lw lx b">__dirname</code>和<code class="fe lu lv lw lx b">__filename</code>等路径作为静态值导入。</li><li id="95d3" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/nicolo-ribaudo/for-own.macro" rel="noopener ugc nofollow" target="_blank">for-own.macro</a></code>:让<code class="fe lu lv lw lx b">for-in</code>只访问自己的属性。</li><li id="2cc5" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/ridermansb/files.macro" rel="noopener ugc nofollow" target="_blank">files.macro</a></code>:将目录转换成文件名数组。</li><li id="bce2" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/gnithin/flavors.macro" rel="noopener ugc nofollow" target="_blank">flavors.macro</a></code>:通过操作导入头构建不同风格的应用。</li><li id="d897" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/lorefnon/yaml-to-js.macro" rel="noopener ugc nofollow" target="_blank">yaml-to-js.macro</a></code>:在构建时将YAML模板字符串转换成JavaScript对象。</li><li id="b29c" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/ts-delight/pipe.macro" rel="noopener ugc nofollow" target="_blank">@ts-delight/pipe.macro</a></code>:支持异步步骤、附加参数、早期返回和协调的类型脚本友好的流畅管道API。</li><li id="e30a" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/ts-delight/if-expr.macro" rel="noopener ugc nofollow" target="_blank">@ts-delight/if-expr.macro</a></code>:面向表达式的流畅替代JavaScript的<code class="fe lu lv lw lx b">if</code>语句，编译成三元表达式。</li><li id="43fc" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/ts-delight/switch-expr.macro" rel="noopener ugc nofollow" target="_blank">@ts-delight/switch-expr.macro</a></code>:面向表达式的流畅替代JavaScript的<code class="fe lu lv lw lx b">switch</code>语句，编译成三元表达式。</li><li id="cbc6" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/ts-delight/async-to-generator.macro" rel="noopener ugc nofollow" target="_blank">@ts-delight/async-to-generator.macro</a></code>:将异步函数转换为生成器函数。</li><li id="9e30" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/rakeshpai/fast-fp.macro" rel="noopener ugc nofollow" target="_blank">fast-fp.macro</a></code>:零开销函数式编程库。</li><li id="4aac" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/proteriax/return.macro" rel="noopener ugc nofollow" target="_blank">return.macro</a></code>:JavaScript中Kotlin的早期回归守卫<code class="fe lu lv lw lx b">?: return</code>。</li></ul><h2 id="6e66" class="nw mv it bd mw of og dn na oh oi dp ne lh oj ok ng ll ol om ni lp on oo nk op bi translated">性能和内存管理</h2><ul class=""><li id="2f26" class="lz ma it la b lb nm le nn lh oq ll or lp os lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/Veetaha/using.macro" rel="noopener ugc nofollow" target="_blank">using.macro</a></code>:自动将你的资源句柄包装到<code class="fe lu lv lw lx b">try-finally</code>块中，类似于C# <a class="ae ly" href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-8.0/using#using-declaration" rel="noopener ugc nofollow" target="_blank">使用声明</a>风格。</li><li id="8e08" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/planttheidea/inline-loops.macro" rel="noopener ugc nofollow" target="_blank">inline-loops.macro</a></code>:内联到本机循环以提高性能。</li><li id="bb5d" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/vincentriemer/assign.macro" rel="noopener ugc nofollow" target="_blank">assign.macro</a></code> : Transpile <code class="fe lu lv lw lx b">Object.assign</code>风格的表达式来指导赋值。</li></ul><h2 id="a57d" class="nw mv it bd mw of og dn na oh oi dp ne lh oj ok ng ll ol om ni lp on oo nk op bi translated">文件加载</h2><ul class=""><li id="4db8" class="lz ma it la b lb nm le nn lh oq ll or lp os lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/stereobooster/lqip.macro" rel="noopener ugc nofollow" target="_blank">lqip.macro</a></code>:在构建时创建LQIP，类似于webpack的<code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/zouhir/lqip-loader" rel="noopener ugc nofollow" target="_blank">lqip-loader</a></code>。</li><li id="90d4" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/pveyes/raw.macro" rel="noopener ugc nofollow" target="_blank">raw.macro</a></code>:应用网络包的<code class="fe lu lv lw lx b">raw-loader</code>。</li><li id="ced1" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/eemeli/yaml.macro" rel="noopener ugc nofollow" target="_blank">yaml.macro</a></code>:将YAML文件作为预解析对象加载。</li><li id="fdca" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/ifiokjr/json.macro" rel="noopener ugc nofollow" target="_blank">json.macro</a></code>:单独或模式匹配加载JSON文件，特别支持<code class="fe lu lv lw lx b">package.json</code>、version、tsconfig文件。</li></ul><h2 id="328e" class="nw mv it bd mw of og dn na oh oi dp ne lh oj ok ng ll ol om ni lp on oo nk op bi translated">对象/数组操作</h2><ul class=""><li id="1b56" class="lz ma it la b lb nm le nn lh oq ll or lp os lt me mf mg mh bi translated">利用对象获取器和图形，轻松转换对象。</li><li id="0fbd" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/dralletje/idx.macro" rel="noopener ugc nofollow" target="_blank">idx.macro</a></code>:遍历对象和数组的属性。</li></ul><h2 id="74ca" class="nw mv it bd mw of og dn na oh oi dp ne lh oj ok ng ll ol om ni lp on oo nk op bi translated">以打字打的文件</h2><ul class=""><li id="b7ea" class="lz ma it la b lb nm le nn lh oq ll or lp os lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/vedantroy/typecheck.macro" rel="noopener ugc nofollow" target="_blank">typecheck.macro</a></code>:自动生成类型脚本类型的类型检查函数。</li><li id="0bb7" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/dsherret/ts-nameof/tree/master/packages/ts-nameof.macro" rel="noopener ugc nofollow" target="_blank">ts-nameof.macro</a></code>:打字稿中的<code class="fe lu lv lw lx b"><a class="ae ly" href="https://msdn.microsoft.com/en-us/library/dn986596.aspx" rel="noopener ugc nofollow" target="_blank">nameof</a></code>。</li></ul><h2 id="8364" class="nw mv it bd mw of og dn na oh oi dp ne lh oj ok ng ll ol om ni lp on oo nk op bi translated">代码生成</h2><ul class=""><li id="fba7" class="lz ma it la b lb nm le nn lh oq ll or lp os lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/kentcdodds/preval.macro" rel="noopener ugc nofollow" target="_blank">preval.macro</a></code>:预评估代码。</li><li id="1b8b" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/kentcdodds/codegen.macro" rel="noopener ugc nofollow" target="_blank">codegen.macro</a></code>:生成代码。</li><li id="f44a" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/kentcdodds/import-all.macro" rel="noopener ugc nofollow" target="_blank">import-all.macro</a></code>:导入所有匹配glob的文件。</li></ul><h2 id="0ec7" class="nw mv it bd mw of og dn na oh oi dp ne lh oj ok ng ll ol om ni lp on oo nk op bi translated">发展</h2><ul class=""><li id="6c3c" class="lz ma it la b lb nm le nn lh oq ll or lp os lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/chengjianhua/penv.macro" rel="noopener ugc nofollow" target="_blank">penv.macro</a></code>:根据构建环境选择指定的值或分支。</li><li id="2e0e" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/eemeli/dev-console.macro" rel="noopener ugc nofollow" target="_blank">dev-console.macro</a></code>:从生产构建中移除所有<code class="fe lu lv lw lx b">console.log</code>、<code class="fe lu lv lw lx b">console.warn</code>和<code class="fe lu lv lw lx b">console.error</code>调用。</li><li id="1b1e" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/codemix/babel-plugin-trace" rel="noopener ugc nofollow" target="_blank">babel-plugin-trace/macro</a></code>:添加带有文件名和函数名前缀的带标签的语句日志帮助器。</li><li id="1542" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/bgschiller/inspect.macro" rel="noopener ugc nofollow" target="_blank">inspect.macro</a></code>:将表达式及其结果记录到控制台。</li><li id="d28e" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/storybooks/require-context.macro" rel="noopener ugc nofollow" target="_blank">require-context.macro</a></code>:模拟webpack的<code class="fe lu lv lw lx b">require.context()</code>。</li><li id="b025" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/ts-delight/debug.macro" rel="noopener ugc nofollow" target="_blank">@ts-delight/debug.macro</a></code>:通过构建时增强，使<a class="ae ly" href="https://github.com/visionmedia/debug" rel="noopener ugc nofollow" target="_blank"> visionmedia/debug </a>的使用更加方便。</li></ul><h2 id="ff10" class="nw mv it bd mw of og dn na oh oi dp ne lh oj ok ng ll ol om ni lp on oo nk op bi translated">反应</h2><ul class=""><li id="9e65" class="lz ma it la b lb nm le nn lh oq ll or lp os lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/davidyu85/Tersus-JSX" rel="noopener ugc nofollow" target="_blank">tersus-jsx.macro</a></code>:受AngularJS、<code class="fe lu lv lw lx b">ng-if</code>(使用<code class="fe lu lv lw lx b">tj-if</code>)和<code class="fe lu lv lw lx b">ng-repeat</code>(使用<code class="fe lu lv lw lx b">tj-for</code>)的启发，让React中的JSX更加整齐。</li><li id="3b81" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/vinhlh/tagged-translations" rel="noopener ugc nofollow" target="_blank">tagged-translations</a></code>:翻译React应用程序中的文本。</li><li id="b6f0" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/evenchange4/svgr.macro" rel="noopener ugc nofollow" target="_blank">svgr.macro</a></code>:应用<a class="ae ly" href="https://github.com/smooth-code/svgr" rel="noopener ugc nofollow" target="_blank"> SVGR </a>。</li><li id="380a" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/jhen0409/css-to-rn.macro" rel="noopener ugc nofollow" target="_blank">css-to-rn.macro</a></code>:将CSS转换为React原生样式表。</li><li id="e59c" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/yuchi/hooks.macro" rel="noopener ugc nofollow" target="_blank">hooks.macro</a></code>:自动反应钩子记忆失效。</li><li id="ec5d" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/hamlim/inline-mdx.macro" rel="noopener ugc nofollow" target="_blank">inline-mdx.macro</a></code>:将MDX转换成内嵌组件。</li><li id="a605" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/jaredLunde/react-broker" rel="noopener ugc nofollow" target="_blank">react-broker/macros</a></code>:惰性加载React组件。</li><li id="430d" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/stereobooster/rpi.macro" rel="noopener ugc nofollow" target="_blank">rpi.macro</a></code>:用于<code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/stereobooster/react-precious-image" rel="noopener ugc nofollow" target="_blank">react-precious-image</a></code>的宏。</li><li id="3664" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/eugeneilyin/mdi-norm#with-babel-macros" rel="noopener ugc nofollow" target="_blank">mdi-norm/macro</a></code>:嵌入材质设计系统SVG图标。</li><li id="15d0" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/yesmeck/reactive.macro" rel="noopener ugc nofollow" target="_blank">reactive.macro</a></code>:减少反应样板。</li><li id="e8b2" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/ts-delight/inject-display-name.macro" rel="noopener ugc nofollow" target="_blank">@ts-delight/inject-display-name.macro</a></code>:将显示名注入到动态构造的组件中。</li><li id="5f7f" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/bohdanbirdie/react-css-modules.macro" rel="noopener ugc nofollow" target="_blank">react-css-modules.macro</a></code>:将CSS模块映射到<code class="fe lu lv lw lx b">styleName</code>属性。</li></ul><h2 id="ed3a" class="nw mv it bd mw of og dn na oh oi dp ne lh oj ok ng ll ol om ni lp on oo nk op bi translated">CSS-in-JS</h2><ul class=""><li id="7818" class="lz ma it la b lb nm le nn lh oq ll or lp os lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://emotion.sh/docs/babel-plugin-emotion#babel-macros" rel="noopener ugc nofollow" target="_blank">react-emotion/macro</a></code>:缩小并优化<a class="ae ly" href="https://github.com/emotion-js/emotion" rel="noopener ugc nofollow" target="_blank">情感</a>风格。</li><li id="1cb1" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/kentcdodds/glamorous.macro" rel="noopener ugc nofollow" target="_blank">glamorous.macro</a></code>:给你的<a class="ae ly" href="https://github.com/paypal/glamorous" rel="noopener ugc nofollow" target="_blank">迷人的</a>组件一个好看的<code class="fe lu lv lw lx b">displayName</code>用于React DevTools。</li><li id="ea3f" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/vercel/styled-jsx#using-resolve-as-a-babel-macro" rel="noopener ugc nofollow" target="_blank">styled-jsx/macro</a></code>:使用<a class="ae ly" href="https://github.com/vercel/styled-jsx" rel="noopener ugc nofollow" target="_blank"> styled-jsx </a>的<code class="fe lu lv lw lx b">resolve</code>标签。</li><li id="5479" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://www.styled-components.com/docs/tooling#babel-macro" rel="noopener ugc nofollow" target="_blank">styled-components/macro</a></code>:改善调试体验，为样式化组件增加服务器端渲染支持。</li><li id="5606" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/glortho/styled-import" rel="noopener ugc nofollow" target="_blank">styled-import/macro</a></code>:轻量级CSS解析器，用于从样式表中窃取规则。对于样式化组件、React或任何其他可能在JS中使用CSS的地方——对于使用全局或第三方样式表特别有用。</li><li id="df2e" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/huchenme/unique-classname.macro" rel="noopener ugc nofollow" target="_blank">unique-classname.macro</a></code>:为情感生成唯一的类名。</li><li id="a419" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/ben-rogerson/twin.macro" rel="noopener ugc nofollow" target="_blank">twin.macro</a></code>:作为宏的<a class="ae ly" href="https://tailwindcss.com/" rel="noopener ugc nofollow" target="_blank">顺风</a>的替代和更新解决方案。</li></ul><h2 id="17c9" class="nw mv it bd mw of og dn na oh oi dp ne lh oj ok ng ll ol om ni lp on oo nk op bi translated">GraphQL</h2><ul class=""><li id="8167" class="lz ma it la b lb nm le nn lh oq ll or lp os lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/evenchange4/graphql.macro" rel="noopener ugc nofollow" target="_blank">graphql.macro</a></code>:编译GraphQL AST。</li><li id="7852" class="lz ma it la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated"><code class="fe lu lv lw lx b"><a class="ae ly" href="https://github.com/babel-blade/babel-blade" rel="noopener ugc nofollow" target="_blank">blade.macro</a></code>:内联生成GraphQL查询字符串，解决<a class="ae ly" href="https://babel-blade.netlify.com/docs/declarationdeclaration.html" rel="noopener ugc nofollow" target="_blank">双重声明问题</a>。</li></ul></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="8471" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">结论</h1><p id="744a" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">Babel的插件宏和codegen为我们在编译时操作源代码提供了一个新的维度。它也被称为使用<a class="ae ly" href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" rel="noopener ugc nofollow" target="_blank">抽象语法树</a> (AST)，这是编译器中广泛使用的数据结构，用于表示程序代码的结构。AST是编译器语法分析阶段的结果，它对最终输出有很大的影响。</p><p id="30aa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你对编写宏感兴趣，可以看看Kent Dodds的<a class="ae ly" href="https://github.com/kentcdodds/babel-plugin-macros/blob/master/other/docs/author.md" rel="noopener ugc nofollow" target="_blank"> author markdown页面</a>。那里有很多关于Babel的插件宏和codegen的信息。</p><p id="dce1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读。我希望这有所帮助。你可以在这里看到我的其他媒体出版物<a class="ae ly" href="https://medium.com/@jenniferfubook/jennifer-fus-web-development-publications-1a887e4454af" rel="noopener"/>。</p></div></div>    
</body>
</html>