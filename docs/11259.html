<html>
<head>
<title>Multi Selector in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI中的多重选择器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/multi-selector-in-swiftui-52238dc2a690?source=collection_archive---------2-----------------------#2022-03-03">https://betterprogramming.pub/multi-selector-in-swiftui-52238dc2a690?source=collection_archive---------2-----------------------#2022-03-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6389" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">原型制作缺少SwiftUI组件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b8d65de22e2a1523cf74c4e18aa85616.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A2pgRPeDnV_X97uU"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">哈尔·盖特伍德在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="c902" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在使用SwiftUI开发我的第一个严肃的应用程序时，我一直对使用SwiftUI开发UI的速度印象深刻，特别是如果预先提供的视图已经支持您的用例。当然，对于任何类型的定制UI，我们仍然需要编写我们的定制视图，合并现有的视图，并使用修饰符等对它们进行调整，我希望SwiftUI至少支持开发人员可能需要用来呈现数据和接受用户输入的最常见的视图。</p><p id="bd9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果是这样的话，SwiftUI甚至可以用于原型制作，在这种情况下，可以快速构建一个“工作但不漂亮”的应用创意版本，并向用户展示，以验证该应用创意是否有任何成功的机会。此外，通过这种方式，人们还可以快速收集关于哪些部分实际上需要更好理解的UI(尚未很好理解的部分)以及哪些部分可以通过一些视觉调整保留为默认组件的反馈。</p><p id="5f95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">换句话说:在我看来，SwiftUI有可能让更多开发人员对<a class="ae ky" href="https://en.wikipedia.org/wiki/Minimum_viable_product" rel="noopener ugc nofollow" target="_blank"> MVP </a>驱动的产品开发更感兴趣，这绝对是一件好事，因为它节省了大量时间，否则这些时间将被投入到最终会以这样或那样的方式失败的事情上。这与<a class="ae ky" href="https://en.wikipedia.org/wiki/Lean_startup" rel="noopener ugc nofollow" target="_blank">精益创业方法</a>一致，我认为这是处理任何新产品的好方法。</p><h1 id="8a50" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">SwiftUI的当前状态</h1><p id="845e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了实现这一点，我希望SwiftUI已经涵盖了表单中可能需要的所有常见输入类型，如用户注册或其他类型的数据，因为许多类型的应用程序最终都只是一个接受输入数据、以某种方式转换数据并以特殊方式或时间呈现数据的表单。不幸的是，SwiftUI还没有完全实现。</p><p id="a73c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">苹果似乎对SwiftUI采取的方法是考虑SwiftUI中最缺失的组件，并每年添加一些组件。例如，在WWDC 2020上，他们在<code class="fe ms mt mu mv b">Text</code>中添加了<a class="ae ky" href="https://developer.apple.com/documentation/swiftui/progressview" rel="noopener ugc nofollow" target="_blank">进度视图</a>、<a class="ae ky" href="https://developer.apple.com/documentation/swiftui/gauge" rel="noopener ugc nofollow" target="_blank">量表</a>、<code class="fe ms mt mu mv b">Image</code>支持，并改进了现有视图的许多<a class="ae ky" href="https://developer.apple.com/videos/play/wwdc2020/10041/" rel="noopener ugc nofollow" target="_blank">其他细节，这既是为了性能，也是为了更大的灵活性。在WWDC 2021上，他们增加了多个与<code class="fe ms mt mu mv b">async/await</code>相关的API，如</a><a class="ae ky" href="https://developer.apple.com/documentation/swiftui/asyncimage" rel="noopener ugc nofollow" target="_blank">asyn image</a>或<a class="ae ky" href="https://developer.apple.com/documentation/swiftui/label/refreshable(action:)" rel="noopener ugc nofollow" target="_blank">。可刷新</a>和<a class="ae ky" href="https://developer.apple.com/documentation/swiftui/circle/task(priority:_:)" rel="noopener ugc nofollow" target="_blank">。任务</a>查看修改器，在<a class="ae ky" href="https://medium.com/@anithawritings/whats-new-in-swiftui-wwdc2021-aadbdd8d34de" rel="noopener">其他改进&amp;增加</a>中。</p><p id="b16c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种方法的好处是，一旦向框架中添加了一些东西，人们可以预期它会长期以相同的方式存在和工作，因此每个版本都不需要大的代码更改(就像Swift 4之前的Swift语言一样)。不利的一面是，许多组件仍然缺失。这就是我认为社区可以提供临时解决方案的地方，这些解决方案可以在未来的某个时候被苹果提供的官方组件轻松替换。</p><h1 id="5ea3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">实现多选视图组件</h1><p id="0ecb" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在这篇文章中，我将重点关注这样一个组件，并提供我的初步解决方案:一个多选器，用于从给定的选项集中选择多个选项。截至目前，苹果确实提供了一个<a class="ae ky" href="https://developer.apple.com/documentation/swiftui/picker" rel="noopener ugc nofollow" target="_blank">选择器</a>，但它不支持选择多个条目，甚至会在做出一个选择后自动离开列表屏幕。所以让我们开始着手解决这个问题吧！</p><p id="b3c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">什么样的数据结构需要多重选择器？让我们来看看这个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="3a26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以基本上，在我们的应用程序中，我们有一个目标集合和一个任务集合。我们希望对描述每项任务服务于哪些目标的关系进行建模。当创建或编辑一个<code class="fe ms mt mu mv b">Task</code>时，我们想要选择任务服务于哪个目标。下面是一个<code class="fe ms mt mu mv b">TaskEditView</code>的SwiftUI代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="9a94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码呈现在这个预览中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/d16d56fe6a33b562b90ec563078b5fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/0*Vwqso5XaJ7WO6DfQ.png"/></div></div></figure><p id="f12c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了展示一下，如果我们只有一个目标要服务，事情将如何工作，我们可以简单地用这样的<code class="fe ms mt mu mv b">Picker</code>替换我们的TODO <code class="fe ms mt mu mv b">Text</code>条目:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="dd3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是<code class="fe ms mt mu mv b">TaskEditView</code>现在的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/8204ee64f5dc5656634eb4c6794c9f81.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/0*qNmJPMWg9-rzxNns.png"/></div></figure><p id="029d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击选取器时，这是详细视图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/11d5d7dfa592b259c2463a2b3338fac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/0*meCrj_jMSYYGPsJE.png"/></div></figure><p id="d346" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相当直接。请注意，<code class="fe ms mt mu mv b">Goal</code>必须是<code class="fe ms mt mu mv b">Identifiable</code>才能工作，这就是为什么我首先给它添加了<code class="fe ms mt mu mv b">var id: String { name }</code>。对于我们的多选器，我们希望用户界面看起来几乎一样，但不是一个，我们希望能够选择多个条目。</p><p id="6aba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要在<code class="fe ms mt mu mv b">TaskEditView</code>中重新创建条目，我选择了名称<code class="fe ms mt mu mv b">MultiSelector</code>作为<code class="fe ms mt mu mv b">Picker</code>的替换类型名称。下面是它的实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="9189" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我决定用一个<code class="fe ms mt mu mv b">String</code>来表示每个条目，因此需要一个<code class="fe ms mt mu mv b">optionToString</code>闭包来提供选项类型的<code class="fe ms mt mu mv b">String</code>表示。</p><p id="68e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对<code class="fe ms mt mu mv b">ListFormatter.localizedString</code>的调用确保我们以正确的本地化格式将所选选项列表连接在一起(例如<code class="fe ms mt mu mv b">["A", "B", "C"]</code>变成了英语的“A、B和C”)。</p><p id="7c42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我用于视图的预览代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="9b3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我没有使用<code class="fe ms mt mu mv b">Goal</code>，而是使用了一个内部类型来使预览独立于我的特定项目。这是预览的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/abb797c16187647f24642e431a6d9081.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/0*HUyKQD7suCr8lZi0.png"/></div></figure><p id="d752" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将它放入我们的<code class="fe ms mt mu mv b">TaskEditView</code>中，通过将TODO <code class="fe ms mt mu mv b">Text</code>调用替换为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="f4d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">预览现在变成这样，看起来和预期的一样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/ac86d76440347a35d26335a6a378462c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*WYgUs9vNY7d6fOPJ.png"/></div></figure><p id="fa1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是当我们点击它的时候，我们看到了这个，这还不是正确的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/6bc0364a82df75913b0e835ff78833c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/0*Lts0KNiOXJRhSrAC.png"/></div></figure><p id="17b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们实现细节视图。我为详细视图选择了类型名<code class="fe ms mt mu mv b">MultiSelectionView</code>,这是它的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="d8b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了<code class="fe ms mt mu mv b">label</code>之外，这个基本都有相同的性质。但是这一次，它们实际上被使用了，例如当通过调用<code class="fe ms mt mu mv b">selected</code>集合上的<code class="fe ms mt mu mv b">contains</code>来检查复选标记是否应该实际显示时。</p><p id="2d3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当点击其中一个条目时，在该条目上使用<code class="fe ms mt mu mv b">toggleSelection</code>来删除或插入到<code class="fe ms mt mu mv b">selected</code>属性中。对于勾号，我使用SF符号“勾号”，它看起来与<code class="fe ms mt mu mv b">Picker</code>的勾号图标一模一样。</p><p id="a836" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我为细节视图设置的预览代码，请注意，它几乎是<code class="fe ms mt mu mv b">MultiSelector</code>预览的副本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="a953" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是它在Xcode预览中的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/e9617c1afdf5d4fece7af8a278977b54.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/0*qoavQouhiDB5b0mx.png"/></div></figure><p id="19a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们将TODO <code class="fe ms mt mu mv b">Text</code>条目替换为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="a3e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本上，我们只是将数据传递到细节视图上。但是，让我们看看我们的应用程序现在是什么样子，在我从模拟器上录制的动画GIF中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/80aa1909f1afb9e9820df4e58a76606a.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/0*j6xb__9j48npDKEz.gif"/></div></figure><p id="e83b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很好，起作用了！</p><p id="3581" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经上传了演示项目<a class="ae ky" href="https://github.com/Jeehut/MultiSelectorDemo" rel="noopener ugc nofollow" target="_blank">到GitHub </a>如果你想复制<code class="fe ms mt mu mv b">MultiSelector</code>和<code class="fe ms mt mu mv b">MultiSelectionView</code>的内容，你可以在<a class="ae ky" href="https://github.com/Jeehut/MultiSelectorDemo/tree/main/Shared/MultiSelector" rel="noopener ugc nofollow" target="_blank">这个文件夹</a>中找到它们。</p><pre class="kj kk kl km gt nf mv ng nh aw ni bi"><span id="51ee" class="nj lw it mv b gy nk nl l nm nn"><strong class="mv iu">Want to Connect?</strong></span><span id="5a8b" class="nj lw it mv b gy no nl l nm nn">You can also find me on 👾 <a class="ae ky" href="https://www.twitch.tv/Jeehut" rel="noopener ugc nofollow" target="_blank">Twitch</a>, on 🎬 <a class="ae ky" href="https://www.youtube.com/channel/UCtg6Ck7oYa_9k1oSTmFGNRw" rel="noopener ugc nofollow" target="_blank">YouTube</a> and on 🐦 <a class="ae ky" href="https://twitter.com/Jeehut" rel="noopener ugc nofollow" target="_blank">Twitter</a>.</span></pre></div></div>    
</body>
</html>