<html>
<head>
<title>Monitor Your Flutter App’s Health End to End With GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub操作端到端监控您的Flutter应用程序的健康状况</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/monitor-your-flutter-apps-health-end-to-end-with-github-actions-8a9fb1889c6a?source=collection_archive---------16-----------------------#2020-01-02">https://betterprogramming.pub/monitor-your-flutter-apps-health-end-to-end-with-github-actions-8a9fb1889c6a?source=collection_archive---------16-----------------------#2020-01-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="73db" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">详细的指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7165de2a4fec74c82f944ce72d811245.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CyMp4tQojb3nGso4rmXp2w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@kidcircus?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">儿童马戏团</a>在<a class="ae ky" href="https://unsplash.com/s/photos/action?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="399e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://flutter.dev/" rel="noopener ugc nofollow" target="_blank"> Flutter </a>是最新的跨平台应用框架，提供声明式UI方法、工具和同类最佳的平台覆盖。</p><p id="93ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，为颤振项目构建设备端对端测试并不容易，因为CI和测试平台还没有跟上。</p><p id="ab15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我一直在探索在设备上运行自动端到端测试的方法，以确保我的应用程序的质量。</p><p id="2328" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">经过反复试验，我找到了一种可靠的方法，用<a class="ae ky" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Action </a>在设备上运行Flutter应用的端到端测试。</p><p id="257a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章中使用的代码来自我的Flutter项目，可以在这里找到:</p><div class="lv lw gp gr lx ly"><a href="https://github.com/tianhaoz95/iwfp" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">天昊95/iwfp</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">愿百分之五的原力与你同在。iwfp(我要百分之五)是一个帮助每个使用信用卡的人的工具…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">github.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="41a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注:</strong>对于那些想知道<code class="fe mn mo mp mq b">iwfp</code>是什么的人来说:它是<em class="mr">我想要百分之五</em>——我制作的一个应用程序记录了我所有的信用卡，并使用算法根据每次购买的返现奖励对卡进行排序，这样我就可以总是获得最佳的返现奖励。它是开源的，可以在<a class="ae ky" href="https://play.google.com/store/apps/details?id=com.jacksonz.iwfpapp&amp;hl=en_US" rel="noopener ugc nofollow" target="_blank">谷歌Play商店</a>上获得。请随意使用/贡献。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="9f53" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">步骤1:在GitHub Action中启动模拟器</h1><p id="9613" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">首先，我们需要用模拟器构建一个测试环境。</p><p id="bfa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的<a class="ae ky" href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions" rel="noopener ugc nofollow" target="_blank">工作流脚本</a>中，我们定义了:</p><ul class=""><li id="0996" class="nw nx it lb b lc ld lf lg li ny lm nz lq oa lu ob oc od oe bi translated">我们想在哪些设备上测试我们的应用程序(iPhone 8和11)</li><li id="f4c2" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated">我们想要运行测试的平台(macOS)</li></ul><p id="93ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>这很重要，因为macOS是唯一支持iOS模拟器的操作系统。运行Android模拟器是不可能的，因为它需要容器中没有的硬件加速。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/d4dfcefce1e8baf6de564b3602427ac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fjz5UCKAjgpn5E7Xmg9JTQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>的<a class="ae ky" href="https://github.com/tianhaoz95" rel="noopener ugc nofollow" target="_blank">杰克逊兹</a>的代码(署名<a class="ae ky" href="https://medium.com/flutter-community/run-flutter-driver-tests-on-github-actions-13c639c7e4ab" rel="noopener">卡塔琳娜的帖子</a>)</p></figure><p id="73c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下脚本将在后台启动iOS模拟器:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/3227d3b4fe5cb06fb69ef99110c20816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0RZgzArFqMf7KCNKHCUw7w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>的<a class="ae ky" href="https://github.com/tianhaoz95" rel="noopener ugc nofollow" target="_blank"> JacksonZ </a>编码(署名<a class="ae ky" href="https://medium.com/flutter-community/run-flutter-driver-tests-on-github-actions-13c639c7e4ab" rel="noopener"> Katarina的帖子</a>)</p></figure><p id="d55b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">更新(2020年1月10日):</strong></p><p id="58d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近的Xcode更新更改了设备命名方案。更新后的战略矩阵应该是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/e7b66bca95d6571735c1414985e94cef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*5ihlQ57e3adF80aoilrQEg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>的<a class="ae ky" href="https://github.com/tianhaoz95" rel="noopener ugc nofollow" target="_blank"> JacksonZ </a>编码(来源<a class="ae ky" href="https://medium.com/flutter-community/run-flutter-driver-tests-on-github-actions-13c639c7e4ab" rel="noopener"> Katarina的帖子</a></p></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="28aa" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">步骤2:运行集成测试</h1><p id="96c4" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">既然已经有了一个模拟器运行的测试环境，我们需要构建测试来利用它。</p><p id="f47e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Flutter提供了一个驱动包来轻松编写设备上的测试。详情请阅读<a class="ae ky" href="https://flutter.dev/docs/cookbook/testing/integration/introduction" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="c990" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个<a class="ae ky" href="https://flutter.dev/docs/cookbook/testing/integration/introduction" rel="noopener ugc nofollow" target="_blank">颤振设备测试</a>的片段:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/9282797192ae3f3b6c5649262ead4c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_dsad0dkM4Pbgw4968J8OA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>的<a class="ae ky" href="https://github.com/tianhaoz95" rel="noopener ugc nofollow" target="_blank"> JacksonZ </a>编码</p></figure><p id="ef11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过将以下脚本添加到工作流中，设备上测试将在每次触发工作流时运行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/e14d6b4c28da59de077c8361626b13a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YD8ozz2COG5Zu0qThJniYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>的<a class="ae ky" href="https://github.com/tianhaoz95" rel="noopener ugc nofollow" target="_blank"> JacksonZ </a>编码</p></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="1e5d" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">步骤3:生成感兴趣的截图(可选)</h1><p id="c735" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">为了做得更好，我们可以在运行设备测试时截取我们感兴趣的屏幕截图，并将它们上传到GitHub Action <a class="ae ky" href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/persisting-workflow-data-using-artifacts" rel="noopener ugc nofollow" target="_blank"> artifacts </a>来检查UI回归。</p><p id="16a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码片段显示了一个实用函数，该函数使用Flutter驱动程序包截取屏幕截图，并将其保存到由<code class="fe mn mo mp mq b">path</code>定义的位置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/b9ab0128cba8b7f4c56cac25a9430b72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JmSUWVv6M8thI7GiOcxc2w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>的<a class="ae ky" href="https://github.com/tianhaoz95" rel="noopener ugc nofollow" target="_blank">杰克逊兹</a>编码</p></figure><p id="1fc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更容易使用，我们将最后一个函数封装到另一个实用函数中，该函数隐藏了重复的位置和后缀:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/0fe85a63afcd791e813ab9a1b70448e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0zVaUGWjeELf6YQmZdbJQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>的<a class="ae ky" href="https://github.com/tianhaoz95" rel="noopener ugc nofollow" target="_blank"> JacksonZ </a>编码</p></figure><p id="1dec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了助手功能，我们可以在设备上测试时抓图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/d4be7cbf31664133f00ff352b06aec97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BsdL56L1NI6Edm9U0gHPCg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>的<a class="ae ky" href="https://github.com/tianhaoz95" rel="noopener ugc nofollow" target="_blank"> JacksonZ </a>编码</p></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="d662" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">步骤4:打包截图并上传(可选)</h1><p id="2666" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">有了最后一步，现在每次测试都会生成一组截图。</p><p id="c45f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了让开发人员更容易检查，我们将使用以下脚本将截图作为工件上传到GitHub Action:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/94cab87988219a553650bd95e24112df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YkUVmA6utze4OhAgQv3-KA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>的<a class="ae ky" href="https://github.com/tianhaoz95" rel="noopener ugc nofollow" target="_blank"> JacksonZ </a>编码</p></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="26d2" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">第五步:喝杯咖啡(非可选)</h1><p id="9d63" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">下面快速浏览一下完整的工作流程，以及在哪里可以找到您的截图工件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/e52b8a9b43c94c0c17e050cbb40fbce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OPMs7EFFXzH6E6CwYum_KA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>的<a class="ae ky" href="https://github.com/tianhaoz95" rel="noopener ugc nofollow" target="_blank"> JacksonZ </a>编码</p></figure><p id="9006" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一如既往，编码快乐！</p></div></div>    
</body>
</html>