<html>
<head>
<title>iOS 13 Compositional Layouts in CollectionView</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 13集合视图中的合成布局</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ios-13-compositional-layouts-in-collectionview-90a574b410b8?source=collection_archive---------0-----------------------#2019-11-19">https://betterprogramming.pub/ios-13-compositional-layouts-in-collectionview-90a574b410b8?source=collection_archive---------0-----------------------#2019-11-19</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="feeb" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">探索用于编写复杂布局的强大的新API</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/d35e07ec4b273a41b179403614d96b3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VZumXGZSfiKMX9KX"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@teodosiev?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿塔纳斯·特奥多西耶夫</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="bd27" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">苹果今年在<code class="fe lw lx ly lz b">CollectionView</code>布局上带来的进步证明了一个事实，尽管引发了风暴<a class="ae kz" href="https://developer.apple.com/xcode/swiftui/" rel="noopener ugc nofollow" target="_blank">swift ui</a>,<a class="ae kz" href="https://getuikit.com/" rel="noopener ugc nofollow" target="_blank">UIkit</a>还没有结束。至少近期不会，因为SwiftUI目前甚至不支持<code class="fe lw lx ly lz b">CollectionView</code>。</p><p id="d66d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">UICollectionFlowLayout</code>在简单的布局中工作得很好，但是随着设计变得越来越多样化，需要构建定制的布局，这有它自己的问题。</p><p id="d357" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">样板代码和自调整单元格的挑战只是使构建高级设计变得麻烦的几个问题。</p><p id="2e73" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">很高兴，在WWDC 2019期间，苹果推出了组合布局，目标是简化我们应用程序中复杂布局的开发过程。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="abf9" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">构图布局:引擎盖下</h1><p id="6fb8" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">组合布局是一种声明式的API，它允许我们通过拼接较小的布局组来构建大型布局。组合布局有一个层次结构，包括:<code class="fe lw lx ly lz b">Item</code>、<code class="fe lw lx ly lz b">Group</code>、<code class="fe lw lx ly lz b">Section</code>和<code class="fe lw lx ly lz b">Layout</code>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ne"><img src="../Images/f24f51308fad3e4c59b2e2fcd3799601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xm6Xe0OaYmSAlUoOxQ7WTg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">构图布局的层次</p></figure></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="266d" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">核心概念</h1><p id="618c" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">要构建任何组合布局，需要实现以下四个类:</p><ul class=""><li id="8916" class="nf ng iu lc b ld le lg lh lj nh ln ni lr nj lv nk nl nm nn bi translated"><code class="fe lw lx ly lz b">NSCollectionLayoutSize</code> —宽度和高度尺寸属于<code class="fe lw lx ly lz b">NSCollectionLayoutDimension</code>类型，可通过设置布局的部分宽度/高度(相对于其容器的百分比)或通过设置绝对或估计尺寸来定义。</li><li id="1c5d" class="nf ng iu lc b ld no lg np lj nq ln nr lr ns lv nk nl nm nn bi translated"><code class="fe lw lx ly lz b">NSCollectionLayoutItem</code> —这是根据尺寸在屏幕上呈现的布局单元格。</li><li id="80a8" class="nf ng iu lc b ld no lg np lj nq ln nr lr ns lv nk nl nm nn bi translated"><code class="fe lw lx ly lz b">NSCollectionLayoutGroup</code> —它以水平、垂直或自定义形式保存<code class="fe lw lx ly lz b">NSCollectionLayoutItem</code>。</li><li id="8265" class="nf ng iu lc b ld no lg np lj nq ln nr lr ns lv nk nl nm nn bi translated"><code class="fe lw lx ly lz b">NSCollectionLayoutSection</code> —用于通过传递<code class="fe lw lx ly lz b">NSCollectionLayoutGroup.</code>部分来初始化部分，最终组成组合布局。</li></ul></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="9e72" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">履行</h1><p id="63a7" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">让我们来看看混合(确切地说，嵌入)上述每个组件来构建<code class="fe lw lx ly lz b">CollectionView</code>的组合布局的代码。</p><pre class="kk kl km kn gu nt lz nu nv aw nw bi"><span id="ec6e" class="nx mi iu lz b gz ny nz l oa ob">private func createLayout() -&gt; UICollectionViewLayout {</span><span id="8217" class="nx mi iu lz b gz oc nz l oa ob">//1<br/>let itemSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(1.0),heightDimension: .fractionalHeight(1.0))</span><span id="cd69" class="nx mi iu lz b gz oc nz l oa ob">let item = NSCollectionLayoutItem(layoutSize: itemSize)</span><span id="75d3" class="nx mi iu lz b gz oc nz l oa ob">//2<br/>let groupSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(1.0),heightDimension: .absolute(44))</span><span id="b417" class="nx mi iu lz b gz oc nz l oa ob">//3<br/>let group = NSCollectionLayoutGroup.horizontal(layoutSize: groupSize,subitems: [item])</span><span id="af19" class="nx mi iu lz b gz oc nz l oa ob">let section = NSCollectionLayoutSection(group: group)</span><span id="e447" class="nx mi iu lz b gz oc nz l oa ob">let layout = UICollectionViewCompositionalLayout(section: section)</span><span id="d2f9" class="nx mi iu lz b gz oc nz l oa ob">return layout</span><span id="80ee" class="nx mi iu lz b gz oc nz l oa ob">}</span></pre><p id="63df" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上面的代码是为<code class="fe lw lx ly lz b">CollectionView</code>构建组合布局的一个非常基本的例子。让我们看看在几个关键点上发生了什么:</p><ol class=""><li id="ec30" class="nf ng iu lc b ld le lg lh lj nh ln ni lr nj lv od nl nm nn bi translated">通过将项目布局的<code class="fe lw lx ly lz b">fractionalWidth</code>和<code class="fe lw lx ly lz b">fractionalHeight</code>设置为1，我们将项目分配为占据整个组的宽度和高度。</li><li id="e8ba" class="nf ng iu lc b ld no lg np lj nq ln nr lr ns lv od nl nm nn bi translated">类似地，组尺寸被设置为占据截面的整个宽度和绝对高度。</li><li id="c737" class="nf ng iu lc b ld no lg np lj nq ln nr lr ns lv od nl nm nn bi translated">该组的布局大小和子项被包装到section组件中，最终进入复合布局。</li></ol><p id="4637" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要将组合布局添加到我们的集合视图中，只需将其添加到初始化器中，如下所示:</p><pre class="kk kl km kn gu nt lz nu nv aw nw bi"><span id="2fe4" class="nx mi iu lz b gz ny nz l oa ob">collectionView = UICollectionView(frame: view.bounds, collectionViewLayout: createLayout())</span></pre></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="c184" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">团体是至关重要的</h1><p id="839b" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">即使第一眼看上去不像，组也是最终决定物品高度的组件。此外，他们甚至可以覆盖项目的大小尺寸。</p><p id="cf77" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在下面的代码片段中，我们显式设置了每组的项目数，这将自动确定组中每个项目的大小并覆盖默认项目大小:</p><pre class="kk kl km kn gu nt lz nu nv aw nw bi"><span id="36be" class="nx mi iu lz b gz ny nz l oa ob">let group = NSCollectionLayoutGroup.horizontal(layoutSize: groupSize,subitem: item, count: 2)</span></pre></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="f10e" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">项目间距</h1><p id="9f7f" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">构图布局提供了很多增加空间的选择。它可以在项目或组上完成，如下面的代码片段所示:</p><pre class="kk kl km kn gu nt lz nu nv aw nw bi"><span id="a036" class="nx mi iu lz b gz ny nz l oa ob">item.contentSize = NSDirectionalEdgeInsets(top: 5, leading: 5, trailing: 5, bottom: 5)</span><span id="2a23" class="nx mi iu lz b gz oc nz l oa ob">group.interItemSpacing = .fixed(CGFloat(10))</span></pre><p id="ed7a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们已经将我们的集合视图单元格映射到一些随机的<code class="fe lw lx ly lz b">UIColors</code>，这最终给了我们这个:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oe"><img src="../Images/b2226a797b371bca0b6724c2a6d2c86d.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/1*6FR5sIWTWEqgpVL-jzfSyw.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">带组和项目间距</p></figure><p id="d8f7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">只需几行代码，您就可以为复合布局带来全新的外观。在下一节中，我们将探索具有不同布局的多个部分。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="a488" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">多个部分，多种布局</h1><p id="0e82" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">除了我们之前看到的自顶向下定义布局的方式，我们可以使用闭包来初始化部分，并将它们返回到组合布局。</p><p id="3c8d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面这段代码显示:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="of og l"/></div></figure><p id="6a04" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以上代码或多或少类似于我们之前看到的代码，除了我们正在创建部分提供者闭包并将它们返回到布局中。基于上面代码片段中的节号，我们设置了不同的列数。</p><p id="04c3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">layoutEnvironment</code>包含与视图相关的有用属性。我们可以从这个参数中获取视图的宽度/高度，并基于此在不同的屏幕尺寸上设置每组的项目数。</p><p id="5480" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们的例子中，我们在<code class="fe lw lx ly lz b">CollectionView</code>中将段数设置为3，并得到以下结果:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oh"><img src="../Images/c302594961dcbf56942cc6384e97fde7.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/1*o4VmFKMveiu-5lWtufq57A.gif"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">屏幕截图</p></figure><p id="1351" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，我们已经讨论了对于构建复合布局至关重要的各种组件。包含上述示例的完整源代码可以在这个<a class="ae kz" href="https://github.com/anupamchugh/iowncode/tree/master/iOS13CompostionalLayouts" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a>中获得。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="7caf" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">还有更多</h1><p id="0948" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">我们可以通过在组合布局中使用补充视图和徽章来构建更有趣的布局。</p><p id="22f7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://medium.com/better-programming/applying-diffable-data-sources-70ce65b368e4" rel="noopener"> Diffable数据源</a>是在WWDC 2019期间推出的，可以很好地与组合布局配合使用，因为它使用类型安全标识符来识别其部分和项目。我们将在下一部分讨论这些。</p><p id="11f9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这就结束了。我希望你喜欢读它。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="d220" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">下一部分</h1><div class="oi oj gq gs ok ol"><a href="https://medium.com/better-programming/applying-diffable-data-sources-70ce65b368e4" rel="noopener follow" target="_blank"><div class="om ab fp"><div class="on ab oo cl cj op"><h2 class="bd iv gz z fq oq fs ft or fv fx it bi translated">应用不同的数据源</h2><div class="os l"><h3 class="bd b gz z fq oq fs ft or fv fx dk translated">再见reloadData()和performBatchUpdates()</h3></div><div class="ot l"><p class="bd b dl z fq oq fs ft or fv fx dk translated">medium.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz kt ol"/></div></div></a></div></div></div>    
</body>
</html>