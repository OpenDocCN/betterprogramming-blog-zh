<html>
<head>
<title>Creating a Full-fledged Spotify Playlist Generator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个成熟的Spotify播放列表生成器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/creating-a-full-fledged-spotify-playlist-generator-in-a-weekend-498bb488c275?source=collection_archive---------9-----------------------#2022-07-20">https://betterprogramming.pub/creating-a-full-fledged-spotify-playlist-generator-in-a-weekend-498bb488c275?source=collection_archive---------9-----------------------#2022-07-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c04b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从一首歌的氛围无缝过渡到另一首</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3a27825c877f644160649acca40968f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mgEkltXeo1O2G85A"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">亚历山大·沙托夫在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="f073" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最近，我想更好地理解<a class="ae kv" href="https://aws.amazon.com/what-is/api/" rel="noopener ugc nofollow" target="_blank">API</a>是如何工作的。我用了一些简单的，会<a class="ae kv" href="https://www.colr.org/api.html" rel="noopener ugc nofollow" target="_blank">为你产生随机颜色</a>，或者给你一个<a class="ae kv" href="https://kinduff.github.io/dog-api/" rel="noopener ugc nofollow" target="_blank">随机狗事实</a>(你知道竖起耳朵的狗比耷拉耳朵的狗听声音更好吗？).API是为你的web应用获取数据的一个很好的工具，但是几乎所有更复杂的API都需要<a class="ae kv" href="https://auth0.com/docs/get-started/identity-fundamentals/authentication-and-authorization" rel="noopener ugc nofollow" target="_blank">认证和授权</a>。</p><p id="e195" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我决定使用<a class="ae kv" href="https://developer.spotify.com" rel="noopener ugc nofollow" target="_blank"> Spotify的Web API </a>。它提供了大量的文档，允许你做用户在平台上能做的几乎任何事情；搜索歌曲，创建播放列表，获取推荐，等等。</p><p id="b9cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我做的应用程序叫做Vibesition，它允许用户制作一个播放列表，从一首歌的氛围无缝过渡到另一首歌的氛围。这是我做过的最喜欢的网站开发项目。</p><p id="6e08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://vibesition.jordantwells.com" rel="noopener ugc nofollow" target="_blank">vibesition.jordantwells.com</a>亲自尝试一下吧！它的所有源代码都可以在我的GitHub上找到。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1aad" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">使用NextAuth.js进行身份验证</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/269d3c78b6ff403e63fd8be9351cbe8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*U8EtCfJ0RRCI27gJ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">搜索一首有节奏的歌曲</p></figure><p id="f59d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">NextAuth是Next.js的一个工具，它使得与GitHub、脸书、Discord和<a class="ae kv" href="https://next-auth.js.org/configuration/providers/oauth" rel="noopener ugc nofollow" target="_blank">更多</a>等流行的登录服务的集成变得尽可能简单。我强烈推荐使用<a class="ae kv" href="https://create.t3.gg" rel="noopener ugc nofollow" target="_blank"> create-t3-app </a>来初始化您的项目，因为它可以为您设置NextAuth的大部分样板文件。</p><p id="827d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您需要做的唯一更改是对[…nextauth]。ts <br/>文件，使用<a class="ae kv" href="https://next-auth.js.org/providers/spotify" rel="noopener ugc nofollow" target="_blank"> SpotifyProvider </a>，给你的app适当的<a class="ae kv" href="https://developer.spotify.com/documentation/general/guides/authorization/scopes/" rel="noopener ugc nofollow" target="_blank">授权范围</a>。客户端ID和客户端密码都来自于向<a class="ae kv" href="https://developer.spotify.com/dashboard/" rel="noopener ugc nofollow" target="_blank"> Spotify开发者仪表板</a>注册应用程序。当您在这里时，请确保在您的重定向URIs中添加类似于"<a class="ae kv" href="http://localhost:3000/api/auth/callback/spotify" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/API/auth/callback/Spotify</a>"的内容，以确保您可以正确登录。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">设置NextAuth</p></figure><p id="2a1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的例子中，我选择了一个允许我查看用户的电子邮件地址并修改他们的公共播放列表的范围，就像我需要的<a class="ae kv" href="https://vibesition.jordantwells.com" rel="noopener ugc nofollow" target="_blank">VI position</a>一样。</p><p id="308f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了实际使用这个API，需要将授权代码换成一个访问令牌，这个令牌将是您在定义的范围内使用任何端点的入场券。</p><p id="3d52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于这个过程的更多细节可以在Spotify的文档中找到。请注意，这个刷新令牌来自NextAuth生成的令牌:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用Spotify API</p></figure><p id="ad99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，<code class="fe mu mv mw mx b">refreshToken</code>参数来自NextAuth，在我的设置中可以通过。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">获取accessToken</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="b230" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">构建应用程序</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/d81b8cfca413303a6edd64516f44de35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vmDkTBovXWlYlj5m.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">选择带有振动位置的歌曲</p></figure><p id="373e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我有了Spotify API的强大支持(在我定义的小范围内)，我终于可以开始构建我的web应用程序了。</p><p id="57ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望用户能够搜索歌曲作为播放列表的起点和终点。为此，我使用<a class="ae kv" href="https://developer.spotify.com/documentation/web-api/reference/#/operations/search" rel="noopener ugc nofollow" target="_blank">搜索端点</a>从Spotify搜索中获取前5个响应。一旦用户选择了一首歌曲，如上所示，它会在React状态下保存Spotify ID。这个ID被用作许多其他端点的查询，所以保存它是一件好事。</p><p id="cea1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦用户选择了一首歌曲，它就会使用<a class="ae kv" href="https://developer.spotify.com/documentation/web-api/reference/#/operations/get-audio-features" rel="noopener ugc nofollow" target="_blank">Spotify Audio Features</a>endpoint根据歌曲的~vibe~自动生成一种颜色。具体来说，我使用歌曲的可跳性、能量和效价(我也不知道它是什么意思)的组合来确定RGB值。</p><p id="14c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了确定哪些歌曲将出现在播放列表中，我使用了<a class="ae kv" href="https://developer.spotify.com/documentation/web-api/reference/#/operations/get-recommendations" rel="noopener ugc nofollow" target="_blank">获取推荐</a>端点。这允许你根据目标特征来查找歌曲，例如可跳舞性、速度、音调、持续时间等等。在这种情况下，我使用了一个<a class="ae kv" href="https://en.wikipedia.org/wiki/Sigmoid_function" rel="noopener ugc nofollow" target="_blank">类sigmoid插值</a>在两首歌曲的音频特征值之间进行插值，并在曲线上获得10首歌曲的目标值。</p><p id="c776" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，为了创建播放列表，我使用了<a class="ae kv" href="https://developer.spotify.com/documentation/web-api/reference/#/operations/create-playlist" rel="noopener ugc nofollow" target="_blank">创建播放列表</a>和<a class="ae kv" href="https://developer.spotify.com/documentation/web-api/reference/#/operations/add-tracks-to-playlist" rel="noopener ugc nofollow" target="_blank">添加项目到播放列表</a>的端点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/ee5f0c09857af1ca40bfee76a1286b2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*d18fOupNNJ3fNJ8K.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Vibesition的结果页面</p></figure><p id="97c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个项目还添加了一大堆其他的好东西。我使用<a class="ae kv" href="https://www.framer.com/motion/" rel="noopener ugc nofollow" target="_blank">帧运动</a>给整个项目一些急需的生命。我使用了<a class="ae kv" href="https://www.w3schools.com/html/html5_audio.asp" rel="noopener ugc nofollow" target="_blank"> HTML音频标签</a>来允许用户播放歌曲，如果他们有来自Spotify的预览URL。当然，我使用了<a class="ae kv" href="https://tailwindcss.com" rel="noopener ugc nofollow" target="_blank"> Tailwind CSS </a>来使UI成为这个过程中最简单的部分。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="ce22" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="f81b" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">总的来说，这是一个学习使用高效API的令人难以置信的项目。我希望在未来使用更多，并将它们整合到我的项目中，使获取有趣的数据变得容易。</p><p id="0837" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p><pre class="kg kh ki kj gt nd mx ne nf aw ng bi"><span id="8393" class="nh ma iq mx b gy ni nj l nk nl">If you’re interested in more of my projects or me, check out my personal website, <a class="ae kv" href="https://jordantwells.com" rel="noopener ugc nofollow" target="_blank">jordantwells.com</a>.</span></pre></div></div>    
</body>
</html>