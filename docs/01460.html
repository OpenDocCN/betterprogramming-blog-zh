<html>
<head>
<title>Setting Up Your Own Private VPN and Fixing DNS Leaks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置您自己的专用VPN并修复DNS漏洞</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/setting-up-your-own-private-vpn-and-fixing-dns-leaks-768ee8872bc?source=collection_archive---------6-----------------------#2019-09-12">https://betterprogramming.pub/setting-up-your-own-private-vpn-and-fixing-dns-leaks-768ee8872bc?source=collection_archive---------6-----------------------#2019-09-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e568" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">了解如何在AWS EC2上使用OpenVPN，以及如何在Ubuntu 18.04 LTS上处理DNS泄漏</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bc8a5660f2ac51919954d12b6722a6bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AHJL_C11yEaOsSTU"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@niv?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Niv歌手</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="7bf4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">滚动自己的<a class="ae ky" href="https://en.wikipedia.org/wiki/Virtual_private_network" rel="noopener ugc nofollow" target="_blank">虚拟专用网</a> (VPN)远比从某人的“2019年最佳VPN”名单中选择VPN提供商复杂。但是我越了解为什么要使用VPN，后一种选择就越没有吸引力。除了相信虚假的VPN应用程序或成为相似URL的受害者的危险之外，即使是合法的VPN服务提供商也有压力和动机，可能与你希望购买的隐私不一致。</p><p id="8b47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，VPN的目的是通过伪装你的位置来获得一层隐私。如果你目前没有使用，你可以在DNSleaktest.com<a class="ae ky" href="https://dnsleaktest.com/" rel="noopener ugc nofollow" target="_blank">看看互联网知道你在哪里。你会看到一个大大的“你好”，你的IP地址和你的位置。如果这有点令人不安，要知道VPN可以帮助保护你的位置和在线活动，使其免受不确定的目光和投机的广告商的影响。前者可能是一个过于好奇甚至恶意的公共WiFi上网者，但后者，与直觉相反，可能是你自己的家庭互联网服务提供商(ISP)。</a></p><p id="8cd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用VPN意味着互联网不能轻易看到你的位置，你的ISP不能看到你未加密的网络流量(你好奇的咖啡店邻居也不能)。您的ISP <em class="lv">可以</em>看到您以加密形式发送的数据量，以及您发送到VPN服务器的数据量——但仅此而已。</p><p id="d86b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除非你有一个<a class="ae ky" href="https://dnsleaktest.com/what-is-a-dns-leak.html" rel="noopener ugc nofollow" target="_blank"> DNS泄露</a>。</p><p id="74a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您仍在使用ISP的DNS服务器，他们仍能看到服务器为您解析的所有URL。因此，他们会知道你请求的是“lastminutebackwax.com”，尽管他们无法解密与该网站交换的数据。(是不是只有我觉得，或者这看起来更糟，不知何故？)</p><p id="e949" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">建立自己的实例和VPN服务比信任另一家公司来处理您的数据更让人放心。注意VPN不会给你完全的在线匿名；还有许多其他方法可以跟踪您的互联网状态并发现您的位置。然而，如果设置得当，没有DNS泄露，你将拥有尽可能多的互联网隐私而不用使用<a class="ae ky" href="https://en.wikipedia.org/wiki/Tor_(anonymity_network)" rel="noopener ugc nofollow" target="_blank"> Tor </a>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="eb8d" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">设置您的VPN</h1><p id="5858" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这篇文章将介绍如何在AWS Marketplace上设置<a class="ae ky" href="https://aws.amazon.com/marketplace/pp/B00MI40CAE/" rel="noopener ugc nofollow" target="_blank"> OpenVPN Access Server </a>产品，在<a class="ae ky" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank">亚马逊EC2 </a>(弹性计算云)实例上运行。然后，我们将看看如何修复Ubuntu 18.04中一个已知的<a class="ae ky" href="http://Setting Up Your VPN" rel="noopener ugc nofollow" target="_blank">网络管理器错误</a>，该错误可能会导致DNS泄漏。整个过程大约需要15分钟，所以喝杯咖啡，让我们做一些成人活动。</p><p id="ecaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">注意:本教程中显示的用于演示的id和IP地址无效。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4e03" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">在AWS Marketplace上启动OpenVPN访问服务器</h1><p id="6614" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><a class="ae ky" href="https://aws.amazon.com/marketplace/pp/B00MI40CAE" rel="noopener ugc nofollow" target="_blank"> OpenVPN访问服务器</a>可在AWS Marketplace上获得。自带许可证(BYOL)模式实际上不需要最多两台连接设备的许可证；为了连接更多的客户端，您可以获得针对五个、十个或二十五个客户端的<a class="ae ky" href="https://aws.amazon.com/marketplace/seller-profile/ref=srh_res_product_vendor?ie=UTF8&amp;id=aac3a8a3-2823-483c-b5aa-60022894b89d" rel="noopener ugc nofollow" target="_blank">捆绑计费</a>，或者以<a class="ae ky" href="https://openvpn.net/pricing/" rel="noopener ugc nofollow" target="_blank">15美元/设备/年</a>的价格按菜单购买至少十个OpenVPN许可证。对于我们大多数人来说，两个免费连接的设备就足够了；如果使用<a class="ae ky" href="https://aws.amazon.com/blogs/aws/new-amazon-ec2-micro-instances/" rel="noopener ugc nofollow" target="_blank"> EC2微实例</a>，我们的设置也将符合<a class="ae ky" href="https://aws.amazon.com/free/" rel="noopener ugc nofollow" target="_blank"> AWS自由层</a>。</p><p id="4b18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先点击<a class="ae ky" href="https://aws.amazon.com/marketplace/pp/B00MI40CAE" rel="noopener ugc nofollow" target="_blank"> OpenVPN接入服务器</a>的“继续订阅”,这将带你进入如下页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/552698f362e3f12518c815f4c1d15348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FWGQ7p_vKgujZsxqfvjgrw.jpeg"/></div></div></figure><p id="5496" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击“继续配置”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/7c3f529471b8517b82147987d1547d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j5GZpAl3a_qJobgMxqt7Vw.jpeg"/></div></div></figure><p id="a8c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能会注意到，右边栏中的EC2实例类型(以及随后的每月评估)并不是我们想要的类型——没关系，我们很快就会改变它。只要确保选择的“区域”是我们希望实例所在的位置。一般来说，离你的客户(这里是你的笔记本电脑)越近，你的VPN就越快。点击“继续启动”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/3954263c0e4aeb8c199f2703e355e5cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QR41JrjnKJfpnPfA33W7Ug.jpeg"/></div></div></figure><p id="2323" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在此页面上，我们将更改三项内容:</p><h2 id="eaf6" class="nd me it bd mf ne nf dn mj ng nh dp mn li ni nj mp lm nk nl mr lq nm nn mt no bi translated">EC2实例类型</h2><p id="d3a8" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">不同类型的EC2实例将为我们提供不同级别的计算能力。如果您计划将您的实例用于除此VPN之外的其他用途，您可能希望选择具有更高内存或存储容量的实例，这取决于您计划如何使用它。我们可以在<a class="ae ky" href="https://aws.amazon.com/ec2/instance-types/" rel="noopener ugc nofollow" target="_blank">亚马逊EC2实例类型页面</a>上查看每个实例。</p><p id="6f9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于简单的VPN使用，<code class="fe np nq nr ns b">t2.nano</code>或<code class="fe np nq nr ns b">t2.micro</code>实例可能就足够了。只有微实例符合自由层条件。</p><h2 id="d327" class="nd me it bd mf ne nf dn mj ng nh dp mn li ni nj mp lm nk nl mr lq nm nn mt no bi translated">安全组设置</h2><p id="0de3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">一个<a class="ae ky" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html" rel="noopener ugc nofollow" target="_blank">安全组</a>是一个配置文件，或者设置的集合，Amazon用它来控制对我们实例的访问。如果您以前安装过其他AWS产品，您可能已经有一些定义了自己规则的组。我们应该仔细理解我们的安全组设置的原因，因为这些定义了我们的实例是公开的还是私有的，以及谁可以访问它。</p><p id="ed05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们点击“根据卖家设置新建”，OpenVPN服务器会为默认安全组定义一些推荐设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/34753b47d7d006083d6ed1c7e4f5a67b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M7KjtxWdj52b3ECHGEJO9Q.jpeg"/></div></div></figure><p id="713f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于TCP端口22、943、443和945以及UDP端口1194，默认的推荐设置都是<code class="fe np nq nr ns b">0.0.0.0/0</code>。OpenVPN在其网站上提供了关于如何使用端口的解释。在默认设置下，所有这些端口都是开放的，以支持OpenVPN服务器的各种功能。我们可能希望将对这些端口的访问限制在一个特定的IP地址或地址块(比如您自己的ISP)上，以增加我们实例的安全性。但是，如果您的IP地址频繁更改(例如当您旅行并连接到不同的WiFi网络时)，限制端口可能不会像我们希望的那样有用。</p><p id="2e5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在任何情况下，我们的实例都需要SSH密钥来连接，并且OpenVPN服务器将受到密码保护。除非您有其他特定的安全目标，否则现在接受默认设置就可以了。</p><p id="fd18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们给安全组一个名称和简要描述，这样我们就知道它的用途了。然后点击“保存”</p><h2 id="efb2" class="nd me it bd mf ne nf dn mj ng nh dp mn li ni nj mp lm nk nl mr lq nm nn mt no bi translated">密钥对设置</h2><p id="5761" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">前面提到的SSH密钥是访问凭证，我们将使用它们来连接到我们的实例。我们可以在这个部分<a class="ae ky" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html#having-ec2-create-your-key-pair" rel="noopener ugc nofollow" target="_blank">创建一个密钥对</a>，或者您可以选择一个已经在AWS中使用的密钥对。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/d0e29f505af86502d581cc2bb2825132.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ydO8xCB8NrxaGUJ7oSrXg.jpeg"/></div></div></figure><p id="ba8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建一组新的访问凭证，请单击“在EC2中创建密钥对”以打开一个新窗口。然后，单击“创建密钥对”蓝色按钮。一旦您为您的密钥对命名，它将被创建，并且私钥将自动下载到您的机器上。这是一个以扩展名<code class="fe np nq nr ns b">.pem</code>结尾的文件。将此密钥存储在计算机上安全的地方。当我们连接到新的EC2实例时，我们需要引用它。</p><p id="5e39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以返回到上一个窗口，选择刚刚创建的密钥对。如果它没有出现，点击下拉菜单旁边的小“刷新”图标。一旦它被选中，点击闪亮的黄色“启动”按钮。</p><p id="e9e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们应该会看到这样的消息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/3394bc70711dafa4d999530883fcba6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z2Ki1JN0QtGVEX-tJTAo-A.jpeg"/></div></div></figure><p id="84b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很棒的东西！现在我们的实例已经存在，让我们确保可以访问它并启动我们的VPN。要获得下一步的快捷方式，请单击成功消息中的“EC2控制台”链接。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="159c" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">关联弹性IP</h1><p id="4d7d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">亚马逊的<a class="ae ky" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html" rel="noopener ugc nofollow" target="_blank">弹性IP地址</a>为我们提供了一个由我们的账户控制的公共IPv4地址，不像公共IP地址绑定到我们的EC2实例。创建一个并将其与我们的VPN实例相关联被认为是最佳实践。如果我们的实例出现任何问题，或者如果我们希望将来为我们的VPN使用一个新的实例，弹性IP可以从当前实例中分离出来，并与我们的新实例重新关联。这使得我们的联网客户可以无缝过渡。把弹性IP想象成我们注册的网络域名——我们可以把它指向我们选择的任何地方。</p><p id="a231" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在<a class="ae ky" href="https://console.aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank"> Amazon EC2控制台</a>上创建一个新的弹性IP地址。如果您点击了上面成功消息中的链接，我们已经在那里了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/b22920acbac002863acc4a346717b426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*10Us2h2MAoQZWtcffZLAZA.jpeg"/></div></div></figure><p id="89da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有多个实例，请记下我们刚刚启动的那个实例的实例ID。</p><p id="0e6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在左侧边栏的“网络与安全”下，选择“弹性IPs”然后点击蓝色的“分配新地址”按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/31878bb5b67db27cb23ab1d63c66a721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JsZ9fC1EGCqNxJ7RBtBeYQ.jpeg"/></div></div></figure><p id="35dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选取“Amazon Pool”，然后点按“分配”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/bf422f9ae7eac951be576efcbc441dd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ktdyxg4Ntdq6oqya7RnAtA.jpeg"/></div></div></figure><p id="77a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功！我们可以点击“关闭”返回到弹性IP控制台。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/2cc446d2e080f9b9a41b45512be442d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HiJa0TZZ0PDPfY9O3Sz8Dw.jpeg"/></div></div></figure><p id="e4c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了一个弹性IP，让我们将它与我们的实例关联起来。选择IP地址，然后点按“操作”，并选取“关联地址”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/275f8fe48f6213dd06739ce5cb690e3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1OHE6Pj5blfulZ4sA_myQg.jpeg"/></div></div></figure><p id="e0b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保选择了“实例”选项，然后单击下拉菜单。我们应该在那里看到我们的EC2实例ID。选择它，然后点按“关联”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/4def8c378f67ccb8f86e820f6a7a7051.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BPsnqYFA9WJl8T73SwyA0A.jpeg"/></div></div></figure><p id="ea3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功！现在我们将能够访问我们的VPN实例，让我们启动并运行我们的VPN服务。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6222" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">在EC2服务器上初始化OpenVPN</h1><p id="c467" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">首先，我们需要通过终端连接到EC2实例。我们将使用我们之前创建的私钥。</p><p id="9b6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开一个新的终端窗口，导航到包含私钥<code class="fe np nq nr ns b">.pem</code>文件的目录。我们需要设置它的权限:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="3fc6" class="nd me it ns b gy od oe l of og">sudo chmod 400 &lt;name&gt;.pem</span></pre><p id="5ffd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保用您的密钥名称替换<code class="fe np nq nr ns b">&lt;name&gt;</code>。</p><p id="0f7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这会将文件权限设置为<code class="fe np nq nr ns b">-r--------</code>，这样它只能被用户(您)读取。这可能有助于保护私钥免受其他用户的读写操作，但更确切地说，这将防止AWS在我们尝试连接到实例时抛出错误。</p><p id="e6e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以这样做，运行:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="160a" class="nd me it ns b gy od oe l of og">ssh -i &lt;name&gt;.pem openvpnas@&lt;elastic ip&gt;</span></pre><p id="ec27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户<code class="fe np nq nr ns b">openvpnas</code>由OpenVPN访问服务器设置，允许我们连接到我们的实例。用我们刚刚关联的弹性IP地址替换<code class="fe np nq nr ns b">&lt;elastic ip&gt;</code>。</p><p id="49b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可能会收到一条消息，说我们的主机的真实性无法建立。只要我们正确地输入了弹性IP，我们就可以对提示回答“是”。</p><p id="651a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在初始连接到OpenVPN实例时，应该会自动运行一个名为“初始配置工具”的设置向导。(如果由于某种原因它不工作，或者你慌乱地按了一个按钮，我们可以用<code class="fe np nq nr ns b">sudo ovpn-init –ec2</code>重启它。)我们将被要求接受协议，然后向导将帮助我们完成VPN服务器的一些配置设置。</p><p id="ff59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能通常会接受默认设置，但是，有几个问题您可能想明智地回答。它们是:</p><p id="cc0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">客户端流量是否应该默认通过VPN路由？</strong></p><p id="79b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么您可能想回答“是”:对该选项回答“是”可以防止<a class="ae ky" href="https://en.wikipedia.org/wiki/Split_tunneling" rel="noopener ugc nofollow" target="_blank">分割隧道</a>，这是一种当您连接到WiFi网络时可能绕过VPN的情况。</p><p id="54dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">客户端DNS流量是否应该默认通过VPN路由？</strong></p><p id="91ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么您可能想回答“是”:此设置可以通过指定DNS请求应该由VPN处理来帮助防止DNS泄漏。如果您对上一个问题回答“是”，则无论如何都会启用它。</p><p id="0a90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当被要求输入我们的“OpenVPN-AS许可证密钥”时，我们可以将其留空，以便在最多两个客户端上使用VPN。如果您已经购买了密钥，请在此输入。</p><p id="a493" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦配置向导运行完毕，我们应该会看到消息“初始配置完成！”在我们继续之前，我们应该为服务器的管理帐户设置一个密码。为此，请运行:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="04fe" class="nd me it ns b gy od oe l of og">sudo passwd openvpn</span></pre><p id="f8e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后输入您选择的密码两次。现在我们准备好连接了！</p><p id="2c68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要关闭ssh连接，请键入<code class="fe np nq nr ns b">exit</code>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="0f89" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">将客户端连接到VPN</h1><p id="b983" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">要将我们的客户机(在本例中是我们的笔记本电脑)连接到VPN并开始获益，我们需要做两件事；首先，获取我们的连接配置文件；其次，安装<code class="fe np nq nr ns b">openvpn</code>守护进程。</p><h2 id="16f4" class="nd me it bd mf ne nf dn mj ng nh dp mn li ni nj mp lm nk nl mr lq nm nn mt no bi translated">获取您的<code class="fe np nq nr ns b">.ovpn</code>连接档案</h2><p id="4d8e" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们需要为自己下载一个连接配置文件；这就像一个个人配置文件，其中包含VPN服务器允许我们连接所需的信息，包括密钥。我们可以使用刚刚在弹性IP地址943端口设置的密码登录。这看起来像:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="802f" class="nd me it ns b gy od oe l of og">https://&lt;elastic ip&gt;:943/</span></pre><p id="c035" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe np nq nr ns b">https</code>部分很重要；没有它，实例将不会发送任何数据。</p><p id="23f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们转到该URL时，我们可能会看到一个页面，警告我们该站点的证书颁发者未知或无效。只要我们正确地输入了我们的弹性IP，就可以安全地继续了。如果您使用的是Firefox，请点按“高级”，然后“接受风险并继续”在Chrome中，点击“高级”，然后“继续…”弹性IP。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/2336a672ed3f112807f1847af3d26269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lXB6XOEWggBGTxBBOC-R5Q.jpeg"/></div></div></figure><p id="a97a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用用户名<code class="fe np nq nr ns b">openvpn</code>和我们刚刚设置的密码登录。现在，我们将看到一个链接，用于下载我们的用户锁定连接配置文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/72c56c964895904e5b1b5f7d57a422ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*KIrkuUUnJ7yIq9uGJEEDyw.jpeg"/></div></figure><p id="e8bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们点击链接时，一个名为<code class="fe np nq nr ns b">client.ovpn</code>的文件将被下载。</p><h2 id="4f71" class="nd me it bd mf ne nf dn mj ng nh dp mn li ni nj mp lm nk nl mr lq nm nn mt no bi translated">2.在你的Ubuntu 18.04客户端上安装并启动<code class="fe np nq nr ns b">openvpn</code></h2><p id="1cb3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这个<code class="fe np nq nr ns b">openvpn</code>守护进程将允许我们的客户端连接到我们的VPN服务器。它可以通过默认的Ubuntu库安装。运行:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="b4c5" class="nd me it ns b gy od oe l of og">sudo apt install openvpn</span></pre><p id="2a2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了让OpenVPN在我们启动计算机时自动启动，我们需要重命名并移动连接配置文件。我建议使用<a class="ae ky" href="https://en.wikipedia.org/wiki/Symbolic_link" rel="noopener ugc nofollow" target="_blank">符号链接</a>来完成这项工作，因为它使我们的原始文件更容易编辑，并允许我们将它存储在我们选择的任何目录中。我们可以通过在文件所在的目录中运行以下命令来创建符号链接:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="41fc" class="nd me it ns b gy od oe l of og">sudo ln -s client.ovpn /etc/openvpn/&lt;name&gt;.conf</span></pre><p id="386f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在适当的文件夹中为连接概要文件创建一个符号链接，以便<code class="fe np nq nr ns b">systemd</code>找到它。<code class="fe np nq nr ns b">&lt;name&gt;</code>可以是任何东西。当Linux内核启动后，<code class="fe np nq nr ns b">systemd</code>用于初始化用户设置运行的服务和守护进程；其中之一就是OpenVPN。用扩展名<code class="fe np nq nr ns b">.conf</code>重命名文件会让<code class="fe np nq nr ns b">openvpn</code>守护进程知道使用它作为我们的连接文件。</p><p id="17ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以通过运行以下命令手动启动并连接到OpenVPN:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="976c" class="nd me it ns b gy od oe l of og">sudo openvpn --config client.ovpn</span></pre><p id="a441" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将被要求输入用户名和密码，这将是我们之前使用的相同凭证。一旦服务完成启动，我们将看到“初始化序列完成”如果我们现在访问<a class="ae ky" href="https://www.dnsleaktest.com/" rel="noopener ugc nofollow" target="_blank">DNS泄漏测试网站</a>，我们应该会看到弹性IP和EC2服务器的位置。耶！</p><p id="ad39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你使用的是更高版本的Ubuntu，你可以点击其中一个“测试”按钮来检查DNS漏洞。如果显示的所有ISP都是亚马逊的，没有一个是你自己的服务提供商，那么恭喜你！没有泄漏！您可以继续下面第二部分中的<a class="ae ky" href="#3-set-up-openvpn-as-networkmanager-system-connection" rel="noopener ugc nofollow">步骤3，之后，您就完成了。</a></p><p id="87f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，如果你使用的是Ubuntu 18.04 LTS版，我们还没有完成。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="5e18" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">DNS泄露看起来像什么</h1><p id="5c0d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">要查看DNS泄漏的情况，请点击<a class="ae ky" href="https://www.dnsleaktest.com/" rel="noopener ugc nofollow" target="_blank"> DNS泄漏测试页面</a>上的一个“测试”按钮。当我们这样做的时候，我们不仅会看到我们的Amazon.com IP地址，还会看到我们自己的ISP和位置。</p><p id="bb34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以通过在终端中运行<code class="fe np nq nr ns b">systemd-resolve --status</code>来查看泄漏。我们的结果将包含不同接口下的两行，这两行都有DNS服务器的条目。它看起来会像这样:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="d35b" class="nd me it ns b gy od oe l of og">Link 7 (tun0)<br/>Current Scopes: DNS<br/>LLMNR setting: yes<br/>MulticastDNS setting: no<br/>DNSSEC setting: no<br/>DNSSEC supported: no<br/>DNS Servers: 172.31.0.2<br/>DNS Domain: ~.</span><span id="ecd3" class="nd me it ns b gy oj oe l of og">Link 3 (wlp4s0)<br/>Current Scopes: none<br/>LLMNR setting: yes<br/>MulticastDNS setting: no<br/>DNSSEC setting: no<br/>DNSSEC supported: no<br/>DNS Servers: 192.168.0.1<br/>DNS Domain: ~.</span></pre><p id="2dc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Ubuntu 18.04 中的<a class="ae ky" href="https://unix.stackexchange.com/questions/434916/how-to-fix-openvpn-dns-leak" rel="noopener ugc nofollow" target="_blank"> DNS泄露问题源于Ubuntu的DNS解析器<code class="fe np nq nr ns b">systemd-resolved</code>，未能正确处理我们的OpenVPN配置。为了成为一个好的、高效的DNS解析器，<code class="fe np nq nr ns b">systemd-resolved</code>将并行发送DNS查询请求到每个有DNS服务器配置的接口，然后利用最快的响应。在我们的例子中，我们只想使用VPN的DNS服务器。不好意思，<code class="fe np nq nr ns b">systemd-resolved</code>。你尽力了。</a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="c60c" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">如何修复Ubuntu 18.04上的OpenVPN DNS漏洞</h1><p id="a708" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">幸运的是，我们可以实现一个修复。我们需要从Ubuntu库安装一些助手，更新我们的配置文件，然后使用NetworkManager设置OpenVPN。我们开始吧！</p><h2 id="d15f" class="nd me it bd mf ne nf dn mj ng nh dp mn li ni nj mp lm nk nl mr lq nm nn mt no bi translated">安装一些助手</h2><p id="c1e0" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为了正确整合OpenVPN和<code class="fe np nq nr ns b">systemd-resolved</code>，我们需要更多的帮助。在终端中，运行:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="24f5" class="nd me it ns b gy od oe l of og">sudo apt install -y openvpn-systemd-resolved network-manager-openvpn network-manager-openvpn-gnome</span></pre><p id="69ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将安装一个助手脚本，它集成了OpenVPN和<code class="fe np nq nr ns b">systemd-resolved</code>，一个用于OpenVPN的网络管理器插件，以及它的用于<a class="ae ky" href="https://www.gnome.org/" rel="noopener ugc nofollow" target="_blank"> GNOME </a>桌面环境的GUI副本。</p><h2 id="b3ff" class="nd me it bd mf ne nf dn mj ng nh dp mn li ni nj mp lm nk nl mr lq nm nn mt no bi translated">将DNS实现添加到您的连接配置文件</h2><p id="42c8" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们需要编辑之前下载的连接配置文件。因为它是象征性链接的，所以我们可以通过改变<code class="fe np nq nr ns b">.ovpn</code>文件来实现，不管它存储在哪里。运行<code class="fe np nq nr ns b">vim &lt;name&gt;.ovpn</code>在<a class="ae ky" href="https://www.vim.org/" rel="noopener ugc nofollow" target="_blank"> Vim </a>中打开它，然后在底部添加以下几行。评论中的解释:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="8950" class="nd me it ns b gy od oe l of og"># Allow OpenVPN to call user-defined scripts<br/>script-security 2</span><span id="ebc7" class="nd me it ns b gy oj oe l of og"># Tell systemd-resolved to send all DNS queries over the VPN<br/>dhcp-option DOMAIN-ROUTE .</span><span id="eb4f" class="nd me it ns b gy oj oe l of og"># Use the update-systemd-resolved script when TUN/TAP device is opened, and also run the script on restarts and before the TUN/TAP device is closed<br/>up /etc/openvpn/update-systemd-resolved<br/>up-restart<br/>down /etc/openvpn/update-systemd-resolved<br/>down-pre</span></pre><p id="68c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关OpenVPN选项的完整列表，请参见<a class="ae ky" href="https://openvpn.net/community-resources/reference-manual-for-openvpn-2-1/" rel="noopener ugc nofollow" target="_blank"> OpenVPN脚本和环境变量</a>。您可能也喜欢<a class="ae ky" href="https://en.wikipedia.org/wiki/TUN/TAP" rel="noopener ugc nofollow" target="_blank">更多关于TUN/TAP </a>的信息。</p><h2 id="e227" class="nd me it bd mf ne nf dn mj ng nh dp mn li ni nj mp lm nk nl mr lq nm nn mt no bi translated">将OpenVPN设置为NetworkManager系统连接</h2><p id="6a4c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们将使用GUI通过NetworkManager设置我们的VPN。打开网络设置，应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/5c1f81ca81885589c84af47a8b7c1be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ksUYDzcNuOkfboCJWlDbfw.png"/></div></div></figure><p id="1b5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后单击“+”按钮。在弹出的窗口上——与直觉相反——选择“从文件导入…”而不是OpenVPN选项。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/42700a080dfdec2444a095bea450a16e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*VCNONYBLlUJPCcxoo_K_-A.jpeg"/></div></figure><p id="fdb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导航到并选择您的<code class="fe np nq nr ns b">.ovpn</code>文件。我们现在应该看到类似这样的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/dfa82aa871e012e2d70892ef8a5d3881.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*7bWDMAaoQpGbVFHuVHyTqg.png"/></div></div></figure><p id="d2a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加您的服务器用户名和密码(<code class="fe np nq nr ns b">openvpn</code>和我们在第一部分的<a class="ae ky" href="#6222" rel="noopener ugc nofollow">第三步</a>中设置的密码)，以及您的用户密钥密码(同样的密码，如果您遵循了本教程)，然后单击“添加”按钮。</p><h2 id="b065" class="nd me it bd mf ne nf dn mj ng nh dp mn li ni nj mp lm nk nl mr lq nm nn mt no bi translated">编辑您的OpenVPN网络管理器配置</h2><p id="d967" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">快到了！既然我们已经将VPN添加为网络管理器连接，我们需要对它进行快速更改。我们可以通过运行以下命令来查看网络管理器连接列表:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="e149" class="nd me it ns b gy od oe l of og">ls -la /etc/NetworkManager/system-connections/*</span></pre><p id="0010" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的VPN可能叫做<code class="fe np nq nr ns b">openvpn</code>，所以让我们通过运行以下命令来编辑它:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="cca7" class="nd me it ns b gy od oe l of og">sudo vim /etc/NetworkManager/system-connections/openvpn</span></pre><p id="470f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe np nq nr ns b">[ipv4]</code>下面，我们需要添加一行<code class="fe np nq nr ns b">dns-priority=-42</code>。它最终应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/7ec70bbfc9da8d6f34bf009c966ee5a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*hZabEPZnvX0QtPL_XGrUqw.jpeg"/></div></figure><p id="b13d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置负数是一种解决方法，它会优先考虑此DNS服务器。实际数字是任意的(<code class="fe np nq nr ns b">-1</code>应该也可以)但是我喜欢42。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="84fd" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">重启，连接，盈利！</h1><p id="8309" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在终端中，运行:</p><pre class="kj kk kl km gt nz ns oa ob aw oc bi"><span id="0c89" class="nd me it ns b gy od oe l of og">sudo service network-manager restart</span></pre><p id="e017" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在网络设置中，单击打开VPN的神奇按钮:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/0efc470b25be2ccd2d97eccb09a2a2c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*KS1Sw5mLQfS4vTEf6m9N6Q.jpeg"/></div></figure><p id="381e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，访问<a class="ae ky" href="https://www.dnsleaktest.com/" rel="noopener ugc nofollow" target="_blank">DNS泄漏测试网站</a>并点击“扩展测试”以验证修复。如果一切正常，我们现在应该看到一个只包含我们的VPN ISP的列表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/510f34bfe570d7feb5a315355a6ddf7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32kXnMh5VmEQ2zLAOP6GuQ.png"/></div></div></figure><p id="4e2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们完事了。恭喜你拥有了自己的VPN服务器，并且用OpenVPN阻止了DNS泄露。享受(相对)隐私的网上冲浪。现在你在当地咖啡店唯一担心的是谁会坐在你后面看你冲浪。</p></div></div>    
</body>
</html>