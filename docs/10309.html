<html>
<head>
<title>Build an iOS Weather SwiftUI App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个iOS天气SwiftUI应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/simple-weather-app-with-swiftui-ac41200a9d4d?source=collection_archive---------0-----------------------#2021-12-26">https://betterprogramming.pub/simple-weather-app-with-swiftui-ac41200a9d4d?source=collection_archive---------0-----------------------#2021-12-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7797" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用tomorrow.io API显示当天的天气</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/40028bc1d7358256656a732299ef2c50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hHqmqssYJbcutHHPd7CcKA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:<a class="ae kv" href="https://undraw.co/" rel="noopener ugc nofollow" target="_blank"> undraw </a></p></figure><p id="82dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于我们公司最近的一次黑客马拉松，我们的团队决定在我们现有的iOS应用程序中添加一个手表应用程序。</p><p id="918f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的工作是集成一个第三方天气API，根据当天的天气为用户提供建议，并在手机和手表上显示每日通知。我们没有赢得黑客马拉松比赛，但这篇文章却诞生于此。</p><p id="bb9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本教程分为三个部分。下一部分的链接在最后。</p><p id="3b1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第一部分中，我将介绍如何将天气API与新的iOS应用程序集成在一起。在第二部分，我将向现有的iOS应用程序添加一个手表应用程序。第三部分将讨论手表连接以及在watchOS应用程序和iOS应用程序之间发送数据。</p><p id="7651" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将使用Xcode13.2和SwiftUI。</p><h1 id="ae3d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">选择第三方天气API</h1><p id="85f0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">第一步是找到适合你的API。我用<a class="ae kv" href="https://rapidapi.com/blog/access-global-weather-data-with-these-weather-apis/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>帮助我开始。从这篇文章开始，我选择看以下三个选项，直到我停在tomorrow.io。</p><ul class=""><li id="b20c" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">OpenWeatherMap有一个非常简单的API，很好的文档，也很容易实现。您只需要为自己生成API密钥，就可以开始了。然而，在撰写本文时，这个API不支持HTTPS请求，这是对我们的应用程序的否定。</li><li id="7ee8" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">DarkSky也有一个非常简单的API可以使用。然而不幸的是，在撰写本文时，他们已经不接受任何新的注册。他们加入了苹果公司，并将在2021年底停止支持他们的API。</li><li id="174f" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><a class="ae kv" href="https://app.tomorrow.io/home" rel="noopener ugc nofollow" target="_blank"> tomorrow.io </a>拥有强大的功能、文档和客户支持。他们也支持HTTPS。这对我们的应用程序来说有点大材小用，因为响应是一个嵌套的json，需要使用Swift的<code class="fe nd ne nf ng b">Codable</code>协议解析几个结构，但如果我们想扩展应用程序的功能，它会非常方便。他们有多种订阅选项，免费版本足以用于个人兼职项目/黑客马拉松。你每天会接到500个电话，一个用户和一个地点。</li></ul><p id="b9ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我将在本教程中使用tomorrow.io。</p><h1 id="795c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">创建新的Xcode项目</h1><p id="f4ed" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这一步我就不赘述了。<a class="ae kv" href="https://developer.apple.com/documentation/xcode/creating-an-xcode-project-for-an-app" rel="noopener ugc nofollow" target="_blank">这里</a>是苹果的文档，告诉你如果你需要的话，如何创建一个新的Xcode项目。</p><p id="cdeb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选择iOS应用模板，命名为“WeatherApp”，界面选择SwiftUI。选择一个文件夹来存储项目，Xcode应该会生成开始编写我们的应用程序所需的所有文件。您的项目结构应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/cab4889761dbcdb4c3b85aafc65ef3e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0t9c2NLvmVD5dlUweG6oSQ.png"/></div></div></figure><h1 id="b380" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">创建虚拟用户界面</h1><p id="ccdc" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们首先用硬编码的天气值创建一个虚拟UI，稍后我们将根据调用<code class="fe nd ne nf ng b">tomorrow.io</code>得到的结果更新这些值。将您的<code class="fe nd ne nf ng b">ContentView</code>替换为:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="333f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将创建一个垂直布局，我们将有两个主要部分。</p><p id="a3f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">顶部将包含当前天气的图标<em class="nk">(第4行)</em>，旁边是温度文本<em class="nk">(第6行)</em>。</p><p id="1f59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在那下面，我们将有一个建议文本<em class="nk">(第9行)</em>，它将根据天气而变化。</p><p id="be6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于天气图标，我使用的是苹果为你的应用程序提供的SF符号。您可以使用<a class="ae kv" href="https://developer.apple.com/sf-symbols/" rel="noopener ugc nofollow" target="_blank">这个应用程序</a>查看所有可用的符号。</p><p id="02a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您最终应该会看到以下用户界面:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/9ec5c2bc20597fe5fcc463468ad29bdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rTZS4hAzRyDHFoMlV-_zow.png"/></div></div></figure><p id="2a70" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将在Watch应用程序中重用相同的视图，所以现在让它保持简单。</p><h1 id="f7d3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">整合Tomorrow.io</h1><p id="e125" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在tomorrow.io上注册，然后去你的<a class="ae kv" href="https://app.tomorrow.io/development/keys" rel="noopener ugc nofollow" target="_blank">开发仪表板</a>获取你的访问密钥，并尝试一个示例API调用。您的仪表板应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/75b5c048e73cbe4d550c7666bcd18af4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h5maMLATlE0r3ahUjf_6hg.png"/></div></div></figure><p id="be07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">浏览他们的<a class="ae kv" href="https://docs.tomorrow.io/reference/key-concepts" rel="noopener ugc nofollow" target="_blank">文档</a>,了解使用tomorrow.io API还能获得哪些信息。</p><p id="5384" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于这个演示应用程序，您将使用<a class="ae kv" href="https://docs.tomorrow.io/reference/get-timelines" rel="noopener ugc nofollow" target="_blank">时间线API </a>，并且您只需要响应中当前小时的<code class="fe nd ne nf ng b">temperature</code>和<code class="fe nd ne nf ng b">weatherCode</code>字段。</p><p id="6802" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在此找到所有其他可用数据<a class="ae kv" href="https://docs.tomorrow.io/reference/data-layers-overview" rel="noopener ugc nofollow" target="_blank">。修改您的请求以包括<code class="fe nd ne nf ng b">weatherCode</code>字段，并限制当前小时只有1个值。请用您的访问密钥替换<code class="fe nd ne nf ng b">{$YOUR_KEY}</code>。最后的请求应该是:</a></p><pre class="kg kh ki kj gt nm ng nn no aw np bi"><span id="b2d8" class="nq lt iq ng b gy nr ns l nt nu"><a class="ae kv" href="https://api.tomorrow.io/v4/timelines?location=40.7579787,-73.9877313&amp;fields=temperature&amp;fields=weatherCode&amp;units=metric&amp;timesteps=1h&amp;startTime=2021-12-25T19:36:11Z&amp;endTime=2021-12-25T20:36:11Z&amp;apikey=2IG0jVndUp4wNRP2kEJUGb5chDLWPWsZ" rel="noopener ugc nofollow" target="_blank">https://api.tomorrow.io/v4/timelines?location=40.7579787,-73.9877313&amp;fields=temperature&amp;fields=weatherCode&amp;units=metric&amp;timesteps=1h&amp;startTime=2021-12-25T19:36:11Z&amp;endTime=2021-12-25T20:36:11Z&amp;apikey=</a>{$YOUR_KEY}</span></pre><p id="a556" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的浏览器中尝试一下。响应将是以下格式的JSON:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/83205a78d54001530339d737d671b75b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mUkZbyfD32n3gH-6kxGjHA.png"/></div></div></figure><p id="dccd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您已经准备好将API集成到您的应用程序中了。</p><h1 id="23d9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">向您的应用程序添加API客户端和响应模型</h1><p id="f246" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">由于我们只需要发出一种类型的请求，并且编写一个可伸缩的API客户端不是这个演示的目的，所以我们的API客户端将会非常简单。</p><p id="9aaf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于如何编写一个更加复杂和可扩展的API客户端的教程，请点击这个<a class="ae kv" href="https://medium.com/makingtuenti/writing-a-scalable-api-client-in-swift-4-b3c6f7f3f3fb" rel="noopener">链接</a>，它有点过时了，但是概念和架构仍然是相关的。这里有<a class="ae kv" href="https://medium.com/macoclock/swift-generic-api-854afdb9315e" rel="noopener">另一个好的</a>是最近的，使用了联合收割机。</p><p id="a7a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出于我们的目的，创建一个文件夹<code class="fe nd ne nf ng b">WeatherAPIClient</code>,存储所有与请求天气API的业务逻辑相关的文件。</p><p id="1042" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，让我们为响应创建模型。我们将使用<code class="fe nd ne nf ng b">Codable</code>协议对<a class="ae kv" href="https://www.avanderlee.com/swift/json-parsing-decoding/" rel="noopener ugc nofollow" target="_blank"> JSON进行解析</a>。</p><p id="72d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从上面的JSON中，我们需要检索<code class="fe nd ne nf ng b">temperature</code>和<code class="fe nd ne nf ng b">weatherCode</code>字段。其余的可以丢弃。</p><p id="9e2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在新文件夹中创建一个新的Swift文件，并将其命名为<code class="fe nd ne nf ng b">WeatherModel.swift</code>。用以下模型填充它:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="e839" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们可以创建API客户机本身，它将在请求成功完成时返回<code class="fe nd ne nf ng b">WeatherValue</code>。</p><p id="10f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在同一个文件夹中创建一个新文件<code class="fe nd ne nf ng b">WeatherAPIClient.swift</code>。填充下面的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="3739" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了进行API调用，我们需要用户的当前位置和按照API文档用<code class="fe nd ne nf ng b">ISO8601</code>格式格式化的<code class="fe nd ne nf ng b">startTime</code>。</p><p id="93b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我们需要一个位置管理器和一个日期格式化对象。我们在初始化时请求用户位置。稍后，每次用户位置更新时，我们都会请求天气更新。</p><p id="76b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据Apple文档，您需要将正确的密钥添加到您的<code class="fe nd ne nf ng b">info.plist</code>文件中:</p><blockquote class="nw nx ny"><p id="246d" class="kw kx nk ky b kz la jr lb lc ld ju le nz lg lh li oa lk ll lm ob lo lp lq lr ij bi translated">要准备您的应用程序调用<code class="fe nd ne nf ng b"><a class="ae kv" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1620562-requestwheninuseauthorization" rel="noopener ugc nofollow" target="_blank">requestWhenInUseAuthorization()</a></code>或<code class="fe nd ne nf ng b"><a class="ae kv" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1620551-requestalwaysauthorization" rel="noopener ugc nofollow" target="_blank">requestAlwaysAuthorization()</a></code>，您必须将带有目的字符串的密钥添加到您的应用程序的<code class="fe nd ne nf ng b">Info.plist</code>文件中。系统在授权请求对话框中显示您的目的字符串。</p></blockquote><p id="a5ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用Xcode 13生成的SwiftUI项目不会获得单独的<code class="fe nd ne nf ng b">info.plist</code>文件。相反，您可以使用目标设置的信息选项卡，如下所示。</p><p id="b652" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于我们的应用程序，我们只需要应用程序正在使用时的位置，所以添加<code class="fe nd ne nf ng b">NSLocationWhenInUseUsageDescription</code>键，并添加一个描述字符串，说明为什么您需要用户位置。</p><p id="217f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当向用户显示“位置授权许可”对话框时，将显示此文本。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/ee6406698b80e052a6a612e092b002e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1enHfvTi_O6zNMwiT-FTSg.png"/></div></div></figure><p id="5491" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了发出API请求，我们使用了URLSession和<a class="ae kv" href="https://docs.swift.org/swift-book/LanguageGuide/Concurrency.html" rel="noopener ugc nofollow" target="_blank"> async/await </a>来使语法更加清晰，使用了更少的闭包。</p><p id="2945" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">async</code>代表异步，用于定义函数正在执行异步工作。<code class="fe nd ne nf ng b">await</code>用于调用异步函数来标记执行暂停点。一旦<code class="fe nd ne nf ng b">async</code>函数与await返回相匹配，我们就从那一点继续执行。</p><p id="39c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我暂时没有处理这些错误。您可以决定在弹出窗口中向用户显示错误，或者根据需要对错误进行任何其他处理。</p><h1 id="80f5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">将模型连接到用户界面</h1><p id="6c11" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在我们需要将API请求的结果与我们的UI连接起来。</p><p id="220a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们需要将从<code class="fe nd ne nf ng b">tomorrow.io</code>接收的<code class="fe nd ne nf ng b">weatherCode</code>转换成我们的自定义enum，它将有一个图像和一个文本描述。</p><p id="173e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将以下内容添加到您的<code class="fe nd ne nf ng b">WeatherModel.swift</code>中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="f9f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加将在<code class="fe nd ne nf ng b">ContentView</code>内部使用的模型。将<code class="fe nd ne nf ng b">Weather</code>结构添加到<code class="fe nd ne nf ng b">WeatherModel.swift</code>中。</p><p id="7ddd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它需要符合<code class="fe nd ne nf ng b">Identifiable</code>协议，以便我们可以在API客户机中将它设置为一个发布变量，并在每次数据改变时更新UI。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="1151" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在更新<code class="fe nd ne nf ng b">WeatherAPIClient</code>类以符合<code class="fe nd ne nf ng b">ObservableObject</code>协议，并发布对<code class="fe nd ne nf ng b">weather</code>变量的更改。</p><p id="551a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另外，将<code class="fe nd ne nf ng b">WeatherAPIClient</code>类中的<code class="fe nd ne nf ng b">currentWeather</code>变量更新为<code class="fe nd ne nf ng b">@Published</code>属性包装器:</p><pre class="kg kh ki kj gt nm ng nn no aw np bi"><span id="0442" class="nq lt iq ng b gy nr ns l nt nu">@Published <strong class="ng ir">var</strong> currentWeather: Weather?</span></pre><p id="c85d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，您需要更新我们如何处理对API调用的响应。</p><p id="258e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要确保从响应中创建新的<code class="fe nd ne nf ng b">Weather</code>结构。</p><p id="9f16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为现在它是一个已发布的变量，所以我们需要在主队列上做这件事。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="19ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后<code class="fe nd ne nf ng b">WeatherAPIClient.swift</code>应该如下图所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="c75e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们需要更新我们的<code class="fe nd ne nf ng b">ContentView</code>来观察发布的变量，如果天气信息不可用，用<code class="fe nd ne nf ng b">Refresh</code>按钮显示一个默认视图。</p><p id="26bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您最终的<code class="fe nd ne nf ng b">ContentView.swift</code>代码应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="6d4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行中的iOS SwiftUI应用程序的输出是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/2572c529a353ead579c541d666da6dee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VsIiJnKkcnomOIa85jRqJg.png"/></div></div></figure><p id="9a65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您已经准备好运行应用程序了。最终结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/62375ad8d8b0e576be62c4858d47d315.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/1*zzP70xf3SRACq5fsSiiFQA.gif"/></div></figure><h1 id="8441" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="bf8c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在您有了一个与tomorrow.io集成的SwiftUI项目，可以获取当前位置的当前天气。</p><p id="74b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步将是为此应用程序创建一个配套的手表应用程序。你可以在下一个教程中完成。</p><p id="7f14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编码快乐！</p></div></div>    
</body>
</html>