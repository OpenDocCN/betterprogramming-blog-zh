<html>
<head>
<title>Deploy a Cost Effective Vue.js Web App on AWS With Terraform and GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Terraform和GitHub操作在AWS上部署一个经济高效的Vue.js Web应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deploy-a-cost-effective-vue-js-web-app-on-aws-with-terraform-and-github-actions-f84fb8df6d17?source=collection_archive---------5-----------------------#2022-08-03">https://betterprogramming.pub/deploy-a-cost-effective-vue-js-web-app-on-aws-with-terraform-and-github-actions-f84fb8df6d17?source=collection_archive---------5-----------------------#2022-08-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2c02" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Terraform、GitHub Actions、亚马逊S3和CloudFront走进一家酒吧</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/20511b319042f6370afe2bcf956b585f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vIIRwB9jRHwffMVQgDybNw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@timelabpro?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Timelab Pro </a>在<a class="ae kv" href="https://unsplash.com/s/photos/warehouse?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="436d" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="625c" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这篇文章是在我和我的队友讨论之后发表的。在我们的讨论中，我们试图找到在AWS上部署web应用程序的最佳解决方案，该方案使用Vue和React等框架，既高效又经济。</p><p id="45e9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">由于我正在准备<a class="ae kv" href="https://aws.amazon.com/certification/certified-solutions-architect-associate/" rel="noopener ugc nofollow" target="_blank"> AWS解决方案架构师助理认证</a>，我认为这是一个非常鼓舞人心和有益的机会来实践我所学的内容并巩固概念。</p><p id="3535" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们找到的解决方案是结合使用亚马逊S3和CloudFront。</p><p id="f124" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面是我试图通过一个小项目来表示所提出的解决方案。</p><p id="2586" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">项目的每个部分都是作为现实生活中的项目来构建的，因此Terraform被用作提供基础设施和资源的IAC工具，GitHub Actions被用于在项目中集成CI/CD概念。</p><p id="2912" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">接下来将快速解释一些概念，如Terraform、亚马逊S3和CloudFront。如果您已经熟悉它们，我建议您跳过这些部分，直接进入已实现工作流的演示。</p><p id="f573" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们开始吧！</p><h1 id="346a" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">先决条件</strong></h1><ul class=""><li id="70be" class="mp mq iq lq b lr ls lu lv lx mr mb ms mf mt mj mu mv mw mx bi translated"><a class="ae kv" href="https://aws.amazon.com/console/" rel="noopener ugc nofollow" target="_blank"> AWS </a>账户</li><li id="98aa" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><a class="ae kv" href="https://cloud.hashicorp.com/products/terraform" rel="noopener ugc nofollow" target="_blank">地形云</a>账号</li><li id="7752" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><a class="ae kv" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>账户</li><li id="376c" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">Terraform CLI </li><li id="0c5c" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">安装了Vue CLI</li></ul><h1 id="b702" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">什么是Terraform？</h1><p id="65cd" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这个世界上，当涉及到自动化和审查任务时，DevOps的作用越来越重要，IAC是DevOps带上的几个工具之一。IAC代表Infrastructure-As-Code，而<a class="ae kv" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a>(由<a class="ae kv" href="https://www.hashicorp.com/" rel="noopener ugc nofollow" target="_blank"> HashiCorp </a>开发的开源供应工具)允许您在人类可读的声明性配置文件中定义您的基础架构和资源，以及管理您的基础架构的生命周期。</p><p id="bc72" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">像对待代码一样对待您的基础设施:应用版本控制来跟踪您的变更，编写自动测试来避免错误，与您的合作者共享，并重用它们。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/cf7976b1fe8fae13c9dae10f73632420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XrXy7ya8mOAqyQhSPjLsCw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank">地形</a>由<a class="ae kv" href="https://www.hashicorp.com/" rel="noopener ugc nofollow" target="_blank">哈希公司</a></p></figure><p id="a8a0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Terraform是一个多云平台，所以它可以让你描述你的主要云提供商的完整基础设施，比如AWS、Azure、GCP等等。社区非常活跃，你可以找到很多模块，可以加快你的文件配置，防止你重新发明轮子。</p><p id="aaa3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Terraform模块将不同的资源封装到一个任务中，减少了您必须为类似的基础架构组件开发的代码量。</p><p id="734d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在部署基础设施和资源时，Terraform为您做的是将您的声明性代码翻译成提供者用来与指定资源交互的相应API。</p><p id="3543" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">主要的Terraform工作流程可以总结为三个步骤:<br/> 1。写:在配置文件中定义你的基础设施。<br/> 2。计划:审查Terraform将应用于您的基础架构的更改。<br/> 3。应用:Terraform将提供您的基础设施并更新状态。</p><p id="fd8f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在本文中，Terraform用于提供一个亚马逊S3桶，我们将在其中部署我们的Vue应用程序文件和CloudFront发行版，以潜在地将我们的工作分发到世界各地！</p><h1 id="e767" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">什么是亚马逊S3？</h1><blockquote class="ne"><p id="3fdd" class="nf ng iq bd nh ni nj nk nl nm nn mj dk translated"><a class="ae kv" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html" rel="noopener ugc nofollow" target="_blank">“亚马逊简单存储服务</a>(亚马逊S3)是一种对象存储服务，提供行业领先的可扩展性、数据可用性、安全性和性能。</p></blockquote><p id="98dc" class="pw-post-body-paragraph lo lp iq lq b lr no jr lt lu np ju lw lx nq lz ma mb nr md me mf ns mh mi mj ij bi translated">如<a class="ae kv" href="https://aws.amazon.com/s3/getting-started/" rel="noopener ugc nofollow" target="_blank">官方文档</a>中所述，AWS S3的一些优势包括:</p><ul class=""><li id="2b36" class="mp mq iq lq b lr mk lu ml lx nt mb nu mf nv mj mu mv mw mx bi translated">耐用性:S3提供99.999999999%的耐用性。</li><li id="b0c7" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">低成本:S3让您根据访问文件的频率和速度，将数据存储在不同的“存储类别”中。</li><li id="ae06" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">可伸缩性:S3只对你使用的资源收费(按使用付费)。</li><li id="3b23" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">可用性:S3提供99.99%的对象可用性。</li><li id="ddfd" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">安全性:S3提供不同的访问管理工具和加密功能，提供顶级的安全性。</li><li id="4e14" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">灵活性:S3是数据存储、数据备份、软件交付、数据归档、灾难恢复、网站托管、移动应用、物联网设备等广泛应用的理想选择。</li><li id="792f" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">简单的数据传输:这项服务围绕着简单和易用。</li></ul><h1 id="a341" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">什么是CloudFront？</h1><p id="d61f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/HowCloudFrontWorks.html" rel="noopener ugc nofollow" target="_blank"> AWS CloudFront </a>是亚马逊全球分发和提供的CDN(内容交付网络)，帮助用户快速请求数据，并具有低延迟网络。</p><p id="1cce" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">它主要用于传递静态内容，如。css，。js，。html和多媒体文件。</p><p id="769a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如前所述，CloudFront是一个遍布全球的网络，分布在世界各地的几个数据中心，称为edge location。</p><p id="8b8c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了保证最佳性能和最低延迟，当用户请求由CloudFront提供的内容时，它会找到地理上最近的边缘位置，该位置可以在速度和最低延迟方面提供最佳结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/12ee97b83cc3cc4391a959dd9ddbd050.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*k4PGxEElHOlA08G_.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">【CloudFront如何交付内容</p></figure><p id="e25f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">此外，CloudFront的一个有趣特性是，它可以在边缘位置缓存内容，从而减少工作量。在像S3这样的服务中(你不仅要为使用的空间付费，还要为与桶的交互付费)，它可以转化为与S3桶的交互次数的减少，从而为你省钱。</p><p id="0ae8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">其他功能包括指定地理目标以定义向特定最终用户的交付(黑名单与白名单)，它使用HTTP和HTTPS协议来交付您的内容，并且它是一种较便宜的服务，因为您将只对数据传输收费。</p><h1 id="da69" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">工作流程</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/a33c53ec1c63808c90c01581d551cbdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jr_WJchAc7y0auR-gVdY0g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">本文中实现的工作流的图形解释</p></figure><p id="ce67" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如上所述，主要思想是创建一个Terraform配置，以定义每次使用GitHub动作在GitHub上推送时将应用的基础设施。如果<code class="fe ny nz oa ob b">terraform plan</code>识别出与状态文件相比的任何变化。</p><p id="7207" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">正如我们将看到的，Terraform创建了亚马逊S3和CloudFront，以及必要的配置和依赖关系。</p><p id="3cf5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">web app是一个简单的Vue应用程序。每当我将一些很酷的东西放入我的存储库时，我的GitHub actions中的一个作业负责创建文件的最终版本，以便在生产中使用。然后，将它们上传到我的S3桶中——之前是用Terraform构建的——最后，这项工作将使CloudFront中的缓存无效，以便用户在下次请求时获得我的web应用程序的新版本。</p><h1 id="464b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">我们开始吧</h1><p id="da6a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">是时候把想法变成现实了。</p><p id="5b58" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们从Terraform开始，然后我们将进入GitHub操作，在那里魔法会成真！</p><p id="adef" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们可以添加和开发很多东西，也可以遵循其他最佳实践。这个项目应该被认为是一个惊人的起点。</p><p id="dd10" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们看一下项目结构。</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="ce4c" class="og kx iq ob b gy oh oi l oj ok">root/<br/>├── LICENSE<br/>├── README.md<br/>├── terraform/<br/>└── webapp/</span></pre><p id="373b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Terraform:它包含AWS基础设施和资源的定义。</p><p id="3129" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">webapp:包含vue应用。它是使用Vue CLI <code class="fe ny nz oa ob b">vue create webapp</code>创建的。</p><p id="78a8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">你可以在我的GitHub <a class="ae kv" href="https://github.com/anotherbuginthecode/terraform-deploy-vuejs-app-to-s3-and-cloudfront" rel="noopener ugc nofollow" target="_blank">上找到这个项目。</a></p><h1 id="5f67" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">将（行星）地球化（以适合人类居住）</h1><p id="704a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了部署我们的webapp，我们决定使用亚马逊S3和CloudFront。</p><p id="5e73" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们可以使用AWS控制台手动配置它们，但是假设这种方法是您的团队采用的主要策略，并且几乎每个新的web应用程序都需要使用这个堆栈进行部署。此外，假设您的团队领导要求您在生产环境中准备一个试运行环境。</p><p id="770c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在，作为新的业务要求，所有网站都应该记录与web应用程序的每次交互，并在出现特定错误模式时触发一个事件。啊！我提到过我们需要改变CloudFront中的最小缓存持续时间和默认标签吗？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/94b3287f153487ed578bbdf36e65aaf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MxbJMDDC_1_oy5QUs3haoA.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">手动完成所有改动后疲惫的海绵宝宝</p></figure><p id="930c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">像Terraform这样的IAC工具，结合远程后端和版本控制，可以帮助您控制所有产品的所有更改，并在不失去理智的情况下传播更新。此外，使用Terraform module，您可以部署一个完全可用的基础架构，减少您和开发人员的工作量，从而缩短上市时间。</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="752c" class="og kx iq ob b gy oh oi l oj ok">terraform<br/>├── backend.tf<br/>├── cloudfront.tf<br/>├── provider.tf<br/>├── s3.tf<br/>├── terraform.tfvars<br/>└── variables.tf<br/></span></pre><p id="5837" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这些是terraform文件夹中的文件。我喜欢将所有资源分开。它帮助我保持井井有条，并且易于维护。即使项目很小，我也强迫自己不要把所有东西都写在一个唯一的<code class="fe ny nz oa ob b">main.tf</code>里。</p><h2 id="3917" class="og kx iq bd ky om on dn lc oo op dp lg lx oq or li mb os ot lk mf ou ov lm ow bi translated">后端. tf</h2><p id="d9a2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这里，我告诉Terraform它必须在哪里存储我的基础设施的状态。在这种情况下(99%的情况下)，我使用S3后端将我的terraform配置的状态存储在由环境或工作空间分隔的S3存储桶中。</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="50fa" class="og kx iq ob b gy oh oi l oj ok">terraform {<br/>backend "s3" {<br/>bucket     = "&lt;YOUR-S3-BACKEND-BUCKET&gt;"<br/>key        = "&lt;S3-KEY-PATH&gt;/terraform.tfstate"<br/>region     = var.region<br/>access_key = var.access_key<br/>secret_key = var.secret_key<br/>}<br/>}</span></pre><p id="c01f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><code class="fe ny nz oa ob b">region</code>、<code class="fe ny nz oa ob b">access_key</code>、<code class="fe ny nz oa ob b">secret_key</code>是在<code class="fe ny nz oa ob b">variables.tf</code>内部定义并在<code class="fe ny nz oa ob b">terraform.tfvars</code>内部初始化的变量。这最后一个文件是我初始化变量和秘密的地方。将此文件添加到您的。gitignore以避免在线发布您的凭据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Terraform配置中变量的定义。sensitive = true避免在状态文件中显示变量值。</p></figure><h2 id="3b19" class="og kx iq bd ky om on dn lc oo op dp lg lx oq or li mb os ot lk mf ou ov lm ow bi translated"><strong class="ak"> provider.tf </strong></h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="87fb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">提供者文件告诉Terraform应该与哪个提供者进行交互。</p><p id="4960" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">大多数情况下，当您定义一个提供者时，您应该传递必要的配置以允许与之交互。在这种情况下，我必须声明区域、标识我的AWS帐户的凭证以及允许在我的帐户内创建资源的用户。对我来说，它是我之前使用<a class="ae kv" href="https://aws.amazon.com/iam/" rel="noopener ugc nofollow" target="_blank"> AWS IAM </a>用管理员权限创建的Terraform用户。</p><p id="ebd2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">此外，我认为定义<code class="fe ny nz oa ob b">default_tags</code>有助于在使用成本浏览器工具时保持所有资源的一致性和易于搜索。</p><h2 id="bf8f" class="og kx iq bd ky om on dn lc oo op dp lg lx oq or li mb os ot lk mf ou ov lm ow bi translated"><strong class="ak"> s3.tf </strong></h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="d69b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在<code class="fe ny nz oa ob b">s3.tf</code>文件中，我们定义了我们的bucket。由于我们将在桶中托管一个静态网站，我们需要将其设置配置为静态网站托管。如第21–33行所示，我们必须指定当用户导航到我们的静态网页时将被服务的<code class="fe ny nz oa ob b">index_document</code>和<code class="fe ny nz oa ob b">error _document</code>。</p><p id="327a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">另一个需要设置的是OAI(原始访问身份)，这是一个与我们的发行版相关联的特殊的CloudFront用户。它只允许用户通过CloudFront访问你的文件，而不是通过一个直接指向S3的URL。这可能发生在创建OAI用户时，附加一个只允许在我们的S3 bucket上执行<code class="fe ny nz oa ob b">s3:GetObject</code>的策略，最后，将这个策略添加到我们的bucket <code class="fe ny nz oa ob b">policies.geo-restrictionsgeodomain-restrictions</code>。</p><h2 id="fd45" class="og kx iq bd ky om on dn lc oo op dp lg lx oq or li mb os ot lk mf ou ov lm ow bi translated">cloudfront.tf</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="8eb5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们定义一下我们的CloudFront分布。为此，我们需要将s3 bucket指定为源域名。然后，在s3配置中将之前设置的<code class="fe ny nz oa ob b">default_root_document</code>定义为<code class="fe ny nz oa ob b">index_document</code>。</p><p id="18ed" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">正如CloudFront部分所解释的，有趣的特性之一是它可以在边缘位置缓存内容，从而减少工作量。在我们的例子中，我们保持它相当标准，告诉我们的发行版缓存所有内容写<code class="fe ny nz oa ob b">path_pattern = “*”</code>。最终，您可以在不同的路径上指定几个缓存行为，复制并粘贴<code class="fe ny nz oa ob b">ordered_cache_behavior</code>语句。</p><p id="defe" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">此外，您可以创建一个允许列表，以使您的用户仅在您的允许列表中的批准国家/地区之一时才能访问您的内容。同样，您可以指定一个阻止列表，以拒绝您的用户访问您的内容，如果他们在您的允许列表上的黑名单国家之一。</p><p id="8ef1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">CloudFront的边缘位置遍布世界各地，按地理区域分组。我们可以指定使用哪组位置来发布我们的文件。为此，我们需要选择一个<code class="fe ny nz oa ob b">price_class</code>。在我们的例子中，它等于<code class="fe ny nz oa ob b">PriceClass_200</code>。</p><p id="24ed" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">关于哪些不同的<code class="fe ny nz oa ob b">price_class</code>标识的完整解释可以在<a class="ae kv" href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/PriceClass.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。请记住，选择较低的<code class="fe ny nz oa ob b">price_class</code>，例如<code class="fe ny nz oa ob b">PriceClass_100</code>，并不意味着该覆盖区域之外的用户无法访问该网站，但他们会经历一些响应延迟，因为他们将由<code class="fe ny nz oa ob b">price_class</code>内最近的边缘位置提供服务。</p><p id="54ba" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，我们指定输出语句来查看哪个将是从AWS生成并可从外部访问的CloudFront URL。下一步，您可以将此URL作为记录添加到Route53中，以将您的网站附加到您的域名。</p><h1 id="3378" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">GitHub操作</h1><p id="e978" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">不错！我们已经准备好了我们的Vue应用，并且我们已经使用Terraform定义了我们的基础设施。现在，是时候使用GitHub Actions将这些点连接起来并创建一个CI/CD管道了。</p><blockquote class="ne"><p id="4ed1" class="nf ng iq bd nh ni nj nk nl nm nn mj dk translated"><a class="ae kv" href="https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions" rel="noopener ugc nofollow" target="_blank"> "GitHub Actions </a>是一个持续集成和持续交付(CI/CD)平台，允许您自动化您的构建、测试和部署管道。您可以创建工作流，为您的存储库构建和测试每个“拉”请求，或将合并的“拉”请求部署到生产环境中。”</p></blockquote><p id="34d2" class="pw-post-body-paragraph lo lp iq lq b lr no jr lt lu np ju lw lx nq lz ma mb nr md me mf ns mh mi mj ij bi translated">在我们的根文件夹下创建文件夹<code class="fe ny nz oa ob b">.github/workflows</code>这里是动作所在的地方，定义为YAML文件。</p><p id="c8a3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们如下创建我们的<code class="fe ny nz oa ob b">deploy-to-aws.yml</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="9d35" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们可以看到，我们有两个主要的工作:Terraform和Webapp。</p><p id="2bb9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Terraform负责提供基础设施，并在与状态文件有差异时对其进行更新。</p><p id="795d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">地形作业的主要阶段是:</p><ul class=""><li id="6ab2" class="mp mq iq lq b lr mk lu ml lx nt mb nu mf nv mj mu mv mw mx bi translated">设置:安装Terraform CLI并连接到Terraform Cloud。如果你只是一个用户，Terraform Cloud是免费的，可以让你轻松地将工具集成到你的行动中。您需要提供GitHub操作<code class="fe ny nz oa ob b">TF_API_TOKEN</code>，您可以在<a class="ae kv" href="https://cloud.hashicorp.com/products/terraform" rel="noopener ugc nofollow" target="_blank"> Terraform Cloud </a>上创建帐户后创建该操作。</li><li id="ea55" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">Init:在创建后端变量之后，我们运行<code class="fe ny nz oa ob b">terraform init</code>将应用程序的结果存储在我们的远程状态中，并下载必要的模块和依赖项来执行tf文件。</li><li id="e1d4" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">格式和语法检查:<code class="fe ny nz oa ob b">terraform fmt</code>命令用于将Terraform配置文件重写为规范的格式和样式。</li><li id="1870" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">应用:一切正常后，我们可以将我们的更改应用到基础设施中。</li><li id="1029" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">输出有用的变量:我们需要存储<code class="fe ny nz oa ob b">CLOUDFRONT_DISTRIBUTION</code>和<code class="fe ny nz oa ob b">BUCKET_NAME</code>的地形输出，供下面的作业动态使用。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/8d18267bab0d24216e1b62b58d2c4a3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PXgdAtDZbft98EYSDgaanQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">应用程序的结果和生成的输出。</p></figure><p id="376b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Webapp负责完成以下工作:</p><ul class=""><li id="2e78" class="mp mq iq lq b lr mk lu ml lx nt mb nu mf nv mj mu mv mw mx bi translated">构建我们的Vue应用程序，生成一个包含构建结果的<code class="fe ny nz oa ob b">dist/</code>文件夹。</li><li id="b164" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">将<code class="fe ny nz oa ob b">dist/</code>文件夹中的所有文件上传到我们的S3桶中。</li><li id="e485" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">使CloudFront缓存无效，以确保用户一旦向我们的CloudFront执行新的请求，就会收到新版本的应用程序。</li></ul><p id="935d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">总之，作为最佳实践，最好将敏感信息如<code class="fe ny nz oa ob b">AWS_ACCESS_KEY_ID</code>和<code class="fe ny nz oa ob b">AWS_SECRET_ACCESS_KEY</code>放在GitHub secrets下面，嗯，保密。<a class="ae kv" href="https://docs.github.com/en/actions/security-guides/encrypted-secrets" rel="noopener ugc nofollow" target="_blank">这里的</a>是怎么做到的。一旦创建完毕，您就可以在您的操作中以<code class="fe ny nz oa ob b">${{ secrets.MY_SECRET }}</code>的身份访问它们。</p><p id="013e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在一切都设置好了，您的GitHub操作应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/b4ced5bbf077bd6b12ad54edfe89955e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xo8Ca1G3UKPk6Bd0MllxOQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">您的操作的GUI结果在GitHub的action选项卡下。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/864ec8fa60dabed43f96969efe102f43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZXKfEVRSRIKSbryCP8RbAw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由Terraform创建的CloudFront服务</p></figure><p id="2160" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当操作完成时，您要做的就是导航到您的由AWS生成的CloudFront URL(在我们的例子中，是Terraform输出<code class="fe ny nz oa ob b">cloudfront_domain_name</code>的结果),并为您今天所取得的成就感到自豪！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/1ca451f7995e6cbc9148ed165959f846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LCqsPiz3qmt8mi-wX2JcXA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的webapp在CloudFront URL下运行。</p></figure><h1 id="5cef" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">最后的话</h1><p id="2fb4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们已经把所有的点连接起来了！每当我们在主节点上推送任何更改时，都会触发该操作，我们的更新将被部署到AWS中。如果我们的AWS帐户中还没有基础设施，Terraform将为我们创建一个，您的web应用程序的新版本将自动部署到我们的S3存储桶中。由于CloudFront，它将被传送到世界各地。很棒，对吧？</p><blockquote class="pc pd pe"><p id="edb3" class="lo lp pf lq b lr mk jr lt lu ml ju lw pg mm lz ma ph mn md me pi mo mh mi mj ij bi translated">“你们才是真正的英雄！”— Homelander，男孩们</p></blockquote><p id="cf34" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">希望你觉得这个小项目有用。有很大的改进空间，但这是主要思想。</p><p id="9fc5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">请在评论中告诉我你的想法！下次实验再见！</p><h1 id="df81" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">有用的链接</h1><div class="pj pk gp gr pl pm"><a href="https://github.com/anotherbuginthecode/terraform-deploy-vuejs-app-to-s3-and-cloudfront" rel="noopener  ugc nofollow" target="_blank"><div class="pn ab fo"><div class="po ab pp cl cj pq"><h2 class="bd ir gy z fp pr fr fs ps fu fw ip bi translated">GitHub-another bug in the code/terra form-deploy-vuejs-app-to-S3-and-cloudfront:terra form项目to…</h2><div class="pt l"><h3 class="bd b gy z fp pr fr fs ps fu fw dk translated">Terraform项目在aws上提供s3 bucket和cloudfront，其中将托管一个用vuejs3制作的静态网站…</h3></div><div class="pu l"><p class="bd b dl z fp pr fr fs ps fu fw dk translated">github.com</p></div></div><div class="pv l"><div class="pw l px py pz pv qa kp pm"/></div></div></a></div><div class="pj pk gp gr pl pm"><a href="https://www.terraform.io/intro" rel="noopener  ugc nofollow" target="_blank"><div class="pn ab fo"><div class="po ab pp cl cj pq"><h2 class="bd ir gy z fp pr fr fs ps fu fw ip bi translated">哈希公司的Terraform | Terraform是什么</h2><div class="pt l"><h3 class="bd b gy z fp pr fr fs ps fu fw dk translated">搜索Terraform文档HashiCorp Terraform是一个基础架构代码工具，可让您定义云…</h3></div><div class="pu l"><p class="bd b dl z fp pr fr fs ps fu fw dk translated">www.terraform.io</p></div></div><div class="pv l"><div class="qb l px py pz pv qa kp pm"/></div></div></a></div><div class="pj pk gp gr pl pm"><a href="https://aws.amazon.com/cloudfront/" rel="noopener  ugc nofollow" target="_blank"><div class="pn ab fo"><div class="po ab pp cl cj pq"><h2 class="bd ir gy z fp pr fr fs ps fu fw ip bi translated">低延迟内容交付网络(CDN) -亚马逊CloudFront -亚马逊网络服务</h2><div class="pt l"><h3 class="bd b gy z fp pr fr fs ps fu fw dk translated">Amazon CloudFront 1 TB的数据传输量通过分布在全球各地的410多个点交付数据，减少了延迟…</h3></div><div class="pu l"><p class="bd b dl z fp pr fr fs ps fu fw dk translated">aw.amazon.com</p></div></div><div class="pv l"><div class="qc l px py pz pv qa kp pm"/></div></div></a></div><div class="pj pk gp gr pl pm"><a href="https://aws.amazon.com/s3/" rel="noopener  ugc nofollow" target="_blank"><div class="pn ab fo"><div class="po ab pp cl cj pq"><h2 class="bd ir gy z fp pr fr fs ps fu fw ip bi translated">云对象存储-亚马逊S3 -亚马逊网络服务</h2><div class="pt l"><h3 class="bd b gy z fp pr fr fs ps fu fw dk translated">亚马逊S3 5gb S3标准存储亚马逊简单存储服务(亚马逊S3)是一种对象存储服务，提供…</h3></div><div class="pu l"><p class="bd b dl z fp pr fr fs ps fu fw dk translated">aws.amazon.com</p></div></div><div class="pv l"><div class="qd l px py pz pv qa kp pm"/></div></div></a></div><div class="pj pk gp gr pl pm"><a href="https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions" rel="noopener  ugc nofollow" target="_blank"><div class="pn ab fo"><div class="po ab pp cl cj pq"><h2 class="bd ir gy z fp pr fr fs ps fu fw ip bi translated">了解GitHub操作- GitHub文档</h2><div class="pt l"><h3 class="bd b gy z fp pr fr fs ps fu fw dk translated">GitHub Actions是一个持续集成和持续交付(CI/CD)平台，允许您自动化您的…</h3></div><div class="pu l"><p class="bd b dl z fp pr fr fs ps fu fw dk translated">docs.github.com</p></div></div><div class="pv l"><div class="qe l px py pz pv qa kp pm"/></div></div></a></div></div></div>    
</body>
</html>