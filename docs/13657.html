<html>
<head>
<title>How To Send HL7 v2 Messages to AWS SQS From Mirth Connect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从“欢乐连接”向SQS自动气象站发送HL7 v2消息</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/sending-hl7-v2-messages-to-aws-sqs-from-mirth-connect-a7f0e467b241?source=collection_archive---------11-----------------------#2022-09-14">https://betterprogramming.pub/sending-hl7-v2-messages-to-aws-sqs-from-mirth-connect-a7f0e467b241?source=collection_archive---------11-----------------------#2022-09-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="36c6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从静态Rhino JavaScript上下文调用AWS Java SDK</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/67f9321aa6a36ed829186002f20fd336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F-IJ41VjPpA45IVeGJemTg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="86a9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当使用HL7 v2和诸如亚马逊SQS这样的网络服务时，我通常会选择<a class="ae lr" href="https://medium.com/towards-data-science/sending-hl7-v2-messages-with-hasura-hapi-and-serverless-9cd1630876a4" rel="noopener">无服务器HAPI </a>作为轻量级接口选项。但是最近，我接手了一个项目，该项目已经广泛使用了Johnny Connect，因此坚持使用它来处理传入的HL7 v2，然后将转换后的JSON消息发送到目的地SQS队列是有意义的。</p><p id="12c8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这篇文章中，我将概述我们如何设置它(TL；DR grab the Johnny<a class="ae lr" href="https://gist.github.com/s1monj/969be43e5fe817c9ff6e578aac8f8123" rel="noopener ugc nofollow" target="_blank">channel XML</a>)，为了简单起见，我们将把ER7(管道分隔)HL7 v2源消息作为磁盘上的文本文件，并使用Mirth File Reader连接器将其拉入。</p><h1 id="dd81" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">第一个想法:API网关</h1><p id="d0e6" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">我是AWS API网关的忠实粉丝，我最初的想法是轻松地使用HTTP发送者目的地连接器，并简单地将消息体通过HTTP发送到<a class="ae lr" href="https://medium.com/@pranaysankpal/aws-api-gateway-proxy-for-sqs-simple-queue-service-5b08fe18ce50" rel="noopener"> API网关SQS代理</a>。这本来可以快速设置并易于测试和故障排除，但是客户没有API Gateway的经验，除非绝对必要，否则不愿意开始使用额外的AWS服务。公平的决定。</p><h1 id="c36d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">第二个想法:JavaScript + HTTP发送器</h1><p id="e4c2" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">对于没有特定性能需求的敏捷集成开发，轻量级脚本语言总是我比编译型编程语言更喜欢的选择，我唯一比JavaScript更喜欢的就是TypeScript。不幸的是，JavaScript的joyful Rhino实现不支持Node.js，因此不能处理包，也不支持Web浏览器特性，因此不能获取带有<code class="fe mp mq mr ms b">&lt;script src="...</code>标签的附加库。</p><p id="5ff9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这样做的结果是，如果我们想在hayway JavaScript运行时中包含JavaScript依赖库，我们需要粘贴每个依赖的源代码，或者从Transformer步骤中引用每个文件，对于像AWS SDK这样大的库来说，这是不切实际的。</p><p id="43d9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="mt">好吧，如果我不能使用AWS SDK，也许我可以手动创建头部，签署请求并将其传递给HTTP发送者目的地连接器？</em></p><p id="163f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我通过粘贴<a class="ae lr" href="https://code.google.com/archive/p/crypto-js/downloads" rel="noopener ugc nofollow" target="_blank"> crypto-js </a>代码并遵循<a class="ae lr" href="https://docs.aws.amazon.com/general/latest/gr/signature-v4-examples.html#signature-v4-examples-javascript" rel="noopener ugc nofollow" target="_blank"> AWS指令</a>创建了一个签名密钥。这一切都很好地结合在一起，我能够将一个工作的AWS SigV4 <code class="fe mp mq mr ms b">Authentication</code> header传递给happy。然而，当您尝试使用AWS的<a class="ae lr" href="https://docs.aws.amazon.com/general/latest/gr/sigv4-signed-request-examples.html" rel="noopener ugc nofollow" target="_blank">有据可查的</a>但极其复杂的过程来手动签署请求时，真正的乐趣就开始了。五分钟后我放弃了。</p><h1 id="8c33" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">好吧，那就Java吧</h1><p id="1778" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">是咬紧牙关的时候了。我的最终解决方案的大纲如下。</p><h2 id="c7c4" class="mu lt iq bd lu mv mw dn ly mx my dp mc le mz na me li nb nc mg lm nd ne mi nf bi translated">第一步:让AWS SDK JARs充满欢乐</h2><p id="28d1" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">在目标机器上创建一个Maven <code class="fe mp mq mr ms b">pom.xml</code>文件，并在下面添加源代码。顾名思义，<code class="fe mp mq mr ms b">jar-with-dependencies</code>插件抛出一个包含所有依赖项的JAR。运行<code class="fe mp mq mr ms b">mvn clean package</code>，然后将<code class="fe mp mq mr ms b">./target/awslibs-1.0-SNAPSHOT-jar-with-dependencies.jar</code>复制到欢乐定制lib dir(在我的例子中，它是<code class="fe mp mq mr ms b">/opt/mirthconnect/custom-lib</code>)。现在一定要重新开始欢笑。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="e1d2" class="mu lt iq bd lu mv mw dn ly mx my dp mc le mz na me li nb nc mg lm nd ne mi nf bi translated">第二步:创建欢乐频道</h2><p id="19ff" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">设置入站和出站数据类型(我通常使用Raw进行出站，以查看测试时发生了什么)，并使用文件读取器源。我们可以简单地在目的地的JavaScript Writer连接器中添加一个日志语句。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/13dd3a91f471f665c9c3335eca32c677.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C21N8ZrHZMva2yl4PNAFNw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">欢乐频道数据类型(图片由作者提供)</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/2ae13aa0361116dcf1c3a1e850389915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-peqQnDyAQ-2fXMaQwSh7A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">欢乐频道来源(图片由作者提供)</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/4b6ed862836633c9339db8474f10ec8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wQwdwPuHmHCocEGiLcWOpA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">欢乐频道目的地(图片由作者提供)</p></figure><h2 id="1c38" class="mu lt iq bd lu mv mw dn ly mx my dp mc le mz na me li nb nc mg lm nd ne mi nf bi translated">步骤3:创建SQS队列</h2><p id="5f74" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">对于这个项目，我们使用了一个FIFO队列，唯一需要注意的配置是打开基于内容的重复数据删除，因此您不必在请求中使用重复数据删除id。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/d3fcc8855aee1edd1bf130a1fc539ecb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sqUiGapVakKu9o_wQ74ELA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">亚马逊SQS FIFO队列配置(图片由作者提供)</p></figure><h2 id="6f49" class="mu lt iq bd lu mv mw dn ly mx my dp mc le mz na me li nb nc mg lm nd ne mi nf bi translated">第四步:从欢笑中传递SQS信息</h2><p id="a479" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">回到通道配置的源代码，编辑转换器，并创建一个新的JavaScript步骤。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/20a0e7ff21cdfd705928e5a88da79a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X8hscjcjnDEKJ-70q1jwKQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">欢笑源转换步骤(图片由作者提供)</p></figure><p id="c9b9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我有很多使用各种语言的AWS SDK的经验，但是在静态上下文中从Rhino JavaScript引擎调用Java SDK完全不同于我以前编写的任何代码。如果不是Vibinchander的博客<a class="ae lr" href="http://vibinchander.com/2022/06/14/read-aws-s3-bucket-using-mirth-aws-sdk-2-19-x-version/" rel="noopener ugc nofollow" target="_blank">中的一篇文章</a>让我走上了正确的道路，我根本不可能解决这个问题。所以要感谢Vibinchander，你应该看看他的博客，了解更多伟大的集成技巧。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="1156" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">保存了我们的转换器，重新部署了我们的通道，再加上一点运气，我们现在应该能够将一个HL7 v2 ER7格式的消息文本文件放入文件阅读器目录，然后在我们的SQS队列中看到JSON消息。</p><p id="a5ad" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">排队快乐！</p><pre class="kg kh ki kj gt nn ms no np aw nq bi"><span id="b3ba" class="mu lt iq ms b gy nr ns l nt nu"><strong class="ms ir">Want to Connect?</strong></span><span id="5fc1" class="mu lt iq ms b gy nv ns l nt nu">If you need assistance or want more reading on healthcare interoperability and integration, head over to <a class="ae lr" href="https://whitebrick.com" rel="noopener ugc nofollow" target="_blank">whitebrick.com</a> and don’t hesitate to reach out.</span></pre></div></div>    
</body>
</html>