<html>
<head>
<title>4 Limitations of UIActivityViewController for iOS Sharing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">4用于iOS共享的UIActivityViewController的限制</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/4-limitations-of-uiactivityviewcontroller-for-ios-sharing-ef88c886ba81?source=collection_archive---------6-----------------------#2022-04-20">https://betterprogramming.pub/4-limitations-of-uiactivityviewcontroller-for-ios-sharing-ef88c886ba81?source=collection_archive---------6-----------------------#2022-04-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1273" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">分享特定应用程序的不同内容，在预定义的iOS列表之外处理<code class="fe ki kj kk kl b">activity types</code>,等等</h2></div><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/0d57f4f31f023ce57d150fc1bd9fe961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*GnUXSRIXDJ3vAvwF7Mp-9g.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=2187996" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>提供</p></figure><p id="16c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将看看iOS内容共享，以了解<code class="fe ki kj kk kl b">UIActivityViewController</code>的挑战和局限性。</p><p id="58da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个类提供了几个标准服务，比如将项目复制到粘贴板，将内容发布到社交媒体站点，通过电子邮件或SMS发送项目，等等。</p><p id="efb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看它的实际应用:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="4b77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这看起来很简单，只有2行代码。</p><p id="0376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为输入，该视图控制器接收我们想要共享的项目列表，默认情况下，我们获得对文本、图像和任何其他类型的URL的支持，您需要自定义支持。</p><p id="7c85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，出现了一个模态视图控制器，它显示系统中的所有应用程序，能够与您的给定内容共享或执行某些操作，在我们的示例文本中，输出如下:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/b1dffd63a2988dc17f13a194bfb66bd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*FX_Az3vGO0QPvUKa96x_Tw.png"/></div></figure><p id="b617" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，一切看起来简单明了，如果你只是想分享一些内容，如文本或图像，那么你不需要任何其他东西。但是，如果你想为特定的应用程序提供不同的内容，事情可能会变得有点糟糕。</p><h1 id="8142" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">1.共享特定应用的不同内容</h1><p id="f2f1" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ms lk ll lm mt lo lp lq mu ls lt lu im bi translated">例如，如果你想分享一些文本，但对于邮件应用程序，你打算分享HTML，因为它看起来更好，更专业。</p><p id="1d32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要做到这一点，你必须遵从<code class="fe ki kj kk kl b">UIActivityItemSource</code>并实施<code class="fe ki kj kk kl b">itemForSourceType</code>方法。</p><p id="40bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果举上面的例子，事情会是这样的:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="bcf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们实现了我们的委托方法。但是等一下！如果我们在当前状态下运行代码，我们仍然不能在邮件应用程序上显示HTML。</p><p id="b71a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那是因为我们没有设置<code class="fe ki kj kk kl b">UIActivityViewController</code>委托，这里的问题是这个视图控制器没有这样的属性可用。</p><p id="92a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是我们有一个快速和肮脏的方法来设置它，这很奇怪，这就是为什么我把它标记为一个潜在的挑战。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="892d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面的代码片段中可以看出，我们将委托作为共享项目列表中的一个项目进行传递，这应该可以解决我们的问题。请注意，我们有一个更好的方法来设置这个委托，我将在本文的后面谈到，但是如果你想要非常简单快捷的东西，这个方法可以是一个解决方案。</p><h1 id="3065" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">2.共享特定应用时移除项目</h1><p id="8ca5" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ms lk ll lm mt lo lp lq mu ls lt lu im bi translated">默认情况下，通过活动视图控制器init传递的所有项目会连接在一起，然后传递到共享应用程序。在这种情况下，我们不希望一些特定的应用程序分享我们面临的所有挑战。</p><p id="cdc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，假设我们想要共享一个文本和一个图像，但是对于邮件应用程序，我们只想要共享HTML。</p><p id="de0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们以上面的例子为例，将一张图片添加到列表中，我们将得到下一个结果:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lv lw l"/></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/c53b3ea5350e064773a58e3f173aef68.png" data-original-src="https://miro.medium.com/v2/resize:fit:416/format:webp/1*ROAhHu3XhBS8fkqMdFGpyQ.jpeg"/></div></figure><p id="ce7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用上面的方法，我们根本不能从邮件应用程序中删除图像，因为<code class="fe ki kj kk kl b">itemForSourceType</code> delegate方法只修改文本项，它不是为修改多个项而设计的。</p><p id="ab3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文的前面，我保证我会在设置<code class="fe ki kj kk kl b">UIActivityViewController</code>委托时提出一个更好的解决方案，现在，一个解决方案应该可以解决这两个问题。</p><p id="6b78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们将传递符合<code class="fe ki kj kk kl b">UIActivityItemSource</code>的自定义对象，而不是传递init列表中的<code class="fe ki kj kk kl b">self</code>实例，这将给我们更多的灵活性，整个代码现在将变成:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="1edc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以完全控制每个应用程序共享的内容。的确，我们有一个更复杂的方法，但它提供的控制和灵活性应该是值得的。</p><h1 id="eee3" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">3.Gmail HTML共享</h1><p id="5629" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ms lk ll lm mt lo lp lq mu ls lt lu im bi translated">在Gmail应用程序上共享HTML内容可能是一个有效的案例，这可能是真的，大多数iOS用户将使用原生邮件应用程序，但也有相当多的人使用Gmail应用程序来处理邮件。很遗憾地通知您，目前，无法通过Gmail应用程序正常共享HTML，这并不是因为某些<code class="fe ki kj kk kl b">UIActivityViewController</code>限制，而是因为Gmail应用程序的限制，它只知道如何处理文本内容。</p><p id="9fb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是Gmail应用程序上HTML共享的截图:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/f2d3857aa5ba2ee88572e432da248122.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*fZmkX2Wa0VXKZkdHGM81RA.png"/></div></figure><p id="fb09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以看出，Gmail应用程序将HTML内容视为纯文本。我们唯一能做的改善用户体验的事情是确保我们将纯文本传递给Gmail应用程序。</p><h1 id="9139" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">4.在预定义的iOS列表之外处理<code class="fe ki kj kk kl b">activity types</code></h1><p id="fa55" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ms lk ll lm mt lo lp lq mu ls lt lu im bi translated">iOS系统为常见的社交媒体应用程序(如脸书、Twitter等)提供了预定义的活动类型列表。</p><p id="6294" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的挑战是，iOS系统无法为所有可能的应用提供预定义的类型。因此，在这种情况下，我们必须手动识别自定义应用程序类型id。例如，我们想在Gmail和Pinterest应用程序上分享一些iOS系统中没有预定义的内容。</p><p id="bc64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">找到自定义应用程序类型id的一个简单方法是在委托<code class="fe ki kj kk kl b">itemForSourceType</code>方法中放置一个断点，并打印给定的类型。</p><p id="c239" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个例子:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lv lw l"/></div></figure></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><p id="cfec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是我在使用活动视图控制器时发现的限制和挑战。我希望你觉得这篇文章很有趣，内容丰富，如果你知道任何其他的限制，请不要犹豫，添加评论。</p></div></div>    
</body>
</html>