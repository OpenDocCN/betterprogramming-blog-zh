# SwiftUI 2 中使用 Combine 框架的动画饼图

> 原文：<https://betterprogramming.pub/an-animated-pie-chart-in-swiftui-2-using-the-combine-framework-f3c277f3118e>

## 我的图表系列的第 5 部分

![](img/07b359ae0ef77a7dbbf578afc450f67f.png)

好的，我希望你是从第一部分来到这里的。如果你错过了，那么你可以回到这里:

[](https://medium.com/better-programming/an-animated-self-sorting-pie-chart-in-swiftui-2-0-24db465f9413) [## SwiftUI 2.0 中的一个动画的、自动排序的饼图

### 在这篇文章中，我想建立一个动画自动着色饼图，其中有一个可视化排序。换句话说，我…

medium.com](https://medium.com/better-programming/an-animated-self-sorting-pie-chart-in-swiftui-2-0-24db465f9413) 

那么我们在这里得到了什么？嗯，我从版本 1 退了一步，非常仔细地思考了一下。也许这是一个很好的例子，说明你不应该使用一个可观察的物体，或者至少用不同的方式使用它。在此基础上，我回到了绘图板:我认为我可以做得更好。

问题是，在尝试重画饼图之前，我们需要更新结构中的几个变量。使用一个被观察的对象，只要我们为第一个切片设置了新值，它就开始更新视图——不，我们需要再思考一下。

我还想绘制切片，并制作动画；我不喜欢我们最后得到的颤抖的图表。让我们后退一步，重新审视这个问题。我们需要跳出框框思考。最终我想要一个馅饼，一整个馅饼。里面有不同切片的馅饼。但是我不想用 bam 动画画切片；我希望他们成长为图片，就像条形图比赛。

我已经提到过，使用一个`observedObject`结构是行不通的。这个结构本身是可以的，但是我需要稍微松散地将它链接到饼图。只有在重新计算所有需要调整大小的切片时，我才需要更新饼图本身。

24 小时后，我设法把这些放在一起。很好看，比上一部好多了。这是对神经过敏的一个很大的改进，尽管我承认我没有整理它——那会弄乱配色方案。显然，我只是在这里自动生成了标签和值。

为此，我完全重写了主循环来显示图表，并在这个过程中引入了一个新的结构。我修复了 rejig 中的一个 bug，并将 struct 本身移到了 principle SwiftUI 2.0 文件中。(好吧，这并不理想。)这里是新的代码库，一个单独的文件。你真的需要重构它，让它变得更加结构化。排序例程也在那里；你可以尝试一下额外的学分。

**注意:**如果您复制、粘贴并运行这段代码，请注意它会在大约 18 次迭代后崩溃，因为 rejig 函数将无法完成循环。这是代码的一个限制。可以通过限制您尝试添加的分段数量或修复 rejig 来避免崩溃，这样您最终总是得到一个一直延伸到 360 度的切片。

这让我想到了这篇文章的结尾。

保持冷静，继续编码。