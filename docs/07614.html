<html>
<head>
<title>How To Make Contact Forms for Your Website Using Nodemailer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Nodemailer为你的网站制作联系表单</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-make-contact-forms-for-your-website-using-nodemailer-74739b186264?source=collection_archive---------3-----------------------#2021-02-02">https://betterprogramming.pub/how-to-make-contact-forms-for-your-website-using-nodemailer-74739b186264?source=collection_archive---------3-----------------------#2021-02-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e7e8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">使用强大的</strong> Node.js模块<strong class="ak">而不使用</strong> <strong class="ak">在你的Gmail账户上启用不太安全的应用</strong></h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cd6676c1cccd42f435e7fa8181a62e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gde189GBjiJpLc4x"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@kellysikkema?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯利·西克玛</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9ec7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有一个联系方式对你的网站来说是必不可少的，因为这是人们通过你的网站与你联系的方式。在本教程中，我们将使用<a class="ae kv" href="https://nodemailer.com/about/" rel="noopener ugc nofollow" target="_blank"> Nodemailer </a>以电子邮件的形式发送联系信息。</p><p id="d405" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">先说结果。在本教程结束时，您应该会看到这样的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/9adef24ec30c1977330ca0b348d26add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lcz8xJw7tFxwyjOXAqhXgA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">联系方式</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/f69d4c9444dae70cfe7c46fe4911bc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwlCFkksC_IDRuMHJQpkxQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">电子邮件</p></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="cb35" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">设置OAuth2</h1><p id="eba1" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">我搜索了一段时间，想用Gmail的Nodemailer发送电子邮件，但我总是发现我需要进入我的Gmail帐户设置，启用不太安全的应用程序。我没有信心做到这一点，所以我一直在寻找一种更安全的方法，直到我找到了<a class="ae kv" href="https://oauth.net/2/" rel="noopener ugc nofollow" target="_blank"> OAuth2 </a>方法。</p><h2 id="36dc" class="my mc iq bd md mz na dn mh nb nc dp ml lf nd ne mn lj nf ng mp ln nh ni mr nj bi translated">第一步。创建新项目</h2><p id="844b" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">转到<a class="ae kv" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌开发者控制台</a>并按左上角的“选择一个项目”按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/4785b524ecbad441cb04953c8c163827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SPY9NJJPk0WMzQ4CDiGdhA.png"/></div></div></figure><p id="307f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一扇窗户将会打开。按窗口右上角的“新建项目”按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/12e15b2a5f780582fe0c9aaccf45f9b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h_6ae9k-_y4qriT9VgJf6w.png"/></div></div></figure><p id="cd4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将被重定向到一个新页面来命名您的项目。然后按Create创建您的项目。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/c0063de249018d5eda10eace564631f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CrvNIT1Mp5VlaPX90eI-0A.png"/></div></div></figure><p id="4a0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将再次被重定向到Google Cloud platform主页，并收到一个通知，告知您项目已经创建。按“选择项目”按钮选择您的项目。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/aad30c33d991644a6d3cd8e03b5cf3a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eXwqQ1OwwQTdFJBLhAFuQw.png"/></div></div></figure><h2 id="58c7" class="my mc iq bd md mz na dn mh nb nc dp ml lf nd ne mn lj nf ng mp ln nh ni mr nj bi translated">第二步。创建API凭据</h2><p id="ff39" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">现在您需要为您的项目创建API凭证。选择您的项目后，您应该会看到您的项目仪表板。选择“API”部分底部的“转到API概述”<strong class="ky ir"> </strong>按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/4ca2f55c9f1c4144ae431527d3cc2478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2-81ts7cKugxAZfdN7MS6w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按下“转到API概览”按钮</p></figure><p id="19e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你将<strong class="ky ir"> </strong>被重定向到一个新页面。在侧栏中选择凭据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/46bb6382aa83319653f28de9b3139b21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J0gWTflkYGoLtQI2jFKzWQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在侧边栏中选择凭据</p></figure><p id="1f37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将被重定向到凭据页面。选择创建凭据按钮，然后从菜单中选择“OAuth客户端ID”以允许您的应用程序访问您的Gmail数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/97177aca19e0d66981ce44efaa077d4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CrNA0PDUpToa8IPqsCi90Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">选择创建凭据按钮</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/c110d6976c2ff3bcfd7c333d2d10ab8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qqihRA_5Lk_0UlSNY2iLdQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">从菜单中选择OAuth客户端ID <strong class="bd ns"> </strong></p></figure><p id="36c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将被重定向到一个新页面，上面写着“要创建OAuth客户端ID，您必须首先在同意屏幕上设置一个产品名称。”</p><p id="86ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是合乎逻辑的，因为你首先需要有一个应用程序来允许它访问你的Gmail帐户数据。</p><p id="f95b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">按配置同意屏幕按钮创建您的应用程序。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/620c20fbf41d9c119238548d6e6f4639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xMWIZYRul3vKkS5jBk2r4g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按下配置同意屏幕按钮</p></figure><p id="12e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将被重定向到OAuth同意屏幕页面。在用户类型下，选择外部，然后按创建按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/584f778daea80d44b2998103f423fb37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ymxVOcAhRd3DwTiefmv39Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">选择外部并按下创建<strong class="bd ns"> </strong>按钮</p></figure><p id="2cf9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你将被重定向到一个新页面，以添加你的应用信息。您只能填写三个必填字段。</p><p id="9494" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在“应用信息”下输入<strong class="ky ir"> </strong>应用名称和用户支持邮箱，并在开发者联系信息下输入邮箱地址。然后按“保存并继续”按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/312f9bbd95e75035536325c7967697a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BR89HKWRfidLlQzQKs7bxg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输入应用程序名称和用户支持电子邮件</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/be1aebae3f97e1f104e139a1b941c567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gV7w-e-pRZsueA_XKws6vw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输入电子邮件地址，然后按“保存并继续”按钮</p></figure><p id="7a52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于范围和“测试用户”，点击，然后按“保存并继续”按钮。在“摘要”选项卡上，按“返回仪表板”按钮。</p><p id="35ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你将被重定向到一个新页面，该页面可查看你的应用信息摘要，并且还有一个发布按钮。发布你的应用非常重要，所以在测试下，按发布应用按钮。</p><p id="85ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将看到一个弹出窗口，要求您确认是否要发布应用程序，因此请按确认。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/b6513ab080a732f1460be1fa8b75ea7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vTsAkF3DgmSIyxGNZJjSnw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按确认</p></figure><p id="fa1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后在侧边栏中再次选择凭据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/933ead246a8969efca4c5852d6cf54bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*60jjQRZzkTAcJAYV3bc7Ww.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在侧栏中再次选择凭据</p></figure><p id="ad26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再次按<strong class="ky ir"> </strong>下【创建凭证】，同样从菜单中再次选择【OAuth客户端ID】。</p><p id="0449" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这一次，您将被重定向到一个新页面来创建OAuth客户端ID。对于“应用程序类型”选择“Web应用程序”，然后输入您的应用程序名称。在<strong class="ky ir"/>下授权重定向URIs，按下<strong class="ky ir">添加URI</strong>按钮并添加<a class="ae kv" href="https://developers.google.com/oauthplayground" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/oauthplayground</a>，然后按下创建。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/67bcbecbb3ca20319060236e9b98ddcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zjMw5KtfLCmVOZxG9t1cpA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">对于“应用程序类型”，选择“Web应用程序”，<strong class="bd ns"> </strong>然后输入您的应用程序名称</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/d7e651af1ad8b76913b5901177986be1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bwDMYgPqoQSazMcUq9g16g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在“授权重定向URIs”下，按添加URI。添加<a class="ae kv" href="https://developers.google.com/oauthplayground" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/oauthplayground</a>，然后按下创建。</p></figure><p id="5482" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您已经创建了OAuth客户端，您需要保存您的客户端ID和客户端密码，因为您很快就会用到它们。然后按确定。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/db457ce60309101e5425b8160c641f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dv1G1kxV6czceIjE27yBkA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">保存您的客户ID和客户密码</p></figure><h2 id="f3de" class="my mc iq bd md mz na dn mh nb nc dp ml lf nd ne mn lj nf ng mp ln nh ni mr nj bi translated"><strong class="ak">第三步。配置OAuth </strong></h2><p id="d066" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">要先配置OAuth，去https://developers.google.com/oauthplayground的<a class="ae kv" href="https://developers.google.com/oauthplayground" rel="noopener ugc nofollow" target="_blank">。按右上方的工具图标。选中“使用您自己的OAuth凭据”复选框，并输入您的OAuth客户端ID和OAuth客户端密码。在“选择&amp;授权API”下的<strong class="ky ir"> </strong>框中输入<strong class="ky ir"/></a><a class="ae kv" href="https://mail.google.com/" rel="noopener ugc nofollow" target="_blank">https://mail.google.com/</a>并点击授权API按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ca"><img src="../Images/33cceb09e247a8148443c8410a807f88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4MmlSobdUujO9xLjcnCEfg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输入您的OAuth客户端ID和OAuth客户端密码。在“选择和授权API”下，在框中输入<a class="ae kv" href="https://mail.google.com/" rel="noopener ugc nofollow" target="_blank">https://mail.google.com/</a>并按下授权API按钮。</p></figure><p id="3b97" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将被重定向到登录您的Gmail帐户。选择您的Gmail帐户后，您将重定向到一个警告页面，提示您谷歌尚未验证该应用程序。这很好，因为谷歌还没有验证你的应用程序。选择高级设置，进入你的应用“不安全”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/9cb2039b0c2448d7136315627a604ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RAyhxunXUbWHKOc7iPuYRg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">登录您的Gmail帐户</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/45d8996ee25a2aab378f786da0ada564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pd3HBP6XhKQQp6Qg2TkFVw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">选择高级设置，进入你的应用“不安全”</p></figure><p id="d534" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将看到一个确认框，表明您授权您的应用程序从Gmail中阅读、撰写、发送和永久删除您的所有电子邮件。按允许。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/9aed5e6cf0cff6f6351b94cc0cc285dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*X18v2aSw3TwzwB-x-NS2ag.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按允许</p></figure><p id="f434" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将看到另一个确认框，所以请按“允许”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/bfbbe05bf5707f7be61d71fcf6d5fb85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*cqYptKn6EI2SITV7O9pbLQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按下<strong class="bd ns">允许。</strong></p></figure><p id="7fdc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将被重定向回OAuth页面。现在，在侧边栏中选择步骤2，并按下“令牌交换授权码”按钮<strong class="ky ir"> </strong>，这将为访问令牌和刷新令牌生成两个框。保存刷新令牌，因为您很快就会需要它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/ebc532e4188bee13332e31cf9c479c0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*BXPRhYJEWSLdmg4owlbHsg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在侧边栏中选择步骤2，然后按下“兑换令牌的授权码”按钮。</p></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="7f52" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">写一些代码</h1><p id="a2df" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">现在我们开始有趣的部分，写代码。我们只对<code class="fe og oh oi oj b">server.js</code>文件和<code class="fe og oh oi oj b">app.js</code>文件感兴趣，因为我们希望用户得到消息已经发送的通知。</p><p id="8f43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们不会对HTML感兴趣。但是，我将与您分享HTML代码，以便清楚地了解我们正在构建的内容。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="96c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你会注意到我正在使用<a class="ae kv" href="https://getbootstrap.com/docs/5.0/getting-started/introduction/" rel="noopener ugc nofollow" target="_blank">自举4 </a>和<a class="ae kv" href="https://sweetalert2.github.io/" rel="noopener ugc nofollow" target="_blank"> SweetAlert2 </a>。</p><h2 id="9c41" class="my mc iq bd md mz na dn mh nb nc dp ml lf nd ne mn lj nf ng mp ln nh ni mr nj bi translated"><strong class="ak"> Server.js文件</strong></h2><p id="09e1" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在<code class="fe og oh oi oj b">server.js</code>文件中，我们将构建我们的电子邮件。首先，我们将安装我们将用来发送电子邮件的库，这是Nodemailer和Node.js的Google OAuth客户端。我们还需要安装我们将使用的Node.js框架<a class="ae kv" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express.js </a>，以及我们将用来解析来自客户端的数据的中间件<a class="ae kv" href="https://www.npmjs.com/package/body-parser" rel="noopener ugc nofollow" target="_blank"> body-parser </a>。</p><p id="d169" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的终端中，编写这行代码来安装所有需要的包。</p><p id="586d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe og oh oi oj b">npm install express nodemailer googleapis body-parser</code></p><p id="8244" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们会带上我们的包裹:</p><pre class="kg kh ki kj gt om oj on oo aw op bi"><span id="d5c4" class="my mc iq oj b gy oq or l os ot">const express = require('express')<br/>const bodyParser= require('body-parser')<br/>const nodemailer = require(‘nodemailer’)<br/>const { google } = require(‘googleapis’)</span></pre><p id="1856" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将设置OAuth客户机、客户机ID、客户机机密和OAuth游乐场的URL。</p><pre class="kg kh ki kj gt om oj on oo aw op bi"><span id="41e1" class="my mc iq oj b gy oq or l os ot">const OAuth2 = google.auth.OAuth2<br/>const oauth2Client = new OAuth2(<br/>process.env.CLIENT_ID,<br/>process.env.CLIENT_SECRET,<br/>"https://developers.google.com/oauthplayground")</span></pre><p id="936c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:我使用的是Heroku环境变量，因为客户端ID、客户端密码和刷新令牌是禁止信息。所以你不应该把它直接写在你的代码上。</p><p id="4bd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们将使用刷新令牌来获取访问令牌。</p><pre class="kg kh ki kj gt om oj on oo aw op bi"><span id="eace" class="my mc iq oj b gy oq or l os ot">oauth2Client.setCredentials({refresh_token:process.env.Refresh_Token})<br/>const accessToken = oauth2Client.getAccessToken()</span></pre><p id="39bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们将使用Express初始化我们的应用程序，并设置我们的服务器。</p><pre class="kg kh ki kj gt om oj on oo aw op bi"><span id="a44d" class="my mc iq oj b gy oq or l os ot">const app = express()<br/>app.use(bodyParser.urlencoded({extended:true}))</span><span id="6ece" class="my mc iq oj b gy ou or l os ot">app.use(bodyParser.json())<br/>app.use(express.static('public'))<br/>app.route("/").get(function (req, res) {<br/>  res.sendFile(process.cwd() + "/public/contactUs.html");<br/>});</span><span id="e115" class="my mc iq oj b gy ou or l os ot">const port = process.env.PORT || 3000<br/>const server = app.listen(port,listening)<br/>function listening (){<br/>console.log(`server running on ${port}`)<br/>}</span></pre><p id="683c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们创建post请求，并将您的电子邮件内容添加到一个变量中。</p><pre class="kg kh ki kj gt om oj on oo aw op bi"><span id="5af8" class="my mc iq oj b gy oq or l os ot">app.post('/contact',(req,response)=&gt;{</span><span id="5a92" class="my mc iq oj b gy ou or l os ot">const output=`<br/>&lt;p&gt;You have a new contact request&lt;/p&gt;<br/>&lt;img class="email" src="cid:email" alt="email-image"&gt;<br/>&lt;h3&gt;Contact details&lt;/h3&gt;<br/>&lt;ul&gt;<br/>&lt;li&gt;FirstName: ${req.body.name}&lt;/li&gt;<br/>&lt;li&gt;TelNum: ${req.body.telephone}&lt;/li&gt;<br/>&lt;li&gt;Email: ${req.body.email}&lt;/li&gt;<br/>&lt;li&gt;Message: ${req.body.message}&lt;/li&gt;<br/>&lt;/ul&gt;`</span></pre><p id="0757" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">重要提示</strong>:发布路径<code class="fe og oh oi oj b">/contact</code>必须与你的HTML表单<code class="fe og oh oi oj b">action=”contact”</code>中的action属性相同。</p><p id="9b29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们将描述如何使用SMTP和Nodemailer发送电子邮件。</p><pre class="kg kh ki kj gt om oj on oo aw op bi"><span id="cff0" class="my mc iq oj b gy oq or l os ot">const smtpTrans = nodemailer.createTransport({<br/>host: 'smtp.gmail.com',<br/>port: 465,<br/>secure: true,<br/>auth:{<br/>type:"OAuth2",<br/>user:process.env.GMAIL_USER,<br/>clientId:process.env.CLIENT_ID,<br/>clientSecret:process.env.CLIENT_SECRET,<br/>refreshToken:process.env.REFRESH_TOKEN,<br/>accessToken:accessToken<br/>}})</span></pre><p id="1640" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们将内容变量添加到电子邮件中。</p><pre class="kg kh ki kj gt om oj on oo aw op bi"><span id="efcf" class="my mc iq oj b gy oq or l os ot">const mailOpts = {<br/>from:process.env.GMAIL_USER,<br/>to:process.env.RECIPIENT,<br/>subject:'New message from Nodemailer-contact-form',<br/>html:output,<br/>attachments: [{<br/>filename: 'email.jpg',<br/>path:__dirname + '/public/images/email.jpg',cid: 'email' //same cid value as in the html img src<br/>}]}</span></pre><p id="3a99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们将发送电子邮件。</p><pre class="kg kh ki kj gt om oj on oo aw op bi"><span id="ed35" class="my mc iq oj b gy oq or l os ot">smtpTrans.sendMail(mailOpts,(error,res)=&gt;{<br/> if(error){<br/> console.log(error);<br/> }<br/> else{<br/>  console.log("Message sent: " + res.message);<br/>  response.status(200).send(200)<br/>  }<br/> })<br/>})</span></pre><p id="196d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是<code class="fe og oh oi oj b">server.js</code>文件的全部代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="1413" class="my mc iq bd md mz na dn mh nb nc dp ml lf nd ne mn lj nf ng mp ln nh ni mr nj bi translated">App.js文件</h2><p id="3011" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在<code class="fe og oh oi oj b">app.js</code>文件中，我们将向表单添加一个事件监听器，并获取用户的输入值来通知用户他们的电子邮件已经发送。</p><pre class="kg kh ki kj gt om oj on oo aw op bi"><span id="1172" class="my mc iq oj b gy oq or l os ot">const form = document.getElementById('contact-form')<br/>const formEvent = form.addEventListener("submit",(event)=&gt;{<br/>  event.preventDefault()<br/>  const name = form.getElementsByTagName('input')[0].value<br/>  const email = form.getElementsByTagName('input')[2].value<br/>  const telephone = form.getElementsByTagName('input')[1].value<br/>  const message = form.getElementsByTagName('textarea')[0].value<br/>  sendEmail(name,email,telephone,message)<br/>})</span></pre><p id="7755" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里是<code class="fe og oh oi oj b">sendEmail</code> <strong class="ky ir"> </strong>函数<strong class="ky ir"/><strong class="ky ir"/>获取表单URL来检查邮件是否已经发送。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="65d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样！您已经制作了与Nodemailer的联系表单。</p><p id="19ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/9adef24ec30c1977330ca0b348d26add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lcz8xJw7tFxwyjOXAqhXgA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">联系方式</p></figure><p id="9bd5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">电子邮件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/f69d4c9444dae70cfe7c46fe4911bc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwlCFkksC_IDRuMHJQpkxQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">电子邮件</p></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="2487" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">资源</h1><ul class=""><li id="fcc4" class="ov ow iq ky b kz mt lc mu lf ox lj oy ln oz lr pa pb pc pd bi translated">你也可以在这里查看Github回购<a class="ae kv" href="https://github.com/zainabelsayed/Nodemailer-contact-form" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="12da" class="ov ow iq ky b kz pe lc pf lf pg lj ph ln pi lr pa pb pc pd bi translated"><a class="ae kv" href="https://nodemailer.com/about/" rel="noopener ugc nofollow" target="_blank">节点邮件程序文档</a>。</li></ul><p id="aefb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你读到这里，我想感谢你，我希望这篇教程对你有用。</p></div></div>    
</body>
</html>