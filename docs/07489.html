<html>
<head>
<title>Is the Server Down? Send Automated Alerts to Your Team Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">服务器停机了吗？使用Python向您的团队发送自动警报</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/server-monitoring-and-sending-alert-to-them-team-when-its-down-using-python-script-cb843084c0a9?source=collection_archive---------6-----------------------#2021-01-20">https://betterprogramming.pub/server-monitoring-and-sending-alert-to-them-team-when-its-down-using-python-script-cb843084c0a9?source=collection_archive---------6-----------------------#2021-01-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a87c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">并创建一个网站监控脚本来跟踪停机时间</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f60980c6b144b8561be96c98e124dd12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SjA5TQYCoFvUueeD"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@ussamaazam?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乌萨马·阿扎姆</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="52dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些年来，我遇到过很多服务器停机而客户端让我们知道的问题。我想很多像我一样的其他开发者也面临过类似的问题。从软件公司和开发者的角度来看都不太好！</p><p id="79fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为一个对Python这样的脚本语言一无所知的iOS开发者，我一直觉得被束缚住了，从来不敢尝试。是的，有可用的系统监控工具——既有开源的，也有付费的，这些都可以使用，但是当我只想在服务器停机时向团队成员发送简单的电子邮件和短信警报时，在系统中集成另一个依赖项——我不喜欢这个想法。</p><p id="244e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我家里有一台Mac mini，它可以24/7全天候稳定连接互联网，所以我想——为什么不用它每隔几分钟或一小时连接我项目的服务器，并检查它的状态呢？我决定坐下来，从这里或那里学习一些知识，以便能够编写脚本并在cron中运行，以便在服务器停机时提醒我。</p><p id="2908" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我决定包括三件事:</p><ul class=""><li id="3224" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">当我的脚本无法ping通服务器时，向所有队友(包括项目经理)发送一封电子邮件通知。</li><li id="0d55" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">向项目经理和团队领导发送短信提醒。</li><li id="1aa0" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">在晚上的时候用声音提醒我(出于实验目的)。</li></ul><p id="efc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于我对这门语言知之甚少，我决定一步一步来。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="935f" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">步骤1:创建新项目(站点监视器)</strong></h1><p id="8730" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">这很容易。我打开终端，为项目和虚拟环境创建一个新目录，然后激活它:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="2c21" class="np mo iq nl b gy nq nr l ns nt">mkdir sitemonitor<br/>cd sitemonitor/<br/>python3 -m venv monitor_env<br/>source monitor_env/bin/activate</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="208b" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">步骤2:在JSON文件中创建项目信息结构</strong></h1><p id="12f7" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">我需要决定监视器需要的项目信息的基本结构。我需要项目名称、ping的服务器URL路径来查找服务器的状态，然后需要项目成员的信息:他们的姓名、电子邮件地址(用于电子邮件提醒)和手机号码(用于短信提醒)。由于我将使用一个试用的Twilio帐户，并决定根据项目的严重性，为一个项目开/关短信提醒，我添加了另一个键:<code class="fe nu nv nw nl b">send_sms_alert</code>。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="d73a" class="np mo iq nl b gy nq nr l ns nt">[<br/> {<br/>  "server" : "<a class="ae kv" href="https://stage.servare.app/" rel="noopener ugc nofollow" target="_blank">u</a>rl here",<br/>  "project_name": "project name here",<br/>  "send_sms_alert" : false,<br/>  "manager": {<br/>   "name" : "manager name here",<br/>   "email" : "<a class="ae kv" href="mailto:ssingh@outcodesoftware.com" rel="noopener ugc nofollow" target="_blank">m</a>anager email address here",<br/>   "number" : "manager mobile number here"<br/>  },<br/>  "lead": {<br/>   "name" : "lead name here",<br/>   "email" : "lead email address here",<br/>   "number" : "lead mobile number here"<br/>  },<br/>  "other_members" : [<br/>   {<br/>    "name" : "member 1 name here",<br/>    "email" : "<a class="ae kv" href="mailto:sshrestha@outcodesoftware.com" rel="noopener ugc nofollow" target="_blank">m</a>ember 1 email address here",<br/>    "number" : "<a class="ae kv" href="mailto:sshrestha@outcodesoftware.com" rel="noopener ugc nofollow" target="_blank">m</a>ember mobile number here"<br/>   }<br/>  ]<br/> }</span><span id="9400" class="np mo iq nl b gy nx nr l ns nt">]</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="0b36" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">步骤3:从JSON文件加载项目</strong></h1><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="c9d8" class="np mo iq nl b gy nq nr l ns nt">import json</span><span id="926d" class="np mo iq nl b gy nx nr l ns nt">def check_server_down(project):<br/>    # here we ping the server and check it's status</span><span id="7c2c" class="np mo iq nl b gy nx nr l ns nt">def load_projects():<br/>    f = open('projects.json')<br/>    projects = json.load(f)<br/>    for project in projects:<br/>         check_server_down(project)</span><span id="52fe" class="np mo iq nl b gy nx nr l ns nt">    f.close()</span><span id="f39f" class="np mo iq nl b gy nx nr l ns nt">load_projects()</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="5766" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">步骤4:ping Project Server URL以检查其HTTP响应状态代码</h1><p id="ef1b" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">我们假设我们有一个端点，如果服务器启动，它总是用<code class="fe nu nv nw nl b">200 OK</code>来响应。为此，我们需要首先安装请求库。但是我们需要确保我们已经激活了虚拟环境。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="ae1c" class="np mo iq nl b gy nq nr l ns nt">(monitor_env) Ashwins-MacBook-Pro:sitemonitor myMac$ pip install requests</span></pre><p id="7cf0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们调用URL，所以在我们之前写的方法<code class="fe nu nv nw nl b">checkServerDown</code>中:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="4a72" class="np mo iq nl b gy nq nr l ns nt">import logging<br/>import requests<br/>import json</span><span id="b615" class="np mo iq nl b gy nx nr l ns nt">def check_server_down(project):<br/>    r = requests.get(project['server'], timeout=timeOutTime)<br/> <br/>    if r.status_code != 200:<br/>        logging.error("Server down of project {} at   {}".format(project['project_name'], datetime.now()))<br/>        send_email_alert(project)<br/>        if project['send_sms_alert']:<br/>           send_sms_alert(project)<br/>        play_alert()</span><span id="d737" class="np mo iq nl b gy nx nr l ns nt">def load_projects():<br/>    f = open('projects.json')<br/>    projects = json.load(f)<br/>    for project in projects:<br/>        check_server_down(project)</span><span id="5412" class="np mo iq nl b gy nx nr l ns nt">    f.close()</span><span id="385d" class="np mo iq nl b gy nx nr l ns nt">load_projects()</span></pre><p id="d138" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样出于日志记录的目的，我们使用日志记录模块。</p><p id="6c1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如上所示，我们有三种方法:发送电子邮件提醒，短信提醒和播放声音提醒。接下来我们将编写它们的实现。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="f956" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">第五步:发送邮件提醒</strong></h1><p id="f24a" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">要发送电子邮件警报，我们需要导入<code class="fe nu nv nw nl b">smtplib</code>模块和一个smtp服务提供商。在这个例子中，我们将使用Gmail作为我们的smtp。然而，为此，我们需要提供访问权限。因此，请转到您希望用作发送电子邮件提醒的默认电子邮件的google帐户链接:</p><p id="8044" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://myaccount.google.com/lesssecureapps" rel="noopener ugc nofollow" target="_blank">https://myaccount.google.com/lesssecureapps</a></p><p id="3f0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并启用，如下图所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/1e1dc720deeb6414cb3405d23c9ce83c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_5DzGhQ6u2tX_zAqLHBGQ.png"/></div></div></figure><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="635d" class="np mo iq nl b gy nq nr l ns nt">import smtplib</span><span id="cf1b" class="np mo iq nl b gy nx nr l ns nt">smtpEmail = "SMTP_EMAIL_ADDRESS"<br/>smtpPassword = "SMTP_PASSWORD"<br/>emailFrom = "EMAIL_FROM"</span><span id="3a17" class="np mo iq nl b gy nx nr l ns nt">def send_email_alert(project):<br/>    conn = smtplib.SMTP('smtp.gmail.com',587) # create a new connection<br/>    conn.ehlo()<br/>    conn.starttls()<br/>    conn.login(smtpEmail, smtpPassword)</span><span id="4536" class="np mo iq nl b gy nx nr l ns nt">    projectName = project['project_name']<br/>    subject = '{} server is down'.format(projectName)</span><span id="dd70" class="np mo iq nl b gy nx nr l ns nt">    manager =  project['manager']<br/>    lead = project['lead']</span><span id="df70" class="np mo iq nl b gy nx nr l ns nt">    projectMembers = project['other_members']<br/>    membersNames = ', '.join(map(str,list(map(lambda x: x['name'], projectMembers))))<br/>    message = """The {} project server seems to be down. Please contact your team mates and fix it</span><span id="59c8" class="np mo iq nl b gy nx nr l ns nt">       Team members:<br/>       Project Manager: {}<br/>       Mobile Number: {}</span><span id="4a5a" class="np mo iq nl b gy nx nr l ns nt">       Team Lead: {}<br/>       Mobile Number: {}</span><span id="00ba" class="np mo iq nl b gy nx nr l ns nt">       Other Members: <br/>       {}</span><span id="7a7e" class="np mo iq nl b gy nx nr l ns nt">     """.format(projectName, manager['name'], manager['number'], lead['name'], lead['number'], membersNames)</span><span id="f848" class="np mo iq nl b gy nx nr l ns nt">    emailTo = list(map(lambda x: x['email'], projectMembers))<br/>    emailTo.insert(0, lead['email'])<br/>    emailTo.insert(0, manager['email'])<br/>    emailMessage = 'Subject: {}\n\n{}'.format(subject, message)<br/> <br/>    conn.sendmail(emailFrom,emailTo,emailMessage) #sends email<br/>    conn.quit() # closes the connection</span></pre><p id="bf85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面，我们创建了一个SMTP连接，然后创建了一个团队成员、项目经理和项目领导的电子邮件地址列表，然后使用这些地址从<code class="fe nu nv nw nl b">emailFrom</code>发送电子邮件。在邮件正文中，我们添加了所有团队成员的详细信息和项目详细信息。</p><p id="fdcd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这之后，我不喜欢在脚本上写电子邮件和密码，所以决定从<code class="fe nu nv nw nl b">env</code>文件中加载。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="9741" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">步骤6:为凭证创建env文件</strong></h1><p id="0441" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">为此我们需要创建一个新的。env文件，并在那里添加我们所有的凭证:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="1e02" class="np mo iq nl b gy nq nr l ns nt">SMTP_EMAIL_ADDRESS=Email_address_here<br/>SMTP_PASSWORD=your_smtp_email_password_here<br/>EMAIL_FROM=your_from_email_for_alert_here</span></pre><p id="6264" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后安装<code class="fe nu nv nw nl b">python-dotenv</code>库:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="73f6" class="np mo iq nl b gy nq nr l ns nt">(monitor_env) Ashwins-MacBook-Pro:sitemonitor myMac$ pip install python-dotenv</span></pre><p id="ff43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在从<code class="fe nu nv nw nl b">env</code>文件加载要使用的凭证:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="ab6c" class="np mo iq nl b gy nq nr l ns nt">from dotenv import load_dotenv<br/>from pathlib import Path<br/>import os</span><span id="a68b" class="np mo iq nl b gy nx nr l ns nt">env_path = Path('.') / '.env'<br/>load_dotenv(dotenv_path=env_path)</span><span id="c6ef" class="np mo iq nl b gy nx nr l ns nt">smtpEmail = os.getenv("SMTP_EMAIL_ADDRESS")<br/>smtpPassword = os.getenv("SMTP_PASSWORD")<br/>emailFrom = os.getenv("EMAIL_FROM")</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="ba6c" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">第七步:发送短信提醒</strong></h1><p id="5862" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">我决定给系统添加一个短信提醒，这是给项目经理和团队领导的。为此，我创建了一个新的Twilio账户，并获得了我的测试Twilio电话号码:<a class="ae kv" href="http://I decided to add SMS alert too in the system which will be for the project manager and team lead. For this, I created a new Twilio account and got my test Twilio phone number: https://www.twilio.com/login" rel="noopener ugc nofollow" target="_blank">https://www.twilio.com/login</a></p><p id="1551" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在我的项目中安装了Twilio库:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="d594" class="np mo iq nl b gy nq nr l ns nt">(monitor_env) Ashwins-MacBook-Pro:sitemonitor myMac$ pip install twilio</span></pre><p id="b43c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来在我的<code class="fe nu nv nw nl b">env</code>文件中添加了Twilio凭证:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="9513" class="np mo iq nl b gy nq nr l ns nt">TWILIO_SID=TWILIO_SID_HERE<br/>TWILIO_AUTH_TOKEN=TWILIO_AUTH_TOKEN_HERE</span></pre><p id="3d64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后添加了发送短信提醒所需的代码:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="48d5" class="np mo iq nl b gy nq nr l ns nt">from twilio.rest import Client</span><span id="6984" class="np mo iq nl b gy nx nr l ns nt">def send_sms_alert(project):<br/>    account_sid = os.getenv("TWILIO_SID")<br/>    auth_token  = os.getenv("TWILIO_AUTH_TOKEN")</span><span id="7d30" class="np mo iq nl b gy nx nr l ns nt">    client = Client(account_sid, auth_token)<br/>    messageBody = '{} server is down. Please have a look in the system. This auto generated message has been sent to other team members as well. Thank you.'.format(project['project_name'])</span><span id="ea70" class="np mo iq nl b gy nx nr l ns nt">    manager =  project['manager']<br/>    lead = project['lead']</span><span id="27ab" class="np mo iq nl b gy nx nr l ns nt">    projectMembers = project['other_members']</span><span id="3b4b" class="np mo iq nl b gy nx nr l ns nt">    mobileNumbers = list(map(lambda x: x['number'], projectMembers))<br/>    mobileNumbers.insert(0, lead['number'])<br/>    mobileNumbers.insert(0, manager['number'])<br/>    mobileNumbers = list(set(mobileNumbers)) # remove the duplicates</span><span id="854f" class="np mo iq nl b gy nx nr l ns nt">    for number in mobileNumbers:<br/>      message = client.messages.create(<br/>          to=number, <br/>          from_="+19177655746",<br/>          body=messageBody)<br/></span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="396c" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">第八步:播放声音提示</strong></h1><p id="233b" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">出于学习的目的，我决定在服务器停机时也增加声音播放功能。为此，我添加了<code class="fe nu nv nw nl b">simpleaudio</code>库:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="806c" class="np mo iq nl b gy nq nr l ns nt">(monitor_env) Ashwins-MacBook-Pro:sitemonitor myMac$ pip install simpleaudio</span></pre><p id="78d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在播放一个声音，我添加了一个警告:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="0714" class="np mo iq nl b gy nq nr l ns nt">import simpleaudio as sa</span><span id="3146" class="np mo iq nl b gy nx nr l ns nt">filename = 'RedAlert.wav'<br/>wave_obj = sa.WaveObject.from_wave_file(filename)</span><span id="3eb6" class="np mo iq nl b gy nx nr l ns nt">def play_alert():<br/>    play_obj = wave_obj.play()<br/>    play_obj.wait_done()</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><p id="cc6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就完成了我们的脚本，现在，当服务器因项目而停机时，它会发送电子邮件、SMS并播放音频。现在我们需要一个脚本，使用一个<code class="fe nu nv nw nl b">cro</code> n作业每隔几分钟或几小时执行一次。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="4d2c" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">步骤cron作业的Shell脚本</strong></h1><p id="3260" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">为此，我们在项目的同一目录下创建一个shell脚本，名为cronjob.sh:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="6de9" class="np mo iq nl b gy nq nr l ns nt">#!/bin/bash</span><span id="71ff" class="np mo iq nl b gy nx nr l ns nt">cd /Users/myMac/Documents/sitemonitor<br/>source monitor_env/bin/activate<br/>python monitor.py</span></pre><p id="d4b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要使用以下命令使该脚本可执行:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="add8" class="np mo iq nl b gy nq nr l ns nt">Ashwins-MacBook-Pro:sitemonitor myMac$ chmod 777 cronjob.sh</span></pre><p id="5389" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以上命令使cronjob.sh文件可读、可写且可执行:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="b149" class="np mo iq nl b gy nq nr l ns nt">Ashwins-MacBook-Pro:sitemonitor myMac$ ls -l<br/>-rwxrwxrwx@ 1 myMac  staff     134 Jan 19 18:56 cronjob.sh</span></pre><p id="d0a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更多详情见:<a class="ae kv" href="https://en.wikipedia.org/wiki/Chmod" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Chmod</a></p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="6ae1" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">步骤10:添加新的cron作业</strong></h1><p id="ae4d" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">在类似Unix的操作系统上，<code class="fe nu nv nw nl b">crontab</code>命令打开cron表进行编辑。cron表是计划在系统上定期运行的任务列表。</p><p id="e9e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一些基本的<code class="fe nu nv nw nl b">crontab</code>命令:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="50e2" class="np mo iq nl b gy nq nr l ns nt">&gt; crontab -l <br/>this lists all the cron job in the system</span><span id="c1f5" class="np mo iq nl b gy nx nr l ns nt">&gt; crontab -r<br/>this removes all the cron job in the system</span><span id="7f1f" class="np mo iq nl b gy nx nr l ns nt">&gt; crontab -e<br/>this creates a new cron job in the system</span></pre><p id="a65e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，因为我们需要为我们的可执行脚本添加一个新的<code class="fe nu nv nw nl b">cron</code>作业，它每10分钟执行一次:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="2886" class="np mo iq nl b gy nq nr l ns nt">Ashwins-MacBook-Pro:sitemonitor myMac$ crontab -e</span></pre><p id="a0b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将打开您的vim编辑器，您可以在其中编写以下内容:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="c04e" class="np mo iq nl b gy nq nr l ns nt">10 * * * * /Users/myMac/Documents/sitemonitor/cronjob.sh &gt;&gt; /Users/myMac/Documents/sitemonitor/cronError.txt 2&gt;&amp;1</span></pre><p id="8985" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，按Esc，然后按wq并按enter，如下图所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/8bd0f96de169d63618f28587f66c356e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*18fvcda35LTVCV270IhrFw.png"/></div></div></figure><p id="7119" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，如果我们去列出<code class="fe nu nv nw nl b">cron</code>的工作，它会显示这个结果:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="d9cb" class="np mo iq nl b gy nq nr l ns nt">Ashwins-MacBook-Pro:sitemonitor myMac$ crontab -l</span></pre><p id="bfd7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是我们需要做的cronjob现在每10分钟执行一次。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="e3cd" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">步骤11:使cron作业在MacOS (Catalina和更高版本)中运行</strong></h1><p id="42f9" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">对于使用Catalina或更高版本的mac用户，由于Mac的安全功能，该作业将不会执行。为此，我们需要最后一步:</p><p id="b48b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开<strong class="ky ir">系统偏好&gt;安全和隐私&gt;隐私&gt;全磁盘访问:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/9ad83ec490a86255f327b93de929f43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*Wjf5VULfh5LyYVCIP73dLw.png"/></div></figure><p id="0275" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们需要将<code class="fe nu nv nw nl b">cron</code>添加到列表中。</p><p id="1ab4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，在您的终端中:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="090a" class="np mo iq nl b gy nq nr l ns nt">Ashwins-MacBook-Pro:sitemonitor myMac$ cd /usr<br/>Ashwins-MacBook-Pro:sitemonitor myMac$ open .</span></pre><p id="4754" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后将sbin文件夹拖到收藏夹部分。因此，当我们将<code class="fe nu nv nw nl b">cron</code>添加到全磁盘访问时，将很容易导航到该项目。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/c7ea1fd2751c8118056403a826b7c5ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tlVSCNDf5xiCdX0yDR8dSw.png"/></div></div></figure><p id="4966" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在cron作业应该运行良好。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><p id="2201" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这对我来说是一次学习经历。如果你有任何问题，请在下面的评论区告诉我。谢谢你。</p><p id="0edd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编码快乐！</p></div></div>    
</body>
</html>