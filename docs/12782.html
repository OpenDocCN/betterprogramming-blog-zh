<html>
<head>
<title>Working With JavaScript Animations Using ‘requestAnimationFrame’</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用“requestAnimationFrame”处理JavaScript动画</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/working-with-javascript-animations-using-requestanimationframe-f07e0658908e?source=collection_archive---------3-----------------------#2022-07-01">https://betterprogramming.pub/working-with-javascript-animations-using-requestanimationframe-f07e0658908e?source=collection_archive---------3-----------------------#2022-07-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d798" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为你的网站制作流畅的动画</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/476791d37b1ca32dca6e1f80ee195b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bSgGr2swZrIDiL6TDhEJEQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@sebastiansvenson?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">塞巴斯蒂安·斯文森</a>在<a class="ae kv" href="https://unsplash.com/@sebastiansvenson?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="f97e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在JavaScript中有几种已知的处理动画的方法。例如，您可以使用一个定时器函数— <code class="fe ls lt lu lv b">setTimeout</code>或setInterval，每隔几毫秒更新一次样式。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="43a4" class="ma mb iq lv b gy mc md l me mf">setInterval(() =&gt; {<br/>  // animation code<br/>}, time);</span></pre><p id="fafa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一种方法是创建一个循环，在动画运行时尽可能频繁地改变样式。这两种方法背后的逻辑是给浏览器大量的动画帧，并希望它呈现平滑的运动。</p><p id="92a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里的问题是，为了让动画流畅，浏览器绘制帧的速度往往要快于屏幕显示帧的速度(大多数计算机屏幕的刷新率为每秒60帧或<em class="mg"> FPS </em>，最近一次才开始以更高的频率120FTP出现)。这导致不必要的计算。</p><p id="a144" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe ls lt lu lv b">setInterval</code>或<code class="fe ls lt lu lv b">setTimeout</code>的另一个问题是，即使用户看不到页面，动画也会继续运行。</p><p id="e8d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事实上，每秒显示的帧数越少越好，但要保持这个数字不变。我们的眼睛察觉到频率的微小偏差，每秒丢几帧比丢几帧更伤眼睛。这就是内置HTML5 <code class="fe ls lt lu lv b">requestAnimationFrame</code> API的用武之地。</p><h1 id="0fd8" class="mh mb iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">关于requestAnimationFrame</h1><p id="4092" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated"><code class="fe ls lt lu lv b">requestAnimationFrame</code>是一个API，它做的正是你所希望的:它把安排动画绘制的责任直接交给浏览器。</p><p id="844a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">浏览器可以做得更好，因为它知道浏览器内部发生了什么。RequestAnimationFrame是W3C对基于脚本的动画API 的<a class="ae kv" href="https://github.com/w3c/web-performance/" rel="noopener ugc nofollow" target="_blank">时序控制的一部分。</a></p><p id="9a75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">语法:</strong></p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="607e" class="ma mb iq lv b gy mc md l me mf">window.requestAnimationFrame(callback);</span></pre><p id="5bc7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">callback</code>:在下次重画时更新动画时调用的函数。</p><h1 id="df2f" class="mh mb iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated"><strong class="ak">优点</strong>请求动画帧</h1><ul class=""><li id="2312" class="nd ne iq ky b kz my lc mz lf nf lj ng ln nh lr ni nj nk nl bi translated">当帧速率保持不变时，动画看起来更平滑。</li><li id="ba07" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">处理器不会因渲染任务而过载，但可以在渲染动画的同时处理其他任务。一般而言，浏览器可以确定对于浏览器在播放动画的同时执行的任务而言最佳的每第二级的帧。</li><li id="47f5" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">使用监视器上图像的刷新率，该参数决定监视器显示一个新帧需要多长时间。</li><li id="31f2" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">如果当前浏览器选项卡不再是焦点，requestAnimationFrame将停止执行动画操作。</li></ul><h1 id="f235" class="mh mb iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">你如何开始和停止动画</h1><p id="7abe" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated"><strong class="ky ir"> requestAnimationFrame </strong>返回一个可以用来取消它的ID。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h2 id="cc87" class="ma mb iq bd mi nt nu dn mm nv nw dp mq lf nx ny ms lj nz oa mu ln ob oc mw od bi translated">浏览器支持</h2><p id="a311" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">浏览器对<code class="fe ls lt lu lv b"><a class="ae kv" href="https://caniuse.com/requestanimationframe" rel="noopener ugc nofollow" target="_blank"><em class="mg">requestAnimationFrame</em></a></code>的支持相当不错。在所有现代浏览器中受支持在以下版本的浏览器中提供全面支持:</p><ul class=""><li id="3fc4" class="nd ne iq ky b kz la lc ld lf oe lj of ln og lr ni nj nk nl bi translated">Opera:从版本15开始无前缀</li><li id="b3ef" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">Chrome:从版本24开始就没有修正过</li><li id="682d" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">Safari:从版本6.1开始无前缀</li><li id="6c06" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">Firefox:从11版开始带有前缀，从23版开始完整</li><li id="c8ce" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">Edge:从版本12开始</li><li id="31d1" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">IE:从版本10开始</li></ul><p id="0234" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是如果需要支持老版本的浏览器，可以用<code class="fe ls lt lu lv b"><a class="ae kv" href="https://gist.github.com/paulirish/1579671" rel="noopener ugc nofollow" target="_blank">polyfill</a></code>。当然，你不会在浏览器中看到新API的好处，但随着动画在其中工作，通过传统的定时器功能。</p><h1 id="53ba" class="mh mb iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">使用requestAnimationFrame的示例</h1><p id="a890" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">既然你已经理解了<code class="fe ls lt lu lv b">requestAnimationFrame</code>的好处，让我们来看看如何使用它。</p><p id="b54b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为一个例子，考虑太阳系的行星围绕太阳旋转的动画。我们将使用按钮开始、停止和重置我们的动画。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/1873e5c4c0345226b18b5272f2e67b26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdLf4NUI3IQINcbnwl-YnQ.png"/></div></div></figure><p id="20ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从创建一个脚本开始，我们需要做的第一件事是为每个星球创建参数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="f3ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们需要使用构造函数、计算新位置的方法和重置函数为每个行星创建一个对象:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="c0e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们需要创建我们的行星，并计算起始位置。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="bc4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们需要创建一个函数来动画我们的星球，如上所述，我们需要使用<code class="fe ls lt lu lv b">requestAnimationFrame</code>递归调用动画函数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="fd09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们为启动、停止和重置动画的按钮创建事件处理程序。它不一定是按钮，你可以给任何东西添加处理程序</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="0284" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的脚本已经准备好了，包括Html和CSS的完整代码可以在<a class="ae kv" href="https://codepen.io/roman9131/pen/rNJoMrX" rel="noopener ugc nofollow" target="_blank"> Codepen </a>上查看。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi ns l"/></div></figure><h1 id="a77b" class="mh mb iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">最终注释</h1><p id="276c" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">我们已经讨论了<code class="fe ls lt lu lv b">requestAnimationFrame</code>方法如何让开发者为他们的网站创建流畅的JavaScript动画变得非常容易。</p><p id="c39d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过将动画帧委托给浏览器，您可以利用一些优化，所有这些都可以减少资源的使用。如何在所有浏览器中成功地使用它。</p><p id="d7db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您阅读这篇文章。我希望这对你有帮助。</p></div></div>    
</body>
</html>