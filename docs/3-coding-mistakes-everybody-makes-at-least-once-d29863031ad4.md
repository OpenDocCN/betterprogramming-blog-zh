# 3 编码错误每个人至少都会犯一次

> 原文：<https://betterprogramming.pub/3-coding-mistakes-everybody-makes-at-least-once-d29863031ad4>

## 从别人的错误中吸取教训

![](img/68a0d61855e7f102c17efccfcec1a126.png)

丽塔·莫莱斯在 [Unsplash](https://unsplash.com/s/photos/crash?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片

说到软件，我们都可以看到它运行得相当流畅。在过去十年中，应用程序的质量显著提高。强大且设计良好的框架给了工程师很大的帮助。它们还警告和阻止开发人员将要执行的危险操作。有了这样的工具，最终产品出现问题的可能性就降到了最低。

目前的现状是有原因的。开发人员经常犯某些错误，所以他们想出了充当安全网的工具。尽管有工具来防止，其中一些错误仍然有可能犯。很可能，你最近也至少有过一次。

# 在 UI 线程上运行

我个人在作为专业开发人员的第一年经常陷入这种陷阱。我在为桌面和移动平台开发应用程序。作为一名应届毕业生，我不认为这是一个问题。我的应用程序启动并从文件中读取数据。没什么大不了的，谁在乎两秒钟的开始时间？

然后事情就有了滚雪球效应。随着时间的推移，我们会在应用程序启动时添加越来越多的初始化操作。这正是我参与的一个项目的情况。仅在两个月内，初始化文件就变得更大，并具有复杂的数据结构。我们开始做更多的手术。我们需要填充数据库，加载可视资产，进行计算。

因此，该应用程序在一台高端计算机上启动大约需要 15 秒钟。我很抱歉我们的客户使用功率较小的机器。最糟糕的是，在此期间，应用程序没有响应。这都是由于在 UI 线程上运行操作。用户界面只是忙着做繁重的任务，而不是处理用户动作。一旦应用程序启动，我们必须等待，直到它完成加载。

对我来说，这是一个学习如何使用后台线程以及 UI 线程的目的是什么的艰难途径。

# 回调地狱

函数式编程范式给了工程师一种新的编写代码的方式。它更小、更简单、更易读。广泛的可识别功能对此很有帮助。看看下面的例子就知道了。

然而，如果使用得当，所有这些看起来都很漂亮。当有 10 个或更多嵌套层次的函数时，大灾难就来了。阅读和调试代码变得很困难。

这是 Javascript 中最常见的问题之一，但在任何编程语言中都可能发生。甚至有一个专门的[网站](http://callbackhell.com/)来解决这个问题，提供如何避免和解决它的建议。

最好的建议是将代码放在小函数中。各种模块中有组织的功能将使可以在其他地方重用的组件解耦。

每个开发人员都有一个诱惑，那就是让所有的部分彼此更加接近。一旦他们意识到这是不可持续的，他们的思维就会进入一个新的层次。

# 低效的 SQL 查询

许多解决方案都使用数据库。几乎每个 web 应用程序都会收集用户数据，并需要将它们存储在某个地方。移动应用程序也组织数据库中的结构化数据。开发人员很乐意应用它们。SQL 查询易于阅读。此外，对象关系映射(ORM)允许将查询编写成代码。

然而，工程师们不断陷入低效查询的陷阱。在只有几项记录的规模上，我们看不到任何问题。然而，当结果是几百万条记录的数据库中的几百条记录时，情况就完全不同了。性能会急剧下降。

例如，我经常犯的一个错误是“N+1 查询”。当在与其他表有关系的表上运行查询时，可能会出现这种情况。惰性加载在这里有负面影响。因为对于结果中的每条记录，都将执行另一个额外的查询。

为了更好地理解问题，我们假设我们的数据库有两个表:`Employee`和`Company`。他们是一对多的关系，因为一个员工只能为一个公司工作，而公司可以有很多员工。以下 SQL 查询可能会在数据加载缓慢的框架中导致此问题。

```
SELECT * FROM Company WHERE Employee.name = "James"
```

如果查询返回 200 家公司，其雇员姓名为 James，那么总共将运行 200 个额外的查询。它们中的每一个都加载了每个雇员的信息。因此，我们总共收到 201 个查询。

不同的框架和库提供了解决这个问题的多种方法。但是有经验的开发人员可以马上发现这些问题。

# 外卖食品

> 智慧不是学校教育的产物，而是终生努力获得的产物。
> 
> ——阿尔伯特·爱因斯坦

有时候我们需要自己犯错来接受新知识。这是我们向前迈进并防止它们在未来发生的唯一途径。做的时候不要难过。历史上没有人一生中没有犯过任何错误。