<html>
<head>
<title>The Cloudflare Stack: The Performant, Cost-Effective, Zero-Maintenance Way To Build Your Serverless Web Apps in 2023</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">cloud flare Stack:2023年构建无服务器Web应用的高效、经济、零维护方式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-cloudflare-stack-the-performant-cost-effective-zero-maintenance-way-to-build-your-apps-93433a63ead8?source=collection_archive---------3-----------------------#2022-11-23">https://betterprogramming.pub/the-cloudflare-stack-the-performant-cost-effective-zero-maintenance-way-to-build-your-apps-93433a63ead8?source=collection_archive---------3-----------------------#2022-11-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4b19" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Cloudflare不断扩大的云计算产品范围为开发人员提供了更少的妥协和难以置信的新机会</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/af4de8597b2c86b816b8003baa3b9e52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MRDSZkG5RemdubdI5JDvQg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">面向Cloudflare工作人员的产品页面</p></figure><p id="65af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">2012年11月26日更新:添加了关于Cloudflare Workers和Cloudflare页面语言支持的信息</em></p><p id="0ebe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">无服务器计算的承诺始终是部署无维护负担、低成本且可立即扩展的应用程序。然而，在实践中，重大问题总是让它变得不那么令人信服。对供应商锁定、与关系数据库的不良集成、冷启动和大规模高成本的担忧，都导致无服务器产品变得有点像只适合特定用例的利基产品。</p><p id="f75e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，近年来，Cloudflare对构建全栈云计算平台的尝试终于使我们更接近于实现无服务器的最初承诺。基于他们的边缘计算网络的能力，我们终于看到了无服务器，它可以提供性能、成本效益和低维护的组合。</p><h1 id="ebc3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">边缘计算的魔力</h1><p id="07e2" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">Cloudflare存在的基础是其边缘计算网络，计算能力分布在世界各地，因此您可以尽可能靠近您的用户提供内容和运行代码。这为Cloudflare众所周知的长期运行的内容交付网络(CDN)提供了动力，也是他们后来构建云产品的基础。</p><p id="3c28" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这对他们的云平台意味着什么？您的代码/内容/数据将始终由离您的用户最近的服务器提供，而不是将资源部署到特定的区域。您可以获得令人难以置信的全球范围的性能，而无需担心在多个地区部署应用或资源的运营负担，或者手动扩展资源以满足需求。</p><p id="05d4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与其他无服务器平台相比，这一关键设计特性使得Cloudflare的许多产品如此引人注目和独特。让我们回顾一下这对他们的一些产品意味着什么，并讨论一些利弊。</p><h1 id="0ce6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Cloudflare的服务</h1><h2 id="a402" class="ms lw it bd lx mt mu dn mb mv mw dp mf lh mx my mh ll mz na mj lp nb nc ml nd bi translated">云闪工人</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/33c4c3c171297b79988b7ae4cb4745d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bClU25QFsfiTnkQxAjAqeg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Cloudflare工作人员登录页面</p></figure><p id="3a07" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Cloudflare向构建全栈云计算平台的演进始于Workers，即其无服务器功能产品。基于Cloudflare的边缘计算网络，它不像AWS Lambda和Google Cloud函数那样以基于容器的方式运行代码。相反，Cloudflare Workers作为V8隔离(如Chrome的JavaScript引擎)运行，这些隔离的JavaScript片段可以在没有容器的情况下运行，基于Web平台API(现代浏览器中可用的标准化API)而不是Node.js。这意味着令人难以置信的快速性能和零冷启动，因为您不需要等待容器启动来服务请求。这解决了一个关键的性能问题，这个问题从一开始就困扰着许多无服务器计算平台。</p><h2 id="8f93" class="ms lw it bd lx mt mu dn mb mv mw dp mf lh mx my mh ll mz na mj lp nb nc ml nd bi translated"><strong class="ak">这种架构的优势如下:</strong></h2><ul class=""><li id="543f" class="nf ng it la b lb mn le mo lh nh ll ni lp nj lt nk nl nm nn bi translated">零冷启动</li><li id="01e3" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">由于Cloudflare的边缘网络，代码将始终在离用户最近的地方运行，从而带来最佳性能，无需任何开发人员配置或干预</li><li id="156f" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">使用符合标准的Web平台API意味着您的无服务器功能是可移植的，减少了供应商锁定(Cloudflare Workers运行时也是<a class="ae nt" href="https://github.com/cloudflare/workerd" rel="noopener ugc nofollow" target="_blank">开源的</a>，这意味着如果您愿意，您可以自托管Workers)</li></ul><h2 id="abf5" class="ms lw it bd lx mt mu dn mb mv mw dp mf lh mx my mh ll mz na mj lp nb nc ml nd bi translated"><strong class="ak">但是，也有明显的缺点:</strong></h2><ul class=""><li id="5892" class="nf ng it la b lb mn le mo lh nh ll ni lp nj lt nk nl nm nn bi translated">不支持V8之外的其他运行时，<a class="ae nt" href="https://developers.cloudflare.com/workers/platform/languages/" rel="noopener ugc nofollow" target="_blank">对JavaScript和TypeScript之外的语言的支持</a>只对编译成JavaScript或编译成WebAssembly的语言可用</li><li id="0802" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">没有Node.js支持意味着工人只能兼容NPM包的一小部分</li><li id="0c7b" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">因为代码不在沙盒容器中运行，所以您不能直接建立TCP连接(例如，到PostgreSQL数据库)，而是需要通过基于HTTP的代理运行请求</li></ul><p id="a7ac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尽管有这些限制，最近的一些发展已经极大地改变了这个等式。Deno等基于Web平台API的运行时的兴起，以及ESM (ES模块)在JavaScript生态系统中日益普遍的使用，使得流行的JavaScript库支持Workers等运行时变得更加普遍。</p><p id="7ed3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二个主要发展是Cloudflare现在正在构建一整套无服务器云产品来补充工作人员，使您无需离开平台即可轻松构建全栈应用程序。</p><h1 id="f9cb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Cloudflare页面</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/5abaf881e665a082ff6b20aab220d0dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LY3CIZHGht1Ze7MB2fQGeg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Cloudflare页面登录页面</p></figure><p id="317f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Cloudflare Pages是一个前端部署平台，您的前端可以立即部署到Cloudflare的边缘网络中。鉴于类似的服务已经存在，如Vercel和Netlify，这并不是一个独特的服务。您可以获得类似Vercel的功能，如自动部署、预览构建、部署到边缘网络，以及无服务器功能的全栈支持。</p><p id="7026" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，Pages的真正价值主张是它位于Cloudflare的边缘网络上和Cloudflare的云堆栈中。您拥有网络的性能和可靠性，世界上一些最大的网站通过该网络运行其流量，并且与Cloudflare的其他优秀云服务相集成。</p><h2 id="199a" class="ms lw it bd lx mt mu dn mb mv mw dp mf lh mx my mh ll mz na mj lp nb nc ml nd bi translated"><strong class="ak">优点:</strong></h2><ul class=""><li id="3831" class="nf ng it la b lb mn le mo lh nh ll ni lp nj lt nk nl nm nn bi translated">您的前端位于Cloudflare出色的边缘网络上，这意味着出色的性能</li><li id="e03f" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">可以通过Pages函数(基于Cloudflare Workers)将无服务器功能部署为您前端的一部分，用于构建全栈应用</li><li id="4883" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">请求数量或带宽没有上限</li></ul><h2 id="25e7" class="ms lw it bd lx mt mu dn mb mv mw dp mf lh mx my mh ll mz na mj lp nb nc ml nd bi translated"><strong class="ak">缺点:</strong></h2><ul class=""><li id="8357" class="nf ng it la b lb mn le mo lh nh ll ni lp nj lt nk nl nm nn bi translated">您可能无法将您喜爱的框架、UI组件或库与全栈Cloudflare页面一起使用(由于Cloudflare Workers中缺少Node.js支持)。对于没有后端组件或服务器端渲染的项目来说，这<strong class="la iu">不是</strong>问题，因为这些项目不能在Cloudflare Workers上运行。Cloudflare Pages将很乐意用各种各样的语言和运行时(包括Node.js)构建一个前端专用项目。</li><li id="38c9" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">对Next.js的支持仍处于早期阶段，即使构建完成，Vercel与框架的深度集成可能仍会更加引人注目</li></ul><h1 id="54b8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">D1: Cloudflare的无服务器数据库</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/0a20d561e96bf07f35e0935d2a109444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6tKRwJDEUKEi7HqR7UuT5g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Cloudflare博客上的D1帖子</p></figure><p id="e193" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Cloudflare工作人员无法通过TCP直接连接到数据库，这使得Cloudflare堆栈中的数据库非常有限。为了帮助缓解这一问题，并为员工提供一个集成良好的数据库解决方案，Cloudflare最近发布了他们的D1 SQL数据库服务。</p><p id="87d7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">按照通常的Cloudflare方式，它是基于其边缘计算网络的无服务器产品。该服务建立在SQLite上，这是一个非常轻量级的SQL数据库，可以作为一个文件运行(它非常轻，甚至可以在嵌入式和移动设备上运行)。</p><p id="56af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这种架构意味着D1可以提供一些非常不可思议的功能，并且没有维护负担，也不需要担心长期运行的服务器。这些功能包括自动读取复制和冗余，以及带恢复功能的自动备份。</p><p id="e3b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">没有区域可供选择，没有要启用的复制，也没有要扩展的数据库服务器。开箱即可获得全球范围的性能。对于传统数据库来说，这种功能要么成本高昂，要么价值不菲。而且，因为D1是基于SQLite，一个开源数据库，你的数据库仍然是完全可移植的，如果你选择把它移到其他地方。</p><h2 id="8b42" class="ms lw it bd lx mt mu dn mb mv mw dp mf lh mx my mh ll mz na mj lp nb nc ml nd bi translated"><strong class="ak">优点:</strong></h2><ul class=""><li id="8c44" class="nf ng it la b lb mn le mo lh nh ll ni lp nj lt nk nl nm nn bi translated">全球范围的开箱即用性能，无需额外配置</li><li id="ed03" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">由于基于SQLite，该数据库是完全可移植的。你可以很容易地进出D1。</li></ul><h2 id="4316" class="ms lw it bd lx mt mu dn mb mv mw dp mf lh mx my mh ll mz na mj lp nb nc ml nd bi translated"><strong class="ak">缺点:</strong></h2><ul class=""><li id="4c33" class="nf ng it la b lb mn le mo lh nh ll ni lp nj lt nk nl nm nn bi translated">D1只能从Cloudflare工作人员内部访问，目前还不清楚这种情况是否会改变。允许在Cloudflare之外访问D1数据需要用Cloudflare Workers构建一个面向公众的API。</li><li id="831e" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">SQLite不像Postgres等其他SQL风格那样功能齐全</li></ul><p id="7321" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">D1目前在阿尔法。上面提到的一些功能仍在开发中，可能会有变化。</p><h1 id="7ed7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">R2</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/a7a98f320a2062e11318d18ef968913a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ptUZ0lZn0GHUxY31o6SGGQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Cloudflare R2产品页面</p></figure><p id="11ec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">R2是Cloudflare的存储产品，使用AWS S3兼容API构建。R2在其存储竞争对手中解决的最大问题是消除出口费用。对离开提供商云网络的数据收取出口费。传统上，这意味着您不仅要为写入、读取和存储付费，还要为每次数据发送到任何地方付费。</p><p id="b991" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这不仅会导致您为数据支付两次费用，还会阻碍您将数据转移到不同的提供商(因为要将所有数据转移到当前提供商的网络之外，您必须支付高昂的费用)。几年来，Cloudflare一直致力于通过他们的<a class="ae nt" href="https://www.cloudflare.com/bandwidth-alliance/" rel="noopener ugc nofollow" target="_blank">带宽联盟</a>来降低和消除出口费用，并且现在已经通过他们自己的存储产品做到了这一点。</p><h2 id="16be" class="ms lw it bd lx mt mu dn mb mv mw dp mf lh mx my mh ll mz na mj lp nb nc ml nd bi translated"><strong class="ak">优点:</strong></h2><ul class=""><li id="c4bb" class="nf ng it la b lb mn le mo lh nh ll ni lp nj lt nk nl nm nn bi translated">对于频繁访问的数据，比S3便宜得多</li><li id="d1dc" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">没有出口费</li><li id="96b6" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">与Cloudflare Workers直接集成</li><li id="f330" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">与S3兼容的API</li><li id="cb33" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">不需要为每个桶选择一个区域。未来，这将允许R2自动分析数据访问模式，以优化数据存储位置。</li></ul><h2 id="4f76" class="ms lw it bd lx mt mu dn mb mv mw dp mf lh mx my mh ll mz na mj lp nb nc ml nd bi translated"><strong class="ak">缺点:</strong></h2><ul class=""><li id="cfaf" class="nf ng it la b lb mn le mo lh nh ll ni lp nj lt nk nl nm nn bi translated">与S3相比，可用的配置选项有限</li><li id="9415" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">不完全等同于S3的API</li><li id="19f4" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">无存档存储率(对于不常访问的数据，S3可能会更便宜)</li></ul><h1 id="9f37" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="9a68" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">Cloudflare的产品现在首次允许您完全在其生态系统内构建全栈应用。虽然一些产品仍然很年轻，有明显的局限性，但Cloudflare的架构使无服务器计算的最初承诺比以往任何时候都更加真实。虽然这个堆栈对每个应用程序都没有意义，但今天许多应用程序都可以从中受益。整个平台也在快速发展，不断增加新的服务和功能。</p><p id="c9cd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我认为Cloudflare的总体愿景是许多开发人员都可以接受的。他们没有尝试在墙上贴上云服务，也没有尝试在服务上与更大的云竞争对手相匹敌，而是构建了一些经过精心设计的服务，旨在解决特定的开发人员痛点。</p><p id="0997" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我认为，还有其他一些价值使它们比其他平台对开发者更友好。作为一家公司，Cloudflare做出了巨大努力，以比竞争对手更具成本效益。他们的服务通常不收取外出费，他们的定价极具竞争力，他们的定价等级通常比竞争对手更宽松。</p><p id="d674" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">他们也一直在更广泛的开发者生态系统和他们自己的产品中推动开放标准。如上所述，Cloudflare的许多产品都以这种方式专门减轻了对供应商锁定的担忧。</p><p id="3740" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您对无服务器计算感兴趣，但对已经存在的东西不感兴趣，那么值得看看Cloudflare。虽然堆栈不会适用于所有用例，尤其是在今天的早期阶段，但我认为它可以为正确的应用程序提供大量价值。即使它现在对你不起作用，但它快速进化的本性意味着它很快就会起作用。</p></div></div>    
</body>
</html>