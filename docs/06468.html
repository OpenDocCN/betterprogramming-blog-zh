<html>
<head>
<title>A Brief Intro to Ahead-of-Time (AOT) Compilation in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular中超前(AOT)编译简介</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-brief-intro-to-ahead-of-time-aot-compilation-in-angular-f13517592cce?source=collection_archive---------3-----------------------#2020-10-05">https://betterprogramming.pub/a-brief-intro-to-ahead-of-time-aot-compilation-in-angular-f13517592cce?source=collection_archive---------3-----------------------#2020-10-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7132" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">AOT编译的来龙去脉</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7a3d8eb4ea0a301e20b02056ebcab244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oJUyARXAtnDEPY-z"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@icons8?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Icons8团队</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="857f" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">介绍</h1><p id="dd5e" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Angular代码主要由HTML模板和TypeScript组件组成，但是对于要在浏览器中运行的Angular应用程序来说，它们必须被编译成JavaScript代码。</p><p id="f280" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">将Angular代码编译成JavaScript主要有两种方法。</p><ol class=""><li id="ca92" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">实时(JIT)编译—这是指运行时在浏览器中编译代码。</li><li id="fd7b" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">提前(AOT)编译——这是将代码编译作为构建过程的一部分，因此得名<em class="nn">提前</em>。</li></ol><p id="a6ad" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">从Angular版本9开始，默认选择的编译是AOT。这意味着，每当您使用命令<code class="fe no np nq nr b">ng build --prod</code>构建用于生产的Angular应用程序时，该应用程序也将作为构建过程的一部分被编译。</p><p id="92c2" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">注:</strong>对于Angular版本8及更早版本，要使用AOT进行编译，使用命令<code class="fe no np nq nr b">ng build --prod --aot=true</code>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="716e" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">AOT编译的优势</h1><p id="2e08" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在这个阶段，你可能想知道AOT能提供什么。下面是AOT编译优于JIT编译的一些优点。</p><ul class=""><li id="8cb6" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ns nf ng nh bi translated">更快地渲染您的Angular应用程序——使用AOT，代码在构建过程中编译。因此，浏览器加载准备好立即呈现的可执行代码。非常快！</li><li id="bc64" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ns nf ng nh bi translated">更小的Angular应用程序大小——不需要下载Angular编译器，因为应用程序已经编译好了。如果像JIT一样在运行时在浏览器中进行编译，Angular应用程序将与Angular编译器一起发布。编译器的大小大约是Angular本身的一半。很重吧？</li><li id="3c6c" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ns nf ng nh bi translated">更好的代码质量——这是因为模板错误在应用程序编译的早期就被检测出来，作为构建过程的一部分。</li><li id="11e3" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ns nf ng nh bi translated">更安全、更健壮的应用程序——这是因为HTML模板和TypeScript组件在运行时不会在浏览器中进行动态评估。这导致注入攻击的机会减少。</li></ul></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="cca0" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">AOT是如何运作的</h1><p id="4c62" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Angular Ivy是Angular版本9和更新版本中新的编译和渲染管道。Angular Ivy与它的前辈View Engine相比，速度超快，效率高。</p><p id="a51c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">编译过程中会发生的主要事情是代码的树抖动、捆绑、丑化和缩小。此外，编译器移除了特定于Angular的装饰符、构造函数参数和未使用的代码。</p><p id="6e13" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">编译分为三个主要阶段，如下所示:</p><h2 id="394d" class="nt lh it bd li nu nv dn lm nw nx dp lq mh ny nz ls ml oa ob lu mp oc od lw oe bi translated">1.代码分析</h2><p id="08cb" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这是编译器分析角度特定元数据的地方，例如<code class="fe no np nq nr b">@Component()</code>和<code class="fe no np nq nr b">@Input()</code> <strong class="ma iu"> <em class="nn">。</em> </strong>元数据为Angular提供了构建应用程序实例所需的信息，例如，如何创建一个组件并生成其可视化表示。Angular代表了<code class="fe no np nq nr b">.metadata.json</code>文件中装饰元数据的整体结构。</p><p id="9ac0" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在这个阶段还会检测和记录元数据语法违规错误。</p><p id="a2cc" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">代码分析阶段的主要输出之一是类型定义文件，其扩展名为<code class="fe no np nq nr b">.d.ts</code>。<strong class="ma iu"><em class="nn"/></strong>AOT编译器使用这些文件生成应用程序代码。一个示例<code class="fe no np nq nr b">.d.ts</code>文件如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/5048dc71a3316dcaf5c7bb760ca07a96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*533MOpza2n62RROmKRFbXQ.png"/></div></div></figure><h2 id="9902" class="nt lh it bd li nu nv dn lm nw nx dp lq mh ny nz ls ml oa ob lu mp oc od lw oe bi translated">2.代码生成</h2><p id="7a6b" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在编译的第二阶段，编译器将解释上面第一阶段产生的<code class="fe no np nq nr b">.metadata.json</code>文件的输出。它还将检查元数据的语义是否符合编译器规则。</p><p id="f4c5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">元数据重写是这个阶段的另一个关键步骤。例如，如果在元数据表达式中发现了箭头函数，代码生成阶段会将该函数重写为对编译器更友好的形式。</p><h2 id="a32a" class="nt lh it bd li nu nv dn lm nw nx dp lq mh ny nz ls ml oa ob lu mp oc od lw oe bi translated">3.模板类型检查</h2><p id="1b25" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">编译的最后阶段与Angular模板有很大关系，即保存HTML代码的文件。在这个阶段，编译器将对表达式进行类型检查，这样它们就不会在运行时导致崩溃。</p><p id="0654" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">Angular编译器还利用TypeScript编译器来验证模板中的绑定表达式。当检测到类型错误时，模板验证会产生适当的错误消息。</p><p id="01dd" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">注意:</strong>有了Angular Ivy，模板检查器比它的前身视图引擎要严格一点。因此，一些在View Engine中编译的带有类型检查错误的模板在Angular Ivy中可能不会这样做。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="5b65" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">AOT的小缺点</h1><p id="2218" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">AOT汇编提供的优势远远超过其缺点。然而，意识到AOT的一些小问题是件好事。</p><ul class=""><li id="a8ed" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ns nf ng nh bi translated">与JIT编译相比，如果使用AOT编译，DevOps构建管道或本地构建通常会花费更长的时间。</li><li id="4abc" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ns nf ng nh bi translated">AOT不支持元数据表达式中的arrow或lambda函数和函数表达式。如果您碰巧在元数据表达式中有这样的函数，则在编译的分析阶段会生成一个错误。<strong class="ma iu">注意</strong>:Angular的新版本会尝试自动为你做这个转换。</li></ul></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="f4e0" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">结论</h1><p id="4cab" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">用Angular Ivy进行AOT编译速度非常快，为开发人员的工作流程提供了许多好处。</p><p id="9a49" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">最后，AOT提供了一种有效的方式来编译你的角度代码，从而产生健壮、安全和精简的应用程序。</p></div></div>    
</body>
</html>