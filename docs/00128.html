<html>
<head>
<title>How To Get Angular and Nginx Working Together Properly for Development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何让Angular和Nginx在开发中正常工作</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-properly-get-angular-and-nginx-working-together-for-development-3e5d158734bf?source=collection_archive---------0-----------------------#2018-05-06">https://betterprogramming.pub/how-to-properly-get-angular-and-nginx-working-together-for-development-3e5d158734bf?source=collection_archive---------0-----------------------#2018-05-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4ad8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也许你想开始使用虚拟机开发或学习Angular。也许你已经安装了Nginx，并想使用Nginx为你的Angular应用服务。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/ab32e1bd01e4fb433af07564739038b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*zZlWOzff-BBNC2r4dvJ0bg.png"/></div><p class="kt ku gj gh gi kv kw bd b be z dk translated">徽标版权归谷歌(<a class="ae kx" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank">https://angular.io/</a>)和Nginx(<a class="ae kx" href="https://www.nginx.com/" rel="noopener ugc nofollow" target="_blank">https://www.nginx.com/</a>)所有</p></figure><p id="71b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">遵循<a class="ae kx" href="https://angular.io/guide/setup-local" rel="noopener ugc nofollow" target="_blank"> Angular快速入门指南</a>创建您的应用<code class="fe ky kz la lb b">your-app</code>。以下步骤将允许<code class="fe ky kz la lb b">ng serve</code>和<code class="fe ky kz la lb b">nginx</code>一起正常工作。</p><blockquote class="lc ld le"><p id="f870" class="jn jo lf jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated"><em class="iq">按照指南，我把一个</em> <code class="fe ky kz la lb b"><em class="iq">nginx.conf</em></code> <em class="iq">文件放在我的项目里面</em> <code class="fe ky kz la lb b"><em class="iq">/your-app/config/nginx.conf</em></code> <em class="iq">下面，并把它和</em> <code class="fe ky kz la lb b"><em class="iq">/etc/nginx/sites-enabled/your-app.conf</em></code> <em class="iq">链接起来。</em></p></blockquote></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><h1 id="68ad" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">务实的方式</h1><p id="0a7a" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">起初，你可能会发现自己说，<em class="lf">容易。将您的</em> <code class="fe ky kz la lb b"><em class="lf">/dist</em></code> <em class="lf">文件夹作为</em> <code class="fe ky kz la lb b"><em class="lf">root</em></code> <em class="lf">放入您的Nginx配置中，并使用</em> <code class="fe ky kz la lb b"><em class="lf">ng build</em></code> <em class="lf">来更新构建。你现在所要做的就是在浏览器中点击F5，然后你就可以开始了。</em></p><p id="2537" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下配置打开您的应用程序:</p><pre class="km kn ko kp gt mt lb mu mv aw mw bi"><span id="2927" class="mx lr iq lb b gy my mz l na nb">server {<br/>    listen 80;<br/><br/>    server_name your.app;<br/>    root /vagrant/your.app/dist/your.app</span><span id="1c6f" class="mx lr iq lb b gy nc mz l na nb">    location / {<br/>        try_files $uri $uri/ /index.html;<br/>    }<br/>}</span></pre><p id="1cfc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在对源代码进行修改后，您必须再次运行<code class="fe ky kz la lb b">ng build</code>。如果您的源代码发生变化，您可能希望使用<code class="fe ky kz la lb b">--watch</code>参数来允许构建重新运行。在您的主机上调用<code class="fe ky kz la lb b">http://your.app</code>工作正常。</p><p id="fb52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用虚拟机时，您可能会发现更新hosts文件以将<code class="fe ky kz la lb b">your.app</code>映射到<code class="fe ky kz la lb b">localhost</code>会很有帮助。</p></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><h1 id="ab30" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">更好的方法</h1><p id="1574" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">有一个更好的方法可以让你的浏览器在你修改后自动重新加载:<code class="fe ky kz la lb b">ng serve</code>将运行一个本地服务器(默认为<code class="fe ky kz la lb b">http:/localhost:4200</code>)并将Angular编译后的源代码直接提供给你的浏览器。</p><p id="da1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Nginx配置与上面的类似；但是，你必须做出调整。您需要使用<code class="fe ky kz la lb b">proxy_pass</code>来实际调用<code class="fe ky kz la lb b">localhost:4200</code>上的内部运行节点服务器。</p><pre class="km kn ko kp gt mt lb mu mv aw mw bi"><span id="7c1d" class="mx lr iq lb b gy my mz l na nb">server {<br/>    listen 80;<br/><br/>    server_name your-app;<br/><br/>    location / {<br/>        proxy_pass       http://localhost:4200;<br/>        proxy_set_header Host            $host;<br/>    }<br/>}</span></pre><p id="3557" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保使用<code class="fe ky kz la lb b">--public-host http://your.app</code>参数运行<code class="fe ky kz la lb b">ng serve</code>，否则应用程序将拒绝启动。</p><p id="d067" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重启<code class="fe ky kz la lb b">nginx</code>后，在你的主机上打开浏览器，你的应用应该可以看到了。</p><h1 id="8480" class="lq lr iq bd ls lt nd lv lw lx ne lz ma mb nf md me mf ng mh mi mj nh ml mm mn bi translated">WebSocket问题</h1><p id="18f6" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">打开控制台后，您可能会看到如下错误:</p><blockquote class="lc ld le"><p id="2fd4" class="jn jo lf jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated"><em class="iq"> WebSocket连接到“ws://your-app/sock js-node/884/1u 4 qfrnl/WebSocket”失败:web socket握手期间出错:意外响应代码:400 </em></p></blockquote><p id="324f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是因为<a class="ae kx" href="https://en.wikipedia.org/wiki/WebSocket" rel="noopener ugc nofollow" target="_blank"> WebSockets </a>使用了两个HTTP头，即<code class="fe ky kz la lb b">Connection</code>和<code class="fe ky kz la lb b">Upgrade</code>头。在将<code class="fe ky kz la lb b">nginx</code>配置为使用<code class="fe ky kz la lb b">proxy_pass</code>之后，您需要传递额外的头。</p><pre class="km kn ko kp gt mt lb mu mv aw mw bi"><span id="702f" class="mx lr iq lb b gy my mz l na nb">server {<br/>    listen 80;<br/><br/>    server_name your.app;<br/><br/>    location / {<br/>        proxy_pass       http://localhost:4200;<br/>        <strong class="lb ir">proxy_set_header Upgrade    $http_upgrade;</strong><br/>        <strong class="lb ir">proxy_set_header Connection $http_connection;</strong><br/>        proxy_set_header Host       $host;<br/>    }<br/>}</span></pre><p id="a874" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在此之后，您的控制台应该没有错误，并且在对源代码进行更改之后，浏览器应该会自动重新加载。</p></div></div>    
</body>
</html>