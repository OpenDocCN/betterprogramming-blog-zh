<html>
<head>
<title>Making iOS REST Integration Sweet With Swift 5 Codables and Generics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Swift 5代码和泛型使iOS REST集成变得更好</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/making-ios-rest-integration-sweet-with-swift-5-codables-and-generics-a4863e089a2?source=collection_archive---------6-----------------------#2019-12-07">https://betterprogramming.pub/making-ios-rest-integration-sweet-with-swift-5-codables-and-generics-a4863e089a2?source=collection_archive---------6-----------------------#2019-12-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7910" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们一起创建一个天气应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/29e565feb6a601ec7787ed0b5daf2f4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DoKIeJaqGxk5SLZBiZKE0Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@anjimenon?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">安贾娜·梅农</a>在<a class="ae kv" href="https://unsplash.com/s/photos/rain?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="e72c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开发一个带有几个REST集成点的iOS应用程序可能会变得非常单调、乏味和令人厌倦。</p><p id="0b2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将展示如何通过开发一个简单的天气应用程序来使REST集成变得有趣，这个天气应用程序带有一个名为<a class="ae kv" href="https://openweathermap.org/" rel="noopener ugc nofollow" target="_blank"> OpenWeather </a>的开放天气API。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0a93" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">让我们把手弄脏吧</h1><p id="1495" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">对于本教程，如果您想继续学习，您需要:</p><ul class=""><li id="1a71" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">Xcode 11.2.1+</li><li id="68c4" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">OpenWeather免费账号:<a class="ae kv" href="https://openweathermap.org/" rel="noopener ugc nofollow" target="_blank">https://openweathermap.org</a>。</li></ul><p id="4104" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了进行演示，我们将通过以编程方式构建用户界面来构建应用程序，如果您想使用它，我已经在GitHub 上添加了一个启动项目<a class="ae kv" href="https://github.com/AfroCyberGuy/StarterTemplate" rel="noopener ugc nofollow" target="_blank">，但是如果您更喜欢故事板方法，您可以在我们进行的过程中自由地这样做。</a></p><p id="03d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们想看看我们将要使用的天气API，现在你应该已经注册并获得了一个密钥。</p><p id="3d4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们希望根据我们提供给API端点的位置坐标获得当前天气的详细信息和预报。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="bd07" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">测试API</h1><p id="535a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">找一个你觉得舒服的REST测试应用，我更喜欢用<a class="ae kv" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>来测试我的REST请求和响应。</p><ul class=""><li id="5e7a" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated"><a class="ae kv" href="http://api.openweathermap.org/data/2.5/weather?lat=-17.745746&amp;lon=31.068936&amp;units=metric&amp;appid=YOURWEATHER_API_KEY" rel="noopener ugc nofollow" target="_blank">当前天气</a>。</li><li id="7367" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><a class="ae kv" href="http://api.openweathermap.org/data/2.5/forecast?lat=-17.745690&amp;lon=31.070690&amp;units=metric&amp;appid=YOURWEATHER_API_KEY" rel="noopener ugc nofollow" target="_blank">五天天气预报</a>。</li></ul><p id="648e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用上面的端点和API键，不要忘记在头中将content-type设置为JSON。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/ada3d3f9ee8fb450199d754c3b242378.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GBGKH3BF4gpvNhwEz4Hz0A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">邮递员</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="ca95" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">创建模型</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">当前天气.雨燕</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">天气预报</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="b63c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">可解码的解释</h1><p id="c05b" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">让我们简单看一下<code class="fe nn no np nq b">CurrentWeather.swift</code>结构，你可以看到它扩展了<code class="fe nn no np nq b">Decodable</code>类。</p><p id="d3d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这使得它能够将来自API的JSON响应数据映射到<code class="fe nn no np nq b">Object</code>类型，并且只需编写几行代码就可以轻松地访问JSON结构中的任何数据。</p><p id="d121" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，简而言之，<code class="fe nn no np nq b">Decodable</code>类是一种可以从外部表示(如JSON)中解码自身的类型。当我们解码JSON数据以确认我们的<code class="fe nn no np nq b">CurrentWeather</code>可解码结构时，每个结构中的私有枚举有助于获得JSON键名。</p><p id="3edd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，如果我们仔细看看之前从REST客户端获得的JSON响应和<code class="fe nn no np nq b">CurrentWeather</code> struct结构，我们可以看到当前的天气结构有嵌套的结构，JSON响应也有嵌套的JSON数据，所以每个结构代表一个JSON对象。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="a8b0" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">创建通用的REST处理函数</h1><p id="95aa" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">完美！既然我们已经准备好使用我们的天气JSON响应的<code class="fe nn no np nq b">Decodable</code>类，那么是时候创建一个方法来调用天气API，而不需要在我们想要调用REST请求时重写或粘贴它。</p><p id="1fbf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这允许我们不重复自己，也允许我们写干净和精益的代码。这就是我喜欢使用Swift泛型的原因，你马上就会看到。</p><p id="8a4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的项目结构中创建另一个名为<code class="fe nn no np nq b">Helpers</code>的组，创建一个空的Swift文件，并粘贴下面的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SmartRESTHelper.swift</p></figure><p id="edc1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的<code class="fe nn no np nq b">getWeatherData</code>泛型函数符合<code class="fe nn no np nq b">Decodable</code>的泛型类型，因为我们想要使用任何符合<code class="fe nn no np nq b">Decodable</code>类型的类，在我们的例子中是<code class="fe nn no np nq b">CurrentWeather</code>和<code class="fe nn no np nq b">ForecastWeather</code>结构。</p><p id="a881" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它接受一个URL字符串参数和一个完成处理程序，该处理程序返回一个泛型类型和<code class="fe nn no np nq b">NSError</code>。然后，它使用内置的<code class="fe nn no np nq b">NSUrlSession</code>方法发出网络请求。</p><p id="7200" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在收到请求后，如果没有错误，我们将数据转换成通用的可解码类型，如下所示。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="a9b6" class="nv ma iq nq b gy nw nx l ny nz">let obj = try JSONDecoder().decode(T.self, from: data)</span></pre><p id="139c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，在将JSON数据传递为可解码类型之后，我们将它添加到我们的完成处理程序中，我们将在视图控制器中使用该处理程序，以便于处理。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="90dc" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">常数</h1><p id="3be8" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">创建另一个名为<code class="fe nn no np nq b">Utils</code>的组，并将代码添加到下面的<code class="fe nn no np nq b">Constants.swift</code>和<code class="fe nn no np nq b">Controls.swift</code>中。我们现在需要它们，因为我们正前往视图控制器开始测试我们的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Constants.swift</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Controls.swift</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="58fd" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">测试泛型函数和可解码结构</h1><p id="6acd" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">转到视图控制器，粘贴下面的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">HomeViewController.swift</p></figure><p id="87ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在运行您的代码之前，确保您已经设置了您的<em class="oa">应用传输安全</em>设置。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/c4649629adf895b2842cdf8c50061d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oEPcsvJcBC_7aF89RG4m2A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">信息列表</p></figure><p id="6114" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Xcode模拟器或iOS设备上运行应用程序。如果一切顺利，您应该会在Xcode输出文件中看到JSON响应，如果结果很好，那就太棒了，干得好。</p><p id="9364" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经设法处理我们当前的天气JSON响应。</p><p id="6437" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们想在标签中显示当前的天气温度和描述，如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/8967da9d63b1d4febd7ee60e72152aa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qh0oHHTJHipo9lebUUZp3w.png"/></div></div></figure><p id="8390" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用下面的代码更新您的视图控制器。当我们更新视图控制器代码时，我们的应用程序应该如上所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">HomeViewController.swift</p></figure><p id="ea79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行您的代码。如果一切顺利，您的温度和天气描述标签应该用来自OpenWeather API的数据进行更新。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="c89a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">下一步是什么</h1><p id="e2bd" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">因此，我们已经设法使用我们的通用函数和可解码函数来显示当前的天气。</p><p id="38ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，你可以使用我们创建的通用函数和<code class="fe nn no np nq b">WeatherForecast</code>结构在你的<code class="fe nn no np nq b">UITableView</code>或<code class="fe nn no np nq b">UICollectionView</code>中显示数据。您甚至可以增强您的天气应用程序UI，添加更多细节，并将其放入应用程序商店或添加到您的投资组合中。</p><p id="9e44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也可以访问苹果官方和OpenWeather API文档页面来获得更多信息。</p><p id="f3dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">祝你未来的项目一切顺利，干杯。</p><div class="od oe gp gr of og"><a href="https://github.com/AfroCyberGuy/GenericWeather" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd ir gy z fp ol fr fs om fu fw ip bi translated">AfroCyberGuy/GenericWeather</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">github.com</p></div></div><div class="op l"><div class="oq l or os ot op ou kp og"/></div></div></a></div></div></div>    
</body>
</html>