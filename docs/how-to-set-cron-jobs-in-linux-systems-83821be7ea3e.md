# 如何在 Linux 系统中设置 Cron 作业

> 原文：<https://betterprogramming.pub/how-to-set-cron-jobs-in-linux-systems-83821be7ea3e>

## 理解 cron jobs 的终极指南

![](img/08f21619f40aafa751a19b5faca1b159.png)

图片来自 [Unsplash](https://unsplash.com/) 。

您可能经常需要在没有任何手动干预的情况下自动启动任务(作业)(例如，在备份数据库时)。您可能无法完成任务，或者您可能希望机器来完成并运行它们。无论哪种方式，您都需要它们在指定的时间在后台运行。

Cron 作业有助于自动化此类任务——更具体地说，是那些重复性的任务。

本指南将帮助您在 Linux 实例上设置 cron 作业。您将学习如何使用 Linux 中内置的 cron 作业工具，以及初始化作业的各种方法。

# 使用 crontab

Linux 提供了`crontab`，它在内部使用`cron`来调度作业。`cron`是一个使我们能够设置 cron 作业的实用程序。`crontab`封装 cron 表。这是您必须输入 cron 作业的地方，它充当用户与`cron`交互的接口。

每个用户，包括根用户，在`/var/spool/cron`目录中都有一个 cron 文件。如果您是根用户，在相关目录中会有一个`root`文件。

默认情况下，与用户相关的 cron 文件不存在。当你发出命令`crontab -e`时，它们就会被创建。该命令创建 cron 文件，并作为编辑器输入 cron 作业。一旦保存，它就启动`crond`守护进程。

要启动`crontab`，键入:

```
$ crontab -e
```

这将打开一个空文件。

```
~
~
"/tmp/crontab.9b8tmCAVkx" 0L, 0C
```

现在假设您要安排一个名为`backup.py`的备份脚本每天出现在`~/Desktop/cronscripts`目录中。您在文件中输入以下行:

```
@daily cd ~/Desktop/cronscripts/; python3 backup.py
~
~
```

输入作业后，保存并退出，这会自动启动 cron 作业。

`@daily`这里每天运行脚本。对于传统场景，您可以使用许多其他的简写表达式。

# Cron 表达式的格式

每个 cron 作业必须具有以下格式:

```
MINUTE HOUR DAY MONTH DAY COMMAND
```

*   `MINUTE` —接受范围从`0`到`59`的值。
*   `HOUR` —接受范围从`0`到`23`的值。
*   `DAY` —接受从`1`到`31`的值。
*   `MONTH` —接受范围从`1`到`12`或`JAN`到`DEC`的值(非标准)。
*   `DAY` —接受范围从`0`到`6`或`SUN`到`SAT`的值(非标准)。
*   `COMMAND` —封装要执行的命令。

每个参数(除了`COMMAND`)也接受`*`、`,`和`-`。`*`表示可以取任意值。`,`是给出多个值，`-`是提供范围。

例如，假设我们必须设置一个 cron，它在每小时的第 12 分钟运行。

这里，`crontab`中的 cron 作业看起来像这样:

```
12 * * * * <command>
```

将该行包含在通过`crontab -e`打开的文件中后，保存它。这将在指定时间自动触发 cron。

# 设置 Cron 作业的示例

要设置每 30 分钟运行一次的 cron，请键入:

```
*/30 * * * * <command>
```

要设置在每小时开始时运行的 cron，请键入:

```
0 */1 * * * <command>
```

要设置在每天晚上 12 点运行的 cron，请键入:

```
0 12 * * * <command>
```

要设置 cron 在每月第 15 天的上午 8:30 运行，请键入:

```
30 8 */15 * * <command>
```

要设置 cron，使其在每第六个小时和第九个小时的第 12 分钟运行，请键入:

```
12 6,9 * * * <command>
```

要设置在每三个月的第十天上午 12 点运行的 cron，请键入:

```
0 0 */10 */3 * <command>
```

要设置 cron 在一周的第二天下午 5 点运行，请键入:

```
0 17 * * */2 <command>
```

要设置在每周一凌晨 1 点运行的 cron，请键入:

```
0 1 * * */MON <command>
```

或者:

```
0 1 * * */1 <command>
```

要设置在每个月的第一天和每个星期天的上午 12 点运行的 cron，请键入:

```
0 0 1 * 0 <command>
```

要设置 cron，使其在一个月的第二天和第三天每小时的开始运行，请键入:

```
0 * 2,3 * * <command>
```

要设置从`1`到`10`每分钟运行一次的 cron，请键入:

```
1-10 * * * * <command>
```

要设置在每个工作日的凌晨 1 点运行的 cron，请键入:

```
0 1 * * 1-5 <command>
```

要设置在每天上午 9 点、上午 10 点、下午 1 点和下午 2 点运行的 cron，请键入:

```
0 9,10,13,14 * * * <command>
```

要设置从早上 8 点到晚上 12 点每隔一小时运行一次的 cron，请键入:

```
0 8-12/2 * * * <command>
```

# 速记表达

如果您不倾向于以原始格式设置 cron 作业，那么您可以使用一种简化的表达方式。

如果希望每年都触发命令，请键入:

```
@yearly <command>
```

这将在每年 1 月 1 日上午 12 点触发该命令。`@yearly`相当于 cron 表达式`0 0 1 1 *`。

如果希望每月触发一次命令，请键入:

```
@monthly <command>
```

这将在每月第一天的上午 12 点触发该命令。`@monthly`相当于 cron 表情`0 0 1 * *`。

如果希望每周触发一次命令，请键入:

```
@weekly <command>
```

这将在每周日上午 12 点触发该命令。`@weekly`相当于 cron 表情`0 0 * * 0`。

如果您想每天触发您的命令，请键入:

```
@daily <command>
```

这将在每天上午 12 点触发该命令。`@daily`相当于 cron 表达式`0 0 * * *`。

如果希望每小时触发一次命令，请键入:

```
@hourly <command>
```

这将在每小时开始时触发该命令。`@hourly`相当于 cron 表达式`0 * * * *`。

# 限制对 crontab 的访问

有时，您可能想要限制谁可以访问`crontab`。您不希望 cron 作业在用户不知情的情况下被删除。

为了实施这种访问，您可以创建`cron.allow` 和`cron.deny`文件。

如果有一个`cron.allow` 存在，那么只有被封装的用户才有权修改`crontab`。

如果有`cron.deny`出现，除了`cron.deny`中出现的用户外，所有用户都可以访问`crontab`。

如果这两个文件都不存在，所有用户都可以访问`crontab`。

要在这些文件中添加用户名，请键入:

```
vim /etc/cron.allow
```

在文件中，每行添加一个用户。

同样，可以填写`/etc/cron.deny`文件。

要使用指定用户访问`crontab`，您可以键入:

```
crontab -u user -e
```

# 如何延伸你的`crontab`

考虑这样一种情况，您希望 cron 作业每隔一天在上午 12 点触发，简单的 cron 作业表达式不足以满足这一要求。我们需要一个额外的 shell 命令来验证这个条件:

```
0 0 * * * < $((($(date +%s) / 86400) % 2)) == 0 > && <command>
```

在这里，cron 在每天上午 12 点被触发。但是，在 cron 作业表达式之后写入的条件验证自 1970–01–01 00:00:00 UTC 以来的一天是否能被 2 整除。这样，我们就能够每隔一天触发一次 cron(也就是说，只有当天数被 2 整除时)。

*注意:您可能会认为 cron* `*0 0 */2 * **` *应该满足隔日条件。尽管如此，这个 cron 在每月的第二天上午 12 点触发*

同样，要每隔一周触发一次 cron 作业，请键入:

```
0 0 * * 1 < $((($(date +%s) / 86400) % 14)) == 0 > && <command>
```

在这里，cron 在每周一的上午 12 点被触发。底层条件检查自 1970–01–01 00:00:00 UTC 以来的周数(14 天)计数是否能被 2 整除。

要每隔一个月触发一次 cron 作业，请键入:

```
0 0 1 */2 * <command>
```

如果您可以推断，这里不需要 shell 脚本。月份字段中的`*/2`应满足要求。

要每隔一小时触发一次 cron 作业，请键入:

```
0 */2 * * * <command>
```

# 结论

`crontab`是一个强大且易于使用的工具，用于设置后台作业的自动触发。

在本教程中，您已经学习了如何初始化`crontab`。为了掌握额外的复杂需求，考虑什么是适合该工作的 cron 表达式。此外，您可以使用 shell 脚本和常见的 cron 作业表达式来处理各种其他用例。

我希望你喜欢阅读这篇文章！