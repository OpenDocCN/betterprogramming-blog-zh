<html>
<head>
<title>Syncing i18n Translations Files in React App Using JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JavaScript在React应用程序中同步i18n翻译文件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/syncing-i18n-translations-files-in-react-app-using-javascript-91fd50513bee?source=collection_archive---------1-----------------------#2022-03-26">https://betterprogramming.pub/syncing-i18n-translations-files-in-react-app-using-javascript-91fd50513bee?source=collection_archive---------1-----------------------#2022-03-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="acc7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如果你在这里着陆，你无疑会明白挑战。国际化是提供多语言应用或网站的关键。挑战在于，如何在所有语言文件中保持JSON键的同步？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/493c6c009a4710457fd76da87b15a6a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LqQ3yRwATVs1uAfW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@towfiqu999999?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Towfiqu barbhuiya </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><h1 id="b9f6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">解释:问题</h1><p id="dda7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">作为软件开发人员，我们花费大量时间构建包含文本、指令或其他HTML元素的UI元素，这些元素向用户呈现文本。该文本将取决于用户选择的语言，并且通常从其各自的键/值对的JSON文件中检索，例如:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="e06a" class="ms la it mo b gy mt mu l mv mw"><strong class="mo iu">// Example: English Translation File</strong></span><span id="a98f" class="ms la it mo b gy mx mu l mv mw">{<br/>  "title": "Example Ltd.",<br/>  "tagline": "Find the best examples right here.",<br/>  "subtitle": "This is a demo website",<br/>  ...<br/>}</span><span id="bd31" class="ms la it mo b gy mx mu l mv mw"><strong class="mo iu">// Example: German Translation File</strong></span><span id="86a7" class="ms la it mo b gy mx mu l mv mw">{<br/>  "tagline": "Hier finden Sie die besten Beispiele.",<br/>  "subtitle": "Dies ist eine Demo-Website",<br/>  ...<br/>}</span></pre><p id="7f38" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">前端实现(例如，<code class="fe nd ne nf mo b">title</code>和<code class="fe nd ne nf mo b">tagline</code>在翻译文件中被替换为它们各自的值):</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="198a" class="ms la it mo b gy mt mu l mv mw">&lt;h1&gt;{title}&lt;/h1&gt; =&gt; to render the title text<br/>&lt;p&gt;{tagline}&lt;/p&gt; =&gt; to render the tagline text</span></pre><h2 id="cc0b" class="ms la it bd lb ng nh dn lf ni nj dp lj ma nk nl ll me nm nn ln mi no np lp nq bi translated">那么…交易是什么？</h2><p id="7093" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">根据构建web应用程序的经验，这些翻译文件(JSON文件)可能会变得非常大。如果我们现在为一个新键添加一个翻译(比方说，一个<code class="fe nd ne nf mo b">description</code>字段)，<em class="nr">我们必须将这个键复制到每一个语言文件</em>(其中可能有很多——每种语言一个)。</p><blockquote class="ns nt nu"><p id="e8b7" class="lr ls nr lt b lu my ju lw lx mz jx lz nv na mc md nw nb mg mh nx nc mk ml mm im bi translated">键可能是嵌套的、无序的，并且可能在不知不觉中被复制。简而言之:这是手动的、耗时的，并且不可扩展！</p></blockquote></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="c035" class="kz la it bd lb lc of le lf lg og li lj jz oh ka ll kc oi kd ln kf oj kg lp lq bi translated">关于后备语言的一句话</h1><p id="4feb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可能会注意到，在上面的例子中，我们的德语翻译文件不包含对<code class="fe nd ne nf mo b">title</code>的翻译，这相当于说，我们的翻译文件不同步。</p><p id="7193" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">幸运的是，像<a class="ae ky" href="https://react.i18next.com" rel="noopener ugc nofollow" target="_blank"> react-i18next </a>这样的React库允许您指定默认的后备语言——这样在缺少翻译的情况下，后备语言(大多数情况下是英语)的值就会呈现给用户。</p><p id="8b1b" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">如果你认为这导致了翻译碎片化，那你就对了！没有什么比给最终用户提供翻译不一致的界面更糟糕的了。</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="2a4e" class="kz la it bd lb lc of le lf lg og li lj jz oh ka ll kc oi kd ln kf oj kg lp lq bi translated">保持翻译文件同步</h1><p id="9dce" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">假设您是一名开发人员，正在用您的母语(可能是英语)添加新的翻译记录，您可能想知道如何构建一个简单的脚本，可以在您的终端中执行该脚本以将“主”语言键同步到所有其他语言文件。可能吗？</p><p id="1d46" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">是啊！而且也很简单！</p><h2 id="aa61" class="ms la it bd lb ng nh dn lf ni nj dp lj ma nk nl ll me nm nn ln mi no np lp nq bi translated">步骤1:组织您的语言环境</h2><p id="3330" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们从将所有翻译文件放入同一个文件夹开始(在我的例子中称为<code class="fe nd ne nf mo b">locales</code>)。现在，请注意<code class="fe nd ne nf mo b">common_en-US.json</code>是我的主翻译文件——包含我的英语价值观。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/a4215fe3a05c32ec4b3139785a70a6aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yvNcMXkECYjS4YPSS6CHcQ.png"/></div></div></figure><h2 id="2197" class="ms la it bd lb ng nh dn lf ni nj dp lj ma nk nl ll me nm nn ln mi no np lp nq bi translated">步骤2:遍历主翻译文件</h2><p id="34c4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们现在想添加一个脚本来遍历master (English)文件中的JSON键列表，并返回所有键。稍后，我们将把其他语言文件中的关键字与这些进行比较，添加那些已经丢失的关键字。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><h2 id="91b1" class="ms la it bd lb ng nh dn lf ni nj dp lj ma nk nl ll me nm nn ln mi no np lp nq bi translated">步骤3:同步翻译文件</h2><p id="f6a2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在对于主动作，我们首先执行步骤2中的<code class="fe nd ne nf mo b">traverseTranslations()</code>函数，以获得根据主文件(英语)应该包含的所有路径的列表。</p><p id="287f" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">接下来，我们读取<code class="fe nd ne nf mo b">locales</code>目录中每个文件的现有JSON结构。对于每个文件，我们检查它是否包含所有它应该包含的路径/键(基于上面的内容)。如果目标语言中已经存在本地翻译，则不会对该记录进行任何更改，如果它不存在，我们只需将该记录与英语翻译一起添加。</p><p id="e894" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">最后，我们将文件写回文件系统，并使用<a class="ae ky" href="https://prettier.io" rel="noopener ugc nofollow" target="_blank">更漂亮的</a>将其格式化。瞧啊。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><h2 id="0a65" class="ms la it bd lb ng nh dn lf ni nj dp lj ma nk nl ll me nm nn ln mi no np lp nq bi translated">步骤4:使用NPM执行</h2><p id="5821" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">对于我们的最后一个技巧，我们将通过<code class="fe nd ne nf mo b">npm run sync:i18n</code>命令执行这段代码。这可以在我们项目的<code class="fe nd ne nf mo b">package.json</code>文件中定义如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="d59e" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">如果您正在使用TypeScript，请确保将一个非常简单的<code class="fe nd ne nf mo b">tsconfig.json</code>添加到与其他两个脚本相同的文件夹中。参见<a class="ae ky" href="https://gist.github.com/olafwrieden/b028ce5f74ae933249aa33c149705059#file-tsconfig-json" rel="noopener ugc nofollow" target="_blank">示例tsconfig.json </a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/abd755d372f3d82beb043fac3f33d3a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M75jisrdLZqAYjWHYbdopQ.png"/></div></div></figure><p id="c81c" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">现在，每当我们作为开发人员向我们的英语翻译文件添加i18n键值对时，我们只需要运行<code class="fe nd ne nf mo b">npm run sync:i18n</code>来将这个新键同步到所有其他语言文件。整洁，对不对？</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="04f6" class="kz la it bd lb lc of le lf lg og li lj jz oh ka ll kc oi kd ln kf oj kg lp lq bi translated">已知限制</h1><ol class=""><li id="2abd" class="oo op it lt b lu lv lx ly ma oq me or mi os mm ot ou ov ow bi translated">如果一个翻译<strong class="lt iu">键</strong>改变了怎么办？例如,<code class="fe nd ne nf mo b">title</code>将嵌套在<code class="fe nd ne nf mo b">app.title</code>下——运行时，<code class="fe nd ne nf mo b">app.title</code>将作为一个新键追加，而不是替换现有的键。</li></ol></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="766e" class="ms la it mo b gy mt mu l mv mw"><strong class="mo iu">Want to Connect?</strong></span><span id="4803" class="ms la it mo b gy mx mu l mv mw">LinkedIn: <a class="ae ky" href="https://www.linkedin.com/in/olafwrieden/" rel="noopener ugc nofollow" target="_blank">Olaf Wrieden</a><br/><a class="ae ky" href="https://github.com/olafwrieden" rel="noopener ugc nofollow" target="_blank">GitHub</a></span></pre></div></div>    
</body>
</html>