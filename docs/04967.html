<html>
<head>
<title>Use Meshery to Configure, Compare, and Operate Service Mesh solutions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用网格来配置、比较和操作服务网格解决方案</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/use-meshery-to-configure-compare-and-operate-service-mesh-88f23dbf0b74?source=collection_archive---------13-----------------------#2020-05-26">https://betterprogramming.pub/use-meshery-to-configure-compare-and-operate-service-mesh-88f23dbf0b74?source=collection_archive---------13-----------------------#2020-05-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="af26" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Meshery入门</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/35033f769d1c9b43c3a9cad7c653d276.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pRmsk2h0aHbRF7r5CczuJw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">里卡多·戈麦斯·安吉尔在<a class="ae ky" href="https://unsplash.com/s/photos/mesh?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="1e68" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">介绍</h1><p id="1317" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">现在有很多服务网格解决方案(Istio、Linkerd、Consul、Maesh等等)。在性能/开销/使用方面，要选择最符合我们需求的一个，可能相当困难。<a class="ae ky" href="https://meshery.io" rel="noopener ugc nofollow" target="_blank"> Meshery </a>将通过使部署、管理和评估不同的解决方案变得非常容易，在选择过程中为您提供帮助。</p><p id="463d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">本文分为以下几个部分，一步一步地说明如何开始使用Meshery:</p><ul class=""><li id="edef" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">服务网格快速介绍</li><li id="2350" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">Istio概述</li><li id="81f1" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">关于网状组织</li><li id="92cc" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">创建一个Kubernetes集群</li><li id="7496" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">经营网络</li><li id="dcf5" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">部署示例应用程序</li><li id="5282" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">运行性能测试</li></ul></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="1a21" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">服务网格快速介绍</h1><p id="d16a" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">一个<em class="nn">服务网格</em>被定义为一个基础设施层，它允许你管理应用程序的微服务之间的通信。它与应用程序一起部署在Kubernetes集群上，无需任何代码更改即可提供许多特性。可用的功能如下:</p><ul class=""><li id="3840" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">微服务之间的加密(TLS/mTLS)</li><li id="04be" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">可观察性(日志和指标)</li><li id="b159" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">认证/授权</li><li id="80fa" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">故障恢复</li><li id="ee63" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">限速</li><li id="bae9" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">A/B测试，金丝雀</li></ul><p id="9529" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">几个服务网格基于相同的架构:部署在应用程序容器旁边的sidecar容器(理解:在应用程序的每个Pod内添加一个容器)。每个sidecar容器都是一个代理(通常基于<a class="ae ky" href="https://www.envoyproxy.io/" rel="noopener ugc nofollow" target="_blank"> Envoy </a>)，它拦截旁边应用程序容器的通信。所有这些代理形成了网状网络并相互通信。</p><p id="cb1f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">服务网格由两个主要组件组成:</p><ul class=""><li id="4a8f" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">代理网络被称为<em class="nn">数据平面</em>。它通过sidecars将流量转发给其他服务。</li><li id="12e0" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><em class="nn">控制平面</em>处理配置和管理、安全以及监控相关的功能。它用于配置代理之间的通信。</li></ul><p id="c63e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下图说明了这些概念。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/c828ef6f62d12a813c46ac166e940075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*W7is2jQPRsVE95p2"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据和控制平面(https://nginx.com)</p></figure><p id="f4a6" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">注意:其他服务网格参与者使用不同的架构模型。例如，他们在节点级别部署代理，而不是在Pod级别(例如，<a class="ae ky" href="https://containo.us/maesh/" rel="noopener ugc nofollow" target="_blank"> Maesh </a>)。</p><p id="3cce" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">为了无差别地管理服务网格解决方案，目前正在指定一个<a class="ae ky" href="https://smi-spec.io/" rel="noopener ugc nofollow" target="_blank">(服务网格接口)SMI </a>。</p><p id="4b25" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如SMI网站所述，SMI涵盖了最常见的服务网格功能:</p><ul class=""><li id="edde" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">流量策略—跨服务应用身份和传输加密等策略</li><li id="eefb" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">流量遥测—捕获服务间的错误率和延迟等关键指标</li><li id="005a" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">流量管理—在不同服务之间转移流量</li></ul><p id="9284" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">SMI背后的思想是提供一组CRD(Kubernetes自定义资源定义),无论选择什么解决方案，都可以用它们来管理服务网格。</p><p id="ad5b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">注意</strong>:一个<em class="nn">定制资源定义</em>是一种扩展Kubernetes定义默认不存在的资源的方式。</p><p id="27b8" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">还值得注意的是，Layer5和Meshery是SMI的启动伙伴，Meshery支持SMI。您可以访问以下链接了解更多信息<a class="ae ky" href="https://www.google.com/url?q=https://layer5.io/blog/a-standard-interface-for-service-meshes&amp;sa=D&amp;ust=1590158878311000&amp;usg=AFQjCNET2Hc3NH41Yr_sB4mgAS927tbsuw" rel="noopener ugc nofollow" target="_blank">https://layer 5 . io/blog/a-standard-interface-for-service-mesh</a>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3ba9" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">Istio概述</h1><p id="693a" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Istio 是我们将在本文中用来说明网格的服务网格。Istio有两个核心组件:</p><ul class=""><li id="045e" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">Envoy代理的扩展版本，用于拦截服务网格中所有服务的所有入站和出站流量。这个代理网络构成了数据平面。</li><li id="3219" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">Istiod，它提供服务发现、代理配置和证书管理。Istiod依靠Pilot来管理流量(金丝雀、超时、重试等)。)，在Citadel上管理加密、认证和授权，在Galley上配置内部Istio组件。</li></ul><p id="93ba" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下面的架构图说明了它们之间的关系。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/a88e6497890b88b8ed1c8e4fb2f1b79c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xMR_nJGee91XgbzAedWj7Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源<a class="ae ky" href="https://istio.io" rel="noopener ugc nofollow" target="_blank"> https://istio.io </a></p></figure><p id="ff6f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">注意:随着最新版本中Istiod的引入，Istio架构在1.4和1.5版本之间得到了简化。在<a class="ae ky" href="https://developer.ibm.com/blogs/istio-15-release/" rel="noopener ugc nofollow" target="_blank">https://developer.ibm.com/blogs/istio-15-release/</a>有一篇关于架构演变的博客文章。</p><p id="ce24" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">此外，在这些组件之上(取决于所使用的Istio配置文件),还可以部署其他组件(Prometheus、Grafana等。).</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="0eaa" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">关于网状组织</h1><p id="2691" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated"><a class="ae ky" href="https://meshery.io" rel="noopener ugc nofollow" target="_blank">网格</a>作为服务网格管理平面出现。它允许您设置、基准测试和操作市场上的许多服务网格解决方案。</p><p id="16a4" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这个项目是由李·卡尔科特创建的。它由<a class="ae ky" href="https://layer5.io" rel="noopener ugc nofollow" target="_blank"> Layer5.io </a>的社区管理，该社区的成员数量在不断增加。</p><p id="e576" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">从技术的角度来看，Meshery由一组工具组成，这些工具可以部署在一个<a class="ae ky" href="https://kubernetes.io" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>集群或者任何运行<a class="ae ky" href="https://hub.Docker.com" rel="noopener ugc nofollow" target="_blank"> Docker </a>的机器上。它提供了一个web界面和一个CLI来部署、管理和基准测试所有领先的服务网格解决方案。</p><p id="0433" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">目前，Meshery支持以下服务网格提供商:</p><ul class=""><li id="1740" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated"><a class="ae ky" href="https://istio.io" rel="noopener ugc nofollow" target="_blank"> Istio </a></li><li id="ef17" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><a class="ae ky" href="https://linkerd.io" rel="noopener ugc nofollow" target="_blank">链接器</a></li><li id="3906" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><a class="ae ky" href="https://networkservicemesh.io/" rel="noopener ugc nofollow" target="_blank">网络服务网格(NSM) </a></li><li id="6efd" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><a class="ae ky" href="https://www.hashicorp.com/products/consul/service-mesh/" rel="noopener ugc nofollow" target="_blank">领事</a></li><li id="bc88" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><a class="ae ky" href="https://www.octarinesec.com/" rel="noopener ugc nofollow" target="_blank">八氢萘</a></li><li id="d9b9" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">思杰CPX (测试版)</li><li id="fc49" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">梅什(阿尔法)</li><li id="1074" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><a class="ae ky" href="https://aws.amazon.com/fr/app-mesh/" rel="noopener ugc nofollow" target="_blank">应用网格</a> (alpha)</li><li id="0b39" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><a class="ae ky" href="https://kuma.io" rel="noopener ugc nofollow" target="_blank">库马</a>(阿尔法)</li></ul><p id="70a7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下面的模式详细描述了整个网格体系结构。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/7cc9e142b0fa8d98dbc66117dcc20be0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Ra6soCPjXSEqRsX34T5EQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Meshery的架构(来源:<a class="ae ky" href="https://meshery.io)" rel="noopener ugc nofollow" target="_blank"> https://meshery.io) </a></p></figure><p id="a5e9" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">管理员使用Meshery web UI或CLI将服务网格组件部署到目标Kubernetes集群。每个服务网格由其自己的网格适配器管理。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="a0ba" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">创建一个Kubernetes集群</h1><p id="f0d0" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">对于这个演示，我们将使用在<a class="ae ky" href="https://www.civo.com/" rel="noopener ugc nofollow" target="_blank"> Civo </a>上创建的集群。该公司有一个基于伟大的<a class="ae ky" href="https://k3s.io/" rel="noopener ugc nofollow" target="_blank"> k3s </a>(牧场主实验室的轻量级Kubernetes发行版)的托管Kubernetes产品(目前处于测试阶段)。</p><p id="fd68" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">首先，从CIVO的web界面中，我们选择Kubernetes菜单并创建一个三节点集群，每个集群有两个CPU和4 GB RAM。创建群集只需几秒钟的时间。</p><div class="kj kk kl km gt ab cb"><figure class="nt kn nu nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/6959015e52c257877f10df01e970b469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*pE6RvU0-m7OoRH2pYe6Cqg.png"/></div></figure><figure class="nt kn nz nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/7c9254d2f473756d846786d7c57b6ccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*vdUzikxETwkRxYmvDxQ0dA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk oa di ob oc translated">在civo.com上创建的K3s集群</p></figure></div><p id="7ec1" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">然后，我们下载<code class="fe od oe of og b">kubeconfig</code>文件(此处为<code class="fe od oe of og b">civo-demo-kubeconfig</code>)并将其保存在一个安全的地方，因为我们将在接下来的步骤中用到它。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="7d66" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">经营网络</h1><p id="fbf8" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Meshery可以在macOS、Linux和Windows上本地运行，也可以直接在Kubernetes集群中运行。在本文中，我将用以下命令将它安装在Docker容器内的macOS上:</p><pre class="kj kk kl km gt oh og oi oj aw ok bi"><span id="8067" class="ol lh it og b gy om on l oo op">$ curl -L https://git.io/meshery | bash -</span></pre><p id="f8c7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">它下载了最新版本的<code class="fe od oe of og b">mesheryctl</code>工具(在撰写本文时是0.3.12 ),并运行几个容器:</p><ul class=""><li id="8b9f" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">一个用于web界面</li><li id="f689" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">每个适配器一个</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/bbdb44c567d1cbff54958b5f1a1b3916.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eB44J5i7bBAoHGCXUdrr8Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">mesheryctl运行的容器</p></figure><p id="373a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">web界面可通过端口9081进行本地访问:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/020043fe1231e7bae74f9318a62cbafb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B1GRy6flGRwtshbrdHv5kw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Meshery web界面</p></figure><p id="5fd2" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">从这个界面中，我们可以看到Meshery中处于稳定状态的六个服务网格解决方案。</p><p id="5f87" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们还没有连接到任何集群，所以让我们更改它，并使用设置菜单导入我们之前下载的<code class="fe od oe of og b">kubeconfig</code>。</p><div class="kj kk kl km gt ab cb"><figure class="nt kn os nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/94e356411e1754fdcb6531a42a3c39e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ESIEbW7w-q13B9C1BqFg6w.png"/></div></figure><figure class="nt kn os nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/81977f1df37f1674b3f1d756ac8d2842.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*B7CHxIB6Srmom2T5vXlcUQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk oa di ob oc translated">与Kubernetes星团相连的网状结构</p></figure></div><p id="64ac" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">Meshery现在可以与我们的集群通信，并准备好部署一个可用的服务网格。下面，我们将重点介绍Istio。</p><p id="bb92" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">从左侧的Istio菜单中，我们可以看到可用的操作:</p><ul class=""><li id="0b94" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">管理服务网格生命周期</li><li id="5ffb" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">管理示例应用程序生命周期</li><li id="0f8b" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">应用服务网格配置</li><li id="0614" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">验证服务网格配置</li><li id="1a1d" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">应用自定义配置</li></ul><p id="1c75" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">首先，我们使用管理服务网格生命周期以标准方式部署Istio(与SMI无关)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/5ab7178b5a6ffcf0b3efae4108caa2d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L_0e-HO_duZrFt3yiq-NuA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Istio管理页面</p></figure><p id="5fba" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">使用伟大的Kubernetes客户端(如果你不知道这个人，你一定要试一试),我们可以看到所有与Istio相关的组件都已经部署好了，Istio现在正在集群上运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/445e2fdef0cb58caf56f56676965b633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U1LSmPSbwFbIFSfqQnL9rA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通过k9s客户端运行的pod列表</p></figure><p id="9d0a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">接下来，我们将部署一个示例应用程序，并配置其微服务之间的通信。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="6002" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">部署示例应用程序</h1><p id="0a35" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">首先，从Meshery web界面中选择Manage Sample Application life cycle菜单。可以部署三个示例应用程序:</p><ul class=""><li id="4e3b" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">潮人商店</li><li id="f668" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">BookInfo</li><li id="fcca" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">httpbin</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/a54170041b8c6b9b20fdf777a499d2fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t0vZCVHhEJGOlpcQl0rBIA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可以为Istio部署的应用程序列表(只需点击一下鼠标)</p></figure><p id="6ec4" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们使用BookInfo应用程序，它由四个微服务组成:</p><ul class=""><li id="581d" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated"><code class="fe od oe of og b">productpage</code>是一个用Python写的web前端，公开一本书的信息。它从两个微服务收集不同的信息:<code class="fe od oe of og b">reviews</code>和<code class="fe od oe of og b">details</code>。</li><li id="9801" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><code class="fe od oe of og b">details</code>微服务是用Ruby写的，返回书的细节。</li><li id="1d3c" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><code class="fe od oe of og b">rating</code>微服务是用NodeJs写的，它为书返回一个标记。</li><li id="d686" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><code class="fe od oe of og b">reviews</code>微服务是用Java写的，它返回一篇书评。这个微服务有三个版本:v.1不调用<code class="fe od oe of og b">rating</code> <em class="nn">，</em> v.2调用<code class="fe od oe of og b">rating</code>并使用黑星显示标记，v.3调用<code class="fe od oe of og b">rating</code>并使用红星显示标记。</li></ul><p id="37db" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下图说明了这些微服务之间的交互:</p><ul class=""><li id="52e4" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">左边是没有Istio的应用程序:微服务直接相互通信。</li><li id="3cf5" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">右边是带有Istio的应用程序:微服务通过代理进行通信，这些代理作为sidecar容器注入到应用程序的每个Pod中。</li></ul><div class="kj kk kl km gt ab cb"><figure class="nt kn ou nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/32861d1d0df1e6372c4475b9d140838d.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*7F74BO4nGSmJCOHEx5w1ZQ.png"/></div></figure><figure class="nt kn ov nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/8573dc91eb6bf367eba4d0b8f6651bbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*ootdgbbvaffy6si-YXFJFg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk ow di ox oc translated">BookInfo应用程序的架构(https://istio.io) -不带istio(左)/带Istio(右)</p></figure></div><p id="c10f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">接下来，我们验证BookInfo是否已部署。从k9s中，我们可以看到应用的微服务(<code class="fe od oe of og b">productpage</code>、<code class="fe od oe of og b">ratings</code>、<code class="fe od oe of og b">details</code>、<code class="fe od oe of og b">reviews</code>微服务的三个版本)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/2eb8f486a1d85ca9743d516f9e8db27b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-NMK7saFUG97jItUcRn9uA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">BookInfo Pods列在所有正在运行的Pods中</p></figure><p id="ba69" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">从Civo web界面(我们创建集群的地方)，我们可以检索DNS名称来访问集群中运行的应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/d193855ef5a622922a4d5327b7e8b4a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AVE5nVCte4sLOO46U5ojew.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">获取到达群集的DNS</p></figure><p id="0a30" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果我们对<code class="fe od oe of og b">/productpage</code>端点进行几次调用，我们可以看到不同版本的<code class="fe od oe of og b">reviews</code>服务以循环方式被调用。</p><div class="kj kk kl km gt ab cb"><figure class="nt kn oz nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/09aef7c8bd616b6c8c39e2064b784612.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*oCpA9vUAMDEZwTGoSUm84g.png"/></div></figure><figure class="nt kn oz nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/d5cb3a8dc61ee9f101502da3e2070336.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*HkQb5MTuxGK4pNzIGAlx9g.png"/></div></figure><figure class="nt kn oz nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/1bd43ba7db7a2c503454661c118ab3e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*QD9RXvufi4pBfZFZmE999A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk pa di pb oc translated">BookInfo /productpage的连续调用</p></figure></div><p id="fed3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">接下来，我们应用默认的BookInfo目的地规则配置。它基本上定义了每个微服务的不同版本，并将用于定义以下通信规则:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/3e69bd1c01f2027d62abab84bd986858.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6EwuW-0ZuEGk2WmQ-F4Eog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">定义BookInfo的默认目的地规则</p></figure><p id="1e23" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">然后，我们应用一个配置，确保只有当请求来自一个名为jason的登录用户时，所有流量才被发送到<code class="fe od oe of og b">reviews</code> v.2。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/ecb9ff8f086ef3617414e2349f84beee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yrhWRYA3qJvQvylKkULleg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">定义流量规则:用户jason应该限于版本2的评论微服务</p></figure><p id="f111" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">从k9s中，我们可以看到已经创建了一个新的<code class="fe od oe of og b">VirtualService</code>，它定义了上面选择的规则。我们现在不会深入研究<code class="fe od oe of og b">VirtualService</code> CRD，但是我们可以记住它们是用来定义代理之间的通信规则的。</p><div class="kj kk kl km gt ab cb"><figure class="nt kn os nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/b1c33d5db5ef9290bd6c282201180122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*tTcwuMSx65f7o2nP2i6gaw.png"/></div></figure><figure class="nt kn os nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/89e600ed4cc19bde95aad290b970cd50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*1lPsbWWdVSbItryvg2DZxw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk oa di ob oc translated">一旦应用了配置，就会创建一个虚拟服务</p></figure></div><p id="3b20" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在让我们测试应用程序，以确保这条规则得到执行。从BookInfo，我们使用jason作为用户名登录。一旦登录，我们只能看到带黑星的评论。这是指所选规则中定义的<code class="fe od oe of og b">reviews</code>服务的版本2。</p><div class="kj kk kl km gt ab cb"><figure class="nt kn os nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/dfbe785211d8702da33462d971497917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Ir8mb6vOjufrijIybAu2Iw.png"/></div></figure><figure class="nt kn os nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/0d5b39f4f5eb580631f00eca8985581e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*HkQb5MTuxGK4pNzIGAlx9g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk oa di ob oc translated">用户jason只能看到reviews服务的版本2</p></figure></div><p id="5b6f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">通过几次点击，我们已经部署了应用程序并应用了一些预先配置的通信规则。太棒了。</p><p id="bdd1" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">还有许多其他操作可以用来配置BookInfo应用程序的微服务如何相互通信。(提醒一下:一旦安装了Istio，通信就通过代理完成，而不是直接在微服务之间进行)。不要犹豫运行这个例子和测试其他规则。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="861c" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">运行性能测试</h1><p id="6f5e" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Meshery还允许我们测试服务网格在我们自己的架构/应用程序上的表现。</p><p id="c9a4" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">首先，我们选择左侧的Performance菜单，并提供一些参数来运行测试:</p><ul class=""><li id="5ba2" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">要测试的URL(此处为BookInfo的<code class="fe od oe of og b">/productpage</code>)</li><li id="a167" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">并发请求的数量</li><li id="6923" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">请求的数量</li><li id="077a" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">测试的持续时间</li></ul><p id="c67b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">然后，在测试完成后，我们在一个漂亮的图表中得到结果。</p><div class="kj kk kl km gt ab cb"><figure class="nt kn os nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/8874a1cc0e0d79dd9b059ced6aad0de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*4u9kE10X2Qy6iq-zmeP04A.png"/></div></figure><figure class="nt kn os nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/93935e77bda9d9faa5be44aa3133f0d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*rdSdzIxdjdEe8uO4Q5maJg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk oa di ob oc translated">用Istio对BookInfo应用程序进行性能测试</p></figure></div><p id="db17" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">运行性能测试不是一蹴而就的事情。例如，它可以定期运行以建立基线，并且可以被评估:</p><ul class=""><li id="735a" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">对于所选服务网格的每个新版本</li><li id="b874" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">对于服务网格配置的每次更改</li><li id="3048" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">对于应用程序的每个新版本</li></ul><p id="3c3d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">它可以用来比较服务网格，并找到最适合我们的需求和约束的服务网格。</p><p id="d461" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们将不讨论性能测试的细节，对其结果的解释，或者如何使用它来定义某种基线，因为这可能是未来文章的主题。</p><p id="c2cf" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">一旦我们完成了，就可以很容易地删除我们到目前为止已经安装的所有组件(Istio和它的BookInfo应用程序),因为一切都可以使用Meshery的web界面中的专用图标来清理。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/109574c2e25848a67d4a7a77f770ec6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ItK9VlaFN6sHlgBNzQ7gcw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从集群中删除BookInfo和Istio组件</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="23d4" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">结论</h1><p id="e98c" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在本文中，我们仅仅触及了Meshery的皮毛，但是我希望您对它的能力有一个总体的了解。正如我们所见，Meshery使得在Kubernetes上部署和管理服务网格变得非常容易。最重要的是，它可以用来对不同的服务网格进行基准测试，建立基线，并跟踪每个服务网格对基础设施的总体影响。</p><p id="ed7c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">请随意尝试Meshery——前往<a class="ae ky" href="https://meshery.io" rel="noopener ugc nofollow" target="_blank"> Meshery.io </a>。</p><p id="39d0" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">注:非常感谢<a class="nq nr ep" href="https://medium.com/u/fdffb5a98b8a?source=post_page-----88f23dbf0b74--------------------------------" rel="noopener" target="_blank">李·考科特</a>、<a class="nq nr ep" href="https://medium.com/u/e13eb32c8fa0?source=post_page-----88f23dbf0b74--------------------------------" rel="noopener" target="_blank">安特·维斯</a>和<a class="nq nr ep" href="https://medium.com/u/b840e4bcadf7?source=post_page-----88f23dbf0b74--------------------------------" rel="noopener" target="_blank">艾苏科里</a>审阅本文。</p></div></div>    
</body>
</html>