<html>
<head>
<title>Identifying Outliers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">识别异常值</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/identifying-outliers-part-two-4c00b2523362?source=collection_archive---------0-----------------------#2020-07-25">https://betterprogramming.pub/identifying-outliers-part-two-4c00b2523362?source=collection_archive---------0-----------------------#2020-07-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cfe2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在熊猫数据集中查找并可视化异常值</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f6dfe1a534f592b8e7b03d18970ae7ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d59T7r5eHM8pr6v03p1n2w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">戴夫·甘迪的照片</p></figure><p id="15f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">警告</strong> : <em class="lv">这里没有神奇的配方或圣杯，尽管一个新的世界可能会为你打开大门。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="2dee" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">📈Python For Finance系列</h2><ol class=""><li id="b687" class="mw mx it lb b lc my lf mz li na lm nb lq nc lu nd ne nf ng bi translated"><a class="ae ky" href="https://medium.com/python-in-plain-english/identifying-outliers-part-one-c0a31d9faefa" rel="noopener">识别异常值</a></li><li id="9376" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated"><a class="ae ky" href="https://medium.com/better-programming/identifying-outliers-part-two-4c00b2523362" rel="noopener">识别异常值—第二部分</a></li><li id="62cb" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated"><a class="ae ky" href="https://medium.com/swlh/identifying-outliers-part-three-257b09f5940b" rel="noopener">识别异常值—第三部分</a></li><li id="58d2" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated"><a class="ae ky" href="https://towardsdatascience.com/data-whispering-eebb77a422da" rel="noopener" target="_blank">程式化的事实</a></li><li id="53ed" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated"><a class="ae ky" href="https://medium.com/@kegui/feature-engineering-feature-selection-8c1d57af18d2" rel="noopener">特征工程&amp;特征选择</a></li><li id="eae1" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated"><a class="ae ky" href="https://towardsdatascience.com/data-transformation-e7b3b4268151" rel="noopener" target="_blank">数据转换</a></li><li id="2d00" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated"><a class="ae ky" href="https://medium.com/swlh/fractionally-differentiated-features-9c1947ed2b55" rel="noopener">微小差异特征</a></li><li id="6243" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated"><a class="ae ky" href="https://towardsdatascience.com/the-triple-barrier-method-251268419dcd" rel="noopener" target="_blank">数据标签</a></li><li id="6361" class="mw mx it lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated"><a class="ae ky" href="https://towardsdatascience.com/meta-labeling-and-stacking-f17a7f9804ec" rel="noopener" target="_blank">元标签和堆叠</a> <a class="ae ky" href="https://towardsdatascience.com/the-triple-barrier-method-251268419dcd" rel="noopener" target="_blank"> g </a></li></ol></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="8e74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在之前的中，我展示了如何使用均值和标准差来过滤掉数据集中的异常值。在本文中，我们将使用移动平均线作为边界再做一次。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="bdf2" class="nm me it bd mf nn no np mi nq nr ns ml jz nt ka mo kc nu kd mr kf nv kg mu nw bi translated">1.数据准备</h1><p id="c329" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">这里，我们重用了第一部分中的数据集。以下代码片段将帮助您入门:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/111c024d4ab7a16d98f99b3af42bf6ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:444/format:webp/1*ygIA5aH_zkrUeANyS4l3eQ.png"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4f6a" class="nm me it bd mf nn no np mi nq nr ns ml jz nt ka mo kc nu kd mr kf nv kg mu nw bi translated">2.使用移动平均均值和标准偏差作为边界</h1><p id="d912" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">与第一种方法一样，我们需要首先获得边界，然后将边界应用于数据集。这一次，将采用移动平均值和标准偏差(std)。为了计算平均值和标准差，选择21天的窗口，因为它代表一个月中的平均交易日。你可以选择任何一天，但敏感度会有所不同。</p><p id="f0b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要得到平均值和标准差，很容易用<a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Pandas </a>中的一行代码:</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="fd90" class="md me it oe b gy oi oj l ok ol">d1[['mean', 'std']] = d1['simple_rtn'].rolling(window=21) \<br/>                               .agg(['mean', 'std'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/da850c0506ca917b79c70943dc9f3b34.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*Jr3pUAIAUVu_aOCQWYpi-Q.png"/></div></figure><p id="d803" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe on oo op oe b">NaNs</code>太多了。下一步是删除它们:</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="82d9" class="md me it oe b gy oi oj l ok ol">d1.dropna(inplace=True)</span></pre><p id="ff6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们画一张图，找出界限在哪里:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/05f0ea9ba86d4bb6e709689e1f87849f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*svyyURvRr4IeRvZIbrTX7Q.png"/></div></div></figure><p id="650c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我用三倍的std代替会怎么样？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/8e982d021ab34a786bef8ccfa0a237bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kmrbWM_j38zwXjVmc4aU6w.png"/></div></div></figure><p id="61f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯…有点过头了。我们把它改成两倍的std:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/6f6e2a0e287d549e7248176e14e7e779.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jt2ns4tAFDcmOpF4vAzOvw.png"/></div></div></figure><p id="3388" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是正确的！现在是时候去寻找那些离群值了:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/fc94266a52b9ebcf475f9c0517496ffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:308/format:webp/1*klK4zRmbNTqL-6y4wVJE5A.png"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="68dc" class="nm me it bd mf nn no np mi nq nr ns ml jz nt ka mo kc nu kd mr kf nv kg mu nw bi translated">小费！</h1><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="8b22" class="md me it oe b gy oi oj l ok ol"># The above code snippet can be refracted as follow:</span><span id="f2e7" class="md me it oe b gy ot oj l ok ol">cond = (d1['simple_rtn'] &gt; d1['mean'] + d1['std'] * 2) | (d1['simple_rtn'] &lt; d1['mean'] - d1['std'] <br/>d1['outliers'] = np.where(cond, 1, 0)</span></pre><p id="5e20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看一下离群信息。我们知道在2，745个数据点中有127个异常值(约4.6%):</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="b7b5" class="md me it oe b gy oi oj l ok ol">outliers.info()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/8e2c2b982dd48f4feb9a0f119a0ae63b.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*WJxi3kE-kTbAY1wtIyYYkw.png"/></div></div></figure><p id="df96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们将两倍的标准差作为边界，我们会得到4.6%的数据点超出范围。我们可以挑出那些异常值，将它们放入另一个数据框架，并在图表中显示出来:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/88d8bbaf4de9b1b8cff845d15596e4b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SYMF2dLG49L7r7G5Z7L1Sw.png"/></div></div></figure><p id="8d7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感觉有点过头了。我们把它微调到标准值的2.5倍。这次，我们得到了41个异常值(~1.5%):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/f20a952a515fca2be473fec9c98320b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZXcRxA8m2FTieuH7efht9g.png"/></div></figure><p id="208d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的一点是，当附近有相当多的大回报时，算法会将第一个识别为异常值，将第二个识别为常规观察值(如圆圈中所示)。这可能是由于第一个异常值进入滚动窗口并影响移动平均值/标准偏差。</p><p id="40bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">窗口大小和标准差都会影响最终结果。我们可以对它们进行微调，以更好地满足我们的需求。与之前的方法相比，移动平均法更加敏感。您可以查看之前的文章以获得更好的理解:</p><div class="ox oy gp gr oz pa"><a href="https://medium.com/@kegui/identifying-outliers-part-one-c0a31d9faefa" rel="noopener follow" target="_blank"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">识别异常值—第一部分</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">— python for finance系列之一</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">medium.com</p></div></div><div class="pj l"><div class="pk l pl pm pn pj po ks pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a href="https://medium.com/@kegui/identifying-outliers-part-three-257b09f5940b" rel="noopener follow" target="_blank"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">识别异常值——第三部分</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">如何通过熊猫来查找和可视化数据集中的异常值</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">medium.com</p></div></div><div class="pj l"><div class="pk l pl pm pn pj po ks pa"/></div></div></a></div></div></div>    
</body>
</html>