# 拉动式请求是否阻碍了您的团队？

> 原文：<https://betterprogramming.pub/are-pull-requests-holding-back-your-team-e8aec48986c2>

## 拉取请求对于开源软件来说非常好。但是他们会阻碍团队的表现

![](img/cbd8babf49856d2745220257351aebb4.png)

戴维·巴洛在 [Unsplash](/s/photos/pull?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片

# 介绍

Git、GitHub 和 Pull Requests (PR)的兴起给软件行业的实践和工作流程带来了巨大的变化。特别是，他们彻底改变了开源世界，提供了一个强大的机制，允许并鼓励陌生人为项目做出贡献。

branch and pull request 工作流也被大量商业软件团队所采用，它似乎已经成为开发工作流事实上的标准。但是作为一个使用这个工作流程几年的用户，我开始质疑以下几点:

*   商业软件行业是否已经无意识地获得了特性分支，仅仅作为采用拉式请求的一种手段？
*   如果是这样，我们是否为了适应拉式请求而放弃了“真正的”持续集成(CI)的好处？
*   对于商业软件团队来说,“拉”请求是值得努力的吗？

# 为什么我们想要拉请求

拉请求有明显的吸引力。它们提供了新代码与当前代码并排的非常方便的视图。肯定没有更好的审查代码的机制了吧？ ***** 它还允许添加行内评论，促使讨论发生——这只能是一件好事，对吗？ *****

现代的基于 Git 的系统(比如 Bitbucket)也提供了针对 pull 请求设置合并检查的能力，需要在合并之前成功构建*。您还可以配置您的构建服务器来拉主线分支，并在本地将其与拉请求分支合并。根据合并的结果构建和执行测试，可以让您提前看到两个版本是否兼容。*

这些特征是可取的，并且感觉与[精益思想](https://en.wikipedia.org/wiki/Lean_thinking)合拍。通过在变更合并之前对其进行验证，我们在早期就建立了质量，不是吗？ *****

**加载的问题*

# 我被吸进去了

出于上述原因，如果我真的诚实，可能因为 GitHub 和 PRs 是时髦的“东西”，我一直是引入 PRs 的倡导者。它们的受欢迎程度让我认为它们肯定是有益的，因为整个行业都在采用它们。如果其他组织/团队没有使用它们，我甚至会认为它们是“业余”的。

但是在使用这种方法几年后，并且获得了实现持续交付的新愿望，我开始意识到它们有严重的缺点，并且可能它们实际上对商业团队没有好处。

# 如果您使用拉请求，您可能没有进行持续集成

软件业深受货物崇拜之苦。组织和个人经常如此努力地寻找那些[银弹](https://en.wikipedia.org/wiki/No_Silver_Bullet)，以至于他们相信他们会神奇地解决他们所有的问题。但是，唉，人们往往没有花时间去真正理解这种子弹的原理和适用性。这方面的终极例子可能是“敏捷”；如果你在做站立和冲刺，你是敏捷的，对吗？微服务是一个更近的例子，我认为持续集成可能是另一个例子。例如，“CICD”一词经常被使用，但我觉得特别是“词”的部分已经失去了它的意义。

持续集成意味着非常具体的东西。它源于[肯特·贝克](https://twitter.com/KentBeck)，是他的[极限编程](https://www.amazon.co.uk/Extreme-Programming-Explained-Embrace-Change/dp/0321278658)方法的 12 个实践之一。马丁·福勒在这里记录了这种做法。

我认为最基本的规则是:

每个人每天都致力于主线。

这条规则对实践来说是如此重要，以至于你可以把它和它的名字协调起来:

**连续** —每天(*该什么时候* )
**集成** —主线分支(*该哪里*)

所以在一个使用拉式请求的团队中，除非**你团队中的每个人**每天都至少合并一个拉式请求**，你真的能声称正在进行持续集成吗？**

**在我的经验中，尽管有使用短命分支的意图，但是使用拉请求工作流的团队不自觉地陷入了[特性分支](https://martinfowler.com/bliki/FeatureBranch.html)策略，在它们被审查和合并/集成之前，开发人员在隔离状态下工作至少几天。但严格来说，这不是持续集成。[史蒂夫·史密斯](https://twitter.com/SteveSmith_Tech)就这个话题做了一个很棒的演讲:[持续集成之死](https://www.infoq.com/presentations/death-continuous-integration/)。**

# **这里没有教条，但是…**

**我应该指出，我绝对反对教条式地遵循规则。团队应该尝试并采用适合他们的工作流程。*而不是*采用持续集成的*、*原始或“纯”形式对于一个给定的*、*团队来说可能是一个合理且有意识的选择。另外，尽管使用拉请求，您仍然可以获得 CI 的一些好处。**

**但是我确实认为使用拉请求的团队不太可能遵守这个基本规则，因此损害了 CI 的强大之处；其生产的[社会技术系统](https://en.wikipedia.org/wiki/Sociotechnical_system)。如果按照最初的意图实施，CI 有助于优化团队成员的行为，有利于团队整体的绩效，而不是优化个人。**

# **特性分支与基于主干的开发**

**你可能会想，到目前为止，我的论点实际上不是关于拉请求，而是分支策略，即[特性分支](https://martinfowler.com/bliki/FeatureBranch.html)与[基于主干的开发](https://trunkbaseddevelopment.com/)。这是真的；向功能分支的转变损害了 CI，而不是拉取请求本身，但是…**

# **拉请求鼓励长寿分支吗？**

***(长寿=超过一天)***

**回想我过去几年使用拉式请求的个人经历，我会说它们是在一个单独的分支机构工作超过一天——通常超过三天——的一个促成因素。我认为工作流鼓励我一次完成所有事情:一个漂亮的、大的、胖的原子提交，包含了有时相当大的功能的全部。**

**我个人的实践显然不能反映我们整个行业的情况，但是我认为 PRs 的使用自然会让开发人员孤立地工作几天。所以我有一种预感，使用 PRs 的团队将与使用长期分支的团队相关联。**

# **长期存在的分支=较低的团队绩效**

**虽然我没有这种相关性的证据，但根据这一假设的推论，提出 PRs 的团队不太可能被归类为高绩效团队。这种将使用较长运行分支的团队与较低性能联系起来的断言不是我的观点；这一点被 DevOps 报告 (SODR)的[状态中产生的研究和数据所证明，并呈现在奇妙的书](https://services.google.com/fh/files/misc/state-of-devops-2019.pdf)[加速](https://www.goodreads.com/book/show/35747076-accelerate) *:* 中**

> **“我们的研究还发现，开发主干/主分支而不是长期功能分支与更高的交付性能相关。”
> —加速，*福斯格伦等人，2018***

**如果他们在下一份报告中调查团队，看看 PRs 和团队绩效之间是否有直接的关联，这将是很有趣的。**

**顺便说一下，对“高绩效”团队的分类不仅仅是一种认知/观点。《加速》的作者清楚地定义了高绩效团队的特征:**

*   ****部署频率** —按需(每天多次)**
*   ****变更的交付时间** —不到一小时**
*   ****平均恢复时间** —不到一小时**
*   ****变更失败率**—0–15%**

**除了我的直觉，PRs 会导致更长的分支，我认为 PRs 还有其他方面会阻碍团队的绩效和文化。**

# **拉式请求无意中造成了不信任的环境**

**![](img/3b97dc6df77d7e051293c6997ff9d655.png)**

**戴夫·劳在 [Unsplash](/s/photos/trust?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片**

**拉请求被明确地设计为创建一个工作流来处理**的不信任。* 它们是来自陌生人的入职代码的把关机制。因此，在一个本应紧密团结的团队中引入这样一种机制似乎有些奇怪。我们真的需要一个像对待陌生人一样对待团队成员的过程吗？***

***我工作过的最高效、最成功(更不用说最快乐)的团队都是高度信任、有心理安全文化的团队，我们没有使用公关。***

***我逐渐意识到，公关可能会对建立信任文化和心理安全造成障碍，而 SODR 的研究得出结论认为，信任文化和心理安全有助于提高绩效:***

> ***“心理安全文化有助于 SDO 绩效、组织绩效和生产力，表明发展和培养健康的文化对组织和个人都有好处。”
> —*2019 年发展状况报告****

***我上面的一个问题表明，写内联评论的能力显然是一件好事，虽然我使用这种媒介进行了积极的讨论，但我也看到了它的消极作用。文字评论很容易被误解——评判性的而不是建设性的，公开羞辱而不是公开的团队讨论。我目睹过公关评论助长紧张和不信任，但我相信如果通过不同的媒体沟通，如面对面或私人即时消息，就不会出现这种情况。显然，这取决于你的团队，但如果团队内部关系恶化，我不认为公关工作流程有助于搭建桥梁。***

***在谈到信任和公关问题时，这条[推文](https://twitter.com/gga/status/1375964347973955584?s=20)确实引起了我的共鸣:***

> ***“在一个高度信任的环境中，采用需要信任的流程将有助于建立和保持信任。”贾尔斯·爱德华兹-亚历山大***

***持续集成(以其原始形式)需要一定程度的信任。即使一个团队是在没有信任的情况下开始的，这个过程也有助于创造信任。相比之下，PRs 不太可能出现这种情况——它是一个缓解信任缺失的过程，因此不太可能鼓励或发展信任缺失。***

***一个有趣的观察是，作为软件团队，我们希望从管理层那里获得授权、自治和信任，但是从外部来看，我们似乎并不信任彼此！***

# ***拉请求实际上并不适合代码审查***

***上面的另一个问题是，除了 PRs 之外，是否有更好的方法来进行代码审查。我觉得有。***

***拉请求对于快速目测代码和发现明显的错误非常有用，但是我不相信它们可以被依赖于一致的深入审查。我认为很可能评论者经常只从事[系统 1 思考](https://www.scientificamerican.com/article/kahneman-excerpt-thinking-fast-and-slow/)而不是必要的系统 2。我承认:这是我的错。这通常发生在我正忙着在冲刺阶段结束前完成某件事，而有人想让我回顾他们的公关时。***

***在这种情况下，你需要与你将自己的工作置于团队集体需求之上的本能作斗争——这意味着你要停下手头的工作，认真检查同事的工作。当然，公关审查中的尽职/审查水平会因团队的纪律水平而异，但每个人都会受到人性的影响。如果你有压力，你就不会那么勤奋。***

***当审查者不尽职时，公关审批就变成了毫无意义的打勾练习。可以与糟糕的变更批准委员会(CAB)流程进行比较，Jez 谦逊地称之为“变更剧场”***

# ***逃避责任***

***我想知道 PRs 是否会鼓励开发人员产生一种虚假的安全感，让我们下意识地认为我们可以通过将责任转移给评审人员来避免一定程度的责任。***

***例如，公关工作流程是否可能鼓励一种思维过程，例如:“如果代码有一些问题，评审人员会发现它们。”或者，可能更糟的是，“……如果他们不接受，至少他们会分担责任，因为他们批准了变革。”***

***我意识到这听起来有些愤世嫉俗，我并不是说开发人员一定会有这些想法，但是 PRs 的本质会以这种方式对人性产生负面影响吗？我想知道我自己是否在压力下表现出这种行为——可能是。***

***这种(也许是无意识的)心态有明显的问题。首先，如果评审者只是将系统 1 的思考和批准作为勾选框练习，就没有安全网。第二，也许从团队文化的角度来说更贴切，这种态度给评审者带来了为其他人的变更负责的负担。***

***虽然软件开发是一项团队运动，团队作为一个整体应该对任何失败负责，但是让一个人来审查代码并分担责任会抑制他们拿起 PR 来审查。不仅如此，它还要求开发人员停止他们正在做的事情，切换上下文来审查 PR——这是另一个不利因素。***

***由于这些不利因素，我发现公关作者不得不追逐团队成员以获得批准，将公关链接粘贴到团队聊天中，并定期请求某人查看，这是常见的做法。***

# ***精益思维？***

***有理由认为 PRs 是精益思维的同义词。我们从一开始就在消除浪费和构建质量，因为我们在合并代码之前会检查代码*。感觉我们比平时做得更早。但我认为这是一个错误的前提。如果我们真的在早期构建质量，[我们会在代码被编写的时候审查代码](https://en.wikipedia.org/wiki/Pair_programming)——而不是等待开发人员走出他们的隔离期*然后*检查它。****

***PR 工作流程由于潜在的多轮评论和额外提交而浪费时间(如果你足够幸运有一个勤奋的审阅者)。添加到 PR 中的每个评论/提交都会在作者和审阅者之间触发一条异步消息，之后会有一段时间等待他们中的一个回复。在这段等待期间，他们中的任何一个都有可能回去做别的事情。这意味着当注释/提交响应被添加到 PR 中时，阻止 PR 首先被拾取的抑制因素也在起作用:它们被要求切换上下文以返回到 PR。我发现正因为如此，开放的 PRs 可能会存在很长一段时间。***

***异步工作流在开源世界中完全有意义，因为人们经常在业余时间维护项目。这种工作流程使他们能够从容地评估即将到来的变更。但是在商业团队中，我们寻求最大的效率(不要与资源利用混淆)。我们不想让采购经理在 WIP 队列中无所事事。事实上，在制品队列是精益思想的对立面；WIP 被视为废品(因此，未完成的 PRs 是废品)。***

***敏捷就是快速的反馈周期——最好是同步的。拉请求的异步本质不提供这一点，所以说它们是反敏捷的是不是太大胆了？***

# ***不要耽误项目！***

***![](img/d41e726d02f45c6a54dd1e1920deee63.png)***

***照片由[阿格巴洛斯](https://unsplash.com/@agebarros?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)在 [Unsplash](https://unsplash.com/s/photos/watch?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄***

***我遇到的另一个关于 pr 的负面经验是他们与外包开发团队的项目的关系。这是外包团队提出(通常是巨大的)PR 的地方，内部开发人员的任务是审查变更。这看起来像是对 PRs 的明智使用，因为它更类似于开源范例——从外部来源获得代码。但是当由于前面提到的抑制因素，已经有交付他们自己团队工作的压力的开发人员不愿意承担评审时，问题就出现了。***

***在这一点上，管理层介入并催促开发人员批准公开的 PR。我们现在进入微观管理领域。***

***如果评审者开始质疑已经完成的工作，事情会变得更糟。项目的最后期限(外包团队以固定的费用交付)即将到来，评审者现在被视为阻碍项目的人。外包团队声称开发人员过于挑剔，管理层对开发人员施加了更大的压力，要求其批准。这导致了全方位的怨恨，最终形成了一个没有生产力的环境。对于按时完成任务的外包团队来说，质量和良好的业务成果成为次要优先事项。套用 Robert Martin 的*The Clean Coder:A Code for Professional programmer:*如果外科医生为了节省时间而试图在手术过程中偷工减料，他们会对管理层说什么？***

# ***那么，如果拉请求是不好的，什么是好的呢？***

***首先，我不是说 PRs 是彻头彻尾的坏，不能很好地为你的团队工作；也许你的团队有他们比没有他们运作得更好。我想说的是，不要因为其他人都在使用公关，就接受它们作为最佳实践，我认为值得考虑公关工作流程实际上提供了多少价值，并权衡这些价值与成本——我在这篇文章中已经描述了一些成本。***

***有了这个警告，我认为拉请求的引入可能对商业软件团队有整体的负面影响，并且限制了优秀团队成为高绩效者的潜力(在 SODR 的意义上)。***

***不止我一个人这么想。下面是一个有类似想法的人的例子:***

***那么还有什么选择呢？我认为持续集成(以其预期的形式)与 Pair/Mob 编程相结合的实践可能会产生最好的结果。CI 的同步特性保持了变更流程的优化，而不会产生静态的 WIP 队列，代码的质量自然会更高，因为在编写代码时不断审查代码的过程使得很难不参与系统 2 的思考。***

***旁注:也许 Pair/Mob 编程应该改名为持续评审？CRID，有人吗？没有吗？***

***不可否认，我在结对编程方面没有丰富的经验，而且在撰写本文时，新冠肺炎当前的形势使得结对编程变得更加困难。但是即使没有 Pair/Mob 编程——当你从 ROI 的角度考虑 PRs 时，让整个团队尽可能快地拉动和运行你的变更可能是更有效的代码评审形式。PRs 真正的回报是多少？***

***我发现 PRs 通常会指出一些相对较小的事情，比如打字错误/命名等。—在这种情况下，我认为简单地希望开发人员在拉出更改后会注意到它们，并当场修复它们可能更有效。你可能会对“希望”这个词感到惊讶也许你在想:我们肯定应该做些比“希望”更有力的事情吧？但是，虽然 PRs 肯定有助于将明显的错误放在前面和中间，我们仍然只是*希望*事情会被评论者注意到。不保证。***

***我们假设他们不会被注意到。我不相信仅仅为了有更好的机会让他们被注意到而花费公关费用是值得的。如果变化真的有问题，那么某种形式的测试肯定会失败，如果没有，你有更大的问题要解决。***

***如果公关审查发现了更重要的事情——也许是开发人员误解并产生了大量误导性的变更——人们很容易认为这是公关过程的胜利。但是我并不认为这是对不良变更的成功缓解，我认为公关工作流是浪费开发人员时间的同谋。***

***它允许(如果不是鼓励的话)开发人员进入隔离模式，写一些不正确的东西。如果开发人员一直遵循 CI 并每天推进较小的提交，很可能他们的误解会在早期被团队的其他成员发现，为团队提供纠正过程的能力而不浪费太多时间。***

# ***结论***

***我现在认为，商业团队中的拉请求通常是次优的。***

***鉴于我在这篇文章中描述的负面影响，以及来自 SODR 的证据表明长期分支和缺乏信任会影响团队绩效，我的愿望是尝试并说服我的团队放弃 PRs，回到同一个分支工作，进行小规模提交。***

***我怀疑我关于不使用 PRs 的建议会遭到一些人的质疑，特别是因为 PRs 是由我目前工作的“上级”授权的[。但尽管如此，我不再认为减贫战略是一项有价值的努力。](https://www.informit.com/articles/article.aspx?p=101654)***