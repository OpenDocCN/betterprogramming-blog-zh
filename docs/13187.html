<html>
<head>
<title>Building a Graph With SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SwiftUI构建图表</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-a-graph-with-swiftui-b16dc48f7fe6?source=collection_archive---------10-----------------------#2022-08-04">https://betterprogramming.pub/building-a-graph-with-swiftui-b16dc48f7fe6?source=collection_archive---------10-----------------------#2022-08-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="65fe" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">学习图形的基础知识</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2e1bec9c1f9d7b16e514d10fa1cd999b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S7kNaSsDi_OwqtO4"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@lxrcbsv?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">алексарцибашев</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h1 id="f627" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">先决条件</strong></h1><ul class=""><li id="cd67" class="lo lp iq lq b lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">swift基础知识(了解如何在Swift中编码)</li><li id="c51c" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">SwiftUI的基础知识(了解SwiftUI中的基本组件以及如何使用它们)</li><li id="0c25" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">学习的意愿！</li></ul></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="3175" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">你曾经打开过一个网站，看到过这样的可视化图表吗？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/a64bd29ce11bc2545bbb75028ec96b49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2fIt9Gr9P9TPpqOTn-Z4nQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">网络图可视化<a class="ae kv" href="https://www.connectedpapers.com/main/49a049dc85e2380dde80501a984878341dd8efdf/wav2vec-2.0%3A-A-Framework-for-Self%20Supervised-Learning-of-Speech-Representations/graph" rel="noopener ugc nofollow" target="_blank">类似论文</a></p></figure><p id="c8d7" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">这被称为<a class="ae kv" href="https://en.wikipedia.org/wiki/Network_theory" rel="noopener ugc nofollow" target="_blank">网络图</a>，通常用于建模许多项目之间的关系。这种图的一些应用是可视化社交网络中的朋友、互联的城市，甚至是你在任何生物学教科书中找到的典型食物链。网络图由两部分组成，顶点和边。顶点代表图形中可视化的项目，边显示相似项目之间的关系。</p><p id="6239" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">但是你有没有想过这样的图是怎么做出来的？你如何在图表中排列每一项？我不会对图论和您的应用程序是否需要图论进行过多的详细说明，但我将在本文中向您展示为您的SwiftUI应用程序显示这样一个可视化背后的技术细节。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="a44f" class="kw kx iq bd ky kz ni lb lc ld nj lf lg jw nk jx li jz nl ka lk kc nm kd lm ln bi translated"><strong class="ak">好先生图</strong></h1><p id="2bc8" class="pw-post-body-paragraph ms mt iq lq b lr ls jr mv lt lu ju mx lv nn mz na lx no nc nd lz np nf ng mb ij bi translated">在我们深入了解如何构建具有许多顶点和边的复杂图形可视化之前，让我们先从一个基本图形开始。这个简单的图有两个顶点和一条边。它看起来会像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/befcf6e13d6a762ce22160f2c0f1429d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*SOuNrKAZSGKpNt9yHLkhbQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">不，这不是大白。这是一个有两个顶点和一条边的图。</p></figure><p id="e335" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">首先，我们从我们的背景开始。在Xcode中设置一个SwiftUI项目(如果你不知道怎么做，可以查看YouTube上的教程，比如<a class="ae kv" href="https://www.youtube.com/watch?v=tPWUsSELJyY" rel="noopener ugc nofollow" target="_blank">这个</a>)。你应该从一个空的<code class="fe nr ns nt nu b">ContainerView</code>开始。</p><p id="f4cb" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">为了给我们的图形提供背景，首先创建一个矩形的<code class="fe nr ns nt nu b">ZStack</code>作为第一项。对于<code class="fe nr ns nt nu b">ZStack</code>,我们会给它<code class="fe nr ns nt nu b">topLeading</code>对齐我们的坐标系(我稍后会解释这一点),对于矩形，给它填充你想要的图形背景颜色。我选择了白色。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们图表背景的代码片段。</p></figure><p id="7649" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">我们的图表通过将每个顶点标绘到<code class="fe nr ns nt nu b">ZStack</code>中的二维坐标系中来工作。因为我们给了它<code class="fe nr ns nt nu b">topLeading</code>对齐，坐标(0，0)将从设备屏幕的左上角开始。</p><p id="52f8" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">设备屏幕上的每个像素代表坐标系中的一个点，向x坐标添加一个值会将我们的点向右移动，向y坐标添加一个值会将我们的点向下移动。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/2daf868cca98196f575bf8bfd646eacf.png" data-original-src="https://miro.medium.com/v2/resize:fit:364/format:webp/1*VKsuKubsONXZitQ5LEh2kg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们图表的坐标系统。</p></figure></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="8c13" class="kw kx iq bd ky kz ni lb lc ld nj lf lg jw nk jx li jz nl ka lk kc nm kd lm ln bi translated">向我的小伙伴们问好。</h1><p id="e195" class="pw-post-body-paragraph ms mt iq lq b lr ls jr mv lt lu ju mx lv nn mz na lx no nc nd lz np nf ng mb ij bi translated">现在我们有了坐标系，我们可以通过使用SwiftUI中的圆形在图形中放置一个顶点(实际上，任何形状都可以，但大多数图形使用圆形来表示顶点)。</p><p id="b6c9" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">我们将修改我们的圆中的两个属性，框架(我们的圆有多高多宽)和偏移量。圆的offset属性中的x和y值决定了圆在图形坐标系中的位置。</p><p id="ad58" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">例如，如果您为x和y值输入50，我们的圆应该出现在设备屏幕左上角附近的某个地方。您可以尝试不同的x和y值，但您应该记住，x越大，我们的圆将显示得越靠右，y越大，我们的圆将放置得越靠下。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">画出我们孤独寂寞的顶点的代码片段。</p></figure><h1 id="7780" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">在ZStack </strong>中，确保我们的圆形(顶点)组件在矩形(背景)组件之后。</h1><p id="7daa" class="pw-post-body-paragraph ms mt iq lq b lr ls jr mv lt lu ju mx lv nn mz na lx no nc nd lz np nf ng mb ij bi translated">现在你应该可以在预览中看到你的顶点了，但是，你可以看到它有点孤单。所以，让我们给它一个朋友，在我们图形的坐标系中的其他地方。对于这个朋友，我将通过给圆的fill属性赋予红色值来给她涂上红色。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的小顶点朋友的代码片段。:]</p></figure><p id="02b7" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">您的屏幕现在应该看起来像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/763fd04f397c8840a9408e6f3953db5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*86BHcVRirKdlrFt5mo2oHg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">两个点。看来你的手机现在有眼睛了。</p></figure><p id="d7c9" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">如果还没有，不要担心，保持冷静，回顾你用上面的代码片段写的代码。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="e5e8" class="kw kx iq bd ky kz ni lb lc ld nj lf lg jw nk jx li jz nl ka lk kc nm kd lm ln bi translated">感觉急躁。</h1><p id="1167" class="pw-post-body-paragraph ms mt iq lq b lr ls jr mv lt lu ju mx lv nn mz na lx no nc nd lz np nf ng mb ij bi translated">现在，我们将通过在这两个顶点之间画一条线来使它们看起来像是相互连接的。首先，我们将创建一个新的Swift文件，并将其命名为<code class="fe nr ns nt nu b">EdgeShape.swift</code>。在这个文件中，我们将通过创建一个新的Struct并使其符合<code class="fe nr ns nt nu b">Shape</code>协议并将其命名为<code class="fe nr ns nt nu b">EdgeShape</code>来向SwiftUI添加一个新的shape组件。</p><p id="4a3f" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">这个结构有两个属性，start(边的起始坐标)和end(边的结束坐标)。这些将属于<code class="fe nr ns nt nu b">CGPoint</code>类型。</p><p id="b597" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">为了符合Shape协议，这个struct必须有一个方法，就是<code class="fe nr ns nt nu b">path(in rect:)</code>。此方法定义如何在UI中绘制此形状。在这个方法的实现中，我们将做四件事:</p><ul class=""><li id="772a" class="lo lp iq lq b lr mu lt mw lv nz lx oa lz ob mb mc md me mf bi translated">创建路径对象</li><li id="7c47" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">使用<code class="fe nr ns nt nu b">path.move(to:) </code>方法将我们的路径移动到起始坐标</li><li id="f3cb" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">使用<code class="fe nr ns nt nu b">path.addLine(to:) </code>方法从起始坐标添加一条线</li><li id="e939" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">在方法中返回我们的路径</li></ul><p id="6ffd" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">我们的EdgeShape的代码应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的边缘形状的代码片段。</p></figure><p id="e187" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">现在我们可以回到我们的<code class="fe nr ns nt nu b">ContentView.swift</code>文件，在<code class="fe nr ns nt nu b">ZStack</code>中的两个圆形组件之间添加<code class="fe nr ns nt nu b">EdgeShape</code>组件来绘制一条边。首先，通过创建两个<code class="fe nr ns nt nu b">CGPoint</code>对象，给<code class="fe nr ns nt nu b">EdgeShape</code>构造函数一个开始和结束值。</p><p id="39dc" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">对于起点<code class="fe nr ns nt nu b">CGPoint</code>，给它的起点x和y与我们的黑色顶点的坐标相同的值。然后对于末端<code class="fe nr ns nt nu b">CGPoint</code>，给它的起点x和y与我们的红色顶点的坐标相同的值。</p><p id="a7f9" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">请注意，即使我们已经使用了EdgeShape组件，这条线仍然没有画出来。那是因为我们只画了一条路径，却没有给它任何颜色和粗细。为此，给我们的<code class="fe nr ns nt nu b">EdgeShape</code>一笔，可选颜色。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">第一条边的代码片段。</p></figure><p id="92b2" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">耶！您已经成功地用一条边连接了两个顶点。但是，您可能会注意到，即使您正确放置了起点和终点坐标，您的边似乎也不在合适的位置。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/58af2caa1c1421bc0fe95a6d1d59aa42.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*YpA2az-bPecFlCSIc4sSzg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">不在正确位置的顽固边缘。</p></figure></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="89cb" class="kw kx iq bd ky kz ni lb lc ld nj lf lg jw nk jx li jz nl ka lk kc nm kd lm ln bi translated">修理它！</h1><p id="59c4" class="pw-post-body-paragraph ms mt iq lq b lr ls jr mv lt lu ju mx lv nn mz na lx no nc nd lz np nf ng mb ij bi translated">不用担心，这种行为是完全可以预料的，因为顶点是通过它的左上角与我们给它的坐标对齐的，而不是中心。我们将解决这个问题，同时为我们的顶点视图重构代码。</p><p id="acbc" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">首先，创建一个名为<code class="fe nr ns nt nu b">VertexView.swift</code>的新Swift文件。在文件中导入SwiftUI，然后创建一个新的struct，该struct扩展了名为<code class="fe nr ns nt nu b">VertexView</code>的<code class="fe nr ns nt nu b">View</code>,具有类型为some View的body属性。</p><p id="5036" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">这个结构将有另外三个属性，类型为<code class="fe nr ns nt nu b">Double</code>的<code class="fe nr ns nt nu b">radius</code>，类型为<code class="fe nr ns nt nu b">Color</code>的颜色，以及类型为<code class="fe nr ns nt nu b">CGPoint</code>的坐标。</p><ul class=""><li id="435c" class="lo lp iq lq b lr mu lt mw lv nz lx oa lz ob mb mc md me mf bi translated">在body属性中，我们将定义一个圆，就像我们之前对顶点所做的那样，然后从我们的color属性中添加一个color属性。</li><li id="a412" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">然后，给圆一个框架属性，宽度和高度是半径乘以2，还有一个偏移属性，分别是坐标的x和y属性。</li><li id="b811" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">然而，我们现在要用圆的半径减去x和y值，根据圆的中心来偏移圆。</li></ul><p id="75a6" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">您的代码应该如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的顶点视图的代码片段。</p></figure><p id="315e" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">现在，回到<code class="fe nr ns nt nu b">ContentView.swift</code>文件，然后用我们新构建的<code class="fe nr ns nt nu b">VertexView</code>替换我们的每一个Circle组件。确保给第一个<code class="fe nr ns nt nu b">VertexView</code>到我们的<code class="fe nr ns nt nu b">EdgeShape</code>开始的每一个<code class="fe nr ns nt nu b">CGPoint</code> x和y值，给第二个<code class="fe nr ns nt nu b">EdgeShape</code>结束的每一个【顶点视图】。</p><p id="5eaa" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">代码应该如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的内容视图的最终代码片段</p></figure><p id="e7f6" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">现在，我们的用户界面应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/2cec8500249ce72b6af1a83ba2d1156d.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*oJsQ4ADbfILfVxMJ8-gNqQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图表的起点</p></figure><p id="29f2" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">接下来，您可以通过添加任意多的顶点和边来试验图形！一旦你这样做了，你就可以尝试从一组<code class="fe nr ns nt nu b">CGPoint</code>对象中自动显示图形的顶点和边！(提示:在SwiftUI中使用带有<code class="fe nr ns nt nu b">ForEach</code>组件的<code class="fe nr ns nt nu b">CGPoints</code>数组)。</p><p id="fd17" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">如果你在教程的任何一点上卡住了，这里是项目的<a class="ae kv" href="https://github.com/m-salman-a/graph-sample" rel="noopener ugc nofollow" target="_blank">完整源代码。</a></p><p id="cad9" class="pw-post-body-paragraph ms mt iq lq b lr mu jr mv lt mw ju mx lv my mz na lx nb nc nd lz ne nf ng mb ij bi translated">另外，如果你愿意的话，如果你能看看我用SwiftUI从我们学过的图形基础中构建一个力导向图形的项目<a class="ae kv" href="https://github.com/m-salman-a/refgraph" rel="noopener ugc nofollow" target="_blank">那就太好了！</a></p></div></div>    
</body>
</html>