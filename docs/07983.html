<html>
<head>
<title>How Promises Actually Work in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中承诺的实际工作方式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-promises-actually-work-in-javascript-1c80b1af7193?source=collection_archive---------3-----------------------#2021-03-11">https://betterprogramming.pub/how-promises-actually-work-in-javascript-1c80b1af7193?source=collection_archive---------3-----------------------#2021-03-11</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="8755" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">了解何时以及如何使用它们</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/52a642ba950c20f20a8bc317488e3ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mFovAo5NOpboICSM"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@flowforfrank?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ferenc Almasi </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="deb0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在当前的JavaScript时代，<code class="fe lw lx ly lz b">Promises</code>是JavaScript中处理异步行为的默认方式。但是它们是如何工作的呢？为什么你要非常了解他们？</p><p id="3501" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本文中，我将深入JavaScript <code class="fe lw lx ly lz b">Promises</code>来理解它们的作用以及何时应该使用它们。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="7745" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">现实生活中的承诺</h1><p id="f67b" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">当我向你承诺时，你要相信我的话，我会实现那个承诺。</p><p id="288f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是我不告诉你那个承诺什么时候兑现，所以生活还要继续…</p><p id="27d6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有两种可能的情况:满足或拒绝。</p><h2 id="3747" class="ne mi iu bd mj nf ng dn mn nh ni dp mr lj nj nk mt ln nl nm mv lr nn no mx np bi translated">完成</h2><p id="bc7e" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">有一天，我实现了那个承诺。它让你如此开心以至于你在推特上发布了它！</p><h2 id="3a71" class="ne mi iu bd mj nf ng dn mn nh ni dp mr lj nj nk mt ln nl nm mv lr nn no mx np bi translated">拒绝</h2><p id="31ed" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">有一天，我告诉你，我不能履行承诺。</p><p id="2744" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你在推特上发了一个悲伤的帖子，说我没有兑现我的承诺。</p><p id="e4fb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这两种情况都会导致一个动作。第一个是积极的，第二个是消极的。</p><p id="bb8e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在研究JavaScript <code class="fe lw lx ly lz b">Promises</code>如何工作的时候，请记住这个场景。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="74f4" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">何时使用承诺</h1><p id="3d1d" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">JavaScript是同步的。它从上到下运行。下面的每一行代码都将等待上面代码的执行。</p><p id="21eb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是当你想从一个API获取数据的时候，你不知道多快能把数据拿回来。更确切地说，你还不知道你会得到数据还是错误。错误无时无刻不在发生，那些事情是无法计划的。但是我们可以做好准备。</p><p id="0425" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，当您等待从API获得结果时，您的代码会阻塞浏览器。它会冻结浏览器。我们和我们的用户对此都不高兴！</p><p id="040c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对一只<code class="fe lw lx ly lz b">Promise</code>来说是完美的情况！</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="8698" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">如何使用承诺</h1><p id="10e0" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">既然我们知道在发出Ajax请求时应该使用<code class="fe lw lx ly lz b">Promise</code>，我们就可以开始使用<code class="fe lw lx ly lz b">Promises</code>了。首先，我将向您展示如何定义一个返回<code class="fe lw lx ly lz b">Promise</code>的函数。然后，我们将深入研究如何使用返回<code class="fe lw lx ly lz b">Promise</code>的函数。</p><h2 id="627b" class="ne mi iu bd mj nf ng dn mn nh ni dp mr lj nj nk mt ln nl nm mv lr nn no mx np bi translated">用承诺定义一个函数</h2><p id="4021" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">下面是一个返回<code class="fe lw lx ly lz b">Promise</code>的函数示例:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nq nr l"/></div></figure><p id="a387" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">该函数返回一个<code class="fe lw lx ly lz b">Promise</code>。这个<code class="fe lw lx ly lz b">Promise</code>可以解决，也可以拒绝。</p><p id="8dc0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">就像现实生活中的承诺一样，一个<code class="fe lw lx ly lz b">Promise</code>可以实现，也可以拒绝。</p><h2 id="7e51" class="ne mi iu bd mj nf ng dn mn nh ni dp mr lj nj nk mt ln nl nm mv lr nn no mx np bi translated">州</h2><p id="f4f8" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">根据<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank"> MDN网络文档</a>，一个JavaScript <code class="fe lw lx ly lz b">Promise</code>可以有三种状态之一:</p><blockquote class="ns nt nu"><p id="f62d" class="la lb nv lc b ld le jv lf lg lh jy li nw lk ll lm nx lo lp lq ny ls lt lu lv in bi translated">"-待定:初始状态，既未完成也未拒绝。</p><p id="742f" class="la lb nv lc b ld le jv lf lg lh jy li nw lk ll lm nx lo lp lq ny ls lt lu lv in bi translated">-已完成:表示操作成功完成。</p><p id="380a" class="la lb nv lc b ld le jv lf lg lh jy li nw lk ll lm nx lo lp lq ny ls lt lu lv in bi translated">- rejected:表示操作失败。"</p></blockquote><h2 id="5fba" class="ne mi iu bd mj nf ng dn mn nh ni dp mr lj nj nk mt ln nl nm mv lr nn no mx np bi translated">悬而未决的</h2><p id="e646" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated"><code class="fe lw lx ly lz b">pending</code>状态是初始状态。这意味着我们一调用<code class="fe lw lx ly lz b">doSomething()</code>函数就有这种状态，所以我们还不知道<code class="fe lw lx ly lz b">Promise</code>是被拒绝还是被解决。</p><h2 id="7481" class="ne mi iu bd mj nf ng dn mn nh ni dp mr lj nj nk mt ln nl nm mv lr nn no mx np bi translated">断然的</h2><p id="dac4" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">在这个例子中，如果<code class="fe lw lx ly lz b">value</code>为真，那么<code class="fe lw lx ly lz b">Promise</code>将被解析。在这种情况下，我们将变量<code class="fe lw lx ly lz b">value</code>传递给它，以便在调用这个函数时使用它。</p><p id="2e09" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们可以定义我们的条件来决定何时解决我们的<code class="fe lw lx ly lz b">Promise</code>。</p><h2 id="a8aa" class="ne mi iu bd mj nf ng dn mn nh ni dp mr lj nj nk mt ln nl nm mv lr nn no mx np bi translated">拒绝</h2><p id="56d9" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">在本例中，如果<code class="fe lw lx ly lz b">value</code>为假，则<code class="fe lw lx ly lz b">Promise</code>将被拒绝。在这种情况下，我们传递一个错误消息。这里只是一个字符串，但是当你发出一个Ajax请求时，你传递的是服务器的错误。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="b80c" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">使用有承诺的功能</h1><p id="e6f0" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">现在我们知道了如何定义一个<code class="fe lw lx ly lz b">Promise</code>，我们可以深入研究如何使用一个返回<code class="fe lw lx ly lz b">Promise</code>的函数:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nq nr l"/></div></figure><p id="734e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以通过<code class="fe lw lx ly lz b">.then()</code>方法或<code class="fe lw lx ly lz b">await</code>关键字识别返回<code class="fe lw lx ly lz b">Promise</code>的函数。如果您的<code class="fe lw lx ly lz b">Promise</code>出现错误，将会调用<code class="fe lw lx ly lz b">catch</code>。所以为<code class="fe lw lx ly lz b">Promise</code>进行错误处理是非常简单的。</p><p id="d720" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">Promises</code>也在很多JavaScript库和框架中使用。但是最简单的web API是Fetch API，您应该使用它来发出Ajax请求。如果你想知道它是如何工作的，请查看下面的教程:</p><div class="nz oa gq gs ob oc"><a rel="noopener  ugc nofollow" target="_blank" href="/from-xhr-to-fetch-with-async-await-on-the-finish-line-b021de1d226b"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd iv gz z fq oh fs ft oi fv fx it bi translated">从XHR到终点的异步/等待取货</h2><div class="oj l"><h3 class="bd b gz z fq oh fs ft oi fv fx dk translated">看看JavaScript中请求的发展和历史</h3></div><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">better编程. pub</p></div></div><div class="ol l"><div class="om l on oo op ol oq kt oc"/></div></div></a></div></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="d6d5" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">结论</h1><p id="3b37" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">希望这能帮助你理解<code class="fe lw lx ly lz b">Promises</code>是如何工作的，以及你能用它们做什么。</p><p id="ba10" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你对<code class="fe lw lx ly lz b">Promises</code>有任何疑问，请告诉我。</p><p id="be4d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">编码快乐！</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="3821" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">从我这里读更多</h1><div class="nz oa gq gs ob oc"><a rel="noopener  ugc nofollow" target="_blank" href="/7-web-development-guidelines-to-speed-up-page-loading-e8f0e13a53b"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd iv gz z fq oh fs ft oi fv fx it bi translated">加速页面加载的7个Web开发指南</h2><div class="oj l"><h3 class="bd b gz z fq oh fs ft oi fv fx dk translated">为了你的访问者的爱，改善用户体验</h3></div><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">better编程. pub</p></div></div><div class="ol l"><div class="or l on oo op ol oq kt oc"/></div></div></a></div><div class="nz oa gq gs ob oc"><a href="https://devbyrayray.medium.com/css-variable-with-styled-components-7e91d89f13f3" rel="noopener follow" target="_blank"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd iv gz z fq oh fs ft oi fv fx it bi translated">带有样式化组件的CSS变量</h2><div class="oj l"><h3 class="bd b gz z fq oh fs ft oi fv fx dk translated">在Next.js/React.js轻松使用它们</h3></div><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">devbyrayray.medium.com</p></div></div><div class="ol l"><div class="os l on oo op ol oq kt oc"/></div></div></a></div><div class="nz oa gq gs ob oc"><a href="https://devbyrayray.medium.com/how-to-use-css-media-queries-with-styled-components-in-react-js-f5db5ffcc5f0" rel="noopener follow" target="_blank"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd iv gz z fq oh fs ft oi fv fx it bi translated">如何在React.js中对样式化组件使用CSS媒体查询</h2><div class="oj l"><h3 class="bd b gz z fq oh fs ft oi fv fx dk translated">在样式化组件中更智能地使用媒体查询</h3></div><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">devbyrayray.medium.com</p></div></div><div class="ol l"><div class="ot l on oo op ol oq kt oc"/></div></div></a></div><div class="nz oa gq gs ob oc"><a href="https://devbyrayray.medium.com/developer-dilemmas-new-technology-vs-old-technology-3de8726ef6c1" rel="noopener follow" target="_blank"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd iv gz z fq oh fs ft oi fv fx it bi translated">开发者的困境:新技术VS旧技术</h2><div class="oj l"><h3 class="bd b gz z fq oh fs ft oi fv fx dk translated">中短篇小说</h3></div><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">devbyrayray.medium.com</p></div></div><div class="ol l"><div class="ou l on oo op ol oq kt oc"/></div></div></a></div><div class="nz oa gq gs ob oc"><a href="https://javascript.plainenglish.io/how-to-build-a-custom-checkbox-with-javascript-82083a66ae04" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd iv gz z fq oh fs ft oi fv fx it bi translated">如何用JavaScript构建自定义复选框</h2><div class="oj l"><h3 class="bd b gz z fq oh fs ft oi fv fx dk translated">以最简单的方式学习JavaScript</h3></div><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="ol l"><div class="ov l on oo op ol oq kt oc"/></div></div></a></div></div></div>    
</body>
</html>