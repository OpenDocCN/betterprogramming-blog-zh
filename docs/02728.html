<html>
<head>
<title>Check File Accessibility, Append Data, and Change Permissions With the Node.js ‘fs’ Module</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js 'fs '模块检查文件可访问性、追加数据和更改权限</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/node-js-fs-module-check-file-accessibility-appending-data-and-changing-permissions-dbce0f2b373c?source=collection_archive---------7-----------------------#2019-12-20">https://betterprogramming.pub/node-js-fs-module-check-file-accessibility-appending-data-and-changing-permissions-dbce0f2b373c?source=collection_archive---------7-----------------------#2019-12-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1552" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过文件系统访问扩展您的应用</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8e32bb6da5feedd124bbefb2b5fe8aaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vQiSDYQDhZyQRlFi"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@rajesh_de?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拉杰什·德</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="2476" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">操作文件和目录是任何程序的基本操作。因为Node.js是一个服务器端平台，可以直接与运行它的计算机交互，所以能够操作文件是一个基本特性。</p><p id="65ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，Node.js的库中内置了一个<code class="fe lv lw lx ly b">fs</code>模块。</p><p id="06c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它有许多功能，可以帮助操纵文件和文件夹。支持的文件和目录操作包括基本的操作，如操作和打开目录中的文件。</p><p id="e0c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，它也可以对文件做同样的事情。它可以同步和异步地做到这一点。它有一个异步API，该API具有支持承诺的功能。</p><p id="9c28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，它还可以显示文件的统计数据。几乎所有我们能想到的文件操作都可以用内置的<code class="fe lv lw lx ly b">fs</code>模块来完成。</p><p id="2280" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将使用<code class="fe lv lw lx ly b">fs</code>模块中的函数来编写文件，并做其他事情，如检查文件的可访问性、添加文件和更改权限。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="8cff" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">使用fs.access和fs.accessSync检查文件可访问性</h1><p id="500f" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">我们可以使用<code class="fe lv lw lx ly b">access</code>函数来检查文件的权限。它需要三个参数。</p><p id="8c0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个参数是path对象，它是一个字符串、<code class="fe lv lw lx ly b">Buffer</code>对象或URL对象。</p><p id="987e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个参数是mode，它是一个整数，指定要检查哪种权限。整数存储为常数。可能的值包括<code class="fe lv lw lx ly b">fs.constants.W_OK</code>、<code class="fe lv lw lx ly b">fs_constants.R_OK</code>或<code class="fe lv lw lx ly b">fs.constants.F_OK</code>。</p><p id="e05c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认值为<code class="fe lv lw lx ly b">fs.constants.F_OK</code>。<code class="fe lv lw lx ly b">fs.constants.F_OK</code>表示文件存在。<code class="fe lv lw lx ly b">fs.constants.W_OK</code>意味着我们可以向它写入数据。<code class="fe lv lw lx ly b">fs_constants.R_OK</code>表示我们可以阅读。</p><p id="b710" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它们可以与位运算结合使用，以同时检查多个权限。例如，如果我们想检查一个文件是否可读或可写，我们可以写:<code class="fe lv lw lx ly b">fs.constants.W_OK | fs_constants.R_OK</code>。</p><p id="884f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一个参数是一个回调函数，它使用一个<code class="fe lv lw lx ly b">err</code>参数来显示错误(如果存在的话),如果正在检查的权限不允许用于文件，就会设置这个参数。<code class="fe lv lw lx ly b">err</code>是<code class="fe lv lw lx ly b">null</code>否则。</p><p id="bc5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用<code class="fe lv lw lx ly b">access</code>函数检查文件是否存在，我们可以编写以下代码:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="8080" class="nh mh it ly b gy ni nj l nk nl">const fs = require("fs");<br/>const file = "./files/file.txt";</span><span id="b3e2" class="nh mh it ly b gy nm nj l nk nl">fs.access(file, fs.constants.F_OK, err =&gt; {<br/>  console.log(`${file} ${err ? "does not exist" : "exists"}`);<br/>});</span></pre><p id="e264" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们运行上面的代码时，如果文件存在，我们应该得到类似下面的输出:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="fa58" class="nh mh it ly b gy ni nj l nk nl">./files/file.txt exists</span></pre><p id="067b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用它来检查文件是否可读，我们可以将<code class="fe lv lw lx ly b">fs.constants.R_OK</code>传入<code class="fe lv lw lx ly b">access</code>，如下面的代码所示:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="8bff" class="nh mh it ly b gy ni nj l nk nl">const fs = require("fs");<br/>const file = "./files/file.txt";</span><span id="a26b" class="nh mh it ly b gy nm nj l nk nl">fs.access(file, fs.constants.R_OK, err =&gt; {<br/>  console.log(`${file} ${err ? "is not readable" : "is readable"}`);<br/>});</span></pre><p id="0803" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果该文件是可读的，那么我们应该得到类似下面的输出:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="66aa" class="nh mh it ly b gy ni nj l nk nl">./files/file.txt is readable</span></pre><p id="ebb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要检查文件是否可写，我们可以使用下面代码中的<code class="fe lv lw lx ly b">fs.constants.W_OK</code>标志:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="7d18" class="nh mh it ly b gy ni nj l nk nl">const fs = require("fs");<br/>const file = "./files/file.txt";</span><span id="6139" class="nh mh it ly b gy nm nj l nk nl">fs.access(file, fs.constants.W_OK, err =&gt; {<br/>  console.log(`${file} ${err ? "is not writable" : "is writable"}`);<br/>});</span></pre><p id="5e04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果文件是可写的，我们应该得到如下输出:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="c836" class="nh mh it ly b gy ni nj l nk nl">./files/file.txt is writable</span></pre><p id="b8d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们想检查一个文件是否存在以及它是否可写，我们可以使用按位<code class="fe lv lw lx ly b">AND</code>操作符将多个常量连接在一起，如下面的代码所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="4374" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值得注意的是，在对同一个文件进行其他文件操作(如写入)之前，我们不应该使用<code class="fe lv lw lx ly b">access</code>函数来检查文件的可访问性，因为它引入了一个竞争条件，在检查文件和完成文件操作之间的时间内，其他操作可能已经改变了文件的可访问性。</p><p id="f351" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于<code class="fe lv lw lx ly b">open</code>、<code class="fe lv lw lx ly b">readFile</code>和<code class="fe lv lw lx ly b">writeFile</code>系列函数在执行任何操作之前都会检查文件的可访问性，如果不能以您指定的方式访问，就会抛出错误，所以我们不需要使用<code class="fe lv lw lx ly b">access</code>函数进行预先检查。</p><p id="78e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Windows上，目录上的访问控制策略可能会限制用户对它的访问，但是<code class="fe lv lw lx ly b">access</code>函数不会检查这一点，因此它可能会报告它是可访问的，即使它受到Windows访问控制列表的限制。</p><p id="724a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有一个同步版本的<code class="fe lv lw lx ly b">access</code>函数，叫做<code class="fe lv lw lx ly b">accessSync</code>函数。它采用与<code class="fe lv lw lx ly b">access</code>函数相同的参数，除了最后的回调参数，并返回<code class="fe lv lw lx ly b">undefined</code>。</p><p id="33d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果出现错误，将会抛出一个异常。例如，我们可以像下面的代码一样使用它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="b54a" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">使用fs.appendFile和fs.appendFileSync将数据追加到现有文件</h1><p id="8e9d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">要将数据追加到现有文件中，我们可以使用<code class="fe lv lw lx ly b">appendFile</code>函数来完成。它需要四个参数。</p><p id="c9d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个参数是对文件的引用，可以是字符串路径、<code class="fe lv lw lx ly b">Buffer</code>对象、URL对象或文件描述符，后者是标识文件的整数。</p><p id="2ae9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个参数是要写入文件的数据，可以是一个字符串或一个<code class="fe lv lw lx ly b">Buffer</code>对象。</p><p id="e279" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第三个参数用于传入一个带有几个选项的对象。有三样东西可以设置，它们是编码、模式和标志。编码指定了正在编写的文本的字符编码，默认为<code class="fe lv lw lx ly b">utf8</code>。模式是一个整数，默认为<code class="fe lv lw lx ly b">0o666</code>。</p><p id="7aa6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该模式设置文件权限和粘滞位，但仅在文件已经创建的情况下。<code class="fe lv lw lx ly b">0o666</code>既可读又可写的意思。flag选项指定正在写入的文件的读取或写入选项。</p><p id="dc9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面列出的对于这个论点都是有效的。最后一个参数是回调函数，这个函数接受一个<code class="fe lv lw lx ly b">err</code>对象，如果存在错误，这个对象不是<code class="fe lv lw lx ly b">null</code>。</p><p id="f5e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果我们想用路径<code class="fe lv lw lx ly b">./files/file.txt</code>将数据追加到一个文本文件中，我们可以用我们想写的内容调用<code class="fe lv lw lx ly b">appendFile</code>，如下面的代码所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="01e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您使用给定的路径转到文件，那么您应该看到内容写在文件的末尾。</p><p id="890c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以使用由<code class="fe lv lw lx ly b">open</code>函数提供的文件描述符，我们可以一起使用<code class="fe lv lw lx ly b">open</code>和<code class="fe lv lw lx ly b">append</code>，如下面的代码所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="1c44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们将<code class="fe lv lw lx ly b">a+</code>传递给了<code class="fe lv lw lx ly b">open</code>函数的参数，让我们将新数据追加到现有文件中。</p><p id="0863" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">append</code>功能的同步版本是<code class="fe lv lw lx ly b">appendSync</code>功能。它将给定的内容同步附加到给定的文件中。</p><p id="4248" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它需要三个参数。第一个参数是对文件的引用，它可以是字符串路径、<code class="fe lv lw lx ly b">Buffer</code>对象、URL对象或文件描述符，后者是标识文件的整数。</p><p id="cac8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个参数是要写入文件的数据，它可以是一个字符串或一个<code class="fe lv lw lx ly b">Buffer</code>对象。第三个参数用于传入一个带有几个选项的对象。</p><p id="5fa6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有三件事可以设置，编码、模式和标志。编码指定了正在写入的文本的字符编码，默认为<code class="fe lv lw lx ly b">utf8</code>。</p><p id="6baa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模式是默认为<code class="fe lv lw lx ly b">0o666</code>的整数。该模式设置文件权限和粘滞位，但仅在文件已经创建的情况下。<code class="fe lv lw lx ly b">0o666</code>表示既可读又可写。</p><p id="3ef7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">flag选项指定正在写入的文件的读取或写入选项。上面列出的对于这个论点都是有效的。</p><p id="b6c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以像下面的代码那样调用它:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="ed8c" class="nh mh it ly b gy ni nj l nk nl">const fs = require("fs");<br/>const file = "./files/file.txt";</span><span id="bc97" class="nh mh it ly b gy nm nj l nk nl">fs.appendFileSync(file, "data", { encoding: "utf8", mode: 666 });<br/>console.log('The "data" was appended to file!');</span></pre><p id="4969" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以通过使用<code class="fe lv lw lx ly b">openSync</code>函数来获取文件描述符，将它与文件描述符一起使用，如下面的代码所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="a50e" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">使用fs.chmod和fs.chmodSync更改文件的权限</h1><p id="978b" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">要异步更改Node.js程序中文件的权限，我们可以使用<code class="fe lv lw lx ly b">chmod</code>函数。它需要三个参数。</p><p id="3983" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个参数是对文件的引用，它可以是一个字符串路径、一个<code class="fe lv lw lx ly b">Buffer</code>对象、一个URL对象或一个文件描述符，后者是一个标识文件的整数。</p><p id="6344" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个参数是文件模式，它是一个八进制数，对应于您想要设置的文件权限。</p><p id="0a23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第三个参数是一个回调函数，带有一个<code class="fe lv lw lx ly b">err</code>参数，在文件权限更改操作完成时调用。</p><p id="a4a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果没有错误,<code class="fe lv lw lx ly b">err</code>将为<code class="fe lv lw lx ly b">null</code>,否则将设置带有错误信息的对象。</p><p id="0d0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要设置文件的文件模式，我们可以使用内置在<code class="fe lv lw lx ly b">fs</code>模块中的常量。它们可以与按位<code class="fe lv lw lx ly b">OR</code>运算符结合使用，以同时设置多个模式。</p><p id="16d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模式常数列表如下:</p><ul class=""><li id="51d4" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">fs.constants.S_IRUSR</code> —对应八进制<code class="fe lv lw lx ly b">0o400</code>，使文件对所有者可读。</li><li id="7b6f" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">fs.constants.S_IWUSR </code> —对应于八进制<code class="fe lv lw lx ly b">0o200</code>，使文件可由所有者写入。</li><li id="c76c" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">fs.constants.S_IXUSR </code> —对应于八进制<code class="fe lv lw lx ly b">0o100</code>，使文件可由所有者执行或搜索。</li><li id="3416" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">fs.constants.S_IRGRP</code> —对应于八进制<code class="fe lv lw lx ly b">0o40</code>，使成组可读。</li><li id="2b69" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">fs.constants.S_IWGRP </code> —对应八进制<code class="fe lv lw lx ly b">0o20</code>，使文件按组可写。</li><li id="e0b3" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">fs.constants.S_IXGRP</code> —对应八进制<code class="fe lv lw lx ly b">0o10</code>，使文件可按组执行或搜索。</li><li id="6c8f" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">fs.constants.S_IROTH </code> —对应八进制<code class="fe lv lw lx ly b">0o4</code>，使文件对其他人可读。</li><li id="518c" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">fs.constants.S_IWOTH </code> —对应八进制<code class="fe lv lw lx ly b">0o2</code>，使文件可被其他人写入。</li><li id="a198" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">fs.constants.S_IXOTH </code> —对应于八进制<code class="fe lv lw lx ly b">0o1</code>，使文件可被其他人执行或搜索。</li></ul><p id="6607" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以用三个八进制数字设置文件权限，就像Unix或Linux文件权限一样。</p><p id="f50c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最左边的数字是所有者的权限。中间的数字是该组的权限，最右边的数字是对其他人的权限。</p><p id="f065" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有效数字包括以下内容:</p><ul class=""><li id="a986" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">7 </code> —读、写、执行</li><li id="c4bb" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">6 </code> —读写</li><li id="7305" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">5 </code> —读取并执行</li><li id="1e5f" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">4 </code> —只读</li><li id="767d" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">3 </code> —编写并执行</li><li id="d462" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">2 </code> —只写</li><li id="2290" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">1 </code> —仅执行</li><li id="d098" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><code class="fe lv lw lx ly b">0 </code> —不允许</li></ul><p id="5fc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在下面的代码中使用<code class="fe lv lw lx ly b">chmod</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="bdfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码将给予每个人对<code class="fe lv lw lx ly b">file.txt</code>的读写权限。同样，我们可以用这些常数做同样的事情:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="a33a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，使用八进制数要短得多，所以使用数而不是常数可能更好。</p><p id="ebd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">chmod</code>功能的同步版本是<code class="fe lv lw lx ly b">chmondSync</code>功能。这需要两个参数。</p><p id="a1f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个参数是对文件的引用，它可以是字符串路径、<code class="fe lv lw lx ly b">Buffer</code>对象、URL对象或文件描述符，后者是标识文件的整数。</p><p id="c330" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个参数是文件模式，它是一个八进制数，对应于您想要设置的文件权限。它们应该与上面列出的相同。</p><p id="8c51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以像在下面的代码中一样使用它，将对<code class="fe lv lw lx ly b">file.txt</code>的读写权限授予每个人:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="0e60" class="nh mh it ly b gy ni nj l nk nl">const fs = require("fs");<br/>const file = "./files/file.txt";</span><span id="e62d" class="nh mh it ly b gy nm nj l nk nl">fs.chmodSync(file, 0o666);<br/>console.log("File permission changed");</span></pre><p id="53c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者相当于:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="0b28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们分别使用<code class="fe lv lw lx ly b">access</code>、<code class="fe lv lw lx ly b">append</code>和<code class="fe lv lw lx ly b">chmod</code>函数检查文件可访问性、附加文件和更改权限。</p><p id="03c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">access</code>函数检查文件是否存在，是否可读可写。</p><p id="746b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">append</code>函数将数据追加到现有文件中，无论是文本还是二进制数据。</p><p id="252b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">chmod</code>函数让我们像在Unix或Linux命令行中一样更改文件的权限。这些功能也有同步版本，分别是<code class="fe lv lw lx ly b">accessSync</code>、<code class="fe lv lw lx ly b">appendSync</code>和<code class="fe lv lw lx ly b">chmodSync</code>。</p></div></div>    
</body>
</html>