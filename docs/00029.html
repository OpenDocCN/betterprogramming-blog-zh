<html>
<head>
<title>Secure a Spring Boot REST API with JSON Web Token</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JSON Web令牌保护Spring Boot REST API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/secure-a-spring-boot-rest-api-with-json-web-token-reference-to-angular-integration-e57a25806c50?source=collection_archive---------1-----------------------#2017-05-15">https://betterprogramming.pub/secure-a-spring-boot-rest-api-with-json-web-token-reference-to-angular-integration-e57a25806c50?source=collection_archive---------1-----------------------#2017-05-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ca90" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">加上角度积分的参考</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/b1096bd5b38db4fa47b88b7bd5e91ec7.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*AfhfnLpsi9TdYF-kax8vcw.png"/></div></figure><p id="4b78" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在本文中，我将带您了解如何使用JSON Web Token (JWT)保护Spring Boot REST API，以便在服务器和客户端之间交换声明。这是我和我的同事Julia Passynkova合作的第二部分，演示了如何使用Spring Boot作为RESTful后端来保护Angular 2+应用程序。如果你不耐烦或者喜欢直接从代码中学习，查看一下<a class="ae lo" href="https://github.com/nydiarra/springboot-jwt" rel="noopener ugc nofollow" target="_blank"> Github库</a>中的代码。你可以在这里找到角度积分项目<a class="ae lo" href="https://github.com/ipassynk/angular-springboot-jwt" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="a14e" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">快速介绍</strong></h1><p id="4816" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi translated">在过去的几年里，Spring Boot已经大大简化了Spring Framework应用程序的配置。它采用的这种随意的方法让开发人员只需在类路径上拥有Spring安全依赖就可以为应用程序启用基本的安全性。</p><p id="5ae6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">选择JWT来保护您的API端点是一个很好的选择，因为它确保了客户端和服务器之间的无状态令牌交换，并且是紧凑的和URL安全的。有了JWT，就没有必要在数据库中存储访问令牌(尽管您可能仍然会这样做，甚至需要这样做，这取决于用例)或者担心粘性会话。这使得在企业应用程序中构建冗余更具成本效益，至少在安全性方面是如此。但是，您确实需要处理其他方面的问题，比如令牌撤销，但这不在这里讨论。理解JWT有多有用的基础是首先掌握OAuth 2.0。为了快速参考，下面是OAuth舞蹈的插图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mt"><img src="../Images/878f3ce05a6d0d984e4272f5914de46e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tYLI2jFJjQ7MnnF-j41ABw.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">OAUTH 2的插图。跳舞</p></figure></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="0087" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">项目需要什么？</strong></h1><p id="ef2b" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi translated">1.Spring Boot 1.5.3 .用Maven或Gradle发布项目。这个项目使用Maven。</p><p id="e8a3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">2.以下依赖关系:</p><ul class=""><li id="5a10" class="nc nd it ks b kt ku kw kx kz ne ld nf lh ng ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">spring-boot-starter-web</code></li><li id="3d93" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">spring-boot-starter-security</code></li><li id="862d" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">spring-boot-starter-data-jpa</code></li><li id="e7a8" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">spring-boot-starter-web</code></li><li id="ca70" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">com.h2database</code> —存储样本测试数据的H2数据库</li><li id="7c72" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">spring-security-jwt</code>版本:1.0.7 .发布</li><li id="4167" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">版本:2.1.0 .发布</li></ul></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="3d8e" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">最终项目结构</strong></h1><p id="a7e8" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi translated">例如，当您从Github克隆项目并将其导入到您的IDE中时，它的结构将如下所示。这里，我使用了IntelliJ Community Edition IDE中的一个截图。根据您使用的IDE，您的外观会略有不同。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/546732235489e5f7e32b42ff8eee5a37.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*HZAKJm-EdWWsk81h3pCl3g.png"/></div></figure></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="6946" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">1.配置Spring安全性</h1><p id="1e38" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi translated">多亏了Spring Boot的自动配置，我们将需要最少的定制来设置:</p><p id="d1ec" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">首先，让我们看看应用程序的配置文件，<code class="fe nl nm nn no b">application.properties</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="5ab1" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">然后是安全配置类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><ul class=""><li id="6cc9" class="nc nd it ks b kt ku kw kx kz ne ld nf lh ng ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">@EnableWebSecurity</code>:启用spring安全并告诉Spring Boot应用所有敏感的默认值</li><li id="95d8" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">@EnableGlobalMethodSecurity</code>:允许我们拥有方法级访问控制</li><li id="dd1c" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">JwtTokenStore</code>和<code class="fe nl nm nn no b">JwtAccessTokenConverter</code>bean:授权服务器需要一个<code class="fe nl nm nn no b">JwtTokenStore</code> bean，为了使资源服务器能够解码访问令牌，两个服务器都必须使用一个<code class="fe nl nm nn no b">JwtAccessTokenConverter</code> bean。在这种情况下，我们提供对称密钥签名。</li><li id="8a76" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">UserDetailsService</code>:我们注入一个<code class="fe nl nm nn no b">UserDetailsService</code>的自定义实现，名为<code class="fe nl nm nn no b">AppUserDetailsService</code>(详见GitHub上的代码)，以便从数据库中检索用户详细信息。</li><li id="ebe6" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">编码:SHA-256用于对密码进行编码。这是在<code class="fe nl nm nn no b">encodingStrength</code>属性中设置的</li><li id="fdd4" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">领域:安全领域名在<code class="fe nl nm nn no b">securityRealm</code>属性中定义。这个名字是任意取的。从提供者到角色、用户等，领域基本上就是定义我们的安全解决方案的所有内容。</li></ul></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="9fcf" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">2.配置授权服务器</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><ul class=""><li id="4df0" class="nc nd it ks b kt ku kw kx kz ne ld nf lh ng ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">@EnableAuthorizationServer</code>:启用授权服务器</li><li id="facd" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">AuthorizationServerConfig</code>是我们的授权服务器配置类，它扩展了<code class="fe nl nm nn no b">AuthorizationServerConfigurerAdapter</code>，而<code class="fe nl nm nn no b">AuthorizationServerConfigurerAdapter</code>又是<code class="fe nl nm nn no b">AuthorizationServerConfigurer</code>的实现。类型为<code class="fe nl nm nn no b">AuthorizationServerConfigurer</code>的bean的出现只是告诉Spring Boot关闭自动配置，使用定制配置。此外，<code class="fe nl nm nn no b">AuthorizationServerConfig</code>像任何其他配置类一样，因为有了<code class="fe nl nm nn no b">@Configuration</code>注释，它的定义被Spring Boot自动扫描、连接和应用。</li><li id="d6d1" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">客户机id:定义被授权进行身份验证的客户机应用程序的id，客户机应用程序提供这个id是为了被允许向服务器发送请求。</li><li id="8540" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">客户端密码:是客户端应用程序的密码。在一个重要的实现中，客户端id和密码将被安全地存储在数据库中，并可通过客户端应用程序在部署期间访问的单独API来检索。这些信息也可以共享并存储在环境变量中，尽管这不是我的首选。</li><li id="c3fb" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">授权类型:我们在这里定义授权类型密码，因为默认情况下它是不启用的</li><li id="a020" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">范围:读/写定义了我们允许的对资源的访问级别</li><li id="e994" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">资源id:此处指定的资源Id也必须在资源服务器上指定</li><li id="f777" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">AuthenticationManager: Spring的身份验证管理器负责检查用户凭证的有效性</li><li id="6560" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">TokenEnhancerChain:我们定义了一个令牌增强器，它能够链接包含不同信息的多种声明</li></ul></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="02a6" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">3.配置资源服务器</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="ee0f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe nl nm nn no b"><a class="ae lo" href="http://twitter.com/EnableResourceServer" rel="noopener ugc nofollow" target="_blank">@EnableResourceServer</a></code>:启用资源服务器。默认情况下，该注释创建一个安全过滤器，该过滤器通过传入的OAuth2令牌对请求进行身份验证。过滤器是<code class="fe nl nm nn no b">WebSecurityConfigurerAdapter</code>的一个实例，它的硬编码顺序是三(由于Spring框架的一些限制)。您需要告诉Spring Boot将OAuth2请求过滤器顺序设置为3，以便与硬编码值保持一致。你可以通过在<code class="fe nl nm nn no b">application.properties</code>文件中添加<code class="fe nl nm nn no b">security.oauth2.resource.filter-order = 3</code>来实现。希望这将在未来的版本中得到解决。</p><p id="082b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">资源服务器有权为任何端点定义权限。端点权限定义为:<br/> <code class="fe nl nm nn no b">.antMatchers(“/actuator/**”, “/api-docs/**”).permitAll()<br/> .antMatchers(“/springjwt/**”).authenticated()</code></p><p id="9963" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">请注意，资源和授权服务器都使用相同的令牌服务。这是因为它们在同一个代码库中，所以我们重用了同一个bean。</p></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="1eb3" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">4.配置数据源</h1><p id="87a4" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi translated">一旦在类路径上定义了内存中的H2数据源，Spring Boot就可以完全自动配置它。但是，为了让您更好地了解如何控制应用程序和定制数据源，提供了以下配置:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="7cff" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">用任何数据库(MariaDB，MySQL，Oracle，SQL Server等)代替H2。)来适应您的使用情况。</p></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="3a51" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">5.数据库脚本和测试数据</h1><h2 id="9b85" class="nx lx it bd ly ny nz dn mc oa ob dp mg kz oc od mi ld oe of mk lh og oh mm oi bi translated"><code class="fe nl nm nn no b">schema.sql</code></h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h2 id="8c56" class="nx lx it bd ly ny nz dn mc oa ob dp mg kz oc od mi ld oe of mk lh og oh mm oi bi translated">data.sql</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="9c60" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">6.实体</h1><p id="4667" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi translated">创建用户、角色、随机城市实体来映射到数据模型</p></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="b351" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">7.通过REST控制器公开资源</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="04cf" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这里暴露了两个端点</p><ul class=""><li id="6b21" class="nc nd it ks b kt ku kw kx kz ne ld nf lh ng ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">/springjwt/cities</code>:所有经过身份验证的用户都可以访问该端点</li><li id="d676" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated"><code class="fe nl nm nn no b">/springjwt/users</code>:只有管理员用户可以访问该端点</li></ul><h1 id="853c" class="lw lx it bd ly lz oj mb mc md ok mf mg jz ol ka mi kc om kd mk kf on kg mm mn bi translated">8.运行和测试应用程序</h1><p id="db7c" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi translated">首先，您需要以下基本信息:</p><ul class=""><li id="0314" class="nc nd it ks b kt ku kw kx kz ne ld nf lh ng ll nh ni nj nk bi translated">客户:<code class="fe nl nm nn no b">testjwtclientid</code></li><li id="6732" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">秘密:<code class="fe nl nm nn no b">XY7kmzoNzl100</code></li><li id="2cf4" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">非管理员用户名和密码:<code class="fe nl nm nn no b">john.doe</code>和<code class="fe nl nm nn no b">jwtpass</code></li><li id="2d92" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">管理员用户:<code class="fe nl nm nn no b">admin.admin</code>和<code class="fe nl nm nn no b">jwtpass</code></li><li id="be34" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">所有认证用户都可以访问的资源示例:<a class="ae lo" href="http://localhost:8080/springjwt/cities" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/spring jwt/cities</a></li><li id="0562" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">只有管理员用户可以访问的资源示例:<a class="ae lo" href="http://localhost:8080/springjwt/users" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/spring jwt/users</a></li></ul><h2 id="6c6c" class="nx lx it bd ly ny nz dn mc oa ob dp mg kz oc od mi ld oe of mk lh og oh mm oi bi translated"><strong class="ak">步骤1:生成访问令牌</strong></h2><p id="13d5" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi translated">使用下面的通用命令生成一个访问令牌:<code class="fe nl nm nn no b">$ curl client:secret@localhost:8080/oauth/token -d grant_type=password -d username=user -d password=pwd</code></p><p id="8e4a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">对于这个特定的应用程序，要为非管理员用户<code class="fe nl nm nn no b">john.doe</code>生成一个访问令牌，运行:<code class="fe nl nm nn no b">$ curl testjwtclientid:XY7kmzoNzl100@localhost:8080/oauth/token -d grant_type=password -d username=john.doe -d password=jwtpass</code>。您将收到类似以下内容的回复:</p><pre class="kj kk kl km gt oo no op oq aw or bi"><span id="7c7f" class="nx lx it no b gy os ot l ou ov">`<br/>{<br/>  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsidGVzdGp3dHJlc291cmNlaWQiXSwidXNlcl9uYW1lIjoiYWRtaW4uYWRtaW4iLCJzY29wZSI6WyJyZWFkIiwid3JpdGUiXSwiZXhwIjoxNDk0NDU0MjgyLCJhdXRob3JpdGllcyI6WyJTVEFOREFSRF9VU0VSIiwiQURNSU5fVVNFUiJdLCJqdGkiOiIwYmQ4ZTQ1MC03ZjVjLTQ5ZjMtOTFmMC01Nzc1YjdiY2MwMGYiLCJjbGllbnRfaWQiOiJ0ZXN0and0Y2xpZW50aWQifQ.rvEAa4dIz8hT8uxzfjkEJKG982Ree5PdUW17KtFyeec",<br/>  "token_type": "bearer",<br/>  "expires_in": 43199,<br/>  "scope": "read write",<br/>  "jti": "0bd8e450-7f5c-49f3-91f0-5775b7bcc00f"<br/>}`</span></pre><h2 id="5b1c" class="nx lx it bd ly ny nz dn mc oa ob dp mg kz oc od mi ld oe of mk lh og oh mm oi bi translated"><strong class="ak">步骤2:使用令牌通过RESTful API访问资源</strong></h2><p id="9d8f" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi translated">使用令牌通过RESTful API访问资源</p><p id="6cde" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">要访问所有已验证用户可用的内容:</p><ul class=""><li id="2c3a" class="nc nd it ks b kt ku kw kx kz ne ld nf lh ng ll nh ni nj nk bi translated">使用生成的令牌作为授权报头中的载体值，如下:<code class="fe nl nm nn no b">curl http://localhost:8080/springjwt/cities -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsidGVzdGp3dHJlc291cmNlaWQiXSwidXNlcl9uYW1lIjoiYWRtaW4uYWRtaW4iLCJzY29wZSI6WyJyZWFkIiwid3JpdGUiXSwiZXhwIjoxNDk0NDU0MjgyLCJhdXRob3JpdGllcyI6WyJTVEFOREFSRF9VU0VSIiwiQURNSU5fVVNFUiJdLCJqdGkiOiIwYmQ4ZTQ1MC03ZjVjLTQ5ZjMtOTFmMC01Nzc1YjdiY2MwMGYiLCJjbGllbnRfaWQiOiJ0ZXN0and0Y2xpZW50aWQifQ.rvEAa4dIz8hT8uxzfjkEJKG982Ree5PdUW17KtFyeec"</code></li><li id="03d9" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">响应将是:<code class="fe nl nm nn no b">[ { "id": 1, "name": "Bamako" }, { "id": 2, "name": "Nonkon" }, { "id": 3, "name": "Houston" }, { "id": 4, "name": "Toronto" }, { "id": 5, "name": "New York" }, { "id": 6, "name": "Mopti" }, { "id": 7, "name": "Koulikoro" }, { "id": 8, "name": "Moscow" } ]</code></li></ul><p id="4c97" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">要访问仅对管理员用户可用的内容:</p><p id="38bf" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">和前面的例子一样，首先，用上面提供的凭证为admin用户生成一个访问令牌，然后运行<code class="fe nl nm nn no b">curl http://localhost:8080/springjwt/users -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsidGVzdGp3dHJlc291cmNlaWQiXSwidXNlcl9uYW1lIjoiYWRtaW4uYWRtaW4iLCJzY29wZSI6WyJyZWFkIiwid3JpdGUiXSwiZXhwIjoxNDk0NDU0OTIzLCJhdXRob3JpdGllcyI6WyJTVEFOREFSRF9VU0VSIiwiQURNSU5fVVNFUiJdLCJqdGkiOiIyMTAzMjRmMS05MTE0LTQ1NGEtODRmMy1hZjUzZmUxNzdjNzIiLCJjbGllbnRfaWQiOiJ0ZXN0and0Y2xpZW50aWQifQ.OuprVlyNnKuLkoQmP8shP38G3Hje91GBhu4E0HD2Fes"</code></p><p id="a780" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">结果将是:<code class="fe nl nm nn no b">[ { "id": 1, "username": "john.doe", "firstName": "John", "lastName": "Doe", "roles": [ { "id": 1, "roleName": "STANDARD_USER", "description": "Standard User - Has no admin rights" } ] }, { "id": 2, "username": "admin.admin", "firstName": "Admin", "lastName": "Admin", "roles": [ { "id": 1, "roleName": "STANDARD_USER", "description": "Standard User - Has no admin rights" }, { "id": 2, "roleName": "ADMIN_USER", "description": "Admin User - Has permission to perform admin tasks" } ] } ]</code></p></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="534f" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak"> 9。访问不安全或不受保护的端点</strong></h1><p id="3303" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi translated"><a class="ae lo" href="http://localhost:/health" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/health</a>不受限制。匿名用户可以访问它，并且可以将其用于负载平衡健康检查目的。</p></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="5e59" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">参考资料和有用的阅读材料:</h1><ul class=""><li id="7c48" class="nc nd it ks b kt mo kw mp kz ow ld ox lh oy ll nh ni nj nk bi translated">Spring Boot 1.5.3.RELEASE转到<a class="ae lo" href="http://docs.spring.io/spring-boot/docs/1.5.3.RELEASE/reference/htmlsingle/" rel="noopener ugc nofollow" target="_blank">http://docs . spring . io/spring-boot/docs/1 . 5 . 3 . release/reference/html single/</a>了解更多关于Spring Boot的信息</li><li id="f14b" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">JSON Web Token去<a class="ae lo" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank">https://jwt.io/</a>解码你生成的令牌并了解更多</li><li id="2c51" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">H2数据库引擎——用于快速原型开发，但至少在大多数情况下不适合生产。前往www.h2database.com<a class="ae lo" href="http://www.h2database.com/" rel="noopener ugc nofollow" target="_blank">了解更多信息</a></li><li id="b647" class="nc nd it ks b kt np kw nq kz nr ld ns lh nt ll nh ni nj nk bi translated">为什么需要在application.properties文件<strong class="ks iu">中设置<strong class="ks iu">security . oauth 2 . resource . filter-order = 3</strong>:</strong><a class="ae lo" href="https://docs.spring.io/spring-security/oauth/apidocs/org/springframework/security/oauth2/config/annotation/web/configuration/EnableResourceServer.html" rel="noopener ugc nofollow" target="_blank">https://docs . spring . io/spring-security/oauth/API docs/org/spring framework/security/oauth 2/config/annotation/web/configuration/enableresourceserver . html</a></li></ul></div></div>    
</body>
</html>