<html>
<head>
<title>XML and Jetpack Compose Interoperability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">XML和Jetpack组成了互操作性</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/interoperability-xml-jetpack-compose-eb823f572cb6?source=collection_archive---------1-----------------------#2022-12-03">https://betterprogramming.pub/interoperability-xml-jetpack-compose-eb823f572cb6?source=collection_archive---------1-----------------------#2022-12-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="58a5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如果您还在犹豫是否将项目从老式的XML视图迁移到Jetpack compose，那么您来对地方了。在这篇文章中，我将带你走近作曲世界</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/377bb89d6eb3dfbefcb2077b1c329faa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5qlhoasBkZfb4KYs_d1CVQ.png"/></div></div></figure><p id="de28" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">2020年初，我在Jetpack Compose的初始阶段开始了我的冒险，当时我已经对一种新的UI实现方式充满了热情。</p><p id="5342" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不幸的是，目前许多功能都缺少后台处理、下拉菜单、导航等。但是让我们快进到2022年。最后，Jetpack Compose已经发展到生产就绪阶段，具有惊人的互操作性API，使迁移比以往任何时候都更容易。</p><h1 id="c052" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">为什么选择Jetpack Compose？</h1><p id="88e4" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">Jetpack Compose是一个用于构建UI的现代工具包，具有一系列优点。尤其是对于整个应用程序切换到一种编程语言，这让我们摆脱了XML文件。</p><p id="4065" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它大大减少了命令式UI中用于查找视图和设置UI逻辑的样板代码，从而简化并加速了UI开发，因为声明式UI中的逻辑是构建在组件内部的。旁边的合成器使得创建带有状态的动画更加容易，这些状态的值在运行时可以很容易地修改。</p><p id="8577" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，使用Jetpack Compose导航要方便得多，因为在XML文件中设置所有规则是非常痛苦的。另一个好处是视图启动时的性能提高，因为布局就像你的应用程序的其他部分一样被编译，不需要被放大。完全迁移后，应用程序的大小和构建时间减少。</p><h1 id="31f0" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">如何开始？</h1><p id="e600" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">您现有的基于视图的UI不需要一次重写整个UI。完全支持互操作性，允许Compose和视图在您的代码库中共存，因此您可以使用Compose添加新功能或将一些小的现有元素移动到Compose世界，当您开始觉得准备好并爱上Compose时，您可以使用推荐的迁移策略，称为自下而上的方法，该方法依赖于逐个重写屏幕上的最小视图，直到您可以将<code class="fe mk ml mm mn b">ViewGroup</code>和<code class="fe mk ml mm mn b">RootView</code>移动到Compose世界。</p><p id="3641" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在接下来的步骤中，您将学习如何为Compose配置环境，可能的场景是什么，如何在视图中实现Compose &amp;在Compose中实现View，以及如何在Compose中处理片段。</p><h1 id="f676" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">梯度设置</h1><p id="4f74" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">打开构建特性合成和<code class="fe mk ml mm mn b">ViewBinding</code>，并添加基本合成依赖项</p><pre class="kg kh ki kj gt mo mn mp bn mq mr bi"><span id="df4f" class="ms lo iq mn b be mt mu l mv mw">android {<br/>    ...<br/>    buildFeatures {<br/>        compose true<br/>        viewBinding true<br/>    }<br/>    composeOptions {<br/>        kotlinCompilerExtensionVersion '1.3.2'<br/>    }<br/>}<br/>dependencies {<br/>    ...<br/>    implementation "androidx.activity:activity-compose:$version"<br/>    implementation "androidx.compose.runtime:runtime-livedata:$version"<br/>    implementation "androidx.compose.ui:ui:$version"<br/>    implementation "androidx.compose.ui:ui-tooling-preview:$version"<br/>    implementation "androidx.compose.material:material:$version"<br/>    implementation "androidx.compose.ui:ui-viewbinding:$version"<br/>    implementation "androidx.navigation:navigation-compose:$version"<br/>}</span></pre><h1 id="fde3" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">在视图中合成</h1><ul class=""><li id="07f2" class="mx my iq kt b ku mf kx mg la mz le na li nb lm nc nd ne nf bi translated"><code class="fe mk ml mm mn b"><strong class="kt ir">ComposeView</strong></code> <strong class="kt ir">在XML布局中— </strong>向XML布局添加撰写视图</li></ul><pre class="kg kh ki kj gt mo mn mp bn mq mr bi"><span id="92b5" class="ms lo iq mn b be mt mu l ng mw">&lt;androidx.compose.ui.platform.ComposeView<br/>    android:id="@+id/composeView"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"/&gt;</span></pre><p id="c80f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从XML布局访问<code class="fe mk ml mm mn b">Compose</code>世界:</p><pre class="kg kh ki kj gt mo mn mp bn mq mr bi"><span id="4d90" class="ms lo iq mn b be mt mu l ng mw">binding.composeView.apply {<br/>    setViewCompositionStrategy(ViewCompositionStrategy.DisposeOnViewTreeLifecycleDestroyed)<br/>    setContent {<br/>        MaterialTheme {<br/>            Text(text = "Hello in Compose World!")<br/>        }<br/>    }<br/>}</span></pre><ul class=""><li id="1eae" class="mx my iq kt b ku kv kx ky la nh le ni li nj lm nc nd ne nf bi translated"><code class="fe mk ml mm mn b"><strong class="kt ir">ComposeView</strong></code> <strong class="kt ir">直接作为布局— </strong>将<code class="fe mk ml mm mn b">ComposeView</code>实现为一个小部件视图，并访问Compose world</li></ul><pre class="kg kh ki kj gt mo mn mp bn mq mr bi"><span id="6060" class="ms lo iq mn b be mt mu l ng mw">override fun onCreateView(<br/>    inflater: LayoutInflater, container: ViewGroup?,<br/>    savedInstanceState: Bundle?<br/>): View = ComposeView(requireContext()).apply {<br/>    setViewCompositionStrategy(ViewCompositionStrategy.DisposeOnViewTreeLifecycleDestroyed)<br/>    setContent {<br/>        MaterialTheme {<br/>            Text(text = "Hello in Compose World!")<br/>        }<br/>    }<br/>}</span></pre><h2 id="6500" class="nk lo iq bd lp nl nm dn lt nn no dp lx la np nq lz le nr ns mb li nt nu md nv bi translated">用于合成视图的视图合成策略</h2><p id="dcf1" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">默认情况下，<code class="fe mk ml mm mn b">ComposeView</code>有四种合成策略，每当视图脱离窗口时，compose就会处理合成。但是，在某些情况下，此默认值可能是不可取的。</p><ul class=""><li id="1ede" class="mx my iq kt b ku kv kx ky la nh le ni li nj lm nc nd ne nf bi translated"><code class="fe mk ml mm mn b">DisposeOnDetachedFromWindow</code></li><li id="6320" class="mx my iq kt b ku nw kx nx la ny le nz li oa lm nc nd ne nf bi translated"><code class="fe mk ml mm mn b">DisposeOnDetachedFromWindowOrReleasedFromPool</code>(默认)</li><li id="2103" class="mx my iq kt b ku nw kx nx la ny le nz li oa lm nc nd ne nf bi translated"><code class="fe mk ml mm mn b">DisposeOnLifecycleDestroyed</code></li><li id="1fc9" class="mx my iq kt b ku nw kx nx la ny le nz li oa lm nc nd ne nf bi translated"><code class="fe mk ml mm mn b">DisposeOnViewTreeLifecycleDestroyed</code>(片段、过渡、生命周期感知定制视图)</li></ul><h1 id="7576" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">在撰写中查看</h1><ul class=""><li id="4cdd" class="mx my iq kt b ku mf kx mg la mz le na li nb lm nc nd ne nf bi translated"><code class="fe mk ml mm mn b"><strong class="kt ir">AndroidView</strong></code> <strong class="kt ir">定制视图— </strong>在工厂中创建一个定制视图并设置点击监听器，以及视图回调—&gt;撰写通信。然后在更新设置通讯时进行撰写- &gt;查看:</li></ul><pre class="kg kh ki kj gt mo mn mp bn mq mr bi"><span id="9449" class="ms lo iq mn b be mt mu l ng mw">@Composable<br/>fun XMLCounter() {<br/>    var resultState by remember { mutableStateOf(0) }<br/>    AndroidView(<br/>        factory = { context -&gt;<br/>            CounterView(context).apply {<br/>                // Example of View -&gt; Compose communication<br/>                resultCallback = {<br/>                    resultState = it<br/>                }<br/>            }<br/>        },<br/>        update = { counterView -&gt;<br/>            // Example of Compose -&gt; View communication<br/>            counterView.binding.result.text = resultState.toString()<br/>        }<br/>    )</span></pre><ul class=""><li id="b73a" class="mx my iq kt b ku kv kx ky la nh le ni li nj lm nc nd ne nf bi translated"><code class="fe mk ml mm mn b"><strong class="kt ir">AndroidViewBinding</strong></code> <strong class="kt ir"> — </strong>在compose world中展开视图绑定，并访问绑定类</li></ul><pre class="kg kh ki kj gt mo mn mp bn mq mr bi"><span id="b973" class="ms lo iq mn b be mt mu l ng mw">@Composable<br/>fun XMLCounterBinding() {<br/>    AndroidViewBinding(ComponentCounterBinding::inflate) {<br/>        down.setOnClickListener { /*...*/ }<br/>        up.setOnClickListener { /*...*/ }<br/>    }<br/>}</span></pre><h1 id="ed56" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">作曲中的片段</h1><p id="b0bc" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">将<code class="fe mk ml mm mn b">FragmentContainerView</code>添加到XML布局:</p><pre class="kg kh ki kj gt mo mn mp bn mq mr bi"><span id="0d81" class="ms lo iq mn b be mt mu l ng mw">&lt;androidx.fragment.app.FragmentContainerView<br/>    xmlns:android="http://schemas.android.com/apk/res/android"<br/>    android:id="@+id/container"<br/>    android:name="com.artf.composeinview.ui.main.MainFragment"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent" /&gt;</span></pre><p id="d2e1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从Compose world访问片段</p><pre class="kg kh ki kj gt mo mn mp bn mq mr bi"><span id="47ef" class="ms lo iq mn b be mt mu l ng mw">override fun onCreate(savedInstanceState: Bundle?) {<br/>    super.onCreate(savedInstanceState)<br/>    setContent {<br/>        MaterialTheme {<br/>            AndroidViewBinding(ActivityMainBinding::inflate) {<br/>                val fragment = container.getFragment&lt;MainFragment&gt;()<br/>                //...<br/>            }<br/>        }<br/>    }<br/>}</span></pre><h1 id="e95e" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">结论</h1><p id="e399" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">没有理由犹豫从组合开始，因为互用性API目前处于非常好的阶段，允许组合和视图在我们的代码库中共存。并且带来了很多好处，包括启动时间、应用程序大小和构建时间的改进。</p><h1 id="76ae" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">参考</h1><ul class=""><li id="0d6e" class="mx my iq kt b ku mf kx mg la mz le na li nb lm nc nd ne nf bi translated"><a class="ae ob" href="https://developer.android.com/jetpack/compose/interop/migration-strategy" rel="noopener ugc nofollow" target="_blank">https://developer . Android . com/jetpack/compose/interop/migration-strategy</a></li><li id="328b" class="mx my iq kt b ku nw kx nx la ny le nz li oa lm nc nd ne nf bi translated"><a class="ae ob" href="https://developer.android.com/jetpack/compose/interop/adding" rel="noopener ugc nofollow" target="_blank">https://developer . Android . com/jetpack/compose/interop/adding</a></li><li id="f3f1" class="mx my iq kt b ku nw kx nx la ny le nz li oa lm nc nd ne nf bi translated"><a class="ae ob" href="https://developer.android.com/jetpack/compose/interop/interop-apis" rel="noopener ugc nofollow" target="_blank">https://developer . Android . com/jetpack/compose/interop/interop-APIs</a></li><li id="160c" class="mx my iq kt b ku nw kx nx la ny le nz li oa lm nc nd ne nf bi translated"><a class="ae ob" href="https://developer.android.com/jetpack/compose/ergonomics" rel="noopener ugc nofollow" target="_blank">https://developer.android.com/jetpack/compose/ergonomics</a></li></ul><h1 id="9f3b" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">链接</h1><ul class=""><li id="4939" class="mx my iq kt b ku mf kx mg la mz le na li nb lm nc nd ne nf bi translated">YouTube:<a class="ae ob" href="https://www.youtube.com/watch?v=f6bnuFu8e0s" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=f6bnuFu8e0s</a></li><li id="4846" class="mx my iq kt b ku nw kx nx la ny le nz li oa lm nc nd ne nf bi translated">GitHub:<a class="ae ob" href="https://github.com/QArtur99/ViewInCompose" rel="noopener ugc nofollow" target="_blank">https://github.com/QArtur99/ViewInCompose</a></li></ul></div></div>    
</body>
</html>