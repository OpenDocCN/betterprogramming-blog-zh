<html>
<head>
<title>How to Select Columns in PySpark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在PySpark中选择列</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-select-column-in-pyspark-c2bb8ddaa994?source=collection_archive---------6-----------------------#2021-12-14">https://betterprogramming.pub/how-to-select-column-in-pyspark-c2bb8ddaa994?source=collection_archive---------6-----------------------#2021-12-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8345" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个简短的PySpark初学者教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c06cb3690ba4c1973533d3c126f99d5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OCzJhtUi5voVh0Tn"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">布兰登·莫温克尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class="kz la gp gr lb lc"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">阅读乔治·皮皮斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq ks lc"/></div></div></a></div><p id="5313" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这个简短的教程中，我们将向您展示在PySpark中选择列的不同方法。一开始，我们将从S3加载一个CSV文件。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="161f" class="ms mt it mo b gy mu mv l mw mx">df <strong class="mo iu">=</strong> <!-- -->spark.read.options(header<strong class="mo iu">=</strong>True).csv("s3://my-bucket/folder1/")</span><span id="8000" class="ms mt it mo b gy my mv l mw mx">df.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/ecf7b0d115b0517642fcd53692217c17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9zNRkp_PvSpaV44B.png"/></div></div></figure><p id="cbf6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">或者如果我们想要得到列名的列表:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="0f32" class="ms mt it mo b gy mu mv l mw mx">df.columns</span></pre><p id="0249" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们得到:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="abf7" class="ms mt it mo b gy mu mv l mw mx">['Row_Number', 'Hash_Name', 'Event_Date', 'Rating', 'Category', 'Class_A', 'Class_B', 'Class_C', 'File_Path']</span></pre><h1 id="41a6" class="na mt it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">按名称选择列</h1><p id="40b9" class="pw-post-body-paragraph lr ls it lt b lu nr ju lw lx ns jx lz ma nt mc md me nu mg mh mi nv mk ml mm im bi translated">假设我们想要选择两列，即<code class="fe nw nx ny mo b">Row_Number</code>和<code class="fe nw nx ny mo b">Category</code>。让我们看看我们如何能做它。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="ac09" class="ms mt it mo b gy mu mv l mw mx">df.select(df.Row_Number, df.Category).show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/75cc2be05cc1930ef535ac902c583e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/0*TC2cR2x4t3K1d-NG.png"/></div></figure><p id="7941" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">或者我们可以如下传递列名(当列名包含空格等时，这很有用)</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="d787" class="ms mt it mo b gy mu mv l mw mx">df.select(df['Row_Number'], df['Category']).show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/75cc2be05cc1930ef535ac902c583e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/0*TC2cR2x4t3K1d-NG.png"/></div></figure><h1 id="567b" class="na mt it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">从列表中选择列</h1><p id="2779" class="pw-post-body-paragraph lr ls it lt b lu nr ju lw lx ns jx lz ma nt mc md me nu mg mh mi nv mk ml mm im bi translated">我们还可以从列名列表中选择列。例如:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="7446" class="ms mt it mo b gy mu mv l mw mx">df.select(['Row_Number','Category']).show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/75cc2be05cc1930ef535ac902c583e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/0*TC2cR2x4t3K1d-NG.png"/></div></figure><p id="b008" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">请记住，它也可以在没有列表的情况下工作。例如:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="71d4" class="ms mt it mo b gy mu mv l mw mx">df.select('Row_Number','Category').show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/75cc2be05cc1930ef535ac902c583e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/0*TC2cR2x4t3K1d-NG.png"/></div></figure><h1 id="eae5" class="na mt it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">使用col()函数选择列</h1><p id="4c80" class="pw-post-body-paragraph lr ls it lt b lu nr ju lw lx ns jx lz ma nt mc md me nu mg mh mi nv mk ml mm im bi translated">我们可以使用<code class="fe nw nx ny mo b">functions</code>中的<code class="fe nw nx ny mo b">col()</code>功能。例如:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="e8bf" class="ms mt it mo b gy mu mv l mw mx"><strong class="mo iu">from</strong> <!-- -->pyspark.sql.functions <strong class="mo iu">import</strong> <!-- -->col</span><span id="72e8" class="ms mt it mo b gy my mv l mw mx">df.select(col('Row_Number'),col('Category')).show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/75cc2be05cc1930ef535ac902c583e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/0*TC2cR2x4t3K1d-NG.png"/></div></figure><h1 id="34a8" class="na mt it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">选择包含正则表达式的列</h1><p id="0181" class="pw-post-body-paragraph lr ls it lt b lu nr ju lw lx ns jx lz ma nt mc md me nu mg mh mi nv mk ml mm im bi translated">我们可以使用正则表达式选择列。假设我们想要选择包含字符串<code class="fe nw nx ny mo b">Class</code>和<code class="fe nw nx ny mo b">Row_Number</code>的所有列。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="71ce" class="ms mt it mo b gy mu mv l mw mx">df.select(df.colRegex("`Class.*`"), df["Row_Number"]).show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/7bbae1fc9fed543820bd9b469f37885d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/0*pF4A4uw5uCvOZtkP.png"/></div></figure><h1 id="c6e5" class="na mt it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">基于列的索引选择列</h1><p id="32b1" class="pw-post-body-paragraph lr ls it lt b lu nr ju lw lx ns jx lz ma nt mc md me nu mg mh mi nv mk ml mm im bi translated">间接地，我们可以根据列的索引来选择列。例如，假设我想选择第1列和第3列。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="215b" class="ms mt it mo b gy mu mv l mw mx">mylist = df.columns<br/>idx = [0,2]</span><span id="01b3" class="ms mt it mo b gy my mv l mw mx">df.select([mylist[i] for i in idx]).show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/8ab2d16a9d906f2e2636a5e3bbb415f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/0*oU9MGBZKL8XYeeJX.png"/></div></figure><h1 id="b354" class="na mt it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">使用SQL语句选择列</h1><p id="133b" class="pw-post-body-paragraph lr ls it lt b lu nr ju lw lx ns jx lz ma nt mc md me nu mg mh mi nv mk ml mm im bi translated">最后，还有一种通过运行SQL语句来选择列的替代方法。在这种情况下，我们需要首先创建一个临时视图，然后运行SQL select语句。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="5e7e" class="ms mt it mo b gy mu mv l mw mx">df.createOrReplaceTempView('mytable')</span><span id="76f1" class="ms mt it mo b gy my mv l mw mx">spark.sql('SELECT Row_Number, Event_Date FROM mytable').show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/f035c579cb91ade70e6eceb75ff1cd94.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*rtkZ1mllgSTpJaxeT8CO6g.png"/></div></figure></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="eb69" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最初发布于<a class="ae ky" href="https://predictivehacks.com/?all-tips=how-to-select-columns-in-pyspark" rel="noopener ugc nofollow" target="_blank">预测黑客</a></p></div></div>    
</body>
</html>