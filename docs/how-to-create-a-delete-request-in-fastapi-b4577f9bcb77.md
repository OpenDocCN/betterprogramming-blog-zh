# 如何在 FastAPI 中创建删除请求

> 原文：<https://betterprogramming.pub/how-to-create-a-delete-request-in-fastapi-b4577f9bcb77>

## 删除资源应该很有趣

![](img/094f2f5c93c5c541a60889f1a118ee25.png)

照片由[陈嘉里](https://unsplash.com/@gary_at_unsplash?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

作为一名数据工程师，我很清楚有多种语言和框架可以完成这项工作。我本人是 Spring (Java)和 FastAPI (Python)的忠实粉丝。

与现在许多人认为的不同，CRUD 还远未消亡。如果操作正确，您拥有创建、读取、更新和删除资源所需的所有方法。而且，更重要的是，应该有可能以快速和稳定的方式创建 API。

这篇文章将向你展示如何创建一个带有删除请求的控制器。我们还将关注用单元测试和集成测试来测试我们的代码。

为自己准备一份提神的点心，因为只需几分钟，您就可以用几行代码创建一个删除请求。

# 创建删除请求

您需要做的第一件事是设置您的 Python 环境。为此，您需要一些库:FastAPI、uvicorn、pydantic 和 requests。请随意用您喜欢的工具安装它们。就我个人而言，我会选择虚拟环境。

在本文中，我们将从头开始创建一个删除请求。我们将从图书列表中删除一本书。我们的数据类型非常简单。我们将使用一本书的以下表示法:

```
class Book:
  **isbn**: int
  **title**: str
```

在实际应用中，我们会使用数据库，但这并不是必需的。这只是一个实现细节。相反，我们从书单开始:

```
books: list[Book] = [
    Book(isbn=1234, title="What is love?"),
    Book(isbn=4567, title="Baby don't hurt me")
]
```

我们的删除请求将遍历我们的图书列表。它将搜索匹配的 ISBN。ISBN 是我们唯一的标识符，是我们找到一本书的关键。如果列表中包含该书，它将删除该书。如果列表中不包含该书，它将保持不变。

在 FastAPI 中，这将看起来像这样:

删除一本书

我要解释一下:

*   没有匹配的书为什么不抛出异常？删除请求应该是等幂的。这意味着，如果你用相同的 ISBN 调用它们，你总是会得到相同的结果。

使删除幂等非常有意义。如果在请求之前书不在那里，在请求之后它仍然不在那里。这消除了 API 的复杂性。我们不再需要关心一个手指粗的用户按两次 delete 键。它将是一致的，不会向用户显示任何错误。

*   为什么我们返回 204 而不是 200 响应？在这种情况下，我们不归还尸体。因此，204 No 内容对 API 的用户来说更具描述性。还是一个成功的应对。
*   最后，在循环时删除列表中的一本书是个坏主意。在最坏的情况下，这会导致异常。这就是为什么我们创建了一个方法来返回这本书并在事后删除它。

# 如何编写单元测试

我们的文章是关于 FastAPI 的，所以我不想一开始就用测试来打扰你。然而，我实际上是先写测试的。在上面的代码片段中，我们有两条路径:

第一个测试用例很重要。当我们传递列表中一本书的 ISBN 时，我们期望这本书从我们的列表中删除。首先，我们在没有指定 ISBN 的情况下删除它。接下来，我们通过在列表中搜索正确的书来删除它。

第二个测试用例将处理删除不在我们列表中的书。这现在很简单。我们创建了一个测试，当我们用错误的 ISBN 调用它时，它什么也不做。一开始写这个测试会很奇怪，因为它会导致没有代码。现在，这就说得通了。

为了用最少的代码使这些测试成功，我们强迫自己写干净的代码。

# 如何编写集成测试

单元测试不足以测试一切。虽然它们非常快，但我们还需要测试组件的交互。这就是集成测试如此重要的原因。

FastAPI 为我们提供了一个测试客户端，这与通过 PostMan 或 curl 等工具执行请求非常相似。唯一的区别是因为你可以把它写成代码，你可以很容易地自动化测试。

因此，在我们的测试中，我们将对我们的 API 执行一个删除请求，并测试两件必然会发生的事情:

*   结果是 204 没有内容
*   这本书从列表中删除了

# 结论

FastAPI 允许我们像用其他语言一样快速地创建 API。这是一种真正有趣的体验，编写删除请求很容易。因为 API 非常容易测试，所以开发速度非常快。

在本文中，我们讨论了删除请求。我们讨论了幂等性以及如何测试这种方法。过去，我也介绍过 [GET 和 POST](/how-to-create-a-get-request-in-fastapi-ecdc794b0cf) 方法。使用这些方法，您将能够创建、读取和删除资源。

感谢您阅读本文！