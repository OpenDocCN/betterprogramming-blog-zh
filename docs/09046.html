<html>
<head>
<title>How To Write Self-Documented Code With Low Cognitive Complexity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何编写低认知复杂度的自文档代码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-write-self-documented-code-with-low-cognitive-complexity-84d3e0bc53ad?source=collection_archive---------0-----------------------#2021-07-11">https://betterprogramming.pub/how-to-write-self-documented-code-with-low-cognitive-complexity-84d3e0bc53ad?source=collection_archive---------0-----------------------#2021-07-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0b4d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">帮助您的团队编写自我记录的代码、生产更好的软件并改善程序员生活的指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9242454e6d0fa672a83ce152261311ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pc06vd5vbidkYRnB"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">克里斯里德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="e5c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将分享停止圣战的实用而直接的建议，关于代码质量的争论，以及重构、简化和添加代码注释或文档的必要性。虽然我将在本文的后半部分提到确切的商业工具，但我想说我与该工具的作者没有关系。这些工具可以通过免费的社区许可和商业许可获得。</p><p id="cbeb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文的目标不是工具本身，而是告诉您有用的度量标准，这些标准将允许您的团队编写自我记录的代码，生产更好的软件，并改善程序员的生活。</p><h1 id="3af2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">自我记录的代码</h1><p id="175e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">当我要求开发人员提供文档或解释他们的代码时，我经常得到的回答是<em class="mp">“去读代码吧”</em>。我相信我不是一个人。许多开发人员认为他们的代码默认是自文档化的。没有多少人理解创建自文档化的代码是一项复杂的设计任务。</p><p id="5cd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是为什么呢？让我们来看看我们阅读代码的方式:</p><ol class=""><li id="910d" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">首先，我们试图找出这段代码的目的:任务和目标是什么(真正的专家也试图探究原因)。</li><li id="6011" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">接下来，知道了什么，我们正在阅读代码，以了解作者是如何实现这一点的。</li></ol><p id="c21a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然反过来也是可能的，但这在任何生产解决方案中都是困难的。由于与其他系统组件(如监控、日志记录或安全性)集成的额外需求，生产代码往往很复杂。它们还必须具有弹性、可伸缩性、可配置性，支持多平台、多版本等。</p><p id="0e5b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有些人声称SQL和HTML同时回答了如何和做什么。我将在这里忽略这个注释，集中讨论通用语言。</p><p id="a528" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">做反过来分析，软件工程师应该弄清楚这段代码的目的是什么，它主要做什么，以及(最后)它缺少什么。这通常被称为心智模型。无论多么简单或复杂，代码背后总有一些心理模型(甚至是坏的模型)。它可能是一个领域模型，或者是表达思维过程的另一种方式。有许多具体的规则可以遵循，以使您的代码更加清晰、易读和易懂。</p><p id="677c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">众所周知，许多书都是关于这个主题的。但是总结所有这些，只有一种方法来编写自文档化的代码:开发人员应该编写代码来揭示心智模型并表达重要的模型部分，同时隐藏不必要的实现细节。开发人员经常关注实现细节，如框架、数据库、协议和语言，这使得理解模型变得困难。</p><p id="6603" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像“如何”和“什么”这样的问题是正交的，因为有几种方法可以达到相同的目标。想象登山者分析通过不同的路径到达山顶的更好的方法。他们考虑各个方面，总结自己的经验和关于山区地形、天气和空气条件、一年中的时间、小组的准备水平等的常识。最后，他们选择最佳路径攀登。最佳路径没有解释所有这些方面，但允许团队将旗帜放在顶峰。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/a2aa548ce56f4b6f2adf5b1bde43c07a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cWMmMnSjhE0lDxQG.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://www.freepik.com/premium-vector/mountain-paths-progress-success-hiking-path-business-metaphor-journey-climb-peak-route-mission-progressive-career-way-vector-illustration-mountain-goal-progress-career-business_18144991.htm" rel="noopener ugc nofollow" target="_blank">图片通过freepik </a></p></figure><p id="a4b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我看来，心智模型显示了作者的设计技巧对自文档代码的明确依赖，允许他们使代码更具可读性。</p><blockquote class="nf ng nh"><p id="7c61" class="kw kx mp ky b kz la jr lb lc ld ju le ni lg lh li nj lk ll lm nk lo lp lq lr ij bi translated">心智模型回答什么，而代码告诉我们如何做。</p></blockquote><h1 id="2d06" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">衡量代码的可读性</h1><p id="351e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Frederick Brooks在他的著名论文<a class="ae kv" href="https://en.wikipedia.org/wiki/No_Silver_Bullet" rel="noopener ugc nofollow" target="_blank">没有银弹——软件工程中的本质和意外</a>中指定了两种类型的复杂性:</p><ul class=""><li id="408c" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr nl mw mx my bi translated">本质复杂性——由要解决的问题引起，没有什么可以消除它</li><li id="3ca1" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nl mw mx my bi translated">意外复杂性——与工程师创造的可以解决的问题相关</li></ul><p id="9fa0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">许多年过去了，但我们仍然不能精确地测量它。众所周知的度量标准圈复杂度(1976年发明)与代码行紧密相关。虽然这是测量代码覆盖率的一个很好的方法，但它不是测量圈复杂度的方法。这里是问题展示区:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/cfc97f7f2be659628680b9a746bcb0a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PQ525FdvYR2W-Z5u.jpg"/></div></div></figure><p id="c9da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如你所看到的，圈复杂度从左到右显示了相同的数字。然而，从开发人员的角度来看，左边和右边的代码并不完全一样复杂。左边的更难阅读和理解。我们可能认为代码在寻找素数之和，这是一个众所周知的问题，但是一个有经验的开发人员永远不会认为它解决了这个问题，直到他们验证了这是真的:</p><ul class=""><li id="5e3f" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr nl mw mx my bi translated">方法的名字是否清楚地说明了代码的作用？</li><li id="5daf" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nl mw mx my bi translated">代码是否实现了任务？</li><li id="4124" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nl mw mx my bi translated">代码是否遗漏了一些用例，它们是什么？(即守则的局限性是什么？)</li></ul><p id="fe5a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，想象一下，对于那些不为他人所知的领域，理解一些更具体的东西有多难。声纳源在2017年发布了认知复杂性度量，知道的人并不多。然而，我相信这是一项开创性的工作，必须被广泛采用。正如我们所看到的，它非常适合所描述的例子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/d910ec8c9df961d352011f26374e110e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dTcXNmEyfhTSKlD0.jpg"/></div></div></figure><p id="53b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在<a class="ae kv" href="https://redirect.sonarsource.com/doc/cognitive-complexity.html" rel="noopener ugc nofollow" target="_blank">他们的论文</a>和<a class="ae kv" href="https://www.youtube.com/watch?v=x5V2nvxco90" rel="noopener ugc nofollow" target="_blank"> YouTube </a>上找到所有细节。该指标基于三条规则:</p><ol class=""><li id="2379" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">忽略允许将多个语句缩写成一个语句的结构。</li><li id="0b68" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">代码线性流程中的每一个断点递增(加一):循环结构(for，while，do-while)，条件，三元运算(if，#if，#ifdef)。</li><li id="ba4f" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">当断流结构嵌套时递增。</li></ol><p id="221d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以使用Sonar Source生产的静态代码分析工具(SonarQube、SonarCloud及其免费提供的SonarLint IDE扩展)找到这个度量。SonarQube在<a class="ae kv" href="https://www.sonarsource.com/plans-and-pricing" rel="noopener ugc nofollow" target="_blank">免费社区版</a>中有售。</p><p id="8fc7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在声纳云中，查看项目-&gt;问题-&gt;规则-&gt;认知复杂性。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/545c57e959453cd3a7953003d31d00bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*csGjYZxXYSJLDbtH.jpg"/></div></div></figure><p id="41fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很容易找到完整的报告，其中逐行解释了惩罚分配。下面是如何做到这一点:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/5de3c4aa87f74f573c1ece24817d15ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xCA0JsZHBNipIKJW.jpg"/></div></div></figure><p id="0edd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码质量的默认阈值是:</p><p id="6118" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">认知复杂性</p><ul class=""><li id="38af" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr nl mw mx my bi translated">15(大多数语言)</li><li id="b290" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nl mw mx my bi translated">25 (C系列语言)</li></ul><p id="5146" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">圈复杂度</p><ul class=""><li id="fa4c" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr nl mw mx my bi translated">10(所有语言)</li></ul><p id="e49d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">了解圈复杂度和认知复杂度阈值是很重要的，因为一个度量可能比另一个大，反之亦然。让我们看一个简单的生产示例。要找到它，您可以执行以下操作:声纳云-&gt;测量-&gt;选择复杂性过滤器</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/2abe1dc52b4af9d8f7628b9cce2be47f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*Gu8OA7hWhPDPneRq.jpg"/></div></figure><p id="04de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在左侧找到文件组(文件夹)的总复杂性度量。在这里，我们可以看到数字翻倍:134对64。您还可以看到文件与文件之间的差异。</p><p id="b2e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nr ns nt nu b">LoggerHelper</code>文件在圈复杂度方面还不错，但是有一些方法可以提高它的认知复杂度。对于其他文件，我们可能会看到一个有争议的图片——圈复杂度大于认知复杂度。</p><h1 id="23d1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结果</h1><p id="c2d1" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">看起来我们有了一种度量代码复杂性的方法，我希望有更多的工具来实现这一点，但是我们已经可以快速直接地开始使用它了。认知复杂性度量仍然没有告诉我们好的代码是如何表达心智模型的，但是它已经是迈向好软件的优秀数据了。使用这些指标，您可以开始在开发和业务之间建立透明的对话，讨论必要的资源和路线图，以获得更好的代码和产品质量:</p><ul class=""><li id="70ae" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr nl mw mx my bi translated">度量代码库所有部分的认知复杂性，以评估引入新开发人员、实现和交付新变更等的难度。</li><li id="2b6a" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nl mw mx my bi translated">在规划开发周期和任何改进代码的活动(如重构)时，使用可度量的目标。</li><li id="1b19" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nl mw mx my bi translated">优先改进代码库最关键的部分。</li><li id="2471" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nl mw mx my bi translated">查看应包含附加文档的地方。</li><li id="1a47" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nl mw mx my bi translated">停止争论和警告，停止冲突，停止和同事强调代码质量。</li><li id="04d1" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nl mw mx my bi translated">让你同事的生活更有成果(每个人都想尽快完成任务，然后与朋友和家人见面)。</li></ul><p id="5eef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望我分享了令人兴奋的食物，让你深入了解这一点，并向你展示认知复杂性如何应用于你的日常生活。</p></div></div>    
</body>
</html>