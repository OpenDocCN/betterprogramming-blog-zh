<html>
<head>
<title>How To Make a Piano App in Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Flutter中制作一个钢琴App</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-make-a-piano-app-in-flutter-8989d989056?source=collection_archive---------4-----------------------#2021-07-22">https://betterprogramming.pub/how-to-make-a-piano-app-in-flutter-8989d989056?source=collection_archive---------4-----------------------#2021-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fc72" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索MIDI和音乐制作之美</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/65ab879be7fe1c895e2f3fcebdc9d7ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbkTDRdqpmvE4rDd2X57ZQ.png"/></div></div></figure><p id="4f27" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从我们出生的那一刻起，直到我们变老，音乐一直围绕着我们。它是人类的通用语言。</p><p id="eb02" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是我们中的许多人没有一种奇特的乐器或天生的嗓音。我们被限制在只能用别人的感受来点击，而不能通过音乐来表达自己的感受。我们觉得创造出比简单的脚敲拍子更多的东西是令人生畏的。</p><p id="26ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">事实上，制作音乐比看起来容易。你甚至不需要有一个音乐的耳朵来开始。</p><p id="c37d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本教程中，您将学习如何创建自己的虚拟仪器。<br/>我们的目标不仅是创造它，还要了解它是如何工作的。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="d357" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">什么是MIDI？</h1><p id="0e92" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">MIDI代表“乐器数字接口”，是一个允许电子乐器和计算机相互发送指令的系统。</p><p id="67df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">既然我们是程序员，我们可以把MIDI看作一种简化的编程语言，只有<code class="fe mu mv mw mx b">NOTE ON </code>和<code class="fe mu mv mw mx b">NOTE OFF</code>语句。</p><h2 id="222d" class="my ly it bd lz mz na dn md nb nc dp mh ld nd ne mj lh nf ng ml ll nh ni mn nj bi translated">MIDI信息的结构</h2><p id="f17a" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">MIDI信息是一个普通的三字节二进制数。</p><p id="4b53" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一个字节代表以下信息:</p><ul class=""><li id="a2a5" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">MIDI信息类型:<code class="fe mu mv mw mx b">NOTE ON</code> ( <code class="fe mu mv mw mx b">1001</code>)或<code class="fe mu mv mw mx b">NOTE OFF</code> ( <code class="fe mu mv mw mx b">1000</code>)。</li><li id="138b" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">MIDI通道:<code class="fe mu mv mw mx b">0CCC</code>，其中<code class="fe mu mv mw mx b">CCC</code>为二进制数，范围从<code class="fe mu mv mw mx b">0</code>到<code class="fe mu mv mw mx b">15</code>。</li></ul><p id="3342" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第二个字节指定弹奏音符的音高，范围从<code class="fe mu mv mw mx b">0</code>到<code class="fe mu mv mw mx b">127</code> ( <code class="fe mu mv mw mx b">0PPP PPPP</code>)。</p><p id="0733" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后一个字节表示弹奏的音符的力度(即音符的响度)。范围从<code class="fe mu mv mw mx b">0</code>到<code class="fe mu mv mw mx b">127</code> ( <code class="fe mu mv mw mx b">0VVV VVVV</code>)。</p><p id="c76c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，如果您要在0声道上演奏一个中等音量的C4音符，您必须发送以下消息:<code class="fe mu mv mw mx b">1001</code>(音符开)<code class="fe mu mv mw mx b">0000</code> (0声道)<code class="fe mu mv mw mx b">0011 1100</code> (60音高)<code class="fe mu mv mw mx b">0101 0000</code> (80力度)。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="77f7" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">钢琴应用程序</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/1e4bfb3977660e7ee6ae8e22c9fd37e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iMullNdFSTVYbSGOGIHuRQ.png"/></div></div></figure><p id="3673" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在你已经看到了MIDI是如何工作的，让我们将这些知识付诸实践。</p><p id="97a9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了简单起见，我们的应用程序将只显示一个八度音程(七个白音和五个黑音)，但您可以根据自己的喜好自由定制。</p><h2 id="2bfc" class="my ly it bd lz mz na dn md nb nc dp mh ld nd ne mj lh nf ng ml ll nh ni mn nj bi translated">1.创建键盘布局</h2><p id="fca9" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">键盘最基本的元素是钢琴键，所以让我们创建一个名为<code class="fe mu mv mw mx b">PianoKey</code>的简单小部件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="36d6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里的<code class="fe mu mv mw mx b">midiNote</code>对应于相关MIDI信息的<code class="fe mu mv mw mx b">pitch</code>。</p><p id="7aaa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以将此widget用于白键和黑键，因为它们的功能是相同的，只是音高不同。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="44dc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在你有了基本的积木，是时候组装你的钢琴了。让我们创建一个有状态的<code class="fe mu mv mw mx b">Piano</code>小部件，您可以在其中放置我们的钢琴键。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="b89d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于一个八度包含12个音符，<code class="fe mu mv mw mx b">octaveStartingNote</code>给出了<code class="fe mu mv mw mx b">octaveNumber</code>八度中第一个C音符的索引。</p><p id="c099" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae ob" href="https://www.inspiredacoustics.com/en/MIDI_note_numbers_and_center_frequencies" rel="noopener ugc nofollow" target="_blank">灵感声学</a>列出了所有可能音符的代码。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="13dc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在你的单八度钢琴中，你会有七个白键和五个黑键。因此，让我们创建<code class="fe mu mv mw mx b">_buildWhiteKeys</code>和<code class="fe mu mv mw mx b">_buildBlackKeys</code>方法，将这些键放在钢琴上。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="854c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如您所见，白键的代码非常简单。<br/>你只是在为它们设置正确的MIDI音符时，将它们一个接一个地水平放置。</p><p id="0526" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而对于黑键，你也必须考虑它们之间的间距。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="431a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是您最终的<code class="fe mu mv mw mx b">Piano</code>小部件布局:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="1630" class="my ly it bd lz mz na dn md nb nc dp mh ld nd ne mj lh nf ng ml ll nh ni mn nj bi translated">2.设置MIDI插件</h2><p id="a3fa" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">你已经看到了什么是MIDI以及它是如何工作的。现在，你必须将这些知识付诸实践，并发出那些<code class="fe mu mv mw mx b">NOTE ON</code>和<code class="fe mu mv mw mx b">NOTE OFF</code>信息。</p><p id="0b05" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为此，您将使用<a class="ae ob" href="https://pub.dev/packages/flutter_midi" rel="noopener ugc nofollow" target="_blank"> flutter_midi </a>插件。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="3fcc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将flutter_midi插件添加到您的<code class="fe mu mv mw mx b">pubspec.yaml</code>后，在线搜索一个声音字体(<code class="fe mu mv mw mx b">.sf2</code>)文件并将其添加到您的资源中。</p><p id="0c6e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，您已经准备好在您的<code class="fe mu mv mw mx b">Piano</code>小部件中设置插件了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="7e18" class="my ly it bd lz mz na dn md nb nc dp mh ld nd ne mj lh nf ng ml ll nh ni mn nj bi translated">3.将MIDI插件连接到钢琴</h2><p id="e7ec" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">在您的<code class="fe mu mv mw mx b">PianoKey</code>小部件中，您已经有了需要播放的MIDI音符。剩下的就是使用MIDI插件在按键时播放那个音符。</p><p id="e63e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当按下该键时，必须发送<code class="fe mu mv mw mx b">NOTE ON</code>消息。释放按键后，发送<code class="fe mu mv mw mx b">NOTE OFF</code>消息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="13ba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不要忘记将<code class="fe mu mv mw mx b">flutterMidi</code>从<code class="fe mu mv mw mx b">Piano</code>小工具发送到<code class="fe mu mv mw mx b">PianoKey</code>。</p><h2 id="3f8b" class="my ly it bd lz mz na dn md nb nc dp mh ld nd ne mj lh nf ng ml ll nh ni mn nj bi translated">4.扩展到你喜欢的程度</h2><p id="dcde" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">应用程序现在已经完成。当你敲击琴键时，你可以听到扬声器中播放的音符。</p><p id="fa8d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过扩展功能或改进用户界面，您可以发挥自己的想象力，让它变得更有趣。</p><p id="537a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，当按键被按下时，你可以在按键上添加一个录音按钮或者一个漂亮的阴影。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="8d16" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">演示</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc oa l"/></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="4b9a" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">结论</h1><p id="cef5" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">即使创作音乐的想法似乎令人生畏，但你已经看到它并不一定如此。在完成一个简短的教程后，你能够直接从智能手机扬声器中听到钢琴音符(或任何你选择作为<code class="fe mu mv mw mx b">.sf2</code>文件的乐器)。</p><p id="d7f9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">想象一下，如果你每天都在这上面投入时间，你还能取得什么成就。</p><p id="92e4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你在学习本教程时遇到困难，给我留言，我会非常乐意帮助你。</p><p id="42d3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您已经完成了本教程，并进一步扩展了应用程序，请在评论部分分享它。</p><p id="d011" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下次见！</p></div></div>    
</body>
</html>