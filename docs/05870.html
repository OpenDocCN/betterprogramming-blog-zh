<html>
<head>
<title>Android’s Attribute android:allowBackup Demystified</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android的属性android:allowBackup去神秘化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/androids-attribute-android-allowbackup-demystified-114b88087e3b?source=collection_archive---------1-----------------------#2020-08-13">https://betterprogramming.pub/androids-attribute-android-allowbackup-demystified-114b88087e3b?source=collection_archive---------1-----------------------#2020-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9bbd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">帮助防止您的用户丢失数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3157a4b3767b026d0d15d3a9e12c30e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LDbaxODS1YeFCzkCUSvew.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">android:allowBackup清单属性</p></figure><p id="74fa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有各种各样的“备份”可以帮助你摆脱各种情况。想想你后备箱里的备用轮胎或者攀岩锚里多余的带子。如果你曾经攀岩过，你会知道在你的锚上增加冗余是很重要的。这样，如果一个部分失效，你还有另一个部分作为备份。</p><p id="6bd1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">同样，Android提供给你一个令人印象深刻的设置，名为<a class="ae lr" href="https://developer.android.com/guide/topics/manifest/application-element#allowbackup" rel="noopener ugc nofollow" target="_blank"> allowBackup </a>，帮助我们自动备份应用程序数据。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="625f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">Android allowBackup是做什么的？</h1><p id="0da1" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">正如<a class="ae lr" href="https://developer.android.com/guide/topics/data/autobackup" rel="noopener ugc nofollow" target="_blank">文档</a>所说，“<em class="mw">应用程序自动备份</em>会自动备份运行在Android 6.0 (API级别23)或更高版本上的应用程序中的用户数据。”</p><p id="b596" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以在我们的Android应用程序中利用自动备份，这样我们的用户就可以更快地恢复他们的数据，如果他们在卸载后更换手机或重新安装我们的应用程序。</p><p id="478b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果用户以任何方式删除应用程序，包括通过设备的工厂重置，当用户重新下载应用程序并安装<code class="fe mx my mz na b">.apk</code>时，应用程序的数据仍将可用。自动备份也可以跨设备工作，这意味着当你的用户获得一部新手机时，他们不会丢失你的应用程序中的关键信息。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="edaa" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">备份数据存储在哪里？</h1><p id="821e" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">Android通过将应用程序数据上传到用户的Google Drive(默认情况下)来保存应用程序数据，在Google Drive中，数据受到用户的Google帐户凭证的保护。</p><p id="cbac" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">数据存储在用户Google Drive账户的私人文件夹中。保存的数据不计入用户的个人Google Drive配额。仅存储最新的备份。当进行备份时，以前的备份(如果存在)将被删除。用户或设备上的其他应用程序无法读取备份数据。</p><p id="f6d2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用户可以在Google Drive Android应用程序中看到已备份的应用程序列表。在Android设备上，用户可以在Drive应用程序的导航抽屉中的设置&gt;备份和重置&gt;应用程序数据下找到该列表。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="f990" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">可以备份多少数据？</h1><p id="111d" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">用户可以存储多达25MB的数据，这些数据会在您设备上安装的应用程序的整个生命周期内持续存在。</p><p id="beeb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，实际上，如果您只需要保存设置和首选项，这就足够了。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="4334" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated"><strong class="ak">什么是备份？</strong></h1><p id="2e23" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">默认情况下，自动备份包括系统分配给应用程序的大多数目录中的文件:</p><ul class=""><li id="d440" class="nb nc iq kx b ky kz lb lc le nd li ne lm nf lq ng nh ni nj bi translated">共享首选项文件</li><li id="52af" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">保存到应用内部存储器的文件，由<code class="fe mx my mz na b"><a class="ae lr" href="https://developer.android.com/reference/android/content/Context#getFilesDir()" rel="noopener ugc nofollow" target="_blank">getFilesDir()</a></code>或<code class="fe mx my mz na b"><a class="ae lr" href="https://developer.android.com/reference/android/content/Context#getDir(java.lang.String,%20int)" rel="noopener ugc nofollow" target="_blank">getDir(String, int)</a></code>访问</li><li id="6d19" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">由<code class="fe mx my mz na b"><a class="ae lr" href="https://developer.android.com/reference/android/content/Context#getDatabasePath(java.lang.String)" rel="noopener ugc nofollow" target="_blank">getDatabasePath(String)</a></code>返回的目录中的文件，其中也包括用<code class="fe mx my mz na b"><a class="ae lr" href="https://developer.android.com/reference/android/database/sqlite/SQLiteOpenHelper" rel="noopener ugc nofollow" target="_blank">SQLiteOpenHelper</a></code>类创建的文件</li><li id="193e" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">由<code class="fe mx my mz na b"><a class="ae lr" href="https://developer.android.com/reference/android/content/Context#getExternalFilesDir(java.lang.String)" rel="noopener ugc nofollow" target="_blank">getExternalFilesDir(String)</a></code>返回的目录中的外部存储文件</li></ul><p id="09ca" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以配置您的应用程序以包括和排除特定文件。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="23e9" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">我们如何定制备份中包括和排除的内容？</h1><p id="211c" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">为此我们有<code class="fe mx my mz na b"><a class="ae lr" href="https://developer.android.com/guide/topics/manifest/application-element#fullBackupContent" rel="noopener ugc nofollow" target="_blank">android:fullBackupContent</a></code>，它指向一个XML文件，该文件包含用于自动备份的<a class="ae lr" href="https://developer.android.com/guide/topics/data/autobackup" rel="noopener ugc nofollow" target="_blank">完整备份规则</a>。这些规则决定备份哪些文件。</p><p id="f6cc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以通过几个步骤做到这一点:</p><ol class=""><li id="0383" class="nb nc iq kx b ky kz lb lc le nd li ne lm nf lq np nh ni nj bi translated">在<code class="fe mx my mz na b">res/xml</code>目录下创建一个XML文件<code class="fe mx my mz na b">auto_backup_rules.xml</code>。</li><li id="8bf6" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq np nh ni nj bi translated">使用以下语法指定要在备份中包括或排除的内容:</li></ol><ul class=""><li id="6075" class="nb nc iq kx b ky kz lb lc le nd li ne lm nf lq ng nh ni nj bi translated">如果在<code class="fe mx my mz na b">include</code>和<code class="fe mx my mz na b">exclude</code>标签中都指定了类型，则在<code class="fe mx my mz na b">exclude</code>标签中指定的项目优先。</li><li id="8fee" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">您可以为想要指定的每个新资源添加一个新的<code class="fe mx my mz na b">&lt;include&gt;</code>或<code class="fe mx my mz na b">&lt;exclude&gt;</code>标签。</li><li id="84cf" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated"><code class="fe mx my mz na b">path</code>标签指定了您想要包含或排除的资源的路径。例如:<code class="fe mx my mz na b">&lt;exclude domain="database" path="my_db.db"/&gt;</code></li></ul><p id="e3c3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">3.在您的Android清单中包含您的备份文件:</p><p id="6e93" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe mx my mz na b">&lt;application ... android:fullBackupContent="@xml/auto_backup_rules"&gt;</code></p><p id="ab1f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是XML文件的示例:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="32a8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以上示例备份了除<code class="fe mx my mz na b">device.xml.</code>之外的所有共享偏好设置</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8158" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">何时可以触发备份？</h1><p id="b147" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">当满足以下所有条件时，备份会自动进行:</p><ul class=""><li id="aaef" class="nb nc iq kx b ky kz lb lc le nd li ne lm nf lq ng nh ni nj bi translated">用户已在设备上启用备份。在Android 9中，这个设置在设置&gt;系统&gt;备份中。</li><li id="d4f7" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">自上次备份以来，至少已经过去了24小时。</li><li id="f863" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">设备处于空闲状态。</li><li id="8935" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">该设备连接到Wi-Fi网络(如果设备用户没有选择加入移动数据备份)。</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="eba8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">我需要担心备份吗？</h1><p id="74bd" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">Android备份依靠Android调试桥(ADB)命令来执行备份和恢复。然而，ADB一直是黑客的软目标，仍然不被受尊敬的开发者信任。至少可以说，有人可以向您的备份数据中注入恶意代码的想法是令人不安的。对于终端用户来说，这通常不是问题，因为它需要在设备上启用调试，但由于许多Android用户喜欢探索和扎根他们的设备，这可能会成为一个严重的问题。</p><p id="d4f0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">备份后，用户可以读取所有应用程序数据。<code class="fe mx my mz na b">adb restore</code>允许从用户指定的来源创建应用程序数据。恢复后，应用程序不应假定数据、文件权限和目录权限是由应用程序自己创建的。</p><p id="06ac" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，处理和存储诸如卡细节、密码等敏感信息的应用程序。，应该将此设置明确设置为<code class="fe mx my mz na b">false</code> —默认情况下，它设置为<code class="fe mx my mz na b">true </code> —以防止此类风险，或者您也可以自定义需要备份的内容。</p><p id="2667" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe mx my mz na b">&lt;application ... android:allowBackup="false"&gt;</code></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="303b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以上就是我对这篇文章的看法。如果你有什么要分享的，请留下评论，这样我们可以一起学习。</p><p id="8cb1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">原发表<a class="ae lr" href="https://thedroidlady.com/2020-08-13-android-allowBackup-Demystified" rel="noopener ugc nofollow" target="_blank">此处</a>。</p></div></div>    
</body>
</html>