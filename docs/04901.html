<html>
<head>
<title>Optimize Your Application With Redis Caching</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Redis缓存优化您的应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/optimizing-your-application-with-redis-caching-5df5fb9acbd4?source=collection_archive---------6-----------------------#2020-05-20">https://betterprogramming.pub/optimizing-your-application-with-redis-caching-5df5fb9acbd4?source=collection_archive---------6-----------------------#2020-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="38b0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你最重要的特征之一是速度</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6671fe959b2c4144e1024e0f14747403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8HRp9wYs2xdLRwArSAuZ3g.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">利亚姆·布里斯在<a class="ae kv" href="https://unsplash.com/s/photos/ram?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2ad4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">软件工程师的角色不仅仅是构建和创造新事物。如果你把你的应用程序看作是建造和拥有一栋房子，你可以想象它需要持续的关注和维护。现在想象一下，在所有这些工作之后，有人花了三秒多的时间通过任何一个门口。对于任何web应用程序来说，挫折都是相互的。</p><p id="6d19" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">许多<a class="ae kv" href="https://dl.acm.org/doi/10.1145/1835449.1835513" rel="noopener ugc nofollow" target="_blank">研究</a>显示，如果页面加载时间超过三秒，人们就会离开。在这个手机广泛使用和注意力持续时间缩短的时代，这一点变得尤其真实。许多应用程序不仅仅是静态页面，所有这些移动的部分意味着要加载更多的东西。正因为如此，对于任何软件工程师来说，在创建和维护一个成功的网站时，优化加载时间变得越来越重要。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/3e0a7bbef5b79534d964fa90e6c64594.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*xGl7RLsD6pMH4Op5-4xPGA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">分秒必争！！</p></figure><p id="7b12" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是从哪里开始呢？有这么多的策略。每种策略的功效因应用而异。模块捆绑、精简代码、压缩图像、使用内容交付网络——所有这些都是有效的技术，但每种技术的用途都略有不同。</p><p id="f584" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将讨论一个特定的解决方案:缓存。缓存是指最近使用或传输的数据以一种允许将来更快访问的方式临时存储。缓存节省了应用程序成本，并为用户创造了更好的体验。</p><p id="068d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文的最后，我将展示如何使用<a class="ae kv" href="https://redis.io/" rel="noopener ugc nofollow" target="_blank"> Redis </a>实现自己的缓存。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="c9cc" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak">为什么要缓存？缓存是如何工作的？</strong></h1><p id="623a" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">缓存的实际创建和实现非常简单。在设置缓存时，开发人员被赋予了极大的灵活性。他们不仅可以选择存储什么(图像、html页面、用户数据、脚本文件等。)，他们还可以决定存储过程背后的物流。</p><p id="5dd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记住，缓存的数据是<em class="lt">暂时</em>存储的数据。因此，您可以决定缓存数据何时更新，以及数据何时过期。它必须过期，否则你就有可能向用户展示过时的数据。缓存为开发人员提供了更多的选择和更多的控制，因此您可以决定如何使您的应用程序更好！</p><p id="a231" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么什么是缓存呢？<em class="lt">如果不在标准数据库中，我们将这些数据存储在哪里？<em class="lt">我们如何储存它？而<em class="lt">当</em>在沟通过程中我们这样做了吗？缓存非常灵活，因为您可以选择在何处、何时以及如何存储数据。虽然最初创建缓存可能很容易，但这种灵活性的提高可能会导致更复杂的设计挑战。通过更好地了解在何处、何时以及如何设置缓存，您可以最大限度地减少这些挑战，并创建更成功的缓存来优化您的应用程序。</em></em></p><p id="c053" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">定义和分类缓存的一种总括方法是通过客户端和服务器端缓存。这两个概念指的是应用程序存储缓存数据的“位置”和“时间”。</p><p id="9d6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下图显示了用户与应用程序的通信过程。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/146278faa6f41f5c20fa0231f2be4226.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o5IegALQ42BQQVFEMSARKg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="mz">图片由亚马逊“缓存概述”页面提供:</em><a class="ae kv" href="https://aws.amazon.com/caching/" rel="noopener ugc nofollow" target="_blank"><em class="mz">https://aws.amazon.com/caching/</em></a></p></figure><p id="27e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">缓存可以存在于这个周期的不同阶段。在左侧，或者说客户端，有一个浏览器缓存。在右边，或者说服务器端，我们有一个服务器缓存，它位于应用程序的服务器上。两者都有助于更快的数据访问，因为第一个请求之后的所有请求都可以访问适当的缓存。我们不再需要对服务器(当使用浏览器端缓存时)或数据库(当使用服务器端缓存时)进行完整的往返。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/5fc27fe1199c51cada9dcfc76760cf95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yt5ccEwxNX_yKv_b_lyZHg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="mz">服务器端缓存</em></p></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="37af" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak">缓存优势</strong></h1><ul class=""><li id="b676" class="nb nc iq ky b kz mt lc mu lf nd lj ne ln nf lr ng nh ni nj bi translated">缓存减少了传输的数据量，从而减少了带宽消耗、网络负载和流量，并降低了网络延迟和成本。</li><li id="0783" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">通过最小化服务器的整体负担，缓存可以提高应用程序的整体响应能力。</li><li id="0600" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">缓存最大限度地减少了所需的数据库访问次数，使您的应用程序不必执行许多昂贵的数据库操作。</li><li id="9303" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">即使脱机，内容也是可用的。由于可以在客户端访问缓存的数据，而不必与web服务器通信，因此即使在网络或服务器崩溃的情况下，用户也可以脱机访问这些数据。</li></ul></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="cdaf" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak">缓存缺点</strong></h1><ul class=""><li id="8a62" class="nb nc iq ky b kz mt lc mu lf nd lj ne ln nf lr ng nh ni nj bi translated">如果在指定的过期时间间隔结束之前修改缓存，可能会导致数据失效、数据丢失或数据不一致。</li><li id="f76d" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">由于只有一个缓存，你的应用程序很容易出现<a class="ae kv" href="https://www.apicasystems.com/blog/5-common-performance-bottlenecks/" rel="noopener ugc nofollow" target="_blank">瓶颈</a>。</li><li id="58b6" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">准确测量应用程序的流量指标和统计数据会变得很困难，因为服务器不再代理每个请求的信息。</li></ul></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="e1fb" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak">一个Redis操作指南</strong></h1><p id="a829" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">本演练假设您有使用JavaScript创建自己的网站的经验。</p><p id="644a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了讨论缓存的数据是如何存储的，让我们来讨论一个流行的缓存系统，Redis(远程字典服务器)。Redis是一个开源的NoSQL数据库，它将数据作为键值对存储在内存中。具体来说，这些数据存储在RAM(随机存取存储器)中，而不是写入硬盘。RAM的访问速度比硬盘快几百倍，这也是高速缓存数据检索速度如此之快的部分原因。然而，RAM比硬盘空间昂贵得多，而且本身也不稳定，这意味着任何断电都可能导致数据丢失。虽然这对于持久性数据存储来说可能不太好，但对于缓存之类的东西来说却非常合适。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="0987" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak">为什么是Redis？</strong></h1><ul class=""><li id="f7f9" class="nb nc iq ky b kz mt lc mu lf nd lj ne ln nf lr ng nh ni nj bi translated">Redis支持多种数据类型和数据结构(字符串、集合、散列等)。)</li><li id="db7d" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">它简单、灵活、易于扩展。</li><li id="187d" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">它可以用于许多目的，而不仅仅是缓存！(那些这里就不赘述了。)</li><li id="0af0" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">它是开源的！工程师们一直在努力使Redis变得更好。</li></ul></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="d2bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们开始吧。我将展示一个我制作的简单应用程序，演示如何用Redis设置服务器端缓存。它通过查询<code class="fe np nq nr ns b"><a class="ae kv" href="https://superheroapi.com/" rel="noopener ugc nofollow" target="_blank">SuperHero</a></code> <a class="ae kv" href="https://superheroapi.com/" rel="noopener ugc nofollow" target="_blank"> API </a>来寻求帮助。我们将看看在不使用缓存的情况下呼叫帮助需要多长时间，然后使用缓存。此应用程序的回购可在<a class="ae kv" href="https://github.com/json-yu/redis-tutorial" rel="noopener ugc nofollow" target="_blank">此处</a>找到。在跟随过程中，请随意使用它。</p><p id="b321" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，您总是希望确保您的设备上安装了Redis。根据您使用的设备，请遵循以下说明:<a class="ae kv" href="https://redis.io/topics/quickstart" rel="noopener ugc nofollow" target="_blank"> Redis快速入门指南。</a>然后，确保使用<code class="fe np nq nr ns b">npm install redis</code>在您的应用程序中安装Redis包。</p><p id="aade" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我的服务器文件——非常标准的东西。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/e35918af9bb3b2ff9eeedccaa371c1fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cOb_Hy_VJ9mZDvyIoir73A.png"/></div></div></figure><p id="d7a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我的前端的样子。你可以在没有前端的情况下建立一个缓存，使用类似于<a class="ae kv" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>的东西，但是为了这个演示的目的，我决定做一些非常详细和复杂的东西。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/ad6d53fb10ab716824fe4cc68ca3a467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z1LPr51bI0k3mMDF3uVJEA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这么详细。</p></figure><p id="5d82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们从一个按钮开始，该按钮向我们在服务器文件中设置的<code class="fe np nq nr ns b">/help</code>端点发起一个获取请求。这调用了我们的<code class="fe np nq nr ns b">callForHelp</code>中间件函数。</p><p id="90d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看当我们点击这个按钮时会发生什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/90c11d9bbcfcc7574f8676f8e6bedc44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wSQ9bgyRxFUwRWpu-mL3qg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">嘣。砰。啪。托尔来救援了。</p></figure><p id="a5a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们将Redis并入我们的代码之前，让我们通过查看Chrome DevTools的network选项卡来看看这个初始请求花费了多长时间。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/0dc78f349da8c2c4d4d09e2f9d43b5ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ATvAuqABwIYSGDfgsoSlg.jpeg"/></div></div></figure><p id="c44c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">说我们想再打电话给托尔。这次应该会更快，因为Thor已经知道我们在哪里(或者因为我们这次将使用缓存)。让我们看一下控制器文件，看看我们是如何做到这一点的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/ddbea15aa285d4060cc824c609e9a45a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hwez6SoUAQagD4XXZuuh6Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的中间件来检查缓存。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/c758c1c5968cbabcd1120a4b8529f9ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*89pyb27PJ-LJsLKOyxvr9A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的<code class="fe np nq nr ns b">callForHelp</code>中间件功能，现在有了<code class="fe np nq nr ns b">redis</code>。</p></figure><p id="61e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意到<code class="fe np nq nr ns b">callForHelp</code>函数中以<code class="fe np nq nr ns b">redis_client.setex</code>开始的那一行了吗？SETEX代表“设置”和“过期”。这个命令有三个参数:一个键、一个时间和将保存到那个键的值。记住，Redis是一个NoSQL数据库，它将数据存储为<em class="lt">键-值对。</em>您随后提供的时间是数据在到期前应该保留的时间。在我们将数据存储在缓存中之后，我们可以使用同一个键来检索数据，使用内置的Redis <code class="fe np nq nr ns b">.get</code>方法，如<code class="fe np nq nr ns b">checkCache</code>函数所示。</p><p id="81c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们有了Redis incorporated，让我们看看再给Thor打电话需要多长时间。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/8cae76f3b460a7d94c7405942416d46e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t3_XUnCinu5EWAca3nzfTA.jpeg"/></div></div></figure><p id="9688" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">差别真大！这看起来似乎不是很多时间，但是当您处理大量数据(可能是图像和HTML文件)时，它真的会增加。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="9ae6" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated"><strong class="ak">结论</strong></h1><p id="1413" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">Redis只是众多选择之一。像决定使用什么技术或框架一样，找到您的应用程序需要的解决方案。对更新和修改缓存的结构和实现持开放态度，以便随着时间的推移更好地适应。例如，随着微服务架构和云计算的兴起，亚马逊的<code class="fe np nq nr ns b"><a class="ae kv" href="https://aws.amazon.com/elasticache/" rel="noopener ugc nofollow" target="_blank">ElastiCache</a></code>成为了在云中开始缓存的选项！它甚至让您选择使用Redis或其他流行的缓存系统，<a class="ae kv" href="https://memcached.org/" rel="noopener ugc nofollow" target="_blank"> Memcached。</a>现在就让自己踏上缓存之路，开始优化您的应用吧！</p></div></div>    
</body>
</html>