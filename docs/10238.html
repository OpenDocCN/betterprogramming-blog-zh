<html>
<head>
<title>Introducing Gopher Jasmine — A Testing Framework for Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Gopher Jasmine简介——围棋测试框架</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/introducing-gopher-jasmine-a-testing-framework-for-go-a1636ab1d94f?source=collection_archive---------11-----------------------#2021-12-15">https://betterprogramming.pub/introducing-gopher-jasmine-a-testing-framework-for-go-a1636ab1d94f?source=collection_archive---------11-----------------------#2021-12-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5597" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用Golang编写简单、快速、明显的验收测试</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1fe30218c9f412fedab5550ac8022f6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*knhDKMdADBb48OgR"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@dtopkin1?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">戴恩·托普金</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="a933" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于测试软件，缓慢的测试和不存在的测试之间几乎没有区别。有人不知道如何运行的测试和不存在的测试没有区别。而且写一个脆弱的测试比根本不写测试更粗心。好吧，也许这些陈述缺乏某种细微差别，但总的来说，这是高质量测试的三个重要支柱:</p><ul class=""><li id="552b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">测试应该快速运行</li><li id="8b97" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">测试应该是健壮的</li><li id="7be6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">测试应该易于运行</li></ul><h1 id="3a74" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">快的</h1><p id="8664" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">耐心是一种美德，但应该被编纂成法典。</p><p id="83d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">测试<em class="ng">速度</em>是一个相对的术语。例如，提供VM的集成测试几乎肯定会比简单的初始测试花费更长的时间。</p><p id="aaac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">排除禁止性边缘情况，这并不是说前者比后者更差。每项测试都应该以理论上所需的最短时间为基准，并且应该尽最大努力达到这一点。</p><p id="3500" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是一些简单的优化:</p><ul class=""><li id="9211" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">同时运行独立的测试。</li><li id="cd15" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">仅配置所需的内容，例如，Spring Boot测试应该仅配置所需的Beans子集。</li><li id="a771" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">仅当状态变脏时，才重新启动进程并重新初始化对象。</li></ul><h1 id="cd9a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">粗野的</h1><blockquote class="nh"><p id="8bd5" class="ni nj it bd nk nl nm nn no np nq lu dk translated">您应该几乎可以肯定，测试失败是由于您的目标特性的中断。</p></blockquote><p id="ab29" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">脆弱的测试会很快侵蚀信心。脆性试验是一种易受间歇性故障影响的试验。理想情况下，测试失败的唯一原因是你在测试中针对的特性发生了重大变化，比如一段代码。</p><p id="bad2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在实践中，测试不仅会因为目标特性中的突破性变化而失败，还会因为系统环境差异和所需服务的中断以及大量其他原因而失败。</p><p id="5a0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开发人员将不得不质疑每一个失败，并且需要特定的经验来诊断测试失败的原因。在这种情况下，我发现开发人员非常担心脆弱的测试套件，以至于他们选择完全不参与其中。</p><p id="8609" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是一些简单的改进:</p><ul class=""><li id="a187" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">编写逻辑以确保环境为测试做好准备。如果环境没有准备好，那么这个测试应该被跳过而不是失败，并且应该有一个适当的错误消息来描述为什么环境没有准备好。</li><li id="72eb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">避免竞态条件。</li><li id="488d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在测试运行之前，保持警惕并清理现有状态。这种状态可能是由于之前的测试或一些手动干预而变脏的。</li><li id="aef3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">每次测试后，请细心清理脏污的状态。</li></ul><h1 id="3d9c" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">缓解</h1><p id="50b9" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">测试应该将专业知识整理成文，并使其易于传播。</p><p id="5ad0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个伟大的测试将专业知识整理成文，并将其分发给其他人。我的一个同事在一个项目中利用了多数据中心配置中的Consul。当时，他是我们团队中唯一一个有在多个数据中心中引导Consul的经验的人。事实证明，我们不需要学习如何引导Consul，因为他编写了过程并编写了一套优秀的测试。</p><p id="26cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整理专业知识的第二部分是让你的同事随时可以使用它，并确保他们可以轻松地运行它。例如，一个测试套件可能需要Mongo。套件选择使用一些嵌入式Mongo了吗？如果有，安装可靠吗？或者该套件需要一个运行在docker中的真实Mongo实例。你的同事熟悉Docker吗？</p><p id="fca7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">测试依赖、工具和初始设置是不可避免的，这是有原因的——它们为套件提供了动力和能力。关键是应该仔细考虑每个需求，并很好地实现，这样您的套件才不会变得无法运行。</p><h1 id="dd52" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">地鼠茉莉</h1><p id="28d5" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated"><a class="ae ky" href="https://gopher-jasmine.io/" rel="noopener ugc nofollow" target="_blank"> Gopher Jasmine </a>是一个测试框架。511行代码，很容易理解，可以在GitHub <a class="ae ky" href="https://github.com/hyperstripe50/gopher-jasmine" rel="noopener ugc nofollow" target="_blank">这里</a>查看。它受Jasmine的显而易见的语法的启发，因此，测试以类似的格式编写。</p><p id="1b02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看官方网站获得更多详细的例子，并有机会运行自己的Gopher Jasmine测试套件。</p><div class="nw nx gp gr ny nz"><a href="https://gopher-jasmine.io/home" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">地鼠茉莉</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">编辑描述</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">gopher-jasmine.io</p></div></div></div></a></div><p id="fb73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Gopher Jasmine致力于上述三大支柱，即:</p><ul class=""><li id="6cd9" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">测试应该快速运行</li><li id="4bd5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">测试应该是健壮的</li><li id="e600" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">测试应该易于运行</li></ul><p id="77e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个简单的套件如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="cca9" class="ok mk it bd ml ol om dn mp on oo dp mt li op oq mv lm or os mx lq ot ou mz ov bi translated">测试应该快速运行</h2><p id="8eb8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">Gopher Jasmine提供两种类型的套件</p><p id="aa47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 1)顺序:</strong>测试按顺序运行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="509e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2)并发:测试并行运行</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="62ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，由于库是用Golang编写的，所以性能很好。</p><h2 id="ad66" class="ok mk it bd ml ol om dn mp on oo dp mt li op oq mv lm or os mx lq ot ou mz ov bi translated">测试应该是健壮的</h2><p id="72a2" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">Gopher Jasmine为测试的设置和拆卸提供了入口点。</p><ul class=""><li id="cc5b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe ow ox oy oz b">BeforeAll</code>:在整个套件之前执行一次逻辑。</li><li id="5cb1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe ow ox oy oz b">BeforeEach</code>:每次测试前执行逻辑。</li><li id="2a14" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe ow ox oy oz b">AfterAll</code>:在整个组曲之后执行一次逻辑。</li><li id="b0f4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe ow ox oy oz b">AfterEach</code>:每次测试后执行逻辑。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="918d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这些入口点，您可以确保您的测试已经准备好运行，并在完成时被清理。这些入口点中的任何失败都很容易被识别为设置和清理中的失败，而不是测试本身的失败。</p><h2 id="7a16" class="ok mk it bd ml ol om dn mp on oo dp mt li op oq mv lm or os mx lq ot ou mz ov bi translated">测试应该易于运行</h2><p id="e60d" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">还有很多类似的更强大的框架，比如<a class="ae ky" href="https://agouti.org/" rel="noopener ugc nofollow" target="_blank"> Agouti </a>。Gopher Jasmine不打算替代这些框架。相反，Gopher Jasmine提供了一个微妙但有用的特性:</p><p id="ad9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在运行时运行测试套件的能力。</p><p id="a3f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该框架本质上允许您通过API公开单元/验收测试，这使得运行测试变得非常容易。我最喜欢的一个野外运行时测试方法的例子是我的三星电视。只需点击一个按钮，我就可以运行一套测试来检查网络连接，即使我不知道在引擎盖下发生了什么。</p><p id="c215" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">测试套件的API可以用一行代码创建。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="77bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第14行将引导一个服务器并公开端口<code class="fe ow ox oy oz b">9091</code>。本地或远程托管此API，并使用客户端来触发套件。例如，如果您在本地运行它，您可以通过以下调用来触发<code class="fe ow ox oy oz b">regression suite</code>:</p><pre class="kj kk kl km gt pa oz pb pc aw pd bi"><span id="043a" class="ok mk it oz b gy pe pf l pg ph">$ curl <a class="ae ky" href="http://localhost:9091/parent-suite" rel="noopener ugc nofollow" target="_blank">http://localhost:9091/regression-suite</a></span></pre><p id="5c2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/58bf0f001eb671ac71dceb4112b6b0d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zdGycvlkq8Yewobgr3RWZA.png"/></div></div></figure><h1 id="86a6" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">在野外使用地鼠茉莉</h1><p id="8b78" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我成功地将Gopher Jasmine与CICD管道结合在一起。假设您的任务是开发一个HTTP API，使用GitLab管道进行构建和部署。在部署了任何HTTP API更改之后，运行验收测试来验证它们是非常有用的。管道示例如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/5425f0fc0e285cd25091164274db56b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Pb5H47aDnZvWcdsSau3aw.png"/></div></div></figure><p id="ad2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在管道中配置一个作业，用<em class="ng"> cURL触发Gopher Jasmine回归套件。</em>检查响应的顶层输出，如果<code class="fe ow ox oy oz b">total_skipped</code>或<code class="fe ow ox oy oz b">total_failed</code>不为零，则作业失败。</p></div></div>    
</body>
</html>