<html>
<head>
<title>Stand Up a Node.js REST API in Just 9 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">仅用9分钟就建立了一个Node.js REST API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/stand-up-a-node-js-rest-api-in-just-9-minutes-1a1f60fe5fc2?source=collection_archive---------9-----------------------#2020-01-29">https://betterprogramming.pub/stand-up-a-node-js-rest-api-in-just-9-minutes-1a1f60fe5fc2?source=collection_archive---------9-----------------------#2020-01-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c17c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">现在，在您的REST API中快速包含CRUD操作、错误处理、排序和过滤</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dffc9b39bd2bc234df5af37905b44426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tQbrVx_t3a-YO0tb3OuOZQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://www.pexels.com/photo/man-wearing-white-sweater-and-black-shorts-about-to-run-936094/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">像素</a>的<a class="ae ky" href="https://www.pexels.com/@nappy?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">尿布</a>的照片</p></figure><p id="6e9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我会尽量让事情变得简单。我花了大量时间试图找到一个简单、可行、易于理解的REST API示例，在Node.js中执行CRUD操作、错误处理、排序和过滤，但是没有成功。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9a17" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">环境设置</h1><p id="bb47" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">好了，我们开始吧！首先，让我解释一下我们将使用的工具:</p><ul class=""><li id="89a7" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">Node.js</code> —一个开源的JavaScript运行时环境，允许你在浏览器之外运行代码。我们将在Node.js服务器上用JavaScript开发RESTful API</li><li id="1bcd" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">MongoDB </code> —我们将向其中写入数据的数据库</li><li id="52e8" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">Postman</code> —我们将用来测试我们的API的工具</li><li id="15b7" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">VSCode</code> —你可以使用任何你想要的文本编辑器，但我会使用它，因为它是我的最爱</li></ul><p id="ab5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您还没有设置这些工具，我已经创建了一个附带的片段来引导您完成这些步骤:<a class="ae ky" href="https://medium.com/better-programming/my-node-js-mongodb-atlas-rest-api-environment-setup-71923cfbc98c" rel="noopener"> Node.js REST API环境设置</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e635" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">目录</h1><p id="7d6d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">今天我们将解决创建REST API的所有基础问题。这些基本要素包括:</p><ul class=""><li id="7acf" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><a class="ae ky" href="#eb22" rel="noopener ugc nofollow">REST API概述/介绍</a></li><li id="e314" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><a class="ae ky" href="#4553" rel="noopener ugc nofollow">请求</a></li><li id="7f64" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><a class="ae ky" href="#2448" rel="noopener ugc nofollow">积垢操作</a></li><li id="4104" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><a class="ae ky" href="#1730" rel="noopener ugc nofollow">错误处理</a></li><li id="bea5" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><a class="ae ky" href="#c2c2" rel="noopener ugc nofollow">排序</a></li><li id="3c8e" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><a class="ae ky" href="#d948" rel="noopener ugc nofollow">过滤</a></li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eb22" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">REST API简介</h1><p id="1ed0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在当今的技术世界里，你到处都听说过REST API，但是它是什么呢？首先，API代表<strong class="lb iu">应用编程接口。</strong></p><p id="6433" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">API的意义是什么？它允许两个软件互相交流。有许多类型的API——SOAP、XML-RPC、JSON-RPC——但是今天我们将讨论REST。</p><p id="b07a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">什么是休息？它代表代表性的状态转移。这是一种用于创建web服务的软件架构风格。REST使得计算机系统通过互联网互相通信变得很容易。</p><p id="cacc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它是如何工作的？这和你在Google中输入“rest api”并返回搜索结果非常相似。在最高级别，客户端以URL的形式向服务器发出请求，请求一些数据。下面是一个谷歌搜索“rest API”的例子:</p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="860b" class="nv md it nl b gy nw nx l ny nz"><a class="ae ky" href="http://www.google.com/search?q=rest+api)." rel="noopener ugc nofollow" target="_blank">www.google.com/search?q=rest+api</a></span></pre><p id="5a15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，服务器通过HTTP协议用数据(响应)进行响应。这些数据出现在JSON符号中，并在您的浏览器中转换成美观的视觉效果——您的google搜索结果。</p><p id="4830" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，您以URL的形式发送请求，并以数据的形式接收响应。</p><p id="81a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些数据通常是如何接收的？JSON (Javascript Object Notation)用键值对来描述数据。JSON使得机器和人类读取数据变得容易。</p><p id="dec6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们更深入地研究一下请求。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4553" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">要求</h1><p id="dd5a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，理解请求由四部分组成是很重要的。</p><ul class=""><li id="03f3" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><strong class="lb iu">端点<em class="oa"> — </em> </strong>您请求的URL。通常由一个根<strong class="lb iu">和一个路径<strong class="lb iu">组成。</strong>例如<a class="ae ky" href="https://www.google.com/search?q=rest+api" rel="noopener ugc nofollow" target="_blank">https://www.google.com/search?q=rest+api</a>，其中根是https://www.google.com，路径是/search？q=rest+api。以下是更多相关信息。</strong></li><li id="a3b0" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><strong class="lb iu">方法— <em class="oa"> </em> </strong>你发送给服务器的请求类型，或者“HTTP动词”。这就是我们能够执行CRUD(创建、读取、更新或删除)操作的方式。这五种类型分别是<code class="fe ni nj nk nl b">GET</code>、<code class="fe ni nj nk nl b">POST</code>、<code class="fe ni nj nk nl b">PUT</code>、<code class="fe ni nj nk nl b">PATCH</code>和<code class="fe ni nj nk nl b">DELETE</code>。</li><li id="9ab7" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><strong class="lb iu">Headers<em class="oa"/>—<em class="oa"/></strong>可以发送到客户端或服务器的附加信息，用于以某种方式辅助您的数据。例如，它可以用来验证用户，以便可以查看数据。或者它可以告诉你应该如何接收数据(application/JSON)。</li><li id="6441" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><strong class="lb iu">Data(body)——</strong>我们希望从我们的请求中接收到的作为JSON的信息。</li></ul><p id="c490" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多关于<strong class="lb iu">端点</strong>的信息:我们将会经常处理这些字符串，所以理解它们很重要。以下是您可能在端点中看到的内容:</p><ul class=""><li id="3ddf" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><strong class="lb iu">冒号(</strong> <code class="fe ni nj nk nl b">:</code> <strong class="lb iu"> ) — </strong>用来表示字符串中的变量。在API文档中，你会看到带有<code class="fe ni nj nk nl b">:username</code>(或者类似的东西)的端点。只要知道当你测试它的时候，你应该用一个真实的用户名替换那个<code class="fe ni nj nk nl b">username</code>。假媒体端点的示例:</li></ul><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="285d" class="nv md it nl b gy nw nx l ny nz">medium.com/users/<strong class="nl iu">:username</strong>/articles <br/>to <br/>medium.com/users/<strong class="nl iu">ryangleason82</strong>/articles</span></pre><ul class=""><li id="8197" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><strong class="lb iu">问号(</strong> <code class="fe ni nj nk nl b">?</code> <strong class="lb iu"> ) — </strong>开始查询参数。<strong class="lb iu"> </strong>查询参数是一组键值对，可用于修改您的请求。以下是一个媒体端点的示例，我希望在其中看到我的文章，以及它们是否已发表:</li></ul><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="d976" class="nv md it nl b gy nw nx l ny nz">medium.com/users/:username/articles<strong class="nl iu">?query=value</strong><br/>medium.com/users/ryangleason82/articles<strong class="nl iu">?published=true</strong></span></pre><ul class=""><li id="2b34" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><strong class="lb iu">与号(</strong> <code class="fe ni nj nk nl b"><strong class="lb iu">&amp;</strong></code> <strong class="lb iu"> ) — </strong>当你想使用多个时用来分隔查询参数。例如，我们可以看到我发表的文章和今天张贴的<strong class="lb iu"> </strong>。</li></ul><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="89f9" class="nv md it nl b gy nw nx l ny nz">medium.com/users/:username/articles?query=value<strong class="nl iu">&amp;query2=value2</strong><br/>medium.com/users/ryangleason82/articles?published=true<strong class="nl iu">&amp;date=today</strong></span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="2620" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">概念上的东西已经说得够多了，让我们深入编码吧！我将首先向您展示创建REST API的基础。它将由四部分组成:</p><ul class=""><li id="eabe" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><strong class="lb iu">服务器— </strong>用于建立我们需要的所有连接，以及定义端点、端口和路由等重要信息。</li><li id="7ce7" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><strong class="lb iu">模型— </strong>我们的数据是什么样的？</li><li id="9be8" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><strong class="lb iu">路线— </strong>我们的终点在哪里？</li><li id="da8a" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><strong class="lb iu">控制器— </strong>我们的端点做什么？</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2448" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置我们的服务器</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">server.js</p></figure><p id="0525" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我解释一下这里发生了什么:</p><ul class=""><li id="07a7" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">Express </code>—<code class="fe ni nj nk nl b">Node.js</code>的web应用框架。这将启动一个服务器并监听端口3000上的连接。</li><li id="0274" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">Mongoose</code>—协助我们为MongoDB进行对象建模。它有助于管理数据之间的关系，验证模式，并且在从Node.js到MongoDB的通信中非常有用。</li><li id="809a" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">bodyParser</code>—需要解释请求。工作方式是提取传入请求的主体部分，并将其公开为<code class="fe ni nj nk nl b">req.body</code> <strong class="lb iu"> </strong>和JSON。</li><li id="205c" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">Entry</code>—这是我们模式的名称。我们需要将它包含在我们的server.js中，因为必须为我们使用的每个模型“注册”模式。</li><li id="8e70" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">mongoose.connect(uri string, {options})</code> —与我们的MongoDB Atlas数据库建立连接。我们设置这些选项来消除弃用警告。</li><li id="983d" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">routes(app):</code> —定义应用程序的端点将如何响应客户端请求。这将指向我们自己定义的路线。</li></ul><p id="625d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们将创建我们的模型、路线和控制器。这是我的项目目录结构的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/4f00ab4850ce16eb316e176dddfd170e.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*PCL5dQKZhtE_N98U5AaPgg.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="20cd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建模型</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">leaderboardModel.js</p></figure><p id="68c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经创建了一个基本模型，只包含三个字段。理解我们使用的是Mongoose模式是很重要的。每个模式映射到一个MongoDB集合，并定义该集合中的文档结构。然后你会看到最后我们正在导出我们的模式，名为<code class="fe ni nj nk nl b">Entry</code>，并把它暴露给应用程序的其余部分。</p><p id="df41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个<code class="fe ni nj nk nl b">Entry</code>将在我们的排行榜中代表一个不同的记录，其中一个<code class="fe ni nj nk nl b">Entry</code>是玩家姓名、分数以及他们是否注册。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bc6f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">定义我们的路线</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">leaderboardRoutes.js</p></figure><p id="c9fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">路由将定义当用户点击我们的一个端点时会发生什么。这也是我们如何确定使用哪个CRUD操作与数据库中的数据进行交互。</p><ul class=""><li id="996d" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">创建一个条目</li><li id="ddde" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">GET</code> — <strong class="lb iu"> R </strong>读一个条目</li><li id="46e1" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">PUT</code> — <strong class="lb iu"> U </strong>更新条目</li><li id="7e18" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">DELETE</code> — <strong class="lb iu"> D </strong>删除条目</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1230" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">构建控制器</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的控制者</p></figure><p id="d45a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们有逻辑。当我们的路线被攻击时会发生什么。这是一个功能完整的API所需要的最低要求。这些方法中的每一种都对应一条路线，您会注意到所有的名称都与路线相同。</p><p id="4bcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些方法中的每一个都接受两个参数:请求和响应(<code class="fe ni nj nk nl b">req</code>、<code class="fe ni nj nk nl b">res</code>)。然后，我们使用与我们试图实现的操作相一致的Mongoose方法。例如，对于一个<code class="fe ni nj nk nl b">GET</code>请求，我们希望找到所有的文档，并将它们作为一个响应JSON对象返回。为此，我们使用<code class="fe ni nj nk nl b">find()</code>方法。</p><p id="e969" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样的道理也适用于<code class="fe ni nj nk nl b">POST</code>。我们想要创建一个记录，所以我们使用Mongoose方法<code class="fe ni nj nk nl b">save()</code>将该记录写入数据库。</p><p id="3fdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">检查点</strong>:为了确保我们正确地写入数据库，让我们在Postman中执行一个<code class="fe ni nj nk nl b">POST</code>请求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/e09c54eb964f32a5c99f6e2fa114b51b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*EYQjsdYjwlWMzwRD3lkL8w.png"/></div></figure><p id="8289" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我的<code class="fe ni nj nk nl b">POST</code>请求发送到<code class="fe ni nj nk nl b">localhost:3000/entries</code>的样子。这是你点击发送按钮后得到的回应:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/d856423aa635e672412eb13c9f234c1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*vzMBX-R57XpXTNmcgv2wgg.png"/></div></figure><p id="1e46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对<code class="fe ni nj nk nl b">localhost:3000/entries</code>的<code class="fe ni nj nk nl b">GET</code>请求将接收我们数据库中的所有文档作为响应。</p><p id="bf5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对<code class="fe ni nj nk nl b">localhost:3000/entries/:entryId</code>(上面的例子:<code class="fe ni nj nk nl b">localhost:3000/entries/5e3022ecbf5a6646209325b2</code>)的<code class="fe ni nj nk nl b">GET</code>请求将只返回一条记录。</p><p id="a1b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发送到<code class="fe ni nj nk nl b">localhost:3000/entries/:entryId</code> <strong class="lb iu"> </strong>的<code class="fe ni nj nk nl b">PUT </code>请求将使用您在主体中放置的内容更新条目。</p><p id="bc2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发送到<code class="fe ni nj nk nl b">localhost:3000/entries/:entryId</code> <strong class="lb iu"> </strong>的<code class="fe ni nj nk nl b">DELETE</code>请求将删除指定的条目。</p><p id="9410" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想你明白了。这里面缺了什么？适当的错误处理。由于我们要求玩家和分数字段，如果这两个字段中有一个没有输入，那么响应将是错误的。我们需要一种优雅的方式来处理这件事。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1730" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">错误处理</h1><p id="94d8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于REST API的错误处理，我们将使用try-catch语句。我们将“尝试”发出请求，如果失败，我们将“捕捉”错误。这是一种优雅地处理错误的方式。以下是创建API请求时可能会发现的错误类型:</p><ul class=""><li id="8a58" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">100 level (informational)</code> —服务器确认请求。</li><li id="c7b7" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">200 level (Successful)</code> —服务器完成了请求。</li><li id="847c" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">300 level (Redirect)</code> —客户端需要做更多来完成请求。</li><li id="e452" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">400 level (Client Error)</code>—客户端发送了无效请求。</li><li id="2cf3" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">500 level (Server Error)</code> —由于服务器错误，服务器无法完成请求。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="d715" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">检查点:</strong>让我们<strong class="lb iu"> </strong>发送一个错误请求，这样我们可以看看我们的错误处理是否有效。我将在错误处理之前和之后发布，这样您就可以看到不同之处。</p><p id="87ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在请求中，我将删除player字段。这将触发一个错误，因为它是必填字段:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/775d85da903c90e2a37bb5a429f77406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*ZipeP9FCEoTRnfD-rNtCtg.png"/></div></figure><p id="a4e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">错误处理前:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/8766eec14f48d3fe3f7422c343816349.png" data-original-src="https://miro.medium.com/v2/resize:fit:558/format:webp/1*m5hjtTlYeU1Ii447Ipz2dA.png"/></div></figure><p id="bf9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ni nj nk nl b">Postman</code>中，在添加错误处理之前，服务器会一直尝试发送请求。它没有任何东西可以捕捉错误，所以它最终会超时，而你也不知道你的请求有什么问题。</p><p id="7388" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的控制台中，您只会看到以下混乱的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/7284771d3baac4f3c9ab861022d04982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A8RGdJ9j4fUIDq8eSKgkGQ.png"/></div></div></figure><p id="d498" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是当我们添加错误处理时，我们得到的只是这个简单的响应:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/a75a5bf97d342c4265956d9db55bcfa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*4h6QafZvNjV-y0UtdbuVdw.png"/></div></figure><p id="cdb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好多了！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c2c2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">整理</h1><p id="a585" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">由于这是一个排行榜，我们希望按分数降序排列。我们从URL字符串中取出排序参数，检查它是否为真，然后执行一个简单的排序。</p><p id="0f3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们只需要更新我们的<code class="fe ni nj nk nl b">read_entries</code>方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="5497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们从URL查询字符串中取出<code class="fe ni nj nk nl b">sort</code>变量。我们访问它的方式是<code class="fe ni nj nk nl b">req.query.sort</code>。</p><p id="8ee3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">检查点:</strong>在排序之前，当执行<code class="fe ni nj nk nl b">GET</code>请求时，我们的输出应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/794274591a16b4a89e4adc1d97bc0e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*AS6I-HHbrX7kyCcqmGiosQ.png"/></div></figure><p id="9c98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<code class="fe ni nj nk nl b">sort=true</code>添加到我们的端点后:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/c6e2e8aeb201d4d61fae26b864018fea.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*n4FSQ38_UH3wgxba7xUWgw.png"/></div></figure><p id="3942" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/daae97e373b9852a7d4adb8889e929f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*OrHCv7X16WS7RNK18vT2KA.png"/></div></figure><p id="2ca1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">已经按降序排序了！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d948" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">过滤</h1><p id="416e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们现在只想显示注册的条目。我们如何做到这一点？通过添加过滤器。同样，为了简单起见，我们将只修改<code class="fe ni nj nk nl b">read_entries</code>方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="60f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们从URL中取出注册变量，如果它等于“是”，那么我们过滤掉所有未注册的条目。</p><p id="b8c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">检查点:</strong>在添加过滤器之前，<code class="fe ni nj nk nl b">GET</code>请求的结果将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/daae97e373b9852a7d4adb8889e929f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*OrHCv7X16WS7RNK18vT2KA.png"/></div></figure><p id="d8f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<code class="fe ni nj nk nl b">registered=yes</code>添加到端点后:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/9547e40926d24b8fe3438af5e0a368a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*fjWGtmFc9iH3ayAJ_ZUmOg.png"/></div></figure><p id="dac6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">响应应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/61006a89b26daa8b7274e1e3e0429d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*qiej1Aaq-AV1unE0tDmLTg.png"/></div></figure><p id="0154" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！您已经成功地从后端过滤了您的数据。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="32b7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">回顾</h1><p id="7ffb" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本教程中，您学习了如何成功地:</p><ul class=""><li id="e23b" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">创建一个REST服务器</li><li id="cd46" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated">执行CRUD操作</li><li id="3f07" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated">优雅地处理错误</li><li id="5879" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated">使用查询参数对数据进行排序</li><li id="a17d" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated">使用查询参数过滤数据</li></ul><p id="aede" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这有所帮助！如果您有任何问题、意见或顾虑，请随时联系我们。</p></div></div>    
</body>
</html>