<html>
<head>
<title>How To Calibrate a Camera Using Python And OpenCV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python和OpenCV校准相机</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-calibrate-a-camera-using-python-and-opencv-23bab86ca194?source=collection_archive---------4-----------------------#2022-08-24">https://betterprogramming.pub/how-to-calibrate-a-camera-using-python-and-opencv-23bab86ca194?source=collection_archive---------4-----------------------#2022-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="56fd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在本文中，我们将看看如何使用Python和OpenCV来确定单目摄像机的摄像机矩阵和失真系数，以获得无失真的图像。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a243847b57966b698adb4f61e05f8ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wlveL3C-F6gkK6X-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@patuphotos?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">帕特里克</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="fd7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将使用单筒相机拍摄一些照片——在我的情况下，这是我的网络摄像头。这些图片将包含一个不同位置和姿态的棋盘。</p><p id="4dab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，一个校准程序将获取这些图像，提取这些棋盘上的角，并使用它们来确定我们相机的失真系数和内在属性。输出将保存在一个JSON文件中。</p><p id="6317" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们将从JSON文件中加载相机矩阵和失真系数，并使用它们来消除原始棋盘图像的失真。</p><p id="1fe6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下文档是我最近出于好奇进行的一些实验的结果。</p><h1 id="e84c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用相机拍照</h1><p id="70f4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，让我们用相机拍一些照片。在我的情况下，这是一个罗技C270高清网络摄像头。</p><p id="b37d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有无数种方法可以做到这一点。我是这样做的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="6f15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们首先从我们的相机打开一个视频流。<code class="fe mu mv mw mx b">src=0</code>表示我们将使用源0处的摄像机。如果您安装了多台摄像机，则信号源可能会有所不同。</p><p id="ed69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们使用无限循环继续从视频流中读取图像帧。我们刚刚读取的画面显示在我们的屏幕上，看看我们的摄像机看到了什么。</p><p id="1de0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们听两次按键。如果按下<code class="fe mu mv mw mx b">q</code>键，程序退出，如果按下<code class="fe mu mv mw mx b">c</code>键，则当前图像帧被保存到文件中。</p><p id="c12c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个程序，我们将在框架内以不同的位置和姿态拍摄一些(在我的例子中是16张)棋盘的图像。如果你需要一个棋盘图案的生成器，那么你可以<a class="ae ky" href="https://calib.io/pages/camera-calibration-pattern-generator" rel="noopener ugc nofollow" target="_blank">到这里</a>选择“棋盘”作为“目标类型”</p><p id="418b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生成的图像看起来如下所示:</p><div class="kj kk kl km gt ab cb"><figure class="my kn mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/ebc3a4c21cbc8b9d108a3b104bea59ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*qnRXTxWHVsZ0Bv6c7YTa8w.png"/></div></figure><figure class="my kn mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/3c30124c4dd7f377d017dee0b64e800f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*XsulNNIAqYirInYTmc49Lg.png"/></div></figure></div><div class="ab cb"><figure class="my kn mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/70758732e7c010153248c83dbf4bbf66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*zo82ctOaVKvBSjW6PdA_Jg.png"/></div></figure><figure class="my kn mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/d9c118b8caed7fa593f35433817bf2bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*2Kz6wKR6j75P9_tqI-tZLg.png"/></div></figure></div><h1 id="8af5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">计算相机矩阵和失真系数</h1><p id="bd06" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在我们有了一堆棋盘的图片，我们可以使用下面的程序提取相机矩阵<code class="fe mu mv mw mx b">mtx</code>和失真系数<code class="fe mu mv mw mx b">dist</code>。相机矩阵和失真系数将被保存到一个JSON文件中。像这样，我们可以快速地将它们加载到其他需要来自网络摄像头的不失真图像的程序中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="e488" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保行数和列数比棋盘上的实际行数和列数少一。这样做的原因是该算法将在棋盘上寻找内角，而不是外角。在我们的棋盘上，我们有6行8列，所以我们写5行7列。</p><p id="57ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一些数组来存储棋盘上所有图像的目标点和图像点。</p><p id="f712" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从当前目录中获取所有校准PNG图像的文件名。</p><p id="eab0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于每个PNG文件名，加载图像并将其转换为灰度。</p><p id="d140" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">棋盘标志引导搜索棋盘角的算法。您也可以将标志设置为<code class="fe mu mv mw mx b">None</code>。接下来使用<code class="fe mu mv mw mx b">findChessboardCorners()</code>尝试找到棋盘的角落。你可以在这里找到关于功能和标志<a class="ae ky" href="https://docs.opencv.org/4.x/d9/d0c/group__calib3d.html#ga93efa9b0aa890de240ca32b11253dd4a" rel="noopener ugc nofollow" target="_blank">的更多信息。</a></p><p id="546c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每次寻找棋盘上所有角点的算法成功后，我们会将角点和空的3D对象点添加到两个数组中，我们还会使用<code class="fe mu mv mw mx b">cornerSubPix()</code>来细化角点位置。点击阅读更多关于此功能及其标准的信息<a class="ae ky" href="https://docs.opencv.org/4.x/dd/d1a/group__imgproc__feature.html#ga354e0d7c86d0d9da75de9b9701a9a87e" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="0f11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们将画出在图像上发现的角，并将该图像输出到屏幕上的一个窗口和一个PNG文件中。</p><p id="6df2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦每个校准图像都处理完毕，我们就可以使用保存为<code class="fe mu mv mw mx b">imgpoints</code>的角点，通过功能<code class="fe mu mv mw mx b">calibrateCamera()</code>校准摄像机。</p><p id="74a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们继续将这个函数返回的所有变量保存在一个JSON文件中。假设一些变量是NumPy数组，我们需要通过编码器运行这些变量，将它们保存为列表。</p><div class="kj kk kl km gt ab cb"><figure class="my kn mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/0e10807b062a3c64727adc3faeb6481c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*YtB9jBFkv1_ytgSM5BBzzw.png"/></div></figure><figure class="my kn mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/f88130f90695cfb2b0162d3497488909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*fdD1NixVm2Kllhe9WbLbIw.png"/></div></figure></div><div class="ab cb"><figure class="my kn mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/30841d1ee130abc45797df1726547199.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*wbRz6N0XBQryxI2lq4wp2w.png"/></div></figure><figure class="my kn mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/1ae1a0ce7c96252b628d5c4d5e5630ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*FoY3mdB22VQrNKhE93ZetA.png"/></div></figure></div><h1 id="9aa5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">示例使用案例</h1><p id="1334" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">让我们尝试使用保存在JSON文件中的相机矩阵和失真系数。在这里，我们将加载我们的原始棋盘图像，并不失真。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="e6a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们打开JSON文件并检索距离系数<code class="fe mu mv mw mx b">dist</code>和相机矩阵<code class="fe mu mv mw mx b">mtx</code>。然后我们使用<code class="fe mu mv mw mx b">glob</code>来查找所有以‘calibrate’开头并带有‘的文件名。' png '扩展名。</p><p id="cbb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">获取第一个图像以确定所有图像的大小(高度<code class="fe mu mv mw mx b">h</code>和宽度<code class="fe mu mv mw mx b">w</code>)——假设它们都具有相同的尺寸。</p><p id="df19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，计算特定尺寸图像和感兴趣区域<code class="fe mu mv mw mx b">roi</code>的特定摄像机矩阵<code class="fe mu mv mw mx b">newcameramtx</code>。</p><p id="54e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我们找到的每个文件名，从该文件中读取图像，并将图像解压缩到一个名为<code class="fe mu mv mw mx b">dst</code>的新图像中。在这里，我已经注释掉了根据感兴趣的区域对图像的裁剪。</p><p id="ed38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，显示我们刚刚未失真的图像，并保存它。</p><p id="228e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面，你可以看到这样的图像的几个例子。</p><div class="kj kk kl km gt ab cb"><figure class="my kn mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/3acd975d13c5db835b862904300280cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*rMkpq99A44GW0jCWR-tdtg.png"/></div></figure><figure class="my kn mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/c26df5998e53da2789c7bd28c004d220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*MSW7kdpo19sVcIG1IdH8IA.png"/></div></figure></div><p id="101e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当将这些图像与原件进行比较时，它们似乎非常接近。这让我怀疑Logitec设备驱动程序可能对网络摄像头图像做了一些不失真的处理——开箱即用。</p><h1 id="b223" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考</h1><ul class=""><li id="fa04" class="ne nf it lb b lc mn lf mo li ng lm nh lq ni lu nj nk nl nm bi translated"><a class="ae ky" href="https://riptutorial.com/opencv/example/21401/get-image-from-webcam" rel="noopener ugc nofollow" target="_blank">“从网络摄像头获取图像”Rip教程</a></li><li id="bb99" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated"><a class="ae ky" href="https://docs.opencv.org/4.5.3/dc/dbb/tutorial_py_calibration.html" rel="noopener ugc nofollow" target="_blank"/>OpenCV的“摄像机校准”</li><li id="6aec" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated"><a class="ae ky" href="https://stackoverflow.com/questions/26646362/numpy-array-is-not-json-serializable" rel="noopener ugc nofollow" target="_blank">“NumPy数组不是JSON可序列化的”在Stackoverflow上</a></li><li id="8d50" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated"><a class="ae ky" href="https://www.freecodecamp.org/news/python-read-json-file-how-to-load-json-from-a-file-and-parse-dumps/" rel="noopener ugc nofollow" target="_blank">“Python读取JSON文件——如何从文件加载JSON并解析转储”来自freeCodeCamp </a></li><li id="0a1a" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated"><a class="ae ky" href="https://calib.io/pages/camera-calibration-pattern-generator" rel="noopener ugc nofollow" target="_blank">calib . io的“模式生成器”</a></li></ul></div></div>    
</body>
</html>