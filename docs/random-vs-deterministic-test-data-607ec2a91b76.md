# 随机与确定性测试数据

> 原文：<https://betterprogramming.pub/random-vs-deterministic-test-data-607ec2a91b76>

## 你应该在什么时候使用哪一种？

![](img/2458e500c6e754971814e5a923eff640.png)

迪伦·诺尔特在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

今天，我和一位同事讨论了将你的测试数据随机化的好处，他指出，这样做，测试不再是确定性的，也就是说，它们有时可能会失败。

我来讲一个简单的例子。看一下下面的代码:

如果可以的话，应该为每个提供的文档调用一次`saveAll`，`fileService.save`。

因为“文档”的长度是随机的，所以测试是不确定的。

当数组中正好有三个文档时，如果我的逻辑中的一个错误导致了一个错误，该怎么办？这意味着有时测试会失败，有时会通过。我的同事指出了这一点，他是绝对正确的。

你应该为每种情况写一个测试吗？

假设服务可以拥有最大数量的文档(假设 20 个)，这仍然意味着您需要 20 个测试来覆盖每个案例。

最大 100 怎么办？你应该做 100 次测试吗？或者，你写一个 1 人的测试和一个 100 人的测试，假设中间的一切都可以工作？

如果正好有 50 个文档时失败了怎么办？如果我用随机数据运行测试，我没有测试每个组合，所以错误可能会漏网。

我的同事认为复制测试很便宜，我甚至可以写一个循环来运行测试 *n* 次，以确保我覆盖了所有可能发生的情况。对于这位同事，如果我把论点过于简单化了，我很抱歉。

但是，这真的是最好的答案吗？我应该停在哪里？我还应该对文档本身进行随机化吗？

如果是这样，我仍然在我的测试中引入了一个不确定的元素，每当文档标题包含一个 6，或者文档大小是一个质数时，这都会导致失败…

当然，我是轻率的。这样的错误永远不会真的出现。对吗？好吧，祝你好运为这样的 bug 编写一堆测试用例。

但是测试的目的是测试“足够”给你对代码的信心。

如果 1000 个确定性的几乎相同的测试为你做到了这一点而没有让你发疯，那么就去做吧。然而，我将继续在有意义的地方随机化我的测试数据，然后调用边缘案例。

# 哪里不使用随机数据？

简而言之，如果随机测试数据要求我在测试中重复已经在我的实现中的逻辑，我会避免随机测试数据。

例如，如果我想通过随机化两个数字并将它们传递给`add`方法来测试一个计算器类，我不会随机化这些数字。

为什么？因为要断言结果是正确的，我必须将它们相加，这正是`add`方法所做的。

因此，相反，我会自己确定答案，然后断言(1 +1) = 2，而不是断言“数字 1+数字 2 =数字 1+数字 2”。

# 结论

编写足够多的测试来给你对代码的信心。明智一点——你不需要测试每一种组合。

如果你真的担心某个边缘情况会破坏东西，那么为那个情况写一个测试。如果您认为有一大堆这样的边缘情况，那么为所有这些情况编写一个测试。

如果你认为有无限多的边缘情况，那么你的代码就有严重的问题。