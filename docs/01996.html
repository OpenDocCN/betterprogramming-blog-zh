<html>
<head>
<title>Building a Music Game in JavaScript: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript构建音乐游戏:第1部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-a-beatbox-game-in-javascript-bd9c2d06e1b2?source=collection_archive---------10-----------------------#2019-10-29">https://betterprogramming.pub/building-a-beatbox-game-in-javascript-bd9c2d06e1b2?source=collection_archive---------10-----------------------#2019-10-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ac44" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建具有<audio>和异步功能的基本节拍制作工具</audio></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/41ab9bd1a0f83c2989f41b244a2ab5e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zhrrdq2m9QKxVVUEzIDmNg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@rexcuando?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">埃里克·诺帕宁</a>在<a class="ae ky" href="https://unsplash.com/s/photos/music?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="cf5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我在Ironhack的第一个项目，我必须在四天内构建一个迷你游戏。我选择使用DOM操作和HTML audio元素来构建一个4x6的pad，其中4列是“节拍时间”, 6行是可以在这些时间播放的不同声音。</p><p id="5238" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了增加趣味性，玩家必须听到一种节奏，然后在有限的时间内再现出来以得分。</p><p id="e5d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GitHub 上有完整的代码<a class="ae ky" href="https://github.com/iourisorokine/The-Beat-Battle" rel="noopener ugc nofollow" target="_blank">。这是一个无框架的应用，只使用了普通的JavaScript来构建。最终结果如下所示:</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/32663e1c73ef9fe2d060c6b4831abdde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1D1esU8_bB78MW-ibfJ_wg.png"/></div></div></figure><p id="daf7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将去掉游戏中所有真正让它成为游戏的部分(分数、听音和重复、计时器)，并专注于左侧可以看到的beat-maker组件。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="b00b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">灵感</h1><p id="0c1c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我从跟随Dev Ed的<a class="ae ky" href="http://appsbuilders.org/guides/build-a-music-app-with-javascript-tutorial/" rel="noopener ugc nofollow" target="_blank">音乐机器</a>教程开始(Wes Bos的<a class="ae ky" href="https://www.youtube.com/watch?v=VuN8qwZoego" rel="noopener ugc nofollow" target="_blank">鼓机</a>教程也是这方面的推荐资源)。</p><p id="b23c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们创建一组按钮，在“播放”按钮打开时进行迭代，而不是在点击/按下按钮时播放音符。为此，我们将需要JS文件中的几个循环，然后将它们连接到我们的DOM元素。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="e19c" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">导入声音</h1><p id="1684" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">声音从波形文件加载到HTML，如下例所示:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="c4a2" class="nf me it nb b gy ng nh l ni nj">&lt;div class="note-def"&gt;              Kick              <br/>&lt;audio class="sound" src="assets/sounds/kit1/kick2.wav"&gt;&lt;/audio&gt;            &lt;/div&gt;</span></pre><p id="3c4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">共有六个，我们将把它们加载到JS文件中:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="1434" class="nf me it nb b gy ng nh l ni nj">const soundsArr = document.querySelectorAll(“.sound”);</span></pre><p id="9baa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果是一个包含六个元素的数组。我可以通过调用相应元素上的<code class="fe nk nl nm nb b">.play()</code>方法来播放它们，例如:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="0c1b" class="nf me it nb b gy ng nh l ni nj">soundsArr[1].play()</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="dc24" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">通过一系列声音同步迭代</h1><p id="fea9" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果我们提供一个包含六个布尔的数组来迭代，我们可以管理包含六个声音的数组，并播放接收到一个<code class="fe nk nl nm nb b">true</code>值的声音:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="58cd" class="nf me it nb b gy ng nh l ni nj">const beatArr = [true, false, true, false, false, false]</span><span id="5e34" class="nf me it nb b gy nn nh l ni nj">playBeat=(soundsArr, beatArr)=&gt;{<br/>   beatArr.forEach((s, i) =&gt; {    <br/>      if (s) {           <br/>         soundsArr[i].play();    <br/>      }  <br/>   });<br/>}</span><span id="14d6" class="nf me it nb b gy nn nh l ni nj">playBeat()</span></pre><p id="0b1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们倾向于认为:“但是循环一个接一个地遍历声音，它应该如何工作呢？”</p><p id="ea58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在迷你游戏的规模上，确实如此，因为这些操作的执行速度并没有让人耳感知到声音之间的延迟。</p><p id="9847" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是下一步会增加一些乐趣。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="0976" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">通过数组的数组进行异步迭代</h1><p id="3612" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">现在，我们必须考虑我们的整个垫，其中有四个所谓的“节拍”。分区看起来应该更像一个2D阵列:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="1caa" class="nf me it nb b gy ng nh l ni nj">const partition1 = [[true, false, false, false, false, false],<br/>                    [true, false, false, false, false, false],<br/>                    [false, true, false, false, true, false],<br/>                    [false, false, false, false, false, false]]</span></pre><p id="b2f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我们的<code class="fe nk nl nm nb b">playBeat</code>函数，我们必须添加一个处理程序，每当我们遍历一系列音符时，该处理程序将声音倒回到<code class="fe nk nl nm nb b">time=0</code>:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="8672" class="nf me it nb b gy ng nh l ni nj">playBeat = (soundsArr, beatArr) =&gt; {  <br/>   beatArr.forEach((s, i) =&gt; {    <br/>      if (s) {      <br/>         soundsArr[i].currentTime = 0;      <br/>         soundsArr[i].play();    <br/>      }  <br/>   });<br/>}</span></pre><p id="776f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:在这些例子中，我经常对变量和函数参数使用相同的名称，以更好地说明什么去哪里。在实际应用中，我避免这样做，因为这会导致混乱。</p><p id="ca91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们使用<code class="fe nk nl nm nb b">setInterval</code>创建一个异步循环，它将在定义的时间间隔内处理数组的元素。<code class="fe nk nl nm nb b">SetInterval</code>需要一个回调函数，我们将把我们的<code class="fe nk nl nm nb b">playBeat</code>部分和一个区间放入其中，这个区间是一个变量，我们称之为<code class="fe nk nl nm nb b">tempo</code>。</p><p id="2958" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">速度必须以毫秒为单位，因此对于120 bpm的八个音符，我们将有:</p><p id="a730" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm nb b">60000 / (120 * 2) = 250ms</code></p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="ca84" class="nf me it nb b gy ng nh l ni nj">playMusic = (soundsArr, partition, tempo) =&gt; {  <br/>   let counter = 0;  <br/>   musicPlaying = setInterval(() =&gt; {    <br/>      playBeat(soundsArr, partition[counter]);   <br/>      counter++;    <br/>      counter = counter%partition.length<br/>   }, tempo);<br/>}</span></pre><p id="70ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们用上面的数据执行我们的函数:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="0cec" class="nf me it nb b gy ng nh l ni nj">playMusic(soundsArr, partition1, 250)</span></pre><p id="54da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它应该会产生一个短循环的重复节拍。第一次迭代可能会滞后一点，但总体结果应该是令人满意的。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="5ba8" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">用DOM元素连接分区</h1><p id="a705" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">HTML文件<a class="ae ky" href="https://github.com/iourisorokine/The-Beat-Battle/blob/master/index.html" rel="noopener ugc nofollow" target="_blank">有一大堆div，代表玩家可以与之交互的pad。大致是这样的:</a></p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="69c3" class="nf me it nb b gy ng nh l ni nj">&lt;div class="notes-col"&gt;<br/>   &lt;div class="note" id="note-2-0"&gt;&lt;/div&gt;            <br/>   &lt;div class="note" id="note-2-1"&gt;&lt;/div&gt;        <br/>   &lt;div class="note" id="note-2-2"&gt;&lt;/div&gt;            <br/>   &lt;div class="note" id="note-2-3"&gt;&lt;/div&gt;  <br/>   &lt;div class="note" id="note-2-4"&gt;&lt;/div&gt; <br/>   &lt;div class="note" id="note-2-5"&gt;&lt;/div&gt;          <br/>&lt;/div&gt;          <br/>&lt;div class="notes-col"&gt;            <br/>   &lt;div class="note" id="note-3-0"&gt;&lt;/div&gt;            <br/>   &lt;div class="note" id="note-3-1"&gt;&lt;/div&gt;            <br/>   &lt;div class="note" id="note-3-2"&gt;&lt;/div&gt;            <br/>   &lt;div class="note" id="note-3-3"&gt;&lt;/div&gt;            <br/>   &lt;div class="note" id="note-3-4"&gt;&lt;/div&gt;            <br/>   &lt;div class="note" id="note-3-5"&gt;&lt;/div&gt;          <br/>&lt;/div&gt;</span></pre><p id="8159" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有很多id和编号，但这允许我们智能地向每个元素添加事件监听器，切换我们的<code class="fe nk nl nm nb b">partition1</code>数组值，还添加CSS类来提供视觉反馈:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="9ab1" class="nf me it nb b gy ng nh l ni nj">window.addEventListener("load", () =&gt; {<br/>   notes.forEach(note =&gt; {<br/>   note.addEventListener("click",() =&gt; {<br/>      note.classList.toggle("highlighted");            <br/>      const rowsToggle = note.id.split("-")[1];            <br/>      const colsToggle = note.id.split("-")[2];<br/>      partition1[rowsToggle][colsToggle] = <br/>      !partition1[rowsToggle][colsToggle];        <br/>      });    <br/>   });<br/>});</span></pre><p id="24e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们只需创建一个播放按钮，并添加一个onclick属性，该属性将触发我们上面编写的函数:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="8218" class="nf me it nb b gy ng nh l ni nj">&lt;button onclick="playMusic(soundsArr, partition1, 250)"&gt;<br/>   Play<br/>&lt;/button&gt;</span></pre><p id="0b33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了不永远陷入这个循环，让我们创建一个停止按钮:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="c619" class="nf me it nb b gy ng nh l ni nj">&lt;button onclick="stopPlaying()"&gt;<br/>   Stop<br/>&lt;/button&gt;</span><span id="7a2c" class="nf me it nb b gy nn nh l ni nj">stopPlaying = () =&gt; clearInterval(musicPlaying)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/479a14df6eedbebdbea7e94b25d0437e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*kCEFPEvE5ItCHobZyX5vVw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在应用样式后，衬垫</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="b47e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">瞧啊。</h1><p id="3d5a" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">由于有了异步循环，我们可以根据自己的速度以一定的间隔播放节拍。关于播放哪些声音以及何时播放的信息存储在2D布尔数组中，用户可以通过与相应的DOM元素交互来更改该数组，这些DOM元素被处理为一个pad。</p><p id="c4b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢这个迷你教程，我期待着在下一篇文章中更深入地研究游戏机制。</p></div></div>    
</body>
</html>