<html>
<head>
<title>How to Create Your Own Combine Subscriber in Swift 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Swift 5中创建自己的联合收割机订户</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-your-own-combine-subscriber-in-swift-5-702b3f9c68c4?source=collection_archive---------6-----------------------#2020-06-15">https://betterprogramming.pub/how-to-create-your-own-combine-subscriber-in-swift-5-702b3f9c68c4?source=collection_archive---------6-----------------------#2020-06-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="aa6d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将逻辑封装在单独的类中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/aa90444fa915cf7e415d9b82b3491bef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4xrUPSwI0JWRqIWm"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">埃里克·麦克林在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="460e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将学习如何创建自己的组合订阅者，将值和完成处理逻辑封装到一个单独的类中。</p><p id="bb91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Xcode Playground实现的源代码可以在本文的底部找到。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5cf2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">我们开始吧</h1><p id="d7af" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设我们的目标是接收字符串值并打印它们的大写版本。</p><p id="8629" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要创建一个符合<code class="fe mz na nb nc b">Subscriber</code>协议的<code class="fe mz na nb nc b">StringSubscriber</code>类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="606c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们必须提供两个类型别名，<code class="fe mz na nb nc b">Input</code>和<code class="fe mz na nb nc b">Failure</code>。<code class="fe mz na nb nc b">Input</code>代表我们从出版商那里获得的价值类型。在我们这里是<code class="fe mz na nb nc b">String</code>。我们不想接收任何<code class="fe mz na nb nc b">Error</code> s，所以我们将<code class="fe mz na nb nc b">Failure</code>设置为<code class="fe mz na nb nc b">Never</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="3dd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须实现三个必需的方法:</p><ul class=""><li id="e68d" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">一个指定我们的订户可以接收的值的数量的</li><li id="9c7f" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">处理接收到的输入并扩展订阅者可以接收的值的数量</li><li id="2c77" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">处理完成事件的对象</li></ul><p id="516c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们指定未来值的最大数量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="e0f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们对收到的<code class="fe mz na nb nc b">String</code>的计数没有限制，所以我们指定了一个<code class="fe mz na nb nc b">.unlimited</code>枚举案例。</p><p id="f9d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们来处理输入:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5ebc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们已经指定了值的数量<code class="fe mz na nb nc b">.unlimited</code>，我们返回<code class="fe mz na nb nc b">.none</code>，所以最大限制保持不变。</p><p id="7978" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们提供了处理完成的方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="3ec9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，我们只是打印了完成事件。</p><p id="6f8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们测试一下<code class="fe mz na nb nc b">StringSubscriber</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="1af9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们向一个发布者提供一组<code class="fe mz na nb nc b">String</code>然后向该发布者订阅<code class="fe mz na nb nc b">StringSubscriber</code>。</p><p id="ec6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果，我们看到了我们想要的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/571eff77deed2b060445317aef7c296f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8lhMPyF-F9tmjajC__JSvA.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2741" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使订户可以与任何类型的</h1><p id="e686" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你可能会想，只处理<code class="fe mz na nb nc b">String</code>对象是好的，但是我如何让一个订阅者处理任何类型的对象呢？</p><p id="f673" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决方案是使其通用化，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="f59a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要测试它，创建两个发布者并订阅它们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="9914" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到打印出的值与预期的一样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/599a8cdbce70e94c707a3721f003a52f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VImNc3Zzxwdf8vHe2yATew.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4332" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">资源</h1><p id="7b05" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">GitHub gist中提供了源代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2145" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">包扎</h1><p id="4194" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对Swift的其他功能感兴趣吗？请随意查看我的其他相关文章:</p><ul class=""><li id="1e94" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated"><a class="ae ky" href="https://medium.com/better-programming/what-is-the-difference-between-class-and-static-in-swift-3493848ed831" rel="noopener">“Swift中的类和静态有什么区别？</a></li><li id="4078" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><a class="ae ky" href="https://medium.com/better-programming/what-is-the-operator-in-swift-7f6bc7623023" rel="noopener">“Swift中的~=运算符是什么？</a></li><li id="3b35" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><a class="ae ky" href="https://medium.com/better-programming/what-is-the-vdsp-framework-in-swift-fe2539693e9a" rel="noopener">“Swift中的vDSP框架是什么？</a></li><li id="5c07" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><a class="ae ky" href="https://medium.com/better-programming/what-is-the-value-binding-pattern-in-swift-a644be3e0597" rel="noopener">“Swift中的价值绑定模式是什么？</a>”</li><li id="39fc" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><a class="ae ky" href="https://medium.com/better-programming/what-is-the-customstringconvertible-protocol-in-swift-4b7ddbc5785b" rel="noopener">“Swift中的CustomStringConvertible协议是什么？</a>”</li></ul><p id="fa71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>