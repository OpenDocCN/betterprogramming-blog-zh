<html>
<head>
<title>How to Produce a Zoomable Bifurcation Diagram in Tauri Using Rust</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Rust在Tauri中生成可缩放的分叉图</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/producing-a-zoom-able-bifurcation-diagram-in-tauri-rust-d2867ff1387f?source=collection_archive---------9-----------------------#2022-10-10">https://betterprogramming.pub/producing-a-zoom-able-bifurcation-diagram-in-tauri-rust-d2867ff1387f?source=collection_archive---------9-----------------------#2022-10-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5607" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这一神奇功能的简要指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cc3826f4abddab80b615d2f239fd25c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Okb3YeyFszxwmSlugnzsyA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><div class="ky kz gp gr la lb"><a href="https://medium.com/@applied-math-coding/membership" rel="noopener follow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd iu gy z fp lg fr fs lh fu fw is bi translated">通过我的推荐链接加入Medium-applied . math . coding</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">获得我所有的故事，以及其他作家在媒体上发表的成千上万的故事。我坚信，媒介是…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">medium.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp ks lb"/></div></div></a></div><p id="f80d" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">Rust可能是科学计算和机器学习中最有前途的编程语言之一。这两门学科都要求我们不时地进行精确的计算机实验和模拟。</p><p id="50a4" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">在我之前的一篇文章中(参见<a class="ae mm" rel="noopener ugc nofollow" target="_blank" href="/building-a-desktop-app-with-tauri-8e281b8c4f64">这里</a>，我已经简单介绍了如何快速建立一个基于<a class="ae mm" href="https://tauri.app/" rel="noopener ugc nofollow" target="_blank"> Tauri </a>的桌面应用程序，它能够绘制来自Rust函数调用的数据。</p><p id="7f62" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">本文将采用这种方法来为逻辑映射生成一个可缩放的分叉图。对于事情背后的理论方面，你给<a class="ae mm" href="https://medium.com/@applied-math-coding/chaos-from-the-logistic-map-part-1-periodic-points-4f579b713055" rel="noopener">这篇文章读一读</a>，但不是这篇文章所要求的。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="e5f9" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">注意，在以下几个组件和功能的名称中有术语<code class="fe mu mv mw mx b">feigenbaum</code>。这并不是偶然的，而是为了帮助第一个开始查看这种特定图表的人(参见<a class="ae mm" href="https://en.wikipedia.org/wiki/Mitchell_Feigenbaum" rel="noopener ugc nofollow" target="_blank">这里的</a>)。</p><p id="e4fd" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">Tauri应用程序本身是通过使用<code class="fe mu mv mw mx b">npm create tauri-app</code>中的<code class="fe mu mv mw mx b">vue-ts</code>选项创建的。而且UI使用组件库<a class="ae mm" href="https://www.primefaces.org/primevue/setup" rel="noopener ugc nofollow" target="_blank"> PrimeVue </a>和<a class="ae mm" href="https://sass-lang.com/" rel="noopener ugc nofollow" target="_blank"> Sass </a>作为CSS扩展。两者都可以集成到应用程序中，就像对普通的web应用程序一样。</p><p id="3a6b" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">这里描述的所有代码都可以在这个<a class="ae mm" href="https://github.com/applied-math-coding/feigenbaum" rel="noopener ugc nofollow" target="_blank">库</a>中找到。你可以随意克隆它，随便玩玩。请注意，当您克隆它时，您必须从其根目录中运行以下命令，以便获取客户端依赖项:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="e304" class="nc nd it mx b gy ne nf l ng nh">npm i</span></pre><p id="6402" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">当然，这都假设你已经安装了这里所列的用Tauri开发的需求。</p><h1 id="c7e9" class="ni nd it bd nj nk nl nm nn no np nq nr jz ns ka nt kc nu kd nv kf nw kg nx ny bi translated">实现模拟</h1><p id="4c8e" class="pw-post-body-paragraph lq lr it ls b lt nz ju lv lw oa jx ly lz ob mb mc md oc mf mg mh od mj mk ml im bi translated">在本节中，您将需要一些关于Rust的基本知识。如果你需要一个总结，你可以在这里找到一个简单的介绍。</p><p id="ac6b" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">分叉图基于以下技术。对于给定区间<code class="fe mu mv mw mx b">[a, b]</code>内<code class="fe mu mv mw mx b">r</code>(分叉参数)的几个值，我们选择一个随机的起始值<code class="fe mu mv mw mx b">x_0</code>，并迭代下面的动态系统几次:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="2234" class="nc nd it mx b gy ne nf l ng nh">x_{n+1} = r * x_n * (1 - x_n)</span></pre><p id="d87d" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">这给出了一个我们称之为暗迭代的值列表。在分叉图中，我们感兴趣的是一个系统的长期行为。也就是说，我们问它是否收敛，例如，收敛到某些周期轨道或不变集。因此，我们再次迭代系统<code class="fe mu mv mw mx b">m</code>次，但是现在我们存储值的列表，以便以后绘制它们。</p><p id="6b29" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">换句话说，如果<code class="fe mu mv mw mx b">(v_1, v_2, ..., v_m)</code>是这些值，我们为特定的<code class="fe mu mv mw mx b">r</code>绘图:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="bc4b" class="nc nd it mx b gy ne nf l ng nh">{(r, v_1), (r, v_2), ..., (r, v_m)}</span></pre><p id="bef7" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">进行上述模拟的部分是:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="e233" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">注意，这也允许你在多个初始点<code class="fe mu mv mw mx b">x_0</code>上操作。</p><p id="fe56" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">我们用一个传递随机初始点的函数来包装对上述函数的调用。看起来是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="1765" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">我在这里使用奇妙的crate <a class="ae mm" href="https://crates.io/crates/rand" rel="noopener ugc nofollow" target="_blank"> rand </a>来产生随机值。</p><p id="5f7d" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">如我所说，这必须在间隔<code class="fe mu mv mw mx b">[a,b]</code>内对<code class="fe mu mv mw mx b">r</code>的几个值进行。下面的方法就是这样做的，它收集所有的迭代结果作为返回值。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="7731" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated"><code class="fe mu mv mw mx b">delta</code>是我们在<code class="fe mu mv mw mx b">[a, b]</code>中选择数值的步骤。</p><p id="47f0" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">最后，由于所有这一切可能需要相当长的时间，明智的做法是将这种计算分布在可用的CPU上。我们通过将区间<code class="fe mu mv mw mx b">[a,b]</code>分割成尽可能多的可用内核来实现这一点(注意，这利用了板条箱<code class="fe mu mv mw mx b"><a class="ae mm" href="https://crates.io/crates/num_cpus" rel="noopener ugc nofollow" target="_blank">num_cpus</a></code>)。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="6ec2" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">Rust出色的通道通信实现了派生线程之间的同步。</p><p id="e6ce" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">为了使所有这些在用户界面中都可以访问，我们在<code class="fe mu mv mw mx b">main.rs</code>中注册了下面的Tauri命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><h1 id="29c4" class="ni nd it bd nj nk nl nm nn no np nq nr jz ns ka nt kc nu kd nv kf nw kg nx ny bi translated">可视化模拟</h1><p id="2666" class="pw-post-body-paragraph lq lr it ls b lt nz ju lv lw oa jx ly lz ob mb mc md oc mf mg mh od mj mk ml im bi translated">尽管在我们的场景中有像<a class="ae mm" href="https://plotly.com/javascript/" rel="noopener ugc nofollow" target="_blank"> plotly </a>这样非常强大的绘图库，但最好还是使用普通的HTML5 canvas元素。这是非常高性能的，可以很容易地处理大量的点。</p><p id="31f2" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">进行绘图的代码位于<code class="fe mu mv mw mx b">Feigenbaum.vue</code>。模板中有一个类似如下的<code class="fe mu mv mw mx b">canvas</code>:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="90db" class="nc nd it mx b gy ne nf l ng nh">&lt;canvas ref="canvas" width="700" height="500"<br/>      <a class="ae mm" href="http://twitter.com/mousemove" rel="noopener ugc nofollow" target="_blank">@mousemove</a>="!state.simulating &amp;&amp; handleMouseMove($event)"<br/>      <a class="ae mm" href="http://twitter.com/mouseleave" rel="noopener ugc nofollow" target="_blank">@mouseleave</a>="state.hoveredR=undefined"    <br/>      <a class="ae mm" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>="!state.simulating &amp;&amp; handleCanvasClick()"&gt;<br/>&lt;/canvas&gt;</span></pre><p id="6571" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">这个<code class="fe mu mv mw mx b">canvas</code>引用自JavaScript代码</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="89e9" class="nc nd it mx b gy ne nf l ng nh">const canvas = ref&lt;HTMLCanvasElement | null&gt;(null);</span></pre><p id="fab0" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">并用于在新数据到达时绘图。请求数据然后绘制数据的部分是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="2850" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">让Tauri调用我们同名的Rust函数。数据将存储在变量<code class="fe mu mv mw mx b">x, y</code>中。因此，<code class="fe mu mv mw mx b">x</code>是一个列表，其中包含对应迭代的<code class="fe mu mv mw mx b">r</code>和<code class="fe mu mv mw mx b">y</code>的值。本质上，这些值被迭代(<code class="fe mu mv mw mx b">forEach</code>)，然后作为一个点绘制到画布中(宽度/高度的填充矩形<code class="fe mu mv mw mx b">1</code>)。</p><p id="68ea" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">不过，在将这些值绘制到<code class="fe mu mv mw mx b">canvas</code>之前，我们必须记住<code class="fe mu mv mw mx b">canvas</code>使用不同的缩放坐标，而且<code class="fe mu mv mw mx b">y</code>轴是镜像的。为了处理这个问题，我们首先通过将所有的<code class="fe mu mv mw mx b">(r, v)</code>对转换成<code class="fe mu mv mw mx b">canvas</code>坐标来对它们进行<code class="fe mu mv mw mx b">map</code>。方法<code class="fe mu mv mw mx b">transfCoords</code>如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><h1 id="8235" class="ni nd it bd nj nk nl nm nn no np nq nr jz ns ka nt kc nu kd nv kf nw kg nx ny bi translated">构建和运行应用程序</h1><p id="073e" class="pw-post-body-paragraph lq lr it ls b lt nz ju lv lw oa jx ly lz ob mb mc md oc mf mg mh od mj mk ml im bi translated">如果您运行以下命令:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="7a39" class="nc nd it mx b gy ne nf l ng nh">npm run tauri build</span></pre><p id="ea7d" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">Tauri将完成所有的构建步骤以生成一个发布版本。根据您的系统，您会在文件夹<code class="fe mu mv mw mx b">src-tauri/target/release</code>中找到一个可执行文件。对我来说，是文件<code class="fe mu mv mw mx b">feigenbaum.exe</code>。点击后，出现如下界面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/ba096f0a8ab268c4a0f058d06cba4223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2LIfrozm59drrYLji9eQHA.png"/></div></div></figure><p id="f5fc" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">按下模拟按钮会产生:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/bc968c933d1c27e7bbf36397b372a96c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P6TVqC7vT8nziJ_6KnipoQ.png"/></div></div></figure><p id="99b0" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">此外，如果您单击图表，间隔将被调整为围绕该点并应用缩放因子。例如，我们可以缩放<code class="fe mu mv mw mx b">r = 3.74</code>的区域以获得下图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/e1a6cdd8bb722baca052a828df4f486a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOamAj4p_h9vs2WNzrl-KA.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj of l"/></div></figure><p id="4d4d" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">现在，你可以自由实验了！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="2539" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">感谢阅读！</p></div></div>    
</body>
</html>