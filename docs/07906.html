<html>
<head>
<title>How To Configure a Static IP for Your Serverless App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为您的无服务器应用程序配置静态IP</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-configure-a-static-ip-for-your-serverless-app-d2c1296f68cc?source=collection_archive---------9-----------------------#2021-03-03">https://betterprogramming.pub/how-to-configure-a-static-ip-for-your-serverless-app-d2c1296f68cc?source=collection_archive---------9-----------------------#2021-03-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="88b8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过静态IP地址发送出站Lambda流量听起来可能很难，但这比你想象的要简单</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5bb4b9bd6432a5af3b235e66a1e14836.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PE2gMMYTjR3-Y8R_p8j4zw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自Stockphotos.com的Amos在T2的Unsplash上拍摄的照片。</p></figure><p id="8373" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无服务器很棒。好了，我说了。</p><p id="c294" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一点上，我不确定很多人会和我争论，但每个人都有自己的看法。</p><p id="14aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无服务器为我们提供了在云中进行快速计算的便利，而不必担心机器或状态。相当棒。</p><p id="796d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，由于我们不必担心机器或状态，一些我们以前没有的问题出现了。像<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/the-challenges-of-stateless-architecture-and-how-to-monitor-your-serverless-application-94c0e8b8dd1">监控你的应用</a>这样的事情变得更加困难。你还会遇到分布式计算的所有困难。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="b7e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是一个静态的IP呢？您需要静态IP地址的原因有很多，比如与第三方集成或连接到内部网络。为了安全措施，这些任务通常需要将IP地址列入白名单。</p><p id="da70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很难反驳安全性，所以我们必须想出一种方法让Lambda函数从一个已知的IP地址发送外部流量。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="887c" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">设置</h1><p id="fcac" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">充分披露:这是一个已经解决了一段时间的问题。当我在做关于如何让Lambda使用静态IP的初步研究时，我使用了<a class="ae ky" href="https://medium.com/cloud-prodigy/aws-lambda-with-static-ip-address-c82e3043c2ed" rel="noopener">本教程</a>和<a class="ae ky" href="https://matthewleak.medium.com/aws-lambda-functions-with-a-static-ip-89a3ada0b471" rel="noopener">本教程</a>来通过控制台工作并设置它。</p><p id="3038" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但我是童子军。我喜欢让东西保持原样。</p><p id="2559" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我收集了教程、评论、试验和错误，并且<a class="ae ky" href="https://github.com/allenheltondev/aws-lambda-static-ip" rel="noopener ugc nofollow" target="_blank">创建了一个SAM模板</a>，它将通过最少的设置自动将您需要的一切部署到云中。</p><p id="dd83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是你需要的:</p><ul class=""><li id="b18b" class="nb nc it lb b lc ld lf lg li nd lm ne lq nf lu ng nh ni nj bi translated">您机器上配置的AWS CLI<a class="ae ky" href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" rel="noopener ugc nofollow" target="_blank"/></li><li id="560e" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html" rel="noopener ugc nofollow" target="_blank"> SAM CLI </a></li><li id="8e4b" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">您帐户中用于部署资源的一个<a class="ae ky" href="https://s3.console.aws.amazon.com/s3/home" rel="noopener ugc nofollow" target="_blank"> S3存储桶</a></li><li id="7bc5" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">一个<a class="ae ky" href="https://www.digitalocean.com/community/tutorials/understanding-ip-addresses-subnets-and-cidr-notation-for-networking" rel="noopener ugc nofollow" target="_blank"> CIDR块</a>为你即将创建的网络</li></ul><p id="db7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您像我一样不熟悉CIDR、网络、子网和IP配置，请不要担心。这些是我在测试中使用的值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np lw l"/></div></figure><p id="48c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能希望为生产用途更改这些值，但是它们应该可以满足您的POC需求。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="5518" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">体系结构</h1><p id="ef9f" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">人脉很难。我常说:“不要把复杂和不熟悉混为一谈。”但是我的大学学位是“软件工程理学学士，重点是网络”，我仍然认为这很难。我对它很熟悉，但它仍然很复杂。</p><p id="3c7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们选择无服务器的原因，对吗？因为我们希望专注于解决业务问题，而不是处理网络。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="0837" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于那些好奇的人，我希望每个人都阅读这篇文章，因为这只是工程师的本性，这是我们用这个SAM模板建立的架构。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/7bece49bf28b95a65ee3abc3bcfda88b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/0*cCGOrgDH7x2hmS6i.png"/></div></figure><p id="7da3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">概括地说，我们已经配置了一些相互通信的移动部件，以便通过静态IP路由流量:</p><ul class=""><li id="01d4" class="nb nc it lb b lc ld lf lg li nd lm ne lq nf lu ng nh ni nj bi translated">接受传入请求的API网关</li><li id="dd18" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">包含私有子网和公有子网的VPC</li><li id="7185" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">私有子网中的Lambda函数</li><li id="ebf9" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">为公共子网提供互联网接入的互联网网关</li><li id="7bec" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">配置了静态IP的NAT网关，用于路由外部流量</li><li id="4887" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">通过网关发送流量的路由表</li></ul></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="6454" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">输出</h1><p id="f90d" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">当你在你的AWS账户中部署这个栈时，<a class="ae ky" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank"> CloudFormation </a>将为你提供两个输出:一个IP地址和一个URL。</p><p id="917d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">IP地址是您分配的弹性IP。这是您可以提供给您的集成商以加入白名单的地址。这是不会改变的。私有子网中Lambda函数的所有出站web流量都将来自该IP。</p><p id="08b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该URL是一个测试端点。它是一个API，点击<a class="ae ky" href="https://www.ipify.org/" rel="noopener ugc nofollow" target="_blank"> ipify </a>来获取Lambda的IP地址，并将该地址与您的静态IP进行比较。该响应将为您提供预期IP、实际IP，并告诉您它们是否匹配。</p><p id="15c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！配置几个小参数，部署，享受！</p><p id="4884" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从这里，您可以修改测试端点或者创建一个新的来满足您的需求。</p><p id="2774" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这能让你尽快解决你的问题，并打开解决业务问题的大门。同样，这也是我们选择无服务器的原因:花尽可能多的时间帮助我们的客户，而不是配置和维护基础架构。</p><p id="e9f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">干杯！</p></div></div>    
</body>
</html>