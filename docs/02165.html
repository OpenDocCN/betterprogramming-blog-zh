<html>
<head>
<title>iOS 13 Rich Link Previews With SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SwiftUI的iOS 13丰富链接预览</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ios-13-rich-link-previews-with-swiftui-e61668fa2c69?source=collection_archive---------10-----------------------#2019-11-11">https://betterprogramming.pub/ios-13-rich-link-previews-with-swiftui-e61668fa2c69?source=collection_archive---------10-----------------------#2019-11-11</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="06ef" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">介绍新的LinkPresentation框架</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/cd38e13974e5e387945f200caa98ee6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FlF1-GtlGZUc5n7dJaybpg.png"/></div></div></figure><p id="7600" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">苹果在2019年WWDC展会期间非常重视用户界面的现代化。无论是像SwiftUI这样的突破性变化，还是像新的LinkPresentation框架这样的微妙变化。</p><p id="fa42" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">LinkPresentation框架允许开发人员从iOS 13开始在他们的应用程序中集成视觉上丰富的预览链接，这种功能以前可以在苹果的消息应用程序中看到。</p><p id="13a5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">尽管今年没有像其他几个版本那样引人注目，LinkPresentation在增强应用程序的用户体验方面可以发挥关键作用。</p></div><div class="ab cl lr ls hy lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="in io ip iq ir"><h1 id="80e9" class="ly lz iu bd ma mb mc md me mf mg mh mi ka mj kb mk kd ml ke mm kg mn kh mo mp bi translated">我们的目标</h1><ul class=""><li id="4520" class="mq mr iu kx b ky ms lb mt le mu li mv lm mw lq mx my mz na bi translated">讨论LinkPresentation的工作方式。</li><li id="2c94" class="mq mr iu kx b ky nb lb nc le nd li ne lm nf lq mx my mz na bi translated">在我们基于Swift UI的iOS应用程序中集成丰富的链接。</li></ul></div><div class="ab cl lr ls hy lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="in io ip iq ir"><h1 id="9afd" class="ly lz iu bd ma mb mc md me mf mg mh mi ka mj kb mk kd ml ke mm kg mn kh mo mp bi translated">LinkPresentation框架</h1><p id="a72f" class="pw-post-body-paragraph kv kw iu kx b ky ms jv la lb mt jy ld le ng lg lh li nh lk ll lm ni lo lp lq in bi translated">新引入的框架允许您在应用程序中嵌入基于内容的URL预览，这在整个操作系统中保持一致。</p><p id="ed6f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">大体上，LinkPresentation框架包括以下内容:</p><ul class=""><li id="0047" class="mq mr iu kx b ky kz lb lc le nj li nk lm nl lq mx my mz na bi translated"><code class="fe nm nn no np b">LPMetaDataProvider</code> —该类用于从URL获取元数据。</li><li id="4dec" class="mq mr iu kx b ky nb lb nc le nd li ne lm nf lq mx my mz na bi translated"><code class="fe nm nn no np b">LPLinkMetaData</code> —充当元数据的容器。它负责存储富链接的内容、图标、图像和视频。或者，您也可以在该类中设置自己的自定义数据。</li><li id="3dbf" class="mq mr iu kx b ky nb lb nc le nd li ne lm nf lq mx my mz na bi translated"><code class="fe nm nn no np b">LPLinkView</code> —这为我们嵌入内容和图像的链接提供了视觉上丰富的预览。</li><li id="cfcd" class="mq mr iu kx b ky nb lb nc le nd li ne lm nf lq mx my mz na bi translated"><code class="fe nm nn no np b">LPError</code> —通常，这处理LinkPresentation框架的错误处理部分。</li></ul><p id="97e3" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在幕后，LinkPresentation框架使用<a class="ae nq" href="https://developer.apple.com/documentation/webkit/wkwebview" rel="noopener ugc nofollow" target="_blank"> WKWebView </a>来获取元数据。</p><p id="fc1e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">下面的代码片段展示了一个获取元数据并将其显示在<code class="fe nm nn no np b">LinkView</code>中的示例:</p><pre class="kk kl km kn gu nr np ns nt aw nu bi"><span id="1e7c" class="nv lz iu np b gz nw nx l ny nz">import LinkPresentation<br/><br/>let metadataProvider = LPMetadataProvider()<br/>let url = URL(string: "https://medium.com/@anupamchugh/")!<br/><br/>metadataProvider.startFetchingMetadata(for: url) { [weak self] metadata, error in<br/>    guard let metadata = metadata else { return }<br/><br/>    let linkView = LPLinkView(metadata: metadata)<br/>    self?.view.addSubview(linkView)<br/>}</span></pre><p id="002e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">对于由于某种原因无法检索元数据的情况，我们可以将自己的自定义标题、图标、视频或URL设置为占位符:</p><pre class="kk kl km kn gu nr np ns nt aw nu bi"><span id="a318" class="nv lz iu np b gz nw nx l ny nz">let md = LPLinkMetadata()<br/>md.title = "Custom title"<br/>md.url = url<br/>md.imageProvider = ....</span><span id="544f" class="nv lz iu np b gz oa nx l ny nz">let linkView = LPLinkView(metadata: metadata)</span></pre><p id="faeb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在下一节中，我们将开发一个基于SwiftUI的iOS应用程序，该应用程序显示丰富的链接预览列表。让我们开始吧。</p></div><div class="ab cl lr ls hy lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="in io ip iq ir"><h1 id="36bb" class="ly lz iu bd ma mb mc md me mf mg mh mi ka mj kb mk kd ml ke mm kg mn kh mo mp bi translated">创建UIView</h1><p id="19b2" class="pw-post-body-paragraph kv kw iu kx b ky ms jv la lb mt jy ld le ng lg lh li nh lk ll lm ni lo lp lq in bi translated">是啊！我们将遵照<code class="fe nm nn no np b">UIViewRepresentable</code>将我们的UIKit视图包装在SwiftUI视图中。</p><pre class="kk kl km kn gu nr np ns nt aw nu bi"><span id="c8f8" class="nv lz iu np b gz nw nx l ny nz">struct LinkRow : UIViewRepresentable {<br/>    <br/>    var previewURL:URL<br/>    <br/>    <a class="ae nq" href="http://twitter.com/Binding" rel="noopener ugc nofollow" target="_blank">@Binding</a> var redraw: Bool<br/>    <br/>    func makeUIView(context: Context) -&gt; LPLinkView {<br/>        let view = LPLinkView(url: previewURL)<br/>        <br/>        let provider = LPMetadataProvider()<br/>        provider.startFetchingMetadata(for: previewURL) { (metadata, error) in<br/>            if let md = metadata {<br/>                DispatchQueue.main.async {<br/>                    view.metadata = md<br/>                    view.sizeToFit()<br/>                    self.redraw.toggle()<br/>                }<br/>            }<br/>            else if error != nil<br/>            {<br/>                let md = LPLinkMetadata()<br/>                md.title = "Custom title"<br/>                view.metadata = md<br/>                view.sizeToFit()<br/>                self.redraw.toggle()<br/>            }<br/>        }<br/>        <br/>        return view<br/>    }<br/>    <br/>    func updateUIView(_ view: LPLinkView, context: Context) {<br/>        // New instance for each update<br/>    }<br/>}</span></pre><p id="4829" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在上面的代码中，有一个<code class="fe nm nn no np b">redraw</code>绑定实例。它通知SwiftUI视图在获取元数据后重新绘制富链接预览。</p><p id="6ea4" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe nm nn no np b">sizeToFit()</code>用于自动调整单元格大小以适应丰富的链接预览。</p></div><div class="ab cl lr ls hy lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="in io ip iq ir"><h1 id="7cc8" class="ly lz iu bd ma mb mc md me mf mg mh mi ka mj kb mk kd ml ke mm kg mn kh mo mp bi translated">创建我们的数据结构</h1><p id="7532" class="pw-post-body-paragraph kv kw iu kx b ky ms jv la lb mt jy ld le ng lg lh li nh lk ll lm ni lo lp lq in bi translated">接下来，我们为SwiftUI列表创建一个符合<code class="fe nm nn no np b">Identifiable</code>协议的结构，通过其唯一标识符来标识每一行。</p><pre class="kk kl km kn gu nr np ns nt aw nu bi"><span id="ac54" class="nv lz iu np b gz nw nx l ny nz">struct StringLink : Identifiable{</span><span id="ce5a" class="nv lz iu np b gz oa nx l ny nz">var id = UUID()<br/>var string : String</span><span id="945b" class="nv lz iu np b gz oa nx l ny nz">}</span></pre><p id="dbae" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在下一节中，我们将在<code class="fe nm nn no np b">ContentView</code>中用URL字符串填充数组<code class="fe nm nn no np b">StringLink</code>。</p></div><div class="ab cl lr ls hy lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="in io ip iq ir"><h1 id="fe38" class="ly lz iu bd ma mb mc md me mf mg mh mi ka mj kb mk kd ml ke mm kg mn kh mo mp bi translated">构建内容视图</h1><p id="ad95" class="pw-post-body-paragraph kv kw iu kx b ky ms jv la lb mt jy ld le ng lg lh li nh lk ll lm ni lo lp lq in bi translated">最后，我们将数据传递给SwiftUI <code class="fe nm nn no np b">List</code>，它持有<code class="fe nm nn no np b">UIView</code> <code class="fe nm nn no np b">LinkRow</code>，如下所示:</p><pre class="kk kl km kn gu nr np ns nt aw nu bi"><span id="6230" class="nv lz iu np b gz nw nx l ny nz">import LinkPresentation</span><span id="2556" class="nv lz iu np b gz oa nx l ny nz">struct ContentView: View {<br/>    <br/>    <a class="ae nq" href="http://twitter.com/State" rel="noopener ugc nofollow" target="_blank">@State</a> var redrawPreview = false    <br/>    let links : [StringLink]  = [] //add your url links here<br/>    var body: some View {<br/>        List(links){ l in<br/>            LinkRow(previewURL: URL(string: l.string)!, redraw: self.$redrawPreview)<br/>        }<br/>        .environment(\.defaultMinListRowHeight, 200)<br/>        <br/>    }<br/>}</span></pre><p id="1125" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我们可以像上面一样使用<code class="fe nm nn no np b">environment</code>属性设置列表的默认高度和宽度。</p><p id="9316" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">作为回报，我们在SwiftUI live预览中得到以下结果。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ob"><img src="../Images/1043678380430a9b58a67deb92e812e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pdjIcRCxrzbp09oUrbkzJw.png"/></div></div><p class="oc od gk gi gj oe of bd b be z dk translated">屏幕捕获</p></figure></div><div class="ab cl lr ls hy lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="in io ip iq ir"><h1 id="2f3f" class="ly lz iu bd ma mb mc md me mf mg mh mi ka mj kb mk kd ml ke mm kg mn kh mo mp bi translated">还有更多</h1><p id="ab5f" class="pw-post-body-paragraph kv kw iu kx b ky ms jv la lb mt jy ld le ng lg lh li nh lk ll lm ni lo lp lq in bi translated">LinkPresentation框架可用于通过预取URL链接的元数据来优化共享表，从而消除共享表弹出时的延迟。</p><p id="032f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">您甚至可以缓存URL的元数据，以防止每次都向服务器发送相同的链接。</p><p id="e1ce" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这就结束了。我希望你喜欢读它。</p></div></div>    
</body>
</html>