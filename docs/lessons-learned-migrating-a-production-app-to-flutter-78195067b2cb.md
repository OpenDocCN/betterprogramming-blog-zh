# 将生产应用迁移到 Flutter 的经验教训

> 原文：<https://betterprogramming.pub/lessons-learned-migrating-a-production-app-to-flutter-78195067b2cb>

## 我从艰难的道路中学到的教训可以帮助你在下一个颤振项目中更加有效

![](img/1bd6e9adf7833304bb84fec7bd5328e1.png)

在 [Unsplash](https://unsplash.com/s/photos/dual?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上由 [Franck V.](https://unsplash.com/@franckinjapan?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 拍摄的照片

我已经开发原生 Android 应用程序两年多了。除了在 Android 中做简单事情的过于复杂的方式之外，我所面临的唯一缺点是，我只能接触 Android 用户。我不得不指望一个 iOS 开发人员为 iOS 用户发布相同的应用程序。这总感觉像是对我作为开发人员的能力的某种限制。

进入[颤振](https://flutter.dev/)，看起来有希望提高我的权力，并保持简单的事情简单的建设。我仍然需要依赖 iOS dev 来完成一些配置工作，但是现在这种依赖已经小得多了。

我们有一个运行在 Android 和 iOS 上的本地应用，内部并不复杂，但需要更多的开发人员来维护它。我们有了下一个特性需求。

我和我的团队为接下来的需求选择了 Flutter。这是有意义的，因为它的功能并不复杂，但 UI 却很复杂。如果成功，这可能是我们将现有应用迁移到 Flutter 的第一步。

我们成功地度过了这一关，但只是在艰难地学习了一些东西之后。这是一次很棒的学习经历，而且构建跨平台应用程序更有趣。

在这里，我分享我们的经验和教训。

一句话:我仍然爱扑！

# 经验教训

## 1.开始会很难

当你从本地应用程序开发转移到 Flutter 时，写代码将是一件非常痛苦的事情。

您会发现自己在挣扎，因为您会对将业务逻辑和 UI 逻辑放在哪里感到困惑，尤其是当您喜欢编写干净的代码时。

UI 和业务逻辑的单个文件听起来像是一种优势，因为您不必创建单独的布局和逻辑文件，但是我发现它更像是一种潜在的负债而不是资产。

## 2.编写更干净的代码是一个更大的挑战，比以往任何时候都更重要

权力越大，责任越大。

这不仅仅是必须干净地编写您的 UI 和业务逻辑。在 Flutter 中，不同部件之间的通信方式非常重要。

Flutter 按照一个窗口小部件树来构建东西，如果你不够仔细地规划你的数据流，那么你将会遇到你的 UI 不能正确更新的问题。随着时间的推移，你会感到沮丧，下一件事你知道，你会写黑客只是为了让它工作。

那只是运行中的坏代码。

看看刚刚发生了什么。你先写坏代码，然后你写更多的坏代码试图修复这些坏代码。一旦成功了，你就会害怕做出任何改变。然后你会忙于下一个截止日期。那些糟糕的代码会一直留在那里，困扰着你。您将围绕这些糟糕的代码编写更多的代码，以使其他东西正常工作。

随着时间的推移，你的 Flutter 应用程序将会变得不可维护，并且比原生应用程序快得多。

## 3.在实际编码之前，在纸上计划你的方法

首先，规划您的小部件树结构。

从您的`main.dart`文件开始，到您的第一个屏幕及其小部件，考虑:

*   这些小部件将如何存储状态
*   无论您将使用`StatefulWidget`还是提供商包
*   是否需要任何小部件来监听公共数据源，如果需要，您将如何实现这一点
*   如何移动到另一个屏幕，以及如何与该屏幕共享数据(如果需要)
*   如何从子部件更新父部件
*   你将如何构建你的代码:仓库、网络、工具、模型、视图、视图模型等等。
*   如何保持代码的可测试性，例如，是否可以使用依赖注入

在纸上规划出你的 MVP 的整个流程。如果你遇到了障碍，做你的研究，找到可以帮助你的包和设计模式。

寻找以最干净的方式实现需求的最佳方式。

这可能需要一点额外的时间，但从长远来看，这是一项值得的投资。

## 4.不要多此一举

你知道我们怎么说的吗，“有一个应用程序可以做到这一点”？在 Flutter 中，如果你说“有一个包可以解决这个问题”，这几乎是真的。

由于令人惊奇的 Flutter 社区，现在有很多软件包。但是在选择使用哪个 Flutter 包时，您应该做好研究。

有一些只适用于 Android 的 Flutter 包和一些目前正在开发中的 Android 包。

如果您希望在 Android 和 iOS 上实现某个特定的功能，并且您依赖于某个包，请确保您构建了一个小型 POC 来检查该包在这两个平台上的功能。

你不会想在进入生产阶段时发现你所依赖的包在某个平台上不工作。

## 5.不要过度设计你的解决方案

是的，封锁很酷。但是你试过提供商套餐吗？

对于一些看起来复杂的情况，您可以很容易地使用一些基本的构建块(比如提供者包)来实现您的特性。

即便如此，有时当你试图修复复杂逻辑中的一个 bug 时，你可能最终会写出更复杂的代码，但仍然不能修复你的解决方案。

只是退一步，回到纸笔，计划一下。我相信你总能找到更简单更有效的方法。

## 6.热重装很酷，但是…

当我第一次听说颤振和尝试热重装，我只是太他妈的高兴和惊讶。当我开始构建更复杂的管理状态的应用程序时，我发现自己冷启动应用程序的次数比热重新加载更多。

重启有时会花费意想不到的长时间，这有点令人失望，毕竟热重装设置了很高的期望。还是比原生 app 搭建快。只是某些期望没有实现。

## 7.必须知道的

无论您是正在学习 Flutter 并打算立即投入到应用程序开发中，还是您仍在从多个来源学习并且对 Flutter 没有信心，这里有几个主题应该足以让您开始构建漂亮的、可伸缩的应用程序。

*   建筑布局
*   `StatelessWidget`与`StatefulWidget`——何时使用，何时可以避免使用`StatefulWidget`
*   `ChangeNotifier` /提供者包——如何为多个小部件提供一个公共的数据观察者
*   依赖注入与`GetIt`
*   在 Flutter 中编写测试

如果你觉得我错过了任何重要的话题，请在评论中告诉我。

## 8.免费学习的绝佳资源

Flutter 仍然在发展，所以你不能坚持用一年前的课程来让你了解最新的最佳实践。重要的是，你要密切关注以下资源，并不断学习，以便在游戏中保持领先。

*   [颤振群落](https://medium.com/flutter-community) —中
*   [火船](https://www.youtube.com/channel/UCsBjURrPoezykLs9EqgamOA)——YouTube
*   [ResoCoder](https://www.youtube.com/channel/UCSIvrn68cUk8CS8MbtBmBkA) — YouTube

我个人真的很感谢所有这些帮助我学习 Flutter 的资料，以及它们的作者。这些人一直在增加内容，敬请关注。

## 9.练习建筑布局

在推介 Flutter 解决方案时，您会想到的第一个品质是您可以自由地构建外观惊艳、流畅、响应迅速的 UI。

那么，确保这是你的强项。去网上找各种资源，比如运球，练习做这些布局。发挥 Flutter 的最大潜能。

一定要在网上分享你的作品，帮助别人从你身上学到更多。知识只有在分享时才会增长。

## 10.互操作性在这里，但是…

如果你有旧的原生应用程序在 Android 和 iOS 上运行，你可以考虑在 Flutter 中构建你的下一个功能——但这是以臃肿的应用程序大小为代价的。

不过，如果这不是一个大问题，也许你可以考虑迁移你的原生应用程序，一次一个屏幕，然后最终完成迁移，回到一个小得多的应用程序大小。

在进入项目并实现它之前，一定要检查如何在两个平台上实现互操作性。也许还可以学习如何将数据从本地应用程序发送到 Flutter 屏幕。

感谢阅读！