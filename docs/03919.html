<html>
<head>
<title>How to Shrink the Size of Your Android App With R8</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用R8缩小你的安卓应用的大小</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/shrink-your-android-app-with-r8-afe17c4d393?source=collection_archive---------7-----------------------#2020-03-12">https://betterprogramming.pub/shrink-your-android-app-with-r8-afe17c4d393?source=collection_archive---------7-----------------------#2020-03-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="22ed" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">当用户可以更快地下载你的应用程序时，他们可以更快地爱上它</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/616797064b84495191e1de931f6864a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jSIj3zijubVMuj-h"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@samwarren?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">山姆·沃伦</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="6305" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于现代企业来说，一个Android应用程序可以服务于许多目的。您可以开发一个定制的Android应用程序，提供所需的功能来简化业务，并轻松地与客户联系。</p><p id="61d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，你需要关注你的Android应用的大小。决定人们是否会安装你的应用的是应用的大小。多亏了R8，你可以用更轻的APK优化你的应用。</p><p id="35cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从Android应用程序开发的角度来讨论R8的角色。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="30bc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在Android Studio中启用R8的配置</h1><ol class=""><li id="eaf3" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">Android Studio版本3.4.0或更高版本。</li><li id="3041" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><a class="ae ky" href="http://tools.android.com/tech-docs/new-build-system/user-guide" rel="noopener ugc nofollow" target="_blank"> Android Gradle插件</a>版本3.4.0。</li><li id="b988" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><code class="fe nk nl nm nn b">minifyEnabled true</code> ( <code class="fe nk nl nm nn b">build.gradle</code>项目级代码优化)。</li><li id="43d9" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><code class="fe nk nl nm nn b">shrinkResources true</code> ( <code class="fe nk nl nm nn b">build.gradle</code>资源缩减的项目级别=可选)。</li></ol><p id="4b41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你使用Android Studio 3.4或Android Gradle plugin 3.4.0或更高版本时，R8是默认的编译器。</p><p id="ef99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能会想，在项目中运行或启用R8的实现步骤应该是什么，请不要想太多，因为只要您当前正在使用上述功能，就没有一行代码可以做到这一点。</p><blockquote class="no"><p id="35cb" class="np nq it bd nr ns nt nu nv nw nx lu dk translated">“请记住，R8旨在与您现有的ProGuard规则一起工作，因此您可能不需要采取任何行动来受益于R8。”—<a class="ae ky" href="https://developer.android.com/studio/build/shrink-code#shrink-code" rel="noopener ugc nofollow" target="_blank">Android Dev</a></p></blockquote><p id="0be1" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">谷歌非常注重构建性能，这表明谷歌是多么专注于此，以及他们愿意为此走多远。</p><p id="6062" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能在想幕后的过程是什么，对吗？那么，让我们来看看这个过程…</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="959f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">生成APK时构建流程</h1><ol class=""><li id="e63b" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">Desugar在编译期间将Java 8特性转换成可被<a class="ae ky" href="https://source.android.com/devices/tech/dalvik" rel="noopener ugc nofollow" target="_blank"> Dalvik </a> / <a class="ae ky" href="https://source.android.com/devices/tech/dalvik" rel="noopener ugc nofollow" target="_blank"> ART编译器</a>识别的东西。</li><li id="332d" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><a class="ae ky" href="https://www.guardsquare.com/en/products/proguard" rel="noopener ugc nofollow" target="_blank"> ProGuard </a>删除未使用的类、字段、方法和属性。</li><li id="5512" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">DEX编译器将Java字节码转换成Android的字节码。dex文件格式。</li></ol><p id="a37d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">后来，在2017年，谷歌推出了D8，这是DEX编译器的可选替代品。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="87ab" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">对于D8，构建过程如下所示</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/d6b65addc989fd3d899e7af930c02d41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aEqA0xYKQBNRpAa3Iyz7vA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://developer.android.com/studio/releases/#r8-default" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="0fcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ProGuard是一种压缩代码的技术，它检测并删除未使用的类、字段、方法、包和属性(包括代码库)。</p><ol class=""><li id="a6ac" class="mu mv it lb b lc ld lf lg li oe lm of lq og lu nb nc nd ne bi translated">收缩:它通过检测和删除未使用的代码来收缩代码。</li><li id="7173" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">优化器:它分析并优化字节码。</li><li id="d9b4" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">混淆器:它用短名称重命名优化的类和方法。(用于防止逆向工程)。</li></ol><p id="bf0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">D8运行速度更快，产量更小。与以前的编译器DX相比，dex文件具有相当或更好的运行时性能。</p><p id="8289" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谷歌在2018年将D8作为默认的DEX编译器。后来，在2019年，谷歌推出了R8，它是ProGuard的替代品，拥有D8的所有功能。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b23f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">对于R8，构建过程如下所示</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/3a5cf78fd2d1f9b49afac85557ce8e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yv6GU8-chujLhW_q4s79bw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://developer.android.com/studio/releases/#r8-default" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="4532" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为开发者，你们都知道我们只能相信实际的结果。所以，这就是为什么<a class="ae ky" href="https://android-developers.googleblog.com/2018/11/r8-new-code-shrinker-from-google-is.html" rel="noopener ugc nofollow" target="_blank"> Android官员</a>上传了下面的结果，以更好地了解R8如何比ProGuard工作得更快更好。</p><p id="8e41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是<a class="ae ky" href="https://github.com/madsager/santa-tracker-android" rel="noopener ugc nofollow" target="_blank">圣诞老人追踪器应用的结果。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/6b027db8531a8a727339be364afe2ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZzbjxpKlp1HMJimQ29o7Ew.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://android-developers.googleblog.com/2018/11/r8-new-code-shrinker-from-google-is.html" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/883083a000c54e77ae065f2ffedc8636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9rZXiBk68nVlkHEIGqQ6hA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://android-developers.googleblog.com/2018/11/r8-new-code-shrinker-from-google-is.html" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/f12b51459712e6337c28fd9cda8999ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GKFH12sUMH05bgwDCM4J4Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://android-developers.googleblog.com/2018/11/r8-new-code-shrinker-from-google-is.html" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fd7f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">R8配置文件</h1><ol class=""><li id="d517" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated"><code class="fe nk nl nm nn b">proguard-rules.pro</code> (Android Studio在那个模块的根目录下创建这个文件，你可以根据你的要求添加你的自定义ProGuard来保存规则。)</li><li id="80b4" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><code class="fe nk nl nm nn b">proguard-android-optimize.txt</code>(运行时由Android Gradle插件生成。)</li></ol><p id="5945" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想查看R8编译器的报告，请将下面几行添加到<code class="fe nk nl nm nn b">proguard-rules.pro</code>文件中</p><ol class=""><li id="bfed" class="mu mv it lb b lc ld lf lg li oe lm of lq og lu nb nc nd ne bi translated"><code class="fe nk nl nm nn b">-printconfiguration ~/tmp/full-r8-config.txt</code><strong class="lb iu"/>(R8的报告适用于构建您的项目。)</li><li id="5a83" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><code class="fe nk nl nm nn b">-printusage &lt;output-dir&gt;/usage.txt</code> <strong class="lb iu"> </strong>(被R8删除代码的报告。)</li><li id="c2cb" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><code class="fe nk nl nm nn b">-printseeds &lt;output-dir&gt;/seeds.txt</code><strong class="lb iu"/>(R8从你的项目的keep规则中确定的入口点的报告。)</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bb58" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">R8和普罗瓜德的区别</h1><h2 id="cd7e" class="oj md it bd me ok ol dn mi om on dp mm li oo op mo lm oq or mq lq os ot ms ou bi translated">R8</h2><p id="c743" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li ov lk ll lm ow lo lp lq ox ls lt lu im bi translated">R8在一个步骤中结合了去糖、收缩、模糊、优化和去索引，从而显著提高了构建性能。</p><h2 id="f3f4" class="oj md it bd me ok ol dn mi om on dp mm li oo op mo lm oq or mq lq os ot ms ou bi translated">ProgGuard</h2><p id="da16" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li ov lk ll lm ow lo lp lq ox ls lt lu im bi translated">ProGuard只集成了收缩、模糊和优化。</p><p id="9412" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据上面的陈述，ProGuard只对减少APK大小有效。因此，其他过程，如去糖和去兴，被额外包括在构建过程中，所以它们需要更多的时间来构建。</p><p id="0dae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">R8在一个步骤中处理三种不同的事情，所以它在一个步骤中完成整个构建过程，以减少编译的总时间。</p><p id="9c85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我绝对相信你会想让R8在你的项目中体验到建造过程时间的减少和APK规模的缩小。</p><p id="2791" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，<a class="ae ky" href="https://developer.android.com/studio/build/shrink-code#shrink-code" rel="noopener ugc nofollow" target="_blank"> R8 </a>到此为止。</p><p id="9169" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">快乐编码，我希望你喜欢看我的博客。</p></div></div>    
</body>
</html>