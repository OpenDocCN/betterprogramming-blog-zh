<html>
<head>
<title>An Introduction to MVVM in Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">《飘动中的MVVM》简介</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/mvvm-in-flutter-edd212fd767a?source=collection_archive---------1-----------------------#2019-12-09">https://betterprogramming.pub/mvvm-in-flutter-edd212fd767a?source=collection_archive---------1-----------------------#2019-12-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1b0d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在这篇文章中，我们将使用MVVM设计模式来编写一个完整的Flutter应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a714f5c14f69e45f8749c7e4037a24e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-H1sQ_4JwPAMyy5nQpSNKQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/photos/GC80BXJf0Yw" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@zuizuii" rel="noopener ugc nofollow" target="_blank"> Duy Huong </a>拍摄的照片</p></figure><p id="0bec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Flutter是一个跨平台的框架，允许你使用单一代码库编写iOS和Android应用。</p><p id="75da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，Flutter应用程序不使用任何特定的设计模式。这意味着开发人员负责选择和实现适合他们需求的模式。颤振的声明性本质使其成为MVVM设计模式的理想候选。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7ec5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">了解MVVM</h1><p id="a542" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://www.wintellect.com/model-view-viewmodel-mvvm-explained/" rel="noopener ugc nofollow" target="_blank"> MVVM </a>代表模型-视图-视图模型。基本思想是创建一个视图模型，为视图提供数据。视图可以使用视图模型提供的数据来填充自己。创建一个视图-模型层允许您编写模块化代码，这些代码可以被多个视图使用。</p><p id="646b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MVVM设计模式起源于微软。MVVM被大量用于编写Windows演示基础<a class="ae ky" href="https://docs.microsoft.com/en-us/visualstudio/designers/getting-started-with-wpf?view=vs-2019" rel="noopener ugc nofollow" target="_blank"> (WPF </a>)应用程序。MVVM模式是展示模型的一个别出心裁的名字。</p><div class="mz na gp gr nb nc"><a href="https://www.udemy.com/course/flutter-dart-mvvm-design-pattern/?referralCode=3E32698D188E47553501" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">终极手摇&amp; MVVM -建造真实的项目</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">Google Flutter框架风靡全球。Flutter允许开发人员编写一个单一的代码库…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">www.udemy.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq ks nc"/></div></div></a></div><p id="c5c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于设计模式是平台无关的，它可以用于任何框架，包括Flutter。</p><p id="4cc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一部分中，我们将创建一个电影应用程序，它将根据输入的关键字获取电影并显示给用户。这个应用程序将根据MVVM原则创建。在深入研究代码之前，先看看下面的动画，了解一下我们将要构建的应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/d51f4fb73f2889e33d16dd4b0935fb7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/1*TOGh3CqAER66VJcVEIBckA.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">电影spp</p></figure><h2 id="4218" class="ns md it bd me nt nu dn mi nv nw dp mm li nx ny mo lm nz oa mq lq ob oc ms od bi translated">实现web服务</h2><p id="e1cc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们将使用<a class="ae ky" href="http://www.omdbapi.com/" rel="noopener ugc nofollow" target="_blank"> OMDb </a> API来获取电影。确保您在他们的网站上注册以获得API密钥。没有有效的API密钥，您将无法执行成功的请求。</p><p id="d88d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您已经注册了OMDb服务并收到了您的密钥，我们可以继续实现web服务/客户机了。web服务使用<a class="ae ky" href="https://pub.dev/packages/http" rel="noopener ugc nofollow" target="_blank"> HTTP </a>包发出网络请求并下载JSON响应，但是您可以随意使用任何网络包。</p><p id="0acc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">JSON下载后，它被提供给电影模型以获得电影对象的列表，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="a56a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">电影模型实现如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="0652" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只包含一个标题和一张海报。它还公开了一个<code class="fe og oh oi oj b">fromJson</code>函数，允许我们基于JSON响应创建一个<code class="fe og oh oi oj b">Movie</code>对象。</p><p id="cf6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用术语<em class="ok">模型</em>来定义我们的<code class="fe og oh oi oj b">Movie</code>对象，但是，实际上，它们服务于数据传输对象(DTO)的目的。</p><p id="1833" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至此，我们已经获得了所有需要的数据，下一步是在屏幕上显示这些数据。在进入用户界面之前，我们必须创建视图模型，负责向视图提供数据。</p><h2 id="cbf7" class="ns md it bd me nt nu dn mi nv nw dp mm li nx ny mo lm nz oa mq lq ob oc ms od bi translated">实现视图模型</h2><p id="2b7a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">虽然您可以通过创建单个视图模型来获得想要的结果，但是我们将在我们的应用程序中创建两个单独的视图模型。</p><p id="ee4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个视图模型，<code class="fe og oh oi oj b">MoviesListViewModel</code>，将代表显示电影的整个屏幕。第二个视图模型<code class="fe og oh oi oj b">MovieViewModel</code>将代表一个单独的电影——它将在视图中显示。</p><p id="1df0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">视图模型的实现如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="c781" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe og oh oi oj b">MovieListViewModel</code>由movies属性组成，该属性将返回一列<code class="fe og oh oi oj b">MovieViewModel</code>对象。<code class="fe og oh oi oj b">MovieViewModel</code>接受一个<code class="fe og oh oi oj b">Movie</code>对象，并将标题和海报作为只读属性返回。下一步是使用web服务获取电影。</p><h2 id="5319" class="ns md it bd me nt nu dn mi nv nw dp mm li nx ny mo lm nz oa mq lq ob oc ms od bi translated">设置ChangeNotifier和ChangeNotifierProvider</h2><p id="7c25" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe og oh oi oj b">MovieListViewModel</code>中的<code class="fe og oh oi oj b">fetchMovies</code>方法负责在web服务的帮助下从OMDb API中检索电影。</p><p id="9990" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实现如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="985d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经更新了我们的<code class="fe og oh oi oj b">MovieListViewModel</code>来继承<code class="fe og oh oi oj b">ChangeNotifier</code>。<code class="fe og oh oi oj b">ChangeNotifier</code>允许我们发布变更通知，视图可以使用这些通知来更新自身。</p><p id="7dcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们使用web服务获取电影之后，我们调用<code class="fe og oh oi oj b">notifyListeners</code>函数，通知所有的订阅者/听众。目前，没有人听，所以没有人被通知电影已经下载。</p><p id="00c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了用更新后的<code class="fe og oh oi oj b">MovieListViewModel</code>通知视图，我们将不得不使用<code class="fe og oh oi oj b">ChangeNotifierProvider</code> <strong class="lb iu">、</strong>这是<a class="ae ky" href="https://pub.dev/packages/provider" rel="noopener ugc nofollow" target="_blank">提供方</a>包的<strong class="lb iu">、</strong>部分。通过在<code class="fe og oh oi oj b">pubspec.yaml</code>文件中添加依赖项来添加提供方包，如下图所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="153d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要找到一个好的地方，从供应商那里注入价值。我们谈论的价值是<code class="fe og oh oi oj b">MovieListViewModel</code>的一个实例，因为它扩展了<code class="fe og oh oi oj b">ChangeNotifier</code>并且向听众发布通知。</p><p id="f065" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，我们可以使用<code class="fe og oh oi oj b">main.dart</code>文件并将值注入到<code class="fe og oh oi oj b">MovieListPage</code>中。这意味着<code class="fe og oh oi oj b">MovieListViewModel</code>将可用于<code class="fe og oh oi oj b">MovieListPage</code>及其所有子代。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="cd40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太棒了。最后一步是在屏幕上显示数据。这将在下一节中介绍。</p><h2 id="ffac" class="ns md it bd me nt nu dn mi nv nw dp mm li nx ny mo lm nz oa mq lq ob oc ms od bi translated">显示电影</h2><p id="8770" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于我们的应用程序，我们会要求用户输入关键字，然后按键盘上的返回键。这将调用<code class="fe og oh oi oj b">MovieListViewModel</code>上的<code class="fe og oh oi oj b">fetchMovies</code>方法，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="5897" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe og oh oi oj b">fetchMovies</code>将根据关键字获取所有电影，并触发<code class="fe og oh oi oj b">notifyListeners</code>。为了获得<code class="fe og oh oi oj b">MovieListViewModel</code>的更新实例，我们将从提供程序包中获得帮助，如下所示:</p><pre class="kj kk kl km gt ol oj om on aw oo bi"><span id="8d6a" class="ns md it oj b gy op oq l or os">@override Widget build(BuildContext context) { <br/>final vm = Provider.of&lt;MovieListViewModel&gt;(context);</span></pre><p id="90aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过在构建方法中添加<code class="fe og oh oi oj b">Provider</code>，我们确保无论何时<code class="fe og oh oi oj b">notifyListener</code>被激发，我们都可以访问<code class="fe og oh oi oj b">MovieListViewModel</code>的实例。</p><p id="2105" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果你运行你的应用程序，它会根据关键词获取电影，并在用户界面上显示出来。</p><p id="30b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想在页面加载时进行初始提取，那么您可以将<code class="fe og oh oi oj b">StatelessWidget</code>更新为<code class="fe og oh oi oj b">StatefulWidget</code>并从<code class="fe og oh oi oj b">initState</code>方法内部调用<code class="fe og oh oi oj b">fetchMovies</code>，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="e117" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们将<code class="fe og oh oi oj b">listen: false</code>传递给了<code class="fe og oh oi oj b">Provider</code>，这意味着这只是一次调用，更改不会被<code class="fe og oh oi oj b">Provider</code>跟踪。</p><p id="ee60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在此查看GitHub回购<a class="ae ky" href="https://github.com/azamsharp/Movies-App-Flutter-MVVM" rel="noopener ugc nofollow" target="_blank">。</a></p><div class="mz na gp gr nb nc"><a href="https://www.udemy.com/course/flutter-dart-mvvm-design-pattern/?referralCode=3E32698D188E47553501" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">终极手摇&amp; MVVM -建造真实的项目</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">Google Flutter框架风靡全球。Flutter允许开发人员编写一个单一的代码库…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">www.udemy.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq ks nc"/></div></div></a></div><p id="9832" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>