<html>
<head>
<title>Secrets Management Stinks, Use Some SOPS!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">秘密管理很糟糕，使用一些标准操作程序！</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/secrets-management-stinks-use-some-sops-43a92b7b8d54?source=collection_archive---------5-----------------------#2019-06-24">https://betterprogramming.pub/secrets-management-stinks-use-some-sops-43a92b7b8d54?source=collection_archive---------5-----------------------#2019-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c431" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过使用GPG在YAML使用sop加密/解密凭证</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ee36bdb493bf6f51c1e068c54663cecb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XbnYCd95uVv5NeCoc7IeUw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">伊利斯·圣克莱尔在<a class="ae ky" href="https://unsplash.com/search/photos/vista?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="705c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">动机</h1><p id="e807" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">假设您正在进行一个软件项目，需要处理凭证。例如:</p><ul class=""><li id="a944" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">您需要从应用程序中访问数据库</li><li id="14c3" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">您需要向AWS或Google Cloud等云服务提供凭证</li><li id="7436" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">您需要将凭证传递给CI/CD工具来构建您的应用程序</li></ul><p id="0802" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">凭证很重要的例子还有很多。通常，您会将凭证存储在YAML或JSON文件中，然后将其放入项目文件夹中。</p><h2 id="b042" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">项目结构</h2><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="c233" class="ng la it nt b gy nx ny l nz oa">.<br/>├── src/<br/>│   └── ...<br/>├── app.py<br/>├── credentials.yml<br/>├── ...</span></pre><p id="7707" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">我经常看到的一个不好的做法是，用明文凭证对项目进行版本控制。因此，有权访问项目存储库的每个人都能够查看凭证。通常，您只希望参与项目的人员能够访问。这篇文章强调了我们如何使用<a class="ae ky" href="https://github.com/mozilla/sops" rel="noopener ugc nofollow" target="_blank">秘密操作或者短sops </a>和<a class="ae ky" href="https://en.wikipedia.org/wiki/GNU_Privacy_Guard" rel="noopener ugc nofollow" target="_blank"> GPG </a>来解决这个问题。</p><h1 id="3fc4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">SOPS ftw</h1><p id="3c5f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我最近发现sop可以使用在<a class="ae ky" href="https://aws.amazon.com/kms/" rel="noopener ugc nofollow" target="_blank"> AWS KMS </a>、<a class="ae ky" href="https://cloud.google.com/kms/" rel="noopener ugc nofollow" target="_blank"> GCP KMS </a>、<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/key-vault/" rel="noopener ugc nofollow" target="_blank"> Azure Key Vault </a>或<a class="ae ky" href="https://en.wikipedia.org/wiki/Pretty_Good_Privacy" rel="noopener ugc nofollow" target="_blank"> PGP </a>中生成的加密密钥来加密/解密YAML、JSON和二进制格式的文件(我们实际上为此使用了<a class="ae ky" href="https://en.wikipedia.org/wiki/GNU_Privacy_Guard" rel="noopener ugc nofollow" target="_blank"> GPG </a>)。在Python的Go中已经重写了。Python分支依然存在，并被积极维护；但是，我们推荐Go版本。</p><p id="f857" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">使用brew在Mac上安装sop(确保你已经预装了Go和GPG)。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="c768" class="ng la it nt b gy nx ny l nz oa">brew install sops</span></pre><p id="8ff9" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">接下来，用GPG生成一个加密密钥。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/ddd4cbd2c886b6c469b4f3a96dd9e154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_M7dPGxMOaqKciEf"/></div></div></figure><p id="404f" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">您将能够看到密钥是否创建正确。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/bdde63212fe59ab924e3e97bccd2efe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ICxP7rWb0Z7hq-zX"/></div></div></figure><p id="6726" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">使用创建的加密密钥的指纹来生成加密的YAML文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/c4a369ba98c29d19e51cd08a0326f14a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sCpr3EieHQ3vGIIA"/></div></div></figure><p id="8631" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">在项目文件夹中使用sop创建YAML文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/de3ac9b49b267557fa4f4591b2e234a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*a6rc7H1ES_ABasf2"/></div></div></figure><p id="bcd4" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">最后，创建了YAML文件。您应该能够看到文件被正确加密(例如，使用Vim而不进行任何解密)。</p><p id="1292" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">重复这些步骤来解密文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/9cd60bf2e4011d611452e205e86728c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1ecvdzt5OWnxu3Wu"/></div></div></figure><p id="3e0c" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">您还可以导出加密密钥供其他团队成员导入。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="101b" class="ng la it nt b gy nx ny l nz oa"># export encryption key / get fingerprint via 'gpg --fingerprint'<br/>gpg --export-secret-keys --armor 'fingerprint' &gt; private.rsa</span><span id="917d" class="ng la it nt b gy od ny l nz oa"># import encryption key<br/>gpg --import private.rsa</span></pre><h1 id="eb81" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">加密快乐！</h1></div></div>    
</body>
</html>