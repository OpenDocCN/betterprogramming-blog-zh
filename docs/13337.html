<html>
<head>
<title>Optimize the User Experience and Performance via Node.js and Lighthouse</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Node.js和Lighthouse优化用户体验和性能</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/optimize-the-user-experience-and-performance-via-node-js-and-lighthouse-bfd8107fe248?source=collection_archive---------16-----------------------#2022-08-17">https://betterprogramming.pub/optimize-the-user-experience-and-performance-via-node-js-and-lighthouse-bfd8107fe248?source=collection_archive---------16-----------------------#2022-08-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="99ba" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">同时改善两者的技巧</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/0edfa375578ca027e7927de92de678f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*VPt7aKTugk3VXntCp0mhsQ.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">尼古拉斯·霍伊泽在<a class="ae kr" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片|图像高度有所改变</p></figure><blockquote class="ks"><p id="16fc" class="kt ku iq bd kv kw kx ky kz la lb lc dk translated">想一想:为什么你要把精力集中在优化用户界面和应用程序的用户体验上，而不是集中在整个事情的性能方面？</p></blockquote><p id="4dac" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx lc ij bi translated">我相信UX/UI的改进可以带来更好的性能。产品负责人和技术人员将会从中受益。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><p id="b9e4" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">最近，我通过Lighthouse实现了一个自动化的后期构建管道，以自动化视觉和性能测试。我们正在收集指标、截图、测试和性能结果，在手动分析这些之后，我们实现了一些更改、一些UX改进、一些功能删除等等。</p><p id="2166" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">我们在前端代码库(我们使用微前端架构)的Grafana仪表板上实现了许多改进和一个很好的历史图表。</p><p id="9151" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">让我们深入了解这些改进。</p><h1 id="86f5" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">场景是怎样的？</h1><p id="8e5a" class="pw-post-body-paragraph ld le iq lf b lg nc jr li lj nd ju ll lm ne lo lp lq nf ls lt lu ng lw lx lc ij bi translated">我曾为一家受欢迎的意大利电子邮件营销平台工作，这是一个顶级的多渠道云平台，有10，000多家客户使用它来改进他们的电子邮件和短信营销策略。</p><p id="bb61" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">我们致力于通过改进性能、用户界面和用户体验，为最终用户提供最佳体验。</p><p id="b3a6" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">该平台有许多日常使用的功能和页面，正因为如此，每个版本都很重要。我们正在开发一个微前端架构，每周每个项目交付超过30个版本。</p><p id="6fb2" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">除了e2e、a/b测试、压力测试等。，我们希望监控每一个前端版本，以检查我们是否在UI/UX或客户端性能上做了改进。</p><h1 id="b88f" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">对于我们的情况，哪一个是最好的解决方案？</h1><p id="e749" class="pw-post-body-paragraph ld le iq lf b lg nc jr li lj nd ju ll lm ne lo lp lq nf ls lt lu ng lw lx lc ij bi translated">我们想了很多，提出了很多有正反两面的假设方案。我们最终在我们的Jenkins pipelines of Lighthouse中使用Node.js、Puppeteer、Prometheus和Grafana定制了一个实现。</p><p id="2828" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">我们使用Lighthouse metrics来监控新的开发、移植任务、UI/UX改进、性能等等。</p><p id="4065" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">通过收集这些指标，我们还可以通过Prometheus和Grafana获得历史数据来比较“旧”和“新”。当然，一切都应该是可移植的，所以我们使用了Docker来实现可移植性，并在我们的云提供商(AWS)上部署一切。</p><h1 id="82d7" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">使用了哪些技术？</h1><p id="662d" class="pw-post-body-paragraph ld le iq lf b lg nc jr li lj nd ju ll lm ne lo lp lq nf ls lt lu ng lw lx lc ij bi translated">所有提议的技术都是开源库。以下是我们使用的方法:</p><p id="22f7" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">puppet eer——一个节点库，它提供了一个高级API来通过DevTools协议控制Chrome或Chrome。因此，您拥有一个在后台运行的Chromium实例，并拥有完全的控制权！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/76bd9cb9117c88f8c810e571f7a48768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Eq_Y5YZS9GOe2iEx"/></div></div></figure><p id="1ab1" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">普罗米修斯——一个用于数据建模和时间序列数据库的开源系统。我们用它作为Grafana的数据提供者。</p><p id="d367" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">grafana——开源分析和监控解决方案。它允许你建立你的仪表板，提高你的应用程序的可观察性。</p><p id="8351" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">light house——一个开源的自动化工具，用于提高谷歌制作的网页质量。它的架构是围绕Chrome调试协议构建的，这是一组与Chrome实例交互的低级API。它与一个Chrome实例接口。</p><p id="cf83" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">这些审核来自于新的现代网络标准，比如页面上的第一次内容绘制、渲染时间等。你可以在https://web.dev/measure/找到更多信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/1b9caec944e0fa06f0d396b59c2c0db6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/0*p6KMhXblcc9D7Epc"/></div></figure><p id="769c" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">我们选择开源项目是因为我们真的相信开源。我们的项目很快就可以在一个开源仓库中获得。</p><h1 id="9769" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">我们如何实施解决方案</h1><p id="6ca9" class="pw-post-body-paragraph ld le iq lf b lg nc jr li lj nd ju ll lm ne lo lp lq nf ls lt lu ng lw lx lc ij bi translated">我们尝试了许多不同的架构和实现，最终我们做到了以下几点:</p><ul class=""><li id="a0b3" class="nn no iq lf b lg mf lj mg lm np lq nq lu nr lc ns nt nu nv bi translated">在节点实例上构建我们的解决方案</li><li id="7d34" class="nn no iq lf b lg nw lj nx lm ny lq nz lu oa lc ns nt nu nv bi translated">在后台运行的无头浏览器(puppeteer)中为我们的API执行web服务器</li><li id="c000" class="nn no iq lf b lg nw lj nx lm ny lq nz lu oa lc ns nt nu nv bi translated">获取灯塔指标</li><li id="a85a" class="nn no iq lf b lg nw lj nx lm ny lq nz lu oa lc ns nt nu nv bi translated">在S3/磁盘上写入指标</li><li id="c2f3" class="nn no iq lf b lg nw lj nx lm ny lq nz lu oa lc ns nt nu nv bi translated">通过普罗米修斯收集它们，这样我们就能最终从格拉夫纳那里取回它</li></ul><p id="af1f" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">这是我们的架构模式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi ob"><img src="../Images/033b14cbe2ea096a659350c5d4140fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1kpCWiWlNlY2B0uc"/></div></div></figure><p id="d66c" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">我们的节点实例服务于端点，通过cURL bash命令从Jenkins管道收集指标。</p><p id="cd59" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">API对请求中作为参数传递的URL执行了lighthouse测试，这样我们就可以将浏览器重定向(通过一个木偶实例)到正确的页面。</p><p id="73f5" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">当然，我们的平台有一个表单认证，所以我们首先需要对我们的演示平台进行认证。为了给你一个解决方案的例子，我将通过puppeteer和Node.js向你展示我们的认证流程的一个片段。</p><p id="a5a7" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">当我们使用木偶师时，我们复制了真实用户的任何动作。因此，我们将点击按钮，输入输入，并将鼠标移动到页面上的一个方向来模拟用户的动作。</p><p id="a85e" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">在下面的代码片段中，您可以看到我们是如何实现<code class="fe oc od oe of b">signIn</code>函数以及木偶师API是如何工作的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><h1 id="2c26" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">这个项目的成果是什么？</h1><p id="b801" class="pw-post-body-paragraph ld le iq lf b lg nc jr li lj nd ju ll lm ne lo lp lq nf ls lt lu ng lw lx lc ij bi translated">我们设法构建了我们的解决方案，并通过Jenkins中的后构建触发器将我们的自动化附加到每个微前端应用程序。这将触发一个API来收集任何页面或特性的指标。</p><p id="186b" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">这是来自我们本地仪表板的图像，检索页面指标、得分、次数、审核等:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi oi"><img src="../Images/b0a9fd6ea2eddbf5a4196eadbf28c39a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v0MdCUx9ImjuG4lD"/></div></div></figure><p id="0941" class="pw-post-body-paragraph ld le iq lf b lg mf jr li lj mg ju ll lm mh lo lp lq mi ls lt lu mj lw lx lc ij bi translated">通过使用这个工具，我们允许产品和设计团队控制他们的客户旅程和用户流/ UX性能。我们使技术团队能够了解特定版本中的问题或性能方面的重大改进。</p><blockquote class="oj ok ol"><p id="45fe" class="ld le om lf b lg mf jr li lj mg ju ll on mh lo lp oo mi ls lt op mj lw lx lc ij bi translated">有趣的是:我们改变了CDN缓存和交付资产的方式，并且由于Grafana的历史图表，我们设法看到了我们指标的变化。</p></blockquote><h1 id="df2d" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">外卖食品</h1><ul class=""><li id="afcf" class="nn no iq lf b lg nc lj nd lm oq lq or lu os lc ns nt nu nv bi translated">我们相信Lighthouse是分析和监控我们的应用程序的一个很好的工具。</li><li id="5b12" class="nn no iq lf b lg nw lj nx lm ny lq nz lu oa lc ns nt nu nv bi translated">最大的挑战是在容器中实现平台的认证和业务逻辑，但是我们做到了！</li><li id="030f" class="nn no iq lf b lg nw lj nx lm ny lq nz lu oa lc ns nt nu nv bi translated">收集发布前和发布后的指标让我们更加清楚我们的目标，并且让我们对整个应用程序设计有一个大的了解，以提高UX</li><li id="bdac" class="nn no iq lf b lg nw lj nx lm ny lq nz lu oa lc ns nt nu nv bi translated">改进产品开发流程</li></ul><blockquote class="ks"><p id="c667" class="kt ku iq bd kv kw kx ky kz la lb lc dk translated">我的最后一个建议是，总是尝试改进和自动化一切！</p></blockquote></div></div>    
</body>
</html>