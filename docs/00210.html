<html>
<head>
<title>App Actions &amp; Slices — Extending Your App to Use Google Search &amp; Google Assistant</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">应用程序操作和切片——扩展您的应用程序以使用谷歌搜索和谷歌助手</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/app-actions-slices-extending-your-app-to-google-search-google-assistant-30dd803d4e79?source=collection_archive---------0-----------------------#2018-10-18">https://betterprogramming.pub/app-actions-slices-extending-your-app-to-google-search-google-assistant-30dd803d4e79?source=collection_archive---------0-----------------------#2018-10-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="70fc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何为你的应用程序创建一个简单的切片，并让用户在应用程序之外用更丰富的UI执行任务</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a56006c3cab63a8c27479cd7280302f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o2RVFWkmzm_TtasJU0LiTA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Bapusaheb Patil的横幅<a class="ae kv" href="https://bapspatil.com" rel="noopener ugc nofollow" target="_blank">Google的Jetpack标志</a></p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="kw kx l"/></div></figure><p id="d531" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">这篇文章是写给刚刚开始使用<a class="ae kv" href="https://developer.android.com/guide/actions/" rel="noopener ugc nofollow" target="_blank">应用动作</a>和<a class="ae kv" href="https://developer.android.com/guide/slices/" rel="noopener ugc nofollow" target="_blank">切片</a>的开发者的。</p><p id="7537" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">请注意，在写这篇文章的时候，Google还没有提供创建应用程序的功能。这里有一张<a class="ae kv" href="https://docs.google.com/forms/d/e/1FAIpQLSfzg7DrFtD8S_tHrYYoWpmsfFzLuduukoQQY6A2AtHsxTHgKg/viewform" rel="noopener ugc nofollow" target="_blank">表格</a>，你可以填写它，以便在它可用时得到通知。</p><p id="015e" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">尽管如此，我们可以创建切片，这也是本文的重点。</p><p id="65ea" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">但首先，我们来谈谈什么是App动作和切片，以及它们之间的关系。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="077b" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">什么是App动作？</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/953b478ecf20fbea30a7f53c40bf4b9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FfvLqkZt-4RDtWdVoVWPhg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">截图来自官方<a class="ae kv" href="https://developer.android.com/guide/actions/" rel="noopener ugc nofollow" target="_blank"> App动作页面</a></p></figure><p id="8045" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><strong class="la ir">应用动作</strong>是一种通过让用户在你的应用之外执行动作<em class="mu">来为你的用户提供更丰富用户体验的方式。这可能是在谷歌搜索，你的安卓启动器，甚至谷歌助手。如果你搜索一部电影，它看起来就像这里的截图。注意这里的<strong class="la ir">最后两个搜索结果</strong>；都是App动作。</em></p><p id="7de0" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">让我们考虑另一个例子:你可以长按Home键打开谷歌助手，你需要做的就是开始输入“工作”，然后它会显示一个结果，点击后直接为你订购一辆优步。</p><p id="cb8f" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">相比之下，你通常需要做些什么来获得优步，你已经让你的生活变得更容易了——可能是因为用应用程序操作做同样的任务需要大约8秒钟，而用通常的方法会花更长的时间！</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="83c3" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">什么是切片？</h1><p id="10b1" class="pw-post-body-paragraph ky kz iq la b lb mv jr ld le mw ju lg lh mx lj lk ll my ln lo lp mz lr ls lt ij bi translated">应用程序动作和切片这两个概念一开始很难区分。</p><p id="c21b" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><strong class="la ir">基本上，你可以说切片是超级充电的App动作。</strong></p><p id="9326" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">切片是显示在你的应用程序之外的小块用户界面，它们使你的用户能够从你的应用程序中看到和访问某些<strong class="la ir">交互</strong>、<strong class="la ir">图像</strong>、<strong class="la ir">文本</strong>，甚至<strong class="la ir">视频</strong>，从而丰富你的应用程序操作！</p><p id="ad45" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">切片有<strong class="la ir">单机</strong>和<strong class="la ir">互动</strong>。它们为用户提供了他们可以在完整的应用程序体验之外执行的相关操作，即用户不必每次都打开应用程序。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="d48f" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">让我们开始构建我们的第一个切片…</h1><p id="5c45" class="pw-post-body-paragraph ky kz iq la b lb mv jr ld le mw ju lg lh mx lj lk ll my ln lo lp mz lr ls lt ij bi translated">你需要在手机上安装<strong class="la ir"> Android Studio 3.2 </strong>和<strong class="la ir">slice viewer</strong>；这个可以从<a class="ae kv" href="https://github.com/googlesamples/android-SliceViewer/releases" rel="noopener ugc nofollow" target="_blank"> <strong class="la ir">这里下载</strong> </a>。另外，请注意，本教程将在科特林。</p><p id="5ccd" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">以下是本文的示例应用程序:</p><div class="na nb gp gr nc nd"><a href="https://github.com/bapspatil/SlicesPlayground" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">bapspatil/slice playground</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">一个用于玩Android切片的游乐场存储库。-bapspatil/slice playground</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr kp nd"/></div></div></a></div><h2 id="5d47" class="ns mc iq bd md nt nu dn mh nv nw dp ml lh nx ny mn ll nz oa mp lp ob oc mr od bi translated">步骤1:添加切片依赖关系</h2><p id="f545" class="pw-post-body-paragraph ky kz iq la b lb mv jr ld le mw ju lg lh mx lj lk ll my ln lo lp mz lr ls lt ij bi translated">将以下几行添加到应用程序级<code class="fe oe of og oh b">build.gradle</code>文件的依赖项中:</p><pre class="kg kh ki kj gt oi oh oj ok aw ol bi"><span id="6ba6" class="ns mc iq oh b gy om on l oo op">implementation "androidx.slice:slice-builders-ktx:1.0.0-alpha6"<br/>implementation "androidx.annotation:annotation:1.0.0"</span></pre><h2 id="d329" class="ns mc iq bd md nt nu dn mh nv nw dp ml lh nx ny mn ll nz oa mp lp ob oc mr od bi translated">步骤2:创建一个SliceProvider来处理所有切片</h2><p id="9f9a" class="pw-post-body-paragraph ky kz iq la b lb mv jr ld le mw ju lg lh mx lj lk ll my ln lo lp mz lr ls lt ij bi translated">您将需要一个<code class="fe oe of og oh b"><a class="ae kv" href="https://developer.android.com/reference/androidx/slice/SliceProvider" rel="noopener ugc nofollow" target="_blank">SliceProvider</a></code>类来向Android操作系统提供应用程序中的所有片段。您创建的切片由一个<code class="fe oe of og oh b"><a class="ae kv" href="https://developer.android.com/reference/android/net/Uri" rel="noopener ugc nofollow" target="_blank">Uri</a></code>标识，您的<code class="fe oe of og oh b">SliceProvider</code>根据它接收到的<code class="fe oe of og oh b">Uri</code>提供切片。</p><p id="ee48" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">为此，点击<strong class="la ir">文件&gt;新建&gt;其他&gt;切片提供器</strong>。</p><p id="35c5" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">您将看到一个包含以下字段的对话框:</p><ul class=""><li id="a455" class="oq or iq la b lb lc le lf lh os ll ot lp ou lt ov ow ox oy bi translated"><strong class="la ir">类名称</strong> —这将是您的<code class="fe oe of og oh b">SliceProvider</code>类的名称。在这个例子中，是<code class="fe oe of og oh b">MySliceProvider</code>。</li><li id="5e0f" class="oq or iq la b lb oz le pa lh pb ll pc lp pd lt ov ow ox oy bi translated">URI当局, —这是我建议与你的包裹名称保持一致的东西。在这个例子中，是<code class="fe oe of og oh b">com.bapspatil.slicesplayground</code>。</li><li id="a5c9" class="oq or iq la b lb oz le pa lh pb ll pc lp pd lt ov ow ox oy bi translated"><strong class="la ir">主机URL </strong> —这将是您的域名。在本例中，是<a class="ae kv" href="http://bapspatil.com" rel="noopener ugc nofollow" target="_blank">bapspatil.com</a>。</li><li id="2730" class="oq or iq la b lb oz le pa lh pb ll pc lp pd lt ov ow ox oy bi translated"><strong class="la ir"> URI当局</strong> —这是指主机URL，它是从主机URL映射到我们的<code class="fe oe of og oh b">SliceProvider</code>的东西。你现在可以把它设置为<code class="fe oe of og oh b">/hello</code>。</li></ul><p id="7d73" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">这一步将一个<code class="fe oe of og oh b">provider</code>添加到您的<code class="fe oe of og oh b">AndroidManifest.xml</code>文件中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pe kx l"/></div></figure><h2 id="dba5" class="ns mc iq bd md nt nu dn mh nv nw dp ml lh nx ny mn ll nz oa mp lp ob oc mr od bi translated">步骤3:在您的SliceProvider中实现onBindSlice方法</h2><p id="34fe" class="pw-post-body-paragraph ky kz iq la b lb mv jr ld le mw ju lg lh mx lj lk ll my ln lo lp mz lr ls lt ij bi translated"><code class="fe oe of og oh b"><a class="ae kv" href="https://developer.android.com/reference/androidx/slice/SliceProvider.html#onBindSlice(android.net.Uri)" rel="noopener ugc nofollow" target="_blank">onBindSlice</a></code>方法返回一个<code class="fe oe of og oh b"><a class="ae kv" href="https://developer.android.com/reference/androidx/slice/Slice" rel="noopener ugc nofollow" target="_blank">Slice</a></code>，它被作为参数传递给<code class="fe oe of og oh b">onBindSlice</code>的<code class="fe oe of og oh b">Uri</code>识别。我们需要实现<code class="fe oe of og oh b">onBindSlice</code>方法来为特定的<code class="fe oe of og oh b">Uri</code>创建一个<code class="fe oe of og oh b">Slice</code>，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pe kx l"/></div></figure><h2 id="be00" class="ns mc iq bd md nt nu dn mh nv nw dp ml lh nx ny mn ll nz oa mp lp ob oc mr od bi translated">步骤4:为切片创建SliceAction</h2><p id="9fc0" class="pw-post-body-paragraph ky kz iq la b lb mv jr ld le mw ju lg lh mx lj lk ll my ln lo lp mz lr ls lt ij bi translated">在上面的<code class="fe oe of og oh b">onBindSlice</code>方法实现中，我们通过调用方法<code class="fe oe of og oh b">createActivityAction()</code>初始化了一个变量<code class="fe oe of og oh b">activityAction</code>。这将返回一个<code class="fe oe of og oh b"><a class="ae kv" href="https://developer.android.com/reference/androidx/slice/builders/SliceAction" rel="noopener ugc nofollow" target="_blank">SliceAction</a></code>。</p><p id="b0ee" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">A <code class="fe oe of og oh b">SliceAction</code>用于处理<code class="fe oe of og oh b">Slice</code>上的点击，如果不将<code class="fe oe of og oh b">row</code>中的<code class="fe oe of og oh b">primaryAction</code>设置为a <code class="fe oe of og oh b">SliceAction</code>，即不将<code class="fe oe of og oh b">null</code>的值设置为<code class="fe oe of og oh b">primaryAction</code>，则<code class="fe oe of og oh b">Slice</code>不会显示。</p><p id="3b8f" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">下面是我们如何创建一个<code class="fe oe of og oh b">SliceAction</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pe kx l"/></div></figure><p id="76e9" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们现在已经完成了切片的创建！</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="51ca" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">我如何查看我的切片？</h1><p id="915a" class="pw-post-body-paragraph ky kz iq la b lb mv jr ld le mw ju lg lh mx lj lk ll my ln lo lp mz lr ls lt ij bi translated">一旦你在手机上安装了<a class="ae kv" href="https://github.com/googlesamples/android-SliceViewer/releases" rel="noopener ugc nofollow" target="_blank"> SliceViewer工具</a>，你需要在Android Studio中添加一个新的<strong class="la ir">运行配置</strong>来测试你的切片。</p><ol class=""><li id="02d2" class="oq or iq la b lb lc le lf lh os ll ot lp ou lt pf ow ox oy bi translated">点击<strong class="la ir">运行&gt;编辑配置… </strong></li><li id="7840" class="oq or iq la b lb oz le pa lh pb ll pc lp pd lt pf ow ox oy bi translated">点击+按钮，选择<strong class="la ir">安卓应用</strong>，在<strong class="la ir">名称</strong>字段将配置名称设置为<code class="fe oe of og oh b">slice</code>。</li><li id="e668" class="oq or iq la b lb oz le pa lh pb ll pc lp pd lt pf ow ox oy bi translated">在<strong class="la ir">启动选项</strong>下，将<strong class="la ir">启动</strong>的值从下拉列表更改为<strong class="la ir"> URL </strong>，并将<strong class="la ir"> URL </strong>设置为<code class="fe oe of og oh b">slice-content://com.bapspatil.slicesplayground/hello</code>，这是您在<code class="fe oe of og oh b">AndroidManifest.xml</code>文件中的权限名称，后跟您想要查看的切片的<code class="fe oe of og oh b">Uri</code>路径。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/cbce0608a790a89624ceb4e360522c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YwcMbKwGraNVsQKiWg_tuw.gif"/></div></div></figure><p id="62b3" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">仅此而已。连接您的设备，选择<code class="fe oe of og oh b">slice</code>配置后点击<strong class="la ir">运行</strong>。然后，根据屏幕上的提示，允许SliceViewer查看您的切片，并查看它的运行情况！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/d8ac94679d8981a1a5f40552ee260054.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/1*OYyzSbZiiBXL-ApAzGLLOg.gif"/></div></figure><p id="962b" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">本文中演示应用程序的源代码可以在这里找到:</p><div class="na nb gp gr nc nd"><a href="https://github.com/bapspatil/SlicesPlayground" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">bapspatil/slice playground</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">一个用于玩Android切片的游乐场存储库。-bapspatil/slice playground</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="pi l no np nq nm nr kp nd"/></div></div></a></div><p id="1987" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>