<html>
<head>
<title>Introduction to Waitress: A WSGI Server for Python 2 and 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WSGI简介:Python 2和3的WSGI服务器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/introduction-to-waitress-a-wsgi-server-for-python-2-and-3-c77e20cb292b?source=collection_archive---------1-----------------------#2020-01-15">https://betterprogramming.pub/introduction-to-waitress-a-wsgi-server-for-python-2-and-3-c77e20cb292b?source=collection_archive---------1-----------------------#2020-01-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1729" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将您的Flask服务器自托管并提供给生产WSGI服务器</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c984b9bbd95666d0aac128c2c6f6cfa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ja3JYMe1gnPq1eglFVBtuw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">斯科特·韦伯在<a class="ae ky" href="https://unsplash.com/s/photos/waitress?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b53b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您已经通过命令行运行了您的<a class="ae ky" href="https://www.palletsprojects.com/p/flask/" rel="noopener ugc nofollow" target="_blank"> Flask </a>服务器:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6b88" class="ma mb it lw b gy mc md l me mf">python myapp.py</span></pre><p id="d26f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/2a65a91781bcbccf700b7a4345c95c69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QhAtNbe3kbsrhrLL68VzDw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="55e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您公开运行时，强烈建议不要使用由<a class="ae ky" href="https://www.palletsprojects.com/p/werkzeug/" rel="noopener ugc nofollow" target="_blank"> Werkzeug </a>提供的开发服务器，因为它不是用于生产的。开发服务器效率不高，不稳定，也不安全。</p><p id="107e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以选择将它部署在第三方主机上，如<a class="ae ky" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>或者用一个独立的容器自托管它。</p><p id="84ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="http://docs.pylonsproject.org/projects/waitress/en/stable/" rel="noopener ugc nofollow" target="_blank">waste</a>是这种容器的一个例子，它既适用于Windows又适用于Linux。根据官方文件，女服务员应该是:</p><blockquote class="mh"><p id="3ed7" class="mi mj it bd mk ml mm mn mo mp mq lu dk translated">“…一个生产质量的纯Python WSGI服务器，性能非常好。除了Python标准库中的依赖项之外，它没有其他依赖项。它在Unix和Windows上的CPython上运行。”</p></blockquote><p id="3862" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">本教程包含三个部分:</p><ol class=""><li id="f465" class="mw mx it lb b lc ld lf lg li my lm mz lq na lu nb nc nd ne bi translated">设置</li><li id="16c7" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">基本用法</li><li id="0a84" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">结论</li></ol></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="02df" class="nr mb it bd ns nt nu nv nw nx ny nz oa jz ob ka oc kc od kd oe kf of kg og oh bi translated">1.设置</h1><p id="7e5c" class="pw-post-body-paragraph kz la it lb b lc oi ju le lf oj jx lh li ok lk ll lm ol lo lp lq om ls lt lu im bi translated">安装非常简单。强烈建议在通过<code class="fe on oo op lw b">pip install</code>命令安装waste之前创建一个虚拟环境。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="91c8" class="ma mb it lw b gy mc md l me mf">pip install waitress</span></pre><p id="a18c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你应该可以很容易地安装它，没有任何问题。让我们进入下一部分，了解更多基本用法。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="c561" class="nr mb it bd ns nt nu nv nw nx ny nz oa jz ob ka oc kc od kd oe kf of kg og oh bi translated">2.基本用法</h1><p id="ff42" class="pw-post-body-paragraph kz la it lb b lc oi ju le lf oj jx lh li ok lk ll lm ol lo lp lq om ls lt lu im bi translated">您需要首先通过以下命令导入<code class="fe on oo op lw b">waitress</code>:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2bdb" class="ma mb it lw b gy mc md l me mf">from waitress import serve</span></pre><p id="22b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将使用<code class="fe on oo op lw b">app</code>作为Flask服务器的变量名。根据您设置的名称对此进行修改。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="98ee" class="ma mb it lw b gy mc md l me mf">app = Flask(__name__)</span></pre><p id="8eae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注释掉主服务器中的<code class="fe on oo op lw b">app.run</code>,并添加以下代码。</p><p id="9c29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，<code class="fe on oo op lw b">Waitress</code>绑定到端口8080上的任何IPv4地址。您可以省略<code class="fe on oo op lw b">host</code>和<code class="fe on oo op lw b">port</code>参数，只使用WSGI应用程序调用<code class="fe on oo op lw b">serve</code>作为单个参数:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6ccc" class="ma mb it lw b gy mc md l me mf">if __name__ == "__main__":<br/>    #app.run('0.0.0.0',port=server_port)<br/>    serve(app)</span></pre><p id="f910" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您打算在特定的端口上提供它，您必须在参数中指定它。以下代码在端口5000上运行服务器。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f5fd" class="ma mb it lw b gy mc md l me mf">serve(app, host='0.0.0.0', port=5000)</span></pre><p id="dbb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您正在使用UNIX，并且希望通过UNIX域套接字为您的应用程序提供服务，您需要使用<code class="fe on oo op lw b">unix_socket</code>参数调用<code class="fe on oo op lw b">serve</code>。请注意，它不适用于Windows。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1ced" class="ma mb it lw b gy mc md l me mf">serve(app, unix_socket='/path/to/unix.sock')</span></pre><h2 id="6138" class="ma mb it bd ns oq or dn nw os ot dp oa li ou ov oc lm ow ox oe lq oy oz og pa bi translated">支持女服务员的理由</h2><p id="599a" class="pw-post-body-paragraph kz la it lb b lc oi ju le lf oj jx lh li ok lk ll lm ol lo lp lq om ls lt lu im bi translated">serve最常用的参数如下:</p><ul class=""><li id="3612" class="mw mx it lb b lc ld lf lg li my lm mz lq na lu pb nc nd ne bi translated"><code class="fe on oo op lw b">host</code> —监听的主机名或IP地址(字符串)，默认为<code class="fe on oo op lw b">0.0.0.0</code>，表示“该主机上的所有IP地址”。不能与listen参数一起使用。</li><li id="91e1" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu pb nc nd ne bi translated"><code class="fe on oo op lw b">port</code> —监听的TCP端口(整数)，默认<code class="fe on oo op lw b">8080</code>。不得与<code class="fe on oo op lw b">listen</code>参数一起使用。</li><li id="d0f4" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu pb nc nd ne bi translated"><code class="fe on oo op lw b">listen</code> —告诉服务员听一听<code class="fe on oo op lw b">host:port</code>论点的组合。组合应该是用引号括起来的空格分隔的列表，如下所示:<br/> <code class="fe on oo op lw b">listen=”127.0.0.1:8080 [::1]:8080"</code> <br/> <code class="fe on oo op lw b">listen=”*:8080 *:6543"<br/></code>主机名的通配符也受支持，并将绑定到IPv4/IPv6，具体取决于它们是启用还是禁用。支持IPv6 IP地址的方法是用括号将IP地址括起来。</li><li id="ea9f" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu pb nc nd ne bi translated"><code class="fe on oo op lw b">ipv4</code> —启用或禁用IPv4(布尔型)。</li><li id="bf91" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu pb nc nd ne bi translated"><code class="fe on oo op lw b">ipv6</code> —启用或禁用IPv6(布尔型)。</li><li id="0769" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu pb nc nd ne bi translated"><code class="fe on oo op lw b">unix_socket</code>—UNIX套接字的路径(字符串)。如果指定了套接字路径，则生成UNIX域套接字，而不是通常的INET域套接字。在Windows上不可用。默认值为无。</li><li id="90f2" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu pb nc nd ne bi translated"><code class="fe on oo op lw b">threads</code> —用于处理应用逻辑的线程数(整数)。默认值为4。</li></ul><p id="6005" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请查看官方<a class="ae ky" href="https://docs.pylonsproject.org/projects/waitress/en/latest/arguments.html#arguments" rel="noopener ugc nofollow" target="_blank">文档</a>以获得可用参数的完整列表。</p><h2 id="26f0" class="ma mb it bd ns oq or dn nw os ot dp oa li ou ov oc lm ow ox oe lq oy oz og pa bi translated">命令行</h2><p id="c3ba" class="pw-post-body-paragraph kz la it lb b lc oi ju le lf oj jx lh li ok lk ll lm ol lo lp lq om ls lt lu im bi translated">最新版本为我们提供了一个直接从命令行运行它的选项。简单地调用<code class="fe on oo op lw b">waitress-serve</code>，然后调用<code class="fe on oo op lw b">port</code>和<code class="fe on oo op lw b">python_file_name:flask_variable</code>。如果您有一个名为myapp.py的文件，并按如下方式初始化Flask:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6bd2" class="ma mb it lw b gy mc md l me mf">api = Flask(__name__)</span></pre><p id="3937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该在命令行中启动服务器，如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="003e" class="ma mb it lw b gy mc md l me mf">waitress-serve --port=8080 myapp:api</span></pre><p id="1f94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该能够看到以下输出，表明服务器运行正常。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d3c0" class="ma mb it lw b gy mc md l me mf">Serving on http://0.0.0.0:8080</span></pre></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="74d3" class="nr mb it bd ns nt nu nv nw nx ny nz oa jz ob ka oc kc od kd oe kf of kg og oh bi translated">3.结论</h1><p id="8265" class="pw-post-body-paragraph kz la it lb b lc oi ju le lf oj jx lh li ok lk ll lm ol lo lp lq om ls lt lu im bi translated">让我们回顾一下今天所学的内容。我们从在虚拟环境中通过<code class="fe on oo op lw b">pip install</code>进行简单安装开始。</p><p id="728f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们详细探究了<code class="fe on oo op lw b">waitress</code>的基本用法。我们导入了Python模块，只修改了一行代码，就可以使用waste代替普通的开发服务器。</p><p id="8fe5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以通过<code class="fe on oo op lw b">waitress.serve</code>中的参数设置<code class="fe on oo op lw b">host</code>和<code class="fe on oo op lw b">port</code>等附加参数。此外，最新版本还带有命令行选项，可以直接从终端运行服务器。</p><p id="82d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读，希望在下一篇文章中再次见到您！</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="1719" class="nr mb it bd ns nt nu nv nw nx ny nz oa jz ob ka oc kc od kd oe kf of kg og oh bi translated">参考</h1><ol class=""><li id="5d8d" class="mw mx it lb b lc oi lf oj li pc lm pd lq pe lu nb nc nd ne bi translated"><a class="ae ky" href="https://docs.pylonsproject.org/projects/waitress/en/latest/" rel="noopener ugc nofollow" target="_blank">铁塔项目——服务员</a></li><li id="f653" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">GitHub上的女服务员</li><li id="aaa7" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><a class="ae ky" href="https://docs.pylonsproject.org/projects/waitress/en/latest/arguments.html#arguments" rel="noopener ugc nofollow" target="_blank">女服务员的争论</a></li></ol></div></div>    
</body>
</html>