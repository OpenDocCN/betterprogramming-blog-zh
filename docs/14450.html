<html>
<head>
<title>What’s New in PHP 8.2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP 8.2的新特性</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/whats-new-in-php-8-2-bcdf951cbd11?source=collection_archive---------0-----------------------#2022-12-17">https://betterprogramming.pub/whats-new-in-php-8-2-bcdf951cbd11?source=collection_archive---------0-----------------------#2022-12-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="eaa1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">只读类、新的“随机”扩展等等</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ea00528de79c3cf7732f312dc5a5a0a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*88G6aS-zp6vNYRJw"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@timmossholder?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">蒂姆·莫斯霍尔德</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="974b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我将快速解释PHP在圣诞节通过PHP 8.2版本提供给我们的新东西。</p><p id="8307" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是PHP语言的一个重大更新。它包含许多新功能，包括只读类、null、false和true作为独立类型、不推荐使用的动态属性、性能改进等等。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5666" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">只读类</h1><p id="647e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">PHP &lt; 8.2</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="07da" class="nb ma iq mx b be nc nd l ne nf">class BlogData<br/>{<br/>    public readonly string $title;<br/><br/>    public readonly Status $status;<br/><br/>    public function __construct(string $title, Status $status)<br/>    {<br/>        $this-&gt;title = $title;<br/>        $this-&gt;status = $status;<br/>    }<br/>}</span></pre><p id="46d0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">PHP ≥ 8.2</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="d411" class="nb ma iq mx b be nc nd l ne nf">readonly class BlogData<br/>{<br/>    public string $title;<br/><br/>    public Status $status;<br/><br/>    public function __construct(string $title, Status $status)<br/>    {<br/>        $this-&gt;title = $title;<br/>        $this-&gt;status = $status;<br/>    }<br/>}</span></pre><p id="5faf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">As of PHP 8.2.0, a class can be marked with the  【T0】  modifier. Marking a class as  【T1】  will add the <a class="ae kv" href="https://www.php.net/manual/en/language.oop5.properties.php#language.oop5.properties.readonly-properties" rel="noopener ugc nofollow" target="_blank"> readonly修饰符</a>到每个声明的属性，并阻止<a class="ae kv" href="https://www.php.net/manual/en/language.oop5.properties.php#language.oop5.properties.dynamic-properties" rel="noopener ugc nofollow" target="_blank">动态属性</a>的创建。</p><p id="d91c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，不可能通过使用<a class="ae kv" href="https://www.php.net/manual/en/class.allow-dynamic-properties.php" rel="noopener ugc nofollow" target="_blank"> AllowDynamicProperties </a>属性来添加对它们的支持。试图这样做将触发编译时错误。</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="34d0" class="nb ma iq mx b be nc nd l ne nf">#[AllowDynamicProperties]<br/>readonly class Foo {<br/>}<br/><br/>// Fatal error: Cannot apply #[AllowDynamicProperties] to readonly class Foo</span></pre><p id="cddf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于非类型属性和静态属性都不能用<code class="fe ng nh ni mx b">readonly</code>修饰符标记，<code class="fe ng nh ni mx b">readonly</code>类也不能声明它们。</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="a166" class="nb ma iq mx b be nc nd l ne nf">readonly class Foo<br/>{<br/>    public $bar;<br/>}<br/><br/>// Fatal error: Readonly property Foo::$bar must have type<br/>?&gt;</span></pre><pre class="nj mw mx my bn mz na bi"><span id="7d10" class="nb ma iq mx b be nc nd l ne nf">readonly class Foo<br/>{<br/>    public static int $bar;<br/>}<br/><br/>// Fatal error: Readonly class Foo cannot declare static properties</span></pre><p id="b3f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记住，当且仅当子类也是一个<code class="fe ng nh ni mx b">readonly</code>类时，一个<code class="fe ng nh ni mx b">readonly</code>类才能被扩展。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="d500" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">析取范式(DNF)类型</h1><p id="c6cf" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">PHP &lt; 8.2</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="8b73" class="nb ma iq mx b be nc nd l ne nf">class Foo {<br/>    public function bar(mixed $entity) {<br/>        if ((($entity instanceof A) &amp;&amp; ($entity instanceof B)) || ($entity === null)) {<br/>            return $entity;<br/>        }<br/><br/>        throw new Exception('Invalid entity');<br/>    }<br/>}</span></pre><p id="70d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">PHP ≥ 8.2</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="f8cd" class="nb ma iq mx b be nc nd l ne nf">class Foo {<br/>    public function bar((A&amp;B)|null $entity) {<br/>        return $entity;<br/>    }<br/>}</span></pre><p id="2d92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">DNF <em class="nk"> (psss，如果你想了解更多关于析取范式的知识，请看</em> <a class="ae kv" href="https://en.wikipedia.org/wiki/Disjunctive_normal_form" rel="noopener ugc nofollow" target="_blank"> <em class="nk">本维基百科页面</em> </a> <em class="nk"> ) </em>类型允许我们组合<a class="ae kv" href="https://www.php.net/manual/en/language.types.type-system.php#language.types.type-system.composite.union" rel="noopener ugc nofollow" target="_blank">并集</a>和<a class="ae kv" href="https://www.php.net/manual/en/language.types.type-system.php#language.types.type-system.composite.intersection" rel="noopener ugc nofollow" target="_blank">交集</a>类型，遵循一个严格的规则:当组合并集和交集类型时，交集类型必须用括号分组。</p><p id="c1c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请看下面的一些例子来更好地理解它</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="a91c" class="nb ma iq mx b be nc nd l ne nf">// Accepts an object that implements both A and B,<br/>// OR an object that implements D.<br/>(A&amp;B)|D<br/><br/>// Accepts an object that implements C, <br/>// OR a child of X that also implements D,<br/>// OR null.<br/>C|(X&amp;D)|null<br/><br/>// Accepts an object that implements all three of A, B, and D, <br/>// OR an int, <br/>// OR null.<br/>(A&amp;B&amp;D)|int|null</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8a1c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">允许null、false和true作为独立类型</h1><p id="fc28" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">PHP &lt; 8.2</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="b349" class="nb ma iq mx b be nc nd l ne nf">class Falsy<br/>{<br/>    public function almostFalse(): bool { /* ... */ *}<br/><br/>    public function almostTrue(): bool { /* ... */ *}<br/><br/>    public function almostNull(): string|null { /* ... */ *}<br/>}</span></pre><p id="f136" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">PHP ≥ 8.2</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="8e76" class="nb ma iq mx b be nc nd l ne nf">class Falsy<br/>{<br/>    public function alwaysFalse(): false { /* ... */ *}<br/><br/>    public function alwaysTrue(): true { /* ... */ *}<br/><br/>    public function alwaysNull(): null { /* ... */ *}<br/>}</span></pre><p id="ada8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">See an example of why the definition of the  【T0】  type does make sense indeed</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="ea62" class="nb ma iq mx b be nc nd l ne nf">class User {<br/>    function isAdmin(): bool<br/>}<br/> <br/>class Admin extends User<br/>{<br/>    function isAdmin(): true<br/>    {<br/>        return true;<br/>    }<br/>}</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="e5b7" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">New “Random” extension</h1><p id="aa09" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">PHP ≥ 8.2</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="0f29" class="nb ma iq mx b be nc nd l ne nf">use Random\Engine\Xoshiro256StarStar;<br/>use Random\Randomizer;<br/><br/>$blueprintRng = new Xoshiro256StarStar(<br/>    hash('sha256', "Example seed that is converted to a 256 Bit string via SHA-256", true)<br/>);<br/><br/>$fibers = [];<br/>for ($i = 0; $i &lt; 8; $i++) {<br/>    $fiberRng = clone $blueprintRng;<br/>    // Xoshiro256**'s 'jump()' method moves the blueprint ahead 2**128 steps, as if calling<br/>    // 'generate()' 2**128 times, giving the Fiber 2**128 unique values without needing to reseed.<br/>    $blueprintRng-&gt;jump();<br/><br/>    $fibers[] = new Fiber(function () use ($fiberRng, $i): void {<br/>        $randomizer = new Randomizer($fiberRng);<br/><br/>        echo "{$i}: " . $randomizer-&gt;getInt(0, 100), PHP_EOL;<br/>    });<br/>}<br/><br/>// The randomizer will use a CSPRNG by default.<br/>$randomizer = new Randomizer();<br/><br/>// Even though the fibers execute in a random order, they will print the same value<br/>// each time, because each has its own unique instance of the RNG.<br/>$fibers = $randomizer-&gt;shuffleArray($fibers);<br/>foreach ($fibers as $fiber) {<br/>    $fiber-&gt;start();<br/>}</span></pre><p id="df10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">The “random” extension provides a new object-oriented API to random number generation. Instead of relying on a globally seeded random number generator (RNG) using the <a class="ae kv" href="https://en.wikipedia.org/wiki/Mersenne_Twister" rel="noopener ugc nofollow" target="_blank"> Mersenne Twister算法</a>面向对象的API提供了几个类(“引擎”)，这些类提供了对现代算法的访问，这些算法将它们的状态存储在对象中，以允许多个独立的可播种序列。</p><p id="5050" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ng nh ni mx b">\Random\Randomizer</code>类提供了一个高级接口，使用引擎的随机性来生成一个随机整数，打乱一个数组或字符串，选择随机数组键等等。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="e274" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">性状中的常数</h1><p id="a37f" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">PHP ≥ 8.2</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="a085" class="nb ma iq mx b be nc nd l ne nf">trait Foo<br/>{<br/>    public const CONSTANT = 1;<br/>}<br/><br/>class Bar<br/>{<br/>    use Foo;<br/>}<br/><br/>var_dump(Bar::CONSTANT); // 1<br/>var_dump(Foo::CONSTANT); // Error</span></pre><p id="c604" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Trait常量可以以与类常量相同的方式定义，并以与trait中的属性和方法定义相同的方式平铺到组成类的定义中。</p><p id="1f0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您不能通过特征的名称来访问常量，但是，您可以通过使用该特征的类来访问常量。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="7e6f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">弃用动态属性</h1><p id="e17d" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">PHP &lt; 8.2</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="019c" class="nb ma iq mx b be nc nd l ne nf">class User<br/>{<br/>    public $name;<br/>}<br/><br/>$user = new User();<br/>$user-&gt;last_name = 'Doe';<br/><br/>$user = new stdClass();<br/>$user-&gt;last_name = 'Doe';</span></pre><p id="20f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">PHP ≥ 8.2</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="d23c" class="nb ma iq mx b be nc nd l ne nf">class User<br/>{<br/>    public $name;<br/>}<br/><br/>$user = new User();<br/>$user-&gt;last_name = 'Doe'; // Deprecated notice<br/><br/>$user = new stdClass();<br/>$user-&gt;last_name = 'Doe'; // Still allowed</span></pre><p id="7e3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不赞成创建动态属性，以帮助避免错误和打字错误，除非类通过使用<code class="fe ng nh ni mx b">#[\AllowDynamicProperties]</code>属性选择加入。<code class="fe ng nh ni mx b">stdClass</code>允许动态属性。</p><p id="de16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个改动不会影响<code class="fe ng nh ni mx b">__get</code> / <code class="fe ng nh ni mx b">__set</code>魔法方法的使用。</p><p id="9e04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">移除对动态属性的支持构成了严重的向后兼容性破坏。虽然现代PHP代码始终声明使用的属性，但遗留代码不一定是这样。</p><p id="c0cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当遇到动态属性弃用警告时，有许多事情可以避免它。最简单和最常见的方法是简单地添加属性声明:</p><pre class="kg kh ki kj gt mw mx my bn mz na bi"><span id="7802" class="nb ma iq mx b be nc nd l ne nf">class Test {<br/>    public $value; // &lt;-- Add property declaration.<br/> <br/>    public function __construct($value) {<br/>        $this-&gt;value = $value;<br/>    }<br/>}</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="b018" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么，你还在等什么？查看升级到PHP 8.2的迁移指南并尝试一下吧！我希望你喜欢这篇文章，并在下一篇文章中看到你！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5e13" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">资源</h1><ul class=""><li id="4c3b" class="nl nm iq ky b kz mr lc ms lf nn lj no ln np lr nq nr ns nt bi translated"><a class="ae kv" href="https://www.php.net/releases/8.2/en.php" rel="noopener ugc nofollow" target="_blank">https://www.php.net/releases/8.2/en.php</a></li><li id="6001" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">https://wiki.php.net/rfc/dnf_types<a class="ae kv" href="https://wiki.php.net/rfc/dnf_types" rel="noopener ugc nofollow" target="_blank"/></li><li id="1de1" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">【https://wiki.php.net/rfc/true-type T4】</li><li id="dca0" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated"><a class="ae kv" href="https://wiki.php.net/rfc/constants_in_traits" rel="noopener ugc nofollow" target="_blank">https://wiki.php.net/rfc/constants_in_traits</a></li><li id="920d" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated"><a class="ae kv" href="https://wiki.php.net/rfc/deprecate_dynamic_properties" rel="noopener ugc nofollow" target="_blank">https://wiki.php.net/rfc/deprecate_dynamic_properties</a></li><li id="415b" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated"><a class="ae kv" href="https://www.php.net/manual/en/migration82.php" rel="noopener ugc nofollow" target="_blank">https://www.php.net/manual/en/migration82.php</a></li></ul></div></div>    
</body>
</html>