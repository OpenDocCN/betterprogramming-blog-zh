# 用 JavaScript 设计 API 方法

> 原文：<https://betterprogramming.pub/designing-api-methods-in-javascript-1d821bd29c7d>

## 探索命名参数、方法链接和函数多态性

![](img/85ee10e160cadba7d21152d6daa05984.png)

来自 Unsplash 的照片

用 JavaScript 设计 API 方法是一项非常有用的技能，可以让你从不同的角度看待编程。这种视角不是为用户构建项目，而是为开发人员构建项目。如果您以前没有构建过库或 SDK，这篇文章可以帮助您了解从哪里以及如何开始，从方法设计开始。

JavaScript 是一种松散类型的语言，开发人员可以利用它来创建健壮的多用途 API。

这篇文章将介绍用 JavaScript 设计 API 时编写方法的几种方式。

# 1.命名参数

我们要讲的第一个方法是*命名参数*。回到过去，在引入 ES6 之前，声明函数的唯一方式是使用`function`语法的[函数声明](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)。

为了确定执行流的去向，您需要一个函数 arity(函数期望的参数数量)，将它转换为一个数组，并根据参数的样子应用其余的逻辑。

在这个例子中，`animal`、`options`和`callback`是函数的参数，arity 是三。该功能旨在创建一个新账户。如果来电者没有提供，每个帐户都会有一些默认设置:

这样做的问题是，调用者必须知道要作为参数传递给函数的参数的确切顺序，即使一个或多个参数不是必需的。按顺序记住需求可能很难，如果不小心的话，很容易弄乱顺序。此外，如果没有必要让函数正常工作，那么让一个参数成为必需参数就没有多大意义。

这在将来也很难维护，因为当你或你的老板需要去掉`username`并把`email`换成新的用户名时，你必须改变逻辑。

更好的做法是简单地使用一个对象:

我们受益于可读性以及对可维护性的更多控制，因为您只需要从代码中删除用户名:

打电话也变得更加简洁易读:

# 2.方法链接/流畅 API

我最喜欢的编写 API 的方式是通过方法链接使用 [fluent API](https://martinfowler.com/bliki/FluentInterface.html) 。

方法链接就是一个接一个地链接多个调用的过程。总的想法是实现一个可读和流畅的代码，从而使它更快地理解。这些方法通常是动词(如 rotate)。

例如:

这翻译成:`Retrieve`图像`*nemo*the *fish.jpg*`和`apply`值为`100%`的`grayscale` `filter`。`Rotate`将图像放大`100`度，并将`scale`放大`1.5`倍。

这种做法的一个好处是可以很快开始编写自己的流畅 API 接口。您只需在方法调用中返回对上下文的引用，这样就可以将它链接起来:

流畅 API 的一个最好的例子是 jQuery。由于该库的流畅性，它可以说是最容易学习和使用的 JavaScript 库之一:

然而，链接 fluent API 的方法有一些缺点。

最大的缺点是很难在链的中间设置断点，这使得错误很难调试。此外，它鼓励过多的程序代码。不过，有一些方法可以解决调试问题，方法是在链中的任何一步插入记录器，并使用它们来调用后续的方法。

另一个缺点是，您可能会陷入用紧凑的点标记法写长句的行为中。这可能会妨碍事情的简单化。

# 3.功能多态性

你可能在其他语言中听说过术语*多态性*，通常情况下，事情会根据上下文表现不同。

同样的概念也适用于 JavaScript 中的函数多态性。这些函数根据传入的参数运行(这是我们的*上下文*)。

API 通常将参数收集到数组或类似数组的结构中，以便对它们进行更多的控制。将它们放在一个数组结构中允许它们做一些事情，比如传递给同一作用域中的其他函数，反之亦然。

在引入 arrow 函数之前，在多态函数中收集参数的常见做法是使用类似数组的`arguments`对象。有时，在将参数分配给数组后，您可能需要对它们做更多的处理。尽管`arguments`是一个类似数组的对象，但它的功能并不像一个真正的数组。它缺少基本的数组函数，这是非常有限的。

开发人员解决这个问题的方法是使用`Array.prototype.slice.call()`制作一个单独的浅层副本。这叫`method delegation`。换句话说，你*将`slice()`调用*委托给`Array.prototype`对象。

例如:

这将复制从`index 0`开始的项目，并返回所有内容。

`Arguments`没有真正的方法，像`.push`或`.shift`，所以我们用`Array.prototype.slice`把它转换成一个数组。这使我们能够访问所有的数组方法。

在 ES6 中，我们可以通过使用 spread 操作符轻松地将其转换为数组，如下所示:

当您的参数位于数组或类似数组的结构中时，您可以根据参数的外观来确定执行逻辑的位置。这使得它非常灵活地用于多种目的，而无需编写太多代码。

不扩散:

展开时:

考虑到这一点，我们现在可以从这些参数中确定如何处理执行:

这个简单的函数允许开发者以多种方式使用它:

1.  通过提供一个字符串和值作为第一个和第二个参数来应用单个筛选器。
2.  通过提供一个键/值对对象作为第一个参数来应用多个过滤器。
3.  通过提供一个筛选器键/值的对象作为第一个参数来应用单个筛选器。
4.  作为第二个或第三个参数通过回调接收新过滤的图像(位置取决于它们为过滤器传递的内容。)

这就是强大的力量！