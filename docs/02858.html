<html>
<head>
<title>How to Do Continuous Vulnerability Scanning With Cloudflare Flan</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Cloudflare Flan进行持续漏洞扫描</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/continuous-vulnerability-scanning-with-cloudflare-flan-be924601cca8?source=collection_archive---------7-----------------------#2020-01-05">https://betterprogramming.pub/continuous-vulnerability-scanning-with-cloudflare-flan-be924601cca8?source=collection_archive---------7-----------------------#2020-01-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3a2d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解您的基础设施</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/37eba16235425aa9213ffbdae0b25543.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Kci2jH0EuP5FARW0"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@codestorm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Safar Safarov </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="d9b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“了解您的基础设施”是安全团队的主要原则之一。但是拥有持续的知识和理解基础设施的弱点对于DevSecOps过程来说尤其重要。</p><p id="55a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，尽快以正确的方式获得结果也很重要。Cloudflare的Flan工具是我见过的针对这个问题的最棒的开源解决方案。</p><p id="3db4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它有助于执行扫描，并将结果立即发送到GCS桶或AWS S3桶。</p><p id="2c87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是在使用了几次之后，我发现了一个小问题:它将报告保存在*。tex和*。xml格式。那些对我来说不方便。因此，在本文中，您将了解cloud flare Flan工具的基本用法，以及如何进行一些更改以在*中启用报告。html格式。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6975" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">执行漏洞扫描的基本Cloudflare Flan用法</h1><p id="2e66" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在GitHub上克隆cloudflare/flan存储库:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="fb9b" class="ne md it na b gy nf ng l nh ni">$ git clone <a class="ae ky" href="https://github.com/cloudflare/flan.git" rel="noopener ugc nofollow" target="_blank">https://github.com/cloudflare/flan.git</a></span></pre><p id="24df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到下载的目录:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c14b" class="ne md it na b gy nf ng l nh ni">$ cd flan</span></pre><p id="f851" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编辑<code class="fe nj nk nl na b">shared/ips.txt</code>文件，并将您的目标IP地址放在那里:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1f34" class="ne md it na b gy nf ng l nh ni">$ nano shared/ips.txt</span></pre><p id="1815" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保存文件并运行命令开始扫描:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="f36b" class="ne md it na b gy nf ng l nh ni">$ make build &amp;&amp; make start</span></pre><p id="5634" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将在扫描过程中看到Nmap输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/cec1102599223a0efb36461797cfaf7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*Rza6vMfrTnKfoiHRzuxwBA.png"/></div></figure><p id="cc67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有*。tex报告将保存在<code class="fe nj nk nl na b">shared/reports</code>目录中，xml输出将保存在<code class="fe nj nk nl na b">shared/xml_files</code>目录中。</p><p id="e4e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在官方的<a class="ae ky" href="https://github.com/cloudflare/flan/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">自述文件</a>中了解更多关于将扫描结果推送到云端的信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3a85" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将Cloudflare Flan Nmap输出保存到HTML</h1><p id="cda8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">快速搜索后，我决定使用HTML报告在Nmap官方网站上如何描述。</p><p id="3cce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要将<code class="fe nj nk nl na b">xsltproc</code>可执行文件添加到Cloudflare Flan的映像中。要执行它，我们应该安装软件包<code class="fe nj nk nl na b">libxslt</code> <em class="nn"> </em>(因为Cloudflare Flan使用Alpine Linux作为镜像)。打开存储库的Dockerfile，更改如下所示的第二行(在行尾添加<code class="fe nj nk nl na b">libxslt</code>):</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8bb8" class="ne md it na b gy nf ng l nh ni">RUN apk add --no-cache nmap nmap-scripts git libxslt</span></pre><p id="bac3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是修改<code class="fe nj nk nl na b">run.sh</code>脚本来执行xml报告到HTML报告的转换。打开<code class="fe nj nk nl na b">run.sh</code>进行编辑，找到工作循环，修改如下图所示:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="e0b1" class="ne md it na b gy nf ng l nh ni">while IFS= read -r line<br/>do<br/> current_time=$(date “+%Y.%m.%d-%H.%M.%S”)<br/> filename=$(get_filename $line)”.xml”<br/> # Added for html generation<br/> htmlreport=$(get_filename $line)”.html”<br/> # ^^^^^^^^^^^^^^^^^^^^^^^^^<br/> nmap -sV -oX $root_dir$xml_dir/$filename -oN - -v1 $@ --script=vulners/vulners.nse $line<br/> upload $xml_dir/$filename<br/> # Added for html generation<br/> xsltproc $root_dir$xml_dir/$filename -o $root_dir$xml_dir/$htmlreport<br/> # ^^^^^^^^^^^^^^^^^^^^^^^^^<br/>done &lt; /shared/ips.txt</span></pre><p id="aba8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再次运行命令:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="6235" class="ne md it na b gy nf ng l nh ni">$ make build &amp;&amp; make start</span></pre><p id="43eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">命令执行后，我们将在目录<code class="fe nj nk nl na b">shared/xml_files/YOUR_SCAN_TIME</code>中找到HTML报告:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/984da12b2b5b42e9bcfd2c47c6269c69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*90oQQMFw3rwie3LWG9AV7A.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="54cd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Cloudflare Flan的其他调整</h1><p id="ccd4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">默认情况下，Nmap仅扫描1，000个众所周知的端口。但是对于您的基础设施，对一些非标准端口执行漏洞扫描可能会很有用。在这种情况下，您应该在文件中找到运行Nmap的<code class="fe nj nk nl na b">run.sh</code>命令，并根据您的期望修改它:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="10f5" class="ne md it na b gy nf ng l nh ni">nmap -sV -oX $root_dir$xml_dir/$filename -oN --v1 $@ --script=vulners/vulners.nse $line</span></pre></div></div>    
</body>
</html>