<html>
<head>
<title>Exploring Server-Driven UI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索服务器驱动的用户界面</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/exploring-server-driven-ui-cf67b3da919?source=collection_archive---------0-----------------------#2020-03-17">https://betterprogramming.pub/exploring-server-driven-ui-cf67b3da919?source=collection_archive---------0-----------------------#2020-03-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="732d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用原生用户界面构建反应式应用的新方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f9bb8f0cc915d2d817a64f03be5922b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TOXSk9BaVwFP98riwV97BA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片来自Airbnb的应用程序。</p></figure><p id="d4af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">原生应用仍然是希望扩大规模并基于其用户界面和性能接触数百万用户的企业的首选。这种说法可能会引起很多人的争议，但我们不会讨论哪个平台是最好的。相反，我们将学习如何使用服务器驱动的用户界面来更好地控制你在应用程序中显示的内容。</p><p id="c04c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我总是想知道Airbnb、Flipkart和Swiggy <strong class="la iu"> </strong>这样的应用程序是如何动态更新其UI的。即使我没有更新应用程序，Flipkart <strong class="la iu"> </strong>在节日期间显示不同的UI，而Swiggy <strong class="la iu"> </strong>总是根据设备位置改变其UI。你想知道他们是怎么做到的吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lu"><img src="../Images/a62ed6aad75fc168e145b1284c81d984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Mh5GMT6X_APdTNpxGkmsg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基于位置的Swiggy用户界面的变化。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lu"><img src="../Images/e5308a20bdad0223909dbd2567822002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-ZtRJVI5vvdXtAq5PSo_w.jpeg"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9ed2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是服务器驱动的UI？</h1><p id="5a84" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">服务器驱动的UI是指API告诉客户端呈现什么组件和什么内容。这可以在所有三个主要平台上实现:Android、iOS和web。在我看来，这种类型的开发使得原生应用更具反应性和可控性。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="52ce" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">服务器如何控制用户界面？</h1><p id="587e" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">从理论上讲，这很简单:我们向服务器发出请求，然后我们收到一个JSON响应，其中会有在屏幕上膨胀什么的逻辑。基于逻辑，我们必须在视图上呈现本地开发的UI组件。这带来了高质量的用户体验，并允许公司对用户可以看到的内容有更多的控制。查看下图，从较高层次了解服务器的响应如何呈现视图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/53d4a6a8ffb9257750fa2611326c8f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZIkbgUvWHFD59DKDdm1o5A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">服务器驱动UI的鸟瞰图。</p></figure><p id="526e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们想改变UI中的顺序，比如图像下面的操作行，然后是标题，我们只需要改变响应:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/4fba7d27c66b208ef1bcaa5ecb613db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c9krRWduJYWB_ewy66c3mg.png"/></div></div></figure><p id="1b3a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">类似地，如果我们想要包含一个完全不同的组件(例如，标题下面的一个全长按钮)并删除action行，我们只需再次更改response:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/fe06f17a8f05397aaecafb4915f202c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j_siflbJ-bsxvB9ONe7c0A.png"/></div></div></figure><p id="cd43" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用这种方法，我们可以基于用户位置、订阅或任何东西来改变UI中的任何东西。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8f1a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">优势</h1><ol class=""><li id="eb3e" class="na nb it la b lb mu le mv lh nc ll nd lp ne lt nf ng nh ni bi translated">企业不再需要依赖用户来更新应用程序以显示特定的UI或改变UI的顺序(至少在大部分情况下)。</li><li id="61f1" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt nf ng nh ni bi translated">我们可以在运行中对特定功能进行测试。</li><li id="548d" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt nf ng nh ni bi translated">发布新特性和创建更多可重用的组件很容易。</li><li id="6b4a" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt nf ng nh ni bi translated">用户的原生体验和公司的反应。</li></ol><p id="b979" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我觉得这是一个双赢的过程。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d65d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">深入了解SDUI</h1><p id="24d7" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">个人开发者不可能创建SDUI系统，所以我想用Airbnb的<a class="ae no" href="https://github.com/airbnb/Lona" rel="noopener ugc nofollow" target="_blank"> Lona </a>(一个SDUI库)来解释SDUI。</p><p id="9f33" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">外面有很多图书馆:</p><ul class=""><li id="4078" class="na nb it la b lb lc le lf lh np ll nq lp nr lt ns ng nh ni bi translated">Airbnb的<a class="ae no" href="https://github.com/airbnb/epoxy" rel="noopener ugc nofollow" target="_blank">环氧树脂</a></li><li id="2af1" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt ns ng nh ni bi translated">来自脸书的石版画</li><li id="f937" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt ns ng nh ni bi translated">来自Flipkart的Proteus </li><li id="7870" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt ns ng nh ni bi translated">Tumblr的gray water<a class="ae no" href="https://github.com/tumblr/Graywater" rel="noopener ugc nofollow" target="_blank"/></li></ul><p id="082c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">回到正题，Airbnb使用基于组件的UI，像<a class="ae no" href="https://developer.android.com/jetpack/compose" rel="noopener ugc nofollow" target="_blank"> Jetpack Compose </a>。当从服务器接收到JSON格式时，应用程序开发人员根据JSON中的行类型扩展组件。</p><h2 id="34ae" class="nt md it bd me nu nv dn mi nw nx dp mm lh ny nz mo ll oa ob mq lp oc od ms oe bi translated">JSON格式</h2><p id="a81e" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">让我们考虑一个非常基本的JSON来简化事情。看一看:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/5dbc1169712aea651aac9ee80c94be12.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*ZLOE5xGOWjEXbtFY_QdPfQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">简单的JSON格式，使用Lona扩展视图。</p></figure><p id="3e15" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">节点<code class="fe og oh oi oj b">type</code>定义了哪种类型的组件应该在视图上展开，比如标题行、动作行等等(正如我们上面看到的)。<code class="fe og oh oi oj b">Content</code>节点提供要在展开视图中显示的内容。例如，如果我的组件是标题行，那么标题和副标题包含要在<code class="fe og oh oi oj b">title</code>和<code class="fe og oh oi oj b">subtitle</code>字段中显示的内容。<code class="fe og oh oi oj b">Action</code>节点用于膨胀可操作的组件，如点击和内容导航应该基于<code class="fe og oh oi oj b">onPress</code>节点发生。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f4e7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">SDUI的版本挑战</h1><p id="1604" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">假设你最近发布了一款带有SDUI的应用，几天后，你向Play Store推送了一个更新，并启用了包含新组件的新API更改，以在视图中展开。这里的问题是，不是所有的用户都更新到最新版本，有些人甚至可能停留在非常旧的版本。</p><p id="9b94" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当旧版本的应用程序访问新的API响应时，后果将是直接的，因此我们应该非常小心，以确保API响应和客户端代码应该是向后兼容的。</p><p id="0d12" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">再来看Airbnb <strong class="la iu"> </strong>针对版本问题提供的解决方案。下面是已经发布的版本1中header组件的JSON格式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/35b24b8817cf8589ef116d0393dfd155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vamGzKLWCMcRTXEezqc8cg.png"/></div></div></figure><p id="110d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于我们已经发布了应用程序，我们需要一个新的版本来进行任何更改。为了集成新的更改，我们需要在版本号中包含新的变量<code class="fe og oh oi oj b">minVersion</code>。在这个变量下，我们可以包含任意数量的组件和样式。看一看:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/95b7a1416d818228f496e63edde03e1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sGdVC5ZNrNEQbV6f_nXjTA.png"/></div></div></figure><p id="b7cf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于我们在之前版本的app中不访问<code class="fe og oh oi oj b">minVersion</code>，所以不会有问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="abb5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用SDUI编写的Jetpack(未来)</h1><p id="ae06" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">Jetpack Compose是Android团队的一个新库，目前处于非常早期的阶段。它最终将改变我们在Android中设计UI的方式。</p><p id="f5c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">JetPack Compose使用Kotlin编程语言将反应式编程模型与简洁和简单的编码结合起来。此外，它是完全声明性的，这意味着您通过调用一系列将数据转换为UI层次结构的函数来描述您的UI，这比使用传统的XML格式更便于使用SDUI构建布局。</p><p id="15e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然我们有先进的库，如Litho、Epoxy和来自大型科技公司的更多库，但拥有一个本地解决方案更方便。这就是Jetpack Compose将在不久的将来大放异彩的原因。</p><p id="7f0b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要了解有关JetPack Compose的更多信息，请阅读以下文章:</p><ul class=""><li id="bf95" class="na nb it la b lb lc le lf lh np ll nq lp nr lt ns ng nh ni bi translated"><a class="ae no" href="https://medium.com/better-programming/jetpack-compose-a-new-and-simple-way-to-create-material-ui-in-android-f49c6fcb448b" rel="noopener">Jetpack Compose——一种在Android中创建材质UI的简单新方法</a></li><li id="c9d3" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt ns ng nh ni bi translated"><a class="ae no" href="https://medium.com/better-programming/interesting-updates-from-jetpack-compose-48b79e7d2d8a" rel="noopener">来自Jetpack Compose的有趣更新</a></li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8bec" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="1f0d" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在我们结束之前，我想感谢劳拉·凯利和纳杉尼尔·西尔弗曼。我从他们在KotlinConfig 2019上的演讲中学到了我在这里提到的许多概念。如果你感兴趣，可以看看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="7646" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>