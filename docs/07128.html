<html>
<head>
<title>Using the New PHPicker With SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">结合SwiftUI使用新的PHPicker</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-the-new-phpicker-with-swiftui-a640e2d94d02?source=collection_archive---------8-----------------------#2020-12-09">https://betterprogramming.pub/using-the-new-phpicker-with-swiftui-a640e2d94d02?source=collection_archive---------8-----------------------#2020-12-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bf33" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将PHPicker与SwiftUI和PromiseKit结合使用的简单教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7863b77a7c066eaa44d3033759347d5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IJgOvx2qA43I7cyPwdXtjQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PHPicker</p></figure><p id="ca1f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2020年WWDC车展上发布了一款新的图像拾取器。<code class="fe lu lv lw lx b">PHPicker</code>是<code class="fe lu lv lw lx b">UIImagePickerController</code>的替代产品，具有许多新功能，例如:</p><ul class=""><li id="3b30" class="ly lz it la b lb lc le lf lh ma ll mb lp mc lt md me mf mg bi translated">不需要完全访问照片图库</li><li id="81d5" class="ly lz it la b lb mh le mi lh mj ll mk lp ml lt md me mf mg bi translated">搜索</li><li id="618a" class="ly lz it la b lb mh le mi lh mj ll mk lp ml lt md me mf mg bi translated">多重选择</li><li id="eb81" class="ly lz it la b lb mh le mi lh mj ll mk lp ml lt md me mf mg bi translated">放大或缩小</li></ul><p id="ca42" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我将带你了解如何在SwiftUI应用中使用<code class="fe lu lv lw lx b">PHPicker</code>。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="dc6d" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">回购示例</h1><p id="b3b5" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">以下是GitHub的最终代码:</p><div class="nq nr gp gr ns nt"><a href="https://github.com/manakuro/swiftui-with-phpicker-example" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">manakuro/swift ui-with-ph picker-示例</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">带有SwiftUI GitHub的PHPicker示例应用程序是超过5000万开发人员的家园，他们一起工作来托管和审查…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">github.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh ks nt"/></div></div></a></div></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="77cf" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">属国</h1><p id="11cf" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">此应用程序中的依赖关系如下:</p><ul class=""><li id="c645" class="ly lz it la b lb lc le lf lh ma ll mb lp mc lt md me mf mg bi translated">iOS14</li><li id="da7e" class="ly lz it la b lb mh le mi lh mj ll mk lp ml lt md me mf mg bi translated">Xcode12.0/Swift5.3</li><li id="52a5" class="ly lz it la b lb mh le mi lh mj ll mk lp ml lt md me mf mg bi translated">承诺6.13.2</li></ul></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="ecc7" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">概观</h1><p id="ec98" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">我们将通过以下步骤实现此应用程序:</p><ol class=""><li id="7cd4" class="ly lz it la b lb lc le lf lh ma ll mb lp mc lt oi me mf mg bi translated">将<code class="fe lu lv lw lx b">PHPicker</code>添加到SwiftUI。</li><li id="1245" class="ly lz it la b lb mh le mi lh mj ll mk lp ml lt oi me mf mg bi translated">用PromiseKit处理异步任务。</li></ol><p id="39bd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设我们将实现从照片库中挑选一张照片并将其显示在列表中的功能。</p><p id="db0a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，我们在这个应用程序中有一个照片列表，看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/f1e5945ee1261db5ba4f6e98c74b0c32.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*En7AVSB89SCyftzf9VbdGg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例应用程序</p></figure><p id="6505" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个非常简单的视图，只有一个按钮和一个照片列表。</p><p id="7e05" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">而<code class="fe lu lv lw lx b">ContentView.swift</code>看起来是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">内容视图. swift</p></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="9bd5" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">1.将PHPicker添加到SwiftUI</h1><p id="c3c6" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">所以，我们来介绍一下<code class="fe lu lv lw lx b">PHPicker</code>这款app。</p><p id="e464" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了在SwiftUI中使用<code class="fe lu lv lw lx b">PHPicker</code>，我们需要准备符合<code class="fe lu lv lw lx b">UIViewRepresentable</code>协议的视图，并在其中创建一个<code class="fe lu lv lw lx b">PHPicker</code>的实例。</p><p id="4b79" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">连接到PHPicker的步骤如下:</p><ul class=""><li id="fcd6" class="ly lz it la b lb lc le lf lh ma ll mb lp mc lt md me mf mg bi translated">创建一个符合<code class="fe lu lv lw lx b">UIViewRepresentable</code>的视图。</li><li id="7bb4" class="ly lz it la b lb mh le mi lh mj ll mk lp ml lt md me mf mg bi translated">添加<code class="fe lu lv lw lx b">makeUIViewController</code>方法并提供<code class="fe lu lv lw lx b">PHPicker</code>视图。</li><li id="ba18" class="ly lz it la b lb mh le mi lh mj ll mk lp ml lt md me mf mg bi translated">添加<code class="fe lu lv lw lx b">updateUIView</code>。</li><li id="1ee9" class="ly lz it la b lb mh le mi lh mj ll mk lp ml lt md me mf mg bi translated">添加一个<code class="fe lu lv lw lx b">Coordinator</code>类和<code class="fe lu lv lw lx b">makeCoodinator</code>方法。</li></ul><p id="e9f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，在根文件夹中创建<code class="fe lu lv lw lx b">ImagePicker.swift</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="b157" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">makeUIViewController</code>负责创建<code class="fe lu lv lw lx b">PHPicker</code>的实例并返回。配置应该在这里完成。</p><p id="2fed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">makeCoodinator</code>提供一个协调器类来处理<code class="fe lu lv lw lx b">PHPicker</code>的所有事件。</p><p id="e2c7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">Coordinator</code>类用于处理picker事件，并在从照片库中获取数据后触发完成处理程序。</p><p id="3912" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，我们应该处理多张照片。</p><p id="3b5c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们将在<code class="fe lu lv lw lx b">ContentView.swift</code>中使用这个视图:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">内容视图. swift</p></figure><p id="de58" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe lu lv lw lx b">pickerConfiguration</code>中，你可以定制你想要的配置。在这种情况下，我们只使用<code class="fe lu lv lw lx b">.image</code>数据，并设置了一个<code class="fe lu lv lw lx b">10</code>图片的限制。</p><p id="d55c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当按下“添加照片”按钮时，照片库出现，您可以选择多张照片:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/43d9081d5af619e87101a5f00f6373e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/1*yR0R-ncCQqUumM9R08k3cQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GIF格式</p></figure><p id="b9a8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它似乎工作得很好。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="5d37" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">2.用PromiseKit处理异步任务</h1><p id="b71a" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">我们已经引入了<code class="fe lu lv lw lx b">PHPicker</code>视图，并将其应用于我们的<code class="fe lu lv lw lx b">ContentView</code>。但是您可能已经注意到，每次在<code class="fe lu lv lw lx b">picker</code>方法中加载完成时，我们都会调用完成处理程序。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="0db9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您出于某种原因对这种方法感到不舒服，并且希望一次处理完，那么您需要在<code class="fe lu lv lw lx b">picker</code>函数中等待所有的异步加载。</p><p id="9691" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，您可以使用<a class="ae on" href="https://github.com/mxcl/PromiseKit" rel="noopener ugc nofollow" target="_blank"> PromiseKit </a>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/49ee2279592ac009dc772542fadd381c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vvdqCBJ6jgZXzmlEJ4lIog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PromiseKit</p></figure><p id="a590" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">PromiseKit允许您以一种简单的方式处理异步任务。它已经将几乎所有的苹果API转换为promises，并完全支持CocoaPods、Carthage、SwiftPM和Accio的安装。</p><p id="c440" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我们将通过SwiftPM安装它。</p><p id="2b59" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">进入项目&gt; Swift软件包:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/f213bbb86631ceb93f333985031cd671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*thsxyIulkMl3Rd8imMsdXg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Swift包裹</p></figure><p id="1b46" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">按+并粘贴<a class="ae on" href="https://github.com/mxcl/PromiseKit" rel="noopener ugc nofollow" target="_blank">https://github.com/mxcl/PromiseKit</a>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/c07c894aa8439cfdb69a86eb77586eeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*etxbSd2R1FrmW99mWtyxTA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">正在安装PromiseKit</p></figure><p id="4ebc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">单击“下一步”,您将看到安装已经完成:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/4411742b746226b2eea9d1db5f932565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xQvV86RAJS3EvNTZj6Ysvg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安装完成</p></figure><p id="d833" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，打开<code class="fe lu lv lw lx b">ImagePicker.swift</code>，编辑如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ImagePicker.swift</p></figure><p id="d2b4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">thenMap</code>允许您异步映射单个值，解析承诺，并返回实际值。</p><p id="64ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在映射到它之后，您可以用<code class="fe lu lv lw lx b">done</code>获取值，它从承诺集合中获取所有的值。</p><p id="bf58" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我觉得看起来简单多了。</p><p id="fe4e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有关PromiseKit的更多信息，请查看文档。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="e7fa" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">结论</h1><p id="e102" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">就是这样！</p><p id="4cf7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们已经介绍了如何在SwiftUI应用中使用<code class="fe lu lv lw lx b">PHPicker</code>。<code class="fe lu lv lw lx b">PHPicker</code>是处理您的照片库的一种强大而简单的方法。</p><p id="a541" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望你觉得这很有趣。</p><p id="3682" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，这里是最后的代码:</p><div class="nq nr gp gr ns nt"><a href="https://github.com/manakuro/swiftui-with-phpicker-example" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">manakuro/swift ui-with-ph picker-示例</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">带有SwiftUI GitHub的PHPicker示例应用程序是超过5000万开发人员的家园，他们一起工作来托管和审查…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">github.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh ks nt"/></div></div></a></div></div></div>    
</body>
</html>