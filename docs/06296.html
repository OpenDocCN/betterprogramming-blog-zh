<html>
<head>
<title>Exploring Firebase Authentication</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索Firebase认证</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/exploring-firebase-authentication-2d9e5c501633?source=collection_archive---------14-----------------------#2020-09-17">https://betterprogramming.pub/exploring-firebase-authentication-2d9e5c501633?source=collection_archive---------14-----------------------#2020-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c782" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用FirebaseAuth库对用户进行身份验证</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ee679b4bd7a8ba7dd12a0f1f6be1fde5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*moFTB1NGx9f9Xf1Q"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@grohsfabian?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Fabian Grohs </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="5742" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Android开发正在迅速采用Kotlin，因此在本文中，我们将通过Kotlin实现Firebase认证。要添加支持ktx的Firebase Auth库，请在<code class="fe lv lw lx ly b">build.gradle</code>文件的模块级的dependencies标签下添加以下行:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="f349" class="md me it ly b gy mf mg l mh mi">implementation 'com.google.firebase:firebase-auth-ktx:19.3.1'</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="b913" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">注册并使用电子邮件和密码登录</h1><p id="bb9b" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">当您想到身份验证时，电子邮件/密码是广泛使用的方法之一。Firebase支持这种方法。首先，让我们看看如何注册一个新用户。然后，我们将看到如何为现有用户实现登录。</p><p id="6e9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要在Firebase控制台的Authentication选项卡下启用电子邮件/密码登录方法。一旦你完成了，我们就可以开始编码了。</p><h2 id="7f78" class="md me it bd mr nm nn dn mv no np dp mz li nq nr nb lm ns nt nd lq nu nv nf nw bi translated">注册</h2><p id="b933" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">注册就像在Firebase控制台中为用户创建一个新帐户一样简单。为此，我们需要创建一个<code class="fe lv lw lx ly b">FirebaseAuth</code>的实例，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">正在创建FirebaseAuth实例</p></figure><p id="d0cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">FirebaseAuth</code>实例，我们可以通过调用<code class="fe lv lw lx ly b">createUserWithEmailAndPassword</code>函数为用户创建一个新帐户。该函数将电子邮件和密码作为参数。</p><p id="37c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开箱即用，该功能将避免重复帐户、密码/电子邮件验证，并保持标准的密码强度。我们可以添加一个回调侦听器，它返回一个任务对象，其中包含关于请求的详细信息。如果请求成功，我们可以通过调用<code class="fe lv lw lx ly b">FirebaseAuth</code>实例上的<code class="fe lv lw lx ly b">currentUser</code>来访问当前用户信息，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用电子邮件/密码创建新帐户</p></figure><h2 id="94ed" class="md me it bd mr nm nn dn mv no np dp mz li nq nr nb lm ns nt nd lq nu nv nf nw bi translated">登录</h2><p id="eb97" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">现在我们知道了如何使用电子邮件/密码方法在Firebase中创建新用户，让我们看看如何实现现有用户的登录。</p><p id="8aab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像创建新用户的<code class="fe lv lw lx ly b">createUserWithEmailAndPassword</code>函数一样，我们用<code class="fe lv lw lx ly b">signInWithEmailAndPassword</code>来实现现有用户的登录。我们可以添加回调，并在注册期间实现的任务对象中接收详细信息。看看登录实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="7fdc" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">当前用户信息</h1><p id="2a9c" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">既然我们已经知道了如何在Firebase中创建一个帐户并登录到一个现有用户，那么是时候检索用户信息了。有了Firebase，我们不再需要在首选项中维护用户详细信息。相反，我们可以从<code class="fe lv lw lx ly b">FirebaseAuth</code>实例中直接访问它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从FirebaseAuth检索当前用户的详细信息</p></figure><p id="b637" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您使用<code class="fe lv lw lx ly b">FirebaseAuth</code>登录/注册，它将存储用户的详细信息。因此，即使应用程序重新启动，我们也可以访问它们。我们可以通过调用<code class="fe lv lw lx ly b">FirebaseAuth</code>实例上的<code class="fe lv lw lx ly b">signOut</code>函数来清除用户，如下所示:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="85dc" class="md me it ly b gy mf mg l mh mi">Firebase.auth.signOut()</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="d676" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">通过Firebase使用社交网站</h1><p id="f3a2" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">使用谷歌或脸书等社交网站来验证用户身份，将减少与机上用户的摩擦。在这里，我们将学习如何使用谷歌和脸书登录Firebase。</p><h2 id="83c6" class="md me it bd mr nm nn dn mv no np dp mz li nq nr nb lm ns nt nd lq nu nv nf nw bi translated">用谷歌登录</h2><p id="1124" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">要用Firebase实现Google登录，我们需要添加一个<code class="fe lv lw lx ly b">play-services-auth library</code>。在<code class="fe lv lw lx ly b">build.gradle</code>文件的模块级的dependencies标签下添加下面一行:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="c1d3" class="md me it ly b gy mf mg l mh mi">implementation 'com.google.android.gms:play-services-auth:18.0.0'</span></pre><p id="1816" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是在Firebase控制台中启用Google登录选项，就像我们对电子邮件/密码方法所做的那样。</p><p id="5c13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要配置Google Sign-In来请求用户id和基本的个人资料信息，创建一个带有<code class="fe lv lw lx ly b">DEFAULT_SIGN_IN</code>参数的<code class="fe lv lw lx ly b"><a class="ae ky" href="https://developers.google.com/android/reference/com/google/android/gms/auth/api/signin/GoogleSignInOptions.Builder#GoogleSignInOptions.Builder%28%29" rel="noopener ugc nofollow" target="_blank">GoogleSignInOptions</a></code>对象。要请求用户的电子邮件地址，使用<code class="fe lv lw lx ly b">requestEmail</code>选项创建<code class="fe lv lw lx ly b">GoogleSignInOptions</code>对象。</p><p id="ebff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们需要配置Google Sign-In来请求用户id和基本的个人资料数据。首先，我们需要创建一个带有<code class="fe lv lw lx ly b">DEFAULT_SIGN_IN</code>参数的<code class="fe lv lw lx ly b"><a class="ae ky" href="https://developers.google.com/android/reference/com/google/android/gms/auth/api/signin/GoogleSignInOptions.Builder#GoogleSignInOptions.Builder%28%29" rel="noopener ugc nofollow" target="_blank">GoogleSignInOptions</a></code>对象。要访问用户的电子邮件地址，将<code class="fe lv lw lx ly b">requestEmail</code>选项添加到<code class="fe lv lw lx ly b">GoogleSignInOptions</code>对象中。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建Google登录构建器</p></figure><p id="fd17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您使用Google登录与后端服务器通信时，您需要调用<code class="fe lv lw lx ly b">requestIdToken</code>并传递按照本指南<a class="ae ky" href="https://developers.google.com/identity/sign-in/android/sign-in" rel="noopener ugc nofollow" target="_blank">中的步骤</a>获得的令牌。</p><p id="68a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过调用<code class="fe lv lw lx ly b"><a class="ae ky" href="https://developers.google.com/android/reference/com/google/android/gms/auth/api/signin/GoogleSignInOptions.Builder#GoogleSignInOptions.Builder%28%29" rel="noopener ugc nofollow" target="_blank">GoogleSignInOptions</a></code>上的登录意图导航到Google登录页面，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">登录意图</p></figure><p id="ca13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果在<code class="fe lv lw lx ly b">onActivityResult</code>中请求成功，我们就可以访问可以在Firebase中使用的令牌，如下图所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Google登录响应处理</p></figure><p id="6712" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们从已登录的帐户获得令牌，我们就可以通过传递令牌调用<code class="fe lv lw lx ly b">GoogleAuthProvider</code>上的<code class="fe lv lw lx ly b">getCredentialon</code>来创建凭证。然后我们可以使用凭证作为参数调用<code class="fe lv lw lx ly b">FirebaseAuth</code>实例上的<code class="fe lv lw lx ly b">signInWithCredential</code>。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="e383" class="md me it bd mr nm nn dn mv no np dp mz li nq nr nb lm ns nt nd lq nu nv nf nw bi translated">使用脸书登录</h2><p id="a442" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">要使用脸书登录，我们需要在Firebase控制台中启用这个选项，就像我们对Google和email/password方法所做的那样。</p><p id="1cbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要请求脸书访问用户的基本信息，如电子邮件和个人资料。为此，我们使用脸书的登录按钮和<code class="fe lv lw lx ly b">CallbackManager</code>，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">脸书登录</p></figure><p id="ce0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果请求成功，那么我们可以访问来自<code class="fe lv lw lx ly b">loginResult</code>的令牌，该令牌用于创建来自<code class="fe lv lw lx ly b">FacebookAuthProvider</code>的凭证。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用脸书登录的Firebase</p></figure><p id="97db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前就这些。希望你学到了有用的东西。感谢阅读！</p></div></div>    
</body>
</html>