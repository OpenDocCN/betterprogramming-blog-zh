# 高级 Python:定义类时应用的 9 个最佳实践

> 原文：<https://betterprogramming.pub/advanced-python-9-best-practices-to-apply-when-you-define-classes-871a27af658b>

## 如何让你的代码更具可读性和可维护性

![](img/0017d8ece2802a3c38d72475e12b6ca1.png)

费雷什特·阿扎迪在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

从本质上讲，Python 是一种面向对象的编程(OOP)语言。作为一种面向对象的语言，Python 通过支持以对象为中心的各种特性来处理数据和功能。例如，数据结构是所有的对象，包括在一些其他语言中不被认为是对象的基本类型(例如，整数和字符串)。对于另一个实例，函数都是对象，并且它们仅仅是定义它们的其他对象的属性(例如，类或模块)。

尽管您可以使用内置数据类型并编写大量函数而无需创建任何自定义类，但随着项目范围的扩大，您的代码可能会变得越来越难以维护。这些独立的部分没有共享的主题，尽管大部分信息是相关的，但是管理它们之间的连接会有很多麻烦。

在这些场景中，定义您自己的类是值得的，这将允许您对相关信息进行分组，并改进项目的结构设计。更重要的是，您的代码库的长期可维护性将得到改善，因为您将处理更少的代码片段。然而，有一个问题——只有当您的类声明以正确的方式完成，定义自定义类的好处可以超过管理它们的开销时，这才是真的。

在本文中，我想回顾九个重要的最佳实践，您应该考虑将它们应用到您的定制类中。

# 1.好名字

当你定义自己的类时，你就在你的代码库中添加了一个新生儿。你应该给这个类起一个很好的名字。尽管类名的唯一限制是合法 Python 变量的规则(例如，不能以数字开头)，但是有一些给出类名的首选方法。

*   **使用容易发音的名词。如果你从事团队项目，这一点尤为重要。在小组演示期间，您可能不想成为说“在这种情况下，我们创建 Zgnehst 类的一个实例”的人。另外，容易发音也意味着名字不能太长。我几乎想不出需要使用三个以上的单词来定义类名的情况。一个字最好，两个字就好，三个字就是极限。**
*   **反映其存储的数据和预期的功能。这就像在我们的现实生活中一样——男孩被赋予男孩的名字。当我们看到男孩的名字时，我们希望孩子是男孩。它也适用于类名(或任何其他变量)。规则很简单*——不要给人惊喜。如果您要处理学生的信息，那么这个类应该命名为 Student。KiddosAtCampus 不符合最基本的常识。***
*   *遵循命名惯例。我们应该对类名使用大写的 camel 风格，比如 GoodName。以下是非传统类名的不完整列表:GOodnAme、Good_Name、good_name 和 goodName。遵循命名惯例是为了让你的意图清晰。当人们阅读你的代码时，他们可以放心地认为一个名字像 GoodName 的对象是一个类。*

*还有适用于属性和函数的命名规则和约定。在下面的部分中，我将在适用的地方简要提及它们，但是总体原则是相同的。唯一的经验法则很简单:不要给人惊喜。*

# *2.显式实例属性*

*大多数情况下，我们希望定义自己的实例初始化方法(即`__init__`)。在这个方法中，我们设置新创建的类实例的初始状态。然而，Python 并没有限制在哪里可以用自定义类定义实例属性。换句话说，您可以在创建实例后的后续操作中定义附加的实例属性。下面的代码向您展示了一个可能的场景。*

*初始化方法*

*如上所示，我们可以通过指定学生的名和姓来创建一个*学生*类的实例。稍后，当我们调用实例方法(即`verify_registration_status`)时， *Student* 实例的 status 属性将被设置。然而，这并不是我们想要的模式，因为如果您将各种实例属性分散到整个类中，您就不能让类清楚一个实例对象包含什么数据。因此，最佳实践是将实例的属性放在`__init__`方法中，这样代码的读者就有了一个了解类的数据结构的地方，如下所示。*

*更好的初始化方法*

*对于那些最初不能设置的实例属性，可以用占位符值来设置，比如`None`。虽然这不太重要，但这一更改也有助于防止当您忘记调用一些实例方法来设置适用的实例属性时可能出现的错误，从而导致 *AttributeError* ( `‘Student’ object has no attribute ‘status_verified’`)。*

*根据命名规则，属性应该使用小写字母命名，并遵循 snake case 样式，这意味着如果您使用多个单词，请用下划线连接它们。此外，所有的名字应该有关于它保存什么数据的有意义的指示(例如，`first_name`比`fn`更好)。*

# *3.使用属性——但要节俭*

*有些人学习 Python 编码时已经有了其他 OOP 语言的背景，比如 Java，他们习惯于为实例的属性创建 getters 和 setters。使用 Python 中的属性装饰器可以模仿这种模式。下面的代码向您展示了使用属性装饰器实现 getters 和 setters 的基本形式。*

*物业装饰*

*一旦创建了这个属性，我们就可以使用点符号将它作为常规属性使用，尽管它是使用幕后的函数实现的。*

*使用属性*

*您可能知道，使用属性实现的优点包括验证正确的值设置(检查是否使用了字符串，而不是整数)和只读访问(通过不实现 setter 方法)。但是，您应该尽量少用属性。如果您的自定义类看起来像下面这样，会非常令人分心——属性太多了！*

*滥用财产*

*在大多数情况下，这些属性可以用实例属性替换，因此我们可以直接访问和设置它们。除非您对使用属性的好处有特殊需求(例如，值验证)，否则使用属性比在 Python 中创建属性更可取。*

# *4.定义有意义的字符串表示*

*在 Python 中，名字前后有双下划线的函数被称为特殊的或神奇的方法，有些人称之为 dunder 方法。它们对解释器的基本操作有特殊的用法，包括我们之前介绍过的`__init__`方法。两个特殊的方法，`__repr__`和`__str__`，对于创建自定义类的正确字符串表示是必不可少的，这将为代码读者提供关于类的更直观的信息。*

*它们之间的主要区别在于，`__repr__`方法定义了字符串，使用该字符串，您可以通过调用`eval(repr(“the repr”))`来重新创建对象，而`__str__`方法定义了更具描述性且允许更多定制的字符串。换句话说，您可以认为在`__repr__`方法中定义的字符串是供开发人员查看的，而在`__str__`方法中使用的字符串是供普通用户查看的。下面是一个例子。*

*字符串表示的实现*

*请注意，在`__repr__`方法的实现中(第 7 行), f-string 使用了`!r`,它将显示这些带引号的字符串，因为它们是用正确格式化的字符串构造实例所必需的。没有了！r 格式，字符串将是`Student(John, Smith)`，这不是构造*学生*实例的正确方法。让我们看看这些实现是如何向我们展示字符串的。具体来说，当您在交互式解释器中访问对象时会调用`__repr__`方法，而当您打印对象时，默认情况下会调用`__str__`方法。*

*字符串表示*

# *5.实例、类和静态方法*

*在一个类中，我们可以定义三种方法:实例、类和静态方法。您需要考虑对于相关的功能应该使用什么方法。以下是一些通用指南。*

*例如，如果方法与单个实例对象有关，您需要访问或更新实例的特定属性，在这种情况下，您应该使用实例方法。这些方法有一个签名是这样的:`def do_something(self):`，其中 *self* 参数指的是调用方法的实例对象。想了解更多关于*自我*的论证，可以参考[我之前关于这个话题的文章](https://medium.com/better-programming/unlock-the-4-mysteries-of-self-in-python-d1913fbb8e16)。*

*如果这些方法与单个实例对象无关，您应该考虑使用类或静态方法。这两种方法都可以用合适的装饰器轻松定义:`classmethod`和`staticmethod`。这两者的区别在于，类方法允许您访问或更新与类相关的属性，而静态方法独立于任何实例或类本身。类方法的一个常见例子是提供方便的实例化方法，而静态方法可以只是一个实用函数。下面的代码展示了一些例子。*

*不同种类的方法*

*以类似的方式，您也可以创建类属性。与我们前面讨论的实例属性不同，类属性由所有实例对象共享，它们应该反映一些独立于单个实例对象的特征。*

# *6.使用私有属性的封装*

*当你为你的项目编写定制类时，你需要考虑封装，特别是当你期望其他人也会使用你的类时。当类的功能增加时，一些函数或属性只与类内的数据处理相关。换句话说，在类之外，这些函数不会被调用，你的类的其他用户甚至不会关心这些函数的实现细节。在这些场景中，您应该考虑封装。*

*按照惯例，应用封装的一个重要方法是给属性和函数加上一个或两个下划线前缀。微妙的区别在于，那些带下划线的被认为是受保护的 T2，而那些带两个下划线的被认为是私有的 T4，这涉及到创建后的域名篡改。区分这两个类别超出了本文的范围，我以前的一篇文章已经讨论过了。*

*本质上，通过以这种方式命名属性和函数，您告诉 ide(即集成开发环境，如 PyCharm)它们不会在类之外被访问，尽管 Python 中不存在真正的私有属性。换句话说，如果我们愿意，它们仍然可以被访问。*

*包装*

*上面的代码向您展示了一个简单的封装示例。对于一个学生来说，我们可能有兴趣知道他们的平均 GPA，用`get_mean_gpa`的方法就能得到要点。用户不需要知道平均 GPA 是如何计算的，这样我们可以通过在函数名前加下划线来保护相关的方法。*

*这种最佳实践的关键要点是，您只公开与用户使用您的代码相关的最小数量的公共 API。对于那些只在内部使用的方法，使它们成为受保护的或私有的方法。*

# *7.分离关注点和分离*

*随着项目的发展，您发现您要处理更多的数据，如果您坚持使用一个单独的类，您的类会变得很麻烦。让我们继续以*学生*班级为例。假设学生在学校吃午饭，他们每个人都有一个用餐账户，可以用来支付餐费。理论上，我们可以在 *Student* 类中处理与帐户相关的数据和功能，如下所示。*

*混合功能*

*上面的代码向你展示了一些关于检查账户余额和将钱存入账户的伪代码，这两者都是在*学生*的类中实现的。想象一下，有更多的操作可以与帐户相关，例如暂停一张丢失的卡，合并帐户—实现所有这些操作将使*学生*类越来越大，逐渐变得越来越难以维护。相反，你应该隔离这些职责，让你的*学生*类对这些与账户相关的功能不负责任——这种设计模式被称为*解耦*。*

*分离的关注点*

*上面的代码向您展示了我们如何使用一个额外的 *Account* 类来设计数据结构。如您所见，我们将所有与账户相关的操作都转移到了*账户*类中。为了检索学生的帐户信息，*学生*类将通过从*帐户*类检索信息来处理该功能。如果我们想实现更多与类相关的功能，我们可以简单地只更新*账户*类。*

*设计模式的主要要点是，您希望您的各个类有单独的关注点。通过分离这些职责，您的类变得更小，这使得将来的更改更容易，因为您将处理更小的代码组件。*

# *8.考虑 __slots__ 进行优化*

*如果您的类主要用作存储数据的数据容器，您可以考虑使用`__slots__`来优化您的类的性能。它不仅提高了属性访问的速度，还节省了内存，如果您需要创建成千上万的实例对象，这将是一个很大的好处。原因是对于常规类，实例属性是通过内部管理的字典存储的。相比之下，通过使用`__slots__`，实例属性将使用 C 实现的与数组相关的数据结构来存储，并且它们的性能以更高的效率得到优化。*

*类定义中 __slots__ 的使用*

*上面的代码向你展示了一个我们如何在类中实现`__slots__`的简单例子。具体来说，您将所有属性作为一个序列列出，这将在数据存储中创建一对一的匹配，以实现更快的访问和更少的内存消耗。正如刚才提到的，常规类使用字典进行属性访问，但那些实现了`__slots__`的类不使用字典。下面的代码向您展示了这样一个事实。*

*具有 __slots__ 的类中没有 __dict__*

*关于使用`__slots__`的详细讨论可以在[栈溢出](https://stackoverflow.com/questions/472000/usage-of-slots)上的一个好看的回答中找到，也可以从官方[文档](https://docs.python.org/3/reference/datamodel.html#slots)中找到更多信息。关于获得更快的访问和节省内存的好处，最近的一篇文章有一个很好的演示，我不打算在这方面展开。然而，有一点需要注意，使用`__slots__`会有副作用——它会阻止您动态创建额外的属性。有些人建议将它作为控制类属性的一种机制，但它不是这样设计的。*

# *9.证明文件*

*最后，但同样重要的是，我们必须谈谈你的类的文档。最重要的是，我们需要理解编写文档并不是取代任何代码。编写大量的文档并不能提高代码的性能，也不一定能提高代码的可读性。如果你不得不依靠 docstrings 来澄清你的代码，很有可能你的代码有问题。我真的相信你的代码应该自己说话。下面的代码只是向您展示了一些程序员可能会犯的错误——使用不必要的注释来补偿糟糕的代码(即，在这种情况下没有意义的变量名)。相比之下，一些名字好听的好代码甚至不需要注释。*

*不良评论示例*

*我并不是说我反对编写注释和 docstrings，但这确实取决于您的用例。如果你的代码被不止一个人或者不止一个场合使用(例如，你是唯一一个访问代码的人，但是是多次使用)，你应该考虑写一些好的注释。他们可以帮助你自己或你的队友阅读你的代码，但是没有人应该假设你的代码完全符合评论中所说的。换句话说，写好代码永远是你需要牢记的头等大事。*

*如果您的代码的特定部分将由最终用户使用，您希望编写文档字符串，因为这些人不熟悉相关的代码库。他们想知道的只是如何使用相关的 API，文档字符串将构成帮助菜单的基础。因此，作为程序员，你有责任确保你提供了关于如何使用你的程序的清晰说明。*

# *结论*

*在本文中，我们回顾了在定义自己的类时需要考虑的重要因素。如果您是 Python 或一般编程的新手，您可能无法完全理解我们讨论的每个方面，这没关系。你编码的越多，你就越会发现在定义类之前记住这些原则的重要性。当你处理类的时候，不断地实践这些指导方针，因为一个好的设计将会节省你以后的开发时间。*