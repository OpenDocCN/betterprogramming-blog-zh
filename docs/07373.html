<html>
<head>
<title>K8s: Vanilla All the Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">K8s:一路香草</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/k8s-vanilla-all-the-way-9ba8c746e4f0?source=collection_archive---------3-----------------------#2021-01-08">https://betterprogramming.pub/k8s-vanilla-all-the-way-9ba8c746e4f0?source=collection_archive---------3-----------------------#2021-01-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9194" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Vanilla Stack是一个新的基于Kubernetes的开源云原生栈</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fe83ae76af2350b73bb18cde626cf6db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cZIIlLozeU52HiFX9pT5cQ.jpeg"/></div></div></figure><p id="d0e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">几周前，我偶然发现了<a class="ae lq" href="https://vanillastack.io/" rel="noopener ugc nofollow" target="_blank"> Vanilla Stack </a>，这是一个基于Kubernetes的技术堆栈，嵌入了许多优秀的开源组件。在这篇文章中，这主要是一个堆栈的介绍，我们将快速浏览安装过程，展示不同的可用选项。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="8f23" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">香草栈——温和的介绍</h1><p id="6a4f" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated"><a class="ae lq" href="https://vanillastack.io" rel="noopener ugc nofollow" target="_blank"> Vanilla Stack </a>可以定义为一个<a class="ae lq" href="https://kubernetes.io" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>集群，附带许多开源组件。</p><p id="b849" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">开箱即用的不同解决方案包括:</p><ul class=""><li id="9e31" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated"><a class="ae lq" href="https://rook.io" rel="noopener ugc nofollow" target="_blank"> Rook </a>管理分布式存储(文件系统、数据块、对象)</li><li id="5e59" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated"><a class="ae lq" href="https://www.openstack.org/" rel="noopener ugc nofollow" target="_blank"> OpenStack </a>提供基础设施即服务(IaaS)</li><li id="4f76" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated"><a class="ae lq" href="https://www.cloudfoundry.org/" rel="noopener ugc nofollow" target="_blank"> Cloud Foundry </a>提供平台即服务(PaaS)</li></ul><p id="9b82" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下来自官方文档的模式说明了堆栈的全局架构。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/3edaf8411a2b89b2b90b582b2a611d3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ax1RSg2kcX4CFGDOVN9e0A.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">整体架构</p></figure><p id="ee7d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意:</strong>Vanilla Stack附带的所有解决方案(Rook、Cloud Foundry、OpenStack和许多其他工具)都作为Pods在底层Kubernetes集群中运行。</p><p id="45d4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从上面的模式中我们可以看到，客户端可以:</p><ul class=""><li id="a027" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">通过创建部署、服务、导航图等，在底层Kubernetes集群上运行应用程序。</li><li id="39f8" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">使用Cloud Foundry从您的代码中运行应用程序(使用简单的<code class="fe no np nq nr b">cf push</code> <em class="ns"> ) </em></li><li id="91aa" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">使用OpenStack创建新的基础架构(虚拟机、软件定义的网络等。)</li></ul><p id="d214" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意:</strong>底层机器的硬件要求取决于将安装在堆栈中的组件。</p><p id="ee44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面的模式更深入一点，提供了所有组件的列表，按类别组织，可以与Vanilla堆栈一起提供:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/2b61a784228685391552808adce99858.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wdNmsh7GC53CrpPZ188LdA.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">作为Vanilla堆栈一部分的开源组件</p></figure><p id="4761" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很漂亮，对吧？有些组件是默认安装的，其他组件可以在安装过程中选择。</p><p id="380d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我们将展示安装过程的主要步骤。为了简单起见，我们将在<a class="ae lq" href="https://digitalocean.com" rel="noopener ugc nofollow" target="_blank">数字海洋</a>上提供的六个虚拟机上设置Vanilla堆栈:三个虚拟机将充当Kubernetes主节点，另外三个将充当工作节点。</p><p id="db49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意:</strong>根据我们要安装的组件，可能无法使用所有云提供商，因为有些可能不符合安装要求。例如，要安装Rook，我们需要一个允许提供块存储的基础设施提供者。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="7463" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">运行安装</h1><p id="731c" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">有两种安装Vanilla堆栈的方法，在<a class="ae lq" href="https://vanillastack.io/download" rel="noopener ugc nofollow" target="_blank">下载</a>部分都有描述。在本文中，我们将使用Docker安装，它可以通过以下命令运行:</p><pre class="kj kk kl km gt nu nr nv nw aw nx bi"><span id="2cb1" class="ny lz it nr b gy nz oa l ob oc">$ docker run \<br/>  --name VanillaStack-installer -d \<br/>  -p 8080:8080 \<br/>  harbor.vanillastack.io/vanillastack/installer:latest</span></pre><p id="3893" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">端口8080上提供了安装程序的web界面。它介绍了我们将经历的十几个简单步骤。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="f9d7" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">要求</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/99aae7e7eb9cdb62adbdee4904306932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DZvGOkt7M97vJYCSuc4Wog.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">标准堆栈安装程序的第一步</p></figure><p id="ac0a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一步，<strong class="kw iu"> Start </strong>，定义将要安装堆栈的机器的硬件和软件需求。</p><p id="1af5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">出于本文的目的，我们将使用在<a class="ae lq" href="https://digitalocean.com" rel="noopener ugc nofollow" target="_blank">数字海洋</a>上创建的六个虚拟机。每个虚拟机都运行Ubuntu 20.04 box，并拥有4 GB ram / 2个CPU。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/2f556b011fad8dbd2bcd3449230e619e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NQ3Z6T9WDTIotqZ2JtPK-g.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">用于设置Vanilla堆栈的数字海洋虚拟机的特征</p></figure><p id="6ad4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这些虚拟机中，三个将充当Kubernetes主节点，其他的将作为工作节点。</p><pre class="kj kk kl km gt nu nr nv nw aw nx bi"><span id="2443" class="ny lz it nr b gy nz oa l ob oc"># IP addresses of the master nodes<br/>master1 - 159.65.92.123<br/>master2 - 178.62.32.212<br/>master3 - 178.62.40.225<br/></span><span id="8d2b" class="ny lz it nr b gy of oa l ob oc"># IP addresses of the worker nodes<br/>worker1 - 178.62.41.87<br/>worker2 - 178.62.27.97<br/>worker3 - 178.62.67.29</span></pre><p id="773a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们还需要设置域(和几个子域)来访问集群。稍后在配置负载平衡器时，我们将回到这一步。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="10da" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">条件</h1><p id="fdeb" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated"><strong class="kw iu">条款</strong>是第二步。它提供了有关许可证的信息，并要求我们接受条款和条件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/b88a35dbe6d054ba9379013dd00c5c7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xd-31NTilxOLypSZqfYs5g.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">展示使用Vanilla堆栈的条款和条件</p></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="d513" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">常规设置</h1><p id="311d" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">接下来，在<strong class="kw iu">通用设置</strong>步骤中，我们需要指定我们想要的安装类型:</p><ul class=""><li id="0350" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">硕士人数</li><li id="1fe9" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">工人人数</li><li id="6ab1" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">初始工作量</li></ul><div class="kj kk kl km gt ab cb"><figure class="og kn oh oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/fa2de678df2e5a22233ec27b5400609c.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*32zSXoFvq56PWxRbVqFSXw.png"/></div></figure><figure class="og kn oh oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/741e079fd9645cd5eac682790888d81a.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*G4sAQkCPR__5F718mfAqUg.png"/></div></figure><figure class="og kn oh oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/0ad7e1640bd808562d2f09131f31e657.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*25l2JskvVgcOu_S_hS5YMw.png"/></div><p class="nk nl gj gh gi nm nn bd b be z dk om di on oo translated">常规设置步骤，定义安装类型</p></figure></div><p id="850e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们的示例中，我们使用三个主节点进行HA安装，其余三个节点充当工作节点。默认情况下，选择Rook来安装存储解决方案。这里我们不会用OpenStack或者Cloud Foundry。(这可能是另一篇文章的主题)。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="504b" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">通过SSH密钥授予对虚拟机的访问权限</h1><p id="f1f6" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated"><strong class="kw iu">公钥</strong>部分提供RSA公钥，并要求在每个虚拟机上复制它。这一步对于允许安装机器(安装程序在其上运行的机器)运行Ansible行动手册来配置每个虚拟机是必要的。</p><p id="8f99" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意:</strong>T5】ansi ble是一个配置工具。它仅通过SSH连接在目标机器上运行命令。它不像其他配置工具如<a class="ae lq" href="https://www.chef.io/" rel="noopener ugc nofollow" target="_blank"> Chef </a>和<a class="ae lq" href="https://puppet.com" rel="noopener ugc nofollow" target="_blank"> Puppet </a>一样需要任何代理。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/e0a527c08420b19c9cff7f55705988fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXcPUR-FEF9fhHm7vsnT1g.png"/></div></div></figure><p id="730f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">安装程序中指定了复制密钥的说明:</p><ul class=""><li id="0415" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">将密钥存储在名为<code class="fe no np nq nr b">key.pub</code>的文件中。</li><li id="524a" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">使用<code class="fe no np nq nr b">ssh-copy-id</code>将密钥复制到目标计算机:</li></ul><pre class="kj kk kl km gt nu nr nv nw aw nx bi"><span id="c02d" class="ny lz it nr b gy nz oa l ob oc">ssh-copy-id -f -i key.pub &lt;username&gt;@&lt;ip-address-of-node&gt;</span></pre><ul class=""><li id="bcc0" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">对所有节点重复此操作。</li></ul><p id="fe32" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于Windows，请按照这篇博文中的说明:<a class="ae lq" href="https://www.chrisjhart.com/Windows-10-ssh-copy-id/" rel="noopener ugc nofollow" target="_blank">https://www.chrisjhart.com/Windows-10-ssh-copy-id/</a>，从“将SSH密钥复制到远程Linux设备”开始</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="f524" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">定义节点的信息</h1><p id="3ddd" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">在<strong class="kw iu">节点</strong>步骤中，我们需要定义每个主节点和工作节点的IP地址和用户。</p><div class="kj kk kl km gt ab cb"><figure class="og kn op oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/fb873b6b9c97dd10417b72a9e8739019.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*G7Ptz6TQlYnqFqVO-QFsTQ.png"/></div></figure><figure class="og kn oq oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/503260246ad0b733524a4a3fb00d0aa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*a5Sk2P6ylhusuVYXdXKImQ.png"/></div><p class="nk nl gj gh gi nm nn bd b be z dk or di os oo translated">定义节点的IP地址</p></figure></div><p id="8e21" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们还需要定义将用于运行车舱的节点。为了满足需求，我们使用了所有三个工作节点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/b7b4365b1fce27c676221f9c1ca56348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Le7kQTqRF_Q9NDkQx8kk1Q.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">选择运行车舱的节点</p></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="b6cb" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">检查节点配置</h1><p id="7177" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated"><strong class="kw iu">节点检查</strong>步骤用于确保每个节点符合要求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/c636e67cdb81c40c47de3761dce79e4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zsxfrWfIVWqoGGUoxtR12g.png"/></div></div></figure><p id="0836" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在单击Validates Nodes按钮之前，我们需要稍微滚动一下，确保满足Rook的要求:每个节点都需要连接一个原始块设备。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/2b9039216dc02e2161edc37da55a3e01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CVVtn5GWw9LYzOk8l4F1Sw.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">块设备需要连接到运行Rook的每个节点</p></figure><p id="6cc4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Digital Ocean中，我们可以通过创建三个块设备并将每个设备安装在一个工作节点上来轻松完成这一步。</p><div class="kj kk kl km gt ab cb"><figure class="og kn ow oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/e89e5cdd8ba21dcc091bbc3b5872b2d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*Uy42Tusis2-xxIsYqX2rbA.png"/></div></figure><figure class="og kn ox oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/ee1083ed5714350ea73e8549f1a57d7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*SI5PoT0gP6Tu6smhrpHU6w.png"/></div><p class="nk nl gj gh gi nm nn bd b be z dk oy di oz oo translated">从数字海洋界面创建块设备</p></figure></div><p id="ff5a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了验证一切正常，我们可以在工人上运行<code class="fe no np nq nr b">lsblk -f </code>命令:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/020e68e4518c8e90bc344e02072d295c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4qoMrYQAdRm7KJ_MB7_hcQ.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">显示附加块设备(sda)的工作节点</p></figure><p id="5136" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在安装程序中，我们可以通过单击Validate Nodes按钮来确保所有节点都已正确配置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/13ec7b5bedb2cd4d06aac13efcbd593b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n35DxTHwVv2AG69OWuluZw.png"/></div></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="8c99" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">集群设置</h1><p id="344d" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">在<strong class="kw iu">集群设置</strong>步骤中首先要设置的是Pod CIDR和服务CIDR(分别是用于提供Pod的IP地址和服务的虚拟IP的IP范围)。在这个例子中，我们使用默认的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/c407fa2f1c63a9d8e62496b359d0399b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cP80rBq6xjlUcN4IDkdD5Q.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">集群的Pod和服务CIDR的定义</p></figure><p id="c45b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，我们需要创建一个负载平衡器，将特定的流量转发到主节点或工作节点。</p><p id="2cc9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在数字海洋中，不可能使用同一个负载平衡器将流量重定向到不同的节点集。然后，我们将创建两个负载平衡器:</p><ul class=""><li id="9443" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">一个在主节点的前面</li><li id="ff38" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">其他的在工人前面</li></ul><h2 id="3e7d" class="ny lz it bd ma pc pd dn me pe pf dp mi ld pg ph mk lh pi pj mm ll pk pl mo pm bi translated">主节点前面的负载平衡器</h2><p id="3dc7" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">需要第一个负载平衡器来公开集群的API服务器。它必须配置为:</p><ul class=""><li id="246b" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">将端口6443上的TCP流量重定向到主节点上的同一端口</li><li id="671d" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">定期检查在端口6443上发送TCP请求的主节点的健康状况</li></ul><p id="b76d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本例中，负载平衡器获得了IP 159.65.211.35。</p><h2 id="7037" class="ny lz it bd ma pc pd dn me pe pf dp mi ld pg ph mk lh pi pj mm ll pk pl mo pm bi translated">工作节点前面的负载平衡器</h2><p id="9bea" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">需要第二个负载平衡器来公开集群的入口控制器(公开集群中运行的应用程序的组件)。它必须配置为:</p><ul class=""><li id="ce30" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">将HTTP流量(端口80)重定向到工作节点的端口30080</li><li id="e191" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">将HTTPS流量(端口443)重定向到工作节点的端口30443</li><li id="a1d1" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">定期检查在端口30080上发送TCP请求的工作节点的运行状况</li></ul><p id="7a7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本例中，负载平衡器获得了IP 46.101.64.165。</p><h2 id="a48a" class="ny lz it bd ma pc pd dn me pe pf dp mi ld pg ph mk lh pi pj mm ll pk pl mo pm bi translated">设置DNS条目</h2><p id="1f76" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">负载平衡器的IP地址应该与群集域名相关联。在本文中，我们使用<code class="fe no np nq nr b">vanilla.techwhale.io</code>。需要额外的子域，以便可以访问通过入口控制器暴露的API服务器和应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/d4553f22e23c104fd2dde379c31b6c11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mT1RtRLk8PQplHSBzZC3YQ.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">与创建的两个负载平衡器之一的IP相关联的域名</p></figure><p id="10a6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这一步中，我们只能提供单个负载平衡器的IP地址，但是在安装程序的下一个版本中将提供更多的灵活性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/2daead792a4ca9e534e95e0d0a8fd667.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1UuAG3fMUUrMfYDna5qRQ.png"/></div></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="bf69" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">配置让我们加密</h1><p id="7143" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated"><a class="ae lq" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">让我们加密</a>是一个广泛使用的免费认证机构。它基本上允许我们获得HTTPS证书并自动更新。在Kubernetes中，Let's Encrypt经常通过<a class="ae lq" href="https://cert-manager.io/" rel="noopener ugc nofollow" target="_blank">证书管理器</a>使用，这是一个默认安装在Vanilla堆栈中的组件。Cert Manager可以从Let's Encrypt(和其他几个来源)获得一个证书，并通过Kubernetes Secret使它对应用程序可用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/c6787a69202de9d6f88da074ec09ad8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3h9R6HcVKr9mBVCArNJO7Q.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">让我们加密配置</p></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="3fe6" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">车配置</h1><p id="fe07" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated"><strong class="kw iu"> Rook </strong>步骤允许选择将要安装的Rook组件(在这种情况下为Rook仪表板和监控)以及单个数据将被复制的次数(副本级别)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/40d818d683413b7c5917377fdead3f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tHwqcF7cw4K5GXboVCThqQ.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">车的基本配置</p></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="1a1d" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">安装附加工具</h1><p id="311f" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated"><strong class="kw iu">附加工具</strong>部分允许指定将在集群中安装哪些组件。</p><div class="kj kk kl km gt ab cb"><figure class="og kn pq oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/a00c150f7c1ef1c1fe8e392397639cd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Bwa1IsQZvhxmOC4DrKMFbg.png"/></div></figure><figure class="og kn pq oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/f2294b69f371200ed9dd34398e26940d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*DpCnO_WyaF-qF3hUUxEKKQ.png"/></div><p class="nk nl gj gh gi nm nn bd b be z dk pr di ps oo translated">选择将要安装的工具</p></figure></div><p id="48ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里列出的工具非常常见。它们分为不同的类别:</p><ul class=""><li id="47e2" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">监测(普罗米修斯，让格尔)</li><li id="8e2f" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">日志记录(fluentd、Elasticsearch、Grafana)</li><li id="958b" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">集装箱图像登记和舵图储存库(港口)</li><li id="6409" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">入口控制器(nginx)</li></ul><p id="23ad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一种从单一位置安装这些组件的便捷方式。当然，如果在这一步没有选择这些组件，以后仍然可以安装它们。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="26a2" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">签署</h1><p id="71b4" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">此步骤提供了我们需要的所有信息，以防我们想要订阅商业支持。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/790f50b42f3652f026b0a3157ef0d9ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*brNGR9cl_Mjo1CgwoEQU6Q.png"/></div></div></figure><p id="963d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">支持由<a class="ae lq" href="https://cloudical.io/" rel="noopener ugc nofollow" target="_blank">云</a>提供。企业维护<a class="ae lq" href="https://vanillastack.io" rel="noopener ugc nofollow" target="_blank">香草栈</a>并提供<a class="ae lq" href="https://vanillacloud.io/" rel="noopener ugc nofollow" target="_blank">香草云</a>，这是栈的全新托管风格。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="188b" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">查看整个设置</h1><p id="2f69" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">这最后一步允许我们检查和修改(如果需要)我们到目前为止提供的配置选项。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/a640b47c4ac6d9fca60f10d2514161d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N7ZLpK3BbfCGhN1flit5Ww.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">配置选项摘要</p></figure><p id="e471" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在进入下一步并安装整个堆栈之前，我们需要确保在每个节点上正确配置了<code class="fe no np nq nr b"> /etc/apt/sources.list</code> <em class="ns"> </em>，以便它引用正式的存储库。</p><p id="f17c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意:</strong>如果在Digital Ocean上创建虚拟机，例如，默认提供的存储库中没有Ansible二进制文件，则需要执行此步骤。</p><p id="b173" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">解决这个问题的简单方法是用以下指令替换<code class="fe no np nq nr b">/etc/apt/sources.list</code>的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pt"><img src="../Images/86311d666601f1e00daa857f7c83f893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2GRt_UB84-tgTZGfcDBrEw.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">确保来源是上游来源(例如，在Digital Ocean flavor上找不到Ansible包)</p></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="3c2f" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">安装所有的东西</h1><p id="9946" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">一切都准备好了。我们可以运行安装步骤，享受一杯好咖啡。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/89273be32127b6a05b01ce6a7a674920.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*21E0lhD3bKz7WsTFUaIKgQ.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">运行安装</p></figure><p id="564c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在安装日志中，我们将看到应用于每个虚拟机的可行行动手册，以便:</p><ul class=""><li id="1d03" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">安装所有必要的软件包</li><li id="b74b" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">建立一个Kubernetes集群(三个主人/三个工人)</li><li id="b9aa" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">安装Rook和上面选择的所有工具</li></ul><p id="d3e9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">安装整个堆栈不需要太长时间:)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/9174c549043d4982b94f74477062d47f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZOlxl6vp4UqXsMZWf8SCsA.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">安装完成！</p></figure><p id="d50e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意:</strong>我在安装堆栈时遇到了一个小问题，因为数字海洋的负载平衡器将流量转发到节点的内部(私有)IP，而不是公共IP。入口控制器暴露在节点的外部(公共)IP上，因此工作节点被标记为不健康，这是不正确的。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="3766" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">访问集群</h1><p id="edd7" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">可以像往常一样从<code class="fe no np nq nr b">/etc/kubernetes/admin.conf file</code>中检索到<code class="fe no np nq nr b">kubeconfig</code>文件。</p><pre class="kj kk kl km gt nu nr nv nw aw nx bi"><span id="e040" class="ny lz it nr b gy nz oa l ob oc"># Get kubeconfig file<br/>$ ssh root@master1 cat /etc/kubernetes/admin.conf &gt; vanilla.cfg</span><span id="2563" class="ny lz it nr b gy of oa l ob oc"># Configure local kubectl<br/>$ export KUBECONFIG=$PWD/vanilla.cfg</span></pre><p id="c390" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">像往常一样，我们首先列出集群的节点:</p><pre class="kj kk kl km gt nu nr nv nw aw nx bi"><span id="b14e" class="ny lz it nr b gy nz oa l ob oc">$ kubectl get no<br/>NAME      STATUS   ROLES    AGE   VERSION<br/>master1   Ready    master   38m   v1.19.6<br/>master2   Ready    master   37m   v1.19.6<br/>master3   Ready    master   37m   v1.19.6<br/>worker1   Ready    worker   37m   v1.19.6<br/>worker2   Ready    worker   37m   v1.19.6<br/>worker3   Ready    worker   37m   v1.19.6</span></pre><p id="b010" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，我们可以检查集群中运行的所有pod以及公开它们的服务。</p><div class="kj kk kl km gt ab cb"><figure class="og kn pv oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/3024efee305bca4d47cc70d6f2fff08b.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*6eFZOswEo4Y-7Sf78w3fwQ.png"/></div></figure><figure class="og kn pw oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/d4991bc40f2861ce6d9c48bb82120296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*j3KJMgsI3wdKjcBseuZswA.png"/></div><p class="nk nl gj gh gi nm nn bd b be z dk px di py oo translated">获取群集中正在运行的pod和现有服务</p></figure></div><p id="3beb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一切似乎都很好。下一步可能是运行一个测试应用程序，例如，一个有状态的应用程序，它:</p><ul class=""><li id="c550" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">使用由Rook创建的Ceph集群提供的块存储</li><li id="c2c8" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">通过nginx入口控制器公开</li><li id="1cef" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">使用证书管理器自动创建的TLS证书来加密CA</li></ul></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="8acf" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">摘要</h1><p id="38d5" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">设置香草栈真的很快。Docker安装程序简单而干净。应该很快添加额外的选项，以提供更大的灵活性。</p><p id="f083" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你不想安装普通堆栈，你可以直接从<a class="ae lq" href="https://vanillacloud.io/" rel="noopener ugc nofollow" target="_blank">普通云</a>中使用这个堆栈。这种新的云产品于2020年12月试运行，第一个测试版将于2021年1月推出。</p><p id="9ebc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我强烈推荐仔细看看这个堆栈，因为这也是更熟悉许多广泛使用的开源项目的好方法。</p></div></div>    
</body>
</html>