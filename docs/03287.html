<html>
<head>
<title>Serialization and Deserialization for DynamoDB With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python实现DynamoDB的序列化和反序列化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/serialisation-and-deserialisation-for-dynamodb-with-python-eaa8f07f08e2?source=collection_archive---------1-----------------------#2020-02-01">https://betterprogramming.pub/serialisation-and-deserialisation-for-dynamodb-with-python-eaa8f07f08e2?source=collection_archive---------1-----------------------#2020-02-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cf81" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python 3和Boto 3库的DynamoDB教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/08efe8aeb52c9b3a8bbf353a996706ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_pUC6g_Br5dLyCmH"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@ratushny?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Dmitry Ratushny </a>拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="ac25" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">介绍</h1><p id="c4ba" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">什么是序列化和反序列化？通俗地说，这就像一种语言翻译，这样我们的观众就能理解我们在说什么。</p><p id="cc54" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">例如，假设你不是说英语的人，你被要求向说各种不同语言的观众做一个演示，但是他们都懂英语。你会有一个翻译，不是吗？</p><p id="d49a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">所以，当你用你的母语说话时，你的翻译会把它翻译成英语，这样听众就能理解了。这是序列化部分。</p><p id="c3ff" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">相反，当你的听众问你一个问题时，你的翻译会把它翻译成你的母语，这样你就能明白问题是什么。这是反序列化部分。</p><p id="4a40" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我希望这个类比有意义，并帮助您理解序列化和反序列化的概念，尤其是如果您是编程新手的话。(我刚开始做程序员的时候很难理解它，所以我支持你！)</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="d8ee" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">你将学到什么</h1><p id="ab43" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我们将学习如何以手动方式和<code class="fe mz na nb nc b">Boto3</code>包方式序列化Python对象和反序列化<a class="ae ky" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank"> DynamoDB </a>项。</p><p id="55b9" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">当我们使用<a class="ae ky" href="https://boto3.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"> Boto 3 </a>的<code class="fe mz na nb nc b">TypeSerializer</code>和<code class="fe mz na nb nc b">TypeDeserializer</code>时，将Python对象序列化为DynamoDB理解的类型并将DynamoDB项反序列化为Python对象是轻而易举的事情。</p><p id="8af3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">所以，让我们看看如何在我们的代码中使用它们。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="42c6" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">用类型序列化器序列化</h1><p id="78b6" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在这个上下文中，序列化是将Python对象转换成与DynamoDB兼容的格式的过程。</p><p id="dfea" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">当我们想要做<code class="fe mz na nb nc b">PutItem</code>和<code class="fe mz na nb nc b">UpdateItem</code>时，这是必要的，因为我们需要告诉DynamoDB创建和/或更新什么。</p><p id="8598" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下面是一个简单的Python脚本，它执行<code class="fe mz na nb nc b">PutItem</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/billydh/31d2bded5cb0e49b21d69f0a1b6adc99" rel="noopener ugc nofollow" target="_blank"> serialise_dynamo.py </a></p></figure><p id="402e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">你能看到我们必须显式地写每个字段吗，例如<code class="fe mz na nb nc b">"lastSeenAt": {"S": item.lastSeenAt}</code>？这意味着每当我们有一个新的字段时，我们都需要添加到字典中，当我们有很多字段时，这可能是很痛苦的。</p><p id="27d4" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">那么，有什么更简单的方法呢？</p><p id="4211" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">嗯，Boto 3的<code class="fe mz na nb nc b">TypeSerializer</code>来了。</p><p id="8e19" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这是我们实现了<code class="fe mz na nb nc b">TypeSerializer</code>后代码的样子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/billydh/18db5b2cd303b26abc84fbab741e0510" rel="noopener ugc nofollow" target="_blank">串行_发电机_v2.py </a></p></figure><p id="6a3f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">简洁多了，不是吗？更不用说，我们不必担心新的领域，只要我们保持我们的<code class="fe mz na nb nc b">dataclass</code>，这是我们应该的。</p><p id="7120" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">注意，我们在字典理解中添加了一个条件<code class="fe mz na nb nc b">if v != ""</code>。</p><p id="f076" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">原因是我们可以处理空字符串输入，这让DynamoDB很高兴，否则DynamoDB会向我们抛出一个异常。大概是这样的<code class="fe mz na nb nc b">AttributeValue may not contain an empty string</code>。</p><p id="8762" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">酷！缩短我们的代码感觉很好，不是吗？</p><p id="6d78" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">太好了！让我们继续讨论反序列化。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3b03" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">使用TypeDeserializer进行反序列化</h1><p id="0a33" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在这个上下文中，反序列化意味着将DynamoDB项转换为Python对象。当我们做<code class="fe mz na nb nc b">GetItem</code>和/或<code class="fe mz na nb nc b">QueryItem</code>时，这是必要的。</p><p id="a410" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">当我们调用<code class="fe mz na nb nc b">GetItem</code>或<code class="fe mz na nb nc b">Query</code>时，DynamoDB会返回类似这样的结果。</p><pre class="kj kk kl km gt nf nc ng nh aw ni bi"><span id="b57c" class="nj lh it nc b gy nk nl l nm nn">{<br/>    "Item": {<br/>        "postedBy": {"S": "someguy@example.com"},<br/>        "postedAt": {"S": "1580528217"},<br/>        "forum": {"S": "PythonDynamo"},<br/>        "subject": {"S": "How to serialise and deserialise for DynamoDB?"},<br/>        "message": {"S": "This is how you can do serialisation and deserialisation for DynamoDB."}<br/>    }<br/>}</span></pre><p id="58a3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">因此，我们需要处理这种类型的对象，并相应地将其反序列化到我们的<code class="fe mz na nb nc b">ForumUser</code>类中。</p><p id="cc67" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下面是我们如何编写代码来处理反序列化。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/billydh/936d2f91a72acb869969b0c2c10ae8fb" rel="noopener ugc nofollow" target="_blank"> deserialise_dynamo.py </a></p></figure><p id="0499" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">上面的代码运行良好，但是让我们看看如何用<code class="fe mz na nb nc b">Boto3</code>包中的<code class="fe mz na nb nc b">TypeDeserializer</code>来简化我们的代码。</p><p id="52c9" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这是我们使用<code class="fe mz na nb nc b">TypeDeserializer</code>时代码的样子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/billydh/8cd2cd335cd705804825fcdfc7893440" rel="noopener ugc nofollow" target="_blank">deserialise _ dynamo _ v2 . py</a></p></figure><p id="2d92" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这里使用<code class="fe mz na nb nc b">TypeDeserializer</code>的好处是我们可以避免像手动反序列化那样使用嵌套的<code class="fe mz na nb nc b">dict</code>理解。</p><p id="c83c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">注意，我们将<code class="fe mz na nb nc b">unknown=EXCLUDE</code>作为参数添加到<code class="fe mz na nb nc b">ForumUser.Schema().load()</code>函数调用中。这个参数告诉<code class="fe mz na nb nc b">Schema</code>当有一个字段没有被识别，或者换句话说，没有在<code class="fe mz na nb nc b">dataclass</code>定义中定义，它将忽略它。</p><p id="594f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果没有这个参数，<code class="fe mz na nb nc b">marshmallow</code>将抛出一个类似于<code class="fe mz na nb nc b">marshmallow.exceptions.ValidationError: {‘&lt;undefined_field_name&gt;: [‘Unknown field.’]}</code>的异常。</p><p id="5598" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">不管怎样，很努力！</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="88f6" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">包裹</h1><p id="8ed5" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在本文中，我们已经介绍了如何为DynamoDB进行序列化和反序列化，既使用了手动方式，也使用了<code class="fe mz na nb nc b">TypeSerializer</code>和<code class="fe mz na nb nc b">TypeDeserializer</code>。</p><p id="7a58" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果你想在一个真正的DynamoDB表上使用上面的函数，你可以设置一个本地DynamoDB Docker。</p><p id="6e23" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">转到<a class="ae ky" href="https://medium.com/better-programming/how-to-set-up-a-local-dynamodb-in-a-docker-container-and-perform-the-basic-putitem-getitem-38958237b968" rel="noopener"> <em class="no">如何在Docker容器</em> </a>中设置本地DynamoDB以获得完整的演练。</p><p id="3a4c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我希望这能让您对如何编写处理DynamoDB的代码有所了解。</p><p id="dbd7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">感谢阅读！</p></div></div>    
</body>
</html>