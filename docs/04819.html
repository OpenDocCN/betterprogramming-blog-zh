<html>
<head>
<title>How I Analyzed Medium’s Popular Page With Python (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何用Python分析Medium的流行页面(第1部分)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-i-analyzed-mediums-popular-page-with-python-part-1-8b81e81ae298?source=collection_archive---------8-----------------------#2020-05-12">https://betterprogramming.pub/how-i-analyzed-mediums-popular-page-with-python-part-1-8b81e81ae298?source=collection_archive---------8-----------------------#2020-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5c8e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数据收集和预处理:用XPath解析HTML，处理数据，创建熊猫数据框架</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/200cbf83d9af374b855c7dd8137411bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F79XsbbCu62KA1Ib"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@margotd1?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">玛格丽特·韦尔</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄。</p></figure><p id="fb02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于新冠肺炎的讨论像病毒本身一样迅速传播。它成为历史上被提及最多的疫情。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/6225361af1b082226f324578c89040b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8nw4bJOojyY5xBZ2GD7DOw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="lw">照片来自</em> <a class="ae ky" href="https://informationisbeautiful.net/visualizations/covid-19-coronavirus-infographic-datapack/" rel="noopener ugc nofollow" target="_blank"> <em class="lw">信息漂亮</em> </a> <em class="lw">。</em></p></figure><p id="31ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我看到那张照片后，我有一个问题:新冠肺炎在媒体上有多受欢迎？</p><p id="0c64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的个人推荐和我关注的出版物上，我看到了很多关于这方面的文章。然而，我不确定我是否坐在回音室里，或者整个媒体是否真的在谈论病毒。</p><p id="4558" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几天前，我在媒体上发表了我的发现。现在，我将再次展示我的发现——只是这一次，我还将展示我回答主要问题的过程中的每一步。这部分是该过程的第一部分，即数据收集和预处理。第二部分将着重分析。本文介绍的完整代码在最下面。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="785f" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">准备好数据</h1><h2 id="5ce8" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">我应该从哪里获取数据？</h2><p id="e15e" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">第一步是找出如何最好地跟踪媒体上的热门文章。刮掉每一篇文章是不可能的。我谷歌了一下“媒体上的流行文章”,得到的回复是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/563f7c0880e5e012ee77a0e826b58820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f7uylMLYigtPvgEmvDpirQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">谷歌搜索</p></figure><p id="ab6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近才开始使用Medium，所以我不知道有一整页都在讨论“Medium现在的趋势是什么”是的，我知道它在Medium页面顶部的栏上，但我以前从未点击过它。当我看到这个页面时，它正是我所需要的:一个在Medium上有趋势的文章列表。</p><p id="4ffc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还注意到页面不是静态的。页面顶部是最近发表的文章，向下滚动可以看到更早发表的文章。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/55c357e6ab79c09eba039103046a058e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UNIRPP4iLJtgDTZTwJJorg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Medium的热门页面向下滚动</p></figure><h2 id="c581" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">我应该如何获取数据？</h2><p id="077e" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">早在2019年11月，新冠肺炎在社交媒体上真正爆发之前，我就想收集数据。现在，我已经在过去使用Python的<a class="ae ky" href="https://scrapy.org/" rel="noopener ugc nofollow" target="_blank"> Scrapy </a>库进行了一个<a class="ae ky" href="https://bit.ly/byronown3" rel="noopener ugc nofollow" target="_blank">简单的项目</a>，所以这就是我想到的用来抓取中等文章数据的方法。</p><p id="b290" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，我对网络抓取的了解仍然相当有限。我知道有几种不同的方法来滚动网页，这样你就可以抓取下面的数据(例如，Splash和Selenium)。在过去，我没有这样做过，因为我的项目只需要一个简单的爬虫来抓取静态站点。</p><p id="8e96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不想花太多时间去弄清楚如何做到这一点，因为我主要想专注于数据的分析。我决定走一条捷径，一路向下滚动热门页面，直到2019年11月。然后，我将该页面的副本保存到我的桌面上。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/f50d12489d655ee68389235c9a900b39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SHX14gOJdVdUL236IYY7IQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在介质上保存页面</p></figure><p id="879f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我可以使用Python来抓取我保存的本地HTML文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/e2387f4dde6926ddcbf104ffc0cb7d22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7e3EiNUaJDXwSenHp7hIGw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">媒体流行页面的本地HTML副本</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="58d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了选择标题、副标题、出版日期、作者和阅读时间，我需要编写相关的XPath选择器。这个<a class="ae ky" href="https://stackoverflow.com/questions/11465555/can-we-use-xpath-with-beautifulsoup" rel="noopener ugc nofollow" target="_blank">堆栈溢出问题</a>的第一个答案给了我一些初始代码，让我可以用XPath解析HTML:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="53f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">HTML类有空格，所以我必须在XPath选择器中使用<code class="fe nq nr ns nt b">contains</code>来获取类。为了获得所有的元素，我只需将鼠标悬停在网页上我需要的每个元素上，Chrome inspector就会为我高亮显示。这允许我编写我需要的所有XPath选择器。<code class="fe nq nr ns nt b">Title</code>的输出是一个如下所示的列表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/6b42d24dbcb6e4db07d4f7812397dab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*maboF3lYhJSJG_uueOAmBg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“标题”HTML解析的输出</p></figure><p id="3e84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">字幕看起来与此类似，所以我得到了关键字分析所需的所有原始元数据。</p><h2 id="8de4" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">处理数据的步骤</h2><p id="a701" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">问题是像<code class="fe nq nr ns nt b">\\’92</code>这样的随机文本字符串，我认为它们是用来表示特殊字符的。现在，如果你有脑子，你就不会做我接下来做的事情:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="aeb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在list comprehension中将一串<code class="fe nq nr ns nt b">.replace()</code>串在一起，创建一个新的列表，手动删除不需要的字符。输出是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/6b42d24dbcb6e4db07d4f7812397dab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*maboF3lYhJSJG_uueOAmBg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">编辑列表输出以删除多余的字符</p></figure><p id="ff4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我并不以此为荣，但这只花了两分钟就成功了。</p><p id="1b2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我想分析数字，我还重新格式化了<code class="fe nq nr ns nt b">read_time</code>,使它只有一个整数。解析的当前输出类似于<code class="fe nq nr ns nt b">5 min read time</code>，我希望只有<code class="fe nq nr ns nt b">5</code>。所以我写了另一个快速列表理解，去掉了多余的文本，只留下一个整数值:</p><pre class="kj kk kl km gt nv nt nw nx aw ny bi"><span id="d9cf" class="mw mf it nt b gy nz oa l ob oc">edited_read_time = [int(entry.replace(" min read","")) for entry in read_time]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/07f1071bf9673e1b7f0875e4f8a62423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b5XQrEU2eEkvgYPHPoatvg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">编辑的读取时间输出只有整数</p></figure><p id="cd4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的下一步是通过将列表组合在一起创建一个<a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫</a>数据框架。所有列表的长度必须相同。否则，pandas会引发一个ValueError错误，指出数组的长度必须相同。我相当肯定他们应该已经准备好装载到熊猫，但只是为了再次检查，我看了每个列表的长度。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/a08d162850905d9cce6c6bf1410f7eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7LkN57XNNDpaK_QWVcCqww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为什么少了一个？</p></figure><p id="ed16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我必须想办法解决这个问题。我不引以为豪的事情的第二部分是我提取标题和副标题列表。只少了一个，所以我想不会花太多时间。我把这些列表并排放在一起，只寻找哪个副标题不见了:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/04c9a89248e64a18567ed63c024a0c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MVbjGB44emip0lG7cEXIlQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这一个花了大约三分钟，所以不太坏。</p></figure><p id="4b49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我看到缺失项的索引是“91”(Python中的<code class="fe nq nr ns nt b">90</code>)，就简单地把<code class="fe nq nr ns nt b">N/A</code>插入到提取的字幕列表中:</p><pre class="kj kk kl km gt nv nt nw nx aw ny bi"><span id="3168" class="mw mf it nt b gy nz oa l ob oc">edited.subtitle.insert(90, 'N/A')</span></pre><p id="a078" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，所有的列表都对齐了。为了创建数据帧，我创建了一个指定列名和值的字典:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="4d90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终的DataFrame输出如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/c5fbfdadcaab1fae957e7bae0ffcdadc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hlcPWf18Wfb-IN06cCToyg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">熊猫数据框上显示的中流行页面文章</p></figure><p id="13ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">精彩！现在我可以开始分析了。</p><p id="7c1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">差不多了。我在这个项目上工作了两天，第二天，我注意到流行页面上又多了一篇文章。我想将它包含在我的数据集中，所以我只是手动插入它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="6b73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，数据集是完整的，我可以开始我的分析。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="d8fd" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">概述</h1><p id="515d" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">概括地说，数据收集和处理:</p><ol class=""><li id="1218" class="oh oi it lb b lc ld lf lg li oj lm ok lq ol lu om on oo op bi translated">保存中等流行页面的本地HTML副本。</li><li id="19df" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated">用<code class="fe nq nr ns nt b">lxml etree</code> XPath选择器解析HTML。</li><li id="90df" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated">通过删除多余的字符、填充缺失的数据以及将读取时间调整为整数值来处理数据。</li><li id="4246" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated">将所有提取的元数据列表合并到一个pandas数据帧中。</li></ol><p id="06ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您现在可以查看<a class="ae ky" href="https://medium.com/better-programming/how-i-analyzed-mediums-popular-page-with-python-part-2-c1952583061e?source=friends_link&amp;sk=df8aa7dc2e719fb46446b35d65a7daa7" rel="noopener">第2部分</a>中关于数据分析和可视化的熊猫和画面！</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h2 id="6185" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">用于第1部分的代码</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">完整的数据收集和处理<a class="ae ky" href="https://gist.github.com/survivorchicken9/db3b017200655ceff7e99bbfb1ed786a" rel="noopener ugc nofollow" target="_blank">代码</a></p></figure></div></div>    
</body>
</html>