<html>
<head>
<title>Build Dynamic Reactive Forms Using Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用角度构建动态反应表单</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-dynamic-reactive-forms-using-angular-47664c42774f?source=collection_archive---------3-----------------------#2021-12-27">https://betterprogramming.pub/build-dynamic-reactive-forms-using-angular-47664c42774f?source=collection_archive---------3-----------------------#2021-12-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a1c5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Angular中实现简单动态表单</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b072ca0185c0f1e3d72ea70d96764666.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hL9q38YJGyiURZpHaeEd6w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0892" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Angular中有两种构建表单的方法——模板驱动和反应式方法。在这里，我们将重点关注反应式方法。反应式方法被认为是一个两步过程。首先，我们需要以编程方式创建一个模型，然后使用模板中的指令将HTML元素链接到该模型。这是一项繁琐且相当重复的任务，任何后续更改都需要我们在两个地方进行更改。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lu"><img src="../Images/ace99e8526fe790d36a1f5a9bb9cfa08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cv9sQoUSaS5Lqudco3Hiiw.png"/></div></div></figure><p id="c5ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">开发一些动态表单组件来简化这个过程是有意义的。当然，你可能会找到任何外部库(例如，<a class="ae lv" href="https://formly.dev/" rel="noopener ugc nofollow" target="_blank"> Angular Formly </a>)，但是有时候想一想如何自己构建它会很有趣。我们将经历这个过程并实现最简单的动态表单。</p><h1 id="9c8f" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">表单描述模型</h1><p id="25d7" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">因为我们试图简化反应式表单创建的两步过程，所以我们需要找到一种方法来描述每个控件元素，并在一个地方定义它在模型和HTML模板中的外观。它可以在简单的JS-object中定义，看起来可能是这样的:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="6048" class="my lx it mu b gy mz na l nb nc">[<br/>   { <br/>      type: 'input',<br/>      key: 'firstName',<br/>      defaultValue: 'Ivan'<br/>   },<br/>   {<br/>      type: 'select',<br/>      key: 'gender',<br/>      options: ['male', 'female']<br/>    }<br/>]</span></pre><p id="cf82" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">其中<code class="fe nd ne nf mu b">type</code>描述了应该在模板中使用哪个HTML元素，<code class="fe nd ne nf mu b">key</code>描述了如何通过模型使用这个控件。注意，这里你也可以定义像<code class="fe nd ne nf mu b">validators</code>这样的字段，但是为了简单起见，我在这里省略了。</p><h1 id="aa3d" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">类型定义</strong></h1><p id="611e" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">首先，让我们为描述表单内容的对象定义一个TypeScript类型。或许，你可能想到的第一个想法是，我们可以把所有可能的字段都集中在一个类型中(这里提供了几乎相同的方法<a class="ae lv" href="https://angular.io/guide/dynamic-form" rel="noopener ugc nofollow" target="_blank">https://angular.io/guide/dynamic-form</a>):</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="deaa" class="my lx it mu b gy mz na l nb nc">type Control = {<br/>   type: 'input' | 'select',<br/>   fieldName: string,<br/>   defaultValue?: string,<br/>   options?: string[]<br/>}</span><span id="3448" class="my lx it mu b gy ng na l nb nc">type FormDescription = Control[];</span></pre><p id="5d88" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里的问题实际上是，我们将<code class="fe nd ne nf mu b">options</code>字段定义为可选的，但是对于类型为<code class="fe nd ne nf mu b">select</code>的控件来说，它应该是必需的。另一方面，我们可以根据需要定义<code class="fe nd ne nf mu b">options</code>字段，但是它对类型为<code class="fe nd ne nf mu b">input</code>的控件有意义吗？我不这么认为。</p><p id="6626" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有没有更好的解决办法？答案是——是的。我们将使用一种在Typescript中被称为“<em class="nh">标记联合</em>或“<em class="nh">区别联合</em>”的模式。为此，让我们分别为所有控件定义所有可能的类型:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4f39" class="my lx it mu b gy mz na l nb nc">type InputControl = {<br/>   type: 'input',<br/>   key: string,<br/>   defaultValue?: string<br/>}</span><span id="6df2" class="my lx it mu b gy ng na l nb nc">type SelectControl = {<br/>   type: 'select',<br/>   key: string,<br/>   options: string[],<br/>   defaultOptions?: string<br/>}</span><span id="07d6" class="my lx it mu b gy ng na l nb nc">type GenericControl = InputControl | SelectControl;</span><span id="3c02" class="my lx it mu b gy ng na l nb nc">type FormDescription = GenericControl[];</span></pre><p id="a3b0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，对于<code class="fe nd ne nf mu b">type</code>字段，我们没有将类型定义为<code class="fe nd ne nf mu b">string</code>，而是使用了字符串的特定值，该值可能被视为标签。</p><p id="2175" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它给我们带来了什么好处？一旦我们为字段<code class="fe nd ne nf mu b">type</code>定义了特定的类型(标签), TypesScript就会推断出哪些字段可用于这个特定的类型，是<code class="fe nd ne nf mu b">InputControl</code>类型还是<code class="fe nd ne nf mu b">SelectControl</code>类型。</p><p id="9602" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，当我们将<code class="fe nd ne nf mu b">type</code>字段定义为<code class="fe nd ne nf mu b">input</code>时，它会警告我们<code class="fe nd ne nf mu b">key</code>是必填字段，还会告诉我们它使用<code class="fe nd ne nf mu b">InputControl</code>类型进行推断。当我们将<code class="fe nd ne nf mu b">type</code>定义为<code class="fe nd ne nf mu b">select</code>时，情况也是如此。它显示有两个必填字段:<code class="fe nd ne nf mu b">key</code>和<code class="fe nd ne nf mu b">options</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7bb4ff5678d371e4c66712d21e6a6601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FXlwMkfsZmRZVqRjPQWw8w.png"/></div></div></figure><p id="baf2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">到目前为止一切顺利。</p><h1 id="09ca" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">2.角度控制器实现</h1><p id="f525" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">为了简单起见，当我们需要从服务器请求一个表单描述时，我跳过了这一部分。Angular有两种处理表单的方法:模板驱动或反应式方法。毫无疑问，在我们的案例中，我们采用反应式方法，因为它更灵活。</p><p id="d940" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第一步是基于<code class="fe nd ne nf mu b">ngOnInit</code>方法中的表单描述构建<code class="fe nd ne nf mu b">FormGroup</code>形状，这并不困难——我们只需遍历数组项并为每个字段创建<code class="fe nd ne nf mu b">FormControl</code>实例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="90f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在模板中，我们需要遍历<code class="fe nd ne nf mu b">this.formDescription</code>项，并根据控件类型构建布局:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h1 id="aa5d" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">结论</h1><p id="7f66" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">我们已经实现了第一个动态表单。我们留下了很大的改进余地。例如，我们可以添加:</p><ul class=""><li id="fb24" class="nk nl it la b lb lc le lf lh nm ll nn lp no lt np nq nr ns bi translated">字段验证并将用户友好的消息放入模板中；</li><li id="1ac3" class="nk nl it la b lb nt le nu lh nv ll nw lp nx lt np nq nr ns bi translated">在UI上添加<code class="fe nd ne nf mu b">label</code>组件的机会；</li><li id="f32c" class="nk nl it la b lb nt le nu lh nv ll nw lp nx lt np nq nr ns bi translated">添加另一种类型的控件，如单选按钮、复选框</li></ul><p id="0610" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但肯定的是，这不是一个你想用于生产的决定。我们的同事已经为相同的提议实现了一个灵活的外部库，例如<a class="ae lv" href="https://formly.dev/" rel="noopener ugc nofollow" target="_blank"> Angular Formly </a>。</p></div></div>    
</body>
</html>