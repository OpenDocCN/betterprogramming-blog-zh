<html>
<head>
<title>Audio Features Extraction With JavaScript and Essentia</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于JavaScript和Essentia的音频特征提取</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/audio-features-extraction-with-javascript-ac8c9cd9903a?source=collection_archive---------18-----------------------#2022-11-21">https://betterprogramming.pub/audio-features-extraction-with-javascript-ac8c9cd9903a?source=collection_archive---------18-----------------------#2022-11-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="18cb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">以下是如何使用Essentia.js来发现你喜欢的歌曲有多有活力！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/347efad2330eab06a933b4e6755442ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UAyFFoUzsqJaMZum"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@stefany_andrade?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯蒂芬尼·安德拉德</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="9334" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你有没有想过Spotify是如何向用户推荐音乐的？</p><p id="6f7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">10月，我为分析网站Vidhya <a class="ae kv" href="https://datahack.analyticsvidhya.com/contest/data-science-blogathon-25" rel="noopener ugc nofollow" target="_blank"> Blogathon 25 </a>写了一篇<a class="ae kv" href="https://www.analyticsvidhya.com/blog/2022/11/creating-a-music-streaming-backend-like-spotify-using-mongodb/" rel="noopener ugc nofollow" target="_blank">获胜指南</a>。在那篇文章中，我分享了如何构建一个副本Spotify后端，包括一个推荐系统。</p><p id="8ca3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但今天，我们将重点分析NodeJS音乐的不同方面。与我的Blogathon文章类似，我们将使用一个名为Essentia的工具。</p><h1 id="3bd1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是本质？</h1><p id="1062" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">嗯，<a class="ae kv" href="https://essentia.upf.edu/" rel="noopener ugc nofollow" target="_blank"> Essentia </a>是一个从音频中检索信息的工具库。它包含一个分析算法语料库，可以执行速度和音调提取、响度检测等任务。他们的免费开源库也有一套Tensorflow深度学习模型，用于更高级的分析，如流派和情绪识别。</p><p id="af55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Essentia来自音乐科技集团，也是freesound.org<a class="ae kv" href="http://freesound.org/" rel="noopener ugc nofollow" target="_blank">背后的同一个团队。</a></p><p id="2d14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">他们的原始库是C++，但是他们有Python和JavaScript的绑定。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="d82a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了了解哪些功能可以用于歌曲分析，我们可以看看<a class="ae kv" href="https://developer.spotify.com/documentation/web-api/reference/#/operations/get-audio-features" rel="noopener ugc nofollow" target="_blank"> Spotify的API </a>中提供的一些音频功能。</p><p id="477d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是我挑选的:<code class="fe mw mx my mz b">danceability, duration, energy, key, mode, loudness, tempo</code></p><p id="f7cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在开始分析吧！</p><h1 id="1151" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">安装Essentia.js</h1><p id="c7e7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在节点项目内的终端中，运行以下命令:</p><pre class="kg kh ki kj gt na mz nb bn nc nd bi"><span id="ecab" class="ne lt iq mz b be nf ng l nh ni">npm i essentia.js</span></pre><h1 id="be45" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">解码音频文件</h1><p id="b6f2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">所有传入Essentia算法的音频都需要解码成一个数组，然后是一个向量。</p><pre class="kg kh ki kj gt na mz nb bn nc nd bi"><span id="85f5" class="ne lt iq mz b be nf ng l nj ni">npm i audio-decode</span></pre><p id="1776" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个库可以解码MP3和WAV文件，并返回每个音频通道的数据。解码后的音频需要转换成矢量(一个<code class="fe mw mx my mz b">C++</code>风格的矢量)。</p><p id="8bfb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在可以使用以下内容来导入库并设置Essentia:</p><pre class="kg kh ki kj gt na mz nb bn nc nd bi"><span id="2b8d" class="ne lt iq mz b be nf ng l nh ni">const { Essentia, EssentiaWASM } = require("essentia.js");<br/>const fs = require("fs");<br/>const decode = require("audio-decode");<br/>const essentia = new Essentia(EssentiaWASM);</span></pre><p id="f1a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是解码音频的函数:</p><pre class="kg kh ki kj gt na mz nb bn nc nd bi"><span id="3253" class="ne lt iq mz b be nf ng l nh ni">const decodeAudio = async (filepath: string) =&gt; {<br/>    const buffer = fs.readFileSync(filepath);<br/>    const audio = await decode(buffer);<br/>    const audioVector = essentia.arrayToVector(audio._channelData[0]);<br/>    return audioVector;<br/>};</span></pre><p id="9196" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了测试Essentia的算法实现，我们将使用来自Pixabay的这个<a class="ae kv" href="https://cdn.pixabay.com/audio/2022/10/18/audio_31c2730e64.mp3" rel="noopener ugc nofollow" target="_blank">音频文件</a>。将其作为“audio.mp3”放入项目文件夹中</p><pre class="kg kh ki kj gt na mz nb bn nc nd bi"><span id="2303" class="ne lt iq mz b be nf ng l nh ni">(async () =&gt; {<br/>    const path = "./audio.mp3";<br/>    const data = await decodeAudio(path);<br/><br/>    // ...<br/>})()</span></pre><h1 id="5568" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">音频分析</h1><h1 id="5aae" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">可跳舞性</h1><p id="75b6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">可舞性指的是一首歌适合跳舞的程度。它是其他因素的混合物，如节拍强度和节奏。</p><pre class="kg kh ki kj gt na mz nb bn nc nd bi"><span id="f421" class="ne lt iq mz b be nf ng l nh ni">const computed = essentia.Danceability(data);<br/>// { danceability: N }<br/><br/>const danceability = computed.value;</span></pre><h1 id="42cd" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">持续时间</h1><p id="9999" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">持续时间是一段音乐的长度。</p><pre class="kg kh ki kj gt na mz nb bn nc nd bi"><span id="37d6" class="ne lt iq mz b be nf ng l nh ni">const computed = essentia.Duration(data);<br/>// { duration: N }<br/><br/>const duration = computed.value;</span></pre><h1 id="bba0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">活力</h1><p id="4241" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">从数学上来说，信号的能量就是曲线下的面积。就音乐而言，能量衡量的是强度和活动性。</p><pre class="kg kh ki kj gt na mz nb bn nc nd bi"><span id="707e" class="ne lt iq mz b be nf ng l nh ni">const computed = essentia.Energy(data);<br/>// { energy: N }<br/><br/>const energy = computed.value;</span></pre><h1 id="7855" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">键和模式</h1><p id="9b2f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">音乐基调是构成歌曲基础的一组音符。</p><p id="4a1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">调式指的是音阶的类型——大调还是小调。</p><pre class="kg kh ki kj gt na mz nb bn nc nd bi"><span id="cb6a" class="ne lt iq mz b be nf ng l nh ni">const computed = essentia.KeyExtractor(data);<br/>// { key: "C" | "D" | "E" ..., scale: "major" | "minor", strength: N }<br/><br/>const KEYS = ["C", "D", "E", "F", "G", "A", "B"];<br/><br/>const key = KEYS.indexOf(computed.key);<br/>const mode = computed.scale === "major" ? 1 : 0;</span></pre><h1 id="27c1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">音量</h1><p id="d2c2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">响度是指一首歌的音量有多大，单位是分贝(dB)。</p><pre class="kg kh ki kj gt na mz nb bn nc nd bi"><span id="f062" class="ne lt iq mz b be nf ng l nh ni">const computed = essentia.DynamicComplexity(data);<br/>// { dynamicComplexity: N, loudness: N }<br/><br/>const loudness = computed.loudness;</span></pre><h1 id="9e96" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">拍子</h1><p id="4b0a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">节奏是一段音乐的速度，单位是每分钟的节拍数。</p><pre class="kg kh ki kj gt na mz nb bn nc nd bi"><span id="e53b" class="ne lt iq mz b be nf ng l nh ni">const computed = essentia.PercivalBpmEstimator(data);<br/>// { bpm: N }<br/><br/>const tempo = computed.bpm;</span></pre><p id="70fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以上就是分析的所有音频特征。但是现在我们有了所有这些信息，我们该如何处理呢？嗯，一个建议是建立一个歌曲推荐系统，我已经在这里<a class="ae kv" href="https://www.analyticsvidhya.com/blog/2022/11/creating-a-music-streaming-backend-like-spotify-using-mongodb/#h2_6" rel="noopener ugc nofollow" target="_blank">解释过了</a>。另一个想法是通过REST API使其可用。</p><h1 id="d9a4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">构建REST API</h1><p id="8c38" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">对于这个API，我们将使用<a class="ae kv" href="https://www.npmjs.com/package/express" rel="noopener ugc nofollow" target="_blank"> express </a>来处理传入的请求并发送响应。此外，我们可以使用<a class="ae kv" href="https://www.npmjs.com/package/formidable" rel="noopener ugc nofollow" target="_blank">强大的</a>来处理文件上传，所以在这里查看如何使用它<a class="ae kv" href="https://medium.com/better-programming/3-ways-to-upload-files-to-google-cloud-storage-with-nextjs-and-formidable-3b58707e7886" rel="noopener">。</a></p><p id="7144" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，当客户端上传文件时，我们将对其进行解码、分析，然后返回音频特征。</p><pre class="kg kh ki kj gt na mz nb bn nc nd bi"><span id="a766" class="ne lt iq mz b be nf ng l nh ni">import express, { NextFunction } from "express";<br/><br/>import formidable from "formidable";<br/><br/>import fs from "fs";<br/>import { IncomingMessage } from "http";<br/>import { Essentia, EssentiaWASM } from "essentia.js";<br/>import decode from "audio-decode";<br/>import IncomingForm from "formidable/Formidable";<br/><br/>const app = express();<br/>const port = 3000;<br/><br/>const essentia = new Essentia(EssentiaWASM);<br/><br/>const KEYS = ["C", "D", "E", "F", "G", "A", "B"];<br/><br/>app.use(express.json());<br/>app.use(express.urlencoded({ extended: true }));<br/><br/>const parseForm = async (<br/>    form: IncomingForm,<br/>    req: IncomingMessage,<br/>    next: NextFunction<br/>): Promise&lt;{ fields: formidable.Fields; files: formidable.Files }&gt; =&gt; {<br/>    return await new Promise((resolve) =&gt; {<br/>        form.parse(<br/>            req,<br/>            function (<br/>                err: Error,<br/>                fields: formidable.Fields,<br/>                files: formidable.Files<br/>            ) {<br/>                if (err) return next(err);<br/>                resolve({ fields, files });<br/>            }<br/>        );<br/>    });<br/>};<br/><br/>const decodeAudio = async (filepath: string) =&gt; {<br/>    const buffer = fs.readFileSync(filepath);<br/>    const audio = await decode(buffer);<br/>    const audioVector = essentia.arrayToVector(audio._channelData[0]);<br/>    return audioVector;<br/>};<br/><br/>app.post("/upload", async (req, res, next) =&gt; {<br/>    const form = formidable();<br/><br/>    const { files } = await parseForm(form, req, next);<br/><br/>    // The file uploaded must have the field name "file"<br/>    const file = files.file as any;<br/><br/>    const data = await decodeAudio(file.filepath);<br/><br/>    const danceability = essentia.Danceability(data).danceability;<br/>    const duration = essentia.Duration(data).duration;<br/>    const energy = essentia.Energy(data).energy;<br/><br/>    const computedKey = essentia.KeyExtractor(data);<br/>    const key = KEYS.indexOf(computedKey.key);<br/>    const mode = computedKey.scale === "major" ? 1 : 0;<br/><br/>    const loudness = essentia.DynamicComplexity(data).loudness;<br/>    const tempo = essentia.PercivalBpmEstimator(data).bpm;<br/><br/>    res.status(200).json({<br/>        danceability,<br/>        duration,<br/>        energy,<br/>        key,<br/>        mode,<br/>        loudness,<br/>        tempo,<br/>    });<br/>});<br/><br/>app.listen(port, () =&gt; {<br/>    return console.log(`Express server listening at http://localhost:${port}`);<br/>});</span></pre><h1 id="cf38" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="73b6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">仅此而已！如果你喜欢这篇文章，请继续关注。</p><p id="0b87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您对如何使用这些音频功能有任何其他建议，请发表评论。</p><p id="d814" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在GitHub 上找到这篇文章的完整代码。</p><p id="1daf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在再见。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="0120" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nk">原发布于</em><a class="ae kv" href="https://cs310.hashnode.dev/audio-features-extraction-with-javascript-and-essentia" rel="noopener ugc nofollow" target="_blank"><em class="nk">https://cs 310 . hash node . dev</em></a><em class="nk">。</em></p></div></div>    
</body>
</html>