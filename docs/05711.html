<html>
<head>
<title>Create a Role-Based Show/Hide Directive in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Angular中创建基于角色的显示/隐藏指令</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-role-based-show-hide-directive-in-angular-8d83fca2eb69?source=collection_archive---------0-----------------------#2020-07-30">https://betterprogramming.pub/create-a-role-based-show-hide-directive-in-angular-8d83fca2eb69?source=collection_archive---------0-----------------------#2020-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e745" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Angular中的自定义指令是你不用的最好的东西</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f6dd9ff731813697316c7ab319780e24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N6XzPLHBii6MKsD4yKT75g.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供。</p></figure><p id="a5ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你在Angular领域呆了很长时间，你必须熟悉指令的概念。指令是Angular的基本构件之一。到处都是。甚至Angular中的组件也在带有模板的指令中。</p><p id="a892" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">指令基本上是带有<code class="fe lr ls lt lu b">@Directive</code>装饰器的类型脚本类。从<a class="ae lv" href="https://angular.io/guide/attribute-directives" rel="noopener ugc nofollow" target="_blank">角度文档</a>中，您可以看到有三种类型的指令</p><ol class=""><li id="17c4" class="lw lx iq kx b ky kz lb lc le ly li lz lm ma lq mb mc md me bi translated">组件:带有模板的指令。</li><li id="f842" class="lw lx iq kx b ky mf lb mg le mh li mi lm mj lq mb mc md me bi translated">结构化指令:通过添加和删除DOM元素来改变DOM布局。</li><li id="76f5" class="lw lx iq kx b ky mf lb mg le mh li mi lm mj lq mb mc md me bi translated">属性指令:更改元素、组件或其他指令的外观或行为。</li></ol><p id="b03e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一些你必须熟悉的常用指令有:<code class="fe lr ls lt lu b">*ngFor(structural)</code>、<code class="fe lr ls lt lu b">*ngIf(structural)</code>、<code class="fe lr ls lt lu b">hidden(attribute)</code>、<code class="fe lr ls lt lu b">NgStyle(attribute)</code>等。本文的范围将集中在最后一种类型:属性指令。</p><p id="f832" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最近在我的一个项目中，我需要一个简单的基于角色的访问系统。在我的一个模块中，添加、编辑、删除或更新操作是基于用户角色的，用户角色是在管理员级别确定的，并且是可配置的。用户登录时可获得访问信息。</p><p id="89dc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您将如何实现这一点？</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="b99e" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">最初的想法</h1><p id="8ad2" class="pw-post-body-paragraph kv kw iq kx b ky nj jr la lb nk ju ld le nl lg lh li nm lk ll lm nn lo lp lq ij bi translated">最初的想法是在所有组件中使用<code class="fe lr ls lt lu b">*ngIf</code>或<code class="fe lr ls lt lu b">[hidden]</code>指令，在组件的控制器中使用定制逻辑。这看起来很容易实现。但是它能重复使用吗？如果您想在多个模块、组件中使用它，该怎么办？是的，是时候引入一个指令了！</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="1ae2" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">创建自定义角度方向</h1><p id="39d4" class="pw-post-body-paragraph kv kw iq kx b ky nj jr la lb nk ju ld le nl lg lh li nm lk ll lm nn lo lp lq ij bi translated">像我上面所说的，指令是类型脚本类。您可以创建一个文件，方便地将其命名为<code class="fe lr ls lt lu b">access-control.directive.ts</code>并手动创建您的类。但是我将从Angular CLI获得帮助来完成这项工作。</p><pre class="kg kh ki kj gt no lu np nq aw nr bi"><span id="b03c" class="ns ms iq lu b gy nt nu l nv nw">ng generate directive access-control</span></pre><p id="5d48" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您现在有了有史以来最简单的指令，它还没有做任何事情。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="c6ae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们开始编辑我们的指令之前，让我们看一下从REST API接收到的访问控制数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="7f11" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从上面的数据可以明显看出，我们的指令至少需要从主机(使用指令的组件)获得两条信息:</p><ol class=""><li id="a37f" class="lw lx iq kx b ky kz lb lc le ly li lz lm ma lq mb mc md me bi translated">模块类型(用户或文章)</li><li id="9deb" class="lw lx iq kx b ky mf lb mg le mh li mi lm mj lq mb mc md me bi translated">访问类型(创建、编辑、删除或读取)</li></ol><p id="228e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们后退一步，回忆一下组件实际上是指令，因此您可以像传递组件一样将数据传递给指令。我们可以用一个室内装潢师。我们还需要在我们的指令中实现<code class="fe lr ls lt lu b">NgOnInit</code>,以便能够检查组件初始化时的访问控制。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="d592" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">太好了！让我们实现我们的逻辑来有条件地显示/隐藏host元素(我们的指令所在的组件)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="219f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们从<code class="fe lr ls lt lu b">@angular/core</code>中导入了<code class="fe lr ls lt lu b">ElementRef</code>，我们可以用它来访问和操作DOM元素。使用<code class="fe lr ls lt lu b">ElementRef</code>时要小心，因为你是直接访问DOM元素，这可能会吸引XSS攻击。在组件初始化时，我们获取角色数据，交叉检查我们的模块和访问类型组合，并使元素显示/隐藏。</p><p id="c4fe" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注意:我从我创建的Angular服务<code class="fe lr ls lt lu b">AuthService</code>类中获取访问数据。您可以让您的自定义登录来做同样的事情。</p><p id="6b68" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们看看如何在我们的一个组件中使用它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="912c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就这么简单！上面的按钮现在将根据用户访问控制显示/隐藏。您可以在任何创建、编辑、删除、读取导航按钮/组件中使用我们的<code class="fe lr ls lt lu b">accessControl</code>指令。它是高度可重复使用的。</p><p id="b509" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">指令还有很多其他的用例。您可以做一些事情，如侦听主机上的事件并对其做出反应，将样式应用于主机，等等。我希望你能用它创造出美好的东西。</p><p id="2152" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">更多类似的文章👇</p><div class="nz oa gp gr ob oc"><a href="https://bharathravi.com/" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">Bharath Ravi | javaScript文章</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">有能力的文章来提升你的网络技能。javaScript全栈开发者Bharath Ravi的个人博客</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">bharathravi.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq kp oc"/></div></div></a></div><p id="0af0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">黑客快乐！</p></div></div>    
</body>
</html>