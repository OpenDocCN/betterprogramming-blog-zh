<html>
<head>
<title>5 Steps to Making a Predictable Cost Model for AWS Serverless Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为AWS无服务器项目建立可预测成本模型的5个步骤</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/5-steps-to-making-a-predictable-cost-model-for-aws-serverless-projects-78d78909bb82?source=collection_archive---------10-----------------------#2020-03-05">https://betterprogramming.pub/5-steps-to-making-a-predictable-cost-model-for-aws-serverless-projects-78d78909bb82?source=collection_archive---------10-----------------------#2020-03-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4780" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">无服务器很棒。为您使用的东西付费。但是你怎么知道你会用多少呢？让我们试着弄清楚</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1f080bcde1b80d6f8e4102c4958f8528.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cPXfLjRnObg5qiIs"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Artem Beliaikin 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="39ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我第一次发现AWS serverless时，它是自切片面包以来最好的东西。事实上，它比切片面包好吃。这是未来。所以我很快收集了我所有的鸡蛋，并把它们放在AWS篮子里。</p><p id="2057" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无服务器的核心原则是你为你所使用的付费。你不需要为在空中托管你的代码支付一笔费用。你不为空闲时间付钱。您需要为存储、计算和数据传输付费。加上AWS免费层，从现在开始，你基本上可以免费访问你所有的附带项目。</p><p id="a4a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是真正的项目呢？生产代码。推动商业的东西。那要花多少钱？为您使用的东西付费似乎是一个好主意，直到您必须计算出您的应用程序在未来一年、三年和五年的运行成本。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cc13" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.发现碎片</h1><p id="77a5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">一个无服务器的项目就是API Gateway，Lambda，DynamoDB，S3，对吧？虽然这在表面上看起来可能是真的，但实际上有许多其他服务参与到拼凑你的应用程序中。CloudFront(内容交付)、Route53 (DNS路由)和CloudWatch(日志、指标和警报)通常是一个完整应用程序中被遗忘的组件。</p><p id="8a1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是除了被遗忘的服务之外，你可能知道也可能不知道在使用这些服务时你将被收费的所有事情。Lambda不仅仅是每次调用的费用。你还必须为你的lambdas运行的时间和消耗的内存付费。对于API Gateway，您不仅要为每个请求付费，还要为数据传输量付费。</p><p id="872e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以将成本分为两类:计算和存储。</p><ul class=""><li id="7789" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">计算成本是短暂。上个月用了多少不重要。这个月是一个新的开始。换句话说，成本不会自行增加。</li><li id="3e85" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">存储成本则相反。无论数据是何时添加的，您都需要为存储的所有数据付费。如果你有一个应用程序，每月增加1 GB的数据，一年后你将支付12 GB的存储空间(如果你不清理这些)。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="17ec" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.了解您的数据</h1><p id="4bb9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">数据传输。没人想过这个问题，但他们需要。几乎每个AWS无服务器服务都有数据传输成本。这对我们意味着什么？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/933b7e5c6661218a6af6119ec192a646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IUltpRWg8d-B0nDR"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@lukechesser?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卢克·切瑟</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="d892" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，确保您正确地设计了您的解决方案。如果您有一个从S3检索文档并通过API Gateway传送的端点，您需要为从S3和API Gateway传送的数据付费。更好的解决方案是返回一个链接到文档的签名URL，然后让您的客户端下载该文件。但这不是我们在这里要谈的。</p><p id="ea46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想要对成本进行半精确的预测，了解数据大小的粗略估计是至关重要的。</p><p id="b0ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要了解您有多少个实体，以及这些实体中包含多少数据。你要通过网络传输整个实体吗？也许只是一个子集？你期望每种类型的实体有多少个？您是否在S3之外存储和检索大文件？</p><p id="8717" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，您还需要考虑您存储了多少数据。如果您每月存储100万个实体，每个实体的大小为50 KB，这意味着您每月将存储50 GB。如果您无限期地存储这些数据，您的存储成本将会迅速增加。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="90a0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.确定您所在的地区</h1><p id="4b3e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可能不知道这一点，但AWS服务的费用因其运营地区而异。例如，在美国东部(n . Virginia ), 100万个lambda请求的成本为0.20美元。但是，如果您在亚太地区(香港)部署，同样的一百万个请求将花费0.28美元。如果你在政府云上构建一个应用程序，你会得到另一个全面的价格上涨。</p><p id="3a6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您正在部署一个需要在地区之间传输数据的应用程序，那么您也必须为此支付数据传输费用。</p><p id="bbdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，如果你在同一个地区，大多数服务之间没有数据传输成本(意味着在Lambda和DynamoDB之间发送数据没有成本)。</p><p id="ed57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您在美国东部(N. Virginia)用完了，以下是一些常见服务的费用明细:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="dbfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能拥有上表中列出的部分、全部或更多服务。只需挑选您使用的服务，并开始构建您的模型。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="923d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.对业务流程建模，而不是聚合</h1><p id="0201" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我认为这是需要考虑的最重要的事情。我们都知道使用模式在应用程序中并不是均匀分布的。有些事情是一次性操作，比如用户注册。其他事情每天都比其他事情发生得更频繁。</p><p id="8fea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用一个示例应用程序来说明我们的观点。Yelp是一个网站，允许用户创建一个帐户，查看地方的评级，并添加他们自己的评级。如果我们分解这些主要业务流程的成本，它可能看起来像这样:</p><p id="6854" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">创建账户</strong></p><ul class=""><li id="fb6d" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">兰达斯:3</li><li id="7931" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">API网关调用:1</li><li id="c411" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">用户元数据存储:1 KB</li><li id="aa61" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">Cloudwatch日志:1kb<br/>~费用:0.00000698美元/创建的账户</li></ul><p id="fe45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">查看收视率</strong></p><ul class=""><li id="fcaf" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">兰姆达斯:1</li><li id="c569" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">API网关调用:1</li><li id="a887" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">API网关数据传输:. 5 MB</li><li id="76f9" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">S3数据传输:5 MB(用于用户图像)</li><li id="eedd" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">CloudFront数据传输:5 MB</li><li id="c73a" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">DDB读取容量单位:15</li><li id="55de" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">Cloudwatch日志:1kb<br/>~成本:收视率$0.0009249‬/view+每月DDB rcu 1.40美元</li></ul><p id="6bab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">添加评级</strong></p><ul class=""><li id="aac8" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">兰姆达斯:6</li><li id="29eb" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">API网关调用:1</li><li id="a5df" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">API网关数据传输:. 5 MB</li><li id="7ef2" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">阶跃函数转换:5</li><li id="adbc" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">社交网络请求:1</li><li id="3884" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">S3存储:. 5MB</li><li id="829e" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">DDB写容量单位:3</li><li id="ecfd" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">Cloudwatch日志:5kb<br/>~费用:0.00019337美元/新评级+DDB WCUs每月1.40美元</li></ul><p id="2f79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基于这些数字，如果你估计一个月有1000个新用户，200万次评级浏览和150，000次新评级，你就可以知道你的应用程序的运行成本了。</p><p id="1ede" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一切都是为了了解您的业务流程，以及您希望它们被使用到什么程度。</p><p id="530f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，如果您只是汇总了10个lambdas、三个端点和一些S3存储，您的估计会受到影响。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="13a0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">5.负载测试它</h1><p id="e8ae" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">AWS并没有让预测你的无服务器应用变得非常容易。获得合理估计的一种方法是对其进行负载测试。更好的是，用上面的公式估计所有的东西，然后运行一个负载测试来衡量准确性。</p><p id="85f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在你的数学中做必要的调整，并磨练你的预测。记住，预测不应该被认为是事实。您的应用程序将根据使用情况计费。不可能做到完全正确。</p><p id="c9bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有几种不同的方法可以对无服务器应用程序进行负载测试。你可以使用像<a class="ae ky" href="https://artillery.io/" rel="noopener ugc nofollow" target="_blank">火炮</a>这样的第三方公司来做负载测试，或者你可以使用<a class="ae ky" href="https://aws.amazon.com/solutions/distributed-load-testing-on-aws/" rel="noopener ugc nofollow" target="_blank"> AWS解决方案</a>。无论哪种方式，这将是你的应用程序将花费多少钱的最有力的来源之一。</p><p id="b9aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">负载测试的一个明显的缺点是每次测试都要付费，但是我们这里说的是无服务器测试。与传统解决方案相比，它的成本很低。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="83a4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="0bb1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在一个没有服务器的世界里，预测比过去需要更多的努力。成本模型是可预测的，但这一切都归结于您的应用程序的业务流程。</p><p id="9d18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您对有多少人将使用您的应用程序以及哪些业务流将比其他业务流使用得更多的估计越准确，您的预测就越准确。</p><p id="303e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">祝你的无服务器之旅好运。享受灵活性、移动性和成本效益的世界！</p></div></div>    
</body>
</html>