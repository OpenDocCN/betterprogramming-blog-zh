<html>
<head>
<title>Exploring AndroidX for Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索安卓系统进行测试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/exploring-androidx-for-testing-6350100b4711?source=collection_archive---------4-----------------------#2019-10-19">https://betterprogramming.pub/exploring-androidx-for-testing-6350100b4711?source=collection_archive---------4-----------------------#2019-10-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="ea0b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"># 100日代码的第32天</h2><div class=""/><div class=""><h2 id="822c" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">Android中的“一次编写，随处运行”测试</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/4811fcabae936a80fe362b7c502792c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PR4EZ8LcjtbVv4lOjKaROA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">很确定这就是谷歌开发人员在构建AndroidX时的想法</p></figure><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="lh li l"/></div></figure><h1 id="5ab0" class="lj lk it bd ll lm ln lo lp lq lr ls lt ki lu kj lv kl lw km lx ko ly kp lz ma bi translated">理解Android中的测试</h1><p id="21a8" class="pw-post-body-paragraph mb mc it md b me mf kd mg mh mi kg mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">在Android上，随着你的实际代码，还有<em class="mx">单元测试</em>和<em class="mx">仪器测试</em> <strong class="md jd"> </strong>。这就是为什么你会在你的主包里面看到三个包。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi my"><img src="../Images/1094779d3b758e8aa14dc6bb0f01328c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yk2rwZziOADOTUuF81JC5g.png"/></div></div></figure><h2 id="57c5" class="mz lk it bd ll na nb dn lp nc nd dp lt mk ne nf lv mo ng nh lx ms ni nj lz iz bi translated">单元测试</h2><p id="e174" class="pw-post-body-paragraph mb mc it md b me mf kd mg mh mi kg mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">单元测试有许多优点:</p><ul class=""><li id="c81f" class="nk nl it md b me nm mh nn mk no mo np ms nq mw nr ns nt nu bi translated">快速:这些测试在你的电脑上运行，而不是在Android服务上。你不必等到Android版本运行后才能测试你的代码。这使得本地测试非常快。</li><li id="ebd9" class="nk nl it md b me nv mh nw mk nx mo ny ms nz mw nr ns nt nu bi translated"><strong class="md jd">简单设置:</strong>像<a class="ae oa" href="https://site.mockito.org/" rel="noopener ugc nofollow" target="_blank"> Mockito </a>和<a class="ae oa" href="http://robolectric.org/" rel="noopener ugc nofollow" target="_blank"> Roboelectric </a>这样的框架可以帮助你通过模仿与Android框架的交互来编写测试，从而为测试设置环境状态。</li></ul><p id="c563" class="pw-post-body-paragraph mb mc it md b me nm kd mg mh nn kg mj mk ob mm mn mo oc mq mr ms od mu mv mw im bi translated">专业提示:你应该为详尽的条件编写大量快速、可伸缩的单元测试。</p><h2 id="e3b2" class="mz lk it bd ll na nb dn lp nc nd dp lt mk ne nf lv mo ng nh lx ms ni nj lz iz bi translated">仪器测试</h2><p id="c737" class="pw-post-body-paragraph mb mc it md b me mf kd mg mh mi kg mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">仪器测试有自己的特点:</p><ul class=""><li id="565d" class="nk nl it md b me nm mh nn mk no mo np ms nq mw nr ns nt nu bi translated"><strong class="md jd">较慢:</strong>它们运行在Android设备上(虚拟或真实)。</li><li id="c402" class="nk nl it md b me nv mh nw mk nx mo ny ms nz mw nr ns nt nu bi translated"><strong class="md jd">更准确:</strong>更准确，因为它们运行在更接近最终用户体验的设备上，给你更大的信心。</li><li id="ef28" class="nk nl it md b me nv mh nw mk nx mo ny ms nz mw nr ns nt nu bi translated">较少的支持:然而，没有多少API可以为你的测试设置先决条件。</li></ul><p id="a549" class="pw-post-body-paragraph mb mc it md b me nm kd mg mh nn kg mj mk ob mm mn mo oc mq mr ms od mu mv mw im bi translated">提示:你应该编写少量的测试程序来证明所有的单元组装在一起的行为符合你的预期。</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="cbc5" class="lj lk it bd ll lm ol lo lp lq om ls lt ki on kj lv kl oo km lx ko op kp lz ma bi translated">如何开始在Android中编写测试</h1><p id="e310" class="pw-post-body-paragraph mb mc it md b me mf kd mg mh mi kg mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">您从使用<a class="ae oa" href="https://developer.android.com/training/testing/espresso" rel="noopener ugc nofollow" target="_blank"> Espresso </a>编写一个失败的UI测试开始(让这个测试成为一个仪器测试)。接下来，您编写一些产品代码来使失败的UI测试通过。为了使该特性工作，您需要编写一系列单元测试，然后是通过这些单元测试的代码。</p><p id="d556" class="pw-post-body-paragraph mb mc it md b me nm kd mg mh nn kg mj mk ob mm mn mo oc mq mr ms od mu mv mw im bi translated">使用TDD完成特性后，您将通过失败的UI测试。然后花些时间清理代码，重构，优化任何需要的地方。然后，按照同样的循环，继续下一个任务。</p><p id="9096" class="pw-post-body-paragraph mb mc it md b me nm kd mg mh nn kg mj mk ob mm mn mo oc mq mr ms od mu mv mw im bi translated">Android上有这么多可用的工具和库。它们有不同的API。所有的测试都是不同的，并且处于不同的层次，并且与测试工具和环境相关联。</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="f7b5" class="lj lk it bd ll lm ol lo lp lq om ls lt ki on kj lv kl oo km lx ko op kp lz ma bi translated">安卓克斯</h1><p id="4450" class="pw-post-body-paragraph mb mc it md b me mf kd mg mh mi kg mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated"><a class="ae oa" href="https://developer.android.com/jetpack/androidx" rel="noopener ugc nofollow" target="_blank"> AndroidX </a>是Android <a class="ae oa" href="https://developer.android.com/jetpack" rel="noopener ugc nofollow" target="_blank"> Jetpack </a>工具包的一部分，该工具包是完全开源的，有良好的文档记录和一致性。它有四个模块:</p><ol class=""><li id="ae2d" class="nk nl it md b me nm mh nn mk no mo np ms nq mw oq ns nt nu bi translated"><a class="ae oa" href="https://junit.org/junit5/" rel="noopener ugc nofollow" target="_blank">JUnit</a>:<strong class="md jd"/>JUnit 4的亚军和规则</li><li id="1888" class="nk nl it md b me nv mh nw mk nx mo ny ms nz mw oq ns nt nu bi translated"><a class="ae oa" href="http://junit.sourceforge.net/javadoc/org/junit/runner/JUnitCore.html" rel="noopener ugc nofollow" target="_blank">核心</a>:由<code class="fe or os ot ou b">ApplicationProvider</code>(帮助你快速简单地获得<code class="fe or os ot ou b">ApplicationContext</code>)<code class="fe or os ot ou b">ActivityScenario</code>(测试你的活动的API)<code class="fe or os ot ou b">FragmentScenario</code>(测试你的片段的API)组成</li><li id="3b92" class="nk nl it md b me nv mh nw mk nx mo ny ms nz mw oq ns nt nu bi translated">Espresso: <strong class="md jd"> </strong> <code class="fe or os ot ou b">ViewMatchers</code>，<code class="fe or os ot ou b">ViewActions</code>，<code class="fe or os ot ou b">Intents</code> <strong class="md jd"> <em class="mx"> </em> </strong>类似于我们一直用于UI测试的Espresso。</li><li id="89ed" class="nk nl it md b me nv mh nw mk nx mo ny ms nz mw oq ns nt nu bi translated"><a class="ae oa" href="https://developer.android.com/reference/androidx/test/ext/truth/os/package-summary" rel="noopener ugc nofollow" target="_blank">真相</a>:Google OS测试断言库。帮助你测试Android对象，编写简洁易读的代码。包含<code class="fe or os ot ou b">IntentSubject</code>、<code class="fe or os ot ou b">BundleSubject</code>和<code class="fe or os ot ou b">ParcelableSubject</code>。</li></ol><p id="2ee3" class="pw-post-body-paragraph mb mc it md b me nm kd mg mh nn kg mj mk ob mm mn mo oc mq mr ms od mu mv mw im bi translated">有了统一的API，作为开发人员，您可以专注于测试什么，而不是在哪里以及如何测试。</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="0fbc" class="lj lk it bd ll lm ol lo lp lq om ls lt ki on kj lv kl oo km lx ko op kp lz ma bi translated">最酷的安卓API</h1><h2 id="d39c" class="mz lk it bd ll na nb dn lp nc nd dp lt mk ne nf lv mo ng nh lx ms ni nj lz iz bi translated"><strong class="ak">应用程序提供者</strong></h2><p id="de36" class="pw-post-body-paragraph mb mc it md b me mf kd mg mh mi kg mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">应用程序提供者为你的测试提供上下文。到目前为止，我们有<code class="fe or os ot ou b">getContext()</code>(用于仪器测试)和<code class="fe or os ot ou b">getTargetContext()</code>(用于单元测试)。如果您在单元测试中使用<code class="fe or os ot ou b">getContext()</code>,您将会得到一个运行时错误，然后您将不得不投入额外的时间和精力来调试。</p><p id="caf7" class="pw-post-body-paragraph mb mc it md b me nm kd mg mh nn kg mj mk ob mm mn mo oc mq mr ms od mu mv mw im bi translated">在新的APK中，<code class="fe or os ot ou b">ApplicationProvider</code>通过一个方法调用提供上下文:</p><pre class="ks kt ku kv gt ov ou ow ox aw oy bi"><span id="a6f0" class="mz lk it ou b gy oz pa l pb pc">val context = getApplicationContext&lt;Application&gt;()</span></pre><h2 id="4f83" class="mz lk it bd ll na nb dn lp nc nd dp lt mk ne nf lv mo ng nh lx ms ni nj lz iz bi translated">活动场景</h2><p id="7034" class="pw-post-body-paragraph mb mc it md b me mf kd mg mh mi kg mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">我们都知道<a class="ae oa" href="https://developer.android.com/reference/android/arch/lifecycle/Lifecycle" rel="noopener ugc nofollow" target="_blank"> Android生命周期</a>；在测试时，活动生命周期对于代码测试来说可能是一个挑战，因为在UI测试期间，活动状态可能会改变，而您的测试可能仍然在测试活动的不同状态。</p><pre class="ks kt ku kv gt ov ou ow ox aw oy bi"><span id="47fc" class="mz lk it ou b gy oz pa l pb pc">@Test<br/>fun testTheStateIsNullAtStart() {</span><span id="c4b8" class="mz lk it ou b gy pd pa l pb pc">    // This code launches your activity<br/>    val activityScenario = launchActivity&lt;ActivityName&gt;()<br/>    <br/>    // Ensures your activity stays in CREATED state<br/>    activityScenario.moveToState(Lifecycle.State.CREATED)<br/>    <br/>    // You can inspect internal state of your activity by<br/>    activityScenario.onActivity <strong class="ou jd">{ </strong>activity <strong class="ou jd">-&gt;<br/>        </strong>assertThat(activity.<em class="mx">variableName</em>).isNull()<br/>    <strong class="ou jd">}<br/></strong>}</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pe"><img src="../Images/66e50febe1d1ab3fc0984312cab742db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZrAYyZXPK2wiJeDRvWs1A.png"/></div></div></figure><p id="1f34" class="pw-post-body-paragraph mb mc it md b me nm kd mg mh nn kg mj mk ob mm mn mo oc mq mr ms od mu mv mw im bi translated">当你转动手机，你的活动经历转换时，它使用<code class="fe or os ot ou b">onSavedInstance</code>来保存一些数据，并将其传递给新创建的活动。</p><p id="2c02" class="pw-post-body-paragraph mb mc it md b me nm kd mg mh nn kg mj mk ob mm mn mo oc mq mr ms od mu mv mw im bi translated"><a class="ae oa" href="https://developer.android.com/reference/androidx/test/core/app/ActivityScenario" rel="noopener ugc nofollow" target="_blank">活动场景</a>也可以帮助你测试活动<strong class="md jd"> </strong>的娱乐性。当你的活动已经在后台运行了很长一段时间，而你又回来的时候，活动再造就发生了。</p><pre class="ks kt ku kv gt ov ou ow ox aw oy bi"><span id="bcfe" class="mz lk it ou b gy oz pa l pb pc">@Test<br/>fun testActivityRecreation() {<br/>    <br/><strong class="ou jd">    // GIVEN<br/></strong>    val username = "devDeejay"<br/>    val activityScenario = launchActivity&lt;ActivityName&gt;()</span><span id="d623" class="mz lk it ou b gy pd pa l pb pc"><strong class="ou jd">    // WHEN</strong><br/>    onView(withId(R.id.usernameEditText))<br/>    .perform(typeText(username))<br/>    <br/>    activityScenario.recreate()</span><span id="a404" class="mz lk it ou b gy pd pa l pb pc">   <strong class="ou jd"> // THEN<br/>   </strong> onView(withId(R.id.usernameEditText))<br/>    .check(matches(withText(username)))<strong class="ou jd"><br/></strong>}</span></pre><p id="c746" class="pw-post-body-paragraph mb mc it md b me nm kd mg mh nn kg mj mk ob mm mn mo oc mq mr ms od mu mv mw im bi translated">在这里，<strong class="md jd"> <em class="mx"> </em> </strong> <code class="fe or os ot ou b">activityScenario.recreate()</code>破坏并再现了活动。等待新活动到达<code class="fe or os ot ou b">onResume()</code>。</p><h2 id="06d9" class="mz lk it bd ll na nb dn lp nc nd dp lt mk ne nf lv mo ng nh lx ms ni nj lz iz bi translated"><strong class="ak">真理中的意向主体</strong></h2><p id="5b94" class="pw-post-body-paragraph mb mc it md b me mf kd mg mh mi kg mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">通过使用Intent Subject，您可以验证您的Intent值，如果出现问题，它会提供人类可读的错误消息。</p><pre class="ks kt ku kv gt ov ou ow ox aw oy bi"><span id="c75a" class="mz lk it ou b gy oz pa l pb pc">@Test<br/>fun testActivityIntent() {<br/>    <br/><strong class="ou jd">    // GIVEN<br/></strong>    val username = "devDeejay"<br/>    val dataIntent = createIntent(username)</span><span id="c399" class="mz lk it ou b gy pd pa l pb pc"><strong class="ou jd">    // THEN<br/>   </strong> assertThat(dataIntent)<strong class="ou jd">.hasAction(ACTION_SEND)<br/>   </strong> assertThat(dataIntent)<strong class="ou jd">.hasType("text/plain")<br/>   </strong> assertThat(dataIntent).<strong class="ou jd">extras()<br/>    .string(EXTRA_TEXT).isEqualTo(contactName)<br/></strong>}</span></pre></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="5b38" class="lj lk it bd ll lm ol lo lp lq om ls lt ki on kj lv kl oo km lx ko op kp lz ma bi translated">关于AndroidX测试的更多资源</h1><ul class=""><li id="f28c" class="nk nl it md b me mf mh mi mk pf mo pg ms ph mw nr ns nt nu bi translated"><a class="ae oa" href="https://www.youtube.com/watch?v=-_kZC29sWAo" rel="noopener ugc nofollow" target="_blank">用氮气大规模测试安卓应用</a>🔥</li><li id="fbbc" class="nk nl it md b me nv mh nw mk nx mo ny ms nz mw nr ns nt nu bi translated"><a class="ae oa" href="https://proandroiddev.com/android-automated-testing-setup-564298378673" rel="noopener ugc nofollow" target="_blank">使用AndroidX的Android自动化测试设置</a>💯</li><li id="bac2" class="nk nl it md b me nv mh nw mk nx mo ny ms nz mw nr ns nt nu bi translated"><a class="ae oa" href="https://developer.android.com/training/testing/set-up-project" rel="noopener ugc nofollow" target="_blank">官方文件</a>👻</li></ul></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="0904" class="pw-post-body-paragraph mb mc it md b me nm kd mg mh nn kg mj mk ob mm mn mo oc mq mr ms od mu mv mw im bi translated">那是美好的一天32:了解AndroidX有多酷！满足我们所有测试需求的一站式解决方案。谢谢你，谷歌开发者。</p><p id="f2f3" class="pw-post-body-paragraph mb mc it md b me nm kd mg mh nn kg mj mk ob mm mn mo oc mq mr ms od mu mv mw im bi translated">第33天见！感谢阅读。</p></div></div>    
</body>
</html>