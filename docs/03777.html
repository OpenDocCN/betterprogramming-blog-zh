<html>
<head>
<title>How to SSH Into a Kubernetes Pod From Outside the Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从集群外部SSH到Kubernetes Pod</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-ssh-into-a-kubernetes-pod-from-outside-the-cluster-354b4056c42b?source=collection_archive---------0-----------------------#2020-03-04">https://betterprogramming.pub/how-to-ssh-into-a-kubernetes-pod-from-outside-the-cluster-354b4056c42b?source=collection_archive---------0-----------------------#2020-03-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ed50" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">根据定义，Pod类似于虚拟机，因此我们可以SSH进入</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/40c3a16aa1860effef09daa26d5348dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ijwyFp6zpI1qBAzWxHhAtQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@orlovamaria?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">奥尔洛娃·玛利亚</a>在<a class="ae ky" href="https://unsplash.com/s/photos/go-inside?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="efd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">安全套接字协议层(SSH) </em>是一种基于UNIX的协议，用于访问远程机器或虚拟机(VM)。</p><p id="e5c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">根据定义，</em>Pod类似于VM，因为它允许容器的行为就像它们在独立的VM上运行一样。如果您在集群内部——最简单的方法是使用kubectl exec命令</p><p id="b5b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，有可能从集群外部通过SSH连接到K8 Pod吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/c9252bf358d69c5a5dbcd65e8141bf46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xCEgSFtyrLfpTM8Eljpi9Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从集群外部SSH到Kubernetes Pod</p></figure><p id="a1a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的。有可能！—但只有在逐步回答以下问题后…</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="08f4" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">如何可靠地访问K8吊舱？</h1><p id="a490" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">根据定义，pod本质上是短暂的，服务是一组pod的稳定抽象点。因此，可以通过<em class="lv">服务可靠地访问K8 Pod。</em></p><h2 id="e092" class="nb mf it bd mg nc nd dn mk ne nf dp mo li ng nh mq lm ni nj ms lq nk nl mu nm bi translated"><strong class="ak">从Kubernetes集群外部访问pod的合适服务类型是什么？</strong></h2><p id="a7f8" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated"><code class="fe nn no np nq b">ClusterIP</code>、<code class="fe nn no np nq b">NodePort</code>和<code class="fe nn no np nq b">LoadBalancer</code>是三种可能的服务类型。</p><p id="2b81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，从集群外部永远无法访问<code class="fe nn no np nq b">ClusterIP</code>服务，因此它不是一个选项。</p><p id="144e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">NodePort</code>服务提供了一个可以通过集群节点访问的集群范围的端口。但是考虑到节点本质上也是短暂的，<code class="fe nn no np nq b">NodePort</code>不是访问Pod的稳定方式。</p><p id="f740" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">LoadBalancer</code>服务是<em class="lv">唯一适合从Kubernetes集群外部访问Pod的</em>服务类型，因为这种服务类型提供了一个外部IP地址，可以绑定到一个公共负载平衡器，如Google的HTTPS负载平衡器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/9f9594d3461a0523023d2589cc3a718d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*ILfP8qAQAL7qQVMRtodI_Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从外部IP到服务于pod的负载平衡器服务器的请求</p></figure><p id="a165" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是打开SSH端口进行通信的<code class="fe nn no np nq b">LoadBalancer</code>服务的片段。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="624d" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">如何启用一个Pod作为SSH服务器？</h1><p id="6549" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">为了SSH到Pod，Pod应该安装了<em class="lv"> SSH服务器</em>。这可以通过安装<a class="ae ky" href="https://help.ubuntu.com/lts/serverguide/openssh-server.html" rel="noopener ugc nofollow" target="_blank"> OpenSSH服务器</a>作为绑定到Pod的Docker镜像的一部分来提供。</p><p id="82e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下命令应包含在与绑定到Pod的集装箱相关联的Dockerfile文件中。</p><p id="3cd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，即使Pod是短暂的，它在每次重新创建时都将拥有<code class="fe nn no np nq b">openssh-server</code>功能，并且配置了SSH的默认用户。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="2774" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后…</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="cacd" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">我们如何从Kubernetes集群外部SSH到K8 Pod？</h1><p id="e091" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">假设Pod可以通过服务访问，并且可以通过由公共负载平衡器服务的<code class="fe nn no np nq b">LoadBalancer</code>服务到达；用户可以从Kubernetes集群外部通过SSH进入K8 Pod，方法是执行下面的经典<code class="fe nn no np nq b">ssh</code>命令:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="01c1" class="nb mf it nq b gy ny nz l oa ob">#Example <br/>ssh -f testuser@&lt;external-load-balancer-ip-address&gt;</span><span id="db78" class="nb mf it nq b gy oc nz l oa ob">(Enter password on prompt to establish the SSH connection)</span></pre><h2 id="bf21" class="nb mf it bd mg nc nd dn mk ne nf dp mo li ng nh mq lm ni nj ms lq nk nl mu nm bi translated"><strong class="ak">替代方法——SSH密钥代替用户凭证</strong></h2><p id="c825" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">如果SSH密钥需要用作身份验证机制，那么客户机的公共SSH密钥可以作为一个秘密安装到Pod上。</p><p id="3374" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将确保客户端的公钥在Pod中作为授权密钥可用，随后，客户端可以通过用客户端的私钥验证Pod上的授权密钥来进行连接。</p></div></div>    
</body>
</html>