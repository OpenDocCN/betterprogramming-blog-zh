<html>
<head>
<title>How To Use React-Tracked</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用反应跟踪</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-react-tracked-c2b13706ff68?source=collection_archive---------5-----------------------#2019-07-07">https://betterprogramming.pub/how-to-use-react-tracked-c2b13706ff68?source=collection_archive---------5-----------------------#2019-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="58f5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用immer反应面向钩子的待办事项列表</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/003288633a7bae1f38f78a5b6eecddbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DjRT_r3wikcMlljb8Mqhzw.jpeg"/></div></div></figure><h1 id="555b" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">介绍</h1><p id="2879" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">React钩子改变了我们编写组件的方式。这篇文章将展示一个面向钩子的例子。</p><p id="3396" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们将使用两个库:react-tracked和immer。immer使得以不可变的方式更新状态变得容易，而react-tracked使得通过跟踪读取状态以进行优化变得容易。更多详情请查看回购协议。</p><p id="799c" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><a class="ae mn" href="https://github.com/dai-shi/react-tracked" rel="noopener ugc nofollow" target="_blank">https://github.com/dai-shi/react-tracked</a></p><p id="4a42" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们展示的例子来自Redux: <a class="ae mn" href="https://redux.js.org/basics/example" rel="noopener ugc nofollow" target="_blank"> Todo List </a>。</p><h1 id="5f39" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">文件夹结构</h1><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="6696" class="mt kv it mp b gy mu mv l mw mx">- src/<br/>  - index.tsx<br/>  - state.ts<br/>  - hooks/<br/>    - useAddTodo.ts<br/>    - useToggleTodo.ts<br/>    - useVisibilityFilter.ts<br/>    - useVisibleTodos.ts<br/>  - components/<br/>    - AddTodo.tsx<br/>    - App.tsx<br/>    - FilterLink.tsx<br/>    - Footer.tsx<br/>    - Todo.tsx<br/>    - VisibleTodoList.tsx</span></pre><p id="763c" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们有两个文件夹:<code class="fe my mz na mp b">components</code>和<code class="fe my mz na mp b">hooks</code>。组件基本上是视图，钩子包括逻辑。</p><h1 id="8a21" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">src/state.ts</h1><p id="1dce" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在这个例子中，我们没有使用减速器。我们只定义一个状态和一些类型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="0097" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">注意最后一行——可能有点复杂。<code class="fe my mz na mp b">SetState</code>是<code class="fe my mz na mp b">setState</code>的一种类型。</p><h1 id="fa1e" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">src/hooks/useAddTodo.ts</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="2aaa" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这是负责添加项目的钩子。我们这里用immer，但没必要。</p><h1 id="dbb8" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">src/hooks/useToggleTodo.ts</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="34c3" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">同样的想法，用这个钩子来切换一个项目。</p><h1 id="e8ff" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">src/hooks/usevisibilityfilter . ts</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="1683" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这个钩子用于返回当前的<code class="fe my mz na mp b">visibilityFilter</code>和一个setter函数。我们为此使用<code class="fe my mz na mp b">useTracked</code>。是组合式挂钩，组合<code class="fe my mz na mp b">useTrackedState</code>和<code class="fe my mz na mp b">useDispatch</code>。</p><h1 id="cc1b" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">src/hooks/useVisibleTodos.ts</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="36a8" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这个钩子处理Todo项目的过滤。</p><h1 id="a9dc" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">src/components/AddTodo.tsx</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="f821" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">除了从<code class="fe my mz na mp b">hooks</code>文件夹导入<code class="fe my mz na mp b">useAddTodo</code>之外，这里没有什么特别需要注意的。</p><h1 id="9c0b" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">src/components/Todo.tsx</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="5902" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这是一个没有挂钩依赖的组件。</p><h1 id="6f10" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">src/components/visibletodolist . tsx</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="6313" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这和原来的例子不一样。我们把过滤逻辑移到了钩子上。</p><h1 id="b7a7" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">src/components/FilterLink.tsx</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="7cba" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这使用了<code class="fe my mz na mp b">useVisibilityFilter</code>挂钩。注意钩子返回一个元组、一个值和一个setter函数。</p><h1 id="c67e" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">src/components/Footer.tsx</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="99c3" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这个组件没有什么特别需要注意的。</p><h1 id="179f" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">src/components/App.tsx</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="0d05" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这是将其他组件组合在一起的组件。</p><h1 id="bfc0" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">src/index.tsx</h1><p id="bb19" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">最后，我们需要入口点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="1600" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">注意<code class="fe my mz na mp b">&lt;Provider&gt;</code>从state.ts通过了<code class="fe my mz na mp b">useValue</code>。</p><h1 id="3558" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">在线演示</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd nc l"/></div></figure><p id="dd62" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><a class="ae mn" href="https://github.com/dai-shi/react-tracked/tree/master/examples/07_todolist" rel="noopener ugc nofollow" target="_blank">回购中的源代码</a></p><h1 id="9c34" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">结束语</h1><p id="62f5" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在我写这篇文章的时候，我注意到了一些事情。我最初的动机是展示如何使用反应跟踪。然而，这个例子也展示了setState和定制钩子如何在没有reducers的情况下分离关注点。我的另一个发现是，至少在这个例子中，immer在定制钩子方面没有太大帮助。</p><p id="1dee" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们没有过多讨论性能优化。还有改进的余地。最简单的一个就是用<code class="fe my mz na mp b">React.memo</code>。优化可能是未来文章的主题。</p><p id="99d3" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这篇文章最初发表于<a class="ae mn" href="https://blog.axlight.com/posts/how-to-use-react-tracked-react-hooks-oriented-todo-list-example/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div></div>    
</body>
</html>