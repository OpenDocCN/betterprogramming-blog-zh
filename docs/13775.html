<html>
<head>
<title>Run Your Prettier Scripts Even Faster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更快地运行更漂亮的脚本</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/run-your-prettier-scripts-even-faster-ef85381cf28e?source=collection_archive---------11-----------------------#2022-09-26">https://betterprogramming.pub/run-your-prettier-scripts-even-faster-ef85381cf28e?source=collection_archive---------11-----------------------#2022-09-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2cb3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">充分利用Apex的漂亮配置</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ff979b0ef12276f6d8637c83b7c4d463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vh5rCFVZJZLCd742"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@roonz_nl?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> RoonZ nl </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="5665" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/stop-manually-formatting-your-code-dcca34de7b1e">我的上一篇文章</a>，你知道我是格式化和自动化任务的爱好者。我完全赞成多成就，少做事。这就是为什么我最近一直在互联网上搜索，试图找到运行Prettier的最佳方式，这是一个著名的代码格式化程序，它对性能较差的计算机也不友好。</p><blockquote class="ls"><p id="d62b" class="lt lu iq bd lv lw lx ly lz ma mb lr dk translated">我完全赞成多成就，少做事！</p></blockquote><p id="e0fd" class="pw-post-body-paragraph kw kx iq ky b kz mc jr lb lc md ju le lf me lh li lj mf ll lm ln mg lp lq lr ij bi translated">比方说，我没有最新的也没有最漂亮的电脑，尽管我可以抱怨这会降低我的工作效率，让我发疯……但我不会。我选择看到它对我的工作流的积极的附带损害，例如提高我的创造力以找到最有效的方式来运行脚本，并避免我的计算机在执行过程中崩溃。</p><p id="8054" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，等等…为什么它会崩溃？漂亮有这么重吗？嗯，当使用默认配置并使用Apex 的更漂亮的插件<a class="ae kv" href="https://github.com/dangmai/prettier-plugin-apex" rel="noopener ugc nofollow" target="_blank">时，就可以了。运行格式化脚本时，浏览每个文件大约需要一秒钟，在处理大型项目时，这可能是个问题。想想你每天提交多少次，你项目中的文件数量，然后乘以你团队中开发人员的数量。</a></p><blockquote class="ls"><p id="e419" class="lt lu iq bd lv lw lx ly lz ma mb lr dk translated">浏览每个文件大约需要一秒钟，在处理大型项目时，这可能是一个问题。</p></blockquote><p id="71b2" class="pw-post-body-paragraph kw kx iq ky b kz mc jr lb lc md ju le lf me lh li lj mf ll lm ln mg lp lq lr ij bi translated">为了进一步理解为什么需要这么长时间，我将使用Apex插件对一个普通的Apex项目进行更漂亮的执行。执行顺序如下:</p><ol class=""><li id="4efe" class="mh mi iq ky b kz la lc ld lf mj lj mk ln ml lr mm mn mo mp bi translated">我们执行漂亮的命令。</li><li id="6fa7" class="mh mi iq ky b kz mq lc mr lf ms lj mt ln mu lr mm mn mo mp bi translated">更漂亮的Apex插件叫做。</li><li id="2c45" class="mh mi iq ky b kz mq lc mr lf ms lj mt ln mu lr mm mn mo mp bi translated">运行apex解析器—Apex解析器在Java上运行，这是一种高成本的操作，因为Java虚拟机大约需要半秒钟才能启动。</li><li id="2418" class="mh mi iq ky b kz mq lc mr lf ms lj mt ln mu lr mm mn mo mp bi translated">您的代码已格式化！对下一个文件重复该循环。</li></ol><p id="4032" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你认为这里有任何可能的改进吗？你猜对了！我们确实可以通过避免为每个文件运行一个解析器，而是让它们共享一个解析器来优化执行。让我引导你通过它。</p><p id="20f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我假设你已经使用了prettier，并且熟悉它的安装和配置。所以只要确保你已经安装了Apex插件。</p><pre class="kg kh ki kj gt mv mw mx my aw mz bi"><span id="5c96" class="na nb iq mw b gy nc nd l ne nf"># Install locally Apex Prettier plug-in<br/>npm install --save-dev prettier prettier-plugin-apex</span><span id="ce78" class="na nb iq mw b gy ng nd l ne nf"># Or install globally Apex Prettier plug-in<br/>npm install --global prettier prettier-plugin-apex</span></pre><p id="9019" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在准备用以下命令初始化终端中的服务器:</p><pre class="kg kh ki kj gt mv mw mx my aw mz bi"><span id="95e2" class="na nb iq mw b gy nc nd l ne nf"># initializes the server<br/>node node_modules/prettier-plugin-apex/bin/start-apex-server.js</span></pre><p id="c826" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用常用命令，通过一些加载项运行得更漂亮:</p><pre class="kg kh ki kj gt mv mw mx my aw mz bi"><span id="47b4" class="na nb iq mw b gy nc nd l ne nf"># run the prettier command<br/>prettier --apex-standalone-parser built-in --list-different \"**/*.{cls,cmp,component,css,html,js,json,md,page,trigger,xml,yaml,yml}\"</span></pre><p id="8688" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你注意到我们命令中的标签了吗？这是我们必须确保更漂亮地使用内置的独立解析器以获得更好性能的方法。</p><p id="38d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦您看到所有的文件都被解析，您可以用下面的命令关闭解析器:</p><pre class="kg kh ki kj gt mv mw mx my aw mz bi"><span id="30bd" class="na nb iq mw b gy nc nd l ne nf"># stop server<br/>node node_modules/prettier-plugin-apex/bin/stop-apex-server.js</span></pre><h1 id="86aa" class="nk nb iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">脚本版本</h1><p id="186d" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">如果您不想单独运行每个命令，或者您想将它添加到您的CI/CD流中，您可以将命令添加到<code class="fe nh ni nj mw b">package.json</code>中，并在一个脚本中运行它们，如下例所示。它将运行解析器并等待它准备好，然后，它将更好地执行并关闭解析器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><h1 id="f329" class="nk nb iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">额外提示</h1><p id="521d" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">即使进行了优化，每天格式化整个项目也没有多大意义。这就是为什么我采用以下策略:</p><ul class=""><li id="0a5c" class="mh mi iq ky b kz la lc ld lf mj lj mk ln ml lr oi mn mo mp bi translated">每隔一段时间运行一次完整的脚本，以保持整洁。</li><li id="4da1" class="mh mi iq ky b kz mq lc mr lf ms lj mt ln mu lr oi mn mo mp bi translated">改变之前的脚本，只修饰你正在处理的文件。这将很容易验证你所做的改变和漂亮的人所做的改变。</li></ul></div></div>    
</body>
</html>