<html>
<head>
<title>End-to-End Testing Using xUnit and Docker on Azure Pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Azure管道上使用xUnit和Docker进行端到端测试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/end-to-end-testing-using-xunit-and-docker-on-azure-pipelines-1ef2311e2f61?source=collection_archive---------5-----------------------#2021-10-18">https://betterprogramming.pub/end-to-end-testing-using-xunit-and-docker-on-azure-pipelines-1ef2311e2f61?source=collection_archive---------5-----------------------#2021-10-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f93f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Azure Pipelines中使用xUnit和Docker的定制集成测试解决方案综合指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/eb3fdc29081ad7ae00e2170d792b4377.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0fFNNc5da-owNu3qAQmwGg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者插图，背景由<a class="ae kv" href="https://unsplash.com/@anniespratt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">安妮·斯普拉特</a>在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="412a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有效的端到端测试是对您的应用程序最重要的事情之一。但是进行端到端测试不像进行单元测试那么简单，因为它可能是单元测试和集成测试的融合。您将需要加速您的测试环境，更重要的是，您需要在CI管道中完成这一切。</p><p id="52c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让端到端测试在您的CI管道中运行，可以帮助您节省大量的测试时间，最重要的是，因为它是自动化的，所以您可以在每次想要检查构建时利用这一点。</p><h1 id="f3ec" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是端到端测试？</h1><p id="7728" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">端到端测试意味着模拟整个应用程序流，使整个应用程序可测试。在您的日常工作流程中使用端到端测试可以创建更强大的应用程序体验，保证每个发布版本的质量。</p><p id="38de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是在本文中，我将向您展示如何使用xUnit和Azure管道对您的API进行端到端测试。您将学习如何使用Docker创建模拟数据库，以及如何使用NSubstitute和AutoFixture模拟接口。</p><h1 id="97ef" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用xUnit编写单元测试</h1><p id="dff4" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在开始之前，我需要通知您，在本节中，我将利用四个主要的包进行单元测试:</p><ul class=""><li id="6d19" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">xUnit</li><li id="ed09" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">不可替代</li><li id="7bbd" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">自动固定</li><li id="abd3" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">FluentAssertions</li></ul><p id="bedc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">单元测试是端到端测试系统的一部分。单元测试是用来测试应用程序组件微小部分的小代码。为了能够保证业务逻辑输出，您可以创建一个单元测试来模拟输入并相应地检查输出。以下代码可以帮助您:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">单元测试模板</p></figure><p id="b194" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，您想要创建一个测试套件，用于检查当提供空参数时，方法是否返回用户角色列表。在您开始测试之前，您需要创建被测试的主题(SUT)以及相应的依赖项。</p><p id="ff91" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">处理程序将是SUT，存储库将使用NSubstitute进行模拟，最后，我们需要启动一个<code class="fe nf ng nh ni b">IFixture</code>实例来帮助生成假数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">安排单元测试</p></figure><p id="4a14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，您需要通过创建将通过依赖注入使用的模拟对象来安排测试。在这种情况下，您可能想要创建假的结果，并将它们附加到模拟的依赖项。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">执行单元测试</p></figure><p id="5f79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在你创建了假的结果之后，你需要执行这个方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">断言单元测试</p></figure><p id="98ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了验证结果，您可以使用流畅的断言方法。fluent断言不是微软默认测试套件提供的默认功能，它是一个您可以安装的自定义软件包。如果你有一个不存在错误的方法，试着先安装<strong class="ky ir">fluent assessments</strong>包。</p><h1 id="5bad" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用Docker启动独立数据库</h1><p id="5450" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在开始使用xUnit编写端到端测试之前，您需要连接到一个测试数据库。创建测试数据库最简单的方法是使用Docker。通过使用Docker，您可以创建填充了测试数据的数据库映像。最重要的是，您可以将它与您的CI管道集成，以创建功能测试。</p><p id="5b0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，您需要创建一个脚本来填充测试数据(在这里，我将把脚本命名为<code class="fe nf ng nh ni b">init.sql</code>)。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">为集成测试注入新AccessRoles数据的查询</p></figure><p id="2ce2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，创建一个<code class="fe nf ng nh ni b">Dockerfile</code>，它将构建您的定制映像，假设您将使用SQL Server，下面的<code class="fe nf ng nh ni b">Dockerfile</code>将使用SQL Server，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于创建自定义SQL Server映像的Dockerfile</p></figure><h1 id="31ee" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用xUnit编写集成测试</h1><p id="20da" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">编写集成测试非常容易，但是在开始之前，我需要通知您，在本节中，我将使用两个主要的集成测试包:</p><ul class=""><li id="68e9" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">xUnit</code></li><li id="adfd" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">Microsoft.AspNetCore.Mvc.Testing</code></li></ul><p id="dd10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这需要微软提供的包才能工作。这个包提供了内存API测试所需的一切。假设您已经有了在后台运行的数据库，那么您需要做的就是创建测试。</p><p id="63b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，让我们做一个测试，检查<code class="fe nf ng nh ni b">/users</code>端点是否会返回一个成功状态代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">集成测试模板</p></figure><p id="4d53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个测试类都会扩展<code class="fe nf ng nh ni b">IClassFixture</code>接口。<code class="fe nf ng nh ni b">IClassFixture</code>由<code class="fe nf ng nh ni b">WebApplicationFactory</code>类提供。<code class="fe nf ng nh ni b">WebApplicationFactory</code>将用于创建一个与生产非常相似的内存客户端。您只需要在<code class="fe nf ng nh ni b">/users</code>端点上执行<code class="fe nf ng nh ni b">GET</code>方法，然后就可以检索和断言状态代码。</p><p id="a3d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为响应将是。您可以通过使用以下命令来断言状态代码:</p><pre class="kg kh ki kj gt nj ni nk nl aw nm bi"><span id="81b8" class="nn lt iq ni b gy no np l nq nr">await client.GetAsync(url);</span></pre><p id="2289" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者，您可以使用以下方式访问响应内容:</p><pre class="kg kh ki kj gt nj ni nk nl aw nm bi"><span id="cefc" class="nn lt iq ni b gy no np l nq nr">await response.Content.ReadAsStringAsync();</span></pre><p id="314c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建集成测试现在不是很难了，不是吗？上面的例子看起来很简单，但是如果你愿意的话，它可以扩展到很大的程度。</p><h1 id="470e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用Azure Pipeline自动化CI构建内部的测试</h1><p id="80aa" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">出于安全目的，Azure Pipelines要求您托管一个私有构建代理，以便在CI管道中运行Linux Docker映像。要运行XUnit测试，您需要在安装了Visual Studio的机器上运行它们。</p><p id="2587" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要为您的生成代理安装Visual Studio，您需要首先在Windows计算机上安装一个生成代理作为基准操作系统。</p><h2 id="29fd" class="nn lt iq bd lu ns nt dn ly nu nv dp mc lf nw nx me lj ny nz mg ln oa ob mi oc bi translated">安装visual studio生成代理</h2><p id="7ba9" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为此，您需要下载特定于Windows的构建代理，但要获得最新的代理版本，您需要从代理池页面获取。</p><p id="91d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，转到您的项目设置:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/0a73f6dfdadb0a899c0b7600dfe658b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NvetVa7tscrBU7_c"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="3424" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后转到代理池部分，并单击您的默认代理池。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/be3afc07a1fd9b1f433f88ee96d01b73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g7w2zUB0j6ETQXPX"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="7c6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击<strong class="ky ir">新增代理</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/635bdff30f7480178843640f051bf701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ulsmejcnObSMlXtY"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="938d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后会出现一个弹出窗口，您必须:</p><ol class=""><li id="0974" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">点击<strong class="ky ir">窗口的</strong>选项卡。</li><li id="fecb" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">复制代理下载URL。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/5efb2b74e7260e51617309d3ee23a08f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T-Alge-xowBdbdno"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="7377" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">TL；<em class="oi">博士为了帮助你更快的度过这一切，你可以在这里</em> </strong>  <strong class="ky ir"> <em class="oi">下载</em> </strong> <a class="ae kv" href="https://vstsagentpackage.azureedge.net/agent/2.193.1/vsts-agent-win-x64-2.193.1.zip" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="oi">代理(链接指向代理版本2.193.1)，以后再更新。</em>T19】</strong></a></p><p id="0613" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，转到您的<code class="fe nf ng nh ni b">C:</code>目录并键入create a new directory agent:</p><pre class="kg kh ki kj gt nj ni nk nl aw nm bi"><span id="d400" class="nn lt iq ni b gy no np l nq nr">mkdir agent<br/>cd agent</span></pre><p id="56ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，通过解包下载的软件包来创建代理:</p><pre class="kg kh ki kj gt nj ni nk nl aw nm bi"><span id="9303" class="nn lt iq ni b gy no np l nq nr">Add-Type -AssemblyName System.IO.Compression.FileSystem ; [System.IO.Compression.ZipFile]::ExtractToDirectory(“$HOME\Downloads\vsts-agent-win-x64–2.193.1.zip”, “$PWD”)</span></pre><p id="a46e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，通过运行配置脚本来配置代理:</p><pre class="kg kh ki kj gt nj ni nk nl aw nm bi"><span id="1783" class="nn lt iq ni b gy no np l nq nr">.\config.cmd</span></pre><p id="4f04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，使用<code class="fe nf ng nh ni b">run.cmd</code>脚本运行代理:</p><pre class="kg kh ki kj gt nj ni nk nl aw nm bi"><span id="b9d3" class="nn lt iq ni b gy no np l nq nr">.\run.cmd</span></pre><p id="980a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">若要在Windows代理上启用Visual Studio，您只需在您的计算机上下载并安装Visual Studio。因为我的示例将使用VS2017，所以您可以在这里检索<a class="ae kv" href="https://visualstudio.microsoft.com/vs/older-downloads/" rel="noopener ugc nofollow" target="_blank"> VS2017的下载URL。</a></p><h1 id="f22c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">创建CI渠道</h1><p id="88fc" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">首先，创建新的配置项管道:</p><ol class=""><li id="e62f" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">进入您的管道目录。</li><li id="6a8b" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">点击<strong class="ky ir">创建管道</strong>。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/03143b93b01ac87ed38ae1c80af0f2fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8tOE8eMnatDfvF0T"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="2157" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尝试创建配置项模板时，选择使用经典编辑器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/6286e9b66fde92f7ae3f9e3c119772c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k8GiItXngsd-IQN9"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="08fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，确定您将参与哪个项目:</p><ol class=""><li id="c98d" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">选择<strong class="ky ir">项目</strong>。</li><li id="8ed3" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">选择您指定的存储库。</li><li id="1435" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">选择将触发CI构建的分支。</li><li id="6ccc" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">全部完成后，再次检查并点击<strong class="ky ir">继续</strong>。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/ddb43113c19cd372679139de345ab875.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R2KZfeWwmFG0twF8"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="70d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要简化新模板的创建:</p><ol class=""><li id="10bc" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">搜索预定义的ASP.NET核心模板。</li><li id="5317" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">应用模板。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/9e513a914671eccfee930a0a031e0473.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XrMRGmLTN8Ec71sg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="b949" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，使用您安装的Visual Studio代理:</p><ol class=""><li id="f7c9" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">点击<strong class="ky ir">管道</strong>标签。</li><li id="2b24" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">单击代理池下拉列表。</li><li id="8b64" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">选择您的自托管代理池。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/6c6c54a6212b461e017184e324ef3f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Nnwd5o44lcGEt7HV"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="330d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个具体的ASP.NET核心解决方案中，我将其分成三个项目，主要是<code class="fe nf ng nh ni b">Application</code>、<code class="fe nf ng nh ni b">UnitTest</code>和<code class="fe nf ng nh ni b">IntegrationTest</code>项目。这三个项目的修复和建造阶段也将分开。</p><p id="902c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目前，您将为应用程序项目设置恢复:</p><ol class=""><li id="1752" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">单击恢复任务。</li><li id="30c7" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">通过单击链形符号取消项目链接。</li><li id="d199" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">然后点击<strong class="ky ir">解除链接</strong>。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/68b54339154953ae60d4c5597f77c8f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Kd8lrQYsgZVGMXsQ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="1ad3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后将<strong class="ky ir">到</strong>项目的路径改为<strong class="ky ir">到</strong>您的应用程序项目文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/7b62bafb87d518484d8debd19ff3716e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1lXvzfD1M2rfrhUE"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="7548" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，对构建任务执行同样的操作:</p><ol class=""><li id="c5ed" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">单击构建任务。</li><li id="a010" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">将项目路径更改为应用程序项目文件。</li><li id="71c8" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">添加一个配置来防止构建恢复依赖项(因为它已经通过前面的任务完成了)。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/018154589232315f251a87f2c610d0a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rYJZU1Lsr134yAge"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="243c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过以下方式清理未使用的任务:</p><ol class=""><li id="4a7c" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">单击要删除的任务。</li><li id="ef60" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">点击<strong class="ky ir">移除</strong>按钮。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/c0bc7e8f4d221b428bc870e869a46bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iQYID_uYwYdzVZiu"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="0541" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我的例子需要一个<code class="fe nf ng nh ni b">appsettings.json</code>:</p><ol class=""><li id="6a0c" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">点击<strong class="ky ir"> + </strong>按钮。</li><li id="dcf2" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">因为你在Windows操作系统上选择搜索<strong class="ky ir"> Powershell </strong>。</li><li id="cb88" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">点击<strong class="ky ir">添加</strong>。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/5143018df5bdfe464fad683af398f813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fZuPK6sLZBAd-20f"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="503f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Powershell任务将用于使用Powershell脚本在应用程序项目文件夹中插入appsettings.json。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于复制appsettings.json的Powershell脚本</p></figure><p id="bbaa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要插入Powershell脚本:</p><ol class=""><li id="c69d" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">单击Powershell任务。</li><li id="cba8" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">将任务显示标题更改为<strong class="ky ir">复制appsettings.json </strong>。</li><li id="e4de" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">将脚本类型更改为内联。</li><li id="01ca" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">添加脚本。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/865a4d681edd87c594520b317e18882b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QojaxcMg4SM-cbcY"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="6f94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，您将需要恢复并构建单元测试项目，您可以通过克隆应用程序项目的前两个任务来轻松完成这一任务:</p><ol class=""><li id="0f74" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">左键单击恢复项目任务。</li><li id="01ad" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">点击<strong class="ky ir">克隆任务</strong>选项。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/850b4d735a702fdebd23cb61d76f2352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j1IGJZ8n8uUQ3Mcx"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="1692" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">克隆恢复任务后:</p><ol class=""><li id="f959" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">单击克隆的任务。</li><li id="75b6" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">更改显示名称。</li><li id="d8a1" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">更改项目文件位置。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/70a2f3883500e460731760550889747f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-DJ-dYcKOou_LiGf"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="6ba9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后重复构建任务的步骤，之后:</p><ol class=""><li id="8520" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">单击克隆的任务。</li><li id="da78" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">更改显示名称。</li><li id="8131" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">更改项目文件位置。</li><li id="bc97" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">检查配置以防止在构建期间进行恢复，如果不存在，请添加它。</li><li id="1ea7" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">对集成测试项目再次这样做。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/4e0d4cf702a92fdf6c50f771620f5bbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YOxoDFp6DO8AMNbq"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="ac29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要运行Docker数据库，需要添加一个Docker任务:</p><ol class=""><li id="2516" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">点击<strong class="ky ir"> + </strong>按钮。</li><li id="a42b" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">搜索Docker任务。</li><li id="edd7" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">点击<strong class="ky ir">添加</strong>。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/08ca89beb4e7f0233fd9dfed623c29fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mrn14sig9SxWKBte"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="e528" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在运行Docker容器之前，您需要首先构建它:</p><ol class=""><li id="c07b" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">点击新的Docker任务。</li><li id="7121" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">将任务版本更改为<strong class="ky ir"> 0。* </strong>。</li><li id="c1f6" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">将动作更改为<strong class="ky ir">构建图像</strong>。</li><li id="0175" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">更新容器注册表类型以使用常规容器注册表。</li><li id="efe8" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">插入您的<code class="fe nf ng nh ni b">Dockerfile</code>的位置。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/11ca5c4e26ea7b62232ad71a8309d8fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jFoNnYVL1C6oAy-E"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="76f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加另一个Docker任务来运行映像:</p><ol class=""><li id="e059" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">点击新的Docker任务。</li><li id="8400" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">将任务版本更改为<strong class="ky ir"> 0。* </strong>。</li><li id="7d53" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">将动作更改为<strong class="ky ir">运行图像</strong>。</li><li id="2200" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">取消选中<strong class="ky ir">限定图像名称</strong>选项。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/79dd7370e636886db77cd76a19ea6cd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sSecuiTmbKk_kwFU"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="d5c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加Visual Studio测试任务:</p><ol class=""><li id="12d1" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">点击<strong class="ky ir"> + </strong>按钮。</li><li id="6629" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">搜索Visual Studio测试任务。</li><li id="be3a" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">点击<strong class="ky ir">添加</strong>。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/2e94fd8b30965b69206561200b065abf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Tenf4aBwo5RCc4yV"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="10d0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">设置Visual Studio测试任务:</p><ol class=""><li id="db9e" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">点击任务。</li><li id="3b5c" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">更改显示名称。</li><li id="b45f" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">定义测试文件。</li></ol><p id="775e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测试文件脚本如下:</p><pre class="kg kh ki kj gt nj ni nk nl aw nm bi"><span id="610d" class="nn lt iq ni b gy no np l nq nr">**\bin\$(BuildConfiguration)\**\*test*.dll<br/>!**\obj\**<br/>!**\xunit.runner.visualstudio.testadapter.dll<br/>!**\xunit.runner.visualstudio.dotnetcore.testadapter.dll</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/73713ccd45ce0b047c7db14ad491fd28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JVxSGIEpzlwKr4XK"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="956c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加另一个发布测试的任务:</p><ol class=""><li id="3964" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">点击<strong class="ky ir"> + </strong>按钮。</li><li id="f721" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">搜索“发布测试结果”任务。</li><li id="9ef7" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">点击<strong class="ky ir">添加</strong>。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/9523562bbc861c2a82c28fa32aaa102a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iMGYwbbhC_P2nAfT"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="7e71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，设置发布测试结果任务:</p><ol class=""><li id="ea5f" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr og mv mw mx bi translated">点击任务。</li><li id="bfab" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">更改显示名称。</li><li id="db6f" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr og mv mw mx bi translated">将预期的测试格式更改为XUnit。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/39743b1b6226cdc1b3b0a1cf0a48ebbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B3aDzBBI6OlZZNZ4"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="0e5b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">TL；如果这个经典编辑器过时了，你可以在这里复制YAML版本的管道:</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用Azure管道进行端到端测试的管道</p></figure><h1 id="c4c9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="f0e1" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在本教程中，您学习了如何使用XUnit创建一个基本的端到端测试，以及如何使用Azure Pipelines在CI管道上运行它们。进行端到端测试的目的是确保您的应用程序运行良好，在这种情况下，是确保您的API完美无缺。</p><p id="232a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过本教程，我希望您可以将端到端测试无缝集成到您的CI管道中，现在您将有一本开放的食谱供您测试。</p></div></div>    
</body>
</html>