<html>
<head>
<title>Getting Gatsby Wrong</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">误解了盖茨比</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-gatsby-wrong-836c198eb6ea?source=collection_archive---------7-----------------------#2020-01-29">https://betterprogramming.pub/getting-gatsby-wrong-836c198eb6ea?source=collection_archive---------7-----------------------#2020-01-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="45c8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用客户端运行时数据提取而不是构建时数据提取</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f231816ed744c28769ee77a44e192d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AZLyYP_0Pc7TKK-zLGYOLg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/s/photos/mistake?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@neonbrand?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> NeONBRAND </a>拍摄的照片</p></figure><p id="2197" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像许多其他人一样，我最近用<a class="ae ky" href="https://www.gatsbyjs.org/" rel="noopener ugc nofollow" target="_blank">盖茨比</a>给自己建了一个网站。但我实际做的是用Gatsby CLI引导一个应用程序，然后像对待任何其他React应用程序一样对待它——我还不如使用<a class="ae ky" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>。</p><p id="c977" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能已经听说过，Gatsby使得构建静态网站变得很容易，这些静态网站是进步的web应用程序，“非常快”，安全，SEO优化等。使用React。</p><p id="eeed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些好处中的大部分是无法避免的，因为它们是盖茨比工作方式的一部分，然而我仍然设法提供了一个不符合盖茨比标准的用户体验。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5b7a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">错误</h1><p id="af4e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">其中一个<a class="ae ky" href="https://cpv123.netlify.com/coffee/" rel="noopener ugc nofollow" target="_blank">网站页面</a>显示了一个咖啡店列表(大部分非常好)，其数据来自我的一个外部REST API。</p><p id="7684" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在获取这些数据时，我进入了自动驾驶模式，并在安装后的组件中这样做，然后将它存储在状态中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个熟悉的模式，但不总是正确的。</p></figure><p id="ba8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这工作得非常好，这就是Gatsby所说的“客户端运行时数据获取”</p><p id="ad2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是有了Gatsby，就有了另一种获取数据的方法:<em class="nb">构建时数据获取</em>。</p><p id="1e92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是在站点构建过程中(通常在部署过程中)获取数据的地方，然后作为静态数据保留下来，供站点启动并运行后使用。</p><p id="913c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每种方法都有一些明显的优点和缺点。</p><h2 id="7f95" class="nc md it bd me nd ne dn mi nf ng dp mm li nh ni mo lm nj nk mq lq nl nm ms nn bi translated"><strong class="ak">客户端运行时</strong></h2><ul class=""><li id="4d8a" class="no np it lb b lc mu lf mv li nq lm nr lq ns lu nt nu nv nw bi translated">优点:提取的数据将总是最新的。</li><li id="4de9" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">缺点:用户体验依赖于外部因素，如互联网连接和API的性能。</li></ul><p id="5006" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，这仅用于获取频繁更改的数据。</p><h2 id="8960" class="nc md it bd me nd ne dn mi nf ng dp mm li nh ni mo lm nj nk mq lq nl nm ms nn bi translated"><strong class="ak">构建时间</strong></h2><ul class=""><li id="5274" class="no np it lb b lc mu lf mv li nq lm nr lq ns lu nt nu nv nw bi translated">优点:数据随时可用，因此用户体验将保持快速。</li><li id="3d2e" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">缺点:数据可能已经过时了——它将是网站最后一次构建和部署时的数据。</li></ul><p id="26b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，对于不经常更改的数据，请使用此选项。</p><p id="3c50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我犯的错误是使用客户端运行时抓取，而我的网站实际上是构建时抓取更优越的完美例子——当数据不经常改变时。</p><p id="9684" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，这是事实，因为我每周只能去一两家新的咖啡店。</p><p id="7914" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，切换到构建时获取提供了更好的用户体验(更少甚至没有可见的加载时间),并且显示过时商店列表的可能性非常低——如果我记得每周构建和部署一次站点，这种可能性为零。</p><h2 id="3d0d" class="nc md it bd me nd ne dn mi nf ng dp mm li nh ni mo lm nj nk mq lq nl nm ms nn bi translated">附注:我改变数据获取方法的真正原因</h2><p id="155b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">老实说，让我改变的并不是稍差的用户体验(因为我是唯一的用户)，而是意识到客户端运行时获取增加了从AWS收到账单的机会。</p><p id="c227" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">咖啡店API由AWS API Gateway提供服务，由Lambda函数提供支持，这意味着如果该网站在一夜之间引起了互联网轰动，该API将开始接收大量请求——每次有人加载页面时都会收到一个请求。</p><p id="a494" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">切换到构建时意味着每次构建只调用一次API，不管站点接收到多少流量。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8734" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">从运行时到构建时数据提取</h1><p id="6eab" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">从客户端运行时切换到构建时获取被证明是非常简单的，正如这个<a class="ae ky" href="https://github.com/cpv123/my-site/commit/8eccda2cbb5479c659bc6bf6e60fb239f1cf1600" rel="noopener ugc nofollow" target="_blank">一个小提交</a>所证明的。</p><p id="e60e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">神奇的事情发生在站点构建过程中运行的<code class="fe oc od oe of b">gatsby-node.js</code>文件中。</p><p id="4366" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我所要做的就是将现有的数据获取函数移到这里，然后使用Gatsby的<code class="fe oc od oe of b">onCreatePage</code>函数创建一个新的“咖啡店”页面，该页面可以访问这些数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="c285" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在页面创建后，每个页面都会调用<code class="fe oc od oe of b">onCreatePage</code>函数，在页面最终完成之前，可以用它来修改页面。</p><p id="e2f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，该函数用于操作“咖啡店”页面，以便通过props访问其上下文中的咖啡店数据。</p><p id="bea0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为这个“咖啡店”页面是由Gatsby 自动创建的<a class="ae ky" href="https://www.gatsbyjs.org/docs/creating-and-modifying-pages/" rel="noopener ugc nofollow" target="_blank">，所以只能先删除页面，然后用咖啡店的上下文重新创建。</a></p><p id="34c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">组件(咖啡店页面)现在可以通过<code class="fe oc od oe of b">props.pageContext.coffeeShops</code>立即访问咖啡店列表——不需要加载状态、错误状态或等待组件安装，数据就在那里。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a172" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">摘要</h1><p id="e65b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当使用Gatsby时，不要因为它支持许多相同的工作方式就把它当成一个创建-反应-应用程序。</p><p id="ac88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，Gatsby提供了更多的东西，可以帮助您提供更好的用户体验，甚至为您节省一些资金。</p></div></div>    
</body>
</html>