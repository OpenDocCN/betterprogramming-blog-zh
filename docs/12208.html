<html>
<head>
<title>Building a Simple Blockchain Oracle With Solidity and Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Solidity和Node.js搭建一个简单的区块链Oracle</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-a-simple-blockchain-oracle-with-solidity-and-node-js-29eacdad31f1?source=collection_archive---------3-----------------------#2022-05-19">https://betterprogramming.pub/building-a-simple-blockchain-oracle-with-solidity-and-node-js-29eacdad31f1?source=collection_archive---------3-----------------------#2022-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="62a3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过使用solidity和node.js构建一个简单的天气预报，了解区块链oracle如何将web 2.0数据引入web 3.0</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5ee41ee9286a59a3e8559e0c209d92cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*e88tiplts_M2udsc"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@tezos?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">泰佐斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="5d0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://chain.link/education/blockchain-oracles" rel="noopener ugc nofollow" target="_blank">区块链上的甲骨文</a>是允许区块链世界与网络其余部分的数据接口的框架，我们称之为web 2.0世界。随着智能合约应用的不断扩展，处理独特用例所需的数据种类也将不断增加。</p><p id="ff17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实是，web 2.0和web 3.0是两个不同的网络，目前大多数有用的数据都存储在web 2.0上。通过创建一套协议使智能合约能够访问这些数据，新一代的网络、系统设计和区块链将会出现。在我的上一篇文章中，我大致写了这个问题:</p><div class="lv lw gp gr lx ly"><a rel="noopener  ugc nofollow" target="_blank" href="/a-web-2-0-developers-guide-to-web-3-0-18447da4325d"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">Web 3.0的Web 2.0开发者指南</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">了解区块链和Web 3.0如何塑造后端软件开发的下一个迭代</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">better编程. pub</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="c716" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当前的协议已经倾向于oracle的概念来构建混合系统，这些系统依赖于智能合约和链外API来桥接web 2.0数据以及其他区块链。最突出的oracle是<a class="ae ky" href="https://www.investopedia.com/chainlink-link-definition-5217559" rel="noopener ugc nofollow" target="_blank"> Chainlink </a>，它提供定价数据、到其他区块链的连接、对大多数API的访问，以及各种其他数据源。</p><p id="e8a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其他主要的例子包括令牌桥，它允许在链外服务的帮助下在链之间移动令牌和数据。随着时间的推移，更多独特的神谕可能会出现。</p><p id="6c37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前，像<a class="ae ky" href="https://singularitynet.io/aboutus/" rel="noopener ugc nofollow" target="_blank"> Singularity NET </a>这样的组织正在致力于构建神谕，这些神谕可以创建市场，并方便地访问提供服务的API，比如这个具体例子中的人工智能推理。<br/> <br/>在本文中，我的目标是通过浏览当前用例的一般架构，并使用solidity和node.js构建一个简单的链上天气oracle来给出oracle概念的一般定义，以进一步形象化该协议如何工作。</p><h1 id="639b" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">事件驱动的Oracle设计</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/d4da201e47704f3cf761220bc1bd03f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-uwGXtN0oHQJWAhID3xZeA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://www.kaleido.io/blockchain-blog/how-chainlink-works-under-the-covers" rel="noopener ugc nofollow" target="_blank">https://www . kaleido . io/区块链-blog/how-chain link-works-under-covers</a></p></figure><p id="c144" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当处理使用链外服务来代表智能合约执行某些操作的问题时，要记住的最重要的事情是，在智能合约和服务之间没有正式的消息传递过程。根据这一假设，我们知道智能契约不能“推送”，因此服务必须侦听、观察或拉取。</p><p id="f329" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只有两个链上项目是服务能够观察的，状态变量和事件。观察状态变量很麻烦，因为它需要与契约进行许多交互。另一方面，事件不需要直接交互。<br/> <br/>智能合约事件是这样发出的:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="c98f" class="nl mo it nh b gy nm nn l no np">emit newEvent(block.timestamp)</span></pre><p id="2ca5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个事件可以被看作是由开发人员定义的智能合约操作的日志。就像其他类型的日志一样，其他服务可以订阅这个提要来观察特定类型的事件，从它们的参数中收集数据，并对它们做任何想做的事情。任何有权访问区块链的人都可以看到这些日志，并且可以通过web3.js. <br/> <br/>这样的库进行访问。鉴于这种独特的通信系统，智能合同可以廉价地“通知”外部世界的服务事件，或者在oracle案例中需要完成的作业。理解事件和链上链下消息传递是oracle设计中最重要的部分。</p><p id="1724" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦服务发现了一个新事件，触发了它的动作，它就可以获取事件中有价值的数据和一个惟一的作业id，并像任何其他程序一样执行离线动作。</p><p id="a84d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦任务完成，服务可以使用web3库来处理合同。典型的事务可以“上传”带有作业id的请求/事件的结果，因此智能契约可以继续处理它计划对这些离线数据做的任何事情。将所有这些放在一起看起来像这样:</p><p id="d0dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.Oracle smart contract发出一个事件，其中包含有关作业的信息。</p><p id="596c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.离线oracle服务监听事件，并在事件被触发时提取信息。</p><p id="22f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.离线oracle与任何服务或数据交互以接收结果。<br/> <br/> 4。oracle与oracle smart contract进行离线交易，以更新作业数据。</p><p id="3073" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.智能合约生态系统将数据用于任何需要它的地方。</p><p id="25a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，这是对oracle设计的过度简化，如Chainlink，它包括许多节点和共识协议，以确保oracle数据是分散的。虽然有趣且重要，但简单的理解将是构建该概念的最佳背景。</p><h1 id="2f27" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">构建简单的Oracle</h1><p id="6357" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">为了形象化oracle的概念，我们可以构建一个简单的单一服务、单一节点oracle，让这个概念不那么令人生畏。</p><p id="c573" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我选择了像天气这样的服务，因为输入数据很容易传输，而且API非常丰富。考虑到我们对事件驱动的oracle的理解，我们的系统设计应该是这样的</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/be21e719aa05147870d4f478c44d2474.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Whchd9Q7akuws0DtWTre8Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">天气预报系统图</p></figure><p id="9a0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们有一个solidity契约和一个node.js程序，因此该设计的要求很简单:</p><ol class=""><li id="bf4b" class="nw nx it lb b lc ld lf lg li ny lm nz lq oa lu ob oc od oe bi translated">可靠智能合同</li><li id="711a" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated">节点. js</li><li id="9800" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated">Web3.js</li><li id="b735" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated">一个天气API(使用<a class="ae ky" href="https://openweathermap.org/current" rel="noopener ugc nofollow" target="_blank"> OpenWeather </a>)</li></ol><p id="b4a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们可以进入智能合同:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="39c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经一行一行地提供了更详细的行内注释，但是总结一下我们的合同是使用几个映射来保存<code class="fe om on oo nh b">jobIds(true = complete, false = incomplete)</code>的状态和作业的结果。</p><p id="bcb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">契约提供了一个函数来触发作业<code class="fe om on oo nh b">getWeather</code>，它将位置数据作为参数，创建一个作业id，并发出一个包含相关位置和作业信息的事件。</p><p id="a10b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个oracle的一个重要特性是updateWeather函数上的操作符修饰符。如果只允许服务与此函数交互，则需要此修饰符，否则任何人都可以更新作业数据。<br/> <br/>现在我们有了区块链oracle合同，可以在node.js中构建一个离线数据提供程序，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="cd01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了注释中的细节，总结一下node.js服务，web3提供者被设置为使用我们的网络正在使用的任何URL提供者。注意，交互的钱包地址必须是一个操作者，我们必须确保我们的web3提供者包括该帐户。<br/> <br/>使用我们订阅的web3库收听事件。对于新事件，代码使用内置的API接口和事件参数来获取我们请求的天气数据。</p><p id="50e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据该调用的结果，<code class="fe om on oo nh b">web3</code>库通过我们的contracts abi调用<code class="fe om on oo nh b">updateWeather</code>函数，将结果上传到合同。一旦成功，初始设计要求都已满足，智能合同可以访问该作业的结果，以满足任何需要。虽然这是一个简单的例子，但它可能会让你感觉到如何为独特的用例构建简单的链外接口。</p><h1 id="f5b0" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">结论</h1><p id="47dd" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">总之，区块链甲骨文公司准备向web 2.0数据源开放web 3.0世界。这反过来允许web 3.0开始实现更多的优势。事件驱动的oracle设计创建了一个将智能合约功能与传统软件工程技术相结合的框架。</p><p id="5e4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着这一概念的扩展，一个完整的生态系统可能会出现，允许最平滑的数据访问网络，因为solidity使与其他智能合约(未来的API)的交互变得非常简单。</p><p id="2847" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对这个生态系统做出贡献可能会有很大的机会，从一个像天气这样简单的应用程序开始是深入探索并发现新事物的第一步</p></div><div class="ab cl op oq hx or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="16c4" class="nl mo it nh b gy nm nn l no np"><strong class="nh iu">Want to Connect?</strong></span><span id="7732" class="nl mo it nh b gy ow nn l no np">Connect with me on <a class="ae ky" href="https://www.linkedin.com/in/ian-rowan/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a> to share ideas and opportunities!</span></pre><h1 id="4125" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">资源</h1><p id="416b" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">[1]<a class="ae ky" href="https://chain.link/education/blockchain-oracles" rel="noopener ugc nofollow" target="_blank">https://chain.link/education/blockchain-oracles</a></p><p id="a62d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2]<a class="ae ky" href="https://medium.com/better-programming/a-web-2-0-developers-guide-to-web-3-0-18447da4325d" rel="noopener">https://medium . com/better-programming/a-we b-2-0-developers-guide-to-we b-3-0-18447 da 4325d</a></p><p id="8acc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[3]<a class="ae ky" href="https://www.investopedia.com/chainlink-link-definition-5217559" rel="noopener ugc nofollow" target="_blank">https://www . investopedia . com/chain link-link-definition-5217559</a></p><p id="8d1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[4]<a class="ae ky" href="https://www.kaleido.io/blockchain-blog/how-chainlink-works-under-the-covers" rel="noopener ugc nofollow" target="_blank">https://www . kaleido . io/区块链-blog/how-chain link-works-under-the-covers</a></p><p id="45cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[5]<a class="ae ky" href="https://openweathermap.org/current" rel="noopener ugc nofollow" target="_blank">https://openweathermap.org/current</a></p></div></div>    
</body>
</html>