<html>
<head>
<title>AWS: Creating a VPC With an Auto-scaling Group Using T2.micro Instances</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS:使用T2.micro实例创建带有自动缩放组的VPC</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/aws-creating-a-vpc-with-an-auto-scaling-group-using-t2-micro-instances-4ac2c5c7795b?source=collection_archive---------4-----------------------#2022-04-09">https://betterprogramming.pub/aws-creating-a-vpc-with-an-auto-scaling-group-using-t2-micro-instances-4ac2c5c7795b?source=collection_archive---------4-----------------------#2022-04-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0e11" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">维护自我修复架构</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/e7434d49364d493254a3aa33ae07358f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*_71UtrkrwoceUTRlNwa7Ow.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr">Credit</strong>:<a class="ae ks" href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/as-register-lbs-with-asg.html" rel="noopener ugc nofollow" target="_blank">AWS Auto Scaling</a>[*注意:尽管该图描述了应用程序负载平衡器的使用，但本练习不会使用负载平衡器，而是侧重于实例的CPU压力。]</p></figure><p id="36bb" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">在本演练中，我们将讨论AWS ( <em class="lp"> Amazon Web Services </em>)中的VPCs架构，以及在EC2中使用自动伸缩组来帮助维护自修复架构。</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="8076" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated"><strong class="ak"> <em class="mp">目标</em> </strong></h1><ol class=""><li id="9b4e" class="mq mr iq kv b kw ms kz mt lc mu lg mv lk mw lo mx my mz na bi translated">使用CIDR 10.10.0.0/16创建自定义VPC</li><li id="2f93" class="mq mr iq kv b kw nb kz nc lc nd lg ne lk nf lo mx my mz na bi translated">在EC2中，创建启动配置，以便定义包含自定义VPC的启动规范——每个实例还需要安装Apache webserver，该服务器能够检查随机IP地址并生成测试页面</li><li id="4f62" class="mq mr iq kv b kw nb kz nc lc nd lg ne lk nf lo mx my mz na bi translated">在EC2中，为实例配置一个自动缩放组，最小实例数为2，最大实例数为5。在CPU利用率超过80%后，扩展策略将使用CloudWatch进行扩展</li><li id="18d6" class="mq mr iq kv b kw nb kz nc lc nd lg ne lk nf lo mx my mz na bi translated">创建自动扩展组后，将使用压力工具对CPU利用率超过80%的实例进行压力测试，以确保上述扩展策略有效。</li></ol></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><blockquote class="ng nh ni"><p id="1c3d" class="kt ku lp kv b kw kx jr ky kz la ju lb nj ld le lf nk lh li lj nl ll lm ln lo ij bi translated"><strong class="kv ir"> <em class="iq">注意:</em> </strong> <em class="iq"> </em>出于本练习的目的，我还使用了新的AWS管理控制台。我将配置一个自定义的VPC，而不是使用AWS创建的默认。我的地区设置为<em class="iq">美国东部-1 </em>。</p></blockquote></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h2 id="0f87" class="nm ly iq bd lz nn no dn md np nq dp mh lc nr ns mj lg nt nu ml lk nv nw mn nx bi translated">用<em class="mp"> 10.10.0.0/16 </em>的<strong class="ak"> CIDR </strong>创建自定义<strong class="ak"> VPC </strong></h2><ol class=""><li id="cdcf" class="mq mr iq kv b kw ms kz mt lc mu lg mv lk mw lo mx my mz na bi translated">从AWS管理控制台，使用搜索栏导航到VPC。<em class="lp">在此页面中，您可以从控制面板选项中配置VPC和所有网络设置，或者使用启动向导引导您一次性完成所有设置的创建。</em></li><li id="c7a9" class="mq mr iq kv b kw nb kz nc lc nd lg ne lk nf lo mx my mz na bi translated">使用启动向导:选择VPC、子网等。，命名VPC，并确保CIDR设置为<em class="lp"> 10.10.0.0/16。</em>保留所有其他默认设置，并点击<em class="lp">创建VPC。</em></li></ol><div class="kg kh ki kj gt ab cb"><figure class="ny kk nz oa ob oc od paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><img src="../Images/6781d0d0ee32c17b077628af67276e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*MHgZp2Jf2o9Yngiss70s7A.png"/></div></figure><figure class="ny kk oi oa ob oc od paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><img src="../Images/a459beb23857d14bf8872dbe1ce145d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:596/format:webp/1*d7CrjJxKXTIuhkyxD_MKwg.png"/></div></figure><figure class="ny kk oj oa ob oc od paragraph-image"><img src="../Images/6dee09f6006d6e8aad3a735ab223b77b.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*Uu2RsoDGaKWtlZt2TaeEVg.png"/><p class="kn ko gj gh gi kp kq bd b be z dk ok di ol om translated">VPC设置</p></figure></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi on"><img src="../Images/fbf803b712e6a2fa0c468265575ab579.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SExjvOIx20hmtfOJH_WPzg.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">配置设置时自动创建VPC建筑的预览</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi oo"><img src="../Images/3909e62a80f18d2b86c0115969661b98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4WucMJBeKN5l8eB0MqJRdQ.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">将使用所有必需的组件和id创建VPC。观看VPC也能让你看到这一点。</p></figure></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h2 id="659d" class="nm ly iq bd lz nn no dn md np nq dp mh lc nr ns mj lg nt nu ml lk nv nw mn nx bi translated">安装Apache时的EC2和启动配置</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/cfb4481939377735004b03e25dcfa92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*eqINFdEdX2qwxqTPOEDXsA.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">AWS EC2和Apache Webserver</p></figure><ol class=""><li id="ffec" class="mq mr iq kv b kw kx kz la lc oq lg or lk os lo mx my mz na bi translated">从AWS管理控制台，使用搜索栏导航到EC2。在仪表板中，向下滚动到实例，然后选择启动模板。</li><li id="a448" class="mq mr iq kv b kw nb kz nc lc nd lg ne lk nf lo mx my mz na bi translated">为模板的每个部分包括以下设置:</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/407ba4557f3fd87f1f281f5b467dc53a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*zRUdqQYCztNaLJxZ2Tb57g.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">创建一个<strong class="bd kr">启动模板name | </strong> check " <strong class="bd kr">提供指导，帮助我设置一个可以与EC2自动缩放</strong>一起使用的模板</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/1c54a85c7698749118bdfe9d38963f3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*u5nrKov_XGJtrtMFakuwNA.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr"> AMI </strong> —选择<strong class="bd kr">亚马逊Linux 2 </strong>(从<em class="mp">目录</em>或使用<em class="mp">最近</em> ) | <strong class="bd kr">实例类型</strong> →t2.micro ( <em class="mp">自由层</em>)</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/1530a97d4b5f060893e92267f1729e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*gjkVTQK_YOvOUM-puRoVrw.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr">密钥对(登录)</strong> →创建<strong class="bd kr">新的密钥对</strong> <em class="mp">或</em>选择<strong class="bd kr">现有的密钥对</strong></p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/384595cd51c339707079d72caa5a4e88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*8mGelQnZ2o_Tqb4HrQfx5Q.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr">网络设置</strong> →创建安全组(这样我们可以附加新创建的VPC)</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi ov"><img src="../Images/34d0d1ae4d121924e627076324671779.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rwla79wOs_1CVlywGW6NBw.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr">安全组规则</strong>:在现实场景中，我不会允许所有的IP地址访问，但是出于这个练习的目的，我不会限制访问。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi ow"><img src="../Images/e036b1aec474b5d45afb429abb572ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H0Zze6G3KTMTHLM_KBtXRw.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr">高级网络配置</strong> →选择<strong class="bd kr">Enable</strong><strong class="bd kr">自动分配公共IP </strong>以允许我们稍后在浏览器中查看实例的Apache测试页面。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/b33c8464918c4542542ac0ca0140499c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*_X1FmDg7l1onkvOvqU9Zyw.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr">高级详情:</strong>选择<strong class="bd kr">启用</strong>进行详细的CloudWatch监控</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/d49286ff043e8e38f728157a20f8553c.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*gPhzyYJJ-zs1yFzI6dXtaA.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr">高级细节</strong> → <strong class="bd kr">用户数据</strong> —包括将更新软件包、安装Apache的引导程序，还包括我们将使用的压力工具。</p></figure><pre class="kg kh ki kj gt oz pa pb pc aw pd bi"><span id="fb78" class="nm ly iq pa b gy pe pf l pg ph">#!/bin/bash<br/>yum update -y<br/>yum install httpd -y<br/>systemctl start httpd<br/>systemctl enable httpd<br/>amazon-linux-extras install epel -y<br/>yum install stress -y</span></pre><p id="ba7e" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">3.配置完所有设置后，单击“启动模板”。在下一个屏幕中，您应该能够选择“从您的模板创建自动缩放组”选项。</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h2 id="c13a" class="nm ly iq bd lz nn no dn md np nq dp mh lc nr ns mj lg nt nu ml lk nv nw mn nx bi translated"><strong class="ak">创建自动缩放组</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/14ef009e8c883ab0d98c6bc73ab91060.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*e0yKwyEpqrWW1_ELRxrAwg.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">信用:<a class="ae ks" href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/what-is-amazon-ec2-auto-scaling.html" rel="noopener ugc nofollow" target="_blank"> AWS文档—亚马逊EC2自动缩放用户指南</a></p></figure><ol class=""><li id="c887" class="mq mr iq kv b kw kx kz la lc oq lg or lk os lo mx my mz na bi translated">单击“从您的模板创建自动缩放组”后，按照下面列出的规范完成步骤1-7。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi pj"><img src="../Images/df7d320961d3c8a3a0082b6a70e20cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F_5bPCh1wSrZrfJW_S0kEg.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr">第一步</strong>:创建<strong class="bd kr">自动缩放组名称</strong>，选择前面创建的<strong class="bd kr">启动模板</strong></p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi pk"><img src="../Images/381ff1dfb8ae2f9ae5b9acb2e45febe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-NtpHXJp0nW5XSgnpTY5w.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr">步骤2 </strong> : <strong class="bd kr">网络</strong> →选择在第一部分中创建的VPC，仅选择公共子网以允许实例能够显示Apache测试页面。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi pl"><img src="../Images/b91664a9784959a6bf996019d910607d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0s42IF1rVWLkPJysj5Pmvg.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr">第4步</strong> - <strong class="bd kr">第1部分</strong>:由于本练习指定了2的<strong class="bd kr">最小容量</strong>和5的<strong class="bd kr">最大容量</strong>，我选择了2的<strong class="bd kr">期望容量</strong>进行测试。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi pm"><img src="../Images/0ed9effb5ff13adb9b3347351dd55346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZPSrIevS0t1hYtbTr5KPtQ.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr">第四步</strong> — <strong class="bd kr">第二部分</strong>:添加(和名字！)一个<strong class="bd kr">目标跟踪缩放策略</strong>，能够指定将由自动缩放组使用的指标。对于本练习，指标包括一个80的<strong class="bd kr">目标值</strong>，如果超过<strong class="bd kr"> CPU利用率</strong>，将允许创建更多实例。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi pn"><img src="../Images/d9eb9ac7769d1b2700dd56e2ab01ad33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u4HDlACYahPpRltpN6UUIw.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">自动缩放组已成功创建</p></figure></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h2 id="9ac7" class="nm ly iq bd lz nn no dn md np nq dp mh lc nr ns mj lg nt nu ml lk nv nw mn nx bi translated">确认自动缩放组的成功并使用压力工具</h2><ol class=""><li id="4a00" class="mq mr iq kv b kw ms kz mt lc mu lg mv lk mw lo mx my mz na bi translated">确认Apache已经安装在每个实例上:启动自动伸缩组几分钟后，实例将开始初始化和启动。实例运行并通过两种状态检查后，选择实例id以查看详细信息并复制公共ip。在浏览器的搜索栏中，键入<code class="fe po pp pq pa b">http://&lt;public_ip&gt;</code>并点击“回车”。如果您到达Apache测试页面，那么从引导安装是成功的。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi pr"><img src="../Images/03c30bced7e07b2a5d04554ab369865c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bu6pEk-Np89oiy43KvqYqA.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Apache测试页面</p></figure><p id="cd97" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">2.从AWS管理控制台，使用搜索栏导航到CloudWatch。因为我们在流程的早期检查了选项以跟踪CloudWatch中的CPU利用率指标，所以应该已经为CloudWatch仪表板中的Auto Scaling组创建了警报。</p><p id="8e94" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">3.要运行我们引导到自动缩放组实例中的压力工具，打开终端，使用<code class="fe po pp pq pa b">$ cd &lt;name_of_directory&gt;</code>更改目录以确保您与keypair在同一个目录中。pem文件。如有必要，使用命令<code class="fe po pp pq pa b">$chmod 400 &lt;<em class="lp">nameofkeypair</em>&gt;.pem</code>来保护它不被看到。然后，使用以下代码登录到正在运行的EC2实例之一:</p><pre class="kg kh ki kj gt oz pa pb pc aw pd bi"><span id="e17b" class="nm ly iq pa b gy pe pf l pg ph">$ ssh -i "&lt;<em class="lp">nameofkeypair</em>&gt;.pem" ec2-user@&lt;<em class="lp">public_ip_of_instance</em>&gt;</span><span id="cadd" class="nm ly iq pa b gy ps pf l pg ph">$ sudo stress --cpu 1 --timeout 300</span></pre><ul class=""><li id="52fa" class="mq mr iq kv b kw kx kz la lc oq lg or lk os lo pt my mz na bi translated">由于我的实例将需要60秒来预热(如Auto Scaling组中所配置的)，压力工具将需要对CPU施加足够的压力，以达到最大限度并触发目标跟踪策略中配置的CloudWatch警报。<code class="fe po pp pq pa b">--timeout</code>值代表压力测试的长度。压力测试将结束并产生以下结果:</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi pu"><img src="../Images/811530000220e9b72836c184610d80fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TmgZaPf0sXjXWvlOpeE5OA.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">在本地终端中，压力工具将对我选择的实例施加300秒(5分钟)的压力，允许<strong class="bd kr"> CloudWatch </strong>跟踪指定的指标(<strong class="bd kr"> CPU利用率</strong>)。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi pv"><img src="../Images/8d4432766fffc4d98b238c453eb5572c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hUsC6VUQjNnVwiD0c2kmYg.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><strong class="bd kr">cloud watch</strong>→<strong class="bd kr">Widget</strong>带有<strong class="bd kr"> CPU利用率</strong>指标集，跟踪5分钟内的最大值。压力测试得出<strong class="bd kr"> 100%的CPU利用率</strong>，这意味着压力测试是成功的。(这可以在<strong class="bd kr"> CloudWatch </strong>中查看，或者在<strong class="bd kr"> EC2 </strong>中选择一个正在运行的实例时查看)。</p></figure><p id="b44e" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">**我花了很多时间用不同的值调整压力测试，看看CloudWatch是如何调整图形的。出于同样的目的，我还试验了用于监控的值。在练习的这个阶段，了解这些调整如何影响结果是很有帮助的。</p></div></div>    
</body>
</html>