<html>
<head>
<title>Product Nirvana: Continous Deployment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">产品天堂:持续部署</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/product-nirvana-continous-deployment-3a5763768cf8?source=collection_archive---------15-----------------------#2020-07-07">https://betterprogramming.pub/product-nirvana-continous-deployment-3a5763768cf8?source=collection_archive---------15-----------------------#2020-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6c50" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你真的应该在每次合并时部署你的应用吗？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/db2861f4112917bba3e86bcbe33c9a5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AJ9HQHND7VPACSYZ8sY3Iw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">鲁本·华雷斯在<a class="ae ky" href="/s/photos/continue?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="45f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">似乎持续部署是所有DevOps团队的目标。每一次合并到master都应该直接送到客户手中。代码应该经过大量的冒烟测试、单元测试和集成测试，通过测试环境，然后用一个神奇的管道发布出去。</p><p id="7822" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在GameChanger，这就是我们的后端。在每次推送Git时，我们都有一套针对代码运行的测试，以测试其部署的可行性。我们在CI服务器上编译和运行应用程序。然后，如果代码被同行认可并通过了所有的测试，你就可以点击绿色的大按钮:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/d27db79a38b71c08010d2835e128ed94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SBpecN81f5UXh9lHhxgGdA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">很满足。但这真的是你想要的吗？</p></figure><p id="9f00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在另一个自动部署过程之后，客户实际上开始使用你的代码<em class="lw">。</em>仔细想想还是蛮野的。</p><p id="2669" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你与十年前的开发人员交谈，持续部署只适用于拥有庞大、专注的开发团队的大型公司。现在，只需一些专门的人员和工具，如GitLab、Docker和Jenkins，您就可以让整个部署流程自动化。工具已经走过了漫长的道路。看看<a class="ae ky" href="https://medium.com/the-telegraph-engineering/android-continuous-delivery-fb41da63176" rel="noopener">这篇关于为你的Android应用程序设置CD的文章</a>。</p><p id="8a20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">工具本身非常酷——这是不可否认的。但是正如发展中的许多事情一样，<strong class="lb iu"> </strong>仅仅因为你<em class="lw">能</em>做某事并不意味着你<em class="lw">应该</em>。</p><p id="d610" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，持续部署适合您吗？这是好的，坏的，破碎的。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="dcc0" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">好人</h1><h2 id="5879" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">停止决定何时释放</h2><p id="77e4" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">你参加过关于何时发布代码的会议吗？他们太可怕了。</p><ul class=""><li id="75e1" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">"我们应该等待下一个特性加入这个版本吗？"</li><li id="0abe" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">“这是一个大发布…我们需要更多的测试吗？”</li><li id="c64f" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">“乔不是在圣帕特里克节不穿绿色吗？我对他写的代码感到紧张。”</li></ul><p id="6f2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些都是非常令人讨厌的观点，尤其是当你把这些问题带给那些构建和测试产品的人的时候。</p><p id="cf7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“是的，它准备好了，”<em class="lw"> </em>我们说。事实上，我们来证明一下。让我们停止这些愚蠢的会议，当我们，产品团队，说它准备好了，它就准备好了，它就要给客户了。</p><p id="1d97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">产品经理和商业利益相关者可能会有点动摇，但是如果你真的信任你的工程团队(你应该信任，或者你应该找一个新的)，你永远都不需要考虑什么时候再部署。</p><h2 id="9cec" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">开始快速释放</h2><p id="826c" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">现在，您可以快速部署。想象一下，如果有一个全球性的疫情影响到我们生活的方方面面，请和我一起呆在这里。它改变了许多公司的进程，改变了你的公司需要做的事情。</p><p id="ff52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了生存和保持业务的相关性，你必须发布社交远程约会API。有点拗口，但却是有用的产品，而且可能是非常有利可图的产品。</p><p id="c826" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了持续部署，你就不用找人坐下来经历一个艰苦的部署过程了。你只需点击绿色按钮，并开始寻找那些相距6英尺的匹配(这听起来比它需要的更令人毛骨悚然)。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="80ef" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">坏事</h1><h2 id="bcd1" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">你的测试和同行评审的好坏决定了你的水平</h2><p id="7fc7" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">现在，仅仅因为您有了所有这些测试、检查和代码审查，您的代码仍然可能无法按预期工作。</p><p id="df2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我在持续部署的后端上写的第一件事就是一个新的端点。我把<code class="fe ob oc od oe b">authentication</code>和<code class="fe ob oc od oe b">authorization</code>搞混了，部署了一个没有认证配置的端点。端点不需要<code class="fe ob oc od oe b">authorization</code>(您需要什么用户角色来访问这个端点？)，但它确实需要<code class="fe ob oc od oe b">authentication</code>(这个端点调用来自合法来源吗？).</p><p id="85e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它通过了测试，通过了代码审查，并被部署。直到几天后，我才意识到自己的错误，并回去将身份验证添加到端点。但是有几天，任何人——实际上是任何有浏览器或<code class="fe ob oc od oe b">curl</code>的人——都可以访问那个端点，从我们的后端获取合法数据。挺吓人的。也许我们应该在我们的CI中建立一个检查…</p><p id="fbb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，如果你写了新的代码，但是没有用它写新的测试，你的CI怎么能测试它呢？代码不能像为客户设计的那样运行，但仍然通过了测试。</p><p id="5744" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">长话短说，三个复选标记并不意味着你的代码可以工作，甚至在逻辑上是正确的。你还是要小心。</p><h2 id="e4f8" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">如果你的代码对人的生命负责呢？</h2><p id="4d0b" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">猎鹰9号的代码应该因为一名实习生在SpaceX按下绿色按钮而在发射中途改变吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/5e1ddb5337228ff26834c83750383102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3nO7mpdJqQGrryhBF4QyRg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面有代码和人。照片来自SpaceX via <a class="ae ky" href="https://www.theverge.com/2018/5/24/17388680/spacex-falcon-9-rocket-block-5-commercial-crew-nasa-copv]" rel="noopener ugc nofollow" target="_blank"> The Verge </a>。</p></figure></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="e9b9" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">破碎者</h1><p id="f35e" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">但是持续部署真正闪光的地方是当狗屎击中风扇的时候。如果你曾经做过网站可靠性或者随叫随到，那么可能发生的最糟糕的事情之一就是修复了一个问题，但是却不能让用户得到修复。您找到了让客户恢复工作状态的根本原因或解决方法，但是修复程序必须留在您的本地机器上，因为您不知道如何快速将修复程序提供给客户。</p><p id="90f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着持续部署，只需点击绿色按钮！在我们公司，如果您现在真的需要在您的客户手中进行修复，您甚至可以绕过我们的许多测试和检查。这就是修补程序的定义，它已经挽救了我公司的许多事故。</p><p id="4b75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是GameChanger也有客户端应用，也就是我们的iOS和Android应用。我们不会持续部署这些应用，因为它们必须通过各自的应用商店。它们需要人工审查，而且周转时间很长。</p><p id="8ee8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着当用户发现一个边缘案例或bug时，我们就有点麻烦了。我们通常可以快速修复这些问题，但实际上直到一周左右之后我们才能为这些用户提供修复。告诉客户他们需要等待才能做他们想做的事情是非常令人沮丧的。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="a09f" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">但我要我的代码现在就部署！</h1><p id="4a1e" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">好的，那么您应该持续部署您的后端吗？</p><p id="6b12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不知道…大概吧？人们似乎喜欢它。我仍然夜不能寐，担心是否有人意外部署了不工作的东西，而我们的监控或检查没有发现它。但是，无论如何，批量部署可能会发生这种情况…</p><p id="7005" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还担心，由于代码部署的周转时间很短，而且代码部署如此频繁，这是否意味着团队对我们现在正在做的事情思考得更少，因为我们可以“稍后再部署一个修补程序”？</p><p id="a1d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是就像工程中的所有事情一样，为你的项目权衡利弊。权衡构建和维护CD管道的成本，权衡CD是否适合您的应用程序的利弊。</p><p id="42da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只是不要随意部署。感谢阅读！</p></div></div>    
</body>
</html>