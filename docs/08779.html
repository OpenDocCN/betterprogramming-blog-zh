<html>
<head>
<title>Getting Started With the Combine Framework in 2021</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2021年开始使用联合框架</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-the-combine-framework-in-2021-e8c1bfb9db1a?source=collection_archive---------6-----------------------#2021-06-10">https://betterprogramming.pub/getting-started-with-the-combine-framework-in-2021-e8c1bfb9db1a?source=collection_archive---------6-----------------------#2021-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5f42" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在生产代码中使用Combine需要知道的一切</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c821ea884a72198f8ff3c596aa7963b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vFHl1oYU172x7BIL4T1naQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">约书亚·雷德科普在<a class="ae kv" href="https://unsplash.com/s/photos/coding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6a94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">苹果在2019年推出与iOS 13结合的框架已经有一段时间了，但我最近才决定学习它，因为现在大多数活跃的iOS设备都运行iOS 13。互联网上有大量的资源(免费或付费，阅读或代码),讨论各个级别的联合收割机。然而，我花了许多个晚上在浏览了无数篇文章后感到困惑，然后才感到有足够的信心在我当前项目的生产代码中编写我的第一个<code class="fe ls lt lu lv b">import Combine</code>。</p><p id="bb50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你在花时间学习了联合收割机之后有同样的感觉，这篇文章是为你准备的。</p><p id="6b06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lw">本文仅介绍联合收割机的基础知识。例如，创建自定义</em><code class="fe ls lt lu lv b"><em class="lw">Publishers</em></code><em class="lw"/><code class="fe ls lt lu lv b"><em class="lw">Subscribers</em></code><em class="lw">等复杂用法将在单独的文章中介绍。</em></p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="cbbc" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">联合收割机的主要参与者</h1><p id="7a6e" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">在成为专家必须理解的所有新概念中，联合收割机有三个关键角色:<code class="fe ls lt lu lv b">Publishers</code>、<code class="fe ls lt lu lv b">Subscribers</code>和操作员。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="be01" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">出版商</h1><p id="05f8" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">一个<code class="fe ls lt lu lv b">Publisher</code>是一个带有签名<code class="fe ls lt lu lv b">Publisher&lt;Output, Failure&gt;</code>的协议，并且期望传递零个、一个或多个相同类型的值。它必须指出它是否能发出错误。如果它发出错误，我们将它的失败标记为错误类型。如果它没有发出任何错误，我们使用<code class="fe ls lt lu lv b">Never</code>作为失败。<code class="fe ls lt lu lv b">Publisher</code>完成，无错误或出现<code class="fe ls lt lu lv b">Failure</code>中指定类型的错误。</p><p id="c722" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Combine中的<code class="fe ls lt lu lv b">Publisher</code>类似于新闻业中的出版商。期刊出版商(或出版社)提供内容，而不考虑格式。例如，它可以是出版周刊的传统出版社(例如<em class="lw">时代</em>杂志)。它输出多个值，并且不期望打破这种模式，这意味着你总是可以期待《时代》杂志每周都会出一期新的。</p><p id="9395" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出版商的另一个例子可以是运营新闻出版服务的数字出版公司。你不知道你的手机会收到多少通知——一天一个或几个。他们可以不小心把Lorem Ipsums推送到你的手机上。或者当你点击通知时，它在打开应用程序时崩溃，而不是引导你到正确的文章。这就是发布者发出错误的方式。这与Combine的<code class="fe ls lt lu lv b">Publisher</code>的区别在于，在Combine中，一旦<code class="fe ls lt lu lv b">Publisher</code>发出一个错误，<code class="fe ls lt lu lv b">Publisher</code>就被认为是完整的。就你的新闻应用而言，如果错误没有被修复，你会不断收到错误通知。</p><p id="0450" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">综上，一个<code class="fe ls lt lu lv b">Publisher</code>:</p><ul class=""><li id="30b1" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated">有一个<code class="fe ls lt lu lv b">Publisher&lt;Output, Failure&gt;</code>的签名。</li><li id="efc4" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">随时间推移输出零个、一个或多个相同类型的值。</li><li id="e50e" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">可以发布一个错误类型来通知<code class="fe ls lt lu lv b">Publisher</code>已经失败，并且<code class="fe ls lt lu lv b">Publisher</code>将完成。</li><li id="4296" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">可以没有任何错误地完成。</li></ul><h2 id="ec04" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">有用的出版商</h2><p id="46c3" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">Combine有一百万种方法来初始化一个<code class="fe ls lt lu lv b">Publisher</code>。有专门的发布器供我们用于某些常见任务。</p><h2 id="5280" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">就<output/></h2><p id="4668" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/combine/just" rel="noopener ugc nofollow" target="_blank">提供单个值</a>并完成。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="4452" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它不能因为一个错误而失败。这就是为什么输出值是初始化<code class="fe ls lt lu lv b">Just</code>发布器所需的唯一参数。</p><h2 id="41f9" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">未来<output failure=""/></h2><p id="aeb5" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/combine/future" rel="noopener ugc nofollow" target="_blank">用闭包</a>初始化，最终解析为单个输出值或失败完成。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="69ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">Future</code>就像Javascript中的承诺。它需要一个回调函数，在回调函数中，当你需要的时候，你可以自由地返回一个<code class="fe ls lt lu lv b">.success</code>或<code class="fe ls lt lu lv b">.failure</code>(例如，当你想做一个异步任务的时候)。处理完您的请求后，<code class="fe ls lt lu lv b">Publisher</code>将发出您指定的值(即成功或失败)。</p><h2 id="2b89" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">@已发布</h2><p id="6cf2" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/combine/published" rel="noopener ugc nofollow" target="_blank">一个属性包装器</a>，为这个类型创建一个<code class="fe ls lt lu lv b">Publisher</code>。然后可以使用<code class="fe ls lt lu lv b">$</code>操作器访问<code class="fe ls lt lu lv b">Publisher</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="b9d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe ls lt lu lv b">@Published</code>时要记住的一点是:<code class="fe ls lt lu lv b">@Published</code>属性是受类约束的。只能为类的属性标记它，而不能为结构的属性标记它。如果你试图这样做，编译器会抱怨。它也不能在协议中使用。</p><p id="a8c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然有其他方法可以达到同样的目的，<code class="fe ls lt lu lv b">@Published</code>仅仅是让联合收割机来做繁重的工作。替代方案将在后面介绍。</p><p id="55b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lw">为了学习更多关于属性包装器的知识，</em> <a class="ae kv" href="https://www.swiftbysundell.com/articles/property-wrappers-in-swift/" rel="noopener ugc nofollow" target="_blank"> <em class="lw">约翰·桑德尔</em> </a> <em class="lw">写了一篇关于这个主题的广泛介绍</em>。</p><h2 id="cf67" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">出版商和基金会</h2><p id="34fe" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">苹果还为Foundation引入了许多助手，所以你不必每次想与Foundation交互时都要编写自定义的<code class="fe ls lt lu lv b">Publisher</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="e5cf" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">订阅者</h1><p id="6894" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">使用联合收割机的第一步是衍生一个<code class="fe ls lt lu lv b">Publisher</code>。一个<code class="fe ls lt lu lv b">Publisher</code>单独不能实现任何有用的东西，直到它被一个<code class="fe ls lt lu lv b">Subscriber</code>附加。<code class="fe ls lt lu lv b">Publishers</code>和<code class="fe ls lt lu lv b">Subscribers</code>是要连接的。一个<code class="fe ls lt lu lv b">Subscriber</code>是一个带有签名<code class="fe ls lt lu lv b">Subscriber&lt;Input, Failure&gt;</code>的协议。将<code class="fe ls lt lu lv b">Subscriber</code>连接到<code class="fe ls lt lu lv b">Publisher</code>会产生一个<code class="fe ls lt lu lv b">Subscription</code>。</p><p id="fc11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设你是<em class="lw">时代</em>杂志的订户(即你与<em class="lw">时代</em>杂志出版商有订阅关系)。这种订阅的一个特点是，当最新一期《时代》杂志出版时，你会收到一份。你期望收到一份<em class="lw">时间</em>——<em class="lw"/>而不是<em class="lw">国家地理</em>的副本。在Combine中确实如此:发布者的输出必须与订阅者的输入相匹配。发布服务器的失败类型必须与订阅服务器的失败类型相匹配。</p><p id="9724" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你应该熟悉现今大多数订阅服务的取消政策。在订阅期内，您可以随时退出或取消订阅。或者，如果<em class="lw"> Time </em>杂志停止营业，订阅将自动取消。你不会从杂志上得到任何新的问题。</p><p id="be62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Combine允许您随时进行<code class="fe ls lt lu lv b">cancel</code>订阅。</p><p id="44cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在一个<code class="fe ls lt lu lv b">Subscriber</code>订阅了一个<code class="fe ls lt lu lv b">Publisher</code>之后，你得到了一个符合<code class="fe ls lt lu lv b">Cancellable</code>协议的对象:</p><ol class=""><li id="a406" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr od nh ni nj bi translated">您可以通过拨打<code class="fe ls lt lu lv b">subscription.cancel()</code>手动取消订阅。</li><li id="a9a2" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr od nh ni nj bi translated">如果已经取消分配，订阅将自动取消。</li></ol><p id="080c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">存储订阅，因为如果取消分配，订阅将自动取消。</p><p id="dd46" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">综上所述，<code class="fe ls lt lu lv b">Subscriber</code>:</p><ul class=""><li id="08ea" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated">与一个订阅链接。一个<code class="fe ls lt lu lv b">Subscriber</code>不能订阅多个<code class="fe ls lt lu lv b">Publishers</code>。</li><li id="e8c1" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><code class="fe ls lt lu lv b">Subscriber</code>的输入和失败类型必须与发布者的匹配。</li><li id="9cef" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">您需要将订阅存储在某个地方，以避免它被释放。</li></ul><h2 id="5274" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">有用的订户</h2><h2 id="c5df" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">。接收器(接收完成:接收值:)</h2><p id="da87" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">Combine 提供的一个方便的<code class="fe ls lt lu lv b">Subscriber</code>T21，允许您处理<code class="fe ls lt lu lv b">Publisher</code>发出的值。立即从<code class="fe ls lt lu lv b">Publisher</code>请求一个值，然后等待输入值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="b905" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">只要订阅保持有效，它就接受由<code class="fe ls lt lu lv b">Publisher</code>发出的值，并将它们转发给<code class="fe ls lt lu lv b">sink</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="13a0" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">。分配(给:在:)</h2><p id="3d31" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/combine/just/assign(to:on:)" rel="noopener ugc nofollow" target="_blank">将来自发布者的每个元素</a>分配给对象的一个属性。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="d4be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lw">注意:在写的时候，使用</em> <code class="fe ls lt lu lv b"><em class="lw">.assign(to: on: self)</em></code> <em class="lw">会造成保留循环。这被报告为一个错误。有一个</em> <a class="ae kv" href="https://forums.swift.org/t/does-assign-to-produce-memory-leaks/29546/9" rel="noopener ugc nofollow" target="_blank"> <em class="lw">临时变通办法</em> </a> <em class="lw">可用。</em></p><h2 id="4631" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">学科</h2><p id="7e04" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><code class="fe ls lt lu lv b">Subjects</code>很特别，因为它们的行为类似于<code class="fe ls lt lu lv b">Publishers</code>和<code class="fe ls lt lu lv b">Subscribers</code>。通常情况下，<code class="fe ls lt lu lv b">Subscriber</code>从<code class="fe ls lt lu lv b">Publishers</code>获取输入。<code class="fe ls lt lu lv b">Subjects</code>是<code class="fe ls lt lu lv b">Publishers</code>，在它们被初始化之后，你可以自由地按需发送值。</p><p id="67bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Combine为我们提供了两个方便而有用的主题。</p><p id="b9a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/combine/passthroughsubject" rel="noopener ugc nofollow" target="_blank">通过主题&lt;输出，失败&gt; </a>:</p><p id="f327" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">PassthroughSubject</code>没有初始值，也不在订阅期间的任何时间点存储任何值。它充当发布者，唯一的工作是将值传递给订阅操作。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="e7c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/combine/currentvaluesubject" rel="noopener ugc nofollow" target="_blank">电流值Subject &lt;输出，故障&gt;T22】:</a></p><p id="b67f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">CurretValueSubject</code>的初始化需要初始值。您可以随时访问用<code class="fe ls lt lu lv b">subject.value</code>存储的值。更改该值将导致主题向附加到它的订阅发出该值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="aa15" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">PassthroughSubject与CurrentValueSubject</h2><p id="4181" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">总之，比较<code class="fe ls lt lu lv b">CurrentValueSubject</code>和<code class="fe ls lt lu lv b">PassthroughSubject</code>:</p><ul class=""><li id="05ef" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated"><code class="fe ls lt lu lv b">CurrentValueSubject</code>有初始值，而<code class="fe ls lt lu lv b">PassthroughSubject</code>没有。</li><li id="dd5e" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><code class="fe ls lt lu lv b">CurrentValueSubject</code>在<code class="fe ls lt lu lv b">.value</code>中存储一个值。改变该值将自动使<code class="fe ls lt lu lv b">Publisher</code>发送一个新值。<code class="fe ls lt lu lv b">PassthroughSubject</code>本身不存储任何值。它只是将上游值传递给下游。</li></ul><p id="a34d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">CurrentValueSubject</code>对于有状态的、可变的属性很有用，而<code class="fe ls lt lu lv b">PassthroughSubject</code>对于表示事件很有用。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="b091" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">经营者</h1><p id="051b" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">Combine的函数式反应范式在可读性和装饰性方面优于其他范式。所有的权力都在运营商手里。</p><p id="758c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运算符是定义在<code class="fe ls lt lu lv b">Publisher</code>实例上的函数:</p><ul class=""><li id="59dc" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated">操作符被链接以添加处理步骤。</li><li id="674a" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">每个操作符返回一个新的<code class="fe ls lt lu lv b">Publisher</code>。</li></ul><p id="f696" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运算符最好通过例子来解释。</p><h2 id="2711" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">。map(_ transform: (Output) -&gt; T)</h2><p id="b97d" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">Combine的<code class="fe ls lt lu lv b"><a class="ae kv" href="https://developer.apple.com/documentation/combine/publisher/map(_:)-99evh" rel="noopener ugc nofollow" target="_blank">.map(_:)</a></code> <a class="ae kv" href="https://developer.apple.com/documentation/combine/publisher/map(_:)-99evh" rel="noopener ugc nofollow" target="_blank">操作符</a>的工作方式类似于您将在集合上使用的标准<code class="fe ls lt lu lv b">.map(:)</code>函数。</p><p id="4af3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">.map(_:)</code>使用闭包来转换它从上游接收的每个元素<code class="fe ls lt lu lv b">Publisher</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="016a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们从一个整数数组开始，使用Combine的一个方便的方法创建了一个<code class="fe ls lt lu lv b">Publisher</code>,将基础实体转化为发布者。当我们需要额外处理这些值时,<code class="fe ls lt lu lv b">.map</code>就派上了用场。在这种情况下，上游值从整数转换为字符串。</p><p id="85ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运算符可以被链接。链接多个<code class="fe ls lt lu lv b">.map()</code>让我想起了<em class="lw">单一责任原则</em>，在这里你可以为每个操作者做一件事。它极大地提高了合并代码的可读性。</p><h2 id="c998" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">。filter(_ is included:(Output)-&gt; Bool)</h2><p id="2c44" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><code class="fe ls lt lu lv b"><a class="ae kv" href="https://developer.apple.com/documentation/combine/just/filter(_:)" rel="noopener ugc nofollow" target="_blank">.filter()</a></code>工作原理类似。它接受一个闭包，只发出满足闭包中指定要求的值。其他值不会向下游发出。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="a999" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">操作员应该一起工作。在上面的例子中，我们首先过滤掉奇数，然后将它们转换成字符串。最后，我们可以使用值。</p><h2 id="50c2" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">。删除重复项()</h2><p id="dd15" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/combine/fail/removeduplicates()" rel="noopener ugc nofollow" target="_blank">从上游<code class="fe ls lt lu lv b">Publishers</code>移除重复元素</a>。</p><p id="6bae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">.removeDuplicates()</code>不记录发出的所有值，但使用双元素存储器。该比较基于当前值和先前值。</p><p id="d049" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，如果值为<code class="fe ls lt lu lv b">0, 1, 1</code>，则发出的值将为<code class="fe ls lt lu lv b">0</code>和<code class="fe ls lt lu lv b">1</code>。如果值是<code class="fe ls lt lu lv b">0, 1, 0, 1</code>，发出的值仍然是<code class="fe ls lt lu lv b">0, 1, 0, 1</code>，因为没有相邻的元素相等。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="88a8" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">。compact map(_ transform:(Output)-&gt; T？)</h2><p id="064c" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><code class="fe ls lt lu lv b"><a class="ae kv" href="https://developer.apple.com/documentation/combine/publishers/catch/compactmap(_:)/" rel="noopener ugc nofollow" target="_blank">.compactMap()</a></code>接受一个返回可选的转换闭包，只有非零可选结果将被返回到下游<code class="fe ls lt lu lv b">Publisher</code>。无选项将被删除。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="66e2" class="np mf iq bd mg nq nr dn mk ns nt dp mo lf nu nv mq lj nw nx ms ln ny nz mu oa bi translated">。组合测试<p> (_其他:P)</p></h2><p id="56e8" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">在一个<code class="fe ls lt lu lv b">Publisher</code> <a class="ae kv" href="https://developer.apple.com/documentation/combine/just/combinelatest(_:)" rel="noopener ugc nofollow" target="_blank">上调用该方法来组合多个</a> <code class="fe ls lt lu lv b"><a class="ae kv" href="https://developer.apple.com/documentation/combine/just/combinelatest(_:)" rel="noopener ugc nofollow" target="_blank">Publishers</a></code>。当any发出一个值时，下游的<code class="fe ls lt lu lv b">Subscriber</code>将从组合的<code class="fe ls lt lu lv b">Publishers</code>中接收一个最新元素的元组。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="80ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在组合的<code class="fe ls lt lu lv b">Publisher</code>产生任何值之前，每个发布者必须至少产生一个值。</p><p id="8389" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">.combineLatest()</code>支持链接。你可以把unlimited <code class="fe ls lt lu lv b">Publishers</code>和这个语句结合起来。如果您需要组合少于四个<code class="fe ls lt lu lv b">Publishers</code>，combine在<code class="fe ls lt lu lv b">Publishers</code>上为您的命令提供了方便的静态方法:</p><ul class=""><li id="ea4f" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated"><code class="fe ls lt lu lv b">Publishers.CombineLatest(a: _, b: _)</code></li><li id="1db4" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><code class="fe ls lt lu lv b">Publishers.CombineLatest3(a: _, b: _, c: _)</code></li><li id="8942" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><code class="fe ls lt lu lv b">Publishers.CombineLatest4(a: _, b: _, c: _, d: _)</code></li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="043d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。</p></div></div>    
</body>
</html>