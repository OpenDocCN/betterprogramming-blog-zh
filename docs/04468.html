<html>
<head>
<title>React With CORS: The How and the Why</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与CORS反应:如何和为什么</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/react-with-cors-the-how-and-the-why-163ecf10035f?source=collection_archive---------2-----------------------#2020-04-15">https://betterprogramming.pub/react-with-cors-the-how-and-the-why-163ecf10035f?source=collection_archive---------2-----------------------#2020-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c5fb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">向不同域中的服务器发出请求</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5dfaef57dc9e741d0988dbc829d1e87c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b9G9WieT210RxxSQrX-LMw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">金属齿轮连接——图片由<a class="ae ky" href="https://unsplash.com/@bill_oxford?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">比尔·牛津</a>在<a class="ae ky" href="https://unsplash.com/s/photos/connection?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="b288" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像许多其他人一样，我最近开始建造一些东西。我决定创建一个网络应用程序，来解决我已经感觉了很长一段时间的痒。另外，我想增加我对React和一些核心Ruby库的了解。因此，我将它实现为一个React SPA，服务器是一个机架应用程序。我没有使用任何Ruby框架，只是使用了小型的非常专业的库。我决定写下我学到的东西，以增加我的学习经验，并让其他人加入到这种经验中来。</p><p id="a071" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这第一篇文章是关于跨原产地资源共享(CORS)。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="be38" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是CORS？</h1><p id="aa74" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">CORS是一种允许您向不同域的服务器发出ajax请求的技术。如果你想直接在你的客户端上使用API，这是非常有用的——如果你正在编写一个<a class="ae ky" href="https://jamstack.org/" rel="noopener ugc nofollow" target="_blank"> Jamstack </a> web应用，这是绝对需要的。</p><p id="0064" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是这在其他用例中也是有用的。如果您将前端放在不同于后端域的域中，您需要让后端对前端可用，这正是我的用例。</p><p id="1113" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来探索为什么和如何！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c83e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">CORS是如何在幕后工作的？</h1><p id="8c29" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们首先要考虑为什么这是必要的。每个浏览器都有一个叫做“同源策略”的安全机制这种机制确保了潜在的恶意脚本无法执行对随机域的随机API调用。</p><h2 id="73ca" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">什么叫做同源？</h2><p id="3e73" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">根据定义，<code class="fe nl nm nn no b">protocol</code>、<code class="fe nl nm nn no b">port</code>和<code class="fe nl nm nn no b">host</code>必须相等才能被认为是同一个原点。这清楚地表明，您可以使用任何查询参数调用服务器上的任何路由，但是您不能调用另一个子域，因为子域是不同的主机。</p><p id="d4bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以<code class="fe nl nm nn no b">https://my-awesome-app.com</code>无法访问<code class="fe nl nm nn no b">https://api.my-awesome-app.com</code>是因为主机不同，但是<code class="fe nl nm nn no b">https://my-awesome-app.com/api/v1/...</code>任何路由都是可用的。</p><p id="b63b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们如何为我们的服务器/客户端停用同源策略？</p><p id="c137" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须设置一些HTTP头来告诉客户端一些资源可供他们使用。相关标题包括:</p><ul class=""><li id="c1cf" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated"><code class="fe nl nm nn no b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin" rel="noopener ugc nofollow" target="_blank">Access-Control-Allow-Origin</a></code>，必须设置为请求资源的域。根据我们上面的例子，这可以设置为<code class="fe nl nm nn no b">Access-Control-Allow-Origin: <a class="ae ky" href="https://my-awesome-app.com" rel="noopener ugc nofollow" target="_blank">https://my-awesome-app.com</a></code>。</li><li id="8bf3" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">其他一些<code class="fe nl nm nn no b">Access-Control-*</code>头可以限制一些资源或者设置一些权限参数，进一步增加服务器的安全性。</li></ul><p id="2635" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">浏览器通过向服务器发送飞行前HTTP OPTIONS请求来确保它可以访问服务器，并因此请求报头。完成请求后，当服务器通过发送所需的头批准请求时，浏览器将发送实际的请求。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1c5b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">你如何使用CORS和React？</h1><p id="0fb9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在React应用程序中有两个常用的选项来发出HTTP请求:</p><ul class=""><li id="f668" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated"><a class="ae ky" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> axios </a></li><li id="8481" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener ugc nofollow" target="_blank">获取API </a></li></ul><p id="893d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何设置客户端来发出CORS请求。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="16b3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使配置在整个应用程序中可用</h1><p id="6b31" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，我们如何使配置对整个应用程序可用？axios有一个创建新实例的功能。当我们保存这个实例时，我们可以配置它，并在我们需要的任何组件中访问它。使该实例可用的最佳方式是使用上下文。</p><p id="92ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于fetch，我们也可以编写一个上下文，我们可以配置一些函数，然后使用我们自己编写的请求函数。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0574" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Axios配置</h1><p id="3472" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们需要配置什么？其实不多。最重要的配置如下:</p><pre class="kj kk kl km gt od no oe of aw og bi"><span id="3fc2" class="mz md it no b gy oh oi l oj ok">baseURL: 'http://api.my-awesome-app.com' </span></pre><p id="77c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从这一点开始，axios将总是使用这个URL来启动请求。并且浏览器确保它自己发出初始HTTP选项请求。</p><p id="fc26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当使用API时，您可能还需要向服务器发送一个令牌来验证客户端。标准割台是<code class="fe nl nm nn no b">Authorization</code>割台。通常，令牌前面会有一个<code class="fe nl nm nn no b">“Bearer: "</code>字符串。但这取决于你使用的API。</p><h2 id="a10a" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">旁注</h2><p id="2a69" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您在另一边，并且必须配置服务器，那么设置一些额外的头—即<code class="fe nl nm nn no b">Access-Control-Allow-Credentials</code>是很重要的。为什么会这样呢？如前所述，浏览器用一个选项请求询问服务器是否允许它访问资源，服务器告诉浏览器它可以访问哪些资源以及它可以使用哪些头。</p><p id="ae3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Ruby中，有一个<code class="fe nl nm nn no b">rack-cors</code> gem使得服务器配置非常容易。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e3b7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">获取配置</h1><p id="023c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了将<code class="fe nl nm nn no b">fetch</code>用于CORS请求，我们将<code class="fe nl nm nn no b">mode</code>选项设置为<code class="fe nl nm nn no b">cors</code>。我们不需要设置默认的URL，但是我们可以在请求中设置URL。就像在<code class="fe nl nm nn no b">axios</code>的例子中一样，这不会发送任何<code class="fe nl nm nn no b">Authorization</code>头，但是通过<code class="fe nl nm nn no b">headers</code>选项，我们可以设置服务器允许的任何头。完全配置的请求可能如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a976" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="6577" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">正如我们所见，在浏览器中使用CORS非常容易。这将为我们提供许多新的可能性，并使开发者和用户的生活更加轻松。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="0763" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="on">不是中等会员？</em> <a class="ae ky" href="https://grnt-grdwhl.medium.com/membership" rel="noopener"> <em class="on">在这里报名</em> </a> <em class="on">并支持我的写作过程！</em></p></div></div>    
</body>
</html>