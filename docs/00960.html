<html>
<head>
<title>How to Auto Deploy an App to Google Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将应用程序自动部署到Google Cloud Run</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-auto-deploy-an-app-to-google-cloud-run-9a20a183088d?source=collection_archive---------13-----------------------#2019-07-31">https://betterprogramming.pub/how-to-auto-deploy-an-app-to-google-cloud-run-9a20a183088d?source=collection_archive---------13-----------------------#2019-07-31</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="bc5a" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">通过这个简短的教程，让您的Dockerized应用程序自动构建和部署</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj kj"><img src="../Images/7720b0760e219c0443a93b82e0928fd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*gYGvyOHloJ2JKO8MX3fYAw.png"/></div></figure><p id="d437" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">很容易让您的Dockerized应用程序自动构建并部署到<a class="ae ln" href="https://cloud.google.com/run/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Run </a>，当您不想考虑基础设施时，这是一个非常棒的部署应用程序的服务。</p><p id="986c" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">首先，<a class="ae ln" href="https://console.cloud.google.com/projectcreate" rel="noopener ugc nofollow" target="_blank">在Google Cloud控制台上创建一个新项目</a>，并复制您的项目ID以在本文中使用。我们开始吧！</p></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="762e" class="lv lw iu bd lx ly lz ma mb mc md me mf ka mg kb mh kd mi ke mj kg mk kh ml mm bi translated">手动部署，做好一切准备</h1><p id="55af" class="pw-post-body-paragraph kr ks iu kt b ku mn jv kw kx mo jy kz la mp lc ld le mq lg lh li mr lk ll lm in bi translated">在命令行上设置您的项目ID:</p><pre class="kk kl km kn gu ms mt mu mv aw mw bi"><span id="447f" class="mx lw iu mt b gz my mz l na nb">gcloud config set project $PROJECT_ID</span></pre><p id="ed75" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">现在，让我们将应用程序的Docker图像推送到项目的Google容器注册表中。转到控制台中的<code class="fe nc nd ne mt b">Container Registry</code>并启用API，然后:</p><pre class="kk kl km kn gu ms mt mu mv aw mw bi"><span id="16c6" class="mx lw iu mt b gz my mz l na nb">docker build -t gcr.io/$PROJECT_ID/hello .<br/>docker push gcr.io/$PROJECT_ID/hello</span></pre><p id="b05b" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">接下来，我们需要通过云运行让它运行起来。你只需要这样做一次，只是为了确保一切工作正常。</p><pre class="kk kl km kn gu ms mt mu mv aw mw bi"><span id="f746" class="mx lw iu mt b gz my mz l na nb">gcloud beta run deploy --image gcr.io/$PROJECT_ID/hello --platform managed</span></pre><p id="d019" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">运行后，您将获得一个全新的网址来查看您的应用程序:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gi gj nf"><img src="../Images/be5197b488d9f250c8d731f26edd8c8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GugEU6j6QCigIa1I_bJYYw.png"/></div></div></figure><p id="a0b0" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">好了，现在我们的应用已经在Cloud Run上运行了！下一步是自动化上述所有工作。</p></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="3d64" class="lv lw iu bd lx ly lz ma mb mc md me mf ka mg kb mh kd mi ke mj kg mk kh ml mm bi translated">现在自动化吧！</h1><p id="6377" class="pw-post-body-paragraph kr ks iu kt b ku mn jv kw kx mo jy kz la mp lc ld le mq lg lh li mr lk ll lm in bi translated">在控制台中，为您的项目启用<code class="fe nc nd ne mt b">Cloud Build</code>，参见<a class="ae ln" href="https://cloud.google.com/cloud-build/docs/quickstart-docker" rel="noopener ugc nofollow" target="_blank">本快速入门</a>获取说明。然后添加一个<a class="ae ln" href="https://console.cloud.google.com/cloud-build/triggers" rel="noopener ugc nofollow" target="_blank">触发器</a>到云构建中。每当您推送到GitHub存储库时，这个触发器都会运行构建。对于<code class="fe nc nd ne mt b">Trigger Type</code>，选择“分支”，并在“分支(正则表达式)”字段中输入“主”。另外，选择“云构建配置文件”。设置好之后，它应该是这样的:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gi gj nk"><img src="../Images/d6f4ec4561c1ddc7e93efcf44f9a8e0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4A4hfnFvLMMJgTwo5DhhZw.png"/></div></div></figure><p id="d46b" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">我们需要授予我们的云构建服务帐户访问云运行的权限，方法是转到<a class="ae ln" href="https://console.cloud.google.com/iam-admin/iam" rel="noopener ugc nofollow" target="_blank"> IAM </a>并授予<code class="fe nc nd ne mt b"><em class="nl">PROJECT_ID@cloudbuild.gserviceaccount.com</em></code>“云运行管理员”角色和“云运行服务代理”，以便允许部署到云运行。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nm"><img src="../Images/056242d1157773ae6179c02ca78c2a9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:348/format:webp/1*0af4DStB274Tc0h7V43U7g.png"/></div><p class="nn no gk gi gj np nq bd b be z dk translated">云构建服务客户的角色。</p></figure><p id="e921" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">最后，在您的git存储库中，将以下内容复制到一个名为<code class="fe nc nd ne mt b">cloudbuild.yaml</code>的文件中，并将其推送到GitHub。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nr ns l"/></div><p class="nn no gk gi gj np nq bd b be z dk translated">第15行的最后一个参数是云运行服务的名称，如果您继续下去，应该是<code class="fe nc nd ne mt b">hello</code>。</p></figure><p id="54ff" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">嘣！您的构建将在每次推送至master时运行和部署。尝试更新您的应用程序并推动它以查看它的运行情况。</p><p id="05b9" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">你可以在这里找到这篇文章中用到的所有代码:</p><div class="nt nu gq gs nv nw"><a href="https://github.com/treeder/cloud-run-example" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fp"><div class="ny ab nz cl cj oa"><h2 class="bd iv gz z fq ob fs ft oc fv fx it bi translated">tree der/cloud-run-示例</h2><div class="od l"><h3 class="bd b gz z fq ob fs ft oc fv fx dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oe l"><p class="bd b dl z fq ob fs ft oc fv fx dk translated">github.com</p></div></div></div></a></div></div></div>    
</body>
</html>