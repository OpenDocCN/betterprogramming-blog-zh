<html>
<head>
<title>Filterable, Scalable Event Messaging With SNS and SQS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过社交网络和SQS提供可过滤、可扩展的事件消息</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/filterable-scalable-event-messaging-with-sns-and-sqs-3a1d624eb5b5?source=collection_archive---------4-----------------------#2019-10-18">https://betterprogramming.pub/filterable-scalable-event-messaging-with-sns-and-sqs-3a1d624eb5b5?source=collection_archive---------4-----------------------#2019-10-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="de31" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">分离服务，同时实现巨大的可伸缩性和扇出</h2></div><p id="5360" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">无服务器和微服务都是关于解耦服务的。</p><p id="9e2c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">拥有合适的工具可以确保您的架构获得成功。将你的服务设计成真正独立、有弹性和可伸缩的，可以确保你的产品能够承受你要扔给它的一切。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/2329eebab50aecade8834d94478bc34c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1p18K9Qw4NPOBWZgRCmGfw.jpeg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">格雷格·法罗摄影</p></figure><h1 id="8422" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">解决方案架构中的解耦</h1><p id="2e69" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">当我们使用类似于<em class="mr">关注点分离</em>和<em class="mr">解耦</em>的短语时，我们指的是什么？</p><p id="2f0b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果微服务或面向服务的架构(SOA)方法要取得成功，它必须容忍失败。如果架构的一部分出现问题，其他服务应该可以继续正常运行。每个服务都应该维护自己独立的数据源和接口。</p><p id="ab06" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">微服务模式的衍生物是事件驱动架构。它以事件从一个服务到另一个服务的移动为中心。它特别适合无服务器技术。</p><p id="d1f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为无服务器技术通常是按使用付费的，所以最好只在需要的时候调用服务。因此，事件驱动架构和无服务器技术是完美的搭档。</p><p id="0175" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">AWS提供了一系列服务来帮助实现事件驱动的无服务器设计。您可以在此了解更多选项:</p><div class="ms mt gp gr mu mv"><a href="https://medium.com/better-programming/moving-messages-in-aws-comparing-kinesis-sqs-and-sns-32cb5d2f89d5" rel="noopener follow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">在AWS中移动消息:比较Kinesis、SQS和SNS</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">哪种技术最适合在AWS上传递您的信息？</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">medium.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj lo mv"/></div></div></a></div></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="fe0a" class="lu lv it bd lw lx nr lz ma mb ns md me jz nt ka mg kc nu kd mi kf nv kg mk ml bi translated">为什么是SNS和SQS？</h1><p id="47a2" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">所以如果你读了<a class="ae nw" href="https://medium.com/better-programming/kinesis-vs-sqs-vs-sns-moving-messages-in-aws-32cb5d2f89d5" rel="noopener">的另一篇文章</a>，你就会知道Kinesis是事件驱动系统的一个完美的选择。它有几个引人注目的优点。所以在我回答“为什么SNS+SQS？”，为什么<em class="mr">不是</em>身势？</p><h2 id="8093" class="nx lv it bd lw ny nz dn ma oa ob dp me kr oc od mg kv oe of mi kz og oh mk oi bi translated">为什么不是Kinesis？</h2><p id="aeff" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">Kinesis是一个非常棒的服务，在适当的情况下，它是一个强大的工具。然而，有三个限制阻止我在更多的设计中使用它:</p><ul class=""><li id="124f" class="oj ok it kk b kl km ko kp kr ol kv om kz on ld oo op oq or bi translated"><strong class="kk iu">扇出</strong> —由于每个流最多有20个消费者，每秒读取5次，Kinesis不是向多个消费者传递消息的好选择。</li><li id="6362" class="oj ok it kk b kl os ko ot kr ou kv ov kz ow ld oo op oq or bi translated"><strong class="kk iu">规模</strong> —管理Kinesis中的规模很简单。只要改变一个配置属性，就搞定了。然而，缩放可能很慢才会生效(特别是当您的迭代器年龄很大时)。<a class="ae nw" href="https://docs.aws.amazon.com/kinesis/latest/APIReference/API_UpdateShardCount.html" rel="noopener ugc nofollow" target="_blank">缩放也被限制为每24小时两个事件</a>。此外，它不是自动的，所以它对我来说是更多的工作。</li><li id="de83" class="oj ok it kk b kl os ko ot kr ou kv ov kz ow ld oo op oq or bi translated"><strong class="kk iu">过滤</strong> —任何消费Lambdas必须调用并解析消息，然后才能知道该消息是否应该被处理。如果消息内容满足特定的标准，就不可能只调用Lambda。无缘无故地调用Lambda对我来说就像是无服务器的反模式。</li></ul></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="233b" class="lu lv it bd lw lx nr lz ma mb ns md me jz nt ka mg kc nu kd mi kf nv kg mk ml bi translated">那么为什么选择SNS呢？</h1><h2 id="993e" class="nx lv it bd lw ny nz dn ma oa ob dp me kr oc od mg kv oe of mi kz og oh mk oi bi translated">扇出</h2><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/72b89d95a9331ec77a459904a7aa0f83.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*HOLP45NS3Eg6WYvB7_4veQ.png"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">扇出</p></figure><p id="01bf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在事件驱动的系统中，通常希望一个事件引起多个动作。在某些情况下，我希望由一个事件触发多个动作。</p><p id="1b8e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">SNS是扇出的完美选择。它允许每个主题有多达1000万订阅者。这比我需要的还要多。</p><h2 id="e91b" class="nx lv it bd lw ny nz dn ma oa ob dp me kr oc od mg kv oe of mi kz og oh mk oi bi translated">规模</h2><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/a7df7d9e3fb2412dbe1bbe3f1e5569ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*OBNf_TZhyGk8aiD7nWFSww.png"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">规模</p></figure><p id="9a84" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我对我的团队以及我们设计和实现优秀软件的能力充满信心。但是和我们一样好，我认为AWS可以做得更好。如果AWS已经开发了解决问题的软件，最好使用他们的服务，而不是开发我们自己的。</p><p id="90a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我不想构建一个工具来监控和管理Kinesis流的碎片计数。</p><p id="cc6e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">SNS和SQS都从自动扩展中受益，AWS为我管理这一切。缩放限制几乎是无限的。现有的限制是软限制，这意味着我可以要求AWS提高它们。更多的是我能承受多大规模的问题。</p><h2 id="73d6" class="nx lv it bd lw ny nz dn ma oa ob dp me kr oc od mg kv oe of mi kz og oh mk oi bi translated">过滤</h2><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/a185cd47de740d50c8a1d8d34031edf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/1*YlCLHGsEHSA8ZY-4N7AJEA.gif"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">过滤</p></figure><p id="6b8a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我最喜欢的SNS功能是在信息被处理之前过滤信息的能力<em class="mr">。在我看来，这就是无服务器的意义所在。你可以将消费者的调用减少到那些<em class="mr">需要</em>运行的人。处理不相关的消息不会浪费计算时间。</em></p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="5985" class="lu lv it bd lw lx nr lz ma mb ns md me jz nt ka mg kc nu kd mi kf nv kg mk ml bi translated">如果SNS解决了这些问题，为什么还要用SQS呢？</h1><p id="9293" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">SNS是一个优秀的服务，基于上面的标准，非常适合事件驱动的架构。</p><p id="e11f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么，仅仅单独使用社交网络有什么错呢？你绝对可以。在正确的情况下，SNS本身是理想的。但事实并非总是如此。</p><h2 id="26b2" class="nx lv it bd lw ny nz dn ma oa ob dp me kr oc od mg kv oe of mi kz og oh mk oi bi translated">SNS + SQS什么时候才是正确的选择？</h2><p id="73bd" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">我经常需要在系统内移动事件，这依赖于难以置信的高可靠性。在这些系统中，丢失哪怕一条事件消息都是不可接受的。</p><p id="5959" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">SNS是可靠的。<a class="ae nw" href="https://aws.amazon.com/sns/faqs/#Reliability" rel="noopener ugc nofollow" target="_blank">消息存储在多个可用性区域</a>:</p><blockquote class="pa pb pc"><p id="b2cc" class="ki kj mr kk b kl km ju kn ko kp jx kq pd ks kt ku pe kw kx ky pf la lb lc ld im bi translated">虽然这种情况很少发生，但如果一个区域发生故障，SNS的运行和您的消息的持久性将会继续，不会中断。</p></blockquote><p id="3ef7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这些场景中，SNS的可靠性不是我主要关心的。我担心我的一个消费者可能会行为不端。</p><p id="9193" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果使用者工作不正常，它可能无法对事件消息做出适当的反应。如果我只使用社交网络，我的消息将会丢失。</p><h2 id="4b3e" class="nx lv it bd lw ny nz dn ma oa ob dp me kr oc od mg kv oe of mi kz og oh mk oi bi translated">进入SQS</h2><p id="ec92" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">SQS让我有更多的时间来成功处理信息。根据我的MessageRetentionPeriod配置，消息将在队列中最多保留14天<a class="ae nw" href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/APIReference/API_SetQueueAttributes.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="f075" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我的消费者开始行为不当，事件消息将重新出现在队列中。然后，消费者可以再次尝试处理该消息。这种保持能力让我有时间了解消费者的问题。然后我可以解决这个问题。问题解决后，消费者会自动处理任何未处理的消息。神奇！</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/85338b3d283cb53a32d8f18479d9e2ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5xXen0apJ1rH1WP5nQVwBg.jpeg"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">可靠性！——照片由格雷格·法罗拍摄</p></figure><h2 id="1362" class="nx lv it bd lw ny nz dn ma oa ob dp me kr oc od mg kv oe of mi kz og oh mk oi bi translated">顶端的樱桃</h2><p id="3c55" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">你会从<a class="ae nw" href="https://medium.com/better-programming/moving-messages-in-aws-comparing-kinesis-sqs-and-sns-32cb5d2f89d5" rel="noopener">这个故事</a>中想起:</p><blockquote class="pa pb pc"><p id="11f6" class="ki kj mr kk b kl km ju kn ko kp jx kq pd ks kt ku pe kw kx ky pf la lb lc ld im bi translated">因为SQS是一种排队服务(不是流服务)，它不适合多个消费者。</p></blockquote><p id="7463" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我之前提到的，SNS的一大好处是它允许扇出的能力。如果我使用只有一个SQS队列的SNS主题，我会失去这个邪恶的特性。这是设计中最好的部分；使用订阅过滤，我可以将一个SNS主题分散到多个SQS队列中。</p><p id="6ca1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">SNS和SQS是一起工作的。<a class="ae nw" href="https://docs.aws.amazon.com/sns/latest/dg/sns-sqs-as-subscriber.html" rel="noopener ugc nofollow" target="_blank"> AWS给出了如何实现这种模式的详细说明</a>。</p><p id="4dfb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">按照这种模式，我可以受益于SNS的所有我喜欢的特征:规模、扇出和过滤。我可以做到这一点，而不会有丢失数据的风险。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/101a9aaf3afc97b3bbc1649b3743f00c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*nIFrSKQGgf2fLhIzcLWqqA.png"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">社交网络和SQS:可过滤、可扩展、可靠</p></figure><p id="d52b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这可以通过<a class="ae nw" href="https://aws.amazon.com/blogs/compute/simplify-pubsub-messaging-with-amazon-sns-message-filtering/" rel="noopener ugc nofollow" target="_blank">使用订阅过滤将事件消息从SNS移动到SQS队列</a>来实现。</p><p id="83cc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我可以使用这种技术来订阅许多不同的队列，每个队列对应一种类型的消费者。每个订阅都会过滤掉任何不相关的事件消息。因此，队列只接收相关的消息。瞧啊。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="6a38" class="lu lv it bd lw lx nr lz ma mb ns md me jz nt ka mg kc nu kd mi kf nv kg mk ml bi translated">问题是</h1><p id="41ac" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">这种式样符合我的所有要求。不幸的是，这并不意味着我可以一直使用它。这可能是一个昂贵的选择。</p><h2 id="8af8" class="nx lv it bd lw ny nz dn ma oa ob dp me kr oc od mg kv oe of mi kz og oh mk oi bi translated">好人</h2><p id="6299" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">SNS和SQS都是真正的无服务器，我的意思是，没有固定成本。如果我没有任何数据要处理，那么我什么也不付。正好是0美元。在一个无服务器、事件驱动的世界里，这正是我所期望的价格。</p><p id="8334" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">随着数据开始在体系结构中流动，成本开始增加。产生的成本也遵循一个可爱的无服务器模型。您只需为您使用的东西付费。除此之外，AWS对从社交网站发送到SQS的信息不收取递送费。</p><p id="d671" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">到目前为止，一切顺利。</p><h2 id="ade1" class="nx lv it bd lw ny nz dn ma oa ob dp me kr oc od mg kv oe of mi kz og oh mk oi bi translated">坏事</h2><p id="81cf" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">我对SNS和SQS的收费感到失望。依我拙见，它们很贵。</p><p id="a1f7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae nw" href="https://aws.amazon.com/sns/pricing/" rel="noopener ugc nofollow" target="_blank">社交网络</a>:亚马逊100万次社交网络请求收费0.5美元</p><p id="fe2b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae nw" href="https://aws.amazon.com/sqs/pricing/" rel="noopener ugc nofollow" target="_blank"> SQS </a>:每100万个请求0.40美元</p><h2 id="61bd" class="nx lv it bd lw ny nz dn ma oa ob dp me kr oc od mg kv oe of mi kz og oh mk oi bi translated">一个例子</h2><p id="78ca" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">让我们看一个实际的例子。假设我们有一个SNS主题，订阅了三个SQS队列:</p><ul class=""><li id="8dfe" class="oj ok it kk b kl km ko kp kr ol kv om kz on ld oo op oq or bi translated">队列1使用所有邮件。</li><li id="bd8d" class="oj ok it kk b kl os ko ot kr ou kv ov kz ow ld oo op oq or bi translated">由于过滤，队列2消耗了50%的邮件。</li><li id="64c7" class="oj ok it kk b kl os ko ot kr ou kv ov kz ow ld oo op oq or bi translated">由于过滤，队列3消耗了10%的邮件。</li></ul><p id="34d9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将通过系统发送1000万条消息，并计算成本。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ph"><img src="../Images/a0a215173c2fac0adec3f80efe0a5cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*JxwZOvgGwHbQZ7_M1_dR0Q.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">1000万条消息的成本分布</p></figure><p id="fc74" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们有它:5美元(社交网站)和12.80美元(SQS)。假设我们单独通过系统传递每个事件，一千万条消息将花费我们17.80美元。</p><p id="0a59" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">SQS支持消息批处理。如果您使用Lambda函数来使用队列，那么您可以以10个为一批来处理消息。这样做将减少90%的SQS成本:一个请求中每个<code class="fe pi pj pk pl b">receive</code>10条消息，随后在一个<code class="fe pi pj pk pl b">DeleteMessageBatch</code>请求中删除10条消息。</p><p id="f40e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">新费用:5美元(社交网络服务)+1.28美元(SQS)= 6.28美元。</p><h2 id="6bd2" class="nx lv it bd lw ny nz dn ma oa ob dp me kr oc od mg kv oe of mi kz og oh mk oi bi translated">愤怒地使用它</h2><p id="e8e0" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">1000万英镑的货是微不足道的。在ResponseTap的生产环境中，我预计要处理5亿或10亿条消息。在生产规模上，我预计成本为314-628美元。突然听起来有点贵了。</p><p id="6bbe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，考虑到我想在我的平台的多个地方使用这种模式。我的成本在上升。</p><p id="b86b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为什么我认为这很贵？在这个平台上，我使用Lambda进行计算。我发现SNS + SQS的成本比我的Lambda成本高出20–30%。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi pm"><img src="../Images/c1aa08b6b3b00874f077af1b3e21f24e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jjiars4KbEAEDVM6qYBk9Q.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">在许多用例中部署的模式</p></figure></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="7837" class="lu lv it bd lw lx nr lz ma mb ns md me jz nt ka mg kc nu kd mi kf nv kg mk ml bi translated">反正我用的是这种模式</h1><p id="46a2" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">描述的蓝图并不是最便宜的。用Kinesis替换它可能会减少我20-40%的信息传输成本。那么，我为什么要坚持使用社交网站和SQS呢？</p><p id="19c5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从一个纯粹的、无服务器的fanboi的角度来看，这种模式非常好。对我来说，这正是无服务器、事件驱动的架构应该有的样子。但这只是我的看法。</p><p id="3c98" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这种模式如此引人注目并在ResponseTap中如此广泛使用的原因是架构的简单性和透明性。我坚信，为了理解一个系统而进行代码遍历是非常糟糕的。能够通过图表雄辩地描述你的平台使它更容易理解。</p><p id="9db7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个模式演示了它在做什么，而不需要理解任何Lambda代码。透明度带来了更直接的交流。工程时间几乎总是比平台费用更昂贵，所以我们省钱。</p><p id="00dd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">总的来说，这种设计对我的许多用例都很适用。与任何架构决策一样，您需要确信模式适合您。希望这篇帖子能让你更容易评价。</p></div></div>    
</body>
</html>