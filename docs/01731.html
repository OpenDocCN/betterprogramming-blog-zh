<html>
<head>
<title>Easier Web-Scraping in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中更简单的Web抓取</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/reverse-engineering-the-scrape-f5e9fb08a7c6?source=collection_archive---------1-----------------------#2019-10-09">https://betterprogramming.pub/reverse-engineering-the-scrape-f5e9fb08a7c6?source=collection_archive---------1-----------------------#2019-10-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3a8d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">只针对您想要的数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/aceba55a8022cd3467dcf119b70d7440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LVjw1GR_21yJEz3dX7YTAQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@officialdavery?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">德文·艾弗里</a>在<a class="ae ky" href="https://unsplash.com/s/photos/reverse?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3dc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每天，我都会看到一些关于如何抓取我订阅的网页的指南。</p><p id="06da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有人都在使用某种美丽的汤和木偶师或硒的组合。但是当你只是想搜集一些简单的数据时，对你正在搜集的网站进行逆向工程可能会更容易。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1d62" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">逆向工程并不可怕</h1><p id="bb1f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当我说<em class="mz">逆向工程的时候，</em>我只是想看看信息是如何到达那里的，看看是否有一种方法可以得到你正在寻找的数据。</p><p id="a5df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个例子，我们将着眼于Smedian.com，因为我想要一个我正在做的另一个抓取项目的中型文章的大列表。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bc99" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.研究网页</h1><p id="bc46" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在深入研究之前，检查是否有<code class="fe na nb nc nd b">robots.txt</code>或条款和条件。他们会明确说明抓取他们的网站是否安全。为了一点数据和约翰尼·劳闹僵是不值得的。</p><p id="b4e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe na nb nc nd b">robots.txt</code>，你可以查看基本URL，如下所示:<a class="ae ky" href="https://smedian.com/robots.txt" rel="noopener ugc nofollow" target="_blank">https://smedian.com/robots.txt</a>。如果你访问这个链接，你会得到一个404的欢迎——这意味着刮擦是安全的。</p><p id="e67b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我进行抓取时，我查看网络日志，过滤到XMLHttpRequest (XHR)，这通常是数据请求。我通常会寻找类似查询和JSON响应的内容。</p><p id="c659" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">找到如下所示的端点后，我将复制JSON的主体，并查看我想要的页面关键词是否在JSON中。如果是的话，我会开始在网页上工作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/987dec94290844524f909e176b8eb6fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3hWuqoQLb8O3Hlk-O-J9IA.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6b7b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.分析请求URL</h1><p id="b56e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在这里，我会推荐你尽可能的懒。</p><p id="1275" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我确定了我想要使用的URL(如下所示)时，我首先看到的是limit参数。我插入了一个大的限制，看看我是否需要刮文章。或者，至少，我认为我做到了。稍后会详细介绍。看到这个没用后，我开始解构网址。</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="49e2" class="nj md it nd b gy nk nl l nm nn"><a class="ae ky" href="https://www.smedian.com/api/i/pub/advertised?bpa=true&amp;limit=700&amp;from=%7B%22name%22%3A%22%3C%20BE%20OUTSTANDING%20%2F%3E%22%2C%22_id%22%3A%225927167d5fbc457423b176fc%22%7D" rel="noopener ugc nofollow" target="_blank">https://www.smedian.com/api/i/pub/<br/>advertised?<br/>bpa=true&amp;<br/>limit=700&amp;<br/>from=%7B<br/>"name"%3A"&lt;%20BE%20OUTSTANDING%20%2F&gt;"%2C<br/>"_id"%3A"5927167d5fbc457423b176fc"%7D</a></span></pre><p id="3ac4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从URL中，我发现它通过查看列表中最后一篇文章的名称和ID来请求下面的文章。幸运的是，他们将请求下一组记录所需的参数放在JSON开头的一个小数据结构中:</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="e7b2" class="nj md it nd b gy nk nl l nm nn">"paging": {<br/>  "limit": 10,<br/>  "canLoadMore": true,<br/>  "total": null,<br/>  "from": {<br/>    "name": "Waves Token Movement",<br/>    "_id": "5cef369a32628075008a0bf9"<br/>  },<br/>  "sortOrder": 1<br/>}</span></pre><p id="607b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这些，我开始研究一个janky函数来为序列中的下一组数据生成URL。</p><p id="418f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将基本URL、格式化名称、ID标记和发布ID组合成一个URL。</p><p id="21ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还会注意到，我将出版物名称转换为字符串，因为其中一个只是数字。Python试图这样解释它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/80f0c2dd77f4c948e9fb7bb0d3ce60d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*PfMt0R1GoRPg19yHDFhJLQ.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2a02" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.把它们串在一起</h1><p id="276e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我使用以下三个函数将它串在一起。</p><p id="067c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">Get_Publications</code>使用种子输入URL启动流程。接下来，它将打开一个CSV来记录它正在处理的请求URL。然后循环，用<code class="fe na nb nc nd b">request_data(URL)</code>获取数据，用<code class="fe na nb nc nd b">extract_data(data)</code>解析数据，然后生成下一个要处理的URL。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/331bd94cfd3f5c11b4a950d98d28c1f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*616VVIflIB9eF_1EcwwX1g.png"/></div></figure><p id="232a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">Extract_data</code>将发布URL记录到特定文件，并返回上一篇文章的名称和ID，以生成下一个查询字符串。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/c33d5a598bedc7bd57ac2b0f60af25b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pl1Jju9VUYhig3pPOKCBTQ.png"/></div></div></figure><p id="0bb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，<code class="fe na nb nc nd b">request_data</code>使用请求模块获取数据并返回JSON主体。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/d53bffa041786a9506b4064ce681dfea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*e9cV0g0Ea0Lt83rJAetr6Q.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5182" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="895c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">就是这样。花了30分钟的时间，我生成了一些非常难看的代码，节省了我手动复制和粘贴所有数据的时间。</p><p id="653f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">张贴如此丑陋的代码并发表在<em class="mz"> Better Programming，</em>上可能看起来很奇怪，但这里的要点是，有时编写漂亮代码的价值并不存在。我写这段代码是为了一次性提取一些数据。如果我需要更长时间的支持，我会花一些时间来做适当的错误处理和类型检查。但是这很有效，而且总体上节省了我的时间——这是我在这里所关心的。</p><p id="704a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我将指出，如果我更好地关注我之前所做的事情，我会节省20分钟来编写请求和生成URL的代码。在我研究的时候，我曾经尝试改变另一个端点的限制，但是没有成功。然而，这个端点是不受限制的，所以我可以简单地预先请求所有的JSON，然后专注于解析它。</p><p id="0eee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个旁注是对互联网上的一切都要半信半疑。Smedian为797种出版物做广告；然而，在我的计数中只有721个，有两个重复的。不知道为什么，但是他们没有回复我的微博。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure></div></div>    
</body>
</html>