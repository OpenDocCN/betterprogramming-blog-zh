<html>
<head>
<title>3 Reasons Why You Shouldn’t Use “for…in” Array Iterations in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中不应使用“for…in”数组迭代的3个理由</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/3-reasons-why-you-shouldnt-use-for-in-array-iterations-in-javascript-8db3f42d8c73?source=collection_archive---------9-----------------------#2021-02-16">https://betterprogramming.pub/3-reasons-why-you-shouldnt-use-for-in-array-iterations-in-javascript-8db3f42d8c73?source=collection_archive---------9-----------------------#2021-02-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bfcb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过理解数组方法的工作原理来避免错误</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8e42f5cb61800065b9052dab9be50bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*23rWzVy1qcQTyfCO"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@isaiahrustad?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Isaiah Rustad </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="b859" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想迭代一个数组，为什么不应该使用下面的代码？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="b3f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，有几个原因。一是官方推荐使用<code class="fe lx ly lz ma b">for…of</code>语句(还有<code class="fe lx ly lz ma b">forEach</code>方法和经典的<code class="fe lx ly lz ma b">for</code>循环)来实现这个目的。但是，使用<code class="fe lx ly lz ma b">for…in</code>进行数组迭代有什么问题呢？</p><p id="5246" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要回答这个问题，我们需要知道<code class="fe lx ly lz ma b">for…in</code>实际上做什么。下面是<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...in" rel="noopener ugc nofollow" target="_blank"> MDN Web文档</a>对此的描述:</p><blockquote class="mb"><p id="b2d5" class="mc md it bd me mf mg mh mi mj mk lu dk translated">"<code class="fe lx ly lz ma b"><strong class="ak">for...in</strong></code> <strong class="ak">语句</strong>遍历一个对象的所有<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Enumerability_and_ownership_of_properties" rel="noopener ugc nofollow" target="_blank">可枚举属性</a>，这些属性由字符串作为关键字。"</p></blockquote><p id="8490" class="pw-post-body-paragraph kz la it lb b lc ml ju le lf mm jx lh li mn lk ll lm mo lo lp lq mp ls lt lu im bi translated">可枚举属性有一个内部可枚举标志<code class="fe lx ly lz ma b">true</code>。例如，通过简单赋值创建的属性就是这种情况。关于属性默认为可枚举的更多细节，请查看MDN条目<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Enumerability_and_ownership_of_properties" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="eeb2" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">问题#1:未定义的顺序</h1><p id="69c9" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">第一个问题是迭代的顺序依赖于实现，所以不能保证元素以特定的顺序迭代。通常，当您思考数组迭代时，默认的假设是迭代以指定的顺序发生(通常从第一个条目到最后一个条目，或者相反)。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="0417" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">问题#2:扩展数组</h1><p id="44b8" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">在JavaScript中，如果给一个索引赋值超过了数组的当前大小，数组会自动扩展。假设我们有一个包含三个元素的数组<code class="fe lx ly lz ma b">let arr = [‘a’, ’b’, ’c’];</code>，并在索引5处分配一个新值:<code class="fe lx ly lz ma b">arr[5] = 'd';</code>。JavaScript将使用<code class="fe lx ly lz ma b">undefined</code>来填补这些空白，因此我们的数组现在看起来像这样:<code class="fe lx ly lz ma b">['a', 'b', 'c', undefined, undefined, 'd']</code>。到目前为止，一切顺利。</p><p id="3bc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是为什么这对我们的迭代技术来说是个问题呢？好吧，让我们比较一下那种情况下<code class="fe lx ly lz ma b">for…of</code>和<code class="fe lx ly lz ma b">for…in</code>的输出:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="4559" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为索引3和4不是数组的可枚举属性。索引5是一个可枚举的属性，因为它是直接赋值的。</p><p id="f58d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据您的用例，这可能是您想要的，也可能不是。然而，它的行为不同于传统的数组迭代，这可能会导致意外。打印的元素数量不再匹配数组的长度。如果你知道你在做什么，并且这正是你想要的用例，使用<code class="fe lx ly lz ma b">for..in</code>。注意它的行为就可以了。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="2d73" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">问题#3:自定义属性</h1><p id="81d2" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">如果出于某种原因，将一个属性添加到数组的原型中，可能会出现另一个问题。这是否是一个好的实践是一个不同的讨论，但是您可能无法完全控制代码运行的环境。</p><p id="cb84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果您正在编写一个其他人可以使用的库，请考虑这样一种情况:其他一些程序员认为为数组添加一个方法可能会有用，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="5e0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><pre class="kj kk kl km gt nu ma nv nw aw nx bi"><span id="ac0e" class="ny my it ma b gy nz oa l ob oc">a<br/>b<br/>c<br/>() =&gt; {...}</span></pre><p id="d689" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里发生了什么？嗯，<code class="fe lx ly lz ma b">flatten</code>现在是我们数组的一个可枚举属性，所以<code class="fe lx ly lz ma b">for…in</code>对它进行迭代。这肯定不是你想要的。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="50b9" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">结论</h1><p id="ea0d" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated"><code class="fe lx ly lz ma b">for…in</code>并不打算在通常意义上迭代数组。所以在大多数情况下，它是错误的工具。但是，在极少数情况下，将它用于此目的可能是个好主意。只要有意识地去做，注意确切的行为，这样你就不会在你的代码中引入任何错误。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="565a" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">参考</h1><ul class=""><li id="8897" class="od oe it lb b lc np lf nq li of lm og lq oh lu oi oj ok ol bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...in" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/JavaScript/Reference/Statements/for...在</a></li><li id="c0fd" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated"><a class="ae ky" href="https://tc39.es/ecma262/#sec-for-in-and-for-of-statements" rel="noopener ugc nofollow" target="_blank">https://tc39.es/ecma262/#sec-for-in-and-for-of-statements</a></li></ul></div></div>    
</body>
</html>