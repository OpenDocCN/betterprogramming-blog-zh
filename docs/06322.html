<html>
<head>
<title>How to Fix Your Mistakes in Git (and Leave No Trace)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Git中修复你的错误(并且不留痕迹)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-fix-your-mistakes-in-git-and-leave-no-trace-8919d112064b?source=collection_archive---------10-----------------------#2020-09-21">https://betterprogramming.pub/how-to-fix-your-mistakes-in-git-and-leave-no-trace-8919d112064b?source=collection_archive---------10-----------------------#2020-09-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d147" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">发现git中的修复工具，以优雅的方式从错误中恢复</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ecda0e884b2c25ed200da650f9b40ee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VoPekCqCcaIjiNOOIC8dQg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Dana Vollenweider 在<a class="ae ky" href="https://unsplash.com/photos/GzYQll7ojIM" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="e2ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你终于找到了:一个老提交的bug！幸运的是，你心中已经有了一个解决方案。所以你只需要在新的提交中修复你的错误，一切都很好，对吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/91b18b85cb225a3d7ed1900c82a04acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S-J1dZJbWLWi6eGju9qTPg@2x.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="32c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不完全是。如果你遵循这个策略一段时间，你的提交历史将会<em class="lw">被这些小小的“创可贴”提交弄得乱七八糟。它们没有任何语义上的意义——而且它们本来就不应该出现在那里！当其他人(或者过一段时间后，您)查看提交历史时，他们会看到有缺陷的原始提交，抓耳挠腮，直到后来，在提交日志的某个地方，发现一个更正了原始提交错误的提交。</em></p><p id="d636" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们能在最初的<em class="lw">提交中纠正我们的错误，那不是很好吗？好消息是:你可以！</em></p><p id="515d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将研究作为Git交互式Rebase命令一部分的修复工具，并了解它如何允许我们修复旧提交中的错误。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="0130" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">关于交互式Rebase的一些话</h1><p id="3cab" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">在我们进入细节和处理一个示例案例之前，我认为先对交互式Rebase做一个非常简单的介绍是有帮助的。</p><p id="0e58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以说交互式Rebase是一套工具，它们都有一个目的:它们允许你在事后纠正你的提交历史。您可以使用交互式Rebase做许多有趣的事情:删除旧的提交、更改它们的消息、合并多个提交等等。我们不会深入这些其他用例，但我会在本文末尾链接一些好的阅读材料。</p><p id="c10c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一个警告:正如我们马上要做的，操纵您的提交历史最好是在还没有在远程存储库上共享的提交上执行。这样做的原因很简单:如果你已经和你的队友分享了提交，那么他们很可能已经把他们的新工作建立在这些提交的基础上了。如果你在事后操纵他们，你可以期待眼泪和脏话。</p><p id="be0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，为了过上长久而快乐的生活，我建议你只在本地提交历史上使用这些工具——在集成到共享团队分支之前使用<em class="lw">。</em></p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="abd5" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">有很多方法可以把事情搞砸</h1><p id="3935" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">正如您无疑知道的，有一百万种方法可以搞乱您的代码。您可能忘记添加文件，或者应该删除一个文件。也许你应该删除一些行或你只是产生了一个错别字！修正工具的美妙之处在于，它并不影响到底发生了什么。我们犯了一个错误，现在我们正在改正。</p><p id="07de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们已经讨论过的，我们的自然倾向是简单地产生一个新的承诺来修复我们的不幸。这种方法的问题是，每次我们这样做，我们的提交历史都会变得越来越脏——以至于很难跟踪和理解。</p><p id="1e5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是这里有一个好消息:使用修正，我们可以像这样继续工作(简单地产生一个包含修正的新提交),但是最后有一个干净的提交历史！</p><p id="2363" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是Fixup如何做到这一点:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/96f00eafd35879767dde83f11a03c95d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cUErQNnS3FDCF69pScaDcQ@2x.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="69fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">神奇的事情发生在第三步:Fixup将难看的创可贴提交中的更改应用于原始的创可贴提交，然后丢弃创可贴提交。我们留下了一个干净的提交历史，没有任何错误的痕迹！</p><p id="0045" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看所有这些在实践中是如何工作的！</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="5612" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">第一步:制作创可贴</h1><p id="b8a3" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">第一步是采取一切必要措施来纠正错误。您将会想要跳入您的编辑器并进行修复。对于我们的例子，假设我们的修正包含在<code class="fe nc nd ne nf b">the-fix.txt</code>中。我们简单地将它添加到暂存区，并像普通提交一样提交它— <em class="lw">几乎</em>:</p><pre class="kj kk kl km gt ng nf nh ni aw nj bi"><span id="152e" class="nk mf it nf b gy nl nm l nn no">$ git add the-fix.txt<br/>$ git commit — fixup 2b504bee</span></pre><p id="fe5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里唯一的特色是<code class="fe nc nd ne nf b">commit</code>命令的<code class="fe nc nd ne nf b">--fixup</code>选项。正是在这里，我们提到了我们打算修复的中断的原始提交。您可以按如下方式阅读该命令:“这个新提交将使用散列值<code class="fe nc nd ne nf b">2b504bee</code>修复旧提交。”</p><p id="48b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用Git桌面GUITower来看看我们的提交历史:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/d8147dfd48eab8132eb1e576d4d48985.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWczDIScmyNGbHwDCLaM-g@2x.png"/></div></div></figure><p id="99d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你会看到最新的产品是我们刚刚生产的创可贴。没什么特别的，除了它的提交信息。这是我们想要修复的<em class="lw">旧提交</em>的消息，由<code class="fe nc nd ne nf b">fixup !</code>预先添加。</p><p id="065a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们都设置好了，现在可以开始交互式重建基础会话来执行<em class="lw">实际的</em>修复操作。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="98b9" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">步骤2:用交互式重定基础进行修复</h1><p id="1d7b" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">要开始交互式Rebase会话，我们首先必须再次查看我们的提交历史:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/211ab56075c376539da2d32285b2889d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w2--Y19knmvXC7H15W7gbQ@2x.png"/></div></div></figure><p id="181c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的屏幕截图中选择了我们想要更正的提交。为了能够操作Git历史的这一部分，我们需要至少在错误提交的<em class="lw">父</em>修订版开始交互式Rebase会话！您可以提供提交散列，或者简单地提供在当前头提交之后有多少次提交:</p><pre class="kj kk kl km gt ng nf nh ni aw nj bi"><span id="2da9" class="nk mf it nf b gy nl nm l nn no"># Option (a): provide a specific commit hash:<br/>$ git rebase -i — autosquash 0023cddd</span><span id="fbd9" class="nk mf it nf b gy nr nm l nn no"># Option (b): provide how far behind the HEAD commit it is:<br/>$ git rebase -i — autosquash HEAD~4</span></pre><p id="2525" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论您选择哪种方式，<code class="fe nc nd ne nf b">--autosquash</code>选项是这个工作流程中的另一个重要因素。还记得我们的邦迪承诺被赋予的<code class="fe nc nd ne nf b">fixup !</code>前缀吗？当<code class="fe nc nd ne nf b">autosquash</code>选项发现带有这样前缀的提交时，它<em class="lw">会自动</em>知道需要进行修正。</p><p id="bf65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行上述命令之一后，交互式重建基础会话将启动，您将看到一个类似于以下窗口的编辑器窗口:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/159015c64dd234fe55eeffd5bc367a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yxVQ8yYT6nzKwH1iFEdR9w@2x.png"/></div></div></figure><p id="bbc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文件顶部的行是您刚刚选择的提交(通过提供一个提交散列或HEAD后面的一个范围)。好消息是Git已经为我们完成了所有繁重的工作:它用<code class="fe nc nd ne nf b">fixup</code> action关键字标记了我们的邦迪提交，并将其移动到正确的行。后者需要一个简短的解释:<code class="fe nc nd ne nf b">fixup</code>动作关键字通过将带标记的提交(这里:第2行)与之上的提交<em class="lw">(这里:第1行)结合起来工作。由于Git已经知道了创可贴和最初的错误提交，它已经为我们准备好了一切。</em></p><p id="3359" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了保存这个编辑器窗口，然后关闭它之外，我们别无选择。然后，交互式Rebase会话结束，留给我们以下场景:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/d7ac14a209df545894df97cfc70959fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQU46VQyPJV0u0cE_DI5_Q@2x.png"/></div></div></figure><p id="7e99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有两件事值得注意:</p><ol class=""><li id="4fdc" class="nu nv it lb b lc ld lf lg li nw lm nx lq ny lu nz oa ob oc bi translated">旧的、错误的提交现在在其变更集中显示<code class="fe nc nd ne nf b">the-fix.txt</code>——就像我们一开始希望的那样！</li><li id="9d64" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated">创可贴承诺没了。Git在将包含的更改应用到原始提交后丢弃了它。</li></ol><p id="bef1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总而言之，我们最初的提交现在是正确的(就像它从未有过错误一样)，我们的提交历史是干净的，没有任何那些难看的邦迪式的提交。</p><p id="c1db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请随意打开上好的香槟，因为这当然是值得庆祝的理由！</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="109d" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">发现交互式Rebase的力量</h1><p id="9a5d" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">我们几乎没有触及交互式Rebase能为您做什么的表面！这是一个非常强大的工具，可以帮助您在Git存储库中生成一个更干净、更清晰的提交历史。</p><p id="e72f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想深入了解，这里有一些(免费)资源可能会有帮助:</p><ul class=""><li id="f410" class="nu nv it lb b lc ld lf lg li nw lm nx lq ny lu oi oa ob oc bi translated">“<a class="ae ky" href="https://www.git-tower.com/learn/git/first-aid-kit?utm_source=betterprogramming&amp;utm_medium=guestpost&amp;utm_campaign=fix-mistakes-using-interactive-rebase-fixup" rel="noopener ugc nofollow" target="_blank">Git急救包</a>”—一系列围绕“用Git纠正错误”的不同用例的短片，包括交互式Rebase。</li><li id="a688" class="nu nv it lb b lc od lf oe li of lm og lq oh lu oi oa ob oc bi translated">一个关于CSS的视频——让自己摆脱困境的技巧。</li></ul><p id="bfca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">享受使用Git提高工作效率的乐趣！</p></div></div>    
</body>
</html>