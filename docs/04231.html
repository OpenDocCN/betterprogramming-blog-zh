<html>
<head>
<title>How to Develop Safer Applications in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Node.js中开发更安全的应用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/developing-safer-applications-in-nodejs-f645788f9c65?source=collection_archive---------6-----------------------#2020-03-31">https://betterprogramming.pub/developing-safer-applications-in-nodejs-f645788f9c65?source=collection_archive---------6-----------------------#2020-03-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1e79" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使我们的节点应用更加安全的措施</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/815d1f45e0ceaf313d7af099fe9a641c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ih8AW1miYJdyNiZN3NWK2A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者照片。</p></figure><p id="f948" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此外，可从以下链接获得API-Rest的模板以及实现的安全选项:</p><div class="lr ls gp gr lt lu"><a href="https://github.com/antonioalfa22/Node-Secure-Rest-Template" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab fo"><div class="lw ab lx cl cj ly"><h2 class="bd ir gy z fp lz fr fs ma fu fw ip bi translated">Antonio alfa 22/Node-Secure-Rest-模板</h2><div class="mb l"><h3 class="bd b gy z fp lz fr fs ma fu fw dk translated">节点JS安全API-Rest模板。为Antonio alfa 22/Node-Secure-Rest-Template开发做出贡献，创建一个…</h3></div><div class="mc l"><p class="bd b dl z fp lz fr fs ma fu fw dk translated">github.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi kp lu"/></div></div></a></div></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><p id="b69e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在开始开发任何类型的应用程序之前，无论是在Node.js中还是在任何其他编程环境中，我们都必须确保我们已经将所有将要使用的库和框架更新到它们的最新稳定版本(除了那些我们需要特定版本的库和框架)。</p><p id="4d27" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">定期更新我们的工作环境至关重要，因为链条的强度取决于其最薄弱的环节。</p></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="3338" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">使用NPM管理包版本</h1><p id="d102" class="pw-post-body-paragraph kv kw iq kx b ky ni jr la lb nj ju ld le nk lg lh li nl lk ll lm nm lo lp lq ij bi translated">为了确保我们没有使用Node.js的未使用版本，我们可以使用<a class="ae nn" href="https://nodejs.org/es/about/releases/" rel="noopener ugc nofollow" target="_blank">他们的官方网站</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/63e0644fc84def8fdca3179f12fe9456.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*r3iiWkKJKgV-NfNtu1NCYQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自<a class="ae nn" href="https://nodejs.org/es/about/releases/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>。</p></figure><p id="6177" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要管理我们在项目中使用的包，我们可以使用NPM:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="1ba1" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">使用TLS(传输层安全性)</h1><p id="6709" class="pw-post-body-paragraph kv kw iq kx b ky ni jr la lb nj ju ld le nk lg lh li nl lk ll lm nm lo lp lq ij bi translated">HTTPS协议是TLS加密在web服务和应用程序中使用的HTTP协议上的直接实现。</p><p id="308a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了能够在Node.js和Express的应用程序中使用HTTPS，我们需要一个证书来验证我们的作者身份。</p><p id="8294" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae nn" href="https://letsencrypt.org/about/" rel="noopener ugc nofollow" target="_blank">让我们加密</a>是一个开放的认证机构(CA)，我们可以免费使用(大部分是付费的)。</p><p id="adaa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在Express.js中使用HTTPS:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="5f7d" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">当心HTTP默认头</h1><p id="0987" class="pw-post-body-paragraph kv kw iq kx b ky ni jr la lb nj ju ld le nk lg lh li nl lk ll lm nm lo lp lq ij bi translated">用Node.js和Express做应用时，增加了一个名为<code class="fe nr ns nt nu b">X-Powered-By: Express</code> <strong class="kx ir"> <em class="nv"> </em> </strong>的HTTP头。它可能成为攻击我们应用程序的媒介，因为知道使用了哪些技术会使攻击者的工作变得容易得多。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/475a039127f509a00504487609514168.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*5Uc5Zqw2J8j_Q-mz1p1org.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">HTTP默认头。</p></figure><p id="667f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Express有一个名为<a class="ae nn" href="https://helmetjs.github.io/" rel="noopener ugc nofollow" target="_blank">头盔</a> <strong class="kx ir"> </strong>的包，它允许我们修改我们希望我们的应用程序显示的标题，并删除默认的<code class="fe nr ns nt nu b">X-Powered-By</code>标题。</p><p id="928c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，运行:</p><pre class="kg kh ki kj gt nx nu ny nz aw oa bi"><span id="7add" class="ob mr iq nu b gy oc od l oe of">npm i helmet</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="f091" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">默认情况下，头盔启用了以下选项:</p><ul class=""><li id="f7d3" class="og oh iq kx b ky kz lb lc le oi li oj lm ok lq ol om on oo bi translated"><a class="ae nn" href="https://helmetjs.github.io/docs/dns-prefetch-control" rel="noopener ugc nofollow" target="_blank"> dnsPrefetchControl </a>控制浏览器DNS预取。</li><li id="c9c8" class="og oh iq kx b ky op lb oq le or li os lm ot lq ol om on oo bi translated"><a class="ae nn" href="https://helmetjs.github.io/docs/frameguard/" rel="noopener ugc nofollow" target="_blank">框架保护装置</a>用于防止点击千斤顶。</li><li id="4ff4" class="og oh iq kx b ky op lb oq le or li os lm ot lq ol om on oo bi translated"><a class="ae nn" href="https://helmetjs.github.io/docs/hide-powered-by" rel="noopener ugc nofollow" target="_blank">被</a>隐藏电源，移除<code class="fe nr ns nt nu b">X-Powered-By</code>割台。</li><li id="3d15" class="og oh iq kx b ky op lb oq le or li os lm ot lq ol om on oo bi translated"><a class="ae nn" href="https://helmetjs.github.io/docs/hsts/" rel="noopener ugc nofollow" target="_blank"> hsts </a>用于HTTP严格的传输安全。</li><li id="3e06" class="og oh iq kx b ky op lb oq le or li os lm ot lq ol om on oo bi translated"><a class="ae nn" href="https://helmetjs.github.io/docs/ienoopen" rel="noopener ugc nofollow" target="_blank"> ieNoOpen </a>为IE8+设置X-Download-Options。</li><li id="9a58" class="og oh iq kx b ky op lb oq le or li os lm ot lq ol om on oo bi translated"><a class="ae nn" href="https://helmetjs.github.io/docs/dont-sniff-mimetype" rel="noopener ugc nofollow" target="_blank"> noSniff </a>防止客户端嗅探MIME类型。</li><li id="fc00" class="og oh iq kx b ky op lb oq le or li os lm ot lq ol om on oo bi translated">xssFilter 增加了一些小的XSS保护。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/91c15ec64b1deb1bcb9cfe66b956901d.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*d2emmeyz_1STdzbAnZHt2g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">HTTP用头盔更新了标题。</p></figure></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="beda" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">限制请求以避免暴力攻击</h1><p id="a819" class="pw-post-body-paragraph kv kw iq kx b ky ni jr la lb nj ju ld le nk lg lh li nl lk ll lm nm lo lp lq ij bi translated">暴力攻击和DDoS攻击在网络上非常常见，会影响我们的应用程序。</p><p id="bce7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于Express和Node.js，有几个包允许我们限制某个IP地址或用户对某些路由产生的访问次数，并在一段时间内阻止它们的访问。</p><p id="2c4a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这种情况下，我们将解释<strong class="kx ir"> <em class="nv"> </em> </strong>快速限速套餐是如何工作的。</p><p id="d1d2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，运行:</p><pre class="kg kh ki kj gt nx nu ny nz aw oa bi"><span id="ad57" class="ob mr iq nu b gy oc od l oe of">npm i express-rate-limit</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/acc5464e6fd69526d3825afb9f414019.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*oSCBa-HI6R_wwUkeNH3kXw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">默认极限响应。</p></figure></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="cf8c" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">代币和饼干</h1><p id="4ef0" class="pw-post-body-paragraph kv kw iq kx b ky ni jr la lb nj ju ld le nk lg lh li nl lk ll lm nm lo lp lq ij bi translated">如果我们要开发一个API-Rest，我们建议使用<a class="ae nn" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank"> JWT </a> (JsonWebToken)来代替cookie，因为API现在也被比传统的不支持cookie的浏览器简单得多的HTTP客户端使用。</p><p id="69a1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们的应用程序需要使用cookie进行会话管理，为了确保cookie不会打开应用程序进行攻击，请不要使用默认的会话cookie名称，并正确设置cookie安全选项。</p><p id="c151" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于Node.js，有两个主要的cookie会话模块:</p><ul class=""><li id="9856" class="og oh iq kx b ky kz lb lc le oi li oj lm ok lq ol om on oo bi translated"><a class="ae nn" href="https://www.npmjs.com/package/express-session" rel="noopener ugc nofollow" target="_blank">快速会议</a></li><li id="ba72" class="og oh iq kx b ky op lb oq le or li os lm ot lq ol om on oo bi translated"><a class="ae nn" href="https://www.npmjs.com/package/cookie-session" rel="noopener ugc nofollow" target="_blank"> cookie会话</a></li></ul><p id="01af" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这两个模块的主要区别在于它们如何从cookies中保存会话数据。快速会话中间件将会话数据存储在服务器上。它只在cookie本身中存储会话ID，而不是会话数据。</p><p id="0af4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">另一方面，cookie会话中间件实现了基于cookie的存储:它序列化cookie中的整个会话，而不仅仅是一个会话密钥。</p><p id="0c66" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是一个使用express-session重命名会话cookie的示例:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="b10a" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">其他考虑</h1><ul class=""><li id="f636" class="og oh iq kx b ky ni lb nj le ow li ox lm oy lq ol om on oo bi translated">安全正则表达式:【https://www.npmjs.com/package/safe-regex】<a class="ae nn" href="https://www.npmjs.com/package/safe-regex" rel="noopener ugc nofollow" target="_blank"/></li><li id="6e75" class="og oh iq kx b ky op lb oq le or li os lm ot lq ol om on oo bi translated">https://www.npmjs.com/package/csurf<a class="ae nn" href="https://www.npmjs.com/package/csurf" rel="noopener ugc nofollow" target="_blank">CSRF保护:</a></li></ul></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="2b70" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">参考</h1><ul class=""><li id="57d0" class="og oh iq kx b ky ni lb nj le ow li ox lm oy lq ol om on oo bi translated"><a class="ae nn" href="https://expressjs.com/es/advanced/best-practice-security.html" rel="noopener ugc nofollow" target="_blank">https://express js . com/es/advanced/best-practice-security . html</a></li><li id="a683" class="og oh iq kx b ky op lb oq le or li os lm ot lq ol om on oo bi translated">【https://www.sitepoint.com/how-to-use-ssltls-with-node-js/ T4】</li><li id="f47a" class="og oh iq kx b ky op lb oq le or li os lm ot lq ol om on oo bi translated"><a class="ae nn" href="https://blog.risingstack.com/node-js-security-checklist/" rel="noopener ugc nofollow" target="_blank">https://blog.risingstack.com/node-js-security-checklist/</a></li><li id="1a4f" class="og oh iq kx b ky op lb oq le or li os lm ot lq ol om on oo bi translated"><a class="ae nn" href="https://www.npmjs.com/advisories" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/advisories</a></li><li id="cfad" class="og oh iq kx b ky op lb oq le or li os lm ot lq ol om on oo bi translated"><a class="ae nn" href="https://letsencrypt.org/about/" rel="noopener ugc nofollow" target="_blank">https://letsencrypt.org/about/</a></li></ul></div></div>    
</body>
</html>