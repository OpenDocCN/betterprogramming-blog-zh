<html>
<head>
<title>Build a 3D Pie Chart Using SceneKit and SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SceneKit和SwiftUI构建3D饼图</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-3d-pie-chart-using-scenekit-and-swiftui-423f24fc765a?source=collection_archive---------12-----------------------#2022-07-01">https://betterprogramming.pub/build-a-3d-pie-chart-using-scenekit-and-swiftui-423f24fc765a?source=collection_archive---------12-----------------------#2022-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6d17" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">交互式三维饼图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/065db37c1b3c99abba822aa7ff6fb228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MLsecPutmjXykiEXS0Gpmg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">交互式三维饼图</p></figure><p id="01c7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上个月，在苹果宣布WWDC 2022的图表之前，我写了一篇关于<a class="ae lu" href="https://medium.com/p/789a2631ef6f" rel="noopener">使用SceneKit </a>创建3D条形图的文章。我向你保证，这完全是巧合。一篇受到好评的论文。</p><p id="1b0a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，本月用SceneKit构建3D饼图时，给予相同的待遇是完全合理的。除此之外，这也是一个很好的借口来仔细研究SceneKit框架的其他几个方面，在过去的一两个月里，我已经就这个主题写了六篇文章，但是还没有涉及到这些方面。</p><h2 id="8ffb" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">乐计划</h2><p id="9af5" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">接下来的计划是使用我在这篇<a class="ae lu" href="https://medium.com/analytics-vidhya/shapes-with-paths-using-swiftui-part4-954853cd47c9" rel="noopener">文章</a>中谈到的数学来为一个<code class="fe mt mu mv mw b">SCNShape</code>节点构建路径。我将使用我在SceneKit <a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/build-a-3d-bar-chart-in-scenekit-with-swiftui-789a2631ef6f">文章</a>中为这个3D条形图开发的代码制作一个演示应用程序。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="087a" class="ne lw it bd lx nf ng nh ma ni nj nk md jz nl ka mg kc nm kd mj kf nn kg mm no bi translated">编码</h1><p id="f346" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">我以so开头..当然，通过寻找一个<code class="fe mt mu mv mw b">SCNShape</code>实现的好例子。第一个目标是用这里展示的基本代码构建一个切片。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2a11165a06d8de29b30cf769cc71a19a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NZfrXNuNl2lyTugapFN8YQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一片馅饼</p></figure><p id="449e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，尽管苹果称之为贝塞尔路径，但它似乎只不过是一条路径。你可以查看我写的关于贝塞尔路径的更多信息，这里是<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/using-bezier-curves-in-swiftui-9d080657fb15"/>，<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/using-de-casteljaus-algorithm-bezier-curves-in-swiftui-3dcadd62635e">这里是</a>，这里是<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/a-better-bezier-curve-a-polynomial-in-swiftui-e0807e9cc214">这里是</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="4b32" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">bon——我给自己设定的下一个挑战是构建一个完整的切片饼——另一个看起来像这样相当容易的胜利。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/465606f96bd51b1d913b2dbb5aaed69f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*K22WAgmcIKRnVDY6yYPUrg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">三维饼图</p></figure><h1 id="74de" class="ne lw it bd lx nf nr nh ma ni ns nk md jz nt ka mg kc nu kd mj kf nv kg mm no bi translated">分离切片</h1><p id="4dd1" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">好吧，但你我都知道大多数馅饼都想拿一片做个例子，比如说最大的一片——事实上，许多馅饼都拿所有的部分做个例子。一个需要一段时间来完善的问题。简而言之，对于每个切片，我查看中心线，计算偏移并创建偏移切片。</p><pre class="kj kk kl km gt nw mw nx ny aw nz bi"><span id="99fa" class="lv lw it mw b gy oa ob l oc od">let r = startAngle - ((startAngle - endAngle) / 2)<br/>let radians4 = Double(r) * Double.pi / 180.0<br/>osx = Double(center.x) + Double(radius.width / 4) * Double(cos(radians4))<br/>osy = Double(center.y) + Double(radius.height / 4) * sin(radians4)<br/>os.append(CGPoint(x: osx, y: osy))</span></pre><p id="cf39" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我添加了几个订阅来通过我的SwiftUI HUD运行动画，并包括了图例和文本标签。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe nq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用SceneKit &amp; SwiftUI构建的3D饼图</p></figure><p id="80a3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您看到的是一系列永无止境的SCNTransactions，它们在每个切片的两个可能位置之间执行SCNMorphs。</p><h1 id="9400" class="ne lw it bd lx nf nr nh ma ni ns nk md jz nt ka mg kc nu kd mj kf nv kg mm no bi translated">调整切片大小</h1><p id="df64" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">现在，最后一个挑战是根据命令调整切片的大小。我很快发现，这项工作比我在当前设计中想象的要难。我使用<code class="fe mt mu mv mw b">SCNMorph</code>方法编写的初始代码悲惨地失败了，出现了严重的崩溃。</p><p id="ce22" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">错误:变形:目标顶点数与基础顶点数不匹配(268！= 258) </strong></p><p id="a058" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">问题是如果你使用变形，形状的几何形状<strong class="la iu">必须</strong>匹配，因为它们需要有相同数量的顶点。我的初始代码有一个问题，因为使用的数字顶点是它所代表的值的反映，所以更大的切片有更多的度数。</p><p id="4113" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我停下来写了一两个小时的代码，勾画了一些如何解决这个问题的想法。最终的修复比我最初想象的要简单得多。我做的修改是将这条线添加到创建贝塞尔路径的循环中。</p><pre class="kj kk kl km gt nw mw nx ny aw nz bi"><span id="7449" class="lv lw it mw b gy oa ob l oc od"><strong class="mw iu">let steps = (endAngle - startAngle) / 16</strong></span></pre><p id="c65e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完成后，我可以在不同的饼图切片之间快速变换，尽管这样做的效果有点奇怪。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b67937f3bf52329090abc1e627f3d5bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Sc877tt3sXBIbYlyeUwO7g.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">三维饼图，动态调整大小</p></figure><h1 id="5429" class="ne lw it bd lx nf nr nh ma ni ns nk md jz nt ka mg kc nu kd mj kf nv kg mm no bi translated">排序切片</h1><p id="1f5a" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">我决定看看如果我整理我的馅饼，事情会不会变得更好。和以前一样，这是我添加到更改方法中的一行程序。</p><pre class="kj kk kl km gt nw mw nx ny aw nz bi"><span id="05c2" class="lv lw it mw b gy oa ob l oc od"><strong class="mw iu">share.pie.sort { $0.value &gt; $1.value }</strong></span></pre><p id="33af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我重新调整了饼图的大小，但是并没有什么不同。我仔细查看了代码十几次，但是我找不到对我稍后将向您展示的行为的解释。如果你能发现问题，请在评论中分享。</p><h1 id="6613" class="ne lw it bd lx nf nr nh ma ni ns nk md jz nt ka mg kc nu kd mj kf nv kg mm no bi translated">实现触摸</h1><p id="898c" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">是的，我确实说过最后一个任务是最后一个，但是在做了修改之后，我决定我也要做touch。现在我尝试用SceneKit域实现了一些东西，这样当你触摸一个切片时，它会移出并移回。</p><p id="ba68" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是——你没有touch[除非你使用主机控制器实现场景]——你必须在SwiftUI中捕捉手势，然后尝试将所述坐标映射回SceneKit。</p><p id="2ff2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尽管我尽了最大努力，但还是没有找到一个好的解决方案——我决定采用一个更简单的方法，使用SwiftUI覆盖；最后的结果相当不错。<br/>在我翻转饼图之前，你可以看到我放置的SwiftUI覆盖图，让你可以选择饼图的一部分。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7ee4edaca4a8f5ead3d22ba282a1bc16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yFacFvY_AfRjX1O_W9pfVQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">交互式三维饼图</p></figure><p id="7cfd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以看到我放置的覆盖图，当我翻转饼图时，它可以让您选择一块饼图。</p><h1 id="3146" class="ne lw it bd lx nf nr nh ma ni ns nk md jz nt ka mg kc nu kd mj kf nv kg mm no bi translated">结论</h1><p id="bcb0" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">和以往一样，一个我认为会很快成功的项目，因为我相信我已经完成了大部分工作，结果比我想象的更具挑战性。</p><p id="5793" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在这里下载完整的代码<a class="ae lu" href="https://github.com/wizard1066/Pie" rel="noopener ugc nofollow" target="_blank"/>——注意，我还没有清理它。就是你在上一张动画GIF里看到的版本。</p></div></div>    
</body>
</html>