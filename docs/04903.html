<html>
<head>
<title>Why Don’t My Pods Compile With Mac Catalyst and How Can I Solve It?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么我的Pods不能用Mac Catalyst编译，如何解决？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/why-dont-my-pods-compile-with-mac-catalyst-and-how-can-i-solve-it-ffc3fbec824e?source=collection_archive---------8-----------------------#2020-05-20">https://betterprogramming.pub/why-dont-my-pods-compile-with-mac-catalyst-and-how-can-i-solve-it-ffc3fbec824e?source=collection_archive---------8-----------------------#2020-05-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="32b6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在iOS应用中使用Mac Catalyst解决“for architecture x86 _ 64c lang:error:linker command failed with exit”</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/979ef08f999035cae6155e62990ed7bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mmgccpsFCOc_kH4bCu8BpQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@matthewhenry?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马太·亨利</a>在<a class="ae ky" href="https://unsplash.com/s/photos/sad?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="af06" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">概观</h1><p id="091b" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">前段时间，我发表了一篇关于这个话题的<a class="ae ky" href="https://medium.com/better-programming/macos-catalyst-debugging-problems-using-catalyst-and-cocoapods-579679150fa9" rel="noopener">文章</a>。我试图解释为什么你的项目在点击新Mac复选框后无法在你的笔记本电脑上编译:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/f2b4f6dad5d356baf5e84712a1d095f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ApK6lO4Sss91DeuRF1s3Iw.png"/></div></div></figure><p id="bd6e" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">从那以后，我得到了你们许多人的反馈，我注意到了一些值得一提的额外问题，这些问题是我当时没有考虑到的。在这篇文章中，我将完成第一篇文章，并深入探讨问题的根源。我将把本教程分为三个部分:</p><ul class=""><li id="fdc8" class="na nb it ma b mb mv me mw mh nc ml nd mp ne mt nf ng nh ni bi translated">建筑问题</li><li id="c63b" class="na nb it ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">App Store提交问题</li><li id="1071" class="na nb it ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">自动化解决方案</li></ul><p id="2472" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">你可以在这里找到原文:“<a class="ae ky" href="https://medium.com/better-programming/macos-catalyst-debugging-problems-using-catalyst-and-cocoapods-579679150fa9" rel="noopener">在你的iOS应用中支持macOS Catalyst:使用不是为macOS编译的Pods】。”</a></p><p id="84b3" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">如果您对最终的解决方案感兴趣，请跳过前两个部分，找到可以一劳永逸地解决您的问题的脚本的链接。</p><p id="5671" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">注意:该脚本只是配置您的Pods项目，但是您必须确保您没有导入和使用不支持的库用于<a class="ae ky" href="https://developer.apple.com/design/human-interface-guidelines/ios/overview/mac-catalyst/" rel="noopener ugc nofollow" target="_blank"> Mac Catalyst </a>。也就是说，如果框架不支持Mac架构，您就不能将其用于Mac Catalyst。尽管如此，你肯定可以在iOS和iPadOS上删除这些功能，所以如果你愿意在Mac上删除这些功能，那就继续读吧。</p><p id="274b" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">你只需要做:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="3dac" class="nt lh it np b gy nu nv l nw nx">#if !targetEnvironment(macCatalyst) <br/>import UnsupportedLibrary<br/>#endif</span><span id="70b2" class="nt lh it np b gy ny nv l nw nx">func dummy() {<br/>    #if !targetEnvironment(macCatalyst) <br/>    // some call to UnsupportedLibrary<br/>    #endif<br/>}</span></pre></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="4a58" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">建筑问题</h1><p id="6071" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如果你已经点击了Mac复选框，将你的iOS应用程序移植到macOS上，并尝试在Mac上运行该应用程序，你会注意到移植并不像想象的那么简单。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/1da35cfd0d7aecea3e3c0bdac6ab0e08.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*2l6wyfq8_v8wLJjktaedYA.png"/></div></figure><p id="f1cb" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">你会发现两种不同的错误:链接错误和编译错误。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/9eceb835a742ca6ffaa3d72792ecd86a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BqT1eVwJMWV030FDEc_8EA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">链接错误</p></figure><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="fedc" class="nt lh it np b gy nu nv l nw nx">ld: in Pods/Crashlytics/iOS/Crashlytics.framework/Crashlytics(CLSInternalReport.o), building for Mac Catalyst, but linking in object file built for iOS Simulator, file 'Pods/Crashlytics/iOS/Crashlytics.framework/Crashlytics' for architecture x86_64clang: error: linker command failed with exit code 1 (use -v to see invocation)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/112a25170721540a491373cd8b8201a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*uTJaH17JFlGZZoGvmS1JxA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">编译错误</p></figure><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="264d" class="nt lh it np b gy nu nv l nw nx">Undefined symbols for architecture x86_64:<br/>    "_OBJC_CLASS_$_UIWebView", referenced from:<br/>    objc-class-ref in BNCDeviceInfo.o<br/>    objc-class-ref in BranchViewHandler.o<br/>ld: symbol(s) not found for architecture x86_64<br/>clang: error: linker command failed with exit code 1 (use -v to see invocation)</span></pre><h2 id="5800" class="nt lh it bd li oc od dn lm oe of dp lq mh og oh ls ml oi oj lu mp ok ol lw om bi translated">为什么会这样？</h2><p id="88d1" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">您正在使用的一些Pods，或它们的任何依赖项，不是或不能针对Mac架构(即x86_64)进行编译。所以静态库不会链接，动态框架不会编译。</p><h2 id="2832" class="nt lh it bd li oc od dn lm oe of dp lq mh og oh ls ml oi oj lu mp ok ol lw om bi translated">我该如何解决这个问题？</h2><p id="58cc" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">您可以确定哪些Pod目标不应包含在Mac Catalyst版本中，并手动删除它们。假设您已经将<code class="fe on oo op np b">FBSDKCoreKit</code>包含在您的<code class="fe on oo op np b">Podfile</code>中。你需要进入你的Pods项目，找到<code class="fe on oo op np b">FBSDKCoreKit</code>目标，进入构建设置<em class="oq">、</em>并查找OTHER_LDFLAGS。在这里，您需要过滤所有那些您标识为仅iOS的依赖项，以便它们不会链接到macOS架构:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/ba8b94fc82b21f831cb3cc352de4d356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2p_A5tWWo0e9hw08YiHhw.png"/></div></div></figure><p id="0f4a" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">然后，转到“构建阶段”选项卡，将iOS作为平台过滤器添加到:</p><ul class=""><li id="afce" class="na nb it ma b mb mv me mw mh nc ml nd mp ne mt nf ng nh ni bi translated">属国</li><li id="6e8c" class="na nb it ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">头球</li><li id="46b6" class="na nb it ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">编译源代码</li><li id="d4fa" class="na nb it ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">双星</li><li id="837e" class="na nb it ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">捆绑资源</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/9804f1fc33784d2d4232cf04ab3f6b1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LcpMO2XNs4czDebeMTXYtQ.png"/></div></div></figure><p id="e628" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">就这些吗？我们还没开始呢！对于任何其他已安装的pod以及自动生成的目标Pod-myapp target 1、Pod-myapp target 2等不需要的Pod可能具有的任何依赖项(在本例中，它没有任何依赖项)，您必须重复相同的过程。根据库的Podspec是如何定义的，链接可能在Pod的目标或自动生成的“Pods-”目标中。</p><p id="c114" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">这就是上一篇文章所涉及的内容:运行和归档。但是提交到App Store呢？</p><h2 id="6aa0" class="nt lh it bd li oc od dn lm oe of dp lq mh og oh ls ml oi oj lu mp ok ol lw om bi translated">App Store提交问题</h2><p id="c7ef" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">存档过程不同于运行过程。到目前为止，我们还没有编译pod目标构建阶段中定义的源代码、资源、框架和头文件。我们还取消了不支持的库的链接。这很好，但是还有一个额外的问题。如果您试图在此时将您的应用程序提交到App Store，您会遇到类似如下的错误:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="2fa5" class="nt lh it np b gy nu nv l nw nx">ERROR ITMS-90276: "Missing Bundle Identifier. The application bundle contains a tool or framework ${PRODUCT_NAME} [com.myapp.myapp.pkg/Payload/MyApp.app/Contents/Resources/GoogleSignIn.bundle] that is missing the bundle identifier in its Info.plist file."</span></pre><h2 id="0373" class="nt lh it bd li oc od dn lm oe of dp lq mh og oh ls ml oi oj lu mp ok ol lw om bi translated">为什么会这样？</h2><p id="6efa" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如果你进入你的项目文件夹并导航到<code class="fe on oo op np b">Pod/Target Support Files/Pods-MyAppTarget</code> <em class="oq"> </em>，你会看到一个名为<code class="fe on oo op np b">Pods-MyAppTarget-frameworks.sh</code>的bash脚本。如果有任何资源要安装在归档文件中，您可能会看到另一个名为<code class="fe on oo op np b">Pods-MyAppTarget-resources.sh</code>的脚本。这两个脚本是在应用程序的目标构建阶段调用的，步骤如下:</p><ul class=""><li id="3ba4" class="na nb it ma b mb mv me mw mh nc ml nd mp ne mt nf ng nh ni bi translated">[CP]嵌入式Pods框架</li><li id="9d2c" class="na nb it ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">[CP]复制Pods资源</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/f1fabfbc721e33e6e570ab2ade74f8fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RcCBHLdZuhv3UMfD06mhPA.png"/></div></div></figure><p id="da5f" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">第一步将把框架包含到归档中，第二步将包含捆绑包资源。框架可能带有预编译的依赖项，其中包含捆绑包资源，因此两个脚本都可能在Mac应用程序归档中包含不必要的未签名捆绑包资源。</p><h2 id="ec96" class="nt lh it bd li oc od dn lm oe of dp lq mh og oh ls ml oi oj lu mp ok ol lw om bi translated">我该如何解决这个问题？</h2><p id="04c5" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">您可以打开这两个脚本，查找不应该包含的资源或框架，并修改脚本，使它们不为Mac架构安装:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="d367" class="nt lh it np b gy nu nv l nw nx">if [[ "$CONFIGURATION" == "Release" ]]; then<br/>    if [ "$ARCHS" != "x86_64" ]; then<br/>        install_framework "${BUILT_PRODUCTS_DIR}/FBSDKCoreKit/FBSDKCoreKit.framework"<br/>    fi<br/>fi</span></pre><p id="9ed7" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">对于框架和:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="f11f" class="nt lh it np b gy nu nv l nw nx">if [[ "$CONFIGURATION" == "Release" ]]; then<br/>    if [ "$ARCHS" != "x86_64" ]; then<br/>        install_resource "${PODS_ROOT}/GoogleSignIn/Resources/GoogleSignIn.bundle"<br/>    fi<br/>fi</span></pre><p id="22ec" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">为了资源。如果再次存档，请转到生成的文件，右键单击以显示其内容。您可以通过导航到Product/Applications/MyApp/Contents/Frameworks和Product/Applications/MyApp/Contents/Resources并验证这两个文件夹不包含框架或资源来检查这一点。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="c39b" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">自动化解决方案</h1><p id="1412" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">所有这些过程看起来都是严酷且不可持续的。这就是为什么我一直在用Ruby编写一个脚本来一次性解决所有这些问题。您只需要将脚本包含在项目文件夹中，并从您的<code class="fe on oo op np b">Podfile</code>中调用它:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="fadc" class="nt lh it np b gy nu nv l nw nx">##### Inside your Podfile #####</span><span id="b7d8" class="nt lh it np b gy ny nv l nw nx">load 'remove_unsupported_libraries.rb'</span><span id="f293" class="nt lh it np b gy ny nv l nw nx">target 'MyAppTarget' do   <br/>    use_frameworks!   <br/>    <br/>    # Install your pods   <br/>    ...<br/>end</span><span id="e993" class="nt lh it np b gy ny nv l nw nx">def unsupported_pods   <br/>    ['Firebase/Crashlytics', 'Firebase/Analytics', ...]<br/>end</span><span id="ef1f" class="nt lh it np b gy ny nv l nw nx">def supported_pods   <br/>    ['SwiftLint', 'Firebase/Auth', 'KeychainSwift', ...]<br/>end</span><span id="1849" class="nt lh it np b gy ny nv l nw nx">post_install do |installer|   <br/>    $verbose = true # remove or set to false to avoid printing<br/>    installer.configure_support_catalyst(supported_pods, unsupported_pods)<br/>end</span></pre><p id="9576" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">你可以在GitHub 上找到剧本<a class="ae ky" href="https://gist.github.com/fermoya/f9be855ad040d5545ae3cb254ed201e4" rel="noopener ugc nofollow" target="_blank">:</a></p><p id="ba55" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated"><strong class="ma iu">注意</strong>:如果你已经在你的应用目标中包含了任何不支持的Pod的脚本阶段，例如<code class="fe on oo op np b">Firebase/Crashlytics</code>，你需要跳过这个Mac架构的脚本:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="d808" class="nt lh it np b gy nu nv l nw nx">if [[$ARCHS != "x86_64"]]; then<br/>  <!-- -->"${PODS_ROOT}/FirebaseCrashlytics/run"<br/>fi</span></pre><h2 id="7147" class="nt lh it bd li oc od dn lm oe of dp lq mh og oh ls ml oi oj lu mp ok ol lw om bi translated">更新</h2><p id="0e0b" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">有关更新和文档，请参见此存储库:</p><div class="ou ov gp gr ow ox"><a href="https://github.com/fermoya/CatalystPodSupport" rel="noopener  ugc nofollow" target="_blank"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd iu gy z fp pc fr fs pd fu fw is bi translated">氧化亚铁/催化剂载体</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">如果你正在使用CocoaPods并且你的应用支持macCatalyst，你可能会遇到这个错误:ld: in…</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">github.com</p></div></div><div class="pg l"><div class="ph l pi pj pk pg pl ks ox"/></div></div></a></div><h2 id="7886" class="nt lh it bd li oc od dn lm oe of dp lq mh og oh ls ml oi oj lu mp ok ol lw om bi translated">找到新的问题了吗？</h2><p id="aece" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如果您遇到任何反馈或问题，请不要犹豫。多亏了你的评论，我才得以升级并继续维护它。</p></div></div>    
</body>
</html>