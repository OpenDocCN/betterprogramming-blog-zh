# Python 中的赋值与浅拷贝和深拷贝

> 原文：<https://betterprogramming.pub/assignment-vs-shallow-copy-vs-deep-copy-in-python-246ea4d36b3c>

## 以正确的方式复制数据以避免错误

![](img/26549beb6f2c1af128946254a493fa90.png)

照片由[吕山德元](https://unsplash.com/@lysanderyuen?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)在 [Unsplash](https://unsplash.com/s/photos/copy?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄

今天，我们将讨论 Python 中的副本。我们有三种方法可以做这件事。在本文中，您将了解每个操作的作用以及它们的不同之处。

1.  赋值运算符`(=)`
2.  浅拷贝
3.  深层拷贝

# 赋值运算符(=)

```
>>> a = [1, 2, 3, 4, 5]
>>> b = a
```

在上面的赋值操作符的例子中，它没有复制 Python 对象。相反，它将一个内存地址(或指针)从`a`复制到`b`、`(b=a)`。这意味着`a`和`b`指向同一个内存地址。

这里，我们可以使用`id()`方法来获取对象在内存中的地址，并检查两个列表是否指向同一个内存。

```
>>> id(a) == id(b)
True>>> print('id of a - {}, id of b - {}'.format(id(a), id(b)))
id of a - 140665942562048, id of b - 140665942562048
```

因此，在这里，如果您要编辑新列表，它也会在原始列表中得到更新:

```
>>> b.append(6) >>> a
[1, 2, 3, 4, 5, 6]>>> b
[1, 2, 3, 4, 5, 6]
```

因为在存储器中只有该列表的一个实例。

# 浅拷贝

浅层拷贝构造一个新的复合对象，然后(尽可能地)向其中插入对原始对象的引用。

我们有三种不同的方法来创建浅层拷贝:

这里，上述所有列表都包含与原始列表相同的值:

```
>>> print(nums == m1 == m2 == m3)
True
```

但是，每个的内存地址是不同的。

```
>>> print('nums_id - {}, m1_id - {}, m2_id - {}, m3_id = {}'.format(id(nums), id(m1), id(m2), id(m3)))nums_id - 140665942650624, m1_id - 140665942758976, m2_id - 140665942759056, m3_id = 140665942692000
```

这意味着这一次，每个列表的对象都有自己独立的内存地址。

现在我们进入更有趣的部分。如果原始列表是复合对象(例如，列表的列表)，那么在浅层复制之后，新的列表元素仍然引用原始元素。

因此，如果您修改可变元素，比如列表，那么这些变化将会反映在原始元素上。让我们看看下面的例子，以便更好地理解:

正如你在上面的例子中看到的，当我们在新列表中修改内部列表元素时，它也在原始列表中被更新，因为`a[0]`和`b[0]`仍然指向相同的内存地址(原始列表)。

所以，新的列表`b`有自己的内存地址，但是它的元素没有。这是因为，在浅层复制中，不是将列表的元素复制到新对象，而是简单地将引用复制到它们的内存地址。

因此，当我们对原始对象进行更改时，它会反映在复制的对象中，反之亦然。

这是浅抄的一个特点。

# 深层拷贝

深度拷贝构造一个新的复合对象，然后递归地将原始对象的拷贝插入其中。

创建深层副本比较慢，因为您要为所有内容创建新副本。

在这种情况下，它不只是复制复合对象的地址，而是简单地复制原始列表的所有列表元素(简单和复合对象),并为新列表分配不同的内存地址，然后将复制的元素分配给它们。

为了实现深度复制，我们必须导入`copy`模块。并使用`copy.deepcopy()`。

如上所示，原始列表不受影响。

# 结论

浅层复制和深层复制的区别只与复合对象(包含其他对象的对象，如列表或类实例)相关。

我希望你喜欢赋值操作符、浅拷贝和深拷贝的解释。不过，如果你对 Python 中的复制有任何疑问或改进，请在评论区提问。

# 参考

*   [Python 文档](https://docs.python.org/2/library/copy.html)