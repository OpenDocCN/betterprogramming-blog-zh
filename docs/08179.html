<html>
<head>
<title>How To Handle Page Routing in Flutter Using the RouteGenerator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用RouteGenerator处理Flutter中的页面路由</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-handle-page-routing-in-flutter-using-the-routegenerator-ccce288e751c?source=collection_archive---------1-----------------------#2021-04-04">https://betterprogramming.pub/how-to-handle-page-routing-in-flutter-using-the-routegenerator-ccce288e751c?source=collection_archive---------1-----------------------#2021-04-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2cc0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在你的Flutter应用中构建下一级导航</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a690085c33d0c8a865e8dcd5caab26da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CiTAu3JAU-5xLh0s"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@s_hietsch?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Sebastian Hietsch </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="50a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当涉及到多个页面之间的导航时，你无法绕过这种颤动<code class="fe lv lw lx ly b">Navigator</code>。然而，当一遍又一遍地调用相同的页面时，重复的代码会非常烦人。</p><p id="9977" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么不把页面路由移到一个单独的类中，让路由变得更加简单呢？</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="4647" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">基础知识</h1><p id="2ed7" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">例如，为了通过点击按钮跳转到另一个页面，我们使用了Flutter <code class="fe lv lw lx ly b">Navigator</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="9ee9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">Navigator.of(context)</code>使用当前<code class="fe lv lw lx ly b">BuildContext</code>的<code class="fe lv lw lx ly b">Navigator</code>实例。然后使用<code class="fe lv lw lx ly b">push</code>功能在当前页面上放置一个新页面。在这里，创建了一个新的<code class="fe lv lw lx ly b">MaterialPageRoute</code>,它在其构建函数中引用了新页面。</p><p id="75c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">Navigator.of(context)</code>上的可选功能有:</p><ul class=""><li id="8963" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated"><code class="fe lv lw lx ly b">.pop()</code>返回上一页。</li><li id="7984" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><code class="fe lv lw lx ly b">.popUntil((route) =&gt; condition)</code>导航回上一页，直到所需站点出现。</li><li id="976f" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><code class="fe lv lw lx ly b">.pushReplacement(newRoute)</code>用当前页面替换页面。</li><li id="0d98" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><code class="fe lv lw lx ly b">.popAndPushNamed(routeName)</code>与前一个类似，但在此之前，页面导航是用一个字符串唯一标识的。</li><li id="8280" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><code class="fe lv lw lx ly b">.pushNamed(routeName)</code>与前一个类似，但是没有用它替换当前页面。</li></ul><p id="3d7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在假设您不仅想调用一个新页面，还想向它传递值，或者在错误导航的情况下转移到一个错误页面(404)。代码变得混乱，很难很快读懂！</p><p id="bb45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要解决这个问题，生成一个类来处理动态路由。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="e511" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">页面路由是如何工作的？</h1><p id="76eb" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">为了通过单独的类实现路由，必须做三件事。</p><h2 id="ed04" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">1.创建RouteGenerator类</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c2fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个类包含一个静态函数，它被传递给一个<code class="fe lv lw lx ly b">RouteSettings</code>对象并返回一个动态路由。传递的对象的<code class="fe lv lw lx ly b">name</code>属性用于定位要导航的页面并返回相应的对象。</p><h2 id="062c" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">2.在主类中分配RouteGenerator</h2><p id="1ce2" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">为此，必须设置<code class="fe lv lw lx ly b">onGenerateRoute</code>和<code class="fe lv lw lx ly b">initialRoute</code>属性:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="7727" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">3.执行导航</h2><p id="250e" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">现在，可以使用与开始时类似的简化调用来调用新页面。在这种情况下，只需传递新页面的字符串标识符:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="210f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是从页面路由开始的全部工作！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="1332" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">如何传递信息</h1><p id="6a2c" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">直奔主题。下一步传递信息并不难，但是很容易导致错误。因此，做好错误处理尤为重要。</p><p id="4d29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是为了传递信息，首先必须遵循这些步骤。</p><h2 id="02b9" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">1.传递参数</h2><p id="6dcb" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">为了在调用<code class="fe lv lw lx ly b">Navigator</code>对象时传递参数，必须用任何类型的数据填充<code class="fe lv lw lx ly b">arguments</code>参数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="0275" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些可以是原始数据类型，如整数或字符串，也可以是复杂对象。如果要传递几个单项的数据，建议放在一个列表里。</p><h2 id="4657" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">2.流程参数</h2><p id="3751" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在之前创建的<code class="fe lv lw lx ly b">RouteGenerator</code>类中，传递的参数现在可以被提取并传递给新页面。这可以通过以下方式完成:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="35b5" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">3.防止运行时错误</h2><p id="40d3" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">为了避免运行时错误，检查输入的参数是否有效很重要。例如，这可以通过检查类型来实现。例如，如果只允许传递整数值，可以如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5832" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果传递的参数无效，则将<code class="fe lv lw lx ly b">null</code>传递给导航器，新页面不会出现。这比错误消息要好，但对用户没有太大帮助。如果您想知道如何创建错误页面，请查看以下部分。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="11c7" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">如何处理错误</h1><p id="59a5" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">为了在应用内导航时捕捉错误，我们添加了错误查询。现在，将用户重定向到错误页面只需要几个简单的步骤。</p><h2 id="eecd" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">1.创建错误页面</h2><p id="8cff" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">要显示错误页面，我们需要创建一个错误页面。这可以在一个单独的类中完成，也可以直接在我们之前创建的<code class="fe lv lw lx ly b">RouteGenerator</code>类中完成。如果错误页面很简单，我推荐最后一个选项。</p><p id="91a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于错误页面，我们现在创建一个内部私有函数(<code class="fe lv lw lx ly b">_errorRoute</code>)，它返回一个对象(<code class="fe lv lw lx ly b">Route&lt;dynamic&gt;</code>)。在返回的页面上，我们构造了一个scaffold对象来设置我们的错误消息。这可能如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="65cc" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">2.链接到错误页面</h2><p id="186f" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">现在，为了在每个错误情况下重定向到页面，我们只需要在每个错误时返回<code class="fe lv lw lx ly b">_errorRoute()</code>函数。因此，我们之前创建的<code class="fe lv lw lx ly b">switch-case</code>块将扩展如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="0007" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">3.个性化错误页面</h2><p id="176b" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">当然，也可以在错误页面上为用户提供更多信息。例如，您可以通过尝试传递错误的原因来使错误更加具体。这可能如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="dcce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并且:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="15f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住将传递的错误指定为可选的，如示例中所示，这样在导航到错误页面时就不会出现错误。这有多讽刺？</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="da3c" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">如何弹出页面并传回数据</h1><p id="ae05" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在浏览应用程序或网站时，您通常还想往回导航。这可能发生在三种不同的情况下:</p><ol class=""><li id="2dc7" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu of nl nm nn bi translated">通过使用智能手机上的原生后退按钮。</li><li id="8b75" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu of nl nm nn bi translated">通过使用应用程序栏中的后退按钮。</li><li id="bb7a" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu of nl nm nn bi translated">通过使用<code class="fe lv lw lx ly b">Navigator.pop(context);</code>将此功能赋予按钮。</li></ol><h2 id="d376" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">1.WillPopScope</h2><p id="ddce" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在Flutter中，几乎每个应用程序都有一个小部件。对于条件1和2，可以用<code class="fe lv lw lx ly b">WillPopScope</code>小部件拦截和处理相应的<code class="fe lv lw lx ly b">onWillPop</code>事件。这可能如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5561" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用顶部的<code class="fe lv lw lx ly b">WillPopScope</code>小部件扩展了<code class="fe lv lw lx ly b">_SecondPageState</code>的构建方法。使用<code class="fe lv lw lx ly b">onWillPop</code>属性将在用户想要返回上一页时产生想要的结果。注意<code class="fe lv lw lx ly b">onWillPop</code>中的方法是异步调用的。</p><h2 id="4197" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">2.pop上下文</h2><p id="feca" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">作为<code class="fe lv lw lx ly b">WillPopScope</code>小部件的替代，也可以通过编程切换到上一页。这通常是通过点击按钮来完成的。下面给出一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="218a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">onPressed</code>函数处理按钮点击。在调用<code class="fe lv lw lx ly b">Navigator.of(context).pop();</code>之前，可选任务也可以做。</p><h2 id="412e" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">3.砰的一声然后</h2><p id="f5b0" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在上面的两个例子中，在返回之前，您只能执行第二页中的任务。下面，我想向您展示一种在向后导航后执行上一个类中的操作的方法。</p><p id="55ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您执行基础中介绍的某个函数，比如<code class="fe lv lw lx ly b">.pushNamed()</code>，那么<code class="fe lv lw lx ly b">.then()</code>函数可以在此运算符上执行。在此功能中，可以执行仅在再次向前和向后导航后执行的操作。一个具体的例子如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="2b5d" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">4.传回数据</h2><p id="e2da" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">您可能想知道前面例子中的<code class="fe lv lw lx ly b">value</code>变量传递的是什么。这非常简单:当然，您可以将第二页的数据传递回前一页。这可以通过在调用<code class="fe lv lw lx ly b">.pop()</code>函数时传递除<code class="fe lv lw lx ly b">context</code>之外的另一个对象来实现。该对象可以作为函数调用<code class="fe lv lw lx ly b">.pushNamed()</code>(或类似函数)的返回值来实现，也可以通过<code class="fe lv lw lx ly b">.then()</code>函数作为传递变量来实现。</p><p id="48d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个例子看起来像这样。向前导航时，在首页上:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="33c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">向后导航时在第二页上:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="ca29" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结束语</h1><p id="67a3" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">我希望这篇文章向您展示了如何在Flutter中平稳有效地导航。感谢您的阅读，并期待您对内容的反馈、对新内容的建议以及其他有趣的对话。</p><p id="65c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你有哪些颤振和导航的经验？</p></div></div>    
</body>
</html>