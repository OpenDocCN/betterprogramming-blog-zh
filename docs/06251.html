<html>
<head>
<title>Programmatically Trigger SwiftUI Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以编程方式触发SwiftUI操作</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/programmatically-trigger-swiftui-actions-be2dcb8acf0d?source=collection_archive---------11-----------------------#2020-09-14">https://betterprogramming.pub/programmatically-trigger-swiftui-actions-be2dcb8acf0d?source=collection_archive---------11-----------------------#2020-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1922" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">SwiftUI 2.0中触发代码的不同方式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/137503208cea5ff940a38930b6b29bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KJhqNT2xLCqNdy0q"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">美国宇航局在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片。</p></figure><p id="538c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天的文章讨论了触发代码的不同方式，包括SwiftUI 2.0中新的<code class="fe lv lw lx ly b">onChange</code>操作符。</p><p id="506c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我相信你已经知道如何让SwiftUI自我刷新了。您只需对SwiftUI <code class="fe lv lw lx ly b">@State</code>变量进行更改。但是，如何在视图内部甚至外部触发这种变化呢？让我们探索我们的选择。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="b848" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">案情摘要</h1><p id="f601" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">我希望有一个符号，它是一种在两种状态之间循环的计时器，一个符号切换器，看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/a9a394dd27cd2d724db191892a436c4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/1*ddE9PumyB3r1QPF5HbkSWQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个半黑半白的翻转圈。</p></figure><p id="800d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在这里使用了两个新的SF符号。现在，最简单的解决方案是有一个布尔状态，根据它的值显示两个符号中的一个。下一节将展示如何编写代码。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="69f1" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">选项1</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="31ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它工作并由一个计时器启动/保持，尽管因为计时器本质上与视图相关联，我们对它没有真正的控制。如果不删除视图，或者像我们在这里做的那样，给它添加一个手势，就没有办法打开或关闭它。</p><p id="9307" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然这在很多情况下可能已经足够了，但是我们可能还需要更多。想象一下，我们希望在我们的视图中有一些我们可以打开或关闭的动画——在我们的代码中有一种懒惰的动画视图。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="8198" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">选项2</h1><p id="1bff" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">下面是使用<code class="fe lv lw lx ly b">onAppear</code> / <code class="fe lv lw lx ly b">onDisappear</code>视图修饰符和id视图修饰符(类似于<code class="fe lv lw lx ly b">setNeedsDisplay</code>)的相同代码的第二个例子。我们将这些视图修改器与SwiftUI的<code class="fe lv lw lx ly b">@Binding</code>一起使用，让我们能够打开和关闭事物:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="a495" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">选项3</h1><p id="fac7" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">SwiftUI 2.0还有第三个选项。我们现在可以直接查看视图中bool的值，并在它发生变化时采取措施。但是等等，要小心。这在某些方面相当微妙:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e91f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是可行的，但是让我们把它分解一下，这样我们可以更好地理解这里发生了什么。修改代码，当switcher的值改变时使<code class="fe lv lw lx ly b">onChange</code>翻转，注释掉<code class="fe lv lw lx ly b">if switcher</code>语句。所以，做出你在这里看到的改变。它将会编译——switcher毕竟是swift ui<code class="fe lv lw lx ly b">@State</code>——并且您将能够翻转这些值:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="27cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但它会坏掉的。仔细看看代码就明白为什么第二个版本不行了。尽管我们正在更改SwiftUI <code class="fe lv lw lx ly b">@State</code>变量，但它并不直接链接到视图。</p><p id="a347" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在选项1-3都很好，但是它们都与视图紧密相关。还有别的办法吗？</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="b169" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">选项4</h1><p id="95ca" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">也许我们需要更独立地控制视图的状态，而不需要使用SwiftUI <code class="fe lv lw lx ly b">@Binding</code>。SwiftUI <code class="fe lv lw lx ly b">@Bindings</code>的挑战在于，当您调用依赖于它们的方法时，您需要将它们作为参数包含进来。我相信你可以想象事情失去控制。为了管理具有松散绑定的视图，我们可以使用SwiftUI <code class="fe lv lw lx ly b">@Published</code>和SwiftUI <code class="fe lv lw lx ly b">@Observerable</code>对象。使用这个选项，我们的代码将如下所示。注意，我们必须在这里引入一个类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="093d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它也很好用。事实上，我们可以对SwiftUI <code class="fe lv lw lx ly b">@Environmental</code>对象使用相同的技术。我不会在这里展示这些代码，因为它们几乎完全相同。此外，环境对象的目标是与所有视图共享数据，这在这里几乎是不可能的。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="ed89" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">选项5</h1><p id="fc17" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">我们有第五个选项，尽管我们需要包含Combine框架来使它变得生动。利用这一点，我们可以使这两个视图——一个调用原理，一个显示翻转圆——的耦合更加松散:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e9d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是用您的视图打开和关闭事物的一种极好的方式，并且它可以扩展到您的非SwiftUI代码。</p><p id="b60a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。希望你觉得有用。</p><p id="fca6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保持冷静和编码。</p></div></div>    
</body>
</html>