<html>
<head>
<title>Build the Apple Stocks App Using Flutter (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flutter构建苹果股票应用程序(第1部分)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-apple-stocks-app-using-flutter-part-1-ea1c7477d58d?source=collection_archive---------10-----------------------#2020-01-08">https://betterprogramming.pub/building-apple-stocks-app-using-flutter-part-1-ea1c7477d58d?source=collection_archive---------10-----------------------#2020-01-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="725c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">跨平台股票报价</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/551bc1a48eecd6a7dc34fb4899dffed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JRup1_fm69GFsTuZaSutSw.png"/></div></div></figure><p id="e0e9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在SwiftUI上最近的<a class="ae lq" href="https://medium.com/better-programming/building-apple-stocks-app-using-swiftui-part-1-296169ff4257" rel="noopener">帖子</a>中，我们学习了如何在SwiftUI框架中创建苹果股票应用。</p><p id="02f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于<a class="ae lq" href="https://flutter.dev/" rel="noopener ugc nofollow" target="_blank"> Flutter </a>和SwiftUI有很多相似之处，我们认为使用Flutter框架实现同一个应用是个好主意。</p><p id="5d8a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这篇由多个部分组成的文章中，我们将学习如何创建向用户显示股票的主页。</p><p id="8533" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在以后的文章中，我们将介绍如何为Flutter stocks应用程序实现新闻列表页面。看一下完成的app的截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/9cb0d25e47693fa7569308ab81265666.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*eVkNiFJYwMdSavZptRuEqw.png"/></div></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="079b" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">服务器之旅</h1><p id="f232" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">我们的服务器使用Express.js包在Node中实现，并以JSON的形式返回硬编码的股票。服务器的完整实现如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="366f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">没什么花哨的！</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="258c" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">从JSON Web API获取股票</h1><p id="73b2" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">让我们从实现一个从JSON API获取数据的客户机开始。客户端将有一个单一的方法来获得所有的股票，并返回一个未来的响应。</p><p id="24d9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们使用<a class="ae lq" href="https://pub.dev/packages/http" rel="noopener ugc nofollow" target="_blank"> HTTP </a>包来执行网络请求，但是非常欢迎您使用任何其他的HTTP库。web服务的实现如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="1f2c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">web服务从我们的定制服务器获取股票，然后填充股票模型，该模型稍后作为<code class="fe my mz na nb b">Future&lt;List&lt;Stock&gt;&gt;</code>返回给调用者。</p><p id="005a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">股票模型实现如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="3dea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe my mz na nb b">fromJson</code>工厂方法接受一个<code class="fe my mz na nb b">Map</code>对象，然后基于JSON数据返回一个新的<code class="fe my mz na nb b">Stock</code>实例。</p><p id="232d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们需要在页面上显示股票数据。在我们进入用户界面实现之前，我们需要实现视图模型，它可以保存数据并向视图提供数据。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="ba55" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">实现视图模型</h1><p id="b113" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">视图模型负责携带数据，然后将数据绑定到视图。视图模型可以代表整个页面，甚至包含指向页面目标部分的子视图模型。</p><p id="def5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">视图模型的实现如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="73d5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe my mz na nb b">StockListViewModel</code>代表整个页面，<code class="fe my mz na nb b">StockViewModel</code>代表将在列表中显示的单个股票单元格。</p><p id="cbcc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe my mz na nb b">fetchStocks</code>方法负责使用<code class="fe my mz na nb b">Webservice</code>实例并检索所有股票。</p><p id="f33b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">获取股票后，结果被转换成一个由<code class="fe my mz na nb b">StockViewModel</code>对象组成的数组，并赋给<code class="fe my mz na nb b">StockListViewModel</code>的<code class="fe my mz na nb b">stocks</code>属性。</p><p id="e224" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe my mz na nb b">StockListViewModel</code>还扩展了<code class="fe my mz na nb b">ChangeNotifier</code>类，使其能够通知监听器。一旦触发了<code class="fe my mz na nb b">notifyListeners</code>方法，所有的侦听器都会得到通知，它们可以采取行动。</p><p id="5ee0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于我们的例子，我们希望更新视图，以便它可以显示最新的股票。</p><p id="0b88" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了从变更通知程序获得变更通知，您必须使用<code class="fe my mz na nb b">ChangeNotifierProvider</code>。<code class="fe my mz na nb b">ChangeNotifierProvider</code>是提供商包的一部分。更新<code class="fe my mz na nb b">pubspec.yaml</code>以添加提供者包。</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="4c8a" class="ng ma it nb b gy nh ni l nj nk">dependencies:</span><span id="72c0" class="ng ma it nb b gy nl ni l nj nk">flutter:</span><span id="dc82" class="ng ma it nb b gy nl ni l nj nk">sdk: flutter</span><span id="10d7" class="ng ma it nb b gy nl ni l nj nk"># The following adds the Cupertino Icons font to your application.</span><span id="cf82" class="ng ma it nb b gy nl ni l nj nk"># Use with the CupertinoIcons class for iOS style icons.</span><span id="f6ba" class="ng ma it nb b gy nl ni l nj nk">cupertino_icons: ^0.1.2</span><span id="efac" class="ng ma it nb b gy nl ni l nj nk">http: ^0.12.0+4</span><span id="ba95" class="ng ma it nb b gy nl ni l nj nk">provider: ^4.0.1</span></pre><p id="f956" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，让我们看看如何将<code class="fe my mz na nb b">StockListViewModel</code>实例传递给视图。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="3914" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">在视图中显示股票</h1><p id="fb82" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">为了显示股票，我们必须访问视图中的<code class="fe my mz na nb b">StockListViewModel</code>。我们可以使用<code class="fe my mz na nb b">ChangeNotifierProvider</code>来访问视图模型。</p><p id="6f45" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将把<code class="fe my mz na nb b">StockListViewModel</code>的实例注入到我们的主页部件中。这在如下所示的<code class="fe my mz na nb b">main.dart</code>文件中实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="750c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码确保了<code class="fe my mz na nb b">StockListViewModel</code>实例对<code class="fe my mz na nb b">HomePage</code>及其所有子部件可用。</p><p id="74cb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe my mz na nb b">HomePage</code>小部件中，我们使用<code class="fe my mz na nb b">Provider.of&lt;StockListViewModel&gt;</code>来获取<code class="fe my mz na nb b">StockListViewModel</code>的实例，然后我们在视图模型上调用<code class="fe my mz na nb b">fetchStocks</code>函数。</p><p id="0dad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe my mz na nb b">fetchStocks</code>将从Web API中检索股票，并填充<code class="fe my mz na nb b">StockListViewModel</code>的<code class="fe my mz na nb b">stocks</code>属性。</p><p id="d39b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦设置了<code class="fe my mz na nb b">stocks</code>属性，我们就调用<code class="fe my mz na nb b">notifyListeners</code>方法，该方法使用<code class="fe my mz na nb b">Consumer</code>小部件刷新视图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6d89" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">小部件负责显示股票列表。<code class="fe my mz na nb b">StockList</code>小部件接受一个参数，即股票列表。</p><p id="331c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你想了解更多关于Flutter应用中的数据流，那么看看<a class="ae lq" href="https://medium.com/better-programming/data-flow-and-delegation-in-flutter-apps-1a6fedce90ef" rel="noopener">这篇</a>文章。<code class="fe my mz na nb b">StockList</code>小部件的实现如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="524d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你运行这个应用程序，你将能够看到股票应用程序的运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/9622db2f96b5dcbf55033d19c5029e7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*ed5zfMIrg-hML1WR-FwQRg.png"/></div></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="4536" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">搜索股票</h1><p id="5170" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">目前，在文本字段中键入不做任何事情。我们需要根据用户的输入来过滤股票。搜索功能在<code class="fe my mz na nb b">StockListViewModel</code>中实现，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6850" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在搜索方法中，我们使用<em class="nn"> where </em>特性根据用户输入过滤出股票。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/7f4c854fefe60982105d31ae44344f7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/1*NR5B72na3KBjC_7m-For0Q.gif"/></div></figure><p id="4460" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就是这样！</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="7019" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">结论</h1><p id="9eb2" class="pw-post-body-paragraph ku kv it kw b kx mr ju kz la ms jx lc ld mt lf lg lh mu lj lk ll mv ln lo lp im bi translated">我真的希望你喜欢这篇文章。在第二部分中，我将介绍如何显示来自实时Web API的新闻，并添加拖拽手势来滑动/向下移动新闻视图。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="2bd8" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">资源</h1><ol class=""><li id="a7d7" class="np nq it kw b kx mr la ms ld nr lh ns ll nt lp nu nv nw nx bi translated"><a class="ae lq" href="https://github.com/azamsharp/AppleStocksFlutter" rel="noopener ugc nofollow" target="_blank"> GitHub </a></li><li id="7ed6" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated"><a class="ae lq" href="https://youtu.be/Gz3IEFe5PIw" rel="noopener ugc nofollow" target="_blank">在颤振视频中构建苹果股票</a></li></ol></div></div>    
</body>
</html>