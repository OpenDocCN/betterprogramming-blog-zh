# 8 个非常有用的 SQL 代码片段，你会想把它们放在手边

> 原文：<https://betterprogramming.pub/8-super-useful-sql-snippets-youll-want-to-have-on-hand-5b01fd7c87de>

## 节省您时间的基本 SQL 语句

![](img/a6e0ce04308537d531165b8203073808.png)

照片由[卢卡斯·DC](https://www.pexels.com/@lucasdc?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)从[派克斯](https://www.pexels.com/photo/light-art-pattern-festival-10325707/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)拍摄

一年即将结束，在 2021 年的最后一篇文章中，我留下了八个小技巧，可以在程序员的日常工作中节省你的时间。

有些是基本的，有些可能有点复杂。但我认为它们很方便，所以不浪费更多时间，让我们开始吧。

# 1.按列名搜索重复的行

通过这个简单的查询，我们可以获得具有在`column_name`字段中指定的相同值的行的列表。
另外，我们可以看到它们被重复的次数。

# 2.显示数据库模式的索引

虽然这是可以从数据库客户端看到的，但是我们也可以用 SQL 语句来实现。

# 3.显示 N 个最昂贵的查询

这句话看起来非常复杂，但实际上并不复杂，它向您展示了哪些句子花费了数据库引擎执行的最多时间。

知道哪些 SQL 语句需要检查以确定它们是否可以被优化是很方便的。

# 4.显示是否使用了索引

通常，数据库中的索引数量会随着时间的推移而增加。

你检查过多少次这些索引是否仍然有效？索引会消耗磁盘空间，这在大型表中可能很重要。所以查查哪些在用，看看方便不方便删除，总是很方便的。

首先，您需要启用对索引的监控:

```
ALTER INDEX INDEX_NAME MONITORING USAGE;
```

如果您想禁用监控，您只需执行以下语句:

```
ALTER INDEX INDEX_NAME **NO**MONITORING USAGE;
```

现在，您可以通过查看 *v$object_usage* 视图来使用监控数据:

*   `START_MONITORING`字段指示监控开始的时间。
*   `MONITORING`字段指示指数是否被监控。
*   `USED`字段用“是”字表示自监控激活后是否使用了索引。

在删除任何您认为不使用的索引之前，建议让监视运行一段合理的时间，并考虑可能有使用该索引且不经常执行的批处理进程。

# 5.使用 count (1)而不是 count (*)

尽可能使用`count(1)`而不是`count(*)`。`count(*)`子句考虑表中的所有列来进行计算，而`count(1)`子句只考虑第一列。

请注意，如果使用`count (*)`或`count (1)`，结果没有变化。

使用`count(1)`使数据库引擎使用更少的资源，运行更快。对于小表，这种差异并不明显，但是如果使用大表，这种情况会对查询的性能产生明显的影响。

*注意:这仅在以下情况下有效

# 6.条件式

您可以使用“case when”类(相当于其他编程语言的 if-then-else)在查询中编写条件。

# 7.常用表表达式(CTE)

这种类型的表达式允许您定义一个临时命名的结果集，该结果集在语句的执行范围内(如`SELECT`、`INSERT`、`UPDATE`、`DELETE`或`MERGE`)临时存在于内存中。

该子句也可以在`CREATE VIEW`语句中作为定义它的 SELECT 语句的一部分使用。

CTE 主要允许您替换子查询和表变量。

在子查询的情况下，CTE 不会给你带来任何性能优势，但它会让你有一个更有序和更干净的代码，这有利于代码的可读性。

在表变量的情况下，CTE 为您提供了更好的查询性能，因此它始终是一个更可取的选项。

这个小例子可能没有展示 CTE 的潜力，但是想象一下非常大和复杂的子查询以及代码看起来会是什么样子。

# 8.一遍又一遍(分区依据)

`OVER`子句允许您在不使用`GROUP BY`的情况下获得聚合信息，从而避免了许多复杂情况。例如，您可以检索一组行，并获得它们的聚合数据。

`OVER`子句将整个结果集暴露给聚合，但是您可以使用子句`PARTITION BY`将结果集分成多个分区。

在本例中，分区是由客户端进行的，单个客户端的每个“窗口”都将与其他“窗口”分开处理

# 结论

我们总结了一小组 SQL 片段，它们通常可以节省我的时间，或者对我的日常工作有所帮助。

其中一些可以在 SQL server 中应用，另一些可以在 Oracle 中应用，但是您通常可以在任何其他数据库引擎中找到等效的引擎。

如果你喜欢这篇文章，考虑通过我的[个人资料](https://kesk.medium.com/membership)订阅 Medium。谢谢大家！