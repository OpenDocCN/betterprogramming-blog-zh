<html>
<head>
<title>Securing Your GraphQL Endpoint With Dgraph and Auth0 — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Dgraph和Auth0保护GraphQL端点—第1部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/securing-your-graphql-endpoint-with-dgraph-and-auth0-eb94b935f795?source=collection_archive---------6-----------------------#2022-04-02">https://betterprogramming.pub/securing-your-graphql-endpoint-with-dgraph-and-auth0-eb94b935f795?source=collection_archive---------6-----------------------#2022-04-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="09c7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">设置数据图表</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b169068270ef864ded88b4bbc0c7a0a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tuyw_nMfyxQKR26cB6r5hg.jpeg"/></div></div></figure><blockquote class="kr ks kt"><p id="2729" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一系列文章的第一部分，这些文章将解释如何用一个示例报价应用程序来设置Dgraph。</p><p id="9b25" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="iq">最终目标是建立一个安全的GraphQL端点，您的前端应用程序和后端脚本可以通过JWT查询和修改数据。我们将通过一个简单应用程序的例子来完成设置Dgraph、Auth0和Dgraph with Auth0的所有必要步骤。如果您已经设置了Dgraph并知道如何使用它，您可以安全地跳过这一部分。</em></p></blockquote><h1 id="7537" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">介绍</h1><p id="d584" class="pw-post-body-paragraph ku kv iq kx b ky mj jr la lb mk ju ld ml mm lg lh mn mo lk ll mp mq lo lp lq ij bi translated">随着NoSQL运动的兴起，各种产品出现在大型科技公司的产品目录中——<a class="ae mr" href="https://cloud.google.com/firestore" rel="noopener ugc nofollow" target="_blank">谷歌GCP、</a> <a class="ae mr" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank">亚马逊AWS </a>、<a class="ae mr" href="https://azure.microsoft.com/en-au/services/cosmos-db/" rel="noopener ugc nofollow" target="_blank">微软Azure</a>——他们都看到了以一种新的、非正统的方式存储数据的潜力。灵活性、潜在的规模和易用性使得全世界的开发者创造了一股不可阻挡的新技术浪潮。</p><p id="35b9" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ml lf lg lh mn lj lk ll mp ln lo lp lq ij bi translated">GraphQL也经历了类似的模式。由于越来越多的应用程序变得前端繁重，开发人员开发和维护这些应用程序的需求变得越来越重要。</p><p id="744e" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ml lf lg lh mn lj lk ll mp ln lo lp lq ij bi translated">但是由于阅读这篇文章的人都不想读一篇关于Dgraph是如何产生的文章，所以我将把它留在这里，继续实际的任务。然而，如果你们中的一个想知道更多，请查看Dgraph博客上的<a class="ae mr" href="https://dgraph.io/blog/post/rise-of-gql-db/" rel="noopener ugc nofollow" target="_blank"> @matt tanner的</a>文章。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="33dd" class="lr ls iq bd lt lu mz lw lx ly na ma mb jw nb jx md jz nc ka mf kc nd kd mh mi bi translated">设置数据图表</h1><p id="b8f2" class="pw-post-body-paragraph ku kv iq kx b ky mj jr la lb mk ju ld ml mm lg lh mn mo lk ll mp mq lo lp lq ij bi translated">到目前为止，Dgraph是唯一真正的GraphQL数据库，因此，在我看来，在不远的将来，它是web开发的必备工具。但是在你给他们你所有的钱之前，让我们建立一个<a class="ae mr" href="https://cloud.dgraph.io/login?redirect=/" rel="noopener ugc nofollow" target="_blank">免费测试账户</a>来看看你自己是否会选择Dgraph作为工具！</p><p id="49d8" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ml lf lg lh mn lj lk ll mp ln lo lp lq ij bi translated">注册后，你应该被重定向到你的管理界面，在那里你可以做交互式教程或者直接启动后端。因为开发人员通常都很忙，所以让我们跳过教程，马上启动我们的后端。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/851feb8d7d6c6506cad310d4737211b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gbvv05bSIE58JUKqBb3FCw.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">注册Dgraph后重定向。点击“启动后端”开始。</p></figure><p id="73d3" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ml lf lg lh mn lj lk ll mp ln lo lp lq ij bi translated">我们现在进入集群选择(Dgraph希望您花费一些钱的页面)，在这里我们选择免费共享集群选项。这不会给你带来很多好处(每天1MB的数据传输量和25MB的存储空间),但对于我们将要做的事情来说，这已经足够了。你也可以为你的后端选择一个名字——我选择了<em class="kw">测试引用</em>——但是你可以随意命名。理想情况下，您希望将集群区域设置在您附近的某个地方，但这也不是必须的，因为我们只是在测试。不过，如果你打算以后购买付费版本，你可能现在就要选择合适的地点。点击启动，我们就可以开始了🚀</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/d53c54c6ff5190b6804bae1d74ef6ca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BRVu-GYTrpZzPRC7_APV5g.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">启动一个新的后端。点击“免费”开始。</p></figure><p id="ece3" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ml lf lg lh mn lj lk ll mp ln lo lp lq ij bi translated">你现在看到了相当多的东西，但实际上大多数现在都不重要。让我们从稍后需要的一些基本设置开始。因为我们计划从一个节点环境中运行一些查询，所以我们需要一个客户机密钥用于我们的(不可公开访问的)节点。转到<code class="fe nj nk nl nm b">Settings &gt; API Keys &gt; Create New</code>并选择<code class="fe nj nk nl nm b">Client.</code>，将其命名为<em class="kw">客户端密钥</em>，然后单击创建。</p><blockquote class="kr ks kt"><p id="3f69" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">把钥匙保存在某个地方！不会再放了！</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/3c0c3b211656c856a54be86e73903bb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_U1T9ods1XFUTzb0jT3zfA.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">导航至设置&gt; API密钥&gt;新建以生成客户端密钥。</p></figure></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h2 id="27cb" class="nn ls iq bd lt no np dn lx nq nr dp mb ml ns nt md mn nu nv mf mp nw nx mh ny bi translated">添加模式</h2><p id="c230" class="pw-post-body-paragraph ku kv iq kx b ky mj jr la lb mk ju ld ml mm lg lh mn mo lk ll mp mq lo lp lq ij bi translated">接下来，让我们创建模式！我不会详细介绍如何编写GraphQL模式，所以如果你需要更多信息，我建议你从GraphQL官方网站<a class="ae mr" href="https://graphql.org" rel="noopener ugc nofollow" target="_blank">开始。要创建模式，只需点击导航标签菜单中的<code class="fe nj nk nl nm b">Schema</code>。确保顶部选择了<code class="fe nj nk nl nm b">GraphQL s´Schema</code>(DQL是Dgraph自己的查询语言，是另一篇博客文章的特色)。一旦到了这里，我们就可以开始编写我们以后想要查询的节点了。</a></p><p id="947f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ml lf lg lh mn lj lk ll mp ln lo lp lq ij bi translated">我们想建立一个后端，允许我们存储报价和他们的作者。因为我们希望尽可能保持简单，所以报价只有一个字段<code class="fe nj nk nl nm b">text</code>，它保存报价的文本形式，还有一个字段<code class="fe nj nk nl nm b">Author</code>，它将报价的作者链接到报价。作者只有一个代表作者全名的字段<code class="fe nj nk nl nm b">name</code>。<code class="fe nj nk nl nm b">id</code>字段是对该节点进行润土查询和变异所必需的。感叹号表示该字段是必填的。点击Deploy将模式部署到您的后端。</p><pre class="kg kh ki kj gt nz nm oa ob aw oc bi"><span id="4987" class="nn ls iq nm b gy od oe l of og">// Quote<br/>type Quote {<br/> id: ID!<br/> text: String!<br/> author: Author!<br/>}</span><span id="a723" class="nn ls iq nm b gy oh oe l of og">// Author<br/>type Author {<br/> id: ID!<br/> name: String!<br/>}</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/a1d8a0ae6459db19b312089e152be24f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6X8vq86RNbiWq6ukV1m9TA.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">在Scheme &gt; GraphQL Schema中开始编写第一个模式。</p></figure><p id="fd86" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ml lf lg lh mn lj lk ll mp ln lo lp lq ij bi translated">一旦部署了模式，Dgraph就会自动创建大量解析器来操作数据。如果你想知道Dgraph做了什么，你可以探索<code class="fe nj nk nl nm b">GraphQL &gt; Explorer.</code>中的东西，而我们在这里，让我们添加我们的第一个数据。开始在中间的字段输入<code class="fe nj nk nl nm b">mutation</code>,然后输入你想给这个突变起的名字(我选择了<code class="fe nj nk nl nm b">AddQuote</code>),然后填写右边的字段。确保您已经填写了所有必填字段，包括:</p><ul class=""><li id="b4fd" class="oj ok iq kx b ky kz lb lc ml ol mn om mp on lq oo op oq or bi translated"><code class="fe nj nk nl nm b">text</code>还有</li><li id="96a4" class="oj ok iq kx b ky os lb ot ml ou mn ov mp ow lq oo op oq or bi translated"><code class="fe nj nk nl nm b">author &gt; name</code></li></ul><p id="68ee" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ml lf lg lh mn lj lk ll mp ln lo lp lq ij bi translated">还要确保选择了<code class="fe nj nk nl nm b">numUids</code>，它会告诉您在查询/变异过程中接触到的节点数量。如果出了问题。如果你只是想复制粘贴我的报价，那就请便。</p><pre class="kg kh ki kj gt nz nm oa ob aw oc bi"><span id="7899" class="nn ls iq nm b gy od oe l of og">mutation AddQuote {<br/> addQuote(<br/>  input: {<br/>   text: “Before you marry a person, you should first make them use a computer with slow Internet to see who they really are.”, <br/>   author: {name: “Will Ferrell”}}<br/> ) {<br/>  numUids<br/> }<br/>}</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/a832f280fd7ec99a20a65adb33c0f350.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UGG3gjtUjSa1j9aqpSWtZQ.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">运行一个变异，将一个报价及其相应的作者添加到数据库中。</p></figure></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="dd51" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ml lf lg lh mn lj lk ll mp ln lo lp lq ij bi translated">运行查询并检查数据库中有什么</p><p id="8710" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ml lf lg lh mn lj lk ll mp ln lo lp lq ij bi translated">是时候检查变异有没有起作用了！开始键入<code class="fe nj nk nl nm b">query</code>后跟任何名字(我选择了<code class="fe nj nk nl nm b">QueryQuote</code>)，然后键入<code class="fe nj nk nl nm b">queryQuote</code>以获得所有引用加上相应的作者。向我们的任务列表中添加另一个查询，例如<code class="fe nj nk nl nm b">QueryAuthor</code>。通过点击顶部的▶️按钮，您将被迫选择任务(让我们选择<code class="fe nj nk nl nm b">QeryQuote</code>)并检查结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/6213a660faa7992d5556c019abafdd32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vlvD0O7KTK0j9qqydPm2qQ.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">最后，通过创建to查询来检查数据库条目(一个用于报价，一个用于作者)。</p></figure><p id="b32e" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ml lf lg lh mn lj lk ll mp ln lo lp lq ij bi translated">如您所见，您也可以只查询<code class="fe nj nk nl nm b">Authors</code>。因为作者和报价之间没有联系，所以运行作者查询不会给你任何关于他的报价的信息。</p><p id="0612" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ml lf lg lh mn lj lk ll mp ln lo lp lq ij bi translated">使用GraphQL和Dgraph可以做很多事情，但为了简单起见，我们就此打住。在本系列的第2部分中，我们将设置Auth0来保护Dgraph端点。</p></div></div>    
</body>
</html>