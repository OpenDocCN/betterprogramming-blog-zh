<html>
<head>
<title>How To Read Deployed Smart Contract From Android Using Web3j</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Web3j从Android读取已部署的智能合同</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-read-deployed-smart-contract-from-android-using-web3j-d56b23d616a3?source=collection_archive---------0-----------------------#2022-05-29">https://betterprogramming.pub/how-to-read-deployed-smart-contract-from-android-using-web3j-d56b23d616a3?source=collection_archive---------0-----------------------#2022-05-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="34ba" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从已部署的合同中读取ERC-20令牌数量</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/53ae7cecb08c110861dae712923bdb16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XLF5VRTR-vZQTlLKq7j9iQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@tezos?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Tezos </a>在<a class="ae kv" href="https://unsplash.com/s/photos/crypto-wallet?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="d600" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">区块链技术发展如此之快，以至于即使那些没有听说过加密货币或对其工作一无所知的人也在试图投资和研究该领域。随着加密货币热潮继续在全球蔓延，越来越多的初创公司每天都在开发利用区块链技术的新方法，难怪越来越多的人对投资该领域感兴趣。</p><p id="1598" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇短文中，我们将学习如何使用<a class="ae kv" href="https://docs.web3j.io/4.8.7/" rel="noopener ugc nofollow" target="_blank"> Web3j </a>从Android应用程序中读取已部署的智能合同。我们不需要智能合同的ABI代码。对于read，我们将使用我们<a class="ae kv" href="https://yoorbit.medium.com/create-your-own-erc-20-token-using-solidity-and-hardhat-on-avalanche-test-network-d5239fa7611c" rel="noopener">之前</a>创建的ERC-20令牌契约。</p><h2 id="bd00" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">目录</h2><ul class=""><li id="2c1f" class="ml mm iq ky b kz mn lc mo lf mp lj mq ln mr lr ms mt mu mv bi translated">什么是ERC-20代币？</li><li id="2a54" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">Web3j是什么？</li><li id="ba1e" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">读取帐户余额</li></ul><h2 id="2cd6" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">什么是ERC-20代币？</h2><p id="b017" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">ERC-20引入了可替换令牌的标准，换句话说，它们具有一种属性，使得每个令牌与另一个令牌完全相同(在类型和值上)。例如，ERC-20令牌的行为就像ETH一样，这意味着1令牌等于并将永远等于所有其他令牌。</p><p id="6065" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ERC-20令牌必须能够:</p><ul class=""><li id="7f70" class="ml mm iq ky b kz la lc ld lf ne lj nf ln ng lr ms mt mu mv bi translated">将代币从一个帐户转移到另一个帐户</li><li id="f2ce" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">退还账户余额</li><li id="e876" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">返回令牌中可用的令牌总数</li><li id="0a20" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">将代币转移到帐户</li></ul><p id="b03c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ERC-20是用于以太坊智能合约的令牌标准。它规定了以太坊令牌契约必须实现的6个公共方法和3个公共事件</p><p id="af7a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ERC20标准令牌的简单实现:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/c32fd8a41455bad1d19c4cff6ec90085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6IihvYIy7BTG0dEf.png"/></div></div></figure><ul class=""><li id="afac" class="ml mm iq ky b kz la lc ld lf ne lj nf ln ng lr ms mt mu mv bi translated"><code class="fe ni nj nk nl b">name</code>返回令牌的名称(例如，Avalanche)</li><li id="c384" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><code class="fe ni nj nk nl b">symbol</code>返回令牌的符号(如AVAX)</li><li id="dc56" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><code class="fe ni nj nk nl b">decimals</code>返回令牌使用的小数位数</li><li id="93ec" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><code class="fe ni nj nk nl b">totalSupply</code>返回最初提供给令牌的总数</li><li id="8ef8" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><code class="fe ni nj nk nl b">balanceOf</code>返回账户余额</li><li id="e9d8" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><code class="fe ni nj nk nl b">transfer</code>将一定数量的代币转移到某个地址</li><li id="54c9" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><code class="fe ni nj nk nl b">transferFrom</code>将一定数量的代币从收款人地址转移到收款人地址</li><li id="ffcb" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">从所有者的地址中提取一定数量的代币</li><li id="d02f" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><code class="fe ni nj nk nl b">allowance</code>返回可从所有者账户中提取的代币数量</li><li id="23d0" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><code class="fe ni nj nk nl b">Transfer</code>，令牌转移时必须触发</li><li id="7d10" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><code class="fe ni nj nk nl b">Approval</code>，账户被批准领取一定数量代币时必须触发</li></ul><h2 id="adae" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">Web3j是什么？</h2><p id="1d15" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">Web3j是一个轻量级、高度模块化、反应式、类型安全的Java和Android库，用于处理智能合约并与以太坊网络上的客户端(节点)集成:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/be6c577ad347cb495157410875b9a9f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IGjRn4kP6xdaAtYr.png"/></div></div></figure><p id="52c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这允许你使用<a class="ae kv" href="https://www.ethereum.org/" rel="noopener ugc nofollow" target="_blank">以太坊</a>区块链，而不需要为平台编写你自己的集成代码。</p><p id="1b31" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.youtube.com/watch?v=ea3miXs_P6Y" rel="noopener ugc nofollow" target="_blank"> Java和区块链</a>演讲概述了区块链、以太坊和Web3j。</p><h2 id="ac84" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">阅读合同</h2><p id="2365" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">由于我们的合同类型为ERC-20，我们将读取余额的具体地址。当我们使用OpenZeppelin预定义的ERC-20时，ERC-20合同所需的所有功能都将存在，我们将使用<code class="fe ni nj nk nl b">balanceOf()</code>功能。</p><p id="a19e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 1-创建新项目</strong></p><p id="dd18" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用Android Studio的创建窗口创建一个新项目。</p><p id="76c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当项目编译结束时，将下面的实现添加到<code class="fe ni nj nk nl b">build.gradle (Mocule)</code>文件并点击<code class="fe ni nj nk nl b">Sync now</code>按钮。</p><pre class="kg kh ki kj gt nn nl no np aw nq bi"><span id="0e66" class="ls lt iq nl b gy nr ns l nt nu">// Web3j<br/>implementation ('org.web3j:core:4.8.7-android')</span></pre><p id="0394" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你读到这篇文章时，版本可能已经改变了。你可以查看<a class="ae kv" href="https://github.com/web3j/web3j" rel="noopener ugc nofollow" target="_blank"> Web3j GitHub库</a>获取最新版本。</p><p id="8333" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始之前，不要忘记添加互联网权限。打开<code class="fe ni nj nk nl b">AndroidManifest.xml</code>文件，将下面一行添加到<code class="fe ni nj nk nl b">&lt;application</code>标签上面。</p><pre class="kg kh ki kj gt nn nl no np aw nq bi"><span id="f857" class="ls lt iq nl b gy nr ns l nt nu">&lt;uses-permission android:name="android.permission.INTERNET" /&gt;</span></pre><p id="f6b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 2-设置扩展和常量</strong></p><p id="4b6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于我们阅读合同和具体地址的平衡，我们需要<code class="fe ni nj nk nl b">CONTRACT_ADDRESS</code>和<code class="fe ni nj nk nl b">WALLET_ADDRESS</code>。为了连接到链条，我们需要链条的<code class="fe ni nj nk nl b">SOCKET_URL</code>。我们将使用雪崩富士的套接字Url，因为我们的ERC-20令牌被部署到富士测试网络。您可以使用<code class="fe ni nj nk nl b">Infura</code>在其他链中创建套接字URL。</p><p id="ef77" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建<code class="fe ni nj nk nl b">Constants.kt</code>并复制粘贴下面的代码。不要忘记改变你的变量。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="4864" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的扩展函数接受返回的参数，在我们的情况下，它将是<code class="fe ni nj nk nl b">balance</code>，转换为Ether并返回它。</p><p id="dca8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建<code class="fe ni nj nk nl b">Extensions.kt</code>并复制粘贴下面的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="d0ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 3-设置视图模型</strong></p><p id="d7a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建名为<code class="fe ni nj nk nl b">ContractViewModel</code>的视图模型。在这个视图模型类中，我们需要两个函数。</p><p id="f94f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一个函数创建一个套接字服务，连接该套接字，创建Web3j对象，并返回它。复制下面的代码并粘贴到你的视图模型中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="d8fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二个功能基本上是阅读合同。</p><p id="0b09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个函数中，我们将获取Web3j对象，创建<code class="fe ni nj nk nl b">Function</code>对象并发送<code class="fe ni nj nk nl b">EthCall</code>。</p><p id="b8d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">函数对象有3个参数。第一个参数是函数名。第二个是<code class="fe ni nj nk nl b">inputParameters</code>,我们的实度函数的参数列表。第三个是<code class="fe ni nj nk nl b">outputParameters</code>，我们的实度函数的返回值如下。</p><p id="4f59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要在发送之前对函数进行编码。之后，我们可以使用这些参数创建事务。</p><p id="467b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">复制下面的代码，粘贴到<code class="fe ni nj nk nl b">createWeb3j</code>函数下面。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="c652" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果一切正常，您应该可以在<code class="fe ni nj nk nl b">logcat</code>中看到<code class="fe ni nj nk nl b">log</code>。就是这样！阅读一份如此简单的合同。</p><h2 id="9d2f" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">结论</h2><p id="c2a3" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">在本文中，我们研究了如何从Android应用程序获取帐户余额。为此，我们使用了Web3j以太坊Android客户端。更多信息参见<a class="ae kv" href="https://docs.web3j.io/4.8.7/" rel="noopener ugc nofollow" target="_blank">正式文件</a>和<a class="ae kv" href="https://github.com/Enes-Kayiklik/AndroidWeb3jSample" rel="noopener ugc nofollow" target="_blank">样本代码</a>。</p><h2 id="8170" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">有用的链接</h2><ul class=""><li id="42c6" class="ml mm iq ky b kz mn lc mo lf mp lj mq ln mr lr ms mt mu mv bi translated"><a class="ae kv" href="https://medium.com/stably-blog/what-is-a-crypto-wallet-7363d3118ce5" rel="noopener">什么是加密钱包</a></li><li id="2694" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><a class="ae kv" href="https://ethereum.org/en/developers/docs/standards/tokens/erc-20/" rel="noopener ugc nofollow" target="_blank">什么是ERC-20 </a></li><li id="d3c4" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><a class="ae kv" href="https://docs.web3j.io/4.8.7/" rel="noopener ugc nofollow" target="_blank"> Web3j官方文档</a></li><li id="5991" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><a class="ae kv" href="https://github.com/web3j/web3j" rel="noopener ugc nofollow" target="_blank"> Web3j GitHub </a></li></ul></div></div>    
</body>
</html>