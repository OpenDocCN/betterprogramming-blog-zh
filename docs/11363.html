<html>
<head>
<title>Angular: HttpContextToken — Handling HTTP Requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular: HttpContextToken —处理HTTP请求</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/angular-tweaking-a-http-request-with-httpcontexttoken-41920f3d1e24?source=collection_archive---------4-----------------------#2022-03-13">https://betterprogramming.pub/angular-tweaking-a-http-request-with-httpcontexttoken-41920f3d1e24?source=collection_archive---------4-----------------------#2022-03-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c3c6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用途和用法示例</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/269bff93f7d5b615e373265428215d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mpyMxmHHNYHEySIHMuZ-FA.jpeg"/></div></div></figure><p id="c871" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在应用程序中，我们经常需要处理一些不同条件的<code class="fe ln lo lp lq b">http</code>请求。这些条件会导致代码中不同的逻辑。</p><p id="dbc4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通常，在Angular中，我们在一个实现了<a class="ae lr" href="https://angular.io/api/common/http/HttpInterceptor" rel="noopener ugc nofollow" target="_blank"> HttpInterceptor </a>接口的类中这样做。当然，有许多关于服务注入和条件检查的标准实践。但是我们也可以用有角的力量。还是用<code class="fe ln lo lp lq b">HttpContextToken</code>吧。</p><blockquote class="ls lt lu"><p id="4934" class="kr ks lv kt b ku kv jr kw kx ky ju kz lw lb lc ld lx lf lg lh ly lj lk ll lm ij bi translated">从名字中可以看出<code class="fe ln lo lp lq b">HttpContextToken</code>的用途——这个令牌允许您向请求上下文添加额外的数据。</p></blockquote><h1 id="f0aa" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">一个例子</h1><p id="ad96" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">假设我们有一个应用程序，它的服务器请求带有授权权限。如果我们没有权限，请求就不会被发送。但是我们还必须处理对几个开放的、不需要授权检查的API的请求。</p><p id="ffa5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">解决这个问题一个方法是拥有一个开放API的列表，并检查要包含在这个列表中的每个请求URL。但是那有点开销，让我们用<code class="fe ln lo lp lq b">HttpContextToken</code>来解决这个问题。</p><p id="c1cc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们有非常简单的<code class="fe ln lo lp lq b">ApiInterceptor</code>类，带有哑权限检查:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="5bc9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一个有请求的服务:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="d9b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们需要用<code class="fe ln lo lp lq b">HttpContextToken</code>修改我们的代码。因此，让我们用默认值<code class="fe ln lo lp lq b">false</code>创建一个<code class="fe ln lo lp lq b">HttpContextToken</code>令牌的实例，并在拦截器类中使用它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="d0b3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">用代码<code class="fe ln lo lp lq b">request.context.get</code>你可以得到上下文的参数。因此，我们完成了主要步骤——在请求中添加对开放API的检查。</p><p id="cb08" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果<code class="fe ln lo lp lq b">OPEN_API_HTTP_TOKEN</code>令牌值为<code class="fe ln lo lp lq b">true</code>，请求将被调用。</p><p id="abdd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们进行最后一步，通过设置令牌来修改我们的服务:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="594f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就是这样！现在我们的应用程序已经可以使用开放API了。</p><p id="feab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望你喜欢这一课，谢谢，并与Angular呆在一起。</p></div></div>    
</body>
</html>