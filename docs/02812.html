<html>
<head>
<title>Running React with Ionic Capacitor and Live Reload</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">运行反应与离子电容器和带电重装</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/running-react-with-ionic-capacitor-live-reload-fc00fd4695d0?source=collection_archive---------19-----------------------#2020-01-02">https://betterprogramming.pub/running-react-with-ionic-capacitor-live-reload-fc00fd4695d0?source=collection_archive---------19-----------------------#2020-01-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6104" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将React整合到您的Ionic应用程序中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7142c5bb4e9d070ccfd3bc02d9b4d171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ORXasHESEnTZcrZzK95pWQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="ky">由法比安·格罗斯在Unsplash上拍摄的照片</em></p></figure><p id="ad6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae lv" href="https://capacitor.ionicframework.com/docs/" rel="noopener ugc nofollow" target="_blank"><em class="lw">Ionic Capacitor</em></a><em class="lw">是一个跨平台的应用运行时，可以轻松构建在iOS、Android、Electron和web上本地运行的web应用。我们称这些应用为“本地渐进式网络应用”，它们代表了混合应用的下一次发展。</em></p><p id="9832" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae lv" href="https://ionicframework.com/docs/cli/commands/capacitor-run" rel="noopener ugc nofollow" target="_blank"> Ionic Capacitor文档</a>对于构建和运行带有Capacitor和Live Reload的react应用程序并不起作用。所以，经过几个小时的努力，我找到了一个适合我的方法。希望它也能让其他人受益。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="8d41" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">首先构建您的应用程序</h1><p id="7c13" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">这段代码的起点在这个github repo中:<a class="ae lv" href="https://github.com/aaronksaunders/MyAppReactApp" rel="noopener ugc nofollow" target="_blank"> MyAppReactApp </a>。这是YouTube视频中的代码<a class="ae lv" href="https://www.youtube.com/watch?v=f9pq4Yizrg4&amp;t=6s" rel="noopener ugc nofollow" target="_blank">Ionic框架中的React Hooks第一部分</a>。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="b8c2" class="ng mf it nc b gy nh ni l nj nk">ionic serve</span></pre><p id="b8f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当它运行时，注意它显示了应用程序运行的URL。这是它在我的开发设备上的样子:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="1746" class="ng mf it nc b gy nh ni l nj nk">MacBook-Pro:MyAppReactApp aaronksaunders$ionic serve &gt;react-scripts start <br/>[react-scripts] ℹ ｢wds｣: Project is running at http://10.6.17.241/ [react-scripts] ℹ ｢wds｣: webpack output is served from / <br/>[react-scripts] ℹ ｢wds｣: Content not from webpack is served from /Users/aaronksaunders/dev/projects/react/MyAppReactApp/public <br/>[react-scripts] ℹ ｢wds｣: 404s will fallback to /index.html <br/>[react-scripts] Starting the development server...</span></pre></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="0fc1" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">设置<code class="fe nl nm nn nc b">capacitor.config.json</code></h1><p id="1b91" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">文件<code class="fe nl nm nn nc b">capacitor.config.json</code>可以在应用程序目录的根目录中找到。我们需要修改它，以便电容器知道在哪里找到网站运行。从<code class="fe nl nm nn nc b">ionic serve</code>命令的输出中获取URL，并修改您的<code class="fe nl nm nn nc b">capacitor.config.json</code>文件，如下所示:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="3082" class="ng mf it nc b gy nh ni l nj nk">{<br/>  "appId": "io.ionic.starter",<br/>  "appName": "myAppReact1",<br/>  "bundledWebRuntime": false,<br/>  "npmClient": "npm",<br/>  "webDir": "build",<br/>  "cordova": {},<br/>  "server": {<br/>    "url": "http://10.6.17.241:8100"<br/>  }<br/>}</span></pre><p id="965e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lw">确保将端口添加到URL的末尾！</em></p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="18de" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">运行电容器</h1><p id="c445" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">由于我使用的是Visual Studio代码，因此只需打开另一个终端窗口并运行以下命令来同步项目代码:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="7ee5" class="ng mf it nc b gy nh ni l nj nk">npx cap sync</span></pre><p id="efa1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将复制项目的所有插件信息和本机桥代码，以便在设备或仿真器上运行。控制台输出应该类似于以下内容:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="64d3" class="ng mf it nc b gy nh ni l nj nk">MacBook-Pro:MyAppReactApp aaronksaunders$npx cap sync ios <br/>✔ Copying web assets from build to ios/App/public in 348.07ms <br/>✔ Copying native bridge in 1.60ms <br/>✔ Copying capacitor.config.json in 1.43ms <br/>✔ copy in 368.54ms <br/>✔ Updating iOS plugins in 3.57ms <br/>Found 0 Capacitor plugins for ios: ✔ Updating iOS native dependencies with "pod install" (may take several minutes) in 4.23s <br/>✔ update ios in 4.24s <br/>Sync finished in 4.626s</span></pre><p id="9efd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，用下面的命令打开特定于平台的IDE。我在iOS上，所以命令打开XCode——当它打开时，构建并运行应用程序:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="5bb2" class="ng mf it nc b gy nh ni l nj nk">npx cap open ios</span></pre><p id="6ba3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当应用程序启动时，您应该会在Xcode日志中看到类似下面的内容:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="9184" class="ng mf it nc b gy nh ni l nj nk">2019-12-30 14:30:08.440853-0500 App[8013:145759] DiskCookieStorage changing policy from 2 to 0, cookie file: file:///Users/aaronksaunders/Library/Developer/CoreSimulator/Devices/76C4C563-0811-4917-9047-4ACD2B6C8687/data/Containers/Data/Application/D4CCEEC9-3FE1-4360-AF30-574BC8DEA7FA/Library/Cookies/io.ionic.starter.aks.binarycookies Loading network plugin <br/>2019-12-30 14:30:08.541581-0500 App[8013:145759] CAPKeyboard: resize mode - native <br/>⚡️ Loading app at http://10.6.17.241:8100... Reachable via WiFi APP ACTIVE <br/>⚡️ [log] - [HMR] Waiting for update signal from WDS... <br/>⚡️ WebView loaded <br/>⚡️ To Native -&gt;App addListener 25525202 <br/>SplashScreen.hideSplash: SplashScreen was automatically hidden after default timeout. You should call `SplashScreen.hide()` as soon as your web app is loaded (or increase the timeout). Read more at https://capacitor.ionicframework.com/docs/apis/splash-screen/#hiding-the-splash-screen <br/>⚡️ To Native -&gt;Camera getPhoto 25525203</span></pre><p id="656a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您对网站所做的任何编辑都将强制重新构建—应用程序将检测新网站并重新加载自己。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="5aad" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">安卓怪癖</h1><p id="293d" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">在Android设备和模拟器上运行带实时重载的电容器时，可能会遇到一个问题。如果您按照下面的说明操作，这个问题很容易解决。</p><p id="1059" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将向您介绍整个过程，以便您可以看到错误，然后修复它。让我们从将Android添加到项目开始。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="91dc" class="ng mf it nc b gy nh ni l nj nk">npx cap add android</span></pre><p id="94ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是运行该命令的输出:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="ab84" class="ng mf it nc b gy nh ni l nj nk">MacBook-Pro:MyAppReactApp aaronksaunders$npx cap add android <br/>✔ Installing android dependencies in 7.13s ⠋ <br/>Adding native android project in: /Users/aaronksaunders/de<br/>✔ Adding native android project in: /Users/aaronksaunders/dev/projects/react/MyAppReactApp/android in 27.56ms <br/>✔ Syncing Gradle in 15.83s <br/>✔ add in 22.99s ⠋ <br/>Copying web assets from build to android/app/src/main/asse⠙ <br/>Copying web assets from build to android/app/src/main/asse⠹ <br/>Copying web assets from build to android/app/src/main/asse<br/>✔ Copying web assets from build to android/app/src/main/assets/public in 235.76ms <br/>✔ Copying native bridge in 1.00ms <br/>✔ Copying capacitor.config.json in 760.08μp <br/>✔ copy in 247.39ms <br/>✔ Updating Android plugins in 3.77ms Found 0 Capacitor plugins for android: <br/>✔ update android in 16.64ms</span></pre><p id="3630" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们需要同步本机代码和插件，这样我们就可以在Android Studio中运行它。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="6c34" class="ng mf it nc b gy nh ni l nj nk">npx cap sync android</span></pre><p id="b46f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后用下面的命令打开Android Studio。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="5b0a" class="ng mf it nc b gy nh ni l nj nk">npx cap open android</span></pre><p id="674d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，在模拟器或设备中运行代码，您将看到以下错误:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/277f4a053ff0918fd0fa3111bac6c6b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xrmh4xWcivdOAPAB.png"/></div></div></figure><p id="4a61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个Android特有的问题，可以通过更新<code class="fe nl nm nn nc b">AndroidManifest.xml</code>以包含<code class="fe nl nm nn nc b">android:usesCleartextTraffic="true"</code>来解决。您可以在以下路径找到的文件中进行编辑:<code class="fe nl nm nn nc b">android/app/src/main/AndroidManifest.xml</code>。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="e7fa" class="ng mf it nc b gy nh ni l nj nk">&lt;application android:usesCleartextTraffic= "true"   <br/>  android:allowBackup= "true" <br/>  android:icon= "@mipmap/ic_launcher"<br/>  android:label= "@string/app_name" <br/>  android:roundIcon= "@mipmap/ic_launcher_round"<br/>  android:supportsRtl= "true" <br/>  android:theme= "@style/AppTheme" &gt;</span></pre><p id="a558" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您做出这个更改之后，您需要<code class="fe nl nm nn nc b">npx cap sync android</code>来获得应用程序更新。然后重新启动模拟器或设备，应用程序应该工作正常。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="aa14" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">移除实时重新加载</h1><p id="f581" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">要从您的项目中移除live reload，您只需更新<code class="fe nl nm nn nc b">capacitor.config.json</code>并移除<code class="fe nl nm nn nc b">server.url</code>属性:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="4af6" class="ng mf it nc b gy nh ni l nj nk">{<br/>  "appId": "io.ionic.starter",<br/>  "appName": "myAppReact1",<br/>  "bundledWebRuntime": false,<br/>  "npmClient": "npm",<br/>  "webDir": "build",<br/>  "cordova": {},<br/>  "server": {<br/>    "url": "http://10.6.17.241:8100" //&lt;== REMOVE THIS!!<br/>  }<br/>}</span></pre></div></div>    
</body>
</html>