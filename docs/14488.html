<html>
<head>
<title>Troubleshooting Tips for GitHub Actions Workflows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GitHub操作工作流程的故障排除提示</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/17-troubleshooting-tips-for-github-actions-workflows-43394e4f1a8a?source=collection_archive---------4-----------------------#2022-12-23">https://betterprogramming.pub/17-troubleshooting-tips-for-github-actions-workflows-43394e4f1a8a?source=collection_archive---------4-----------------------#2022-12-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="99ec" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">GitHub Actions工作流错误和解决方案的汇编，来自我自己的工作经验</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ffefdf6da1326ed2c5a62c331ea2bcd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lLDRBka6cu_Nu-hZZ7XESQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片</p></figure><p id="b7ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在使用GitHub Actions工作流将微服务构建和部署到AWS中时，我遇到了一些错误/异常，并深入寻找它们的解决方案。我列出了一系列这样的错误场景及其解决方案，希望对那些使用GitHub Actions的人有所帮助。</p><p id="40be" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下故障排除详情中引用的详细CI/CD工作流记录在我的故事“<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-github-actions-reusable-workflow-8604e8cbf258?sk=016e931ac8c4058eea74ce7838039bf6">深入了解GitHub Actions的可重用工作流</a>”中。</p><h1 id="a93b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">错误#1: CI工作流在“使用Trivy漏洞扫描器扫描ECR映像”步骤失败</strong></h1><p id="fbe0" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">如果您使用<a class="ae lu" href="https://github.com/aquasecurity/trivy" rel="noopener ugc nofollow" target="_blank"> Trivy </a>扫描您的docker映像，并且如果您的CI工作流在ECR映像扫描步骤失败，并出现以下错误(请参见下面的屏幕截图)，这是由docker基本映像中的漏洞问题引起的。在这种情况下，基本映像<code class="fe ms mt mu mv b">amazoncorretto:17.0.2-alpine3.15</code>用于Spring Boot微服务(在撰写本文时，还没有发布带有修复的新映像)，您将需要提供解决方法来更新<code class="fe ms mt mu mv b">Dockerfile</code>中基本映像中的包。</p><p id="5496" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">具体来说，就是在你的<code class="fe ms mt mu mv b">Dockerfile</code>里的<code class="fe ms mt mu mv b">FROM</code>线下面加线<code class="fe ms mt mu mv b">RUN apk update &amp;&amp; apk upgrade -U -a</code>。通过这一行修复，您配置项应该能够通过ECR映像扫描步骤。顺便说一下，我强烈推荐Trivy进行图像扫描，它不仅扫描你的应用程序的依赖项来检查漏洞，它还扫描你的基本图像。将Trivy scan添加到您的CI工作流中，如果您还没有这样做的话。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/cde67c853600545163ae21fef4013d4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f4fld__97yNxNGVxoMnjqA.png"/></div></div></figure><h1 id="acc1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">错误#2: </strong>发布工作流失败，出现“500内部服务器错误”</h1><p id="410e" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在测试maven发布工作流程的过程中，我遇到了“500内部服务器错误”,并指出GitHub包的行为不符合预期。我就此错误联系了GitHub技术支持，以下是他们的回应:</p><p id="5218" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mx">这似乎是一个暂时性错误，可能发生在高负载期间</em>。他们推荐了以下解决方法，以允许在出现此类错误时重试。如果在3次重试后，您仍然遇到这个错误，那么清理发布过程的最好方法是手动将主程序的pom版本升级到下一个开发快照版本，并重新发布新版本。</p><pre class="kj kk kl km gt my mv mz bn na nb bi"><span id="bbd5" class="nc lw it mv b be nd ne l nf ng">env:<br/>  MAVEN_OPTS: -Dhttp.keepAlive=false -Dmaven.wagon.http.pool=false -Dmaven.wagon.http.retryHandler.class=standard -Dmaven.wagon.http.retryHandler.count=3</span></pre><h1 id="eb48" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">错误#3:“无法从您的身份提供商处检索验证密钥，请参考AssumeRoleWithWebIdentity文档了解相关要求”</strong></h1><p id="ec1c" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">如果在步骤“配置AWS凭据”中遇到上述错误，则表明OIDC配置错误。按照下面的四个步骤在AWS中正确配置OIDC。</p><h2 id="9879" class="nh lw it bd lx ni nj dn mb nk nl dp mf lh nm nn mh ll no np mj lp nq nr ml ns bi translated"><strong class="ak">步骤1:添加身份提供者(如果尚不存在)</strong></h2><ol class=""><li id="f1ce" class="nt nu it la b lb mn le mo lh nv ll nw lp nx lt ny nz oa ob bi translated">打开IAM控制台。</li><li id="c759" class="nt nu it la b lb oc le od lh oe ll of lp og lt ny nz oa ob bi translated">在导航窗格中，选择“身份提供者”，然后选择“添加提供者”。</li><li id="664f" class="nt nu it la b lb oc le od lh oe ll of lp og lt ny nz oa ob bi translated">对于“配置提供商”，选择“OpenID连接”。</li><li id="f2ac" class="nt nu it la b lb oc le od lh oe ll of lp og lt ny nz oa ob bi translated">对于“提供商URL ”,键入<code class="fe ms mt mu mv b"><a class="ae lu" href="https://token.actions.githubusercontent.com." rel="noopener ugc nofollow" target="_blank">https://token.actions.githubusercontent.com</a></code></li><li id="f402" class="nt nu it la b lb oc le od lh oe ll of lp og lt ny nz oa ob bi translated">对于“观众”，键入<code class="fe ms mt mu mv b">sts.amazonaws.com</code>，因为我们正在使用<a class="ae lu" href="https://github.com/aws-actions/configure-aws-credentials" rel="noopener ugc nofollow" target="_blank">官方动作</a>。</li><li id="35bf" class="nt nu it la b lb oc le od lh oe ll of lp og lt ny nz oa ob bi translated">选择“添加提供商”。</li></ol><h2 id="6f8c" class="nh lw it bd lx ni nj dn mb nk nl dp mf lh nm nn mh ll no np mj lp nq nr ml ns bi translated"><strong class="ak">步骤2:添加角色和信任策略</strong></h2><p id="7357" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">根据新应用程序的需要添加新角色并分配策略。根据您计划部署的特定应用程序，此步骤中的策略可能会有所不同。如果有您想要使用的现有角色，请通过验证以下步骤确保其配置正确。</p><p id="67d5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">添加角色后，确保其信任策略定义如下，<code class="fe ms mt mu mv b">Federated</code>行应该为我们刚刚在上面创建的身份提供者指定<code class="fe ms mt mu mv b">ARN</code>(下面的示例片段仅供参考，请确保根据您在第7行的帐户更改身份提供者的<code class="fe ms mt mu mv b">ARN</code>)。<code class="fe ms mt mu mv b">aud</code>部分(第12行)应该总是有值<code class="fe ms mt mu mv b">sts.amazonaws.com</code>，如上面的身份提供者部分所定义。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h2 id="1cbd" class="nh lw it bd lx ni nj dn mb nk nl dp mf lh nm nn mh ll no np mj lp nq nr ml ns bi translated"><strong class="ak">步骤3:添加ECR访问的内联策略</strong></h2><p id="c743" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">对于微服务来说，构建docker映像并将其推送到ECR是常见的步骤。我们用来登录ECR的GitHub操作<code class="fe ms mt mu mv b">aws-actions/amazon-ecr-login@v1</code>需要ECR私有回购的push/pull权限。不幸的是，ECR的内置策略不能用于从/向私有repo推送/提取图像，所以我必须为ECR访问创建一个内嵌策略。除了我们已经为该角色选择的现有策略之外，将此内联策略添加到我们的角色:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h2 id="c38d" class="nh lw it bd lx ni nj dn mb nk nl dp mf lh nm nn mh ll no np mj lp nq nr ml ns bi translated"><strong class="ak">第四步:GitHub Actions工作流配置</strong></h2><p id="535f" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">创建一个新的GitHub环境秘密，密钥为<code class="fe ms mt mu mv b">ROLE_TO_ASSUME</code>，值为该角色的<code class="fe ms mt mu mv b">ARN</code>。</p><p id="ee73" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在定义作业之前，我们需要在GitHub Actions工作流中指定权限，特别需要在caller工作流中添加<code class="fe ms mt mu mv b"> id-token: write</code>权限，它允许从GitHub的OIDC提供者请求JWT。如果<code class="fe ms mt mu mv b">id-token</code>的<code class="fe ms mt mu mv b">permissions</code>设置被设置为<code class="fe ms mt mu mv b">read</code>或<code class="fe ms mt mu mv b">none</code>，我们将无法请求OIDC JWT令牌。</p><h1 id="2fff" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">错误# 4:“NoCredentialProviders:链中没有有效的提供者”</strong></h1><p id="51c0" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">如果您在工作流执行中碰巧遇到这个错误，它通常表明GitHub操作无法找到定义的秘密。检查您是否在工作流程中指定了<code class="fe ms mt mu mv b">environment</code>。如果您正在处理一个与AWS资源交互的全新工作流，请确保在工作流作业中定义的步骤上方添加这一行(见下文)。</p><pre class="kj kk kl km gt my mv mz bn na nb bi"><span id="fd08" class="nc lw it mv b be nd ne l nf ng">environment: ${{ inputs.env || 'dev' }}</span></pre><h1 id="6eed" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">错误#5:即使工作流中有workflow_dispatch触发器，也缺少手动触发器</strong></h1><p id="d886" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">如果您在工作流中定义了<code class="fe ms mt mu mv b">workflow_dispatch</code>触发器，但是由于某种原因，您在存储库中的Actions选项卡下没有看到工作流的“Run workflow”按钮，请检查您所在的分支是否是存储库的默认分支。您可以将您的功能分支合并到您的默认分支中，修改触发器以指向您的功能分支，一旦代码被合并，您将看到最新的代码和工作流文件的更改被反映出来。您现在应该看到“操作”选项卡下的“运行工作流”按钮，请参见下面的屏幕截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/f0eb5b14c54ca27857e6095c80155f61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Y-V1hnq7BbZInMDkp4cUg.png"/></div></div></figure><h1 id="df0e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">错误#6: GitHub PR页面显示“此分支已成功部署”,即使您运行CI工作流</strong></h1><p id="d954" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">如果您的工作流中有PR触发器，当提出新的PR时，它会自动触发CI工作流。您的AWS环境中没有实际的部署。你想知道为什么在GitHub的PR页面上显示这一行“此分支已成功部署”(见下图截图)。我联系了GitHub技术支持，以下是他们的回复:</p><p id="0eb6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mx">“这是因为工作流有一个作业引用了</em> <strong class="la iu"> <em class="mx"> dev </em> </strong> <em class="mx">环境。当您在工作流作业中引用一个环境时，GitHub会隐式地创建一个到该环境的部署。本例中的部署是指GitHub中的</em> <a class="ae lu" href="https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdocs.github.com%2Fen%2Frest%2Fdeployments%2Fdeployments&amp;data=05%7C01%7C%7C8bdc91d2a5414b1aa2b108da6663bb3e%7C9c230f7cb8904c309f79d32c2ba39bd4%7C0%7C0%7C637934875790366862%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=%2FFpsTEr7UwjU%2BRcwO955ngcjr8Oi1d7hX6zfYxYL0aI%3D&amp;reserved=0" rel="noopener ugc nofollow" target="_blank"> <em class="mx">部署概念</em> </a> <em class="mx">而非外部服务提供者。</em></p><p id="ac66" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mx">目前，如果工作流中的作业引用环境，则无法从拉式请求时间线中更改或删除该消息，抱歉。</em></p><p id="0f1f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我同意这条消息看起来确实令人困惑，我们也从其他用户那里收到了类似的反馈。我已将此票添加到讨论中。我不能给你一个时间表，当它将被修改，但这将记录在我们的 <a class="ae lu" href="https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.blog%2Fchangelog%2F&amp;data=05%7C01%7C%7C8bdc91d2a5414b1aa2b108da6663bb3e%7C9c230f7cb8904c309f79d32c2ba39bd4%7C0%7C0%7C637934875790366862%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=CglPcn5Mkw%2BKqJZCwomyGBgEJrZN9MT5P%2BC0wLH5foo%3D&amp;reserved=0" rel="noopener ugc nofollow" target="_blank"> <em class="mx">变更日志</em> </a> <em class="mx">。”</em></p><p id="5d92" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们的示例CI工作流中，我们需要引用在<code class="fe ms mt mu mv b">dev</code> GitHub环境中定义的秘密来执行诸如配置AWS凭证和将图像推送到ECR之类的操作。CI工作流引用了<code class="fe ms mt mu mv b">dev</code>环境，这正是GitHub显示该消息的原因。我们这边什么也做不了。现在，只需注意这条消息，并等待GitHub提出适当的解决方案。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/6ec70206d129faa3880b095e9af774e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GogWd4_uM-27w7fReMsazA.png"/></div></div></figure><h1 id="7c62" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">错误#7:“工作流不存在或在此标签中没有workflow_dispatch触发器”</strong></h1><p id="f47c" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">当您试图通过选择特定的标记来手动触发将已发布的标记部署到任何环境时，就会发生此错误。这个错误的原因是，自从maven release创建了您的标记之后，您的工作流文件一定发生了变化。当您在采用GitHub操作的开始阶段调整/细化您的工作流时，就会发生这种情况。因此，如果您的工作流自上一次maven发布以来发生了变化，最好的解决方法就是发布一个新版本并部署新标签。那有效！</p><h1 id="14e6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">错误#8:工作流程在“构建、标记和将图像推送到AWS ECR”步骤失败</strong></h1><p id="df0a" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">如果您在GitHub操作日志中的“构建、标记和推送图像到AWS ECR”步骤下看到一个错误，抱怨多次尝试推送图像到ECR，最终返回退出代码1。这很可能是因为您的应用程序没有在ECR注册表中配置ECR存储库，或者您的应用程序IAM角色没有在ECR存储库中配置适当的权限。仔细检查两个！</p><h1 id="3788" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">错误#9:“要求输入但未提供:AWS-区域”</strong></h1><p id="0192" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">此错误发生在“配置AWS凭据”步骤中。即使你已经在GitHub secrets中正确添加了你的IAM角色和AWS_REGION，你还是会遇到这个错误，为什么？几个原因:</p><p id="ea71" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">1).确保在GitHub操作工作流程中正确设置了您的OIDC权限。在调用包含“配置AWS凭据”或任何其他AWS操作的可重用工作流之前，请确保检查您是否正确定义了以下权限。</p><pre class="kj kk kl km gt my mv mz bn na nb bi"><span id="fa24" class="nc lw it mv b be nd ne l nf ng">permissions:<br/>  id-token: write # need this for OIDC  <br/>  contents: read</span></pre><p id="b7a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2).确保在操作环境变量之前定义了“配置AWS凭据”步骤。这似乎是AWS操作“配置AWS凭据”中的一个潜在错误，每当github环境变量被定义并传递到$GITHUB_ENV中时，“配置AWS凭据”步骤就会以某种方式提取该环境变量并将其传递到其操作，而不是从secrets中获取IAM角色和AWS区域值。因此，建议始终将“配置AWS凭证”步骤放在处理<code class="fe ms mt mu mv b">$GITHUB_ENV</code>的任何步骤之前。</p><h1 id="6d07" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">错误#10: </strong>部署工件时“没有这样的文件或目录”</h1><p id="41d3" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">对于许多将映像部署到ECS的微服务，可重用的工作流已经确定了部署的细节，但是对于部署docker映像之外的工件的微服务，例如将jar文件部署到Lambda函数，当工件的路径没有正确定义时，可能会出现错误“没有这样的文件或目录”,特别是在monorepo场景中，或者在现有遗留存储库中的嵌套项目结构中。每当需要工件路径时，一定要指定工件的完整文件路径。</p><h1 id="236e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">错误#11:发布工作流失败，工件已经存在错误</strong></h1><p id="8242" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">快照版本可以发布多次，但发布版本只能发布一次。如果开发人员试图在版本已经发布之后发布相同的版本(唯一可能的原因是开发人员忘记将最新的代码从<code class="fe ms mt mu mv b">release</code>分支合并到<code class="fe ms mt mu mv b">release</code>之后的<code class="fe ms mt mu mv b">main</code>中)，发布工作流将抛出工件“已经存在”的错误。避免这种错误的唯一方法是，一旦一个版本被成功发布到GitHub包，确保发布分支被合并回<code class="fe ms mt mu mv b">main</code>，这将把<code class="fe ms mt mu mv b">main</code>中的版本提升到下一个快照。</p><h1 id="6601" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">错误#12: <strong class="ak">调用DescribeTaskDefinition操作时出错(ClientException):无法描述任务定义</strong></h1><p id="054b" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">如果您的工作流程在<code class="fe ms mt mu mv b">describe-task-definition</code>步骤失败，出现下面截图中的错误，您需要检查两件事:</p><ol class=""><li id="4b0a" class="nt nu it la b lb lc le lf lh ol ll om lp on lt ny nz oa ob bi translated">确保<code class="fe ms mt mu mv b">ECS_TASK_DEFINITION</code>的秘密配置中没有打字错误。</li><li id="58e0" class="nt nu it la b lb oc le od lh oe ll of lp og lt ny nz oa ob bi translated">如果您在与repo's secret中定义的默认<code class="fe ms mt mu mv b">AWS_REGION</code>位于不同区域的环境/帐户中运行此工作流，您需要在环境secret中定义<code class="fe ms mt mu mv b">AWS_REGION</code>和<code class="fe ms mt mu mv b">AWS_DEFAULT_REGION</code>，以在存储库或组织级别覆盖这些secret的值。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/ea42c9f694a45b505aab50fcefaf4fc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UT5rb51G88U9msz2OG2X0A.png"/></div></div></figure><h1 id="7f3e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">错误#13: <strong class="ak">错误“无法加载凭证，请检查您的操作输入:无法从任何提供者加载凭证”</strong></h1><p id="6ffb" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">如果您的工作流在<code class="fe ms mt mu mv b">configure-aws-credentials</code>步骤失败，并出现上述错误，请参见下面的屏幕截图，根本原因是OIDC的权限问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/bfc90c02f1285fdde5d7ff9aafa8fe1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TZg8l7Km5lAF7wo-qgXKTg.png"/></div></div></figure><p id="7c92" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您需要为OIDC <code class="fe ms mt mu mv b">id-token: write</code>添加权限。如果您的工作流正在调用可重用工作流，权限是在调用方工作流中设置的，而不是在可重用工作流中设置的，因此在调用可重用工作流之前，请确保调用方工作流已正确设置了以下权限(第5–6行),示例如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h1 id="fbfd" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">错误14: " <strong class="ak"> npm ERR！代码E400 </strong></h1><p id="5da1" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">当您尝试将一个npm包发布到GitHub包时，如果您遇到此错误，详细信息如下:</p><p id="f0ff" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ms mt mu mv b">“253npm ERR! 400 Bad Request — PUT <a class="ae lu" href="https://npm.pkg.github.com/@arisglobal%2fagcp-ui" rel="noopener ugc nofollow" target="_blank">https://npm.pkg.github.com/@&lt;</a>repo-name&gt;— failed to stream package from json: unhandled input: Cannot publish over existing version”</code></p><p id="3f4e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它表示您不能将相同版本的包发布到GitHub包，因为相同的版本已经存在。因此，请尝试升级版本并重试。</p><h1 id="e72f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">错误15: <strong class="ak">试图启动工作目录为</strong>的进程“/usr/bin/bash”时出错</h1><p id="1041" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">这个错误看起来很棘手，尤其是当所有工作目录和路径都为工作流正确定义时。修复其实非常简单。您需要始终将签出代码操作(<code class="fe ms mt mu mv b">actions/checkout</code>)放在硬化运行程序步骤(<code class="fe ms mt mu mv b">step-security/harden-runner</code>)之后。一旦顺序被切换，这个错误就消失了！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/99599d97c9fa88f18575ffc0352eaea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DnbkTyH3oYGufIOATDpoQQ.png"/></div></div></figure><h1 id="ffeb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">错误16: <strong class="ak">“对等方重置连接”</strong></h1><p id="1c8a" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">如果您在<code class="fe ms mt mu mv b">terraform plan</code>或<code class="fe ms mt mu mv b">terraform apply</code>步骤期间遇到间歇性错误“<strong class="la iu">连接被对等方重置</strong>”，请注意这是哈希公司<code class="fe ms mt mu mv b">terraform-provider-aws</code>的已知问题，根本原因似乎是AWS API速率限制:<a class="ae lu" href="https://github.com/hashicorp/terraform-provider-aws/issues/23614" rel="noopener ugc nofollow" target="_blank">terra form应用问题#23614哈希公司/terra form-provider-AWS(github.com)</a>时，间歇性连接被对等方重置。</p><p id="ae0c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此处提交了在这种错误情况下重试的增强功能，<a class="ae lu" href="https://github.com/hashicorp/terraform-provider-aws/issues/10715" rel="noopener ugc nofollow" target="_blank">添加了当请求的连接被对等问题重置时的重试处理# 10715 hashi corp/terra form-provider-AWS(github.com)</a>。</p><p id="f3b8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在撰写本文时，该增强仍处于开放状态。我们希望HashiCorp团队能够尽快实现这一改进。同时，如果您在工作流程运行期间遇到这样的错误，请重试您的工作流程，错误通常会消失。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/a6cdc5706a50eae606886fdfe09fe6a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oD18X_dUgKroCuhT5iSroQ.png"/></div></div></figure><h1 id="6f71" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">错误17: <strong class="ak">在设置步骤</strong>中未找到版本###</h1><p id="9969" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">这个错误是在我们的一个Python应用程序的“设置Python”步骤中发现的。见下面截图。这看起来很奇怪，因为相同工作流的前几次运行在设置Python时都没有问题。这个问题的根本原因是Ubuntu/Python版本的兼容性。</p><p id="7b7a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你的GitHub托管的工作流运行器运行在<code class="fe ms mt mu mv b">ubuntu-latest</code>版本上，这可能意味着不同的Ubuntu版本号，取决于最新的Ubuntu版本。例如，以下工作流的Ubuntu版本为22.04，它没有为该操作提供python版本3.8.8，如错误消息下方的屏幕截图中的链接所示，而工作流在Ubuntu版本20.04之前运行，该版本为该特定操作提供python版本3.8.8。</p><p id="bc0d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">版本不兼容的经典例子。修复方法是在工作流文件中将兼容的Ubuntu版本从<code class="fe ms mt mu mv b">runs-on: ubuntu-latest</code>改为<code class="fe ms mt mu mv b">runs-on: ubuntu-20.04</code>。升级Python版本的应用程序需要开发团队付出更多的努力和测试，这仍然是团队长期考虑的一个选项。最佳实践是在一段时间后重新访问这个版本清单链接，看看最新的Ubuntu版本是否支持您的特定Python版本，并相应地升级Ubuntu版本。或者更好的是，当资源和时间准备好时，升级你的应用程序的Python版本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/6d38c5884dfae481236e205c4696e253.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mi6nwB48SefhckUsf7FzCA.png"/></div></div></figure><p id="1fa4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要了解您的工作流运行器运行在哪个版本的Ubuntu上，您可以在工作流运行结果页面中展开“设置作业”步骤，展开“操作系统”以捕获实际的Ubuntu版本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/02855aff59f6507fc4f6e89940f8c16a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*XaJbf64rgekBsyi7ZfhMlA.png"/></div></figure></div><div class="ab cl ou ov hx ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="im in io ip iq"><p id="a2d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们探讨了我在使用GitHub Actions工作流程时遇到的一些错误。我希望这个列表有助于那些使用GitHub Actions工作流的人节省一些故障排除时间。</p><p id="70ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">编码快乐！</p></div></div>    
</body>
</html>