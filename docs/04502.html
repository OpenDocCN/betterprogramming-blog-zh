<html>
<head>
<title>Exploring Scoped Storage in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索Android中的作用域存储</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/exploring-scoped-storage-in-android-f309a7208baa?source=collection_archive---------2-----------------------#2020-04-17">https://betterprogramming.pub/exploring-scoped-storage-in-android-f309a7208baa?source=collection_archive---------2-----------------------#2020-04-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="385c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">面向Android开发者的全新存储系统</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/294420c78f2068a738f71f82b9a1f7ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8aZiPzk4s0nM-hPM"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">弗兰克·麦凯纳在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片。</p></figure><p id="e6ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你看到最近在Android操作系统层面上的改进，团队主要关注的是安全性和隐私。例如，为了在Android中提供安全的偏好存储，该团队最近发布了<a class="ae ky" href="https://developer.android.com/reference/androidx/security/crypto/EncryptedSharedPreferences" rel="noopener ugc nofollow" target="_blank"> EncryptedSharedPreferences库</a>。关于位置和麦克风等敏感数据权限，单次权限——应用程序只能访问该实例——出现了。</p><p id="31d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，由于与存储相关，我们得到了范围存储，其中媒体的整个库访问仅可用于Play Console中的白名单应用程序。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="aa06" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">问题</h1><p id="2303" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Android存储系统有两个问题，即使在发明了十年之后，这两个问题也导致了创建新的存储系统:</p><ol class=""><li id="3006" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">任何拥有<code class="fe ni nj nk nl b">READ_EXTERNAL_STORAGE </code>和<code class="fe ni nj nk nl b">WRITE_EXTERNAL_STORAGE </code>权限的Android应用程序都可以很容易地访问和使用你的媒体文件。</li><li id="53bc" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated">大多数请求存储权限的应用程序不需要媒体文件的宽视图。使用一个聊天应用程序，您可以在其中上传媒体或将媒体文件写入系统。该应用程序只需要访问单个媒体文件，但在目前的生态系统中，整个媒体集合都暴露在该应用程序中。</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c27a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">解决方案范围的存储</h1><p id="6f21" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">作用域存储的出现扭转了局面。它根据应用程序的要求限制媒体文件的曝光。从Android 10开始，如果没有被列入Play控制台的白名单，你将无法访问整个媒体收藏。它还提供了一个新的媒体框架，我们可以在其中执行简单的任务，例如在聊天应用程序中访问媒体文件，并将文件保存到系统中，而无需任何存储权限。</p><p id="9864" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并不是所有的公司都有足够的开发人员专注于像范围存储这样的新变化。因此，Android团队决定在下一个Android版本发布之前同时支持新的作用域存储和旧的原生存储系统。也就是说，面向API级别29的应用程序必须在清单文件中包含<code class="fe ni nj nk nl b">requestLegacyExternalStorage</code> <strong class="lb iu"> </strong>标志，以便与旧的存储系统一起工作。看一看:</p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="b3c7" class="nv md it nl b gy nw nx l ny nz">&lt;<strong class="nl iu">application<br/>    </strong>android:allowBackup="true"<br/>    android:icon="@mipmap/ic_launcher"<br/>    android:label="@string/app_name"<br/>    android:roundIcon="@mipmap/ic_launcher_round"<br/>    android:supportsRtl="true"<br/>    android:<strong class="nl iu">requestLegacyExternalStorage</strong>="true"<br/>    android:theme="@style/AppTheme"&gt;<br/>&lt;<strong class="nl iu">/application&gt;</strong></span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e47e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何使用作用域存储</h1><p id="5d2a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">正如我所说的，有两种方法可以使用作用域存储来访问媒体:</p><ul class=""><li id="8741" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu oa nf ng nh bi translated">只需要将媒体文件保存为个人资料图片或用作电子邮件附件的应用程序。</li><li id="1794" class="mz na it lb b lc nm lf nn li no lm np lq nq lu oa nf ng nh bi translated">需要访问所有媒体文件的应用程序(例如音乐播放器和文件浏览器)。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5d7c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">简单用法</h1><p id="03b5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">作用域存储使得只需要用户选择的媒体文件(从存储中读取数据)或将媒体文件保存到存储中(写入文件)的应用变得更加容易。</p><h2 id="fd95" class="nv md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated">读取文件</h2><p id="bda8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这里，我们使用一个<code class="fe ni nj nk nl b">Intent</code>来启动一个新的活动，用户可以在其中选择一个媒体文件，在<code class="fe ni nj nk nl b">onActivityResult</code>中，我们可以获得文件<code class="fe ni nj nk nl b">URI</code>。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="c76f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ni nj nk nl b">ACTION_OPEN_DOCUMENT </code>作为一个动作，启动一个活动，将指定类型的媒体文件呈现给用户，根据用户的选择，数据在<code class="fe ni nj nk nl b">onActivityResult</code>中可用(如上图)。</p><p id="39e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ni nj nk nl b">CATEGORY_OPENABLE </code>表示该意向只需要可以用<code class="fe ni nj nk nl b">contentResolver</code>打开的URIs。</p><h2 id="2194" class="nv md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated">写文件</h2><p id="c7b0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这与读取文件是一样的。我们必须在<code class="fe ni nj nk nl b">onActivityResult</code>中开始意图并观察结果。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="e19f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了这里的动作类型之外，其他都和上面一样。我们使用<code class="fe ni nj nk nl b">ACTION_CREATE_DOCUMENT </code>来指示系统创建文件并恢复它的<code class="fe ni nj nk nl b">URI </code>，我们还必须指定文件的类型。我们也可以使用intent上的<code class="fe ni nj nk nl b">EXTRA_TITLE </code>标志来设置文件的名称。</p><p id="903f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">系统将在应用程序的私有存储下创建这个文件，这样即使没有存储权限，我们也可以访问它们，这是作用域存储的一个显著特点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e697" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">复杂用法</h1><p id="f2f9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于音乐播放器和文件浏览器这样的应用程序来说，访问单个文件是不够的。<code class="fe ni nj nk nl b">READ_EXTERNAL_STORAGE </code>权限是强制性的，因为他们需要访问存储中的每个文件。通过使用下面这段代码，我们可以访问文件列表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8160" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">媒体元数据</h1><p id="38fa" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">作用域存储已经采取措施来保护可能潜在地暴露用户的位置历史的媒体的元数据。因此，如果应用程序具有必要的权限，您通过作用域存储访问的媒体文件仅提供元数据。</p><p id="a1c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>