<html>
<head>
<title>Improving Mail Delivery in an iOS App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">改进iOS应用程序中的邮件发送</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/improving-mail-delivery-in-an-ios-app-fcab74e6274?source=collection_archive---------8-----------------------#2019-10-27">https://betterprogramming.pub/improving-mail-delivery-in-an-ios-app-fcab74e6274?source=collection_archive---------8-----------------------#2019-10-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="614d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">苹果MFMailComposeViewController的替代产品</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bf47f2d1378d13b1a387a20072757388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4osNXD_y3RZ8wQQmiXyB0g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://pixabay.com" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/ribkhan-380399/" rel="noopener ugc nofollow" target="_blank"> ribkhan </a></p></figure><p id="d721" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论你是想收集反馈还是为你的用户提供一种联系你的方式，在很多情况下，让用户在你的应用内发送电子邮件是一个好主意。</p><p id="66e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最简单的方法是使用苹果的<code class="fe lv lw lx ly b">MFMailComposeViewController</code>，它是<code class="fe lv lw lx ly b">MessageUI</code>框架的一部分。</p><p id="8bdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您解释如何设置和显示这个视图控制器。此外，我们将看到它的一些缺点，以及如何使用发送电子邮件的替代方式。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="1f0c" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">使用MFMailComposeViewController发送邮件</h1><p id="50a2" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">什么是<code class="fe lv lw lx ly b">MFMailComposeViewController</code>？</p><p id="d24a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它是一个显示电子邮件内容的视图控制器。它可以由开发人员预先填充，但用户可以更改任何值，并需要手动发送。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/6ae23891bb4690bfbf528e97667f18e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*hinaNAVHqWYB18qPN5A2Ww.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe lv lw lx ly b">MFMailComposeViewController in iOS 13.</code></p></figure><p id="c60c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我们如何展示这样一个视图控制器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建并呈现MFMailComposeViewController。</p></figure><p id="eec0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">// 1</code>需要导入<code class="fe lv lw lx ly b">MessageUI</code>才能使用<code class="fe lv lw lx ly b">MFMailComposeViewController</code>。</p><p id="fb13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">// 2</code>由于您的用户可能没有邮件帐户，我们需要检查是否可以发送邮件。</p><p id="3568" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可以通过使用方法<code class="fe lv lw lx ly b">canSendMail</code>来完成。如果用户的设备没有设置为发送电子邮件，您可以显示一个警告或使用<code class="fe lv lw lx ly b">mailto</code>打开一个URL，但是在本例中，我们将只打印一条错误消息。</p><p id="ca6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">// 3</code>接下来，我们需要创建<code class="fe lv lw lx ly b">MFMailComposeViewController</code>，它将被呈现。这样做时，我们可以定制邮件的每个方面。我们可以设置其主题，添加收件人列表、抄送和密件抄送。</p><p id="b512" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">电子邮件的正文可以设置为HTML或普通文本。要将数据作为附件添加，需要数据、附件的标题和mime类型。</p><p id="1238" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以在这里找到可能的mime类型的详细列表<a class="ae ky" href="https://gist.github.com/AshvinGudaliya/6f9cfb2e7c90453161cfc3adfa758819" rel="noopener ugc nofollow" target="_blank">。我们甚至可以将用户的电子邮件地址设置为首选发送地址，这样用户就不需要在电子邮件准备好后再去处理它了。</a></p><p id="e085" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还需要设置一个<code class="fe lv lw lx ly b">mailComposeDelegate</code>来处理这个<code class="fe lv lw lx ly b">MFMailComposeViewController</code>上的事件。</p><p id="01d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">// 4</code>最后我们可以展示一下<code class="fe lv lw lx ly b">MFMailComposeViewController</code>。</p><p id="6c77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦用户完成，代理将被通知，因此呈现视图控制器的方法<code class="fe lv lw lx ly b">mailComposeController(_:didFinishWith:error:)</code>将被调用。</p><p id="139d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们可以检查用户是否确实发送了电子邮件，电子邮件是否被保存以便稍后发送，或者发送是否被取消或失败。在大多数情况下，您可能只是想取消当前的<code class="fe lv lw lx ly b">MFMailComposeViewController</code>，因为不再需要它了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实现mfmailcompositeviewcontrollerdelegate。</p></figure><p id="3807" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管您可以提供自己的UI让用户输入收件人、主题和文本，但您仍然需要提供这个额外的视图控制器，因为如果不这样做，Apple就无法发送电子邮件。</p><p id="2dfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在许多情况下，这可能不是最佳解决方案，并且可能有一些缺点，这取决于您的使用情况。</p><p id="fca4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最大的缺点是你向你的用户公开了一切。他们可以看到整个邮件、每个可能附加的文件以及收件人的电子邮件地址。</p><p id="8dc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，用户需要在他们的设备上设置一个邮件帐户，否则他们将无法发送任何邮件。此外，由于用户明确需要确认发送邮件，他们通过应用程序的流程并不像它应该的那样方便。</p><p id="5781" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，幸运的是，还有另外一种发送邮件的方式。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="5a56" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">使用Mailjet发送邮件</h1><p id="6ca5" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">Mailjet 是一种允许你通过HTTP请求发送电子邮件的服务。</p><p id="6861" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有许多类似的服务，但Mailjet很容易设置，并有一个慷慨的免费计划，每月可以发送多达6000封电子邮件，每天200封电子邮件，无需付费。</p><p id="821c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于电子邮件是通过HTTP请求发送的，您可以提供您的邮件地址作为收件人，而不会向您的用户透露。此外，用户无法接触到关于邮件的任何详细信息。</p><p id="ec8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，让我们来看看你需要做什么。</p><p id="dfc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一部分是创建你的邮件。这可以通过定义一个JSON字符串并将所有数据嵌入其中来实现。</p><p id="e0d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该字符串包含以下部分:</p><ul class=""><li id="2857" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated"><code class="fe lv lw lx ly b">From</code>部分:发件人的邮件地址和发件人的姓名。重要的是，发件人的邮件地址是您在Mailjet注册的邮件地址，否则邮件将不会被发送！</li><li id="7d6d" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><code class="fe lv lw lx ly b">To</code>部分:邮件地址和收件人姓名列表。</li><li id="ed30" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><code class="fe lv lw lx ly b">Cc/Bcc</code>部分:电子邮件地址和抄送/密件姓名列表。</li><li id="a39a" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><code class="fe lv lw lx ly b">Subject</code>:邮件的主题。</li><li id="cc5d" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><code class="fe lv lw lx ly b">TextPart/HTMLPart</code>:普通文本或HTML格式的邮件正文。</li><li id="8fd3" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><code class="fe lv lw lx ly b">Attachments</code>:内容类型(或mime类型)、名称和内容为base64编码字符串的附加文件。</li></ul><p id="3187" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，您可以看到这样一个字符串是如何构造的示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建您的邮件内容。</p></figure><p id="5467" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置好邮件数据后，您就可以请求发送邮件了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">正在向Mailjet发送请求。</p></figure><p id="1b2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">// 1</code>为了对Mailjet进行授权，我们将使用提供给我们的登录数据。您可以在创建帐户后显示的示例中找到它。</p><p id="f3ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将秘密密钥附加到API密钥上，由<code class="fe lv lw lx ly b">:</code>分隔，并将它们转换成base64编码的字符串。这个登录数据被添加到我们将在下一步创建的请求中。</p><p id="e296" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">// 2</code>现在我们创建实际的请求，它将被发送到显示的URL。我们指定一个<code class="fe lv lw lx ly b">httpMethod</code>，添加所需的<code class="fe lv lw lx ly b">httpHeaderFields</code>，将之前创建的JSON字符串设置为<code class="fe lv lw lx ly b">httpBody</code>，并添加我们在第一步中准备的登录数据。</p><p id="2019" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">// 3</code>最后，这个请求可以发送了。在闭包中，我们可以检查响应并确保没有任何错误。</p><p id="caa2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你不想让你的用户看到和改变邮件的每一个细节时，Mailjet是一个优雅的选择。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="64f5" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">资源</h1><ul class=""><li id="98e7" class="ng nh it lb b lc my lf mz li nu lm nv lq nw lu nl nm nn no bi translated"><a class="ae ky" href="https://www.mailjet.com" rel="noopener ugc nofollow" target="_blank"> Mailjet </a>网站。</li><li id="3b9e" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">用于将数据附加到<code class="fe lv lw lx ly b">MFMailComposeViewController</code>的mime类型及其标识符的<a class="ae ky" href="https://gist.github.com/AshvinGudaliya/6f9cfb2e7c90453161cfc3adfa758819" rel="noopener ugc nofollow" target="_blank">扩展列表。</a></li></ul></div></div>    
</body>
</html>