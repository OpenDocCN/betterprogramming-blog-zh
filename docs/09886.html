<html>
<head>
<title>Automating Sticker Generation With Web Scraping and Image Processing in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python中的Web抓取和图像处理自动生成贴纸</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/automating-sticker-generation-with-web-scraping-and-image-processing-in-python-6eccdc39975c?source=collection_archive---------1-----------------------#2021-10-26">https://betterprogramming.pub/automating-sticker-generation-with-web-scraping-and-image-processing-in-python-6eccdc39975c?source=collection_archive---------1-----------------------#2021-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4ccc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为消息平台快速生成贴纸</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4eadb8444714db03d6655c8e078fd58d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4CfFj1J5czzB0qEt"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@slidebean?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Slidebean </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="b061" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我将告诉你我是如何从网上商店的海报图片中生成42个电报贴纸的。店里卖各种有搞笑双关语的海报，但是没有对应的贴纸。让我们创造它们吧！</p><p id="381b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">唯一的问题是，要制作一张贴纸，你需要从网页上下载一张图片，在photoshop中将字母与背景分开，并以适合电报贴纸的分辨率保存。对于42幅图像来说，这将是非常耗时的，所以让我们尝试自动化这个过程。</p><p id="7140" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以计划是这样的:</p><ol class=""><li id="f315" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">web scraping——解析网上商店的所有图片。</li><li id="b38e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">自动从背景中分离字母，从背景中删除阴影，使图片看起来更像扫描。</li></ol><h1 id="51c0" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">下载图片</h1><p id="d89a" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">首先，让我们创建一个单个海报页面的所有链接的列表。这样，我们就可以下载高分辨率的图片了。主画廊里的照片分辨率太小了。</p><p id="a7fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，让我们保存图库中图片的所有链接。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="02ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">画廊分为四页，每一页包含15张海报。要进入下一页，加上<code class="fe nf ng nh ni b">?offset=</code> 15或30或45就足够了。这允许我们解析剩余的链接。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="6992" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后一部分就是按照所有的链接，从产品页面下载高分辨率的图片。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5176" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图片由海报上的文字命名，所以我们需要删除名称中的禁用字符，如“/”、“和“*”。</p><h1 id="6716" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">图像处理</h1><p id="f3fc" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">不幸的是，网上商店包含海报的照片，而不是扫描件。所以我们不能照原样使用它们。下面是一个典型图片的示例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/1d7faf424cd8ca8da2ecdded78615deb.png" data-original-src="https://miro.medium.com/v2/resize:fit:412/format:webp/1*JdEGodwxxWGUfsHlojsTXQ.png"/></div></figure><p id="6a4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图片上的poser是从侧面照亮的。这使得纸张的纹理清晰可见。在某些情况下，使用亮度阈值来区分字母很有挑战性，因为在某些情况下，字母可能比背景的某些部分更亮。这种方法在这种情况下并不通用。</p><p id="4acf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了实现一种适合所有可能的光线条件的方法，让我们利用所有海报都在白色或灰色背景上包含大红色字母的事实。数字图像的每个像素是三个数字的向量。一个灰色的像素，不管是亮还是暗，都是由三个相似的数字组成，而一个彩色的像素会包含彼此不同的数字。</p><p id="7d8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，基于标准差阈值而不是亮度来分离背景更有效。经过几次尝试，我发现这样一个阈值的一个好的估计是30。</p><p id="0e9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在检测到一个像素是背景的一部分后，让我们将它的值设置为(245，245，245)。作为字母一部分的像素将被设置为更接近(200，17，11)。背景不会是完美的白色，但这样看起来更好，因为没有完美的白纸，贴纸需要模仿海报。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="1971" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/7787a0081b9210de70e00b7a09dfc208.png" data-original-src="https://miro.medium.com/v2/resize:fit:412/format:webp/1*YXuxwWZnPLwi5Ho-149mTw.png"/></div></figure><p id="d2dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，最后一步是调整图像的大小，使最长的尺寸为512。为了调整所有图像的大小并保存为png文件，我将使用PIL图书馆。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="4e7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/83f7bb5846db87b157315ed4873bad1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MAOuu9y8-ZFQR8Bwspf7sw.jpeg"/></div></div></figure><p id="2768" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以及GitHub 的<a class="ae kv" href="https://github.com/Megachell/sticker-generation" rel="noopener ugc nofollow" target="_blank">链接给感兴趣的人。</a></p></div></div>    
</body>
</html>