<html>
<head>
<title>Build a Hands-Free Dark Mode Switcher in Chrome With Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用机器学习在Chrome中构建一个免提黑暗模式切换器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-hands-free-dark-mode-switcher-in-chrome-with-machine-learning-2faa9417d3f4?source=collection_archive---------4-----------------------#2021-12-23">https://betterprogramming.pub/build-a-hands-free-dark-mode-switcher-in-chrome-with-machine-learning-2faa9417d3f4?source=collection_archive---------4-----------------------#2021-12-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1dcd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过拍手使你的网页进入黑暗模式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dfdb79f0c36ec2387a23e9c79994b4eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sOPo8tNEv5NewTGA"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@austinban?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">奥斯汀·班</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="d024" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我今天有点时间，所以我决定分享一些有趣的信息。在我的家庭办公室里，我制作了一个小型的黑暗和光明模式切换器，但是是免提的…做了一点调查，几个小时后我得到了这个结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="5071" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以…让我们开始吧。</p><h1 id="4c5f" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">训练模型</h1><p id="fab2" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">首先，我训练这个模型，以确保检测拍手的声音是可行的。我使用了<a class="ae ky" href="https://teachablemachine.withgoogle.com/" rel="noopener ugc nofollow" target="_blank">可教机器平台(打开新窗口)</a>，并开始了一个音频项目。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/457ee538cd507bda3d4fe4074556a018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dRz_e8Rry3TmL6f4.png"/></div></div></figure><p id="8c54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步是为你的背景音录一些例子。在那之后，你可以记录一些其他的<strong class="lb iu">类</strong>(定义)比如用手拍手。</p><p id="06ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我还记录了语音样本，以便模型能够识别语音“看起来像什么”,而不会误认为是拍手。</p><p id="5d93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您录制了一些示例声音并将它们添加到类中之后，您就可以开始训练模型了。训练结束后，您可以<strong class="lb iu">导出</strong>模型以备使用。我决定把它放在谷歌上，因为这是存储训练好的模型的最快最简单的方法。</p><h1 id="d354" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">构建Chrome扩展</h1><p id="56d7" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">关于如何构建一个Chrome扩展，我不会说太多细节，因为有很多不同的选择，但这里是我为自己做的。</p><p id="b2aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您至少需要一个manifest.json文件，它将包含关于您的扩展的详细信息。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="e668" class="na ly it mw b gy nb nc l nd ne">{<br/>    "name": "Darkmode Clapper",<br/>    "description": "Toggle dark mode by clapping your hands!",<br/>    "version": "1.0",<br/>    "manifest_version": 3,<br/>    "permissions": ["storage", "activeTab"],<br/>       "content_scripts": [<br/>      {<br/>        "js": ["content.js"],<br/>        "matches": ["https://app.netlify.com/*"],<br/>        "all_frames": true<br/>      }<br/>    ]<br/>  }</span></pre><p id="6831" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个项目最重要的部分是权限和内容脚本。</p><h1 id="66b1" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">内容脚本</h1><p id="f235" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated"><a class="ae ky" href="https://developer.chrome.com/docs/extensions/mv2/content_scripts/" rel="noopener ugc nofollow" target="_blank">内容脚本(打开新窗口)</a>是在网页环境中运行的文件，因此它们可以访问浏览器当前正在访问的页面。</p><p id="a083" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据您在manifest.json文件中的配置，这将在任何选项卡或仅特定选项卡上触发。由于我添加了参数“matches”:[“https://app . netlify . com/*]，这仅在我使用web应用程序时触发。</p><p id="2d2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我可以开始触发声音检测专用代码。</p><h1 id="9402" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">设置TensorFlow.js以检测声音</h1><p id="8e14" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">当使用TensorFlow.js时，我通常在我的机器上将模型导出为文件，但这次我决定使用另一个选项，并将其上传到Google Cloud。这样，就可以通过URL访问它。否则，您可以将其存储在自己的web服务器或像Azure blob存储这样的存储中。</p><p id="8ccd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你可以开始破解了，你需要从创建你的模型开始:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="e912" class="na ly it mw b gy nb nc l nd ne">const URL = SPEECH_MODEL_TFHUB_URL; //URL of your model uploaded on Google Cloud.<br/>const recognizer = await createModel();<br/><br/>async function createModel() {<br/>  const checkpointURL = URL + "model.json";<br/>  const metadataURL = URL + "metadata.json"; // model metadata<br/><br/>  const recognizer = speechCommands.create(<br/>    "BROWSER_FFT",<br/>    undefined,<br/>    checkpointURL,<br/>    metadataURL<br/>  );<br/><br/>  await recognizer.ensureModelLoaded();<br/>  return recognizer;<br/>}</span></pre><p id="544d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦完成，你就可以开始实时预测了:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="4e6e" class="na ly it mw b gy nb nc l nd ne">const classLabels = recognizer.wordLabels(); // An array containing the classes trained. In my case ['Background noise', 'Clap', 'Speech']<br/><br/>recognizer.listen(<br/>  (result) =&gt; {<br/>    const scores = result.scores; // will be an array of floating-point numbers between 0 and 1 representing the probability for each class<br/>    const predictionIndex = scores.indexOf(Math.max(...scores)); // get the max value in the array because it represents the highest probability<br/>    const prediction = classLabels[predictionIndex]; // Look for this value in the array of trained classes<br/><br/>    console.log(prediction);<br/>  },<br/>  {<br/>    includeSpectrogram: false,<br/>    probabilityThreshold: 0.75,<br/>    invokeCallbackOnNoiseAndUnknown: true,<br/>    overlapFactor: 0.5,<br/>  }<br/>);</span></pre><p id="70ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一切正常，当这段代码运行时，它应该会根据现场音频数据的预测记录“背景噪音”或“拍手声”。</p><p id="abf9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，为了切换Netlify的黑暗模式，我用一些小逻辑替换了console.log语句。目前实现黑暗模式的方式是在主体上添加一个tw-dark类。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="b4b4" class="na ly it mw b gy nb nc l nd ne">if (prediction === "Clap") {<br/>  if (document.body.classList.contains("tw-dark")) {<br/>    document.body.classList.remove("tw-dark");<br/>    localStorage.setItem("nf-theme", "light");<br/>  } else {<br/>    document.body.classList.add("tw-dark");<br/>    localStorage.setItem("nf-theme", "dark");<br/>  }<br/>}</span></pre><p id="a829" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还更新了localStorage中的值，使其持久化。</p><h1 id="4187" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">安装延伸部分</h1><p id="512c" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">为了能够测试这段代码是否有效，您必须在浏览器中安装该扩展。</p><p id="9e6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(在这样做之前，您可能需要捆绑您的扩展，这取决于您使用的工具。)</p><p id="8d3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要安装它，请遵循以下步骤:</p><ul class=""><li id="ad1e" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">访问chrome://extensions</li><li id="3454" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">切换位于页面右上角的开发人员模式</li><li id="4aee" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">单击Load unpacked并选择包含捆绑扩展的文件夹</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/c9aa5280ea5fcebe6ebd7ec66b54aec9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/0*S4oKvBq6sBPaqL9x.png"/></div></figure><p id="84c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一切顺利，你应该访问任何你想运行扩展的页面，它应该请求麦克风的许可，以便能够检测现场音频，并开始预测！</p><p id="64aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！总的来说，这个项目甚至不是真正的切换黑暗模式，但我想学习使用TensorFlow.js作为Chrome扩展有一段时间了，所以这似乎是一个完美的机会！</p><p id="6a72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在我的<a class="ae ky" href="https://github.com/SBajonczak/BlogClapExample" rel="noopener ugc nofollow" target="_blank"> Github </a>上查看这个项目的源代码</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="576f" class="na ly it mw b gy nb nc l nd ne"><strong class="mw iu">Want to Connect With the Author?</strong></span><span id="23f0" class="na ly it mw b gy nu nc l nd ne">This post was originally posted on this <a class="ae ky" href="https://blog.bajonczak.com/Machinelearning/#what-the-heck" rel="noopener ugc nofollow" target="_blank">blog</a>.</span></pre></div></div>    
</body>
</html>