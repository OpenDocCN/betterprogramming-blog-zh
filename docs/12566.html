<html>
<head>
<title>State Management in Flutter Using Riverpod, StateNotifier, Freezed, and DDD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Riverpod、StateNotifier、Freezed和DDD的颤振状态管理</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/riverpod-statenotifier-freezed-ddd-combination-to-manage-the-state-powerfully-in-flutter-e674ba7e932c?source=collection_archive---------5-----------------------#2022-06-14">https://betterprogramming.pub/riverpod-statenotifier-freezed-ddd-combination-to-manage-the-state-powerfully-in-flutter-e674ba7e932c?source=collection_archive---------5-----------------------#2022-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1847" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们构建一个Todo应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/dab23905715323d0a4de550b0a3b04f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RYnQhSv_Nbn7NCARW1Xr6Q.jpeg"/></div></div></figure><blockquote class="kr ks kt"><p id="ee9e" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注:在开始之前，如果你想看这个项目的链接，可以在这里访问项目<a class="ae lr" href="https://github.com/alper-efe-sahin/todo_riverpod_ddd_freezed_statenotifier" rel="noopener ugc nofollow" target="_blank">。同样是这个项目，在YouTube上，我上传了一个视频，所以你也可以从</a><a class="ae lr" href="https://youtu.be/wtw_5d7VWmQ" rel="noopener ugc nofollow" target="_blank">这里</a>观看。</p></blockquote><p id="4747" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">大家好。在本文中，我们将使用river pod+state notifier+Freezed+域驱动设计(DDD)创建一个Todo应用程序。当我写这篇文章的时候，我也在上传与这篇文章相关的视频。所以，你想要什么，你就可以做什么，你既可以读，也可以看。</p><p id="7c90" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">首先，在这篇文章中我不会解释所有的事情，因为有一个视频。我只是创建架构，我试着教如何用其他东西创建Riverpod。</p><p id="fcdb" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">好了，我们开始吧。</p><h1 id="af03" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">待办事项应用程序</h1><p id="727b" class="pw-post-body-paragraph ku kv iq kx b ky mn jr la lb mo ju ld ls mp lg lh lt mq lk ll lu mr lo lp lq ij bi translated">我在做一个待办应用，因为它很简单，对吧？我不想创建<code class="fe ms mt mu mv b">COUNTER</code>应用程序，因为有很多计数器应用程序，我不想再看到更多。所以我会创建一个简单的待办事项应用程序。</p><p id="5721" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">同样在我的GitHub上，我还有一条内容，就是<code class="fe ms mt mu mv b">rickandmortyapi</code>，又和river pod+state notifier+Freezed+域驱动设计(DDD)有关。我还会写文章和上传视频，但这个待办事项应用程序对于了解我们如何使用Riverpod非常重要。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><p id="7df3" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">首先，让我们看看我们的架构(文件夹):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/051a63b749929eaaaf1979d0f32b561d.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*07Mu4JnZLKvDJSS-LCg7VQ.png"/></div></figure><p id="5d31" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">这里我们有应用程序文件夹，用于业务逻辑。领域、表示、可能还有基础设施等等。它们在这里(文件结构部分)有很好的解释<a class="ae lr" href="https://medium.com/@sahinefe/bloc-pattern-for-login-bloc-login-in-flutter-551fd05beb99" rel="noopener">。</a></p><p id="2675" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">接下来，在创建小部件(我指的是基本UI)之后，我们可以转移到真正的问题:</p><blockquote class="kr ks kt"><p id="c842" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们如何同时使用river pod+state notifier+Freezed+域驱动设计(DDD)。</p></blockquote><p id="955a" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">注意:对于这个项目，这里是<code class="fe ms mt mu mv b">pubspec.yaml</code>文件(对于包，如果你想使用它们):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6d8b" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">首先，让我们创建一个域文件夹，它有一些模型。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="b38c" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">创建模型后，我们需要运行下面的代码:</p><pre class="kg kh ki kj gt ng mv nh ni aw nj bi"><span id="ca00" class="nk lw iq mv b gy nl nm l nn no">flutter packages pub run build_runner build — delete-conflicting-outputs</span></pre><p id="8d60" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">…错误就会消失。</p><p id="cca9" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">其次，我们有应用程序文件夹的文件。</p><p id="7de3" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">让我们也创建它们。当你创建这个架构时，那么你需要从创建一个状态文件开始，因为你可能会感到困惑(这只是一个建议)。</p><p id="ef58" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">这是我们的<code class="fe ms mt mu mv b">todo_state.dart</code>文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c91f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">之后，创建<em class="kw"> </em> <code class="fe ms mt mu mv b">todo_event.dart</code>文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d664" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">创建todo状态和todo事件后，我们需要运行以下代码:</p><pre class="kg kh ki kj gt ng mv nh ni aw nj bi"><span id="4e13" class="nk lw iq mv b gy nl nm l nn no">flutter packages pub run build_runner build — delete-conflicting-outputs</span></pre><p id="f3e3" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">错误会消失。</p><p id="1562" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">现在，最后一个是状态通知部分。我们的状态是todo，所以我们可以用<code class="fe ms mt mu mv b">TodoNotifier</code>重命名它。</p><p id="aac4" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">此外，创建一个<code class="fe ms mt mu mv b">todo_notifier.dart</code>文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c669" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">在这里，我们不必运行构建运行程序什么的，我们不需要它。</p><p id="ab13" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我们有通知程序、状态、事件和模型。现在，我们可以创建我们的<code class="fe ms mt mu mv b">provider</code>，之后，我们可以到达这些状态、事件等。通过<code class="fe ms mt mu mv b">Provider</code>。</p><p id="decb" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">在提供者文件夹中，创建<code class="fe ms mt mu mv b">todo_provider.dart</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c64d" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">这里我们使用<code class="fe ms mt mu mv b">StateNotifierProvider</code>，因为我们想要到达我们的通知程序，以及它的状态。所以我们用我们的<code class="fe ms mt mu mv b">TodoNotifier</code>和<code class="fe ms mt mu mv b">TodoState</code>创造了<code class="fe ms mt mu mv b">StateNotifierProvider</code>。如您所见，它也返回了<code class="fe ms mt mu mv b">TodoNotifier()</code>。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><p id="c7d5" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我们需要做的最后一件事，调用我们的状态，发送事件，使用我们的提供者，因为我们几乎完成了！</p><p id="a105" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">让我们移动<code class="fe ms mt mu mv b">main.dart</code>文件夹。</p><p id="486f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">如果你想用<code class="fe ms mt mu mv b">Riverpod</code>树，那么你必须用<code class="fe ms mt mu mv b">ProviderScope()</code>把所有的东西都包起来。</p><p id="7f70" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">简单地说，我们的<code class="fe ms mt mu mv b">main.dart</code>文件在这里:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="cdaa" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">接下来，我们可以移动演示文件夹。</p><p id="f301" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">下面是我们的<code class="fe ms mt mu mv b">app_widget</code>(核心文件):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="ad49" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">当然，不要忘记进口正确的东西！</p><p id="0e36" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">此外，我们还有<code class="fe ms mt mu mv b">home_page</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="9539" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我们有了<code class="fe ms mt mu mv b">final todoList</code>变量。我们用<code class="fe ms mt mu mv b">ref.watch</code>方法得到我们的<code class="fe ms mt mu mv b">STATE</code>，而不是<code class="fe ms mt mu mv b">METHOD</code>。如果你想访问你的通知程序，它有你的方法和函数，那么你需要使用<code class="fe ms mt mu mv b">yourprovider.notifier</code>代码。对于州，只需使用<code class="fe ms mt mu mv b">ref.watch(yourProvider)</code>。有时候选择方法也是有用的。</p><p id="cd45" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">比如我们用<code class="fe ms mt mu mv b">select</code>的方法，因为我们只是想看<code class="fe ms mt mu mv b">todoList</code>，而不是所有的状态。</p><p id="946a" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">在<code class="fe ms mt mu mv b">home_page.dart</code>文件中，我们还有其他部分，如<code class="fe ms mt mu mv b">TodosActionPart</code>和<code class="fe ms mt mu mv b">TodosPart</code>部分。</p><p id="320e" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">在<code class="fe ms mt mu mv b">TodosActionPart</code>部分，我们有一个按钮和<code class="fe ms mt mu mv b">textfield</code>。我们不使用<code class="fe ms mt mu mv b">onChanged</code>，因为我们有<code class="fe ms mt mu mv b">TextfieldController</code>，我们在这里保存我们的文本。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="2605" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">当我们使用Riverpod时，如果我们使用一个按钮或<code class="fe ms mt mu mv b">onTap</code>，或<code class="fe ms mt mu mv b">onClick</code>，没关系，我们不能使用<code class="fe ms mt mu mv b">watch</code>。不要使用它。我们什么都不听，我们只是点击按钮，就这样。欲了解更多信息，请访问<code class="fe ms mt mu mv b">riverpod.dev</code>链接。</p><p id="2fa7" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我们用<code class="fe ms mt mu mv b">provider.notifier</code>来表示通知者。然后，调用我们的函数，名字叫<code class="fe ms mt mu mv b">mapEventsToState</code>。首先，我们添加了<code class="fe ms mt mu mv b">TodoTitleChanged</code>事件，接下来，我们添加了<code class="fe ms mt mu mv b">AddTodo</code>事件。</p><p id="497a" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">对于<em class="kw"> </em> <code class="fe ms mt mu mv b">todos_part.dart</code>文件，我们用同样的东西。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/2dea41d0a0c5745341d8b8da8e9d7bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6qqhcU_ZkhZe0K6dJcN5dg.jpeg"/></div></div></figure><p id="03c9" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">这就是我的全部。此外，你可以从<a class="ae lr" href="https://github.com/alperefesahin?tab=repositories" rel="noopener ugc nofollow" target="_blank">这里</a>浏览我用Riverpod创建的应用程序。</p><p id="10e7" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">感谢您的阅读，敬请关注！</p></div></div>    
</body>
</html>