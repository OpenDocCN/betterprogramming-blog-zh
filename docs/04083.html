<html>
<head>
<title>How to Implement Sign In With SwiftUI and AWS Amplify (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用SwiftUI和AWS Amplify实现登录(第1部分)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/sign-in-with-aws-amplify-and-swiftui-978b01a5cf10?source=collection_archive---------4-----------------------#2020-03-23">https://betterprogramming.pub/sign-in-with-aws-amplify-and-swiftui-978b01a5cf10?source=collection_archive---------4-----------------------#2020-03-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2ba3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">登录谷歌</strong></h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/41b74a8601a05411cb89e5a2e471c6a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ok4pPEnKIU834CVQ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@gustasbrazaitis?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Gustas Brazaitis </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="d5f3" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">为什么使用AWS Amplify/Cognito进行登录？</h1><p id="beb9" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">有许多关于如何让用户在iOS上登录的指南和资源。由此，许多人使用Firebase，因为它非常简单。</p><p id="c712" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">虽然它可能很简单，我过去也用过，但这个平台有一个很大的局限性:你不能在中国使用它。拥有世界上最多的智能手机用户(超过8亿)，这当然是一个许多人不想错过的国家。</p><div class="mw mx gp gr my mz"><a href="https://www.statista.com/statistics/467160/forecast-of-smartphone-users-in-china/" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ir gy z fp ne fr fs nf fu fw ip bi translated">中国:2017-2023年智能手机用户</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">了解Statista如何支持您的业务。Statista。(2019年2月18日)。智能手机用户数量…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">www.statista.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn kp mz"/></div></div></a></div><p id="fdae" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">如果我们计划在中国发展和推出，我们不能在使用Firebase的同时这样做。对于最初想使用移动后端作为服务的小团队来说，这可能是个问题，尤其是在像台湾这样Firebase工作的国家。</p><p id="955a" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在台湾，开发者可能会决定先在当地进行试运行，作为一个较小的市场，他们可以对自己的应用进行多次迭代，并根据用户反馈进行改进，然后在增长后在中国推出，因为中国是一个文化相似的国家。</p><p id="1767" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在这种情况下，从一开始就使用能够支持中国使用的平台是很好的。</p><p id="008b" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">当然，如果你在中国推出的应用有多个社交媒体登录选项，用户将无法登录谷歌或脸书，但对中国用户来说，移除这些选项并只允许苹果或电子邮件等提供商比改变整个后端更容易。</p><p id="e802" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">不管你想把AWS作为一项服务用于你的移动后端的原因是什么，让我们开始吧！</p><p id="e394" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在本教程中，我将假设我们从一开始就启动一个应用程序，并希望为用户添加授权。我将通过谷歌、脸书、苹果和电子邮件完成添加登录的过程。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="3cee" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">安装</h1><p id="bae1" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">在开始繁重的工作之前，如果您不熟悉AWS Amplify CLI，您需要遵循<a class="ae kv" href="https://aws-amplify.github.io/docs/" rel="noopener ugc nofollow" target="_blank">入门指南</a>。这些步骤基本上是注册一个AWS帐户，安装它，并配置CLI。</p><p id="8305" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">你可以跟随他们的<a class="ae kv" href="https://aws-amplify.github.io/docs/ios/start" rel="noopener ugc nofollow" target="_blank">入门指南</a>来开始了解他们的GraphQL API是如何工作的，他们甚至有一个演示<a class="ae kv" href="https://github.com/aws-samples/aws-amplify-swiftui-demo" rel="noopener ugc nofollow" target="_blank"> SwiftUI项目</a>。</p><p id="9d36" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">如果您对在开始构建API并将数据发送到数据库之前准备登录感兴趣，只需遵循本教程。</p><p id="ce49" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">让我们首先转到Xcode并创建一个新项目。选择<em class="no">单视图应用</em>。在<em class="no">语言</em>中选择<em class="no"> Swift </em>，在<em class="no">用户界面</em>中选择<em class="no"> SwiftUI </em>。给它您想要的产品名称和组织名称。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/19d9fb8e0847f6b118653fce8a4ae401.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*8-m6M4P3gzC3S92dpJ4gmg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">不要忘记为用户界面设置SwiftUI</p></figure><p id="8b40" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">创建项目后，记下项目的包标识符:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/df98a7a971a1bc874900323f42bce283.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*ABUORSySXUmfpxBmtwzbIw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们一会儿会用到它</p></figure><p id="aef1" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在能够编写我们的代码来登录不同的提供商之前，您需要在谷歌和脸书开发者门户上创建一个项目，因为您将被要求提供这些提供商的凭证。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="3422" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">在Google开发者控制台中创建项目</h1><p id="1455" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">要启用Google登录，我们需要从他们那里获取OAuth凭证。</p><p id="8e67" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">为此，我们转到<a class="ae kv" href="https://console.developers.google.com" rel="noopener ugc nofollow" target="_blank">谷歌开发者控制台</a>。使用您的Google帐户登录，然后为您的应用程序创建一个新项目。之后，转到您新创建的项目。</p><p id="131d" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">首先，您需要转到左侧菜单中的“OAuth同意”屏幕，并在添加凭证之前设置所需的详细信息。</p><p id="b7d2" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">选择<em class="no">外部</em>作为<em class="no">用户类型</em>，然后填写app名称，点击<em class="no">保存</em>按钮。您可以在此处填写其他详细信息，或者稍后再回来填写。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/12b74683455392728c506c00ab23f2dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:284/format:webp/1*CLmyRGhDqMM_T6zHkbY9iA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ns">在这里，我们只需要访问OAuth同意屏幕和凭证</em></p></figure><p id="b3f7" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">设置同意屏幕后，在左侧菜单中选择<em class="no">凭证</em>。选择<em class="no">创建凭证</em>、<em class="no"> OAuth客户端ID </em>和<em class="no"> Web应用</em>。您可以保存客户端ID和客户端密码，或者在需要时返回控制台获取它们。</p><p id="d73f" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在，选择<em class="no">创建凭证</em>、<em class="no"> OAuth客户端ID </em>和<em class="no"> iOS </em>。输入在Xcode上创建项目后获得的包标识符。同样，您可以保存创建的ID或稍后再来获取它。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="22b7" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">在脸书开发人员控制台上创建项目</h1><p id="d1ed" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">要启用脸书登录，我们需要遵循类似的流程。</p><p id="64fc" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">进入<a class="ae kv" href="https://developers.facebook.com" rel="noopener ugc nofollow" target="_blank">脸书开发者控制台</a>。使用您的脸书帐户登录。进入<em class="no">我的应用</em>、<em class="no">创建应用</em>。</p><p id="012c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在，在左侧菜单中，进入<em class="no">设置</em>、<em class="no">基本</em>。在底部，点击<em class="no">添加平台</em>、<em class="no"> iOS </em>，输入您的项目的包标识符，然后点击<em class="no">保存更改</em>。</p><p id="e41a" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">同样，您可以保存应用ID和应用密码，或者稍后再来获取它们。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/26fb9b348635a8b3b804e881478330a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/1*sxUvkpPcBekET4kvUrFcKA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ns">在这里我们只需要进入设置/基本</em></p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="8a28" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">将Amplify添加到iOS项目</h1><p id="50eb" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">在终端中，转到刚刚创建的项目的文件夹，然后运行以下命令:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="0b1e" class="nz le iq nv b gy oa ob l oc od">$ amplify init</span></pre><p id="d02f" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">CLI将带我们完成一些步骤:</p><ul class=""><li id="4c95" class="oe of iq lx b ly mr mb ms me og mi oh mm oi mq oj ok ol om bi translated">输入项目名称:通过按Enter键选择默认值，或者输入您喜欢的项目名称。</li><li id="4f5c" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">输入环境名称:选择您喜欢的环境名称，例如“local”。</li><li id="c6cf" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">选择您的默认编辑器:Visual Studio代码(或您首选的编辑器)。</li><li id="e626" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">选择你正在开发的应用类型:iOS。</li><li id="616a" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">是否要使用AWS配置文件？Y.</li><li id="8d4c" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">请选择您要使用的配置文件:选择您的AWS配置文件。</li></ul><p id="9ed6" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">过一会儿，您应该会收到一条成功消息。现在我们的项目已经创建好了，如果你愿意，你可以检查一下<a class="ae kv" href="https://console.aws.amazon.com/amplify" rel="noopener ugc nofollow" target="_blank"> AWS放大器控制台</a>，并验证它是否在那里。</p><p id="65f2" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">当点击您的项目并转到<em class="no">后端环境</em>选项卡时，您应该看到该项目还没有启用的类别，如下图所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/c82ee27cf99622d7d6b2429608f725f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*2cqrhnr2ytLtNpAAkTD2TQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">新项目的自动气象站放大器控制台</p></figure><p id="52aa" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">一旦您添加了<em class="no">授权</em>、<em class="no"> API </em>或<em class="no">分析</em>，您应该能够从这里访问它们中的每一个。</p><p id="32ea" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">回到CLI，转到您的项目文件夹并运行命令:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="df89" class="nz le iq nv b gy oa ob l oc od">$ amplify add auth</span></pre><p id="c160" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">CLI将再次带我们完成一个(有点长的)过程:</p><ul class=""><li id="f530" class="oe of iq lx b ly mr mb ms me og mi oh mm oi mq oj ok ol om bi translated">您想使用默认的身份验证和安全配置吗？社交提供者(联盟)的默认配置。</li><li id="d960" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">您希望用户如何登录？用户名。</li><li id="12ed" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">您想配置高级设置吗？是的，我想做一些额外的更改。</li><li id="2cbe" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">报名需要具备哪些属性？电子邮件、姓名、图片*。</li><li id="bf1c" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">您想启用以下任何功能吗？跳过。</li><li id="20e2" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">您希望我们为您创建什么域名前缀？默认或随意选择。</li><li id="5302" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">在URI输入您的重定向标志:Myapp://。</li><li id="f0d0" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">你想在URI增加另一个重定向标志吗？名词（noun的缩写）</li><li id="a6e3" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">输入您的重定向注销URI: Myapp://*。</li><li id="d23b" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">您是否希望在URI之外添加另一个重定向标志？名词（noun的缩写）</li><li id="49d0" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">选择要为您的用户群配置的社交提供商:脸书、谷歌。</li><li id="7e47" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">输入您的OAuth流的脸书应用ID:输入您之前获得的脸书应用ID。</li><li id="e771" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">输入你的OAuth流的脸书应用程序秘密:输入你之前获得的脸书秘密ID。</li><li id="3da8" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">为OAuth流输入您的Google Web客户端ID:输入您之前获得的Web客户端ID。</li><li id="ab2f" class="oe of iq lx b ly on mb oo me op mi oq mm or mq oj ok ol om bi translated">为OAuth流输入您的Google Web客户端密码:输入您之前获得的Web客户端密码。</li></ul><p id="af3c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">*请注意，在这里，我选择了电子邮件、姓名和图片作为必需属性，这样我就可以向用户显示这些详细信息。选择您喜欢的属性，只需注意哪些属性对您使用的登录提供程序可用。</p><p id="cb60" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">*我们使用<code class="fe os ot ou nv b">myapp://</code>作为重定向URI，因为我们想在登录后返回应用程序。</p><p id="197a" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在您可以运行该命令:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="d178" class="nz le iq nv b gy oa ob l oc od">$ amplify push</span></pre><p id="a5f8" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">一段时间后，您应该会收到一条成功消息。您可以点击链接来测试自动生成的测试UI。</p><p id="ce00" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这将试图把你重定向到myapp://虽然，你不能在浏览器中这样做。但是如果你在登录后有一个有效的重定向网站，测试UI会带你去那里。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="1c34" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">完成使用Google登录的设置</h1><p id="4fcf" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">现在让我们回到谷歌开发者控制台。在凭证列表中，编辑<em class="no"> Web客户端</em>。</p><p id="a2eb" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在<em class="no">Authorized JavaScript origins</em>中，添加刚刚从AWS CLI获得的HostedUI端点，末尾不带“<code class="fe os ot ou nv b">/</code>”。它应该是这样的:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="85fd" class="nz le iq nv b gy oa ob l oc od">https://yourswiftuiamplifyprojectf9af9929f9af9929-local.auth.us-east-1.amazoncognito.com</span></pre><p id="1864" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在<em class="no">授权重定向URIs </em>中，增加相同的<code class="fe os ot ou nv b">HostedUIEndpoint</code>，末尾加上<code class="fe os ot ou nv b">/oauth2/idpresponse</code>。它应该是这样的:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="1deb" class="nz le iq nv b gy oa ob l oc od">https://yourswiftuiamplifyprojectf9af9929f9af9929-local.auth.us-east-1.amazoncognito.com/oauth2/idpresponse</span></pre><p id="25b9" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在，您可以保存web客户端凭据了。</p><p id="cb70" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">您需要从iOS凭据中获取iOS URL方案。你可以通过点击编辑按钮来查看，然后从右上角复制它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/0aecf5fe25eb9be813229c92f3e3d072.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qzk_yOxQj-SY0WV4qemLDQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">单击图片上显示的编辑按钮，查看您的iOS凭据详细信息</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/17a2c8fd05fc4f6fc59c4a0f45d7bfde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CtLTpGGD-bqUpuu4Ii_Ouw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">您的iOS URL方案应该如下所示</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="7faf" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">完成与脸书的登录设置</h1><p id="360f" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">我们还需要将端点添加到我们的脸书应用程序。</p><p id="e7b6" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">返回脸书开发者控制台。转到<em class="no">设置</em>、<em class="no">基本</em>。向下滚动选择<em class="no">添加平台</em>、<em class="no">网站</em>，然后输入<code class="fe os ot ou nv b">HostedUIEndpoint</code>，最后是<code class="fe os ot ou nv b">/oauth2/idpresponse</code>:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="760a" class="nz le iq nv b gy oa ob l oc od">https://yourswiftuiamplifyprojectf9af9929f9af9929-local.auth.us-east-1.amazoncognito.com/oauth2/idpresponse</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/351c6716545112ccfd58f81c35b08c82.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*Zre0fvDcc-d0woRK6prYvg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">搭建网站平台</p></figure><p id="d165" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">向上滚动，在<em class="no">应用程序域</em>中输入相同的HostedUI端点，并在末尾加上<code class="fe os ot ou nv b">/oauth2/idpresponse</code>，然后保存更改。</p><p id="fcfb" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">接下来，在左侧菜单中，选择<em class="no">产品</em>、<em class="no">脸书登录</em>、<em class="no">设置</em>。选择<em class="no"> iOS </em>，忽略快速启动，选择<em class="no">设置</em>，在左侧菜单<em class="no">脸书登录</em>下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/e8671de8ba1df66662ae7bf1937e5e98.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/1*3iJe4zV0UhxUgQ-0iIil8w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ns">现在我们只需要进入脸书登录/设置</em></p></figure><p id="bd4f" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在<em class="no">有效OAuth重定向URIs </em>中，输入以<code class="fe os ot ou nv b">idpresponse</code>结尾的端点:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="a33e" class="nz le iq nv b gy oa ob l oc od">https://yourswiftuiamplifyprojectf9af9929f9af9929-local.auth.us-east-1.amazoncognito.com/oauth2/idpresponse</span></pre><p id="9f6f" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">保存更改，现在我们可以进行下一步了！</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="ad42" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">编辑信息. plist</h1><p id="b1c6" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">在文本编辑器中打开您的<code class="fe os ot ou nv b">Info.plist</code>文件，这样您就可以以XML文件的形式查看它。在文件的顶部，在字典的开头添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">需要添加到Info.plist文件中的密钥</p></figure><p id="ffb4" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这里有几个注意事项，在<code class="fe os ot ou nv b">CFBundleURLTypes</code>下面，注意在你的app ID前面加字母<code class="fe os ot ou nv b">fb</code>。向下，在<code class="fe os ot ou nv b">FacebookAppID</code>下面，不需要加字母<code class="fe os ot ou nv b">fb</code>。您的<code class="fe os ot ou nv b">Info.plist</code>文件应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/bcf09ef29db86ff73ffa58bf6baf03ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*sh1TPeOkmXf8gzV5Hgk1lw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Info.plist添加以上详细信息后</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="2d52" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">向iOS项目添加所需的窗格</h1><p id="357c" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">要添加<a class="ae kv" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank"> CocoaPods </a>，在您的项目文件夹中，运行以下命令:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="ce67" class="nz le iq nv b gy oa ob l oc od">$ pod init</span></pre><p id="3fbf" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在文本编辑器中打开生成的pod文件，并添加以下pod:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="11e0" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在，通过运行以下命令来安装它们:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="e1b2" class="nz le iq nv b gy oa ob l oc od">$ pod install --repo-update</span></pre><p id="01a2" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">打开你的项目<code class="fe os ot ou nv b">.xcworkspace</code>，让我们(最终)开始实际编写一些Swift代码！</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="2e90" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">将AWS配置文件复制到Xcode中</h1><p id="8c2d" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">在能够使用<code class="fe os ot ou nv b">AWSMobileClient</code>之前，你需要复制两个文件到Xcode: <code class="fe os ot ou nv b">awsconfiguration.json</code>和<code class="fe os ot ou nv b">amplifyconfiguration.json</code>。</p><p id="59d8" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">将它们拖到您的项目中，并取消选中“如果需要，复制项目”，这样您就只保留了对原始文件的引用。这样，如果您更新您的放大器配置，Xcode上的参考将会跟踪这些更改。</p><p id="3e80" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">您的项目应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/99355ae2125e6893096e65c85b906172.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/format:webp/1*M37Yb-ULoweT61eHaFwZjA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ns">项目中当前文件的概述</em></p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="7c07" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">正在初始化AWS移动客户端</h1><p id="adb2" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">在您的<code class="fe os ot ou nv b">AppDelegate</code>中，在顶部添加以下导入:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="c5a5" class="nz le iq nv b gy oa ob l oc od">import AWSMobileClient</span></pre><p id="767a" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在<code class="fe os ot ou nv b">AppDelegate</code>类中，添加这个函数来初始化AWS移动客户端:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在应用程序委托内部初始化AWSMobileClient的代码</p></figure><p id="2127" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">当然，不要忘记在返回之前对应用程序<code class="fe os ot ou nv b">didFinishLaunchingWithOptions</code>中的函数进行分类。你的<code class="fe os ot ou nv b">AppDelegate</code> <strong class="lx ir"> </strong>应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/28962d603c95f326b1f3274100dceb78.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*BN0APlqfA4eLJfLTNeZ51A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">别忘了调用<strong class="bd pa">initializeAWSMobileClient()</strong>！</p></figure><p id="29c3" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">您可以通过在模拟器中运行您的应用程序来测试AWS移动客户端是否正确初始化。您应该会在控制台上看到以下内容:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="e098" class="nz le iq nv b gy oa ob l oc od">AWSMobileClient initialized. Current UserState: signedOut</span></pre></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="dd5a" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">创建SwiftUI视图</h1><p id="56e1" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">打开<code class="fe os ot ou nv b">ContentView.Swift</code>。让我们添加一个内部带有<code class="fe os ot ou nv b">Button</code>的<code class="fe os ot ou nv b">VStack</code>来登录Google。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">简单的VStack与谷歌登录按钮</p></figure><p id="40c5" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">目前，当在模拟器或设备上运行时，除了在控制台中打印一些东西之外，按钮没有做任何事情。随意添加任何样式到你的按钮！</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="0e81" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated"><strong class="ak">登录谷歌</strong></h1><p id="fff2" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">为了在SwiftUI中使用<code class="fe os ot ou nv b">AWSMobileClient</code>方法，我们需要在<code class="fe os ot ou nv b">UIViewControllerRepresentable</code>中使用它。创建一个名为<code class="fe os ot ou nv b">SignInViewController.swift</code>的文件，并在其中添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">登录方法的UIViewControllerRepresentable</p></figure><p id="b92d" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">关于这段代码的一点解释。我们在上面创建了一个<code class="fe os ot ou nv b">UINavigationController</code>，因为<code class="fe os ot ou nv b">AWSMobileClient</code>期望它显示每个提供者的UI。</p><p id="54c4" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">请注意，当我们设置<code class="fe os ot ou nv b">hostedUIOptions</code>时，我们设置了“email”和“profile”来获取我们向它们询问的附加细节(如姓名和个人资料图片)。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="cab5" class="nz le iq nv b gy oa ob l oc od">let hostedUIOptions = HostedUIOptions(scopes: ["openid", "email", "profile"], identityProvider: "Google")</span></pre><p id="17be" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">登录成功后，我们得到<code class="fe os ot ou nv b">userState</code>。如果我们想得到上面要求的详细信息(电子邮件，姓名，个人资料图片)，我们需要做一些额外的工作。</p><p id="06ab" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">文档和论坛答案建议使用<code class="fe os ot ou nv b">AWSMobileClient</code> <code class="fe os ot ou nv b">getUserAttributes</code>或<code class="fe os ot ou nv b">AWSCognitoIdentityPool</code> <code class="fe os ot ou nv b">getDetails</code>，但在本文撰写之时(2020年3月)它们并不起作用。</p><p id="ee81" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这就是为什么我选择在这一行从JSON声明中获取信息:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="4ec8" class="nz le iq nv b gy oa ob l oc od">AWSMobileClient.default().getTokens { (tokens, error) in …</span></pre><p id="485c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在我们需要将<code class="fe os ot ou nv b">SignInViewController</code>添加到我们的<code class="fe os ot ou nv b">ContentView</code>中。修改主体，使其返回我们已经拥有的<code class="fe os ot ou nv b">VStack</code>下的<code class="fe os ot ou nv b">ZStack</code>中的<code class="fe os ot ou nv b">SignInViewController</code>，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将SignInViewController添加到ContentView</p></figure><p id="db4c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">之后，您可以在模拟器或您的设备上运行项目。成功登录后，您将看到控制台中打印的用户详细信息。</p><p id="35a3" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在你知道你已经登录，如果你重新启动你的应用程序，你应该会看到以下消息:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="7538" class="nz le iq nv b gy oa ob l oc od">AWSMobileClient initialized. Current UserState: signedIn</span></pre><p id="b117" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">让我们做一些更有趣的事情。登录后，我们换到另一个屏幕。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="5c29" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">登录后切换到另一个屏幕</h1><p id="c8ee" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">为了通过应用程序传播更改，我选择创建一个名为<code class="fe os ot ou nv b">AppSettings</code>的<code class="fe os ot ou nv b">ObservableObject</code>。这将存储用户名等详细信息。</p><p id="3ae1" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">您可以在此添加用户的其他详细信息，例如电子邮件或其个人资料图片的URL。创建一个名为<code class="fe os ot ou nv b">AppSettings.swift</code>的文件，并添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于访问用户默认值的AppSettings</p></figure><p id="1698" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在你的<code class="fe os ot ou nv b">ContentView</code>里面，在正文之前，添加这个变量:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="8cdc" class="nz le iq nv b gy oa ob l oc od">@ObservedObject var settings = AppSettings()</span></pre><p id="561e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在让我们更改正文，以便<code class="fe os ot ou nv b">View</code>在登录后显示不同的消息:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">登录后在内容视图上显示消息</p></figure><p id="9196" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">如果用户名设置在<code class="fe os ot ou nv b">AppSettings</code>上，应用程序将显示不同的消息。</p><p id="3d6e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我还在这里添加了两个退出按钮。一个让你可以注销，如果你已经这样做之前，设置用户名。第二个在您登录后显示，因此您可以退出并测试其他登录方法。</p><p id="91bb" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我还添加了<code class="fe os ot ou nv b">Divider</code> s，所以<code class="fe os ot ou nv b">Button</code> s彼此之间有点距离。</p><p id="3b30" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在，您可能已经注意到，我们在登录后没有在任何地方设置用户名。让我们回到<code class="fe os ot ou nv b">SignInViewController</code>并解决这个问题。在顶部添加以下变量，就在<code class="fe os ot ou nv b">navController</code>之前:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="addc" class="nz le iq nv b gy oa ob l oc od">@ObservedObject var settings = AppSettings()</span></pre><p id="29ae" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">就在打印声明之后，您将获得用户名、电子邮件和图片，添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="68bf" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我们需要在主队列中设置这个变量，因为它触发了对UI的一些更改。</p><p id="bdc8" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">如果您构建您的应用程序，您会注意到一个错误。现在我们需要将设置<code class="fe os ot ou nv b">ObservedObject</code>传递给<code class="fe os ot ou nv b">SignInController</code>:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="ab27" class="nz le iq nv b gy oa ob l oc od">let signInVC = SignInViewController(settings: settings)</span></pre><p id="f680" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在，运行您的应用程序后，如果您之前已经登录过，请按“注销”按钮，然后尝试登录和注销以查看屏幕上的更改。现在您知道如何使用AWS向您的应用程序添加授权服务了！</p><p id="c350" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">如果你想看看整个项目，请查看<a class="ae kv" href="https://github.com/rolisanchez/swiftui-amplify-demo" rel="noopener ugc nofollow" target="_blank"> GitHub Repo </a>。</p></div></div>    
</body>
</html>