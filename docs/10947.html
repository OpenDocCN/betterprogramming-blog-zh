<html>
<head>
<title>Four Ways to Improve Your AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">提高AWS Lambda的四种方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/four-ways-to-improve-your-aws-lambda-1cfd3a3115d6?source=collection_archive---------2-----------------------#2022-02-06">https://betterprogramming.pub/four-ways-to-improve-your-aws-lambda-1cfd3a3115d6?source=collection_archive---------2-----------------------#2022-02-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6b9f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何打磨你的Lambda函数</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a5e91de2884ad15c7ad414b2da87e7d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*f3A9Cb9GiGUyLSot"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@czapp_arpad?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">áRPád Czapp</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="01a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你好，今天我想谈谈如何通过抛光来提升Lambda的性能。让我们深入研究四种方法来改进Lambda函数的init阶段，平衡成本和性能，用X射线跟踪代码，最终得到一个更快更可伸缩的函数。</p><h1 id="4022" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">将变量放在处理程序之外</h1><p id="df09" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果你有一个对象需要为每个Lambda请求初始化和重用，你可以把它放在处理函数之外。</p><p id="a24a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果没有请求，Lambda的执行环境会保持活动2到10分钟。</p><p id="bc7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一次启动后，Node.js中的AWS客户机将在下一次执行中重用同一个连接，从而加快后续请求的速度。</p><p id="f6ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个例子是重用包含一个值的变量，如在参数存储中，为了不达到限制，而您可以存储该值并在下一次执行中使用它。</p><p id="2d87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Lambda中的INIT阶段执行外部代码:如果您需要启动一个数据库连接，这是一个很好的时机。</p><blockquote class="mp mq mr"><p id="71d4" class="kw kx ms ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">记住:如果你使用提供的并发性，处理程序之外的代码将被执行。</p></blockquote><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">带有外部代码的Lambda处理程序示例</p></figure><h1 id="df40" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">了解层的力量</h1><p id="7db4" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">您知道可以在一个层中包含所有依赖项吗？在部署包中避免使用它们将会优化性能，因为在初始化阶段使用小包的Lambda函数会更快。</p><p id="0712" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记住<strong class="ky ir"> AWS SDK v2 </strong>已经在标准运行时中，所以你不需要包含为依赖项。</p><blockquote class="mp mq mr"><p id="0aa9" class="kw kx ms ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">注意:如果您计划将<strong class="ky ir"> AWS SDK v3 </strong>用于Javascript，那么最好将其添加到层中。</p></blockquote><p id="62ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不仅仅是依赖！您还可以添加您的代码，以便在包含该层的所有函数中使用它。</p><h1 id="c259" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">用X射线检查你的代码</h1><p id="96e0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">您在代码中包含了多个AWS资源。你担心整体表现吗？您可以在代码中添加X-Ray客户端，它将允许您使用自定义段跟踪所有非AWS请求。通过这种方式，您可以测量代码的全局性能。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/03b9ad15b99a94b5320ce8c08d3c7dc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s3SV6Arz7cq74Nc89n11-w.jpeg"/></div></div></figure><p id="71d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是该函数的第一次执行。如您所见，初始化阶段持续约556毫秒，包括执行层和处理程序之外的代码。</p><p id="cc1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还有，我们看到GetParameter需要500ms，唉。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/e568695d390f076d0681045245b56e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*avZIeLDi8jXHdmnQY17RTQ.jpeg"/></div></div></figure><p id="3b3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">相反，这是第二次执行的持续时间。不再有Lambda函数的初始化和对SSM值的调用。</p><blockquote class="mp mq mr"><p id="5646" class="kw kx ms ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">请记住:使用X射线，您可以检查所有服务的性能，或者只检查一段代码的性能。</p></blockquote><h1 id="0027" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">相应地平衡你的内存</h1><p id="6cbb" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果你想提高Lambda的速度，你也可以增加Lambda函数的内存。最小128mb，最大10240mb。</p><p id="a2a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">执行的成本会增加，从而减少执行时间。为此，我们可以使用Casalboni的工具来查看每次执行的成本比率(您可以在这里了解更多<a class="ae kv" href="https://github.com/alexcasalboni/aws-lambda-power-tuning" rel="noopener ugc nofollow" target="_blank">)。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/8f8f5c1af4458742712e7aa26a963d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_38DGik2fCHbv3Dbi1roHw.jpeg"/></div></div></figure><p id="185c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以看到，所有RAM层的调用时间都是相同的，而每层的调用成本都有所增加。我们可以看到，在128 mb时，函数的每次调用时间成本最低，所以最好选择它。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="a678" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在下面的资源库GitHub中找到所有这些示例的源代码。</p><div class="ni nj gp gr nk nl"><a href="https://github.com/SalvoCozzubo/AWS-Lambda-Performance-Tips" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd ir gy z fp nq fr fs nr fu fw ip bi translated">GitHub-SalvoCozzubo/AWS-Lambda-性能-提示</h2><div class="ns l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">github.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny kp nl"/></div></div></a></div><p id="d18b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你有更多关于如何改进AWS Lambda功能的建议，请随时尝试并告诉我。查看我的<a class="ae kv" href="https://blog.salvatorecozzubo.com/aws-s3-select-and-node-js-a33aeeef9838" rel="noopener ugc nofollow" target="_blank">以前关于AWS S3选择</a>的文章。</p><p id="52f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回头见！</p></div></div>    
</body>
</html>