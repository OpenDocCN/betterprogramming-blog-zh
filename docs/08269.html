<html>
<head>
<title>How To Write a Useful Instance Counter in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python写一个有用的实例计数器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-write-a-useful-instance-counter-in-python-9eee1761c3c7?source=collection_archive---------9-----------------------#2021-04-12">https://betterprogramming.pub/how-to-write-a-useful-instance-counter-in-python-9eee1761c3c7?source=collection_archive---------9-----------------------#2021-04-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d27f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个简单的mixin，可以添加到任何类中，允许实例计数</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2a8bd79ed787f78dac8b7f7e5048489c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nN3WNSDWs4JrKiAD"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Crissy Jarvis 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="109d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我将解释用Python编写实例计数器的显而易见的方法，然后展示如何改进它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="84f2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么要计算实例？</h1><p id="b293" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，我们为什么要计算一个对象的实例数？以下是一些使用案例:</p><ul class=""><li id="cdd0" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">我们希望在运行时给对象唯一的id。</li><li id="7435" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">出于调试目的，我们希望跟踪或统计实例创建。</li><li id="9d80" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">运行时实例计数对我们的程序有一定的意义(例如，我们需要按照创建顺序对对象进行排序)。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="018a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">基本方法</h1><p id="b161" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">实例计数的简单方法是将它直接添加到您的类中:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="d3f3" class="ns md it no b gy nt nu l nv nw">class A:<br/>    numInstances = 0<br/>    def __init__(self):<br/>        A.numInstances += 1<br/>        self.count = A.numInstances</span></pre><p id="98f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建一个名为<code class="fe nx ny nz no b">numInstances</code>的<a class="ae ky" href="https://docs.python.org/3/tutorial/classes.html#class-and-instance-variables" rel="noopener ugc nofollow" target="_blank">类变量</a>，用于跟踪创建的<em class="oa">实例总数</em>，以及一个名为<code class="fe nx ny nz no b">count</code>的实例变量，用于保存给定实例的实例号。</p><p id="7e5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="bfae" class="ns md it no b gy nt nu l nv nw">a = A()<br/>b = A()<br/>a.count            # returns 1<br/>b.count            # returns 2<br/>a.numInstances     # returns 2<br/>b.numInstances     # returns 2</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="77e5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使其可重复使用</h1><p id="4c3b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当然，作为优秀的程序员，我们希望这种计数功能可以重用。然后通过继承一些预先做好的<code class="fe nx ny nz no b">Countable</code>类，可以独立统计多个类。</p><p id="631f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的第一反应是这样做:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="c559" class="ns md it no b gy nt nu l nv nw">class B : A<br/>    pass # implement specialist functionality in B</span></pre><p id="e534" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题是<code class="fe nx ny nz no b">B</code>和<code class="fe nx ny nz no b">A</code>现在共享由<code class="fe nx ny nz no b">A</code>提供的同一个<code class="fe nx ny nz no b">numInstances</code>变量，给我们:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="b1b1" class="ns md it no b gy nt nu l nv nw">b = B()<br/>b.count    # returns 3, not 1 as expected</span></pre><p id="fe38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，有一种方法可以解决这个问题，那就是使用<a class="ae ky" href="https://www.datacamp.com/community/tutorials/python-metaclasses" rel="noopener ugc nofollow" target="_blank"> Python元类</a>。这使我们能够为每个子类创建单独的实例计数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="9736" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nx ny nz no b">Countable</code>类现在可以用作<a class="ae ky" href="https://en.wikipedia.org/wiki/Mixin" rel="noopener ugc nofollow" target="_blank">混音</a>:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="7094" class="ns md it no b gy nt nu l nv nw">class A(Countable):<br/>    pass</span><span id="03c7" class="ns md it no b gy od nu l nv nw">class B (Countable):<br/>    pass</span><span id="5e03" class="ns md it no b gy od nu l nv nw">a = A()<br/>b = B()<br/>a.count    # prints 1<br/>b.count    # also prints 1. numInstances is no longer shared</span></pre><p id="9135" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。如果您觉得这很有用，请查看我在Medium上的其他文章:</p><div class="oe of gp gr og oh"><a href="https://jamiebullock.medium.com/my-top-stories-updated-weekly-ca7e9b57599e" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">我的热门故事(每周更新)</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">本月读者最多:iOS版比特币基地深度评论</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">jamiebullock.medium.com</p></div></div></div></a></div></div></div>    
</body>
</html>