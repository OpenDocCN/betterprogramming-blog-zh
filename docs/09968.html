<html>
<head>
<title>Raspberry Pi GPIO in Golang and C — RGB LED</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Golang和C-RGB LED中的Raspberry Pi GPIO</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/raspberry-pi-gpio-in-golang-and-c-rgb-led-cebdb9b456a9?source=collection_archive---------7-----------------------#2021-11-08">https://betterprogramming.pub/raspberry-pi-gpio-in-golang-and-c-rgb-led-cebdb9b456a9?source=collection_archive---------7-----------------------#2021-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="294a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用Golang和C控制RGB LED</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7f4503cbb00fbfef12979e8730abf93b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iD62Gg_9RyyaJxJAXe1ONQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:作者</p></figure><h1 id="844a" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">内容</h1><ul class=""><li id="5fbc" class="ln lo iq lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">概观</li><li id="2af4" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">先决条件</li><li id="9224" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">会有帮助的信息</li><li id="7efc" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">RGB LED in C(软件PWM)</li><li id="4164" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">RGB LED in C(硬件PWM)</li><li id="48bb" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">RGB LED in Go(硬件PWM)</li><li id="f4ee" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">摘要</li><li id="a390" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">参考</li></ul><h1 id="0c6a" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">概观</h1><p id="bd5d" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">这是探索在Raspberry Pi 3B+上进行GPIO编程的系列文章的第二篇。第一个是<a class="ae mx" href="https://youngkin.github.io/post/sunfoundergpionotesled/" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi GPIO in Go和C —闪烁LED </a>。它是对<a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/1.1.2_rgb_led_c.html" rel="noopener ugc nofollow" target="_blank"> Sunfounder RGB LED项目</a>的补充。你可以在这里找到完整系列<a class="ae mx" href="https://youngkin.github.io/categories/gpio/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="0217" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">本文探讨如何使用脉宽调制(PWM)来驱动RGB LED，以及如何控制单个LED引脚的亮度。代码示例将放在Go和c中。</p><h1 id="8fb6" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">先决条件</h1><p id="16bd" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">如果你没有，你需要一个树莓派。我在Raspbian OS的“拉伸”版本中使用了一个树莓派3B+。鉴于Sunfounder Ultimate Starter Kit被宣传为与Raspberry Pi 4一起工作，我希望4系列也能工作。我对其他Raspberry Pi版本不太确定，尤其是26对40 GPIO引脚的版本。</p><p id="a9d9" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">接下来你需要</p><ol class=""><li id="a65d" class="ln lo iq lp b lq my ls mz lu nd lw ne ly nf ma ng mc md me bi translated">一个<a class="ae mx" href="https://www.amazon.com/dp/B082KBF7MM/ref=sspa_dk_detail_4?psc=1&amp;pd_rd_i=B082KBF7MM&amp;pd_rd_w=1tGTV&amp;pf_rd_p=887084a2-5c34-4113-a4f8-b7947847c308&amp;pd_rd_wg=fX8JB&amp;pf_rd_r=44DE0RS1E9FD42RBYC7R&amp;pd_rd_r=47cbdc7f-7834-455f-9429-ef74a438bd45&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUFVVkdZVUZRNUw3ODkmZW5jcnlwdGVkSWQ9QTA4MzI4MzYyU0VLNzBJM0cxRUVMJmVuY3J5cHRlZEFkSWQ9QTA0Mjk1NTMzSzNSWlNFUjU0NURBJndpZGdldE5hbWU9c3BfZGV0YWlsJmFjdGlvbj1jbGlja1JlZGlyZWN0JmRvTm90TG9nQ2xpY2s9dHJ1ZQ==" rel="noopener ugc nofollow" target="_blank">试验板</a></li><li id="cfce" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">一些<a class="ae mx" href="https://www.amazon.com/dp/B08HZ26ZLF/ref=syn_sd_onsite_desktop_19?psc=1&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUExRFpLWElCRjg1MUNMJmVuY3J5cHRlZElkPUEwMjMyMTE1M01aOFE3U1BQS09YSiZlbmNyeXB0ZWRBZElkPUEwODE5NTMxMktEMTlZRjEyQjBJNiZ3aWRnZXROYW1lPXNkX29uc2l0ZV9kZXNrdG9wJmFjdGlvbj1jbGlja1JlZGlyZWN0JmRvTm90TG9nQ2xpY2s9dHJ1ZQ==" rel="noopener ugc nofollow" target="_blank">跳线</a></li><li id="0700" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">一个<a class="ae mx" href="https://www.amazon.com/EDGELEC-Tri-Color-Multicolor-Diffused-Resistors/dp/B077XGF3YR/ref=asc_df_B077XGF3YR/?tag=hyprod-20&amp;linkCode=df0&amp;hvadid=242051162351&amp;hvpos=&amp;hvnetw=g&amp;hvrand=11064062033670066895&amp;hvpone=&amp;hvptwo=&amp;hvqmt=&amp;hvdev=c&amp;hvdvcmdl=&amp;hvlocint=&amp;hvlocphy=9028749&amp;hvtargid=pla-430228081645&amp;psc=1" rel="noopener ugc nofollow" target="_blank"> 220欧姆电阻和一个RGB LED </a>。</li></ol><p id="78af" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">您还应该考虑使用一个带有T型适配器的<a class="ae mx" href="https://www.amazon.com/dp/B082PRVRYR/ref=sspa_dk_detail_2?psc=1&amp;pd_rd_i=B082PRVRYR&amp;pd_rd_w=8mKhr&amp;pf_rd_p=887084a2-5c34-4113-a4f8-b7947847c308&amp;pd_rd_wg=e9psa&amp;pf_rd_r=S09F37DF2G5FW8B8GX4B&amp;pd_rd_r=c065c120-e60b-45e9-b93b-f581f048cf46&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUFCMzhUQ09COFI2VlMmZW5jcnlwdGVkSWQ9QTA5NjU2ODUxRDkxNEYwSTYwV09KJmVuY3J5cHRlZEFkSWQ9QTAxOTg1MTUyRUhEUlc2VzQ2VDQ4JndpZGdldE5hbWU9c3BfZGV0YWlsJmFjdGlvbj1jbGlja1JlZGlyZWN0JmRvTm90TG9nQ2xpY2s9dHJ1ZQ==" rel="noopener ugc nofollow" target="_blank"> 40引脚母对母，将GPIO输出连接到试验板上。您只能使用跳线，但电缆会使事情变得更容易，并有助于防止损坏Raspberry Pi上的GPIO引脚。如果您选择不购买带T型适配器的40针电缆，您需要购买</a><a class="ae mx" href="https://www.amazon.com/SinLoon-Breadboard-Arduino-Circuit-40-Pack/dp/B08M3QLL3Q/ref=pd_sbs_7/143-0445142-7950409?pd_rd_w=sVLrc&amp;pf_rd_p=8b76d7a7-ab83-4ddc-a92d-e3e33bfdbf03&amp;pf_rd_r=CDM5TGJT03VKF0ZFB577&amp;pd_rd_r=8e58fd82-8503-41cf-b8f2-c78eaeb78d25&amp;pd_rd_wg=tT1U0&amp;pd_rd_i=B08M3QLL3Q&amp;psc=1" rel="noopener ugc nofollow" target="_blank">公母跳线</a>。然而，单独购买所有这些东西会比一套花费更多。<a class="ae mx" href="https://www.amazon.com/dp/B06WP7169Y/ref=sspa_dk_detail_5?psc=1&amp;pd_rd_i=B06WP7169Y&amp;pd_rd_w=OZVyf&amp;pf_rd_p=887084a2-5c34-4113-a4f8-b7947847c308&amp;pd_rd_wg=0V0IH&amp;pf_rd_r=623YJTBQ2CN2B2GYXQG5&amp;pd_rd_r=faa61f0f-3aec-4cf0-8e7e-d44eb1b3b92f&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEyUVlDQzMzVVZBMFYxJmVuY3J5cHRlZElkPUEwMzExNzk4MUhGSjFSS0VKTlBROCZlbmNyeXB0ZWRBZElkPUEwMzYwNjg2UUdMRU44N0YzNzIwJndpZGdldE5hbWU9c3BfZGV0YWlsJmFjdGlvbj1jbGlja1JlZGlyZWN0JmRvTm90TG9nQ2xpY2s9dHJ1ZQ==" rel="noopener ugc nofollow" target="_blank">这里有一个简单的工具包，上面所有的</a>。如果你希望了解这个系列，我推荐你购买<a class="ae mx" href="https://www.amazon.com/gp/product/B09BMVT4CB/ref=ppx_yo_dt_b_asin_title_o02_s00?ie=UTF8&amp;psc=1" rel="noopener ugc nofollow" target="_blank">sun founder Raspberry Pi Ultimate初学者工具包</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/620811adbbbdb21ec26cf7d8be17f64c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uYIgjshQqjJNq5P_xNJ8ow.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ni">sun founder Ultimate Starter/Raphael套件— </em>图片来源:作者</p></figure><p id="5aa9" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">您还需要一些基本的C和Go编程知识，并且熟悉登录到Raspberry Pi终端，或者登录到一些操作系统版本附带的桌面GUI。根据您采用的方法，您可能需要将键盘和显示器连接到Raspberry Pi。我只是简单地进入Pi。您还需要熟悉如何使用像Vi或nano这样的编辑器。</p><p id="980a" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">为了编译和运行C程序，你需要<a class="ae mx" href="https://github.com/WiringPi/WiringPi" rel="noopener ugc nofollow" target="_blank"> WiringPi </a>库。很容易得到:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="5bd4" class="no kw iq nk b gy np nq l nr ns">sudo apt-get install wiringpi</span></pre><p id="a7de" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">然后使用以下命令测试安装:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="2231" class="no kw iq nk b gy np nq l nr ns">pi@pi-node1:~/go/src/github.com/youngkin/gpio/rgbled $ gpio -v<br/>gpio version: 2.50<br/>Copyright (c) 2012-2018 Gordon Henderson<br/>This is free software with ABSOLUTELY NO WARRANTY.<br/>For details type: gpio -warranty</span><span id="63fe" class="no kw iq nk b gy nt nq l nr ns">Raspberry Pi Details:<br/>  Type: Pi 3B+, Revision: 03, Memory: 1024MB, Maker: Sony<br/>  * Device tree is enabled.<br/>  *--&gt; Raspberry Pi 3 Model B Plus Rev 1.3<br/>  * This Raspberry Pi supports user-level GPIO access.</span></pre><p id="b747" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">在上面你会注意到<code class="fe nu nv nw nk b">gpio version: 2.50</code>。如果你使用的是Rasberry Pi 4，使用Sunfounder <a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/check_the_wiringpi_c.html" rel="noopener ugc nofollow" target="_blank">中给出的检查接线Pi </a>的说明。</p><p id="e337" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">WiringPi的独特之处在于它包括一个命令行工具<code class="fe nu nv nw nk b">gpio</code>，如上所示，可用于管理、控制和查询GPIO板。这非常方便。参见<a class="ae mx" href="http://wiringpi.com/the-gpio-utility/" rel="noopener ugc nofollow" target="_blank"> gpio参考</a>了解更多关于它能做什么和如何使用的信息。</p><p id="1dd0" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">我选择不从Sunfounder网站下载代码，而是自己编写代码，即使我所做的只是直接从项目文档中复制。因此，我创建了自己的位置来创建代码。实际上，<a class="ae mx" href="https://github.com/youngkin/gpio" rel="noopener ugc nofollow" target="_blank">我的代码在Github </a>里。如果你喜欢下载代码，你可以选择从我的Github库下载、克隆或派生代码。另外，用Go编写的项目代码也位于那里。该项目的代码位于<a class="ae mx" href="https://github.com/youngkin/gpio/tree/main/rgbled" rel="noopener ugc nofollow" target="_blank"> gpio/rgbled </a>。</p><p id="fcad" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">如果您对在Raspberry Pi上进行Go开发感兴趣，您需要将开发环境安装到Raspberry Pi上。<a class="ae mx" href="https://www.jeremymorgan.com/tutorials/raspberry-pi/install-go-raspberry-pi/" rel="noopener ugc nofollow" target="_blank">这里有一个简单的来源</a>解释了如何实现这一点。这个源代码有点过时了，但是唯一重要的问题是Go to install的版本。来源显示正在安装围棋<strong class="lp ir">1.14.4.linux-arm64.tar.gz</strong>和<strong class="lp ir">1.14.4.linuxarmv6l.tar.gz</strong>。目前的版本是<strong class="lp ir">1.17.1.linux-arm64.tar.gz</strong>和<strong class="lp ir">1.17.1.linuxarmv6l.tar.gz</strong>。对于树莓派3B+正确的选择将是<strong class="lp ir">1.17.1.linuxarmv6l.tar.gz</strong>。另一个是为64位系统设计的，比如Raspberry Pi 4系列。</p><p id="9e67" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">对于Go开发，你还需要go-rpio库。我选择它有几个原因:</p><ol class=""><li id="f6eb" class="ln lo iq lp b lq my ls mz lu nd lw ne ly nf ma ng mc md me bi translated">它似乎被广泛使用</li><li id="e1f2" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">它看起来相当完整</li><li id="2f28" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">它相对活跃</li><li id="6245" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">它附带了示例代码和良好的文档</li><li id="faaa" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">它的API类似于WiringPi</li></ol><p id="5324" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">另一个Go选项是<a class="ae mx" href="https://github.com/periph/host" rel="noopener ugc nofollow" target="_blank"> periph </a>(代码)与<a class="ae mx" href="https://periph.io/" rel="noopener ugc nofollow" target="_blank">文档</a>。它更活跃，文档也非常好，比go-rpio好。但是对于我能找到的LED例子，go-rpio更好地匹配了我正在寻找的，特别是关于这个项目。但是这是go-rpio的一个很好的替代，反之亦然。</p><p id="db9c" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">最后，如果你想脱离Sunfounder文档的食谱风格，我假设你对Linux有基本的了解。例如，我不会解释什么是<strong class="lp ir">根特权</strong>。</p><h1 id="bb55" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">会有帮助的信息</h1><p id="aaa0" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">该项目使用GPIO引脚上的PWM(脉宽调制)来实现所需的效果，即演示如何使用简单的RGB LED创建不同的颜色。不幸的是，Sunfounder文档遗漏了关于PWM的信息，比如什么是PWM，它是如何在Raspberry Pi上实现的？我开始在这一节中包括我在Sunfounder项目文档中发现缺失的所有信息，但是很快就发现最好留在一篇单独的文章中。因此，如果你还没有很好地理解PWM，我建议在继续这篇文章之前，阅读我的<a class="ae mx" href="https://youngkin.github.io/post/pulsewidthmodulationraspberrypi/" rel="noopener ugc nofollow" target="_blank">假人脉宽调制，以及一片树莓Pi </a>文章。在这篇文章中，我将使用那篇文章中解释的术语。</p><h1 id="8330" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">RGB LED in C(软件PWM)</h1><p id="9d04" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">根据您的经验，您应该考虑从<a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/component_list.html" rel="noopener ugc nofollow" target="_blank">组件列表和简介</a>开始审查<a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/1.1.2_rgb_led_c.html" rel="noopener ugc nofollow" target="_blank"> RGB LED </a>项目。仔细阅读<em class="nx">与C一起玩</em>部分。如果你熟悉基本的电子器件和元件，如试验板和电阻，你可以跳过它。</p><p id="c952" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">您应该按照项目文档或下图中的描述设置试验板:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/3add1f3b848438fcb9ea02bf63ef07d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xiUJfxPaCtzpYHWJj_Z__w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ni"> Sunfounder RGB LED试验板设置— </em>图片来源:<a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/_images/image61.png" rel="noopener ugc nofollow" target="_blank"> Sunfounder </a></p></figure><p id="b88f" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">如果有必要，WiringPi <code class="fe nu nv nw nk b">gpio</code>实用程序可以帮助进行调试。您已经有了这个实用程序，并在上面的先决条件一节中使用它来验证WiringPi安装。</p><p id="5133" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">Sunfounder <a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/1.1.2_rgb_led_c.html" rel="noopener ugc nofollow" target="_blank"> RGB LED项目</a>中描述的C代码使用软件PWM。运行时，RGB LED的颜色会按预期变化。使用软件PWM改变各个RGB引脚的电压，可产生不同亮度的光(关闭至全亮)，从而产生各种颜色。</p><p id="d6fb" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">下面是Sunfounder C程序的一个稍加修改的版本，它控制一个RGB LED:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="b305" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第8行提供了构建程序所需的命令— <code class="fe nu nv nw nk b">gcc -o rgbled rgbled.c -lwiringPi -lpthread</code>。<code class="fe nu nv nw nk b">-l</code>标志引用构建程序所需的库。<code class="fe nu nv nw nk b">-lwiringPi</code>指WiringPi库。它应该和WiringPi一起安装在正确的位置，并且build命令应该可以正常工作。图书馆通常位于<code class="fe nu nv nw nk b">/usr/lib</code>。第9行提供了运行程序的命令。</p><p id="3caf" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第18–20行使用WiringPi引脚编号方案分别指定了<code class="fe nu nv nw nk b">LedPinRed</code>、<code class="fe nu nv nw nk b">LedPinGreen</code>和<code class="fe nu nv nw nk b">LedPinBlue</code>的GPIO引脚0、1和2。</p><p id="ace5" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第24行包含中断信号的信号处理程序声明(SIGINT)。</p><p id="4ce9" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第27–29行使用<code class="fe nu nv nw nk b">softPwmCreate()</code>函数初始化管脚。功能名称<code class="fe nu nv nw nk b">softPwm</code>中的初始字符表示引脚正在为软件PWM进行初始化。该函数的第一个参数是pin号。第二个参数是起始脉冲宽度。最后一个参数是范围。如果你不理解这些术语，请参见<a class="ae mx" href="https://youngkin.github.io/post/pulsewidthmodulationraspberrypi/" rel="noopener ugc nofollow" target="_blank">假人脉宽调制，以及一片树莓酱</a>。</p><p id="d6be" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第33–35行，<code class="fe nu nv nw nk b">softPwmWrite()</code>向相关引脚发送所需信号/电压。第一个参数是pin号，与上面的<code class="fe nu nv nw nk b">softPwmCreate()</code>相同。第二个参数是脉冲宽度。注意<code class="fe nu nv nw nk b">softPwmCreate()</code>中的脉冲宽度为<code class="fe nu nv nw nk b">0</code>。这具有将引脚设置为零伏的效果。在<code class="fe nu nv nw nk b">softPwmWrite()</code>中，脉冲宽度被设置为由<code class="fe nu nv nw nk b">r_val</code>、<code class="fe nu nv nw nk b">g_val</code>和<code class="fe nu nv nw nk b">b_val</code>指定的值。这些值分别代表红色、绿色和蓝色值。脉冲宽度的最大有效值是范围。这将导致全亮度/电压。任何大于范围的值都不会有额外的影响。值得注意的是，所需电压将继续流向引脚，直到被另一个<code class="fe nu nv nw nk b">softPwmWrite()</code>复位。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="cba9" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">上面的代码片段是程序的延续。它显示了<code class="fe nu nv nw nk b">main()</code>功能。第2–5行初始化WiringPi库。如果初始化失败，程序将退出。</p><p id="7673" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第7行指定了程序收到SIGINT信号时要调用的信号处理程序。这是用户在键盘上输入ctl-C时设置的信号。这个信号处理器将终止程序。这个函数是在前面的代码片段中声明的。</p><p id="5c33" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第11行的<code class="fe nu nv nw nk b">while(keepRunning)</code>循环中对<code class="fe nu nv nw nk b">ledColorSet(...)</code>的调用使用十六进制数来设置颜色。这些用于生成所有可用的颜色。它们必须在<code class="fe nu nv nw nk b">0</code>到<code class="fe nu nv nw nk b">0xff</code>的范围内，回想一下<code class="fe nu nv nw nk b">softPwmCreate()</code>中指定的范围值。我确实改变了原始Sunfounder代码的值，因为所用的绿色LED显然电阻较小，因为它比红色和蓝色LED亮得多，因此会丢弃生成的颜色。同样，蓝色LED的电阻似乎更大，因为它比其他两个LED更暗。改变数值，至少对于我的特定RGB LED，产生了更真实的颜色。代码循环，改变LED颜色，直到通过键盘上的ctl-C终止。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="57ea" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">上面的代码片段是前面代码片段的延续。它包含前面描述的中断处理程序的实现。它关闭所有RGB LED的引脚，导致LED完全关闭。<code class="fe nu nv nw nk b">pinMode()</code>将指定管脚的模式(第一参数)设置为<code class="fe nu nv nw nk b">OUTPUT</code>(第二参数)。这将使引脚从PWM引脚变为只能设置为开或关的引脚。输出引脚的电压不能改变。<code class="fe nu nv nw nk b">digitalWrite()</code>将指定管脚的电压设置为零(低)。</p><p id="17c4" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">程序编译后可以使用<code class="fe nu nv nw nk b">./rgbled</code>运行。</p><h1 id="d6bb" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">RGB LED in C(硬件PWM)</h1><p id="0a98" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">由于Sunfounder文档不包含C语言的硬件PWM解决方案，我决定自己创建一个。对于该程序，修改试验板，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/6d5e38707f0d5d66b858b0c9cefe2ff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*220SjKgRg3BttSTpGwDyHw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ni">改良Sunfounder RGB LED试验板设置— </em>图片来源:<a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/_images/image61.png" rel="noopener ugc nofollow" target="_blank"> Sunfounder </a> &amp;作者</p></figure><p id="f186" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">这一次，我使用WiringPi引脚24、1和23来显示红色、绿色和蓝色，它们分别对应于BCM引脚19、18和13。这是因为这是Broadcomm BCM2835板上4个硬件PWM引脚中的3个。请务必重新布线板，以匹配这些新的引脚分配。如有必要，WiringPi <code class="fe nu nv nw nk b">gpio</code>实用程序可以帮助调试。您已经有了这个实用程序，并在上面的先决条件一节中使用它来验证WiringPi安装。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="bc52" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">这个版本的RGB LED与上面的软件PWM版本非常相似。有两个显著的区别。</p><ol class=""><li id="afd1" class="ln lo iq lp b lq my ls mz lu nd lw ne ly nf ma ng mc md me bi translated">请注意第14–16行中使用的引脚编号。这里使用的WiringPi引脚编号对应于GPIO板上可用的硬件PWM引脚。</li><li id="7170" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated"><code class="fe nu nv nw nk b">ledInit()</code>和<code class="fe nu nv nw nk b">ledColorSet()</code>功能(第30-48行)非常不同。在这些功能中，引脚模式设置为<code class="fe nu nv nw nk b">PWM_OUTPUT</code>而不是使用<code class="fe nu nv nw nk b">softPwmCreate()</code>，并且使用<code class="fe nu nv nw nk b">pwmWrite()</code>而不是<code class="fe nu nv nw nk b">softPwmWrite()</code>。第34行设置了范围。请注意，pin号码不是为<code class="fe nu nv nw nk b">pwmSetRange()</code>调用指定的。这有两个原因。首先，范围是在通道级设置的，而不是针对单个引脚。第二是WiringPi库不允许分别指定这两个通道。它将两个通道设置为相同的值。第35行，<code class="fe nu nv nw nk b">pwmSetClock()</code>，(间接)设置频率。它指定了一个<em class="nx">除数</em>，在本例中为<code class="fe nu nv nw nk b">2</code>，用于将电路板振荡器的时钟频率划分为用于控制引脚的频率。<em class="nx">除数</em>必须是介于2和4095之间的数字。与<code class="fe nu nv nw nk b">pwmSetRange()</code>一样，<code class="fe nu nv nw nk b">pwmSetClock()</code>是在通道级指定的，而不是针对单个引脚。关于时钟、频率和<em class="nx">除数</em>与PWM相关的更多讨论，请参见<a class="ae mx" href="https://youngkin.github.io/post/pulsewidthmodulationraspberrypi/" rel="noopener ugc nofollow" target="_blank">虚拟脉宽调制，以及一片树莓派</a>。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="01b6" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">上面的代码片段包含程序的剩余部分，<code class="fe nu nv nw nk b">main()</code>和中断处理程序。中断处理程序与软件PWM版本中的中断处理程序完全相同。像软件PWM版本的程序，该程序循环，直到通过ctl-C中断。</p><p id="9d5e" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">使用根权限和<code class="fe nu nv nw nk b">sudo ./rgbledHardware</code>运行程序。需要<code class="fe nu nv nw nk b">sudo</code>是因为直接硬件访问仅限于具有root权限的用户。<code class="fe nu nv nw nk b">sudo</code>为前缀为<code class="fe nu nv nw nk b">sudo</code>的命令提供根权限。</p><p id="34e4" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">运行该程序时，您会注意到RGB LED没有产生预期的颜色。有时它应该显示蓝色，却可能显示紫色。有时候，当它应该显示一种颜色时，它可能会被完全关闭。出现这种现象是因为BCM的第13号针脚(蓝色)和BCM的第19号针脚(红色)位于同一硬件通道上。如上所述，当信号发送到一个通道时，它会传播到共享该通道的两个引脚。BCM针12上的绿色不受影响。我不明白的一个行为是，为什么有时LED应该显示一种颜色却不亮。这只发生在红色(BCM19)和蓝色(BCM 13)引脚上。也许共享一个通道的引脚不会在完全相同的时间产生信号。假设蓝色引脚设为0xff，红色引脚设为0x00。如果红色引脚的信号稍晚于蓝色信号，它将覆盖关闭LED的蓝色引脚信号。所有这一切的要点是，对于所有意图和目的，只有2个硬件PWM引脚可以同时使用，并且它们不能在同一通道上。</p><h1 id="e83b" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">RGB LED in Go(硬件PWM)</h1><p id="fe27" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">这个版本的RGB LED将与C硬件PWM版本的试验板设置一起工作。也就是说，它使用GPIO板上的硬件PWM引脚。与Sunfounder C版本以及本文中的第一个C版本不同，Go库只支持硬件PWM。在我的<a class="ae mx" href="https://youngkin.github.io/post/pulsewidthmodulationraspberrypi/" rel="noopener ugc nofollow" target="_blank">假人脉宽调制，用一片树莓Pi </a>的文章中，我确实包含了一个软件版本的PWM在Go中。它是在一个配套程序中实现的，<code class="fe nu nv nw nk b">runSoftwarePWM()</code>函数中的<a class="ae mx" href="https://github.com/youngkin/gpio/blob/main/pwmdemo/pwmexplorer/apps/freqtest.go" rel="noopener ugc nofollow" target="_blank"> freqtest.go </a>。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="ab49" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第27–29行定义了用于LED的红色、绿色和蓝色元件的引脚。</p><p id="6bb1" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第30–31行定义了用于设置的默认值。</p><p id="591b" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第35–75行将<code class="fe nu nv nw nk b">Mode</code>设置为PWM，将<code class="fe nu nv nw nk b">DutyCycle</code>设置为LED引脚。在<code class="fe nu nv nw nk b">DutyCycle()</code>中，第一个参数是脉冲宽度，被go-rpio称为<em class="nx"> duty </em>。第二个参数是范围，被go-rpio称为<em class="nx">周期</em>。其余几行包含注释和代码，用于解决试图使用位于同一通道上的2个硬件PWM引脚时出现的问题，如上文C语言中的<em class="nx">硬件PWM</em>部分所述。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="ce50" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">这个代码片段是上面程序的延续。此要诀显示<code class="fe nu nv nw nk b">ledInit()</code>。它初始化程序中使用的GPIO引脚。它们设置模式(PWM)、频率和占空比(提供脉冲宽度(即占空比)和范围(即周期)的参数)。如<a class="ae mx" href="https://youngkin.github.io/post/pulsewidthmodulationraspberrypi/" rel="noopener ugc nofollow" target="_blank">假人脉宽调制中所述，用一片树莓Pi </a>，指定频率必须在4688到9600000之间。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="8aeb" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">这是程序的第3部分，展示了<code class="fe nu nv nw nk b">main()</code>的实现。第2-4行初始化go-rpio库。第5行确保当程序退出时，所使用的资源被释放。</p><p id="cfd7" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">程序的其余部分提示用户输入要使用的红色、绿色和蓝色值，并适当设置引脚。</p><p id="0c78" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">完整的程序，<a class="ae mx" href="https://github.com/youngkin/gpio/blob/main/rgbled/rgbled.go" rel="noopener ugc nofollow" target="_blank"> rgbled.go </a>，可以在<a class="ae mx" href="https://github.com/youngkin/gpio" rel="noopener ugc nofollow" target="_blank"> gpio github repo </a>中找到。</p><h1 id="ca6b" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">摘要</h1><p id="4c3d" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">就这些，希望你觉得这篇文章有趣。为了快速回顾，本文介绍了以下内容:</p><ol class=""><li id="56d8" class="ln lo iq lp b lq my ls mz lu nd lw ne ly nf ma ng mc md me bi translated">设置在Raspberry Pi 3B+上试验RGB LED所需的物理环境。</li><li id="b6f3" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">通过与<a class="ae mx" href="https://youngkin.github.io/post/pulsewidthmodulationraspberrypi/" rel="noopener ugc nofollow" target="_blank">虚拟脉宽调制的链接，提供了一片树莓Pi </a>，详细介绍了<a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/1.1.2_rgb_led_c.html" rel="noopener ugc nofollow" target="_blank"> Sunfounder RGB LED项目</a>中缺少的PWM知识。</li><li id="e7fd" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">提供并解释了使用硬件和软件PWM在RGB LED中设置颜色所需的C和Go代码。</li></ol><h1 id="77e5" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">参考</h1><ol class=""><li id="960c" class="ln lo iq lp b lq lr ls lt lu lv lw lx ly lz ma ng mc md me bi translated"><a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/1.1.2_rgb_led_c.html" rel="noopener ugc nofollow" target="_blank"> Sunfounder RGB LED项目</a>是本文的基础</li><li id="79f7" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated"><a class="ae mx" href="https://github.com/WiringPi/WiringPi" rel="noopener ugc nofollow" target="_blank"> WiringPi </a> —本文中用于GPIO编程的C库</li><li id="b83e" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated"><a class="ae mx" href="https://github.com/stianeikeland/go-rpio" rel="noopener ugc nofollow" target="_blank"> go-rpio </a> —本文中用于GPIO编程的go库</li><li id="e030" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated"><a class="ae mx" href="https://youngkin.github.io/post/pulsewidthmodulationraspberrypi/" rel="noopener ugc nofollow" target="_blank">脉宽调制的假人，用一片树莓皮</a>包含所有你需要知道的关于一个树莓皮上的PWM，至少直到你想成为一个PWM专家！</li></ol></div></div>    
</body>
</html>