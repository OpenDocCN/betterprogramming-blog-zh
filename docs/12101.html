<html>
<head>
<title>How to Use Web3.swift in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在iOS中使用Web3.swift</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-fetch-data-from-the-ethereum-blockchain-using-swift-46138b290ac?source=collection_archive---------13-----------------------#2022-05-11">https://betterprogramming.pub/how-to-fetch-data-from-the-ethereum-blockchain-using-swift-46138b290ac?source=collection_archive---------13-----------------------#2022-05-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7a53" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Swift从以太坊区块链获取数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0897d76e105db00461f9e65f334711a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cw9sJExzOp3czSkAT1VAMQ.png"/></div></div></figure><p id="d809" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">自从以太坊区块链在2015年推出以来，它已经彻底改变了整个软件开发行业。这是第一个具有智能合约功能的区块链，允许开发人员创建和部署与以太坊区块链交互的分散式应用程序(dApps)。</p><p id="f13e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在大多数dApps都是基于网络的应用。然而，我确实相信，随着时间的推移，当区块链技术得到更多的采用时，移动原生dApps将变得越来越受欢迎。</p><p id="ee51" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我将向您展示如何创建一个简单的dApp，从以太坊Mainnet获取最新的天然气价格。在整个过程中，您将学习如何访问公共节点，在Xcode项目中应该使用什么库，以及如何从Mainnet连接和获取数据。</p><p id="72a9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">事不宜迟，让我们直接开始吧！</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="41f3" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">基本概念</h1><p id="745a" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">如果你正在阅读这篇文章，我想你已经对什么是区块链有了一些基本的概念。如果你不知道，你可以把它想象成一个巨大的服务器，由分布在世界各地的数千个节点组成。</p><blockquote class="mu mv mw"><p id="9b9d" class="ku kv mx kw b kx ky ju kz la lb jx lc my le lf lg mz li lj lk na lm ln lo lp im bi translated">专家提示:查看这个页面，了解目前全球可用的以太坊节点。</p></blockquote><p id="a2bc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从以太坊区块链获取数据的方式与从中央服务器获取数据的方式非常相似。我们将连接到一个以太坊节点，而不是连接到一个集中式服务器，这个以太坊节点公开了JSON-RPC方法 (API端点)的<a class="ae nb" href="https://docs.infura.io/infura/networks/ethereum/json-rpc-methods" rel="noopener ugc nofollow" target="_blank">列表。通过使用提供的API端点，我们可以执行一些操作，比如获取当前的天然气价格或者获取地址的余额。</a></p><p id="4f33" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是否意味着我们需要建立自己的以太坊节点才能入门？嗯，没必要。</p><p id="c3cc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有一些第三方服务，比如向公共节点提供API的<a class="ae nb" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank"> Infura </a>和<a class="ae nb" href="https://www.alchemy.com/" rel="noopener ugc nofollow" target="_blank"> Alchemy </a>。我们需要做的就是订阅他们的免费服务，然后我们就可以开始了。对于这篇文章，Infura将是我们的主要焦点，但是如果你喜欢的话，你可以使用炼金术。</p><p id="3cc4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦我们有了合适的节点，从以太坊区块链获取数据只是调用API端点的问题。对于我们的示例应用程序，我们将使用由<a class="ae nb" href="https://www.argent.xyz/" rel="noopener ugc nofollow" target="_blank"> Argent Labs </a>开发的<a class="ae nb" href="https://github.com/argentlabs/web3.swift" rel="noopener ugc nofollow" target="_blank"> web3.swift </a>库来简化我们与以太坊区块链的交互。</p><p id="df90" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有了基本的概念之后，让我们前往<a class="ae nb" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank"> Infura </a>开始吧。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="226f" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">使用Infura</h1><p id="842f" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">正如您可能已经猜到的，您需要做的第一件事是创建一个Infura帐户。你可以在这里<a class="ae nb" href="https://infura.io/register" rel="noopener ugc nofollow" target="_blank">做</a>。</p><p id="cbeb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦您的帐户启动并运行，前往仪表板并创建一个新项目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/ff561818fb1b7fb3369c79272355cf6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*G0j6eFrpbnWGbP6A"/></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">Infura仪表板</p></figure><p id="893b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在“新建项目”对话框中，选择“以太坊”作为产品，并填写您想要的项目名称:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/88f8735e8464ad5c426aeac71ce2c94e.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/0*HghcyyY760xr4m4M"/></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">在Infura中创建新项目</p></figure><p id="4894" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建项目后，您将被重定向到项目设置页面。您可以在这里获得项目的JSON-RPC端点:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/a7f2e2028251fb658f73496c07187570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0PYL3hpK4e0QPu1i"/></div></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">获取Infura中的项目端点</p></figure><p id="ee71" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您不想在以太坊主网上测试您的dApp，您可以使用下拉菜单切换到测试网，如Ropsten和Rinkeby，以获得它们各自的端点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/a8cb77bed31c471c676339036ed21bbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/0*I-R0Lnchr7cbjXfK"/></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">Infura中的交换端点</p></figure><p id="212d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">至此，我们已经成功设置了Infura，现在可以开始使用给定的端点与以太坊区块链进行交互了。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="4886" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">从以太坊区块链获取数据</h1><p id="53f5" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">我们可以用来获取当前以太坊气价的JSON-RPC方法是<code class="fe nk nl nm nn b">eth_gasPrice</code>。如果您看一下该方法的<a class="ae nb" href="https://docs.infura.io/infura/networks/ethereum/json-rpc-methods/eth_gasprice" rel="noopener ugc nofollow" target="_blank"> API规范</a>，您会注意到响应体如下所示:</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="513b" class="ns ly it nn b gy nt nu l nv nw">{<br/>  "jsonrpc": "2.0",<br/>  "id": 1,<br/>  "result": "0x12a05f200"<br/>}</span></pre><p id="6b77" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其中气价(<code class="fe nk nl nm nn b">result</code>)用一个整数的十六进制代码表示。</p><p id="3935" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您完全可以对<code class="fe nk nl nm nn b">eth_gasPrice</code>方法执行post请求，并手动将给定的十六进制代码解析回整数，但这太麻烦了！让我向您介绍一种更好的方法来处理这种情况——使用<a class="ae nb" href="https://github.com/argentlabs/web3.swift" rel="noopener ugc nofollow" target="_blank"> web3.swift </a>库。</p><h2 id="2fa1" class="ns ly it bd lz nx ny dn md nz oa dp mh ld ob oc mj lh od oe ml ll of og mn oh bi translated">web3.swift库</h2><p id="1c44" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">如前所述，<em class="mx"> web3.swift </em>库是由Argent Lab开发的，该团队是著名的移动DeFi wallet“<a class="ae nb" href="https://apps.apple.com/app/argent-defi-in-a-tap/id1358741926" rel="noopener ugc nofollow" target="_blank">Argent</a>”的幕后团队。他们开源该库的主要目标是通过Swift本地库方便地访问以太坊区块链，主要用于创建分散的iOS应用程序。因此，如果你喜欢这个库，并且愿意支持团队正在做的事情，请随时给他们你的反馈，为这个库做贡献。</p><p id="f261" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在回到库本身，它基本上是以太坊区块链的一些最常用方法的包装类。它为我们处理所有繁重的任务，比如API调用和JSON解析。最好的部分是它甚至支持新的<a class="ae nb" href="https://swiftsenpai.com/swift/swift-concurrency-get-started/" rel="noopener ugc nofollow" target="_blank"> Swift Concurrency </a> ( <code class="fe nk nl nm nn b">async/await</code>)语法。</p><blockquote class="mu mv mw"><p id="7c8d" class="ku kv mx kw b kx ky ju kz la lb jx lc my le lf lg mz li lj lk na lm ln lo lp im bi translated">专业提示:</p><p id="656e" class="ku kv mx kw b kx ky ju kz la lb jx lc my le lf lg mz li lj lk na lm ln lo lp im bi translated">安装完这个库之后，查看在<code class="fe nk nl nm nn b">EthereumClient.swift</code>中定义的<code class="fe nk nl nm nn b">EthereumClientProtocol</code>,查看这个库支持的所有JSON-RPC方法。</p></blockquote><p id="9959" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了从以太坊区块链获得天然气价格，我们需要做的就是使用从Infura获得的端点创建一个<code class="fe nk nl nm nn b">EthereumClient</code>的实例，并相应地调用相应的客户端方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="3844" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">需要注意的一点是，<code class="fe nk nl nm nn b">eth_gasPrice()</code>方法返回的类型是<code class="fe nk nl nm nn b">BigUint</code>，是一个比<code class="fe nk nl nm nn b">UIntMax</code>更宽的整数类型。因此，我们可以使用<code class="fe nk nl nm nn b">BigUint</code>提供的<code class="fe nk nl nm nn b">quotientAndRemainder(dividingBy:)</code>函数将给定的气价从wei转换为Gwei。</p><p id="ef1d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">至此，你已经成功地创建了第一个运行在以太坊区块链上的去中心化iOS应用。好样的。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="65ad" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">包扎</h1><p id="1996" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">在本文中，我只介绍了您使用Swift开始dApp开发所需了解的最基本的内容。围绕移动dApp开发仍然有很多话题，比如连接到钱包、处理交易等。我还没讲到。</p><p id="af55" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此时此刻，我还处于探索和学习的阶段。我将继续在Medium上分享我在这里学到的东西，所以请在不久的将来继续关注更多类似的文章。</p><p id="c528" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读。</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="e401" class="ns ly it nn b gy nt nu l nv nw"><strong class="nn iu">Want to Connect?</strong></span><span id="938c" class="ns ly it nn b gy ok nu l nv nw">In the meantime, you can follow me on <a class="ae nb" href="https://twitter.com/Lee_Kah_Seng" rel="noopener ugc nofollow" target="_blank">Twitter</a> and check out my website for articles related to <a class="ae nb" href="https://swiftsenpai.com/category/swift/" rel="noopener ugc nofollow" target="_blank">Swift</a> and <a class="ae nb" href="https://swiftsenpai.com/category/development/" rel="noopener ugc nofollow" target="_blank">iOS development</a>.</span></pre></div></div>    
</body>
</html>