<html>
<head>
<title>How to Build a Barcode Scanner App That Gets Prices From eBay</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何建立一个从易贝获取价格的条形码扫描仪应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-build-a-bar-code-scanner-app-that-gets-prices-from-ebay-8228fe26c029?source=collection_archive---------7-----------------------#2019-09-10">https://betterprogramming.pub/how-to-build-a-bar-code-scanner-app-that-gets-prices-from-ebay-8228fe26c029?source=collection_archive---------7-----------------------#2019-09-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a99d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们将构建一个PHP应用程序来查询易贝API，然后我们将构建一个web应用程序来获取条形码并将其发送到我们的API</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8e4bcd973b37a4588a6247eacf2c8e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yNmfhENsC6UyqXKSUpHUow.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@d_dandelion?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> david pl </a>在<a class="ae ky" href="https://unsplash.com/search/photos/barcode?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ab53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">易贝有一个免费的API来访问他们的列表数据，HTML有一个摄像头API来通过网页从摄像头获取图像。这意味着我们可以创建应用程序，从您的web应用程序中扫描条形码，获取代码，并将其发送到易贝API进行查询。</p><p id="19a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个故事中，我们将构建一个PHP应用程序来查询易贝API，然后我们将构建一个web应用程序来获取条形码并将其发送到我们的API。后端很简单。这只是一个通过ISBN代码从易贝API获取数据的脚本。为后端应用程序创建一个文件夹，并放入以下内容:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="520e" class="ma mb it lw b gy mc md l me mf">&lt;?php<br/>use Symfony\Component\HttpFoundation\Request;<br/>use Symfony\Component\HttpFoundation\Response;<br/>use GuzzleHttp\Client;</span><span id="23b7" class="ma mb it lw b gy mg md l me mf">$ebay = $app['controllers_factory'];<br/>$ebayAppId = $_ENV['EBAY_APP_ID'];<br/>$client = new Client([    <br/>    'base_uri' =&gt; '<a class="ae ky" href="http://svcs.ebay.com'" rel="noopener ugc nofollow" target="_blank">http://svcs.ebay.com'</a>    <br/>]);</span><span id="b5de" class="ma mb it lw b gy mg md l me mf">$ebay-&gt;get('/find-by-code/{code}/{page}', function ($code, $page) use ($app, $client, $ebayAppId) {  <br/>    if (strlen($code) == 10 || strlen($code) == 13){<br/>        $type = 'ISBN';<br/>    }<br/>    else if (strlen($code) == 12){<br/>        $type = 'UPC';<br/>    }<br/>    else{<br/>        return $app-&gt;json(['error' =&gt; 'invalid code'], 400);<br/>    }</span><span id="e58e" class="ma mb it lw b gy mg md l me mf">    if (!is_int(intval($page)) || $page &lt;= 0){<br/>        return $app-&gt;json(['error' =&gt; 'invalid page'], 400);<br/>    }</span><span id="d92d" class="ma mb it lw b gy mg md l me mf">$response = $client-&gt;request('GET', "/services/search/FindingService/v1?OPERATION-NAME=findItemsByProduct&amp;SERVICE-VERSION=1.0.0&amp;SECURITY-APPNAME=$ebayAppId&amp;RESPONSE-DATA-FORMAT=JSON&amp;REST-PAYLOAD&amp;paginationInput.entriesPerPage=10&amp;productId.<a class="ae ky" href="http://twitter.com/type" rel="noopener ugc nofollow" target="_blank">@type</a>=$type&amp;productId=$code&amp;paginationInput.pageNumber=$page");    <br/>    return $app-&gt;json(json_decode($response-&gt;getBody(), true));<br/>});</span><span id="9edc" class="ma mb it lw b gy mg md l me mf">return $ebay;</span></pre><p id="4634" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们称之为<code class="fe mh mi mj lw b">ebay.php</code>。<code class="fe mh mi mj lw b"> function ($code, $page) use ($app, $client, $ebayAppId)</code>部分允许路由访问外部变量，因为回调与外部变量在不同的范围内。</p><p id="63b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在<code class="fe mh mi mj lw b">index.php</code>，我们把</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a2df" class="ma mb it lw b gy mc md l me mf">&lt;?php<br/>require_once 'vendor/autoload.php';</span><span id="6bb3" class="ma mb it lw b gy mg md l me mf">$app = new Silex\Application();<br/>$dotenv = new Dotenv\Dotenv('.');<br/>$dotenv-&gt;load();<br/>$app-&gt;register(new JDesrosiers\Silex\Provider\CorsServiceProvider(), [<br/>    "cors.allowOrigin" =&gt; "*",<br/>]);</span><span id="b491" class="ma mb it lw b gy mg md l me mf">$app['debug']= true;</span><span id="8038" class="ma mb it lw b gy mg md l me mf">$app-&gt;get('/hello/{name}', function($name) use($app) {<br/>    return 'Hello '.$app-&gt;escape($name);<br/>});</span><span id="e0c3" class="ma mb it lw b gy mg md l me mf">$app-&gt;mount('/ebay', include 'ebay.php');<br/>$app["cors-enabled"]($app);<br/>$app-&gt;run();</span></pre><p id="1907" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样我们就可以进入我们的路线。</p><p id="6fdd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mh mi mj lw b">composer.json</code>中，我们把</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="92bd" class="ma mb it lw b gy mc md l me mf">{<br/>    "require": {<br/>        "silex/silex": "^2.0",<br/>        "vlucas/phpdotenv": "^2.4",<br/>        "jdesrosiers/silex-cors-provider": "~1.0",<br/>        "guzzlehttp/guzzle": "~6.0"<br/>    }<br/>}</span></pre><p id="b0e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果安装了Composer，我们可以运行<code class="fe mh mi mj lw b">composer install</code>来安装我们的依赖项。</p><p id="bcf9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们已经完成了后端。我们可以做前端。该应用程序将建立有角度的。我们用Angular CLI搭建了这个应用。我们运行<code class="fe mh mi mj lw b">ng new frontend</code>来搭建应用程序。</p><p id="7d81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与我们的典型应用程序唯一不同的是，HTTPS需要访问相机，所以我们必须为我们的开发服务器生成我们自己的HTTPS证书。我们应该把<code class="fe mh mi mj lw b">server.crt</code>和<code class="fe mh mi mj lw b">server.key</code>文件和前端app文件放在同一个文件夹里。</p><p id="e8a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的<code class="fe mh mi mj lw b">angular.json</code>的<code class="fe mh mi mj lw b">serve</code>部分应该有:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2014" class="ma mb it lw b gy mc md l me mf">"serve": {<br/>  "builder": "<a class="ae ky" href="http://twitter.com/angular" rel="noopener ugc nofollow" target="_blank">@angular</a>-devkit/build-angular:dev-server",<br/>  "options": {<br/>    "browserTarget": "frontend:build",<br/>    "sslKey": "server.key",<br/>    "sslCert": "server.cert"<br/>  },<br/>  "configurations": {<br/>    "production": {<br/>      "browserTarget": "frontend:build:production"<br/>    },<br/>    "mobile": {<br/>      "browserTarget": "frontend:build:mobile"<br/>    }<br/>  }<br/>},</span></pre><p id="63f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在哪里</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="297b" class="ma mb it lw b gy mc md l me mf">"sslKey": "server.key",<br/>"sslCert": "server.cert"</span></pre><p id="af4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应该引用您的证书路径。</p><p id="1cf7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，为了运行Angular CLI开发服务器，我们运行:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f24d" class="ma mb it lw b gy mc md l me mf">ng serve --ssl</span></pre><p id="8553" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你进入<a class="ae ky" href="https://localhost:4200," rel="noopener ugc nofollow" target="_blank"> https://localhost:4200，</a>你会在大多数浏览器中看到一个不安全的连接错误。单击继续继续。</p><p id="f2c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你的摄像头在你的安卓设备上，我们可以远程调试。在Chrome中，按F12打开控制台，点击右上角带有三个垂直圆点的菜单。然后点击远程设备，将你的Android设备连接到你的电脑上，根据<a class="ae ky" href="https://developers.google.com/web/tools/chrome-devtools/remote-debugging/" rel="noopener ugc nofollow" target="_blank">指令</a>启用远程调试。</p><p id="5934" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你不跑<code class="fe mh mi mj lw b">ng serve --ssl</code>，而是跑<code class="fe mh mi mj lw b">ng serve --ssl --host 0.0.0.0</code></p><p id="50a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成所有这些操作后，您应该会看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/021c95d7c7938748b59e2562deb5dd72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GzG3GUA_amiXlFrqW3RZ6Q.png"/></div></div></figure><p id="66eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦应用程序构建完成。</p><p id="a757" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们安装了一个库，通过运行以下命令来访问设备的摄像头和我们的flux store:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="241e" class="ma mb it lw b gy mc md l me mf">npm i @zxing/ngx-scanner @ngrx/store @angular/material @angular/cdk</span></pre><p id="273b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mh mi mj lw b">app.module.ts</code>中，我们把:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4df1" class="ma mb it lw b gy mc md l me mf">import { BrowserModule } from '<a class="ae ky" href="http://twitter.com/angular/platform-browser" rel="noopener ugc nofollow" target="_blank">@angular/platform-browser</a>';<br/>import { NgModule } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { ZXingScannerModule } from '<a class="ae ky" href="http://twitter.com/zxing/ngx-scanner" rel="noopener ugc nofollow" target="_blank">@zxing/ngx-scanner</a>';<br/>import { BrowserAnimationsModule } from '<a class="ae ky" href="http://twitter.com/angular/platform-browser" rel="noopener ugc nofollow" target="_blank">@angular/platform-browser</a>/animations';<br/>import { MatToolbarModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/toolbar';<br/>import { MatInputModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/input';<br/>import { MatButtonModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/button';<br/>import { MatTabsModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/tabs';<br/>import { MatCardModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/card';<br/>import { HttpClientModule } from '<a class="ae ky" href="http://twitter.com/angular/common" rel="noopener ugc nofollow" target="_blank">@angular/common</a>/http';<br/>import { MatPaginatorModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/paginator';<br/>import { MatTableModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/table';<br/>import { MatSelectModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/select';</span><span id="00f9" class="ma mb it lw b gy mg md l me mf">import { AppRoutingModule } from './app-routing.module';<br/>import { AppComponent } from './app.component';<br/>import { HomePageComponent } from './home-page/home-page.component';<br/>import { StoreModule } from '<a class="ae ky" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';<br/>import { barCodeReducer } from './bar-code-reducer';<br/>import { FormsModule } from '<a class="ae ky" href="http://twitter.com/angular/forms" rel="noopener ugc nofollow" target="_blank">@angular/forms</a>';<br/>import { EbayTabComponent } from './ebay-tab/ebay-tab.component';</span><span id="9a16" class="ma mb it lw b gy mg md l me mf"><a class="ae ky" href="http://twitter.com/NgModule" rel="noopener ugc nofollow" target="_blank">@NgModule</a>({<br/>  declarations: [<br/>    AppComponent,<br/>    HomePageComponent,<br/>    EbayTabComponent<br/>  ],<br/>  imports: [<br/>    BrowserModule,<br/>    AppRoutingModule,<br/>    ZXingScannerModule,<br/>    BrowserAnimationsModule,<br/>    MatButtonModule,<br/>    MatToolbarModule,<br/>    MatInputModule,<br/>    MatTabsModule,<br/>    StoreModule.forRoot({ barCode: barCodeReducer }),<br/>    FormsModule,<br/>    MatCardModule,<br/>    HttpClientModule,<br/>    MatPaginatorModule,<br/>    MatTableModule,<br/>    MatSelectModule<br/>  ],<br/>  providers: [],<br/>  bootstrap: [AppComponent]<br/>})<br/>export class AppModule { }</span></pre><p id="fd0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这包括了角材料成分和我们的通量储备。</p><p id="f5a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们必须为我们的数据建立一个集中的存储。我们创建一个名为<code class="fe mh mi mj lw b">bar-code-reducer.ts</code>的文件，并添加以下内容:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="54a6" class="ma mb it lw b gy mc md l me mf">export const SET_BARCODE = 'SET_BARCODE';</span><span id="d847" class="ma mb it lw b gy mg md l me mf">export function barCodeReducer(state: string = '', action) {<br/>    switch (action.type) {<br/>        case SET_BARCODE:<br/>            return action.payload;<br/>        default:<br/>            return state;<br/>    }<br/>}</span></pre><p id="9bf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以添加前端组件了。我们运行:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4023" class="ma mb it lw b gy mc md l me mf">ng g component ebayTab<br/>ng g component homePage</span></pre><p id="78bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将添加显示我们的条形码扫描仪的页面和显示我们的易贝数据的部分。</p><p id="c374" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们创建一个服务，通过运行以下命令来创建HTTP请求:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="41b4" class="ma mb it lw b gy mc md l me mf">ng g service productSearch</span></pre><p id="d42c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在那之后，我们应该有<code class="fe mh mi mj lw b">produce-search.service.ts</code>。我们把以下内容放在那里:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="963c" class="ma mb it lw b gy mc md l me mf">import { Injectable } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { HttpClient } from '<a class="ae ky" href="http://twitter.com/angular/common" rel="noopener ugc nofollow" target="_blank">@angular/common</a>/http';<br/>import { environment } from 'src/environments/environment';</span><span id="2689" class="ma mb it lw b gy mg md l me mf"><a class="ae ky" href="http://twitter.com/Injectable" rel="noopener ugc nofollow" target="_blank">@Injectable</a>({<br/>  providedIn: 'root'<br/>})<br/>export class ProductSearchService {</span><span id="79c4" class="ma mb it lw b gy mg md l me mf">  constructor(<br/>    private http: HttpClient<br/>  ) { }</span><span id="6aeb" class="ma mb it lw b gy mg md l me mf">  searchProduct(barcode: string, currentPage: number) {<br/>    return this.http.get(`${environment.apiUrl}/ebay/find-by-code/${barcode}/${currentPage}`)<br/>  }<br/>}</span></pre><p id="56ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mh mi mj lw b">ebay-tab.component.ts</code>中，我们输入:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0022" class="ma mb it lw b gy mc md l me mf">import { Component, OnInit } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { Store, select } from '<a class="ae ky" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';<br/>import { Observable } from 'rxjs';<br/>import { ProductSearchService } from '../product-search.service';<br/>import { ConstantPool } from '<a class="ae ky" href="http://twitter.com/angular/compiler" rel="noopener ugc nofollow" target="_blank">@angular/compiler</a>';</span><span id="8a2f" class="ma mb it lw b gy mg md l me mf"><a class="ae ky" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-ebay-tab',<br/>  templateUrl: './ebay-tab.component.html',<br/>  styleUrls: ['./ebay-tab.component.css']<br/>})<br/>export class EbayTabComponent implements OnInit {</span><span id="b5b9" class="ma mb it lw b gy mg md l me mf">barcode$: Observable&lt;string&gt;;<br/>  barcodeValue: string;<br/>  products: any[] = [];<br/>  totalPages: number = 0;<br/>  totalEntries: number = 0;<br/>  entriesPerPage: number = 0;<br/>  currentPage: number = 1;<br/>  displayedColumns: string[] = [<br/>    'itemId',<br/>    'title',<br/>    'location',<br/>    'country',<br/>    'shippingServiceCost',<br/>    'currentPrice',<br/>    'convertedCurrentPrice',<br/>    'bestOfferEnabled',<br/>    'buyItNowAvailable',<br/>    'listingType'<br/>  ];</span><span id="ddb6" class="ma mb it lw b gy mg md l me mf">constructor(<br/>    private store: Store&lt;any&gt;,<br/>    private productSearchService: ProductSearchService<br/>  ) {<br/>    this.barcode$ = store.pipe(select('barCode'))<br/>    this.barcode$.subscribe(barcode =&gt; {<br/>      this.barcodeValue = barcode;<br/>      this.products = [];<br/>      this.searchProduct(this.barcodeValue, this.currentPage);<br/>    }, err =&gt; {</span><span id="4221" class="ma mb it lw b gy mg md l me mf">})<br/>  }</span><span id="8745" class="ma mb it lw b gy mg md l me mf">ngOnInit() {<br/>  }</span><span id="b00e" class="ma mb it lw b gy mg md l me mf">searchProduct(barcodeValue, currentPage) {<br/>    this.productSearchService.searchProduct(barcodeValue, currentPage)<br/>      .subscribe((res: any) =&gt; {<br/>        try {<br/>          this.products = res.findItemsByProductResponse[0].searchResult[0].item as any[];          <br/>          this.products = this.products.map(p =&gt; {<br/>            let shippingServiceCost = p.shippingInfo[0].shippingServiceCost;<br/>            let sellingStatus = p.sellingStatus;<br/>            return {<br/>              itemId: p.itemId,<br/>              title: p.title,<br/>              country: p.country,<br/>              location: p.location,<br/>              shippingServiceCost: Array.isArray(shippingServiceCost) ? `${shippingServiceCost[0]['__value__']} ${shippingServiceCost[0]['<a class="ae ky" href="http://twitter.com/currencyId" rel="noopener ugc nofollow" target="_blank">@currencyId</a>']}` : '',<br/>              currentPrice: Array.isArray(sellingStatus) ? `${sellingStatus[0].currentPrice[0]['__value__']} ${sellingStatus[0].currentPrice[0]['<a class="ae ky" href="http://twitter.com/currencyId" rel="noopener ugc nofollow" target="_blank">@currencyId</a>']}` : '',<br/>              convertedCurrentPrice: Array.isArray(sellingStatus) ? `${sellingStatus[0].convertedCurrentPrice[0]['__value__']} ${sellingStatus[0].convertedCurrentPrice[0]['<a class="ae ky" href="http://twitter.com/currencyId" rel="noopener ugc nofollow" target="_blank">@currencyId</a>']}` : '',<br/>              bestOfferEnabled: p.listingInfo[0].bestOfferEnabled[0],<br/>              buyItNowAvailable: p.listingInfo[0].buyItNowAvailable[0],<br/>              listingType: p.listingInfo[0].listingType[0]<br/>            }<br/>          })<br/>          this.totalPages = res.findItemsByProductResponse[0].paginationOutput[0].totalPages[0];<br/>          this.totalEntries = res.findItemsByProductResponse[0].paginationOutput[0].totalEntries[0];<br/>          this.entriesPerPage = res.findItemsByProductResponse[0].paginationOutput[0].entriesPerPage[0];<br/>        }<br/>        catch (ex) {<br/>          this.products = [];<br/>        }<br/>      }, err =&gt; {<br/>        this.products = [];<br/>      })<br/>  }</span><span id="967f" class="ma mb it lw b gy mg md l me mf">getProducts(event) {<br/>    this.currentPage = event.pageIndex + 1;<br/>    this.searchProduct(this.barcodeValue, this.currentPage);<br/>  }<br/>}</span></pre><p id="d65d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mh mi mj lw b">ebay-tab.component.html</code>中，我们有:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="807d" class="ma mb it lw b gy mc md l me mf">&lt;div *ngIf='products.length &gt; 0'&gt;<br/>  &lt;table mat-table [dataSource]="products" class="mat-elevation-z8"&gt;<br/>    &lt;ng-container matColumnDef="itemId"&gt;<br/>      &lt;th mat-header-cell *matHeaderCellDef&gt; Item ID &lt;/th&gt;<br/>      &lt;td mat-cell *matCellDef="let element"&gt; {{element.itemId}} &lt;/td&gt;<br/>    &lt;/ng-container&gt;</span><span id="d935" class="ma mb it lw b gy mg md l me mf">&lt;ng-container matColumnDef="title"&gt;<br/>      &lt;th mat-header-cell *matHeaderCellDef&gt; Title &lt;/th&gt;<br/>      &lt;td mat-cell *matCellDef="let element"&gt; {{element.title}} &lt;/td&gt;<br/>    &lt;/ng-container&gt;</span><span id="e879" class="ma mb it lw b gy mg md l me mf">&lt;ng-container matColumnDef="location"&gt;<br/>      &lt;th mat-header-cell *matHeaderCellDef&gt; Location &lt;/th&gt;<br/>      &lt;td mat-cell *matCellDef="let element"&gt; {{element.location}} &lt;/td&gt;<br/>    &lt;/ng-container&gt;</span><span id="8b68" class="ma mb it lw b gy mg md l me mf">&lt;ng-container matColumnDef="country"&gt;<br/>      &lt;th mat-header-cell *matHeaderCellDef&gt; Country &lt;/th&gt;<br/>      &lt;td mat-cell *matCellDef="let element"&gt; {{element.country}} &lt;/td&gt;<br/>    &lt;/ng-container&gt;</span><span id="e73a" class="ma mb it lw b gy mg md l me mf">&lt;ng-container matColumnDef="shippingServiceCost"&gt;<br/>      &lt;th mat-header-cell *matHeaderCellDef&gt; Shipping Cost &lt;/th&gt;<br/>      &lt;td mat-cell *matCellDef="let element"&gt; {{element.shippingServiceCost}} &lt;/td&gt;<br/>    &lt;/ng-container&gt;</span><span id="13ca" class="ma mb it lw b gy mg md l me mf">&lt;ng-container matColumnDef="currentPrice"&gt;<br/>      &lt;th mat-header-cell *matHeaderCellDef&gt; Current Price &lt;/th&gt;<br/>      &lt;td mat-cell *matCellDef="let element"&gt; {{element.currentPrice}} &lt;/td&gt;<br/>    &lt;/ng-container&gt;</span><span id="8d67" class="ma mb it lw b gy mg md l me mf">&lt;ng-container matColumnDef="convertedCurrentPrice"&gt;<br/>      &lt;th mat-header-cell *matHeaderCellDef&gt; Converted Current Price &lt;/th&gt;<br/>      &lt;td mat-cell *matCellDef="let element"&gt; {{element.convertedCurrentPrice}} &lt;/td&gt;<br/>    &lt;/ng-container&gt;</span><span id="004f" class="ma mb it lw b gy mg md l me mf">&lt;ng-container matColumnDef="bestOfferEnabled"&gt;<br/>      &lt;th mat-header-cell *matHeaderCellDef&gt; Best Offer Enabled &lt;/th&gt;<br/>      &lt;td mat-cell *matCellDef="let element"&gt; {{element.bestOfferEnabled}} &lt;/td&gt;<br/>    &lt;/ng-container&gt;</span><span id="950b" class="ma mb it lw b gy mg md l me mf">&lt;ng-container matColumnDef="buyItNowAvailable"&gt;<br/>      &lt;th mat-header-cell *matHeaderCellDef&gt; Buy It Now &lt;/th&gt;<br/>      &lt;td mat-cell *matCellDef="let element"&gt; {{element.buyItNowAvailable}} &lt;/td&gt;<br/>    &lt;/ng-container&gt;</span><span id="1e2d" class="ma mb it lw b gy mg md l me mf">&lt;ng-container matColumnDef="listingType"&gt;<br/>      &lt;th mat-header-cell *matHeaderCellDef&gt; Listing Type &lt;/th&gt;<br/>      &lt;td mat-cell *matCellDef="let element"&gt; {{element.listingType}} &lt;/td&gt;<br/>    &lt;/ng-container&gt;</span><span id="3e61" class="ma mb it lw b gy mg md l me mf">&lt;tr mat-header-row *matHeaderRowDef="displayedColumns"&gt;&lt;/tr&gt;<br/>    &lt;tr mat-row *matRowDef="let row; columns: displayedColumns;"&gt;&lt;/tr&gt;<br/>  &lt;/table&gt;</span><span id="59c1" class="ma mb it lw b gy mg md l me mf">&lt;mat-paginator [length]="totalEntries" [pageSize]="entriesPerPage" (page)='getProducts($event)'&gt;<br/>  &lt;/mat-paginator&gt;<br/>&lt;/div&gt;<br/>&lt;div *ngIf='products.length == 0' class="center"&gt;<br/>  &lt;h1&gt;No Results&lt;/h1&gt;<br/>&lt;/div&gt;</span></pre><p id="65d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mh mi mj lw b">home-page.component.ts</code>中，我们放入:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="5290" class="ma mb it lw b gy mc md l me mf">import { Component, OnInit, ViewChild } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { Store } from '<a class="ae ky" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';<br/>import { Observable } from 'rxjs';<br/>import { SET_BARCODE } from '../bar-code-reducer';<br/>import { NgForm } from '<a class="ae ky" href="http://twitter.com/angular/forms" rel="noopener ugc nofollow" target="_blank">@angular/forms</a>';<br/>import { BarcodeFormat } from '<a class="ae ky" href="http://twitter.com/zxing/library" rel="noopener ugc nofollow" target="_blank">@zxing/library</a>';<br/>import { ZXingScannerComponent } from '<a class="ae ky" href="http://twitter.com/zxing/ngx-scanner" rel="noopener ugc nofollow" target="_blank">@zxing/ngx-scanner</a>';</span><span id="86bd" class="ma mb it lw b gy mg md l me mf"><a class="ae ky" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-home-page',<br/>  templateUrl: './home-page.component.html',<br/>  styleUrls: ['./home-page.component.css']<br/>})<br/>export class HomePageComponent implements OnInit {</span><span id="448d" class="ma mb it lw b gy mg md l me mf">  barcodeValue: number;<br/>  webCamAvailable: boolean = true;<br/>  barcode$: Observable&lt;string&gt;;<br/>  searching: boolean = false;<br/>  allowedFormats = [<br/>    BarcodeFormat.QR_CODE,<br/>    BarcodeFormat.EAN_13,<br/>    BarcodeFormat.CODE_128,<br/>    BarcodeFormat.DATA_MATRIX,<br/>    BarcodeFormat.UPC_A,<br/>    BarcodeFormat.UPC_E,<br/>    BarcodeFormat.UPC_EAN_EXTENSION,<br/>    BarcodeFormat.CODABAR,<br/>    BarcodeFormat.CODE_39,<br/>    BarcodeFormat.CODE_93<br/>  ];<br/>  hasCameras = false;<br/>  hasPermission: boolean;<br/>  qrResultString: string;</span><span id="0088" class="ma mb it lw b gy mg md l me mf">  availableDevices: MediaDeviceInfo[];<br/>  selectedDevice: MediaDeviceInfo;<br/>  <a class="ae ky" href="http://twitter.com/ViewChild" rel="noopener ugc nofollow" target="_blank">@ViewChild</a>('scanner')<br/>  scanner: ZXingScannerComponent;</span><span id="b2f3" class="ma mb it lw b gy mg md l me mf">  constructor(<br/>    private store: Store&lt;any&gt;<br/>  ) {</span><span id="a835" class="ma mb it lw b gy mg md l me mf">  }</span><span id="516a" class="ma mb it lw b gy mg md l me mf">  ngOnInit() {<br/>    this.scanner.camerasFound.subscribe((devices: MediaDeviceInfo[]) =&gt; {<br/>      this.hasCameras = true;<br/>      this.availableDevices = devices;</span><span id="0f27" class="ma mb it lw b gy mg md l me mf">});</span><span id="2fc1" class="ma mb it lw b gy mg md l me mf">this.scanner.permissionResponse.subscribe((answer: boolean) =&gt; {<br/>      this.hasPermission = answer;<br/>    });<br/>  }</span><span id="94ea" class="ma mb it lw b gy mg md l me mf">  onValueChanges(result) {<br/>    this.barcodeValue = result.codeResult.code;<br/>    this.searching = true;<br/>    this.store.dispatch({ type: SET_BARCODE, payload: this.barcodeValue });<br/>  }</span><span id="3f6c" class="ma mb it lw b gy mg md l me mf">  searchProduct(barCodeForm: NgForm) {<br/>    this.searching = false;<br/>    if (barCodeForm.invalid) {<br/>      return;<br/>    }<br/>    this.searching = true;<br/>    this.store.dispatch({ type: SET_BARCODE, payload: this.barcodeValue });<br/>  }</span><span id="2667" class="ma mb it lw b gy mg md l me mf">  scanSuccessHandler(event) {<br/>    console.log(event);<br/>    this.barcodeValue = event;<br/>    this.store.dispatch({ type: SET_BARCODE, payload: this.barcodeValue });<br/>  }</span><span id="0f1c" class="ma mb it lw b gy mg md l me mf">  onDeviceSelectChange(selectedValue: string) {<br/>    this.selectedDevice = this.scanner.getDeviceById(selectedValue);<br/>  }</span><span id="608f" class="ma mb it lw b gy mg md l me mf">  scanErrorHandler(event) {<br/>    console.log(event);<br/>  }</span><span id="4be2" class="ma mb it lw b gy mg md l me mf">  scanFailureHandler(event) {<br/>    console.log(event);<br/>  }</span><span id="4a9b" class="ma mb it lw b gy mg md l me mf">  scanCompleteHandler(event) {<br/>    console.log(event);<br/>    this.barcodeValue = event.text;<br/>    this.store.dispatch({ type: SET_BARCODE, payload: this.barcodeValue });<br/>  }<br/>}</span></pre><p id="aab8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了扫描，还可以手动输入条形码。如果有相机，您应该会看到一个预览框。扫描后，我们获得条形码值，并将其传播到我们通过flux store创建的<code class="fe mh mi mj lw b">ebay-tab</code>组件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/d9107d7f068ab732c85ee549f3de45d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KKc9thPI4cEBr9tDY0Kitg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/37dc73f8423b22d5f4b44dbb94da12a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D4d5jrUrpqHKpQmX1MO4hQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/2961e75e1ebc1a90f717dad361400e1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RTeRVCKaHZimor4_BlzEfQ.png"/></div></div></figure></div></div>    
</body>
</html>