<html>
<head>
<title>How To Publish Your First Python Package — It’s Not That Hard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何发布你的第一个Python包——这并不难</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-publish-your-first-python-package-its-not-that-hard-6202f74f5954?source=collection_archive---------8-----------------------#2020-01-09">https://betterprogramming.pub/how-to-publish-your-first-python-package-its-not-that-hard-6202f74f5954?source=collection_archive---------8-----------------------#2020-01-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="71f3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">上传到PyPI和pip安装您的成名之路</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8fd492b1726e8185071cedb29b6b3b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*huON82ngbYi-v_BeSLLNeg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@ryoji__iwata?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">岩田良治</a>在<a class="ae ky" href="https://unsplash.com/s/photos/puzzle?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="3200" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经发布了我的第一个Python包，现在轮到你了。本指南将为您提供清晰的分步说明，帮助您规划、设置和执行第一个公共Python包的发布。跟随之后，你和世界上的其他人将能够<strong class="lb iu"> </strong> pip安装你自己发布的软件包。</p><p id="375d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">快速的谷歌搜索会让发布一个Python包看起来像是一项令人生畏的任务。事实上，简单的第一个包并不难，但是过多的配置选项淹没了它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8a8e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">达成共识</h1><p id="d3b7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在我们转向代码和终端之前，我们必须做一些簿记工作。被抛来抛去的术语可能会令人困惑。什么是模块？一个包裹？图书馆？</p><p id="b26c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将这三个术语概念化的方式是，模块可以像单个Python文件一样基本。包就是那个模块，但却是为分发而准备的。最后，库将是模块的集合，大概是为发布而准备的。</p><p id="8096" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来要澄清的是你需要做什么。确保你有一个编辑器(我用的是Visual Studio)、一个终端应用(我用的是iTerm或者Windows PowerShell)、一个TestPyPI上的账号Python包索引的沙箱。我们希望在那里练习，这样就不会污染生产索引，但是我也将包括生产发布的命令。</p><p id="20b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我想概述一下我们将要采取的步骤。我们将设置目录结构，添加一些内容，然后创建用作安装脚本的setup.py文件。</p><p id="5851" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将创建包并上传到(测试)PyPI。最后，我们将讨论继续开发的下一步以及学到的一些经验教训。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1f9c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置目录和内容</h1><p id="4dcb" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们从创建下面的文件夹结构开始，用您的包名替换<code class="fe mz na nb nc b">jhsu98</code>。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="92a8" class="nh md it nc b gy ni nj l nk nl">jhsu98/<br/>  jhsu98/<br/>    __init__.py<br/>  LICENSE<br/>  README.md<br/>  setup.py</span></pre><p id="fd8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将要创建的模块将直接放入嵌套的<code class="fe mz na nb nc b">jhsu98</code>目录中的<code class="fe mz na nb nc b">__init__.py</code>中。把顶层目录想象成我们的项目，把嵌套目录想象成模块本身。</p><p id="a660" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">LICENSE</code>文件将包含软件包发布的许可证。我不会在这里深入讨论，但是为您的包选择您想要的许可证并相应地复制/粘贴。</p><p id="f165" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">README.md</code>文件将包含包的描述。用Markdown编写，这将是在项目的PyPI页面上可见的文档。</p><p id="64ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，<code class="fe mz na nb nc b">setup.py</code>文件将用于在包创建期间提供细节。它实际上是项目的元数据。好了，让我们开始充实<code class="fe mz na nb nc b">__init__.py</code>和<code class="fe mz na nb nc b">setup.py</code></p><p id="cfc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每次初始化模块实例时，都会执行<code class="fe mz na nb nc b">__init__.py</code>文件。我们要确保有两件事:一个版本和一个函数。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="38f2" class="nh md it nc b gy ni nj l nk nl"># __init__.py<br/>__version__ = "0.0.1"</span><span id="cdca" class="nh md it nc b gy nm nj l nk nl">def helloWorld():<br/>   print("Hello World")</span></pre><p id="f6de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请随意在文件中使用您自己的版本号和您自己的函数。该版本的主要优点是，每次发布到PyPI时，您都需要增加。</p><p id="f2b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是<code class="fe mz na nb nc b">setup.py</code>，互联网提供了上千种不同的变化。让我们从解释这个文件是什么和它做什么开始。</p><p id="cf20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我相信你已经注意到了<code class="fe mz na nb nc b">.py</code>扩展名，所以对于初学者来说，它是一个普通的Python文件——不要让它的存在过于复杂。该文件的目的是提供一旦我们执行该文件以触发打包过程时将使用的包的详细信息。</p><p id="cd80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在研究了许多<code class="fe mz na nb nc b">setup.py</code>教程和例子之后，以下是我的开始样板:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="dac4" class="nh md it nc b gy ni nj l nk nl">import pathlib<br/>from setuptools import setup</span><span id="25d7" class="nh md it nc b gy nm nj l nk nl">HERE = pathlib.Path(__file__).parent<br/>README = (HERE / "README.md").read_text()<br/>setup(<br/>  name="jhsu98",<br/>  version="0.0.1",<br/>  description="",<br/>  long_description=README,<br/>  long_description_content_type="text/markdown",<br/>  author="",<br/>  author_email="",<br/>  license="MIT",<br/>  packages=["jhsu98"],<br/>  zip_safe=False<br/>)</span></pre><p id="34e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要关注的几个亮点:确保版本号与<code class="fe mz na nb nc b">__init__.py</code>匹配，我冒昧地假设了一个免费使用和分发的MIT许可证，<code class="fe mz na nb nc b">packages=["jhsu98"]</code>的值必须与你的模块名匹配，<code class="fe mz na nb nc b">name="jhsu98"</code>是项目的名称，技术上可以与你的模块名不同。</p><p id="467c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将剩下的部分留给您来填写，但是在此之后，我们就完成了模块的创建并准备打包它了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3d4d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建分发包</h1><p id="c801" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">是时候使用您的<code class="fe mz na nb nc b">setup.py</code>文件来创建发行包了。打开终端，导航到父项目文件夹。然后使用以下命令运行<code class="fe mz na nb nc b">setup.py</code>:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="67eb" class="nh md it nc b gy ni nj l nk nl">python setup.py sdist bdist_wheel</span></pre><p id="96bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将看到创建了三个目录<code class="fe mz na nb nc b">build</code>、<code class="fe mz na nb nc b">dist</code>和<code class="fe mz na nb nc b">jhsu98.egg-info</code>，除了您的模块名称。我们最关心的是<code class="fe mz na nb nc b">dist</code>目录，其中有一个以您的包的名称和版本命名的tarball ( <code class="fe mz na nb nc b">tar.gz</code>文件)。这是将要发布到(测试)PyPI的文件。</p><p id="5092" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有许多不同的策略来创建依赖于项目内容和发行方法的发行版，但是那是另外一天的2级主题。重要的是在下一节中将要发布到(测试)PyPI的单文件tarball。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7a82" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">发布您的包</h1><p id="2be9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这一刻终于到来了。是时候发布你的包了。如前所述，Python包索引托管了一个用于测试的索引，这就是我们将要开始的地方。首先，在<a class="ae ky" href="https://test.pypi.org/" rel="noopener ugc nofollow" target="_blank">https://test.pypi.org/</a>上创建一个账户</p><p id="6dac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建并验证您的帐户后，让我们回到终端，安装用于上传tarball的<a class="ae ky" href="https://pypi.org/project/twine/" rel="noopener ugc nofollow" target="_blank"> twine </a>。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="c2de" class="nh md it nc b gy ni nj l nk nl">pip install twine</span></pre><p id="d60c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将使用twine模块上传到测试环境。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="7142" class="nh md it nc b gy ni nj l nk nl">python3 -m twine upload --repository-url https://test.pypi.org/legacy/dist/*</span></pre><p id="f571" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简单起见，我用星号(*)来上传全部；但是，接下来您可以更加明确地指定要上传的确切文件。</p><p id="7c51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输入用户名和密码后，您应该会收到一条成功消息:祝贺您，您刚刚发布了一个Python包！</p><p id="07e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在任何Python环境中查看您的<a class="ae ky" href="https://test.pypi.org/manage/projects/" rel="noopener ugc nofollow" target="_blank">项目的主页</a>和<code class="fe mz na nb nc b">pip install</code>。让我们试着从<code class="fe mz na nb nc b">pip</code>安装我们的模块。我建议使用虚拟环境，但这取决于你。</p><p id="63b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们发布了测试索引，所以我们需要指定安装源。使用以下命令，替换您自己的软件包名称:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="0f37" class="nh md it nc b gy ni nj l nk nl">pip install -i https://test.pypi.org/simple/jhsu98</span></pre><p id="0f17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设安装进展顺利，是时候创建一个新的<code class="fe mz na nb nc b">.py</code>文件了，您将在其中导入您安装的模块并使用它:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="26dc" class="nh md it nc b gy ni nj l nk nl">import jhsu98</span><span id="8600" class="nh md it nc b gy nm nj l nk nl">jhsu98.helloWorld()</span></pre><p id="e98e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你准备好真正的交易，这里有一些说明。<a class="ae ky" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank">创建一个账户</a>并使用以下命令上传和安装。</p><p id="6b13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">python3 -m twine upload dist/*</code></p><p id="2b2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">pip install jhsu98</code></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5849" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">持续发展和经验教训</h1><p id="770b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">很自然地，你已经兴奋地准备好发布你的Python模块了，所以这里有一些小技巧来节省你在Google上的时间，并且避免我碰到的绊脚石。</p><ul class=""><li id="3307" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">想想文件结构。您可能不希望整个模块或库都放在<code class="fe mz na nb nc b">__init__.py</code>中，所以计划好您的文件并相应地导入。</li><li id="3d4a" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">制定版本计划。我喜欢在我的项目中使用<code class="fe mz na nb nc b">major.minor.micro</code>结构。简而言之，我认为向后破坏的变更是主要版本，新特性或一组修复是次要版本，表面的变更或单一的错误修复是微版本。不要忘记更新<code class="fe mz na nb nc b">setup.py</code>和<code class="fe mz na nb nc b">__init__.py</code>的版本</li><li id="4299" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">跟踪依赖关系。随着项目的增长，您可能需要导入其他已安装的模块。您将希望在<code class="fe mz na nb nc b">setup.py</code>中通过添加一个名为<code class="fe mz na nb nc b">install_requires</code>的参数来跟踪这些，该参数是一个包名数组。这将确保在安装过程中包含这些依赖项。</li></ul><p id="9af6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你有什么建议或经验教训吗？分享您发布到以下Python包索引的经验。</p></div></div>    
</body>
</html>