<html>
<head>
<title>Creating NuGet Packages to Share Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建NuGet包以共享代码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/creating-nuget-packages-9192d34255e7?source=collection_archive---------3-----------------------#2022-08-28">https://betterprogramming.pub/creating-nuget-packages-9192d34255e7?source=collection_archive---------3-----------------------#2022-08-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="596a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用包共享有用的代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fb0782ed28e7dde58e2b34f586d145f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0IztZnOW_IQHoV7IKM_Jnw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/@kampus/" rel="noopener ugc nofollow" target="_blank">坎普斯制作</a>在<a class="ae ky" href="https://www.pexels.com/" rel="noopener ugc nofollow" target="_blank">像素</a>上拍摄</p></figure><p id="6672" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如今，大多数框架都提供了一组足以构建优秀应用程序的组件，但另一方面，它们也提供了一种方式来共享我们的定制组件，以解决特定的问题，这在大多数情况下允许社区协作来改进这些部分。</p><p id="e4c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://dotnet.microsoft.com/en-us/" rel="noopener ugc nofollow" target="_blank">。Net framework </a>使用本机<a class="ae ky" href="https://www.nuget.org/" rel="noopener ugc nofollow" target="_blank"> NuGet </a>作为库的包管理器，例如<a class="ae ky" href="https://www.nuget.org/packages/Newtonsoft.Json/13.0.2-beta1" rel="noopener ugc nofollow" target="_blank"> Newtonsoft </a>、<a class="ae ky" href="https://www.nuget.org/packages/Moq" rel="noopener ugc nofollow" target="_blank"> Moq </a>、<a class="ae ky" href="https://www.nuget.org/packages/AutoMapper" rel="noopener ugc nofollow" target="_blank"> Automapper </a>以及许多其他库。</p><p id="6fc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多开发人员可能不知道的是，用我们的代码创建和共享一个NuGet包是非常简单快捷的，这也是我将在本文中解释的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8b34" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">我们要打包什么？</h1><p id="04cd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">几天前，我写了一篇关于<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/debugging-http-requests-in-net-core-2d26cb5d4295">我们如何拦截使用Refit发出的HTTP请求并将它们记录为curl </a>的文章，现在我将使用这些代码来创建我们新的NuGet包。</p><p id="9ff4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在我的个人资料下找到GitHub repo的全部代码。</p><p id="b566" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将修改这段代码，以便其他开发人员在他们的项目中轻松使用。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b0fe" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">准备包</h1><p id="7d16" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要创建一个NuGet包，我们需要首先创建一个类库项目，编写代码，然后运行命令来生成<code class="fe mz na nb nc b">.nupkg</code>文件，这个包已经准备好上传到nuget.org<a class="ae ky" href="https://www.nuget.org/" rel="noopener ugc nofollow" target="_blank"/></p><p id="07e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，在终端上运行命令<code class="fe mz na nb nc b">mkdir refit-log-calls</code>来创建一个新文件夹，并运行<code class="fe mz na nb nc b">cd refit-log-calls</code>来访问它。</p><blockquote class="nd ne nf"><p id="37f3" class="kz la ng lb b lc ld ju le lf lg jx lh nh lj lk ll ni ln lo lp nj lr ls lt lu im bi translated">在创建NuGet包之前，重要的是要考虑。net核心版本，我们将针对您的库。</p><p id="9056" class="kz la ng lb b lc ld ju le lf lg jx lh nh lj lk ll ni ln lo lp nj lr ls lt lu im bi translated">如果您使用最新版本的。net core，使用旧版本的项目将无法使用您的包。</p><p id="299e" class="kz la ng lb b lc ld ju le lf lg jx lh nh lj lk ll ni ln lo lp nj lr ls lt lu im bi translated">您可以通过运行命令<code class="fe mz na nb nc b">dotnet --list-sdks</code>在本地检查已安装的dotnet版本，在我的例子中，我有以下四个版本:</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/32effbfc916d09904304586bdbf3d64d.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/format:webp/1*8Zacqu1MQgG5HPOTSCrocg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Dotnet核心安装版本</p></figure><p id="c1f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行<code class="fe mz na nb nc b">dotnet new classlib</code>创建一个新的类库项目，默认情况下将使用最新版本，如果你想覆盖它并使用一个旧版本，你必须在根文件夹中创建一个<code class="fe mz na nb nc b">global.json</code>文件并选择你想要的版本。在下面的<code class="fe mz na nb nc b">global.json</code>文件中，我选择了。网络核心2.1</p><pre class="kj kk kl km gt nl nc nm nn aw no bi"><span id="cd30" class="np md it nc b gy nq nr l ns nt">{<br/>    "sdk": {<br/>        "version": "2.1.818"<br/>    }<br/>}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="d744" class="np md it bd me nu nv dn mi nw nx dp mm li ny nz mo lm oa ob mq lq oc od ms oe bi translated">编写代码</h2><p id="e1de" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">接下来，我将添加我从前面提到的现有项目中复制的第一个类。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">HttpToCurlHandler类</p></figure><p id="f1c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我将创建一个扩展方法来方便该类的使用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">HttpHandlerExtension扩展方法</p></figure><p id="d911" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我使用的是类库和. Net Core 2.1项目，所以我需要添加一些NuGet包来提供<code class="fe mz na nb nc b">IServiceCollection</code>和<code class="fe mz na nb nc b">IHttpClientBuilder</code></p><p id="0107" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将在终端中运行<code class="fe mz na nb nc b">dotnet add package Microsoft.Extensions.DependencyInjection --version 2.1.1</code>和<code class="fe mz na nb nc b">dotnet add package Microsoft.Extensions.Http --version 2.1.1</code>命令</p><p id="c03a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在运行<code class="fe mz na nb nc b">dotnet build</code>将会工作，并将成功构建一个类库</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e4c5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">配置包</h1><p id="e904" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">NuGet包需要额外的信息，可以通过在。csproj文件。</p><pre class="kj kk kl km gt nl nc nm nn aw no bi"><span id="95b0" class="np md it nc b gy nq nr l ns nt">&lt;PackageId&gt;NugetPackageIdentification&lt;/PackageId&gt; <br/>&lt;Version&gt;1.0.0&lt;/Version&gt; <br/>&lt;Authors&gt;your_name&lt;/Authors&gt; <br/>&lt;Company&gt;your_company&lt;/Company&gt;</span></pre><p id="cee5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加这些信息后，您的包应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/ce9583d38980c348b0b416681553dade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*r6qatD6pP9jnS_83G1-mdQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">NuGet包。csproj文件</p></figure><p id="1789" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，运行命令<code class="fe mz na nb nc b">dotnet pack</code>，如果一切正常，它将生成。文件夹<code class="fe mz na nb nc b">bin\Debug\RefitLogCalls.1.0.0.nupkg</code>中的nupkg文件</p><p id="5efe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了避免必须运行<code class="fe mz na nb nc b">dotnet pack</code>，您可以将属性<code class="fe mz na nb nc b">&lt;GeneratePackageOnBuild&gt;true&lt;/GeneratePackageOnBuild&gt;</code>添加到<code class="fe mz na nb nc b">&lt;PropertyGroup&gt;</code>标签中，下一个<code class="fe mz na nb nc b">dotnet build</code>将自动生成包。</p><p id="d0b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本上就是这样，我们得到了一个NuGet包。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7e0e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">上传到NuGet组织</h1><p id="957d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要上传您的软件包，我们需要在nuget.org上创建一个免费帐户。首先，这非常简单，您可以使用您的Microsoft帐户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/55ba23ae267d8bf775edb4b29d589a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jW-SZcRlxbRyvPjW0eBXmQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">NugetOrg门户</p></figure><p id="7668" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来点击页面右上角的API keys选项</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/b1f4cbf01f407cf721630ad13738012c.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*UeY4F0X6lSQ0gYGNxGqYbw.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">API密钥选项</p></figure><ol class=""><li id="e420" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu op oq or os bi translated">选择<code class="fe mz na nb nc b">Create</code>，如下图所示填写所有字段。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/a01a6a7a5b8ff4f3e5ac81ec2ba6e3d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5hxhriEdTD5ceLcCZmbJ6A.jpeg"/></div></div></figure><p id="5b15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按下<code class="fe mz na nb nc b">Create</code>按钮，我们将看到如下页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/76db7b656c4f119f104c55587b4ab7e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ahHJ_n03rRJ-7NXSVIr8QA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">新密钥已创建</p></figure><p id="420a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">复制密钥并保存在安全的地方，刷新页面后您将无法复制它。</p><p id="80dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们将包上传到nuget.org，首先，转到生成包的目录，运行命令<code class="fe mz na nb nc b">dotnet nuget push RefitLogCalls.1.0.0.nupkg --api-key aaaaaaaa --source <a class="ae ky" href="https://api.nuget.org/v3/index.json" rel="noopener ugc nofollow" target="_blank">https://api.nuget.org/v3/index.json</a></code>不要忘记替换API-key和appId参数的值。</p><p id="5c49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一切正常，您将看到如下消息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/b133bb796c5b027b4ef5cfee49f7fd44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cRTIypzn9VZK75r3ZTwrAQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">包发布成功</p></figure><p id="2d6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当点击nuget.org上的<code class="fe mz na nb nc b">Manage Packages</code>选项时，您将能够在列表中看到它，请注意，可能需要一些时间才能在已发布的列表中看到它，直到它仅出现在未列出的部分。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bc0f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用您的包</h1><p id="9c19" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在，这个包已经发布了，它是公开的并且正在工作，要把它添加到你的项目中，只需运行<code class="fe mz na nb nc b">dotnet add package RefitLogCalls version --1.0.0</code>你就可以在nuget.org的这个<a class="ae ky" href="https://www.nuget.org/packages/RefitLogCalls/#readme-body-tab" rel="noopener ugc nofollow" target="_blank">链接</a>上看到它。</p><p id="a8da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过访问nuget.org的<code class="fe mz na nb nc b">Manage Package</code>部分来编辑您的软件包，我在库中添加了一个README.me部分，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/065f2b3caeb8c2e5bb9d9cd42c67773f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*dNehK9OmP7hiSPib0K0Sjw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">README.md库部分</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3d0e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最终考虑</h1><p id="1a03" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果你想查看我用来构建这个包的代码，你可以在我的GitHub个人资料的这个库上看到。</p><p id="c567" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发布之后，我意识到我可以改进很多东西，比如名称空间模式和一些选项，只记录请求或响应，或者两者都记录，但是我肯定会在下一个版本中进行调整。</p><p id="f0ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望它能对你的项目有所帮助，我也希望你喜欢这篇文章，谢谢你的阅读，下次再见。</p></div></div>    
</body>
</html>