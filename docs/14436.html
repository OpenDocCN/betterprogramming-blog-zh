<html>
<head>
<title>Pulumi: The Ultimate Infrastructure As Code Tool</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pulumi:作为代码工具的终极基础设施</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/pulumi-the-ultimate-infrastructure-as-code-tool-8be5ae471a9c?source=collection_archive---------11-----------------------#2022-12-14">https://betterprogramming.pub/pulumi-the-ultimate-infrastructure-as-code-tool-8be5ae471a9c?source=collection_archive---------11-----------------------#2022-12-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2c7f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用Pulumi基于代码的方法转变基础设施管理</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/077a7f54a0746dff6b1ebf7fe03b6e7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6FAIUFC76H7nd1J8.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由Pulumi提供</p></figure><h1 id="787b" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">介绍</h1><p id="6370" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">基础设施代码(IaC)使用配置文件描述和提供基础设施，而不是通过web界面手动设置资源。这种方法有几个好处，包括可重复性、版本控制和协作。</p><p id="0f04" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">Pulumi是一个IaC工具，支持许多云提供商，包括AWS、Azure、Google Cloud和Kubernetes。它可用于管理基础设施和应用程序。</p><p id="1422" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我们将看看Pulumi是什么，它是如何工作的，以及为什么它对管理云资源如此有用。我还将提供一个代码示例，展示如何使用Pulumi部署一些AWS基础设施资源。</p><h1 id="5550" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">普鲁米是什么？</h1><p id="ea0d" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">Pulumi是一个开源的基础设施代码(IaC)平台，允许开发人员管理和部署云资源。它使开发人员能够使用他们熟悉的编程语言来定义他们的基础设施，包括Java、JavaScript/TypeScript、Python和Go。</p><p id="e206" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这意味着开发人员可以使用他们首选语言的全部功能，包括循环、条件和函数等功能，来清晰简洁地表达他们的基础设施，而不是用特定领域语言(DSL)编写模板，如Terraform或CloudFormation，或者通过web界面进行手动配置。</p><h1 id="9f4d" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">普鲁米是怎么工作的？</h1><p id="82de" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">如上所述，Pulumi允许开发人员使用他们选择的编程语言的代码来定义他们的基础设施。然后，这些代码被转换成特定于云的模板，并部署到所需的云提供商。</p><p id="196d" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">一旦部署了基础设施，Pulumi就会跟踪资源的当前状态，并可用于进行更改和更新。这是通过修改代码并像任何其他应用程序一样部署更改来完成的，然后Pulumi将这些更改应用于现有的基础设施。这使得协作和版本控制变得容易，因为基础设施可以像任何其他代码库一样对待。</p><p id="a061" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">除了管理基础设施，Pulumi还提供了部署和管理应用程序的工具。通过这种方式，您可以使用一个统一的平台来管理整个堆栈，从基础架构到代码。</p><h2 id="d2d8" class="mr kz it bd la ms mt dn le mu mv dp li lz mw mx lk md my mz lm mh na nb lo nc bi translated">大量</h2><p id="b21c" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">每个Pulumi程序都被部署到一个堆栈中。Pulumi栈用于管理开发过程的不同阶段。堆栈本质上是相关资源的集合，代表基础设施的特定部署。例如，您可能有一个堆栈用于生产环境，另一个堆栈用于暂存环境。</p><p id="d47e" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">堆栈对于组织和管理基础设施非常有用，因为它们允许您分别隔离和管理不同的部署。每个堆栈都有自己的配置和状态，可以使用Pulumi CLI进行管理。</p><p id="4a42" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">一个Pulumi项目可以有任意多的不同堆栈。例如，当处理一个特性分支时，你也可以创建一个新的堆栈。这样，您可以测试新的更改，而不会影响当前部署的资源。</p><h1 id="5714" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">普鲁米的好处</h1><h2 id="1190" class="mr kz it bd la ms mt dn le mu mv dp li lz mw mx lk md my mz lm mh na nb lo nc bi translated">使用熟悉的编程语言</h2><p id="6039" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">使用Pulumi的主要好处之一是它允许开发人员使用熟悉的编程语言来定义他们的基础设施。正如我已经提到的，Pulumi允许您使用您喜欢的编程语言的全部功能。随着时间的推移，这使得理解、维护和发展基础设施变得更加容易。</p><p id="38e9" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">Pulumi支持以下语言:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/da27f96933db87f835b41c8c737de4fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yR3flBeZDQcFQGbRh3fcSg.png"/></div></div></figure><h2 id="36f9" class="mr kz it bd la ms mt dn le mu mv dp li lz mw mx lk md my mz lm mh na nb lo nc bi translated">丰富的API</h2><p id="cb5b" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">Pulumi APIs是平台的关键部分，构建在Terraform之上。它们提供了开发人员可以用来管理和部署基础设施的工具和库。例如，开发人员可以使用Pulumi APIs来创建和配置AWS EC2实例、Azure虚拟机、Google云存储桶和许多其他资源。</p><p id="6daa" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这些API还支持常见的基础设施管理任务，例如创建和管理资源之间的依赖关系、定义访问控制策略以及监控所部署资源的健康状况和性能。在处理复杂的基础设施时，这可以节省时间和精力，使您能够专注于应用程序的业务逻辑，而不是底层基础设施。</p><p id="cd51" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">此外，与其他IaC平台相比，Pulumi APIs提供了更大的灵活性和控制能力。例如，开发人员可以使用API创建定制的资源类型，并定义他们自己的部署策略。这对于构建复杂的多云基础设施或者实现定制部署模式和最佳实践非常有用</p><h2 id="947e" class="mr kz it bd la ms mt dn le mu mv dp li lz mw mx lk md my mz lm mh na nb lo nc bi translated">与流行工具的集成</h2><p id="b3e3" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">Pulumi与Git、Slack和CI/CD系统等流行工具和服务无缝集成。这使得它可以轻松地适应现有的工作流和工具，并有助于改善团队成员之间的协作和协调。</p><h2 id="eaec" class="mr kz it bd la ms mt dn le mu mv dp li lz mw mx lk md my mz lm mh na nb lo nc bi translated">普鲁米CLI</h2><p id="b636" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">除了它的API和与流行工具的集成，Pulumi还提供了一个命令行界面(CLI ),允许开发人员管理他们的基础设施和配置。Pulumi CLI提供了一系列用于处理Pulumi项目的命令，包括用于创建、更新和删除资源以及用于管理机密、配置设置等的命令。</p><p id="fd36" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">Pulumi CLI还允许开发人员在部署之前预览他们的基础设施更改，并查看他们的基础设施的当前状态。这有助于降低错误和意外变更的风险，并对基础设施变更的影响提供有价值的见解。</p><p id="f8ad" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">下面是一个使用Pulumi CLI创建新堆栈、预览更改和部署堆栈的示例:</p><p id="258c" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">1.首先，使用<code class="fe ne nf ng nh b">pulumi new</code>命令创建一个新的Pulumi项目。这将为Pulumi项目创建一个包含必要文件和配置的新目录。</p><pre class="kj kk kl km gt ni nh nj bn nk nl bi"><span id="28a4" class="nm kz it nh b be nn no l np nq">pulumi new aws-typescript</span></pre><p id="982b" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">2.接下来，使用<code class="fe ne nf ng nh b">pulumi stack init</code>命令为您的项目创建一个新的堆栈。这将创建一个具有唯一名称的新堆栈，并允许您为堆栈指定配置选项。</p><pre class="kj kk kl km gt ni nh nj bn nk nl bi"><span id="474f" class="nm kz it nh b be nn no l np nq">pulumi stack init dev</span></pre><p id="12c4" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">3.在您为您的新堆栈配置并编写代码之后，您现在可以使用<code class="fe ne nf ng nh b">pulumi up</code>命令来预览将对您的基础设施做出的更改。这将向您显示将要进行的更改的摘要以及任何潜在的问题或冲突。</p><pre class="kj kk kl km gt ni nh nj bn nk nl bi"><span id="734b" class="nm kz it nh b be nn no l np nq">pulumi up -s dev</span></pre><p id="9f85" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">4.如果您对预览感到满意，可以从命令行选择“是”继续部署。一旦您将来对代码进行了任何更改，您可以再次运行该命令，向您显示将对现有堆栈进行的更改。</p><h1 id="dabf" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">代码示例</h1><p id="fe73" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">我将提供一个简单的例子，使用Pulumi框架和AWS SDK创建一个VPC和多个EC2实例。它演示了如何使用循环和数组函数来管理资源集合，以及如何导出值以在程序的其他地方使用。</p><p id="0017" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">以下示例创建了一个AWS虚拟私有云(VPC)和多个Amazon弹性计算云(EC2)实例:</p><pre class="kj kk kl km gt ni nh nj bn nk nl bi"><span id="fbc7" class="nm kz it nh b be nn no l np nq">import * as pulumi from "@pulumi/pulumi";<br/>import * as aws from "@pulumi/aws";<br/><br/>const vpc = new aws.ec2.Vpc("my-vpc", {<br/>    cidrBlock: "10.0.0.0/16",<br/>});<br/><br/>const instanceNames = ["web1", "web2", "web3"];<br/><br/>const instances = instanceNames.map(name =&gt; {<br/>    return new aws.ec2.Instance(name, {<br/>        instanceType: "t2.micro",<br/>        vpcId: vpc.id,<br/>        subnetId: vpc.publicSubnetIds[0],<br/>    });<br/>});<br/><br/>export const instanceIds = instances.map(instance =&gt; instance.id);</span></pre><p id="3375" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">首先，我们从<code class="fe ne nf ng nh b">@pulumi/pulumi</code>和<code class="fe ne nf ng nh b">@pulumi/aws</code>包中导入必要的模块开始。这些模块提供了对Pulumi框架和我们将使用的AWS云资源的访问。</p><p id="5636" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">接下来，我们使用<code class="fe ne nf ng nh b">aws.ec2.Vpc</code>类创建一个AWS VPC。这个VPC将用于托管EC2实例。VPC的<code class="fe ne nf ng nh b">cidrBlock</code>属性被设置为<code class="fe ne nf ng nh b">10.0.0.0/16</code>，它定义了VPC内使用的IP地址的范围。</p><p id="130e" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">然后我们创建一个实例名数组，它将用于我们将要创建的EC2实例。</p><p id="0453" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">最后，我们使用一个<code class="fe ne nf ng nh b">map()</code>函数遍历实例名，并为每个实例创建一个EC2实例。<code class="fe ne nf ng nh b">aws.ec2.Instance</code>类用于定义每个实例的属性，比如实例类型(<code class="fe ne nf ng nh b">t2.micro</code>)以及VPC和子网id。然后将结果实例添加到一个数组中，该数组作为<code class="fe ne nf ng nh b">instanceIds</code>导出，以便程序的其他部分可以访问它们。</p><p id="dd0f" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">现在，这是相同实现，但是是在云结构中:</p><pre class="kj kk kl km gt ni nh nj bn nk nl bi"><span id="cb98" class="nm kz it nh b be nn no l np nq">---<br/>AWSTemplateFormatVersion: '2010-09-09'<br/>Resources:<br/>  VPC:<br/>    Type: AWS::EC2::VPC<br/>    Properties:<br/>      CidrBlock: 10.0.0.0/16<br/><br/>  Web1:<br/>    Type: AWS::EC2::Instance<br/>    Properties:<br/>      InstanceType: t2.micro<br/>      VpcId: !Ref VPC<br/>      SubnetId: !GetAtt VPC.PublicSubnetIds[0]<br/><br/>  Web2:<br/>    Type: AWS::EC2::Instance<br/>    Properties:<br/>      InstanceType: t2.micro<br/>      VpcId: !Ref VPC<br/>      SubnetId: !GetAtt VPC.PublicSubnetIds[0]<br/><br/>  Web3:<br/>    Type: AWS::EC2::Instance<br/>    Properties:<br/>      InstanceType: t2.micro<br/>      VpcId: !Ref VPC<br/>      SubnetId: !GetAtt VPC.PublicSubnetIds[0]<br/><br/>Outputs:<br/>  InstanceIds:<br/>    Description: The IDs of the EC2 instances<br/>    Value:<br/>      - !Ref Web1<br/>      - !Ref Web2<br/>      - !Ref Web3</span></pre><p id="1149" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">如您所见，Pulumi代码比同等的Cloudformation语法更容易阅读、维护和更新(在我看来)。</p><h1 id="b297" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">结论</h1><p id="c5a3" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">Pulumi是一个使用熟悉的编程语言管理云资源的强大而方便的平台。然而，像任何技术一样，它也有其局限性和缺点。</p><p id="d991" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">例如，Pulumi是一个相对较新的平台，可能没有像Terraform这样更成熟的IaC工具那样得到相同水平的社区支持和采用。此外，因为它使用编程语言来定义基础设施，所以与其他使用声明性语言的IaC工具相比，它可能需要更多的专业知识和精力。</p><p id="d0a6" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">尽管有这些限制，Pulumi的无服务器架构、API的组合，以及与其他服务的集成，使其成为希望利用基础设施作为代码的好处的开发人员和组织的一个引人注目的选择。</p><p id="b0cf" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">无论是部署一个简单的web应用程序还是管理一个复杂的多云环境，Pulumi都拥有帮助您成功的工具和能力。尝试一下，看看它如何帮助您更有效地管理云资源。Pulumi会指导你完成一些很酷的小挑战，帮助你熟悉并开始使用他们的平台:<a class="ae nr" href="https://www.pulumi.com/challenge/" rel="noopener ugc nofollow" target="_blank">https://www.pulumi.com/challenge/</a></p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt ni nh nj bn nk nl bi"><span id="7f60" class="nm kz it nh b be nn no l nz nq"><strong class="nh iu">Want to Connect?</strong><br/><br/>You can reach me through my <a class="ae nr" href="https://www.michaelphamill.com/" rel="noopener ugc nofollow" target="_blank">website</a> where I have links to my other socials<br/>and a contact form. I am always happy to connect with new people!</span></pre></div></div>    
</body>
</html>