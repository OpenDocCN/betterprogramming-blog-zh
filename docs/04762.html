<html>
<head>
<title>A Guide to Deep Links in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">安卓深层链接指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/android-guide-for-app-deeplinks-aa5fb0e1514e?source=collection_archive---------1-----------------------#2020-05-07">https://betterprogramming.pub/android-guide-for-app-deeplinks-aa5fb0e1514e?source=collection_archive---------1-----------------------#2020-05-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="af7b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">它们是什么，我们怎样才能用好它们？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/22bdf9e6c822f91e24f6a73e2934c55b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nXYtp42VaUUdGG-YYhRWng.png"/></div></div></figure><p id="85d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Play Store中的每个应用程序在用户基础方面都达到了一定的水平，希望用户每天或每月都回来使用该应用程序。</p><p id="5ac3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这被称为<em class="lq">留存率，</em>这是应用程序筹集资金或做其他一些事情的关键因素，具体取决于它们的要求。</p><p id="242a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以基本上他们发送不必要的通知或消息来获得用户的关注。深层链接是一个重要的方面，让用户去一个特定的目的地，而不是通常的导航流。</p><p id="d4fd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Android上的深度链接推动了更好的用户体验。在本文中，让我们探索深层链接，以及我们如何在Android应用程序中实现它们。在开始实现之前，理解一些基本的东西是很重要的，比如它们是什么以及我们为什么需要它们。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="e0ae" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">什么是深度链接？</h1><p id="5a64" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">深层链接类似于我们日常使用的链接或URL。每个链接或URL用于将用户导航到某个特定的目的地。例如，让我们看看下面的URL:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="9fb6" class="na lz it mw b gy nb nc l nd ne">https://www.example.com/classes?lecture=10</span></pre><p id="018e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的链接是一个URL，它将你导航到<code class="fe nf ng nh mw b">example.com</code>域中的<code class="fe nf ng nh mw b">classes</code>页面，而不是域主页。</p><p id="a4b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，在这些术语中，Android深度链接是一种将用户导航到应用程序内特定目的地的URL。在Android中，我们添加了<em class="lq">意图过滤器</em>来定义特定页面的URL，我们从输入的意图中提取数据来驱动用户进行正确的活动。</p><p id="3e36" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">简单来说，Android深度链接只不过是将用户导航到应用程序的特定内容或特定页面的URL。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="e880" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">深层链接的构建模块</h1><p id="659e" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">URL是用于定义web端点的格式。对于Android，我们需要将URL分成几个部分来告诉系统处理特定的事情。让我们用Android术语检查一个示例URL:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="96a9" class="na lz it mw b gy nb nc l nd ne">https://www.sample.com/profile?id=1&amp;name=pavan</span></pre><ul class=""><li id="6bac" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nn no np nq bi translated"><code class="fe nf ng nh mw b">https</code>是一个<em class="lq">方案</em></li><li id="e7ec" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated"><code class="fe nf ng nh mw b">www.sample.com</code>是一台<em class="lq">主机</em></li><li id="856d" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated"><code class="fe nf ng nh mw b"><strong class="kw iu">/profile</strong></code>是一个<em class="lq">路径</em>，用于标识特定的页面或内容</li><li id="8c73" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated"><code class="fe nf ng nh mw b">?id=1&amp;name=pavan</code>是我们使用意图提取的<em class="lq">查询参数</em></li></ul><p id="ba6a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以上的东西，像主机、方案、路径、查询参数，都是在Android中建立深度链接需要的东西。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="adea" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">理解深层链接</h1><p id="bfcd" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">当用户点击深层链接时，Android系统会按顺序尝试每个操作，直到请求成功:</p><ol class=""><li id="e56b" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nw no np nq bi translated">打开可以处理URI的用户首选应用程序(如果已指定)。</li><li id="0a3b" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nw no np nq bi translated">打开唯一可用的可以处理URI的应用程序。</li><li id="7f40" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nw no np nq bi translated">允许用户从如下选项对话框中选择一个应用程序</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/037bea0cd3a3868c42ae113abfea9dff.png" data-original-src="https://miro.medium.com/v2/resize:fit:268/format:webp/1*LerJzZrUO1t5B218s8b12g.jpeg"/></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="cd63" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">如何处理意图过滤器</h1><p id="2356" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">意图过滤器是应用程序清单文件中的一个表达式，它指定组件希望接收的意图类型。在清单文件中设置一个<code class="fe nf ng nh mw b">&lt;intent-filter&gt;</code>作为入口点。</p><ol class=""><li id="ddaf" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nw no np nq bi translated">将动作定义为意图的<code class="fe nf ng nh mw b">ACTION_VIEW</code>,这样Google搜索就可以到达意图过滤器。</li></ol><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="1bd5" class="na lz it mw b gy nb nc l nd ne">&lt;<strong class="mw iu">action</strong> android:name="<strong class="mw iu">android.intent.action.VIEW</strong>" /&gt;</span></pre><p id="3c35" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">2.包括<code class="fe nf ng nh mw b"><a class="ae ny" href="https://developer.android.com/reference/android/content/Intent#CATEGORY_BROWSABLE" rel="noopener ugc nofollow" target="_blank">BROWSABLE</a></code>类别，以便可以从意图过滤器的网络浏览器访问它。没有它，在浏览器中点击链接就无法解析到你的应用。</p><p id="f378" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，包括<code class="fe nf ng nh mw b"><a class="ae ny" href="https://developer.android.com/reference/android/content/Intent#CATEGORY_DEFAULT" rel="noopener ugc nofollow" target="_blank">DEFAULT</a></code>类别，它允许你的应用程序响应隐含的意图。否则，只有在意向指定了您的应用程序组件名称时，活动才能开始。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="fdd0" class="na lz it mw b gy nb nc l nd ne">&lt;<strong class="mw iu">category</strong> android:name="<strong class="mw iu">android.intent.category.DEFAULT</strong>" /&gt;<br/>&lt;<strong class="mw iu">category</strong> android:name="<strong class="mw iu">android.intent.category.BROWSABLE</strong>" /&gt;</span></pre><p id="09f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">3.为意图过滤器添加一个<code class="fe nf ng nh mw b">data</code>标签。这个<code class="fe nf ng nh mw b">data</code>标签有<code class="fe nf ng nh mw b">host</code>、<code class="fe nf ng nh mw b">scheme</code>、<code class="fe nf ng nh mw b">path</code>和<code class="fe nf ng nh mw b">query</code>参数来标识链接。</p><p id="ab53" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">可以有多个<code class="fe nf ng nh mw b">data</code>标签。</p><p id="fc7d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">URL <code class="fe nf ng nh mw b">example://app/profile</code>的<code class="fe nf ng nh mw b">data</code>标签如下:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="e83f" class="na lz it mw b gy nb nc l nd ne">&lt;<strong class="mw iu">data</strong><br/>    android:<strong class="mw iu">host</strong>="app"<br/>    android:<strong class="mw iu">pathPrefix</strong>="/profile"<br/>    android:<strong class="mw iu">scheme</strong>="example" /&gt;</span></pre><p id="9db9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意:</strong>为目标<code class="fe nf ng nh mw b">Activity</code>设置<code class="fe nf ng nh mw b">android:launchMode="singleTask"</code>以避免同时启动活动的多个实例。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="a7f9" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">让我们创造一个深度链接</h1><p id="dd30" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">要构建一个深层链接，把上面步骤中的所有东西加在一起。以下XML片段显示了如何在清单中为深度链接指定意图筛选器。</p><p id="eefc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">URIs <code class="fe nf ng nh mw b">“app://sample/profile”</code>和<code class="fe nf ng nh mw b">“https://www.sample.com/profile”</code>都解析为一个活动。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="6504" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以使用带有多个<code class="fe nf ng nh mw b">data</code>标签的单个意图过滤器，但是为不同的URIs添加多个意图过滤器是一个很好的过程。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="5e63" class="na lz it mw b gy nb nc l nd ne">&lt;intent-filter&gt;<br/>  ...<br/>  &lt;data android:scheme="https" android:host="www.example.com" /&gt;<br/>  &lt;data android:scheme="app" android:host="open.my.app" /&gt;<br/>&lt;/intent-filter&gt;</span></pre><p id="9d0d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">看起来好像只支持<code class="fe nf ng nh mw b">https://www.example.com</code>和<code class="fe nf ng nh mw b">app://open.my.app</code>。但是，它实际上支持那两个加上这些:<code class="fe nf ng nh mw b">app://www.example.com</code>和<code class="fe nf ng nh mw b">https://open.my.app</code>。</p><p id="edf0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦我们通过URIs为你的应用清单添加了活动内容的意图过滤器，Android就能够在运行时将任何具有匹配URIs的<code class="fe nf ng nh mw b">Intent</code>路由到你的应用。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="2578" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">从传入意向中读取数据</h1><p id="00a0" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">一旦系统通过意图过滤器开始我们的活动，我们就可以使用意图提供的数据来确定我们需要呈现什么。调用<code class="fe nf ng nh mw b">getData()</code>和<code class="fe nf ng nh mw b">getAction()</code>方法来检索与传入意图相关的数据和动作</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="23d1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于<code class="fe nf ng nh mw b">id</code> <strong class="kw iu"> </strong>是强制参数，如果intent不包含数据，我们将通过调用<code class="fe nf ng nh mw b">finish()</code>来关闭活动实例。逻辑取决于需求。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="926f" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">如何测试深层链接</h1><p id="9234" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">我们可以使用Android Debug Bridge (adb) shell命令来检查深层链接是否流动，比如深层链接是否导航到正确的页面。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="dd47" class="na lz it mw b gy nb nc l nd ne">adb shell am start -a android.intent.action.VIEW -d "<strong class="mw iu">URI_SCHEME</strong>" <strong class="mw iu">package-name</strong></span></pre><p id="2598" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用上面的命令，通过用定义的URL替换<code class="fe nf ng nh mw b">URI_SCHEME</code>，用应用程序包名称替换<code class="fe nf ng nh mw b">package-name</code>，我们可以测试我们的实现。上述配置文件页面的命令是:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="8014" class="na lz it mw b gy nb nc l nd ne">adb shell am start -a android.intent.action.VIEW -d "<strong class="mw iu">app://sample/profile?id=1</strong>" <strong class="mw iu">com.sample</strong></span></pre><p id="b315" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，<code class="fe nf ng nh mw b">package-name</code>是一个可选属性。为了消除具有相同URI的不同应用程序之间的歧义，我们定义了<code class="fe nf ng nh mw b">package-name</code>。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="d73b" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">最佳实践</h1><ul class=""><li id="3729" class="ni nj it kw b kx mq la mr ld ob lh oc ll od lp nn no np nq bi translated">您需要有一个<strong class="kw iu">单独的深度链接活动</strong>来处理所有需要登录、完成入职等情况。隔离入口点将提供处理事情的灵活性，并提供更干净的代码来维护。</li><li id="2494" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">最好<strong class="kw iu">验证并呈现</strong>页面内容，因为目标页面是隐藏的，可能会有安全问题。最好在呈现页面之前进行验证</li><li id="58c5" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">如果应用程序有登录或入职功能，最好有一个<strong class="kw iu">重定向助手</strong>功能来维护导航。例如，如果用户点击一个链接并进入应用程序，假设他没有登录。还假设他试图访问的内容需要登录验证。首先，我们将目的地的详细信息存储在一个重定向函数中，并显示登录页面，在验证之后，使用重定向函数，我们需要将用户重定向到正确的目的地。</li></ul></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="4338" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">结论</h1><p id="97f8" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">目前就这些——希望你喜欢这篇文章。</p><p id="0489" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读！</p><h2 id="565d" class="na lz it bd ma oe of dn me og oh dp mi ld oi oj mk lh ok ol mm ll om on mo oo bi translated">参考</h2><ul class=""><li id="f9e8" class="ni nj it kw b kx mq la mr ld ob lh oc ll od lp nn no np nq bi translated"><a class="ae ny" href="https://developer.android.com/training/app-links/deep-linking" rel="noopener ugc nofollow" target="_blank">“创建应用内容的深层链接</a>”</li></ul></div></div>    
</body>
</html>