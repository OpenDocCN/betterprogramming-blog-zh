<html>
<head>
<title>4 Ways to Safely Access Nested Objects in Vanilla Javascript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在普通Javascript中安全访问嵌套对象的4种方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/4-ways-to-safely-access-nested-objects-in-vanilla-javascript-8671d09348a8?source=collection_archive---------2-----------------------#2019-09-07">https://betterprogramming.pub/4-ways-to-safely-access-nested-objects-in-vanilla-javascript-8671d09348a8?source=collection_archive---------2-----------------------#2019-09-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d4e2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何访问嵌套对象并编写更安全的代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e31163f752dec524e02bfa9b3478d057.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y2DYVpsxM8Wa2azG1izvcw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">布莱克·康纳利在<a class="ae ky" href="https://unsplash.com/search/photos/code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6ffc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您正在使用Javascript，您可能会遇到这样的情况:您必须访问一个深度嵌套的对象。如果一切顺利，您可以毫无问题地获得数据。太好了！</p><p id="78b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在现实中，我们并不总是保证数据<em class="lv">存在，</em>却错误地假设它存在<em class="lv">。</em>我曾多次处于这种境地，我经常发现自己在想:“这个值怎么可能不被填充呢？”</p><p id="5a3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，我们需要防止这些讨厌的错误的只是对<code class="fe lw lx ly lz b">undefined</code>值的额外检查。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="8d17" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">错误的例子</h1><p id="31cd" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">对于那些以前没有见过这种情况的人来说，这里有一个例子可以让你熟悉。假设我有一个JavaScript对象，代表我感兴趣的音乐艺术家。</p><pre class="kj kk kl km gt ne lz nf ng aw nh bi"><span id="1f15" class="ni mi it lz b gy nj nk l nl nm">const macAyres = {<br/>  tours: {<br/>    nearMe: {<br/>      sanFrancisco: {<br/>        date: 'Sun Oct 27',<br/>        location: 'The Regency Ballroom',<br/>        cost: '30.00',<br/>      },<br/>    },<br/>  }<br/>}</span></pre><p id="395b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我错误地认为这场音乐会在圣何塞举行，并希望检索(假想的)音乐会的地点，我可能会键入如下内容:</p><p id="e102" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lw lx ly lz b">const concertLocation = macAyres.tours.nearMe.sanJose.location;</code></p><p id="436e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于属性<code class="fe lw lx ly lz b">sanJose</code>不存在，上面的表达式类似于<code class="fe lw lx ly lz b">undefined.location</code>。当然，我们会遇到一个非常熟悉的错误；未捕获的类型错误:无法读取undefined的属性“type”。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="fe7a" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">1.用于检查空值/未定义值的三元运算符</h1><p id="bb94" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">处理这个问题最直接的方法是在试图访问其中的数据之前检查对象是否是<code class="fe lw lx ly lz b">null/undefined</code>。</p><pre class="kj kk kl km gt ne lz nf ng aw nh bi"><span id="1898" class="ni mi it lz b gy nj nk l nl nm">const concertCity = macAyres.tours.nearMe.sanJose<br/>const concertLocation = concertCity ? concertCity.location : undefined;</span></pre><p id="3d21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个选项可能是最容易实现和检查的。当对象嵌套不深时，这可能是一个很好的检查方法。</p><p id="811b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，当我们必须遍历更深的几层时，检查会变得非常复杂和重复。</p><pre class="kj kk kl km gt ne lz nf ng aw nh bi"><span id="65a8" class="ni mi it lz b gy nj nk l nl nm">const concertLocation = (macAyres.tours &amp;&amp;<br/>macAyres.tours.nearMe &amp;&amp;<br/>macAyres.tours.nearMe.sanJose) ? macAyres.tours.nearMe.sanJose.location : undefined;</span></pre><p id="e6b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有一个深度嵌套的对象，最后两种方法提供了一种更优雅的方式。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="ab38" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">2.奥利弗·斯蒂尔的嵌套对象访问模式</h1><p id="7245" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">这种访问值的方法类似于上一点中描述的方法。</p><p id="f90e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们没有使用<code class="fe lw lx ly lz b">&amp;&amp;</code>操作符来检查<code class="fe lw lx ly lz b">null/undefined</code>值，而是使用了<code class="fe lw lx ly lz b">||</code>操作符和一个空的对象文字。下面的例子将提供更多的清晰度。</p><pre class="kj kk kl km gt ne lz nf ng aw nh bi"><span id="ed90" class="ni mi it lz b gy nj nk l nl nm">const concertLocation = (macAyres.tours.nearMe.sanJose || {}).location;</span></pre><p id="e74c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于<code class="fe lw lx ly lz b">||</code>运算符中断返回遇到的真值，如果不是<code class="fe lw lx ly lz b">null/undefined</code>，上面的表达式将返回<code class="fe lw lx ly lz b">macAyres.tours.nearMe.sanJose</code>，否则返回<code class="fe lw lx ly lz b">{}</code>。</p><p id="332d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们将从一个空对象访问<code class="fe lw lx ly lz b">location</code>，而不是从<code class="fe lw lx ly lz b">undefined</code>，所以我们将避免得到错误。</p><p id="db00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还要注意，当<code class="fe lw lx ly lz b">||</code>操作符查找第一个遇到的<strong class="lb iu">真值时，我们<em class="lv">不应该</em>写这样一个表达式:</strong></p><pre class="kj kk kl km gt ne lz nf ng aw nh bi"><span id="e1bd" class="ni mi it lz b gy nj nk l nl nm">const concertLocation = ({} || macAyres.tours.nearMe.sanJose).location;</span></pre><p id="ea75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们将总是依靠<code class="fe lw lx ly lz b">{}</code>，因为它被认为是<br/>真值。如果你想了解更多关于逻辑操作符的知识，这篇文章提供了一个很好的纲要。</p><p id="4f3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与上面描述的方法类似，如果我们需要在每一步都使用<code class="fe lw lx ly lz b">||</code>操作符，那么即使是奥利弗·斯蒂尔的模式也会变得越来越难以理解。</p><p id="1782" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，下一个方法展示了如何利用强大的JavaScript函数来保持整洁。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="2be1" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">3.数组缩减</h1><p id="7818" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">这种方法要求你熟悉JavaScript的内置<code class="fe lw lx ly lz b">reduce </code>函数。如果你还不知道这个，这是一个很好的工具，你可以在Mozilla网站上了解更多。</p><p id="b483" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，<code class="fe lw lx ly lz b">reduce</code>对一个数组执行reducer函数并返回一个输出。你可以想象我们要处理的数组是一个包含了我们遍历对象的路径的数组。</p><p id="50ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用上面的示例数据结构，但是为了演示<code class="fe lw lx ly lz b">reduce</code>函数的能力，我们将假设每一级数据都没有得到保证。</p><pre class="kj kk kl km gt ne lz nf ng aw nh bi"><span id="0b5f" class="ni mi it lz b gy nj nk l nl nm">// Data Structure for recap<br/>const macAyres = {<br/>  tours: {<br/>    nearMe: {<br/>      sanFrancisco: {<br/>        date: 'Sun Oct 27',<br/>        location: 'The Regency Ballroom',<br/>        cost: '30.00',<br/>      },<br/>    },<br/>  }<br/>}</span><span id="f914" class="ni mi it lz b gy nn nk l nl nm">const paths = ['tours', 'nearMe', 'sanJose', 'location'];<br/>const location = paths.reduce((object, path) =&gt; {<br/>    return (object || {})[path]; // Oliver Steele's pattern</span><span id="8cb0" class="ni mi it lz b gy nn nk l nl nm">}, macAyres)</span></pre><p id="083d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意我们是如何整合之前所学的知识的！如果您不喜欢使用Oliver Steele模式，三元运算符检查也很好。</p><p id="b941" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种访问值的方式是我个人最喜欢的方式之一，因为它保持了高度的可读性和干爽性，即使对象嵌套很深。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="18fd" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">4.带有ES6箭头功能的Try/Catch辅助功能</h1><p id="925c" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">我正在做一些研究，无意中发现了这个<a class="ae ky" href="https://stackoverflow.com/questions/14782232/how-to-avoid-cannot-read-property-of-undefined-errors/42349521" rel="noopener ugc nofollow" target="_blank">堆栈溢出帖子</a>，我认为它真的很棒！</p><p id="69a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我以前没有使用过这种方法，但是这种简洁的方法可以作为一种实用的方法来实现，并且更加可重用。写完这一点，我怀疑我可能真的最喜欢这个了。</p><pre class="kj kk kl km gt ne lz nf ng aw nh bi"><span id="d010" class="ni mi it lz b gy nj nk l nl nm">// Code Snippet taken from the post<br/>function getSafe(fn, defaultVal) {<br/>    try {<br/>        return fn();<br/>    } catch (e) {<br/>        return defaultVal;<br/>    }<br/>}<br/><br/>// use it like this<br/>getSafe(() =&gt; obj.a.lot.of.properties);<br/><br/>// or add an optional default value<br/>getSafe(() =&gt; obj.a.lot.of.properties, 'nothing');</span></pre></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="883b" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">结论</h1><p id="e4cf" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">这四种方法可以用来编写更安全的代码，并避免出现破坏代码的讨厌错误。</p><p id="d2ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然有一些库可以帮助您克服这一点，但是如果您想要一种简单快捷的方法，您可能会考虑这些普通的JavaScript方法。</p><p id="6830" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我希望您能从这篇文章中获得一些有用的东西。这是我第一次写技术文章，我希望人们能从中发现价值。</p></div></div>    
</body>
</html>