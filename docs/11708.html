<html>
<head>
<title>How to Create a Blockchain Using Node.js: A Step-by-Step Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Node.js创建区块链:分步指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-blockchain-with-node-js-e65dfc40479e?source=collection_archive---------1-----------------------#2022-04-11">https://betterprogramming.pub/create-blockchain-with-node-js-e65dfc40479e?source=collection_archive---------1-----------------------#2022-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f1cf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用Node.js创建区块链对等网络。该分步指南涵盖了从创建基本P2P网络到设置名称-值数据库和创建API的所有内容。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5325091d0e0bc2e40504ed0e3f5ae153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E1bgqOohocb6i6IUPgUFsw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自Unsplash</p></figure><p id="92ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本实用指南中，我们将探索使用Node.js创建全功能区块链原型背后的代码。我们的示例旨在让想要了解区块链技术的人易于理解。到本文结束时，您将对如何创建P2P网络、发送和接收块以及建立名称-值数据库有更好的理解。无论你是初学者还是有经验的开发者，本指南将帮助你掌握区块链技术的基础。</p><h1 id="b5d2" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">涵盖的主题</h1><ol class=""><li id="624d" class="mm mn it la b lb mo le mp lh mq ll mr lp ms lt mt mu mv mw bi translated">创建一个基本的P2P网络</li><li id="a307" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated">发送和接收块</li><li id="af86" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated">注册矿工和创建新区块</li><li id="db72" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated">设置名称-值数据库，LevelDB</li><li id="5214" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated">创建公私钱包</li><li id="b35d" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated">创建API</li><li id="7dfe" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated">创建命令行界面</li></ol><h1 id="803a" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">创建一个基本的P2P网络</h1><p id="b5b9" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">对等网络是一种使用分布式体系结构的计算机网络。在这样的网络中，每个对等体或节点分担工作负载，并且与其他对等体平等，没有任何特权对等体。</p><p id="6b3d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们创建一个文件夹，命名为<code class="fe nf ng nh ni b">Blockchain</code>。</p><p id="bfae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您的代码需要找到并连接对等点，部署用于发现其他对等点的服务器，并获得可用的TCP端口。这是通过利用以下三个库来实现的:</p><ul class=""><li id="1f7b" class="mm mn it la b lb lc le lf lh nj ll nk lp nl lt nm mu mv mw bi translated"><code class="fe nf ng nh ni b">discovery-swarm</code>:用于使用发现信道连接到网络中的对等体</li><li id="2802" class="mm mn it la b lb mx le my lh mz ll na lp nb lt nm mu mv mw bi translated"><code class="fe nf ng nh ni b">dat-swarm-defaults</code>:部署帮助识别其他潜在对等体的服务器</li><li id="398d" class="mm mn it la b lb mx le my lh mz ll na lp nb lt nm mu mv mw bi translated"><code class="fe nf ng nh ni b">get-port</code>:检索可用的TCP端口</li></ul><p id="2df1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要安装这些库，请运行以下命令:</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="2132" class="nr lv it ni b gy ns nt l nu nv">npm install crypto discovery-swarm dat-swarm-defaults get-port@5.1.1 --save</span></pre><p id="8974" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在库已经安装好了，你需要创建一个文件并命名为<code class="fe nf ng nh ni b">p2p.js</code>。在这个文件中，您需要编写以下代码。如果你愿意，你可以复制下面的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">p2p.js</p></figure><p id="0d9c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">打开两个终端窗口，并导航到资料库的位置。在两个终端窗口中，键入以下命令:</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="336e" class="nr lv it ni b gy ns nt l nu nv">node p2p.js</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/fd91d01054204638d82dd1469b73fe62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lC443u0Difc7mRmEXaj_mw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">输出p2p</p></figure><p id="8a02" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从上面的代码中可以看出，当您的机器发现网络上的其他对等机时，它会生成一个随机的对等机ID并选择一个随机的端口。这样，你就和其他用户连接到了一个P2P网络。发送和接收块</p><h2 id="ad8c" class="nr lv it bd lw nz oa dn ma ob oc dp me lh od oe mg ll of og mi lp oh oi mk oj bi translated">创建起源块和共享块</h2><p id="2466" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">块对象在不同的区块链模型中有所不同；出于本教程的目的，您将使用一个类似于比特币网络中使用的Block对象。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/8cf89e5e4f95e1cc966f994b2cec28a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WprTXXgvqQcLdvEQSRBDWA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阻塞流</p></figure><p id="6ac5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">块对象具有以下属性:</p><ul class=""><li id="044b" class="mm mn it la b lb lc le lf lh nj ll nk lp nl lt nm mu mv mw bi translated"><code class="fe nf ng nh ni b">index</code>:链中的第一个块称为GenesisBlock，其索引为0。</li><li id="6d44" class="mm mn it la b lb mx le my lh mz ll na lp nb lt nm mu mv mw bi translated"><code class="fe nf ng nh ni b">txns</code>:这是块内的交易数据。你可以把它想象成你想要存储的任何类型的数据。</li></ul><p id="ddf1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Block对象包含BlockHeader对象，具有以下属性:</p><ul class=""><li id="71fa" class="mm mn it la b lb lc le lf lh nj ll nk lp nl lt nm mu mv mw bi translated">版本:block有四个版本，genesis block是2009年的版本1。版本2是2012年的比特币核心0.7.0的软叉，而版本3块是2015年的比特币核心0.10.0的软叉。版本4块，是2015年比特币核心0.11.2中的BIP65，是最新的。</li><li id="ae24" class="mm mn it la b lb mx le my lh mz ll na lp nb lt nm mu mv mw bi translated">前一个块头哈希:这是前一个块头的SHA-256(安全哈希算法)哈希函数。它确保了前一个块不会被修改，因为这个块需要修改。</li><li id="f976" class="mm mn it la b lb mx le my lh mz ll na lp nb lt nm mu mv mw bi translated">Merkle root hash:它是Merkle树中所有键值对的散列。对树进行哈希处理，使得每个键值对都是唯一的，并且使用整个哈希来标识树。</li><li id="0570" class="mm mn it la b lb mx le my lh mz ll na lp nb lt nm mu mv mw bi translated">时间:这是矿工开始散列头部的Unix纪元时间。</li></ul><p id="e03f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如你所知，比特币有一个“困难”属性，矿工需要每2016块重新计算一次。记住这一点，您就不需要对PoW使用nBits和nounce参数。</p><ul class=""><li id="4707" class="mm mn it la b lb lc le lf lh nj ll nk lp nl lt nm mu mv mw bi translated">nounce:它是矿工用来调整一个块的散列值，使它小于或等于当前目标值的数字。这个数字是32位或4个字节。</li><li id="4bd6" class="mm mn it la b lb mx le my lh mz ll na lp nb lt nm mu mv mw bi translated">nBits:这是目标，是一个256位的数字，和难度成反比。每隔2016个块重新计算一次。</li></ul><p id="d501" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">P2P通信包括每个对等体从网络上的对等体请求最新的块，然后接收块请求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/d448ffb9da5b61c655ccc3cb5e5f3673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pk_n1VpDOMpP52ns0tGJ9Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">P2P通信请求最新块和接收最新块的流程图</p></figure><p id="43e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在您已经了解了P2P网络的工作原理，您已经准备好开始发送和请求块了。</p><h2 id="3b1e" class="nr lv it bd lw nz oa dn ma ob oc dp me lh od oe mg ll of og mi lp oh oi mk oj bi translated">P2P网络发送块</h2><p id="a46b" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated"><strong class="la iu">设置块类和链库</strong></p><p id="3989" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">区块链需要两个文件:<code class="fe nf ng nh ni b">block.js</code>和<code class="fe nf ng nh ni b">chain.js</code>。<code class="fe nf ng nh ni b">block.js</code>包含块类的代码，<code class="fe nf ng nh ni b">chain.js</code>有与块交互的方法。至于Block对象，您将希望创建类似于比特币核心中的属性。如果你不确定Block和BlockHeader对象应该是什么样子，看看<code class="fe nf ng nh ni b">block.js</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">block.js</p></figure><p id="1b86" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，<code class="fe nf ng nh ni b">chain.js</code>包含第一个块，它被称为genesis块。此外，该方法可用于接收整个区块链对象、添加新块或检索特定块。值得一提的是，为了节省Unix时间格式的时间，您需要安装<code class="fe nf ng nh ni b">moment</code>库。这可以通过使用npm来实现。</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="8bb9" class="nr lv it ni b gy ns nt l nu nv">npm install moment --save</span></pre><p id="31dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在创建<code class="fe nf ng nh ni b">chain.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">链家网</p></figure><p id="ac52" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们有了一个包含在<code class="fe nf ng nh ni b">chain.js</code>中的block对象，我们的库可以创建一个genesis block并向您的区块链对象添加一个block。此外，我们将能够发送和请求块。要使用<code class="fe nf ng nh ni b">p2p.js</code>中的<code class="fe nf ng nh ni b">chain.js</code>，只需遵循以下步骤:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">p2p.js</p></figure><h1 id="9f65" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">注册矿工和创建新区块</h1><p id="84f1" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">截至目前，我们有一个工作的P2P网络，我们可以连接网络内的对等点，创建一个genesis块，并交换块。</p><p id="f0e6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下一步是启用新块的生成。我们将采用利益证明(PoS)方法，通过这种方法，我们相信每个采矿者都会生成区块。每个对等体将注册为一个矿工，轮流开采区块。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/c9a5daec446823eec30312eead305e43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IQOeGcw-9Mp6Ug0bB8HMFg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您的区块链使用简单的PoS机制处理采矿</p></figure><p id="d1c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要每隔X分钟自动生成一个块，可以使用Node.js cron库。这个库类似于自动化任务的Linux库。要安装cron开源库，请运行以下命令:</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="723c" class="nr lv it ni b gy ns nt l nu nv">npm install cron --save</span></pre><p id="2be9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在您的p2p.js文件中，您将创建两个变量:一个跟踪注册的矿工，另一个跟踪谁开采了最后一个区块。这将允许您将下一个块分配给下一个矿工。</p><pre class="kj kk kl km gt nn ni om bn on oo bi"><span id="4fc3" class="op lv it ni b be oq or l os nv">let registeredMiners = [];<br/>let lastBlockMinedBy = null;</span></pre><p id="1f5c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您还将添加两种消息类型。</p><ul class=""><li id="7b94" class="mm mn it la b lb lc le lf lh nj ll nk lp nl lt nm mu mv mw bi translated"><code class="fe nf ng nh ni b">REQUEST_ALL_REGISTER_MINERS</code></li><li id="f4ce" class="mm mn it la b lb mx le my lh mz ll na lp nb lt nm mu mv mw bi translated"><code class="fe nf ng nh ni b">REGISTER_MINER</code></li></ul><pre class="kj kk kl km gt nn ni om bn on oo bi"><span id="8afb" class="op lv it ni b be oq or l os nv">let MessageType = { <br/>    REQUEST_BLOCK: ‘requestBlock’, <br/>    RECEIVE_NEXT_BLOCK: ‘receiveNextBlock’, <br/>    RECEIVE_NEW_BLOCK: ‘receiveNewBlock’,                        REQUEST_ALL_REGISTER_MINERS: ‘requestAllRegisterMiners’,<br/>    REGISTER_MINER: ‘registerMiner’ <br/>};</span></pre><p id="b980" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在您将自己的同事注册为矿工之前，您需要请求网络中所有现有注册矿工的列表。这可以通过运行定时器每五秒更新一次你的矿工名单来实现。一旦有了所有现有矿工的列表，就可以在<code class="fe nf ng nh ni b"><em class="ot">registeredMiners</em></code>对象中添加自己的同伴作为矿工。</p><pre class="kj kk kl km gt nn ni om bn on oo bi"><span id="6500" class="op lv it ni b be oq or l os nv">setTimeout(function(){ <br/>  writeMessageToPeers(MessageType.REQUEST_ALL_REGISTER_MINERS, null); <br/>}, 5000);</span></pre><p id="7775" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，它有了一个自动超时命令，可以指向一个处理程序来更新注册矿工的列表，你也可以自动执行一个命令来将你的同伴注册为矿工；</p><pre class="kj kk kl km gt nn ni om bn on oo bi"><span id="1b74" class="op lv it ni b be oq or l os nv">setTimeout(function(){ <br/>  registeredMiners.push(myPeerId.toString(‘hex’));<br/>  console.log(‘ — — — — — Register my miner — — — — — — — ‘); <br/>  console.log(registeredMiners); <br/>  writeMessageToPeers(MessageType.REGISTER_MINER, registeredMiners); <br/>  console.log(‘ — — — — — Register my miner — — — — — — — ‘); <br/>}, 7000);</span></pre><p id="7a73" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在switch命令中，修改代码，以便能够为关于矿工注册的传入消息设置处理程序。我们希望跟踪已注册的矿工，并在开采新的区块时处理消息。</p><pre class="kj kk kl km gt nn ni om bn on oo bi"><span id="8424" class="op lv it ni b be oq or l os nv">case MessageType.REQUEST_ALL_REGISTER_MINERS: <br/>  console.log(‘ — — — — — -REQUEST_ALL_REGISTER_ MINERS — — — — — — — ‘ + message.to); <br/>  writeMessageToPeers(MessageType.REGISTER_MINER, registeredMiners);    <br/>  registeredMiners = JSON.parse(JSON.stringify(message. data)); <br/>  console.log(‘ — — — — — -REQUEST_ALL_REGISTER_ MINERS — — — — — — — ‘ + message.to); <br/>break;</span></pre><pre class="ou nn ni om bn on oo bi"><span id="de2c" class="op lv it ni b be oq or l os nv">case MessageType.REGISTER_MINER: <br/>  console.log(‘ — — — — — -REGISTER_MINER — — — — — — — ‘ + message.to); <br/>  let miners = JSON.stringify(message.data); <br/>  registeredMiners = JSON.parse(miners);<br/>  console.log(registeredMiners);  <br/>  console.log('----------- REGISTER_MINER------------- ' + message.to);  <br/>break;</span></pre><p id="7149" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦与miner的连接关闭或丢失，您还需要注销miner。</p><pre class="kj kk kl km gt nn ni om bn on oo bi"><span id="5545" class="op lv it ni b be oq or l os nv">console.log(`Connection ${seq} closed, peerId: ${peerId}`);</span></pre><pre class="ou nn ni om bn on oo bi"><span id="b831" class="op lv it ni b be oq or l os nv">if (peers[peerId].seq === seq) { <br/>  delete peers[peerId]; <br/>  console.log('— — registeredMiners before: ' + JSON.stringify(registeredMiners)); <br/>    let index = registeredMiners.indexOf(peerId); <br/>    if (index &gt; -1) <br/>        registeredMiners.splice(index, 1); <br/>        console.log('— — registeredMiners end: '+ <br/>        JSON.stringify(registeredMiners));<br/> } <br/>});</span></pre><p id="5987" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">矿山新区块</strong></p><p id="9874" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与比特币每10分钟生成一个区块相反，你的区块链将得到改善，每30秒生成一个区块。为了实现这一点，您已经为Node.js安装了开源cron库。您可以利用<strong class="la iu"> cron </strong>库来设置再次调用相同代码的频率，这将用于每30秒调用您的矿工。</p><p id="5657" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，首先在代码的import语句中把这个库包含在<code class="fe nf ng nh ni b">p2p.js</code>文件的顶部。接下来，您设置一个每30秒运行一次的cronjob，<code class="fe nf ng nh ni b">job.start();</code>将启动该作业，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="1c59" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">添加完以上所有功能后，你的<code class="fe nf ng nh ni b">p2p.js</code>文件将会是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">p2p.js</p></figure><h1 id="bdd4" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">设置名称-值数据库，LevelDB</h1><p id="96c1" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">LevelDB数据库以向上和向下的方式存储名称-值对。这是区块链网络的理想选择。事实上，比特币使用LevelDB不仅存储块信息，还存储交易信息。要使用它，请安装带有npm的<code class="fe nf ng nh ni b">level</code>。</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="f8a4" class="nr lv it ni b gy ns nt l nu nv">npm install level --save</span></pre><p id="3bfb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，创建一个保存数据库的目录。</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="203e" class="nr lv it ni b gy ns nt l nu nv">mkdir db</span></pre><p id="9139" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在可以实现数据库了。在<code class="fe nf ng nh ni b">chain.js</code>中，添加一些代码来保存LevelDB数据库中的块。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">链家网</p></figure><p id="29ae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，在您的<code class="fe nf ng nh ni b">p2p.js</code>文件中，您需要做的就是在启动代码后创建一个数据库。</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="cca1" class="nr lv it ni b gy ns nt l nu nv">chain.createDb(myPeerId.toString(‘hex’));</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/a20b196345138fac9a9874f195462ff6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*64bh_4SQJyYSQpypqIsfaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在p2p.js中添加createDb</p></figure><h1 id="0856" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">创建公私钱包</h1><p id="6b44" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">在加密货币中，为了奖励矿工生成区块，以及创建和发送交易，钱包是必要的。在本节中，您将通过生成公钥和私钥的组合来创建一个钱包。这不仅可以验证用户，还允许您存储和检索用户拥有的数据。</p><p id="c660" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您将使用一个椭圆曲线加密库实现来生成私钥-公钥组合。注意，椭圆曲线库使用secp256k1作为ECDSA曲线算法。要安装它，请运行以下命令:</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="94df" class="nr lv it ni b gy ns nt l nu nv">npm i elliptic --save</span></pre><p id="d5ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建一个新文件<code class="fe nf ng nh ni b">wallet.js</code>并复制下面的代码，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="8ad8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，创建一个wallet目录来存储私钥并运行脚本。该代码将初始化脚本并创建您的公钥。</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="b145" class="nr lv it ni b gy ns nt l nu nv">mkdir wallet<br/>node wallet.js<br/>cat wallet/private_key</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/981b9f1fa7682f6ad7b6fd1d7a7a08bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eY22QYj2mDBH0El9kMn4ww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">输出私钥</p></figure><blockquote class="ox oy oz"><p id="c1ed" class="ky kz ot la b lb lc ju ld le lf jx lg pa li lj lk pb lm ln lo pc lq lr ls lt im bi translated">记住注释掉<code class="fe nf ng nh ni b">wallet.js</code>的最后32到34行，因为在下一步中，您将创建一个API来通过浏览器创建您的密钥。</p></blockquote><h1 id="7335" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">创建API</h1><p id="31e7" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">下一步是创建一个应用程序接口(API ),以便能够访问您编写的代码。这是区块链的重要组成部分，因为它允许您使用HTTP服务访问您的区块和钱包或任何其他P2P网络操作。</p><p id="af78" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您需要安装express和body-parser。这些库将允许您创建服务器并在浏览器中显示页面。</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="2ed6" class="nr lv it ni b gy ns nt l nu nv">npm install express body-parser — save</span></pre><p id="3937" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在打开你的<code class="fe nf ng nh ni b">p2p.js</code>文件并跟着做，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="4b49" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要调用您的服务，运行P2P网络，</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="a070" class="nr lv it ni b gy ns nt l nu nv">node p2p.js</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/482cd91d7bde0cfc05dc1c91587a05c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VYXx7W-bBQWxzI_L_E3dPg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">p2p.js输出</p></figure><p id="ba65" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，打开浏览器并调用API，</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="3477" class="nr lv it ni b gy ns nt l nu nv"><a class="ae pe" href="http://localhost:8001/getWallet" rel="noopener ugc nofollow" target="_blank">http://localhost:8001/b</a>locks<br/><a class="ae pe" href="http://localhost:8001/getWallet" rel="noopener ugc nofollow" target="_blank">http://localhost:8001/getB</a>lock<br/><a class="ae pe" href="http://localhost:8001/getWallet" rel="noopener ugc nofollow" target="_blank">http://localhost:8001/getD</a>BBlock<br/><a class="ae pe" href="http://localhost:8001/getWallet" rel="noopener ugc nofollow" target="_blank">http://localhost:8001/getWallet</a></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/439d40ae62f0716536de5ca060513860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EJAfDIE6IKTbFMpt3xZm5g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在浏览器中调用/阻止API</p></figure><h1 id="4a34" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">创建命令行界面</h1><p id="92ae" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">对于本文的最后一步，您将创建一个命令行界面(CLI)。需要CLI来轻松访问您创建的服务。</p><p id="47d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，安装您将用来运行promises、运行async函数、向控制台添加颜色和存储cookies的库。</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="5979" class="nr lv it ni b gy ns nt l nu nv">npm i babel-polyfill async update-notifier handlebars colors nopt --save</span></pre><p id="595a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为命令创建一个新目录<code class="fe nf ng nh ni b">cli</code>和另一个目录<code class="fe nf ng nh ni b">cmds</code></p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="d0b0" class="nr lv it ni b gy ns nt l nu nv">mkdir cli<br/>cd cli<br/>mkdir cmds<br/>touch block.js help.js version.js wallet.js</span></pre><p id="dea8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe nf ng nh ni b">block.js</code>中，您将设置两个命令:get和all，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">block.js cli</p></figure><p id="4dcc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，<code class="fe nf ng nh ni b">wallet.js</code>将包含get和all方法，指向一个curl命令来运行HTTP服务调用，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">wallet.js cli</p></figure><p id="fe70" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">同样，我们将为其他人做请遵循这个<a class="ae pe" href="https://github.com/ac12644/Blockchain/tree/main/cli" rel="noopener ugc nofollow" target="_blank">链接</a>。从给定的链接中复制代码。</p><p id="db67" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，创建一个目录<code class="fe nf ng nh ni b">bin</code>并添加<code class="fe nf ng nh ni b">cli.js</code>，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="9576" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">既然已经设置了命令，就可以将CLI作为别名添加到bash_profile中，以便能够从任何路径位置运行CLI。</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="f9e9" class="nr lv it ni b gy ns nt l nu nv">nano .bash_profile</span><span id="0b94" class="nr lv it ni b gy pg nt l nu nv">alias cli='node /&lt;location&gt;/Blockchain/bin/cli.js'</span></pre><p id="7d25" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">按<code class="fe nf ng nh ni b">ctrl+o</code>保存，按<code class="fe nf ng nh ni b">ctrl+X</code>退出，然后运行bash_profile，</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="70ff" class="nr lv it ni b gy ns nt l nu nv">. ~/.bash_profile</span></pre><p id="cd76" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">万岁！！我们的命令行界面准备好了😃，我们来测试一下，</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="e71c" class="nr lv it ni b gy ns nt l nu nv">node p2p.js</span></pre><p id="079d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">打开另一个终端并运行，</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="bf17" class="nr lv it ni b gy ns nt l nu nv">cli block --get [port] 1 <br/>cli block –all [port] <br/>cli wallet --create [port]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/c1cd254e094c5e200c2d8758358cdf3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pwXFXoZRNpx_TrpUY1VpSA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">cli界面输出</p></figure><h2 id="f9bb" class="nr lv it bd lw nz oa dn ma ob oc dp me lh od oe mg ll of og mi lp oh oi mk oj bi translated">祝贺👏我们创造了自己的区块链🔥🔥🔥🔥</h2><h1 id="305c" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">摘要</h1><p id="c3c7" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">在这篇文章中，我们介绍了如何创建自己的基本P2P区块链网络；您可以发送和接收消息，并在这些消息中包含块；您能够注册和注销矿工，并实现一个简单的PoS共识机制；您创建了新的块并在对等体之间发送它们；您还设置了一个名称-值LevelDB数据库来存储块；您继续创建了一个由私钥-公钥对组成的钱包。最后，您创建了通过API服务和CLI与P2P网络通信的方法。</p><pre class="kj kk kl km gt nn ni no np aw nq bi"><span id="7aa1" class="nr lv it ni b gy ns nt l nu nv"><strong class="ni iu">Want to Connect?</strong></span><span id="ce67" class="nr lv it ni b gy pg nt l nu nv">For the full code visit and if you like it, follow me on GitHub:<br/><a class="ae pe" href="https://github.com/ac12644/Blockchain" rel="noopener ugc nofollow" target="_blank">https://github.com/ac12644/Blockchain</a></span></pre></div><div class="ab cl pi pj hx pk" role="separator"><span class="pl bw bk pm pn po"/><span class="pl bw bk pm pn po"/><span class="pl bw bk pm pn"/></div><div class="im in io ip iq"><p id="8ed0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="ot">感谢阅读！</em></p><p id="a27e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="ot">同样检查:</em></p><div class="pp pq gp gr pr ps"><a rel="noopener  ugc nofollow" target="_blank" href="/implementing-smart-contracts-using-vyper-a-python-approach-95f9299e64d8"><div class="pt ab fo"><div class="pu ab pv cl cj pw"><h2 class="bd iu gy z fp px fr fs py fu fw is bi translated">使用Vyper实现智能合约——Python方法</h2><div class="pz l"><h3 class="bd b gy z fp px fr fs py fu fw dk translated">探索如何使用Vyper编程语言而不是Solidity编写智能合同</h3></div><div class="qa l"><p class="bd b dl z fp px fr fs py fu fw dk translated">better编程. pub</p></div></div><div class="qb l"><div class="qc l qd qe qf qb qg ks ps"/></div></div></a></div></div></div>    
</body>
</html>