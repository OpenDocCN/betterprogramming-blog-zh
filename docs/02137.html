<html>
<head>
<title>An Introduction to Property Wrappers in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift中的属性包装器简介</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/property-wrappers-in-swift-657bead85501?source=collection_archive---------11-----------------------#2019-11-08">https://betterprogramming.pub/property-wrappers-in-swift-657bead85501?source=collection_archive---------11-----------------------#2019-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b40f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">它们是什么，我们如何使用它们？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6055025da0f35505b38a3f338fc2f460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UIr8pnzGJW3Wp6cIB5t08A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2520855" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/Mysticsartdesign-322497/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2520855" rel="noopener ugc nofollow" target="_blank">神秘艺术设计</a></p></figure><p id="1f64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很久以前，在魔法和壮丽的世界里，矮人正在和兽人战斗。兽人比矮人强大得多，因此赢得这场战斗的唯一方法就是向黑暗精灵寻求帮助。</p><p id="8d03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">精灵有一种叫做<code class="fe lv lw lx ly b">propertyWrapper</code>的秘密武器，可以让任何生物长生不老。</p><p id="aa64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个故事将告诉你永生的本质。</p><p id="83e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，理解属性包装器只是语法糖，编译器能够将其翻译成更详细的代码是有好处的。</p><p id="11e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们来定义永生:它是一种从致命攻击中恢复的能力。</p><p id="123f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑下面的代码片段。这是矮人的数据结构，他们有一个<code class="fe lv lw lx ly b">health</code>属性和<code class="fe lv lw lx ly b">attacked(by:)</code>方法。每当<code class="fe lv lw lx ly b">health</code>变为零，这就意味着矮人被杀。按照以前对永生的定义，我们可以假设它意味着健康不应该小于或等于零。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">凡人侏儒的例子</p></figure><p id="9f0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用这样的方法，矮人肯定会输掉这场战斗。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="22a1" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">包装价值</h1><p id="5a1a" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">矮人要求得到以坚不可摧而闻名的武器。因此，让我们用精灵给的超级武器来解决它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">包装值示例</p></figure><p id="2294" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查最后一行——矮人现在好像刀枪不入。</p><p id="899f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来整理一下:</p><ul class=""><li id="44c2" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated"><strong class="lb iu">第3行:</strong>我们正在定义我们的支持变量。这实际上是一个变量，当你与<code class="fe lv lw lx ly b">Dwarf</code>结构交互时，你认为你正在处理这个变量。</li><li id="3d3f" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">第5行:我们正在定义一个初始化式。是的，属性包装可以有初始化器。这里棘手的部分是如何调用这个初始化器。基本上，当您通过<code class="fe lv lw lx ly b">Dwarf(health: 10)</code>在默认成员方式初始化器中为<code class="fe lv lw lx ly b">health</code>属性赋值时，这将转化为<code class="fe lv lw lx ly b">Immortal(wrappedValue: 10)</code>。</li><li id="a4d7" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><strong class="lb iu">第9–14行:</strong> <code class="fe lv lw lx ly b">@propertyWrapper</code>结构要求你定义一个<code class="fe lv lw lx ly b">wrappedValue</code>属性，它实际上是你用<code class="fe lv lw lx ly b">health</code>变量操作时的一个入口点。熟悉getter中的特殊行为，我们不允许支持值小于1。</li><li id="c1bf" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><strong class="lb iu">第17–28行:</strong>我们已经用特殊的超级武器定义了一个<code class="fe lv lw lx ly b">health</code>属性，也被称为注释<code class="fe lv lw lx ly b">@Immortal</code>。它显示这个变量由一个名为<code class="fe lv lw lx ly b">Immortal</code>的属性包装器支持。这就意味着，每当兽人攻击矮人时，<code class="fe lv lw lx ly b">health</code>变量会将伤害分配给<code class="fe lv lw lx ly b">wrappedValue</code>变量，让<code class="fe lv lw lx ly b">health</code>变得刀枪不入。</li></ul></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="af0e" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">预计价值</h1><p id="2d02" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">如果你认为这是故事的结尾，那么不。精灵们并不慷慨，他们对黄金真的很慎重。这就是为什么，在秘密武器交易中，他们隐藏了一个布尔标志，表明不朽是否被一个矮人使用过。数学非常简单——如果使用了武器，精灵将获得一定比例的战争战利品。</p><p id="66d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看他们是如何完成的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">预计值示例</p></figure><p id="8197" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们彻底分析一下添加的代码。</p><ul class=""><li id="cee0" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated"><strong class="lb iu">第4行&amp; 14: </strong>我们增加了<code class="fe lv lw lx ly b">isUsed</code>变量，如果不死逻辑被触发，我们将其设置为<code class="fe lv lw lx ly b">true</code>。</li><li id="a508" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><strong class="lb iu">第22行&amp;第40行:</strong>注意一个叫做<code class="fe lv lw lx ly b">projectedValue</code>的特殊计算属性。这是属性包装器可以使用<code class="fe lv lw lx ly b">$</code>语法投射的值。看一下第40行- <code class="fe lv lw lx ly b">dwarf.$health</code>。这将打印一个使用<code class="fe lv lw lx ly b">isUsed</code>属性投影的布尔值。</li></ul><p id="8c49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">投影布尔值是一个简单的例子。你可以投射任何你想要的东西，甚至是<code class="fe lv lw lx ly b">self</code>。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="4a7d" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">结论</h1><p id="16f7" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">总而言之，我们需要回顾一下今天所学的一切:</p><ul class=""><li id="5a2d" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">属性包装器是语法糖，没有任何魔力。</li><li id="205b" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">可以使用<code class="fe lv lw lx ly b">struct</code>、<code class="fe lv lw lx ly b">class</code>、<code class="fe lv lw lx ly b">enum</code>来创建属性包装器。</li><li id="44a8" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">您必须定义一个向外界表示值的<code class="fe lv lw lx ly b">wrappedValue</code>属性。</li><li id="554b" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">你可以定义一个<code class="fe lv lw lx ly b">projectedValue</code>属性，在美元语法<code class="fe lv lw lx ly b">$</code>的帮助下，属性包装器将被打开更多。</li><li id="0c9d" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">查看<a class="ae ky" href="https://docs.swift.org/swift-book/LanguageGuide/Properties.html" rel="noopener ugc nofollow" target="_blank"> Swift文档</a>以获取更多信息。</li></ul><p id="2aea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最后的建议是使用这台新机器时要小心。如你所见，对于任何超能力，你都需要付费，就像精灵的战利品一样。过度使用注释可能会产生误导，并给代码增加不必要的复杂性。因此，在添加下一个属性包装之前要三思。</p></div></div>    
</body>
</html>