<html>
<head>
<title>Create a Simple Login Application Using Google OAuth 2.0, JavaScript, and Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google OAuth 2.0、JavaScript和Heroku创建一个简单的登录应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-simple-login-application-using-google-oauth-2-0-javascript-and-heroku-b1e56ad4604?source=collection_archive---------4-----------------------#2021-01-28">https://betterprogramming.pub/create-a-simple-login-application-using-google-oauth-2-0-javascript-and-heroku-b1e56ad4604?source=collection_archive---------4-----------------------#2021-01-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6216" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们将应用程序托管在Heroku服务器上</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ccb3677e7a085f9cea2bbdb011eff301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ocnHQoNhtl30LyM7.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://developers.google.cn/identity/account-linking/oauth-with-sign-in-linking?hl=zh-cn" rel="noopener ugc nofollow" target="_blank">谷歌开发者</a>。</p></figure><p id="8567" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示如何将Google sign-in添加到您的JavaScript web应用程序中。这些代码片段将对您的纯JavaScript/jQuery/Node.js应用程序有效。</p><p id="d54f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，您需要创建一个简单的登录，它将提供使用用户名和密码手动登录的功能。然后你需要建立一个谷歌开发者账户，并使用<a class="ae ky" href="https://console.developers.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">凭证</a>页面创建应用OAuth密钥。</p><ol class=""><li id="4b6d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">进入<a class="ae ky" href="https://console.developers.google.com/apis/credentials?authuser=9" rel="noopener ugc nofollow" target="_blank">证件页面</a>。</li><li id="766e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如果您还没有任何项目，请创建一个新项目。之后，你需要给出一些关于你的项目的细节。如果您使用的是组织开发人员帐户，请始终选择“内部”作为用户类型。那对你来说会容易些。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/b97b998f4974d01086f0c938d26b3e5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i5SHyXjLzGvJeqI7gxp3og.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">谷歌开发者控制台</p></figure><p id="f5e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您必须在整合了Google登录的网页上包含Google平台库。</p><p id="f9aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了演示，我将使用<a class="ae ky" href="https://www.tutorialrepublic.com/codelab.php?topic=bootstrap&amp;file=simple-login-form" rel="noopener ugc nofollow" target="_blank">教程Republic </a>上的一个示例登录页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/7a56f189f9b4900981436ae49e423a21.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*YWXlRGqhPDbiooiXV33ipA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">登录页面来自<a class="ae ky" href="https://www.tutorialrepublic.com/codelab.php?topic=bootstrap&amp;file=simple-login-form" rel="noopener ugc nofollow" target="_blank">教程共和国</a>。</p></figure><p id="2d8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我将在经典登录按钮下添加一个Google OAuth登录按钮。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="32bb" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">1.创建OAuth客户端ID</h1><p id="d2dc" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">在我们开始之前，从开发人员控制台启用分析API <strong class="lb iu"> </strong>。否则，它将抛出一个关于JavaScript起源的错误。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/29d290e8a480e7b5e4c633f4fab84485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BzO_a_bJGU235plEH9evQg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用程序注册</p></figure><p id="2d19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我将添加一些非敏感范围。稍后将在注册和登录过程中使用它们。可以使用电子邮件、个人资料图片或加密的个人资料ID作为密码(这可能不是最好的处理方式)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/fecba11f3d19328c2292f1be263e7f29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sl4fI8xjmPjFK1Rhtj0Cog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用程序信息页面</p></figure><p id="dfcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在应用程序信息配置中，您需要给出应用程序徽标的良好形象。它将在登录表单中使用。</p><p id="bf15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在最后一步中，您需要添加用于测试的帐户。如果您使用的是组织帐户(大学帐户、公司帐户)，您可以选择组织。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/5388053ec872d0e479537b51d571b2ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TTNhquX0p3T1ECPiPxg8nA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加测试用户</p></figure><p id="b3f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要将Google OAuth登录按钮添加到您的应用程序，您需要首先获得一个OAuth登录ID。稍后将在您的代码中使用它。对于测试，您需要添加<a class="ae ky" href="http://localhost" rel="noopener ugc nofollow" target="_blank"> http://localhost </a>作为授权源之一。对于Heroku，您需要添加一个已部署的Heroku URL。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="63fa" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">2.添加Google登录按钮</h1><p id="8df2" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">在您的代码中，您需要添加Google平台库来使用Google OAuth函数，并用来自<a class="ae ky" href="https://console.developers.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">凭证</a>页面的客户端ID替换<code class="fe ns nt nu nv b">YOUR_CLIENT_ID</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="81fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您需要将Google按钮添加到应用程序的登录页面:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="b7a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你得到一个类似下面的错误，检查你是否已经启用了分析API。这不是因为JavaScript起源中的错误配置。</p><pre class="kj kk kl km gt ny nv nz oa aw ob bi"><span id="a1a2" class="oc mt it nv b gy od oe l of og">details: “Not a valid origin for the client: <a class="ae ky" href="http://localhost" rel="noopener ugc nofollow" target="_blank">http://localhost</a> has not been whitelisted for client ID YOUR_CLIENT_ID.apps.googleusercontent.com. Please go to <a class="ae ky" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank">https://console.developers.google.com/</a> and whitelist this origin for your project’s client ID.” <br/>error: “idpiframe_initialization_failed”</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/1253d955a8676f4b40074eed26035107.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1XCLPKJ8k20zG4AffAIuKQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Chrome开发工具控制台</p></figure><p id="7c84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你已经到了这个阶段，那就说明你已经成功添加了一个登录按钮。然后我们需要处理登录。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/6b691a75954097490ee118fde08d34c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QqPyB6hj9RyvSy8iH-ucPg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用程序登录</p></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="130f" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">3.处理登录</h1><p id="13ed" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">对于登录，我将获取用户的电子邮件并在会话中设置它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="be7d" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">4.处理注册</h1><p id="7b12" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">您也可以使用Google登录来创建用户帐户。下面这个简单的PHP脚本是为了在注册过程中为每个新用户创建一个新的JSON文件而编写的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="6e4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的PHP函数将用于创建存储用户相关数据的JSON文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="0322" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">5.在Heroku中部署您的应用</h1><p id="8f30" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">Heroku只托管和支持应用程序，而不是静态页面。因此，为了将我们的静态HTML页面部署到Heroku，我们需要欺骗Heroku，使其认为我们的网站是一个PHP应用程序。</p><p id="32e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将添加一个动态PHP文件，从这个PHP文件中，我们将调用其他静态HTML文件。我们必须创建一个<code class="fe ns nt nu nv b">composer.json</code>,因为Heroku需要它来托管PHP应用程序。下面的命令将为您创建<code class="fe ns nt nu nv b">composer.js</code>和<code class="fe ns nt nu nv b">index.php</code>文件。我们将使用一个名为<code class="fe ns nt nu nv b">include_once</code>的简单PHP命令从<code class="fe ns nt nu nv b">index.php</code>重定向到我们的HTML文件。</p><p id="3472" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oj">注意:如果使用的是Windows，</em> <code class="fe ns nt nu nv b"><em class="oj">cmd</em></code> <em class="oj">将无法执行这些命令，但是Powershell可以。</em></p><pre class="kj kk kl km gt ny nv nz oa aw ob bi"><span id="58aa" class="oc mt it nv b gy od oe l of og">echo {} &gt; composer.json<br/>echo '&lt;?php include_once("login.html"); ?&gt;' &gt; index.php</span></pre><p id="2fcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要将您的页面推送到Git远程服务器，以便Heroku可以从Git更改中进行部署:</p><pre class="kj kk kl km gt ny nv nz oa aw ob bi"><span id="0b66" class="oc mt it nv b gy od oe l of og">git init<br/>git add *<br/>git commit -m "my google Login page"<br/>git branch -M main<br/>git remote add origin &lt;YOUR_REPO&gt;.git<br/>git push -u origin main</span></pre><p id="be49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您需要在Heroku中创建一个新的应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/d0c727e09b04c2df03de21f3ea2c071f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9p-SOIu0QvYVQ-7ghyfX6w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Heroku中创建新的应用程序页面</p></figure><p id="a1fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以在部署页面上选择要部署的存储库:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/68afa2f797550df2537149cfd5f9c876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5PM9kE3NBQwnWzGos_628A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">连接到GitHub repo</p></figure><p id="36f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将GitHub repo连接到Heroku应用程序后，您可以启用自动部署来为您的每次推送部署该应用程序的新版本。或者，您也可以手动部署。</p><p id="4304" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。相信这个简短的教程会有所帮助。工作代码示例可以在<a class="ae ky" href="https://github.com/AselSiriwardena/demo-oauth" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p></div></div>    
</body>
</html>