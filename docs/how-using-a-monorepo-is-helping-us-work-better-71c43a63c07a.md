# 如何使用 Monorepo 帮助我们更好地工作

> 原文：<https://betterprogramming.pub/how-using-a-monorepo-is-helping-us-work-better-71c43a63c07a>

## 引入一个产生透明性和一致性的工具比其他任何技术优势都重要得多

![](img/95723d0d27bf39194b27518f0ddfb100.png)

马特奥·维斯托科在 [Unsplash](https://unsplash.com/) 上。

与许多其他走向成长阶段的成熟创业公司类似，Minute Media 不得不重建一些基础设施。

我们最初的基础设施是 Ruby on Rails 中的单一应用程序，但是我们意识到随着公司和团队的发展，我们需要探索其他的选择。当我们开始探索更多选项时，我们的目标是创建工具和公司范围的标准，以帮助促进公开对话和公司发展。

在我们的公司结构中，我们的团队在跨职能组织中工作，具有明确的、有时是独立的业务目标。在我们的探索过程中，每个团队都独自冒险，测试 Node 和 Go 等技术。几个星期后，我们意识到我们有一些沟通问题。当我们有机会分享我们的工作时，我们注意到类似的技术和设计问题在团队中出现。

为了避免跨多个团队的重复工作，我们在 monorepo 中尝试了我们的新开发工作。

简而言之，monorepo 是一个整体存储库。这个想法是将公司的所有或者大部分项目保存在一个单一的存储库中。这个概念并不新鲜，已经实行了十年。最值得注意的是，它被大公司和企业使用，如谷歌、脸书、推特和优步。

在使用 monorepo 一年多后，我想分享一些好处和我们学到的经验教训。

我们的代码库可供所有团队成员使用，但是当每个项目都有自己的 repos 时，我们很少发现自己审查其他团队的代码。

现在，我们可以让所有团队成员审查整个代码库。大部分代码仍然属于不同的团队，但是如果有人有兴趣看看其他团队在做什么，他们所要做的就是看一看 pull 请求。

这样做的障碍非常低，因为它只是存储库中的另一个 PR。事实上，团队成员经常发现自己在浏览其他团队的 PRs。

这个过程让我们下意识地创建更好、更可读的代码，因为所有代码对所有团队都是开放的(类似于开源效应)。

当一切都在一个回购协议中可见和可访问时，就更容易达成一致并强化标准。以前，每个团队都有自己的特定标准，但随着我们更好地调整自己，我们提出了一个公司范围的标准流程。在这个过程中，所有标准都要在每个团队中进行测试和实施，一旦证明有用，所有团队都要向前推进，新标准要在整个 monorepo 中实施。

我们最近实施的标准是:

*   Go 中 restful 服务的目录结构
*   从 JavaScript 切换到 TypeScript
*   JavaScript 项目的林挺规则
*   文档格式
*   证明
*   部署和监控

自从切换到 monorepo，我们看到了更好的跨系统架构设计。这在以前是很难发现的——尤其是对于独立存储库中的服务——但是现在类似的功能很容易发现和提取。通过建立一个内部框架来支持和提高交付速度，我们在一个服务中使用回购，然后应用它。使用一个代码库可以让参与者发现新的或相似的想法。例如，您可以使用一种根据脚本对视频进行分类的服务，也可以使用一种对新闻文章进行分类的服务。

由于整个系统都在一个 repo 中，所以在 Docker 中编写集成测试并启动整个系统是轻而易举的事情。今天，Minute Media 能够非常早地发现集成问题。

使用 Docker Compose，您可以在笔记本电脑上运行整个端到端系统。这实现了更精细的特性，比如为客户旋转专门的 QA 环境或演示。

此外，语言升级和安全补丁会一次性应用于所有代码。维护和更新外部依赖关系比以前简单多了，也更容易访问。

例如，从 Go 1.10 升级到 1.11 是由一个开发人员在 2-3 天的时间里在 20 种不同的服务上完成的。

像软件开发中的其他事情一样，monorepo 需要一些规则。就像分享想法很容易一样，打破服务封装也很容易。

并不是每个人都愿意一直共享所有的代码，有时共享会导致更复杂的讨论，而应该只做一个简单的决定。

此外，一旦代码增长，推/拉请求就会变得更慢。这就是我们努力实现更好整合的原因。我们仍处于这项实验的开始阶段，很明显，我们仍需要将许多东西添加到我们的工具箱中，例如:

*   monorepo 规则列表
*   自动化项目生成
*   模板部署脚本
*   拉式请求模板
*   使用有向图构建系统，如[巴泽尔](https://bazel.build/)或[巴克](https://buck.build/)

使用单边回购可以实现很多技术上的好处。通过一些工作，我相信你可以获得与使用多重回购相同的技术优势。

然而，最重要的是，引入一个生成透明性和一致性的工具比任何其他技术优势都重要得多。