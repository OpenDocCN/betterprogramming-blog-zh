<html>
<head>
<title>Live Text API in iOS 16 — Scanning Data With the Camera in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 16中的Live Text API在SwiftUI中用相机扫描数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/scanning-data-with-the-camera-in-swiftui-491741e36f69?source=collection_archive---------6-----------------------#2022-06-09">https://betterprogramming.pub/scanning-data-with-the-camera-in-swiftui-491741e36f69?source=collection_archive---------6-----------------------#2022-06-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4e37" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在SwiftUI中使用<code class="fe kf kg kh ki b"><a class="ae kj" href="https://developer.apple.com/documentation/visionkit/datascannerviewcontroller" rel="noopener ugc nofollow" target="_blank">DataScannerViewController</a></code></h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/d54fe15a8364d6ed8f78360c1eebfdf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nX-DLsh2EZNyxIut"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">由<a class="ae kj" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae kj" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="fcf0" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">WWDC22带来了出色的实时文本数据扫描工具，允许用户使用相机扫描文本和代码，类似于iOS和iPadOS开发人员在相机应用程序中的实时文本界面。</p><p id="f3a1" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在本文中，我将重点介绍名为<code class="fe kf kg kh ki b"><a class="ae kj" href="https://developer.apple.com/documentation/visionkit/datascannerviewcontroller" rel="noopener ugc nofollow" target="_blank">DataScannerViewController</a></code>的新API，并分享我在如何将该API嵌入到您的SwiftUI代码中的经验。下面的照片展示了今天的演示。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi lw"><img src="../Images/15709e13491e9a277a7aaa834132feef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUjD8gWoosta2a99hdZvgA.jpeg"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">我们将创建的演示应用程序</p></figure><h1 id="56d5" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">提供使用相机的理由</h1><p id="fadc" class="pw-post-body-paragraph la lb iq lc b ld mp jr lf lg mq ju li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">因为这个演示应用程序只能在真实世界的设备上运行，所以要访问用户的相机，你最好提供一个清晰的声明，说明你为什么需要访问他们的相机。</p><p id="2c07" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">您需要在Xcode项目配置中提供使用摄像机的原因。在Xcode中将<code class="fe kf kg kh ki b"><a class="ae kj" href="https://developer.apple.com/documentation/bundleresources/information_property_list/nscamerausagedescription" rel="noopener ugc nofollow" target="_blank">NSCameraUsageDescription</a></code>键添加到目标的信息属性列表中。</p><p id="e52f" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">以下我提供的步骤来自苹果官方文档:<a class="ae kj" href="https://developer.apple.com/documentation/visionkit/scanning_data_with_the_camera" rel="noopener ugc nofollow" target="_blank">用摄像头扫描数据</a>。</p><ol class=""><li id="5f15" class="mu mv iq lc b ld le lg lh lj mw ln mx lr my lv mz na nb nc bi translated">在项目编辑器中，选择目标并单击“信息”。</li><li id="c6f5" class="mu mv iq lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">在自定义iOS目标属性下，单击任意行中的加号按钮。</li><li id="ec3f" class="mu mv iq lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">从“密钥”栏的弹出式菜单中，选取“隐私——相机使用说明”。</li><li id="3d6e" class="mu mv iq lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">在“值”栏中，输入原因，如“您的相机用于扫描文本和代码”</li></ol><h1 id="a82e" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">创建主视图</h1><p id="0ad1" class="pw-post-body-paragraph la lb iq lc b ld mp jr lf lg mq ju li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">在您的<code class="fe kf kg kh ki b">ContentView.swift</code>文件中，添加以下代码:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="c019" class="nm ly iq ki b gy nn no l np nq">VStack {<br/>    Text(scanResults)<br/>        .padding()</span><span id="cdb8" class="nm ly iq ki b gy nr no l np nq">    Button {<br/>        // Enable Scan Document Action<br/>    } label: {<br/>        Text("Tap to Scan Documents")<br/>            .foregroundColor(.white)<br/>            .frame(width: 300, height: 50)<br/>            .background(Color.blue)<br/>            .cornerRadius(10)<br/>    }<br/>}</span></pre><p id="e503" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">其中<code class="fe kf kg kh ki b">scanResult</code>是一个<code class="fe kf kg kh ki b">String</code>变量，代表摄像头扫描结果，用于说明摄像头在扫描过程中看到的内容。</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="b86a" class="nm ly iq ki b gy nn no l np nq">@State <strong class="ki ir">private</strong> <strong class="ki ir">var</strong> scanResults: String = ""</span></pre><p id="bb9c" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">此处的按钮用于显示扫描视图。</p><p id="b044" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">当有人点击按钮时，设备将准备扫描数据。但是，并非所有设备都支持该功能。或者甚至当设备支持扫描数据时，当用户否认提供相机使用权限时，轻按按钮时，事情可能会失败。</p><p id="d941" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在这种情况下，我会提供一个警报视图，在设备无法扫描数据时显示一条消息。</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="f681" class="nm ly iq ki b gy nn no l np nq">@State <strong class="ki ir">private</strong> <strong class="ki ir">var</strong> showDeviceNotCapacityAlert = <strong class="ki ir">false</strong></span></pre><p id="dc48" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">上面的代码提供了一个变量来选择是否显示警报视图。如果<code class="fe kf kg kh ki b">showDeviceNotCapacityAlert</code>是<code class="fe kf kg kh ki b">true</code>，则显示告警视图。</p><p id="3978" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在<code class="fe kf kg kh ki b">VStack</code>代码后面添加以下代码:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="dbfe" class="nm ly iq ki b gy nn no l np nq">.alert("Scanner Unavailable", isPresented: $showDeviceNotCapacityAlert, actions: {})</span></pre><p id="25be" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">最后，当设备准备好扫描数据时，我们需要呈现一个扫描视图，如上面的代码，并将下面的代码添加到您的<code class="fe kf kg kh ki b">ContentView.swift</code>文件中:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="604c" class="nm ly iq ki b gy nn no l np nq">@State <strong class="ki ir">private</strong> <strong class="ki ir">var</strong> showCameraScannerView = <strong class="ki ir">false</strong></span><span id="7895" class="nm ly iq ki b gy nr no l np nq"><strong class="ki ir">var</strong> body: <strong class="ki ir">some</strong> View {<br/>    VStack {<br/>        ...<br/>    }<br/>    .sheet(isPresented: $showCameraScannerView) {<br/>        // Present the scanning view<br/>    }<br/>    ...<br/>}</span></pre><p id="2a42" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在我们剩下的是，当我们点击按钮时，如果设备无法扫描数据，将会显示一个警报视图。我们使用<code class="fe kf kg kh ki b">isDeviceCapacity</code>来检查设备是否可以使用该功能。</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="4c98" class="nm ly iq ki b gy nn no l np nq">@State <strong class="ki ir">private</strong> <strong class="ki ir">var</strong> isDeviceCapacity = <strong class="ki ir">false</strong></span></pre><p id="a0f4" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在，在按钮操作中添加以下代码:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="3ee6" class="nm ly iq ki b gy nn no l np nq"><strong class="ki ir">if</strong> isDeviceCapacity {<br/>    <strong class="ki ir">self</strong>.showCameraScannerView = <strong class="ki ir">true<br/></strong>} <strong class="ki ir">else</strong> {<br/>    <strong class="ki ir">self</strong>.showDeviceNotCapacityAlert = <strong class="ki ir">true<br/></strong>}</span></pre><h1 id="0023" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">创建相机扫描仪视图</h1><p id="f380" class="pw-post-body-paragraph la lb iq lc b ld mp jr lf lg mq ju li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">创建一个新的swift文件并命名为<code class="fe kf kg kh ki b">CameraScanner.swift</code>。在此添加以下代码:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="d6d0" class="nm ly iq ki b gy nn no l np nq"><strong class="ki ir">struct</strong> CameraScanner: View {<br/>    @Environment(\.presentationMode) <strong class="ki ir">var</strong> presentationMode<br/>    <strong class="ki ir">var</strong> body: <strong class="ki ir">some</strong> View {<br/>        NavigationView {<br/>            Text("Scanning View")<br/>                .toolbar {<br/>                    ToolbarItem(placement: .navigationBarLeading) {<br/>                        Button {<br/><strong class="ki ir">self</strong>.presentationMode.wrappedValue.dismiss()<br/>                        } label: {<br/>                              Text("Cancel")<br/>                        }<br/>                    }<br/>                }<br/>                .interactiveDismissDisabled(<strong class="ki ir">true</strong>)<br/>        }<br/>    }<br/>}</span></pre><h1 id="607e" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">扫描仪不可用时的处理</h1><p id="ed13" class="pw-post-body-paragraph la lb iq lc b ld mp jr lf lg mq ju li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">当用户打开应用程序时，我们需要检查扫描仪是否可用。只需添加以下代码，此应用程序便会打开:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="91d6" class="nm ly iq ki b gy nn no l np nq"><strong class="ki ir">var</strong> body: <strong class="ki ir">some</strong> View {<br/>    VStack {<br/>        ...<br/>    }<br/>    .onAppear {<br/>        isDeviceCapacity = (DataScannerViewController.isSupported &amp;&amp; DataScannerViewController.isAvailable)<br/>    }<br/>    ...<br/>}</span></pre><p id="8ddc" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">只有当上面检查两个值的便利属性返回<code class="fe kf kg kh ki b">true</code>时，我们才能打开扫描视图。</p><h1 id="669d" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">创建数据扫描仪视图控制器</h1><p id="7e0b" class="pw-post-body-paragraph la lb iq lc b ld mp jr lf lg mq ju li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">要实现一个可以在SwiftUI视图中使用的视图控制器，首先我们需要使用<code class="fe kf kg kh ki b"><strong class="lc ir">UIViewControllerRepresentable</strong></code>来包装一个UIKit视图控制器，以便它可以在SwiftUI中使用。创建一个名为<code class="fe kf kg kh ki b">CameraScannerViewController.swift</code>的新Swift文件，并在此添加以下代码:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="eee3" class="nm ly iq ki b gy nn no l np nq"><strong class="ki ir">import</strong> SwiftUI<br/><strong class="ki ir">import</strong> UIKit<br/><strong class="ki ir">import</strong> VisionKit</span><span id="9c1d" class="nm ly iq ki b gy nr no l np nq"><strong class="ki ir">struct</strong> CameraScannerViewController: UIViewControllerRepresentable {<br/>    <strong class="ki ir">func</strong> makeUIViewController(context: Context) -&gt; DataScannerViewController {<br/>        <strong class="ki ir">let</strong> viewController =  DataScannerViewController(recognizedDataTypes: [.text()],qualityLevel: .fast,recognizesMultipleItems: <strong class="ki ir">false</strong>, isHighFrameRateTrackingEnabled: <strong class="ki ir">false</strong>, isHighlightingEnabled: <strong class="ki ir">true</strong>)</span><span id="5f21" class="nm ly iq ki b gy nr no l np nq"><strong class="ki ir">        return</strong> viewController<br/>    }</span><span id="b071" class="nm ly iq ki b gy nr no l np nq"><strong class="ki ir">    func</strong> updateUIViewController(_ viewController: DataScannerViewController, context: Context) {}</span><span id="c09d" class="nm ly iq ki b gy nr no l np nq">}</span></pre><p id="0aa0" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">上面的代码返回了一个视图控制器，它提供了用于扫描实时视频中的项目的接口。在本文中，我将只关注扫描文本数据，所以这里的<code class="fe kf kg kh ki b">recognizedDataTypes</code>只包含<code class="fe kf kg kh ki b">.text()</code>属性。</p><h1 id="f2fa" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated"><code class="fe kf kg kh ki b">Handle Delegate</code>协议</h1><p id="15b1" class="pw-post-body-paragraph la lb iq lc b ld mp jr lf lg mq ju li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">在创建视图控制器之后，在我们展示它之前，将它的委托设置为这个应用中处理<code class="fe kf kg kh ki b"><a class="ae kj" href="https://developer.apple.com/documentation/visionkit/datascannerviewcontrollerdelegate" rel="noopener ugc nofollow" target="_blank">DataScannerViewControllerDelegate</a></code>协议回调的一个对象。</p><p id="9b97" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在UIKit中，很容易编写以下代码:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="c972" class="nm ly iq ki b gy nn no l np nq">viewController.delegate = self</span></pre><p id="f99f" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">幸运的是，在SwiftUI中处理<code class="fe kf kg kh ki b"><a class="ae kj" href="https://developer.apple.com/documentation/visionkit/datascannerviewcontrollerdelegate" rel="noopener ugc nofollow" target="_blank">DataScannerViewControllerDelegat</a>e</code>非常方便。</p><blockquote class="ns nt nu"><p id="c6c3" class="la lb nv lc b ld le jr lf lg lh ju li nw lk ll lm nx lo lp lq ny ls lt lu lv ij bi translated">SwiftUI的协调器被设计为充当UIKit视图控制器的代表。请记住，“委托”是对其他地方发生的事件做出响应的对象。例如，UIKit允许我们将一个委托对象附加到它的文本字段视图中，当用户键入任何内容、按下return键等等时，该委托将会得到通知。这意味着UIKit开发人员可以修改他们的文本字段的行为方式，而不必创建他们自己的自定义文本字段类型。</p></blockquote><p id="90e7" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">因此，在<code class="fe kf kg kh ki b">CameraScannerViewController</code>中添加以下代码:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="b0fb" class="nm ly iq ki b gy nn no l np nq"><strong class="ki ir">func</strong> makeCoordinator() -&gt; Coordinator {<br/>    Coordinator(<strong class="ki ir">self</strong>)<br/>}</span><span id="5c7c" class="nm ly iq ki b gy nr no l np nq"><strong class="ki ir">class</strong> Coordinator: NSObject, DataScannerViewControllerDelegate {<br/>    <strong class="ki ir">var</strong> parent: CameraScannerViewController<br/>    <strong class="ki ir">init</strong>(_ parent: CameraScannerViewController) {<br/>        <strong class="ki ir">self</strong>.parent = parent<br/>    }<br/>}</span></pre><p id="7a25" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在我们可以在<code class="fe kf kg kh ki b">makeUIViewController</code>里面使用类似的代码，只是在<strong class="lc ir">上面返回</strong>代码:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="bdc7" class="nm ly iq ki b gy nn no l np nq"><strong class="ki ir">func</strong> makeUIViewController(context: Context) -&gt; DataScannerViewController {<br/>    ...<br/>    viewController.delegate = context.coordinator<br/>    <strong class="ki ir">return</strong> viewController<br/>}</span></pre><h1 id="3a95" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">开始数据扫描</h1><p id="90fd" class="pw-post-body-paragraph la lb iq lc b ld mp jr lf lg mq ju li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">该开始数据扫描了。一旦用户允许不受限制地访问摄像机，您就可以通过调用<code class="fe kf kg kh ki b"><a class="ae kj" href="https://developer.apple.com/documentation/visionkit/datascannerviewcontroller/3941759-startscanning" rel="noopener ugc nofollow" target="_blank">startScanning()</a></code>方法开始扫描出现在直播视频中的项目。在这种情况下，当显示扫描视图时，我们将需要该视图来执行扫描操作。</p><p id="b9b2" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们需要一个值来告诉扫描视图进行扫描，将下面的代码添加到<code class="fe kf kg kh ki b">CameraScannerViewController</code>中:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="9188" class="nm ly iq ki b gy nn no l np nq">@Binding <strong class="ki ir">var</strong> startScanning: Bool</span></pre><p id="7702" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">当<code class="fe kf kg kh ki b">startScanning</code>的值设置为true时，我们需要更新UIViewController并开始扫描，在<code class="fe kf kg kh ki b">updateUIViewController</code>中添加以下代码:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="a362" class="nm ly iq ki b gy nn no l np nq"><strong class="ki ir">func</strong> updateUIViewController(_ viewController: DataScannerViewController, context: Context) {<br/>    <strong class="ki ir">if</strong> startScanning {<br/>        <strong class="ki ir">try</strong>? viewController.startScanning()<br/>    } <strong class="ki ir">else</strong> {<br/>        viewController.stopScanning()<br/>    }<br/>}</span></pre><h1 id="828e" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">当我们点击一个项目时做出响应</h1><p id="f621" class="pw-post-body-paragraph la lb iq lc b ld mp jr lf lg mq ju li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">当我们点击实时视频中的一个识别项时，视图控制器调用<code class="fe kf kg kh ki b"><a class="ae kj" href="https://developer.apple.com/documentation/visionkit/datascannerviewcontrollerdelegate/3941771-datascanner" rel="noopener ugc nofollow" target="_blank">dataScanner(_:didTapOn:)</a></code>委托方法并传递识别项。实现此方法以根据用户点击的项目采取一些操作。使用<code class="fe kf kg kh ki b"><a class="ae kj" href="https://developer.apple.com/documentation/visionkit/recognizeditem" rel="noopener ugc nofollow" target="_blank">RecognizedItem</a></code>枚举的参数来获得关于该项目的细节，比如边界。</p><p id="b1b3" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在这种情况下，为了处理我们点击相机识别的文本，实现<code class="fe kf kg kh ki b"><a class="ae kj" href="https://developer.apple.com/documentation/visionkit/datascannerviewcontrollerdelegate/3941771-datascanner" rel="noopener ugc nofollow" target="_blank">dataScanner(_:didTapOn:)</a></code>方法来执行在屏幕上显示结果的动作。因此，在<code class="fe kf kg kh ki b">Coordinator</code>类中添加以下代码:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="2798" class="nm ly iq ki b gy nn no l np nq"><strong class="ki ir">class</strong> Coordinator: NSObject, DataScannerViewControllerDelegate {<br/>    ...<br/>    <strong class="ki ir">func</strong> dataScanner(_ dataScanner: DataScannerViewController, didTapOn item: RecognizedItem) {<br/>        <strong class="ki ir">switch</strong> item {<br/>            <strong class="ki ir">case</strong> .text(<strong class="ki ir">let</strong> text):<br/>                parent.scanResult = text.transcript<br/>            <strong class="ki ir">default</strong>:<br/>                <strong class="ki ir">break<br/>        </strong>}<br/>    }<br/>}</span></pre><p id="950e" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">并在<code class="fe kf kg kh ki b">CameraScannerViewController</code>里面增加一个<code class="fe kf kg kh ki b">Binding</code>属性:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="bfb8" class="nm ly iq ki b gy nn no l np nq">@Binding <strong class="ki ir">var</strong> scanResult: String</span></pre><h1 id="9292" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">立即扫描</h1><p id="8ad5" class="pw-post-body-paragraph la lb iq lc b ld mp jr lf lg mq ju li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">是时候更新<code class="fe kf kg kh ki b">CameraScanner.swift</code>文件了。只需添加以下代码:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="0b55" class="nm ly iq ki b gy nn no l np nq">@Binding <strong class="ki ir">var</strong> startScanning: Bool<br/>@Binding <strong class="ki ir">var</strong> scanResult: String</span></pre><p id="8298" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">并将<code class="fe kf kg kh ki b">Text(“Scanning View”)</code>改为以下代码:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="701b" class="nm ly iq ki b gy nn no l np nq"><strong class="ki ir">var</strong> body: <strong class="ki ir">some</strong> View {<br/>    NavigationView {<br/>        CameraScannerViewController(startScanning: $startScanning, scanResult: $scanResult)<br/>        ...<br/>    }<br/>}</span></pre><p id="fafb" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">最后，将以下代码添加到<code class="fe kf kg kh ki b">ContentView</code>:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="ada3" class="nm ly iq ki b gy nn no l np nq"><strong class="ki ir">struct</strong> ContentView: View {<br/>    ...<br/>    @State <strong class="ki ir">private</strong> <strong class="ki ir">var</strong> scanResults: String = ""</span><span id="c2b3" class="nm ly iq ki b gy nr no l np nq"><strong class="ki ir">    var</strong> body: <strong class="ki ir">some</strong> View {<br/>        VStack {<br/>            ...<br/>        }<br/>        .sheet(isPresented: $showCameraScannerView) {<br/>            CameraScanner(startScanning: $showCameraScannerView, scanResult: $scanResults)<br/>        }<br/>        ...<br/>    }<br/>}</span></pre><p id="f53d" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe kf kg kh ki b">scanResults</code>用于通过视图传递值。一旦相机扫描到什么东西，<code class="fe kf kg kh ki b">scanResults</code>就会被更新然后更新文本视图。</p><p id="7af2" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在运行这个项目，并享受自己。</p><h1 id="c5b7" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">下一步</h1><p id="19e6" class="pw-post-body-paragraph la lb iq lc b ld mp jr lf lg mq ju li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">WWDC不仅带来了摄像头中的实时文本，还简化了开发人员如何实现实时文本与图像的交互。如果您对如何启用与图像的实时文本交互感兴趣，请查看我的新文章:<a class="ae kj" href="https://medium.com/better-programming/enabling-live-text-interactions-with-images-in-swiftui-5dd1d7f1676" rel="noopener"> WWDC22:在SwiftUI中启用与图像的实时文本交互</a>。</p><h1 id="470f" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">源代码</h1><p id="4770" class="pw-post-body-paragraph la lb iq lc b ld mp jr lf lg mq ju li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">你可以在<a class="ae kj" href="https://github.com/HuangRunHua/ScanningDataCamera" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到源代码。</p><h1 id="b00f" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">支持我</h1><p id="427b" class="pw-post-body-paragraph la lb iq lc b ld mp jr lf lg mq ju li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">如果你认为这篇文章有帮助，你可以在<a class="ae kj" href="https://apps.apple.com/us/app/filerapp/id1626627609?mt=12&amp;itsct=apps_box_link&amp;itscg=30200" rel="noopener ugc nofollow" target="_blank"> Mac应用商店</a>上下载我的第一个Mac应用，名为<a class="ae kj" href="https://huangrunhua.github.io/FilerApp/" rel="noopener ugc nofollow" target="_blank"> FilerApp </a>。FilerApp是一个用于Mac的Finder扩展，它使您能够在系统的任何地方轻松创建支持格式的文件。它是免费的，对许多人来说是有用的。希望你喜欢。</p></div></div>    
</body>
</html>