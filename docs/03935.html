<html>
<head>
<title>How to Verify a User’s Email Address With Firebase and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Firebase和Python验证用户的电子邮件地址</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/verify-user-email-address-with-firebase-and-python-adda433ff48d?source=collection_archive---------4-----------------------#2020-03-13">https://betterprogramming.pub/verify-user-email-address-with-firebase-and-python-adda433ff48d?source=collection_archive---------4-----------------------#2020-03-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0941" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">发送电子邮件验证链接，以确保您的用户是他们所说的人</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/43d21264a44ec821d72039d643af325c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jwM1XppjunmNP0Ph"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Philipp Katzenberger 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="0803" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">介绍</h1><p id="cae9" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在这个时代，保护我们应用程序用户的信息是我们应该投入大量精力的最重要的事情之一。这就是为什么大多数应用程序(如果不是全部的话)都有身份验证的形式。例如，电子邮件地址和手机号码是两个最常见的。</p><p id="2370" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们当然可以从头开始构建我们自己的验证解决方案，但是，如果我们时间紧迫，需要快速完成任务，该怎么办呢？</p><p id="cc02" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这个问题的一个答案是谷歌的<a class="ae ky" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase </a>。该工具提供了一个API来发送电子邮件验证链接并确认电子邮件验证本身。</p><p id="3d14" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在本教程中，我们将讨论和演练如何实现Firebase的电子邮件验证API来验证我们的应用程序用户的电子邮件地址。</p><p id="f4b3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">TLDR:克隆这个GitHub <a class="ae ky" href="https://github.com/billydh/python-firebase-admin-sdk-demo" rel="noopener ugc nofollow" target="_blank"> repo </a>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3521" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">先决条件</h1><p id="4786" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我们需要一个谷歌账户和一个Firebase项目来实现电子邮件验证。最近，我写了一篇关于如何建立一个Firebase项目并获得证书和API密匙的教程。</p><p id="d3e0" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">您可以遵循该教程，对Firebase如何与您的应用程序后端集成有一个基本的了解。</p><p id="806f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">除了介绍Firebase项目设置之外，本教程还介绍了用户管理，包括创建用户、更新用户的详细信息、设置用户的密码、使用电子邮件和密码验证用户以及删除用户。</p><p id="aac0" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在进入下一部分之前，请克隆这个GitHub <a class="ae ky" href="https://github.com/billydh/python-firebase-admin-sdk-demo" rel="noopener ugc nofollow" target="_blank">库</a>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="b26d" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">发送电子邮件验证链接</h1><p id="7987" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">好了，让我们进入本教程的第一部分，向用户发送一封包含电子邮件验证链接的电子邮件。</p><p id="d440" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">发送电子邮件验证链接的API是Firebase Auth REST API的一部分。它是一个接受包含<code class="fe mz na nb nc b">requestType</code>的请求体的<code class="fe mz na nb nc b">POST</code>端点，请求体的值应该总是<code class="fe mz na nb nc b">"VERIFY_EMAIL"</code>和<code class="fe mz na nb nc b">idToken</code>，这是我们在用户通过身份验证时获得的Firebase ID令牌。</p><p id="814e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">因此，让我们创建一个新用户，设置一个密码并进行身份验证，这样我们就可以获得Firebase ID令牌。所有的步骤都包含在前面提到的教程中。</p><p id="9ef3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">继续使用您可以访问的电子邮件地址创建一个用户，以便您可以在以后接收电子邮件验证链接。</p><p id="de66" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果您遵循上面提到的教程，这些步骤看起来会是这样的。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="ad07" class="nh lh it nc b gy ni nj l nk nl">~/demo/python-admin-sdk-demo ❯ python create_user.py --email your.email@yourdomain.com --user-id 12345</span><span id="2cbd" class="nh lh it nc b gy nm nj l nk nl">Firebase successfully created a new user with email - your.email@yourdomain.com and user id - 12345</span><span id="5c8d" class="nh lh it nc b gy nm nj l nk nl">~/demo/python-admin-sdk-demo ❯ python set_password.py --user-id 12345 --password whateverpasswordyouwanttouse</span><span id="cfac" class="nh lh it nc b gy nm nj l nk nl">Firebase has updated the password for user with user id - 12345</span><span id="3677" class="nh lh it nc b gy nm nj l nk nl">~/demo/python-admin-sdk-demo ❯ python sign_in_with_email_and_password.py --email your.email@yourdomain.com --password whateverpasswordyouwanttouse</span><span id="87c7" class="nh lh it nc b gy nm nj l nk nl">### This will result in a Json response body. Just grab the value of the field named 'idToken'. ###</span></pre><p id="18ba" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">一旦我们在认证用户之后获得了Firebase ID令牌，我们就可以继续创建一个名为<code class="fe mz na nb nc b">send_email_verification_link.py</code>的新Python文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe mz na nb nc b">send_email_verification_link.py</code></p></figure><p id="73aa" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">让我们称之为向用户的电子邮件地址发送电子邮件验证链接的脚本。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="5179" class="nh lh it nc b gy ni nj l nk nl">~/demo/python-admin-sdk-demo ❯ python send_email_verification_link.py --firebase-id-token &lt;insert-id-token-here&gt;</span><span id="78db" class="nh lh it nc b gy nm nj l nk nl">{'email': 'your.email@yourdomain.com',<br/> 'kind': 'identitytoolkit#GetOobConfirmationCodeResponse'}</span></pre><p id="7e99" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">很好。</p><p id="cc78" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果这是我们看到的响应，这意味着API调用成功了。现在，如果我们进入我们的电子邮件收件箱，我们应该会看到一封来自Firebase的电子邮件，就像这样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/d36a4d5703330b2251e856ca041489d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2fYZg_xlWqdT04vFgRUBeA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Firebase的电子邮件验证链接</p></figure><p id="8c0e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果您只是点击链接，它将带您到一个新的页面，如果验证成功，您将看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/3ca28e6ca4e8074440a4b70b33ecfef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PnEzVRHHsgyKZ1vof9bp0Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">成功的电子邮件验证</p></figure><p id="efa2" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们中的一些人可能已经注意到，我们的API密钥包含在上面的电子邮件验证链接中。我们的第一反应很可能是这样做不安全。</p><p id="9179" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">然而，对于Firebase项目，API键实际上是公共信息，有必要在Google服务器上识别我们的Firebase项目。关于这个主题，有一个很好的堆栈溢出问题供你参考。</p><p id="c7da" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">本质上，Firebase推荐使用<a class="ae ky" href="https://firebase.google.com/docs/rules" rel="noopener ugc nofollow" target="_blank"> Firebase安全规则</a>来保护您的资源。因此，在部署您的应用程序之前，请设置相关的安全规则，以保护您的应用程序资源。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="7b60" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">参考</h1><ul class=""><li id="dadf" class="nr ns it ma b mb mc me mf mh nt ml nu mp nv mt nw nx ny nz bi translated"><a class="ae ky" href="https://firebase.google.com/docs/reference/rest/auth#section-send-email-verification" rel="noopener ugc nofollow" target="_blank"> Firebase —发送电子邮件验证链接</a></li><li id="f2ff" class="nr ns it ma b mb oa me ob mh oc ml od mp oe mt nw nx ny nz bi translated"><a class="ae ky" href="https://firebase.google.com/docs/rules" rel="noopener ugc nofollow" target="_blank"> Firebase安全规则</a></li><li id="46c4" class="nr ns it ma b mb oa me ob mh oc ml od mp oe mt nw nx ny nz bi translated"><a class="ae ky" href="https://github.com/billydh/python-firebase-admin-sdk-demo" rel="noopener ugc nofollow" target="_blank"> GitHub回购</a></li></ul></div></div>    
</body>
</html>