<html>
<head>
<title>How to Access a Docker Container — Secure Shell vs Docker Attach</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何访问Docker容器——安全外壳与Docker附加</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-access-a-docker-container-secure-shell-vs-docker-attach-1270d0475bb1?source=collection_archive---------9-----------------------#2022-06-24">https://betterprogramming.pub/how-to-access-a-docker-container-secure-shell-vs-docker-attach-1270d0475bb1?source=collection_archive---------9-----------------------#2022-06-24</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="5cf2" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">简短的教程教学是每个DevOps工程师的基本技能</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/834efba56165b01bcd7e79f5c25e13b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RZKY4ywZTSfp9DgmyDlJAA.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@rubaitulazad?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Rubaitul Azad </a>在<a class="ae kz" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="5440" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">今天，最流行的容器技术之一是Docker，它被广泛用于运行各种不同的应用程序。</p><p id="ead8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">使用Docker容器的一项基本技能是知道如何连接到正在运行的容器来修改数据、调试或执行命令。</p><p id="b09c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇短文中，我描述了两种连接到正在运行的Docker容器的不同方法。</p><h1 id="08f1" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">1.使用Docker Exec附加到运行中的容器</h1><p id="4656" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">通过shell访问容器的最有用的命令是通过执行<code class="fe mt mu mv mw b">docker exec -it</code>来完成的。</p><p id="94b0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这是因为以下原因:</p><p id="165e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe mt mu mv mw b">docker exec</code>在Docker环境中运行新命令</p><p id="28f6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe mt mu mv mw b">-i</code>:保持STDIN打开，即使没有连接</p><p id="7929" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe mt mu mv mw b">-t</code>:分配一个伪TTY</p><p id="c381" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe mt mu mv mw b">-it</code>:结合<code class="fe mt mu mv mw b">-i</code>和<code class="fe mt mu mv mw b">-t</code>与流程交互</p></div><div class="ab cl mx my hy mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="in io ip iq ir"><p id="97f6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要对此进行测试，请使用以下命令启动一个新的测试容器:</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="5a21" class="ni lx iu mw b gz nj nk l nl nm">docker run --name nginx --rm -p 8080:80  -d nginx</span></pre><p id="5278" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">容器成功启动后，您可以执行前面解释的命令，并添加容器名<code class="fe mt mu mv mw b">nginx</code>和<code class="fe mt mu mv mw b">bash</code>来执行bash。</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="fab8" class="ni lx iu mw b gz nj nk l nl nm">docker exec -it nginx bash</span><span id="256e" class="ni lx iu mw b gz nn nk l nl nm"># the shell will be opened as root user<br/>root@b24af25732a2:/#</span></pre><p id="fd13" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以随时通过按下<code class="fe mt mu mv mw b">control + d</code>或在shell中键入<code class="fe mt mu mv mw b">exit</code>来退出附加的shell。</p></div><div class="ab cl mx my hy mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="in io ip iq ir"><p id="ecf2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通常，如果您使用Alpine Docker图像，默认情况下<code class="fe mt mu mv mw b">bash</code>不会安装。您可以通过使用<code class="fe mt mu mv mw b">sh</code> -shell来访问容器:</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="0200" class="ni lx iu mw b gz nj nk l nl nm">docker exec -it nginx sh</span></pre><p id="eb66" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">另一种方法是创建一个新的docker文件，并添加以下内容:</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="98d8" class="ni lx iu mw b gz nj nk l nl nm">FROM nginx:alpine</span><span id="bc25" class="ni lx iu mw b gz nn nk l nl nm">RUN apk update &amp;&amp; apk add bash</span></pre><p id="186a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然后，您必须构建并标记图像，如下所示:</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="4f81" class="ni lx iu mw b gz nj nk l nl nm">docker build -t nginx-2</span></pre><p id="3507" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然后运行它(使用不同名称/端口)</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="3801" class="ni lx iu mw b gz nj nk l nl nm">docker run — name nginx2 — rm -p 81801:80 -d nginx-2</span></pre><p id="2b2c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">之后，您可以用<code class="fe mt mu mv mw b">bash</code>连接到容器上</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="b9a3" class="ni lx iu mw b gz nj nk l nl nm">docker exec -it nginx bash</span></pre></div><div class="ab cl mx my hy mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="in io ip iq ir"><p id="e00c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有时，您会使用没有安装任何shell的容器。因此，在普通的Docker环境中，无法在容器中获取shell。如果您仍然想要一个shell，那么您应该通过创建一个新的Dockerfile来创建一个新的容器，并使用它来代替基本映像。</p><h1 id="5970" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">2.使用Docker Attach连接到正在运行的容器</h1><blockquote class="no np nq"><p id="fdb9" class="la lb nr lc b ld le jv lf lg lh jy li ns lk ll lm nt lo lp lq nu ls lt lu lv in bi translated"><em class="iu"/><code class="fe mt mu mv mw b"><em class="iu">docker attach</em></code><em class="iu">命令使用容器的</em> <code class="fe mt mu mv mw b"><em class="iu">id</em></code> <em class="iu">或</em> <code class="fe mt mu mv mw b"><em class="iu">name</em></code> <em class="iu">将终端的标准输入、输出和错误附加到运行中的容器。(来源</em>【docker.com】<em class="iu"/><em class="iu">)</em></p></blockquote><p id="07c9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这意味着您在打开的shell中输入的所有内容都将被转发到容器中，并且容器中的所有内容都将显示在您的控制台中。</p><p id="8ebf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果之前创建的容器仍在运行，可以使用以下命令将控制台连接到它:</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="580e" class="ni lx iu mw b gz nj nk l nl nm">docker attach nginx</span></pre><p id="d925" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您还没有接触Nginx web服务器，您将不会在控制台中看到任何输出。</p><p id="823c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在浏览器中打开<code class="fe mt mu mv mw b"><a class="ae kz" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></code>，Nginx会生成一些日志。它应该如下所示:</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="03ff" class="ni lx iu mw b gz nj nk l nl nm">10.100.128.1 - - [26/Apr/2022:07:42:56 +0000] "GET / HTTP/1.1" 200 615 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.84 Safari/537.36 OPR/85.0.4341.72" "-"</span><span id="b58f" class="ni lx iu mw b gz nn nk l nl nm">2022/04/26 07:42:56 [error] 33#33: *2 open() "/usr/share/nginx/html/favicon.ico" failed (2: No such file or directory), client: 10.100.128.1, server: localhost, request: "GET /favicon.ico HTTP/1.1", host: "localhost:8080", referrer: "http://localhost:8080/"</span><span id="9e3d" class="ni lx iu mw b gz nn nk l nl nm">10.100.128.1 - - [26/Apr/2022:07:42:56 +0000] "GET /favicon.ico HTTP/1.1" 404 555 "http://localhost:8080/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.84 Safari/537.36 OPR/85.0.4341.72" "-"</span></pre><p id="5911" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通常情况下，你现在可以按下<code class="fe mt mu mv mw b">control+c</code>从窗口中分离出来，重新开始在你的shell中工作。当您在这里使用<code class="fe mt mu mv mw b">docker attach</code>命令时，您的输入被转发到容器，按下<code class="fe mt mu mv mw b">control + c</code>也将触发容器内的kill信号，该信号将被关闭。</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="475b" class="ni lx iu mw b gz nj nk l nl nm">10.100.128.1 - - [26/Apr/2022:07:46:35 +0000] [notice] 1#1: signal 2 (SIGINT) received, exiting</span><span id="39dd" class="ni lx iu mw b gz nn nk l nl nm">10.100.128.1 - - [26/Apr/2022:07:46:35 +0000] [notice] 32#32: exiting</span></pre><p id="44c1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">从一个附加的容器上分离可能很棘手，因为<code class="fe mt mu mv mw b">control + c</code>是用来分离和杀死一个容器的。为了能够在不停止容器的情况下分离，您可以在连接容器时禁用转发信号。</p><p id="efea" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">首先，再次启动容器，因为它是使用以下命令终止的:</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="8936" class="ni lx iu mw b gz nj nk l nl nm">docker run --name nginx --rm -p 8080:80  -d nginx</span></pre><p id="ab9f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然后再次连接到容器并禁用转发信号。</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="5abd" class="ni lx iu mw b gz nj nk l nl nm">docker attach --sig-proxy=false nginx</span></pre><p id="d08c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，你可以用<code class="fe mt mu mv mw b">control + c</code>拆下容器而不杀死它。</p><h1 id="80d9" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">结论</h1><p id="0d97" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">我希望本教程对您有所帮助，现在您知道了两个不同的命令来连接容器:<code class="fe mt mu mv mw b">docker exec</code>和<code class="fe mt mu mv mw b">docker attach</code>。</p><p id="7a05" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe mt mu mv mw b">docker attach</code>非常严格，因为它附加到您的控制台并将输入转发到容器。此外，您不能在容器中访问文件或进行操作。</p><p id="e3ad" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe mt mu mv mw b">docker exec</code>更加强大和流行，因为您可以运行一个允许生成新shell的新命令。然后，您可以检查进程、打开或编辑文件，并像在本地环境中一样在shell中操作。</p><p id="382d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，您可以使用<code class="fe mt mu mv mw b">docker exec</code>来执行其他命令。这不限于使用<code class="fe mt mu mv mw b">bash</code>或<code class="fe mt mu mv mw b">sh</code>。我将在另一篇文章中解释这一点。</p><p id="47f1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，如果你有任何问题，想法，建议，或想分享酷Docker命令或工具，请记下它们。我会试着回答你的问题，测试你的推荐。</p><pre class="kk kl km kn gu ne mw nf ng aw nh bi"><span id="ab01" class="ni lx iu mw b gz nj nk l nl nm"><strong class="mw iv">Want to connect?</strong></span><span id="4e22" class="ni lx iu mw b gz nn nk l nl nm">You can find me on <a class="ae kz" href="https://www.linkedin.com/in/paulknulst/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a> and <a class="ae kz" href="https://github.com/paulknulst" rel="noopener ugc nofollow" target="_blank">GitHub</a>!</span></pre></div><div class="ab cl mx my hy mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="in io ip iq ir"><p id="efc0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="nr">本文最初发表于我的博客</em><a class="ae kz" href="https://www.paulsblog.dev/how-to-access-a-docker-container-secure-shell-vs-docker-attach/" rel="noopener ugc nofollow" target="_blank"><em class="nr">https://www . paulsblog . dev/how-to-access-a-docker-container-secure-shell-vs-docker-attach/</em></a></p></div></div>    
</body>
</html>