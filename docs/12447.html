<html>
<head>
<title>How to Quickly Create a Custom Image With Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Docker快速创建自定义图像</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/docker-quickly-create-a-custom-image-372cd1e2a450?source=collection_archive---------19-----------------------#2022-06-06">https://betterprogramming.pub/docker-quickly-create-a-custom-image-372cd1e2a450?source=collection_archive---------19-----------------------#2022-06-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d640" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">集装箱化的新手？你猜对了！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/63fe9d97dfb7789af86f68ff20ead68e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iMmU3yVy1y1vABAHH0i8KA.png"/></div></div></figure><p id="d1ab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Docker为用户提供了一种快速开发、发布和运行应用程序的方式。我只是刚刚开始了解这个平台的皮毛。</p><p id="1f9f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本演练面向像我一样对Docker和容器化相对陌生的人。本文的目的是介绍一种创建和部署Docker容器的简单方法，其中包含一个表示容器部署日期的文件。</p><h1 id="8c14" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated"><strong class="ak">先决条件和资源考虑</strong></h1><ul class=""><li id="e59a" class="mg mh iq kt b ku mi kx mj la mk le ml li mm lm mn mo mp mq bi translated">我将利用<a class="ae ln" href="https://aws.amazon.com/cloud9/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> AWS Cloud9 </strong> </a>作为我的IDE(集成开发环境)。这项服务非常适合那些需要快速管理无服务器工作流的Docker新手，他们可以专注于开发而不是安装必要的工具。它预先打包了流行的SDK、插件、库和编程语言。如果你选择不使用Cloud9，你将不得不<a class="ae ln" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">安装Docker </a>，以及其他必要的工具。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/348b76d6dbb4a1dad8c4f87c5405c01e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pZCCY2jLtQA1v-QCd662kw.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">Cloud9设置:Shell — <strong class="bd mw">创建一个新的EC2实例</strong>，实例类型— <strong class="bd mw"> t2.micro </strong>，平台— <strong class="bd mw"> Ubuntu 18.04 LTS </strong></p></figure><p id="5314" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦创建了Cloud9环境，向安全组添加一个入站规则，以允许实例访问端口80。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/a8f06700b660604331f05ef68661750e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4X4OOvnMIOtvPeROErjXyg.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">导航到EC2以识别Cloud9实例，然后从仪表板中选择“Security groups”以添加入站规则。</p></figure><ul class=""><li id="5af3" class="mg mh iq kt b ku kv kx ky la my le mz li na lm mn mo mp mq bi translated"><a class="ae ln" href="https://aws.amazon.com/ecr/?trk=d66ebef2-a56b-4c4d-9630-4d0838c2f114&amp;sc_channel=ps&amp;sc_campaign=acquisition&amp;sc_medium=ACQ-P|PS-GO|Non-Brand|Desktop|SU|Containers|Solution|US|EN|DSA&amp;ef_id=Cj0KCQjwheyUBhD-ARIsAHJNM-PSwubdCm0gDMZobSdceSiNSkrTNoBZ-oZqRM303XED7oPiD7cXDn0aAs3eEALw_wcB:G:s&amp;s_kwcid=AL!4422!3!579408225584!!!g!!" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> AWS弹性容器注册表</strong> </a> ( <strong class="kt ir"> ECR </strong> ) —创建自定义图像创建容器后，数据会保存到ECR。这将提供一种安全、高可用性的方法来保存和发布容器图像。</li></ul></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="f94c" class="lo lp iq bd lq lr ni lt lu lv nj lx ly jw nk jx ma jz nl ka mc kc nm kd me mf bi translated"><strong class="ak">使用Dockerfile文件创建容器</strong></h1><p id="5949" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">一个<a class="ae ln" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank"> Dockerfile </a>是一个简单的文本文件，包含了组装一个定制图像所需的所有指令。Dockerfile易于复制且高效，允许开发人员快速创建容器，而无需在CLI中使用长字符串。</p><ol class=""><li id="e182" class="mg mh iq kt b ku kv kx ky la my le mz li na lm nq mo mp mq bi translated">在Cloud9中，使用下面的命令打开一个终端来提取NGINX映像:<code class="fe nr ns nt nu b">$ docker pull nginx:latest</code>。要确认图像已被提取，请运行命令<code class="fe nr ns nt nu b">$ docker images</code>。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/e9b3dcc90a5fdc9e144141bcc0c84844.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u90ZOrSu1V0Mw5CsPeCf-A.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">Dockerfile将在创建容器的命令中引用这个图像。</p></figure><p id="f886" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">2.在您想要的目录中创建Docker文件，确保保持大写以便Docker能够识别它。(* *如果使用终端，确保使用<code class="fe nr ns nt nu b">$ cd ,name-of-directory&gt;</code>进入所需目录，并使用命令<code class="fe nr ns nt nu b">$ touch Dockerfile</code>创建文件。)创建完成后，打开文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/05f6b414285e79fe91f91e4afbcde252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0oBrqpa_vlMznbbaMPt-fg.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">我在Cloud9的环境窗格中直接创建了Dockerfile，以确保它位于正确的目录中。</p></figure><p id="292c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">3.在docker文件中，您希望根据<a class="ae ln" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank">文档</a>为您想要构建的映像提供说明。出于本演练的目的，我们将使用一个<strong class="kt ir"> NGINX </strong>基本映像，使用<strong class="kt ir">端口8080 </strong>，以及一个包含容器部署日期的文件。</p><p id="0da4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，您将需要创建一个index.html，其中包含提供容器部署日期的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">对于index.html，请随意查看其他方法来更改代码，使网页独特，如改变颜色和字体！</p></figure><p id="3ea9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">4.在包含Dockerfile文件的目录中，使用<code class="fe nr ns nt nu b">$ docker build -t nginx1 .</code>构建新的映像。<em class="nz"> </em> ( <em class="nz">我将这张图片命名为</em> <code class="fe nr ns nt nu b">nginx1</code> <em class="nz">以区别于我从资源库中提取的图片。)</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/5585740e78929db22f104a308626a1dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v8wP-2Ps9gcBd9zGcLzAdw.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">确认图像是使用$ docker图像构建的</p></figure><p id="d221" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用<code class="fe nr ns nt nu b">$ docker run -d --name &lt;container-name&gt; -p 8080:80 nginx1</code>从这个新的定制图像创建容器。该命令将创建具有自定义名称的容器(—如果不包括<code class="fe nr ns nt nu b">--name</code>选项，将随机为容器分配一个名称)，在后台运行容器(<code class="fe nr ns nt nu b">-d</code>，在端口80将容器的端口8080暴露给公共互联网(<code class="fe nr ns nt nu b">-p 8080:80</code>，并使用自定义映像(<code class="fe nr ns nt nu b">nginx</code>)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/06e23730aaa75de9736f676d83adb4b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*urkRAEpLC33MFtElqJZEuw.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">确认已经使用$ docker ps创建了容器</p></figure><p id="49d7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">5.使用<code class="fe nr ns nt nu b">$ curl localhost:8080</code>确认容器文件能够通过指定端口(8080)访问互联网。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/91062cc880f83cb2419abf1ef52f2ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BsJ-Z1vxbMuTJ3GFyVWfGA.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">如果成功，输出应该如上所示，并显示index.html页面代码。</p></figure><p id="6687" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于我们使用的是Cloud9，我们需要使用运行环境的EC2实例的公共IP，通过将<code class="fe nr ns nt nu b">&lt;public-ip-address-of-instance&gt;:8080</code>粘贴到搜索栏来在浏览器中进行测试。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/93de1244aa52df9d71dd0a928d9b765d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e-2tEpaoRB5HPi0jCl9uWw.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">页面根据Dockerfile指令正确运行脚本！</p></figure><p id="687d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> <em class="nz">提示</em> </strong> <em class="nz">:让页面变得有创意，在html中改变颜色和样式，以获得一些不同的东西..</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/5c23e5487ba612b1ad43220a6ec4da25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O-zqfMZhop3iKNVtZlj8wQ.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">这张图片是使用一些样式选项的index.html的另一个视图。</p></figure></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="8f1d" class="lo lp iq bd lq lr ni lt lu lv nj lx ly jw nk jx ma jz nl ka mc kc nm kd me mf bi translated">通过将集装箱数据推送到AWS ECR来保存集装箱数据</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/41e95ca2e71a844531cbd65da775d2b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zleE9_glbMjXtnB72YfIMQ.png"/></div></div></figure><ol class=""><li id="10f9" class="mg mh iq kt b ku kv kx ky la my le mz li na lm nq mo mp mq bi translated">从<strong class="kt ir"> AWS管理控制台</strong>，导航到<strong class="kt ir">弹性容器注册→创建库→ </strong> <em class="nz">选择</em> <strong class="kt ir">“开始”</strong>。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/5ce6ca35e78364ab3836c88bc89eebe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2hkOJ3exPp2DH-OStkPueQ.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">选择所需的可见性设置和存储库名称，保留其他默认设置，然后单击“<strong class="bd mw">创建存储库</strong>”。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/ebb6ee4d5cf08cab68158f69ccdc6182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hIFu2gB0pxoApocWcPpWhQ.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">选择<strong class="bd mw">查看推送命令</strong>以访问弹出窗口，该窗口将提供用于将容器数据推送到存储库的CLI命令。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/0a38b89bfd896cfcdd8eec5e84bae70c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o5zMmhbP0rGioE9Ix1Ya7w.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">复制步骤1的命令，并在终端中运行它。跳过步骤2，因为映像已经构建好了。对于第3步，修改命令以在“docker tag”后包含image标记，而不是repo名称。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/82f27b7e698331e774eb3e33199eae44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jc373kYRwr-GURmgIH7SHA.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">步骤4的输出应该如上图所示。</p></figure><p id="e7c8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完成推送命令后，您创建的自定义图像应该出现在ECR中的<strong class="kt ir">图像</strong>中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/cc1cb2ee1b35ee39e9290585892ff0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Csf4brBfw_KkZ6DncxLpww.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">上图显示push命令成功地将自定义映像推送到ECR存储库。</p></figure><p id="fb4e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">确保使用<code class="fe nr ns nt nu b">$ docker rm -f $(docker ps -a -q)</code>(用于容器)和<code class="fe nr ns nt nu b">$ docker rmi -f $(docker images -a -q)</code>(用于创建的任何图像)移除终端中的容器和图像。</p><p id="e753" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在图像存储在ECR中，可以提取以备将来使用！</p></div></div>    
</body>
</html>