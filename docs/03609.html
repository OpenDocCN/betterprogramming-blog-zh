<html>
<head>
<title>Learn GraphQL by Building a Github Client</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过构建Github客户端来学习GraphQL</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/learn-graphql-by-building-a-github-client-15c312932e65?source=collection_archive---------3-----------------------#2020-02-21">https://betterprogramming.pub/learn-graphql-by-building-a-github-client-15c312932e65?source=collection_archive---------3-----------------------#2020-02-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4362" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">掌握React中GraphQL的基础知识</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ff245ee64608274469bafc384a03f00b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hto8q9q7m5QCGaNl.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=3357642" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/TheDigitalArtist-202249/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=3357642" rel="noopener ugc nofollow" target="_blank">皮特·林弗斯</a></p></figure><p id="9ca8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GraphQL是一种由脸书开发的查询语言，作为REST的替代品已经变得非常流行。在本教程中，我们将构建一个使用GraphQL从Github提取数据的React应用程序。</p><p id="41dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你根本没有听说过GraphQL，我建议你从这篇文章开始。它解释了GraphQL、REST和SQL之间的区别，并介绍了术语:</p><div class="lv lw gp gr lx ly"><a href="https://medium.com/javascript-in-plain-english/what-exactly-is-graphql-7a4fc930eae7" rel="noopener follow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">GraphQL到底是什么？</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">GraphQL的目的是为数据获取和操作提供一种查询语言。它不完全是SQL，也不是…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">medium.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="93aa" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">我们正在建造的东西</h1><p id="d863" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我们将构建一个简单的React应用程序，通过名称查找存储库并显示相关信息。这是我们完成教程后的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/c0ccf01f7e626e3eb0b54bb228179a40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*jnofl710bfW18S1x"/></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="e424" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第一步。生成访问令牌</h1><p id="6fdb" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">在深入研究代码之前，我们需要创建一个访问令牌。访问令牌用于授权API调用，并且是与Github进行任何通信所必需的。要获取它，打开<a class="ae ky" href="https://github.com/settings/tokens" rel="noopener ugc nofollow" target="_blank">https://github.com/settings/tokens</a>并点击“生成新令牌”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/b186d1e46831527c84acb3edebd1a47c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*SAa2ucJjgpOox4bX"/></div></figure><p id="661d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于我们的目的，我们需要<code class="fe ns nt nu nv b">public_repo</code>范围——其他的是可选的。创建令牌后，请将其复制到安全的地方，稍后您会需要它。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="5c35" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第二步。创建新的React应用程序</h1><p id="66b9" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我们使用React来构建我们的应用程序。要创建它，请在命令行中运行以下命令:</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="21ad" class="oa mv it nv b gy ob oc l od oe">npm init react-app react-graphql-client</span></pre><p id="8f7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在实用程序创建完应用程序后，我们需要安装一些依赖项。我们使用<code class="fe ns nt nu nv b"><a class="ae ky" href="https://material-ui.com/" rel="noopener ugc nofollow" target="_blank">material-ui</a></code>作为组件库，使用<code class="fe ns nt nu nv b"><a class="ae ky" href="https://www.npmjs.com/package/apollo-boost" rel="noopener ugc nofollow" target="_blank">apollo-boost</a></code>、<code class="fe ns nt nu nv b"><a class="ae ky" href="https://www.npmjs.com/package/@apollo/react-hooks" rel="noopener ugc nofollow" target="_blank">apollo/react-hooks</a></code>和<code class="fe ns nt nu nv b"><a class="ae ky" href="https://www.npmjs.com/package/graphql" rel="noopener ugc nofollow" target="_blank">graphql</a></code>进行GraphQL通信:</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="9e4f" class="oa mv it nv b gy ob oc l od oe">npm i --save @material-ui/core @material-ui/icons apollo-boost @apollo/react-hooks graphql</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="7788" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第三步。保护访问令牌</h1><p id="465f" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我们将在整个应用程序中引用Github API令牌，但是将它直接放在源代码中是不好的做法。另外，你应该<em class="of">永远不要</em>在你的VCS中有API键。为了解决这个问题，使用了一个<code class="fe ns nt nu nv b">.env</code>文件。在项目根目录下创建一个<code class="fe ns nt nu nv b">.env</code>文件，并将这一行放入其中:</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="0281" class="oa mv it nv b gy ob oc l od oe">REACT_APP_GITHUB_KEY = your_key_goes_here</span></pre><p id="b24e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一行将使<code class="fe ns nt nu nv b">REACT_APP_GITHUB_KEY</code>作为一个环境变量被注入到你的应用程序中。它将作为<code class="fe ns nt nu nv b">process.env.REACT_APP_GITHUB_KEY</code>提供。确保不要提交此文件！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="7f87" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第四步。下载模式</h1><p id="2dca" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">GraphQL的一个很大的优点是语法突出和严格的类型。要为您的IDE启用语法高亮，创建一个名为<code class="fe ns nt nu nv b">.graphqlconfig</code>的文件，并将以下内容放入其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="ba5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用这个文件，您需要安装一个扩展。如果你用的是WebStorm，那就叫<a class="ae ky" href="https://plugins.jetbrains.com/plugin/8097-js-graphql" rel="noopener ugc nofollow" target="_blank"> <em class="of"> JS GraphQL </em> </a>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/a8c227eb59ad5826d2ba13c1bfb9ec7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/0*OfotS-flmE4Ediff.png"/></div></figure><p id="15b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于VS代码，只需<a class="ae ky" href="https://marketplace.visualstudio.com/items?itemName=kumar-harsh.graphql-for-vscode" rel="noopener ugc nofollow" target="_blank"> <em class="of"> GraphQL </em> </a>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/dcc3b35a10b9a4ff2b66a81b4a0235b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*RPC3coE374Ps7krk"/></div></figure><p id="3751" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装后，它会提示您下载在<code class="fe ns nt nu nv b">.graphqlconfig</code>文件中定义的模式。有了这个模式，语法自动补全应该可以工作了。一个重要的注意事项:您需要您的API令牌来访问模式。这不是一个完美的解决方案，这也意味着你不应该把<code class="fe ns nt nu nv b">.graphqlconfig</code> <strong class="lb iu"> </strong>也交给VCS。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="9ef0" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第四步。定义查询</h1><p id="afc2" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">在我们开始编写React代码之前，让我们停下来想一想我们需要什么样的GraphQL查询。查询是用GraphQL语言编写的表达式，用于从服务器(在我们的例子中是从Github)检索数据。您可以在<a class="ae ky" href="https://developer.github.com/v4/" rel="noopener ugc nofollow" target="_blank"> Github API参考</a>中找到支持的查询列表。</p><p id="f2ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可能希望通过名称搜索存储库，并获得它们的描述和链接。<code class="fe ns nt nu nv b">search</code>查询将适合这种情况。能够查看回购的未结问题也很好——这是通过<code class="fe ns nt nu nv b">repository</code>查询完成的。</p><p id="4185" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ns nt nu nv b">src</code>文件夹中创建一个文件<code class="fe ns nt nu nv b">queries.js</code>，并将以下代码放入其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="c11a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们从从<code class="fe ns nt nu nv b">graphql-tag</code>导入<code class="fe ns nt nu nv b">gql</code>标签开始。它帮助格式化和解析GraphQL查询。在第3-23行，我们定义了第一个查询<code class="fe ns nt nu nv b">SEARCH_FOR_REPOS</code>。它接受<code class="fe ns nt nu nv b">search_term</code>作为参数(第5行),并将返回前20个匹配的存储库。响应将包括匹配存储库的总数(第6行)、每个回购的名称(第10行)、每个所有者的用户名(第11-13行)、星级数(第14-16行)和描述(第18行)。</p><p id="bb5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的第二个查询<code class="fe ns nt nu nv b">GET_REPO_ISSUES</code>，将根据名称和所有者查找存储库的前20个问题。它还将按日期、新旧对这些问题进行排序。响应包括问题的标题、正文和时间戳(第30-32行)。</p><h2 id="1150" class="oa mv it bd mw oj ok dn na ol om dp ne li on oo ng lm op oq ni lq or os nk ot bi translated">旁注:在线测试你的查询</h2><p id="f487" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">虽然我们的应用程序还没有准备好，但你已经可以使用<a class="ae ky" href="https://developer.github.com/v4/explorer/" rel="noopener ugc nofollow" target="_blank"> Github GraphQL Explorer </a>来测试你的查询了。例如，通过使用<code class="fe ns nt nu nv b">search_term: "React"</code>调用我们的第一个查询，您将得到以下响应:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="0b66" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第五步。创建搜索栏</h1><p id="98b7" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">现在是时候开始研究UI了。我们的应用程序将有一个标题，一个搜索栏来搜索回购，回购列表，以及点击回购扩展的功能，它会向您显示最近20个未决问题。让我们从删除src文件夹中的所有内容开始，除了<code class="fe ns nt nu nv b">index.js</code>、<code class="fe ns nt nu nv b">App.js</code>和<code class="fe ns nt nu nv b">serviceWorker.js</code>。然后，创建一个<code class="fe ns nt nu nv b">SearchBar.js</code>并将这段代码放入其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="bc4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不熟悉<code class="fe ns nt nu nv b">material-ui</code>，可以先阅读<a class="ae ky" href="https://material-ui.com/" rel="noopener ugc nofollow" target="_blank">的文档</a>。在这个组件中，我们呈现了一个简单的文本输入，带有一个搜索图标和一些基本的样式。请注意，<code class="fe ns nt nu nv b">SearchBar</code>是一个由<em class="of">控制的</em>组件:它从props接受它的值，并在您键入时触发<code class="fe ns nt nu nv b">onChange</code>回调。</p><p id="7aaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>由于我们删除了<code class="fe ns nt nu nv b">index.css</code>并且<code class="fe ns nt nu nv b">index.js</code>导入了它，你需要从<code class="fe ns nt nu nv b">index.js</code>删除第三行。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="da60" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第六步。创建存储库列表</h1><p id="0137" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">现在我们有了一个搜索栏，让我们写一个存储库列表。创建一个<code class="fe ns nt nu nv b">RepositoryList.js</code>文件，并将以下代码放入其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="0b2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还没有任何实际的数据，所以我们只是让用户知道目前没有存储库。在我们继续下一步之前，有必要把所有的东西放在一起，以确保我们在正确的轨道上。打开<code class="fe ns nt nu nv b">App.js</code>，编辑如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="2acd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在其中，我们只是渲染一个标题和我们的两个组件。要打开应用程序，从项目根目录下的终端运行<code class="fe ns nt nu nv b">npm start</code>。编译完成后，您应该会看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/11e0cc5570ff27428b33cab72ad4f498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*1HzSjFBf9NSNom_7"/></div></figure><p id="e2ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜，我们成功了一半！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="4336" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第七步。建立阿波罗</h1><p id="cbad" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">在我们发出任何API请求之前，我们需要用一个<code class="fe ns nt nu nv b">ApolloProvider</code>包装我们的应用程序。Apollo是GraphQL的客户端库，它为React提供绑定。一个提供商将为我们应用程序中的每个组件提供Apollo客户端，使其更易于使用。如果您熟悉Redux Provider，它的工作方式与Redux Provider类似。要添加提供者，我们需要首先创建一个客户机。用下面的代码创建一个新文件<code class="fe ns nt nu nv b">client.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="7bd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码将创建一个连接到Github API的Apollo客户端。注意我们如何使用环境变量在第六行提取API令牌。因此，将该文件提交给VCS是100%安全的。</p><p id="34b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将与<code class="fe ns nt nu nv b">App.js</code>的提供商一起使用这个客户端:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="e5ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时您不会注意到任何视觉差异，所以不要惊慌，继续下一步。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="21f2" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第八步。查询存储库</h1><p id="ec70" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">最后，是时候做一些实际的查询了！为此，需要一个新的依赖项:<code class="fe ns nt nu nv b">use-debounce</code>。这解决了去抖动的问题，确保你不会在每次击键时都调用API，这将是低效的，但是将它限制在某个时间范围内。要安装它，请在项目根目录下运行以下命令:</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="8f79" class="oa mv it nv b gy ob oc l od oe">npm i --save use-debounce</span></pre><p id="ae87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们需要从<code class="fe ns nt nu nv b">SearchBox</code>中获取搜索词，并将其传递给<code class="fe ns nt nu nv b">RepositoryList</code>。这在<code class="fe ns nt nu nv b">App.js</code>中完成:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="a5c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，使用这个术语，<code class="fe ns nt nu nv b">RepositoryList</code>可以执行查询。这样更新<code class="fe ns nt nu nv b">RepositoryList.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="9639" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，注意第21行中<code class="fe ns nt nu nv b">useDebounce</code>的使用。它接受两个参数:我们想要去抖的值和时间间隔。它返回一个最多每秒更新一次的值(可以随意调整时间间隔)。</p><p id="247f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第22–24行，我们使用<code class="fe ns nt nu nv b">useQuery</code>钩子从Github API获取数据。它接受我们在第四步中定义的<code class="fe ns nt nu nv b">SEARCH_FOR_REPOS</code>查询和一个带选项的对象。在我们的例子中，我们需要向查询传递参数，即<code class="fe ns nt nu nv b">search_term</code>。<code class="fe ns nt nu nv b">useQuery</code>当这些发生变化时会重新运行查询，所以您不必担心。</p><p id="19f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ns nt nu nv b">useQuery</code> <a class="ae ky" href="https://www.apollographql.com/docs/react/api/react-hooks/#usequery" rel="noopener ugc nofollow" target="_blank">返回一个有很多字段的对象</a>，但是我们感兴趣的是<code class="fe ns nt nu nv b">data</code>、<code class="fe ns nt nu nv b">loading</code>和<code class="fe ns nt nu nv b">error</code>。这些都是不言自明的，你可以在26-45行看到我们是如何使用它们的。你可以通过将<code class="fe ns nt nu nv b">data</code>登录到控制台，使用<a class="ae ky" href="https://developer.github.com/v4/explorer/" rel="noopener ugc nofollow" target="_blank"> Github API Explorer </a>，或者安装<a class="ae ky" href="https://github.com/apollographql/apollo-client-devtools" rel="noopener ugc nofollow" target="_blank"> Apollo DevTools扩展</a>来探索数据结构。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="98ed" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第九步。渲染存储库信息</h1><p id="2952" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">现在我们有了数据，并能够渲染它。对于每个存储库，我们想要显示它的名称、所有者和描述。为此，我们需要一个新组件<code class="fe ns nt nu nv b">Repository</code>。在<code class="fe ns nt nu nv b">Repository.js</code>中创建:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="b12a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该组件接受道具<code class="fe ns nt nu nv b">repo</code>、<code class="fe ns nt nu nv b">expanded</code>和<code class="fe ns nt nu nv b">onToggled</code>。<code class="fe ns nt nu nv b">repo</code>是包含存储库数据的对象，<code class="fe ns nt nu nv b">expanded</code>是true，如果该组件被展开(以查看问题)，而<code class="fe ns nt nu nv b">onToggled</code>是一个回调，将在展开或收缩该组件时被触发。</p><p id="126f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第32行，你可以看到回购是如何被分解成<code class="fe ns nt nu nv b">name</code>、<code class="fe ns nt nu nv b">descriptionHTML</code>、<code class="fe ns nt nu nv b">login</code>和<code class="fe ns nt nu nv b">totalStarCount</code>的。这些稍后用于呈现信息。由于<code class="fe ns nt nu nv b">descriptionHTML</code>是一个HTML字符串，我们在第51行使用<code class="fe ns nt nu nv b">dangerouslySetInnerHTML</code>来呈现它。</p><p id="c51b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:未经消毒/检查，切勿在生产中使用<code class="fe ns nt nu nv b">dangerouslySetInnerHTML</code> <strong class="lb iu"> </strong>。如果它来自不可信的来源，第三方可以完全控制您的网站。我们用它只是为了教育目的。</p><p id="f7a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了显示<code class="fe ns nt nu nv b">Repository</code>组件，我们需要对<code class="fe ns nt nu nv b">RepositoryList.js</code>中的<code class="fe ns nt nu nv b">RepositoryList</code>进行一些调整:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="059e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们使用第22行的<code class="fe ns nt nu nv b">expandedRepo</code>和<code class="fe ns nt nu nv b">setExpandedRepo</code>来跟踪哪个回购被打开。第28-20行的效果是每次<code class="fe ns nt nu nv b">data</code>改变时重置它，以确保当我们进行新的搜索时回购收缩。</p><p id="99d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第67–74行，我们遍历了<code class="fe ns nt nu nv b">data.search.edges</code>，它包含了一个存储库数组。对于每一个存储库，一个<code class="fe ns nt nu nv b">Repository</code>组件会呈现所有需要的信息。现在，您的应用程序应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/f423f72e9ecf9b4953b8cf116c997aa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*zQSnEqy1cGm6G5sN"/></div></figure><p id="8d91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">差不多完成了—只剩下几个问题！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="d578" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第十步。渲染问题</h1><p id="a367" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">这将非常类似于我们如何渲染存储库，所以我在这里会讲得更快一点。为了得到问题，我们需要进行另一个API调用，即第四步中的<code class="fe ns nt nu nv b">GET_REPO_ISSUES</code>。然后，在列表中显示它们，并在单击时显示描述。用以下代码创建文件<code class="fe ns nt nu nv b">IssueList.js</code>和<code class="fe ns nt nu nv b">Issue.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="82bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您看到了对<code class="fe ns nt nu nv b">useQuery</code>的熟悉调用，只是添加了新的查询和变量。注意，这里我们不需要去抖，因为我们不处理用户输入。一旦<code class="fe ns nt nu nv b">data</code>被获取，我们检查没有错误并且<code class="fe ns nt nu nv b">data</code>不为空。如果一切正常，迭代<code class="fe ns nt nu nv b">data.repository.issues.nodes</code>并为每期渲染一个<code class="fe ns nt nu nv b">Issue</code>组件。</p><p id="2fa8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ns nt nu nv b">Issue</code>组件中，呈现了一个<code class="fe ns nt nu nv b">ListItem</code>和一个<code class="fe ns nt nu nv b">Dialog</code>。<code class="fe ns nt nu nv b">ListItem</code>有问题的标题，点击打开对话框。这个对话框有发布主体的HTML代码，和你在Github上看到的一样。</p><p id="9d61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你只需要在<code class="fe ns nt nu nv b">Repository.js</code>中渲染<code class="fe ns nt nu nv b">IssueList</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="d820" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意第56行的<code class="fe ns nt nu nv b">IssueList</code>的条件渲染。这样做是为了优化，以便API请求仅在用户打开repo时发出。</p><p id="28e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是你的应用程序的最终外观:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/6497f54ee1131812c25aad6f44e6e9eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*alKluajMY3Wo4XYf"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">主视图</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/6875f8b8cf85886abcd18785e69dfa06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*xgd9PgsgeM4qKpYL"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">存储库已扩展</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/c552233a92e9e4844ea97be259c7b79b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*psLCIEquw8D5PnrN"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">问题视图</p></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="29b4" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">结束注释</h1><p id="8bc6" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">谢谢你一直坚持到最后，我希望你喜欢我的GraphQL教程。代码可在<a class="ae ky" href="https://github.com/r3dm1ke/graphql-react-tutorial" rel="noopener ugc nofollow" target="_blank"> my Github </a>上获得。如果你想知道如何改进这个应用程序，这里有一些建议:</p><ul class=""><li id="5726" class="ou ov it lb b lc ld lf lg li ow lm ox lq oy lu oz pa pb pc bi translated">能够打开各自的Github页面</li><li id="2ccb" class="ou ov it lb b lc pd lf pe li pf lm pg lq ph lu oz pa pb pc bi translated">查看对问题的评论</li><li id="3a6b" class="ou ov it lb b lc pd lf pe li pf lm pg lq ph lu oz pa pb pc bi translated">对问题发表评论</li><li id="02bc" class="ou ov it lb b lc pd lf pe li pf lm pg lq ph lu oz pa pb pc bi translated">查看readme.md</li><li id="8185" class="ou ov it lb b lc pd lf pe li pf lm pg lq ph lu oz pa pb pc bi translated">还有更多！</li></ul></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="c72a" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">资源</h1><ul class=""><li id="f1d6" class="ou ov it lb b lc nm lf nn li pi lm pj lq pk lu oz pa pb pc bi translated"><a class="ae ky" href="https://github.com/r3dm1ke/graphql-react-tutorial" rel="noopener ugc nofollow" target="_blank"> Github回购</a></li><li id="5ada" class="ou ov it lb b lc pd lf pe li pf lm pg lq ph lu oz pa pb pc bi translated"><a class="ae ky" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL主页&amp;文档</a></li><li id="99a8" class="ou ov it lb b lc pd lf pe li pf lm pg lq ph lu oz pa pb pc bi translated"><a class="ae ky" href="https://www.apollographql.com/" rel="noopener ugc nofollow" target="_blank">阿波罗主页&amp;文档</a></li></ul></div></div>    
</body>
</html>