<html>
<head>
<title>How to Supply Assets to DeFi Protocols Using JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用JavaScript向DeFi协议提供资产</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-supply-assets-to-defi-protocols-using-javascript-df6c6d31e58d?source=collection_archive---------13-----------------------#2020-06-15">https://betterprogramming.pub/how-to-supply-assets-to-defi-protocols-using-javascript-df6c6d31e58d?source=collection_archive---------13-----------------------#2020-06-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8c22" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建您的应用程序，与复合金融互动</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/abd48e32dec680667415abc943c94b7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K_B9fk4OLex0SizoDAUC3w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@mr_vero?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">欧文·史密斯</a>在<a class="ae ky" href="https://unsplash.com/s/photos/javascript?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="1457" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">DeFi已经成为以太坊生态系统中一个非常流行的用例。在撰写本文时，DeFi协议锁定了超过10亿美元。迄今为止，用开放、分散的替代产品取代现有金融产品的前景已被证明非常受欢迎。</p><p id="ad2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些DeFi平台之所以伟大，是因为它们易于开发人员使用。由于它们的开源性质，它们是可以理解的，任何愿意学习的人都可以使用。</p><p id="2786" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中最大的是复合融资，锁定价值约为1.15亿美元。任何人都可以向他们的协议提供资产，并开始从中获利，但是这个过程是如何工作的呢？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f2f9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">复合金融是如何运作的？</h1><p id="4258" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">化合物目前在九个市场发挥作用:英美烟草、戴、瑞士联邦理工学院、代表、SAI、USDC、USDT、WBTC、ZRX。这些是你可以从中赚取利息的数字资产。</p><p id="2015" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们以戴为例。一旦您向协议提供DAI，该值就被锁定，直到您决定撤销它。然而，当它在那里的时候，你同意协议可以借出那个值，因此赚取整个壶的利息。把它想象成一个储蓄账户。</p><p id="1eeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦它在那里，你可以随时查看有多少戴，目前的利率是多少，借用其他资产，等等。</p><h2 id="65e5" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">让我们来谈谈技术</h2><p id="73ed" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">从技术角度来看，这个供应过程是什么样的？</p><p id="8546" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该协议为每个受支持的市场使用符合ERC20的合同。他们被称为<em class="nl"> cTokens </em>。它们都有一个外部函数:<code class="fe nm nn no np b">mint</code>，发送所提供的值。此函数接收所提供的值，根据汇率计算cTokens的等效数量，并将它们交换为所提供的值。</p><p id="e0a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果汇率是1:1，那么提供一个ETH将导致发送方接收一个cETH。</p><p id="44f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与<code class="fe nm nn no np b">mint</code>相对的是一个叫做<code class="fe nm nn no np b">redeem</code>的函数。当用户想要提取他们的锁定值时，使用所需数量的cETH令牌调用<code class="fe nm nn no np b">redeem</code>，将根据当前汇率返回ETH的等值。</p><p id="1210" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nl">注意:还有一个</em> <code class="fe nm nn no np b"><em class="nl">redeemUnderlying</em></code> <em class="nl">函数使用基础资产单位而不是cToken单位作为输入。</em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dd72" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">编写代码</h1><p id="5802" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><em class="nl">先决条件:本演练假设您对JavaScript、Web3和以太坊智能合约有基本的了解。</em></p><p id="bebc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将按照以下步骤供应和赎回ETH以实现复合融资:</p><ol class=""><li id="6da4" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">加载cETH合同。</li><li id="d3d5" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">通过调用<code class="fe nm nn no np b">mint</code>，锁定ETH，并接收cETH令牌来提供ETH。</li><li id="1c3d" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">阅读我们的cETH平衡。</li><li id="50a2" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">读取我们锁定的ETH余额。</li><li id="d94a" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">通过提供cETH从协议中赎回ETH。</li></ol><h2 id="a463" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">步骤1:加载cETH合同</h2><p id="3666" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">每个令牌协定在每个网络上都有不同的地址。cToken合同的ABI可在<a class="ae ky" href="https://compound.finance/docs/abi/%3Cnetwork%3E/%3CcToken%3E" rel="noopener ugc nofollow" target="_blank">https://compound.finance/docs/abi/&lt;网络&gt; / &lt; cToken &gt; </a>公开获取。</p><p id="a1df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的场景中，使用cETH和Kovan testnet，我们的URL是https://compound.finance/docs/abi/kovan/cETH。</p><p id="afde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个网络上每个合同的地址可以在Compound的官方文档中找到。</p><p id="73e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用web3，我们像这样初始化我们的契约实例:</p><pre class="kj kk kl km gt oe np of og aw oh bi"><span id="1b2e" class="mz md it np b gy oi oj l ok ol">const cEthInstance = new web3.eth.Contract(cEthABI, addr);</span></pre><h2 id="5998" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">步骤2:供应ETH</h2><p id="3b66" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">图1显示了使用web3的<code class="fe nm nn no np b">send</code>功能来<code class="fe nm nn no np b">mint</code> cTokens是多么容易:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:铸造cTokens</p></figure><p id="bd80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个阶段，我们的ETH将根据当前利率开始赚取利息(也可以使用<a class="ae ky" href="https://compound.finance/docs#protocol-math" rel="noopener ugc nofollow" target="_blank">数学公式</a>计算)。</p><h2 id="a3b6" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">第三步:阅读我们的cETH余额</h2><p id="e7ca" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">因为cToken <em class="nl"> </em>契约符合ERC20，所以它们提供了一个名为<code class="fe nm nn no np b">balanceOf</code>的功能。我们可以通过调用这个并将我们的帐户地址传递给它来检查我们的cETH的余额:</p><pre class="kj kk kl km gt oe np of og aw oh bi"><span id="32a4" class="mz md it np b gy oi oj l ok ol">let b = await cEthInstance.methods.balanceOf(account).call();</span></pre><h2 id="29f4" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">步骤4:读取我们锁定的ETH余额</h2><p id="d64f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">cToken合约还提供了一个名为<code class="fe nm nn no np b">balanceOfUnderlying</code>的函数，该函数使用其拥有的CTO ken和当前汇率返回账户的基础资产价值:</p><pre class="kj kk kl km gt oe np of og aw oh bi"><span id="b996" class="mz md it np b gy oi oj l ok ol">let u = await cEthInstance.methods.balanceOfUnderlying(account).call();</span></pre><h2 id="9941" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">步骤5:从协议中赎回我们的ETH</h2><p id="1c6a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">使用步骤4中的值<code class="fe nm nn no np b">u</code>作为图2中的<code class="fe nm nn no np b">redeemAmount</code>，我们可以调用<code class="fe nm nn no np b">redeemUnderlying</code>来赎回我们的以太:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:赎回基础资产</p></figure><p id="b1a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，我们可以使用<code class="fe nm nn no np b">redeem</code>代替<code class="fe nm nn no np b">redeemUnderlying</code>，并将步骤3中的值<code class="fe nm nn no np b">b</code>作为<code class="fe nm nn no np b">redeemAmount</code>传入。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ec64" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="2bf3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">随着DeFi变得越来越容易使用并被如此多的人采用，学习如何与这些协议交互是任何开发人员工具箱中的一个有价值的工具。</p><p id="f70a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你对区块链开发感兴趣，我会写一些教程、演练、提示以及如何开始和建立投资组合的技巧。查看以下资源:</p><div class="oo op gp gr oq or"><a href="https://medium.com/blockcentric/blockchain-development-resources-b44b752f3248" rel="noopener follow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">区块链开发资源马上跟进</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">学习区块链、以太坊和DApp开发的资源列表</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">medium.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf ks or"/></div></div></a></div></div></div>    
</body>
</html>