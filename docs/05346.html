<html>
<head>
<title>What Are Truffle Scripts and How Can We Use Them?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是松露脚本，我们如何使用它们？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/what-are-truffle-scripts-and-how-can-we-use-them-88185acd86dd?source=collection_archive---------8-----------------------#2020-07-01">https://betterprogramming.pub/what-are-truffle-scripts-and-how-can-we-use-them-88185acd86dd?source=collection_archive---------8-----------------------#2020-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0ac0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个强大的工具，可用于播种您当地的区块链环境</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fb1534e03bad34ccc98946bf2eb2c898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ohRnf8u6WIttSucTzbE8Sw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·斯皮斯克在<a class="ae ky" href="/s/photos/scripts?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="cd94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在测试环境中，模仿现实生活中的用法是至关重要的。想象一下，我们正在创建一个DApp，期望迎合成千上万的用户。在我们当地的区块链上很难模仿这样的使用量。</p><p id="1bc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Truffle脚本使我们能够创建这样的定制操作，可以在我们的本地测试环境中从命令行调用这些操作。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6331" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">它们是什么？</h1><p id="1abd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Truffle脚本是JavaScript文件，我们可以创建它来执行一组自动化任务。我们可以在里面做任何我们想做的事情，只要我们遵循块菌执行所需的基本结构。图1显示了这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1: Truffle脚本结构</p></figure><p id="ee58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要运行这个脚本，我们只需在根目录中调用<code class="fe nb nc nd ne b">truffle exec truffle-script.js</code>(假设脚本也在那里)。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="481f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">浏览一个真实的例子</h1><p id="bcc3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设我们已经为分散式ERC20令牌交换创建了智能合约，用户可以用ETH交换ERC20令牌，反之亦然。在我们的本地测试环境中，如果没有用户，我们无法为前端生成价格图表和数据，因此在部署之前我们不知道它是否有效。为了模拟真实的使用，我们需要在测试环境中用虚拟数据播种契约。我们可以用块菌脚本做到这一点。</p><p id="0007" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图2向我们展示了我们已经创建的<code class="fe nb nc nd ne b">Exchange</code>契约的函数定义。为了简单起见，实现是隐藏的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:交换函数定义</p></figure><p id="5870" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要一种简单的方法来用虚拟数据填充我们的交换，这样我们就可以确保我们的接口正常工作。为此，我们创建一个种子脚本。</p><p id="d6f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的根文件夹中，我们创建了一个名为<code class="fe nb nc nd ne b">scripts</code>的新目录。然后我们创建一个名为<code class="fe nb nc nd ne b">seed-exchange.js</code>的新文件，将图1中的代码复制到其中。在继续之前，让我们测试一下这个脚本是否有效。我们在脚本中控制台登录，如图3所示，并在终端中从项目根目录运行<code class="fe nb nc nd ne b">truffle exec scripts/seed-exchange.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:登录到控制台</p></figure><p id="aa7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们应该看到<code class="fe nb nc nd ne b">“IT WORKS”</code>出现在输出中。</p><h2 id="566b" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">存放、制作和填写订单</h2><p id="0d62" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">下一步是模仿用户的行为，如果他们决定在我们的交易所交易。使用图2中的函数定义，我们将使用本地测试环境提供的帐户(<a class="ae ky" href="https://www.trufflesuite.com/ganache" rel="noopener ugc nofollow" target="_blank"> Ganache </a>)来存放资金，然后生成并完成订单。</p><p id="db7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">松露在幕后为脚本工作表演了一点“魔法”。对于我们的交换，我们需要将契约实例加载到内存中，这意味着我们需要编译后的契约ABI。我们可以使用关键字<code class="fe nb nc nd ne b">artifacts</code>获得这些信息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:向我们的交易所存放乙醚</p></figure><p id="6a9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们在图4中分解我们脚本的当前状态:</p><ul class=""><li id="2d9c" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">第2行:使用<code class="fe nb nc nd ne b">artifacts</code>关键字检索编译后的<code class="fe nb nc nd ne b">Exchange</code>合同。</li><li id="85b6" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">第5行:一个帮助器函数，我们可以用它将ETH的单位转换成Wei的单位。</li><li id="be13" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">第11行:块菌脚本的入口点。</li><li id="3939" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">第14行:检索我们可用的帐户。</li><li id="7ba1" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">第17行:创建我们的<code class="fe nb nc nd ne b">Exchange</code>契约的本地实例，这样我们就可以向它提交事务。</li><li id="f96c" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">第25行:从<code class="fe nb nc nd ne b">user1</code>到<code class="fe nb nc nd ne b">Exchange</code>存放2 ETH。</li></ul><p id="49f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过运行<code class="fe nb nc nd ne b">truffle exec scripts/seed-exchange.js</code>，我们可以看到我们的脚本按预期运行，并且<code class="fe nb nc nd ne b">user1</code>已经存放了2个ETH。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="166f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">后续步骤</h1><p id="cb68" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设我们有一个开始模拟现实生活使用的脚本，看看您是否可以扩展它来模拟订单创建、订单执行和取款。使用来自<code class="fe nb nc nd ne b">accounts</code>和循环的多个用户来播种多个订单。从第28行开始编码，这里有<code class="fe nb nc nd ne b">//…</code>注释。</p><p id="49b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">祝你好运！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4e49" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">进一步阅读</h1><p id="7d9e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果你对区块链开发感兴趣，我会写一些教程、演练、提示以及如何开始和建立投资组合的技巧。查看以下资源:</p><div class="of og gp gr oh oi"><a href="https://medium.com/blockcentric/blockchain-development-resources-b44b752f3248" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">区块链开发资源马上跟进</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">学习区块链、以太坊和DApp开发的资源列表</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">medium.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow ks oi"/></div></div></a></div></div></div>    
</body>
</html>