<html>
<head>
<title>Raspberry Pi GPIO in Go and C — Using a Shift Register and 7 Segment Display</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Go和C中的Raspberry Pi GPIO使用移位寄存器和7段显示器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/raspberry-pi-gpio-in-go-and-c-using-a-shift-register-7-segment-display-aa8ad85dec70?source=collection_archive---------5-----------------------#2021-11-23">https://betterprogramming.pub/raspberry-pi-gpio-in-go-and-c-using-a-shift-register-7-segment-display-aa8ad85dec70?source=collection_archive---------5-----------------------#2021-11-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f090" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">什么是移位寄存器和7段led，以及如何使用C &amp; Golang在Raspberry Pi上对它们进行编程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/dd2fd7ad8569331005260ea937fa2c2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A4L2IjxS6coO0UK9o7PpMw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:作者</p></figure><h1 id="68bf" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">内容</h1><ul class=""><li id="d43b" class="ln lo iq lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">概观</li><li id="80eb" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">先决条件</li><li id="f458" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">会有帮助的信息</li><li id="3071" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">什么是7段显示器？</li><li id="c9e2" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">什么是移位寄存器，它有什么用途？</li><li id="039e" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">这个项目如何使用移位寄存器和7段显示器？</li><li id="8207" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">设置和代码</li><li id="16a3" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">C语言中的移位寄存器/7段显示</li><li id="65c4" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">Go中的移位寄存器/7段显示</li><li id="ec78" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">摘要</li><li id="55b0" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">参考</li></ul><h1 id="a056" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">概观</h1><p id="34cc" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">这是探索在Raspberry Pi 3B+上进行GPIO编程的系列文章的第四篇。是对<a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/1.1.4_7-segment_display_c.html" rel="noopener ugc nofollow" target="_blank"> Sunfounder 7段显示</a>项目的补充。你可以在这里找到完整系列<a class="ae mx" href="https://youngkin.github.io/categories/gpio/" rel="noopener ugc nofollow" target="_blank"/>。该系列的代码可以在<a class="ae mx" href="https://github.com/youngkin/gpio" rel="noopener ugc nofollow" target="_blank"> github </a>上找到。</p><p id="d00b" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">像<a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/1.1.2_rgb_led_c.html" rel="noopener ugc nofollow" target="_blank"> Sunfounder RGB LED </a>项目一样，这个项目有一些复杂的方面，Sunfounder项目文档中没有很好地介绍。本文的目的就是填补这些空白，具体来说:</p><ol class=""><li id="73e9" class="ln lo iq lp b lq my ls mz lu nd lw ne ly nf ma ng mc md me bi translated">什么是“移位寄存器”(74HC595芯片)？</li><li id="6d33" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">移位寄存器的用途是什么？</li><li id="2d38" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">什么是7段显示器？</li><li id="d4ff" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">移位寄存器如何与7段显示器结合使用？</li></ol><p id="4331" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">本文的另一个目的是提供一个更完整的例子，说明使用c语言编写的程序实现移位寄存器和7段显示器的功能，该程序在这方面比Sunfounder代码先进得多。本文还将提供用Go编写的相同程序。</p><p id="b08f" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">如果你以前没有使用过LED，你应该考虑先看看我的<a class="ae mx" href="https://youngkin.github.io/post/sunfoundergpionotesled/" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi GPIO in Go和C-闪烁LED </a>。那篇文章涵盖了将LED与Raspberry Pi GPIO一起使用的基础知识，以及相关的C和Go库，这在本文中没有讨论。</p><h1 id="9f47" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">先决条件</h1><p id="82d0" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">这一节在我的<a class="ae mx" href="https://youngkin.github.io/categories/gpio/" rel="noopener ugc nofollow" target="_blank">树莓Pi GPIO系列</a>的所有文章中都有重复。如果你已经完成了这些文章中的一个项目，你可以浏览这一部分，只寻找不包括在其他项目中的必要项目，特别是移位寄存器和7段显示器。</p><p id="ad88" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">如果你没有，你需要一个树莓派。我在Raspbian OS的“拉伸”版本中使用了一个树莓派3B+。Raspberry Pi网站上有关于如何<a class="ae mx" href="https://projects.raspberrypi.org/en/projects/raspberry-pi-setting-up" rel="noopener ugc nofollow" target="_blank">从头开始安装一个新的Raspberry Pi的说明</a>，如果你决定这样做而不是购买一个完整的套件。</p><p id="4b3c" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">你需要的其他物品包括:</p><ul class=""><li id="f318" class="ln lo iq lp b lq my ls mz lu nd lw ne ly nf ma mb mc md me bi translated">一个<a class="ae mx" href="https://www.amazon.com/dp/B082KBF7MM/ref=sspa_dk_detail_4?psc=1&amp;pd_rd_i=B082KBF7MM&amp;pd_rd_w=1tGTV&amp;pf_rd_p=887084a2-5c34-4113-a4f8-b7947847c308&amp;pd_rd_wg=fX8JB&amp;pf_rd_r=44DE0RS1E9FD42RBYC7R&amp;pd_rd_r=47cbdc7f-7834-455f-9429-ef74a438bd45&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUFVVkdZVUZRNUw3ODkmZW5jcnlwdGVkSWQ9QTA4MzI4MzYyU0VLNzBJM0cxRUVMJmVuY3J5cHRlZEFkSWQ9QTA0Mjk1NTMzSzNSWlNFUjU0NURBJndpZGdldE5hbWU9c3BfZGV0YWlsJmFjdGlvbj1jbGlja1JlZGlyZWN0JmRvTm90TG9nQ2xpY2s9dHJ1ZQ==" rel="noopener ugc nofollow" target="_blank">试验板</a> <em class="nh">(你可能会发现</em> <a class="ae mx" href="https://www.sciencebuddies.org/science-fair-projects/references/how-to-use-a-breadboard" rel="noopener ugc nofollow" target="_blank"> <em class="nh">这个教程对试验板</em> </a> <em class="nh">很有帮助)</em>，</li><li id="5b67" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">一些<a class="ae mx" href="https://www.amazon.com/dp/B08HZ26ZLF/ref=syn_sd_onsite_desktop_19?psc=1&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUExRFpLWElCRjg1MUNMJmVuY3J5cHRlZElkPUEwMjMyMTE1M01aOFE3U1BQS09YSiZlbmNyeXB0ZWRBZElkPUEwODE5NTMxMktEMTlZRjEyQjBJNiZ3aWRnZXROYW1lPXNkX29uc2l0ZV9kZXNrdG9wJmFjdGlvbj1jbGlja1JlZGlyZWN0JmRvTm90TG9nQ2xpY2s9dHJ1ZQ==" rel="noopener ugc nofollow" target="_blank">跳线</a>，</li><li id="0b1a" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">一个<a class="ae mx" href="https://www.amazon.com/Resistor-Tolerance-Resistors-Assortment-Certificated/dp/B08QR72BFW/" rel="noopener ugc nofollow" target="_blank"> 220欧姆的电阻</a>，</li><li id="5e2a" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">一个<a class="ae mx" href="https://www.amazon.com/Texas-Instruments-SN74HC595N-Registers-3-State/dp/B01J6WI7RA" rel="noopener ugc nofollow" target="_blank"> 74HC595移位寄存器</a></li><li id="3138" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">一个<a class="ae mx" href="https://www.amazon.com/microtivity-7-segment-Display-Common-Cathode/dp/B004S95VJE/" rel="noopener ugc nofollow" target="_blank">共阴极七段显示器</a></li><li id="ea58" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">您还应该考虑使用一个带有T型适配器的<a class="ae mx" href="https://www.amazon.com/dp/B082PRVRYR/ref=sspa_dk_detail_2?psc=1&amp;pd_rd_i=B082PRVRYR&amp;pd_rd_w=8mKhr&amp;pf_rd_p=887084a2-5c34-4113-a4f8-b7947847c308&amp;pd_rd_wg=e9psa&amp;pf_rd_r=S09F37DF2G5FW8B8GX4B&amp;pd_rd_r=c065c120-e60b-45e9-b93b-f581f048cf46&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUFCMzhUQ09COFI2VlMmZW5jcnlwdGVkSWQ9QTA5NjU2ODUxRDkxNEYwSTYwV09KJmVuY3J5cHRlZEFkSWQ9QTAxOTg1MTUyRUhEUlc2VzQ2VDQ4JndpZGdldE5hbWU9c3BfZGV0YWlsJmFjdGlvbj1jbGlja1JlZGlyZWN0JmRvTm90TG9nQ2xpY2s9dHJ1ZQ==" rel="noopener ugc nofollow" target="_blank"> 40引脚母对母，将GPIO输出连接到试验板上。您只能使用跳线，但T型适配器将使事情变得更容易，并有助于防止损坏Raspberry Pi上的GPIO引脚。如果您选择不购买带T型适配器的40针电缆，您需要购买</a><a class="ae mx" href="https://www.amazon.com/SinLoon-Breadboard-Arduino-Circuit-40-Pack/dp/B08M3QLL3Q/ref=pd_sbs_7/143-0445142-7950409?pd_rd_w=sVLrc&amp;pf_rd_p=8b76d7a7-ab83-4ddc-a92d-e3e33bfdbf03&amp;pf_rd_r=CDM5TGJT03VKF0ZFB577&amp;pd_rd_r=8e58fd82-8503-41cf-b8f2-c78eaeb78d25&amp;pd_rd_wg=tT1U0&amp;pd_rd_i=B08M3QLL3Q&amp;psc=1" rel="noopener ugc nofollow" target="_blank">公母跳线</a>。然而，单独购买所有这些东西会比一套花费更多。</li></ul><p id="79fb" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated"><a class="ae mx" href="https://www.amazon.com/dp/B06WP7169Y/ref=sspa_dk_detail_5?psc=1&amp;pd_rd_i=B06WP7169Y&amp;pd_rd_w=OZVyf&amp;pf_rd_p=887084a2-5c34-4113-a4f8-b7947847c308&amp;pd_rd_wg=0V0IH&amp;pf_rd_r=623YJTBQ2CN2B2GYXQG5&amp;pd_rd_r=faa61f0f-3aec-4cf0-8e7e-d44eb1b3b92f&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEyUVlDQzMzVVZBMFYxJmVuY3J5cHRlZElkPUEwMzExNzk4MUhGSjFSS0VKTlBROCZlbmNyeXB0ZWRBZElkPUEwMzYwNjg2UUdMRU44N0YzNzIwJndpZGdldE5hbWU9c3BfZGV0YWlsJmFjdGlvbj1jbGlja1JlZGlyZWN0JmRvTm90TG9nQ2xpY2s9dHJ1ZQ==" rel="noopener ugc nofollow" target="_blank">这里有一个简单的套件</a>拥有所有(大部分？)以上的。套件的照片似乎显示了一个移位寄存器，但我不能肯定。我发现sun founder Raspberry Pi Ultimate Starter Kit特别有用。注意:Ultimate Starter Kit和Raphael Kit是同一产品。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/bf2262c808f770b260e261f513e1d45e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IOC3nrXvkgY0xxI-.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:<a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/1.1.4_7-segment_display_c.html" rel="noopener ugc nofollow" target="_blank"> Sunfounder </a></p></figure><p id="847c" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">您还需要一些基本的C和Go编程知识，并且熟悉登录到Raspberry Pi终端，或者登录到一些操作系统版本附带的桌面GUI。根据您采用的方法，您可能需要将键盘和显示器连接到Raspberry Pi。我只是简单地进入Pi。您还需要熟悉如何使用像vim或nano这样的编辑器。</p><p id="9b5c" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">为了编译和运行C程序，你需要<a class="ae mx" href="https://github.com/WiringPi" rel="noopener ugc nofollow" target="_blank"> WiringPi </a>库。很容易得到:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="0afa" class="no kw iq nk b gy np nq l nr ns">sudo apt-get install wiringpi</span></pre><p id="24ea" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">然后使用以下命令测试安装:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="907f" class="no kw iq nk b gy np nq l nr ns">pi@pi-node1:~/go/src/github.com/youngkin/gpio/rgbled $ gpio -v<br/>gpio version: 2.50<br/>Copyright (c) 2012-2018 Gordon Henderson<br/>This is free software with ABSOLUTELY NO WARRANTY.<br/>For details type: gpio -warranty</span><span id="dc70" class="no kw iq nk b gy nt nq l nr ns">Raspberry Pi Details:<br/>  Type: Pi 3B+, Revision: 03, Memory: 1024MB, Maker: Sony<br/>  * Device tree is enabled.<br/>  *--&gt; Raspberry Pi 3 Model B Plus Rev 1.3<br/>  * This Raspberry Pi supports user-level GPIO access.</span></pre><p id="2b47" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">在上面你会注意到<code class="fe nu nv nw nk b">gpio version: 2.50</code>。如果你使用的是Rasberry Pi 4，使用Sunfounder <a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/check_the_wiringpi_c.html" rel="noopener ugc nofollow" target="_blank">中给出的检查接线Pi </a>的说明。</p><p id="016a" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">WiringPi的独特之处在于它包括一个命令行工具<code class="fe nu nv nw nk b">gpio</code>，如上所示，可用于管理、控制和查询GPIO板。这非常方便。参见<a class="ae mx" href="http://wiringpi.com/the-gpio-utility/" rel="noopener ugc nofollow" target="_blank"> gpio参考</a>了解更多关于它能做什么和如何使用的信息。</p><p id="de35" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">如果您对在Raspberry Pi上进行Go开发感兴趣，您需要将开发环境安装到Raspberry Pi上。<a class="ae mx" href="https://www.jeremymorgan.com/tutorials/raspberry-pi/install-go-raspberry-pi/" rel="noopener ugc nofollow" target="_blank">这里有一个简单的来源</a>解释了如何实现这一点。这个源代码有点过时了，但是唯一重要的问题是Go to install的版本。来源显示正在安装围棋<strong class="lp ir">1.14.4.linux-arm64.tar.gz</strong>和<strong class="lp ir">1.14.4.linuxarmv6l.tar.gz</strong>。目前的版本是<strong class="lp ir">1.17.1.linux-arm64.tar.gz</strong>和<strong class="lp ir">1.17.1.linuxarmv6l.tar.gz</strong>。对于树莓派3B+正确的选择将是<strong class="lp ir">1.17.1.linuxarmv6l.tar.gz</strong>。另一个是为64位系统设计的，比如Raspberry Pi 4系列。你可以在<a class="ae mx" href="https://golang.org/dl/" rel="noopener ugc nofollow" target="_blank"> Golang下载网站</a>找到当前ARM版本的Go。</p><p id="5b40" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">对于Go开发，你还需要go-rpio库。</p><p id="a1dc" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">如果你想脱离Sunfounder文档的食谱风格，你需要一些Linux的基础知识。例如，我不会解释什么是根特权。</p><h1 id="4019" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">会有帮助的信息</h1><p id="6fdc" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">Sunfounder 7段显示器项目文档只是简单地介绍了如何连接试验板和代码，而没有提及太多硬件组件，尤其是移位寄存器。鉴于我对移位寄存器缺乏了解，甚至代码描述也有点混乱。我偶然发现了<a class="ae mx" href="https://docs.sunfounder.com/projects/electronic-kit/en/latest/lesson_19_7-segment.html" rel="noopener ugc nofollow" target="_blank"> Sunfounder 7段Python </a>项目文档，该文档确实提供了一些关于7段显示的有用信息，但仍然没有提到移位寄存器。这个项目不需要移位寄存器就可以轻松完成，事实上许多关于7段显示器的<a class="ae mx" href="https://www.circuitbasics.com/arduino-7-segment-display-tutorial/" rel="noopener ugc nofollow" target="_blank">其他文章</a>就是这么做的。那么这个项目为什么要用移位寄存器呢？为什么不直接将7段显示器连接到GPIO引脚？显然移位寄存器有问题，我想知道那是什么。无论如何，对我来说，这个项目实际上是关于移位寄存器，7段显示器仅仅是一个可视化移位寄存器如何工作的工具。但在讨论移位寄存器之前，我们先来简单讨论一下7段显示器。</p><h1 id="d921" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">什么是7段显示器？</h1><p id="848b" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">那么什么是7段显示器呢？嗯，说得迂腐一点，如果算上器件上的小数点，它有8段。除此之外，这是一种常见的设备，你已经很熟悉了，可以看到它们被用在从时钟到计算器和其他需要数字显示的设备上。就物理实现而言，我们需要了解一些细节。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/8982c1bc5939ac37f37d5f87b592bf07.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/0*t3OWzqMWMIYmLpZp.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">引脚排列图— <a class="ae mx" href="https://www.circuitbasics.com/arduino-7-segment-display-tutorial/" rel="noopener ugc nofollow" target="_blank"> <em class="ny">图像来源:电路基础</em> </a></p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/18fbc522c79c9fc888fac31b40792f86.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/0*WS2RDHB5DQXSNNZ7.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">LED ID图— <a class="ae mx" href="https://www.circuitbasics.com/arduino-7-segment-display-tutorial/" rel="noopener ugc nofollow" target="_blank"> <em class="ny">图像来源:电路基础</em> </a></p></figure><p id="97f2" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">首先，上面的第一张图显示了7段显示器的引脚排列。此图显示了顶部和底部的中间引脚，并带有(-)注释。这将这些引脚指定为显示器的接地引脚。其余针脚上的字母与下方LED标识图中的字母相对应。例如，给显示屏上的“A”引脚通电将点亮下方LED ID图中标有“A”的LED。字母“DP”代表小数点。</p><p id="0b40" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">对于这个项目，我们需要什么是众所周知的公共阴极7段显示器。这就是上图显示的<em class="nh">(顶部和底部的中间引脚有一个(-)标注)</em>。这意味着显示器中led的所有负极端子都连接到公共接地引脚。公共阳极是另一种类型，正如你所料，这意味着所有led的正极端子都连接到同一个引脚。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/3f958bcbaff67c8e639d6836bf140f0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gKiP7ezNVdp64pNL.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">确定共阴极或共阳极— <a class="ae mx" href="https://www.circuitbasics.com/arduino-7-segment-display-tutorial/" rel="noopener ugc nofollow" target="_blank"> <em class="ny">图像学分:电路基础知识</em> </a> <em class="ny"> &amp; </em> <a class="ae mx" href="https://fritzing.org/" rel="noopener ugc nofollow" target="_blank"> <em class="ny">烧结</em> </a></p></figure><p id="a713" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">如果您使用Sunfounder套件，7段显示器是常见的阴极显示器。如果您从其他来源获得了7段显示，您可能需要验证它的类型。确定7段显示器是公共阴极还是公共阳极相当容易。根据<a class="ae mx" href="https://www.circuitbasics.com/arduino-7-segment-display-tutorial/" rel="noopener ugc nofollow" target="_blank">如何在Arduino </a>上设置七段显示，步骤如下:</p><blockquote class="ob oc od"><p id="394b" class="mk ml nh lp b lq my jr mm ls mz ju mn oe na mp mq of nb ms mt og nc mv mw ma ij bi translated">虽然上图显示了一个Arduino，但是将它挂接到一个Raspberry Pi上是非常相似的。</p></blockquote><ol class=""><li id="f201" class="ln lo iq lp b lq my ls mz lu nd lw ne ly nf ma ng mc md me bi translated">如上图所示连接Raspberry Pi的电源(或连接到试验板的电源总线)。</li><li id="aac9" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">在试验板的两侧之间连接一个电阻，或者从电源总线连接到试验板的一侧。</li><li id="e25f" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">将一根跨接导线(红色)连接到电源电阻器的远端。</li><li id="3e9a" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">将跳线(黑色)连接到Raspberry Pi的GPIO接地引脚。</li><li id="4ed6" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">将黑色跳线(接地)连接到显示器顶部或底部的中间针脚。</li><li id="0a55" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">将红色跳线(正极)连接到任何其他引脚(除了中间的引脚！).</li></ol><p id="9d30" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">如果一个LED点亮，显示是一个共同的阴极。</p><blockquote class="ob oc od"><p id="aad4" class="mk ml nh lp b lq my jr mm ls mz ju mn oe na mp mq of nb ms mt og nc mv mw ma ij bi translated">如果指示灯不亮，请尝试以下步骤:</p></blockquote><ol class=""><li id="3744" class="ln lo iq lp b lq my ls mz lu nd lw ne ly nf ma ng mc md me bi translated">从显示器上断开跳线</li><li id="20de" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">将红色跳线连接到其中一个中间引脚，顶部或底部</li><li id="deff" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">将黑线连接到另一个针脚上。</li></ol><blockquote class="ob oc od"><p id="b482" class="mk ml nh lp b lq my jr mm ls mz ju mn oe na mp mq of nb ms mt og nc mv mw ma ij bi translated">此时，LED应该会亮起，您已经验证了该显示器是一个公共阳极显示器。如果没有LED灯亮起，则再次检查您的接线。</p></blockquote><p id="71f5" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated"><a class="ae mx" href="https://youtu.be/Fa7BHbPAM98" rel="noopener ugc nofollow" target="_blank">这段YouTube视频</a>展示了如何使用万用表来实现这一点，而不是如上所述在试验板上布线。</p><h1 id="5c1a" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">什么是移位寄存器，它有什么用途？</h1><p id="6555" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">移位寄存器有<a class="ae mx" href="https://www.elprocus.com/what-is-a-shift-register-different-types-counters-and-applications/" rel="noopener ugc nofollow" target="_blank">几种类型。对于这个项目，我们使用的是所谓的“串行输入，并行输出”(SIPO)移位寄存器。这种类型的移位寄存器将串行输入转换成并行输出。例如，单个Raspberry Pi GPIO引脚上产生的几个信号脉冲可以由移位寄存器累加，然后作为单个并行输出发送到7段显示器。这正是这个项目正在做的事情。</a></p><p id="3ba3" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">那么为什么要使用移位寄存器呢？首先，如上所述，只需要一个GPIO引脚来驱动7段显示器上的8个引脚<em class="nh">(不完全正确，这将在本文后面更详细地解释)</em>。没有移位寄存器的这个项目的版本需要8个GPIO引脚来完成同样的事情。因此，移位寄存器的一个用途是节省GPIO引脚。这对于具有大量LED的LED显示器来说尤其如此，由于缺少可用的GPIO引脚，这些LED显示器可能无法使用。虽然这不是7段显示器的真实情况，但一些设备只接受并行输入。因此，对于这种情况，在将串行源转换为并行输出时，必须使用SIPO移位寄存器。</p><h2 id="546e" class="no kw iq bd kx oh oi dn lb oj ok dp lf lu ol om lh lw on oo lj ly op oq ll or bi translated">移位寄存器解剖学</h2><p id="4308" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">74HC595移位寄存器有几个与本文相关的逻辑组件:</p><ul class=""><li id="ed9b" class="ln lo iq lp b lq my ls mz lu nd lw ne ly nf ma mb mc md me bi translated">输入移位寄存器——这是一系列相连的触发器器件，在收到每个同步时钟脉冲时接收输入(串行)数据(稍后将详细介绍)。该寄存器由从Qa '到Qh '顺序命名的输出组成，即Qa '、Qb '、…、Qh '。</li><li id="373e" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">输出或存储寄存器——这是另一系列相连的触发器器件，将串行数据并行传输到相连的器件。该寄存器由从Qa到Qh和Qh’的顺序命名的输出组成(更多关于Qh’的信息见下文)。</li></ul><p id="ed31" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">虽然有些复杂，但这种剖析在下面的图中以图形方式显示，该图来自<a class="ae mx" href="https://www.ti.com/lit/ds/symlink/cd74hc595.pdf?ts=1636840974607&amp;ref_url=https%253A%252F%252Fwww.google.com%252F" rel="noopener ugc nofollow" target="_blank">德州仪器CD74HC595带3态输出寄存器数据表</a>的8位移位寄存器。左边第一列8个框，标为C1或C2，组成输入移位寄存器。右边第二列8个框，标为C3，组成输出移位寄存器。输出寄存器的输出引脚位于最右侧，标记为Qa至Qh和Qh’。图左上角的OE、RCLK、SRCLR、SRCLK和SER所示的输入和控制通道将在下文详细讨论。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/1d71af914dce8d5df78fa37c6a433ba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sTAlIzqjp6U9SDT_.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae mx" href="https://www.ti.com/lit/ds/symlink/cd74hc595.pdf?ts=1636840974607&amp;ref_url=https%253A%252F%252Fwww.google.com%252F%22" rel="noopener ugc nofollow" target="_blank"> <em class="ny"> TI CD74HC595原理图—图片鸣谢:德州仪器</em> </a></p></figure><p id="ba1d" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">下面提供了关于寄存器输出的Q*名称的更多信息。</p><p id="e182" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">将整个器件称为移位寄存器，而将输入元件也称为移位寄存器，这有点令人困惑。为了区分这两者，如果从上下文看不清楚，我将确保在本文后面使用该术语时引用我所指的那一个。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/4ab523bcd6f59add0edbdfbbe3b97953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PFuu5EqPRYY1J5SG.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">74HC595引脚排列图— <a class="ae mx" href="https://www.ti.com/lit/ds/symlink/cd74hc595.pdf?ts=1636840974607&amp;ref_url=https%253A%252F%252Fwww.google.com%252F%22" rel="noopener ugc nofollow" target="_blank"> <em class="ny">图片来源:德州仪器</em> </a></p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/6472e690841e0bc20de2c374f6c249fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RaV-9KGosBDXh8ej.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SN744HC595N照片—图片来源:作者</p></figure><p id="78f2" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">上面的第一张图显示了SN74HC595移位寄存器的引脚排列。上面的SN74HC595N图中的照片与引脚图的方向相同，即GND在左下方，Vcc在右上方，“凹口”在顶部中央。上图中的引脚定义如下:</p><ul class=""><li id="fc37" class="ln lo iq lp b lq my ls mz lu nd lw ne ly nf ma mb mc md me bi translated"><strong class="lp ir">Qa引脚15 </strong>(右侧，从上往下数第二个)是第一个输出引脚。Qa也称为Q0。</li><li id="018d" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><strong class="lp ir">引脚1–7</strong>，Qb-Qh，是剩余的输出引脚。注意，有8个输出引脚(包括上面的Qa)。8路输出使其成为8位移位寄存器。Qb-Qh也被称为Q1-Q7。</li><li id="9b29" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><strong class="lp ir">引脚8 </strong>，GND为接地引脚。</li><li id="94c0" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><strong class="lp ir">Vcc引脚16 </strong>是电源输入引脚。</li><li id="d2e5" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><strong class="lp ir">引脚14</strong>SER是串行输入引脚。这是从Raspberry Pi获取输入串行数据脉冲的引脚。这有时被称为DS、SI或SDI。</li><li id="40ae" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><strong class="lp ir">引脚11 </strong>、SRCLK是接收同步信号的引脚，该信号表示已向SER引脚发送1位数据。这种信号被称为时钟。SRCLK代表移位寄存器时钟。SRCLK也称为sh_cp。</li><li id="2a71" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><strong class="lp ir">引脚12</strong>RCLK是接收同步信号的引脚，该信号指示所有8个移位寄存器位已被填充，是时候将这些位并行传输到输出/存储寄存器，从而传输到连接到输出引脚Qa-Qh的器件。RCLK也称为st_cp或latch。</li><li id="00b6" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><strong class="lp ir">引脚10 </strong>，SRCLR，用于清除移位寄存器的当前值。SRCLR代表移位寄存器清零。SRCLR也称为MR，如果不需要清除移位寄存器，可以将其连接到产生高电平信号(或1)的电源。要清除移位寄存器，SRCLR引脚应设为低电平(或0)。在移位寄存器再次工作之前，必须将其设置回高电平。</li><li id="df29" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><strong class="lp ir">引脚13</strong>OE用于阻止输出或存储寄存器的可用性。OE引脚的影响是暂时的。当设为低电平(0)时，输出寄存器中的数据可以访问。当它为高电平(1)时，数据不可访问。将它从高设置为低可以再次访问数据。与SRCLR引脚不同，它不清零寄存器。如果不需要禁用输出寄存器，可以将其接地。</li><li id="ac17" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><strong class="lp ir">引脚9 </strong>，Qh’，用于菊花链多个移位寄存器。例如，想象一个需要以并行方式控制16个led的项目。在这种情况下，单个8位移位寄存器是不够的，我们需要两个能够以某种方式进行通信的寄存器。我们可以从第二个8位移位寄存器中获得其他所需的8位。为了连接两个移位寄存器，我们将第一个移位寄存器的Qh’输出连接到第二个移位寄存器的引脚14 SER。菊花链移位寄存器超出了本项目的范围，但您可以在Arduino第1部分的<a class="ae mx" href="https://www.electroschematics.com/multiple-shift-registers-arduino-part-1/" rel="noopener ugc nofollow" target="_blank">多移位寄存器中了解更多信息。</a></li></ul><h2 id="59a3" class="no kw iq bd kx oh oi dn lb oj ok dp lf lu ol om lh lw on oo lj ly op oq ll or bi translated">操作中的移位寄存器</h2><p id="95d6" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">如上所述，输入数据存储在输入移位寄存器中。数据在SRCLK输入的每个脉冲上传输。当接收到SRCLK输入时，前一个Q* '引脚上的数据被移位到序列中的下一个Q* '寄存器。当输入移位寄存器被填充后，RCLK信号会将所有输入寄存器内容传输至输出寄存器。下表说明了这种行为。为了简单起见，我将示例限制为4位，Qa*到Qd*。输入位序列将为<code class="fe nu nv nw nk b">1011</code>。第一位<code class="fe nu nv nw nk b">1</code>将在时间<em class="nh"> t0 </em>被发送。发送的位在时间指示旁边的括号中指示(例如<code class="fe nu nv nw nk b">t0(1)</code>)。在t4，RCLK发出信号时，输出寄存器中的4位变为可用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/4ab8a76be57affa126d78b0415a04287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c_IGw7u1yGZ8OaGkyAtLDg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">移位寄存器的操作—图片来源:作者</p></figure><p id="818b" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">请注意，在输出位序列中，如果输出位从Qa读取到Qd，则位序列相反。即<code class="fe nu nv nw nk b">1101</code>对<code class="fe nu nv nw nk b">1011</code>的输入顺序。这种移位方式称为最高有效位(MSB)移位。它从最左边的位开始，如本例所示。这一点必须牢记在心，否则可能会出现意想不到的结果。可以以更直观的方式移位最低有效位(LSB)。为此，移位必须从最少或最右边的输入位开始。在C &amp; Go中，使用<code class="fe nu nv nw nk b">&lt;&lt;</code>移位运算符完成MSB移位。LSB移位通过使用<code class="fe nu nv nw nk b">&gt;&gt;</code>移位操作符完成。当我们了解移位寄存器(不是输入移位寄存器)如何与7段显示器结合使用时，移位方法的影响将变得更加明显。<a class="ae mx" href="https://en.wikipedia.org/wiki/Bit_numbering" rel="noopener ugc nofollow" target="_blank">参见维基百科了解更多关于MSB和LSB </a>的信息。</p><blockquote class="ob oc od"><p id="b87e" class="mk ml nh lp b lq my jr mm ls mz ju mn oe na mp mq of nb ms mt og nc mv mw ma ij bi translated">如前所述，当我在上面提到只需要一个Raspberry Pi GPIO引脚来驱动7段显示器中的8个LED段时，我稍微简化了事情。我确定的一个引脚用于SER(串行数据输入)引脚。至少还需要2个；1用于SRCLK引脚，另一个用于RCLK引脚。如上所示，这是分别推进输入移位寄存器上的时钟和从输入移位寄存器向输出寄存器传输数据所必需的。因此，现在有3个引脚来驱动7段显示器上的8个led。这仍然是一个很好的权衡。但如果需要SRCLR和OE引脚，则还需要2个GPIO引脚。因此，现在需要5个GPIO引脚来驱动8个LED段。仍然有3针的净增益。然而，如上所述，当移位寄存器以菊花链形式连接时，节省会更大。无需额外的GPIO引脚，就可以从这5个GPIO引脚控制16个甚至更多的led。随着需要控制更多的设备，例如led，节省变得更加显著。</p></blockquote><h1 id="ec39" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">这个项目如何使用移位寄存器和7段显示器？</h1><p id="add7" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">该项目使用移位寄存器器件来捕获串行输入，累加直到写入8位，然后将其提供给输出寄存器。由于移位寄存器组件连接到7段显示器，输出寄存器的内容可用于7段显示器，控制最终显示的内容。从移位寄存器元件到7段显示引脚的引脚连接细节，以及所使用的移位方法(本例中为MSB ),决定了7段显示器上将点亮哪些led。下表提供了具体的引脚分配，以及当输入数为<code class="fe nu nv nw nk b">0x3f</code>、<code class="fe nu nv nw nk b">0011 1111</code>、使用MSB移位时，输出寄存器给出的最终值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/72d9a4fe226dc9d975a89f33f66d1d0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mAVmluD6Afbr7aKOOcQZGg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">移位寄存器到7段显示值映射—图片来源:作者</p></figure><p id="8437" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">使用下图，我们可以确定7段LED将显示什么数字。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/31653ade8e5d897350397db97c034650.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/0*xtZGyxQrGFuBJaVD.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">七段显示排线图— <a class="ae mx" href="https://www.circuitbasics.com/arduino-7-segment-display-tutorial/" rel="noopener ugc nofollow" target="_blank"> <em class="ny">图片来源:电路基础</em> </a></p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/82cb32427f213b01287ced86cd087858.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/0*C-jo6N0thZ8hB7MB.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">7段显示LED ID图— <a class="ae mx" href="https://www.circuitbasics.com/arduino-7-segment-display-tutorial/" rel="noopener ugc nofollow" target="_blank"> <em class="ny">图像来源:电路基础</em> </a></p></figure><p id="b33e" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">7段显示引脚A-F的值为1，G和DP的值为0。将它映射到上面的LED识别图中，我们可以看到显示的数字是<code class="fe nu nv nw nk b">0</code>。</p><h1 id="d801" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">设置和代码</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/fd8ea1904f6644371bbff308a3d3fadd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NkTQJ3WqF4-nlNQ0.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ny"> Sunfounder接线图— </em> <a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/1.1.4_7-segment_display_c.html" rel="noopener ugc nofollow" target="_blank"> <em class="ny">图片来源— Sunfounder </em> </a></p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/6ae4e314c63f584c80a453286ea1ebbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-e99aUrYhubV5zD3.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ny">实际布线(大部分)—图片鸣谢:作者</em></p></figure><p id="07a8" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">试验板应如上图所示<em class="nh">(如</em> <a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/1.1.4_7-segment_display_c.html" rel="noopener ugc nofollow" target="_blank"> <em class="nh"> Sunfounder 7段显示器</em> </a> <em class="nh">项目文档中所示)</em>。有一点非常重要，我花了太多时间调试，那就是连接7段显示器接地引脚的电阻必须连接到试验板上的地或负总线。在我之前的所有项目中，我都将电阻连接到正试验板总线。我最初错过了这个细节，7段显示器没有显示任何东西。我在初始布线中犯的另一个错误是，我将74HC595输出寄存器引脚错误地连接到7段显示器。这很容易做到。我通过记录哪个LED段点亮了哪个预期数字来调试这个问题。看了几个数字后，很明显我把7段显示器上的G和E引脚颠倒了。</p><p id="df0e" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">如果你不熟悉试验板和试验板图，这个<a class="ae mx" href="https://www.sciencebuddies.org/science-fair-projects/references/how-to-use-a-breadboard" rel="noopener ugc nofollow" target="_blank">试验板教程</a>应该会有帮助。</p><h1 id="db5c" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">C语言中的移位寄存器/7段显示</h1><p id="2393" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">这段代码与Sunfounder代码有很大不同。这是因为我选择添加几项功能，包括:</p><ol class=""><li id="add0" class="ln lo iq lp b lq my ls mz lu nd lw ne ly nf ma ng mc md me bi translated">支持中断处理程序。这将通过清除输入移位寄存器从而关闭所有led来优雅地退出程序。Sunfounder程序将使led保持在该版本退出时的状态。</li><li id="79cf" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">它支持设置SRCLR和OE移位寄存器引脚。</li><li id="d5e0" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">它增加了对7段显示中小数点的照明支持。</li><li id="a7e7" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">它增加了几个功能，能够测试74HC595移位寄存器的不同功能，包括使用SRCLR和OE引脚。</li><li id="bc93" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">它接受来自键盘的用户输入，允许用户指定他们希望程序如何驱动移位寄存器，从而驱动LED。这包括清除输入移位寄存器、禁用和重新启用输出寄存器、写入所有十六进制数字/小数点以及向显示器写入<code class="fe nu nv nw nk b">8.</code>。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="939a" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">嵌入的注释很好地解释了大部分内容，但我将提到几个亮点。</p><p id="b1d7" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第12行和第13行提供了关于如何构建和运行程序的信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/7f5bc2407c05a10a4de30f6587d6674a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6ArCGoZDKr-DcSQF.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">74HC595引脚排列图— <a class="ae mx" href="https://www.ti.com/lit/ds/symlink/cd74hc595.pdf?ts=1636840974607&amp;ref_url=https%253A%252F%252Fwww.google.com%252F%22" rel="noopener ugc nofollow" target="_blank"> <em class="ny">图片来源:德州仪器</em> </a></p></figure><p id="c785" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第27和28行定义了分别驱动SRCLR和OE引脚的GPIO引脚。请注意，GPIO引脚号是<a class="ae mx" href="https://github.com/WiringPi/WiringPi" rel="noopener ugc nofollow" target="_blank">接线引脚</a>引脚号。如果您想看到这种行为，应将引脚24连接到SRCLR移位寄存器引脚，将引脚29连接到OE移位寄存器引脚，而不是分别连接正极和地。</p><p id="8415" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第32行和第33行定义了一个数组<code class="fe nu nv nw nk b">SegCode</code>，它包含将被移入移位寄存器的十六进制数，以便显示与数组中特定数字的索引相匹配的数字。例如，要显示8应该使用<code class="fe nu nv nw nk b">SegCode[8]</code>。请注意，这些数字反映了MSB形式移位的使用。如果使用LSB移位形式，数字会有所不同。例如，用于显示0的数字，如第32行所示，是<code class="fe nu nv nw nk b">0x3F</code> ( <code class="fe nu nv nw nk b">0011 1111</code>)。要使用LSB方法显示0，应使用十六进制数<code class="fe nu nv nw nk b">0xFC</code> ( <code class="fe nu nv nw nk b">1111 1100</code>)和C右移运算符<code class="fe nu nv nw nk b">&gt;&gt;</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="825b" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">下面的代码片段显示了移位寄存器的初始化。简而言之，我们使用的所有引脚都处于输出模式，因此我们可以对它们进行写入。接下来，除SRCLR引脚之外的所有引脚都被设为低电平(0)。回想一下，SRCLR引脚必须设为高电平，移位寄存器才能工作。</p><blockquote class="ob oc od"><p id="c2ba" class="mk ml nh lp b lq my jr mm ls mz ju mn oe na mp mq of nb ms mt og nc mv mw ma ij bi translated">引脚模式输出的替代方案是PWM(脉宽调制)。由于PWM通过快速脉动相关引脚来模拟较低电压，因此不适合与移位寄存器一起使用。回想一下，SRCLK和RCLK引脚的一个脉冲代表一个时钟前进。使用PWM以及由此产生的快速脉冲会干扰时钟以可靠的方式前进。</p></blockquote><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="9ab7" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">这个代码片段演示了关闭7段显示器中所有led的两种方法。具体来说，它显示了如何使用SRCLR引脚并向所有输入移位寄存器位写入0来清除输入移位寄存器，这将导致7段显示器不显示任何内容。</p><p id="ec03" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">在<code class="fe nu nv nw nk b">shiftRegClr</code>的第1行到第11行，注意第4行和第6行RCLK引脚的使用。该引脚的时钟信号必须是脉冲信号，即先设为高电平，再设为低电平，以便输出寄存器可以使用输入移位寄存器的内容。另请注意，重新使能移位寄存器的操作完成后，SRCLR引脚需要复位至高电平。</p><p id="e9cb" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第16行到第28行显示了向所有输入移位寄存器位写0以清除输入移位寄存器(<code class="fe nu nv nw nk b">zeroClear()</code>)的方法。这在功能上等同于使用SRCLR方法，两者都将输入移位寄存器位设为0。然而，这确实需要付出更多的努力。第18到23行中的<code class="fe nu nv nw nk b">for</code>循环将一个零移入输入移位寄存器的每一位。该过程重复8次，每次写操作都推进SRCLK，以填充输入移位寄存器位。线20和22发送SRCLK脉冲，以提升输入移位寄存器位。严格来说，没有必要把<code class="fe nu nv nw nk b">0</code>和<code class="fe nu nv nw nk b">&amp;</code>移到19行的<code class="fe nu nv nw nk b">0x80</code>。仅将<code class="fe nu nv nw nk b">0</code>写入SDI引脚就足够了。然而，有必要使用这种写入SDI引脚的方法，将任何其他数字，例如<code class="fe nu nv nw nk b">0x3F</code>写入输入移位寄存器。</p><p id="04cf" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">与上面的<code class="fe nu nv nw nk b">shiftRegClr()</code>一样，第25和27行切换RCLK引脚，将位传输到输出寄存器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="f284" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">下一段代码演示了如何点亮所有led，包括小数点，以及切换OE引脚以暂时禁用输出寄存器。</p><p id="e5de" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第3行到第15行显示<code class="fe nu nv nw nk b">writeAllOnes()</code>。它的实现几乎和上面的<code class="fe nu nv nw nk b">zeroClear()</code>一模一样。一个值得注意的例外是，在写入引脚之前，它不会将1和<code class="fe nu nv nw nk b">&amp;</code>左移到<code class="fe nu nv nw nk b">0x80</code>。这表明，当所有输入移位寄存器位具有相同的值，即1或0时，没有必要这样做。不过，它会重复8次写入引脚的过程，每次写入后都会提升SRCLK时钟。</p><p id="2149" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第22到29行实现了<code class="fe nu nv nw nk b">oeToggle()</code>，它将OE引脚切换到高电平(1)，然后再次切换到低电平。写入之间有1秒钟的延迟，以确保效果可见。回想一下，将OE引脚设为高电平是禁用输出寄存器的原因。从观察者的角度来看，7段显示器将关闭1秒钟，然后恢复到切换之前的显示状态。在调用该函数之前，由调用函数决定在7段显示器上显示什么。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="5a88" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated"><code class="fe nu nv nw nk b">hc595_shift()</code>负责将输入数<code class="fe nu nv nw nk b">dat</code>的各个位移入输入移位寄存器。除了输入数字根据<code class="fe nu nv nw nk b">dat</code>的值是可变的之外，该功能的实现与上面的<code class="fe nu nv nw nk b">zeroClr()</code>完全一样。事实上，<code class="fe nu nv nw nk b">zeroClr()</code>和<code class="fe nu nv nw nk b">writeAllOnes()</code>都可以，而且很可能已经使用<code class="fe nu nv nw nk b">hc595_shift()</code>实现了。</p><p id="aa2c" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">对于那些像我一样难以想象<code class="fe nu nv nw nk b">&lt;&lt;</code>如何与<code class="fe nu nv nw nk b">&amp;</code>操作符协同工作的人，这里有一个简短的例子，以<code class="fe nu nv nw nk b">0x3f</code>或<code class="fe nu nv nw nk b">0011 1111</code>为例。注意，操作的优先顺序是<code class="fe nu nv nw nk b">&lt;&lt;</code>先发生，然后是<code class="fe nu nv nw nk b">&amp;</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/9f2ed087532a210f5462a06d3ea54770.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZNL4Es7VT4-mLMrlbIxssw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">移位示例—图片来源:作者</p></figure><p id="b2c5" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">最后一个条目<code class="fe nu nv nw nk b">i = 8</code>，是如果<code class="fe nu nv nw nk b">dat</code>移动9次而不是8次会发生的情况。这只是为了清楚地说明<code class="fe nu nv nw nk b">dat</code>已经向左移动了8位，所有8位都设置为0。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="c66d" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">上面代码片段中的大多数函数只是通过将显示设置为<code class="fe nu nv nw nk b">8</code>来设置测试，然后将行为委托给我们上面看到实现的函数(例如<code class="fe nu nv nw nk b">shiftRegClr()</code>)。<code class="fe nu nv nw nk b">testWriteNums()</code>不是只显示十六进制数<code class="fe nu nv nw nk b">0-F</code>，而是会在所有的十六进制数和小数点之间循环。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="7889" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">最后，这段代码实现了<code class="fe nu nv nw nk b">main()</code>和<code class="fe nu nv nw nk b">interruptHandler()</code>功能。</p><p id="8cef" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第3行记录了一个对<code class="fe nu nv nw nk b">SIGINT</code>信号感兴趣的信号处理器<code class="fe nu nv nw nk b">interruptHandler()</code>。<code class="fe nu nv nw nk b">SIGINT</code>是在终端输入<code class="fe nu nv nw nk b">ctl-C</code>时产生的。</p><p id="af7d" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第6到9行初始化WiringPi库，如果初始化失败就退出。</p><p id="95be" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第16行提示用户他们希望看到演示的行为。</p><p id="dc24" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第17行到第25行首先读取用户的终端输入，并用结果填充一个以null结尾的字符串。除了第一个字符之外，代码不关心任何可能已经输入的字符。它和换行符之间的任何附加字符都将被忽略。</p><p id="a18f" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第26行释放第19行的<code class="fe nu nv nw nk b">getline()</code>分配的内存。这是避免内存泄漏所必需的。如果你不明白这些，也不要担心。这个程序演示了什么并不重要。如果您感兴趣，可以研究一下C中的内存分配，包括内存是如何分配的(<code class="fe nu nv nw nk b">malloc</code>)、如何释放的(<code class="fe nu nv nw nk b">free</code>)、为什么这很重要，以及最后的<code class="fe nu nv nw nk b">getline()</code>函数的操作。否则，请记住这是必需的。</p><blockquote class="ob oc od"><p id="4958" class="mk ml nh lp b lq my jr mm ls mz ju mn oe na mp mq of nb ms mt og nc mv mw ma ij bi translated">旁白:严格地说，这个程序实际上并不需要这样做，因为在正常使用中，由此产生的内存泄漏可能是微不足道的。至少，当不再需要时，不<code class="fe nu nv nw nk b">free</code>所有分配的内存是不好的。最坏的情况是，一旦分配完所有可用内存，程序可能会以各种方式失败。因此，当不再需要与像<code class="fe nu nv nw nk b">line</code>这样的变量相关联的内存时，调用<code class="fe nu nv nw nk b">free</code>。</p><p id="117e" class="mk ml nh lp b lq my jr mm ls mz ju mn oe na mp mq of nb ms mt og nc mv mw ma ij bi translated"><a class="ae mx" href="https://en.wikipedia.org/wiki/C_dynamic_memory_allocation" rel="noopener ugc nofollow" target="_blank">维基百科</a>有非常详细的关于内存分配和管理的讨论。</p></blockquote><p id="d418" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第28到56行检测用户选择了哪个选项，并调用与该选项相关的函数。重复从第15行开始的整个过程，直到用户选择<code class="fe nu nv nw nk b">(q)uit</code>选项。</p><p id="f90a" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第63到67行记录了信号处理器，如果在终端输入<code class="fe nu nv nw nk b">ctl-C</code>，它将优雅地退出程序。它调用<code class="fe nu nv nw nk b">toggle8()</code>，在关闭7段显示器中的所有led之前，短暂显示一个<code class="fe nu nv nw nk b">8</code>。</p><h1 id="2134" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">Go中的移位寄存器/7段显示</h1><p id="5047" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">围棋程序和C版本很像。在实现和运行时输出中有一些微小的差异。其中一些差异是由于语言之间的结构差异以及编码约定的差异造成的。下面的片段代表了程序的大部分，但不是全部。我留下了一些锅炉板和空白。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="6d1e" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">这个片段有4个主要部分。第一个是第3行的<code class="fe nu nv nw nk b">segcode</code>变量的定义。它的作用与C程序中的<code class="fe nu nv nw nk b">SegCode</code>相同，即定义要左移到移位寄存器中的值。需要注意的是，与C版本一样，这些值取决于最高有效位移位(MSB)的使用。为了方便起见，下面是C版本的说明文字:</p><blockquote class="ob oc od"><p id="28f3" class="mk ml nh lp b lq my jr mm ls mz ju mn oe na mp mq of nb ms mt og nc mv mw ma ij bi translated"><code class="fe nu nv nw nk b">SegCode</code> …包含应移入移位寄存器的十六进制数，以便显示与数组中特定数字的索引相匹配的数字。例如，要显示8应该使用<code class="fe nu nv nw nk b">SegCode[8]</code>。请注意，这些数字反映了MSB形式移位的使用。如果使用LSB移位形式，数字会有所不同。例如，用于显示0的数字，如第32行所示，是<code class="fe nu nv nw nk b">0x3F</code> ( <code class="fe nu nv nw nk b">0011 1111</code>)。要使用LSB方法显示0，应使用十六进制数<code class="fe nu nv nw nk b">0xFC</code> ( <code class="fe nu nv nw nk b">1111 1100</code>)和C右移运算符<code class="fe nu nv nw nk b">&gt;&gt;</code>。</p></blockquote><p id="a00c" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第二，第7–13行，在<code class="fe nu nv nw nk b">main()</code>中，初始化go-rpio库，如果有问题就退出。第13行保证go-rpio库持有的资源将在程序终止时被释放。</p><p id="dca0" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第三，第15–20行，创建go-rpio <code class="fe nu nv nw nk b">rpio.Pin</code>对象，由程序的其余部分操作。</p><p id="b52e" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">最后，第22–35行定义了一个信号/中断处理程序来捕捉来自终端的<code class="fe nu nv nw nk b">ctl-C</code>输入。如果用户在键盘上输入<code class="fe nu nv nw nk b">ctl-C</code>，这是优雅地退出程序所需要的。在这个代码片段中需要注意的一个关键点是名为<code class="fe nu nv nw nk b">stop</code>的通道的使用。信号/中断处理程序运行在自己的goroutine中(第35行)。此时，有2个goroutine正在运行，<code class="fe nu nv nw nk b">main()</code> goroutine和与信号/中断处理程序相关的goroutine。它们是独立运行和调度的，因此控制权可以以任意和不可预测的方式从一个例程转移到另一个例程。为了优雅地关闭程序，必须以受控的方式停止它们。否则退出程序会导致不可预知的行为。例如，在程序退出时，7段显示器可能仍有一些发光二极管。使用<code class="fe nu nv nw nk b">stop</code>通道同步程序退出可防止这种情况发生。请参见<a class="ae mx" href="https://tour.golang.org/concurrency/1" rel="noopener ugc nofollow" target="_blank"> Goroutines </a>和<a class="ae mx" href="https://tour.golang.org/concurrency/2" rel="noopener ugc nofollow" target="_blank"> Channels </a>上的Go课程之旅，快速了解Goroutines和Channels。如果你不太理解这些，不要担心，Go中的并发性是一个高级话题。我主要只是想提供一个高层次的解释，说明为什么要这样写代码。</p><p id="8672" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">程序注释提供了额外的细节。<code class="fe nu nv nw nk b">main()</code>的其余部分在下面的代码片段中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="d830" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">如上所示的<code class="fe nu nv nw nk b">main()</code>的其余部分处理提示用户他们希望看到演示的功能是相当不言自明的。需要指出的一点是从第2-8行开始的<code class="fe nu nv nw nk b">for/select</code>循环。<code class="fe nu nv nw nk b">for/select</code>是围棋程序中常用的模式。它在这里的使用可以追溯到之前关于<code class="fe nu nv nw nk b">stop</code>通道的讨论。<code class="fe nu nv nw nk b">for/select</code>模式的<code class="fe nu nv nw nk b">select</code>部分在<code class="fe nu nv nw nk b">stop</code>上监听指示该goroutine应该退出的消息。注意<code class="fe nu nv nw nk b">select</code>有两个<code class="fe nu nv nw nk b">case</code>选择。第一个是用来听<code class="fe nu nv nw nk b">stop</code>频道的。如果收到消息，则<code class="fe nu nv nw nk b">for</code>循环和程序将退出。如果没有收到消息，则控制将立即转到<code class="fe nu nv nw nk b">default</code>情况，继续正常程序流程。在<code class="fe nu nv nw nk b">default</code>的情况下，在第18-57行提示用户选择，这将导致其中一个测试函数被调用。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="7b3d" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">下一个代码片段有3个部分。第一个是go-rpio <code class="fe nu nv nw nk b">rpio.Pin</code>对象的创建，这些对象表示到移位寄存器物理引脚的逻辑连接。GPIO/BCM引脚17、18、27、19和21分别用于SDI、RCLK、SRCLK、SRCLR和OE引脚。</p><p id="ab49" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第二部分将引脚设置为输出模式，以便可以写入。</p><p id="d51d" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">最后一部分将引脚上的电压设置为初始值。注意，SRCLR引脚设为高电平。这是移位寄存器工作所必需的。在后面的代码片段中，我们将看到，通过将SRCLR引脚设为低电平来清除输入移位寄存器，然后再设为高电平来重新使能移位寄存器的正常操作，从而清除输入移位寄存器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="b69d" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">这个代码片段显示了测试函数的实现，调用这些函数是为了响应用户关于他们希望看到演示的功能的选择。如果有任何数据被写入7段显示器，在功能退出前将被清除。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="eea7" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">这个代码片段展示了程序核心功能<code class="fe nu nv nw nk b">hc595_shift()</code>的实现，它实际上是对输入移位寄存器的写操作。注释对该函数的功能提供了很好的详细解释。关于位移如何工作的更多细节，请参见上面的C版本。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="13b3" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">这个最后的代码片段展示了两个助手函数和信号/中断处理程序的实现。第一个辅助函数<code class="fe nu nv nw nk b">writeNums()</code>，写入照亮7段显示屏上的十六进制数字所需的实际数据。</p><p id="e506" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">第二个是<code class="fe nu nv nw nk b">shiftRegClr()</code>，显示如何结合使用SRCLR和RCLK引脚来清除移位寄存器，最终清除7段显示。注意，如上所述，为了重新使能移位寄存器，需要将SRCLR引脚置回高电平。</p><p id="6475" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">在<code class="fe nu nv nw nk b">shiftRegClr</code>的第12行到第18行，注意第14行和第16行RCLK引脚的使用。该引脚的时钟信号必须是脉冲信号，即先设为高电平，再设为低电平，以便输出寄存器可以使用输入移位寄存器的内容。另请注意，重新使能移位寄存器的操作完成后，SRCLR引脚需要复位至高电平。</p><p id="031b" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">最后，<code class="fe nu nv nw nk b">signalHandler()</code>功能通过<code class="fe nu nv nw nk b">sigs</code>通道捕捉来自操作系统(第23行)的信号。然后在(第25行)它关闭停止通道。关闭通道的一个副作用是会向通道另一端的所有侦听器发送通知。这是围棋中常见的模式。最后，它清空移位寄存器，释放go-rpio资源(第28行)，并退出程序。</p><h1 id="f3f0" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">摘要</h1><p id="ba58" class="pw-post-body-paragraph mk ml iq lp b lq lr jr mm ls lt ju mn lu mo mp mq lw mr ms mt ly mu mv mw ma ij bi translated">这篇文章涉及了相当多的领域。如果你一直在关注我的系列，从<a class="ae mx" href="https://youngkin.github.io/post/sunfoundergpionotesled/" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi GPIO in Go和C-Blinking LED</a>项目开始，你已经熟悉使用GPIO驱动LED。你可能会同意<a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/1.1.4_7-segment_display_c.html" rel="noopener ugc nofollow" target="_blank"> Sunfounder 7段显示器</a>项目并没有真正增加你在以前的项目中没有涉及的GPIO和led知识。这就是为什么，对我来说，这个项目实际上是关于学习移位寄存器的基础知识，并以一种非平凡的方式使用它们。</p><p id="a480" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">这篇文章涵盖了几件有趣的事情:</p><ol class=""><li id="e696" class="ln lo iq lp b lq my ls mz lu nd lw ne ly nf ma ng mc md me bi translated">它演示了在试验板上连接一个相对复杂的电路。正如我所做的那样，您可能在这个过程中犯了一些错误，这给了您一些如何调试电路的有用知识。</li><li id="dac1" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">通过学术讨论和动手实践，你已经对移位寄存器及其用途有了相当多的了解。</li><li id="974f" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma ng mc md me bi translated">尽管我在这个项目中有点轻视led的使用，但这个项目确实揭示了如何以更现实的方式使用led。控制单个LED很有趣，但能够并行控制LED阵列并在阵列上显示数字是一大进步。您还了解了7段显示器有两种类型，公共阳极和公共阴极。</li></ol><p id="7095" class="pw-post-body-paragraph mk ml iq lp b lq my jr mm ls mz ju mn lu na mp mq lw nb ms mt ly nc mv mw ma ij bi translated">欢迎对本文提出评论和问题(掌声也是一样):</p><h1 id="a0a4" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">参考</h1><ul class=""><li id="7611" class="ln lo iq lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated"><a class="ae mx" href="https://docs.sunfounder.com/projects/raphael-kit/en/latest/1.1.4_7-segment_display_c.html" rel="noopener ugc nofollow" target="_blank"> Sunfounder 7段显示</a>项目文档。</li><li id="e740" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><a class="ae mx" href="https://docs.sunfounder.com/projects/electronic-kit/en/latest/lesson_19_7-segment.html" rel="noopener ugc nofollow" target="_blank"> Sunfounder 7段Python </a>项目包含一些C版本项目中没有的附加信息。</li><li id="d7af" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><a class="ae mx" href="https://pinout.xyz/" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi GPIO引脚排列图</a>包括物理板引脚号、BCM/GPIO引脚号和WiringPi引脚号。</li><li id="b7bb" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><a class="ae mx" href="https://www.allaboutcircuits.com/textbook/digital/chpt-12/serial-in-parallel-out-shift-register/" rel="noopener ugc nofollow" target="_blank">移位寄存器:串行输入、并行输出(SIPO)转换</a>是详细介绍移位寄存器，尤其是74HC595移位寄存器的好资源。</li><li id="df60" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><a class="ae mx" href="https://www.ti.com/lit/ds/symlink/cd74hc595.pdf?ts=1636840974607&amp;ref_url=https%253A%252F%252Fwww.google.com%252F" rel="noopener ugc nofollow" target="_blank">德州仪器CD74HC595数据手册</a>包含一些有趣的信息，包括时序图。</li><li id="8f9d" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><a class="ae mx" href="https://www.circuitbasics.com/arduino-7-segment-display-tutorial/" rel="noopener ugc nofollow" target="_blank">如何在Arduino上设置七段显示器</a>提供了一个不使用移位寄存器的七段LED项目示例。它还有一些其他有用的信息，如如何确定7段显示器是共阴极还是共阳极显示器。</li><li id="1f1e" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><a class="ae mx" href="https://github.com/WiringPi/WiringPi" rel="noopener ugc nofollow" target="_blank">wiring pi</a>C库</li><li id="cfff" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><a class="ae mx" href="http://wiringpi.com/" rel="noopener ugc nofollow" target="_blank"> WiringPi网站</a></li><li id="3b68" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><a class="ae mx" href="https://github.com/stianeikeland/go-rpio" rel="noopener ugc nofollow" target="_blank"> go-rpio </a>用于go的库</li><li id="965d" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">我的<a class="ae mx" href="https://youngkin.github.io/categories/gpio/" rel="noopener ugc nofollow" target="_blank">树莓Pi GPIO系列其他文章</a></li><li id="3f60" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated">包含本文代码的gpio库</li><li id="b70a" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><a class="ae mx" href="https://projects.raspberrypi.org/en/projects/raspberry-pi-setting-up" rel="noopener ugc nofollow" target="_blank">如何从头开始设置一个新的Raspberry Pi</a></li><li id="3d9f" class="ln lo iq lp b lq mf ls mg lu mh lw mi ly mj ma mb mc md me bi translated"><a class="ae mx" href="https://www.sciencebuddies.org/science-fair-projects/references/how-to-use-a-breadboard" rel="noopener ugc nofollow" target="_blank">如何使用试验板</a></li></ul></div></div>    
</body>
</html>