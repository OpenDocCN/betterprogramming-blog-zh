<html>
<head>
<title>Deploy Django Projects to Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Django项目部署到Kubernetes</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deploy-django-projects-to-kubernetes-d1c9584036a5?source=collection_archive---------3-----------------------#2019-10-22">https://betterprogramming.pub/deploy-django-projects-to-kubernetes-d1c9584036a5?source=collection_archive---------3-----------------------#2019-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a338" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Kubernetes和DevSpace的可伸缩Django部署</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0885548addeb6c2bfc7ee3256975ff65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nmZLo8Jb22fEl7Fi.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">资料来源:Lukas Gentele</p></figure><p id="993d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本教程旨在为想要探索Kubernetes并在使用Kubernetes构建和部署Django项目时提高生产力的Django开发人员提供指导。本教程独立于任何云平台。一切都适用于任何Kubernetes集群，无论它是使用Minikube或Docker desktop创建的本地单节点集群，还是位于GKE、阿拉斯加州或EKS的完全托管集群。</p><p id="dd60" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">即使您还没有Kubernetes集群，也可以学习本教程。如果你已经有一个集群，那就更好了！让我们开始吧。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="0337" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">1.创建Django项目</h1><p id="04ca" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">如果您已经有一个Django项目，您可以跳过这一步，但是要确保您的项目根目录中有一个<code class="fe my mz na nb b">requirements.txt</code>(运行<code class="fe my mz na nb b">pip freeze &gt; requirements.txt</code>来创建它)。</p><p id="5b55" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在创建一个新的Django项目之前，让我们用我们希望Django项目所在的目录来定义一个变量:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="78f7" class="ng mc it nb b gy nh ni l nj nk">PROJECT_DIR=/c/Users/[username]/django # win (git-bash)<br/>PROJECT_DIR=/home/[username]/django # mac, linux (bash)</span></pre><p id="1513" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你正在使用传统的Docker工具箱(例如，因为你正在使用Windows Home Edition)，你的<code class="fe my mz na nb b">$PROJECT_DIR</code>需要在你的用户的主目录中，例如<code class="fe my mz na nb b">/c/Users/[username]</code>。</p><p id="f0cf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你在Windows上使用Docker桌面，确保你的项目所在的驱动器在Docker设置中被标记为<a class="ae nl" href="https://docs.docker.com/docker-for-windows/#shared-drives" rel="noopener ugc nofollow" target="_blank">共享驱动器</a>。</p><p id="8859" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们还应该为项目名称定义一个变量:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="7dd0" class="ng mc it nb b gy nh ni l nj nk">PROJECT_NAME=mysite  <br/><em class="nm"># warning: Django only allows characters a-z, no -, space or anything else</em></span></pre><p id="5509" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们使用Docker创建一个新的Django项目:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="fbec" class="ng mc it nb b gy nh ni l nj nk">mkdir $PROJECT_DIR </span><span id="7699" class="ng mc it nb b gy nn ni l nj nk">docker run --rm -v /$PROJECT_DIR:/app -w //app python bash -c "pip install django &amp;&amp; django-admin startproject $PROJECT_NAME &amp;&amp; pip freeze &gt; $PROJECT_NAME/requirements.txt" </span><span id="d5c4" class="ng mc it nb b gy nn ni l nj nk">cd $PROJECT_DIR/$PROJECT_NAME</span></pre><p id="0d12" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太好了！我们都准备好了。现在让我们将Django项目容器化。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="0938" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">2.集装箱化项目</h1><p id="73b2" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">当然，我们可以手动创建Dockerfile、Kubernetes manifests，甚至是Helm chart，但是这需要大量的工作，而且很容易出错。因此，让我们使用DevSpace来自动化我们的Django项目的容器化。<a class="ae nl" href="https://github.com/devspace-cloud/devspace" rel="noopener ugc nofollow" target="_blank"> DevSpace是一款面向Kubernetes的云原生开发工具。它是开源的，你可以从GitHub </a>安装它。</p><p id="2825" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在您的计算机上安装了DevSpace之后，您可以使用以下命令将您的Django项目容器化:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="3258" class="ng mc it nb b gy nh ni l nj nk">devspace init</span></pre><p id="4b46" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">DevSpace会问几个问题。确保您告诉它这是:</p><ul class=""><li id="b164" class="no np it la b lb lc le lf lh nq ll nr lp ns lt nt nu nv nw bi translated">一个使用<code class="fe my mz na nb b">python</code>作为编程语言的项目</li><li id="76de" class="no np it la b lb nx le ny lh nz ll oa lp ob lt nt nu nv nw bi translated">监听端口<code class="fe my mz na nb b">8000</code>的项目</li></ul><p id="4a09" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你不确定Docker注册表或其他问题，只需选择DevSpace为你推荐的默认选项。</p><p id="fca7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们将项目容器化之后，DevSpace为项目添加了一个<code class="fe my mz na nb b">Dockerfile</code>。将此Dockerfile文件中的最后一行从:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="2388" class="ng mc it nb b gy nh ni l nj nk">CMD ["app.py"]</span></pre><p id="5dea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">到</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="97ea" class="ng mc it nb b gy nh ni l nj nk">CMD ["manage.py", "runserver"]</span></pre><p id="7c7a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们准备将Django项目部署到Kubernetes。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="dc7d" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">3.选择Kubernetes集群</h1><p id="ac91" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">如果您已经有了一个Kubernetes集群，使用下面的命令告诉DevSpace将项目部署到哪个名称空间:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="1abe" class="ng mc it nb b gy nh ni l nj nk">devspace use namespace [my-namespace]</span></pre><p id="137e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果这个名称空间还不存在，DevSpace将在部署过程中创建它。在部署项目之前，确保您处于正确的kube上下文中。</p><h2 id="9252" class="ng mc it bd md oc od dn mh oe of dp ml lh og oh mn ll oi oj mp lp ok ol mr om bi translated">没有Kubernetes集群？</h2><p id="6c98" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">如果没有Kubernetes集群，可以使用DevSpace赞助的免费Kubernetes名称空间。使用以下命令创建一个:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="905b" class="ng mc it nb b gy nh ni l nj nk">devspace create space mysite</span></pre><p id="e0a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">DevSpace将自动为您配置kube-context，这样您就可以使用任何Kubernetes工具来使用这个名称空间，比如kubectl、Kustomize、Skaffold或Helm。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="ba05" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">4.发展</h1><p id="7005" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">在我们以类似生产的方式部署我们的项目之前，让我们首先启动开发模式:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="70a6" class="ng mc it nb b gy nh ni l nj nk">devspace dev</span></pre><p id="6861" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个命令告诉DevSpace:</p><ol class=""><li id="27d4" class="no np it la b lb lc le lf lh nq ll nr lp ns lt on nu nv nw bi translated">基于Docker文件构建Docker映像</li><li id="9d10" class="no np it la b lb nx le ny lh nz ll oa lp ob lt on nu nv nw bi translated">标记并将该图像推送到Docker注册表(例如，Docker Hub)</li><li id="da2c" class="no np it la b lb nx le ny lh nz ll oa lp ob lt on nu nv nw bi translated">为我们的Django应用程序部署一个带有Kubernetes部署的舵图</li><li id="12db" class="no np it la b lb nx le ny lh nz ll oa lp ob lt on nu nv nw bi translated">启动端口转发以访问本地主机上的应用程序(并在浏览器中打开)</li><li id="8a8e" class="no np it la b lb nx le ny lh nz ll oa lp ob lt on nu nv nw bi translated">流式传输容器的日志</li><li id="95d1" class="no np it la b lb nx le ny lh nz ll oa lp ob lt on nu nv nw bi translated">观察文件更改，如果有任何文件更改，请重新启动应用程序</li></ol><p id="fa0b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以定制在DevSpace配置文件<code class="fe my mz na nb b">devspace.yaml</code>中发生的事情，这个文件是<code class="fe my mz na nb b">devspace init</code>为您的项目创建的。</p><p id="199b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe my mz na nb b">devspace dev</code>成功部署之后，您应该会在命令行中看到Django的日志输出，浏览器将会打开，显示一个漂亮的欢迎页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/56083052df96b990d1ccea3632bea7f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QWD8liXzCm9qqaM-.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Django欢迎页面——如果你看到这个页面，说明你目前做的一切都是正确的！</p></figure><p id="2661" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，是时候创建<code class="fe my mz na nb b">/pages</code>文件夹了。运行以下命令来创建它:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="bcc3" class="ng mc it nb b gy nh ni l nj nk">devspace enter python manage.py startapp pages</span></pre><p id="3db3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">添加完pages文件夹后，我们需要将<code class="fe my mz na nb b">pages.apps.PagesConfig</code>添加到<code class="fe my mz na nb b">$PROJECT_NAME/settings.py</code>中的<code class="fe my mz na nb b">INSTALLED_APPS</code>数组中:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="b93a" class="ng mc it nb b gy nh ni l nj nk">INSTALLED_APPS = [<br/>    'django.contrib.admin',<br/>    'django.contrib.auth',<br/>    'django.contrib.contenttypes',<br/>    'django.contrib.sessions',<br/>    'django.contrib.messages',<br/>    'django.contrib.staticfiles',<br/>    'pages.apps.PagesConfig',<br/>]</span></pre><p id="5aeb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太好了！是时候添加Hello World页面了。</p><h2 id="faaa" class="ng mc it bd md oc od dn mh oe of dp ml lh og oh mn ll oi oj mp lp ok ol mr om bi translated">添加“Hello World”视图</h2><p id="d533" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">编辑文件<code class="fe my mz na nb b">$PROJECT_NAME/pages/views.py</code>，使其看起来像这样:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="2014" class="ng mc it nb b gy nh ni l nj nk">from django.http import HttpResponse</span><span id="9655" class="ng mc it nb b gy nn ni l nj nk">def homePageView(request):<br/>    return HttpResponse('Hello, World!')</span></pre><p id="65b7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，用以下内容创建文件<code class="fe my mz na nb b">$PROJECT_NAME/pages/urls.py</code>:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="33b5" class="ng mc it nb b gy nh ni l nj nk">from django.urls import path</span><span id="9819" class="ng mc it nb b gy nn ni l nj nk">from .views import homePageView</span><span id="8fd6" class="ng mc it nb b gy nn ni l nj nk">urlpatterns = [<br/>    path('', homePageView, name='home')<br/>]</span></pre><p id="f683" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">添加Hello World页面的最后一步是将<code class="fe my mz na nb b">$PROJECT_NAME/urls.py</code>中的代码从:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="f7fc" class="ng mc it nb b gy nh ni l nj nk">from django.contrib import admin<br/>from django.urls import path</span><span id="9360" class="ng mc it nb b gy nn ni l nj nk">urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>]</span></pre><p id="d9f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">收件人:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="68c2" class="ng mc it nb b gy nh ni l nj nk">from django.contrib import admin<br/>from django.urls import path, include</span><span id="2fef" class="ng mc it nb b gy nn ni l nj nk">urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('', include('pages.urls')),<br/>]</span></pre><p id="1668" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！现在，您可以重新加载浏览器，您将看到DevSpace实时更新了您的Django应用程序—无需部署您的项目，因为DevSpace使用热重新加载来更新您的运行容器。</p><p id="e801" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">自己试试:</p><ol class=""><li id="978b" class="no np it la b lb lc le lf lh nq ll nr lp ns lt on nu nv nw bi translated">改变你的Hello World！文件中的语句:<code class="fe my mz na nb b">$PROJECT_NAME/pages/views.py</code></li><li id="26e0" class="no np it la b lb nx le ny lh nz ll oa lp ob lt on nu nv nw bi translated">重新加载浏览器，查看更改如何立即生效。</li></ol><h2 id="70ef" class="ng mc it bd md oc od dn mh oe of dp ml lh og oh mn ll oi oj mp lp ok ol mr om bi translated">额外收获:添加PostgreSQL数据库</h2><p id="3c37" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">在添加Postgres数据库之前，确保您终止了<code class="fe my mz na nb b">devspace dev</code>，例如，使用<code class="fe my mz na nb b">CTRL+C</code>。</p><p id="5c85" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们需要使用以下命令将Python的Postgres驱动程序添加到我们的<code class="fe my mz na nb b">requirements.txt</code>中:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="f9dd" class="ng mc it nb b gy nh ni l nj nk">docker run --rm -v /$PROJECT_DIR:/app -w //app python bash -c "pip install psycopg2 &amp;&amp; pip freeze | grep psycopg2 &gt;&gt; $PROJECT_NAME/requirements.txt"</span></pre><p id="0f76" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们需要告诉DevSpace，我们也想部署一个PostgreSQL数据库。为此，我们需要将我们的<code class="fe my mz na nb b">devspace.yaml</code>中的<code class="fe my mz na nb b">deployments</code>部分从:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="0197" class="ng mc it nb b gy nh ni l nj nk">deployments:<br/>- name: mysite # this line may be different for you<br/>  helm:<br/>    componentChart: true<br/>    values:<br/>      containers:<br/>      # this line may be different for you<br/>      - image: dscr.io/${DEVSPACE_USERNAME}/mysite  <br/>      service:<br/>        ports:<br/>        - port: 8000</span></pre><p id="a6e4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">收件人:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="d8b2" class="ng mc it nb b gy nh ni l nj nk">deployments:<br/>- name: database<br/>  helm:<br/>    chart:<br/>      name: stable/postgresql<br/>    values:<br/>      postgresqlDatabase: "db_mysite"<br/>      postgresqlUsername: "db_user"<br/>      postgresqlPassword: ${DB_PASSWORD}<br/>- name: mysite # this line may be different for you<br/>  helm:<br/>    componentChart: true<br/>    values:<br/>      containers:<br/>      # this line may be different for you<br/>      - image: dscr.io/${DEVSPACE_USERNAME}/mysite<br/>        env:<br/>        - name: DB_HOST<br/>          value: "database-postgresql"<br/>        - name: DB_NAME<br/>          value: "db_mysite"<br/>        - name: DB_USER<br/>          value: "db_user"<br/>        - name: DB_PASSWORD<br/>          value: ${DB_PASSWORD}<br/>      service:<br/>        ports:<br/>        - port: 8000</span></pre><p id="f00c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们再次部署项目，DevSpace现在将启动一个PostgreSQL数据库容器。然而，在我们这样做之前，我们需要配置Django项目来连接数据库。</p><p id="f742" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此将<code class="fe my mz na nb b">$PROJECT_NAME/settings.py</code>从:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="f5f7" class="ng mc it nb b gy nh ni l nj nk">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django.db.backends.sqlite3',<br/>        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),<br/>    }<br/>}</span></pre><p id="d813" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">收件人:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="61c9" class="ng mc it nb b gy nh ni l nj nk">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django.db.backends.postgresql',<br/>        'HOST': os.environ.get('DB_HOST'),<br/>        'NAME': os.environ.get('DB_NAME'),<br/>        'USER': os.environ.get('DB_USER'),<br/>        'PASSWORD': os.environ.get('DB_PASSWORD'),<br/>    }<br/>}</span></pre><p id="f61e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们使用以下命令重新部署Django项目:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="4db0" class="ng mc it nb b gy nh ni l nj nk">devspace dev -b</span></pre><p id="207c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这个改变之后第一次运行<code class="fe my mz na nb b">devspace dev</code>时，DevSpace会要求您定义一个用于变量<code class="fe my mz na nb b">DB_PASSWORD</code> <em class="nm">的数据库密码。</em></p><p id="0da8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意<code class="fe my mz na nb b">-b</code>标志，它是<code class="fe my mz na nb b">--force-rebuild</code>的快捷方式。它告诉DevSpace我们不想使用热重载，而是重建Docker映像并完全重新部署项目。当重要设置发生变化而无法使用热重装进行更新时，这通常很有用，例如<code class="fe my mz na nb b">settings.py</code>。</p><p id="d80c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当您再次看到日志时，您可以中止<code class="fe my mz na nb b">devspace dev</code>或者您可以打开一个额外的终端并检查PostgreSQL数据库的日志以确保在您继续之前它已经准备好了。您可以通过以下方式查看日志来检查它是否准备好了:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="a2f2" class="ng mc it nb b gy nh ni l nj nk">devspace logs -f</span></pre><p id="f48a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在将数据库连接添加到Django应用程序之后，我们需要运行一个迁移。我们可以使用以下命令来实现这一点:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="a51e" class="ng mc it nb b gy nh ni l nj nk">devspace enter python manage.py migrate</span></pre><p id="0eee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">DevSpace将询问您应该在哪个容器中执行迁移。确保选择Django应用程序。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="1960" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">5.部署</h1><p id="ad97" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">如果您完成了应用程序的构建，并且想要发布它，那么您不应该通过<code class="fe my mz na nb b">devspace dev</code>来发布，这是为了开发。对于类似生产的部署，您可以使用以下命令:</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="9a9a" class="ng mc it nb b gy nh ni l nj nk">devspace deploy</span></pre><p id="5ecd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在成功地将Django部署到Kubernetes之后，您可以通过运行以下命令使项目在公共URL上可用或者通过localhost访问它(使用类似于<code class="fe my mz na nb b">devspace dev</code>的端口转发):</p><pre class="kj kk kl km gt nc nb nd ne aw nf bi"><span id="0ebc" class="ng mc it nb b gy nh ni l nj nk">devspace open</span></pre></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="7377" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">下一步是什么？</h1><p id="dceb" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">我希望这篇教程能够帮助很多人开始在Kubernetes上部署Django项目。一个教程很难涵盖每个细节，我想写这篇文章的后续。如果你有任何问题或事情想让我在下一篇文章中写，请留下评论。</p><p id="6bd4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我目前的计划是写另一篇文章，讲述如何使用自动伸缩、数据库高可用性和多阶段Docker构建使基于Kubernetes的Django项目可以投入生产。</p></div></div>    
</body>
</html>