<html>
<head>
<title>A Beginner’s Guide to SQL Injection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL注入初学者指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-beginners-guide-to-sql-injection-163c1ad2257f?source=collection_archive---------6-----------------------#2019-12-01">https://betterprogramming.pub/a-beginners-guide-to-sql-injection-163c1ad2257f?source=collection_archive---------6-----------------------#2019-12-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7e75" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">它是什么，我们如何保护我们的代码免受黑客和不良行为者的攻击？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e6dacfe4bee82d605dbb85259e00c3a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zB5JlbMSA26pklzNRAmSEg.png"/></div></div></figure><p id="dca1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> <em class="ln"> SQL注入</em> </strong>是一个web安全漏洞，使得攻击者能够改变对数据库的SQL查询。这可用于检索一些敏感信息，如数据库结构、表、列及其底层数据。</p><p id="f58b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如，假设应用程序使用以下查询获取某人的登录详细信息:</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="ee1e" class="lt lu iq lp b gy lv lw l lx ly">SELECT USERNAME,PASSWORD from USERS where USERNAME='&lt;username&gt;' AND PASSWORD='&lt;password&gt;';</span></pre><p id="eac5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里，<code class="fe lz ma mb lp b">username</code>和<code class="fe lz ma mb lp b">password</code>是用户提供的输入。假设攻击者在两个字段中都输入了<code class="fe lz ma mb lp b">' OR '1'='1</code>。因此，SQL查询将类似于:</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="fd8f" class="lt lu iq lp b gy lv lw l lx ly">SELECT USERNAME,PASSWORD from USERS where USERNAME='' OR '1'='1' AND PASSWORD='' OR '1'='1';</span></pre><p id="3e7a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该查询产生一个true语句，因此用户登录。这个例子描述了最基本的SQL注入。</p><p id="2213" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">可以在任何地方使用SQL注入从数据库中获取任何敏感信息。</p><p id="31b0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:这是最基本的例子，只是为了便于理解。在现实世界中，你几乎找不到这样的案例。</p><p id="8bf6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以使用这个<a class="ae mc" href="https://portswigger.net/web-security/sql-injection/cheat-sheet" rel="noopener ugc nofollow" target="_blank">备忘单</a>来查看如何对不同的SQL数据库提供者进行查询。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="650f" class="mk lu iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">如何检测SQL注入的存在？</h1><p id="6ef1" class="pw-post-body-paragraph kr ks iq kt b ku nb jr kw kx nc ju kz la nd lc ld le ne lg lh li nf lk ll lm ij bi translated">在大多数情况下，通过提供无效的参数很容易检测到SQL注入，如<code class="fe lz ma mb lp b">'</code>、<code class="fe lz ma mb lp b">'' a' or 1=1--</code>、<code class="fe lz ma mb lp b">"a"" or 1=1--"</code>、<code class="fe lz ma mb lp b">or a = a</code>、<code class="fe lz ma mb lp b">a' waitfor delay '0:0:10'--</code>、<code class="fe lz ma mb lp b">1 waitfor delay '0:0:10'--</code>、<code class="fe lz ma mb lp b">%26</code>、<code class="fe lz ma mb lp b">' or username like '%</code>等。然后，您可以观察应用程序行为的变化。</p><p id="799b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以尝试分析服务器响应的长度，以及发送响应所需的时间。像<code class="fe lz ma mb lp b">'</code>、<code class="fe lz ma mb lp b">a' or 1=1--</code>等有效载荷。可能会显示数据库服务器响应的变化。但是如果没有变化，那么我们尝试使用类似<code class="fe lz ma mb lp b">a' waitfor delay '0:0:10'--</code>的有效载荷来触发时间延迟。这可能会使服务器在发送响应之前延迟一段特定的时间。</p><p id="e870" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在确定网站是否易受<code class="fe lz ma mb lp b">SQL Injection</code>攻击后，我们可以尝试从数据库中提取一些敏感信息。</p><p id="c0f0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在此之前，我们需要识别SQL查询返回的<code class="fe lz ma mb lp b">number of columns</code>。这很重要，因为如果我们试图提取的列数与查询实际返回的列数不相等，那么它将返回一个错误。</p><p id="4cd8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以通过使用<code class="fe lz ma mb lp b">order by</code>命令来确定列的数量。例如:</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="3b99" class="lt lu iq lp b gy lv lw l lx ly"><a class="ae mc" href="http://www.onlineshopping.com/products.php?pid=8" rel="noopener ugc nofollow" target="_blank">www.onlineshopping.com/products.php?pid=8</a> order by 1 -- //<br/>www.onlineshopping.com/products.php?pid=8 order by 2 -- //// If the parameter is a string then you need to add ' after it.www.onlineshopping.com/products.php?usr=b' order by 3 -- //<br/>www.onlineshopping.com/products.php?usr=a' order by 4 -- //</span></pre><p id="b58a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe lz ma mb lp b">--</code>的重要性在于它是SQL中的注释指示器，这使得查询的其余部分成为注释。现在为了保留<code class="fe lz ma mb lp b">--</code>后的<code class="fe lz ma mb lp b">space</code>，我们在其后添加了任何字符，这样<code class="fe lz ma mb lp b">space</code>就不会在<code class="fe lz ma mb lp b">HTTP request</code>中被忽略。根据SQL数据库提供者的不同，我们可能还会使用<code class="fe lz ma mb lp b">#</code>或<code class="fe lz ma mb lp b">/* */</code>进行注释。</p><p id="b486" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">继续此过程，直到遇到错误。如果在使用有效负载<code class="fe lz ma mb lp b">order by 5</code>时遇到错误，而在使用<code class="fe lz ma mb lp b">order by 4</code>时没有遇到错误，这意味着查询将返回<code class="fe lz ma mb lp b">4</code>列。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="0300" class="mk lu iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">如何利用SQL注入进行开发</h1><p id="6492" class="pw-post-body-paragraph kr ks iq kt b ku nb jr kw kx nc ju kz la nd lc ld le ne lg lh li nf lk ll lm ij bi translated">一旦您知道应用程序易受SQL注入攻击，并且您已经确定了列的数量，我们将尝试找到关于数据库的必要信息，如所需表的<code class="fe lz ma mb lp b">DB name</code>、<code class="fe lz ma mb lp b">DB user name</code>、<code class="fe lz ma mb lp b">DB version</code>、<code class="fe lz ma mb lp b">table names</code>、<code class="fe lz ma mb lp b">column names</code>等。查看SQL注入备忘单，找到相应的问题。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="c4d7" class="mk lu iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">SQL注入的类型</h1><ol class=""><li id="a86f" class="ng nh iq kt b ku nb kx nc la ni le nj li nk lm nl nm nn no bi translated"><strong class="kt ir">基于错误的</strong>:这种类型的SQL注入依赖于数据库服务器抛出的<code class="fe lz ma mb lp b">error messages</code>，它可能为我们提供一些关于数据库结构的有用信息。</li><li id="3453" class="ng nh iq kt b ku np kx nq la nr le ns li nt lm nl nm nn no bi translated"><strong class="kt ir">基于联合的</strong>:这种技术使用SQL <code class="fe lz ma mb lp b">UNION</code>操作符来组合两个<code class="fe lz ma mb lp b">SELECT</code>查询的结果并返回一个表。它允许攻击者通过将结果附加到对数据库的原始查询中，从其他表中提取信息。</li><li id="94fd" class="ng nh iq kt b ku np kx nq la nr le ns li nt lm nl nm nn no bi translated"><strong class="kt ir">盲注入</strong>:当应用程序易受<code class="fe lz ma mb lp b">SQL Injection</code>攻击，但<code class="fe lz ma mb lp b">SQL query</code>的结果没有在<code class="fe lz ma mb lp b">HTTP response</code>中返回时，就会出现这种情况。在这种情况下，我们查询数据库中的任何真/假语句，并查看真和假条件的变化。它有两种类型:</li><li id="b535" class="ng nh iq kt b ku np kx nq la nr le ns li nt lm nl nm nn no bi translated"><strong class="kt ir">基于内容的</strong>:在这种技术中，使用任何条件语句查询数据库服务器，并且在发送<code class="fe lz ma mb lp b">true</code>条件和<code class="fe lz ma mb lp b">false</code>条件的同时，分析来自服务器的<code class="fe lz ma mb lp b">response</code>的任何差异。</li><li id="947d" class="ng nh iq kt b ku np kx nq la nr le ns li nt lm nl nm nn no bi translated"><strong class="kt ir">基于时间的</strong>:这种技术依赖于注入一个SQL查询，让数据库根据指定的条件等待特定的时间。服务器发送回响应所花费的时间决定了查询是对还是错。</li><li id="c66f" class="ng nh iq kt b ku np kx nq la nr le ns li nt lm nl nm nn no bi translated"><strong class="kt ir">带外注入</strong>(不常见):这不是一种非常常见的<code class="fe lz ma mb lp b">SQL Injection</code>类型，因为它取决于数据库服务器上启用的特性。它依靠数据库服务器的能力来发出类似于<code class="fe lz ma mb lp b">HTTP</code>、<code class="fe lz ma mb lp b">DNS</code>和<code class="fe lz ma mb lp b">ftp</code>的web请求，以便向攻击者发送数据。</li></ol></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="ce22" class="mk lu iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">如何保护你的代码免受SQL注入？</h1><ol class=""><li id="5344" class="ng nh iq kt b ku nb kx nc la ni le nj li nk lm nl nm nn no bi translated">永远不要用用户的输入直接构造查询。相反，使用<strong class="kt ir">参数化语句</strong>。它们<strong class="kt ir"> </strong>确保传递给SQL查询的输入得到安全处理。</li><li id="da29" class="ng nh iq kt b ku np kx nq la nr le ns li nt lm nl nm nn no bi translated">T21对用户输入进行净化总是好的。此外，正确的<strong class="kt ir">输入验证</strong>应该完成，例如，姓名不能是数字，电话号码不能是字母。然而，这有时可以被绕过。</li><li id="da6b" class="ng nh iq kt b ku np kx nq la nr le ns li nt lm nl nm nn no bi translated">使用<strong class="kt ir">安全驱动</strong>与您的SQL数据库交互。它们会自动防范所有SQL注入攻击。比如python的SQLAlchemy。</li></ol></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="2a3a" class="mk lu iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">资源</h1><ol class=""><li id="7a1f" class="ng nh iq kt b ku nb kx nc la ni le nj li nk lm nl nm nn no bi translated"><a class="ae mc" href="http://sqlmap.org/" rel="noopener ugc nofollow" target="_blank"> SQL Map </a>是一个开源工具，用于<code class="fe lz ma mb lp b">automates</code>处理<code class="fe lz ma mb lp b">detecting</code>和<code class="fe lz ma mb lp b">exploiting</code> SQL注入漏洞。</li><li id="794c" class="ng nh iq kt b ku np kx nq la nr le ns li nt lm nl nm nn no bi translated">这个<a class="ae mc" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection" rel="noopener ugc nofollow" target="_blank">库</a>在<code class="fe lz ma mb lp b">SQL Injection</code>上有一些很酷的资源。这包括一些备忘单和许多有用的有效载荷，可以根据用例来使用。</li></ol><p id="46d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不要忘记留下一些掌声，以防你喜欢这个博客</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><p id="9690" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ln">我们连线吧？</em></p><p id="5241" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ln">领英:</em><a class="ae mc" href="https://linkedin.com/in/ashwigoel" rel="noopener ugc nofollow" target="_blank"><em class="ln">https://linkedin.com/in/ashwigoel</em></a></p><p id="587c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ln">网址:【https://ashwingoel.com】<a class="ae mc" href="https://ashwingoel.com" rel="noopener ugc nofollow" target="_blank"><em class="ln"/></a></em></p><p id="ecf9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ln">邮箱:</em><a class="ae mc" href="mailto:goelashwin36@gmail.com" rel="noopener ugc nofollow" target="_blank"><em class="ln">【goelashwin36@gmail.com】</em>T5】</a></p></div></div>    
</body>
</html>