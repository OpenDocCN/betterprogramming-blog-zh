<html>
<head>
<title>How To: AWS Cognito + Sign In With Slack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何:AWS Cognito +使用Slack登录</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-aws-cognito-sign-in-with-slack-85430aba6cc1?source=collection_archive---------8-----------------------#2019-11-07">https://betterprogramming.pub/how-to-aws-cognito-sign-in-with-slack-85430aba6cc1?source=collection_archive---------8-----------------------#2019-11-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="79b7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建一个OpenID Connect兼容的shim，用于与AWS Cognito一起使用的Slack登录</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1edf1189221f582d054d9fd8d3faf43d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tsewvKTdN3YbMuG7"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杰西·布瑟在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="257b" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">问题是</h1><p id="7b67" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">用Slack登录只是一个OAuth2实现，而不是一个<a class="ae ky" href="https://openid.net/connect/" rel="noopener ugc nofollow" target="_blank"> OpenID Connect </a> (OIDC)实现。这意味着它只提供<em class="mu">授权</em>而不提供<em class="mu">认证</em>。</p><ul class=""><li id="cb89" class="mv mw it ma b mb mx me my mh mz ml na mp nb mt nc nd ne nf bi translated">认证:这个用户是他们所说的那个人吗？</li><li id="1638" class="mv mw it ma b mb ng me nh mh ni ml nj mp nk mt nc nd ne nf bi translated">授权:允许用户访问特定的资源吗？</li></ul><p id="4c09" class="pw-post-body-paragraph ly lz it ma b mb mx ju md me my jx mg mh nl mj mk ml nm mn mo mp nn mr ms mt im bi translated">这意味着您不能在<a class="ae ky" href="https://aws.amazon.com/cognito/" rel="noopener ugc nofollow" target="_blank"> AWS Cognito </a>中使用Slack的本地登录作为OIDC提供者，因为Slack只提供了一个可用于访问Slack资源的访问令牌，而不是一个告诉我们用户是谁的ID令牌。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="f6ba" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">解决方案</h1><p id="57bc" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">幸运的是，Slack有一个获取用户数据的API，我们可以用它来构建ID令牌。</p><p id="ab1b" class="pw-post-body-paragraph ly lz it ma b mb mx ju md me my jx mg mh nl mj mk ml nm mn mo mp nn mr ms mt im bi translated">这些都将被放在位于AWS Cognito和Slack之间的<a class="ae ky" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/2c141817638f3dd5b941d8cbcd9f3bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*2DKNKTpoSNCoshKQtJyI0g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">认知和松弛之间的λ垫片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="662b" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">它看起来像什么</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/3834a172ca72224c01cbc266d29e9305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V7zuI_zgOUcdaW2JrWsHYw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">归功于<a class="ae ky" href="https://twitter.com/JonesTim" rel="noopener ugc nofollow" target="_blank"> @JonesTim </a></p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="eddf" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">如何实施</h1><p id="0149" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">前往<a class="ae ky" href="https://github.com/jonoirwinrsa/slack-cognito-openid-wrapper" rel="noopener ugc nofollow" target="_blank">GitHub repo</a>查看自述文件获取详细说明。下面列出了基本要素:</p><ol class=""><li id="7adb" class="mv mw it ma b mb mx me my mh mz ml na mp nb mt nq nd ne nf bi translated">创建一个认知用户池。(如果您使用的是<a class="ae ky" href="https://aws.amazon.com/amplify/" rel="noopener ugc nofollow" target="_blank"> AWS Amplify </a>，请确保将默认设置从电子邮件更改为用户名验证。)</li><li id="85be" class="mv mw it ma b mb ng me nh mh ni ml nj mp nk mt nq nd ne nf bi translated">使用Cognito <em class="mu">域</em>作为Slack应用重定向URL，创建一个Slack应用。</li><li id="f9d2" class="mv mw it ma b mb ng me nh mh ni ml nj mp nk mt nq nd ne nf bi translated">将<code class="fe nr ns nt nu b">example-config.sh</code>复制到<code class="fe nr ns nt nu b">config.sh</code>并更新其中的变量。</li><li id="090b" class="mv mw it ma b mb ng me nh mh ni ml nj mp nk mt nq nd ne nf bi translated"><code class="fe nr ns nt nu b">npm install</code>和<code class="fe nr ns nt nu b">npm run deploy</code>。</li><li id="7696" class="mv mw it ma b mb ng me nh mh ni ml nj mp nk mt nq nd ne nf bi translated">使用步骤4中从<a class="ae ky" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank"> CloudFormation </a>输出的URL，使用以下配置将<em class="mu">OpenID Connect Federation Provider</em>添加到您现有的Cognito用户池<strong class="ma iu"> </strong>:</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/8ccaed38b504cfaf66e763b396564b47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*_zL-wdiBfBUtuYavW_rGZA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">OpenID连接提供程序</p></figure><p id="8dfb" class="pw-post-body-paragraph ly lz it ma b mb mx ju md me my jx mg mh nl mj mk ml nm mn mo mp nn mr ms mt im bi translated">6.在Cognito用户池<em class="mu">应用客户端设置中启用新的Slack提供者。</em></p><p id="c7bd" class="pw-post-body-paragraph ly lz it ma b mb mx ju md me my jx mg mh nl mj mk ml nm mn mo mp nn mr ms mt im bi translated">7.更新<em class="mu">联盟属性映射中的用户信息映射。</em></p><p id="2405" class="pw-post-body-paragraph ly lz it ma b mb mx ju md me my jx mg mh nl mj mk ml nm mn mo mp nn mr ms mt im bi translated">7.返回<em class="mu"> App客户端设置</em> <strong class="ma iu">，</strong>点击<em class="mu">启动托管UI </em>测试你的新Slack登录。</p><p id="2622" class="pw-post-body-paragraph ly lz it ma b mb mx ju md me my jx mg mh nl mj mk ml nm mn mo mp nn mr ms mt im bi translated">如果一切顺利，应该会使用代码<code class="fe nr ns nt nu b">GET</code>变量将您重定向到您的应用程序。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="c99e" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">出事了</h1><p id="02d2" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如果不成功:</p><ol class=""><li id="6df5" class="mv mw it ma b mb mx me my mh mz ml na mp nb mt nq nd ne nf bi translated">将<code class="fe nr ns nt nu b">src/connectors/logger.js</code>中的Winston记录器级别从<code class="fe nr ns nt nu b">info</code>更改为<code class="fe nr ns nt nu b">debug</code>。</li><li id="b9d1" class="mv mw it ma b mb ng me nh mh ni ml nj mp nk mt nq nd ne nf bi translated"><code class="fe nr ns nt nu b">npm run deploy</code>又来了。</li><li id="1715" class="mv mw it ma b mb ng me nh mh ni ml nj mp nk mt nq nd ne nf bi translated">查看<a class="ae ky" href="https://aws.amazon.com/cloudwatch/" rel="noopener ugc nofollow" target="_blank"> CloudWatch </a>中的Lambda日志。</li></ol></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="7047" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">奖励:反应放大登录按钮</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="6709" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">资源</h1><ul class=""><li id="9a2f" class="mv mw it ma b mb mc me mf mh ny ml nz mp oa mt nc nd ne nf bi translated">Slack Shim代码:<a class="ae ky" href="https://github.com/jonoirwinrsa/slack-cognito-openid-wrapper" rel="noopener ugc nofollow" target="_blank">https://github . com/jonoirwinrsa/slack-cognito-OpenID-wrapper</a></li><li id="8f65" class="mv mw it ma b mb ng me nh mh ni ml nj mp nk mt nc nd ne nf bi translated">这是基于GitHub Cognito Shim 的蒂莫西·琼斯的功劳。</li></ul></div></div>    
</body>
</html>