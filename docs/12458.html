<html>
<head>
<title>WWDC22: Get Started With WeatherKit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">With WeatherKit入门</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/wwdc22-get-started-with-weatherkit-202794853c01?source=collection_archive---------5-----------------------#2022-06-07">https://betterprogramming.pub/wwdc22-get-started-with-weatherkit-202794853c01?source=collection_archive---------5-----------------------#2022-06-07</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="24c8" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">苹果新的免费API可以让你每月免费调用50万次API</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/79cd9c9d9d9f2aced39fcbf081b8a876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XUk4q4tmCCxAYUtt.jpg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自<a class="ae kz" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1867550" rel="noopener ugc nofollow" target="_blank">像素库</a>的<a class="ae kz" href="https://pixabay.com/users/pexels-2286921/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1867550" rel="noopener ugc nofollow" target="_blank">像素</a>的图像</p></figure><p id="292c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">启动和运行WeatherKit的许多复杂性在于获得适当的功能。前往<a class="ae kz" href="https://developer.apple.com/account/resources/identifiers/add/bundleId" rel="noopener ugc nofollow" target="_blank">在苹果开发者网站上创建一个应用ID </a>。</p><p id="c371" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您需要在名为“功能”和“应用服务”的两个选项卡上启用WeatherKit。您的捆绑包标识符需要明确，并且您需要在创建应用ID后等待至少30分钟，然后才能尝试使用WeatherKit。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj lw"><img src="../Images/b067975cbeee365d2d15edb9a4bfe1df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6j6nZA_YxMth1Z7g3bfSsw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者截图</p></figure><p id="d06b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在在Xcode 14 beta中创建新的app项目，确保在项目文件的<em class="lx">签名和功能</em>选项卡上添加WeatherKit功能，如下所示。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ly"><img src="../Images/f28a23bbcd307a57960b26aeb4ec6472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zF2AZzENVkN9N3LdW4ZoCA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者截图</p></figure><p id="4a07" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，希望您已经使用正确的功能和应用服务创建了您的应用ID，并等待了半个小时，然后您已经使用与您的应用ID相同的捆绑包ID创建了一个应用项目，最后您已经将该功能添加到您的项目文件中。</p><p id="20d7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在我们实际上可以开始有趣的部分了，那就是制作一个显示天气数据的SwiftUI界面。</p><p id="118c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了简单起见，我制作了一个只显示库比蒂诺当前温度的应用程序:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="lz ma l"/></div></figure><p id="5a13" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">使用<a class="ae kz" href="https://latlong.net" rel="noopener ugc nofollow" target="_blank">latlong.net</a>计算Cuptertino的纬度和经度，并保存为静态<code class="fe mb mc md me b">CLLocation</code>对象。为了让屏幕上的温度变大，选择了一个巨大的字体大小和最小的比例因子。这就是我们如何访问UIKit中的“自动收缩”功能。使用行限制是为了避免单元被放到第二行，如果字符串太长就会出现这种情况。</p><p id="14a9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当<code class="fe mb mc md me b">weather</code>对象为零时，有一个<code class="fe mb mc md me b">ProgressView</code>形式的旋转器，当旋转器第一次出现时，使用<code class="fe mb mc md me b">.task</code>修改器来获取天气。这个<code class="fe mb mc md me b">ProgressView</code>和显示温度的<code class="fe mb mc md me b">Text</code>都在一个组内，所以它们可以有相同的导航标题。这显示在屏幕的顶部，让我们知道我们显示的温度的位置。</p><p id="5ca4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe mb mc md me b">WeatherService</code>有一个<code class="fe mb mc md me b">shared</code> singleton，这就是我们访问WeatherKit API的方式。不需要添加任何类型的身份验证，因为这是通过App ID的功能完成的。经过<code class="fe mb mc md me b">WeatherService</code>一个位置给了我们一个物体一堆有用的数据，但是我们现在只关心当前的天气。</p><p id="7052" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">目前的天气结束了类似<a class="ae kz" href="https://gist.github.com/sturdysturge/78091a0c7dcd09bd2840bcbd58ef389d" rel="noopener ugc nofollow" target="_blank">这种JSON </a>的结构。</p><p id="ef52" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你在创建你的应用程序ID后没有等待半个小时，你可能会得到一个<code class="fe mb mc md me b">fatalError</code>，说你得到了一个无效的JWT响应和一个401错误代码。如果你在等待半小时后仍然收到这个错误，你的应用ID可能没有正确配置(或者苹果的服务器太慢)。</p><p id="7882" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我也遇到过抱怨天气对象的某些部分丢失的错误。</p><p id="bbfc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你也许可以通过将<code class="fe mb mc md me b">fatalError</code>改为打印错误来阻止应用程序崩溃，因为它们不一定是致命的错误。</p><p id="4f40" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">暂时就这样吧！</p></div></div>    
</body>
</html>