<html>
<head>
<title>Simple SSH Tweaks for Remote Developers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">针对远程开发人员的简单SSH调整</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/simple-ssh-tweaks-for-remote-developers-4392a1409c33?source=collection_archive---------2-----------------------#2020-10-08">https://betterprogramming.pub/simple-ssh-tweaks-for-remote-developers-4392a1409c33?source=collection_archive---------2-----------------------#2020-10-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="88b4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">简单的SSH连接调整将节省您的时间</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7621b782ad2a8f5004e1d8d59e534429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dMBcjRhj9qDI90UqlXAaDQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@muhraufan?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Muhammad Raufan Yusup </a>在<a class="ae ky" href="https://unsplash.com/s/photos/internet?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><blockquote class="kz"><p id="6a93" class="la lb it bd lc ld le lf lg lh li lj dk translated">与<insert_host_here>的连接关闭。</insert_host_here></p></blockquote><p id="7a66" class="pw-post-body-paragraph lk ll it lm b ln lo ju lp lq lr jx ls lt lu lv lw lx ly lz ma mb mc md me lj im bi translated">你几乎每天都看到这条信息吗？对于一些开发人员来说，登录和退出远程机器来完成工作就像发送电子邮件一样平常。拥有对机器的远程SSH访问可以让您做任何事情，从故障排除到直接在机器上开发。只要你有一个稳固的网络连接和一套证书，你就可以在任何地方完成工作。</p><p id="5481" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">随着越来越多的开发人员完全远程化，拥有健壮灵活的SSH访问变得至关重要。无论您是专注于设置新的基础设施，还是只是远程测试新版本的应用程序，能够快速连接而不必记住模糊的地址或其他信息都是提高工作效率的关键。当您可以登录并工作时，您很容易浪费大量时间来摸索连接信息。</p><p id="4540" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">在本文中，我们将探索一些简单明了的SSH连接调整和技术，这些调整和技术将节省时间并改进您在远程机器上的工作方式。一些调整非常简单，只需为您经常使用的机器添加一些自定义别名，而其他一些则稍微复杂一些，利用套接字和转发。让我们开始吧。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="363e" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">主机别名</h1><p id="e654" class="pw-post-body-paragraph lk ll it lm b ln nj ju lp lq nk jx ls lt nl lv lw lx nm lz ma mb nn md me lj im bi translated">停止键入您定期连接的机器的完整用户名和主机名。请在SSH配置中使用主机别名。这是一种简单、快速的方法，可以减少您必须为经常访问的主机键入的信息。在<code class="fe no np nq nr b">~/.ssh/config</code>中打开(或者创建，如果你还没有的话)你的SSH配置，添加一个条目，如下所示，带有你自己的主机信息:</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="70f1" class="nw ms it nr b gy nx ny l nz oa">Host my_host<br/>    HostName 1.2.3.4<br/>    User my_username<br/>    IdentityFile ~/.ssh/&lt;my_key&gt;<br/>    ForwardAgent yes</span></pre><p id="0a25" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">让我们来分解这个条目的各个部分:</p><ul class=""><li id="2591" class="ob oc it lm b ln mf lq mg lt od lx oe mb of lj og oh oi oj bi translated">第一个声明是<code class="fe no np nq nr b">Host</code>条目本身，它指定了这个主机的别名。为这台机器输入一个您将记住的友好名称。</li><li id="b44b" class="ob oc it lm b ln ok lq ol lt om lx on mb oo lj og oh oi oj bi translated">第二个(缩进一个)是该主机的实际<code class="fe no np nq nr b">HostName</code>或地址。这可以是用于连接远程主机的FQDN或IP地址。</li><li id="0adf" class="ob oc it lm b ln ok lq ol lt om lx on mb oo lj og oh oi oj bi translated">接下来是您将作为连接到机器的<code class="fe no np nq nr b">User</code>。如果远程机器与本地机器上的用户不匹配，那么您应该在这里指定。</li><li id="2990" class="ob oc it lm b ln ok lq ol lt om lx on mb oo lj og oh oi oj bi translated">最后两个条目是可选的，但值得注意。<code class="fe no np nq nr b">IdentityFile</code>允许您选择私钥文件的路径，以便使用SSH密钥对连接到该主机。<code class="fe no np nq nr b">ForwardAgent</code>为您提供了将ssh-agent传递到远程机器的选项，这样您已经添加的任何凭证都将出现在您的ssh会话中(从一个主机跳到另一个主机，等等)。).</li></ul></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="6ce3" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">多路复用/控制插座</h1><p id="90af" class="pw-post-body-paragraph lk ll it lm b ln nj ju lp lq nk jx ls lt nl lv lw lx nm lz ma mb nn md me lj im bi translated">下一个问题比添加别名稍微复杂一点。使用SSH多路复用允许您建立一个持久的、共享的“控制”连接，供多个SSH会话使用。这也意味着共享连接可以在一段时间内保持打开，这样就省去了每次进出不同主机都要重新建立初始连接的麻烦。</p><p id="035a" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">这在远程主机登录时使用双因素身份验证或一些附加安全层的情况下尤其有用。如果您将控制套接字设置为持续一段时间，那么每次退出该主机并尝试再次登录(在时间窗口内)时，您都不必从头开始重新进行身份验证。只要您不将<code class="fe no np nq nr b">ControlPersist</code>参数设置得太高(例如，不超过一个小时)，那么这将保持在方便的范围内，不会成为重大的安全漏洞。</p><p id="0a4a" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">这种多路复用连接的方法对于减少多个并行会话的连接开销也很有价值。每次SSH到远程主机时，都必须分配一个端口并建立一个TCP连接。当您利用多路复用连接时，由于基本连接已经被共享，因此这种开销会显著降低。</p><p id="77ca" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">要为特定主机添加多路复用，请查看下面的SSH配置:</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="1af1" class="nw ms it nr b gy nx ny l nz oa">Host my_host<br/>    ControlPath ~/.ssh/sockets/control-%r@%h:%p<br/>    ControlMaster auto<br/>    ControlPersist 5m</span></pre><p id="bea3" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">上面的配置告诉SSH，当您建立到<code class="fe no np nq nr b">my_host</code>的连接时，使用<code class="fe no np nq nr b">~/.ssh/sockets/</code>中的控制套接字并保持连接打开五分钟。<code class="fe no np nq nr b">ControlPath</code>中的变量将根据远程用户、地址和端口来命名套接字，以保持该主机的唯一性。</p><p id="a6d4" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">查看WikiBooks 中的这篇文章，了解更多关于SSH复用的信息。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="3b46" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">开挖隧道</h1><p id="28ef" class="pw-post-body-paragraph lk ll it lm b ln nj ju lp lq nk jx ls lt nl lv lw lx nm lz ma mb nn md me lj im bi translated">您是否曾经想要测试运行在远程主机上的web服务，但是由于您和该主机之间的防火墙而无法测试？如果您在云实例上运行服务，那么这是一个非常普遍的问题。因为害怕被攻击，没有人愿意从他们珍贵的服务器上打开80甚至443端口来访问互联网。如果你只是在测试一个服务，还没有完全锁定它，这一点尤其正确。</p><p id="3499" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">SSH隧道快速而优雅地解决了这个问题。您所需要做的就是通过您用来连接到远程主机的同一个SSH会话转发一个端口，然后您就可以安全地测试一整天了。</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="4c0e" class="nw ms it nr b gy nx ny l nz oa">ssh -L 48000:1.2.3.4:80 1.2.3.4</span></pre><p id="f2cc" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">让我们分析一下这个命令中发生了什么。首先，我们将<code class="fe no np nq nr b">-L</code>标志传递给SSH，告诉它我们希望通过隧道将本地套接字绑定到远程套接字。接下来，我们传入一个本地端口以在我们的机器上使用，在本例中是<code class="fe no np nq nr b">48000</code>，后面是远程端的主机和端口。最后，我们通过远程主机再次连接(毕竟这是SSH)。</p><p id="b04f" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">一旦输入这个命令，就会建立一个新的会话，看起来您所做的就是连接到远程主机。如果您将web浏览器指向<code class="fe no np nq nr b">localhost:48000</code>，您应该会看到服务在隧道的另一端从远程主机运行。答对了。不要再玩弄防火墙规则或向互联网开放端口。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="4bf2" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">代理/跳转主机</h1><p id="df9d" class="pw-post-body-paragraph lk ll it lm b ln nj ju lp lq nk jx ls lt nl lv lw lx nm lz ma mb nn md me lj im bi translated">我们列表中的最后一个，但肯定不是最不重要的，是<a class="ae ky" href="https://en.wikipedia.org/wiki/Jump_server" rel="noopener ugc nofollow" target="_blank"> <em class="op">跳转主机</em> </a>或<em class="op">跳转框</em>的概念。这实际上是一个额外的服务器，被配置为充当其他服务器的网关。在许多环境中，这是一种常见的安全做法，可以防止用户直接访问多台不同的机器。用户不能连接到一个组中的一堆不同的服务器，他们必须通过一个单独的机器来引导他们所有的连接。</p><p id="a663" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">这是有益的，原因有很多，包括集中的身份验证日志记录、更好的面向互联网的安全状态，以及需要管理的安全足迹更少。</p><p id="2681" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">但是对于开发人员的工作流程呢？好吧，如果你经常在跳转主机后面的服务器上测试，那么这就需要改变你的连接工作流程。为了访问该主机，您可以简单地SSH两次并手动处理，但是这需要宝贵的时间，并且会使事情变得复杂。你不会想忘记你在哪个主机上，并开始修改跳转主机而不是你的预定目标，你会吗？</p><p id="6aa9" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">在这种情况下，您可以利用SSH的跳转主机或代理命令工具。如果您使用的是相对较新版本的SSH客户端，那么您应该可以访问<code class="fe no np nq nr b">-J</code>选项:</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="2f83" class="nw ms it nr b gy nx ny l nz oa">ssh -J &lt;jumphost_address&gt; &lt;remote_host&gt;</span></pre><p id="cef8" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">如果你使用的是没有这个功能的旧版本SSH，那么你总是可以使用<code class="fe no np nq nr b">ProxyCommand</code>，就像这样:</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="4911" class="nw ms it nr b gy nx ny l nz oa">ssh -o ProxyCommand="ssh -W %h:%p &lt;jumphost_address&gt;" &lt;remote_host&gt;</span></pre><p id="e8e7" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">这两个命令都告诉SSH，在到达我们想要的目标主机之前，应该有一个我们想要首先连接的中间主机。这些是有帮助的，因为它们减少了你必须考虑进行的“跳跃”的次数，但是如果我们想让事情变得更简洁呢？</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="52fb" class="nw ms it nr b gy nx ny l nz oa">Host my_host<br/>    Hostname &lt;remote_host&gt;<br/>    User &lt;my_username&gt;<br/>    IdentityFile ~/.ssh/id_rsa<br/>    ProxyCommand ssh -W %h:%p &lt;jumphost_address&gt;</span></pre><p id="4b56" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">上面的SSH配置将使用相同的<code class="fe no np nq nr b">ProxyCommand</code>来告诉SSH，当您连接到<code class="fe no np nq nr b">my_host</code>时，您希望在两者之间使用一个跳转主机。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="bae6" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">感谢您的阅读。我希望您喜欢探索一些调整远程SSH连接工作流的方法。这些方法中的许多方法也可以结合起来，形成一个强大的配置，您可以随身携带。有关可用SSH选项的更多信息，请查看您的版本的<a class="ae ky" href="https://linux.die.net/man/1/ssh" rel="noopener ugc nofollow" target="_blank">手册页</a>。</p></div></div>    
</body>
</html>