<html>
<head>
<title>Welcome to the MVVM-Router With SwiftUI and Combine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">欢迎使用SwiftUI和Combine的MVVM路由器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swiftui-combine-welcome-to-the-mvvm-router-f4f497a05e6d?source=collection_archive---------0-----------------------#2020-10-17">https://betterprogramming.pub/swiftui-combine-welcome-to-the-mvvm-router-f4f497a05e6d?source=collection_archive---------0-----------------------#2020-10-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="026a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">充满希望的观点模型</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/92cc39df39efe226e6ba8211f7f2c9e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8FYReFPcJ1s8pYjP"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SpaceX 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的<a class="ae kv" href="https://unsplash.com/@spacex?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"/></p></figure><p id="55ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大家好。像你们中的许多人一样，我最近开始了我在SwiftUI和Combine的新的陌生世界中的旅程，我必须说，我在很大程度上非常享受这一旅程。是的，它当然是新的，它是华而不实的，它是年轻的，但它也充满了承诺(结合，眨眼眨眼)。我真的希望这些工具能够很好地成熟起来，并有足够的动力为我们iOS开发者留下来。</p><p id="13ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是让我们不要分心，而是专注于本文的目标。与任何新工具一样，需要反复试验才能找到使用它们的最佳方式，并从中获得最大收益。随着强大的力量而来的是伟大…(耳边的低语告诉我，我走在正确的道路上)。</p><p id="ad15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，您将看到我对SwiftUI的MVVM实现的看法，并将其结合到一个非常简单的项目中。</p><p id="ef91" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将在项目中找到的所有工具和模块都是为了展示我们如何实现著名的MVVM模式，同时避免新的iOS语言编码工具带来的一些陷阱。</p><p id="a057" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是少说话，多显示代码。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0700" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">示例项目</h1><p id="600e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如前所述，为本文创建的项目非常简单。</p><p id="2730" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些工具和特性的实现还远没有准备好投入生产，它们只是作为一个示例和基础，供进一步改进时参考。</p><p id="3944" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">源代码可以在这里找到:<a class="ae kv" href="https://github.com/lukacs-m/SpaceXMVVMSwiftUICombine/tree/master" rel="noopener ugc nofollow" target="_blank"> SpaceXSwiftUICombine </a>。</p><p id="231d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">主要目标是向用户显示SpaceX的所有发射，同时添加一些小的数据处理功能(搜索和过滤)。</p><p id="3c0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是您通过挖掘源代码可以找到的内容:</p><ul class=""><li id="8dcd" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">组合网络</li><li id="caba" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">数据真实的单一来源(组合工具的组合/依赖注入)</li><li id="e948" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">集中式路由协调器</li><li id="0a58" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">大量的依赖注入</li><li id="a0d9" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">许多协议:0</li><li id="1f7b" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">一些搜索和过滤功能</li></ul><p id="ea22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是总的来说，核心结构应该与您可能已经熟悉的以前的MVVM实现非常相似。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="ff67" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">这种MVVM路由器的主要特点</h1><h2 id="5742" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">集中式路由协调器</h2><p id="1c89" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如果您已经使用过SwiftUI，那么您一定很早就注意到视图之间的耦合非常紧密。导航链接或工作表通常通过名称调用导航流中的下一个视图。这使得导航的任何未来变化都非常复杂(尤其是在复杂的应用导航环境中)。我的方法是尝试将路由集中在一个地方，可以共享或传递给任何视图模型。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c77d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如您在上面的代码中看到的，mainRouter基于有助于解耦视图的协议。这可以通过在视图模型中设置一个路由器，并在视图中需要时调用它来实现，如下两个示例所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="aea2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瞧，你的视图忘记了“routeToLaunches()”或“routeToRockets()”代表什么。</p><p id="d183" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这也适用于需要数据共享的路由，正如您看到的到“DetailLaunchView”的路由</p><h2 id="4667" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">数据真实的单一来源</h2><p id="7c52" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这个特性很容易通过依赖注入、使用特定的数据管理存储库以及组合来实现。</p><p id="abcd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它不是新的，但是很好用。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="4a2c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与路由协议一样，我们利用协议的力量来减少耦合。存储库可以通过依赖注入传递到应用程序的任何部分。只需订阅协议中声明的发布者，您就可以访问最新、最新鲜的数据流。</p><p id="7d3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例子胜过千言万语:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ol class=""><li id="9ebf" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr ny nc nd ne bi translated">声明您的数据共享存储库</li><li id="5baa" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">注入组件</li><li id="0afe" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">订阅&amp;分配或使用发送的数据。与@Published变量结合使用效果非常好。</li><li id="86e1" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">然后，您可以对数据应用所需的转换</li><li id="fd07" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">随心所欲地在本地数据上应用这些更改。</li></ol><p id="86b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总的来说，用SwiftUI和Combine以及某种DI实现这些类型的技术是轻而易举的。如果你觉得懒，有太多的依赖注入库应该会有帮助(Resolve、SwiftInject等等)。</p><h2 id="c5a6" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">数据处理的容易程度</h2><p id="312c" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">作为最后一点，我想快速回顾一下SwiftUI和Combine之间已经存在的良好共生关系。</p><p id="9e90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，您只需关注一个非常简单的搜索和过滤栏的实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="8cc9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面是一个显示space X发射的简单网格视图。</p><ol class=""><li id="384d" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr ny nc nd ne bi translated">视图和视图模型之间的绑定。在本例中，是TextField内容和viewModel查询变量。</li><li id="2456" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">视图和viewModel筛选器之间的绑定。</li><li id="890a" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">将Gridview显示的数据链接到viewModel启动。</li></ol><p id="26b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，让我们看看如何在viewModel中处理传入的数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="5e71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">神奇的事情发生在filteredLaunchesPublisher变量中。组合、去抖、处理和分配。在很少的几行代码中，我们对数据进行了全功能的搜索和过滤。</p><ol class=""><li id="0905" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr ny nc nd ne bi translated">@Published variables有助于viewModel和视图之间的数据绑定。</li><li id="5554" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">创建用于处理数据的发布者。在这种情况下，它是我们的真理主流的组合:启动、查询和应用过滤器。</li><li id="32c1" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">将处理发布者分配给局部有界变量以显示最新数据。</li></ol></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="033f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">可以尝试的一些技巧和窍门</h1><p id="c9fa" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我将用我在使用SwiftUI和Combine时获得的一些提示和技巧来结束这篇文章。</p><h2 id="9a23" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">分配强引用</h2><p id="bd94" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">首先，似乎combine assign在元素之间创建了一个强引用。为了解决这个问题，forums.swift.org有人想出了一段很棒的代码。我建议用那个。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="14c9" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">惰性加载导航链接子视图</h2><p id="92cf" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">另一个奇怪的发现是NavigationLink destination中的视图集并不总是延迟加载的。事实上，似乎恰恰相反。这可能会导致你的应用程序在启动时加载大量数据。StackOverflow再次成为我们的朋友。我们的一个同事想出了一小段很好的代码来解决这个问题。你可以在这里找到更多信息<a class="ae kv" href="https://medium.com/better-programming/swiftui-navigation-links-and-the-common-pitfalls-faced-505cbfd8029b" rel="noopener">。诀窍是:</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="9e1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，你像这样使用它:</p><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="c1f6" class="nk ma iq oa b gy oe of l og oh">NavigationLink(destination: <strong class="oa ir">LazyView</strong>( ** Put your destination view **)) { ** NavigationLink UI ** }</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="4aeb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这个关于如何用SwiftUI和Combine实现MVVM的概述对您有所帮助。我希望它给了你一些好的想法，并澄清了你的任何问题。</p><p id="c019" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想了解特定主题的更多信息，请随时联系我们。我也总是希望讨论如何改进、修改或补充之前讨论过的话题。</p></div></div>    
</body>
</html>