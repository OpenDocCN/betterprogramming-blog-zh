<html>
<head>
<title>Android 2-Way Data Binding With MVVM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android与MVVM的双向数据绑定</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/android-2-way-data-binding-with-mvvm-c13022a2f04a?source=collection_archive---------3-----------------------#2021-02-18">https://betterprogramming.pub/android-2-way-data-binding-with-mvvm-c13022a2f04a?source=collection_archive---------3-----------------------#2021-02-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8b03" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将数据绑定的力量与架构组件结合起来</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c98341f5ee76ad176f1a42d0faae19f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Vhs5voVQ3IQsOQNb"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@emtm17?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Marissa &amp; Eric </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="c202" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个系列的开始，在这个系列中，您将学习数据绑定基础知识，以及如何将数据绑定用于像<code class="fe lv lw lx ly b">LiveData</code>和<code class="fe lv lw lx ly b">ViewModel</code>这样的架构组件。</p><p id="4a62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一部分中，我们将介绍基础知识、双向绑定和代码优化。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="62af" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">介绍</h1><p id="b2c9" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">数据绑定是一个框架，它通过减少开发人员需要编写的样板代码来充当布局和数据源之间的桥梁。这将为他们提供时间专注于重要的事情，从而提高他们的工作效率。</p><p id="20c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我假设您熟悉数据绑定的基础知识。如果你不是，我强烈建议你在继续之前阅读下面的文章:</p><div class="nd ne gp gr nf ng"><a href="https://sgkantamani.medium.com/data-binding-in-android-4ff7bba93a2c" rel="noopener follow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">Android中的数据绑定</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">不再需要编程来更新UI并将事件链接到视图</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">sgkantamani.medium.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu ks ng"/></div></div></a></div><p id="9820" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们都知道什么是数据绑定了，那么什么是双向数据绑定呢？</p><p id="7ee5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答案很简单。从数据源更新视图是一个简单的单向绑定。在这种情况下，您将只访问数据源中的数据并更新布局。</p><p id="c9b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">双向数据绑定只不过是在布局发生变化时更新数据源，反之亦然。双向数据绑定并不适用于Android中的所有视图。例如，在<code class="fe lv lw lx ly b">EditText</code>中使用双向数据绑定是有意义的，因为用户可以更新视图中的数据。但是不建议对<code class="fe lv lw lx ly b">TextView</code>做同样的事情，因为用户不能改变<code class="fe lv lw lx ly b">TextView</code>中的数据。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="6494" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">履行</h1><p id="c74d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">让我们从单向数据绑定开始。我们将创建一个简单的Kotlin模型类，并使用数据绑定从布局中访问它。首先，让我们创建一个<code class="fe lv lw lx ly b">UserModel</code>类:</p><pre class="kj kk kl km gt nv ly nw nx aw ny bi"><span id="6712" class="nz mh it ly b gy oa ob l oc od">class <strong class="ly iu">UserModel</strong>(var <strong class="ly iu">name </strong>: String, var <strong class="ly iu">email </strong>: String )</span></pre><p id="1864" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要从布局文件中访问这个模型，并将这些变量分配给视图。因为我们从单向数据绑定开始，所以我们使用<code class="fe lv lw lx ly b">@{}</code>将数据源绑定到视图:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="183a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，每当数据源中的初始值更新时，布局也会更新。但是这不足以反映数据源每次更新的UI。</p><p id="1f86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果模型中有任何变化，为了更新UI，我们需要使模型成为一个可观察的组件。使其可观察的第一步是从数据绑定框架用<code class="fe lv lw lx ly b">BaseObservable</code>扩展模型类:</p><pre class="kj kk kl km gt nv ly nw nx aw ny bi"><span id="0eea" class="nz mh it ly b gy oa ob l oc od">class UserModel () : <strong class="ly iu">BaseObservable()</strong>{<br/><br/>    var name : String = ""<br/>    var email : String = ""<br/><br/>}</span></pre><p id="35d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们需要注释UI中的每个变量，用<code class="fe lv lw lx ly b"><a class="ae ky" href="http://twitter.com/get" rel="noopener ugc nofollow" target="_blank">@get</a>:Bindable</code>动态更新，并调用<code class="fe lv lw lx ly b">set</code>委托上的<code class="fe lv lw lx ly b">notifyPropertyChanged</code>来更新UI:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="05f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，UI会动态刷新。</p><p id="0687" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在完成了单向可观察数据绑定。下一步是实现简单的双向数据绑定。让我们后退一步，评估一下形势。</p><p id="52e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前，如果数据源有任何变化，数据绑定将负责刷新用户界面。我们需要实现的唯一一件事是，如果UI中有任何变化，不管数据源是什么，都要更新数据源。对于这一点，数据绑定有一个现成的简单解决方案。我们只需要在布局中用<code class="fe lv lw lx ly b">@={}</code>更新<code class="fe lv lw lx ly b">@{}</code>，剩下的就交给框架处理了。</p><p id="bf12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，我们将使用<code class="fe lv lw lx ly b">name</code>进行双向数据绑定，因为它是一个用户可以更新的<code class="fe lv lw lx ly b">EditText</code>值:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="6362" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已！我们已经成功实现了双向数据绑定。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="3467" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">最佳化</h1><p id="777a" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">上面的实现工作起来没有任何问题，但是如果您仔细观察，就会发现涉及到太多的手工工作。默认情况下，数据绑定为主数据类型提供了<code class="fe lv lw lx ly b">ObservableField</code>。比如我们可以用<code class="fe lv lw lx ly b">ObservableField&lt;String&gt;</code>代替<code class="fe lv lw lx ly b">String</code>来表示用户模型中的<code class="fe lv lw lx ly b">name</code>和<code class="fe lv lw lx ly b">email</code>。</p><p id="0483" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在幕后，数据绑定会处理样板代码，这样我们就不需要一直写了。看看优化后的模型类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="92ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要记住的一点是，移除<code class="fe lv lw lx ly b">BaseObservable</code>会使<code class="fe lv lw lx ly b"> UserModel</code>成为一个不可观察的物体。但是通过使其变量<code class="fe lv lw lx ly b">ObservableFields</code>，双向绑定不会受到影响。使用哪种结构完全取决于您。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="57ec" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">监听器和实时用例</h1><p id="a7e7" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">数据绑定是一个强大的框架，具有强大的功能，有助于减少开发人员每天编写的大量样板代码。</p><p id="d44e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据绑定提供的不仅仅是<code class="fe lv lw lx ly b">ObservableFields</code>。我们可以实现点击监听器，利用<code class="fe lv lw lx ly b">Elvis</code>操作符为布局中的属性分配适当的值，创建定制适配器来加载图像或应用定制字体，等等。</p><p id="86fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从长远来看，学习如何在XML中实现所有这些类型的特性将会提高开发人员的生产力。这些是基础，所以如果你是数据绑定的新手，我强烈推荐<a class="ae ky" href="https://sgkantamani.medium.com/data-binding-in-android-4ff7bba93a2c" rel="noopener">阅读这篇文章</a>。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="dced" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">下一部分会发生什么</h1><p id="2a5d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">既然我们已经学习了双向数据绑定和如何优化代码，在下一篇文章中，我们将学习如何使用双向绑定和类似于<code class="fe lv lw lx ly b">LiveData</code>和<code class="fe lv lw lx ly b">ViewModel</code>的架构组件。敬请期待！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="646b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">奖金</h1><p id="ef31" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">要了解有关Android高级开发的更多信息，请阅读以下文章:</p><ul class=""><li id="57bc" class="og oh it lb b lc ld lf lg li oi lm oj lq ok lu ol om on oo bi translated"><a class="ae ky" href="https://medium.com/better-programming/8-common-mistakes-in-android-development-2edcf5179ec0" rel="noopener">《Android开发中的8个常见错误》</a></li><li id="3a4d" class="og oh it lb b lc op lf oq li or lm os lq ot lu ol om on oo bi translated"><a class="ae ky" href="https://medium.com/better-programming/everything-you-should-know-about-viewbinding-in-android-52552af9e8ba" rel="noopener">“关于Android中ViewBinding你应该知道的一切”</a></li><li id="9825" class="og oh it lb b lc op lf oq li or lm os lq ot lu ol om on oo bi translated"><a class="ae ky" href="https://medium.com/better-programming/exploring-kotlin-dsl-4ab67ed13062" rel="noopener">“探索kot Lin DSL”</a></li><li id="e55b" class="og oh it lb b lc op lf oq li or lm os lq ot lu ol om on oo bi translated"><a class="ae ky" href="https://medium.com/better-programming/the-evolution-of-view-linking-in-android-d6219678740d" rel="noopener">“Android中视图链接的演变”</a></li></ul><p id="8191" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前就这些。希望你学到了有用的东西。感谢阅读。</p></div></div>    
</body>
</html>