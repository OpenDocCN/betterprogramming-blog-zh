<html>
<head>
<title>Connecting Node.js Server With SQL Database Using Sequelize ORM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用顺序化ORM连接Node.js服务器和SQL数据库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/node-js-backend-to-connect-mysql-database-using-sequelize-modeling-8cc637ed5f29?source=collection_archive---------2-----------------------#2021-11-22">https://betterprogramming.pub/node-js-backend-to-connect-mysql-database-using-sequelize-modeling-8cc637ed5f29?source=collection_archive---------2-----------------------#2021-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5313" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建处理SQL数据库的松耦合Node.js后端服务器的指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6249f8fbcc0774ea8a24803f73995926.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BQTDx9yXcA72r1_i"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">詹姆斯·麦金文在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="445f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，我将指导您创建一个松散耦合的Node.js后端服务器来处理SQL数据库，使用Sequelize来执行对象关系映射。</p><p id="510f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">前端应用程序将使用React构建，但我们将在另一篇文章中介绍。在本文中，我们将重点放在后端服务器上。</p><p id="58ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里我将使用<code class="fe ls lt lu lv b">Express</code>，它是Node.js的后端web应用程序框架。</p><h1 id="8eed" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">什么是顺序化？</h1><p id="efb2" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">直接引自<a class="ae kv" href="https://sequelize.org/" rel="noopener ugc nofollow" target="_blank">官方文件</a>:</p><blockquote class="mt mu mv"><p id="b208" class="kw kx mw ky b kz la jr lb lc ld ju le mx lg lh li my lk ll lm mz lo lp lq lr ij bi translated">Sequelize为Postgres、MySQL、MariaDB、SQLite和Microsoft SQL Server提供了基于promise的Node.js <strong class="ky ir">对象关系映射</strong>。它具有可靠的事务支持、关系、急切加载和延迟加载、读取复制等特性。</p></blockquote><p id="4450" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">换句话说，Sequelize完成了JavaScript的面向对象用法和关系SQL数据库之间的映射。</p><h2 id="b87b" class="na lx iq bd ly nb nc dn mc nd ne dp mg lf nf ng mi lj nh ni mk ln nj nk mm nl bi translated">我们要做什么？</h2><p id="79f9" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">我们将为学生管理创建一个简单的CRUD应用程序。它具有添加学生，更新学生，删除学生和查看学生详细信息的功能。</p><p id="e9c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于这四个动作，我们创建的Express服务器将公开以下四个URL。</p><ol class=""><li id="664e" class="nm nn iq ky b kz la lc ld lf no lj np ln nq lr nr ns nt nu bi translated">要插入新学生:<code class="fe ls lt lu lv b">baseURL/students</code></li><li id="0422" class="nm nn iq ky b kz nv lc nw lf nx lj ny ln nz lr nr ns nt nu bi translated">要更新现有学生的详细信息:<code class="fe ls lt lu lv b">baseURL/students/:id</code></li><li id="4330" class="nm nn iq ky b kz nv lc nw lf nx lj ny ln nz lr nr ns nt nu bi translated">删除学生:<code class="fe ls lt lu lv b">baseURL/students/:id</code></li><li id="9a0e" class="nm nn iq ky b kz nv lc nw lf nx lj ny ln nz lr nr ns nt nu bi translated">查看所有学生:<code class="fe ls lt lu lv b">baseURL/students</code></li></ol><p id="8302" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们应用程序的高层架构。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/f70260f1d0dc96af82c887b97a4368c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*A4KjL-87tx7SXyT9wXtQ2g.png"/></div></figure><p id="7d65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我们开始吧！</p><ol class=""><li id="ec24" class="nm nn iq ky b kz la lc ld lf no lj np ln nq lr nr ns nt nu bi translated">我们将从创建Node.js应用程序开始！只需创建一个新文件夹来放置您的项目。我正在创建一个名为<code class="fe ls lt lu lv b">student_app_backend</code>的文件夹，然后打开文件夹中的<code class="fe ls lt lu lv b">cmd</code>并初始化那里的节点，使用以下命令:</li></ol><pre class="kg kh ki kj gt ob lv oc od aw oe bi"><span id="a574" class="na lx iq lv b gy of og l oh oi">npm init</span></pre><p id="2704" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您保留默认设置，系统会提示您详细信息，否则请输入所需的详细信息，然后输入——如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/5bcbbdbdc69535be680f64c71bdbdc50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nc3bOYgjhWGOqXt8qLo3wA.png"/></div></div></figure><p id="c0b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在进入下一步。</p><p id="b72a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们安装所需的模块。我要安装的模块是<code class="fe ls lt lu lv b">MySQL2</code>、<code class="fe ls lt lu lv b">Express</code>、<code class="fe ls lt lu lv b">Sequelize</code>和<code class="fe ls lt lu lv b">cors</code>。</p><p id="f308" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里我使用<code class="fe ls lt lu lv b">MySQL2</code>，因为它是Node.js的MySQL客户端，关注性能。它支持预处理语句、非utf8编码、二进制日志协议、压缩、SSL等等。从<a class="ae kv" href="https://www.npmjs.com/package/mysql2" rel="noopener ugc nofollow" target="_blank">这里阅读更多信息</a></p><p id="bda7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Cors(跨源资源共享)是一个Node.js包，用于管理与其他服务器的跨源HTTP请求。如果你想了解更多，我推荐这篇有趣的文章。</p><p id="41f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在cmd中使用以下命令安装上述内容:</p><pre class="kg kh ki kj gt ob lv oc od aw oe bi"><span id="7f91" class="na lx iq lv b gy of og l oh oi">npm install express mysql2 cors sequelize - save</span></pre><p id="8c14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们配置web服务器。</p><p id="8fd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将在后端应用程序的根目录下创建<code class="fe ls lt lu lv b">student_server.js</code>。添加以下代码来设置服务器:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="a433" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在只需在<code class="fe ls lt lu lv b">cmd</code>中使用以下命令来执行服务器:</p><pre class="kg kh ki kj gt ob lv oc od aw oe bi"><span id="577b" class="na lx iq lv b gy of og l oh oi">node student_server.js</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/129de9f924d89afadec42b74c53f0338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*MdPmepWyNj66rJVfZyzwSQ.png"/></div></figure><p id="991a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的web浏览器中打开<a class="ae kv" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/</a>URL，您应该会得到以下消息！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi on"><img src="../Images/d86302cf620f635f61ef6e3c550e0cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*JMm9z8QTg6kpEtsT_hF4tw.png"/></div></figure><p id="9f5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第四步，让我们创建数据库。</p><p id="eda3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用任何方便的方法创建一个名为<code class="fe ls lt lu lv b">student_db</code>的MySQL数据库。最简单的方法是，您可以使用XAMPP在那里启动apache和MySQL模块。然后在我的网络浏览器中打开<code class="fe ls lt lu lv b">phpMyAdmin</code>，在那里创建一个名为<code class="fe ls lt lu lv b">student_db</code>的新数据库。只有您需要创建数据库。当我们第一次启动服务器时，数据列的创建将在<code class="fe ls lt lu lv b">Sequelize</code>的帮助下完成！所以不用再担心数据库了！</p><p id="7336" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们将设置数据库配置。</p><p id="2525" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我在根目录中创建了一个名为<code class="fe ls lt lu lv b">config</code>的新文件夹，并在config中创建了文件<code class="fe ls lt lu lv b">database_config.js</code>并放置了以下配置:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="e200" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们必须使用Sequelize来执行剩下的任务！对于这些建模，我在根目录下创建了一个名为<code class="fe ls lt lu lv b">models</code>的单独文件夹。</p><p id="76e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们需要初始化Sequelize，提供必要的配置。<br/>为此，我们将在<code class="fe ls lt lu lv b">models</code>文件夹中创建一个名为<code class="fe ls lt lu lv b">index.js</code>的文件，在那里我们将为Sequelize进行初始化:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="0459" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们需要定义我们的数据模型。数据库中的表及其数据字段应该是什么样的？我们将在<code class="fe ls lt lu lv b">models</code>文件夹的单独文件中定义它们。我正在创建一个名为<code class="fe ls lt lu lv b">student.js</code>的文件，并将这些建模信息放在那里:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="aef9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以当我们开始执行这个后端应用程序时，它会检查这个<code class="fe ls lt lu lv b">student</code>表是否存在于数据库中。如果尚未创建，将按照我们在此定义的方式创建。酷！</p><p id="5e14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们创建控制器！在<code class="fe ls lt lu lv b">model</code>中，我们定义了数据模型的外观。在这里，我们定义了我们的应用程序如何运行。为此，我在根目录下创建了一个名为<code class="fe ls lt lu lv b">controllers</code>的独立文件夹。在其中，我将创建名为<code class="fe ls lt lu lv b">student.js</code>的控制器文件，并在那里创建我的应用程序中需要的函数。</p><p id="f84f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个控制器中，我们定义了向数据库发送数据和从数据库接收数据的方式。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="594d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们只差一步了。</p><p id="948c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">定义您的前端应用程序应该寻找执行CRUD的路线。我将在我的应用程序根目录下创建一个名为<code class="fe ls lt lu lv b">routes</code>的文件夹，并在其中添加一个<code class="fe ls lt lu lv b">routes.js</code>来放置路线:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="77d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在通过添加下面这一行将<code class="fe ls lt lu lv b">routes</code>文件包含在您的服务器<code class="fe ls lt lu lv b">student_server.js</code>中:</p><pre class="kg kh ki kj gt ob lv oc od aw oe bi"><span id="6d9d" class="na lx iq lv b gy of og l oh oi">require("./routes/routes.js")(app);</span></pre><p id="cfb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您没有运行该应用程序，我们就完成了，只需打开项目根文件夹中的cmd，然后简单地键入并输入:</p><pre class="kg kh ki kj gt ob lv oc od aw oe bi"><span id="6cf7" class="na lx iq lv b gy of og l oh oi">node student_server.js</span></pre><p id="1111" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">后端应该启动并运行！</p><p id="643c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在GitHub的这里找到源代码<a class="ae kv" href="https://github.com/RusJaI/Node-SQL-Loose-Coupled-Backend" rel="noopener ugc nofollow" target="_blank">！</a></p><p id="7221" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">干杯，感谢阅读。</p></div></div>    
</body>
</html>