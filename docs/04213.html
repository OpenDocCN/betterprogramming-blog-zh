<html>
<head>
<title>How to Make a Pokémon-Like Game With ERC-721 Tokens</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用ERC 721代币制作类似神奇宝贝的游戏</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-make-a-pok%C3%A9mon-like-game-with-erc-721-tokens-704f2344626?source=collection_archive---------14-----------------------#2020-03-30">https://betterprogramming.pub/how-to-make-a-pok%C3%A9mon-like-game-with-erc-721-tokens-704f2344626?source=collection_archive---------14-----------------------#2020-03-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c7f3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">ERC-721代币:它们是什么？它们是如何工作的？我们如何使用它们？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/84c81f6a00a37e2451e3a9221c5c4e16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VE5vGk1jJiRbs_eA12KsRg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@filmape?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">杰伦</a>在<a class="ae ky" href="https://unsplash.com/s/photos/pokemon?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="37f4" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">ERC队以20比721战胜ERC队</h1><p id="503d" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在2017年ICO泡沫最严重的时候，ERC-20代币随处可见。它们被科技公司用作一种众筹形式，一些公司声称未来可以在他们的平台上使用这些代币。</p><p id="3888" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu"> ERC-20代币就像货币</strong>。每一美元的价值都是一样的。把一张一美元的钞票换成另一张一美元的钞票，你实际上得到的是同样的东西。这就是所谓的<strong class="ma iu">可替换令牌</strong>。</p><p id="8083" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><a class="ae ky" href="http://erc721.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ma iu"> ERC-721 </strong> </a> <strong class="ma iu">代币如同收藏品</strong>。每张口袋妖怪卡都和其他口袋妖怪卡不一样。即使是代表同一个口袋妖怪的卡片，价值也不一样。有些卡状况比其他卡好，有些是限量版或特别版等。一张皮卡丘卡并不总是等同于另一张皮卡丘卡。这就是所谓的<strong class="ma iu">不可替换令牌</strong>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="736e" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">但是怎么做呢？</h1><p id="aa96" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated"><a class="ae ky" href="https://eips.ethereum.org/EIPS/eip-721" rel="noopener ugc nofollow" target="_blank"> ERC-721标准</a>描述了任何不可替代令牌必须遵守的接口，以被视为ERC-721。</p><p id="edb2" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">幸运的是，我们不需要每次创建ERC-721时都创建新的代码来满足这个标准。社区维护的图书馆的存在为我们解决了这个问题。OpenZeppelin 提供了一个<a class="ae ky" href="https://github.com/OpenZeppelin/openzeppelin-contracts" rel="noopener ugc nofollow" target="_blank">伟大的库</a>，它填补了大部分空白。</p><p id="22d2" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">让我们看看如何使用OpenZeppelin创建一个非常有限的数字口袋妖怪游戏的仿制品。我们将把我们的游戏叫做以太门。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="9598" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">ERC-721以太怪游戏</h1><p id="26e3" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">首先，让我们概述一下关于每个Ethermon的一些假设:</p><ul class=""><li id="9e3c" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">每辆车都归某人所有，</li><li id="5c00" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">他们从第一层开始，</li><li id="4432" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">他们和其他口袋妖怪战斗，</li><li id="b29e" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">通过战斗获得等级。</li></ul><p id="43b0" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们还需要围绕战斗的一些逻辑。为简单起见，我们假设如果一个以太怪攻击另一个以太怪，胜者将由哪个以太怪等级更高来决定。如果等级相同，攻击者获胜。战斗的胜利者上升两级，失败者上升一级。</p><h2 id="c64c" class="nn lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">项目创建</h2><p id="41f0" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">请注意，在本演练中，我们将使用<a class="ae ky" href="https://www.trufflesuite.com/" rel="noopener ugc nofollow" target="_blank">松露套件</a>。</p><p id="d6a4" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">首先创建一个新文件夹并初始化Truffle项目。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="a625" class="nn lh it oa b gy oe of l og oh">mkdir ethermon<br/>cd ethermon/<br/>truffle init</span></pre><h2 id="88e0" class="nn lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">使用OpenZeppelin</h2><p id="bcf0" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">要使用OpenZeppelin，我们需要通过npm导入库。让我们初始化npm，然后获取OpenZeppelin的正确版本。我们使用的是最新的稳定版本，在撰写本文时是版本<code class="fe oi oj ok oa b">2.5.0</code>。确保你有Solidity编译器版本<code class="fe oi oj ok oa b">0.5.5</code>。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="3688" class="nn lh it oa b gy oe of l og oh">npm init<br/>npm install @openzeppelin/contracts@2.5.0 --save</span></pre><h2 id="7297" class="nn lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">扩展ERC-721</h2><p id="3a97" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在我们的<code class="fe oi oj ok oa b">contracts/</code>文件夹中，让我们创建一个名为<code class="fe oi oj ok oa b">Ethermon.sol</code>的新文件。为了在OpenZeppelin代码中包含所有为我们编写的功能，我们需要导入并扩展<code class="fe oi oj ok oa b"><a class="ae ky" href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/58a3368215581509d05bd3ec4d53cd381c9bb40e/contracts/token/ERC721/ERC721.sol" rel="noopener ugc nofollow" target="_blank">ERC721.sol</a></code>。</p><p id="57a9" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">图1向我们展示了此时<code class="fe oi oj ok oa b">Ethermon.sol</code>应该是什么样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1: Ethermon.sol</p></figure><p id="1004" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们通过运行<code class="fe oi oj ok oa b">truffle compile</code>来确保我们的合同正确编译。接下来，让我们编写迁移脚本，以便将其部署到本地区块链。在<code class="fe oi oj ok oa b">migrations/</code>中创建一个名为<code class="fe oi oj ok oa b"> 2_deploy_contracts.js</code>的新迁移文件。粘贴图2的内容。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2: 2_deploy_contracts.js</p></figure><p id="271a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">确保您的<code class="fe oi oj ok oa b">truffle-config.js</code>针对您的本地区块链设置正确。您可以通过运行<code class="fe oi oj ok oa b">truffle test</code>来测试这一点。</p><h2 id="4add" class="nn lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">写Ethermon逻辑</h2><p id="dde6" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我们需要Ethermon合同能够:</p><ol class=""><li id="a02e" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt on nf ng nh bi translated">创造新的怪物。</li><li id="e39f" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt on nf ng nh bi translated">将怪物分配给它们的主人。</li><li id="6343" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt on nf ng nh bi translated">让主人与他们的怪物对抗其他怪物。</li></ol><p id="818b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">让我们从第一步开始。我们需要我们的<code class="fe oi oj ok oa b">Ethermon</code>契约来存储所有现存怪物的数组。这个庞大的数据需要存储一些信息，比如名称和级别，所以我们将使用一个struct。</p><p id="63f8" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">图3显示了我们的合同在这个阶段应该是什么样子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:创建新的怪物</p></figure><p id="42f3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">第7行定义了我们的<code class="fe oi oj ok oa b">Monster</code>结构，第12行定义了我们的数组。我们还添加了一个<code class="fe oi oj ok oa b">gameOwner</code>变量来存储部署了<code class="fe oi oj ok oa b">Ethermon</code>契约的地址。第19行显示了我们的<code class="fe oi oj ok oa b">createNewMonster()</code>函数的定义。</p><p id="b9bc" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">首先，它检查这个函数是由游戏的所有者调用的。然后，它使用现有的怪物数量生成一个ID，将一个新的怪物推送到我们的数组中，最后使用<code class="fe oi oj ok oa b">_safeMint()</code>将怪物ID分配给它的所有者。这包括步骤1和2。</p><p id="029b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><code class="fe oi oj ok oa b">_safeMint()</code>是ERC-721合同提供给我们的一个功能，我们是从这个功能延伸而来的。它通过检查ID是否已经存在来安全地将ID分配给一个地址。</p><p id="2193" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在，我们可以创造新的怪物并把它们分配给主人。进入第三步:战斗逻辑。</p><h2 id="7c2e" class="nn lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">战斗逻辑</h2><p id="b4dc" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如前所述，我们的战斗逻辑决定了一个怪物升多少级。更高级别的怪物赢了就升两级，输了就升一级。如果他们是同一级别，攻击者获胜。图4显示了当我们为战斗添加代码时，我们的契约看起来是什么样子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:添加了战斗功能的Ethermon.sol</p></figure><p id="406d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">第19行现在显示了战斗函数逻辑。目前，任何人都可以打电话给<code class="fe oi oj ok oa b">battle()</code>。然而，我们需要限制这个功能，这样只有攻击怪物的主人才能发起战斗。为此，我们可以添加一个修改器，利用<code class="fe oi oj ok oa b">ERC721.sol</code>中的<code class="fe oi oj ok oa b">ownerOf()</code>功能。图5向我们展示了它的样子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="1e15" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们做到了！一个非常基本但工作正常的怪物战斗游戏，使用ERC-721建造。</p><p id="61aa" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们可以创造新的怪物并指定主人。在那里，怪物的主人可以和其他人战斗来升级他们的怪物。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="a7d7" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">后续步骤</h1><ol class=""><li id="8f1e" class="mz na it ma b mb mc me mf mh oo ml op mp oq mt on nf ng nh bi translated">这段代码中有一些漏洞。你能认出他们吗？<a class="ae ky" href="https://medium.com/better-programming/how-to-secure-your-smart-contracts-part-2-d3ec21f8685a" rel="noopener">本文解释算术上溢和下溢</a>。</li><li id="84ca" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt on nf ng nh bi translated">我们这里还没有任何测试。为这个合同写一些JavaScript和Solidity测试。使用<a class="ae ky" href="https://medium.com/better-programming/how-to-test-ethereum-smart-contracts-35abc8fa199d" rel="noopener">这篇文章来学习更多关于测试你的智能合约</a>。</li><li id="aa6e" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt on nf ng nh bi translated">扩展这个代码并创建一个React前端，这样你就可以让用户加入你的Ethermon游戏了！跟随<a class="ae ky" href="https://medium.com/better-programming/how-to-connect-a-react-app-to-the-blockchain-fa9dbd0bbd69" rel="noopener">这篇关于如何将React应用连接到区块链</a>的教程。</li></ol></div></div>    
</body>
</html>