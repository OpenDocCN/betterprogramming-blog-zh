<html>
<head>
<title>Playing With Combine: Grid Layout in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Combine:swift ui中的网格布局</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/playing-with-combine-grid-layout-in-swiftui-42e652d6462e?source=collection_archive---------2-----------------------#2019-09-09">https://betterprogramming.pub/playing-with-combine-grid-layout-in-swiftui-42e652d6462e?source=collection_archive---------2-----------------------#2019-09-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ab69" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用Combine在SwiftUI中实现网格的基本方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/64e0809d9ecf2a87fd87a95aa763541a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*04abPUB-f3s-2qrF5WRn_g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://mockuper.net" rel="noopener ugc nofollow" target="_blank">https://mockuper.net</a>生成的实体模型</p></figure><p id="a6bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可能已经意识到SwiftUI只支持列表，但本身并不支持<code class="fe ls lt lu lv b">collectionView</code>。我一直在学习联合，并试图实现类似的想法。</p><p id="300f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是开始的<a class="ae kv" href="https://github.com/rudrankriyam/GridLayoutCombine" rel="noopener ugc nofollow" target="_blank">演示项目</a>。</p><p id="7497" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开项目，去探索那18个赏心悦目的景观，为了简单起见，命名为<code class="fe ls lt lu lv b">noaa[number]</code> <strong class="ky ir"> </strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lw"><img src="../Images/67c1009b3f2859d848d7710deec4907d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s5BQsjvjFhEUBRD66C3ESw.png"/></div></div></figure><p id="a6f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为这些美丽的照片向美国国家海洋和大气管理局大声喊出来。</p><p id="062d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开<strong class="ky ir"> </strong> <code class="fe ls lt lu lv b">ContentView.swift</code>。<strong class="ky ir"> </strong>你会看到一幅令人惊叹的南极光图像。</p><p id="a496" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们开始使用Combine设计网格布局的旅程吧！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lw"><img src="../Images/df2d68fb766e1b013183fe15577d2fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*imYLcvWdhoHvxKxvg-OeDQ.png"/></div></div></figure><p id="4df3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们将为网格创建另一个<code class="fe ls lt lu lv b">View</code>。创建一个名为<code class="fe ls lt lu lv b">ImageRow</code>的新文件，类型为<em class="lx"> SwiftUI View </em>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lw"><img src="../Images/385b081bbdcc86a9380ff191f4b11cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NSioDo12EkFnOHmiu-7lYw.png"/></div></div></figure><p id="b305" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是时候理解网格背后的逻辑了。</p><ul class=""><li id="8dfb" class="ly lz iq ky b kz la lc ld lf ma lj mb ln mc lr md me mf mg bi translated">我们将有一个针对列的<code class="fe ls lt lu lv b">ForEach</code>循环，在其中，我们将有另一个针对行的循环。把它想象成一个2D阵列。</li><li id="96eb" class="ly lz iq ky b kz mh lc mi lf mj lj mk ln ml lr md me mf mg bi translated">例如，我们有一个数字序列，1，2，3，4，5，6。我们想把数字分成两列，这样1和2在一行，3和4在另一行，5和6在最后一行。</li><li id="22a4" class="ly lz iq ky b kz mh lc mi lf mj lj mk ln ml lr md me mf mg bi translated">所以，我们将<em class="lx">划分</em>数字序列，我们得到它们的<em class="lx">块</em> <strong class="ky ir"> </strong>。</li></ul></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="1889" class="mt mu iq bd mv mw mx my mz na nb nc nd jw ne jx nf jz ng ka nh kc ni kd nj nk bi translated">编码</h1><p id="e4fb" class="pw-post-body-paragraph kw kx iq ky b kz nl jr lb lc nm ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">是时候编码了。</p><p id="87d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">序列可以是任何东西，从图像名称到普通文本。这里，我们考虑NOAA图像的整数。</p><p id="025e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将创建一个空的2D数组来存储分块的<strong class="ky ir"> </strong>值。</p><pre class="kg kh ki kj gt nq lv nr ns aw nt bi"><span id="474e" class="nu mu iq lv b gy nv nw l nx ny">var images: [[Int]] = []</span></pre><p id="660e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，创建一个整数发布器。在这种情况下，我们有18个图像，所以:</p><pre class="kg kh ki kj gt nq lv nr ns aw nt bi"><span id="673b" class="nu mu iq lv b gy nv nw l nx ny">_ = (1...18).publisher</span></pre><p id="265b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">逻辑的魔力来了。我们将使用<code class="fe ls lt lu lv b">collect()</code> <strong class="ky ir"> </strong>实例方法。引用苹果的文档:</p><blockquote class="nz"><p id="dd7c" class="oa ob iq bd oc od oe of og oh oi lr dk translated">"收集所有收到的元素，并在上游发布者完成时发出集合的单个数组."</p></blockquote><p id="a4e2" class="pw-post-body-paragraph kw kx iq ky b kz oj jr lb lc ok ju le lf ol lh li lj om ll lm ln on lp lq lr ij bi translated">您可以指定希望集合限制的值的数量，我们将使用它来指定列的数量。这给了我们一个数组块流。</p><pre class="kg kh ki kj gt nq lv nr ns aw nt bi"><span id="c27b" class="nu mu iq lv b gy nv nw l nx ny">.collect(2) // Creating two columns</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/96f6868d40dec09bc48ab9e3b776d055.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*foUuEWcickKOcprKrw66GQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这两列</p></figure><p id="2b9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们需要将这些行的数组放在一个2D数组中。我们将使用另一个collect() <strong class="ky ir"> </strong>方法来获取单个流中的所有值。</p><pre class="kg kh ki kj gt nq lv nr ns aw nt bi"><span id="788d" class="nu mu iq lv b gy nv nw l nx ny">.collect()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/f14826177f7dc548f04992b54e97b523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iX56DLL_a8oaquxMMjubkA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">单个2D数组中的流</p></figure><p id="92d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:<code class="fe ls lt lu lv b">collect()</code>使用无限量的内存来存储接收到的值。</p><p id="3601" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe ls lt lu lv b">sink(receiveValue:)</code>订阅者从发布者那里获得整个2D数组。将订阅存储在images变量中。</p><pre class="kg kh ki kj gt nq lv nr ns aw nt bi"><span id="e1f2" class="nu mu iq lv b gy nv nw l nx ny">.sink(receiveValue: { images = $0 })</span></pre><p id="8560" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">整个代码应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/090b72c4b1cec69ac9c984a64d006aa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dnq9bDFad9-UiRDghurr_A.png"/></div></div></figure><p id="b7b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该写嵌套的<code class="fe ls lt lu lv b">ForLoop</code>实现了。从现在开始就很简单了。</p><p id="1d61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们将有一个针对行数的<code class="fe ls lt lu lv b">ForEach</code>循环。从零迭代到图像中子阵列的数量，即行数。</p><pre class="kg kh ki kj gt nq lv nr ns aw nt bi"><span id="fc0e" class="nu mu iq lv b gy nv nw l nx ny">return ForEach(0..&lt;images.count, id: \.self) { array in</span></pre><p id="b631" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，在循环内部，为行元素添加一个<code class="fe ls lt lu lv b">HStack</code>。遍历每个子数组给我们图像的编号</p><pre class="kg kh ki kj gt nq lv nr ns aw nt bi"><span id="d98d" class="nu mu iq lv b gy nv nw l nx ny">HStack {</span><span id="fdc6" class="nu mu iq lv b gy or nw l nx ny">    ForEach(images[array], id: \.self) { number in</span></pre><p id="4709" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据你的喜好修改图像。</p><pre class="kg kh ki kj gt nq lv nr ns aw nt bi"><span id="6b2c" class="nu mu iq lv b gy nv nw l nx ny">Image(“noaa\(number)”)</span><span id="00c0" class="nu mu iq lv b gy or nw l nx ny">    .resizable()</span><span id="36f6" class="nu mu iq lv b gy or nw l nx ny">    .scaledToFit()</span><span id="a680" class="nu mu iq lv b gy or nw l nx ny">    .cornerRadius(10)</span></pre><p id="2924" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，您的代码应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/9ba0682ea40f5b424d721719869a3a4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yBb3OoM6nP_YcFlxgcru8A.png"/></div></div></figure><p id="b154" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe ls lt lu lv b">ContentView.swift</code>、<strong class="ky ir">、</strong>中，用修改器移除图像，并在一个带有<code class="fe ls lt lu lv b">navigationView</code>的<code class="fe ls lt lu lv b">List</code>中添加<code class="fe ls lt lu lv b">ImageRow</code>，得到一个漂亮的标题栏。</p><pre class="kg kh ki kj gt nq lv nr ns aw nt bi"><span id="afe9" class="nu mu iq lv b gy nv nw l nx ny">NavigationView {</span><span id="afab" class="nu mu iq lv b gy or nw l nx ny">    List {</span><span id="e833" class="nu mu iq lv b gy or nw l nx ny">        ImageRow()</span><span id="0aa0" class="nu mu iq lv b gy or nw l nx ny">    }.navigationBarTitle(Text("Landscapes"))</span><span id="cd66" class="nu mu iq lv b gy or nw l nx ny">}</span></pre><p id="ef62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行这个项目给出了一个美丽的景观网格。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lw"><img src="../Images/f757c2fa25576388db08519dcb3ec292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Up4ZJC-gi-eIaSim4cgvKA.png"/></div></div></figure></div></div>    
</body>
</html>