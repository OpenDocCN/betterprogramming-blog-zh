<html>
<head>
<title>Build a Chat App in Node.js With Room Functionality</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Node.js中构建一个具有房间功能的聊天应用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-chat-app-in-node-js-with-room-functionality-6ebbd4b19133?source=collection_archive---------1-----------------------#2020-06-26">https://betterprogramming.pub/build-a-chat-app-in-node-js-with-room-functionality-6ebbd4b19133?source=collection_archive---------1-----------------------#2020-06-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="03d8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用Socket？web应用中的IO</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/83ad543397c1d134e56fc3cf160a2564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UzivWhBYhX30LxQc"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://unsplash.com/photos/BjhUu6BpUZA" rel="noopener ugc nofollow" target="_blank">普里西拉·杜·普里兹在Unsplash </a></p></figure><p id="fcce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名程序员，你可能曾经想知道聊天应用程序是如何工作的。是什么让这一技术奇迹成为可能？<a class="ae ky" href="http://socket.io" rel="noopener ugc nofollow" target="_blank">插座。IO </a>使得聊天应用的开发变得更加容易，并且已经在<a class="ae ky" href="https://awesomeopensource.com/projects/socket-io" rel="noopener ugc nofollow" target="_blank">许多软件项目</a>中使用。</p><p id="7575" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将使用套接字构建一个聊天应用程序。IO库和Node.js引擎。这是它看起来的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/8abc1ac3a3e9034f66ec6d036f5cb10a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vPhWCslCdOQjLYICh5RiNQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们将在本教程中构建的聊天应用程序的演示</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="bda6" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">入门指南</h1><h2 id="6b1c" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">图书馆的安装</h2><p id="4c2c" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">我们将安装:</p><ul class=""><li id="0ae4" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">处理我们的路线</li></ul><pre class="kj kk kl km gt nz ny oa ob aw oc bi"><span id="c8b5" class="mv me it ny b gy od oe l of og">npm install express</span></pre><ul class=""><li id="a909" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><code class="fe nv nw nx ny b">socket.io</code>这是我们应用程序的要点——它将基本上处理我们的聊天功能</li></ul><pre class="kj kk kl km gt nz ny oa ob aw oc bi"><span id="1501" class="mv me it ny b gy od oe l of og">npm install socket.io</span></pre><p id="3cac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！我们现在终于能够在应用程序中使用这些库了。是时候把手弄脏了。现在让我们继续关注<code class="fe nv nw nx ny b">require</code>他们。</p><h2 id="37c1" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">库的导入</h2><p id="2f15" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">要将<code class="fe nv nw nx ny b">socket.io</code>集成到您的<code class="fe nv nw nx ny b">main.js</code>中，请编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/587a624e08d9014948a9e9e373cbe8b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xWExurqkaTO9YwrzRFj0vw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用“require”关键字导入库</p></figure><p id="b88e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于代码的解释，更多信息在<a class="ae ky" href="https://socket.io/docs/#Using-with-Express" rel="noopener ugc nofollow" target="_blank">插座上提供。IO网站</a>。这基本上会将您的<code class="fe nv nw nx ny b">express</code>实例绑定到您的<code class="fe nv nw nx ny b">socket.io</code>实例。此外，您还可以选择根据官方<code class="fe nv nw nx ny b">socket.io</code>网站提供的指南来使用<code class="fe nv nw nx ny b">http</code>模块。</p><p id="8cb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nv nw nx ny b">line 4</code>中，我们还导入了一个名为<code class="fe nv nw nx ny b">user.js</code>的文件，它将处理我们聊天室中已连接客户端的添加和删除。</p><p id="0868" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在已经完成了，让我们继续创建聊天应用程序的客户端。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="7bd2" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">我们应用程序的客户端</h1><p id="626a" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">这是用户打开聊天应用时看到的第一个东西。</p><p id="f347" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的目录中，编写一个名为<code class="fe nv nw nx ny b">index.html</code>的新文件，并为您的<code class="fe nv nw nx ny b">body</code>和<code class="fe nv nw nx ny b">script</code>标记编写以下代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><ul class=""><li id="5e3b" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><strong class="lb iu">第2-7行:</strong>创建一个带有文本字段的表单来写消息，并添加一个提交按钮</li><li id="75d1" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第10-13行:</strong>为客户端功能导入<code class="fe nv nw nx ny b">socket.io</code>，并初始化一个<code class="fe nv nw nx ny b">socket</code>实例。这个插座就是你的客户端。</li></ul><p id="aa8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将继续回到<code class="fe nv nw nx ny b">index.html</code>文件来做进一步的修改和改进。现在，我们将转移到<code class="fe nv nw nx ny b">users.js</code>来处理我们应用程序中用户功能的添加和删除。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4334" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">在users.js中添加和删除用户</h1><p id="2e54" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">创建一个新文件，<code class="fe nv nw nx ny b">users.js</code>，并添加下面一行代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/6f3432c213509e521bbb1b4aeb14894d.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*LKgg-oq1m7qjZxjUAIkg9Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">声明一个名为“users”的空数组</p></figure><p id="751d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们实际上创建了一个名为<code class="fe nv nw nx ny b">users</code>的数组。每当用户加入时，相关信息被<code class="fe nv nw nx ny b">pushed</code>放入这个数组，当用户离开时，相关的<code class="fe nv nw nx ny b">index</code>从数组中删除。</p><p id="bad0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们添加用户。</p><h2 id="da73" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">1.添加用户</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/0fd1c678793cbf247bf5398c471b2431.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ESTGzjj2m_X3sLPexhnRBA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“加入用户”功能</p></figure><p id="7c60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码相当简单。</p><ul class=""><li id="d643" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><strong class="lb iu">第2-6行:</strong>创建一个包含用户ID、用户名和他们加入的聊天室的对象</li><li id="1346" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第7-8行:</strong>使用<code class="fe nv nw nx ny b">push</code>方法将这个对象添加到<code class="fe nv nw nx ny b">users</code>数组中，然后在这个过程完成后返回数组</li></ul><p id="de46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在用户想要离开应用程序，所以我们声明一个函数来移除用户。</p><h2 id="a9de" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">2.删除用户</h2><p id="8e4f" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">在<code class="fe nv nw nx ny b">users.js</code>中，添加一个名为<code class="fe nv nw nx ny b">removeUser</code>的新函数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/504757276b11ec3a2e21f5ba5b041f37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EED5QrWzemJ_7OF_5OLzww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“removeUser”函数定义</p></figure><ul class=""><li id="3d74" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><strong class="lb iu">第2-3行:</strong>查找包含匹配ID的元素的索引。关于<code class="fe nv nw nx ny b">findIndex</code>数组方法的更多信息，<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</li><li id="f930" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第4-5行:</strong>如果找到了元素(<code class="fe nv nw nx ny b">index</code>不是<code class="fe nv nw nx ny b">0</code>)，那么删除数组中的元素并返回这个被删除的元素。稍后，我们将使用这个元素，然后提取<code class="fe nv nw nx ny b">username</code>属性来显示离开的用户的姓名。</li></ul><p id="bbe2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您的代码将是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="aa41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然已经完成了，我们现在将进入项目的核心部分，<code class="fe nv nw nx ny b">main.js</code>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="7b83" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">应用程序的主要部分在main.js和index.html</h1><h2 id="01ff" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">连接事件</h2><p id="2a33" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">每当客户端登录聊天应用程序时，就会发出一个<code class="fe nv nw nx ny b">connection</code>事件。我们将使用<code class="fe nv nw nx ny b"><a class="ae ky" href="https://medium.com/analytics-vidhya/event-emitters-in-node-js-d93084441974" rel="noopener">EventEmitter</a></code> <a class="ae ky" href="https://medium.com/analytics-vidhya/event-emitters-in-node-js-d93084441974" rel="noopener">概念</a>来处理相关事件。</p><p id="cb6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们；我来处理<code class="fe nv nw nx ny b">connection</code>事件。每当用户登录到应用程序时，就会触发该事件。在<code class="fe nv nw nx ny b">main.js</code>中，在导入库之后，编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/ceb3095c3d62cbe162635868014f312b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B3nmMgwnTqkz2ZavoGkxgg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">处理“连接”事件</p></figure><ul class=""><li id="938d" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><strong class="lb iu">第1行和第8行:</strong>当用户进入<code class="fe nv nw nx ny b">localhost:3000</code>(根目录)时，Express将呈现<code class="fe nv nw nx ny b">index.html</code>文件作为响应。关于这方面的更多信息，请点击这里。</li><li id="4de4" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第4行:</strong><code class="fe nv nw nx ny b">thisRoom</code>变量存储聊天室名称。这个后面会用到。</li><li id="da2d" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第5-7行:</strong>这处理了<code class="fe nv nw nx ny b">connection</code>事件。当用户登录聊天应用程序时，将发出此事件。</li></ul><p id="2cc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>在整篇文章中，我们将修改<code class="fe nv nw nx ny b">main.js</code>，所以一定要在文件末尾保留第7行。此外，所有其他事件处理都将在<code class="fe nv nw nx ny b">connection</code>事件处理程序中进行。</p><p id="f834" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到<code class="fe nv nw nx ny b">localhost:3000</code>。在浏览器中输入提示，这将是控制台中的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/ffe43fe551ac0b4616bb1d889be0be01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eX-zrVBz7unr-uHxn56_yg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示用户已连接的控制台</p></figure><h2 id="f507" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">“加入房间”活动</h2><p id="f62e" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">你现在应该知道插座。IO是一个事件驱动的库，所以现在我们将从客户端发出将在客户端处理的事件。</p><p id="709f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，让我们发出一个<code class="fe nv nw nx ny b">join room</code>事件。</p><p id="031d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到<code class="fe nv nw nx ny b">index.html</code>，在<code class="fe nv nw nx ny b">script</code>标签之间添加以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/f65ee27d3d59643e117f18fc81232591.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z9-li_iwUL3lPblV2cniIQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从客户端代码发出“加入房间”事件</p></figure><p id="5ff0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码做的是发出一个<code class="fe nv nw nx ny b">join room</code>事件，然后发送一个对象作为数据。现在我们需要从服务器端处理这个事件，并处理传入的数据。此外，现在我们将为客户分配一个ID，并将他发送到指定的聊天室。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/7bd777e83572cd3f8e8b434750942563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wjnaAjuEEOY4Dk9KBLdLpg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">处理“加入房间”事件</p></figure><ul class=""><li id="9a9c" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><strong class="lb iu">第1-3行:</strong>处理<code class="fe nv nw nx ny b">join room</code>事件。使用给定数据作为参数应用<code class="fe nv nw nx ny b">joinUser</code>功能。在这个过程中，我们还为客户端分配了一个ID。<code class="fe nv nw nx ny b">socket.emit</code>方法确保这些数据只发送给发送者，而不是聊天中的所有客户。</li><li id="27d8" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第4行:</strong>发出<code class="fe nv nw nx ny b">send data</code>事件，同时发送给定的数据。该事件将由客户端处理。每当客户端发送消息时，我们将使用这些数据来显示用户名。</li><li id="3303" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第7行:</strong>用给定的名字加入房间</li></ul><p id="5d0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将是浏览器中的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/af93efad3b8049be4005d371e05fe625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/1*WVbCmWOGTiIpameZ_tra1Q.gif"/></div></figure><p id="f78b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将是控制台中的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/6975c9eb9bb74caa1030839631b2b66e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*e8FiQBrpJJXW3H1d5quVVw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">记录用户详细信息的输出</p></figure><h2 id="33ff" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">“发送数据”事件</h2><p id="3e7a" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">在上面的标题中，注意我们也发出了<code class="fe nv nw nx ny b">send data</code>事件。在这个过程中，我们发送用户的ID、他们的名字和他们的聊天室。我们将使用他们的聊天ID来比较他们是否是房间中任何消息的发送者。此外，只要他们发送消息，就会显示姓名。</p><p id="7bcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将从客户端处理这个事件。</p><p id="e5fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到<code class="fe nv nw nx ny b">index.html</code>，添加以下JavaScript:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/75941f257fe9ce0d132c7e4aad338d44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2fv2WmgsTAxL1voPORiYA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">处理“发送数据”事件的代码</p></figure><ul class=""><li id="7b18" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><strong class="lb iu">第2行:</strong>获取包含服务器发送的数据的对象(<code class="fe nv nw nx ny b">data</code>变量)。</li><li id="054a" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第3行:</strong>将<code class="fe nv nw nx ny b">id</code>赋给另一个变量，这样<code class="fe nv nw nx ny b">id</code>字段在整个程序中都是持久的</li></ul><p id="d3bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将是您输入所需信息后浏览器中的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/7ad8b590a0d762cc015730ab6d488e37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*JkWU5LM3__aJP-SULFk34A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示用户ID的输出</p></figure><h2 id="a9b9" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">“聊天消息”事件</h2><p id="dd7c" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">显然，没有消息功能的聊天应用是不完整的。</p><p id="c2ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一步中，我们将发出一个<code class="fe nv nw nx ny b">chat message</code>事件，该事件将被服务器端和客户端代码获取。</p><p id="b9e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到<code class="fe nv nw nx ny b">index.html</code>，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><ul class=""><li id="9f46" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><strong class="lb iu">第1行:</strong>关注文本字段</li><li id="cde1" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第3-11行:</strong>当用户点击<code class="fe nv nw nx ny b">submit</code>按钮时，发出<code class="fe nv nw nx ny b">chat message</code>事件。在这个过程中，它将文本字段值和用户名作为数据发送。</li><li id="e275" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第13行:</strong>在上面的代码运行后，使文本字段为空</li><li id="9e91" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第15行:</strong>获取服务器发出的<code class="fe nv nw nx ny b">chat message</code>事件并处理该事件</li><li id="7140" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第17行:</strong>向网页显示消息</li></ul><p id="f363" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nv nw nx ny b">displayMessage</code>执行以下操作:</p><ul class=""><li id="da10" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">比较<code class="fe nv nw nx ny b">chat message</code>事件发送的<code class="fe nv nw nx ny b">id</code>和<code class="fe nv nw nx ny b">send data</code>事件(<code class="fe nv nw nx ny b">ID</code>)发送的<code class="fe nv nw nx ny b">id</code></li><li id="d790" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated">如果是<code class="fe nv nw nx ny b">true</code>，将适当的CSS样式应用到<code class="fe nv nw nx ny b">list</code>元素，以指示客户端发送了消息</li><li id="0339" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated">如果是<code class="fe nv nw nx ny b">false</code>，将适当的CSS样式应用到<code class="fe nv nw nx ny b">list</code>元素，以指示另一个客户端发送了消息</li><li id="16f9" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated">在每个信息气泡的角上，也显示了它被发送的时间</li></ul><p id="cd8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在转到<code class="fe nv nw nx ny b">main.js</code>来处理<code class="fe nv nw nx ny b">chat message</code>事件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/99763d6fdc64cb2a0407ff647800d200.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zIttqBANA-ICCnLMiQedvw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">处理main.js中的聊天消息事件</p></figure><ul class=""><li id="08f0" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><strong class="lb iu">第二行:</strong>发送<code class="fe nv nw nx ny b">chat message</code>事件到用户所在的指定房间。在此过程中，发送所需的数据和用户的<code class="fe nv nw nx ny b">id</code>字段。</li></ul><p id="ac58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将是浏览器中的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/3baac4df48f0e514187791b0a2ecd13d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-Hs7BqoS9_zBiBlty7acyg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示代码输出的GIF</p></figure><p id="4632" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是终端中的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/d655a7befaf900edd919c173e759a384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L5_sAWjzQ7EjpIg12ax4Zg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示用户数据的终端输出</p></figure><h2 id="c60a" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">处理“断开连接”事件</h2><p id="0875" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">每当客户端在浏览器中关闭聊天客户端时，就会发出<code class="fe nv nw nx ny b">disconnect</code>事件。</p><p id="6bce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到<code class="fe nv nw nx ny b">main.js</code>，编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/210268984b7b9075600363e6a3245769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HEkIBXXRVNGNzcGqaS0xzg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">处理“断开连接”事件的代码</p></figure><ul class=""><li id="d7e0" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><strong class="lb iu">第2行:</strong>从<code class="fe nv nw nx ny b">users</code>数组中删除用户</li><li id="e27e" class="nm nn it lb b lc ok lf ol li om lm on lq oo lu nr ns nt nu bi translated"><strong class="lb iu">第5行:</strong>显示用户的用户名，表示该用户已离开聊天应用</li></ul><p id="8ed8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是当用户离开聊天窗口时会发生的情况。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/b7133385acdd5427bcac1b55eefc4bd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*qWze00emigFOt7hjEcTX3g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示用户“zain”和“hussain”已离开聊天应用程序的输出</p></figure><p id="2ffb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是聊天应用程序的全部内容。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a8df" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">回顾和链接</h1><p id="4752" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">这是<code class="fe nv nw nx ny b">users.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="1647" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是<code class="fe nv nw nx ny b">index.html</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="0012" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是<code class="fe nv nw nx ny b">main.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="4114" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是这个项目的<a class="ae ky" href="https://github.com/HussainArif12/Chat-App" rel="noopener ugc nofollow" target="_blank"> GitHub回购</a>。</p><h2 id="8aee" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">进一步阅读</h2><ul class=""><li id="3e80" class="nm nn it lb b lc nh lf ni li pe lm pf lq pg lu nr ns nt nu bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=rxzOqP9YwmM" rel="noopener ugc nofollow" target="_blank">“用Node搭建实时聊天App。Js和Socket.io </a></li></ul></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="e682" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="5959" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">插座。IO有一个较小的学习曲线；然而，如果您编写代码并深入理解程序，并广泛研究每个函数的作用，这是最好的。只是不要放弃你的编程之旅。</p><p id="0835" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢您的阅读，祝您有美好的一天！</p><p id="e3e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一篇文章:<a class="ae ky" href="https://levelup.gitconnected.com/get-your-daily-dose-of-inspiration-with-reactjs-fa529940326d" rel="noopener ugc nofollow" target="_blank">在React </a> <br/>中获取每日灵感前一篇文章:<a class="ae ky" href="https://levelup.gitconnected.com/weather-app-in-react-js-ca668ae86b14?source=your_stories_page---------------------------" rel="noopener ugc nofollow" target="_blank">在React </a>中创建一个天气应用</p></div></div>    
</body>
</html>