<html>
<head>
<title>Detect Roads and Vehicles With YOLOPv2 In Grand Theft Auto 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在侠盗猎车手5中使用YOLOPv2检测道路和车辆</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-detect-roads-and-vehicles-with-yolopv2-in-gta-v-7e74a853cc17?source=collection_archive---------3-----------------------#2022-10-16">https://betterprogramming.pub/how-to-detect-roads-and-vehicles-with-yolopv2-in-gta-v-7e74a853cc17?source=collection_archive---------3-----------------------#2022-10-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a99a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">安装并设置YOLOPv2，这样您就可以在视频游戏GTA V中将它用于可驾驶表面、车道线和车辆检测</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e1f3254553994b365bb2f4f83027b69e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WBy0yDYnhLvKoBB9oGYzKg.png"/></div></div></figure><p id="e413" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面，我将向您展示如何从GitHub安装和设置YOLOPv2项目。此外，我将向您展示如何测试安装。在那之后，我将回顾在视频游戏《侠盗猎车手5》中使用YOLOPv2的代码。最后，我将向您展示用游戏运行代码的结果。</p><h1 id="30de" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">安装和设置YOLOPv2</h1><p id="15fb" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">你可以在Github <a class="ae mn" href="https://github.com/CAIC-AD/YOLOPv2" rel="noopener ugc nofollow" target="_blank">这里</a>找到YOLOPv2的描述。</p><p id="43e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要安装项目文件，您可以执行以下操作:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="a39d" class="mt lr it mp b gy mu mv l mw mx">git clone <a class="ae mn" href="https://github.com/CAIC-AD/YOLOPv2.git" rel="noopener ugc nofollow" target="_blank">https://github.com/CAIC-AD/YOLOPv2.git</a><br/>cd yolopv2<br/>pip install -r requirements.txt</span></pre><p id="0ee3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">项目的目录布局如下所示:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="cb76" class="mt lr it mp b gy mu mv l mw mx">D:.<br/>├───data<br/>│   ├───demo<br/>│   ├───log<br/>│   └───weights<br/>└───utils</span></pre><p id="5850" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从<a class="ae mn" href="https://github.com/CAIC-AD/YOLOPv2/releases/download/V0.0.1/yolopv2.pt" rel="noopener ugc nofollow" target="_blank">这里</a>下载<code class="fe my mz na mp b">yolopv2.pt</code>模型文件，放在<code class="fe my mz na mp b">weights</code>目录下。</p><p id="3176" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以运行演示来检查安装是否正确执行:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="44e7" class="mt lr it mp b gy mu mv l mw mx">python demo.py</span></pre><p id="7f7c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在<code class="fe my mz na mp b">/runs/detect/exp</code>目录中找到结果。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="80be" class="mt lr it mp b gy mu mv l mw mx">D:.<br/>├───data<br/>│   ├───demo<br/>│   ├───log<br/>│   └───weights<br/>├───runs<br/>│   └───detect<br/>│       ├───exp<br/>└───utils</span></pre><p id="436c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">结果应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/ef0550260a4e28a368d104bf46e9870e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hfjMYpCNG_5OqmxYtsmbVw.jpeg"/></div></div></figure><h1 id="bca1" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">将YOLOPv2与GTA V一起使用的代码</h1><p id="e111" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">要对来自游戏的视频流执行检测，您可以使用以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="5092" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将上述代码放在YOLOPv2项目目录的上层。</p><p id="79b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您的系统上还没有安装Python的<code class="fe my mz na mp b">mss</code>和<code class="fe my mz na mp b">win32gui</code>，请务必安装它们。你可以这样做:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="388a" class="mt lr it mp b gy mu mv l mw mx">pip install mss<br/>pip install pywin32</span></pre><p id="17da" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第8行和第9行，我们从原始YOLOPv2项目的<code class="fe my mz na mp b">util</code>目录中的<code class="fe my mz na mp b">util.py</code>文件导入了一些函数。</p><p id="a6df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第11–13行，我们找到了包含GTA V游戏的窗口，并使其在前景中可见。后者是截图功能所必需的。</p><p id="bab9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第15-18行，游戏窗口的位置和大小被确定。此外，我们添加了一些修正，从截图坐标中删除菜单栏和边框。</p><p id="4062" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第20–32行，我们定义了一个函数，它可以截取屏幕上任何一个矩形的截图。输入参数决定了这个矩形。</p><p id="5cbd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第34–38行，加载了YOLOPv2模型。我必须写出完整的路径来找到模型文件<code class="fe my mz na mp b">yolopv2.pt</code>。随后，模型文件被发送到GPU (cuda)，精度减半以加快推理过程，并对模型进行评估。</p><p id="b015" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第40行，图像尺寸<code class="fe my mz na mp b">imgsz</code>被设置为640。这是因为YOLOPv2类神经网络接受640x640的输入。在下面一行中，网络被“预热”</p><p id="8c3e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第45行，我们设置了<code class="fe my mz na mp b">torch.no_grad()</code>来减少内存使用和加速计算。</p><p id="3621" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第46行中，设置了一个无限循环，不断地从游戏中截取截图，并对每个截图执行检测。</p><p id="7a14" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第48行，我们截取了游戏的截图。在这里，我们确保不要截图菜单栏等。</p><p id="ac77" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第51行，我们缩小了截图大小以适应YOLOPv2网络。如前所述，网络可以接受最大640x640像素的图像作为输入。我们的截图因此缩小到640x480。</p><p id="1751" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第56–61行，我们更多地调整了图像数据。维度被转置，图像矩阵被转换为Pytorch张量，发送到GPU，数字被转换为浮点，精度减半，数字被归一化…</p><p id="ddfc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第62行，图像最终被输入到YOLOPv2模型中。输出为<code class="fe my mz na mp b">[pred, anchor_grid]</code>中的车辆检测、<code class="fe my mz na mp b">seg</code>中的可行驶路面(道路)和<code class="fe my mz na mp b">ll</code>中的车道线。</p><p id="0ed6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第67–84行中，我们对输出图像上的可行驶表面和道路上的线条进行了遮罩。这是基于<code class="fe my mz na mp b">seg</code>和<code class="fe my mz na mp b">ll</code>的。</p><p id="50b3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第86–96行，车辆检测被添加到输出图像中。这里重用了原YOLOPv2项目中的几个现有函数。这主要是基于<code class="fe my mz na mp b">pred</code>。</p><p id="1de1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第98行，最终的输出图像显示在使用OpenCV的窗口中。</p><p id="d500" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第102–105行，有一些标准的OpenCV代码用于处理输出的显示，并等待“q”键关闭输出窗口。</p><h1 id="84a3" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">使用GTA V运行YOLOPv2</h1><p id="7baf" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">我已经将GTA V设置为以800x600像素的分辨率窗口运行。据我所知，下面显示的游戏内部设置已经足够了。</p><div class="kj kk kl km gt ab cb"><figure class="ne kn nf ng nh ni nj paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/e3472d6b210e4c88831699817db46b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*szZXVjF1xCfhKOAzoCwdpg.jpeg"/></div></figure><figure class="ne kn nk ng nh ni nj paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/0c0589fca5c89cf2cca6a6d798827ae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*iVeRoNOuhQNxmCdWdh6qDA.jpeg"/></div></figure></div><p id="f61a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦游戏加载完毕，我们进入了“故事模式”，我们的角色就可以通过按“f”进入某处的一辆汽车。然后，你可以按“v”几次来获得汽车引擎盖的视图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/9d92fa2ac16e644519850fa50200a809.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FuQ7BE1MEcL4IXr3sVNYeA.jpeg"/></div></div></figure><p id="b9f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不幸的是，视野并不集中在引擎盖上，而是在驾驶员的前方。</p><blockquote class="nm nn no"><p id="abb6" class="ku kv np kw b kx ky ju kz la lb jx lc nq le lf lg nr li lj lk ns lm ln lo lp im bi translated">注意一旦你在游戏窗口内点击并运行游戏，光标就不能离开窗口。您需要按下<code class="fe my mz na mp b">Shift-Tab</code>来释放光标。</p></blockquote><p id="bfe8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们可以运行上面这段Python代码…</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="39b3" class="mt lr it mp b gy mu mv l mw mx">python gtav_yolopv2.py</span></pre><p id="004b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">命令行输出将以FPS为单位显示帧速率，一个窗口将显示覆盖了YOLOPv2检测的游戏视频流。</p><p id="533d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面，你可以看到一个展示结果的视频。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nd l"/></div></figure><p id="ece7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我只想指出，我的硬件设置是连接到Razer Core X eGPU机箱中的NVidia GTX 1080 FE的英特尔NUC 10。连接是通过迅雷。</p><p id="34ae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该设置以其独特的方式引人入胜，但在性能方面却不尽如人意。至少没有达到目前(2022年10月)的标准。因此，事实上YOLOPv2网络推理工作得如此之快令人印象深刻。</p><p id="ae06" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面也是我另一次跑步的一些照片。有时道路和车道线检测工作完美，但有时它们可能会令人困惑。</p><div class="kj kk kl km gt ab cb"><figure class="ne kn nu ng nh ni nj paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/451d619492b5bb6e55f27a02b6e88b38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*dBSCs-ia5SbGaLR2EtOYdQ.png"/></div></figure><figure class="ne kn nu ng nh ni nj paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/0b1293405cc120794f3d43dfb3f768a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*y_7zXqftjr1rlATBROzypA.png"/></div><p class="nv nw gj gh gi nx ny bd b be z dk nz di oa ob translated">使用YOLOPv2进行两次非常好的道路和线路检测</p></figure></div><div class="ab cb"><figure class="ne kn nu ng nh ni nj paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/abbf81efad5fd28393e7f810e624d4d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*2AqxP3yunQ7dZjzYD6XpAg.png"/></div></figure><figure class="ne kn nu ng nh ni nj paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/567ed8c7f8fe882ccf0287df1d870e81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*GqzXOVTffP0fc7QBf3EcSw.png"/></div><p class="nv nw gj gh gi nx ny bd b be z dk nz di oa ob translated">使用YOLOPv2进行的两种略微令人困惑的道路和线路检测</p></figure></div><h1 id="8ed6" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">结论</h1><p id="f210" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">总的来说，我认为YOLOPv2工作得非常好，因为它不是为视频游戏输入而设计的，也因为我的硬件不是特别高性能。</p><p id="1e69" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">车辆(汽车和卡车)的检测精度非常高。可行驶的道路和车道线检测得非常好，但是可以改进。</p><p id="125f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">也许在将截图输入神经网络之前，对其进行一些简单的图像处理会进一步提高质量。在这种情况下，应用高斯模糊或调整截图的HSV边界可能会有所帮助。</p><h1 id="74d1" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">参考</h1><p id="201e" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated"><a class="ae mn" href="https://stackoverflow.com/questions/52806906/cant-install-win32gui" rel="noopener ugc nofollow" target="_blank">“无法安装win32gui”在Stackoverflow上</a></p><p id="d368" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae mn" href="https://datascience.stackexchange.com/questions/32651/what-is-the-use-of-torch-no-grad-in-pytorch" rel="noopener ugc nofollow" target="_blank">“py torch的torch.no_grad有什么用？”在Stackoverflow上</a></p><p id="11ad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae mn" href="https://github.com/CAIC-AD/YOLOPv2" rel="noopener ugc nofollow" target="_blank">“yolop v2🚀:更好、更快、更强的全景驾驶感受”</a></p></div></div>    
</body>
</html>