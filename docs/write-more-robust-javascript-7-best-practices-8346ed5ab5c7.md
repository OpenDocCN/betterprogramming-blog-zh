# 编写更健壮的 JavaScript: 7 个最佳实践

> 原文：<https://betterprogramming.pub/write-more-robust-javascript-7-best-practices-8346ed5ab5c7>

## 希望编写不太可能崩溃的代码

![](img/6ed13d1f5581d22a9b7140a3ee71a611.png)

*法尔扎德·纳兹菲在 Unsplash 上的照片*

# 更健壮的 JavaScript 的最佳实践

## 1.使用工厂功能

如果你不知道工厂函数是什么，它只是一个返回对象的函数(不是类或构造函数)。这个简单的概念允许我们利用 JavaScript 及其特性来创建强大的健壮应用程序。

重要的是要知道，当用关键字`new`调用它们时，它们不再是工厂函数。

**为什么是工厂职能？**

工厂函数可以用来轻松地生成对象的实例，而与类或`new`关键字没有任何关系。

它本质上的意思是，它们最终被当作仅仅是函数，这意味着它们可以用来组成对象、函数，甚至是承诺。这意味着您可以混合和匹配工厂函数来创建一个增强的工厂函数，然后继续与其他函数或对象组合来创建进一步增强的工厂函数。可能性是无限的。

当我们考虑到这一点并将其与良好的代码实践相结合时，它真的开始发光了。

下面是一个简单的工厂函数示例:

当你使用工厂函数足够多的时候，你开始意识到与它的类构造函数相比，它促进了更强的可重用性。这导致代码更少，重构更容易，因为工厂函数最终会返回任意对象，并且更容易管理一个代码到另一个代码。

## 2.上添加方法。编写构造函数时的原型

如果您是 JavaScript 新手，这一节可能对您来说有点陌生，因为这是我使用 JavaScript 的头两年的经历。

(请记住，这不适用于类，因为类已经将方法附加到了它们的原型上。)

下面是一个构造函数的例子:

为什么这样做而不是直接附加`leap`方法，如下例所示？

当我们直接在`prototype`上附加方法时，它们在由构造函数创建的所有实例中共享。

换句话说，使用最后一个例子，如果我们创建了三个单独的`Frog`(来自`this.leap = function() {...}`，那么我们最终会创建三个单独的副本。这是一个问题，因为`leap`方法将一直保持不变，不需要有自己的实例副本。

最终，这会降低性能，而这本来是可以避免的。需要在实例上定义`this.name`和`this.gender`属性，因为在现实生活中，青蛙可能有自己的名字和性别，所以在实例级别上创建它们是有意义的。

[这里有一个 GitHub](https://github.com/request/request/blob/master/lib/querystring.js) 上的例子，流行的[请求](https://github.com/request/request)包使用了这种方法。

## 3.使用常规的。区分时的类型属性

这种做法非常有效，以至于今天被广泛使用。如果你是一名 React 开发人员，你可能已经每天都看到这种情况了，尤其是当你使用 [Redux](https://redux.js.org/) 的时候。

使用类似的方法也使您在开发流程中变得非常容易，因为它甚至非常好地记录了自己:

## 4.使用类型脚本

TypeScript 已经在 JavaScript 社区中被广泛采用，因为它能够为类型安全提供强大的保护，并且能够帮助我们在错误发生之前就将其捕获。

使用 TypeScript 将使您的编译器能够在代码运行之前检测并显示有关代码中任何潜在错误的警告。

但是这还不是为什么采用 TypeScript 对任何情况都有好处的原因的完整列表。TypeScript 最棒的一点是，它允许您在主流浏览器支持之前使用 JavaScript 中的新特性，因为它们会被编译为早期版本的 JavaScript，最终能够在旧浏览器中运行。

## 5.编写测试

如果你正在做一个项目，并打算认真对待它，那么几乎必须进行测试，以便你的应用程序变得更可预测，更不容易出错，并对未来的变化具有弹性。换句话说，如果您计划让您的项目经得起未来考验，没有比在整个代码中建立测试更好的方法了。您在代码中进行的测试越多，当它被部署到现实世界的生产中时，您就越有信心。

考试最大的好处是什么？事实上，它们可以帮助你在错误出现之前就抓住错误——难道没有人想要这种能力吗？我肯定我有！这就是我在项目中编写单元测试的原因。

通过阅读这篇关于测试[框架和工具](https://geekflare.com/javascript-unit-testing/)的文章，你可以开始使用今天正在使用的工具类型。

## 6.尽可能保持功能简单

众所周知，在 JavaScript 中，很明显有可能使用巨大的函数来做不止一件事。

当你是编程新手时，这可能感觉像是一件好事——我知道当我写了大量有效的代码时，我对自己感觉非常好。这基本上对我来说是最重要的，给了我很多信心，让我看到我的任何代码都没有问题地运行，更不用说是我写的巨大的代码块了。哦，天啊，那时我是不是太天真了！

如果您想编写更易维护、更简单、更不容易出错的代码，那么最好尽可能保持代码的简单性和小巧性。越简单越容易单独测试。

如果您更喜欢函数式编程范式，这一点尤其重要。众所周知，函数应该做一件事，而且必须做好。

## 7.使用`JSON.parse` 或`JSON.stringify`时，请务必考虑使用`try/catch`

在 JavaScript 中，当我们将 JSON 作为输入传递给`JSON.parse`方法时，它期望一个正确格式化的 JSON 作为第一个参数。如果格式不正确，它将抛出一个 JSON 解析错误。

JSON 解析错误带来的危险是收到无效的 JSON 会使应用程序崩溃。我最近在工作中遇到过这样的情况，我们的一个 web 项目失败了，因为另一个内部包没有将`JSON.parse`包装在`try/catch`中。这导致了一个 web 页面的失败，并且没有办法克服这个错误，除非内部包修复它。这是因为 JavaScript 运行时被破坏了。

```
SyntaxError: Unexpected token } in JSON at position 107
```

您不应该总是期望有效的 JSON 输入，因为它可以接收像`>`字符这样的奇怪字符，这在今天并不罕见。

# 结论

这就是这篇文章的结尾。我希望你发现这是有价值的。以后多多关注！