<html>
<head>
<title>Generate Contrasting Text for Your Random Background Color</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为您的随机背景颜色生成对比文本</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/generate-contrasting-text-for-your-random-background-color-ac302dc87b4?source=collection_archive---------2-----------------------#2019-12-23">https://betterprogramming.pub/generate-contrasting-text-for-your-random-background-color-ac302dc87b4?source=collection_archive---------2-----------------------#2019-12-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e09d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在JavaScript中为你的随机背景颜色自动生成对比文本</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2a9494a0bac93d305357d941097fdacb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o8tTGo3vsocTKnCUyz0wHA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@codytdavis?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">戴维斯科</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="73d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我目前正在开发一个新的应用程序，以显著提高我的<a class="ae ky" href="https://react-redux.js.org" rel="noopener ugc nofollow" target="_blank"> React Redux </a>技能。在这个新项目中，用户将能够将他们选择的颜色分配给一些实体的背景。这就是为什么我必须找到一个显示对比文本的解决方案。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0ab3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">信用</h1><p id="0725" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这个周末我正在寻找解决这个问题的方法，突然想起<a class="ae ky" href="https://ionicframework.com/docs/theming/colors" rel="noopener ugc nofollow" target="_blank">离子颜色发生器</a>已经解决了这个问题。我看了他们的<a class="ae ky" href="https://github.com/ionic-team/ionic-docs/blob/master/src/components/color-gen/color.ts" rel="noopener ugc nofollow" target="_blank">代码</a>(你一定会喜欢开源❤️)并基于他们的实现提出了解决方案。</p><p id="89c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还必须实现一个将十六进制转换成RGB颜色的函数。为此，我在由<a class="ae ky" href="https://stackoverflow.com/users/2404470/xameeramir" rel="noopener ugc nofollow" target="_blank"> xameeramir </a>提供的<a class="ae ky" href="https://stackoverflow.com/a/5624139/5404186" rel="noopener ugc nofollow" target="_blank">堆栈溢出</a>上找到了一个干净的正则表达式。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5193" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">生成对比文本</h1><p id="6d1d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了生成对比文本，我们使用了由<a class="ae ky" href="https://www.w3.org/WAI/ER/WD-AERT/#color-contrast" rel="noopener ugc nofollow" target="_blank">万维网联盟(W3C) </a>定义的以下公式，以确保当有色彩缺陷的人或在黑白屏幕上观看时，前景和背景颜色组合能够提供足够的对比度:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="e29b" class="ne md it na b gy nf ng l nh ni">((Red value X 299) + (Green value X 587) + (Blue value X 114)) / 1000</span></pre><p id="655c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述算法采用从RGB公式转换的YIQ颜色方案作为输入，并输出颜色的感知亮度。</p><p id="991e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我使用的是十六进制颜色，所以在能够计算亮度之前，实现需要两次转换。它首先需要将输入转换为RGB，然后转换为YIQ颜色。</p><p id="9319" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，在阈值的帮助下，它可以确定对比度应该是暗还是亮，并作为结果提供对比文本颜色，黑色或白色。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="f90b" class="ne md it na b gy nf ng l nh ni">interface RGB {<br/>    b: number;<br/>    g: number;<br/>    r: number;<br/>}</span><span id="f3b2" class="ne md it na b gy nj ng l nh ni">function rgbToYIQ({ r, g, b }: RGB): number {<br/>    return ((r * 299) + (g * 587) + (b * 114)) / 1000;<br/>}</span><span id="d3c2" class="ne md it na b gy nj ng l nh ni">function hexToRgb(hex: string): RGB | undefined {<br/>    if (!hex || hex === undefined || hex === '') {<br/>        return undefined;<br/>    }<br/><br/>    const result: RegExpExecArray | null =<br/>          /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);<br/><br/>    return result ? {<br/>        r: parseInt(result[1], 16),<br/>        g: parseInt(result[2], 16),<br/>        b: parseInt(result[3], 16)<br/>    } : undefined;<br/>}</span><span id="3955" class="ne md it na b gy nj ng l nh ni">export function contrast(colorHex: string | undefined,<br/>                         threshold: number = 128): string {<br/>    if (colorHex === undefined) {<br/>        return '#000';<br/>    }<br/><br/>    const rgb: RGB | undefined = hexToRgb(colorHex);<br/><br/>    if (rgb === undefined) {<br/>        return '#000';<br/>    }<br/><br/>    return rgbToYIQ(rgb) &gt;= threshold ? '#000' : '#fff';<br/>}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a9d8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用普通Javascript演示</h1><p id="6f70" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们用普通的Javascript试试上面的解决方案。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/00c6f3c23d6e9f11eab8b2fb50ea6428.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*33JQbJ-KqGrry-VIXHZbMA.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为所选颜色自动生成对比文本</p></figure><p id="b41d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在HTML页面中，我们添加一个颜色选择器来选择一个动态值。为此，我们使用为<a class="ae ky" href="https://deckdeckgo.com" rel="noopener ugc nofollow" target="_blank"> DeckDeckGo </a>开发的组件，这是我们用于演示的web开源编辑器。我们从<a class="ae ky" href="https://unpkg.com" rel="noopener ugc nofollow" target="_blank"> unpkg </a>加载组件；这就是为什么不需要在本地安装依赖项的原因。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5885" class="ne md it na b gy nf ng l nh ni">&lt;!DOCTYPE html&gt;<br/>&lt;html dir="ltr" lang="en"&gt;<br/>&lt;head&gt;<br/>  &lt;meta charset="utf-8"&gt;<br/>  &lt;title&gt;Contrast color&lt;/title&gt;<br/><br/>  &lt;script type="module" src="https://unpkg.com/@deckdeckgo/color@latest/dist/deckdeckgo-color/deckdeckgo-color.esm.js"&gt;&lt;/script&gt;<br/>  &lt;script nomodule=""<br/>src="https://unpkg.com/@deckdeckgo/color@latest/dist/deckdeckgo-color/deckdeckgo-color.js"&gt;&lt;/script&gt;<br/>&lt;/head&gt;</span><span id="e70d" class="ne md it na b gy nj ng l nh ni">&lt;body style="background: #F78DA7;"&gt;<br/>  &lt;h1 style="font-size: 40px;"&gt;Hello World&lt;/h1&gt;</span><span id="a9c6" class="ne md it na b gy nj ng l nh ni">  &lt;deckgo-color&gt;&lt;/deckgo-color&gt;</span><span id="e142" class="ne md it na b gy nj ng l nh ni">  &lt;!-- Here we will add the contrast function --&gt;</span><span id="e1c5" class="ne md it na b gy nj ng l nh ni">  &lt;!-- Here we will bind the event and modify the colors --&gt;</span><span id="dc53" class="ne md it na b gy nj ng l nh ni">&lt;/body&gt;</span></pre><p id="5be5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们添加上面的函数来生成对比文本。注意，我们只是删除了Typescript部分，只解析JavaScript代码。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d8d8" class="ne md it na b gy nf ng l nh ni">&lt;script&gt;<br/>  function rgbToYIQ({r, g, b}) {<br/>    return ((r * 299) + (g * 587) + (b * 114)) / 1000;<br/>  }<br/><br/>  function hexToRgb(hex) {<br/>    if (!hex || hex === undefined || hex === '') {<br/>      return undefined;<br/>    }<br/><br/>    const result =<br/>          /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);<br/><br/>    return result ? {<br/>      r: parseInt(result[1], 16),<br/>      g: parseInt(result[2], 16),<br/>      b: parseInt(result[3], 16)<br/>    } : undefined;<br/>  }<br/><br/>  function contrast(colorHex, threshold = 128) {<br/>    if (colorHex === undefined) {<br/>      return '#000';<br/>    }<br/><br/>    const rgb = hexToRgb(colorHex);<br/><br/>    if (rgb === undefined) {<br/>      return '#000';<br/>    }<br/><br/>    return rgbToYIQ(rgb) &gt;= threshold ? '#000' : '#fff';<br/>  }<br/>&lt;/script&gt;</span></pre><p id="1d3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们将一个事件绑定到颜色选择器，以侦听所选的颜色，我们将该颜色应用于页面背景，并使用它来生成一个对比度值，最终将该值设置为页面文本的颜色。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="2b39" class="ne md it na b gy nf ng l nh ni">&lt;script&gt;<br/>  document.querySelector('deckgo-color')<br/>          .addEventListener('colorChange', updateColor, true);<br/><br/>  function updateColor($event) {<br/>    document.querySelector('body').style.background = <br/>                                   $event.detail.hex;<br/>    document.querySelector('body').style.color = <br/>                                   contrast($event.detail.hex);<br/>  }<br/>&lt;/script&gt;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="514f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">蛋糕上的樱桃🍒🎂</h1><p id="415c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们的web组件是开源的。它是一个<a class="ae ky" href="https://stenciljs.com" rel="noopener ugc nofollow" target="_blank"> StencilJS </a> web组件，因此可以用在普通的Javascript或任何现代框架中。也比较轻便；根据<a class="ae ky" href="https://bundlephobia.com/result?p=@deckdeckgo/color@1.0.0-rc.3-2" rel="noopener ugc nofollow" target="_blank"> Bundlephobia </a>的说法，它只给任何包增加418字节(一旦缩小和压缩)。如果您想在您的应用程序中尝试一下，请查看它的<a class="ae ky" href="https://docs.deckdeckgo.com/components/color" rel="noopener ugc nofollow" target="_blank">文档</a>并开始尝试吧！</p><p id="077a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到无限和更远的地方！🚀</p></div></div>    
</body>
</html>