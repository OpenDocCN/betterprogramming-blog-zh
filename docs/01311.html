<html>
<head>
<title>Build Your Docker Images Automatically When You Push on GitHub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当你在GitHub上推送时，自动构建你的Docker图像</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-your-docker-images-automatically-when-you-push-on-github-18e80ece76af?source=collection_archive---------0-----------------------#2019-08-31">https://betterprogramming.pub/build-your-docker-images-automatically-when-you-push-on-github-18e80ece76af?source=collection_archive---------0-----------------------#2019-08-31</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="716c" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">实现Docker Hub和GitHub的集成</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/61de839c765ebbfd0ffbe340ea5c1eb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HxKyyQhQFKTaZgdmrjQZjA.jpeg"/></div></div></figure><p id="8cfd" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><a class="ae lr" href="https://hub.docker.com" rel="noopener ugc nofollow" target="_blank"> <em class="ls"> Docker Hub </em> </a> <em class="ls">与</em><a class="ae lr" href="https://github.com" rel="noopener ugc nofollow" target="_blank"><em class="ls">GitHub</em></a><em class="ls">(以及</em><a class="ae lr" href="https://bitbucket.org" rel="noopener ugc nofollow" target="_blank"><em class="ls">bit bucket</em></a><em class="ls">)集成，允许您在推送新代码时自动构建容器的映像。您的映像的标记可以从您的存储库的标记(或分支)中提取，并且可以执行自动化测试，以确保您的映像在可供下载之前按预期构建。在这篇文章中，我将向你展示如何快速建立这样一个工作流程。</em></p></div><div class="ab cl lt lu hy lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="in io ip iq ir"><h1 id="2c2c" class="ma mb iu bd mc md me mf mg mh mi mj mk ka ml kb mm kd mn ke mo kg mp kh mq mr bi translated">创建你的GitHub Repo并添加一个<code class="fe ms mt mu mv b">Dockerfile</code></h1><p id="9e32" class="pw-post-body-paragraph kv kw iu kx b ky mw jv la lb mx jy ld le my lg lh li mz lk ll lm na lo lp lq in bi translated">显然，第一步是在GitHub上设置您的存储库:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nb"><img src="../Images/789341d593714d1297eb2340bffc0f95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X8-itvK_vGTsy4MNyRKaXg.png"/></div></div><p class="nc nd gk gi gj ne nf bd b be z dk translated">创建公共GitHub库</p></figure><p id="3f53" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">接下来，在本地克隆您的新存储库，添加一个示例<code class="fe ms mt mu mv b">Dockerfile</code>，并将更改推回到存储库:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ng"><img src="../Images/3639d357a5ac766c2c7e3f8751b09ef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7eNikcL3ZRn5PzvllNbvA.png"/></div></div><p class="nc nd gk gi gj ne nf bd b be z dk translated">将默认的<code class="fe ms mt mu mv b">Dockerfile</code>添加到您的存储库中</p></figure><p id="e1a8" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如你所见，我们创建的<code class="fe ms mt mu mv b">Dockerfile</code>非常简单——仅仅使用了官方的<code class="fe ms mt mu mv b">hello-world</code>图片。</p></div><div class="ab cl lt lu hy lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="in io ip iq ir"><h1 id="f211" class="ma mb iu bd mc md me mf mg mh mi mj mk ka ml kb mm kd mn ke mo kg mp kh mq mr bi translated">在Docker Hub上实现自动化构建</h1><p id="3927" class="pw-post-body-paragraph kv kw iu kx b ky mw jv la lb mx jy ld le my lg lh li mz lk ll lm na lo lp lq in bi translated">要启用自动构建，您需要将您的Docker Hub帐户与您在GitHub上的帐户连接。登录Docker Hub，进入<em class="ls">账户设置&gt;关联账户</em>。向下滚动找到<em class="ls"> GitHub </em>并点击<em class="ls">连接</em>链接。您将通过通常的OAuth流程登录GitHub(如果尚未登录)并授权Docker访问您的GitHub库。如果一切顺利，您应该会收到来自GitHub的通知:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nh"><img src="../Images/580aeb5fae0bf9e260d8b0eee5868815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9y9ZXZheuHuyFJxSpRy_Zw.png"/></div></div><p class="nc nd gk gi gj ne nf bd b be z dk translated">成功连接Docker Hub和GitHub</p></figure><p id="d3b8" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在是时候创建Docker Hub资源库并将其链接到您的GitHub资源库了:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ni"><img src="../Images/ba5c688bd4685ae0c811be71a4744679.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s9CE1TsgQGU57mk5vPkzeQ.png"/></div></div><p class="nc nd gk gi gj ne nf bd b be z dk translated">使用GitHub access创建Docker Hub存储库</p></figure><p id="34eb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这里发生了一些事情，让我们来分解一下:</p><ul class=""><li id="2709" class="nj nk iu kx b ky kz lb lc le nl li nm lm nn lq no np nq nr bi translated"><strong class="kx iv">给你的回购命名</strong> <br/>这里不多说，只是用一个有意义的名字。我选择了与我的GitHub库相同的名字。</li><li id="8764" class="nj nk iu kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated"><strong class="kx iv">选择GitHub repo </strong>选择您在上一步中创建的存储库。</li><li id="42b3" class="nj nk iu kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated"><strong class="kx iv">设置建造规则</strong> <br/>真正有趣的部分来了。因为代码可以在任何时候被推送，所以您应该让Docker Hub知道您映像应该在什么时候构建，以及哪个标签应该将该映像分配给它。您可以使用<em class="ls">构建规则</em>来配置这两者。</li></ul><p id="1b08" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在只需点击<em class="ls"> Create </em>(不要点击<em class="ls"> Create &amp; Build </em>，因为这将触发手动构建)。</p></div><div class="ab cl lt lu hy lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="in io ip iq ir"><h1 id="ba79" class="ma mb iu bd mc md me mf mg mh mi mj mk ka ml kb mm kd mn ke mo kg mp kh mq mr bi translated">建立规则</h1><p id="4560" class="pw-post-body-paragraph kv kw iu kx b ky mw jv la lb mx jy ld le my lg lh li mz lk ll lm na lo lp lq in bi translated">要让Docker Hub知道如何以及何时自动构建您的映像，您可以指定构建规则。您可能有多个并行应用的规则，只需一次git-push就可以有效地为您的图像分配多个标签:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nx"><img src="../Images/e3292e66b99877ac8619c977089aca5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bM66MA1KMKDTCdL7QpCxkQ.png"/></div></div><p class="nc nd gk gi gj ne nf bd b be z dk translated">基于标记和主分支自动构建的构建规则</p></figure><p id="dfa3" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在上图中，我们设置了两个不同的规则——让我们看看它们是怎么做的。</p><h2 id="4e7e" class="ny mb iu bd mc nz oa dn mg ob oc dp mk le od oe mm li of og mo lm oh oi mq oj bi translated">标签规则</h2><p id="b759" class="pw-post-body-paragraph kv kw iu kx b ky mw jv la lb mx jy ld le my lg lh li mz lk ll lm na lo lp lq in bi translated">“标记规则”允许Docker Hub在git存储库中发现新标记时开始构建映像。这可能是您为正式发布的图像构建图像的首选方式。</p><p id="7b14" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">由于git标签可以是任意的，并且包含开发人员可能选择的任何内容，Docker Hub允许您定义一个<a class="ae lr" href="https://regex101.com" rel="noopener ugc nofollow" target="_blank">正则表达式</a>，以便确定git标签的哪个部分应该成为Docker图像标签的一部分。在上面的例子中，我们选择了<code class="fe ms mt mu mv b">/^[0-9.]+$/</code>作为正则表达式来提取图像标签。实际上，这告诉Docker Hub我们的git标签适合自动构建，应该是带点的数字形式，并且应该是标签的唯一文本。提取并分配给它的图像标签由在<em class="ls"> Docker标签</em>下输入的<code class="fe ms mt mu mv b">{sourceref}</code>属性表示。</p><h2 id="3c44" class="ny mb iu bd mc nz oa dn mg ob oc dp mk le od oe mm li of og mo lm oh oi mq oj bi translated">分支规则</h2><p id="4fcd" class="pw-post-body-paragraph kv kw iu kx b ky mw jv la lb mx jy ld le my lg lh li mz lk ll lm na lo lp lq in bi translated">“分支规则”允许Docker Hub根据特定分支上的活动开始构建映像。这里典型的用例是使用这样一个规则，根据您的git存储库的日常活动构建一个最新的映像。在<em class="ls">源</em>下输入要监控的分支，并在<em class="ls">停靠标签</em>下为从其构建的停靠图像分配标签。</p><h1 id="08ea" class="ma mb iu bd mc md ok mf mg mh ol mj mk ka om kb mm kd on ke mo kg oo kh mq mr bi translated">建立你的第一个形象</h1><p id="a0a7" class="pw-post-body-paragraph kv kw iu kx b ky mw jv la lb mx jy ld le my lg lh li mz lk ll lm na lo lp lq in bi translated">现在一切就绪，我们只需要标记git存储库的当前状态，并将标记推回GitHubDocker Hub将施展魔法，为我们树立一个形象:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj op"><img src="../Images/207ffb6d0f9cff962f7d1d06a57a032c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_IrCZbd8Z48gdTwGjN8yg.png"/></div></div><p class="nc nd gk gi gj ne nf bd b be z dk translated">推动标签来触发自动构建</p></figure><p id="ee24" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">事实上，几分钟后，Docker Hub已经自动构建并标记了1.0.0映像:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oq"><img src="../Images/254f60e94bb6669f38d15b57ee9a21cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KjuasngMgYZ0AnIqW1MwtA.png"/></div></div><p class="nc nd gk gi gj ne nf bd b be z dk translated">1.0.0版的第一个自动化构建</p></figure><p id="c0a0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">为了看到我们的<em class="ls">最新的</em>图像被自动创建，我们需要在<em class="ls">主</em>分支中推动一个新的变化:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj or"><img src="../Images/355fc115685cd914bb8373de93ea8363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mcdkTt0GAFIs1jMWwkR6UQ.png"/></div></div><p class="nc nd gk gi gj ne nf bd b be z dk translated">将变更推送到<em class="os">主分支</em></p></figure><p id="1913" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">又过了几分钟:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ot"><img src="../Images/11937705ba0fbeb471fbbb11fa551436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UW46SPP1nnRKjZ5dRQSRyA.png"/></div></div><p class="nc nd gk gi gj ne nf bd b be z dk translated">从主分支构建的最新映像</p></figure><p id="cbd0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Docker Hub为您提供了两个额外屏幕，您可以在这些屏幕上监视您的构建:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ou"><img src="../Images/a2ed5de8d713a9589f2e134562bfc517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q73pTHUCpqb8jidZTHj9yA.png"/></div></div><p class="nc nd gk gi gj ne nf bd b be z dk translated">构建屏幕</p></figure><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ov"><img src="../Images/4419c1fe78cf897b48872aec559bf354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YG19ubyJOa8ycyhDcxnWew.png"/></div></div><p class="nc nd gk gi gj ne nf bd b be z dk translated">时间线屏幕</p></figure></div><div class="ab cl lt lu hy lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="in io ip iq ir"><p id="ec79" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><strong class="kx iv">本系列的其他文章<br/> </strong>本文是关于<em class="ls"> Docker Hub和自动化构建</em>系列文章的一部分。本系列的其他文章包括:</p><div class="ow ox gq gs oy oz"><a href="https://medium.com/@NMichas/how-to-test-your-automated-builds-on-docker-hub-e40879f35d1e" rel="noopener follow" target="_blank"><div class="pa ab fp"><div class="pb ab pc cl cj pd"><h2 class="bd iv gz z fq pe fs ft pf fv fx it bi translated">如何在Docker Hub上测试你的自动化构建</h2><div class="pg l"><h3 class="bd b gz z fq pe fs ft pf fv fx dk translated">如何测试您的自动化Docker Hub构建</h3></div><div class="ph l"><p class="bd b dl z fq pe fs ft pf fv fx dk translated">medium.com</p></div></div><div class="pi l"><div class="pj l pk pl pm pi pn kt oz"/></div></div></a></div><div class="ow ox gq gs oy oz"><a href="https://medium.com/@NMichas/how-to-recover-from-a-failed-automated-docker-hub-build-8b6c1cc3d7d4" rel="noopener follow" target="_blank"><div class="pa ab fp"><div class="pb ab pc cl cj pd"><h2 class="bd iv gz z fq pe fs ft pf fv fx it bi translated">如何从失败的自动化Docker Hub构建中恢复</h2><div class="pg l"><h3 class="bd b gz z fq pe fs ft pf fv fx dk translated">你的Docker Hub自动化构建失败了吗？这里有一个如何恢复它的快速指南。</h3></div><div class="ph l"><p class="bd b dl z fq pe fs ft pf fv fx dk translated">medium.com</p></div></div><div class="pi l"><div class="po l pk pl pm pi pn kt oz"/></div></div></a></div></div></div>    
</body>
</html>