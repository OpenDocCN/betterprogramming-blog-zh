<html>
<head>
<title>How to Fix the “Failed to Read the CSSRules Property From CSSStyleSheet” Error</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何修复“无法从CSS样式表读取CSSRules属性”错误</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-fix-the-failed-to-read-the-cssrules-property-from-cssstylesheet-error-431d84e4a139?source=collection_archive---------1-----------------------#2020-10-12">https://betterprogramming.pub/how-to-fix-the-failed-to-read-the-cssrules-property-from-cssstylesheet-error-431d84e4a139?source=collection_archive---------1-----------------------#2020-10-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="48e8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在您的web应用程序中使用样式表时，请避免此问题</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/109b9543734315227ea78ed290581a2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zkTnxU6wI4XGLL4k"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Graham Ruttan 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="ba3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近，一些客户在Angular web应用程序中遇到了一个问题，其中抛出了一个异常。因为这个问题，你不能使用应用程序的主要部分。作为一名开发人员，我希望有关于如何重现问题的明确说明，以免浪费时间。良好的客户支持或愿意分享更多细节而不是“它对我不起作用”的客户可以提供有意义的信息，使开发人员的生活更轻松。客户支持人员无法在他们的设备上重现该问题，但少数客户却一直遇到这种情况。</p><p id="2fde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当这个问题被提出时，我做了我遇到类似问题时通常会做的事情。这篇文章是关于这个特殊的问题以及调试关键问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3311" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">找到根本原因</h1><ul class=""><li id="6a71" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">我用的是<a class="ae ky" href="https://www.instana.com/product-overview#web-browser2/" rel="noopener ugc nofollow" target="_blank"> Instana </a>，这是一个很棒的监控微服务和网站的SaaS。通过我们的监控工具，我能够确认少数客户出现了错误，以及导致问题的用户操作。即使有了这些信息，我一开始也无法重现这个问题。</li><li id="429a" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">多亏了我们的监控工具，我有了错误堆栈跟踪。这样，我就找到了导致异常抛出的代码。正如您在下面看到的，这段代码查询DOM中的所有样式表，并对每个样式表的CSS规则做一些事情。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="5073" class="nr md it nn b gy ns nt l nu nv">Uncaught DOMException: Failed to read the 'cssRules' property from 'CSSStyleSheet': Cannot access rules</span></pre><ul class=""><li id="e686" class="mu mv it lb b lc ld lf lg li nw lm nx lq ny lu nb nc nd ne bi translated">我们的监控工具还提供浏览器数据，所以我检查了哪些浏览器受影响最大。原来主要是基于Chromium的浏览器的最新版本，比如谷歌Chrome。由于我的许多同事使用Google Chrome作为开发的主要浏览器，我发现奇怪的是还没有其他开发人员偶然发现这一点。</li><li id="cf8d" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">没有针对此功能的测试。我试图用Jest的单元测试来重现这个问题，但是测试成功地通过了。</li><li id="0e49" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">我在网上搜索了这个错误信息，找到了一些关于Chrome最近变化的有用帖子。在最新版本的Chrome中，CORS安全规则也适用于样式表(类似于Iframe规则)。您可以加载和呈现它们，但是不能通过JavaScript访问从另一个域加载的内容样式表。虽然这些信息很有帮助，但我仍然不明白为什么这会是个问题。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1d11" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何修复错误</h1><p id="3a52" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">有了上面提到的所有知识，我脑海中形成了一个理论:如果以某种方式加载到DOM中的样式表不是我们的，会怎么样？这是我能想到的唯一可能导致这个问题的东西，所以我开始思考，“不是来自我们的样式表是如何加载到DOM中的？”</p><p id="7dac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答案是:浏览器扩展。你可能知道网页扩展可以删除网站上的广告，或者提供你的浏览器所没有的功能。浏览器扩展通常构建在HTML、CSS和JavaScript等web技术之上。这意味着web扩展完全有可能从另一个域加载样式表——除非您没有使用这样做的扩展。</p><p id="8a0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过注入指向来自另一个域(例如CDN)的CSS文件的样式(例如通过使用Chrome开发者工具),可以容易地再现该问题。如果您的CSS样式表与HTML来自同一个域，您将能够访问<code class="fe oc od oe nn b">document.<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentOrShadowRoot/styleSheets" rel="noopener ugc nofollow" target="_blank">styleSheets</a>.get(index).<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/cssRules" rel="noopener ugc nofollow" target="_blank">cssRules</a></code>属性。否则，它将抛出以下错误:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="0268" class="nr md it nn b gy ns nt l nu nv">Uncaught DOMException: Failed to read the 'cssRules' property from 'CSSStyleSheet': Cannot access rules</span></pre><p id="c2dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们已经理解并找到了根本原因，那么解决这个问题就很容易了:只保留从同一个域加载的样式表或者其中的<code class="fe oc od oe nn b">href</code>为空(如果样式表是内联的，比如在使用Angular时，就可能出现这种情况):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="4166" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">修复发布后，我们联系了受影响的客户，他们可以确认问题不再发生。此外，我们的监控工具也没有报告这个问题的更多发生，所以我们知道我们是安全的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fceb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="8ae0" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">感谢您阅读这篇短文。如您所见，问题的修复可以在几分钟内实现，但是了解问题的根本原因通常比我们预期的要长。</p><p id="3be5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这对你有帮助吗？请在评论中告诉我。</p></div></div>    
</body>
</html>