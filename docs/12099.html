<html>
<head>
<title>JavaScript 101: JSON all the way down</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript 101: JSON一路向下</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/javascript-101-json-all-the-way-down-4d01d185236f?source=collection_archive---------11-----------------------#2022-05-11">https://betterprogramming.pub/javascript-101-json-all-the-way-down-4d01d185236f?source=collection_archive---------11-----------------------#2022-05-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5fc4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你曾经想知道的关于JSON的一切，但是由于某种原因你不敢问</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/21caf38677f5bd3ffa72dcb6448efdb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a0akg2Q0eOxqu5qptdW8PQ.png"/></div></div></figure><p id="7a02" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">JSON只是一种很好的数据传输格式，但有时我们会忘记它。我们专注于使用CSV、XML和YAML等其他工具，却忘记了JS开发人员应该永远记住的一个特殊事实:JSON代表<strong class="kw iu">J</strong>ava<strong class="kw iu">S</strong>script<strong class="kw iu">O</strong>object<strong class="kw iu">N</strong>rotation。</p><p id="3fac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">换句话说，我们有现成的本机支持，所以让我们利用它！</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="99f7" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">用JavaScript解析JSON</h1><p id="1730" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">“解析”本质上意味着要么把一个字符串转换成别的东西。</p><p id="71a0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在有两个场景，在处理JavaScript中的JSONs时，这可能会派上用场。毕竟，我们确实喜欢这种格式，但是如果你是序列化的(字符串形式),你真的不能用它做什么，不是吗？</p><h2 id="431e" class="mu ly it bd lz mv mw dn md mx my dp mh ld mz na mj lh nb nc ml ll nd ne mn nf bi translated">场景1:将字符串转换成实际的对象</h2><p id="a0a0" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">一个非常常见的场景可能是您读取字符串，或者从您的用户接收它作为输入，也许作为请求参数。关键是你面对的是这样一个字符串:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="acac" class="mu ly it nh b gy nl nm l nn no">"{\n  \"name\": \"Fernando Doglio\",\n  \"author\": true,\n  \"age\": 38\n}"</span></pre><p id="772a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一个有效的字符串，但是我们不能把它赋给一个变量，并把它当作一个对象，不是吗？</p><p id="ec78" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">幸运的是，有一个非常简单的解析方法:用<code class="fe np nq nr nh b">JSON.parse</code>方法。</p><p id="ce2a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">没错，有一个神奇的全局对象叫做<code class="fe np nq nr nh b">JSON</code>(注意大写名称)，可以用来解析(也可以是stringify)一个JSON字符串。</p><p id="9434" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以我们要做的就是:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="5cbf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是你所需要的，现在你可以像例子中一样，把值当作一个对象。</p><h2 id="66cb" class="mu ly it bd lz mv mw dn md mx my dp mh ld mz na mj lh nb nc ml ll nd ne mn nf bi translated">场景2:从Node.js中的文件读取JSON</h2><p id="d3da" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">这是一个特殊的用例，虽然它可能不适用于所有人，但我认为理解它也很重要。</p><p id="96fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">基于上面的例子，我们假设要读取一个JSON文件的内容，您必须用类似于<code class="fe np nq nr nh b">fs.readFile</code>的东西读取它，然后用<code class="fe np nq nr nh b">JSON.parse</code>解析它的内容。这是可行的。</p><p id="0ba4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，Node.js使它变得更加简单，因为您可以简单地直接导入它，它会为您完成工作！</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="6c4e" class="mu ly it nh b gy nl nm l nn no">const myJSON = require("path/to/file.json")</span></pre><p id="4e46" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当然，这是使用了<code class="fe np nq nr nh b">require</code>函数，因为来自ES6的<code class="fe np nq nr nh b">import</code>语句仍然不支持它。有一个关于it 的<a class="ae nu" href="https://github.com/tc39/proposal-json-modules/issues" rel="noopener ugc nofollow" target="_blank">提案，目前处于第三阶段，所以也许有一天我们也能够“导入”它。</a></p><h2 id="9ba3" class="mu ly it bd lz mv mw dn md mx my dp mh ld mz na mj lh nb nc ml ll nd ne mn nf bi translated">但是如果JSON无效会发生什么呢？</h2><p id="8378" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">关于这种格式，需要记住的重要一点是，它不像文字对象符号。</p><p id="5aca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您不使用双引号，或者如果您在里面的某个地方留下了一个尾随逗号，那么JSON将是无效的，并且上面的任何一个方法都会抛出一个异常。</p><p id="3bc4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是为什么你通常想要用一个<code class="fe np nq nr nh b">try...catch</code>块来包装<code class="fe np nq nr nh b">parse</code>调用，当然，除非你绝对信任字符串的来源，但是为了仔细检查，确保总是添加块:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="3556" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将确保如果您的JSON出现问题，您的应用程序不会崩溃。如果错误信息不够清楚(有时可能有点晦涩)，你可以使用在线验证器，比如<a class="ae nu" href="https://jsonformatter.org/json-parser" rel="noopener ugc nofollow" target="_blank">https://jsonformatter.org/json-parser</a>。如果你不能发现文件的确切问题，这些工具将帮助你。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="ad0e" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">使用可选的reviver功能</h1><p id="cdf4" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">虽然以上内容已经足够了，但是在解析JSON时，有时可能需要一些额外的帮助。也许在解析期间，您需要影响或者至少检查被解析的键和值。</p><p id="632e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">也许你甚至需要删减一些值，因为你知道你不需要它们。解析之后肯定可以这么做。但是如果你可以使用一个可选的回调函数“reviver”(不知道为什么是这个名字，顺便说一下)和<code class="fe np nq nr nh b">parse</code>方法，并在那里处理它，为什么要等待呢？</p><p id="6973" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个函数将为JSON中的每个键调用，它将接收这个键及其相应的值。例如，如果您想将JSON中的每个字符串值都大写，您应该这样做:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="67ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当然，这段代码会输出:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="5084" class="mu ly it nh b gy nl nm l nn no">Name: FERNANDO DOGLIO<br/>Country: SPAIN</span></pre><p id="4ff9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您还可以通过不返回它们的值来删除一些键(注意在我之前的例子中我是如何返回每个值的，即使它不是字符串):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="c62e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将输出如下所示的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/ead0422129aef56a4ab995d3ba514031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dzspPpZz6JgSEWM4eOVF6Q.png"/></div></div></figure><p id="967a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意我是如何方便地从解析结果中删除我的年龄的。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="29a0" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">向JSON添加类型和结构检查</h1><p id="734a" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">同样，这完全是可选的，但是如果您需要向JSONs添加一些数据类型检查，甚至是结构检查，以确保您没有遗漏强制属性，那么理解一件事很重要:您不能这样做。</p><p id="710e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我的意思是你可以，当然，但不是天生的。JSON标准不支持这两种检查。开箱即用，您不能真正指定属性的类型，甚至不能强制指定一个属性。见鬼，这些检查并不基于任何模式，所以如果这是您所需要的，请停止阅读JSON文档。</p><p id="c5d3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">相反，把你的注意力转向<a class="ae nu" href="https://json-schema.org/" rel="noopener ugc nofollow" target="_blank"> JSONSchema </a>。这是向JSONs添加结构验证的正式方式。是的，它们将要求您添加一个额外的文件来声明您的模式，是的，您将需要添加一个外部库来支持它，因为它不是JS的JSON标准的一部分。</p><p id="a9d2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，由于这是开发人员支持这一功能的唯一真正的方法，所以有针对大多数通用语言的库。是的，这当然包括JavaScript。</p><p id="b6e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里的是一个模式验证器的列表，您可以将它作为项目的依赖项。大多数都是这样工作的:首先编写模式，令人吃惊的是，它是JSON格式的，然后解析(加载)它，最后根据它验证您的JSON。</p><p id="75fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里有一个例子，是我到目前为止作为例子使用的JSON模式的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="ff18" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我承认这有点冗长，但是它可以让您精确地指定每个属性应该是什么样子，最后您甚至可以指定哪些属性必须总是存在。因为当时我删除了<code class="fe np nq nr nh b">age</code>属性，所以我决定在这里让它可选。</p><p id="2201" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">前5个属性更适合解析器(<code class="fe np nq nr nh b">$schema</code>和<code class="fe np nq nr nh b">$id</code>)或者阅读模式的人(<code class="fe np nq nr nh b">title</code>和<code class="fe np nq nr nh b">description</code>)。</p><p id="2979" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在像<strong class="kw iu">API</strong>这样的场景中，使用模式来验证JSON是非常常见的，在这种场景中，您希望某个有效载荷具有预定义的格式，您可以验证它，如果它不满足结构要求(如果模式没有通过验证)，则返回4XX错误。</p><p id="f49d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另一个例子是加载JSON格式的<strong class="kw iu">配置文件</strong>。如果用户可以篡改该文件，您可能希望在使用该数据之前进行某种检查，以确保它是有意义的。</p><p id="2588" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您正在考虑使用模式来验证您的JSON，我强烈建议您阅读官方文档<a class="ae nu" href="https://json-schema.org/learn/getting-started-step-by-step#starting" rel="noopener ugc nofollow" target="_blank"/>，它拥有您需要的一切。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="d0f6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">JSON格式非常强大，但有时人们会忽略它，因为他们认为它与JavaScript的对象文字符号完全一样。正如您所看到的，虽然有一些相似之处，但JSON允许更多。</p><p id="2bdc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您喜欢并学到了一些新东西，请留下您想了解的关于JS的另一个主题的评论，我将在我的下一篇“JavaScript 101”文章中介绍它。</p><p id="0a11" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nw">下次见！</em></p></div></div>    
</body>
</html>