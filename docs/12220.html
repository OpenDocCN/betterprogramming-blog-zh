<html>
<head>
<title>Source Control Your AWS CloudFormation Templates With GitHub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub对AWS CloudFormation模板进行源代码控制</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/source-control-your-aws-cloudformation-templates-with-github-9e2fe5dce677?source=collection_archive---------15-----------------------#2022-05-19">https://betterprogramming.pub/source-control-your-aws-cloudformation-templates-with-github-9e2fe5dce677?source=collection_archive---------15-----------------------#2022-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="45a4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过GitHub操作提高您的工作效率</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6fe9aacfbd622280c39f9481216dcb60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IujwzWxz2FOkOPYj.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4a7d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">源代码管理是跟踪和管理代码更改的实践。这可以是软件代码或基础设施代码(IaC)。</p><p id="69d5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">长期以来，IT开发中的源代码控制一直是常见的做法。但在it运营团队中，这仍然是一件新鲜或不常见的事情。</p><p id="fac4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我可以举起我的手说，我写的许多脚本或部署模板曾经存在于标记为版本1、旧版本、新版本等的文件夹中。甚至是我邮箱里的草稿邮件。多疯狂的工作方式啊，对吧？</p><p id="c7db" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢GitHub的发明和我的发现，我变得更擅长编写和存储脚本(希望如此！).现在一切都公开展示了。</p><h1 id="7dd9" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">使用GitHub进行AWS CloudFormation源代码控制</h1><p id="0749" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我最近一直在学习和创建<a class="ae mr" href="https://www.techielass.com/create-an-s3-bucket-using-aws-cloudformation" rel="noopener ugc nofollow" target="_blank"> AWS CloudFormation模板</a>，并创建了一个GitHub存储库来帮助存储我的模板，所以我可以对它们进行操作，也可以与他人分享它们。</p><p id="6922" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在这里找到我的作品:【https://github.com/weeyin83/AWSCloudFormationSamples T2】</p><p id="491e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我在本地机器上创建模板时，我一直使用某些工具来验证和检查我的模板的最佳实践和任何安全漏洞。</p><p id="3199" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这让我想看看是否可以用<a class="ae mr" href="https://www.techielass.com/tag/github-actions/" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>将这些检查构建到我的GitHub库中，我可以！</p><p id="4b8f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">编写模板时，很容易养成坏习惯，或者使用错误的措辞或语法。尤其是当你在不同语言之间切换甚至是多任务处理的时候。</p><p id="add1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了测试您的AWS CloudFormation模板，您可以部署它们。这将有助于验证您的模板，但还有其他更好的方法。Lint测试你的代码是前进的方向。</p><p id="3cd8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Lint测试您的代码可以帮助您识别错误或违反最佳实践的情况。您可以在编写代码时对代码进行lint测试。在你最喜欢的代码编辑器中，通常有你可以安装的工具或插件。但是最佳实践也是在您将代码签入源代码控制环境时执行lint测试。</p><p id="c894" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了帮助验证您的AWS CloudFormation模板，您可以使用一个名为<a class="ae mr" href="https://github.com/aws-cloudformation/cfn-lint" rel="noopener ugc nofollow" target="_blank"> cfn-lint </a>的工具。</p><p id="f34e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">cfn-lint工具可以根据<a class="ae mr" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-resource-specification.html" rel="noopener ugc nofollow" target="_blank"> AWS CloudFormation资源规范</a>来验证YAML和JSON模板。</p><p id="9948" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果在模板中没有发现问题，cfn-lint工具将返回一个零退出代码。任何其他值都表明模板有问题。下面列出了可能对您有帮助的代码:</p><ul class=""><li id="3da0" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">0表示未发现问题</li><li id="66ab" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">2是一个错误</li><li id="29d4" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">4是一个警告</li><li id="144b" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">6是一个错误和警告</li><li id="57de" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">8是一个信息</li><li id="0024" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">10是一个错误信息</li><li id="2117" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">12是一个警告和信息</li><li id="e425" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">14是错误、警告和信息</li></ul><h1 id="abfd" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">使用cfn_nag检查安全漏洞</h1><p id="42ed" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">还有另一个叫做<a class="ae mr" href="https://github.com/stelligent/cfn_nag" rel="noopener ugc nofollow" target="_blank"> cfn_nag </a>的工具，它可以检查你的代码中潜在的任何不安全的基础设施。当您阅读这个工具的相关文档时，作者说它可以检查如下内容:</p><ul class=""><li id="52bc" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">太宽松的IAM规则(通配符)</li><li id="2aea" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">过于宽松的安全组规则(通配符)</li><li id="f21b" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">访问未启用的日志</li><li id="a1f2" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">未启用的加密</li><li id="21f2" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">密码文字</li></ul><p id="445d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在流程的早期检查您的基础架构模板是否存在任何潜在的安全问题非常重要。没有人愿意为其基础架构中的安全漏洞负责，这些漏洞可能会给他们或他们的客户带来声誉或财务问题。</p><h1 id="64e1" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">带有GitHub操作的AWS CloudFormation工作流</h1><p id="56f8" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">由于我们的AWS CloudFormation模板作为中央存储库存储在GitHub中，我们希望确保只有符合正确标准的模板才存储在那里。</p><p id="dd09" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了做到这一点，我们可以构建一个GitHub actions工作流来运行cfn-lint和cfn_nag工具。</p><p id="8169" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是我创建的GitHub Actions工作流:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub检查云形成的工作流程</p></figure><p id="b7d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我创建的工作流会因多种原因而触发:</p><ul class=""><li id="81a0" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">当某个东西被推入存储库的主分支时</li><li id="3e99" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">当创建一个pull请求来将一些东西推入存储库的主分支时</li><li id="be1b" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">当手动触发时</li></ul><p id="f202" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">GitHub动作在Ubuntu <a class="ae mr" href="https://www.techielass.com/github-runners/" rel="noopener ugc nofollow" target="_blank"> runner </a>上运行。它运行以下三个步骤:</p><ul class=""><li id="c706" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">签出—此步骤签出代码，以便工作流可以使用并访问它。</li><li id="864c" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">cfn-lint-action —第二步是使用cfn-lint工具运行我的所有YAML模板文件。</li><li id="df30" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">stelligent cfn_nag —第三步针对所有模板运行cfn_nag工具。</li></ul><p id="b37b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我最近创建了一个pull请求，试图将新模板合并到主存储库中，当检查运行时，出现了错误。</p><p id="8e52" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我深入细节时，我可以看到根据cfn_nag工具，我的模板中有一些警告和错误。</p><p id="84dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这有助于提醒我和存储库的所有者或维护者，模板有一些问题，应该在合并到主分支之前查看。</p><p id="d734" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我知道你是如何使用GitHub动作来帮助存储和编写更好的基础设施作为代码模板的！</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="a3b6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="np">原载于</em>【https://www.techielass.com】<em class="np"/></p></div></div>    
</body>
</html>