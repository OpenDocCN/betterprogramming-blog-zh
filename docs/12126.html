<html>
<head>
<title>JavaScript 101: Accessing the Clipboard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript 101:访问剪贴板</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/javascript-101-accessing-the-clipboard-ad63f38e7d0?source=collection_archive---------7-----------------------#2022-05-13">https://betterprogramming.pub/javascript-101-accessing-the-clipboard-ad63f38e7d0?source=collection_archive---------7-----------------------#2022-05-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="19eb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">比你想象的容易多了！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/996a807b72dc3793da4f6cfa58fb3c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eSKqfhwtYKLvVvPK8JE3LA.png"/></div></div></figure><p id="64c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们通常不会想太多，因为毕竟如果用户想从我们的页面获取一些东西到剪贴板，他们可以选择它，右键单击它，然后单击“复制”。简单对吗？</p><p id="0654" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是如果他们不能呢？如果出于某种原因，他们被限制使用额外的鼠标按钮甚至键盘按键，那该怎么办？</p><p id="7fce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">或者见鬼，如果他们想要复制的东西是不可见的呢？你见过Twitter上关于Wordle的经典帖子吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/73c0ec31deb651ec14515bf1140c7c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*ewsjDsVpIxnLQpaL0UwyFA.png"/></div></figure><p id="e759" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以通过点击一个“分享”按钮来获得所有的文本和文本框，但你不可能在他们的网站上找到。那么他们是如何做到的呢？</p><p id="cb71" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这其实很简单，今天我将向你展示如何与剪贴板进行交互。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="0686" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">访问剪贴板</h1><p id="4a53" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">除了Internet Explorer之外，大多数其他现代浏览器都可以访问<code class="fe mv mw mx my b">navigator.clipboard</code>全局对象，这是您在现代web应用程序中与剪贴板交互的方式。</p><p id="116a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个全局对象有一些我们将要使用的有趣的方法:</p><ul class=""><li id="72a5" class="mz na it kw b kx ky la lb ld nb lh nc ll nd lp ne nf ng nh bi translated"><code class="fe mv mw mx my b">readText</code>:这个方法返回你之前复制到剪贴板的任何文本。</li><li id="2a39" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp ne nf ng nh bi translated"><code class="fe mv mw mx my b">read</code>:这个方法类似于<code class="fe mv mw mx my b">readText</code>，但是它返回剪贴板中可能存在的任何类型的数据(比如图像)。</li><li id="7493" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp ne nf ng nh bi translated"><code class="fe mv mw mx my b">writeText</code>:这个方法只允许你复制文本到剪贴板。</li><li id="7fcb" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp ne nf ng nh bi translated"><code class="fe mv mw mx my b">write</code>:你可能已经猜到了，用这种方法我们可以将任意数据复制到剪贴板上。这个特殊的方法可以用来实现复制命令，我们可以通过按CTRL+C来获得这个命令。</li></ul><p id="5d31" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样重要的是要提到，这些方法需要用户的特定许可才能启用。一个写(<code class="fe mv mw mx my b">clipboard-write</code>)，一个读(<code class="fe mv mw mx my b">clipboard-read</code>)。一会儿我将向您展示如何检查它，以确保您的代码能够工作。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="3773" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">将内容放入剪贴板</h1><p id="57bd" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">让我们从简单的开始:如何使用JavaScript将内容复制到剪贴板。</p><p id="b2bd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，让我们创建一个简单的页面，它有一个<code class="fe mv mw mx my b">textarea</code>元素和一个按钮，可以让您复制任何您想要写入的内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="d6f7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如你所见，我只是使用普通的JavaScript，我们不需要框架来理解剪贴板。</p><p id="2f82" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在使用<code class="fe mv mw mx my b">document.getElementById</code>方法获得TextArea的引用后，我做的第一件事是查询permissions API以确保我有正确的权限。这是非常标准的，默认情况下，我们应该能够做到这一点。然后我们只需要<code class="fe mv mw mx my b">writeText</code>TextArea元素中的值(第12行)。</p><p id="22d1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="np">关于数据大小的说明</em>:我找不到官方文档说明剪贴板的实际大小限制。这意味着你可以用这种方法复制大量的信息。也就是说，我不鼓励这样做，因为剪贴板不是一个安全的存储。任何应用程序都可以访问它，甚至覆盖它。</p><h2 id="b2b8" class="nq lz it bd ma nr ns dn me nt nu dp mi ld nv nw mk lh nx ny mm ll nz oa mo ob bi translated">将图像复制到剪贴板</h2><p id="fbf1" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">写文本很容易，但是如果你想复制别的东西，比如图像，该怎么办呢？那么我们不能使用<code class="fe mv mw mx my b">writeText</code>方法——很明显——我们必须求助于更通用的<code class="fe mv mw mx my b">write</code>方法。</p><p id="585a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本质上，该方法的工作方式是相同的，但是它不是直接传递我们的数据，而是期望一个由<a class="ae oc" href="https://developer.mozilla.org/en-US/docs/Web/API/ClipboardItem" rel="noopener ugc nofollow" target="_blank"> ClipboardItem </a>元素组成的数组。换句话说，无论我们想要复制什么，都需要包装到一个容器对象中，这样它就知道如何处理任何类型的二进制数据。</p><p id="5853" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不过不要担心，这听起来需要做很多工作，但是非常简单。这里有一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="ff9c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于这个例子，我使用HTML IMG标签只是为了获得<code class="fe mv mw mx my b">src</code>属性，因为我不能直接使用这个元素。API需要我将图像转换成一个Blob(本质上是说“这是一大块我不确切知道的东西”)。由于DOM API没有任何我可以使用的方法，所以我获取实际的图像，然后在响应对象上调用<code class="fe mv mw mx my b">blob</code>方法(第11行)。</p><p id="3205" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">剩下的和预期的一样，我用包含blob的<code class="fe mv mw mx my b">ClipboardItem</code>创建一个单元素数组，然后我将数组写入剪贴板。</p><p id="45f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以用上面的例子来推断你将如何复制其他的东西，比如一个XLS文件。您需要获取它，blob它，并确保您使用了正确的mime-type，这是我在<code class="fe mv mw mx my b">type</code>变量上的字符串。如果你不知道你的文件的mime-type是什么，只要在谷歌上搜索“mime-type for&lt;your file ' s extension here&gt;”，你就能找到了。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="1cf6" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">从剪贴板中读取</h1><p id="d6fa" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">我不打算在这里详细介绍，因为正如你将要看到的，机制与写入它是一样的。</p><p id="28d4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你必须确保你有正确的权限，然后使用<code class="fe mv mw mx my b">read</code>或<code class="fe mv mw mx my b">readText</code>。</p><p id="d019" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因为我们想让这个变得有趣一点，所以我要创建一个页面，让你粘贴你剪贴板上的图像，不知从哪里复制的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/8b90afa32cebab615bb4f42a23c27e16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cAsmhRwrG0X1_U9AOm-Rig.gif"/></div></div></figure><p id="f908" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以看到两者，前一个例子将图像复制到剪贴板，新的例子将它粘贴到本地元素。</p><p id="135f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是后者的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="e3bf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里最重要的部分是，我们需要记住，当我们调用<code class="fe mv mw mx my b">write</code>时，我们传递一个数组，所以<code class="fe mv mw mx my b">read</code>方法也返回一个数组。这意味着我们需要迭代它，确保我们只处理图像(因此检查类型),然后使用方便的<code class="fe mv mw mx my b">URL.createObjectURL</code>方法，该方法获取blob并生成一个编码的URL，使<code class="fe mv mw mx my b">img</code>标签能够理解。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="70f1" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">剪贴板事件</h1><p id="718a" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">最后，剪贴板API处理三个事件:剪切、粘贴和复制，当用户启动这些活动时，它们被触发。</p><p id="44bf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了让你知道你能做什么，让我们扰乱我们的用户，防止他们复制你网站的内容。但与其简单地禁用他们的能力，不如让我们给他们点颜色看看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="da16" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如您所见，我们可以将事件附加到特定的元素上，所以在这里我要确保您无法从我的整个页面中获得任何有趣的东西。当事件触发时，我用<code class="fe mv mw mx my b">document.getSelection</code>捕获选中的文本，然后打乱那个字符串。这样做所需的步骤是:</p><ol class=""><li id="6f02" class="mz na it kw b kx ky la lb ld nb lh nc ll nd lp oe nf ng nh bi translated">通过对每个字符进行拆分，将字符串转换为字符数组。</li><li id="869e" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp oe nf ng nh bi translated">使用带有随机排序功能的<code class="fe mv mw mx my b">sort</code>方法打乱数组。</li><li id="aead" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp oe nf ng nh bi translated">将得到的数组重新组合成一个字符串。</li></ol><p id="6180" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">简单！</p><p id="ba21" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后我用混洗的字符串手动设置剪贴板的内容。这样他们确实得到了一些东西，但不是他们可以利用的东西(<em class="np">邪笑</em>)。</p><p id="c48d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以用另外两个事件做类似的事情，极限是你的想象力！</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="b8de" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是101的全部内容，剪贴板是一个未被充分利用的特性，但是很容易掌握，所以我希望你今天能看到一些新的东西！</p><p id="cc85" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个101系列中，你有什么特别的话题想让我介绍吗？让我知道，我会写一篇关于它的文章！</p></div></div>    
</body>
</html>