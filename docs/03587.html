<html>
<head>
<title>Workflow Automation: How to Download and Organize 18000+ Images Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">工作流自动化:如何使用Python下载和组织18000多幅图像</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/workflow-automation-how-to-download-and-organize-18000-images-using-python-c42206577a8e?source=collection_archive---------7-----------------------#2020-02-19">https://betterprogramming.pub/workflow-automation-how-to-download-and-organize-18000-images-using-python-c42206577a8e?source=collection_archive---------7-----------------------#2020-02-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c3ba" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用22行代码节省几天甚至几周的工作量！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7b126dde40becd2a6b4f5c0ef70172f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SCYt435G-8TOuQsz"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@invictar1997?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Soragrit Wongsa </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="cd83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了22行代码，几天，也许几周的工作可以减少到30分钟。</p><p id="7eef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如今，人们比以往任何时候都更需要快速高效地完成任务。这就是自动化的用武之地。自动化在支持它的环境中是很棒的，但是其他人，比如“恐龙文化”，把它看作是懒惰的一种尝试。</p><p id="7783" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论哪种方式，在有大量“x”并且需要以某种方式操作的情况下，自动化都是有益的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9a1c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">问题</h1><p id="fb8f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我得到了一个包含18000多项足球运动员信息的数据集——运动员的姓名、年龄、体重、身高、原籍国、俱乐部等。</p><p id="c60b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个项目，我只需要球员的名字，俱乐部，和图像路径。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/80f1822db320d07364ea32f78f278838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qKz_DFZonoyiqWv9Xk6aAw.png"/></div></div></figure><h1 id="63b3" class="mc md it bd me mf na mh mi mj nb ml mm jz nc ka mo kc nd kd mq kf ne kg ms mt bi translated">这个计划</h1><p id="6c76" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我如何下载18000张图片，并根据他们的俱乐部将它们组织到一个文件夹中？</p><p id="33fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想自动化这项任务，而不是浪费大量时间，所以我选择编写一个只有22行代码的Python脚本。此代码:</p><ul class=""><li id="52ae" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">阅读CSV</li><li id="4f97" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">循环遍历每一行</li><li id="1922" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">在每一行中首先获取俱乐部名称。</li><li id="713d" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">检查“球员”文件夹以查看标记为文件夹的俱乐部是否存在。如果没有，它会创建一个以俱乐部命名的文件夹。</li><li id="90e7" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">如果俱乐部文件夹存在，它会将球员添加到文件夹中。</li><li id="1083" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">下载玩家的图像，并用玩家的名字保存。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2431" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">该过程</h1><p id="a940" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，创建一个虚拟环境来隔离项目。这个脚本中唯一使用的第三方模块是<code class="fe nt nu nv nw b">Requests</code>。需要执行GET请求来下载球员图像。</p><p id="fb4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建环境，请在终端中键入以下代码:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="fd80" class="ob md it nw b gy oc od l oe of">$ mkdir playerimages</span><span id="0ece" class="ob md it nw b gy og od l oe of">$ cd playerimages</span><span id="98d3" class="ob md it nw b gy og od l oe of">$ virtualenv -p python3 env</span><span id="d0f2" class="ob md it nw b gy og od l oe of">$ source env/bin/activate</span><span id="8344" class="ob md it nw b gy og od l oe of">$ (env) pip install requests</span><span id="303f" class="ob md it nw b gy og od l oe of">$ touch app.py</span></pre><p id="188f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保将CSV添加到目录中。数据集可以在<a class="ae ky" href="https://www.kaggle.com/karangadiya/fifa19" rel="noopener ugc nofollow" target="_blank">这里</a>找到。一旦它被添加，它应该被标记为<code class="fe nt nu nv nw b">fifaplayers.csv</code>。</p><h2 id="0f19" class="ob md it bd me oh oi dn mi oj ok dp mm li ol om mo lm on oo mq lq op oq ms or bi translated">导入模块</h2><p id="2dee" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">python标准库附带了脚本执行任务所需的三个模块。首先是操作系统模块(os)。这个模块将允许目录遍历、创建和操作。下一个模块是逗号分隔值(CSV)。需要CSV来读取播放器数据集。</p><p id="0094" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来是时间模块。用时间延迟来分隔批处理请求是一个很好的做法。如果脚本在没有合理时间延迟的情况下执行，它将在资源允许的情况下尽快完成。问题是，作为一个用户，你访问的服务会认为这是一种暴力攻击，导致你的IP地址被屏蔽，甚至更糟。一个架构良好的服务器可以在这种行为成为问题之前检测到它，但是在您决定这是您计划要做的之前，请查看服务关于访问数据的策略以及什么被认为是“数据抓取”</p><p id="7f3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，导入<code class="fe nt nu nv nw b">requests</code> <strong class="lb iu"> </strong>模块<strong class="lb iu"> </strong>。<code class="fe nt nu nv nw b">Requests</code>是需要下载的标准库未包含的四个模块之一。这个模块将被用来请求下载球员的头像。</p><h2 id="3060" class="ob md it bd me oh oi dn mi oj ok dp mm li ol om mo lm on oo mq lq op oq ms or bi translated">任务</h2><p id="1151" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">下面是对执行过程的解释，从第五行开始。</p><p id="985f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nt nu nv nw b">os.listdir</code> <strong class="lb iu"> : </strong>列出一个目录内的目录。这里<code class="fe nt nu nv nw b">os.listdir</code>被赋予一个<code class="fe nt nu nv nw b">./players</code>参数，并被赋给<code class="fe nt nu nv nw b">imageDir</code>变量。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="a5bd" class="ob md it nw b gy oc od l oe of">imageDir = os.listdir(‘./players’)</span></pre><p id="8c11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要将播放器数据集与CSV模块一起使用，需要将其打开，然后赋给第六行中的变量(<code class="fe nt nu nv nw b">playersFile</code>):</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="3342" class="ob md it nw b gy oc od l oe of"><em class="os">with</em> open(‘fifaplayers.csv’,newline=’’) as playersFile:</span></pre><p id="5da2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nt nu nv nw b">with</code>执行块中，发生了很多事情。让我解释一下我在剧本中的意图，让它更有意义。</p><ul class=""><li id="dee9" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">执行时，读取文档的第一行。</li><li id="6fcf" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">然后读取第1和第7个索引，这是球员的俱乐部。</li><li id="30f8" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">向图像服务器发出请求，如果玩家俱乐部的目录不存在，则创建该目录。</li><li id="3815" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">该播放器被添加到目录中。</li><li id="73bd" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">在将玩家添加到目录的过程中，玩家名称中存在的任何空格都被替换为下划线，小写，并作为png写入目录。这有助于提高可读性，并消除任何与间距有关的格式问题。</li><li id="901d" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">从CSV读取的每一行之间添加了500毫秒的时间延迟，以防止图像下载出现任何问题。</li></ul><p id="3fc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="os">注意:在第14行，当一个目录被创建时，它被记录到控制台。</em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2f1f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">死刑</h1><p id="1819" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当执行开始时，将创建并填充目录。该过程可能需要30分钟，具体取决于时间延迟和资源。</p><p id="97b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要执行脚本，请键入:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="2064" class="ob md it nw b gy oc od l oe of">$ (env) python app.py</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/7e180ea0fd074b74c244fdde0db5f8de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mdKcNXC73MmsPQFC0tL9gg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">脚本生成的文件夹和图像</p></figure><p id="e2ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一点上，可能需要几天甚至几周的事情在几分钟内就完成了。</p><p id="9e61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是自动化的力量！</p><p id="cb10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想得到更多这样的帖子，请注册我的时事通讯以获得最新消息。<a class="ae ky" href="https://share.hsforms.com/1tVh1vq1ZSHy0JlsTnFBwwg4c0tk" rel="noopener ugc nofollow" target="_blank">注册简讯</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure></div></div>    
</body>
</html>