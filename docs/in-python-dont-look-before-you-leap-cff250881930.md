# 在 Python 中，不要三思而后行

> 原文：<https://betterprogramming.pub/in-python-dont-look-before-you-leap-cff250881930>

## 关于更干净更好的 Python 代码的建议

![](img/3422b74070fc86f45fe4bea3bbb491a0.png)

照片由 [Cris Tagupa](https://unsplash.com/@cjtagupa?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄。

在这篇文章中，我们将看看程序员用来处理一段代码可能失败的两种常见的编码风格:“三思而后行”(LBYL)和“请求原谅比请求许可容易”(EAFP)。

如果你不熟悉 LBYL 和 EAFP 的辩论，那也没关系。我们将很快讨论这两个问题。

理解这些范例的细微差别将有助于您编写更干净、更高效的代码。我们将从 Python 的角度来看这个主题，但是一些概念也适用于其他语言。

我们开始吧！

# 三思而后行

LBYL 是一种传统的编程风格，在实际运行之前，我们会检查一段代码是否能够工作。

换句话说，如果一段代码需要一些先决条件，我们就放置条件语句，这样代码只有在所有先决条件都满足的情况下才会运行。

在下面的例子中，我们检查键(`name`、`age`和`gender`)是否存在，然后打印它们:

# 请求原谅比请求允许更容易

术语 EAFP 是由 COBOL 语言的发明者少将·格雷斯·默里·霍珀创造的。在这种方法中，我们简单地运行我们的代码，希望有最好的结果，同时准备好在代码失败时处理任何错误。

通常，这意味着将我们的代码封装在`try-except`块中，并处理任何可能发生的异常。

在下面的例子中，我们简单地打印字典的内容，不做任何检查。如果一个密钥丢失了，那么`except`模块应该处理它。请注意这与上例中的 LBYL 方法有何不同:

# 那么，哪个更好呢？

根据经验，EAFP 被认为更 Pythonic 化，在大多数情况下应该是首选。以下是 EAFP 比 LBYL 更受欢迎的一些原因。

## 清晰易读

EAFP 让“快乐之路”更加清晰易读。“显式比隐式好”是 Python 的一个重要信条。在上面的例子中，我们期望在大多数情况下，这些键会出现在字典中，这是 EAFP 代码所建议的。然而，LBYL 电码强调钥匙丢失的罕见情况。

## 更好的性能

EAFP 通常比 LBYL 快——尤其是需要大量检查的时候。考虑上面的例子。在 LBYL 方法中，我们进行三次检查来查看字典中是否存在这些键。调用字典三次既费时又重复。EAFP 更快，因为它直接打印字典。

现在，异常确实比`if`语句更昂贵。但是异常只被触发几次，而`if`语句总是被执行。此外，您应该注意到，与 Java 或 C++相比，Python 中的异常操作成本更低。所以对控制流使用异常是没问题的。

## 防止竞态条件

最重要的是，EAFP 帮助我们避免了比赛条件。当多个线程试图访问一个对象时，就会出现争用情况。考虑两个线程试图访问 LBYL 场景中的`person`字典。如果其中一个线程从字典中删除了一个键，而第二个线程通过了检查，我们将在执行 print 语句时得到一个异常。

然而，在 EAFP，我们可以放心，不管是什么情况，所有的异常都将由`except`块处理。

那么，LBYL 有什么理由吗？

是的，在某些情况下，使用 LBYL 确实更有意义。

## 复杂的副作用

如果你的函数有难以消除的副作用，使用 EAFP 可能是个坏主意。假设您开始向一个文件写入数据，并在做了一些更改后得到一个异常。试图恢复`except`块中的更改可能会很棘手。利用 LBYL 来提前停止手术会让你的生活轻松很多。

## 太多的例外

如果您希望在代码中的多个点抛出异常，使用 EAFP 可能会降低您跟踪代码实际失败位置的能力。理想情况下，您应该重构您的代码，以缩小`try-except`块，并继续使用 EAFP。如果你不能，就和 LBYL 一起去。

最终，这种争论仍然是开放的，一些开发人员只是喜欢其中一种风格。如果你不同意，我很想听听你的想法。

# 资源

*   YouTube 上的科里·斯查费
*   [“惯用 Python: EAFP 对 LBYL”，作者 Brett Cannon](https://devblogs.microsoft.com/python/idiomatic-python-eafp-versus-lbyl/) (微软博客)