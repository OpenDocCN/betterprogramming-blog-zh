<html>
<head>
<title>Creating APIs in R With Plumber</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Plumber在R中创建API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/creating-apis-in-r-with-plumber-2fb7b064619f?source=collection_archive---------12-----------------------#2022-09-07">https://betterprogramming.pub/creating-apis-in-r-with-plumber-2fb7b064619f?source=collection_archive---------12-----------------------#2022-09-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0d00" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将您的R代码投入生产</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fc3398451df06d9dd70d7555ebb1dbbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mj3UxkhHHtRFFYX5"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@reskp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jametlene Reskp </a>拍摄的照片</p></figure><p id="fd95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">r有一个很棒的社区。据估计，全球有超过两百万的R用户。来自世界各地不同领域的众多研究人员创造了奇妙的模型并分享他们的代码。我们，应用科学从业者，经常在r。</p><p id="0bbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是下一步是什么呢？当你最终找到了最佳工作模式时会发生什么？这正是将研究人员变成软件工程师的问题。我们将模型投入生产。我们用它来控制过程和预测结果。这才是重点。但是怎么做呢？</p><p id="4b7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">高级生产系统可能在形状和名称上有所不同。如果你是R用户，想把你的代码投入生产，你有两个选择:Shiny和Plumber。</p><p id="9aa2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Shiny是一个创建web应用程序的R框架。虽然它越来越受欢迎，但由于各种原因，我并不是Shiny的忠实粉丝。</p><p id="846b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二个选择，我认为是将R应用程序集成到任何软件系统的最佳方式，我的意思是字面上的任何系统，不是别人，就是管道工。正如您可能很容易猜到的，本文的主题是管道工。到本文结束时，您已经用Plumber在R中创建了第一个API。我们开始吧！</p><h1 id="acc1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">浅谈生产中R的使用</h1><p id="a62e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">关于R是否是适合生产环境的语言，有一场激烈的争论。在介绍Plumber之前，我们需要简单地谈一下这个话题。</p><p id="1f15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">快速搜索后，您可以很容易地找到软件行业中最受欢迎的服务器端语言。r根本不在那个名单上。您可以用许多其他语言创建更加健壮、可靠和可伸缩的服务器端应用程序。没有一个顶级软件团队想到在生产环境中使用R。尽管如此，为什么我仍然喜欢水管工，为什么我还要写一篇关于它的文章呢？</p><p id="e70a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为这个世界不是非黑即白的，软件业也不是。将开发和生产环境截然分开是不可能的。这种不可分性在初创企业、中型公司、学生项目和学术界更加明显。只有少数巨头有这种奢侈，如果你不是其中之一，你将不得不在生产环境中使用像R和Python这样的语言。</p><h1 id="6f38" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">API到底是什么？</h1><p id="af85" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们谈到了将我们的模型放到生产环境中的必要性。在本节中，我们将阐明这一点。</p><p id="810e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不要把自己局限在机器学习模型上。任何工作程序都可以投入生产。想想你写的一个程序。它可能接受输入，也可能不接受输入，但是它做了一些事情，并且有一个结论。您希望共享这个工作程序，并帮助其他人自动化他们的任务。那些其他的在不同的机器上，需要和你写的程序通信才能使用。</p><p id="11e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种交流是通过双方之间的信使来完成的。这个信使被称为“应用编程接口”，或API。因此，API作为两个软件实体之间的桥梁，让它们相互通信。</p><p id="f246" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">API的复杂性和用途可能不同。因此，它们按照不同的特性进行分类，您可以看到不同类型的API。我们将使用Plumber创建的一个API称为REST API或RESTful API。这不是你现在应该担心的事情。但是请记住，REST APIs使用一种叫做HTTP方法的非常简单的语言来与不同方进行交互。</p><h1 id="b91d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">水管工是怎么工作的？</h1><p id="a266" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们可以把水管工的过程分为两个主要部分:</p><p id="2508" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.)首先，我们创建一个脚本，打算用作API的主要服务。这是我们请求API时将运行的脚本。脚本的准备相当容易。对于脚本的每一部分，我们都留下了特殊的注释(这与常规的R注释有一点不同)来表明该部分在R脚本中的作用。我们添加到常规工作R脚本中的这些注释将引导Plumber正确地将脚本转换成API。</p><p id="3ccf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.)安装了Plumber之后，我们可以使用包中的<code class="fe mp mq mr ms b">pr()</code>函数将这个R脚本转换成一个Plumber API。</p><h1 id="0d93" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">让我们从一个简单的脚本开始</h1><p id="0c4e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们从一个只有几行的简单R脚本开始。就是这样。主题是蒙特卡洛模拟。你对这门学科的熟悉程度可能会因你各自的背景而有所不同，但对于大多数应用科学家来说，这是一项非常普通的工作。这里我们使用蒙特卡罗技术来解决一个定积分问题。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="d9b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们编写了一个函数，用用户提供的不同参数来寻找正常曲线下的面积。我们对自己的工作非常满意，并希望与他人分享。最快的方法是创建一个API。现在我们要基于R脚本创建一个。</p><h1 id="c208" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">将这个脚本转换成API</h1><p id="a66a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们将在上面的小代码中添加一些特殊的注释，将它变成一个API。那些特殊的注释被称为“注释”为了简单起见，我们将使用有限数量的注释。但是，我们可以用其他复杂的注释来制作更加复杂的API。在Plumber的官方文档中可以找到注释的详细列表。</p><p id="9bee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.rplumber.io/articles/annotations.html" rel="noopener ugc nofollow" target="_blank">https://www.rplumber.io/articles/annotations.html</a></p><p id="3f10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们首先给这个API一个名称和描述。用于此目的的注释如下:</p><pre class="kg kh ki kj gt mv ms mw mx aw my bi"><span id="5cbe" class="mz lt iq ms b gy na nb l nc nd">@apiTitle<br/>@apiDescription</span></pre><p id="c5fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的API将根据我们给出的输入返回一个结果。因此，为了表示这些输入，我们将使用以下注释:</p><pre class="kg kh ki kj gt mv ms mw mx aw my bi"><span id="57d8" class="mz lt iq ms b gy na nb l nc nd">@param</span></pre><p id="8e54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们将使用一个注释来指示这个API执行什么类型的请求。因为我们的API在执行代码后返回值，所以这个API发出一个GET请求。</p><pre class="kg kh ki kj gt mv ms mw mx aw my bi"><span id="9b15" class="mz lt iq ms b gy na nb l nc nd">@get</span></pre><p id="ed4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们代码的最终形状应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="056e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经重新配置了源代码，做了我们必须做的一切。剩下的事情就交给这个包了。</p><pre class="kg kh ki kj gt mv ms mw mx aw my bi"><span id="047c" class="mz lt iq ms b gy na nb l nc nd">mcInt &lt;- pr("plumber2.R")<br/>pr_run(mcInt)</span></pre><h1 id="fab7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">现在我们检查它是否工作</h1><p id="caca" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">运行API文件后，会弹出一个新窗口，我们可以看到它的基本元素。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/d4a43498f13555e95f1c88ebe8dde93b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8oW6neR1ICh4ndq2Xm_ZfA.png"/></div></div></figure><p id="1692" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们试一试，看看是否可行。您可以随意传递参数。我将对其进行如下测试:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/0cf60a80487ccc68150062481b4c2d0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FtdQQFrFDxap4UWEh8Tkig.png"/></div></div></figure><p id="9675" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它返回以下结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/f8d7a245ab50a2257f8e7a243ca4b657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lNb-FuJIBvMEB_BpT4TugQ.png"/></div></div></figure><h1 id="d5ce" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">部署</h1><p id="4fca" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">到目前为止，我们已经创建了一个可用的API。任务完成。可以说是在生产。我们这样做是为了自动化关于输入和输出的R脚本。但不幸的是，它只能从我们的机器上访问。最后一步是将其部署在一个平台上，以便其他人可以实现和使用它。</p><p id="b703" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">部署过程本身就是一个主题，不在本文讨论范围之内。但是，我们可以分享它的路线图。首要任务是为它创建一个容器，这样您就不必管理依赖项和版本。用于容器化应用程序的工具是Docker。第二步要简单得多，就是选择一个云服务来放置你的API。瞧，现在你已经把你的R脚本打开到一个自动化的生产环境中了。</p><h1 id="a9d9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="3f64" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在本文中，我们讨论了如何用R中的Plumber快速创建API。其中之一可能是API设计。您可能不需要用R构建您的整个生产环境，但是当您很着急，需要立即打开您的R应用程序供他人使用时，您知道如何做！</p></div></div>    
</body>
</html>