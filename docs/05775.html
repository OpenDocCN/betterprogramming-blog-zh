<html>
<head>
<title>Cookies in iOS 13</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 13中的Cookies</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/cookie-at-ios-13-8c089b8338fd?source=collection_archive---------3-----------------------#2020-08-05">https://betterprogramming.pub/cookie-at-ios-13-8c089b8338fd?source=collection_archive---------3-----------------------#2020-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8556" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在您的iOS应用程序之间传递数据，以及如何与嵌入在WKWebViews中的网页传递数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1fe03990a93befaccdb126de613ac8b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wt4A58SPoiGRBHTH"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@sharonp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">莎伦·皮特韦</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="76ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很长一段时间以来，Cookies一直在iOS世界中扮演着重要的角色。它们在应用程序中传输和存储状态信息。本文描述了通过将cookie设置为WKWebView，在原生iOS应用程序和嵌入式网页之间共享登录会话的方法。</p><p id="feb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本地iOS应用程序和嵌入式网页之间共享授权的能力需求很高。用户只需登录该应用一次，无需再次输入用户名和密码即可访问网络。利用cookies的优势给用户带来的巨大便利，超级刺激。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d58c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">HTTPCookie</h1><p id="050f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe mz na nb nc b">HTTPCookie</code>包含cookie的属性。它是由一个使用<code class="fe mz na nb nc b">HTTPCookiePropertyKey</code>作为键的键-值对字典定义的。</p><p id="8a47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面初始化包含身份验证令牌的cookie:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杨梦对饼干的定义</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="864f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><code class="fe mz na nb nc b">HTTPCookieStorage</code></h1><p id="497e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">iOS中有两种不同的cookie容器:<code class="fe mz na nb nc b">HTTPCookieStorage</code>和<code class="fe mz na nb nc b">WKHTTPCookieStore</code>。</p><p id="b052" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">HTTPCookieStorage</code>是基础框架中的singleton，用于为<code class="fe mz na nb nc b">URLSessionTask</code>设置cookies。每个应用都有自己的共享<code class="fe mz na nb nc b">HTTPCookieStorage</code> singleton，不会与其他应用共享。每个存储的cookie由一个<code class="fe mz na nb nc b">HTTPCookie</code>类的实例表示。</p><p id="3459" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在<code class="fe mz na nb nc b">HTTPCookieStorage</code>中设置和检索cookies，我们使用以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杨梦的HTTPCookieStorage</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3668" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><code class="fe mz na nb nc b">WKHTTPCookieStore</code></h1><p id="4124" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe mz na nb nc b">WKWebView</code>的每个实例都有自己的cookie存储容器，命名为<code class="fe mz na nb nc b">WKHTTPCookieStore</code>。</p><p id="886f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦用户登录到iOS应用程序，我们就从服务器获取auth访问令牌。在<code class="fe mz na nb nc b">WKWebView</code>使用以下内容将auth令牌跨本机应用共享到嵌入式网页:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杨梦的WKHttpCookieStore</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="119c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">WKWebsiteDataStore</h1><blockquote class="nf ng nh"><p id="e1f4" class="kz la ni lb b lc ld ju le lf lg jx lh nj lj lk ll nk ln lo lp nl lr ls lt lu im bi translated"><code class="fe mz na nb nc b">WKWebsiteDataStore</code>对象代表被选择的网站使用的各种类型的数据。数据类型包括cookies、磁盘和内存缓存，以及持久数据，如WebSQL、IndexedDB数据库和本地存储。— <a class="ae ky" href="https://developer.apple.com/documentation/webkit/wkwebsitedatastore" rel="noopener ugc nofollow" target="_blank">苹果开发者文档</a></p></blockquote><p id="0703" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">WKWebsiteDataStore</code> <em class="ni"> </em>包含一个<code class="fe mz na nb nc b">default</code>数据存储器和一个<code class="fe mz na nb nc b">nonPersistent</code>数据存储器。通过使用<code class="fe mz na nb nc b">nonPersistent</code>，不会有数据写入文件系统。这对于在web视图中实现隐私浏览非常有用。</p><p id="afc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">管理与特定<code class="fe mz na nb nc b">WKWebsiteDataStore</code>相关联的HTTP cookies的<code class="fe mz na nb nc b">WKHTTPCookieStore</code>对象，如下面的代码所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe mz na nb nc b">WKHTTPCookieStore by Eric Yang</code></p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="57fa" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">WKWebViewConfiguration</h1><p id="c097" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe mz na nb nc b">WKWebViewConfiguration</code>对象是用来初始化web视图的属性集合。它包含web视图使用的网站数据存储，这是<code class="fe mz na nb nc b">WKWebsiteDataStore</code>的一个实例。</p><pre class="kj kk kl km gt nm nc nn no aw np bi"><span id="1824" class="nq md it nc b gy nr ns l nt nu">// WKWebViewConfiguration</span><span id="22ed" class="nq md it nc b gy nv ns l nt nu">let configuration = WKWebViewConfiguration()</span><span id="0fcd" class="nq md it nc b gy nv ns l nt nu">configuration.websiteDataStore = websiteDataStore</span><span id="b3cf" class="nq md it nc b gy nv ns l nt nu">// WKWebView with non persistent data store</span><span id="ed02" class="nq md it nc b gy nv ns l nt nu">let webView = WKWebView(frame: CGRect.zero, configuration: configuration)</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a627" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">WKWebView</h1><p id="a361" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">从iOS 8.0开始<code class="fe mz na nb nc b">WKWebView</code>取代<code class="fe mz na nb nc b">UIWebView</code>。它们之间的主要区别在于,<code class="fe mz na nb nc b">WKWebView</code>的实例在一个独立于iOS应用的进程中运行，因此它可以利用原生Safari JavaScript优化。它使得<code class="fe mz na nb nc b">WKWebView</code>加载网页的速度比<code class="fe mz na nb nc b">UIWebView</code>快得多，效率也高得多。</p><p id="40f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它可以用默认配置进行初始化:</p><pre class="kj kk kl km gt nm nc nn no aw np bi"><span id="e5a9" class="nq md it nc b gy nr ns l nt nu">let webView = WKWebView()</span></pre><p id="2cd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者通过<code class="fe mz na nb nc b">WKWebViewConfiguration</code>的定制实例:</p><pre class="kj kk kl km gt nm nc nn no aw np bi"><span id="bc73" class="nq md it nc b gy nr ns l nt nu">let webView = WKWebView(frame: CGRect.zero, configuration: configuration)</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="10d6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="f057" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">文章描述了iOS中cookies的不同配置和存储。它演示了如何通过使用cookies在iOS应用程序和嵌入在<code class="fe mz na nb nc b">WKWebView</code>的网页之间传递身份验证信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="20c1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">资源</h1><p id="b8a2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">上面提到的所有代码都可以在<a class="ae ky" href="https://gist.github.com/ericleiyang/c4c13e3b9cc572988d17a65a2d9fb811" rel="noopener ugc nofollow" target="_blank">烹饪游乐场</a>找到。</p></div></div>    
</body>
</html>