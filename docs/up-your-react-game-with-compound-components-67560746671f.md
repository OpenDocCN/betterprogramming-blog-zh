# 使用复合组件增强您的 React 游戏

> 原文：<https://betterprogramming.pub/up-your-react-game-with-compound-components-67560746671f>

## 在您的 React 应用程序中构建出色的用户界面

![](img/922ccfbf4afb23afd7d1a5b1872e8ba2.png)

在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上由 [Robin Glauser](https://unsplash.com/@nahakiole?utm_source=medium&utm_medium=referral) 拍摄的照片。

作为一名 UI 开发人员，最大的挑战之一是让您的代码可重用，同时保持它的整洁和可维护性。我相信这种模式很熟悉:

*   您得到了您构建、测试和部署的组件的一些设计。一切看起来都很好。
*   一个具有相似(但略有不同)功能的新特性出现了。您向组件添加一个道具或一些条件逻辑来处理这个新的用例，这是可行的，但是事情开始变得有点混乱。
*   您构建组件的原始特性现在有了一些新的需求，您需要更新代码。但是您担心破坏组件的其他实例，并且编写覆盖所有逻辑的测试变得越来越困难。

这种情况(或类似情况)经常发生。那么，我们能做些什么来避免陷入困境呢？

# 复合组件

复合组件是许多子组件以共享的状态一起工作来做一些有用的事情。这有点拗口，所以让我们看一个简单的例子:

我们有一个简单的模态组件，它带有一个`header`、`body`和一个`onClose`道具。在这一点上，模态工作得很好，但不是特别灵活。如果出现了添加一个“确认”按钮或者能够传递 JSX 以呈现在主体中的需求，这将开始引起问题。您可以添加一些额外的逻辑来检查传递的内容，但是随着复杂性的增加，组件将变得不可维护:

正如你所看到的，我们不得不进行一些检查，以便正确地呈现组件，随着需求的增长，这只会变得更加混乱。

让我们来看看如何使用复合组件实现这一点:

在这个例子中，我们已经将模型的每个部分设置为它自己的组件，使用`children`。然后，我们将每个组件作为静态属性分配给`Modal`组件。这部分是完全可选的，但是我喜欢这种模式，因为它显示了组件是显式链接的。

我们可以这样使用它:

我们使用点符号(例如`Modal.Header`)来访问子组件，现在我们可以将我们想要的任何功能作为子组件传递下去。这意味着我们的模态组件要灵活得多——所有的样式和格式都在内部处理，其他任何逻辑都作为子代传递——但是实际的模态代码也大大简化了。

# 更进一步

我之前对复合组件的部分定义是“许多子组件在一个共享的状态下一起工作来做一些有用的事情。”模态示例已经很有用了，它将所有的样式抽象到一个地方，但是允许我们灵活地传递给它什么，但是子组件(例如`Modal.Header`或`Modal.Actions`)之间不共享任何状态。

那么，我们如何在子组件之间隐式共享状态呢？让我们看另一个例子:

这里发生了很多事情，让我们来分析一下。我们正在构建一个选择列表，它应该以类似于 HTML `select`的方式工作:

*   首先，我们使用 [React 的](https://reactjs.org/docs/context.html) `[createContext](https://reactjs.org/docs/context.html)`创建一个上下文。这就是我们在子组件之间共享状态的方式。
*   然后我们设置我们的`SelectList`组件，它创建一个上下文提供者并将`isOpen`状态传递给提供者的值。我们现在可以在`SelectList`提供者的所有消费者中访问这个状态(和`setIsOpen`状态设置器)。
*   我们创建了一个`useSelectListContext`钩子，这样我们就不必重复调用`useContext(SelectListContext)`。
*   然后，我们设置每个子组件(`SelectListToggle`、`SelectListDropdown`和`SelectListItem`)，它们呈现选项并处理打开、关闭和选择项目。
*   最后，我们将每个组件作为静态属性分配给`SelectList`组件，这样当我们使用它时，就可以使用点符号来访问它们。

我们将这样使用它:

我们正在映射我们的列表`options`，并将它们呈现为一个`SelectList.Item`。最棒的是，我们可以把小时候的任何东西传给我们的选项列表(例如图标或更全面的 JSX)。对于在`SelectList`中呈现什么，我们有完全的灵活性，但是我们不必担心处理它的“打开”状态。

# 结论

复合组件是一种非常强大的方法，可以使代码更加整洁，更加可重用。这种模式通常用在 UI 库中(例如 [Reach UI](https://reach.tech/) )，因为它给了开发人员在组件中呈现内容的完全灵活性，同时抽象出了所有重复的逻辑。

希望您会发现它在您自己的项目中很有用，并避免在新需求出现时陷入大家都很熟悉的重构地狱模式！