<html>
<head>
<title>Building Custom Data Visualizations With Datadog UI Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Datadog UI应用程序构建自定义数据可视化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-custom-data-visualizations-with-datadog-ui-apps-1d863018670b?source=collection_archive---------9-----------------------#2022-02-17">https://betterprogramming.pub/building-custom-data-visualizations-with-datadog-ui-apps-1d863018670b?source=collection_archive---------9-----------------------#2022-02-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b947" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在Datadog中创建自定义GeoMap小部件</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/29411badea7a4a9b1934918435106ff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dSq4nbmTzlezWYznv6I86Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一个带有自定义部件的仪表板——来源:作者</p></figure><p id="2179" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文是由两部分组成的博客系列的第二部分。 <a class="ae ls" rel="noopener ugc nofollow" target="_blank" href="/a-tale-of-two-engineers-discovering-the-crystal-programming-language-104b1fdbe525"> <em class="lr">在第一部分中，</em> </a> <em class="lr">我们介绍了Crystal，一种提供C/C++性能和Ruby可读性的编程语言。我们使用Crystal创建了一个代理服务器，用于检索与IP地址相关的地理位置坐标。在第二部分中，我们将了解如何利用Datadog应用程序来创建自定义的Geomap。</em></p><p id="0de1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要阅读这篇博文，您需要一些编程和监控的基础知识。<strong class="kx ir">data dog的知识可能有用，但不是必需的</strong>。我们将创建的UI应用程序将使用React和TypeScript。我们将一起分析每个代码片段。</p><p id="6d91" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以在这个Github资源库上找到完整的<a class="ae ls" href="https://github.com/DataDog/apps/tree/master/examples/geomap" rel="noopener ugc nofollow" target="_blank">项目代码，并按照自述文件中的安装步骤进行操作。</a></p><p id="d274" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">在这篇文章的最后，您将拥有一个自定义的Geomap小部件，显示与地理坐标</strong>相关的标记，换句话说就是纬度和经度。借助UI应用程序，您还可以在Datadog中创建自己的自定义小部件，并监听与SDK上下文切换相关的事件。</p><p id="50d3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们开始吧！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="7bc8" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">这一切都始于客户的痛点…</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/f7236a801a78938bec53daa13e510111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bac71Tl5-qttLKdqt-oFkQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这一系列的两篇博客文章从一个客户的问题开始</p></figure><p id="02b4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们的故事从一个客户和一个功能请求开始:<strong class="kx ir">这个客户想要在Geomap小部件上显示来自Datadog审计日志的数据</strong>。对于不了解Datadog及其特性的新手来说，这是定义的时刻，因为术语审计日志或仪表板小部件不一定会说话。所以还是一步步来吧！</p><p id="3a5d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">仪表板是Datadog的基本工具之一:它们允许您显示、跟踪和跟踪关键数据，以监控基础设施的健康状况</strong>。每个仪表板都由小部件组成。您有分发小部件、事件流小部件、热图小部件，还有geomaps小部件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/fda46765075a6a3bf86f938761d62290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ah3Kw9Q-ZWFDlhtpjzSLRQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一个与CPU利用率相关的主机映射小部件——来源:<a class="ae ls" href="https://docs.datadoghq.com/dashboards/widgets/hostmap/" rel="noopener ugc nofollow" target="_blank">https://docs.datadoghq.com/dashboards/widgets/hostmap/</a></p></figure><p id="0306" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们来看看<a class="ae ls" href="https://docs.datadoghq.com/account_management/audit_logs/" rel="noopener ugc nofollow" target="_blank">审计日志</a>。<strong class="kx ir">审计日志让你知道谁在你的组织中使用Datadog，以及如何使用</strong>。例如，借助审计日志，您将能够知道谁修改了一个重要的仪表板或监视器，以及修改的原因。<strong class="kx ir">如果你熟悉AWS，审计日志可以和CloudTrail </strong>相比。使用审计日志，您将能够检索诸如执行的操作(毕竟它是一个日志)、事件的类型、状态以及执行该操作的用户的IP地址和电子邮件等信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/15212e52dfcedde6b6296c3d35242836.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IoEozCzBonZtBAz9HjJDOg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">审核我的个人Datadog帐户上的活动日志</p></figure><p id="7528" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就是定义，我告诉你会很快！<strong class="kx ir">您现在应该能够理解最初的陈述</strong>:“该客户希望在Geomap小部件上显示Datadog审计日志数据”。顺便说一句，你甚至应该指出已经有Geomap小部件了(因为我刚才提到了它们！)</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="b926" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">是的，已经有一个Geomap小部件</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/5a9205c481851ba98546cee86de7c08b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tpxB5ho0T-Aag8Wn83e2NQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">现有的geomap widget-source:<a class="ae ls" href="https://docs.datadoghq.com/dashboards/widgets/geomap/" rel="noopener ugc nofollow" target="_blank">https://docs.datadoghq.com/dashboards/widgets/geomap/</a></p></figure><p id="da81" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">那么现有的Geomap小工具有什么问题呢？服务和数据不兼容！</p><p id="5b39" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">事实上，<strong class="kx ir">要使用geomap小部件，您需要真正的用户监控服务，或者RUM作为它的昵称</strong>。该服务为您提供了对用户活动和体验的实时端到端可见性。换句话说，多亏了RUM，您将能够监控网页的性能、错误管理和产品的使用。<strong class="kx ir"> RUM在“客户端”工作，即浏览器和iOS或Android应用</strong>。要显示这个geomap小部件，您还需要精确的数据:国家的ISO代码；该ISO必须对应于alpha-2 ISO格式。</p><p id="80a1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">问题是在我们的例子中，客户想要使用另一个服务:审计日志</strong>。此外，客户希望从他们的IP地址中获得用户的纬度和经度。这个地理位置将会显示在地理地图上。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="934b" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">基于IP地址检索地理信息，并在地图上显示这些信息</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/68875497de78ef09693376c16a93d177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FDyjSVFmyJAg5rXbXsZQsA.png"/></div></div></figure><p id="9214" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您还没有这样做，您可以<a class="ae ls" href="https://github.com/DataDog/apps" rel="noopener ugc nofollow" target="_blank">从这个Github库</a>克隆这个项目，并使用Docker和docker-compose启动它。请注意，您将需要一个带有API密钥和应用程序密钥的Datadog帐户。该项目包含三个文件夹:</p><ul class=""><li id="30a4" class="mx my iq kx b ky kz lb lc le mz li na lm nb lq nc nd ne nf bi translated">对应于我们在水晶中的代理。如果你想回到这个话题，<a class="ae ls" rel="noopener ugc nofollow" target="_blank" href="/a-tale-of-two-engineers-discovering-the-crystal-programming-language-104b1fdbe525">欢迎回到这篇博文</a>。这个代理将在8080上运行。</li><li id="9f2c" class="mx my iq kx b ky nk lb nl le nm li nn lm no lq nc nd ne nf bi translated"><code class="fe ng nh ni nj b">datadog-app</code>，我们的Datadog应用程序，其中包含我们的自定义小部件。该应用程序将在端口3000上运行。</li><li id="d307" class="mx my iq kx b ky nk lb nl le nm li nn lm no lq nc nd ne nf bi translated"><code class="fe ng nh ni nj b">setup</code>，这是一套安装脚本。这不仅会创建并配置您的Datadog应用程序，还会创建一个包含小部件的仪表板。</li></ul><p id="6f53" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以用这个CURL请求测试代理:</p><pre class="kg kh ki kj gt np nj nq nr aw ns bi"><span id="99e6" class="nt mb iq nj b gy nu nv l nw nx">curl --location --request GET 'http://localhost:8080/json?ip=8.8.8.8'</span></pre><p id="753b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是代理返回的内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="1bd9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面的gif向你展示了这个项目的实际情况。左侧是传统的Datadog小部件:两个表和一个时间序列。右边部分是我们的Datadog应用程序。<strong class="kx ir">目测两者没有区别</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/680b1831f178f955b5b5937f5e4cf4f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*IMNyWvZ9AsayPi5Knbgv5A.gif"/></div></div></figure><p id="579f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">为了改变地图和标记的位置，我们通过模板变量</strong>。这对于过滤仪表板的一个或多个小部件非常有用。这里，我们在用户的电子邮件和IP地址上使用模板变量。然后，UI Apps客户端检索这些数据，并将其注入到Geomap小部件中。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="7e9e" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">构建自定义Geomap微件</h1><p id="1782" class="pw-post-body-paragraph kv kw iq kx b ky ob jr la lb oc ju ld le od lg lh li oe lk ll lm of lo lp lq ij bi translated">如果你还不清楚Datadog中的UI应用是什么，你应该知道这是一个功能<strong class="kx ir">允许开发者通过定制的小部件、模块和侧面板</strong>来扩展Datadog的原生功能。换句话说，这意味着您现在可以直接在仪表板中运行任意JavaScript代码。<strong class="kx ir">假设您想要一个Datadog不支持的数据可视化，</strong>例如Geomap<strong class="kx ir">，您可以编写一个应用程序将该功能扩展到Datadog </strong>。</p><p id="dd3f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要了解如何初始化Datadog应用程序，我邀请您查看官方文档或我的另一篇文章<a class="ae ls" rel="noopener ugc nofollow" target="_blank" href="/inspect-and-delete-redis-keys-with-a-datadog-app-6e623e2695a6">，这篇文章致力于在Redis </a>上创建Datadog应用程序。<strong class="kx ir">这两个资源不仅能让你创建第一个Datadog应用程序，还能让你创建第一个定制小部件和第一个模态</strong>。事实上，这里的想法是集中在如何显示geomap和它上面的标记。可以打开文件:<a class="ae ls" href="https://github.com/DataDog/apps/blob/master/examples/geomap/datadog-app/src/widget/GeoMap/index.tsx" rel="noopener ugc nofollow" target="_blank">GeoMap/data dog-app/src/widget/GeoMap/index . tsx</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="e14c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你懂TypeScript或者JavaScript，你应该已经熟悉这部分了。请注意，应用程序的SDK是通过<code class="fe ng nh ni nj b">ui-extensions-sdk</code>库导入并初始化的。此外，<code class="fe ng nh ni nj b">ui-extensions-react</code>库用于检索<code class="fe ng nh ni nj b">useTemplateVariables</code>钩子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="e515" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后我们将定义我们的钩子。第一个是地理坐标。<strong class="kx ir">由于小部件是用TypeScript编写的，我们需要创建一个接口</strong>。第二个钩子来自上面导入的库，它允许我们从客户机检索IP地址。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="1d3c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我们将为我们的应用程序添加一个生命周期。<strong class="kx ir">每次ip地址状态会发生变化，我们都会进行API调用来检索地理坐标</strong>。这些数据将通过setLocation方法集成到本地状态。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="0e98" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，如果我们有纬度和经度，我们显示带有GPS坐标和标记的地图。否则，我们不显示任何内容。在不到60行代码中，我们能够创建一个定制的Geomap！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="618d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">既然您已经看到了如何创建一个定制的数据可视化，下一步将会看到如何通过将它提交给Datadog来将它分发给尽可能多的人。好消息是我正在写一篇关于它的博客！无论如何，我希望你喜欢这两个系列的文章，我会看到你未来的冒险(与小晶体)。</p></div></div>    
</body>
</html>