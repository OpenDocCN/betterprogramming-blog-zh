<html>
<head>
<title>4 Steps to Dockerize Your Next.js App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Next.js应用程序分类的4个步骤</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/4-steps-to-dockerize-your-next-js-app-cfa8a54881af?source=collection_archive---------6-----------------------#2021-02-12">https://betterprogramming.pub/4-steps-to-dockerize-your-next-js-app-cfa8a54881af?source=collection_archive---------6-----------------------#2021-02-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b96e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">瞬间将你的Next.js应用容器化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1b94957584a5f4fa8e4ee9365896a0ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kQQ9z8WrS_ptso-A"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">凯瑟琳·麦科马克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="d9f7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么是码头集装箱？</h1><p id="831e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">容器是软件的一个单元，它帮助我们紧凑地打包代码和依赖关系。这样做的主要优势在于，它有助于我们的应用在各种环境中高效可靠地运行。</p><p id="d1cc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当我们打包代码和依赖项时，会创建一个Docker映像。这个映像包含了我们的应用程序运行所需的一切，包括系统工具和库。</p><p id="733a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当我们构建并运行这些映像时，它们就变成了Docker容器。再次强调，这样做的巨大优势是帮助我们的软件以完全相同的方式运行，无论您使用的是什么操作系统——是Linux还是Windows等。Docker容器帮助我们提供的这种一致性至关重要，尤其是在为生产部署应用程序时。</p><p id="93be" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最近，容器化应用程序在很大程度上取代了通过虚拟机(VM)运行应用程序的传统方法。虚拟机需要底层操作系统的完整副本才能运行，您可以想象系统的库、工具等的总体副本需要多少空间。会消耗！</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="5e4e" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">我们开始吧</h1><p id="cc3b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">既然我们已经讨论了容器的概要，让我们开始容器化我们的Next.js应用程序。</p><h2 id="5ac9" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">1.创建项目</h2><p id="5d3b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">出于演示的目的，我们将使用以下命令创建一个全新的Next.js项目:</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="ac71" class="ne la it nr b gy nv nw l nx ny">yarn create next-app</span></pre><p id="a106" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">按照提示完成创建新的Next.js项目。</p><p id="13f4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们通过在项目目录中运行<code class="fe nz oa ob nr b">yarn dev</code>来测试一切运行正常。</p><h2 id="013a" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">2.添加您的docker文件</h2><p id="ace9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在，我们添加docker文件。在项目目录的根目录下，将下面的代码片段添加到一个名为— <code class="fe nz oa ob nr b">Dockerfile</code>的文件中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="acf0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Dockerfile文件非常简单明了。在代码序列中，我们是:</p><ol class=""><li id="1c86" class="oe of it lt b lu mn lx mo ma og me oh mi oi mm oj ok ol om bi translated"><code class="fe nz oa ob nr b">FROM node:12</code>:使用Node.js 12.0镜像。您可以修改版本以使用适合您应用的版本，或者使用<code class="fe nz oa ob nr b">node:latest</code>获得最新版本。这将从Docker Hub中选取一个图像，Docker Hub是Docker图像的全球存储库。我们选择的图片基于Ubuntu。</li><li id="0eff" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated">我们用<code class="fe nz oa ob nr b">mkdir</code>命令在路径<code class="fe nz oa ob nr b">/usr/src/app</code>下创建一个工作目录(如果它还不存在的话)。这有助于我们设置在下面的命令中将会发生什么。</li><li id="2493" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated">我们将所有必需的包文件，即<code class="fe nz oa ob nr b">package.json</code>和<code class="fe nz oa ob nr b">yarn.lock</code>复制到工作目录，并在容器中安装依赖项。</li><li id="2ae7" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated">我们将剩余的源文件复制到工作目录中。</li><li id="d3e0" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated">我们构建应用程序，并通过在容器上打开端口<code class="fe nz oa ob nr b">3000</code>来公开它。</li><li id="0556" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated">我们使用命令<code class="fe nz oa ob nr b">yarn dev</code>运行应用程序。你可以把它改成<code class="fe nz oa ob nr b">yarn start</code>或者任何适合你在<code class="fe nz oa ob nr b">package.json</code>中定义的脚本的名字。</li></ol><p id="9a68" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">注意:</strong>如果您使用<code class="fe nz oa ob nr b">npm</code>而不是<code class="fe nz oa ob nr b">yarn</code>，只需更新各自的命令(例如用<code class="fe nz oa ob nr b">npm install</code>而不是<code class="fe nz oa ob nr b">yarn install</code>)。</p><h2 id="ca36" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">3.添加Docker撰写</h2><p id="19de" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Docker Compose是一个运行多容器应用程序的工具。我们可以添加这个来协调我们的应用程序和Docker引擎。</p><p id="3a19" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们将下面的代码片段作为<code class="fe nz oa ob nr b">docker-compose.yml</code>添加到项目目录的根目录下。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="ca0f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该代码片段将容器的端口<code class="fe nz oa ob nr b">3000</code>暴露给外界，并指定使用哪个Dockerfile文件。<code class="fe nz oa ob nr b">volumes</code>部分有助于启用Next.js应用程序的热重装，尤其是出于开发目的。</p><h2 id="828b" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">4.运行应用程序</h2><p id="3fa9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要运行该应用程序，我们在项目目录的根目录下使用以下命令:</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="b666" class="ne la it nr b gy nv nw l nx ny">docker-compose up -d --build</span></pre><p id="62ee" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该命令构建映像，并以分离模式(即在后台)将其作为容器启动。</p><p id="a17b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要查看正在运行的容器，请使用:</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="c794" class="ne la it nr b gy nv nw l nx ny">docker ps -a</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/7eb551db4dd42f734af7ec88e952fde2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XeHmH94R0cL8FKkUE2zkIA.png"/></div></div></figure><p id="fb67" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要查看容器的码头，请使用:</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="1be3" class="ne la it nr b gy nv nw l nx ny">docker logs -f &lt;container_id&gt;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/3e0d0af07d6469823159d43ce76f49d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qIcv9JI-wx76SXFTtEE1dg.png"/></div></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="fe13" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">这是所有的乡亲</h1><p id="cbb3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这就对了。将Next.js应用程序容器化只需要四个步骤。</p><p id="7229" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">感谢阅读。黑客快乐！</p></div></div>    
</body>
</html>