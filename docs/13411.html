<html>
<head>
<title>Text Formatting in iOS and SwiftUI With AttributedString</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有AttributedString的iOS和SwiftUI中的文本格式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/text-formatting-in-ios-and-swift-with-attributedstring-e821536fbdec?source=collection_archive---------11-----------------------#2022-08-24">https://betterprogramming.pub/text-formatting-in-ios-and-swift-with-attributedstring-e821536fbdec?source=collection_archive---------11-----------------------#2022-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="5d76" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">斯威夫特伊</h2><div class=""/><div class=""><h2 id="730b" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">了解如何在iOS上对文本进行加粗、斜体、高亮显示等操作</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/165ea6be59901734e87485e3bed8e97c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sk1_pNB-PN16Vvv3"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">桑迪·米勒在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="fc89" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们的iOS屏幕上通常会有多个不同属性的标签。有的会加粗，用大字号；我们称这些标题为我们的屏幕。有些字体会更小，可能是灰色的，比普通字体更薄(或更浅)；我们称之为字幕。这些属性适用于单个标签中的所有文本。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi me"><img src="../Images/ee4efc24f8610915129dceb75ab55fcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*I34zWWqvFb-fGuLV7lnLpg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">一个屏幕中多个标签的示例</p></figure><p id="98ec" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你想<strong class="lk jd">强调文本中间的一个单词</strong>(使<strong class="lk jd">加粗</strong>)该怎么办？我们应该创建多个标签吗？每一种都有自己的属性并一起使用？如果我们想将整个链接中的一段文字变成一个链接，以便在我们的应用程序中打开网络浏览器，该怎么办？我们应该开始把按钮和标签放在一起使用吗？</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi me"><img src="../Images/bf922e01a5b6c7c3f947e4ddd46b3f77.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*agPAbEXs-2FW2X-xykm3eg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">带链接、强调和斜体的文本示例</p></figure><p id="78a9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以想象，这可能会变得非常复杂。那么有没有更好的办法呢？是的有！AttributedStrings 允许我们在一个标签中的一段文本上做所有的和更多的事情。</p><p id="496c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本教程中，我将向您展示如何在<a class="ae lh" href="https://developer.apple.com/documentation/swiftui/" rel="noopener ugc nofollow" target="_blank"> SwiftUI </a>中属性化字符串并在标签(文本视图)上显示它们。我假设您熟悉Swift和<a class="ae lh" href="https://developer.apple.com/documentation/swiftui/" rel="noopener ugc nofollow" target="_blank"> SwiftUI </a>的基础知识。</p><p id="0af3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="mf">我在本文中使用了Swift 5.6.1和Xcode 13.4.1。</em></p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="7f1f" class="mn mo it bd mp mq mr ms mt mu mv mw mx ki my kj mz kl na km nb ko nc kp nd ne bi translated">如何使用AttributedString格式化和显示格式化文本</h1><p id="0fc9" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">在本节中，我们将从下载一个已经存在的iOS应用程序项目开始。该项目是一个简单的应用程序，有一段需要格式化的文本。然后，我们将格式化文本，并使用<a class="ae lh" href="https://developer.apple.com/documentation/foundation/attributedstring" rel="noopener ugc nofollow" target="_blank"> AttributedStrings </a>添加属性，并显示这些属性。</p><p id="b42d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是我们将要采取的步骤:</p><ol class=""><li id="e5c6" class="nk nl it lk b ll lm lo lp lr nm lv nn lz no md np nq nr ns bi translated">下载入门包</li><li id="fada" class="nk nl it lk b ll nt lo nu lr nv lv nw lz nx md np nq nr ns bi translated">使用<a class="ae lh" href="https://developer.apple.com/documentation/foundation/attributedstring" rel="noopener ugc nofollow" target="_blank">属性字符串</a>显示字符串</li><li id="c1cc" class="nk nl it lk b ll nt lo nu lr nv lv nw lz nx md np nq nr ns bi translated">将字体属性添加到<a class="ae lh" href="https://developer.apple.com/documentation/foundation/attributedstring" rel="noopener ugc nofollow" target="_blank">属性字符串</a></li><li id="e02d" class="nk nl it lk b ll nt lo nu lr nv lv nw lz nx md np nq nr ns bi translated">将链接属性添加到<a class="ae lh" href="https://developer.apple.com/documentation/foundation/attributedstring" rel="noopener ugc nofollow" target="_blank">属性字符串</a></li></ol><p id="825a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们开始吧！</p><h1 id="1ca5" class="mn mo it bd mp mq ny ms mt mu nz mw mx ki oa kj mz kl ob km nb ko oc kp nd ne bi translated">1.下载入门包</h1><p id="a92e" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">在本教程中，我们将使用一个现有的iOS应用程序项目来举例说明如何使用<a class="ae lh" href="https://developer.apple.com/documentation/foundation/attributedstring" rel="noopener ugc nofollow" target="_blank">attributed string</a>。让我们下载一个已经存在的iOS应用程序项目。打开终端并运行以下命令:</p><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="e020" class="oi mo it oe b gy oj ok l ol om">cd $HOME<br/>curl <a class="ae lh" href="https://github.com/anuragajwani/attributed_string_intro/archive/starter.zip" rel="noopener ugc nofollow" target="_blank">https://github.com/anuragajwani/attributed_string_intro/archive/starter.zip</a> -L -o starter.zip -s<br/>unzip -q starter.zip<br/>cd attributed_string_intro-starter/AttributedStringTut<br/>open -a Xcode AttributedStringTut.xcodeproj</span></pre><p id="eb37" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在<code class="fe on oo op oe b">ContentView.swift</code>运行应用程序或预览。这是应用程序的当前状态:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/3a922c084288368e9d71cbb6ab484402.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*oYopwF8REvDq8jiSGQhmHw.png"/></div></figure><p id="a382" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意，像“这个句子是粗体的”这样的句子目前不会以粗体显示。我们将通过本教程解决这个问题。</p><h1 id="32fc" class="mn mo it bd mp mq ny ms mt mu nz mw mx ki oa kj mz kl ob km nb ko oc kp nd ne bi translated">2.使用AttributedString显示字符串</h1><p id="d2ef" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">在这一步，我们将把显示的文本从一个简单的<a class="ae lh" href="https://developer.apple.com/documentation/swift/string" rel="noopener ugc nofollow" target="_blank">字符串</a>转换成一个<a class="ae lh" href="https://developer.apple.com/documentation/foundation/attributedsubstring" rel="noopener ugc nofollow" target="_blank">属性字符串</a>。打开<code class="fe on oo op oe b">ContentView.swift</code>。将<code class="fe on oo op oe b">myText</code>房产替换为:</p><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="a37e" class="oi mo it oe b gy oj ok l ol om"><strong class="oe jd">let</strong> myText: AttributedString = {<br/>    <strong class="oe jd">let</strong> text = """<br/>               This text is to exemplify how NSAttributedStrings work.<br/>               This sentence is bold.<br/>               This sentence is italicised.<br/>               This sentence will be of a larger font size than the rest of the text.<br/>               This sentence is a link to Google.<br/>               """<br/>    <strong class="oe jd">var </strong>attributedString = AttributedString(text)<br/>    <strong class="oe jd">return </strong>attributedString<br/>}()</span></pre><p id="baf9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上面我们已经将<code class="fe on oo op oe b">myText</code>的房产类型从<code class="fe on oo op oe b">String</code>变更为<code class="fe on oo op oe b">AttributedString</code>。在<code class="fe on oo op oe b">ContentView</code>初始化时，将执行<a class="ae lh" href="https://docs.swift.org/swift-book/LanguageGuide/Closures.html" rel="noopener ugc nofollow" target="_blank">关闭</a>，结果将存储在<code class="fe on oo op oe b">myText</code>属性中。</p><p id="2b34" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">运行应用程序或重新运行预览，您将不会看到应用程序的任何视觉变化。这是因为我们已经将我们的<a class="ae lh" href="https://developer.apple.com/documentation/swift/string" rel="noopener ugc nofollow" target="_blank">字符串</a>包装在AttributedString中，但是我们没有为它提供任何属性。我们将在下一步中这样做。</p><p id="bea1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">注意</strong>我们不需要在<code class="fe on oo op oe b">ContentView</code>内对<code class="fe on oo op oe b">body</code>做任何修改。<a class="ae lh" href="https://developer.apple.com/documentation/swiftui/" rel="noopener ugc nofollow" target="_blank"> SwiftUI </a>中的<a class="ae lh" href="https://developer.apple.com/documentation/swiftui/text" rel="noopener ugc nofollow" target="_blank">文本</a>视图接受<a class="ae lh" href="https://developer.apple.com/documentation/swift/string" rel="noopener ugc nofollow" target="_blank">字符串</a>和<a class="ae lh" href="https://developer.apple.com/documentation/foundation/attributedstring" rel="noopener ugc nofollow" target="_blank">属性字符串</a>而无需对代码进行任何修改。</p><h1 id="43ad" class="mn mo it bd mp mq ny ms mt mu nz mw mx ki oa kj mz kl ob km nb ko oc kp nd ne bi translated">3.向AttributedString添加字体属性</h1><p id="650e" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">在这一步中，我们将在需要的地方给我们的<code class="fe on oo op oe b">myText</code>属性添加粗体、斜体和大字体属性。让我们从课文的第二句开始。我们会把这句话加粗。</p><p id="147d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了使第二个句子加粗，我们需要知道句子开始的索引和句子结束的索引。一种方法是在<a class="ae lh" href="https://developer.apple.com/documentation/foundation/attributedstring" rel="noopener ugc nofollow" target="_blank">属性字符串</a>中使用<code class="fe on oo op oe b"><a class="ae lh" href="https://developer.apple.com/documentation/foundation/attributedstring/3813128-range" rel="noopener ugc nofollow" target="_blank">range(of: _)</a></code>函数。在行<code class="fe on oo op oe b"><strong class="lk jd">var </strong>attributedString = AttributedString(text)</code>和<code class="fe on oo op oe b"><strong class="lk jd">return</strong> attributedString</code>之间添加以下行:</p><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="d327" class="oi mo it oe b gy oj ok l ol om"><strong class="oe jd">let </strong>rangeOfBold = attributedString.range(of: "This sentence is bold.")!</span></pre><p id="1e08" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在“应用粗体属性”旁边，在上一行之后添加以下行:</p><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="5afe" class="oi mo it oe b gy oj ok l ol om">attributedString[rangeOfBold].font = .boldSystemFont(ofSize: 17)</span></pre><p id="eea1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">重新运行应用程序或预览，你会注意到第二句现在是粗体。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/d24a03e52b3b29ea83fff53cc63067ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*MdlHCup4ciE1zUp8HbBbCA.png"/></div></figure><p id="bd08" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们现在将对斜体和更大的字体属性重复这个过程。在应用粗体属性的行之后添加以下行:</p><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="ae2b" class="oi mo it oe b gy oj ok l ol om"><strong class="oe jd">let</strong> rangeOfItalic = attributedString.range(of: "This sentence is italicised.")!<br/>attributedString[rangeOfItalic].font = .italicSystemFont(ofSize: 17)</span><span id="6461" class="oi mo it oe b gy or ok l ol om"><strong class="oe jd">let</strong> rangeOfLargeFont = attributedString.range(of: "This sentence will be of a larger font size than the rest of the text.")!<br/>attributedString[rangeOfLargeFont].font = .systemFont(ofSize: 23)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/7b3b32cf55aa132c6a1d70554c815a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*utxLRZimjmJVSeDYFe2oiQ.png"/></div></figure><h1 id="3d52" class="mn mo it bd mp mq ny ms mt mu nz mw mx ki oa kj mz kl ob km nb ko oc kp nd ne bi translated">4.向AttributedString添加链接属性</h1><p id="bdbc" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">在这一节中，我们将只链接文本的最后一句话，用Google打开浏览器。</p><p id="7501" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">应用大字体大小属性后，添加以下行:</p><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="55f2" class="oi mo it oe b gy oj ok l ol om"><strong class="oe jd">let</strong> rangeOfLink = attributedString.range(of: "This sentence is a link to Google.")!<br/>attributedString[rangeOfLink].link = URL(string: "https://www.google.com")</span></pre><p id="26dc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上面我们做了类似的操作，当我们应用粗体，斜体和大字体时。我们首先找到想要应用链接的文本的<a class="ae lh" href="https://developer.apple.com/documentation/swift/range" rel="noopener ugc nofollow" target="_blank">范围</a>，然后为其设置<a class="ae lh" href="https://developer.apple.com/documentation/foundation/attributescopes/foundationattributes/3764633-link" rel="noopener ugc nofollow" target="_blank">链接</a>属性。链接属性接受一个<a class="ae lh" href="https://developer.apple.com/documentation/foundation/url" rel="noopener ugc nofollow" target="_blank"> URL </a>值。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/938bd00c2d03d472e5d1904796555321.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*dl30CbzL518YLfRzbNhyLw.png"/></div></figure><p id="dc8d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">重新运行应用程序，点击蓝色文本。它将在Safari中打开Google。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi os"><img src="../Images/3bf23b780450853cbc8e8e8ea7839b32.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/1*l-u07Q_jpYFI08Wa2mkv6w.gif"/></div></figure></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="210c" class="mn mo it bd mp mq mr ms mt mu mv mw mx ki my kj mz kl na km nb ko nc kp nd ne bi translated">摘要</h1><p id="227c" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">在这篇文章中，我们了解到:</p><ul class=""><li id="73b1" class="nk nl it lk b ll lm lo lp lr nm lv nn lz no md ot nq nr ns bi translated">如何将不同的属性应用于同一标签中文本的不同部分</li></ul><h1 id="7954" class="mn mo it bd mp mq ny ms mt mu nz mw mx ki oa kj mz kl ob km nb ko oc kp nd ne bi translated">最后的想法</h1><p id="f952" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">你可以在我的报告中找到本教程的源代码:</p><div class="ou ov gp gr ow ox"><a href="https://github.com/anuragajwani/attributed_string_intro" rel="noopener  ugc nofollow" target="_blank"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd jd gy z fp pc fr fs pd fu fw jc bi translated">GitHub-anuragajwani/attributed _ string _ intro</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">github.com</p></div></div><div class="pg l"><div class="ph l pi pj pk pg pl lb ox"/></div></div></a></div><p id="0f0d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你也可以在苹果的文档中找到适用的<a class="ae lh" href="https://developer.apple.com/documentation/foundation/attributescopes" rel="noopener ugc nofollow" target="_blank">属性的完整列表。</a></p><p id="2793" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这篇文章中，我向你展示了<code class="fe on oo op oe b"><a class="ae lh" href="https://developer.apple.com/documentation/foundation/attributedstring" rel="noopener ugc nofollow" target="_blank">AttributedStrings</a></code>允许我们简化<a class="ae lh" href="https://developer.apple.com/documentation/swift/string" rel="noopener ugc nofollow" target="_blank">字符串</a>不同部分的属性。但是，如果您不知道需要归属的确切文本，该怎么办呢？例如，你从网上检索一段可能是HTML格式的文本；或者可能是一段降价格式的文本。在这些情况下，苹果会为你提供保障。我将在以后的文章中讨论这些内容。</p><p id="9863" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你在文本上使用自定义标记，那么你可能需要使用<a class="ae lh" href="https://en.wikipedia.org/wiki/Regular_expression" rel="noopener ugc nofollow" target="_blank">正则表达式</a>。这将允许您确定需要标记的文本范围，并应用必要的属性。我将在以后的帖子中介绍Swift中的<a class="ae lh" href="https://en.wikipedia.org/wiki/Regular_expression" rel="noopener ugc nofollow" target="_blank">正则表达式</a>。</p><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="46ef" class="oi mo it oe b gy oj ok l ol om"><strong class="oe jd">Want to Connect?</strong></span><span id="7212" class="oi mo it oe b gy or ok l ol om">For more on iOS development follow me on <a class="ae lh" href="https://twitter.com/anuragajwani?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank">Twitter</a>!</span></pre></div></div>    
</body>
</html>