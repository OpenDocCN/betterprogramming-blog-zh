<html>
<head>
<title>In Python, Don’t Look Before You Leap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python中，不要三思而后行</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/in-python-dont-look-before-you-leap-cff250881930?source=collection_archive---------4-----------------------#2021-02-16">https://betterprogramming.pub/in-python-dont-look-before-you-leap-cff250881930?source=collection_archive---------4-----------------------#2021-02-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5159" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于更干净更好的Python代码的建议</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3422b74070fc86f45fe4bea3bbb491a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XG44Inz4x7kFgmCw"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@cjtagupa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Cris Tagupa </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="f0c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将看看程序员用来处理一段代码可能失败的两种常见的编码风格:“三思而后行”(LBYL)和“请求原谅比请求许可容易”(EAFP)。</p><p id="9d06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不熟悉LBYL和EAFP的辩论，那也没关系。我们将很快讨论这两个问题。</p><p id="fe11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">理解这些范例的细微差别将有助于您编写更干净、更高效的代码。我们将从Python的角度来看这个主题，但是一些概念也适用于其他语言。</p><p id="596a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="239a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">三思而后行</h1><p id="4216" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">LBYL是一种传统的编程风格，在实际运行之前，我们会检查一段代码是否能够工作。</p><p id="d0d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">换句话说，如果一段代码需要一些先决条件，我们就放置条件语句，这样代码只有在所有先决条件都满足的情况下才会运行。</p><p id="b8c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，我们检查键(<code class="fe mz na nb nc b">name</code>、<code class="fe mz na nb nc b">age</code>和<code class="fe mz na nb nc b">gender</code>)是否存在，然后打印它们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5097" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">请求原谅比请求允许更容易</h1><p id="97d6" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">术语EAFP是由COBOL语言的发明者少将·格雷斯·默里·霍珀创造的。在这种方法中，我们简单地运行我们的代码，希望有最好的结果，同时准备好在代码失败时处理任何错误。</p><p id="3a75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，这意味着将我们的代码封装在<code class="fe mz na nb nc b">try-except</code>块中，并处理任何可能发生的异常。</p><p id="caf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，我们简单地打印字典的内容，不做任何检查。如果一个密钥丢失了，那么<code class="fe mz na nb nc b">except</code>模块应该处理它。请注意这与上例中的LBYL方法有何不同:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b2eb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">那么，哪个更好呢？</h1><p id="5739" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">根据经验，EAFP被认为更Pythonic化，在大多数情况下应该是首选。以下是EAFP比LBYL更受欢迎的一些原因。</p><h2 id="a7f4" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">清晰易读</h2><p id="86d1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">EAFP让“快乐之路”更加清晰易读。“显式比隐式好”是Python的一个重要信条。在上面的例子中，我们期望在大多数情况下，这些键会出现在字典中，这是EAFP代码所建议的。然而，LBYL电码强调钥匙丢失的罕见情况。</p><h2 id="f181" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">更好的性能</h2><p id="8f2c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">EAFP通常比LBYL快——尤其是需要大量检查的时候。考虑上面的例子。在LBYL方法中，我们进行三次检查来查看字典中是否存在这些键。调用字典三次既费时又重复。EAFP更快，因为它直接打印字典。</p><p id="68f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，异常确实比<code class="fe mz na nb nc b">if</code>语句更昂贵。但是异常只被触发几次，而<code class="fe mz na nb nc b">if</code>语句总是被执行。此外，您应该注意到，与Java或C++相比，Python中的异常操作成本更低。所以对控制流使用异常是没问题的。</p><h2 id="c214" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">防止竞态条件</h2><p id="02d4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最重要的是，EAFP帮助我们避免了比赛条件。当多个线程试图访问一个对象时，就会出现争用情况。考虑两个线程试图访问LBYL场景中的<code class="fe mz na nb nc b">person</code>字典。如果其中一个线程从字典中删除了一个键，而第二个线程通过了检查，我们将在执行print语句时得到一个异常。</p><p id="8f4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在EAFP，我们可以放心，不管是什么情况，所有的异常都将由<code class="fe mz na nb nc b">except</code>块处理。</p><p id="39e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，LBYL有什么理由吗？</p><p id="c46d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，在某些情况下，使用LBYL确实更有意义。</p><h2 id="973f" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">复杂的副作用</h2><p id="44ad" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果你的函数有难以消除的副作用，使用EAFP可能是个坏主意。假设您开始向一个文件写入数据，并在做了一些更改后得到一个异常。试图恢复<code class="fe mz na nb nc b">except</code>块中的更改可能会很棘手。利用LBYL来提前停止手术会让你的生活轻松很多。</p><h2 id="4c5f" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">太多的例外</h2><p id="a585" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您希望在代码中的多个点抛出异常，使用EAFP可能会降低您跟踪代码实际失败位置的能力。理想情况下，您应该重构您的代码，以缩小<code class="fe mz na nb nc b">try-except</code>块，并继续使用EAFP。如果你不能，就和LBYL一起去。</p><p id="9dd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，这种争论仍然是开放的，一些开发人员只是喜欢其中一种风格。如果你不同意，我很想听听你的想法。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="321e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">资源</h1><ul class=""><li id="48ef" class="nr ns it lb b lc mu lf mv li nt lm nu lq nv lu nw nx ny nz bi translated">YouTube上的科里·斯查费</li><li id="6e5f" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><a class="ae ky" href="https://devblogs.microsoft.com/python/idiomatic-python-eafp-versus-lbyl/" rel="noopener ugc nofollow" target="_blank">“惯用Python: EAFP对LBYL”，作者Brett Cannon </a>(微软博客)</li></ul></div></div>    
</body>
</html>