<html>
<head>
<title>How to Have Branch Specific .gitignore Files With Husky/git-hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何拥有分支机构？用Husky/git-hooks忽略文件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-have-branch-specific-gitignore-files-with-husky-git-hooks-4ca04d7e78cf?source=collection_archive---------8-----------------------#2022-05-26">https://betterprogramming.pub/how-to-have-branch-specific-gitignore-files-with-husky-git-hooks-4ca04d7e78cf?source=collection_archive---------8-----------------------#2022-05-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3ec0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">掌握Git</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/642fda77af6e375bd797e088b92db813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJjX-m1NdQpPI4bz27cJEA.jpeg"/></div></div></figure><h1 id="dd46" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">介绍</h1><p id="4428" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我敢肯定，几乎每个开发人员都遇到过<a class="ae mf" href="https://git-scm.com" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> Git </strong> </a> <em class="mg"> </em>并且你们中的大多数人可能对它又爱又恨。我记得当我第一次开始使用Git时，我非常讨厌它——它既不能像预期的那样工作，也不能(或不能)像预期的那样使用它。</p><p id="042f" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">从那以后很多事情都变了，而且不止一次，Git已经救了我的命！</p><p id="e76d" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">我们的团队正在维护一个相当大的<a class="ae mf" href="https://en.wikipedia.org/wiki/Monorepo" rel="noopener ugc nofollow" target="_blank"> Monorepo </a>，它有多个不同的暂存环境——全部通过<a class="ae mf" href="https://git-scm.com/docs/git-branch" rel="noopener ugc nofollow" target="_blank"> Git分支</a>控制。因此，我们需要<em class="mg">忽略</em>某些不属于我们正在推进的特定分支的代码。或者换句话说</p><blockquote class="mm mn mo"><p id="18d2" class="lj lk mg ll b lm mh jr lo lp mi ju lr mp mj lu lv mq mk ly lz mr ml mc md me ij bi translated">我们不想分支特定的<code class="fe ms mt mu mv b">.gitignore</code>文件</p></blockquote><p id="9410" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">我经常被问到我们是如何做到这一点的，最近在互联网上的研究表明，关于分支机构特定环境的信息和/或教程并不多。显然，有多种方法能够达到相同的结果，但是通过husky使用Git挂钩似乎是最快、最可靠的解决方案。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h1 id="bb39" class="kr ks iq bd kt ku nd kw kx ky ne la lb jw nf jx ld jz ng ka lf kc nh kd lh li bi translated">设置</h1><p id="69e5" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">此示例使用具有以下依赖关系的存储库:</p><ul class=""><li id="4fe4" class="ni nj iq ll b lm mh lp mi ls nk lw nl ma nm me nn no np nq bi translated"><a class="ae mf" href="https://yarnpkg.com/getting-started/install" rel="noopener ugc nofollow" target="_blank">纱版莓</a> <code class="fe ms mt mu mv b">v3.2.0</code></li><li id="78df" class="ni nj iq ll b lm nr lp ns ls nt lw nu ma nv me nn no np nq bi translated"><a class="ae mf" href="https://git-scm.com/downloads" rel="noopener ugc nofollow" target="_blank"> Git </a>版本<code class="fe ms mt mu mv b">2.34.1</code> <em class="mg">(全球安装或作为你的软件包的一部分)</em></li><li id="86a1" class="ni nj iq ll b lm nr lp ns ls nt lw nu ma nv me nn no np nq bi translated"><a class="ae mf" href="https://typicode.github.io/husky/" rel="noopener ugc nofollow" target="_blank"> husky </a> <code class="fe ms mt mu mv b">v8.0.1</code> <em class="mg">(快速设置</em><a class="ae mf" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank"><em class="mg">git-hooks</em></a><em class="mg">)</em></li></ul><p id="ac9c" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">我假设您熟悉Yarn，并且已经建立了一个存储库。此外，我假设您对Git有基本的了解——尤其是在提交方面，您应该知道如何创建分支。</p><h2 id="0503" class="nw ks iq bd kt nx ny dn kx nz oa dp lb ls ob oc ld lw od oe lf ma of og lh oh bi translated">1.安装husky</h2><p id="f53e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">设置<a class="ae mf" href="https://typicode.github.io/husky/#/?id=install" rel="noopener ugc nofollow" target="_blank">哈士奇</a>真的很简单，只需要几个步骤。显然，你可以只用Git钩子实现完全相同的行为，但是我发现husky是一个更快更简单的解决方案。</p><p id="e822" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">哈士奇配备了自动安装功能，运行良好，但我发现这并不是真正必要的。此外，它还创建了一个样本预提交挂钩，该挂钩(如果您使用Yarn)将阻止您提交到您刚刚安装了husky的分支。</p><p id="282f" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">我推荐手动安装，因为它非常简单，您可以完全控制每一个步骤以及Git挂钩的实际创建。</p><p id="7bac" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">为此，只需运行(确保您的项目在您的<code class="fe ms mt mu mv b">package.json</code>中设置为<code class="fe ms mt mu mv b">private: true</code>)</p><pre class="kg kh ki kj gt oi mv oj ok aw ol bi"><span id="a6a9" class="nw ks iq mv b gy om on l oo op">yarn add -D husky &amp;&amp; yarn husky install</span></pre><p id="2e8f" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">在您的项目根目录中。如果一切顺利，您将看到提示</p><blockquote class="mm mn mo"><p id="3064" class="lj lk mg ll b lm mh jr lo lp mi ju lr mp mj lu lv mq mk ly lz mr ml mc md me ij bi translated">husky —安装了Git挂钩</p></blockquote><p id="1948" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">还有一个文件夹<code class="fe ms mt mu mv b">.husky</code>在你的项目大纲里。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/ddacc21339a9953e69309b2c7437ae41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h6cGCJEallVisGL-jN_Oiw.png"/></div></div><p class="or os gj gh gi ot ou bd b be z dk translated">的。husky文件夹将包含相关的Git钩子和。gitignore文件。</p></figure><h2 id="1c30" class="nw ks iq bd kt nx ny dn kx nz oa dp lb ls ob oc ld lw od oe lf ma of og lh oh bi translated">2.通过husky创建一个Git挂钩</h2><p id="05ef" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">有一整个系列的Git挂钩<a class="ae mf" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank">可用，但由于我们对不同分支有不同的<code class="fe ms mt mu mv b">.gitignore</code>文件感兴趣，我们正在寻找后结帐挂钩。每当我们成功切换分支时，这个钩子就会被执行。为了让这个钩子工作，我们只需运行:</a></p><pre class="kg kh ki kj gt oi mv oj ok aw ol bi"><span id="9904" class="nw ks iq mv b gy om on l oo op">yarn husky add .husky/post-checkout 'echo "Hello Git Hook"'</span></pre><p id="b8cb" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">这将在你的<code class="fe ms mt mu mv b">.husky</code>文件夹中创建一个名为<code class="fe ms mt mu mv b">post-checkout</code>的文件。</p><p id="93bb" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">使用<code class="fe ms mt mu mv b">git add . &amp; git commit -m "Created post-checkout hook"</code>提交您刚刚做出的更改。</p><p id="3149" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">签出任何其他分支(如果您没有分支，您可能希望通过运行<code class="fe ms mt mu mv b">git checkout -b husky</code>来创建一个分支——任何分支名称都可以)并签回当前分支，您应该会看到</p><blockquote class="mm mn mo"><p id="113e" class="lj lk mg ll b lm mh jr lo lp mi ju lr mp mj lu lv mq mk ly lz mr ml mc md me ij bi translated">你好Git Hook</p></blockquote><p id="cfe8" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">这是您的命令行。</p><p id="6940" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">恭喜你！您刚刚创建了您的第一个Git挂钩！</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h1 id="cfa5" class="kr ks iq bd kt ku nd kw kx ky ne la lb jw nf jx ld jz ng ka lf kc nh kd lh li bi translated">创建结账后工作流程，使其具有不同的。git忽略每个分支的文件</h1><p id="6407" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在我们继续之前，我们需要创建一个包含特定于分支的<code class="fe ms mt mu mv b">.gitignore</code>文件的文件夹。我选择把它们放在<code class="fe ms mt mu mv b">.husky/gitignores</code>里面，但是显然，你可以把它们放在任何你想放的地方。</p><p id="0420" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">根据您的包管理器和您的存储库的结构，您已经有了一个全局的<code class="fe ms mt mu mv b">.gitignore</code>。如果你已经建立了你的项目与纱浆果，你一定会有一个与标准纱忽略。</p><p id="00f2" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">基本上，我们将把<code class="fe ms mt mu mv b">.gitignore</code>文件分割成这个全局文件，它包含一般设置——对于每个分支都是一样的，而分支特定忽略了仅对特定分支有效的设置。</p><p id="496f" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">后者我们以<code class="fe ms mt mu mv b">.gitignore_&lt;branch_name&gt;</code>为后缀。对于本教程，让我们假设我们有两个分支称为<code class="fe ms mt mu mv b">main</code>和<code class="fe ms mt mu mv b">husky</code>，其中主要有标准纱忽略和分支哈士奇需要一些额外的文件/文件夹忽略。</p><p id="b3e4" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">我们通过运行(在Linux/Mac上)来设置它</p><pre class="kg kh ki kj gt oi mv oj ok aw ol bi"><span id="3b84" class="nw ks iq mv b gy om on l oo op">mkdir .husky/gitignores</span></pre><p id="fc8a" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">如果您的repo中已经有一个<code class="fe ms mt mu mv b">.gitignore</code>(您应该有)，那么将这个文件复制到我们刚刚创建的文件夹中</p><pre class="kg kh ki kj gt oi mv oj ok aw ol bi"><span id="55c9" class="nw ks iq mv b gy om on l oo op">cp .gitignore .husky/gitignores</span></pre><p id="f7a0" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">现在让我们为我们的哈士奇分公司创建特定的<code class="fe ms mt mu mv b">.gitignore_husky</code></p><pre class="kg kh ki kj gt oi mv oj ok aw ol bi"><span id="f964" class="nw ks iq mv b gy om on l oo op">touch .husky/gitignores/.gitignore_husky</span></pre><p id="aa82" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">你可以像对待一个普通的<code class="fe ms mt mu mv b">.gitignore</code>文件一样对待这个文件，你可以把任何你想忽略的husky分支放入其中。这个文件的内容将被追加到全局<code class="fe ms mt mu mv b">.gitignore</code>中。</p><p id="c276" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">快好了！现在，将下面的代码复制并粘贴到我们之前通过husky命令创建的<code class="fe ms mt mu mv b">post-commit</code>文件中</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="8a8e" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">提交更改后，当切换分支时，一个新的包含来自<code class="fe ms mt mu mv b">.gitignore_husky</code>的内容的<code class="fe ms mt mu mv b">.gitignore</code>将出现在您的根目录中！</p><blockquote class="mm mn mo"><p id="f402" class="lj lk mg ll b lm mh jr lo lp mi ju lr mp mj lu lv mq mk ly lz mr ml mc md me ij bi translated"><strong class="ll ir">注意</strong>:记住如果你想要更新全局<code class="fe ms mt mu mv b">.gitignore</code>，你将不得不在<code class="fe ms mt mu mv b">.husky/gitignores/.gitignore</code>中编辑它，因为你的库的根目录中的文件将在你每次改变分支时被覆盖！</p></blockquote><p id="2989" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">在我的回购根中创建的<code class="fe ms mt mu mv b">.gitignore</code>看起来像</p><pre class="kg kh ki kj gt oi mv oj ok aw ol bi"><span id="ed2c" class="nw ks iq mv b gy om on l oo op"># GENERAL IGNORES<br/># ------------------------------<br/># Attention! Do not change things here, things will get overridden<br/># on the next checkout. Changes need to be done in .husky/.gitignore</span><span id="eff2" class="nw ks iq mv b gy ox on l oo op"># Yarn<br/>.yarn/*<br/>!.yarn/patches<br/>!.yarn/plugins<br/>!.yarn/releases<br/>!.yarn/sdks<br/>!.yarn/versions<br/>!.yarn/cache</span><span id="6849" class="nw ks iq mv b gy ox on l oo op"># Environment specific<br/>.DS_Store</span><span id="f83e" class="nw ks iq mv b gy ox on l oo op"># Branch ::: husky<br/># -------------------------------<br/>ignorethisfile.txt</span><span id="254e" class="nw ks iq mv b gy ox on l oo op"># Comments also work<br/>morefiles.test</span><span id="c440" class="nw ks iq mv b gy ox on l oo op"># Folders<br/>!./test</span></pre><h1 id="dddd" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">摘要</h1><ul class=""><li id="c5b2" class="ni nj iq ll b lm ln lp lq ls oy lw oz ma pa me nn no np nq bi translated"><strong class="ll ir">第一步:</strong> <code class="fe ms mt mu mv b">yarn add -D husky &amp;&amp; yarn husky install</code></li><li id="01c2" class="ni nj iq ll b lm nr lp ns ls nt lw nu ma nv me nn no np nq bi translated"><strong class="ll ir">第二步:</strong> <code class="fe ms mt mu mv b">yarn husky add .husky/post-checkout</code></li><li id="f8b0" class="ni nj iq ll b lm nr lp ns ls nt lw nu ma nv me nn no np nq bi translated"><strong class="ll ir">第三步:</strong> <code class="fe ms mt mu mv b">mkdir .husky/gitignores &amp;&amp; cp .gitignore .husky/gitignores</code></li><li id="ef88" class="ni nj iq ll b lm nr lp ns ls nt lw nu ma nv me nn no np nq bi translated"><strong class="ll ir">第四步:</strong> <code class="fe ms mt mu mv b">touch .husky/gitignores/.gitignore_husky</code></li><li id="0ac0" class="ni nj iq ll b lm nr lp ns ls nt lw nu ma nv me nn no np nq bi translated"><strong class="ll ir">第五步:</strong>将<a class="ae mf" href="https://gist.github.com/Poolshark/52e9ee27ddad34faff282f9b1f716bc9" rel="noopener ugc nofollow" target="_blank">要点内容</a>(向下滚动本页)复制粘贴到<code class="fe ms mt mu mv b">.husky/post--checkout</code></li></ul></div></div>    
</body>
</html>