<html>
<head>
<title>Explaining the Observer Pattern Using Netflix and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用网飞和TypeScript解释观察者模式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/explaining-the-observer-pattern-using-netflix-and-typescript-afbbff219c4d?source=collection_archive---------5-----------------------#2019-12-19">https://betterprogramming.pub/explaining-the-observer-pattern-using-netflix-and-typescript-afbbff219c4d?source=collection_archive---------5-----------------------#2019-12-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9d2b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对软件中的事件做出反应</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/18173d6033e1545f05b61a06a3a29412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SQyVLO0mPqcLCiB3"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://unsplash.com/@pawel_czerwinski" rel="noopener ugc nofollow" target="_blank"> <strong class="bd kz">帕维切维斯基</strong> </a>提供</p></figure><div class="la lb gp gr lc ld"><a href="https://dleroari.medium.com/membership" rel="noopener follow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd iu gy z fp li fr fs lj fu fw is bi translated">通过我的推荐链接加入媒体</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">dleroari.medium.com</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr ks ld"/></div></div></a></div><p id="5960" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi mo translated"><span class="l mp mq mr bm ms mt mu mv mw di">观察者模式是一种行为设计模式，当事情发生时，它对变化做出反应。术语<em class="mx">观察者</em>是指观察或注意到变化的人。</span></p><p id="c51b" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">在编程中，它是一种订阅机制，在事件被触发时通知一个或多个对象(观察者)。同样的概念也适用于Twitter、YouTube、Instagram、Snapchat等社交媒体。</p><p id="be0d" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">每当有人发帖，关注此人的每个人都会收到通知。这一概念与数据和自动化领域高度相关。</p><blockquote class="my"><p id="b9d4" class="mz na it bd nb nc nd ne nf ng nh mn dk translated"><strong class="ak">观察者模式</strong>是一种软件设计<strong class="ak">模式</strong>，其中一个被称为主体(或发布者)的对象维护一个被称为观察者(或订阅者)的依赖者列表，并自动通知它们任何状态变化，通常是通过调用它们的方法之一— <a class="ae ky" href="https://en.wikipedia.org/wiki/Observer_pattern" rel="noopener ugc nofollow" target="_blank">来源</a>。</p></blockquote><figure class="ni nj nk nl nm kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="3088" class="nw nx it bd ny nz oa ob oc od oe of og jz oh ka oi kc oj kd ok kf ol kg om on bi translated">观察者的世界</h1><p id="f5b8" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">如果我们退一步想想，我们周围的一切都是一连串的事件。事件是发生的事情。一些事件是关键的，而另一些则不是。</p><p id="2e39" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">你在日常生活中所做的事情是一系列的事件。你早上醒来，穿好衣服，洗个澡，吃早餐，然后去上班。这些都是事件的例子。</p><p id="2a5e" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">在像飞机这样的复杂系统中，当飞行员在起飞时进行机动动作时，会触发成千上万的事件，其中大多数都是在幕后处理的，因此飞行员可以专注于飞行。</p><p id="c2ea" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">例如，当飞机到达某一高度时，座椅安全带标志关闭，压缩空气被管理以平衡机舱内的新鲜空气，洗手间的门被打开，监视器上播放商业广告，等等。</p><p id="d873" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">当这一切发生时，飞机向空中交通管制发送信号，以确保他们在空域中的安全。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="423d" class="nw nx it bd ny nz oa ob oc od oe of og jz oh ka oi kc oj kd ok kf ol kg om on bi translated">JavaScript中的事件</h1><p id="1a6f" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">JavaScript中的事件通常基于用户事件，比如用户点击按钮、在屏幕上输入内容、鼠标移动、上下滚动。这些是我们可以跟踪的典型用户事件。</p><p id="a532" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">它也可以等待来自服务器的一些数据，例如从数据库请求用户。但是事件本身并没有多大作用，真正重要的是系统对这些事件的反应方式。</p><p id="daae" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">例如，在JavaScript中，我们有一个名为<code class="fe ot ou ov ow b">addEventListener</code>的流行函数，它基于MDN文档中列出的<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/Events" rel="noopener ugc nofollow" target="_blank">事件之一触发。</a></p><p id="2fc7" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">下面是一个响应用户事件的JavaScript函数的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在JavaScript中监听用户事件</p></figure><p id="2140" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated"><code class="fe ot ou ov ow b">addEventListener</code>函数只是一个观察器(订阅者),它等待一个点击事件(通知者)。当用户单击页面上的某个地方时，它将触发一个称为回调的操作，打印一条消息“clicked”。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="a6fc" class="nw nx it bd ny nz oa ob oc od oe of og jz oh ka oi kc oj kd ok kf ol kg om on bi translated">这是我们要解决的问题</h1><ol class=""><li id="8f2d" class="oy oz it lu b lv oo ly op mb pa mf pb mj pc mn pd pe pf pg bi translated">用网飞解释观察者模式。</li><li id="71ae" class="oy oz it lu b lv ph ly pi mb pj mf pk mj pl mn pd pe pf pg bi translated">定义发布者和订阅者。</li><li id="02ea" class="oy oz it lu b lv ph ly pi mb pj mf pk mj pl mn pd pe pf pg bi translated">创建一个流媒体平台。</li><li id="64f7" class="oy oz it lu b lv ph ly pi mb pj mf pk mj pl mn pd pe pf pg bi translated">创建一个设备。</li><li id="5944" class="oy oz it lu b lv ph ly pi mb pj mf pk mj pl mn pd pe pf pg bi translated">订阅网飞。</li><li id="6421" class="oy oz it lu b lv ph ly pi mb pj mf pk mj pl mn pd pe pf pg bi translated">总结。</li></ol></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="d800" class="nw nx it bd ny nz oa ob oc od oe of og jz oh ka oi kc oj kd ok kf ol kg om on bi translated">1.用网飞解释观察者模式</h1><p id="a06e" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">解释观察者模式的最好方法是使用我们都熟悉的东西，那就是网飞。</p><p id="086f" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">网飞是一个流媒体平台，允许成员在全球数千台联网设备上观看各种各样的电视节目、电影、纪录片等。</p><h2 id="4ba6" class="pm nx it bd ny pn po dn oc pp pq dp og mb pr ps oi mf pt pu ok mj pv pw om px bi translated">但是为什么是网飞呢？</h2><p id="adad" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">网飞是遵循观察者模式的一个很好的例子。每当有新内容上传到网飞服务器时，所有激活了网飞帐户的设备都会收到通知，根据内部配置显示或不显示内容。</p><p id="e34e" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">因此，第二天某人打开网飞，这个人最喜欢的节目的一个新系列就可以观看，而不必手动安装新的内容。</p><p id="44e6" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">这样，网飞可以专注于发布内容，而世界各地的设备则负责展示内容。</p><p id="4103" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">换句话说，我们通过让一个平台发布，另一个平台观察来分离责任。这就是观察者模式的突出之处！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi py"><img src="../Images/1b1f8fe966cfc1bfda8db5c72e2e49b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xtkSsSgIsa5WPNMcDPszNQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">网飞的观察者模式</p></figure><p id="06a0" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">如上图所示，网飞是发布者，负责通知设备(观察者)发生了一些事情，比如上传了新内容。</p><p id="0eb6" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">让我们看看如何构建一个像网飞一样的流平台，并在TypeScript中实现观察者模式。</p><p id="c8cc" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">注意:这个例子的全部代码都写在一个文件中。下面的代码示例关注文件中的不同部分。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="4d61" class="nw nx it bd ny nz oa ob oc od oe of og jz oh ka oi kc oj kd ok kf ol kg om on bi translated">2.定义发布者和订阅者</h1><p id="7054" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">为了使我们的生活更容易，我们将创建两个接口；一个发布者和一个订阅者来定义类的语法。</p><h2 id="28d2" class="pm nx it bd ny pn po dn oc pp pq dp og mb pr ps oi mf pt pu ok mj pv pw om px bi translated">界面的力量</h2><p id="a447" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">在TypeScript中，接口通常用于类型检查，也称为协定。</p><p id="524b" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">接口不能被实例化，它只是一个模式，定义了一个类必须有哪些变量或函数。这使得编写代码变得更加容易，因此我们可以在实现代码之前看到我们正在处理什么数据。</p><p id="207d" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">这种洞察是通过代码完成来完成的，大多数IDE都支持这种开箱即用的功能。但是什么是代码补全呢？</p><p id="5d98" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">代码补全(<a class="ae ky" href="https://docs.microsoft.com/en-us/visualstudio/ide/using-intellisense" rel="noopener ugc nofollow" target="_blank"> IntelliSense </a>)通过在变量名后使用<code class="fe ot ou ov ow b">.</code>点符号，帮助开发人员查看代码提示，比如某个类具有哪些属性或方法。</p><p id="1a11" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">例如，编写<code class="fe ot ou ov ow b">person1.</code>将显示类似<code class="fe ot ou ov ow b">person1.getName</code>、<code class="fe ot ou ov ow b">person1.setName</code>、<code class="fe ot ou ov ow b">person1.getEmail</code>等<em class="mx">的建议。</em></p><h2 id="41eb" class="pm nx it bd ny pn po dn oc pp pq dp og mb pr ps oi mf pt pu ok mj pv pw om px bi translated">命名约定</h2><p id="94bb" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">对于命名约定，我们将坚持使用发布者和订阅者，但是在其他编程语言中，发布者被称为流、主题或可观察对象，而订阅者被称为观察者、监听器等等。</p><p id="fcc7" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">不要让这样的命名约定迷惑你，底层逻辑仍然遵循观察者模式的相同原则。</p><h2 id="fd9a" class="pm nx it bd ny pn po dn oc pp pq dp og mb pr ps oi mf pt pu ok mj pv pw om px bi translated">定义发布接口</h2><p id="1e4f" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">发布接口是我们观察者模式的基类。它由subscribe、unsubscribe和<code class="fe ot ou ov ow b">notifySubscribers</code>等方法组成。</p><p id="529d" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">唯一需要注意的是:发布者负责通知订阅者:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">发布者界面</p></figure><h2 id="2799" class="pm nx it bd ny pn po dn oc pp pq dp og mb pr ps oi mf pt pu ok mj pv pw om px bi translated">定义订户界面</h2><p id="ffd2" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">订阅者接口只不过是一个类，它有一个发布者在出现更改时调用的方法。订户可以是侦听传入事件的任何东西。</p><p id="7ad2" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">在这个例子中，它是一个设备，但在其他情况下，它可以是在温度下降时控制热舒适性的通风设备，在红灯信号时停下来的火车，或在收到信息时振动的移动设备。</p><p id="7627" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">订阅者通常有一个发布者调用(通知)更改的方法，它还可以有一个类似名称的字段来帮助标识订阅者的类型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用户界面</p></figure><h1 id="e147" class="nw nx it bd ny nz pz ob oc od qa of og jz qb ka oi kc qc kd ok kf qd kg om on bi translated">3.创建一个流媒体平台</h1><p id="a2b4" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">下一步是创建一个<code class="fe ot ou ov ow b">StreamingPlatform</code>,它负责在新内容发布时通知订阅的设备。这是实现部分，也是观察者模式的核心原则。</p><p id="7420" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">注意:单词<em class="mx"> implement </em>意味着应用由接口描述的契约，而不是创建类的新实例。</p><p id="8928" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">让我们创建一个实现<code class="fe ot ou ov ow b">Publisher</code>接口的类<code class="fe ot ou ov ow b">StreamingPlatform</code>。</p><p id="85f7" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">一旦实现了这个接口，类名<code class="fe ot ou ov ow b">StreamingPlatform</code>下就会显示一条红色的曲线，并显示消息:</p><pre class="kj kk kl km gt qe ow qf qg aw qh bi"><span id="c6cf" class="pm nx it ow b gy qi qj l qk ql">A class<strong class="ow iu"> </strong>StreamingPlatform<!-- --> incorrectly implements interface <!-- -->Publisher<!-- -->. </span></pre><p id="170a" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">这意味着我们需要实现在<code class="fe ot ou ov ow b">Publisher</code>接口中定义的方法。</p><p id="7cc3" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">如前所述，接口是一种模式，它帮助开发人员通过遵循一般定义来定义一个类需要哪些方法和字段。强烈建议为未来的课程提供标准。</p><p id="569c" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">让我们来实现<code class="fe ot ou ov ow b">StreamingPlatform</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通知订户的流平台</p></figure><p id="9ed0" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">如果我们退一步分析<code class="fe ot ou ov ow b">StreamingPlatform</code>，一切都是围绕使用数组的概念构建的，然后循环每个项目来调用它的方法。在我们的例子中，一个条目是一个拥有<code class="fe ot ou ov ow b">update</code>方法的设备对象。</p><h2 id="f3a0" class="pm nx it bd ny pn po dn oc pp pq dp og mb pr ps oi mf pt pu ok mj pv pw om px bi translated">订阅</h2><p id="e20a" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">为了让<code class="fe ot ou ov ow b">StreamingPlatform</code>在发布新内容时更新多个设备，我们需要将订户存储在我们的订户列表中。</p><p id="f959" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">当有人在Twitter、脸书或Instagram上关注一个人时，这遵循相同的概念。例如，当有人在Instagram上发布新帖子时，每个关注的人都会收到通知。</p><h2 id="43c8" class="pm nx it bd ny pn po dn oc pp pq dp og mb pr ps oi mf pt pu ok mj pv pw om px bi translated">取消订阅</h2><p id="572a" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">订阅者应该有停止接收通知的灵活性，原因可能是它想要订阅其他内容，或者不再需要这样的功能。</p><p id="4f3a" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">例如，如果你订阅了一份邮件简讯，后来出于某种原因不想再收到电子邮件，你可以取消订阅。</p><p id="90ef" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">此外，这更有效地节省了HTTP的内存和流量，因此<code class="fe ot ou ov ow b">StreamingPlatform</code>不必通知已经取消订阅的用户。</p><h2 id="c3c2" class="pm nx it bd ny pn po dn oc pp pq dp og mb pr ps oi mf pt pu ok mj pv pw om px bi translated">通知订户</h2><p id="1f0c" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">这是负责通知订户的机制(核心)。这是通过遍历订阅者列表中的每个订阅者并调用其<code class="fe ot ou ov ow b">update</code>方法来完成的。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="e2fd" class="nw nx it bd ny nz oa ob oc od oe of og jz oh ka oi kc oj kd ok kf ol kg om on bi translated">4.创建一个设备</h1><p id="ebc2" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">现在<code class="fe ot ou ov ow b">StreamingPlatform</code>已经准备好了，下一步是创建一个设备，这样我们就可以添加PC、平板电脑、电视和移动设备。</p><p id="37fe" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated"><code class="fe ot ou ov ow b">Device</code>(订阅者)是监听器，它实现了<code class="fe ot ou ov ow b">Subscriber</code>接口；一个<code class="fe ot ou ov ow b">deviceName</code>来帮助我们识别哪个设备被触发了，还有一个<code class="fe ot ou ov ow b">update</code>方法来识别即将到来的变化。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">订户的示例</p></figure><p id="3aa0" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">注意:我们可以创建几个实现<code class="fe ot ou ov ow b">Subscriber</code>接口的类，并添加条件状态，比如我们是否想要限制播放哪些电影。</p><p id="2959" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">例如，父母可以设定年龄限制来保护孩子不看暴力电影。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="5620" class="nw nx it bd ny nz oa ob oc od oe of og jz oh ka oi kc oj kd ok kf ol kg om on bi translated">5.订阅网飞</h1><p id="41d0" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">既然我们已经设置好了<code class="fe ot ou ov ow b">StreamingPlatform</code>和<code class="fe ot ou ov ow b">Device</code>类，下一步就是通过创建一个流平台(网飞)和一个订阅者(设备)来实现它。这里的核心行为是网飞。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">订阅网飞</p></figure><h2 id="5448" class="pm nx it bd ny pn po dn oc pp pq dp og mb pr ps oi mf pt pu ok mj pv pw om px bi translated">创造网飞</h2><p id="c3bc" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">在我们可以向流媒体平台添加设备之前，我们需要创建一个新的<code class="fe ot ou ov ow b">StreamingPlatform</code>类实例。这可以是任何类型的流媒体平台，如YouTube、HBO、Twitch等。</p><p id="af04" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">在本例中，我们将创建网飞。一旦这个类被实例化，它现在就可以添加、删除和通知订阅者了。</p><h2 id="afab" class="pm nx it bd ny pn po dn oc pp pq dp og mb pr ps oi mf pt pu ok mj pv pw om px bi translated">创建设备</h2><p id="2de4" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">这些设备是我们的订户，当网飞发布新内容时，我们会通知他们。为了跟踪所通知的设备类型，该类接受设备的名称。</p><p id="6eef" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">注意，我们不像<code class="fe ot ou ov ow b">device2.update('blabla')</code>那样从<code class="fe ot ou ov ow b">Device</code>类调用<code class="fe ot ou ov ow b">update</code>方法，因此流媒体平台(网飞)是调用它的平台。</p><h2 id="b67e" class="pm nx it bd ny pn po dn oc pp pq dp og mb pr ps oi mf pt pu ok mj pv pw om px bi translated">订阅网飞</h2><p id="a505" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">为了创建一种新内容发布时网飞通知设备的机制，必须有某种类型的关系:设备必须订阅网飞。</p><p id="2b63" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">单词subscribe也可以是connect、attach、listen、follow等等。</p><h2 id="5624" class="pm nx it bd ny pn po dn oc pp pq dp og mb pr ps oi mf pt pu ok mj pv pw om px bi translated">发布并通知</h2><p id="d220" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">最后但同样重要的是，这是符合观察者模式结构的部分。发布新内容时，流媒体平台(网飞)会自动通知设备(订户):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">发布和通知事件</p></figure></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="dfc6" class="nw nx it bd ny nz oa ob oc od oe of og jz oh ka oi kc oj kd ok kf ol kg om on bi translated">摘要</h1><p id="488b" class="pw-post-body-paragraph ls lt it lu b lv oo ju lx ly op jx ma mb oq md me mf or mh mi mj os ml mm mn im bi translated">观察者模式是一种众所周知的行为设计模式，在软件中被大量用于跟踪事件和对事件做出反应。</p><p id="5908" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">让软件响应这些事件的需求对于创建健壮的系统是必不可少的。已经有数十亿个系统遵循观察者模式，但是通过不同的名称和库。</p><p id="8c82" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">如果你像我一样，你想了解事物是如何在幕后工作的，观察者模式是我们使用的东西，即使我们可能没有意识到它。</p><p id="357f" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">例如，当您对用户事件或任何类型的事件做出反应时，这就是观察者模式的工作。</p><p id="2b01" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">现在，您已经对发布和订阅事件的概念以及如何实现它有了基本的了解。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><blockquote class="my"><p id="89e0" class="mz na it bd nb nc nd ne nf ng nh mn dk translated">如果你喜欢这篇文章，并想要更多这样的，请鼓掌❤，并与可能需要它的朋友分享，这是好的因果报应。</p><p id="978e" class="mz na it bd nb nc nd ne nf ng nh mn dk translated">你可以在我每周发表文章的媒体上找到我。或者你可以在<a class="ae ky" href="http://twitter.com/dleroari" rel="noopener ugc nofollow" target="_blank">推特</a>上关注我。</p></blockquote></div></div>    
</body>
</html>