<html>
<head>
<title>Internationalization With Gatsby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Gatsby的国际化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/internationalization-with-gatsby-ae3991c39e92?source=collection_archive---------5-----------------------#2020-03-20">https://betterprogramming.pub/internationalization-with-gatsby-ae3991c39e92?source=collection_archive---------5-----------------------#2020-03-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="37db" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何用gatsby-plugin-i18n和react-intl国际化你的Gatsby网站</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f9cc7b974344399742585a782c28a92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tuOyAQ0r1d4nnAcA1xccyQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尼古拉·纳托尔在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="c7e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我挑战自己每天分享一篇文章，直到4月19日新冠肺炎隔离期结束。还剩30天，希望会有更好的日子。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3ed0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">该项目</h1><p id="ef21" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我和两个朋友开始了一个新项目。我还不能谈论太多，但我们只能说它符合我们的价值观。出于这个目的，我们需要一个网站——显然，它将是开源的，我将与<a class="ae ky" href="https://www.gatsbyjs.org" rel="noopener ugc nofollow" target="_blank"> Gatsby </a>一起开发。</p><p id="b8ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管这不是我的第一个Gatsby网站(我的<a class="ae ky" href="https://daviddalbusco.com" rel="noopener ugc nofollow" target="_blank">个人网站</a>是用同样的栈开发的)，但这是我第一次必须国际化一个。</p><p id="4f6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我期望这样的实现相当简单，但是在简单的文档、过时的博客文章、甚至是示例项目之间，我实际上不得不在今天早上投入两个小时来最终实现我的目标。</p><p id="db86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是为什么我认为在这个新教程中分享结果可能是一个好主意。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6fae" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">SEO友好插件</h1><p id="134e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您的老朋友需要不同的URL(路由)来抓取和呈现每种语言的页面。例如，如果你的网站支持英语和法语，谷歌会很高兴你提供<code class="fe mz na nb nc b">https://domain.com/en/</code>和<code class="fe mz na nb nc b"><a class="ae ky" href="https://domain.com/en/" rel="noopener ugc nofollow" target="_blank">https://domain.com/fr/</a></code>。</p><p id="74cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了让盖茨比做到这一点，要记住的第一件重要的事情是你所有的页面都要复制。按照上面的例子，这意味着网站将包含一个<code class="fe mz na nb nc b">index.en.js</code>和一个<code class="fe mz na nb nc b">index.fr.js</code>。</p><p id="74bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了帮助我们的网站理解这样的路由，我们可以使用插件<a class="ae ky" href="https://github.com/angeloocana/gatsby-plugin-i18n" rel="noopener ugc nofollow" target="_blank"> gatsby-plugin-i18n </a>。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="12de" class="nh md it nc b gy ni nj l nk nl">npm install gatsby-plugin-i18n —-save</span></pre><p id="fe53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装完成后，我们在<code class="fe mz na nb nc b">gatsby-config.js</code>中添加所需的配置，并添加一些关于支持语言列表和默认语言的元信息。</p><p id="f8b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我指定了<code class="fe mz na nb nc b">prefixDefault</code>到<code class="fe mz na nb nc b">true</code>来禁止根路由。甚至默认语言英语的网址也必须加上前缀<code class="fe mz na nb nc b">/en/</code>。老实对你说，这背后的原因之一是我无法让它发生。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="8a67" class="nh md it nc b gy ni nj l nk nl">siteMetadata: {<br/>  languages: {<br/>    langs: ['en', 'fr'],<br/>    defaultLangKey: 'en'<br/>  }<br/>},<br/>plugins: [<br/>  {<br/>    resolve: 'gatsby-plugin-i18n',<br/>    options: {<br/>      langKeyDefault: 'en',<br/>      useLangKeyLayout: true,<br/>      prefixDefault: true<br/>    }<br/>  }<br/>]</span></pre><p id="f2a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们在任何情况下都使用前缀，没有任何其他变化，访问我们网站的根目录将不会显示任何内容——这就是为什么我们编辑<code class="fe mz na nb nc b">gatsby-browser.js</code>将根目录请求重定向到默认主页。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="eec5" class="nh md it nc b gy ni nj l nk nl">exports.onClientEntry = () =&gt; {<br/>  if (window.location.pathname === '/') {<br/>    window.location.pathname = `/en`<br/>  }<br/>}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9e86" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">国际化库</h1><p id="4df7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">盖茨比和上面的插件要么兼容<a class="ae ky" href="https://react.i18next.com" rel="noopener ugc nofollow" target="_blank"> react-i18next </a>要么兼容<a class="ae ky" href="https://github.com/formatjs/react-intl" rel="noopener ugc nofollow" target="_blank"> react-intl </a>。我在<a class="ae ky" href="https://tietracker.app.link/" rel="noopener ugc nofollow" target="_blank">领带追踪器里用i18next因此，我选择了另一个方案，因为我喜欢学习新事物。</a></p><p id="4a31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">React Intl依赖于<code class="fe mz na nb nc b">Intl</code>API——这也是我们安装polyfill <code class="fe mz na nb nc b"><a class="ae ky" href="https://www.npmjs.com/package/@formatjs/intl-pluralrules" rel="noopener ugc nofollow" target="_blank">intl-pluralrules</a></code>的原因。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="4535" class="nh md it nc b gy ni nj l nk nl">npm install react-intl @formatjs/intl-pluralrules --save</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4f38" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">动手编码</h1><p id="7cc5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">足够的安装和配置—让我们开始编码。我们必须应用的主要修改发生在<code class="fe mz na nb nc b">layout.js</code>中，顺便说一下，我把它移到了一个名为<code class="fe mz na nb nc b">src/components/layout/</code>的子文件夹中，原因就是我喜欢干净的结构。</p><p id="bec8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“这里发生了什么？”你可能会问。总而言之，我们添加了两个新的必需属性，<code class="fe mz na nb nc b">location</code>和<code class="fe mz na nb nc b">messages</code>。第一个用于猜测应该应用的地区，第二个包含翻译列表。如您所见，我们导入了React Intl。我们还从<code class="fe mz na nb nc b">ptz-i18n</code>中导入了一个名为<code class="fe mz na nb nc b">getCurrentLangKey</code>的函数，它实际上是上述插件的一个实用程序。</p><p id="63b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还使用<code class="fe mz na nb nc b">&lt;FormattedMessage/&gt;</code>组件打印出<code class="fe mz na nb nc b">Hello</code>以确保我们的实现工作正常。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="b1ce" class="nh md it nc b gy ni nj l nk nl">import React from "react"<br/>import PropTypes from "prop-types"<br/>import { useStaticQuery, graphql } from "gatsby"<br/><br/>import Header from "../header"<br/>import "./layout.css"<br/><br/>import { FormattedMessage, IntlProvider } from "react-intl"<br/>import "@formatjs/intl-pluralrules/polyfill"<br/><br/>import { getCurrentLangKey } from 'ptz-i18n';<br/><br/>const Layout = ({ children, location, messages }) =&gt; {<br/>  const data = useStaticQuery(graphql`<br/>    query SiteTitleQuery {<br/>      site {<br/>        siteMetadata {<br/>          title<br/>          languages {<br/>            defaultLangKey<br/>            langs<br/>          }<br/>        }<br/>      }<br/>    }<br/>  `)<br/><br/>  const { langs, defaultLangKey } = <br/>                                data.site.siteMetadata.languages;<br/>  const langKey = <br/>     getCurrentLangKey(langs, defaultLangKey, location.pathname);<br/><br/>  return (<br/>    &lt;IntlProvider locale={langKey} messages={messages}&gt;<br/>      &lt;Header siteTitle={data.site.siteMetadata.title} /&gt;<br/><br/>      &lt;p&gt;<br/>        &lt;FormattedMessage id="hello" /&gt;<br/>      &lt;/p&gt;<br/><br/>    &lt;/IntlProvider&gt;<br/>  )<br/>}<br/><br/>Layout.propTypes = {<br/>  children: PropTypes.node.isRequired,<br/>  location: PropTypes.any.isRequired,<br/>  messages: PropTypes.any.isRequired,<br/>}<br/><br/>export default Layout</span></pre><p id="ca74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了扩展每种语言和地区的布局，我们为每种支持的语言创建了一个新文件，例如，在英语中，我们创建了<code class="fe mz na nb nc b">layout/en.js</code>，在其中我们导入了自定义消息和特定的polyfill。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="7c41" class="nh md it nc b gy ni nj l nk nl">import React<strong class="nc iu"><em class="nm"> </em></strong>from 'react';<br/>import Layout from "./layout"<br/><br/>import messages from '../../i18n/en';<br/>import "@formatjs/intl-pluralrules/dist/locale-data/en"<br/><br/>export default (props) =&gt; (<br/>  &lt;Layout<br/>    {...props}<br/>    messages={messages}<br/>  /&gt;<br/>);</span></pre><p id="3425" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，我们的代码无法编译，因为在这些语言中，这些消息丢失了。这就是为什么我们也为这些创建文件—例如，<code class="fe mz na nb nc b">i18n/en.js</code>。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="99c0" class="nh md it nc b gy ni nj l nk nl">module.exports = {<br/>  hello: "Hello world",<br/>}</span></pre><p id="8c9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我在介绍中简要说明的那样，每一页都将被复制。这就是我们创建相应索引页面的原因。在默认情况下，英语，我们重命名<code class="fe mz na nb nc b">index.js</code>为<code class="fe mz na nb nc b">index.en.js</code>。此外，因为布局现在需要一个位置属性，所以我们也为每个页面传递它。</p><p id="569a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还要注意，因为我已经决定给所有路由加前缀，所以我还修改了从<code class="fe mz na nb nc b">/page-2/</code>到<code class="fe mz na nb nc b">/en/page-2</code>的链路路由。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="866d" class="nh md it nc b gy ni nj l nk nl">import React<strong class="nc iu"><em class="nm"> </em></strong>from "react"<br/>import { Link } from "gatsby"<br/><br/>import Layout from "../components/layout/en"<br/>import SEO from "../components/seo/seo"<br/><br/>const IndexPage = (props) =&gt; (<br/>  &lt;Layout location={props.location}&gt;<br/>    &lt;SEO /&gt;<br/>    &lt;h1&gt;Hi people&lt;/h1&gt;<br/>    <br/>    &lt;Link to="/en/page-2/"&gt;Go to page 2&lt;/Link&gt;<br/>  &lt;/Layout&gt;<br/>)<br/><br/>export default IndexPage</span></pre><p id="4466" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们为<code class="fe mz na nb nc b">index</code>实现的相同修改应该传播到每个页面——在这个例子中，我也重命名了<code class="fe mz na nb nc b">page-2.en.js</code>中的<code class="fe mz na nb nc b">page-2.js</code>,并应用了与上面相同的修改。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="f276" class="nh md it nc b gy ni nj l nk nl">import React<strong class="nc iu"><em class="nm"> </em></strong>from "react"<br/>import { Link } from "gatsby"<br/><br/>import Layout from "../components/layout/en"<br/>import SEO from "../components/seo/seo"<br/><br/>const SecondPage = (props) =&gt; (<br/>  &lt;Layout location={props.location}&gt;<br/>    &lt;SEO title="Page two" /&gt;<br/>    &lt;p&gt;Welcome to page 2&lt;/p&gt;<br/>    &lt;Link to="/en/"&gt;Go back to the homepage&lt;/Link&gt;<br/>  &lt;/Layout&gt;<br/>)<br/><br/>export default SecondPage</span></pre><p id="7581" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，在我们的<code class="fe mz na nb nc b">404.js</code>页面中，<code class="fe mz na nb nc b">&lt;Layout/&gt;</code>组件的使用必须通过location对象得到增强。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="8d0b" class="nh md it nc b gy ni nj l nk nl">import React<strong class="nc iu"><em class="nm"> </em></strong>from "react"<br/><br/>import Layout from "../components/layout/layout"<br/>import SEO from "../components/seo/seo"<br/><br/>const NotFoundPage = (props) =&gt; (<br/>  &lt;Layout location={props.location}&gt;<br/>    &lt;SEO /&gt;<br/>    &lt;h1&gt;NOT FOUND&lt;/h1&gt;<br/>  &lt;/Layout&gt;<br/>)<br/><br/>export default NotFoundPage</span></pre><p id="58c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，我们的Gastby工厂实现了国际化。当然，你可能想添加一些其他语言。为此，对英语重复上述步骤，并再次复制页面。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1ddd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">更多提示和技巧</h1><p id="14e6" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我随后发表了一篇后续文章，关于盖茨比网站的国际化。如果您渴望阅读更多的提示和技巧，请查看一下😉。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="11b2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">摘要</h1><p id="3622" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">嗯，对我来说，不得不花这么多时间在一个新项目中释放国际化真的是意想不到的——这就是为什么我希望这个小方法可以在未来帮助到某人。</p><p id="72fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">呆在家里，注意安全！</p></div></div>    
</body>
</html>