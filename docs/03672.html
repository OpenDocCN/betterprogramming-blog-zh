<html>
<head>
<title>Building Angular Apps Using GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub动作构建Angular应用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-angular-apps-using-github-actions-bf916b56ed0c?source=collection_archive---------0-----------------------#2020-02-26">https://betterprogramming.pub/building-angular-apps-using-github-actions-bf916b56ed0c?source=collection_archive---------0-----------------------#2020-02-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1909" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用GitHub操作为Angular应用程序配置CI/CD工作流</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/08b41e1a75d3cd5afd786ba6f04c97ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R26sDhT7we0WDyOP4zEmDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">背景图像—无飞溅</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ky kz l"/></div></figure><p id="2925" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae lw" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>是为GitHub上的项目添加CI/CD工作流的自动化工具。它目前面向公众开放，并完全免费用于开源项目。</p><p id="2b6d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在本文中，我们将讨论在Angular项目中集成CI/CD工作流的各个步骤。在Angular项目中，我们将关注GitHub动作配置。创建Angular应用程序的基础及其工作原理不在本文讨论范围之内。</p><p id="1691" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们一步一步来。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="2bcd" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">1.创建GitHub项目</h1><p id="6faf" class="pw-post-body-paragraph la lb it lc b ld mw ju lf lg mx jx li lj my ll lm ln mz lp lq lr na lt lu lv im bi translated">显而易见的第一步是创建一个GitHub项目，并将您的Angular项目与存储库连接起来。</p><p id="9d10" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果您已经成功地完成了Actions beta的注册过程，您应该能够看到您的项目的一个新的“Actions”<strong class="lc iu"/>选项卡<strong class="lc iu"> </strong>，就在“pull requests”的旁边</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/9dec10196fee31e199cc4afc01a1a55d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-GyJxX-UQxdtqistE_toTA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">存储库中的“操作”选项卡。</p></figure></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="d752" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">2.添加工作流文件</h1><p id="a7c7" class="pw-post-body-paragraph la lb it lc b ld mw ju lf lg mx jx li lj my ll lm ln mz lp lq lr na lt lu lv im bi translated">GitHub为许多最流行的平台提供了预定义的工作流。您还可以在可视化编辑器中自定义或创建新的。</p><p id="ffc5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">但是在这个项目中，我们将采用手工的方法，用工作流命令创建一个YAML文件。</p><p id="21b7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在angular项目的根文件夹中，创建一个新文件夹<code class="fe nc nd ne nf b">.github,</code>，并创建一个子文件夹<code class="fe nc nd ne nf b">workflows</code>。这是我们的工作流YAML文件将驻留的地方。</p><p id="3770" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">一个项目可以有多个工作流文件，比如构建、发布等等，但是为了简单起见，我们将只为这个项目使用一个文件。在工作流文件夹中创建一个名为<code class="fe nc nd ne nf b">main.yml</code>的最终文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/d370353d2dab2d428d6f63a2624a83a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UgdJGAIEbhUgrJED_VMoUA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建GitHub文件夹并添加工作流文件</p></figure></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="aefa" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">3.编写命令</h1><p id="712f" class="pw-post-body-paragraph la lb it lc b ld mw ju lf lg mx jx li lj my ll lm ln mz lp lq lr na lt lu lv im bi translated">我们定义的第一件事是我们希望触发工作流的事件。这可以是任何GitHub事件，如<code class="fe nc nd ne nf b">push</code>、<code class="fe nc nd ne nf b">pull_request</code>、<code class="fe nc nd ne nf b">create</code>等，根据您的需求而定。</p><p id="14da" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这个项目中，我们将使用push事件。我们还可以向工作流添加一个名称来标识它。这里是<code class="fe nc nd ne nf b">main.yml</code>的完整代码。为了更好地理解，我们将浏览每一行及其用法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh kz l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">main.yml</p></figure><ul class=""><li id="7c3c" class="ni nj it lc b ld le lg lh lj nk ln nl lr nm lv nn no np nq bi translated"><code class="fe nc nd ne nf b">line 1</code>:当有人将代码推送到我们的repo时，我们希望触发我们的工作流。</li><li id="f906" class="ni nj it lc b ld nr lg ns lj nt ln nu lr nv lv nn no np nq bi translated"><code class="fe nc nd ne nf b">lines 3–8</code>:我们正在定义一个在<code class="fe nc nd ne nf b">ubuntu-latest</code>上运行的作业<code class="fe nc nd ne nf b">Build Angular</code>。每个作业都在虚拟环境的一个新实例中运行。一个作业可以包含一个或多个<code class="fe nc nd ne nf b">steps</code>。我们还定义了我们想要运行的<code class="fe nc nd ne nf b">NodeJS</code>版本。</li><li id="f197" class="ni nj it lc b ld nr lg ns lj nt ln nu lr nv lv nn no np nq bi translated">这是我们工作流程的第一步。我们将使用一个名为<code class="fe nc nd ne nf b"><a class="ae lw" href="https://github.com/actions/checkout" rel="noopener ugc nofollow" target="_blank">checkout</a></code> <em class="nw">的GitHub动作从我们的库中提取源代码。</em>此操作将您的存储库签出到<code class="fe nc nd ne nf b">$GITHUB_WORKSPACE</code>，以便您的工作流可以访问存储库的内容。</li><li id="8070" class="ni nj it lc b ld nr lg ns lj nt ln nu lr nv lv nn no np nq bi translated"><code class="fe nc nd ne nf b">lines 13–19</code>:由于我们需要在构建app之前安装项目所需的npm包，所以我们使用一个名为<code class="fe nc nd ne nf b"><a class="ae lw" href="https://github.com/marketplace/actions/cache" rel="noopener ugc nofollow" target="_blank">cache</a></code>的GitHub动作来缓存节点模块。我们配置这个步骤来跟踪我们的<code class="fe nc nd ne nf b">package-lock.json</code>对npm包的任何更改，如果没有机会，我们就使用缓存中的模块。这将有助于我们加快构建过程。</li><li id="bd27" class="ni nj it lc b ld nr lg ns lj nt ln nu lr nv lv nn no np nq bi translated"><code class="fe nc nd ne nf b">lines 20–23</code>:这里我们使用GitHub action<a class="ae lw" href="https://github.com/marketplace/actions/setup-node-js-for-use-with-actions" rel="noopener ugc nofollow" target="_blank">setup-Node</a>，其中<strong class="lc iu"> </strong>设置一个节点环境用于actions。我们使用定义操作系统时设置的节点版本的引用。</li><li id="b633" class="ni nj it lc b ld nr lg ns lj nt ln nu lr nv lv nn no np nq bi translated"><code class="fe nc nd ne nf b">lines 24–27</code>:在这一步，我们运行<code class="fe nc nd ne nf b">npm i</code>来安装所需的包，然后运行Angular build命令来创建构建包。在这个例子中，我使用了<code class="fe nc nd ne nf b">npm run build:prod</code>,因为这是我在package.json中定义的构建命令。</li></ul><p id="07ac" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="nw">在上述步骤中，您可以添加您在</em> <code class="fe nc nd ne nf b"><em class="nw">package.json</em></code> <em class="nw">中定义的任何命令。例如，您可以定义一个命令，该命令首先运行测试用例，然后创建构建。这完全取决于您的项目范围和需求。</em></p><ul class=""><li id="9816" class="ni nj it lc b ld le lg lh lj nk ln nl lr nm lv nn no np nq bi translated"><code class="fe nc nd ne nf b">lines 28–32</code>:使用一个GitHub动作<a class="ae lw" href="https://github.com/marketplace/actions/create-release" rel="noopener ugc nofollow" target="_blank"><em class="nw">Create Release</em></a><em class="nw">将构建文件推送到存储库的Release部分。</em> <strong class="lc iu"> </strong>这里，我们在构建和指定<code class="fe nc nd ne nf b">*</code>之后，指定构建文件存放的路径，以确保所有的构建文件都被推送到发布。</li><li id="39f8" class="ni nj it lc b ld nr lg ns lj nt ln nu lr nv lv nn no np nq bi translated"><code class="fe nc nd ne nf b">secrets.TOKEN</code> <strong class="lc iu"> </strong>是一个API令牌，授予对存储库的访问权。在下一步中，我们将创建一个并将其添加到我们的项目中。</li></ul></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="88ab" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">4.添加GitHub令牌</h1><p id="13bd" class="pw-post-body-paragraph la lb it lc b ld mw ju lf lg mx jx li lj my ll lm ln mz lp lq lr na lt lu lv im bi translated">我们大多数人都会在某个时候创建一个GitHub令牌来访问存储库。如果你还没有，这个过程非常简单明了。</p><ul class=""><li id="20b9" class="ni nj it lc b ld le lg lh lj nk ln nl lr nm lv nn no np nq bi translated">进入GitHub设置中的<a class="ae lw" href="https://github.com/settings/tokens" rel="noopener ugc nofollow" target="_blank">个人访问令牌</a>部分。</li><li id="a50c" class="ni nj it lc b ld nr lg ns lj nt ln nu lr nv lv nn no np nq bi translated">生成一个可以访问存储库的新令牌，并复制其值。</li><li id="98b5" class="ni nj it lc b ld nr lg ns lj nt ln nu lr nv lv nn no np nq bi translated">在<code class="fe nc nd ne nf b">&lt;repo url&gt;/settings/secrets</code>转到项目的存储库设置。在“<em class="nw">Secrets”</em>选项卡中，从您的工作流文件(本项目中为<code class="fe nc nd ne nf b">TOKEN</code>)中添加一个具有相同令牌名称的新密码，并粘贴令牌值。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/d2b5032498de900dce7552f341992b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NzWFHJPtnujzjCpmjxZKsw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在存储库设置中添加新令牌。</p></figure></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="87b3" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">5.用标签推送代码</h1><p id="82ba" class="pw-post-body-paragraph la lb it lc b ld mw ju lf lg mx jx li lj my ll lm ln mz lp lq lr na lt lu lv im bi translated">一旦我们创建了工作流文件并将令牌添加到项目中，我们就可以使用release标签将代码推送到GitHub并触发工作流。</p><p id="7ce1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在您的本地项目中，提交所有文件，包括<code class="fe nc nd ne nf b">main.yml</code> <strong class="lc iu"> </strong>和<strong class="lc iu"> </strong>使用<code class="fe nc nd ne nf b">git tag</code>命令添加一个新的标签<strong class="lc iu"> </strong>，并将代码与标签一起推送。</p><p id="d97c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">示例:</p><p id="d55c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe nc nd ne nf b">git tag v1.0</code></p><p id="67c1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe nc nd ne nf b">git push origin v1.0</code></p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="c798" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">在GitHub中查看工作流和发布</h1><p id="d946" class="pw-post-body-paragraph la lb it lc b ld mw ju lf lg mx jx li lj my ll lm ln mz lp lq lr na lt lu lv im bi translated">一旦你推送了代码，你就可以通过<code class="fe nc nd ne nf b">&lt;repo URL&gt;/actions</code>看到工作流程，通过<code class="fe nc nd ne nf b">&lt;repo URL&gt;/releases</code>看到发布文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/99654f3afacad38cd7ca6090a8401a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X5AMcyscWkd03HQ7mHkL3g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">触发的工作流历史记录</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/1bf936ba6f0662eb99b932d4a3edb23a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BK8_ur5ji_-DRvV5wtuHxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为推送事件执行的工作流命令</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/cff912fb3c1b03ac8a2117148eb7b080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rrYOOmrZ6-Wmx-ZHdYvwHQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在存储库的发布部分构建文件</p></figure></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><p id="aad0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">就是这样。你可以在<a class="ae lw" href="https://github.com/nabilnalakath/angular-github-actions/" rel="noopener ugc nofollow" target="_blank"> GitHub </a> <strong class="lc iu">上找到该项目的完整源代码。</strong>如果您有任何问题，请发表在评论区<strong class="lc iu">。</strong></p></div></div>    
</body>
</html>