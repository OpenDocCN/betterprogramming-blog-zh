<html>
<head>
<title>Build Better Svelte Stores</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建造更好的苗条商店</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-better-svelte-stores-8c70db038dd2?source=collection_archive---------7-----------------------#2020-04-01">https://betterprogramming.pub/build-better-svelte-stores-8c70db038dd2?source=collection_archive---------7-----------------------#2020-04-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a4e9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用Svelte的内置商店</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/866b0045408a1ecfc3a483651080050a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bytr3653xdXkLBtvMbuEUw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@helloimnik?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">你好我是尼克🎞</a> on <a class="ae ky" href="https://unsplash.com/s/photos/build?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="6aa2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Svelte是构建用户界面的一种全新方法。</p><p id="8c47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管React和Vue等传统框架在浏览器中完成大部分工作，但Svelte将这些工作转变为编译步骤，在构建应用程序时进行。</p><p id="997d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着您的包将没有依赖项，并且会变得更小。除此之外，Svelte的编译器会生成高度优化的代码，这意味着与React、Vue和Angular相比，你的应用程序可能会有更好的整体性能。</p><p id="eefd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你没有听说过它们，Rich Harris的视频“<a class="ae ky" href="https://www.youtube.com/watch?v=AdNJ3fydeao" rel="noopener ugc nofollow" target="_blank">反思反应性</a>”和“<a class="ae ky" href="https://www.youtube.com/watch?v=BzX4aTRPzno" rel="noopener ugc nofollow" target="_blank">‘少写多做’的回归</a>”可能是一个很好的开始。如果你对学习感兴趣，你可以从这本优秀的<a class="ae ky" href="https://svelte.dev/tutorial/basics" rel="noopener ugc nofollow" target="_blank">教程</a>开始。</p><p id="5be2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Svelte提供的开箱即用的特性之一是<code class="fe lv lw lx ly b">store</code>，这是一种在组件之间共享数据的方式，无需使用道具，也不会陷入臭名昭著的<em class="lz">渲染道具地狱。</em></p><p id="60d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Svelte的团队在提供一种非常简单和容易的方法来实现这一点方面做得很好。有两种<code class="fe lv lw lx ly b">store</code>类型:<code class="fe lv lw lx ly b">writable</code>和<code class="fe lv lw lx ly b">readable</code>。第一个可从外部更新，而另一个不可。大多数情况下，你最终会使用<code class="fe lv lw lx ly b">writable</code>类型，如下例所示。该代码创建一个初始值等于零的新商店。</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="3537" class="me mf it ly b gy mg mh l mi mj">// file store.js<br/>import { writable } from 'svelte/store'<br/>const store = writable(0)<br/>export default store;</span></pre><p id="9f33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个商店可以进口和使用任何苗条的组件。</p><p id="0b44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过使用<code class="fe lv lw lx ly b">subscribe</code>方法和<code class="fe lv lw lx ly b">set</code>或<code class="fe lv lw lx ly b">update</code>各自的方法来监听状态变化。</p><p id="dc7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了<code class="fe lv lw lx ly b">subscribe</code>，我们提供了一个回调函数，该函数接收新的存储状态值，该值可用于更新组件的局部变量。<code class="fe lv lw lx ly b">set</code>方法用传递给它的参数覆盖存储状态值。<code class="fe lv lw lx ly b">update</code>方法接收一个回调函数作为参数。回调将现有的存储值作为其参数，并返回要设置到存储区的新值。</p><p id="6de8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在下面的代码中看到这三个方法的运行:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="0529" class="me mf it ly b gy mg mh l mi mj">// file App.svelte<br/>&lt;script&gt;<br/>import { onDestroy, onMount } from 'svelte';<br/>import store from './store.js'<br/>let counter = 0;<br/>let unsubscribe;<br/>onMount(() =&gt; unsubscribe = store.subscribe(state =&gt; (counter = state)));<br/>onDestroy(() =&gt; {if (unsubscribe) unsubscribe()})<br/>const reset = () =&gt; (store.set(0));<br/>const increment = () =&gt; store.update(state =&gt; state + 1)<br/>&lt;/script&gt;<br/>&lt;main&gt;<br/>    &lt;span&gt;The counter value is {counter}&lt;/span&gt;<br/>    &lt;hr /&gt;<br/>    &lt;button on:click={increment}&gt;Increment&lt;/button&gt;<br/>    &lt;button on:click={reset}&gt;Reset&lt;/button&gt;<br/>&lt;/main&gt;</span></pre><p id="0cac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">script</code>标签中，首先我们导入先前创建的商店。然后，我们使用两个Svelte的生命周期事件(<code class="fe lv lw lx ly b">onMount</code>和<code class="fe lv lw lx ly b">onDestroy</code>)来订阅商店并用其值更新计数器，并在组件被销毁时取消订阅。我们还定义了两个方法— <code class="fe lv lw lx ly b"> reset</code>，它将值设置回零，以及<code class="fe lv lw lx ly b">increment</code>，它将存储的值加1。</p><p id="49da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在HTML部分，我们得到了一个显示计数器值(<code class="fe lv lw lx ly b">{counter}</code>)的span和两个触发我们在<code class="fe lv lw lx ly b">script</code>标签中创建的方法的按钮。</p><p id="1fb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它当然非常容易理解和使用，但是，正如我们从代码中看到的，所有的业务逻辑都直接写在组件中，这使得它很难与应用程序可能具有的其他组件共享。</p><p id="e151" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了解决这个问题，我们可以利用Svelte团队提供的优秀文档，特别是“<a class="ae ky" href="https://svelte.dev/docs#Store_contract" rel="noopener ugc nofollow" target="_blank">商店合同</a>”部分。根据定义，惟一的要求是商店必须有一个返回<code class="fe lv lw lx ly b">unsubscribe</code>方法的<code class="fe lv lw lx ly b">subscribe</code>方法。我们已经在Svelte的<code class="fe lv lw lx ly b">store</code>中实现了这一点，所以我们可以在我们的自定义商店中使用它，如下面的代码所示:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="15e8" class="me mf it ly b gy mg mh l mi mj">// file counter-store.js<br/>import { writable } from 'svelte/store';<br/>const store = writable(0);<br/>const counterStore = {<br/>  subscribe: store.subscribe,<br/>  set: store.set,<br/>  update: store.update<br/>};///<br/>export default counterStore;</span></pre><p id="7a23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的自定义存储将像Svelte的<code class="fe lv lw lx ly b">writable</code>存储一样工作，因为它只是返回一个转发<code class="fe lv lw lx ly b">subscribe</code>、<code class="fe lv lw lx ly b">set</code>和<code class="fe lv lw lx ly b">update</code>方法的对象。但是为了做得更好并从我们的组件中移除业务逻辑，我们可以在商店内部实现<code class="fe lv lw lx ly b">reset</code>和<code class="fe lv lw lx ly b">increment</code>方法:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="42a3" class="me mf it ly b gy mg mh l mi mj">// file counter-store.js<br/>import { writable } from 'svelte/store';<br/>const store = writable(0);<br/>const counterStore = {<br/>  subscribe: store.subscribe,<br/>  set: store.set,<br/>  update: store.update,<br/>  reset: store.set(0),<br/>  increment: store.update(state =&gt; state + 1)<br/>};<br/>export default counterStore;</span></pre><p id="bd5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们的组件可以被重构和简化:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="6fa8" class="me mf it ly b gy mg mh l mi mj">// file App.svelte<br/>&lt;script&gt;<br/>import { onDestroy, onMount } from 'svelte';<br/>import store from './counter-store.js'<br/>let counter = 0;<br/>let unsubscribe;<br/>onMount(() =&gt; unsubscribe = store.subscribe(state =&gt; (counter = state)));<br/>onDestroy(() =&gt; unsubcribe())<br/>const reset = () =&gt; store.reset();<br/>const increment = () =&gt; store.increment();<br/>&lt;/script&gt;<br/>&lt;main&gt;<br/>    &lt;span&gt;The counter value is {counter}&lt;/span&gt;<br/>    &lt;hr /&gt;<br/>    &lt;button on:click={increment}&gt;Increment&lt;/button&gt;<br/>    &lt;button on:click={reset}&gt;Reset&lt;/button&gt;<br/>&lt;/main&gt;</span></pre><p id="7200" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我们将业务逻辑放在商店内部，所以最好不要转发<code class="fe lv lw lx ly b">set</code>和<code class="fe lv lw lx ly b">update</code>方法，以避免组件干扰商店数据。因此，我们最终的商店代码如下所示:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="d8ff" class="me mf it ly b gy mg mh l mi mj">// file counter-store.js<br/>import { writable } from 'svelte/store';<br/>const store = writable(0);<br/>const counterStore = {<br/>  subscribe: store.subscribe,<br/>  reset: store.set(0),<br/>  increment: store.update(state =&gt; state + 1)<br/>};<br/>export default counterStore;</span></pre><p id="9a47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过这样做，任何其他需要与商店数据交互的组件都可以通过<code class="fe lv lw lx ly b">reset</code>和<code class="fe lv lw lx ly b">increment</code>方法，而不用担心它们背后的逻辑。</p><p id="f5cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里提供的代码的一个工作示例可以在这个代码沙箱的<a class="ae ky" href="https://codesandbox.io/s/medium-article-svelte-store-32cy4" rel="noopener ugc nofollow" target="_blank">中找到，供你使用，在我的GitHub账户库</a><a class="ae ky" href="https://github.com/n0n3br/svelte-createstore" rel="noopener ugc nofollow" target="_blank"> svelte-createstore，</a>你可以找到这个代码的一个更高级的版本，支持同步/异步动作和模块。</p><p id="40a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下次见。</p></div></div>    
</body>
</html>