<html>
<head>
<title>Get Started With Your First Smart Contract</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始使用您的第一份智能合同</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/get-started-with-your-first-smart-contract-de2b54261d65?source=collection_archive---------3-----------------------#2020-05-05">https://betterprogramming.pub/get-started-with-your-first-smart-contract-de2b54261d65?source=collection_archive---------3-----------------------#2020-05-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="493f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">什么是智能合约，我们如何使用以太坊的可靠性来编写它们？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9a5e1ed01c4d0685e6ce30672ead05b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bf9M14zqE7F6muQfsqrq1A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由来自<a class="ae ky" href="https://www.pexels.com/photo/round-gold-colored-ethereum-ornament-730552/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae ky" href="https://www.pexels.com/@davidmcbee?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">大卫·麦克比</a>拍摄。</p></figure><p id="eef2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">先决条件:这篇文章的目标读者是那些有初级到中级编程经验的人，他们知道以太坊和智能合约，但是不知道从哪里开始。到最后，你应该能够理解和写简单的智能合同。</em></p><p id="cf9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">把比特币钱包想象成一个你可以完全控制的银行账户。每个钱包在区块链上都有地址<em class="lv">。</em>如果你拥有私钥<em class="lv"> </em>(它就像一个无法破解的密码)，你就可以把那个钱包里的比特币发送到任何其他地址<em class="lv">。</em></p><p id="bf70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以太坊也不例外。如果你有一个以太钱包，它有一个地址，如果你有私钥，你可以发送以太到另一个地址。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="d214" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">智能合约呢？</h1><p id="456f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">智能合约和其他钱包一样有一个地址。它们也可以像其他钱包一样装东西。就底层账本而言，它是一个钱包。</p><p id="4e64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个有规则的钱包。</p><p id="950c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码控制着钱包，而不是人通过Metamask或Exodus这样的接口来控制钱包。你决定从你的钱包里把ETH发送到哪里，智能合约根据它们的规则自动做出这些决定，而无需人类的交互。一旦部署，这些规则对于该地址是不可变的。</p><p id="dd39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不可变意味着一旦这些规则被部署，它们就永远不能被改变。</p><p id="90d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些规则用代码定义，并用一种叫做Solidity的语言编写，这种语言是由<a class="ae ky" href="https://vitalik.ca/" rel="noopener ugc nofollow" target="_blank"> Vitalik Buterin </a>和<a class="ae ky" href="https://ethereum.org/" rel="noopener ugc nofollow" target="_blank">以太坊基金会</a>创建的。任何人都可以制定一些规则，编写代码，并以智能合约的形式部署到以太坊区块链。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="62f9" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">制定规则</h1><p id="603c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果你熟悉面向对象的编程语言，可以把Solidity smart contract想象成一个类。</p><p id="b6f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像任何其他语言一样，Solidity有一系列数据类型，包括:</p><ul class=""><li id="52a4" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">布尔运算</li><li id="1433" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">整数</li><li id="74e8" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">用线串</li><li id="d6c2" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">地址</li><li id="438e" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">定点数</li><li id="d81c" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">数组</li></ul><p id="7b6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">访问修饰符定义了谁和什么可以访问变量和函数:</p><ul class=""><li id="8dc1" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">公共</li><li id="1abb" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">私人的</li><li id="9974" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">内部的</li><li id="7a1e" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">外部的</li></ul><p id="c88c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">智能协定可以有状态和局部变量、构造函数和函数。</p><p id="c62d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至关重要的是，Solidity允许任何合同使用全局可用的变量来访问区块链信息(如特定地址有多少ETH)。这些对于执行基于规则的安全操作至关重要，例如将ETH发送到其他地址。</p><p id="c24c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果智能合约是一个有规则的钱包，让我们以此为例。让我们创建一个简单的钱包契约，它可以保存、发送和接收ETH。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1: MyWallet.sol</p></figure><p id="14a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从上到下，然后检查我们是否满足我们为钱包设定的所有标准。</p><h2 id="47df" class="nq me it bd mf nr ns dn mj nt nu dp mn li nv nw mp lm nx ny mr lq nz oa mt ob bi translated">定义坚实度版本</h2><p id="c1d3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">用<code class="fe oc od oe of b">pragma solidity …</code>定义solidity编译器版本。我们这里用的是<code class="fe oc od oe of b">0.6.0</code>。</p><h2 id="91e0" class="nq me it bd mf nr ns dn mj nt nu dp mn li nv nw mp lm nx ny mr lq nz oa mt ob bi translated">定义合同名称</h2><pre class="kj kk kl km gt og of oh oi aw oj bi"><span id="33a8" class="nq me it of b gy ok ol l om on">contract MyWallet {</span></pre><h2 id="0dc8" class="nq me it bd mf nr ns dn mj nt nu dp mn li nv nw mp lm nx ny mr lq nz oa mt ob bi translated">所有者状态变量</h2><p id="6489" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们需要追踪这个钱包的主人。这存储在一个名为<code class="fe oc od oe of b">owner</code>的状态变量中，我们在契约中定义了这个变量，但是不包含在任何函数中。这意味着所有函数都可以访问存储在这个变量中的值。</p><p id="2ca1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它具有<code class="fe oc od oe of b">private</code>可见性，意味着只有该契约中的函数可以访问它。它存储<code class="fe oc od oe of b">address payable</code>类型的数据。<code class="fe oc od oe of b">payable</code>表示本合同可以向其发送以太。</p><h2 id="6337" class="nq me it bd mf nr ns dn mj nt nu dp mn li nv nw mp lm nx ny mr lq nz oa mt ob bi translated">构造函数</h2><p id="c0f6" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><code class="fe oc od oe of b">constructor()</code>在区块链上创建合同时执行。这个函数中唯一的一行是存储部署者的地址。我们已经知道每个智能合约都有一个地址，但是它们必须使用现有的地址进行部署。</p><p id="29b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们第一次看到全局变量的用法。<code class="fe oc od oe of b">msg.sender</code>表示部署者的地址(执行此功能的人/钱包/智能契约)。</p><p id="2032" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任何地址都可以部署智能合约或调用智能合约中的任何功能，无论是人控钱包还是另一个智能合约。</p><p id="da72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一点上，有两个地址在起作用:部署者地址(<code class="fe oc od oe of b">msg.sender</code>)和这个契约被部署到的地址(在我们研究代码时会有更多的介绍)。</p><h2 id="8924" class="nq me it bd mf nr ns dn mj nt nu dp mn li nv nw mp lm nx ny mr lq nz oa mt ob bi translated">接受乙醚</h2><p id="e7b9" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为了让这个契约能够从发送给它的地址接收ETH，它需要一个<code class="fe oc od oe of b">receive()</code>函数。这是Solidity中定义的一个特殊功能，任何希望接收ETH的合同都必须实现该功能。它必须有访问修饰符<code class="fe oc od oe of b">external</code>以便外部地址可以访问它，并且它必须是<code class="fe oc od oe of b">payable</code>，这意味着它可以接收ETH(很像我们的所有者可以接收ETH，因此也是可支付的)。</p><h2 id="cc03" class="nq me it bd mf nr ns dn mj nt nu dp mn li nv nw mp lm nx ny mr lq nz oa mt ob bi translated">发送乙醚</h2><p id="1b8b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">最后一个函数叫做<code class="fe oc od oe of b">sendEther()</code>。这有助于所有者将ETH从这个钱包合同发送到另一个地址。它有两个参数:发送ETH的地址和发送的数量。</p><p id="8f9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意在这个函数的开始有两个<code class="fe oc od oe of b">require</code>语句。这些确保了在函数继续之前某些标准为真。如果任何要求失败，事务将完全恢复。</p><p id="952c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个要求:</p><pre class="kj kk kl km gt og of oh oi aw oj bi"><span id="ff05" class="nq me it of b gy ok ol l om on">require(msg.sender == owner, "...");</span></pre><p id="d708" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这确保了调用该函数的地址是钱包的所有者。我们不希望任何不是所有者的人能够将ETH发送给其他人。应该只有所有者能够做到这一点。</p><p id="10a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个要求:</p><pre class="kj kk kl km gt og of oh oi aw oj bi"><span id="185e" class="nq me it of b gy ok ol l om on">require(address(this).balance &gt;= _amount, "...");</span></pre><p id="da8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这确保了钱包契约有足够的ETH来发送。它不能转让超过它拥有的。</p><p id="e83c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是使用全局可访问变量来查询该合同的ETH数量的另一个示例。<code class="fe oc od oe of b">address(this)</code>获取该智能合约部署到的地址，然后<code class="fe oc od oe of b">.balance</code>返回该地址拥有的ETH数量。只要它大于或等于函数想要发送的数量(<code class="fe oc od oe of b">_amount</code>，那么我们就可以继续！</p><p id="52f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，该函数使用<code class="fe oc od oe of b">_to.transfer(_amount);</code>将ETH发送到目标地址。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="317b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">它做了我们想要的吗？</h1><p id="419c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们需要一个智能契约，它可以充当钱包，可以容纳、发送和接收电子邮件。我们知道可以使用<code class="fe oc od oe of b">receive()</code>函数接收并保存它，也可以使用<code class="fe oc od oe of b">sendEther()</code>函数将ETH发送到其他地址。此外，只有该契约的所有者可以调用<code class="fe oc od oe of b">sendEther()</code>，使其安全。</p><p id="61a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它确实做到了我们想要的！</p><p id="e763" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就钱包而言，这是非常原始的，并不能满足我们对钱包的期望。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="073e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">现在轮到你了</h1><p id="b512" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">使用这段代码，尝试添加一些功能。首先，添加一个返回钱包余额的函数。</p><p id="c6a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你认为你已经实现了一些很酷的新特性，请在评论中添加你的代码。</p><p id="1f21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要了解智能合约的用途，请阅读下一篇解释如何创建ERC20令牌的文章:</p><div class="oo op gp gr oq or"><a href="https://medium.com/better-programming/what-are-smart-contracts-used-for-2583af2c62bc" rel="noopener follow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">智能合约有什么用途？</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">智能合约如何用于创建令牌</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">medium.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf ks or"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8bc0" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">进一步阅读</h1><p id="f4c5" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果你对区块链开发感兴趣，我会写一些教程、演练、提示以及如何开始和建立投资组合的技巧。</p><p id="371f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看以下资源:</p><div class="oo op gp gr oq or"><a href="https://medium.com/blockcentric/blockchain-development-resources-b44b752f3248" rel="noopener follow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">区块链开发资源马上跟进</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">学习区块链、以太坊和DApp开发的资源列表</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">medium.com</p></div></div><div class="pa l"><div class="pg l pc pd pe pa pf ks or"/></div></div></a></div></div></div>    
</body>
</html>