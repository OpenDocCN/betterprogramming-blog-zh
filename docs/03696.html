<html>
<head>
<title>PostgreSQL and the Foreign Data Wrapper</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PostgreSQL和外部数据包装器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/postgresql-and-the-foreign-data-wrapper-2f5c5aaf20d4?source=collection_archive---------8-----------------------#2020-02-27">https://betterprogramming.pub/postgresql-and-the-foreign-data-wrapper-2f5c5aaf20d4?source=collection_archive---------8-----------------------#2020-02-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e317" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您的远程数据库不那么远程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/ab1bfb6da1be7adfda8c8ad55c7f2967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8Os-Bh3sZlAkf8Li.gif"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">资料来源:postgresql.org</p></figure><p id="ded8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">较大的数据库部署可能需要跨不同资源或主机运行多个<code class="fe lq lr ls lt b">Postgres</code>实例。随着时间的推移，管理对多个实例的分布式访问、跟踪权限、管理IP等会变得复杂而繁琐。</p><p id="bdf2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这让您希望有某种方式来集中您的所有数据…</p><p id="6cc4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">嗯，有！</p><p id="fd10" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不，它不是一些第三方插件或单独的聚合数据库。它是<em class="lu">外国数据包装器</em>。</p><p id="4eb4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是对<code class="fe lq lr ls lt b">Postgres</code>的一个非常方便的扩展，允许您将远程服务器添加到现有实例中，并像查询本地表一样查询它们。<em class="lu">牛逼！</em></p><p id="3f19" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在几个简单的命令中，您可以设置到远程服务器之一的映射。让我们来探索一下这是什么样子的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7e50" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">添加扩展名</h1><p id="941a" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">只要您使用的是最近的<code class="fe lq lr ls lt b">Postgres</code>版本，您应该能够用这个简单的命令创建扩展:</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="4525" class="nd md it lt b gy ne nf l ng nh">CREATE EXTENSION IF NOT EXISTS postgres_fdw;</span></pre><h2 id="9787" class="nd md it bd me ni nj dn mi nk nl dp mm ld nm nn mo lh no np mq ll nq nr ms ns bi translated">添加服务器</h2><p id="cb25" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">现在，我们将使用刚刚添加的外部数据包装器扩展来设置远程服务器。请随意给它起一个独特的名字:</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="419f" class="nd md it lt b gy ne nf l ng nh">CREATE SERVER &lt;remote_server_name&gt;<br/>FOREIGN DATA WRAPPER postgres_fdw<br/>OPTIONS (dbname '&lt;database_name_on_server&gt;', ...)</span></pre><p id="4c41" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些只是部分选择。有关远程服务器连接选项的完整列表，请访问:<a class="ae nt" href="https://www.postgresql.org/docs/9.5/postgres-fdw.html" rel="noopener ugc nofollow" target="_blank">https://www.postgresql.org/docs/9.5/postgres-fdw.html</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a9a9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">映射用户权限</h1><p id="db8b" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">为了能够查询远程数据库，它必须知道以什么用户的身份执行操作。为此，您必须为刚刚添加的服务器添加一个用户映射。这实际上是将服务器上的本地用户映射到远程服务器上的用户。</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="9cc6" class="nd md it lt b gy ne nf l ng nh">CREATE USER MAPPING FOR &lt;local_username&gt;<br/>SERVER &lt;remote_server_name&gt;<br/>OPTIONS (user '&lt;remote_username&gt;', password '&lt;remote_pass&gt;', ...);</span></pre><p id="23de" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样，这些并不是所有可用的选项。有关更多信息，请参考上面服务器部分的链接。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="631e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">导入表或模式</h1><p id="b6bd" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">现在您已经添加了服务器和用户信息，您可以开始导入数据了。此时你有几个选择。两种主要方法是导入单个表(一个接一个)或导入整个远程模式。</p><p id="0a95" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们看看第一个选项是如何工作的:</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="b866" class="nd md it lt b gy ne nf l ng nh">CREATE FOREIGN TABLE &lt;table_name&gt; (id bigint, field1 text)<br/>SERVER &lt;remote_server_name&gt;<br/>OPTIONS (schema_name 'public', table_name 'my_table');</span></pre><p id="f4bd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用这种方法，您必须指定远程表的列和数据类型细节。在下一个方法中，我们将创建一个全新的模式，并将远程服务器的模式导入其中:</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="b953" class="nd md it lt b gy ne nf l ng nh">CREATE SCHEMA &lt;new_local_schema_name&gt;<br/>IMPORT FOREIGN SCHEMA &lt;remote_server_schema_name&gt;<br/>LIMIT TO (table1, table2, table3, ...)<br/>FROM SERVER &lt;remote_server_name&gt;<br/>INTO &lt;new_local_schema_name&gt;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="86e9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">查询时间！</h1><p id="eb87" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">现在一切都设置好了，您应该能够向远程服务器查询数据了。假设权限映射正确，上下文相当简单:</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="5abd" class="nd md it lt b gy ne nf l ng nh">SELECT * FROM &lt;my_local_schema&gt;.&lt;remote_table&gt; LIMIT 1;</span></pre><p id="a775" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果一切正常，您应该会看到从远程服务器的表中返回一行。</p><p id="5eeb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当你在整个过程中给每个元素命名时，如果你能想出一个容易推断的逻辑方案，那将会很有帮助。例如，如果您有一个从<code class="fe lq lr ls lt b">Postgres</code>实例到主机的一对一映射，那么您可以使用该主机的主机名作为远程服务器和远程模式。这将有助于您编写查询，因为您将能够快速判断什么映射到什么。</p><p id="baf8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">外来数据包装器是一种快速有效的方法，可以快速设置对分布式<code class="fe lq lr ls lt b">Postgres</code>实例的访问。能够从一个集中点进行查询减少了权限和访问管理的管理开销。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="ad90" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lu">感谢查看我关于</em> <code class="fe lq lr ls lt b"><em class="lu">Postgres</em></code> <em class="lu">的最新文章！如果你喜欢这篇文章，可以看看我的其他以开发者为中心的文章。</em></p></div></div>    
</body>
</html>