<html>
<head>
<title>Getting Rid of Hardcoded Python Variables With the Dotenv Module</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Dotenv模块摆脱硬编码的Python变量</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-rid-of-hardcoded-python-variables-with-the-dotenv-module-d0aff8ce0c80?source=collection_archive---------2-----------------------#2021-08-24">https://betterprogramming.pub/getting-rid-of-hardcoded-python-variables-with-the-dotenv-module-d0aff8ce0c80?source=collection_archive---------2-----------------------#2021-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9d10" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">提高代码可维护性和抵御Google dorking攻击的安全性</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d2f6af5382bbc99b5f371569d7441b07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V6ueg410lcQp5FD2"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@firmbee?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Firmbee.com</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="9f18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个程序员都编写过一些应用程序硬编码的全局设置和变量。虽然在一个简单的脚本中使用这种方法没有错，但是在一个更方便的地方为一个更大的应用程序定义配置可能是值得的。</p><p id="b44e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:在本文中，我将互换使用术语“全局变量”和“常量”。</p><p id="45ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看几个包含常量的代码示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="1b72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，把URL直接写成函数调用的参数也没什么问题。但是，如果您必须在应用程序中多次请求同一个网页，那该怎么办呢？你可能会用这样的全局常量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="0550" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种方法不一定不好，但是如果你的代码被分成不同的文件，可能会适得其反。在每个文件中定义相同的变量既耗时又不可维护，因为更改变量需要您手动检查应用程序中的每个文件。在这种情况下，设置文件可能是一个不错的选择。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="d9e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要访问名为<code class="fe lx ly lz ma b">global_settings.py</code>的设置文件中声明的常量，只需像这样导入它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="95e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一种更简洁的方式来声明应用程序可以访问的变量。但是要注意在源文件中存储敏感信息的潜在安全问题。</p><h2 id="4a0f" class="mb mc it bd md me mf dn mg mh mi dp mj li mk ml mm lm mn mo mp lq mq mr ms mt bi translated">硬编码变量的安全问题</h2><p id="58e9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设您决定开源您的应用程序:可能会出什么问题呢？如果您的设置文件看起来像这样会怎么样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="745c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任何恶意用户都可能在几秒钟内接管您的应用程序。<a class="ae ky" href="https://en.wikipedia.org/wiki/Google_hacking" rel="noopener ugc nofollow" target="_blank"> Google dorking </a>是一种黑客技术，它利用谷歌的搜索引擎和工具，通过简单的浏览器查询来暴露公众可获得的信息或关于目标的错误配置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/cda534048d821ddaebded08923046873.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wUEqt9RFaPuWeDU9.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Google dorking的例子。来源:<a class="ae ky" href="https://www.securitynewspaper.com/2020/03/05/see-how-to-search-username-passwords-configuration-files-emails-open-cameras-on-google/" rel="noopener ugc nofollow" target="_blank">https://www . security news paper . com/2020/03/05/see-how-to-search-username-passwords-configuration-files-emails-open-camera-on-Google/</a></p></figure><p id="79df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要了解更多关于流行的谷歌呆子，请查看这个指南。</p><h2 id="c0ca" class="mb mc it bd md me mf dn mg mh mi dp mj li mk ml mm lm mn mo mp lq mq mr ms mt bi translated">Python设置文件的兼容性问题</h2><p id="e8d4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Python文件在纯Python环境中工作得很好。当你在应用程序中加入其他技术时，麻烦就开始了，比如<a class="ae ky" href="https://en.wikipedia.org/wiki/Docker_(software)" rel="noopener ugc nofollow" target="_blank"> Docker </a>。您可能需要为Docker和Python文件设置全局常量，回到在不同的地方定义相同的变量。</p><h2 id="ea14" class="mb mc it bd md me mf dn mg mh mi dp mj li mk ml mm lm mn mo mp lq mq mr ms mt bi translated">使用环境变量</h2><p id="2cb2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">更安全的方法是将全局设置存储在环境变量中。它们将在整个应用程序中共享，而不仅仅是Python可以访问。根据应用程序的部署环境，可以对它们进行不同的定义。此外，环境变量是不公开的，因此对谷歌呆子是安全的。</p><p id="268b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">定义环境变量的一个简单方法是通过一个<code class="fe lx ly lz ma b">.env</code>文件。这种类型的文件使用简单的Bash式语法。这里有一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><h2 id="6301" class="mb mc it bd md me mf dn mg mh mi dp mj li mk ml mm lm mn mo mp lq mq mr ms mt bi translated">用Python-dotenv模块加载环境变量</h2><p id="a87b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">可以通过以下方式轻松安装<a class="ae ky" href="https://pypi.org/project/python-dotenv/" rel="noopener ugc nofollow" target="_blank"> Python-dotenv </a>模块</p><pre class="kj kk kl km gt na ma nb nc aw nd bi"><span id="694e" class="mb mc it ma b gy ne nf l ng nh">pip install python-dotenv</span></pre><p id="d32b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，使用该模块非常简单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="f83f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，<code class="fe lx ly lz ma b">load_dotenv()</code>函数搜索与Python文件位于同一目录下的一个名为<code class="fe lx ly lz ma b">.env</code>的文件。您可以通过像这样传递<code class="fe lx ly lz ma b">dotenv_path</code>参数来覆盖这种行为:</p><pre class="kj kk kl km gt na ma nb nc aw nd bi"><span id="35ec" class="mb mc it ma b gy ne nf l ng nh">load_dotenv(dotenv_path='path/to/.env')</span></pre><h2 id="8e6b" class="mb mc it bd md me mf dn mg mh mi dp mj li mk ml mm lm mn mo mp lq mq mr ms mt bi translated">将配置载入字典</h2><p id="8b54" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可能希望将所有设置分组到一个Python字典中。Python-dotenv通过使用<code class="fe lx ly lz ma b">dotenv_values()</code>方法使之变得简单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><h2 id="22be" class="mb mc it bd md me mf dn mg mh mi dp mj li mk ml mm lm mn mo mp lq mq mr ms mt bi translated">使用Python-dotenv的Python设置文件</h2><p id="4e05" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">尽管有我之前提到的安全问题，使用一个<code class="fe lx ly lz ma b">.env</code>文件使得使用Python设置文件变得安全。如前所述，这个文件可以从应用程序中的其他Python文件导入，以访问全局设置。下面是这样一个文件的示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><h2 id="a154" class="mb mc it bd md me mf dn mg mh mi dp mj li mk ml mm lm mn mo mp lq mq mr ms mt bi translated">隐藏了。环境文件</h2><p id="535f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我以前讨论过公开设置文件的安全问题。包含敏感数据。由于<code class="fe lx ly lz ma b">.env</code>文件依赖于部署环境，它们不应该存储在任何私有或公共的存储库中。为了防止将它们推送到存储库，应该将<code class="fe lx ly lz ma b">.env</code>添加到应用程序的<code class="fe lx ly lz ma b">.gitignore</code>文件中。</p><h2 id="dbc2" class="mb mc it bd md me mf dn mg mh mi dp mj li mk ml mm lm mn mo mp lq mq mr ms mt bi translated">快速回顾一下</h2><ul class=""><li id="2c86" class="ni nj it lb b lc mu lf mv li nk lm nl lq nm lu nn no np nq bi translated">安装<code class="fe lx ly lz ma b">python-dotenv</code>模块。</li><li id="838e" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">用适当的配置创建<code class="fe lx ly lz ma b">.env</code>文件。</li><li id="b81b" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">将其添加到<code class="fe lx ly lz ma b">.gitignore</code>文件中。</li><li id="df2e" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">使用<code class="fe lx ly lz ma b">python-dotenv</code>模块将配置加载到Python文件中。</li></ul><p id="fc3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>