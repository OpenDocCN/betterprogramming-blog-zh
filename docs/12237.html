<html>
<head>
<title>Taking Your App Offline With the Salesforce Mobile SDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Salesforce Mobile SDK使您的应用程序离线</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/taking-your-app-offline-with-the-salesforce-mobile-sdk-3300719d0301?source=collection_archive---------16-----------------------#2022-05-20">https://betterprogramming.pub/taking-your-app-offline-with-the-salesforce-mobile-sdk-3300719d0301?source=collection_archive---------16-----------------------#2022-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="100b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">请继续阅读，寻找一种简单的方法来切断你的应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5e4159426c195a752401026647cd5a37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VjN0OU1AkZZI0dCznh6mow.jpeg"/></div></div></figure><p id="4d4c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">去年，我和妻子第一次体验了建造一个全新的家。这个过程既有趣又令人兴奋，但我们也经历了新住宅小区经常出现的意想不到的互联网服务中断。</p><p id="c4ff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">虽然这些中断影响了我家人的流媒体服务能力，如亚马逊Prime、Hulu和网飞，但我继续从事我目前的项目，因为我设计它在隔离(或离线)状态下工作。当我一年中在内华达州和佛罗里达州工作时，这在航空旅行中总是很有帮助。</p><p id="99a5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这让我想知道为什么更多的移动应用程序没有被设计成在互联网服务中断时继续工作。</p><p id="0722" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇文章中，我将展示让您的移动应用程序在离线模式下可用是多么简单。由于我最近花了一些时间在<a class="ae ln" href="https://developer.salesforce.com/docs/atlas.en-us.mobile_sdk.meta/mobile_sdk/intro.htm" rel="noopener ugc nofollow" target="_blank"> Salesforce Mobile SDK </a>上，我想继续探索移动应用选项。</p><h1 id="46ed" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">使用Salesforce Mobile SDK脱机工作</h1><p id="541c" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">在我们开始编写代码之前，让我们简单了解一下离线功能如何与Salesforce Mobile SDK一起工作。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/8cc4a6234033b3ea748e84307e8948b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*llwmgRIz9j-_UiAe0eim_w.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">传统Salesforce用法</p></figure><p id="124c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">插图的左侧显示了Salesforce应用程序的传统使用方式。右侧提供了Salesforce Mobile SDK的高级概述。</p><p id="d9c0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行在Android或iOS设备上的原生应用可以用Android Studio、Xcode或React Native编写。这些应用程序包括用户界面、某种级别的业务逻辑以及代表最终存在于Salesforce中的元素的模型对象。</p><p id="1698" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Salesforce Mobile SDK包括SmartStore方面，当移动应用程序无法访问Salesforce服务时，该方面使数据可用。模型层可以很容易地设计为在需要(或首选)离线模式时利用SmartStore，并且当在线状态可用时，它还使smart store准备好与Salesforce同步所有更改。</p><p id="71ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您想了解更多关于该设计的信息，请查看“<a class="ae ln" href="https://developer.salesforce.com/docs/atlas.en-us.noversion.mobile_sdk.meta/mobile_sdk/offline_intro.htm" rel="noopener ugc nofollow" target="_blank">使用智能商店安全存储离线数据</a></p><h1 id="0b60" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">给芬尼食品增加离线功能</h1><p id="7945" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">今年早些时候，我开发了Salesforce Mobile SDK，并创建了一个名为Finny's Foods的虚拟应用程序。我用Android、iOS和React Native三次创建了这个应用程序。我想我会从使用iOS/Xcode (Swift)版本的Salesforce Mobile SDK的<a class="ae ln" href="https://dzone.com/articles/exploring-the-salesforce-mobile-sdk-using-xcode" rel="noopener ugc nofollow" target="_blank">出版物</a>开始，然后在它的基础上提供离线功能。</p><p id="a2c3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面列出了原始文章的GitLab存储库:</p><p id="1bf5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://gitlab.com/johnjvester/finnys-foods-ios" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/johnjvester/finnys-foods-ios</a></p><p id="fd26" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第一步是在SmartStore功能使用的<code class="fe mq mr ms mt b">userstore.json</code>文件中建立<code class="fe mq mr ms mt b">Meal__c</code>对象。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="1bd7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，更新<code class="fe mq mr ms mt b">usersyncs.json</code>文件，使当前的用餐列表离线可用:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="e3dc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以在“<a class="ae ln" href="https://developer.salesforce.com/docs/atlas.en-us.noversion.mobile_sdk.meta/mobile_sdk/offline_config_files.htm" rel="noopener ugc nofollow" target="_blank">用配置文件</a>注册Soups”中了解所有关于SmartStore同步配置的信息</p><p id="71fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">准备好SmartStore配置后，我重构了<code class="fe mq mr ms mt b">MealsListModel.swift</code>类，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="9588" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我更新了<code class="fe mq mr ms mt b">fetchMeals()</code>功能，以便在默认情况下与SmartStore交互，在需要时调用Salesforce，但如果设备处于离线模式，则允许使用应用程序中存储的数据。</p><p id="1007" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">信不信由你，这就是所需要的。</p><h1 id="fdda" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">芬尼食品的线下行动</h1><p id="5cf8" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">从Xcode和一个iPhone 8模拟器启动Finny's Foods后，我们看到下面的屏幕显示，就像在原始出版物中一样。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/0c8d1ff13043e5f5bdff3c35ae973376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*45nTfPEvwq1wnRQBxzR1cw.png"/></div></div></figure><p id="6509" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果我断开设备与互联网的连接并重新加载应用程序，Xcode中会出现以下日志:</p><pre class="kg kh ki kj gt mx mt my mz aw na bi"><span id="c09c" class="nb lp iq mt b gy nc nd l ne nf">2022-03-14 16:14:15.544412-0400 FinnysFoodsIOS[88679:6546397] [MobileSync] CLASS: SFSyncDownTask runSync failed:{ ... } cause:Server call for sync down failed errorError Domain=NSURLErrorDomain Code=-1009 "The Internet connection appears to be offline."</span></pre><p id="cba3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是，应用程序仍然从SmartStore加载并提供数据。事实上，如果不查看Xcode中的日志，我根本不知道我正在处理数据的本地版本。</p><p id="068a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于允许添加或更新数据的离线应用程序，SmartStore能够使用同步管理器合并离线和在线数据。更多信息请参见<a class="ae ln" href="https://developer.salesforce.com/docs/atlas.en-us.mobile_sdk.meta/mobile_sdk/entity_framework_native_requests.htm" rel="noopener ugc nofollow" target="_blank">同步数据</a>文档。</p><h1 id="5de1" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">结论</h1><p id="bf15" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">虽然互联网连接不断改善，但不能100%保证连接可靠。具有前瞻性的功能开发人员应该考虑采取适当的措施，让他们的应用程序在互联网连接不可用时继续工作。问问自己:我的应用程序在断开连接的状态下工作时如何才能更好？</p><p id="b3eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">自2021年以来，我一直试图按照以下使命宣言生活，我觉得这可以适用于任何IT专业人士:</p><blockquote class="ng nh ni"><p id="1f20" class="kr ks nj kt b ku kv jr kw kx ky ju kz nk lb lc ld nl lf lg lh nm lj lk ll lm ij bi translated"><em class="iq">“将您的时间集中在提供扩展您知识产权价值的特性/功能上。将框架、产品和服务用于其他一切。”<br/> — J. Vester </em></p></blockquote><p id="6f5f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我提供了一个使用Salesforce Mobile SDK实现离线功能的简单示例。Salesforce engineering在模型层设计了集成点，这是确定是否可以检索实时数据或是否应该返回SmartStore数据的最佳位置。</p><p id="7c86" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">显然，Salesforce坚持我的个人使命，提供了一个易于使用的设计，没有大量的样板代码。</p><p id="6572" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您对本文的源代码感兴趣，可以在GitLab上找到它:</p><p id="05b3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://gitlab.com/johnjvester/finnys-foods-ios" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/johnjvester/finnys-foods-ios</a></p><p id="3082" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">祝你今天过得愉快！</p></div></div>    
</body>
</html>