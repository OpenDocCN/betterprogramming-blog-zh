<html>
<head>
<title>A Gentle Introduction to Using Scrapy to Crawl Airbnb Listings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Scrapy抓取Airbnb房源的温和介绍</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-gentle-introduction-to-using-scrapy-to-crawl-airbnb-listings-58c6cf9f9808?source=collection_archive---------0-----------------------#2019-07-13">https://betterprogramming.pub/a-gentle-introduction-to-using-scrapy-to-crawl-airbnb-listings-58c6cf9f9808?source=collection_archive---------0-----------------------#2019-07-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6846" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">scrapy中的网页抓取项目入门</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/499ae3e9d539a3d3b5f2215215109af8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J-BMHQV4LOpVjs0uwGs35A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">isles mujèRES(2019春季旅行)</p></figure><p id="6897" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇文章中，我将详细介绍如何搜集Airbnb房源。</p><p id="fe97" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Airbnb是一个网站，允许用户将他们的地方出租给其他用户短期居住(通常是短期)。如果你想和一大群人一起旅行，这是一个很好的选择。我最近对抓取Airbnb感兴趣，因为我想解决我在使用该网站时遇到的一个问题。</p><p id="001c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这篇文章将作为那些有兴趣在<a class="ae lu" href="https://scrapy.org/" rel="noopener ugc nofollow" target="_blank"> scrapy </a>中开始网络抓取项目的人的指南。</p><p id="a516" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，scrapy是一个用于更复杂抓取项目的网络抓取框架。对于较大的抓取项目来说，它比其他web抓取库，如<code class="fe lv lw lx ly b">BeautifulSoup </code>或<code class="fe lv lw lx ly b">Requests</code>要好得多。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="1492" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">设置开发环境</h1><p id="a830" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">让我们从头开始！第一步，安装Python！获得Python最简单的方法就是使用<code class="fe lv lw lx ly b">pyenv</code>。这是一个轻量级的Python版本管理工具，可以让您轻松地在多个Python版本之间切换。</p><p id="3d44" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> Python用户可以简单地跳过1.1-1.2部分，但一定要使用Python 3.6.x版本。</strong></p><p id="8661" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">确保你的Python版本<strong class="la iu">不是</strong> 3.7，因为它不能很好地与scrapy集成！</p><h2 id="5de0" class="nd mh it bd mi ne nf dn mm ng nh dp mq lh ni nj ms ll nk nl mu lp nm nn mw no bi translated">1.安装pyenv</h2><p id="4d4d" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">如果你还没有安装它，你可以按照这些说明。</p><p id="6b51" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您在安装过程中遇到一些问题，<a class="ae lu" href="https://github.com/pyenv/pyenv/wiki/Common-build-problems" rel="noopener ugc nofollow" target="_blank">这是一个有用的第一个位置来查看</a>，因为在安装之前<code class="fe lv lw lx ly b">pyenv</code>有一些您需要的依赖项。</p><h2 id="8be1" class="nd mh it bd mi ne nf dn mm ng nh dp mq lh ni nj ms ll nk nl mu lp nm nn mw no bi translated">2.安装Python</h2><p id="b47d" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">现在，我们可以打开终端并运行以下命令:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="9b7a" class="nd mh it ly b gy nt nu l nv nw">pyenv install 3.6.5</span></pre><p id="09f6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们可以通过运行以下命令来设置Python版本:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="b3c7" class="nd mh it ly b gy nt nu l nv nw">nano ~/.pyenv/version</span></pre><p id="a450" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并输入<code class="fe lv lw lx ly b">3.6.5</code>。您可以通过运行命令<code class="fe lv lw lx ly b">python -V</code>来验证您使用的是正确的版本。现在应该是<code class="fe lv lw lx ly b">Python 3.6.5</code>了。</p><h2 id="2557" class="nd mh it bd mi ne nf dn mm ng nh dp mq lh ni nj ms ll nk nl mu lp nm nn mw no bi translated">3.安装刮刀</h2><p id="98a7" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">我们可以简单地运行以下命令来安装scrapy:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="fb52" class="nd mh it ly b gy nt nu l nv nw">pip install scrapy</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="ff97" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">创建我们的Airbnb蜘蛛</h1><p id="ec0e" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">现在我们的环境已经设置好了，我们终于可以开始一个scrapy项目了！在此之前，我建议为项目创建一个文件夹。我为这个项目创建了一个<code class="fe lv lw lx ly b">scrapy_tutorial</code>文件夹。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/1e6e09379ce87583ee495281d0eca6f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frlvFI3N89IUXXu-n8FiBg.png"/></div></div></figure><h2 id="e6f3" class="nd mh it bd mi ne nf dn mm ng nh dp mq lh ni nj ms ll nk nl mu lp nm nn mw no bi translated">开始一个零碎的项目</h2><p id="8bd6" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">在终端中导航到您的文件夹(如<code class="fe lv lw lx ly b">cd desktop/learning/scrapy_tutorial</code>)后，您可以通过运行以下命令创建一个新项目:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="a3ca" class="nd mh it ly b gy nt nu l nv nw">scrapy startproject airbnb_tutorial</span></pre><p id="e35f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将创建一个名为<code class="fe lv lw lx ly b">airbnb_tutorial</code>的项目模板。我将继续在<a class="ae lu" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank"> VSCode </a>中打开这个项目。尽管你可以随意使用任何你觉得舒服的文本编辑器或IDE！</p><p id="365f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以通过运行以下命令来创建一个通用爬行器，用于抓取Airbnb列表:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="2838" class="nd mh it ly b gy nt nu l nv nw">scrapy genspider airbnb www.airbnb.com</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/a38629753247dc9b131a9020a0b7487a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Lv_CRRD3HPpUO9VVgxaxQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">零碎设置</p></figure><p id="1187" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这应该会生成一个类似上面文件的蜘蛛。现在我们准备开始刮！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="a064" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">我们开始刮吧！</h1><p id="584a" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">通常当我着手刮削项目时，我首先会考虑这个问题:</p><p id="e151" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我能刮到的最低级的物体是什么？</p><p id="6681" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，它可以是一个单一的家上市，单页上市，或任何东西！经过一些调查和大量的反复试验，我找到了XML HTTP请求<strong class="la iu"> </strong>的位置，该请求为一个Airbnb页面返回一个<code class="fe lv lw lx ly b">JSON</code>对象。请注意，从Airbnb获取<code class="fe lv lw lx ly b">GET</code>信息还有其他方法，但我发现以下方法最方便！</p><h2 id="da13" class="nd mh it bd mi ne nf dn mm ng nh dp mq lh ni nj ms ll nk nl mu lp nm nn mw no bi translated">1.获取我们的请求URL</h2><p id="e182" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">假设我们正在墨西哥的坎昆找房子。我们的登录页面看起来会像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/e71dcc6213fb5f551266ddcf25e24bb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k47TvEtW0IMr6JRml33etw.png"/></div></div></figure><p id="0937" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们可以按照以下步骤获取请求URL:</p><ol class=""><li id="371d" class="oa ob it la b lb lc le lf lh oc ll od lp oe lt of og oh oi bi translated">在页面上单击鼠标右键，然后单击进行检查</li><li id="2b69" class="oa ob it la b lb oj le ok lh ol ll om lp on lt of og oh oi bi translated">转到网络选项卡</li><li id="2811" class="oa ob it la b lb oj le ok lh ol ll om lp on lt of og oh oi bi translated">重新加载页面</li><li id="cc36" class="oa ob it la b lb oj le ok lh ol ll om lp on lt of og oh oi bi translated">寻找一个以<code class="fe lv lw lx ly b">explore_tabs?_format</code>开头的条目，点击进入</li><li id="1a36" class="oa ob it la b lb oj le ok lh ol ll om lp on lt of og oh oi bi translated">复制顶部的请求URL</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/c163fa94f1be4c12f6fbd2a11c3cacb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nWDtDCbcvOojYbYrYxzGdQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">简短演示</p></figure><p id="183e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">既然您已经获取了请求URL，它应该看起来像下面这样:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="923d" class="nd mh it ly b gy nt nu l nv nw"><a class="ae lu" href="https://www.airbnb.ca/api/v2/explore_tabs?_format=for_explore_search_web&amp;_intents=p1&amp;auto_ib=false&amp;client_session_id=6c7f3e7b-c038-4d92-b2b0-0bc7c25f1054&amp;currency=CAD&amp;experiences_per_grid=20&amp;fetch_filters=true&amp;guidebooks_per_grid=20&amp;has_zero_guest_treatment=true&amp;is_guided_search=true&amp;is_new_cards_experiment=true&amp;is_standard_search=true&amp;items_per_grid=18&amp;key=d306zoyjsyarp7ifhu67rjxn52tv0t20&amp;locale=en-CA&amp;luxury_pre_launch=false&amp;metadata_only=false&amp;place_id=ChIJ21P2rgUrTI8Ris1fYjy3Ms4&amp;query=Canc%C3%BAn%2C%20Mexico&amp;query_understanding_enabled=true&amp;refinement_paths%5B%5D=%2Fhomes&amp;s_tag=b7cT9Z3U&amp;satori_version=1.1.9&amp;screen_height=948&amp;screen_size=medium&amp;screen_width=1105&amp;search_type=section_navigation&amp;selected_tab_id=home_tab&amp;show_groupings=true&amp;supports_for_you_v3=true&amp;timezone_offset=-240&amp;version=1.5.7" rel="noopener ugc nofollow" target="_blank">https://www.airbnb.ca/api/v2/explore_tabs?_format=for_explore_search_web&amp;_intents=p1&amp;auto_ib=false&amp;client_session_id=6c7f3e7b-c038-4d92-b2b0-0bc7c25f1054&amp;currency=CAD&amp;experiences_per_grid=20&amp;fetch_filters=true&amp;guidebooks_per_grid=20&amp;has_zero_guest_treatment=true&amp;is_guided_search=true&amp;is_new_cards_experiment=true&amp;is_standard_search=true&amp;items_per_grid=18&amp;key=d306zoyjsyarp7ifhu67rjxn52tv0t20&amp;locale=en-CA&amp;luxury_pre_launch=false&amp;metadata_only=false&amp;place_id=ChIJ21P2rgUrTI8Ris1fYjy3Ms4&amp;query=Canc%C3%BAn%2C%20Mexico&amp;query_understanding_enabled=true&amp;refinement_paths%5B%5D=%2Fhomes&amp;s_tag=b7cT9Z3U&amp;satori_version=1.1.9&amp;screen_height=948&amp;screen_size=medium&amp;screen_width=1105&amp;search_type=section_navigation&amp;selected_tab_id=home_tab&amp;show_groupings=true&amp;supports_for_you_v3=true&amp;timezone_offset=-240&amp;version=1.5.7</a></span></pre><p id="53d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你安装了<a class="ae lu" href="https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc?hl=en" rel="noopener ugc nofollow" target="_blank"> JSONView </a>，你可以以更漂亮的形式渲染<code class="fe lv lw lx ly b">JSON</code>对象。这不是必须的，但是有帮助！如果您滚动浏览，您可以看到这是一个包含我们清单第一页上所有清单的<code class="fe lv lw lx ly b">JSON</code>对象。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/de0660468182b606bb94ddfa5a9dd6aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T78mHd9tAe6t36XMWY6gFw.png"/></div></div></figure><h2 id="827a" class="nd mh it bd mi ne nf dn mm ng nh dp mq lh ni nj ms ll nk nl mu lp nm nn mw no bi translated">2.抓取第一页</h2><p id="b5ca" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">现在我们已经有了包含清单第一页的<code class="fe lv lw lx ly b">JSON</code>对象的请求URL，我们只需发送一个<code class="fe lv lw lx ly b">scrapy</code>请求到我们的计算机上的<code class="fe lv lw lx ly b">GET</code>。然后我们可以使用<code class="fe lv lw lx ly b">JSON</code>文件来提取我们想要的字段。</p><p id="bc09" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在您的蜘蛛文件(我的是<code class="fe lv lw lx ly b">airbnb.py</code>)中，配置文件如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="75f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了解释这里发生了什么，我定义了两个函数。<code class="fe lv lw lx ly b">start_requests</code>和<code class="fe lv lw lx ly b">parse</code>。<code class="fe lv lw lx ly b">start_requests</code>将首字母<code class="fe lv lw lx ly b">scrapy request</code>发送到我们的URL并调用<code class="fe lv lw lx ly b">parse</code>，后者将<code class="fe lv lw lx ly b">response</code>的正文写入名为<code class="fe lv lw lx ly b">first_page.json</code>的<code class="fe lv lw lx ly b">JSON</code>文件。</p><p id="3a10" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要运行蜘蛛，使用<code class="fe lv lw lx ly b">cd</code>导航到您的项目，并通过输入以下命令运行蜘蛛:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="ebb0" class="nd mh it ly b gy nt nu l nv nw">scrapy crawl {name_of_your_spider}</span></pre><p id="b4d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您的蜘蛛的名称可以在您的蜘蛛文件的<code class="fe lv lw lx ly b">name</code>变量中找到。例如，我会将<code class="fe lv lw lx ly b">airbnb</code>作为<code class="fe lv lw lx ly b">{name_of_your_spider}</code>传入。</p><p id="953e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">运行时，应该需要几秒钟时间返回一个<code class="fe lv lw lx ly b">JSON</code>文件。打开该文件，您可以按下<code class="fe lv lw lx ly b">CMD-A</code>然后按下<code class="fe lv lw lx ly b">ALT-SHIFT-F</code>来将<code class="fe lv lw lx ly b">JSON</code>格式化为更易读的格式。我们走吧！我们已经成功地从Airbnb抓取了第一页房源！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/ea206358c36b5726c58ad2511fe0a9e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0FlW0Q5KxLzGhQX_2rrUdA.png"/></div></div></figure><h2 id="7df7" class="nd mh it bd mi ne nf dn mm ng nh dp mq lh ni nj ms ll nk nl mu lp nm nn mw no bi translated">3.使用JSON对象</h2><p id="6209" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">既然我们已经抓取了包含整页清单的<code class="fe lv lw lx ly b">JSON</code>对象，我们需要提取每个家庭的必要信息。为此，我建议创建另一个Python文件来测试从<code class="fe lv lw lx ly b">JSON</code>文件中抓取字段。网上有很多指导你如何使用Python中的<code class="fe lv lw lx ly b">JSON</code>的指南。如果你不熟悉的话，一定要去看看！</p><p id="ca25" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设我们想获得每个家庭的<code class="fe lv lw lx ly b">url</code>、<code class="fe lv lw lx ly b">price</code>、<code class="fe lv lw lx ly b">number of reviews</code>和<code class="fe lv lw lx ly b">average rating</code>。我是这样做的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="7d1e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将在运行时返回以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/d9c25eacc053da977f2604229702a850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*73vRmew7ib2Xl3jGH1Wu9A.png"/></div></div></figure><h2 id="045b" class="nd mh it bd mi ne nf dn mm ng nh dp mq lh ni nj ms ll nk nl mu lp nm nn mw no bi translated">4.把所有的放在一起</h2><p id="87c1" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">既然我们已经有了获取我们感兴趣的特定字段的样板代码，我们就可以把这些都放在您的spider文件中。像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="91a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了帮助更好地解释<code class="fe lv lw lx ly b">parse</code>，我们首先将<code class="fe lv lw lx ly b">response.body</code>的输出(这是我们的<code class="fe lv lw lx ly b">first_page.json</code>文件的内容)分配给<code class="fe lv lw lx ly b">data</code>，用来自<code class="fe lv lw lx ly b">json_testing.py</code>的样板代码提取我们想要的<code class="fe lv lw lx ly b">JSON</code>中的字段，最后产生输出<code class="fe lv lw lx ly b">data_dict</code>。</p><p id="18a5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要运行蜘蛛并获得输出<code class="fe lv lw lx ly b">JSON</code>文件，只需在终端中运行:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="ecd2" class="nd mh it ly b gy nt nu l nv nw">scrapy crawl -o cancun.json</span></pre><p id="cd90" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将生成一个<code class="fe lv lw lx ly b">cancun.json</code>输出文件，包含从第一页抓取的所有清单。现在，打开生成的文件，然后使用<code class="fe lv lw lx ly b">CMD-A</code>和<code class="fe lv lw lx ly b">ALT-SHIFT-F</code>再次格式化它。您应该会看到如下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/b1a5c081f9c28c1b32fd8b0579cbc4d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xz4A6wvfJHDr6t2bjNyWUA.png"/></div></div></figure><p id="a365" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">恭喜你。你刚刚从Airbnb搜集了一些房源数据。从这里有很多路可以走:您可以考虑从<code class="fe lv lw lx ly b">first_page.json</code>文件中提取<code class="fe lv lw lx ly b">has_next_page</code>字段，作为解决如何抓取多个页面的起点。或者，如果您觉得受限于<code class="fe lv lw lx ly b">JSON</code>文件中的字段，可以考虑直接向特定的列表URL发送<code class="fe lv lw lx ly b">scrapy</code>请求:<a class="ae lu" href="https://www.airbnb.com/rooms/" rel="noopener ugc nofollow" target="_blank">https://www.airbnb.com/rooms/</a>{ room _ id }</p><p id="52d3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，这需要一个名为<code class="fe lv lw lx ly b">Splash</code>的插件，因为我们现在直接从Airbnb请求信息。由于Airbnb使用JavaScript来呈现内容，仅仅依靠scrapy已经不够了。如果有兴趣，我很乐意解释如何设置和运行<code class="fe lv lw lx ly b">Splash</code>！</p><p id="e632" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本教程中的所有代码将在这里<a class="ae lu" href="https://github.com/kailu3/scrapy_tutorial" rel="noopener ugc nofollow" target="_blank">变为</a>。随意克隆它，并添加更多的字段和功能！</p><p id="d4fc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我还做了一个更复杂的<a class="ae lu" href="https://github.com/kailu3/airbnb_scraper" rel="noopener ugc nofollow" target="_blank"/><code class="fe lv lw lx ly b"><a class="ae lu" href="https://github.com/kailu3/airbnb_scraper" rel="noopener ugc nofollow" target="_blank">scrapy</a></code><a class="ae lu" href="https://github.com/kailu3/airbnb_scraper" rel="noopener ugc nofollow" target="_blank">项目</a>，它可以接受<code class="fe lv lw lx ly b">price_lower_bound</code>、<code class="fe lv lw lx ly b">price_upper_bound</code>和<code class="fe lv lw lx ly b">city</code>等参数，从Airbnb抓取多页房源。你需要为此设置<code class="fe lv lw lx ly b">Splash</code>，我已经在<code class="fe lv lw lx ly b">README.md</code>中包含了说明。</p><p id="05f8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！感谢阅读。</p></div></div>    
</body>
</html>