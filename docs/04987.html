<html>
<head>
<title>What’s the Difference Between Synthetic React Events and JavaScript Events?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">合成React事件和JavaScript事件有什么区别？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/whats-the-difference-between-synthetic-react-events-and-javascript-events-ba7dbc742294?source=collection_archive---------0-----------------------#2020-05-28">https://betterprogramming.pub/whats-the-difference-between-synthetic-react-events-and-javascript-events-ba7dbc742294?source=collection_archive---------0-----------------------#2020-05-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="039b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">理解JavaScript事件之间的主要区别</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b71a41d2ef733efcd1328f4c6958e5d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*esbhbC_EI44HSQBB"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">罗伯特·哈弗利在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="8fdd" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">什么是JavaScript事件？</h1><p id="7801" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">JavaScript事件是发生在网页上的动作或事件。它们是交互式用户界面的重要组成部分。当用户点击按钮或移动鼠标时，事件就发生了。在许多其他情况下，当网页被加载或卸载时也是一个结果。</p><p id="2b9a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">HTML定义了一组事件，JavaScript使用事件处理程序来管理这些事件。React还实现了事件处理程序，如<code class="fe mz na nb nc b">onClick</code>、<code class="fe mz na nb nc b">onMouseMove</code>、<code class="fe mz na nb nc b">onLoad</code>、<code class="fe mz na nb nc b">onError</code>等。React的事件处理程序用camelCase APIs命名，JavaScript事件处理程序用小写API命名。</p><p id="e0eb" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们将解释React如何处理事件，以及React事件的功能和局限性。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="54e8" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">事件捕获和冒泡</h1><p id="3555" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">JavaScript中定义了四个<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Event/eventPhase" rel="noopener ugc nofollow" target="_blank">事件阶段</a>:</p><blockquote class="nd ne nf"><p id="4156" class="ly lz ng ma b mb mu ju md me mv jx mg nh mw mj mk ni mx mn mo nj my mr ms mt im bi translated"><code class="fe mz na nb nc b">Event.NONE (0)</code>:目前没有正在处理的事件。</p><p id="1733" class="ly lz ng ma b mb mu ju md me mv jx mg nh mw mj mk ni mx mn mo nj my mr ms mt im bi translated"><code class="fe mz na nb nc b">Event.CAPTURING_PHASE (1)</code>:事件正在通过目标的祖先对象传播。这个过程从<code class="fe mz na nb nc b">Window</code>开始，然后是<code class="fe mz na nb nc b">Document</code>，然后是<code class="fe mz na nb nc b">HTMLHtmlElement</code>，依此类推，直到到达目标的父元素。这个过程被称为捕获阶段。</p><p id="06b5" class="ly lz ng ma b mb mu ju md me mv jx mg nh mw mj mk ni mx mn mo nj my mr ms mt im bi translated"><code class="fe mz na nb nc b">Event.AT_TARGET (2)</code>:事件已经到达事件的目标。这个过程被称为目标阶段。</p><p id="ce48" class="ly lz ng ma b mb mu ju md me mv jx mg nh mw mj mk ni mx mn mo nj my mr ms mt im bi translated"><code class="fe mz na nb nc b">Event.BUBBLING_PHASE (3)</code>:事件以相反的顺序通过目标的祖先向上传播，从父级开始，最终到达包含它的<code class="fe mz na nb nc b">Window</code>。这个过程被称为冒泡阶段。</p></blockquote><p id="84dd" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">最后三个短语构成了事件传播。</p><p id="cd4a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在React中，<code class="fe mz na nb nc b">Event</code>变量定义如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="8afa" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">大多数时候，我们使用冒泡事件处理程序，比如<code class="fe mz na nb nc b">onClick</code>、<code class="fe mz na nb nc b">onMouseMove</code>、<code class="fe mz na nb nc b">onLoad</code>和<code class="fe mz na nb nc b">onError</code>。</p><p id="5742" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">事件捕获对于事件委托很有用，事件委托是一种在公共祖先级别使用单个事件捕获处理程序的方法，而不是将事件处理程序分配给许多子元素。</p><p id="b4f6" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在React中，要为捕获阶段注册一个事件处理程序，只需将<code class="fe mz na nb nc b">Capture</code>附加到事件名称上。等价的，还有<code class="fe mz na nb nc b">onClickCapture</code>、<code class="fe mz na nb nc b">onMouseMoveCapture</code>、<code class="fe mz na nb nc b">onLoadCapture</code>、<code class="fe mz na nb nc b">onErrorCapture</code>。</p><p id="c6f3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">两个事件处理程序没有等效的捕获处理程序。分别是<code class="fe mz na nb nc b">onMouseEnter</code>和<code class="fe mz na nb nc b">onMouseLeave</code>。这种行为与JavaScript事件一致。</p><p id="6f1e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">让我们创建一个例子来说明这个概念。<a class="ae ky" href="https://medium.com/better-programming/10-fun-facts-about-create-react-app-eb7124aa3785" rel="noopener">创建React应用</a>是一种启动React编码环境的便捷方式:</p><pre class="kj kk kl km gt nm nc nn no aw np bi"><span id="2063" class="nq lh it nc b gy nr ns l nt nu">npx create-react-app my-app<br/>cd my-app<br/>npm start</span></pre><p id="f14a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们修改<code class="fe mz na nb nc b">src/App.js</code>如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="0e16" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">运行<code class="fe mz na nb nc b">npm start</code>，我们看到如下用户界面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/bfb484a1de3235ecc4566001020eae34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j9guFKA5rJCTp8WsqSzLAg.png"/></div></div></figure><ul class=""><li id="f12d" class="nw nx it ma b mb mu me mv mh ny ml nz mp oa mt ob oc od oe bi translated">点击黄色区域，我们得到这些控制台日志:<code class="fe mz na nb nc b">captured yellow</code>和<code class="fe mz na nb nc b">clicked yellow</code>。</li><li id="3c1f" class="nw nx it ma b mb of me og mh oh ml oi mp oj mt ob oc od oe bi translated">点击蓝色区域，我们得到这些控制台日志:<code class="fe mz na nb nc b">captured yellow</code>、<code class="fe mz na nb nc b">captured blue,</code>、和<code class="fe mz na nb nc b">clicked yellow</code>。</li><li id="7958" class="nw nx it ma b mb of me og mh oh ml oi mp oj mt ob oc od oe bi translated">点击绿色区域，我们得到这些控制台日志:<code class="fe mz na nb nc b">captured yellow</code>、<code class="fe mz na nb nc b">captured blue</code>、<code class="fe mz na nb nc b">captured green,</code>、<code class="fe mz na nb nc b">clicked green</code>、<code class="fe mz na nb nc b">clicked blue</code>和<code class="fe mz na nb nc b">clicked yellow</code>。</li><li id="7c65" class="nw nx it ma b mb of me og mh oh ml oi mp oj mt ob oc od oe bi translated">点击紫色区域，我们得到这些控制台日志:<code class="fe mz na nb nc b">captured yellow</code>、<code class="fe mz na nb nc b">captured blue</code>、<code class="fe mz na nb nc b">captured green,</code>、<code class="fe mz na nb nc b">captured purple,</code>、<code class="fe mz na nb nc b">clicked purple</code>、<code class="fe mz na nb nc b">clicked green</code>、<code class="fe mz na nb nc b">clicked blue</code>和<code class="fe mz na nb nc b">clicked yellow</code>。</li></ul></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="d4d1" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">反应事件总是冒泡</h1><p id="3dd3" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在JavaScript中，一些事件——比如<code class="fe mz na nb nc b">focus</code>、<code class="fe mz na nb nc b">blur</code>和<code class="fe mz na nb nc b">change </code>——不会冒泡。然而，React的团队决定让所有事件都冒泡，不管有没有意义。</p><p id="3d3f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下面的<code class="fe mz na nb nc b">src/App.js</code>演示了<code class="fe mz na nb nc b">focus</code>事件冒泡:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="329e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">该代码生成以下用户界面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/142b2491f6dd0cfedc5576662b6ee27a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TjdPYO0Ct2Mmqg8JN4Qi0A.png"/></div></div></figure><p id="256f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">点击输入框，我们得到这些控制台日志:<code class="fe mz na nb nc b">captured yellow</code>、<code class="fe mz na nb nc b">captured blue</code>、<code class="fe mz na nb nc b">captured green,</code>、<code class="fe mz na nb nc b">captured input,</code>、<code class="fe mz na nb nc b">focused green</code>、<code class="fe mz na nb nc b">focused blue</code>和<code class="fe mz na nb nc b">focused yellow</code>。</p><p id="af43" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下面的<code class="fe mz na nb nc b">src/App.js</code>显示<code class="fe mz na nb nc b">change</code>事件冒泡:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="38c5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在下面的用户界面中，当在输入框中输入“a”时，我们得到这些控制台日志:<code class="fe mz na nb nc b">captured yellow</code>、<code class="fe mz na nb nc b">captured blue</code>、<code class="fe mz na nb nc b">captured green,</code>、<code class="fe mz na nb nc b">captured input,</code>、<code class="fe mz na nb nc b">changed input</code>、<code class="fe mz na nb nc b">changed green</code>、<code class="fe mz na nb nc b">changed blue</code>和<code class="fe mz na nb nc b">changed yellow</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/302aad1657594b55d6bd0739d357a3fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i-IeMW2GnjpqmtayA5dzyA.png"/></div></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="070a" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">合成事件</h1><p id="daef" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">以下是React中的<code class="fe mz na nb nc b">Event</code>界面:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="920b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们修改了前面在<code class="fe mz na nb nc b">src/App.js</code>中的例子，在第15行打印出事件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><blockquote class="ol"><p id="39b4" class="om on it bd oo op oq or os ot ou mt dk translated">React 17从React中删除了“事件池”优化。如果你想知道它在React 17之前的表现，请继续阅读。否则，跳过下一节，直接进入React 17后的行为一节。</p></blockquote><h2 id="1b0b" class="nq lh it bd li ow ox dn lm oy oz dp lq mh pa pb ls ml pc pd lu mp pe pf lw pg bi translated">反应前的行为17</h2><p id="7b0e" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">以下是控制台输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/46b7f72de7de6346c8df68c14cc7e212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*616713_ucrktz2W1hpi6lA.png"/></div></div></figure><p id="a1a2" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">点击<code class="fe mz na nb nc b">bubbles</code>值，我们会收到以下警告:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/952d82785a390ae37ec10cf98454d3a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cyViYcvfeS4X0woBGMuRFg.png"/></div></div></figure><p id="d486" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">发生了什么事？</p><p id="f27f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在React中，一个事件处理程序通过一个<code class="fe mz na nb nc b"><a class="ae ky" href="https://reactjs.org/docs/events.html" rel="noopener ugc nofollow" target="_blank">SyntheticEvent</a></code>实例传递，这是一个围绕浏览器本机事件的跨浏览器包装器。和浏览器的原生事件有相同的界面，包括<code class="fe mz na nb nc b">stopPropagation()</code>和<code class="fe mz na nb nc b">preventDefault()</code>。在React中，不能返回<code class="fe mz na nb nc b">false</code>来防止默认行为。相反，<code class="fe mz na nb nc b">preventDefault</code>必须显式调用。合成事件在所有浏览器中的工作方式是相同的，因为它们是根据W3C规范<a class="ae ky" href="https://www.w3.org/TR/DOM-Level-3-Events/" rel="noopener ugc nofollow" target="_blank">定义的。</a></p><p id="5d13" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><code class="fe mz na nb nc b">SyntheticEvent</code>被汇集。这意味着在事件回调被调用后，<code class="fe mz na nb nc b">SyntheticEvent</code>对象将被重用，所有属性都将失效。这种行为是出于性能原因而设计的。因此，<code class="fe mz na nb nc b">SyntheticEvent</code>不能以异步方式使用。单击控制台事件就是异步访问它。</p><p id="1858" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果取消第14行的注释，<code class="fe mz na nb nc b">e.persist()</code>将从池中移除合成事件，并允许用户代码保留对事件的引用。现在<code class="fe mz na nb nc b">SyntheticEvent</code>打印出活动详情:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/ad9da9175b16c1001f6143a03bdc8f92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*guQYBW0HHpSf6O2Cb9Pu5A.png"/></div></div></figure><p id="d631" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们可以看到目标被正确设置为<code class="fe mz na nb nc b">input</code>。取消对第16行的注释将打印出由<code class="fe mz na nb nc b">&lt;div&gt;</code> s换行的<code class="fe mz na nb nc b">&lt;input&gt;</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/53cf6d8252475315e1abc5f979b886d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QRUaWPT9vEwDrAWe2el-A.png"/></div></div></figure><h2 id="975a" class="nq lh it bd li ow pl dn lm oy pm dp lq mh pn pb ls ml po pd lu mp pp pf lw pg bi translated">反应后的行为17</h2><p id="6711" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated"><code class="fe mz na nb nc b">e.persist()</code>(第14行)在React 17后没有效果。</p><p id="cb74" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">第15行总是显示正确的目标，<code class="fe mz na nb nc b">input</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/53fa73103260aa6299c67bae54bb6dd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qr_-J4F2hUKAFemoTpraTg.png"/></div></div></figure><p id="b330" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">取消第16行的注释将只打印出<code class="fe mz na nb nc b">&lt;input&gt;</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/987c0fd95cf86f0c3bb8412355741fe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XkgcAWa9b1YRBffG-fyKgQ.png"/></div></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="18cc" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">停止事件传播</h1><p id="3e00" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">从<code class="fe mz na nb nc b">Event</code>接口，我们看到了<code class="fe mz na nb nc b">stopPropagation()</code>方法，调用该方法是为了防止事件到达除当前对象之外的任何对象。</p><p id="87f6" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><code class="fe mz na nb nc b">src/App.js</code>中的以下代码在捕获阶段停止事件传播:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7e8c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在第15行，事件传播在蓝色元素的捕获阶段停止。点击紫色区域，我们得到这些控制台日志:<code class="fe mz na nb nc b">captured yellow</code>和<code class="fe mz na nb nc b">captured blue</code>。</p><p id="435f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><code class="fe mz na nb nc b">src/App.js</code>中的以下代码在冒泡阶段停止事件传播:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="4a31" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在第19行，事件传播在绿色元素的冒泡阶段停止。点击紫色区域，我们得到以下控制台日志:<code class="fe mz na nb nc b">captured yellow</code>、<code class="fe mz na nb nc b">captured blue</code>、<code class="fe mz na nb nc b">captured green,</code>、<code class="fe mz na nb nc b">captured purple,</code>、<code class="fe mz na nb nc b">clicked purple</code>和<code class="fe mz na nb nc b">clicked green</code>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="cf59" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">React视频事件匹配HTML/JavaScript事件</h1><p id="6445" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我们从代码中删除了<code class="fe mz na nb nc b">stopPropagation()</code>方法，并用一个视频替换了紫色元素:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ps"><img src="../Images/434073a919de4a9984b00830fc61634d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bmBOJUPog4xdW-FTuwgvRw.png"/></div></div></figure><p id="1087" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们把一个视频，<code class="fe mz na nb nc b">IMG_2313.mp4</code>(第30行)，放在<code class="fe mz na nb nc b">public</code>目录下。您可以使用任何mp4文件来测试这个例子。</p><p id="ba51" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下面是修改后的<code class="fe mz na nb nc b">src/App.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="b82a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">点击视频，我们在控制台上得到预期的信息:<code class="fe mz na nb nc b">captured yellow</code>、<code class="fe mz na nb nc b">captured blue</code>、<code class="fe mz na nb nc b">captured green,</code>、<code class="fe mz na nb nc b">captured video</code>、<code class="fe mz na nb nc b">clicked video</code>、<code class="fe mz na nb nc b">clicked green</code>、<code class="fe mz na nb nc b">clicked blue</code>、<code class="fe mz na nb nc b">clicked yellow</code>。</p><p id="1be2" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">但是，如果我们单击播放按钮或其他控件，则根本没有控制台消息。</p><p id="c0b6" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><a class="ae ky" href="https://github.com/facebook/react/issues/19623#issuecomment-674599338" rel="noopener ugc nofollow" target="_blank">发生了什么</a>？</p><p id="81be" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这并不是说React的行为有所不同。这正是视频标签的工作原理。单击播放按钮不会触发click事件，而是触发播放或暂停事件。React事件的行为方式与HTML/JavaScript事件相同。</p><p id="c1d9" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">为了使这个示例能够工作，我们将click事件更改为play事件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="b7f5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">点击视频的播放按钮，我们在控制台上得到预期的信息:<code class="fe mz na nb nc b">captured yellow</code>、<code class="fe mz na nb nc b">captured blue</code>、<code class="fe mz na nb nc b">captured green,</code>、<code class="fe mz na nb nc b">captured video</code>、<code class="fe mz na nb nc b">played video</code>、<code class="fe mz na nb nc b">played green</code>、<code class="fe mz na nb nc b">played blue</code>和<code class="fe mz na nb nc b">played yellow</code>。</p><p id="f919" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果我们取消第15行的注释，事件传播将在蓝色元素的捕获阶段停止。我们在控制台上得到预期的信息:<code class="fe mz na nb nc b">captured yellow</code>和<code class="fe mz na nb nc b">captured blue</code>。</p><p id="b56f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下面是另一个使用<a class="ae ky" href="https://github.com/CookPete/react-player" rel="noopener ugc nofollow" target="_blank"> React播放器</a>的视频例子。</p><p id="b5e9" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">将react-player作为<code class="fe mz na nb nc b"><a class="ae ky" href="https://medium.com/better-programming/package-jsons-dependencies-in-depth-a1f0637a3129" rel="noopener">dependency</a></code>安装在<code class="fe mz na nb nc b">package.json</code>中:</p><pre class="kj kk kl km gt nm nc nn no aw np bi"><span id="221a" class="nq lh it nc b gy nr ns l nt nu">"dependencies": {<br/>  "react-player": "^2.6.0"<br/>}</span></pre><p id="7fda" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">React Player播放各种URL。除了支持视频的文件路径，它还可以播放来自YouTube、脸书、Twitch、SoundCloud、Streamable、Vimeo、Wistia、Mixcloud和DailyMotion的媒体。以下是修改后的<code class="fe mz na nb nc b">src/App.js</code>以YouTube格式播放同一视频(第22行):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="1841" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">运行<code class="fe mz na nb nc b">npm start</code>会显示如下用户界面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pt"><img src="../Images/becb3ad092f00545d7154eebf97c60d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BHNvHcQUwCgbtwdKEblvPg.png"/></div></div></figure><p id="1819" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">点击视频的播放按钮，我们在控制台上得到一行信息:<code class="fe mz na nb nc b">played video</code>。</p><p id="a183" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">检查元件。我们可以看到YouTube播放器是一个iframe。正如所料，根据设计，iframes中的事件不会传播到外部树中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/915d6125d0eca3182ce21255305163b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SMxZ_PzGzyrgR7NCu6sP8Q.png"/></div></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="593c" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">结论</h1><p id="c205" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">React使用一个合成事件系统，这是一个围绕浏览器本机事件的跨浏览器包装器。在大多数情况下，开发人员可能不会注意到差异，但它们确实存在:</p><ul class=""><li id="553f" class="nw nx it ma b mb mu me mv mh ny ml nz mp oa mt ob oc od oe bi translated">React合成事件在不同浏览器中的工作方式相同。</li><li id="47e8" class="nw nx it ma b mb of me og mh oh ml oi mp oj mt ob oc od oe bi translated">React事件处理程序使用camelCase命名。</li><li id="b45e" class="nw nx it ma b mb of me og mh oh ml oi mp oj mt ob oc od oe bi translated">React事件处理程序不能返回<code class="fe mz na nb nc b">false</code>来防止默认行为。</li><li id="c0be" class="nw nx it ma b mb of me og mh oh ml oi mp oj mt ob oc od oe bi translated">反应合成事件总是冒泡。</li><li id="8a3e" class="nw nx it ma b mb of me og mh oh ml oi mp oj mt ob oc od oe bi translated">在React 17之前，React合成事件不能异步使用，除非调用<code class="fe mz na nb nc b">e.persist()</code>。</li><li id="05cd" class="nw nx it ma b mb of me og mh oh ml oi mp oj mt ob oc od oe bi translated">React的视频合成事件系统的工作方式与HTML/JavaScript事件相同。</li></ul><p id="b812" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">感谢阅读。我希望这有所帮助。你可以在这里看到我的其他媒体出版物<a class="ae ky" href="https://medium.com/@jenniferfubook/jennifer-fus-web-development-publications-1a887e4454af" rel="noopener"/>。</p><p id="9929" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><em class="ng">注:Jonathan Ma对本文部分内容有贡献。</em></p></div></div>    
</body>
</html>