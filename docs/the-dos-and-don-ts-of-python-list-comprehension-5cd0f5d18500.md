# Python 列表理解的“做”和“不做”

> 原文：<https://betterprogramming.pub/the-dos-and-don-ts-of-python-list-comprehension-5cd0f5d18500>

## 写出更好的 Python，而不会让你的队友感到困惑

![](img/223de7f160c633744899c29f92cb0710.png)

照片由 [Michael Herren](https://unsplash.com/@mdherren?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

列表理解是一个通常不提供给初学者的话题，因为它的语法不太直观，即使对那些有其他编程语言编码背景的人来说也是如此。

当我们有机会接触列表理解时，我们在这里学到了一些东西，在那里学到了一些东西，因此我们没有一个系统的观点来看待我们应该如何在各种场景中使用列表理解。

在本文中，我想尽可能全面地提供可能的使用指南。我希望本文能成为你购买与列表理解相关技术的一站式商店。

# 多的

## 1.在列表理解中不要使用任何可选项

列表理解的最基本形式是从一个可迭代对象创建一个列表对象——任何您可以迭代其项目的 Python 对象。语法如下所示。

```
[expression for item in *iterable*]
```

下面的代码片段向您展示了一个使用列表理解技术创建列表对象的简单示例。在这个例子中，我们从一个整数列表开始，使用这个列表，我们为每个整数创建了一个正方形和立方体的元组列表。

基本用法

上一个示例使用 list 对象作为 iterable。然而，我们应该意识到许多类型的对象都是可迭代的。我们知道常见的数据类型，如列表、集合、字典和字符串，都是可数据项。其他数据类型，如`range` 对象、`map` 对象、`filter` 对象、[熊猫](https://pandas.pydata.org/)‘`Series`和`DataFrame`对象等都是数据项。下面的代码向您展示了一些使用这些对象的示例。

其他项目

## 2.如果只需要一些项目，一定要应用条件标准

假设只有当元素符合特定标准时，您才希望从 iterable 创建一个对象列表。语法如下所示。

```
[expression for item in *iterable* if condition]
```

条件检查是通过在 iterable 之后的`if`语句来实现的。下面的代码向您展示了这个用法的一个简单例子。

应用条件标准

## 3.一定要使用条件表达式

列表理解也可以使用条件赋值，它有以下语法。

```
[expression0 if condition else expression1 for item in *iterable*]
```

看起来和前面的用法有点类似，但是不要和这两个混淆。在这种用法中，条件表达式本身就是一个整体。下面的代码向您展示了一个示例。

条件赋值

## 4.如果 iterable 有嵌套结构，一定要使用嵌套 for 循环

虽然不太常见，但 iterable 中的元素也可能是 iterables。如果您对处理嵌套 iterables 的元素感兴趣，您可以使用嵌套的`for`循环。它具有以下语法。

```
[expression for item_outer in iterable for item_inner in item_outer]# Equivalent to
for item_outer in iterable:
    for item_inner in item_outer:
        expression
```

下面的代码展示了一个包含嵌套的`for`循环的列表理解的例子。

嵌套 for 循环

## 5.务必替换高阶函数

有些人更习惯于函数式编程。一个特殊的应用是使用高阶函数。具体来说，高阶函数是那些使用其他函数作为输入或输出参数的函数。Python 中一些常见的高阶函数有`map()`和`filter()`。

替换高阶函数

如上面的例子所示，列表理解比高阶函数有更多可读的语法，高阶函数有更复杂的嵌入结构。

# 不要

## 1.不要忘记 list()构造函数

有些人可能认为列表理解是一个很酷的 Python 特性，用来炫耀他们的 Python 技能，即使有更好的选择，他们也倾向于使用它。一个这样的例子是使用`list()`构造函数。考虑下面一些琐碎的例子。

列表理解

在上面的例子中，我们分别使用了一个范围和一个字符串作为 iterables。然而，这两种类型的对象都是可迭代的，并且`list()`构造函数可以直接获取可迭代的对象来创建一个新的列表对象。更好、更清洁的解决方案如下所示。

列表构造函数的使用

## 2.不要忘记生成器表达式

在 Python 中，生成器是一种特殊的迭代器，它延迟地呈现元素，直到被要求这样做。因此，这是一种非常节省内存的处理大量数据的方式。相比之下，list 对象需要预先创建它的所有元素，这样它的元素就可以被计数和索引。与生成器相比，包含相同数量元素的列表需要更多的内存来存储。

为了创建一个生成器，我们可以定义一个生成器函数。然而，我们也可以使用下面的语法来创建一个生成器——一种称为*生成器表达式*的技术。

```
(expression for item in *iterable*)
```

您可能已经注意到，语法非常类似于 list comprehension，除了使用括号而不是方括号。所以区分生成器表达式和列表理解也很重要。

考虑下面这个微不足道的例子。我们需要计算前一百万个整数的平方和。如果我们使用列表理解，这是我们的解决方案。

大数之和

如上图所示，list 对象占用 81528032 字节。让我们考虑一个生成器的相同操作，如下所示。

大数和(生成器)

与使用 list comprehension 的解决方案相比，使用 generator 表达式的解决方案涉及的对象要小得多，只有 96 个字节。原因很简单——生成器不需要捕获它们的所有元素。相反，他们只需要知道他们在序列中的位置，并简单地创建下一个适用的元素并呈现它，而不需要将元素保存在内存中。

# 结论

在这篇文章中，我们回顾了使用列表理解的几个关键准则。如您所见，这些该做和不该做的事情非常简单。我想你应该能够在想要的场景中使用列表理解。这里有一个快速回顾。

*   在列表理解中一定要使用任何可重复项。Python 中存在许多类型的可重复项，你应该超越基本的类型，比如列表和元组。
*   **如果你对保持 iterable 中的一些元素感兴趣，请在 list comprehension** 中应用过滤条件。
*   如果你想用另一种方法给结果元素赋值，请使用条件表达式。
*   如果你正在处理嵌套的 iterables，一定要使用嵌套的 `**for**` **循环。**
*   **在许多用例中，一定要使用列表理解来代替高阶函数**。
*   **不要忘记 list 构造函数**，它使用 iterable 来创建一个新的 list 对象。与列表理解相比，如果你直接使用 iterable，这是推荐的方法。
*   **不要忘记生成器表达式**，它在语法上类似于列表理解。这是一种处理大量对象的高效内存方式。与生成器不同，列表必须在前面创建，以便以后索引和访问，如果列表有许多元素，这将消耗大量内存。