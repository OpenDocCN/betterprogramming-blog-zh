<html>
<head>
<title>How to Use PhotosPicker in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在SwiftUI中使用PhotosPicker</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-photospicker-in-swiftui-637d2d362a60?source=collection_archive---------16-----------------------#2022-08-03">https://betterprogramming.pub/how-to-use-photospicker-in-swiftui-637d2d362a60?source=collection_archive---------16-----------------------#2022-08-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5bd4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">SwiftUI中的原生照片拾取器？你猜对了！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/968a353a152ebad21953a431df51025d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G7VYv5Y4uFQ_r1Yj69KxMQ.jpeg"/></div></div></figure><p id="3c23" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在iOS 16之前，如果需要显示照片拾取器供用户从照片库中选择照片，就不得不依靠UIKit的<code class="fe lq lr ls lt b"><a class="ae lu" href="https://www.appcoda.com/phpicker/" rel="noopener ugc nofollow" target="_blank">PHPickerViewController</a></code>或者更老的<code class="fe lq lr ls lt b"><a class="ae lu" href="https://www.appcoda.com/swiftui-camera-photo-library/" rel="noopener ugc nofollow" target="_blank">UIImagePickerController</a></code>。使用它并不困难，因为你可以将UIKit组件与<code class="fe lq lr ls lt b">UIViewControllerRepresentable</code>集成。也就是说，如果SwiftUI框架带有photo picker的原生视图，那就太好了。</p><p id="6ffc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在iOS 16中，苹果终于为SwiftUI带来了Photos Picker，它与UIKit具有相同的功能。如果你的应用程序只支持运行iOS 16或更高版本的设备，你可以使用这个新视图来处理照片选择。</p><p id="4bb5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们用一些示例代码来看看它是如何工作的。请注意，您需要使用<a class="ae lu" href="https://developer.apple.com/xcode/" rel="noopener ugc nofollow" target="_blank"> Xcode 14 beta 4 </a>来跟随本教程。</p><h1 id="1e82" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在SwiftUI中使用PhotosPicker</h1><p id="2a69" class="pw-post-body-paragraph ku kv it kw b kx mn ju kz la mo jx lc ld mp lf lg lh mq lj lk ll mr ln lo lp im bi translated"><code class="fe lq lr ls lt b">PhotosPicker</code>视图被捆绑在<code class="fe lq lr ls lt b">PhotosUI</code>框架中。在使用它之前，您必须首先导入框架:</p><pre class="kj kk kl km gt ms lt mt mu aw mv bi"><span id="75f1" class="mw lw it lt b gy mx my l mz na">import PhotosUI</span></pre><p id="00b3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们声明一个状态变量来保存选中的照片:</p><pre class="kj kk kl km gt ms lt mt mu aw mv bi"><span id="1e9a" class="mw lw it lt b gy mx my l mz na">@State private var selectedItem: PhotosPickerItem?</span></pre><p id="d9ad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开照片拾取器非常简单。下面是<code class="fe lq lr ls lt b">PhotosPicker</code>的基本用法:</p><pre class="kj kk kl km gt ms lt mt mu aw mv bi"><span id="e743" class="mw lw it lt b gy mx my l mz na">PhotosPicker(selection: $selectedItem, matching: .images)) {<br/>   Label("Select a photo", systemImage: "photo")<br/>}<br/>.tint(.purple)<br/>.controlSize(.large)<br/>.buttonStyle(.borderedProminent)</span></pre><p id="47b1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过将绑定传递给所选项目和照片过滤器来实例化<code class="fe lq lr ls lt b">PhotosPicker</code>。在闭包中，描述按钮的外观。通过几行代码，Xcode应该会在预览中显示一个按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/82e255a3c45b6dc5cb5db2237949f95f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y-1lP6o1ikViZQye.png"/></div></div></figure><p id="1244" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您点按该按钮，它会显示一个照片选取器，用于从照片图库中选取图像。当您选择一张照片时，照片拾取器会自动关闭，所选照片项目会存储在<code class="fe lq lr ls lt b">selectedItem</code>变量中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/473500160887749c0521b70345355e49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YPGsiZMZZV6Ucy5I.png"/></div></div></figure><h1 id="a952" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">过滤照片</h1><p id="a4e1" class="pw-post-body-paragraph ku kv it kw b kx mn ju kz la mo jx lc ld mp lf lg lh mq lj lk ll mr ln lo lp im bi translated"><code class="fe lq lr ls lt b">matching</code>参数允许您指定要应用于照片图库的照片滤镜。在上面的代码中，我们将其值设置为<code class="fe lq lr ls lt b">.images</code>以仅显示图像。如果要同时显示图像和视频，请将参数值设置为以下值:</p><pre class="kj kk kl km gt ms lt mt mu aw mv bi"><span id="871e" class="mw lw it lt b gy mx my l mz na">.any(of: [.images, .videos])</span></pre><p id="73c5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">.images</code>滤镜包括用户照片库中的所有图像。如果想从图像集中排除现场照片怎么办？您可以像这样设置该值:</p><pre class="kj kk kl km gt ms lt mt mu aw mv bi"><span id="d593" class="mw lw it lt b gy mx my l mz na">.any(of: [.images, .not(.livePhotos)])</span></pre><p id="42c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您使用<code class="fe lq lr ls lt b">.not</code>滤镜来排除实时照片。</p><h1 id="3437" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">处理照片选择</h1><p id="f862" class="pw-post-body-paragraph ku kv it kw b kx mn ju kz la mo jx lc ld mp lf lg lh mq lj lk ll mr ln lo lp im bi translated">如前所述，选中的照片会自动存储在<code class="fe lq lr ls lt b">selectedItem</code>变量中，该变量的类型为<code class="fe lq lr ls lt b">PhotoPickerItem</code>。那么，我们如何加载照片并显示在屏幕上呢？</p><p id="a387" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我们附加了<code class="fe lq lr ls lt b">onChange</code>修饰符来监听<code class="fe lq lr ls lt b">selectedItem</code>变量的更新。每当有变化时，我们调用<code class="fe lq lr ls lt b">loadTransferable</code>方法来加载资产数据。</p><pre class="kj kk kl km gt ms lt mt mu aw mv bi"><span id="9307" class="mw lw it lt b gy mx my l mz na">.onChange(of: selectedItem) { newItem in<br/>   Task {<br/>       if let data = try? await newItem?.loadTransferable(type:Data.self) {<br/>           selectedPhotoData = data<br/>       }<br/>   }<br/>}</span></pre><p id="3be1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在WWDC22会议中(<a class="ae lu" href="https://developer.apple.com/videos/play/wwdc2022-10023" rel="noopener ugc nofollow" target="_blank">照片拾取器的新功能</a>)，苹果的工程师向我们展示了如何将类型指定为<code class="fe lq lr ls lt b">Image.self</code>。这是为了指示<code class="fe lq lr ls lt b">loadTransferable</code>返回一个<code class="fe lq lr ls lt b">Image</code>的实例。然而，我无法让它在Xcode 14 beta 4上工作。这也是我用<code class="fe lq lr ls lt b">Data.self</code>代替的原因。稍后，我们可以将数据转换成一个<code class="fe lq lr ls lt b">UIImage</code>对象，用于在<code class="fe lq lr ls lt b">Image</code>视图中显示。</p><p id="bb7c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">selectedPhotoData</code>变量是另一个用于保存数据对象的状态变量:</p><pre class="kj kk kl km gt ms lt mt mu aw mv bi"><span id="1ab9" class="mw lw it lt b gy mx my l mz na">@State private var selectedPhotoData: Data?</span></pre><p id="aa9a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了在图像视图中显示所选图像，我们使用图像数据创建了一个<code class="fe lq lr ls lt b">UIImage</code>实例，然后将其传递给<code class="fe lq lr ls lt b">Image</code>视图:</p><pre class="kj kk kl km gt ms lt mt mu aw mv bi"><span id="c012" class="mw lw it lt b gy mx my l mz na">if let selectedPhotoData,<br/>   let image = UIImage(data: selectedPhotoData) {<br/>                   <br/>   Image(uiImage: image)<br/>       .resizable()<br/>       .scaledToFill()<br/>       .clipped()<br/>   <br/>}</span></pre><p id="c59f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是你处理图像选择的方式。概括地说，当用户从内置的照片库中选择图像时，我们检索图像数据。我们将图像数据保存到一个状态变量中(即<code class="fe lq lr ls lt b">selectedPhotoData</code>)。SwiftUI检测到值的变化，并触发UI更新以在屏幕上呈现照片。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/3b9acb3f16dd28e5da65e1d46b323424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*o63Qvka7sJe45ky9.png"/></div></div></figure><h1 id="ed40" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">选择多张照片</h1><p id="b32e" class="pw-post-body-paragraph ku kv it kw b kx mn ju kz la mo jx lc ld mp lf lg lh mq lj lk ll mr ln lo lp im bi translated"><code class="fe lq lr ls lt b">PhotosPicker</code>视图也可以支持多张照片选择。让我们构建另一个快速演示来看看它是如何工作的。同样，我们有两个状态变量来保存<code class="fe lq lr ls lt b">PhotosPickerItem</code>对象和<code class="fe lq lr ls lt b">Data</code>对象。因为用户可能选择多张照片，所以两个变量都变成了一个数组:</p><pre class="kj kk kl km gt ms lt mt mu aw mv bi"><span id="31b4" class="mw lw it lt b gy mx my l mz na">@State private var selectedItems: [PhotosPickerItem] = []<br/>@State private var selectedPhotosData: [Data] = []</span></pre><p id="db86" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了支持多张照片选择，技巧是使用<code class="fe lq lr ls lt b">PhotosPicker</code>的另一种初始化方法:</p><pre class="kj kk kl km gt ms lt mt mu aw mv bi"><span id="ffff" class="mw lw it lt b gy mx my l mz na">PhotosPicker(selection: $selectedItems, maxSelectionCount: 5,matching: .images) {<br/>   Image(systemName: "photo.on.rectangle.angled")<br/>}<br/>.onChange(of: selectedItems) { newItems in<br/>   for newItem in newItems {<br/>       <br/>       Task {<br/>           if let data = try? await newItem.loadTransferable(type:Data.self) {<br/>               selectedPhotosData.append(data)<br/>           }<br/>       }<br/>       <br/>   }<br/>}</span></pre><p id="3960" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个方法有一个名为<code class="fe lq lr ls lt b">maxSelection</code>的附加参数。我们将该值设置为<code class="fe lq lr ls lt b">5</code>，这意味着允许用户最多支持5张照片。在这种情况下，我们可能会在<code class="fe lq lr ls lt b">onChange</code>闭合中捕获多张照片。我们所做的是加载每个照片项，并将其添加到数据数组中(即<code class="fe lq lr ls lt b">selectedPhotosData</code>)。</p><p id="8377" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于这个演示视图，我们没有在屏幕中央创建按钮，而是将按钮放在了导航栏中。以下是完整的代码片段:</p><pre class="kj kk kl km gt ms lt mt mu aw mv bi"><span id="c8b1" class="mw lw it lt b gy mx my l mz na">NavigationStack {<br/>   <br/>   ScrollView {<br/>       VStack {<br/>           ForEach(selectedPhotosData, id: \.self) { photoData in<br/>               if let image = UIImage(data: photoData) {<br/>                   Image(uiImage: image)<br/>                       .resizable()<br/>                       .scaledToFit()<br/>                       .cornerRadius(10.0)<br/>                       .padding(.horizontal)<br/>               }<br/>           }<br/>       }<br/>   }<br/>   <br/>   <br/>   .navigationTitle("Photos")<br/>   .toolbar {<br/>       ToolbarItem(placement: .navigationBarTrailing) {<br/>           PhotosPicker(selection: $selectedItems,maxSelectionCount: 5, matching: .images) {<br/>               Image(systemName: "photo.on.rectangle.angled")<br/>           }<br/>           .onChange(of: selectedItems) { newItems in<br/>               for newItem in newItems {<br/>                   <br/>                   Task {<br/>                       if let data = try? awaitnewItem.loadTransferable(type: Data.self) {<br/>                           selectedPhotosData.append(data)<br/>                       }<br/>                   }<br/>                   <br/>               }<br/>           }<br/>       }<br/>   }<br/>}</span></pre><p id="2b74" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当<code class="fe lq lr ls lt b">selectedPhotosData</code>变量有任何变化时，SwiftUI将刷新UI并在滚动视图中显示照片。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/4adc65a483ec6308e1ed0d7c3cfe01a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UJlKoGCxnyaBNJua.png"/></div></div></figure><pre class="kj kk kl km gt ms lt mt mu aw mv bi"><span id="1ab6" class="mw lw it lt b gy mx my l mz na"><strong class="lt iu">Want to Connect?</strong></span><span id="b630" class="mw lw it lt b gy nd my l mz na">If you enjoy this article and want to dive deeper into SwiftUI, you may check out my <a class="ae lu" href="https://www.appcoda.com/swiftui" rel="noopener ugc nofollow" target="_blank">Mastering SwiftUI book</a>.</span></pre></div></div>    
</body>
</html>