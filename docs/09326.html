<html>
<head>
<title>How to Create a Delete Request in FastAPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在FastAPI中创建删除请求</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-a-delete-request-in-fastapi-b4577f9bcb77?source=collection_archive---------6-----------------------#2021-08-11">https://betterprogramming.pub/how-to-create-a-delete-request-in-fastapi-b4577f9bcb77?source=collection_archive---------6-----------------------#2021-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="968a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">删除资源应该很有趣</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/094f2f5c93c5c541a60889f1a118ee25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kf4STYGhFprbF_cX"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@gary_at_unsplash?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">陈嘉里</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="62a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名数据工程师，我很清楚有多种语言和框架可以完成这项工作。我本人是Spring (Java)和FastAPI (Python)的忠实粉丝。</p><p id="5ec1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与现在许多人认为的不同，CRUD还远未消亡。如果操作正确，您拥有创建、读取、更新和删除资源所需的所有方法。而且，更重要的是，应该有可能以快速和稳定的方式创建API。</p><p id="7887" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章将向你展示如何创建一个带有删除请求的控制器。我们还将关注用单元测试和集成测试来测试我们的代码。</p><p id="7c08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为自己准备一份提神的点心，因为只需几分钟，您就可以用几行代码创建一个删除请求。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="10a9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建删除请求</h1><p id="f1fd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您需要做的第一件事是设置您的Python环境。为此，您需要一些库:FastAPI、uvicorn、pydantic和requests。请随意用您喜欢的工具安装它们。就我个人而言，我会选择虚拟环境。</p><p id="3742" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将从头开始创建一个删除请求。我们将从图书列表中删除一本书。我们的数据类型非常简单。我们将使用一本书的以下表示法:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8a6a" class="ne md it na b gy nf ng l nh ni">class Book:<br/>  <strong class="na iu">isbn</strong>: int<br/>  <strong class="na iu">title</strong>: str</span></pre><p id="1084" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在实际应用中，我们会使用数据库，但这并不是必需的。这只是一个实现细节。相反，我们从书单开始:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="70da" class="ne md it na b gy nf ng l nh ni">books: list[Book] = [<br/>    Book(isbn=1234, title="What is love?"),<br/>    Book(isbn=4567, title="Baby don't hurt me")<br/>]</span></pre><p id="9387" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的删除请求将遍历我们的图书列表。它将搜索匹配的ISBN。ISBN是我们唯一的标识符，是我们找到一本书的关键。如果列表中包含该书，它将删除该书。如果列表中不包含该书，它将保持不变。</p><p id="0c07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在FastAPI中，这将看起来像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">删除一本书</p></figure><p id="b323" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我要解释一下:</p><ul class=""><li id="5b90" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">没有匹配的书为什么不抛出异常？删除请求应该是等幂的。这意味着，如果你用相同的ISBN调用它们，你总是会得到相同的结果。</li></ul><p id="d829" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使删除幂等非常有意义。如果在请求之前书不在那里，在请求之后它仍然不在那里。这消除了API的复杂性。我们不再需要关心一个手指粗的用户按两次delete键。它将是一致的，不会向用户显示任何错误。</p><ul class=""><li id="245c" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">为什么我们返回204而不是200响应？在这种情况下，我们不归还尸体。因此，204 No内容对API的用户来说更具描述性。还是一个成功的应对。</li><li id="960d" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">最后，在循环时删除列表中的一本书是个坏主意。在最坏的情况下，这会导致异常。这就是为什么我们创建了一个方法来返回这本书并在事后删除它。</li></ul><h1 id="7fe0" class="mc md it bd me mf nz mh mi mj oa ml mm jz ob ka mo kc oc kd mq kf od kg ms mt bi translated">如何编写单元测试</h1><p id="419a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们的文章是关于FastAPI的，所以我不想一开始就用测试来打扰你。然而，我实际上是先写测试的。在上面的代码片段中，我们有两条路径:</p><p id="81da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个测试用例很重要。当我们传递列表中一本书的ISBN时，我们期望这本书从我们的列表中删除。首先，我们在没有指定ISBN的情况下删除它。接下来，我们通过在列表中搜索正确的书来删除它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="3385" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个测试用例将处理删除不在我们列表中的书。这现在很简单。我们创建了一个测试，当我们用错误的ISBN调用它时，它什么也不做。一开始写这个测试会很奇怪，因为它会导致没有代码。现在，这就说得通了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="fc92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了用最少的代码使这些测试成功，我们强迫自己写干净的代码。</p><h1 id="eac5" class="mc md it bd me mf nz mh mi mj oa ml mm jz ob ka mo kc oc kd mq kf od kg ms mt bi translated">如何编写集成测试</h1><p id="0b68" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">单元测试不足以测试一切。虽然它们非常快，但我们还需要测试组件的交互。这就是集成测试如此重要的原因。</p><p id="d577" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">FastAPI为我们提供了一个测试客户端，这与通过PostMan或curl等工具执行请求非常相似。唯一的区别是因为你可以把它写成代码，你可以很容易地自动化测试。</p><p id="a880" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在我们的测试中，我们将对我们的API执行一个删除请求，并测试两件必然会发生的事情:</p><ul class=""><li id="8fe9" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">结果是204没有内容</li><li id="5281" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">这本书从列表中删除了</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="7ea5" class="mc md it bd me mf nz mh mi mj oa ml mm jz ob ka mo kc oc kd mq kf od kg ms mt bi translated">结论</h1><p id="dd4c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">FastAPI允许我们像用其他语言一样快速地创建API。这是一种真正有趣的体验，编写删除请求很容易。因为API非常容易测试，所以开发速度非常快。</p><p id="87ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们讨论了删除请求。我们讨论了幂等性以及如何测试这种方法。过去，我也介绍过<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-create-a-get-request-in-fastapi-ecdc794b0cf"> GET和POST </a>方法。使用这些方法，您将能够创建、读取和删除资源。</p><p id="2d23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您阅读本文！</p></div></div>    
</body>
</html>