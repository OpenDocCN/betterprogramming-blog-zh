<html>
<head>
<title>My Favorite New Features of SQS From Re:Invent 2021</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我最喜欢的《发明2021》中SQS的新特征</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/my-favourite-new-features-of-sqs-from-re-invent-2021-3fd59478496?source=collection_archive---------13-----------------------#2022-02-22">https://betterprogramming.pub/my-favourite-new-features-of-sqs-from-re-invent-2021-3fd59478496?source=collection_archive---------13-----------------------#2022-02-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="60d6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">部分批次失败和SQS Redrive将使您的生活更轻松</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/063104cc4284a17147e44a8514f724b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RvrtgMwyO2jdaama"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">哈尔·盖特伍德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="1ee4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你好。AWS Re:Invent 2021发布了许多公告，在本文中，我们将了解一些关于AWS SQS的公告。</p><h1 id="8f69" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">首先，简单介绍一下SQS。</h1><p id="684a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">什么是SQS？从服务的概述页面"<em class="mp">亚马逊简单队列服务(SQS)是一个完全托管的消息队列服务，使您能够分离和扩展微服务、分布式系统和无服务器应用程序</em></p><p id="55ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我想通过一个实际的例子来解释这些服务:假设您有一个终端，用户想要导出一个大的excel，所以您不希望用户等待导出，您想要通过电子邮件发送它。</p><p id="bf8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，您的端点在SQS队列中推送消息(或作业), Lambda函数将从队列中读取消息并处理导出，然后通过电子邮件发送。这是典型的生产者-消费者模式。如果出现错误，可以重新处理消息，或者您可以将消息移动到DLQ(死信队列)中。</p><p id="6c73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">DLQ队列是与主队列严格相连的SQS队列。队列中的每条消息都有一个计数器:您可以设置一个阈值，超过该阈值后，消息将在DLQ中移动。简直就是死队列。您可以阅读调试的失败消息，并决定修复您的使用者中的问题，然后重新处理它。</p><h1 id="13c7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">批量部分失败</h1><p id="170b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如上所述，当SQS的某个元素失败时，它会返回队列并重新处理，但是在几次尝试之后，该元素会被放入DLQ。</p><p id="fdaf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你用Lambda函数处理多个元素时，如果其中一些失败了，那么所有的元素都会在队列中返回，或者你需要从队列中删除成功的元素。</p><p id="796a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是随着批处理部分失败，你的Lambda响应你将返回失败id的列表。自动地，不需要您自己删除元素，您就可以区分成功项和失败项。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="145e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">把DLQ重新开到SQS</h1><p id="fb98" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在我看来，将元素从DLQ转移到主队列是一个关键特征。在引入它之前，您必须使用自定义实现手动完成这项工作，该实现从DLQ中读取元素，并将它们放入主队列中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/ab0ba3f91678017151d8972ca2eb0b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qh_tq8xxN3_-1viUZ4WjIw.jpeg"/></div></div></figure><p id="ee9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在SQS控制台的左上方，我们可以看到“启动DLQ红驱动”。因此，单击会将我们带到重新驱动配置。</p><blockquote class="mt mu mv"><p id="b501" class="kw kx mp ky b kz la jr lb lc ld ju le mw lg lh li mx lk ll lm my lo lp lq lr ij bi translated">记住:如果SQS队列没有DLQ，按钮将被禁用！</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/f122d3739f3fc9d1aacde74be1ecc38f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_38T-TIlxDPUzu7MRV244Q.jpeg"/></div></div></figure><p id="9224" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用默认设置，DLQ项目将在SQS来源。但是，如果你想在不同的队列中重新驱动或设置不同的速度，你可以在这里编辑。</p></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><p id="56aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今天到此为止。我将制作一个小示例项目，其中实现了部分批处理失败，<a class="ae kv" href="https://github.com/SalvoCozzubo/AWS-SQS-Partial-Batch-Failure" rel="noopener ugc nofollow" target="_blank">你会在GitHub </a>上找到它。</p><p id="54a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">别忘了查看<a class="ae kv" href="https://medium.com/better-programming/four-ways-to-improve-your-aws-lambda-1cfd3a3115d6" rel="noopener">我之前的文章</a>，后会有期！</p></div></div>    
</body>
</html>