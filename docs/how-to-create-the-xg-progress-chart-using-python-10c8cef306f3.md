# 如何使用 Python 创建 xG 进度图

> 原文：<https://betterprogramming.pub/how-to-create-the-xg-progress-chart-using-python-10c8cef306f3>

## 用数据讲足球故事。

![](img/f8a78dc2c7c35b13e27daa694b9336dd.png)

内森·罗杰斯在 [Unsplash](https://unsplash.com/s/photos/football-posts?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片

# 介绍

足球有时是一种不公平的游戏。如果你观看了德国和韩国之间的世界杯比赛，你会惊讶地发现德国输掉了那场比赛，无法进入下一阶段。当我们看到两个团队的预期目标(xG)值时，我们会觉得更痛苦。

预期目标是什么(xG)？xG 值是射门可以转化为进球的概率。如果值更接近 1，就更容易成为目标。决定该值的因素是距离、角度、射手前面的玩家数量等。

在本文中，我将向您展示如何使用 Python 创建 xG 进度图。事不宜迟，我们开始吧！

# 履行

## 数据源

对于数据源，我们将使用来自 StatsBomb 开放数据的数据。StatsBomb 提供了开放数据，我们可以使用这些数据来提高我们的足球分析技能。

该数据包含欧洲冠军联赛、国际足联世界杯、2020 年欧洲杯等比赛的事件数据。更多细节，你可以通过[这里](https://github.com/statsbomb/open-data)的链接了解。

## 行动（或活动、袭击）计划

为了实现 xG 进度表，我们需要做几个步骤。这些步骤是:

*   找到数据
*   准备数据
*   将数据可视化

## 找到数据

在这篇文章中，我们将使用 2018 年韩国和德国之间的世界杯比赛数据。

因为 StatsBomb 提供了如此多的匹配，并且数据被分成几个 JSON 文件，所以我们需要找到数据的文件名。

首先，我们需要打开 competition.json 文件来检索比赛和赛季 id。下面是实现这一点的代码:

从上面可以看到，比赛和赛季对应的 id 分别是 43 和 3。

现在下一步是从这些比赛中检索比赛 id。为了简化我们的搜索过程，我们过滤了包含韩国作为竞争对手的数据。下面是实现这一点的代码:

从上面的结果我们可以看到，韩国和德国比赛对应的比赛 id 是 7567。

现在我们可以使用 id 作为事件数据的文件名。让我们通过使用这些代码行来打开数据:

## 准备数据

我们想创建 xG 进度图，数据还没有完全准备好。因此，我们需要几个步骤来准备数据。首先，我们需要过滤包含镜头事件的数据。下面是实现这一点的代码:

在我们过滤数据之后，下一步是获取利息列。这些列是时间戳、代表当前正在进行的比赛的时间段、比赛的分钟数、击球结果名称以及来自 StatsBomb 的 xG 值。下面是实现这一点的代码:

如你所知，足球比赛的半场不会在 45 分钟结束，所以应该进入伤停补时阶段。因此，时间有可能与下半年重叠。因此，我们需要创建一个新的标识符来标记时间。

我们可以通过合并周期和分钟列来实现。比如说上半场第 47 分钟有一脚射门。因此，标识符将是 1st-47。下面是实现这一点的代码:

因为我们想知道每个团队在 xG 方面的进展，下一步是从每个团队的 xG 值生成累积和。

为了生成这些值，我们可以根据团队名称对数据进行分组，并使用 cumsum 函数对其进行聚合。下面是实现这一点的代码:

在我们聚合数据之后，最后一步是根据时间段和分钟对数据进行排序。下面是实现这一点的代码:

## 将数据可视化

最后，我们可以可视化 xG 进度图。我们将使用 seaborn 来可视化图表，并使用 matplotlib 来提高可视化效果。下面是实现这一点的代码:

那么，我们能从图表中推断出什么呢？我们可以看到德国队从上半场就创造了很多机会。但遗憾的是，他们无法将其转化为目标。因为他们的 xG 更接近 3，这意味着他们表现不佳。

与此同时，韩国队没有创造很多机会，因为他们受到了德国球员的轰炸。但最终，他们获得了冲力，粉碎了德国人的防线。因此，德国自 1938 年以来第一次没有进入下一阶段。

# 结束语

干得好！您已经学习了如何使用 Python 创建 xG 进度图。我希望你能学到很多东西，从准备数据到可视化数据。