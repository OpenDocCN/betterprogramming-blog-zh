<html>
<head>
<title>A Guide to Cypress End-to-End Browser Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Cypress端到端浏览器测试指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-hitchhikers-guide-to-cypress-end-to-end-testing-bb4a460d8f61?source=collection_archive---------12-----------------------#2019-12-20">https://betterprogramming.pub/the-hitchhikers-guide-to-cypress-end-to-end-testing-bb4a460d8f61?source=collection_archive---------12-----------------------#2019-12-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ee7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">经过一年的柏树，决策，权衡，播种数据和更多的发现。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c9d98fb80bc8a9c793a250c4104a3ef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XOHnoqi-7456Cigp"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">美国宇航局在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="3ffe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着代码库变得越来越大，它的片段也变得越来越复杂，每一行都增加了一个潜在的bug。最好的组织通过严格的测试来处理这个问题。</p><p id="991c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">手工测试需要很多努力，这就是自动化测试的用武之地。现场最热门的框架之一是<a class="ae ky" href="https://www.cypress.io/" rel="noopener ugc nofollow" target="_blank"> Cypress </a>，一个完整的端到端测试解决方案。</p><p id="52d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在过去，web应用端到端测试是一件棘手的事情。很长一段时间以来，硒一直是主要的解决方案，有着悠久的历史。它有很好的浏览器兼容性，但是让你的测试保持一致很困难，因为它不是为应用程序测试而设计的。</p><p id="9e8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是为什么当我听说Cypress时，我变得如此兴奋，承诺修复过去框架的所有旧的和损坏的方式。</p><p id="23d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在过去的一年中，我写了并回顾了将近200个测试场景(这是在一个小团队中)，我想写一些我希望在开始时就知道的东西，并分享我对迄今为止我与Cypress的旅程的想法。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1011" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">盒子里有什么</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/1e58457873ce811e8ae2d9620b8d6b21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8XIFEYSZHtS3j0_C"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如此多的功能集于一身</p></figure><p id="9239" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">端到端测试一直是一种碎片化的体验。你需要带很多你自己的工具，例如，一个测试运行器，一个断言库，也许还有其他东西，比如模拟。</p><p id="0b46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Cypress，它将所有这些东西打包在一起，这使得设置和配置非常简单。不仅如此，该文档是我职业生涯中读过的最好的文档之一，对你可能遇到的一切都有<a class="ae ky" href="https://docs.cypress.io/guides/guides/command-line.html#Installation" rel="noopener ugc nofollow" target="_blank">指导。</a></p><p id="05c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们不仅很好地告诉你如何使用产品，还对<a class="ae ky" href="https://docs.cypress.io/guides/overview/key-differences.html#Architecture" rel="noopener ugc nofollow" target="_blank">架构</a>、<a class="ae ky" href="https://docs.cypress.io/guides/overview/key-differences.html#Flake-resistant" rel="noopener ugc nofollow" target="_blank">古怪测试</a>和<a class="ae ky" href="https://docs.cypress.io/guides/references/best-practices.html" rel="noopener ugc nofollow" target="_blank">最佳实践</a>进行了深入的解释。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ca47" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">样机研究</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我的第一次柏树测试！</p></figure><p id="2bad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果有机会，在采用这种规模的任何东西之前，我总是认为先在一个小项目上测试它是一个好主意，只是为了获得一种感觉。在倡导之前，我把它加到了我的个人博客上，只是想看看体验如何。</p><p id="c18b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个非常简单的场景:</p><ul class=""><li id="fe1b" class="mx my it lb b lc ld lf lg li mz lm na lq nb lu nc nd ne nf bi translated">加载应用程序。</li><li id="c5b5" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">转到索引页。</li><li id="571b" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">单击第一篇博客文章链接。</li><li id="6de8" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">显示断言内容。</li></ul><p id="7eda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我被我花的时间之短震惊了，不到一个小时。这实际上就像<a class="ae ky" href="https://github.com/aleccool213/blog/blob/eb20d81a1bd10ba6037d5ac26ee5142ce951d7df/cypress/integration/home_page_spec.js#L8" rel="noopener ugc nofollow" target="_blank">为测试本身</a>、<a class="ae ky" href="https://github.com/aleccool213/blog/blob/60aa908e27aa83a539e563498b34f71a93167ec6/package.json#L70" rel="noopener ugc nofollow" target="_blank">、</a> <code class="fe nl nm nn no b"><a class="ae ky" href="https://github.com/aleccool213/blog/blob/60aa908e27aa83a539e563498b34f71a93167ec6/package.json#L70" rel="noopener ugc nofollow" target="_blank">package.json</a></code>中的npm脚本、<a class="ae ky" href="https://github.com/aleccool213/blog/blob/8fa71b2486660e0175ee49cea1559112a224f146/circle.yml#L39" rel="noopener ugc nofollow" target="_blank">在CircleCI </a>中运行它一样简单。</p><p id="604b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">赛普拉斯不仅完成了断言，还录制了视频！如果我使用<a class="ae ky" href="https://github.com/cypress-io/circleci-orb" rel="noopener ugc nofollow" target="_blank"> CircleCI Cypress Orb </a>的话，这个设置会更快。</p><p id="a00d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这让我在很短的时间内获得了大量的测试覆盖率。这个概念证明足以让我的团队相信，当开始编写端到端自动化测试时，Cypress是正确的选择。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1f5d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">决策和权衡</h1><p id="d7d1" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">我们在<a class="ae ky" href="https://www.yolk.ai/" rel="noopener ugc nofollow" target="_blank"> Yolk </a>拥有的基于浏览器的产品与服务器端API完全分离，它们从服务器端API获取数据、构建并单独提供服务。</p><p id="db65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当决定编写端到端测试时，这提供了一些前进的方向。您可以将后端与前端一起部署并测试，就像应用程序在生产中一样，或者完全模拟API响应。</p><p id="0db3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用真正的后端意味着在CI上运行时会加速潜在的内存密集型进程，但您可以确保应用接近生产。</p><p id="663b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过模仿API响应，您测试的栈更少，冒着剔除不真实响应的风险，并且不得不担心保持它们最新的额外维护。</p><p id="e900" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们决定部署与我们正在测试的应用程序相关的后台实例。这个决定对我们来说很容易做出，因为我们已经有了一个CLI工具来完成大部分困难的工作。</p><p id="a286" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个工具(恰当地命名为yolk-cli)为应用程序下载最新的Docker映像，并知道如何用最少的配置提升产品。这使得让真正的API在CI上工作不是太大的任务。</p><p id="cbf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实证明，在CircleCI上运行两三个大型Python应用程序和几个<a class="ae ky" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>服务器确实会很快耗尽内存限制。</p><p id="c7ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们联系了CircleCI，他们让我们访问了他们的大型资源类(高达16GB的RAM)，得分！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="47a5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">播种数据</h1><p id="4536" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">我们面临的下一个挑战是播种数据。您的测试场景必须彼此共享尽可能少的状态。这是一个测试基础，T4·赛普拉斯在他们的指南中提到了这个问题。</p><p id="9bee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在调试为什么会出错时，让测试场景与数据无关会有很大帮助。另一方面，通过UI创建所有数据会导致测试变慢，这是一个平衡。</p><p id="1d72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将是你的应用程序如何工作高度定制，但我会进入我们的工作。</p><p id="86e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再一次回到我们的CLI工具，它有几个命令，播种一些基本数据。这些命令如下所示:</p><p id="e4f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nl nm nn no b">yolk seed-articles</code></p><p id="c338" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nl nm nn no b">yolk seed-bots</code></p><p id="63b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，使用应用程序的基础数据、静态数据或非常高级的实体，可以加快这一过程，并且易于在每个CI构建中运行。</p><p id="37bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一部分将为实体提供种子数据，这些数据可能更特定于单个测试。这就是争论的地方，对此没有灵丹妙药。</p><p id="80be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们决定针对这些情况直接调用API，并使用<a class="ae ky" href="https://docs.cypress.io/api/cypress-api/custom-commands.html#Syntax" rel="noopener ugc nofollow" target="_blank"> Cypress自定义命令</a>来发起这些请求。这是一个不错的选择，因为我们使用的是GraphQL使用API的定制命令易于编写和记录。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu mw l"/></div></figure><p id="235f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为您的测试将反复执行的操作编写定制命令是整合所有代码的好方法，而不仅仅是数据种子！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2203" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用小黄瓜编写场景</h1><p id="280a" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">如果你以前写过端到端测试，你可能熟悉黄瓜使用的<a class="ae ky" href="https://cucumber.io/docs/gherkin/" rel="noopener ugc nofollow" target="_blank">小黄瓜</a>语法。</p><p id="6665" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一种富有表现力的、类似英语的方式来编写测试场景。它可以帮助记录您的特性，非开发人员也可以帮助编写测试用例。我们发现了一种使用插件将该文件语法集成到Cypress中的方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu mw l"/></div></figure><p id="9419" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编写完这些命令后，插件将转到Cypress来实际运行实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu mw l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e8a4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">主张要素和最佳做法</h1><p id="d6bb" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">归根结底，端到端测试只是确保页面上的元素具有正确的内容。当编写Cypress测试时，90%的时间都需要选择元素并查看它们的内部。</p><p id="990d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Cypress有一个标准的<code class="fe nl nm nn no b"><a class="ae ky" href="https://docs.cypress.io/api/commands/get.html#Syntax" rel="noopener ugc nofollow" target="_blank">get()</a></code>命令，向您展示了一个类似jQuery的选择器，这对于使用过Selenium的人来说应该很熟悉。</p><p id="cfd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个选择器的问题是它可能会被错误地使用，而且你不能(用代码)强制它的使用。欢迎<a class="ae ky" href="https://github.com/testing-library/cypress-testing-library" rel="noopener ugc nofollow" target="_blank"> cypress-testing-library </a>，一个由社区中伟大的测试倡导者<a class="ae ky" href="https://kentcdodds.com/" rel="noopener ugc nofollow" target="_blank"> Kent C. Dodds </a>维护的精彩工具。</p><p id="2a05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个插件公开了无数以<code class="fe nl nm nn no b">find</code>为前缀的命令，其工作方式类似于<code class="fe nl nm nn no b">get()</code>在原生Cypress中的工作方式。</p><p id="7f54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些命令都有助于选择器<a class="ae ky" href="https://kentcdodds.com/blog/making-your-ui-tests-resilient-to-change" rel="noopener ugc nofollow" target="_blank">适应变化</a>。随着应用程序的进展，这对测试如何保持一致性会产生巨大的影响。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="34bc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">排除故障</h1><p id="8050" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">如果您以前曾经使用过Selenium，您会知道调试端到端测试有点像一场噩梦。</p><p id="ab34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了赛普拉斯，这种痛苦降到了历史最低点。作为核心产品的焦点，能够调试是你的Cypress之旅中比较愉快的体验之一。像大多数事情一样，<a class="ae ky" href="https://on.cypress.io/plugins-guide" rel="noopener ugc nofollow" target="_blank">他们有一个很好的指导让你开始</a>。</p><p id="648f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们提到的大部分事情都很棒，但是你最可能遇到的情况是选择器不正确。对于这种情况，GUI是找出问题所在的好方法。</p><p id="c740" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://vimeo.com/237115455" rel="noopener ugc nofollow" target="_blank">有一个很好的视频解释了如何编写你的第一个测试</a>，它展示了GUI的运行。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="802f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">视觉测试和捕捉回归</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/39463398d49006ea7b187f9b0b5b9e00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JrOW-plGeznPxBnq"/></div></div></figure><p id="8279" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">端到端测试的另一个关键部分是事物的外观。HTML和CSS对你的应用程序在不同场景下的外观有很大的影响。</p><p id="e7cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Cypress可以给你很多关于你的应用程序如何工作的报道，但是当你想要断言它的外观时，它就开始崩溃了。</p><p id="5785" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尤其是当涉及到浏览器兼容性和您的应用所使用的不同屏幕尺寸时，如果没有正确实施<a class="ae ky" href="https://blog.hichroma.com/visual-testing-the-pragmatic-way-to-test-uis-18c8da617ecf" rel="noopener ugc nofollow" target="_blank">视觉快照测试</a>，视觉退化很难被捕捉到。</p><p id="397c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们最终得到的解决方案是<a class="ae ky" href="https://percy.io/" rel="noopener ugc nofollow" target="_blank">珀西</a>，因为它很好地与赛普拉斯和<a class="ae ky" href="https://storybook.js.org/" rel="noopener ugc nofollow" target="_blank">故事书</a>整合在一起。它能做的是获取当前在Cypress测试场景中呈现的HTML和CSS，并将其发送到Percy的服务器。</p><p id="e946" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，Percy在其内部浏览器上呈现标记，Chrome和Firefox是选项。Percy知道您的Cypress测试正在哪个特性分支中运行，并将其与您配置的基本分支进行比较。</p><p id="c61d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您不知道代码是否改变了应用程序中某个组件的外观时，这可以让您对拉请求充满信心。如果您的Cypress测试中有大量断言CSS值或事物应该是什么样子的代码，那么这可以节省大量时间。</p><p id="2a76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">热门提示:您可以通过创建一个新的<code class="fe nl nm nn no b">takeSnapshot</code>自定义命令，让Cypress在本地拍摄快照，然后仅在启用Percy时使用它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu mw l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="78d0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">并行构建和Cypress仪表板</h1><p id="bdb0" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">一旦测试运行开始变得足够长，您将开始寻找其他策略来加速它们。</p><p id="27ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于Cypress在每次运行时都以干净的状态运行特性场景文件，因此可以执行并行化。你可以决定你自己的平衡策略，如何分解你的测试，但是Cypress Dashboard的托管版本提供了一种自动实现的方法。</p><p id="1a6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我可以负担得起三个CircleCI容器来运行我的Cypress测试。</p><p id="c91b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我在<a class="ae ky" href="https://circleci.com/docs/2.0/parallelism-faster-jobs/" rel="noopener ugc nofollow" target="_blank">my circle ci job step config</a>中定义了<code class="fe nl nm nn no b">parallelism: 3</code>。这将使您的作业的三个实例旋转起来，所有实例都有不同的作业id。把这些证件交给赛普拉斯，你就可以去比赛了。</p><p id="fa3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果正确设置了Cypress Dashboard，该服务将告诉您容器应该运行哪些测试。下面是一个配置示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu mw l"/></div></figure><p id="c10c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这件事的超级巧妙之处在于Cypress Dashboard知道你过去的测试历史和它们的速度。它将使用这些知识，通过确保容器获得运行测试的平衡负载来优化您的并行构建！</p><p id="0047" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果这对你没有多大意义，不要担心，<a class="ae ky" href="https://docs.cypress.io/faq/questions/dashboard-faq.html#My-CI-setup-is-based-on-Docker-but-is-very-custom-How-can-I-load-balance-my-test-runs" rel="noopener ugc nofollow" target="_blank"> Cypress已经回答了如何做这个</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5247" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">浏览器支持</h1><p id="0ede" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">不幸的是，如果你的组织需要对IE11的支持，你就没那么幸运了。<a class="ae ky" href="https://github.com/cypress-io/cypress/issues/310#issuecomment-337349727" rel="noopener ugc nofollow" target="_blank">赛普拉斯团队已经明确表示他们不会支持它</a>。</p><p id="f1c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GitHub上有一个令人难以置信的帖子，我真的希望你能通读一下。它解释了为什么他们正在缓慢地推出它，而没有从一开始就选择WebDriver并编写他们自己的自定义驱动程序。</p><p id="ce6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于Yolk的我们来说，我们需要IE11支持我们的一些应用程序。我们在IE11中不断得到回归，需要更全面的测试覆盖。</p><p id="27d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们决定使用<a class="ae ky" href="https://www.browserstack.com/automate" rel="noopener ugc nofollow" target="_blank"> Browserstack Automate </a>和Selenium来覆盖这些应用。对于CI，我们已经在Cypress中构建并运行了应用程序，我们只需要添加一个新的构建步骤，使用<a class="ae ky" href="https://github.com/browserstack/browserstack-local-nodejs" rel="noopener ugc nofollow" target="_blank"> Browserstack本地代理</a>运行这些测试。</p><p id="cd55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于测试本身，我们决定将硒和黄瓜结合起来，这是一种常见的搭配。为了使这个过程更容易，我们将小黄瓜<code class="fe nl nm nn no b">.feature</code>文件复制到一个新文件夹中，并编写了特定的基于Selenium的step实现。</p><p id="72d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想到的一个很酷的概念是在Cypress和Selenium上重用相同的<code class="fe nl nm nn no b">.feature</code>文件。如果任何人对此有想法，请在下面评论你的建议。</p><p id="d929" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这取决于你在多大程度上采用这种策略，并决定重复测试覆盖对你来说是否值得。对我们来说，在I.E.11中至少有快乐路径端到端测试覆盖给了我们部署时巨大的信心，所以成本是值得的。</p><p id="9457" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我看来，事情并没有看起来那么糟糕，我们的Cypress测试覆盖了基于Chromium的浏览器(Firefox支持即将推出)，我们的Selenium测试覆盖了I.E.11。</p><p id="b92b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着I.E.11越来越多地被淘汰，甚至在企业中，对硒的需求将消失，对Cypress的需求将变得更大。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f319" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">额外收获:类型脚本支持和代码覆盖率</h1><p id="e8b6" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">我前面提到的所有库和模块都支持TypeScript。</p><p id="5482" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让TypeScript与Cypress一起工作不需要很多配置，从长远来看这是完全值得的。你所需要的只是与Cypress集成的webpack、TS配置和插件文件。赛普拉斯提供的一个很好的指南是他们网站上的<a class="ae ky" href="https://docs.cypress.io/guides/tooling/typescript-support.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="1b61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我知道很多人想知道代码覆盖率和生成报告，Cypress也可以做到这一点！再说一次，<a class="ae ky" href="https://github.com/cypress-io/code-coverage" rel="noopener ugc nofollow" target="_blank">有一个很好的插件</a>可以让你做到这一点。</p><p id="b5fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个警告是，它会将覆盖率计数器附加到您的代码上，因此运行您的测试将会更慢，并且可能不会模拟生产。这里的一个好策略是偶尔在本地生成它们，看看你做得怎么样。</p><p id="0e73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你的后端和前端都在TypeScript中，那么当Cypress运行时，一个很酷的想法是让代码覆盖率在两个应用中运行。然后你可以看到你的整个应用程序的覆盖范围！</p></div></div>    
</body>
</html>