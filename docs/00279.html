<html>
<head>
<title>A Quick Look at Action Text for Rails 6.0</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速浏览Rails 6.0的操作文本</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/quick-look-at-action-text-in-rails-6-0-12a8f9f7597f?source=collection_archive---------1-----------------------#2019-01-29">https://betterprogramming.pub/quick-look-at-action-text-in-rails-6-0-12a8f9f7597f?source=collection_archive---------1-----------------------#2019-01-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b6b2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将富文本内容和编辑引入Rails</h2></div><p id="e704" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://weblog.rubyonrails.org/" rel="noopener ugc nofollow" target="_blank"> Rails 6.0 </a>来了！稳定版于4月30日发布。Rails 6.0 beta1于1月15日发布。Rails 6.0版本是一个动作包，Rails版本总是如此。新推出的有两大框架:<a class="ae le" href="https://weblog.rubyonrails.org/2018/12/13/introducing-action-mailbox-for-rails-6/" rel="noopener ugc nofollow" target="_blank">动作邮箱</a>和<a class="ae le" href="https://weblog.rubyonrails.org/2018/10/3/introducing-action-text-for-rails-6/" rel="noopener ugc nofollow" target="_blank">动作文本</a>。在这篇文章中，让我们通过在一个小应用程序中使用动作文本来快速浏览一下。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/f30e3a6033504301ffcac8ca073d04d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0-LAOoPHs63XCSd3VDJ2Eg.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">礼貌:维基百科</p></figure><h2 id="21ec" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">行动文本</h2><p id="e379" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">动作文本让我们可以将丰富的文本内容和编辑功能引入Rails。这意味着我们可以执行格式化文本、嵌入图像、格式化链接、向文本字段添加列表和其他类似编辑器的功能。</p><p id="1afb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是通过在框架中包含<a class="ae le" href="https://github.com/basecamp/trix" rel="noopener ugc nofollow" target="_blank"> Trix编辑器</a>来实现的。Trix编辑器生成的RichText内容保存在它自己的RichText模型中，该模型与应用程序中任何现有的活动记录模型相关联。使用<a class="ae le" href="https://edgeguides.rubyonrails.org/active_storage_overview.html" rel="noopener ugc nofollow" target="_blank">活动存储器自动存储所有嵌入的图像或其他附件。</a></p><p id="94d2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们开始构建我们的Rails应用程序，这将是一个博客应用程序。该应用程序是在Rails 6.0中创建的，因此ruby版本必须大于2.5。</p><p id="89d6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在终端类型中:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="0185" class="lv lw it mu b gy my mz l na nb">rails new blog --edge</span></pre><p id="4099" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nc nd ne mu b">-- edge</code>标志获取最新的rails版本或rails的edge版本。</p><p id="8e8c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">操作文本要求安装web packer和ActiveStorage。Rails应用程序中已经存在活动存储。因此，我们需要在gem文件中包含以下内容:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="9303" class="lv lw it mu b gy my mz l na nb">gem “image_processing”, “~&gt; 1.2” #uncomment from Gemfile<br/>gem ‘webpacker’</span></pre><p id="ebc4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在运行:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="5b59" class="lv lw it mu b gy my mz l na nb">bundle<strong class="mu iu"> </strong>install<strong class="mu iu">.</strong></span></pre><p id="3ff2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们需要创建一个config/webpacker.yml:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="dfb8" class="lv lw it mu b gy my mz l na nb">bundle exec rails webpacker:install</span></pre><p id="ad43" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们启动我们的Rails服务器。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nf"><img src="../Images/6044203ce977bee352ac6f6ff4728888.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YXa6Y6mfxGa2E2m5hnwuug.png"/></div></div></figure><p id="816a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很好，现在让我们快速构建我们的应用程序。它将只有一个模型文章。</p><p id="9e92" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们为文章创建一个控制器:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="9026" class="lv lw it mu b gy my mz l na nb">rails g controller Articles index new create show edit update destroy — no-helper — no-test-frameworks</span></pre><p id="3543" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后配置我们的路线:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="457e" class="lv lw it mu b gy my mz l na nb">Rails.application.routes.draw do<br/> resources :articles<br/>end</span></pre><p id="6b15" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们需要创建我们的模型。我们的文章模型将有两个字段:<strong class="kk iu">标题</strong>和<strong class="kk iu">文本</strong>。文本必须是接受rtf格式的字段。所以在迁移中，我们只需要添加标题字段。文本字段将由ActionText处理。</p><p id="f7c4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们生成模型:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="892f" class="lv lw it mu b gy my mz l na nb">rails g model Articles title:string — no-test-framework</span></pre><p id="a520" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后运行迁移:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="1bc3" class="lv lw it mu b gy my mz l na nb">rails db:migrate</span></pre><p id="7c69" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们添加ActionText部分。第一次运行:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="34e1" class="lv lw it mu b gy my mz l na nb">rails action_text:install</span></pre><p id="9839" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将添加操作文本所需的所有依赖项。最值得注意的是，它添加了一个新文件<strong class="kk iu">JavaScript/packs/application . js</strong>和两个动作存储迁移。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ng"><img src="../Images/3c9a6215da2b61ac0f58051343dc7400.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1nE9nc8I6E2jC-EnEy394A.png"/></div></div></figure><p id="be0a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用以下命令再次运行迁移</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="2d7b" class="lv lw it mu b gy my mz l na nb">rails db:migrate</span></pre><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nh"><img src="../Images/f99cde0df1b1d3f2167d33d1f23778bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AzLR2ezD1weUwRXHKghCTQ.png"/></div></div></figure><p id="e540" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们可以添加模型的文本部分。进入<strong class="kk iu"> app/models/article.rb </strong>添加下面一行</p><p id="1ed1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nc nd ne mu b">has_rich_text <strong class="kk iu">:text</strong></code></p><p id="072d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nc nd ne mu b">text</code>是我们提供的字段名称。它可以是任何东西，如正文或内容等。</p><p id="0c20" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们的模型变成了:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="852f" class="lv lw it mu b gy my mz l na nb">class Article &lt; ApplicationRecord<br/> has_rich_text :text<br/>end</span></pre><p id="3d83" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在构建表单之前，让我们为创建文章创建控制器逻辑:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="cb79" class="lv lw it mu b gy my mz l na nb">class ArticlesController &lt; ApplicationController<br/> <br/> def create<br/>   @article = Article.new(article_params)<br/>   @article.save<br/>   redirect_to @article<br/> end</span><span id="9de3" class="lv lw it mu b gy ni mz l na nb"> private<br/> def article_params<br/>   params.require(:article).permit(:title, :text)<br/> end</span><span id="f6bd" class="lv lw it mu b gy ni mz l na nb">end</span></pre><p id="5a25" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在可以为博客创建表单了。在<strong class="kk iu">app/views/articles/new . Rb</strong>中添加如下表单代码:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="0731" class="lv lw it mu b gy my mz l na nb">&lt;%= form_with scope: :article, url: articles_path, local: true do |form| %&gt;</span><span id="d9f0" class="lv lw it mu b gy ni mz l na nb">&lt;p&gt;<br/>    &lt;%= form.label :title %&gt;&lt;br&gt;<br/>    &lt;%= form.text_field :title %&gt;<br/>  &lt;/p&gt;<br/> <br/>  &lt;p&gt;<br/>    &lt;%= form.label :text %&gt;&lt;br&gt;<br/>    &lt;%= form.rich_text_area :text %&gt;<br/>  &lt;/p&gt;<br/> <br/>  &lt;p&gt;<br/>    &lt;%= form.submit %&gt;<br/>  &lt;/p&gt;<br/>&lt;% end %&gt;</span></pre><p id="9fb5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意，对于文本字段，我们使用的是由动作文本提供的<strong class="kk iu"> form.rich_text_area </strong>，<strong class="kk iu"> </strong>。</p><p id="6ec1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们呈现我们的页面:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nf"><img src="../Images/5eed119e4cd3f75fe6c0472352808527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zpL22oO9exBtJqvJ75dFPw.png"/></div></div></figure><p id="f43f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">厉害！</p><p id="13ed" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在有一个文本编辑器来创建我们的文章。</p><p id="efdc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们开始使用编辑器之前，让我们快速实现博客的<strong class="kk iu"> show </strong>功能，这样我们就可以看到我们创建的文章。</p><p id="2c68" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<strong class="kk iu">app/controllers/articles _ controller . Rb</strong>中增加以下功能:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="c990" class="lv lw it mu b gy my mz l na nb"> def show<br/>   @article = Article.find(params[:id])<br/> end</span></pre><p id="e041" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要为此创建一个视图。创建文件<strong class="kk iu">app/views/articles/show . html . erb</strong>并添加以下代码:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="244c" class="lv lw it mu b gy my mz l na nb">&lt;p&gt;Article Title:&lt;strong&gt;&lt;%= @article.title %&gt;&lt;/strong&gt;&lt;/p&gt;<br/>&lt;p&gt;Article Text:&lt;strong&gt;&lt;%= @article.text %&gt;&lt;/strong&gt;&lt;/p&gt;</span><span id="5d76" class="lv lw it mu b gy ni mz l na nb">&lt;%= link_to ‘Create new’,new_article_path %&gt;</span></pre><p id="c16f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就这样，我们的应用程序完成了。现在让我们检查ActionText提供的文本编辑器中的各种可用功能:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nf"><img src="../Images/ef9c9663a23d9be8ab5f07c08daa12af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_tH1tezWuI8khKwrieWjZw.png"/></div></div></figure><p id="37be" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以看到，ActionText提供了普通富文本编辑器的几乎所有功能——将文本格式化为粗体、斜体、添加删除线、引号、链接、拖放图像等。</p><p id="78db" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">保存后，我们可以在显示页面看到保存的文章:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nf"><img src="../Images/a33273556fe0d25dbbf9fc0776277466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QD3WpW9992Wzo9a1yPyHgw.png"/></div></div></figure><p id="44bf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">太好了！</p><p id="d584" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个展示ActionText潜力的小例子。我希望这有所帮助——试一试吧！</p><p id="ef58" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">绝大多数web应用程序都以某种方式处理丰富的内容，所以我相信Rails的这一新功能可以让许多开发人员的生活变得更加轻松。</p><p id="80cf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">向DHH和所有幕后的牛人致敬。</p><p id="296a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://github.com/amkurian/Rails-6.0_action_text_demo" rel="noopener ugc nofollow" target="_blank">https://github.com/amkurian/Rails-6.0_action_text_demo</a></p><p id="e194" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一些有用的链接:</p><div class="nj nk gp gr nl nm"><a href="https://edgeguides.rubyonrails.org/action_text_overview.html" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">动作文本概述- Ruby on Rails指南</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">操作文本概述本指南为您提供了开始处理富文本内容所需的全部内容。之后…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">edgeguides.rubyonrails.org</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa lp nm"/></div></div></a></div><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="ob oc l"/></div></figure></div></div>    
</body>
</html>