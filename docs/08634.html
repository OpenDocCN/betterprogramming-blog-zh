<html>
<head>
<title>How To Avoid Callback Hell in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何避免Java中的回调地狱</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-avoid-callback-hell-in-java-e5f0e8f1eab4?source=collection_archive---------10-----------------------#2021-05-24">https://betterprogramming.pub/how-to-avoid-callback-hell-in-java-e5f0e8f1eab4?source=collection_archive---------10-----------------------#2021-05-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="60c4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不要把你的JavaScript代码味道带到Java中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a5988c5e54b30a16e1468861b0971460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xxpKG6l6Yg2uH9Mi09CAmQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/s/photos/pyramid?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@nourwageh?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Nour wagh</a>拍摄的照片。</p></figure><p id="e41a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">JavaScript编码人员认识到深度嵌套的回调是处理异步代码的原始方式，并为其命名。因为JavaScript只有一个线程，所以阻塞是不允许的，所以任何有I/O的代码都需要有一个函数，当请求完成时，这个函数就会被调用。所以你会有这样的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="9106" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当阻塞方法都将函数作为参数时，这是编写代码最直接的方式，但是阅读它会让您头疼。如果代码变得太宽，它就会滚出屏幕。当然，你可以以此为借口购买更宽的显示器，或者你可以习惯水平滚动。但是我更喜欢适合屏幕的短线条。</p><p id="e76a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在现代JavaScript中，通过使用承诺可以很容易地避免这种情况。当异步方法返回承诺时，您可以链接方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="a2c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这使代码看起来更有命令性(“做这个，做那个，做另一个”)，因为您阅读代码时仍然处理JavaScript的异步特性。</p><p id="36e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是承诺是一个有些开发人员难以理解的概念。虽然它看起来更干净，但它没有异步调用那样明显的本质，所以一些JavaScript开发人员仍然回退到回调。多年来一直与回调打交道的开发人员已经习惯了回调，并不认为可读性是个问题。但是，如果我正在进行代码审查，并且我看到了深度嵌套的结构，这是一个危险信号。</p><p id="113d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这和Java有什么关系？</p><p id="8635" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，以反应式Java形式出现的异步Java变得更加流行，我们有同样的问题要处理。尽管reactive Java有一个类似于promises的API，但可能有一些开发人员来自JavaScript回调背景。或者可能有同样的感觉，写代码时回调更容易处理。</p><p id="655c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在reactive Java中，处理调用其他回调的回调的正常方式是通过<code class="fe lx ly lz ma b">flatMap</code>方法。名称<code class="fe lx ly lz ma b">flatMap</code>来自于<code class="fe lx ly lz ma b">Streams</code>库，在那里你可能有一个流的流，你想把它们“展平”成一个包含所有项目的单个连续流。它在reactive Java中做同样的事情，但更重要的是，<code class="fe lx ly lz ma b">flatMap</code>“订阅”内部序列。<code class="fe lx ly lz ma b">subscribe</code>函数是指示你的回调函数的一种方式。不幸的是，名称<code class="fe lx ly lz ma b">flatMap</code>并没有真正描述它在无功系统中的价值，因此可能很难理解。</p><p id="0a9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="6788" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，可以用，但是很难看。但是如果你和来自回调风格的JavaScript背景的人或者不理解<code class="fe lx ly lz ma b">flatMap</code>为你订阅的人一起工作，你可能会看到这一点。</p><p id="4bb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用flatMap重写它，这样我们可以看到它是如何避免(或者更准确地说，隐藏)所有的<code class="fe lx ly lz ma b">subscribes</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="0984" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如promises通过以线性方式呈现步骤使代码更具可读性一样，正确地使用reactive Java可以使异步方法更易于阅读和编写。也可以降低每一步的密度。<code class="fe lx ly lz ma b">database.lookup(database.queryBuilder(wdata))</code>线有点密。让我们把它展开一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="6e71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在代码稍微长了一点，但是没有那么宽。对我来说，每一行执行一步很好，这样我就可以一步一步地阅读正在发生的事情。因为它的长度比宽度大，所以作为一个要做的事情的清单更有意义。此外，如果您正在进行代码审查，并且不得不并排查看旧代码和新代码，那么就更容易看到哪些步骤被更改、删除或插入了。</p><p id="e2f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">学习<code class="fe lx ly lz ma b">flatMap</code>的魔力，你将在掌握反应式Java的道路上走得很远。我希望这个小演示能让你更容易理解。本文的Java代码可以在下面找到:</p><div class="mb mc gp gr md me"><a href="https://github.com/rkamradt/flatmapvssubscribe" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd iu gy z fp mj fr fs mk fu fw is bi translated">rkamradt/flatmapvssubscribe</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">与我的文章配套的代码避免Java中的回调地狱</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">github.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms ks me"/></div></div></a></div></div></div>    
</body>
</html>