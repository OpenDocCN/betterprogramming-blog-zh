<html>
<head>
<title>TypeScript’s New Top-Level Await</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TypeScript的新顶级正在等待</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/typescripts-new-top-level-await-cc6beadbde8?source=collection_archive---------1-----------------------#2020-06-22">https://betterprogramming.pub/typescripts-new-top-level-await-cc6beadbde8?source=collection_archive---------1-----------------------#2020-06-22</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="988e" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">我们不再需要异步函数包装器了</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/1a78ada505040005cb063833bbd01351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*z4OdHrTJHQO9KlEs"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Joshua Aragon 在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="5c37" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你想在JavaScript内部使用<code class="fe lw lx ly lz b">async</code> / <code class="fe lw lx ly lz b">await</code>，一般来说，你必须先定义一个<code class="fe lw lx ly lz b">async</code>函数，然后才能使用<code class="fe lw lx ly lz b">await</code>。</p><p id="82d4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本文中，我想向您展示最终使用顶级的<code class="fe lw lx ly lz b">await</code>而不是将其包装在一个<code class="fe lw lx ly lz b">async</code>函数之间是可能的。</p><p id="1604" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">注:</strong> <em class="ma">从Typescript 3.8开始发布👍以及所有</em> <a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await#top_level_await" rel="noopener ugc nofollow" target="_blank"> <em class="ma">主流浏览器支持顶级恭候</em> </a> <em class="ma">。</em></p></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h1 id="e5a1" class="mi mj iu bd mk ml mm mn mo mp mq mr ms ka mt kb mu kd mv ke mw kg mx kh my mz bi translated">async/await是如何工作的？</h1><p id="f5f6" class="pw-post-body-paragraph la lb iu lc b ld na jv lf lg nb jy li lj nc ll lm ln nd lp lq lr ne lt lu lv in bi translated">在以前的一篇文章中，我写了早期使用XHR直到现在使用Fetch API进行Ajax调用的历史。</p><div class="nf ng gq gs nh ni"><a href="https://medium.com/better-programming/from-xhr-to-fetch-with-async-await-on-the-finish-line-b021de1d226b" rel="noopener follow" target="_blank"><div class="nj ab fp"><div class="nk ab nl cl cj nm"><h2 class="bd iv gz z fq nn fs ft no fv fx it bi translated">从XHR到终点的异步/等待取货</h2><div class="np l"><h3 class="bd b gz z fq nn fs ft no fv fx dk translated">看看JavaScript中请求的发展和历史</h3></div><div class="nq l"><p class="bd b dl z fq nn fs ft no fv fx dk translated">medium.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw kt ni"/></div></div></a></div><p id="8d64" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">承诺是<code class="fe lw lx ly lz b">async</code> / <code class="fe lw lx ly lz b">await</code>必不可少的一部分。没有它们，我们无法使用它们。</p><p id="35a3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">JavaScript中的大多数现代环境(如HTTP请求)是异步的，许多现代API返回承诺。</p><p id="d2ef" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">虽然这在使操作非阻塞方面有很多好处，但它使某些用于加载文件或外部内容的代码可读性较差。</p><pre class="kk kl km kn gu nx lz ny nz aw oa bi"><span id="6529" class="ob mj iu lz b gz oc od l oe of">fetch("...")<br/>    .then(response =&gt; response.json())<br/>    .then(data =&gt; { console.log(data) });</span></pre><p id="6130" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">人们习惯于在JavaScript中使用带有<code class="fe lw lx ly lz b">async</code>函数的承诺来使用<code class="fe lw lx ly lz b">await</code>。</p><p id="a154" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但这会在定义之后马上执行函数，感觉怪怪的。它忽略了使用函数的意义。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="og oh l"/></div></figure></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><blockquote class="oi oj ok"><p id="a57d" class="la lb ma lc b ld le jv lf lg lh jy li ol lk ll lm om lo lp lq on ls lt lu lv in bi translated">我在一个不和谐服务器上聚集了几个来自世界各地的有抱负的开发者，如果你想加入，请随意。</p></blockquote></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h1 id="dba6" class="mi mj iu bd mk ml mm mn mo mp mq mr ms ka mt kb mu kd mv ke mw kg mx kh my mz bi translated">顶级等待</h1><p id="301d" class="pw-post-body-paragraph la lb iu lc b ld na jv lf lg nb jy li lj nc ll lm ln nd lp lq lr ne lt lu lv in bi translated">最好使用<code class="fe lw lx ly lz b">await</code>而不要将其包装在<code class="fe lw lx ly lz b">async</code>函数中。</p><p id="b5b2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">随着<a class="ae kz" href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-8.html#top-level-await" rel="noopener ugc nofollow" target="_blank"> TypeScript 3.8 </a>的发布，我们收到了这个特性。考虑到它只在Chrome中被本地支持。</p><p id="f7cc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要使用它，我们必须创建一个模块。当它通过<code class="fe lw lx ly lz b">export</code>导出东西时，它就是一个模块。</p><pre class="kk kl km kn gu nx lz ny nz aw oa bi"><span id="074c" class="ob mj iu lz b gz oc od l oe of">const response = await fetch("...");<br/>const data = await response.json();<br/>console.log(data);</span><span id="58c9" class="ob mj iu lz b gz oo od l oe of">export {};</span></pre><p id="4cf4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你问我，这段代码可读性更好。因为我们不必创建一个<code class="fe lw lx ly lz b">async</code>函数，所以也节省了一点代码。</p><p id="9262" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="ma">在</em><a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules" rel="noopener ugc nofollow" target="_blank"><em class="ma">MDN Web Docs</em></a><em class="ma">阅读更多关于JavaScript模块的内容。</em></p></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h1 id="4932" class="mi mj iu bd mk ml mm mn mo mp mq mr ms ka mt kb mu kd mv ke mw kg mx kh my mz bi translated">类型脚本配置</h1><p id="9e1a" class="pw-post-body-paragraph la lb iu lc b ld na jv lf lg nb jy li lj nc ll lm ln nd lp lq lr ne lt lu lv in bi translated">要在TypeScript中使用顶级的<code class="fe lw lx ly lz b">await</code>，必须将<code class="fe lw lx ly lz b">target</code>编译器选项设置为<code class="fe lw lx ly lz b">es2017</code>或更高。必须将<code class="fe lw lx ly lz b">module</code>选项设置为<code class="fe lw lx ly lz b">esnext</code>或<code class="fe lw lx ly lz b">system</code>。</p></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h1 id="6697" class="mi mj iu bd mk ml mm mn mo mp mq mr ms ka mt kb mu kd mv ke mw kg mx kh my mz bi translated">结论</h1><p id="04d4" class="pw-post-body-paragraph la lb iu lc b ld na jv lf lg nb jy li lj nc ll lm ln nd lp lq lr ne lt lu lv in bi translated">我认为TypeScript团队在语言中内置顶级<code class="fe lw lx ly lz b">await</code>是非常棒的。</p><p id="df71" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你怎么想呢?你要用它吗？请在评论中让我知道。</p></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h1 id="8f11" class="mi mj iu bd mk ml mm mn mo mp mq mr ms ka mt kb mu kd mv ke mw kg mx kh my mz bi translated">谢谢！</h1><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj op"><img src="../Images/e02317848f6e08e98764dcc3057acf80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4aTcitCaVTWHHeiO"/></div></figure><p id="68c0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">读完这个故事后，我希望你学到了一些新的东西，或者受到启发去创造一些新的东西！🤗</p><p id="39bd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果我给你留下了问题或一些要说的话作为回应，向下滚动并给我键入一条消息。如果你想保密，请在Twitter @DevByRayRay 上给我发个DM。我的DM永远是开放的😁</p></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h2 id="cef3" class="ob mj iu bd mk oq or dn mo os ot dp ms lj ou ov mu ln ow ox mw lr oy oz my pa bi translated"><a class="ae kz" href="https://byrayray.medium.com/subscribe" rel="noopener"> <strong class="ak">通过电子邮件获取我的文章点击这里</strong> </a> <strong class="ak"> | </strong> <a class="ae kz" href="https://byrayray.medium.com/subscribe" rel="noopener"> <strong class="ak">购买5美元中等会员</strong> </a></h2></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h1 id="b869" class="mi mj iu bd mk ml mm mn mo mp mq mr ms ka mt kb mu kd mv ke mw kg mx kh my mz bi translated">阅读更多</h1><div class="nf ng gq gs nh"><div role="button" tabindex="0" class="ab bv gw cb fq pb pc bn pd kt ex"><div class="pe l"><div class="ab q"><div class="l di"><img alt="RayRay" class="l de bw pf pg fe" src="../Images/992af170033696163d6cc0269218aedd.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*1fUwrIRcFq3paK71SLifMw.png"/><div class="fb bw l pf pg fc n aw fd"/></div><div class="hi l fp"><p class="bd b dl z fq fr fs ft fu fv fw fx dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://byrayray.medium.com/?source=post_page-----cc6beadbde8--------------------------------" rel="noopener follow" target="_top">雷雷</a></p></div></div><div class="pj pk gx l"><h2 class="bd iv ul um fq un fs ft no fv fx it bi translated">荒诞的故事</h2></div><div class="ab q"><div class="l fp"><a class="bd b be z bi uo au up uq ur rc us an eh ei ut uu uv el em eo de bk ep" href="https://byrayray.medium.com/list/angular-stories-24674407532a?source=post_page-----cc6beadbde8--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="uw l fp"><span class="bd b dl z dk">6 stories</span></div></div></div><div class="pw dh px fq ab py fp di"><div class="di po bv pp pq"><div class="dh l"><img alt="" class="dh" src="../Images/b94f2b7d2929c90566cd2dd6f657a751.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*O_EKcNrJVWS18ZG-bP1FtA.png"/></div></div><div class="di po bv pr ps pt"><div class="dh l"><img alt="" class="dh" src="../Images/02b73423a62d73b113af9fdf9629c79f.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*HWY53D51pJqJuCKUXFf_9g.jpeg"/></div></div><div class="di bv pu pv pt"><div class="dh l"><img alt="Stacked books" class="dh" src="../Images/b02a2f57c0093e04ab1d11d3a55f35ea.png" width="194" height="194" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*QhXyFtl1Xx_ptTw5"/></div></div></div></div></div><div class="nf ng gq gs nh"><div role="button" tabindex="0" class="ab bv gw cb fq pb pc bn pd kt ex"><div class="pe l"><div class="ab q"><div class="l di"><img alt="RayRay" class="l de bw pf pg fe" src="../Images/992af170033696163d6cc0269218aedd.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*1fUwrIRcFq3paK71SLifMw.png"/><div class="fb bw l pf pg fc n aw fd"/></div><div class="hi l fp"><p class="bd b dl z fq fr fs ft fu fv fw fx dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://byrayray.medium.com/?source=post_page-----cc6beadbde8--------------------------------" rel="noopener follow" target="_top">雷雷</a></p></div></div><div class="pj pk gx l"><h2 class="bd iv ul um fq un fs ft no fv fx it bi translated">最新的JavaScript和TypeScript故事</h2></div><div class="ab q"><div class="l fp"><a class="bd b be z bi uo au up uq ur rc us an eh ei ut uu uv el em eo de bk ep" href="https://byrayray.medium.com/list/latest-javascript-typescript-stories-0358ad941491?source=post_page-----cc6beadbde8--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="uw l fp"><span class="bd b dl z dk">14 stories</span></div></div></div><div class="pw dh px fq ab py fp di"><div class="di po bv pp pq"><div class="dh l"><img alt="" class="dh" src="../Images/c93ca03b33796c40dcc47873de2697c2.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*UQtuHklwRW4uxOcO"/></div></div><div class="di po bv pr ps pt"><div class="dh l"><img alt="" class="dh" src="../Images/86f37efa11855f6f0f0f62984c37f696.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*gHDsISflc1mS_IJIuGZMUQ.png"/></div></div><div class="di bv pu pv pt"><div class="dh l"><img alt="" class="dh" src="../Images/ddbaa6d0bea676316247e82043d60b63.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*KJ9azc_7b1b_8tKn"/></div></div></div></div></div></div></div>    
</body>
</html>