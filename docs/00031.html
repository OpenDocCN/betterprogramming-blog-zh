<html>
<head>
<title>When to Use Callback Function of setState in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中何时使用setState的回调函数</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/when-to-use-callback-function-of-setstate-in-react-37fff67e5a6c?source=collection_archive---------7-----------------------#2017-05-29">https://betterprogramming.pub/when-to-use-callback-function-of-setstate-in-react-37fff67e5a6c?source=collection_archive---------7-----------------------#2017-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="86d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我第一次在React文档中读到setState时，我对自己说，“哦，这很简单，它只做一件事，改变状态，对吗？这就像改变一个变量的值。”</p><p id="ddd2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，在看到有人使用setState的回调后，我简单地忽略了它，因为我认为这只是一种奇特的做事方式。我想坚持我对setState的最初印象。</p><p id="6d78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我甚至看到有人争论说这样写:</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="3c06" class="kx ky it kt b gy kz la l lb lc">this.setState((prevState) =&gt; <br/>  ({ checked: !prevState.checked })<br/>)</span></pre><p id="ad7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">带来了比这更好的性能:</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="c52d" class="kx ky it kt b gy kz la l lb lc">this.setState({ checked: !this.state.checked })</span></pre><p id="9764" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我看来，他们两个没有太大的区别。第一个使用回调，setState接受回调作为第二个参数，然后返回对象来更改状态。</p></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><h1 id="b7ed" class="lk ky it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">使用setState的回调函数</h1><p id="2e3e" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">当我在子组件中调用父组件的方法时，我遇到了一个问题。通过查看代码，您会有更好的想法:</p><figure class="ko kp kq kr gt mm"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="2463" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我想在这里做两件事:</p><ol class=""><li id="c5d2" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn mu mv mw mx bi translated">更改当前子组件的状态</li><li id="b803" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn mu mv mw mx bi translated">传递一个参数，然后调用位于父组件中的getCalendarData方法。</li></ol><p id="a077" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上面的代码失败了，但是为什么呢？这是因为setState是异步的。getCalendarData函数在当前月份更改之前触发。</p><h2 id="8ca1" class="kx ky it bd ll nd ne dn lp nf ng dp lt kb nh ni lx kf nj nk mb kj nl nm mf nn bi translated">破解它让它工作</h2><figure class="ko kp kq kr gt mm"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="15d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是可行的，但是上面的代码并不理想。我们不能确保所有设备上的时间总是100毫秒的延迟。</p><h2 id="f045" class="kx ky it bd ll nd ne dn lp nf ng dp lt kb nh ni lx kf nj nk mb kj nl nm mf nn bi translated">更好的实践</h2><figure class="ko kp kq kr gt mm"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="cfec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我在回调中添加getCalendarData时，问题解决了。setState有一个可选的第二个参数，它是一个回调函数！</p><p id="c1ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一种方法是使用componentDidUpdate，如下所示:</p><figure class="ko kp kq kr gt mm"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="2623" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我决定不使用这种方法，因为我的组件是以一种允许重用的<a class="ae no" href="https://hackernoon.com/react-stateless-functional-components-nine-wins-you-might-have-overlooked-997b0d933dbc" rel="noopener ugc nofollow" target="_blank">纯功能</a>方式编写的。</p></div></div>    
</body>
</html>