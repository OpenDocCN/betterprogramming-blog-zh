<html>
<head>
<title>Getting Started With WebAssembly, Docker, and Alpine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WebAssembly、Docker和Alpine入门</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-wasm-webassembly-docker-alpine-b8652f82ce5e?source=collection_archive---------5-----------------------#2020-10-22">https://betterprogramming.pub/getting-started-with-wasm-webassembly-docker-alpine-b8652f82ce5e?source=collection_archive---------5-----------------------#2020-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4c24" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">今天就开始体验WASM</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f64b1efd1f578755ef7d800828f515b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q7bYOul2CzChKewk"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卢卡斯·范·奥尔特在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="71ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Go </a>内置的支持使得WASM (WebAssembly)变得简单可行。让我们第一次尝试使用WASM。在您的系统上运行之前，需要几个包。</p><p id="fd43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先创建一个. Docker文件，并在您的主机上安装Docker:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="9eb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们有一个<a class="ae ky" href="https://alpinelinux.org/" rel="noopener ugc nofollow" target="_blank">高山</a>为基础的围棋。dockerfile文件</p><p id="57a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个最小尺寸的Docker镜像，已经安装了Go。</p><p id="505d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将创建一个名为<code class="fe lx ly lz ma b">/app</code>的工作目录，然后使用带有参数<code class="fe lx ly lz ma b">--no-cache</code>的命令<code class="fe lx ly lz ma b">apk add</code>安装<code class="fe lx ly lz ma b">git</code>。</p><p id="4797" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将为我们的Alpine实例做好准备，以允许稍后在流程中引入Git模块。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="a6ba" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">编译WASM文件的必要步骤</h1><p id="78b7" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">注意我们的运行命令:</p><pre class="kj kk kl km gt nf ma ng nh aw ni bi"><span id="7b61" class="nj mj it ma b gy nk nl l nm nn">RUN cp "$(go env GOROOT)/misc/wasm/wasm_exec.js" .</span></pre><p id="bb72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令从Go包中复制一个必需的文件，该文件将用于编译到WASM。接下来，让我们看看编写的服务器命令。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="b442" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">在Docker中提供WASM文件</h1><p id="0d29" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">这基本上是一个Go运行时，我们将把它用作静态服务器:</p><pre class="kj kk kl km gt nf ma ng nh aw ni bi"><span id="1d38" class="nj mj it ma b gy nk nl l nm nn">RUN go get -u github.com/shurcooL/goexec</span></pre><p id="5465" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个包需要安装，并且是我们的服务器命令所必需的:</p><pre class="kj kk kl km gt nf ma ng nh aw ni bi"><span id="3ccb" class="nj mj it ma b gy nk nl l nm nn">CMD ["goexec", "http.ListenAndServe(`:8080`, http.FileServer(http.Dir(`.`)))"]<!-- --> </span></pre></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="27cd" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">在Docker中构建WASM文件</h1><p id="e461" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">现在我们有了。dockerfile文件设置完毕，让我们从这个文件开始构建:</p><pre class="kj kk kl km gt nf ma ng nh aw ni bi"><span id="0e45" class="nj mj it ma b gy nk nl l nm nn">docker build -t wasm .</span></pre><p id="9807" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们最终开始使用用Go编写的WASM应用程序。</p><p id="1f2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个名为<code class="fe lx ly lz ma b">main.go</code>的文件。这将是我们的主要应用程序(又名前端),稍后将被写入WASM文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="73cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在Go语法中定义了一些函数(vanilla-js-looking)。</p><p id="11bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">WASM是一种用于浏览器的本机汇编语言。</p><p id="70ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，某些Go功能可能不兼容。由于web浏览器的沙箱特性，一些试图与主机交互的功能可能无法工作。</p><p id="f387" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们创建一个<code class="fe lx ly lz ma b">index.html</code>文件，它可以触发这些函数并运行我们的程序。</p><p id="e212" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们有一个函数调用一个<code class="fe lx ly lz ma b">onClick</code> HTML按钮元素。</p><p id="21bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们编译<code class="fe lx ly lz ma b">.wasm</code>文件之前，这个<code class="fe lx ly lz ma b">add()</code>函数还不存在。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="6367" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们回顾一下docker文件中编译发生的位置:</p><pre class="kj kk kl km gt nf ma ng nh aw ni bi"><span id="9f7a" class="nj mj it ma b gy nk nl l nm nn">RUN GOOS=js GOARCH=wasm go build -o main.wasm</span></pre><p id="f7fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们加载服务器之前,<code class="fe lx ly lz ma b">RUN</code>命令将编译成<code class="fe lx ly lz ma b">.wasm</code>。</p><p id="6fe1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lx ly lz ma b">GOOS=js</code>和<code class="fe lx ly lz ma b">GOARCH=wasm</code>需要建立一个<code class="fe lx ly lz ma b">.wasm</code>文件。</p><p id="8fe5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当使用带有<code class="fe lx ly lz ma b">-o</code>参数的<code class="fe lx ly lz ma b">go build</code>来设置输出文件名时，我们的Go应用程序将被编译成WASM。</p><p id="a9d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用参数<code class="fe lx ly lz ma b">-d</code>在分离模式下运行一个容器:</p><pre class="kj kk kl km gt nf ma ng nh aw ni bi"><span id="bd19" class="nj mj it ma b gy nk nl l nm nn">docker run -d -p 8180:8080 wasm</span></pre><p id="e021" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，我在端口<code class="fe lx ly lz ma b">8080</code>前使用端口<code class="fe lx ly lz ma b">8180:</code>。</p><p id="6ff7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是从主机到容器的重新映射。</p><p id="cff4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以将其更改为主机上可用的任何端口号。甚至<code class="fe lx ly lz ma b">80</code>都可以工作。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="3a7c" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">结论</h1><p id="25b3" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我希望你发现你第一次使用WASM和我一样令人兴奋。作为一名独立的开发人员继续学习和成长，你可以用WebAssembly制作出很棒的工具、产品和体验。</p><p id="dfe1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p></div></div>    
</body>
</html>