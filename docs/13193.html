<html>
<head>
<title>Awesome Website Monitoring With Uptime Kuma</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">真棒网站监测与正常运行时间库马</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/awesome-website-monitoring-with-uptime-kuma-736dfebc1dd3?source=collection_archive---------3-----------------------#2022-08-05">https://betterprogramming.pub/awesome-website-monitoring-with-uptime-kuma-736dfebc1dd3?source=collection_archive---------3-----------------------#2022-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="09f8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用这个直观、轻量级的程序检查你的网站</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4a06a5781e6193e1d13364de57e9ec41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y2gEtjCCR2jkM0T_YeQM9A.png"/></div></div></figure><p id="1c06" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇文章中，我想分享我为我的网站设置监控的经验。虽然其他监视堆栈，如使用prometheus、node-exporter和graphana结合警报提供了大量很酷的功能，但我想介绍一个轻量级的简单堆栈。这个堆栈的核心组件是一个名为<a class="ae ln" href="https://github.com/louislam/uptime-kuma" rel="noopener ugc nofollow" target="_blank"> uptime-kuma </a>的项目。它是用node.js和vue编写的，带有一个非常漂亮的用户界面。说服我运行uptime-kuma的主要理由是:</p><ul class=""><li id="bf40" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">超级简单的设置和配置</li><li id="9ddb" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">超赞的用户界面</li><li id="0d2c" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">电报通知的简单集成</li><li id="b4fe" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">一组用于检查网站的简洁配置</li></ul><p id="7c0a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以让我们开始部署uptime-kuma。我喜欢使用<a class="ae ln" href="https://doc.traefik.io/traefik/" rel="noopener ugc nofollow" target="_blank"> traefik </a>作为反向代理，使用<a class="ae ln" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"> docker-compose </a>部署。这个简单的单主机设置允许您自动为域颁发LetsEncrypt证书。</p><p id="2cf5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，这里是设置所需的全部内容:一个具有公共IP地址的主机，一个可以访问您的监控的域，以及一个将该域指向相应主机的A记录。在主机上，需要安装docker和docker-compose。有几个关于为不同操作系统安装这两个工具的指南，例如<a class="ae ln" href="https://docs.docker.com/engine/install/ubuntu/" rel="noopener ugc nofollow" target="_blank"> docker </a>和<a class="ae ln" href="https://docs.docker.com/compose/install/" rel="noopener ugc nofollow" target="_blank"> docker-compose </a>。就是这样。</p><h1 id="8fb8" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">traefik Docker-撰写部署</h1><p id="758d" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">对于traefik，只有大量不同的合成文件，因此您可以选择您喜欢的任何文件。如果你只是想遵循这个指南，让我给你看看我的。我喜欢将docker-compose部署放在<code class="fe mz na nb nc b">/usr/docker</code>下。所以对于traefik，我们在<code class="fe mz na nb nc b">/usr/docker/traefik</code>下有以下文件。首先，需要将以下内容放入<code class="fe mz na nb nc b">docker-compose.yml</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="f611" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">合成文件包含一个服务和一个网络。该服务是带有一些命令行标志的traefik容器。主要是，你只要换个邮箱就行了。如果您想避免在使用您的设置进行测试时遇到LetsEncrypt的速率限制，您可以将acme resolver更改为staging(参见要点中的注释)。您可以申请任意多的证书，没有速率限制，但是会得到浏览器不自动信任的证书。</p><p id="522b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以不是生产用的。traefik服务为HTTPS流量转发<code class="fe mz na nb nc b">ports 80</code>和<code class="fe mz na nb nc b">443</code>，为仪表板转发<code class="fe mz na nb nc b">127.0.0.1:8080</code>，仪表板只能从本地主机访问。此外，还有一个名为<code class="fe mz na nb nc b">reverseproxy</code>的外部docker网络。我们将把traefik作为反向代理的所有容器连接到该网络。我们需要放入该文件夹的第二个文件是<code class="fe mz na nb nc b">traefik.toml</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a8eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此配置为HTTP和HTTPS流量以及日志设置入口点。对特蕾菲克来说就是这样。</p><p id="12ee" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您现在可以在<code class="fe mz na nb nc b">/usr/docker/traefik</code>文件夹中运行以下命令:<br/>-<code class="fe mz na nb nc b">docker network create -d bridge reverseproxy</code>-<br/>-<code class="fe mz na nb nc b">touch access.log</code>-<br/>-<code class="fe mz na nb nc b">docker-compose up -d</code></p><h1 id="084f" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">正常运行时间-库马码头-撰写部署</h1><p id="afb0" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">对于uptime-kuma，作者提供了一个开箱即用的<a class="ae ln" href="https://github.com/louislam/uptime-kuma/blob/master/docker/docker-compose.yml" rel="noopener ugc nofollow" target="_blank"> docker-compose </a>文件。要使用LetsEncrypt证书在traefik后面运行它，我们只需将它更改为下面的<code class="fe mz na nb nc b">/usr/docker/uptime-kuma/docker-compose.yml</code>文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="43c8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要配置一些traefik标签，让traefik获得域的正确证书。此外，需要将uptime-kuma容器添加到反向代理网络中，以便traefik可以将传入流量转发给它。最后，只需在uptime-kuma文件夹中运行以下命令来启动容器:<code class="fe mz na nb nc b">docker-compose up -d</code></p><h1 id="2490" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">配置正常运行时间-库马</h1><p id="442e" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">第一次访问uptime-kuma实例时，必须配置一个安全的管理员密码。完成后，您可以开始添加端点。用户界面是这样的。你可以定义特定的行为，例如HTTP返回码，证书验证等。太棒了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/9c0d9a137f0b5b5aef4dfe714d194061.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GjQVLR7iUew5qjoD5yCrAw.png"/></div></div></figure><p id="403e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦您添加了第一个端点，我建议您配置电报通知。这样，每当一个或多个终端不按预期工作时，您都会收到通知。设置电报通知非常容易。您需要创建一个组、一个bot，并在uptime-kuma中配置组的聊天ID和bot令牌。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/294e4df77053f51af828dc383abd3c7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0MIEooKyKqVvYv79G70fJw.png"/></div></div></figure><p id="ba6c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以，我们一步一步来。要创建一个机器人，你需要编写<a class="ae ln" href="https://core.telegram.org/bots#6-botfather" rel="noopener ugc nofollow" target="_blank">机器人父亲</a>。进入telegram(或web telegram)，打开与Botfather的聊天(按照doc中的链接)，然后编写<code class="fe mz na nb nc b">/newbot</code>作为对bot的命令。您需要按照要求给它一个名称和用户名。您可以看到您的令牌，这是uptime-kuma所需配置的第一部分。</p><p id="f6d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，创建一个新的电报组，并将机器人添加到其中。您现在可以按照这里的指示<a class="ae ln" href="https://stackoverflow.com/questions/32423837/telegram-bot-how-to-get-a-group-chat-id" rel="noopener ugc nofollow" target="_blank">获取聊天id</a>。基本上你需要在群聊里写一条消息，用你喜欢的任何工具向<code class="fe mz na nb nc b">https://api.telegram.org/bot&lt;YourBOTToken&gt;/getUpdates</code>发出get请求，然后寻找聊天字段。有时候这个数字是负数。别担心，那很好。</p><p id="c73b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用chatId，您可以完成配置。您可以使用设置对话框中的按钮测试电报通知。</p><h1 id="dc77" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">摘要</h1><p id="578a" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">本文向您展示了如何将uptime-kuma与traefik反向代理结合安装，以及如何配置电报通知。在我看来，这是一个伟大的工具，监测网站，有许多有用的设置。如果你只需要确保你的网站正常运行，我绝对推荐你使用它。</p><p id="f52f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请随时分享任何反馈。我很乐意把它加到这篇文章里。</p></div></div>    
</body>
</html>