<html>
<head>
<title>Implementing SwiftUI TimelineView in iOS 15</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS 15中实施SwiftUI TimelineView</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/implementing-swiftui-timelineview-in-ios-15-511f414614a6?source=collection_archive---------3-----------------------#2021-09-27">https://betterprogramming.pub/implementing-swiftui-timelineview-in-ios-15-511f414614a6?source=collection_archive---------3-----------------------#2021-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d135" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们使用新的画布视图构建一个数字时钟</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7fc8e9789786739230465ce43b8f3fb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*AQD-yWzExox4xdHyEhAq8w.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用全新SwiftUI 3.0 TimelineView的时钟</p></figure><p id="0a60" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你听说过crontab吗？不，他不是DC英雄。它从1975年就存在了，那是一个永恒。iOS曾经运行过一个crontab，虽然翻看SO的帖子，但是早就销声匿迹了。当然，它仍然存在于OS X，在shell下键入“crontab -l ”,您将得到一个响应。</p><p id="39d1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但也许并没有失去一切，因为在iOS 15中，苹果推出了一个新的视图，专门用于按计划运行作业，有点像crontab。我说运行作业，是指刷新计划中的视图。现在；在这一点上，我应该承认，我不太确定我应该如何使用这个新的视图。我不确定，因为SwiftUI中已经有了一个调度程序。像这样的调度程序。</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="0989" class="lz ma it lv b gy mb mc l md me">let timer = Timer.publish(every: 0.5, on: .main, in: .common).autoconnect()</span></pre><p id="f6c2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在代码中捕获一个调度程序，并强制进行某种视图刷新。在所示情况下，每0.5秒刷新一次。</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="f49d" class="lz ma it lv b gy mb mc l md me">.onReceive(timer) { _ in<br/>  refresh += 1<br/>}.id(refresh)</span></pre><p id="f7ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我只能假设他们决定创建一个专用于调度的视图，因为它符合SwiftUI中真理哲学的单一来源。安排应用程序应该引用的所有代码的单一来源。请和我一起踏上了解这一新观点的旅程。</p><p id="a225" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们从我能做的最简单的<code class="fe mf mg mh lv b">TimelineView</code>开始。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="1b4f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一段代码将产生这个输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a74567291c02ca397c720c2293ba4721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aYfYPvB-MrRxjrh0gY7azQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">新SwiftUI 3.0 TimelineView的基本输出</p></figure><h2 id="02a9" class="lz ma it bd mk ml mm dn mn mo mp dp mq lh mr ms mt ll mu mv mw lp mx my mz na bi translated">案情摘要</h2><p id="f819" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我想把它变成一个时钟，一个带数字的数字时钟。它需要显示秒、分、小时…仅此而已。</p><p id="3357" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，我最初的想法是解析我从<code class="fe mf mg mh lv b">TimelineView</code>获得的行，尽管我很快改变了主意，因为我确信它不会很好地老化——谁知道在SwiftUI 4.0中苹果会默认报告什么。我认为更好的解决方案是使用<code class="fe mf mg mh lv b">onChange</code>指令来观察这条线的变化。这是我的第一个时钟代码片段:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="e9d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的代码生成了一个非常简单的数字时钟，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f82e044eea1f14180f25c0903b57ded6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*SlWrV75u9rPS1ZeTe52IAA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用全新SwiftUI 3.0 TimelineView的时钟</p></figure><p id="4613" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，除了无聊；还有一个更严重的问题——当它变化时，你会看到一个小的抖动。这都与所显示数字的宽度有关。例如，数字2的宽度大于1。我确实尝试用框架来解决这个问题，但它仍然不起作用。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><p id="04d7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，如果你看着它运行，再仔细想想这个问题——专注于固定一个数字是有意义的。如果我能得到一位数的工作，那么我就成功了。我也想借此机会让时钟变得更有趣，想起我在亿万年前发表的一篇论文，<a class="ae nn" rel="noopener ugc nofollow" target="_blank" href="/drawing-in-3d-using-swiftui-ed211d7c2c91">这篇</a>。我决定在这里也尝试使用rotation3DEffect。经过几次尝试后，我完成了这段代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="1b0b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">动画方面的正道，没那么无聊。最终结果如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/66ef65a5a7b76a417c89a1e4a3617c00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*CZ_fvVnII4EOFc6NlH7K3Q.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用新的SwiftUI 3.0 TimelineView进行计数</p></figure><p id="a488" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，正如你在这个动画GIF中看到的，我仍然有一个微光在那里。当然我可以去掉边框，但是如果我把两个视图放在一起，它们会因为值的改变而争夺空间。我仍然发抖。</p><p id="9979" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我需要做的是使用一张图片。使用iOS 15中另一个新视图，即画布的理想机会。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="0335" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将代码嵌入到我为文本对象创建的先前结构中。一个简单的更新。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b7cdb74e1c16886952eb33bd8e1b0491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*rtK7DPTUkWkC02jMtJC1oQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用新的SwiftUI 3.0 TimelineView进行计数</p></figure><p id="a2c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我相信你会同意，这要好得多。我不仅去掉了hic-up的显示，而且正如你所看到的，我开始摆弄它翻转数字的方式。秒的下拉列表，每十秒钟数字就会翻上来。</p><p id="959b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后我放了一个开关，根据转动的数字选择不同种类的3d效果。你有很多选择。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="25ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的代码代表了一个我会在<code class="fe mf mg mh lv b">timelineView</code>括号内重复调用的视图。最终结果，你可以看到这篇论文的标题。我承认我确实编辑了一点，这样你会看到时间过得更快，而且我包括了比我在这里展示的更多的<code class="fe mf mg mh lv b">TimelineView</code>，总共六个。</p><p id="2e66" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每个视图与所有其他视图同步，在有意义的时间运行。第一个视图在循环回到0之前计数到9。第二个视图在循环回到零之前只计数到5。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="7c35" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">总而言之，这让我想到了这篇文章的结尾。感谢阅读。</p></div></div>    
</body>
</html>