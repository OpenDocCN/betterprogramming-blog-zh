<html>
<head>
<title>How I Created a Pre-reveal for the Lazarus NFT Collection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何为拉撒路·NFT系列设计预展的</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-pre-reveal-mechanism-for-your-nft-collection-b2ff372a2b36?source=collection_archive---------13-----------------------#2022-08-03">https://betterprogramming.pub/create-a-pre-reveal-mechanism-for-your-nft-collection-b2ff372a2b36?source=collection_archive---------13-----------------------#2022-08-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="261c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一种简单、安全且有效的方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/753c1ea46864e983347e11678f2c8db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*34pCzdF1c2fwG_OaWC16xQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">带有预显示占位符图像的NFTs</p></figure><p id="352c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在推出新的亲民党风格的NFT系列(一个la Bored Ape游艇俱乐部)时，为每一个铸造的NFT使用占位符图像已经成为一种常见的做法，只有在所有的NFT都铸造完成后，才显示最终的NFT。</p><p id="417c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一个重要的实践，因为如果没有它，狙击手可以根据通过元数据暴露的特性的稀有性来选择铸造哪些NFT。</p><p id="298d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我最近为LazarusNFT 系列开发了智能合约，并使用了这种预披露技术。</p><p id="38ae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在开始构建这个特性之前，让我们扩展一下我们的业务需求:</p><ul class=""><li id="e2d7" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">隐藏令牌和元数据，直到生成所有令牌</li><li id="3203" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">一旦用户铸造了令牌，就向他们发送令牌的“预揭示”版本</li><li id="cd2d" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">允许合同所有者“显示”集合中的所有令牌</li></ul><p id="bd88" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们的智能契约负责返回每个令牌的<code class="fe mg mh mi mj b">metadata.json</code>文件所在的URL。</p><p id="bf8b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以解决上述问题的方法是创建一个“预揭示”元数据文件，并将其上传到某个地方(例如:<a class="ae lr" href="https://example.org/pre-reveal.json" rel="noopener ugc nofollow" target="_blank">https://example.org/pre-reveal.json</a>)。这个“揭示前的URI”是我们希望在揭示发生之前为每个令牌返回的内容。</p><p id="3baa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">揭示之后，我们希望能够用一个新的URL来更新智能合约，该URL可用于生成正确的令牌URIs。</p><p id="ba26" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">例如，如果我们已经将所有的令牌上传到一个响应<code class="fe mg mh mi mj b">https://exmaple.org/tokens/:tokenId</code>的web服务器，那么我们将希望用我们的<code class="fe mg mh mi mj b">baseURI</code> ( <code class="fe mg mh mi mj b">https://example.org/tokens/</code>)来更新智能合约，这样它可以通过简单地将令牌ID附加到<code class="fe mg mh mi mj b">baseURI</code>来轻松地生成正确的<code class="fe mg mh mi mj b">tokenURI</code>。</p><p id="3f42" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有了这些知识，我们可以将问题重新定义为智能合同的更具体的要求:</p><ul class=""><li id="88e2" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">当集合尚未显示时，它应该返回通用元数据</li><li id="e4b1" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">它应该允许契约所有者更新baseURI</li><li id="fc74" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">当令牌暴露时，它应该返回正确的元数据</li></ul><h1 id="df54" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">我们如何实现它？</h1><p id="5c68" class="pw-post-body-paragraph kv kw iq kx b ky nc jr la lb nd ju ld le ne lg lh li nf lk ll lm ng lo lp lq ij bi translated">让我们假设我们正在为NFT集合开发一个智能契约，它扩展了通常的OpenZeppelin <code class="fe mg mh mi mj b">ERC721</code>实现。</p><p id="9a86" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您检查<code class="fe mg mh mi mj b">ERC721.sol</code>契约，您会发现其中实现了一个<code class="fe mg mh mi mj b">tokenURI</code>函数。</p><p id="5280" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就是，供你参考:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/8bfd76105dd15e8d65b40e2496a5090e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xOg0nKXam3fMAMB7l0c-bw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">OpenZeppelin对tokenURI的实现</p></figure><p id="5f5d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">它们的实现(如上)将自动连接基本URI(从<code class="fe mg mh mi mj b">_baseURI()</code>返回—我们需要记住它以便以后使用)和被检索的令牌ID。</p><p id="0c05" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这对于揭示之后非常有用——但是对于揭示之前，我们需要覆盖这个函数来返回揭示之前的URI:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/5d6924308965e275ce6793e72b30c0f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3D92qQHcKtYUSm-B09BPzw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">tokenURI函数</p></figure><p id="f675" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你会注意到我们引用了几个全局变量:<code class="fe mg mh mi mj b">_isRevealed</code>和<code class="fe mg mh mi mj b">_preRevealURI</code>。您可以按照自己喜欢的方式实现它们，但最简单的方法是，您可以在合同的顶部简单地定义它们:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/2a4be3e6f3f52f075c759862594f627e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qZ_nfsDxJKGjA0vbZzQ4Pg.png"/></div></div></figure><p id="a86e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们需要创建一个函数来“揭示”令牌。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/76b1748b1b17c492230c05055f15ed46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MByjeY4eVgWr6Uz1s39ZYQ.png"/></div></div></figure><p id="abd2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面的reveal函数会将传递的baseURI保存到一个名为<code class="fe mg mh mi mj b">_postRevealBaseURI</code>的全局变量中，并将<code class="fe mg mh mi mj b">_isRevealed</code>布尔值设置为<code class="fe mg mh mi mj b">true</code>。</p><p id="5a82" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们差不多完成了，将<code class="fe mg mh mi mj b">_isRevealed</code>布尔值设置为<code class="fe mg mh mi mj b">true</code>，然后我们之前编写的<code class="fe mg mh mi mj b">tokenURI</code>函数将遵从父类的实现。</p><p id="ee8e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您还记得，这个实现调用了一个<code class="fe mg mh mi mj b">_baseURI</code>函数来检索基URI。</p><p id="6b0e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们检查该实现，我们可以看到它实际上是要被覆盖的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/b742a16e56a028fbb0371856e1e02046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pMwTR7xOiH5W0o7Nek54zQ.png"/></div></div></figure><p id="8688" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们强制OpenZeppelin并覆盖<code class="fe mg mh mi mj b">_baseURI</code>函数来返回正确的基本URI！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/3aee7240435ffd826a95e435be768eda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D6pHYdTBI4aN7RWSOTV0Yg.png"/></div></div></figure><h1 id="d71f" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">结论</h1><p id="c2da" class="pw-post-body-paragraph kv kw iq kx b ky nc jr la lb nd ju ld le ne lg lh li nf lk ll lm ng lo lp lq ij bi translated">您已经学习了一种简单、安全、有效的方法来实现NFT预揭露机制。</p><p id="c266" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这篇文章是从我即将发行的新书《NFT作品集开发者指南》中特别改写的摘录。</p><pre class="kg kh ki kj gt nn mj no np aw nq bi"><span id="a767" class="nr ml iq mj b gy ns nt l nu nv">If you'd like to get a head-start on learning to code an NFT Collection from scratch, check out my book: "<a class="ae lr" href="https://book.michaelstivala.com/" rel="noopener ugc nofollow" target="_blank">A developer's guide to launching an NFT Collection</a>" - use this link for 10% off!</span><span id="6b57" class="nr ml iq mj b gy nw nt l nu nv"><a class="ae lr" href="https://twitter.com/MichaelStivala" rel="noopener ugc nofollow" target="_blank">Follow me on twitter</a> for more blockchain-related tips and tricks, and to follow along as I use my software development skills to build $10k/month in passive income.</span></pre></div></div>    
</body>
</html>