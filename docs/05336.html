<html>
<head>
<title>Using Serverless Technologies to Create a Simple, Low-Cost Twitter Bot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用无服务器技术创建一个简单、低成本的Twitter机器人</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/creating-a-simple-low-cost-twitter-bot-utilising-serverless-technologies-a4044245f645?source=collection_archive---------11-----------------------#2020-06-30">https://betterprogramming.pub/creating-a-simple-low-cost-twitter-bot-utilising-serverless-technologies-a4044245f645?source=collection_archive---------11-----------------------#2020-06-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ecef" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们一起建造一个推特机器人</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c7a29e12e8fef503d7c9406ab6356502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JSxldNYaw9IaqVrm4BoztA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:【www.freepik.com/macrovector T4】</p></figure><p id="05fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">人们对Twitter机器人又爱又恨。对于转发与你正在寻找的东西相关的内容来说，它们可能是有用的，但是如果它们发太多或者如果它们发的是你不关心的东西，它们也可能是令人讨厌的。但是，您可以通过创建自己的bot来解决这个问题。</p><p id="299f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个Twitter机器人相对简单。在真正的无服务器风格中，有可能以经济高效的方式构建自己的服务器。本文将重点关注在<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点</a>中创建一个Twitter机器人，托管在<a class="ae ky" href="https://docs.aws.amazon.com/index.html?nc2=h_ql_doc_do" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>中。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4034" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么没有服务器？</h1><p id="51f8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对Twitter机器人使用无服务器模式完全有意义。</p><h2 id="6109" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">触发器</h2><p id="6829" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">触发器将基于cron作业。在真正的无服务器风格中，我将使用Cloudwatch，并利用一个类似cron的表达式来触发我的lambda。</p><p id="41bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我的活动，穿过<a class="ae ky" href="https://www.terraform.io/docs/index.html" rel="noopener ugc nofollow" target="_blank">地形</a>:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="e720" class="mz md it nm b gy nq nr l ns nt">resource aws_cloudwatch_event_rule every_one_hour {<br/>  name                = "every-one-hour"  <br/>  description         = "Fires every one hour"  <br/>  schedule_expression = "rate(1 hour)"<br/>}</span></pre><p id="923d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Cloudwatch事件规则将每小时运行一次。当它运行时，我希望它调用一个lambda，所以我还需要设置一个事件目标。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="609c" class="mz md it nm b gy nq nr l ns nt">resource aws_cloudwatch_event_target twitter_bot {  <br/>  rule      = aws_cloudwatch_event_rule.every_one_hour.name <br/>  target_id = "lambda"  <br/>  arn       = aws_lambda_function.lambda.arn<br/>}</span></pre><p id="bea9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要忘记设置允许功能执行:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="6db3" class="mz md it nm b gy nq nr l ns nt">resource aws_lambda_permission allow_cloudwatch_to_call_check_foo {<br/>  statement_id  = "AllowExecutionFromCloudWatch"  <br/>  action        = "lambda:InvokeFunction"  <br/>  function_name = aws_lambda_function.lambda.function_name<br/>  principal     = "events.amazonaws.com"  <br/>  source_arn    = aws_cloudwatch_event_rule.every_one_hour.arn<br/>}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="422d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">代码</h1><p id="7b5c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在有了一个触发lambda的方法，我们现在需要一些代码让它运行。我选择Node作为框架，因为我真的很喜欢JavaScript。用一大堆其他语言写这个也一样容易。</p><p id="08ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将为这个项目使用的依赖项是(<code class="fe nu nv nw nm b">package.json</code>):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="4b58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我需要为AWS Lambda调用我的函数(<code class="fe nu nv nw nm b">index.js</code>)创建入口点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="5069" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，所有的配置都是通过环境变量注入的。</p><p id="b084" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nu nv nw nm b">TwitterClient.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="b70e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我基本上是搜索一个标签，并试图过滤掉更多垃圾推文。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c9ce" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">注册一个开发者账户</h1><p id="25b3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了使用代码发送推文，您需要注册创建一个开发者帐户。此处讨论了该过程:</p><p id="f821" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://apps.twitter.com/" rel="noopener ugc nofollow" target="_blank">https://apps.twitter.com/</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/70b5325d24007009d1e7cc90beb42045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6R1XE5LuBarFr5X_GFzmeg.png"/></div></div></figure><p id="ec2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注册后，请确保存储:</p><ul class=""><li id="8b9f" class="oa ob it lb b lc ld lf lg li oc lm od lq oe lu of og oh oi bi translated">访问令牌</li><li id="f3e4" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated">访问令牌秘密</li><li id="e8b6" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated">API密钥</li><li id="c239" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated">API密钥机密</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f6a1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">本地测试</h1><p id="c883" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了测试这一切是如何工作的，我基本上手动调用处理程序，设置环境变量:</p><p id="955f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nu nv nw nm b">index.js</code>的结尾，我补充一句:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="0c01" class="mz md it nm b gy nq nr l ns nt">exports.handler();</span></pre><p id="84c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并运行该函数，如下所示:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="f7b5" class="mz md it nm b gy nq nr l ns nt">TWITTER_CONSUMER_KEY=xxxxU5FaJU3bgDz6nGt9xxxxx TWITTER_CONSUMER_SECRET=XXXXXXXXaQsdHuaC4h3oR3URRqYd0jnqoBVcd9HEV1XXXXXXXX TWITTER_ACCESS_KEY=0000000051433271300-XXXXXXXXRRUdtAMtHoAHIVXXXXXXXX TWITTER_ACCESS_SECRET=xxxxxxxxGalNApvG3yDwPtY2szibxW7TLEImXXXXXXXX FIND_HASHTAG=#serverless RETWEET_COUNT=5 npm start</span></pre><p id="c2e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将搜索多达30条标签为#serverless的推文，并转发其中的5条。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="72ad" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为Lambda构建</h1><p id="b2a3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">因为默认情况下Node会将它的包安装到<code class="fe nu nv nw nm b">node_modules</code>目录中，所以只需要压缩目录并将其推送到AWS。</p><p id="549e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，这对于Terraform来说是一件相当简单的事情。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b7e0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="5d6b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在你有了:一个每小时转发一个特定标签的Twitter机器人！我希望这篇文章对你有所帮助。请在评论区留下任何反馈或问题。感谢阅读。</p></div></div>    
</body>
</html>