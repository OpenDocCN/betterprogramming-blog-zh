<html>
<head>
<title>Observe UIButton Events Using Combine in Swift 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Swift 5中使用Combine观察UIButton事件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/observe-uibutton-events-using-combine-in-swift-5-63c1a4e0a0c1?source=collection_archive---------3-----------------------#2021-07-15">https://betterprogramming.pub/observe-uibutton-events-using-combine-in-swift-5-63c1a4e0a0c1?source=collection_archive---------3-----------------------#2021-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ca66" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建和利用您自己的可重用发布者</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7577c9d9df1efcbf58eb16b31ee0863e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hCARlRy-M7kntA4F"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马克西姆·霍普曼在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="66a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将学习如何在Combine中创建我们自己的<code class="fe lv lw lx ly b">Publisher</code>,您可以很容易地在您的应用程序中重用它。</p><p id="ccfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的计划是尽可能简单地观察<code class="fe lv lw lx ly b">UIButton</code>抽头。这是我们在本文结尾时将拥有的功能:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lz"><img src="../Images/a9bf81c805d0a6a05d57aceb98b62bab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5HriZxHVU7MjXt4YaYREFA.png"/></div></div></figure><p id="5819" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Xcode Playground的源代码可以在文章的底部找到。</p><h1 id="17fa" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">我们开始吧</h1><p id="0f00" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">首先，我们导入<code class="fe lv lw lx ly b">Combine</code>，并在<code class="fe lv lw lx ly b">UIControl</code>上创建一个扩展:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="c1ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了实现我们的目标，我们需要实现三件事:</p><ul class=""><li id="7f47" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">自定义订阅</li><li id="3138" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">自定义发布者结构</li><li id="a55d" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">方便的<code class="fe lv lw lx ly b">publisher()</code>方法</li></ul><p id="5093" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从订阅开始:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="6742" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们在扩展中创建了<code class="fe lv lw lx ly b">InteractionSubscription</code>类。这个类符合<code class="fe lv lw lx ly b">Subscription</code>协议。我们使用where <code class="fe lv lw lx ly b">S.Input == Void</code>来表示一旦点击一个按钮，我们将向订阅者发送<code class="fe lv lw lx ly b">Void</code>值。</p><ul class=""><li id="b6e1" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">我们创建了三个属性:<code class="fe lv lw lx ly b">subscriber</code>、<code class="fe lv lw lx ly b">control</code>和<code class="fe lv lw lx ly b">event</code>。稍后我们将使用<code class="fe lv lw lx ly b">subscriber</code>属性来通知用户点击了一个按钮。属性将被赋予一个目标和一个处理程序。这是我们实际通知订户事件的地方。我们计划使用<code class="fe lv lw lx ly b">event</code>属性来指定触发通知的实际事件。一旦我们使用了publisher，这一点就更清楚了。</li><li id="420e" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">我们添加了一个初始化器，这样我们就可以在即将创建的发布器中实例化这个<code class="fe lv lw lx ly b">InteractionSubscription</code>。</li><li id="980f" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe lv lw lx ly b">request(_ demand:</code>和<code class="fe lv lw lx ly b">cancel()</code>方法是<code class="fe lv lw lx ly b">Subscription</code>协议所要求的。</li></ul><p id="6d0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们给<code class="fe lv lw lx ly b">control</code>属性附加一个处理程序，一旦执行了某个事件就通知<code class="fe lv lw lx ly b">subscriber</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><ul class=""><li id="e5d3" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">当用户点击按钮时，会触发<code class="fe lv lw lx ly b">handleEvent(_ sender:)</code>方法。</li><li id="2ab3" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">在该方法中，我们通知发布者发生了一个事件。正如我之前解释的，我们发出<code class="fe lv lw lx ly b">Void</code>值。这就是为什么我们的订户只收到一个<code class="fe lv lw lx ly b">()</code>值。</li></ul><p id="d399" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">订阅完成后，现在我们需要实现一个定制的<code class="fe lv lw lx ly b">Publisher</code>和一个获取它的方便方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><ul class=""><li id="1454" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">我们添加符合<code class="fe lv lw lx ly b">Publisher</code>协议的<code class="fe lv lw lx ly b">InteractionPublisher</code>结构。</li><li id="3d47" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">我们指定这个<code class="fe lv lw lx ly b">Publisher</code>发出<code class="fe lv lw lx ly b">Void</code>值并且从不失败。</li><li id="d34b" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">类似于我们在<code class="fe lv lw lx ly b">InteractionSubscription</code>中所做的，这里我们依赖于<code class="fe lv lw lx ly b">UIControl</code>和<code class="fe lv lw lx ly b">UIControl.Event</code>属性。我们将使用它们来初始化我们先前定义的订阅，并将其附加到订阅者。</li><li id="10e3" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe lv lw lx ly b">receive&lt;S&gt;(subscriber:)</code>方法是<code class="fe lv lw lx ly b">Publisher</code>协议所需要的。我们现在要用内容填充它。</li></ul><p id="29cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们修改<code class="fe lv lw lx ly b">receive&lt;S&gt;(subscriber:)</code>方法如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><ul class=""><li id="c788" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">我们创建一个<code class="fe lv lw lx ly b">InteractionSubscription</code>，并为它提供一个订阅者、<code class="fe lv lw lx ly b">UIControl</code>和一个触发事件。</li><li id="4708" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">我们通知订阅者，它成功订阅了发布者，现在可以观察事件了。</li></ul><p id="74c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了，我们现在有一个工作的出版商了。最后，让我们添加一个使用<code class="fe lv lw lx ly b">InteractionPublisher</code>的便捷方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="503c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们简单地将一个<code class="fe lv lw lx ly b">UIControl</code>和一个特定事件附加到一个<code class="fe lv lw lx ly b">InteractionPublisher</code>上并返回它。</p><p id="8bff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们终于准备好使用我们创造的东西了。</p><h1 id="8707" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">用法示例</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><ul class=""><li id="e376" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">我们创建<code class="fe lv lw lx ly b">cancellabels</code>属性来存储我们未来的订阅。</li><li id="9d88" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">我们实现了一个简单的<code class="fe lv lw lx ly b">UIButton</code>来显示“Tap！”标题。</li><li id="80d5" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">在<code class="fe lv lw lx ly b">observeForButtonTaps()</code>方法中，我们观察<code class="fe lv lw lx ly b">.touchUpInside</code>事件。一旦用户点击按钮，我们将看到控制台上打印的“Tapped”。</li><li id="5331" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">最后我们调用<code class="fe lv lw lx ly b">viewDidLoad()</code>里面的方法。</li></ul></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="79b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经成功扩展了<code class="fe lv lw lx ly b">UIControl</code>，现在有了一个可重复使用的<code class="fe lv lw lx ly b">Publisher</code>，你可以复制并粘贴到你的应用程序中来观察<code class="fe lv lw lx ly b">UIButton</code>事件。</p><h1 id="f26d" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">资源</h1><p id="64e2" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">Xcode游乐场的源代码可以在<a class="ae ky" href="https://gist.github.com/zafarivaev/d5864857cd18bc21982a066396368c6a" rel="noopener ugc nofollow" target="_blank">要点</a>中找到。</p><h1 id="5a8a" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">包扎</h1><p id="f604" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">我建议你看一下这篇<a class="ae ky" href="https://medium.com/flawless-app-stories/swift-combine-custom-publisher-6d1cc3dc248f" rel="noopener">文章</a>，其中<a class="nu nv ep" href="https://medium.com/u/70542c958f08?source=post_page-----63c1a4e0a0c1--------------------------------" rel="noopener" target="_blank"> Dmitry Lupich </a>创建了一个类似的<code class="fe lv lw lx ly b">Publisher</code>来从远程服务器获取<code class="fe lv lw lx ly b">Data</code>。</p><p id="7356" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章对你有用。感谢阅读！</p></div></div>    
</body>
</html>