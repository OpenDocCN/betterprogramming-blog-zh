<html>
<head>
<title>A Five-Minute Guide to Python APIs on AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Lambda上的Python APIs五分钟指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-5-minute-guide-to-python-apis-on-aws-lambda-d359630fe743?source=collection_archive---------7-----------------------#2020-01-09">https://betterprogramming.pub/a-5-minute-guide-to-python-apis-on-aws-lambda-d359630fe743?source=collection_archive---------7-----------------------#2020-01-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="eaf1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以更好的方式启动您的Python项目</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bab939aba907d0a70bf76526f4e87083.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ds4FCcFZd8Ip6QbWosZzVQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Canva.com制造</p></figure><p id="7c6c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">随着机器学习时代的到来，越来越多的人在使用Python。像<a class="ae lu" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter </a> Notebooks、<a class="ae lu" href="https://www.jetbrains.com/pycharm/" rel="noopener ugc nofollow" target="_blank"> PyCharm </a>和VS Code这样更智能的ide使得函数式编程变得简单有趣。</p><p id="cfd0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以专注于手头的业务案例，轻松连接数据，快速编写和测试功能，而无需担心代码结构。</p><p id="83a3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，也很容易忽略更大的画面。当你训练出一个完美的模型或者创造出一个能让你赚到数百万的解决方案时，你怎么能让别人消费你的代码呢？Web应用还是REST API？服务器上的主机还是无服务器？Azure还是AWS？</p><p id="5552" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你开始时没有考虑到结果，你可能会有很多返工。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4933" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak"> <em class="mu">烧瓶，无服务器，和AWSλ</em></strong></h1><p id="c90f" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">如果你使用Python已经有一段时间了，你可能听说过<a class="ae lu" href="https://www.palletsprojects.com/p/flask/" rel="noopener ugc nofollow" target="_blank"> Flask </a>和<a class="ae lu" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>。这些流行的Python web框架帮助您创建REST APIs或web应用程序。</p><p id="ea7e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于较大的项目，选择Flask或Django时需要考虑一些细微差别，但是让我们改天再讨论这个问题。我更喜欢Flask for REST APIs，因为它简单、轻量级且易于学习。</p><p id="f692" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本练习中，我们将在AWS上部署一个“Hello World”Flask应用程序。</p><p id="ca3f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">无服务器架构帮助您构建和运行应用程序，而无需考虑服务器。服务器供应、高峰时期的扩展和操作系统维护都由云提供商管理，您只需按请求付费。</p><p id="aaf9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">听起来像是微服务的完美家园，不是吗？AWS Lambda函数允许您在支持微服务架构的平台上运行无状态无服务器应用程序。</p><p id="1652" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Lamda函数可以由各种事件触发(比如S3上的文件上传)或者通过API网关触发。顺便提一下，如果您想将API放在一个容器中，也可以考虑查找AWS Fargate。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="86f5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak"> <em class="mu">要求</em> </strong></h1><p id="b232" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">您需要设置一个AWS帐户，并在Windows系统上安装Python 3.6(或更高版本)。VS代码使事情变得简单，但是你可以使用任何你喜欢的IDE。我们开始吧！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="720e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak"> <em class="mu"> 1。安装并配置AWS CLI </em> </strong></h1><p id="87d9" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">安装AWS命令行界面(CLI)，并使用您的AWS“访问密钥ID”、“秘密访问密钥”、区域名称和输出格式对其进行配置。</p><p id="6644" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些凭证将用于创建Lambda函数。以后，您还可以使用CLI命令从命令提示符管理所有AWS资源，而不必每次都登录AWS管理控制台。</p><p id="ea89" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它对于在S3存储桶之间传输文件尤其方便。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/d2ba3bc51c812cbe3a10dbc2abdd77b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*6JyPKmPxPIqP6-vIN6jamw.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/19a83c8b3e160c440ab546501bf3e701.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*9wmcHmUOGkBTKxs4hkMiDA.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2fc4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">2<em class="mu">。创建虚拟环境</em> </strong></h1><p id="4a5c" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">为您的应用程序创建一个文件夹，导航到该文件夹，并启动一个Python 3虚拟环境。一旦激活，您就可以在新环境<code class="fe nc nd ne nf b">env</code>中安装所有需要的库。</p><pre class="kj kk kl km gt ng nf nh ni aw nj bi"><span id="f414" class="nk md it nf b gy nl nm l nn no">mkdir flask_app<br/>cd flask_app<br/>py -3 -m venv env<br/>env\scripts\activate</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/0b9a074e7bd999f63c2f1f74bf87dfe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*eMtZ_piIVBclbq6AtJgCMA.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="26b5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.安装库，完成代码，并进行本地测试</h1><p id="ed3e" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">使用<a class="ae lu" href="https://pip.pypa.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> pip </a>安装烧瓶。在<code class="fe nc nd ne nf b">flask_app</code>文件夹中创建一个<code class="fe nc nd ne nf b">app.py</code>文件，并用下面的示例代码保存它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="297d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">确保在部署代码之前在本地测试它。部署Lambda函数后，可以使用CloudWatch日志来监控它。如果函数不起作用，它会显示错误细节。</p><p id="d679" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，在一个复杂的场景中，仅仅通过读取日志可能很难精确定位问题。</p><p id="7d35" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如下所示在本地主机上运行Flask，并测试所有应用程序路由。</p><pre class="kj kk kl km gt ng nf nh ni aw nj bi"><span id="567e" class="nk md it nf b gy nl nm l nn no">set FLASK_APP=app.py<br/>set FLASK_ENV=development<br/>flask run</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/cd6abca908945b98c44a68b841a09312.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*vFA-sEdiMCQWa02l_f10lw.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="adc3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak"> <em class="mu"> 4。最后，一些Zappa魔法！</em>T13】</strong></h1><p id="7c0e" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated"><a class="ae lu" href="https://github.com/Miserlou/Zappa" rel="noopener ugc nofollow" target="_blank"> Zappa </a>是一个开源库，让Lambda上的部署变得轻而易举。</p><p id="7f13" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通常，部署包括将虚拟环境打包成zip文件，将zip文件上传到S3存储桶，配置Lambda函数，并将其附加到API网关。</p><p id="3881" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Zappa在幕后完成所有这些工作。它与Flask、Django和其他WSGI框架配合得很好。</p><p id="250c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用pip安装Zappa，然后按照下面的代码操作。</p><pre class="kj kk kl km gt ng nf nh ni aw nj bi"><span id="50cc" class="nk md it nf b gy nl nm l nn no">zappa init</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/645ba341bddb61e1de89154303a43b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_5S9braYA1wTSZjTzXdJSw.png"/></div></div></figure><p id="6f08" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，Zappa将请求环境名称、要使用的S3桶和Flask应用程序的位置等信息。要对每个问题使用默认值，只需按Enter键。</p><p id="2cf2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦创建了<code class="fe nc nd ne nf b">zappa_settings.json</code>，您就可以开始部署了。</p><pre class="kj kk kl km gt ng nf nh ni aw nj bi"><span id="31f4" class="nk md it nf b gy nl nm l nn no">zappa deploy</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/0a139933ea87dc3f1f2ca4c495297de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eS_xyy22j7iK9mbBEOR1mQ.png"/></div></div></figure><p id="d5ca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">片刻之后，您的API就启动并运行了！您可以使用Zappa生成的链接来访问和测试API。</p><p id="df82" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您对应用程序进行了更改并希望重新部署，请使用下面的命令。</p><pre class="kj kk kl km gt ng nf nh ni aw nj bi"><span id="17b1" class="nk md it nf b gy nl nm l nn no">zappa update</span></pre><p id="4d2f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢您的阅读。我洗耳恭听任何问题，所以一定要让我知道。</p></div></div>    
</body>
</html>