<html>
<head>
<title>How to Import External Smart Contracts and Libraries in Solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Solidity中导入外部智能合同和库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-import-external-smart-contracts-and-libraries-in-solidity-5670a59ff53a?source=collection_archive---------3-----------------------#2020-04-30">https://betterprogramming.pub/how-to-import-external-smart-contracts-and-libraries-in-solidity-5670a59ff53a?source=collection_archive---------3-----------------------#2020-04-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f9fd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何将外部代码导入智能合约的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/83231b8e78d4bcad4e3bee25c22f9b9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VnD32cpy8T5SJNNGd09Mig.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/users/WorldSpectrum-7691421/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3424785" rel="noopener ugc nofollow" target="_blank"> WorldSpectrum </a>来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3424785" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="bd93" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">从哪里开始</h1><p id="ac09" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在智能合约开发的世界中入门可能会让人不知所措。通常有很多<em class="mu">假设的</em>知识在任何地方都没有得到很好的解释。例如，将外部合同和库导入智能合同。</p><p id="c3d3" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">您可能确切地知道契约是做什么的，并且您的契约使用它会更好，但是实际导入它的语义是一个障碍。</p><p id="a06e" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">在早期，我记得将库代码复制并粘贴到我的<code class="fe na nb nc nd b">.sol</code>文件中是一种变通方法。</p><p id="2525" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">本文解释了如何将任何外部协定或库导入到您的智能协定中。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="25d7" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">从混音开始</h1><p id="2cf3" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">你在智能合约开发中采取的第一步很可能使用<a class="ae ky" href="https://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank"> Remix online IDE </a>。这是一个非常棒的工具，可以快速方便地访问<a class="ae ky" href="https://solidity.readthedocs.io/en/v0.6.6/" rel="noopener ugc nofollow" target="_blank"> Solidity </a>编译器，这样你就可以尽快地学习这门语言。</p><p id="1149" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">一旦你对使用Solidity有了信心，你就会自然而然地想在本地环境中，在桌面IDE中进行开发。将代码放在项目目录中，在本地运行，允许快速开发，并允许使用版本控制和开源。</p><p id="a76b" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">这就是松露套房的用武之地。</p><blockquote class="ne"><p id="e927" class="nf ng it bd nh ni nj nk nl nm nn mt dk translated">"世界一流的开发环境，适用于区块链DApps(分散式应用程序)和智能合同."—<a class="ae ky" href="http://trufflesuite.com" rel="noopener ugc nofollow" target="_blank">Trufflesuite.com</a></p></blockquote><p id="57b3" class="pw-post-body-paragraph ly lz it ma b mb no ju md me np jx mg mh nq mj mk ml nr mn mo mp ns mr ms mt im bi translated">它把你所有的代码放在一个地方，不需要太多的配置，而且学习一些基本的工作是非常简单的。</p><p id="c438" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">下次你要创建一个包含智能合约的新项目时，从Truffle开始。让我们开始吧…</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="a7dd" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">入门指南</h1><h2 id="76c8" class="nt lh it bd li nu nv dn lm nw nx dp lq mh ny nz ls ml oa ob lu mp oc od lw oe bi translated">结节</h2><p id="b6c6" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Truffle运行在Node.js上，所以如果你还没有安装它，<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">访问他们的网站，按照安装说明进行操作</a>。</p><h2 id="6369" class="nt lh it bd li nu nv dn lm nw nx dp lq mh ny nz ls ml oa ob lu mp oc od lw oe bi translated">松露</h2><p id="2c3b" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">通过运行以下命令，使用节点程序包管理器(npm)安装Truffle:</p><pre class="kj kk kl km gt of nd og oh aw oi bi"><span id="4ca8" class="nt lh it nd b gy oj ok l ol om">npm install -g truffle</span></pre><h2 id="a652" class="nt lh it bd li nu nv dn lm nw nx dp lq mh ny nz ls ml oa ob lu mp oc od lw oe bi translated">文字编辑器</h2><p id="dfe8" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">确保您安装了最新的文本编辑器。我用的是<a class="ae ky" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS代码</a>。</p><p id="0225" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">一旦所有东西都安装好了，导航到您喜欢的工作区，创建一个新的目录，我们的Truffle项目将驻留在其中，然后初始化一个Truffle项目:</p><pre class="kj kk kl km gt of nd og oh aw oi bi"><span id="c689" class="nt lh it nd b gy oj ok l ol om">mkdir my-project<br/>cd my-project/<br/>truffle init</span></pre><p id="cdb6" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">在文本编辑器中打开新的项目目录。您的文件夹结构应该如图1所示。应该有三个子目录:<code class="fe na nb nc nd b">contract/</code>、<code class="fe na nb nc nd b">migrations/</code>、<code class="fe na nb nc nd b">test/</code>；还有一档:<code class="fe na nb nc nd b">truffle-config.js</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/c9f1475e0ae6ad022350d4b59856f012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*7QER0aVSKS8sDtn3M9zVjA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:文件夹结构</p></figure><ul class=""><li id="05b3" class="oo op it ma b mb mv me mw mh oq ml or mp os mt ot ou ov ow bi translated"><code class="fe na nb nc nd b">contract/</code>是我们存储Solidity智能合同代码的地方。Truffle知道在这里寻找<code class="fe na nb nc nd b">.sol</code>文件来编译并迁移到区块链。</li><li id="57bb" class="oo op it ma b mb ox me oy mh oz ml pa mp pb mt ot ou ov ow bi translated"><code class="fe na nb nc nd b">migrations/</code>是我们的迁移逻辑所在。在这里，我们可以描述部署我们的合同时所需的步骤，以便正确地部署它们。</li><li id="3458" class="oo op it ma b mb ox me oy mh oz ml pa mp pb mt ot ou ov ow bi translated"><code class="fe na nb nc nd b">test/</code>我们将在这里编写我们的智能合约，以确保它们按预期运行。</li><li id="810d" class="oo op it ma b mb ox me oy mh oz ml pa mp pb mt ot ou ov ow bi translated"><code class="fe na nb nc nd b">truffle-config.js</code>包含关于网络、编译器、文件位置和其他自定义配置的信息，让Truffle框架知道我们的东西在哪里。现在不要担心这个文件。</li></ul></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="9968" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">安装和导入</h1><p id="da62" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated"><a class="ae ky" href="https://openzeppelin.com/contracts/" rel="noopener ugc nofollow" target="_blank"> OpenZeppelin </a>是以太坊智能合约的<a class="ae ky" href="https://medium.com/better-programming/smart-contracts-dont-reinvent-the-wheel-63cee4370d19" rel="noopener">黄金标准可重用存储库。在这个项目中，我们将把契约repo作为一个依赖项来安装，然后导入Ownable契约，这样我们就可以限制对某些功能的访问。</a></p><p id="b854" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">您可能以前见过或使用过类似的模式。当契约初始化时，<code class="fe na nb nc nd b">msg.sender</code>地址存储在一个状态变量中，指示契约的所有者。使用自定义修饰符<code class="fe na nb nc nd b">_onlyOwner</code>，某些函数通过要求<code class="fe na nb nc nd b">msg.sender</code>等于所有者来限制访问。</p><p id="58f4" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">在存储库根目录中，运行:</p><pre class="kj kk kl km gt of nd og oh aw oi bi"><span id="65b1" class="nt lh it nd b gy oj ok l ol om">npm install @openzeppelin/contracts --save</span></pre><p id="a5e4" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">完成后，您应该会在根目录下看到一个名为<code class="fe na nb nc nd b">node_modules/</code>的新文件夹(如果您在了解这一切之前使用过Node或npm)。</p><p id="a7de" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">在<code class="fe na nb nc nd b">node_modules</code>内部，npm已经下载了OpenZeppelin/contracts repo，其中包含了OpenZeppelin必须提供的所有合同和库。花一点时间浏览一下正在出售的商品。</p><p id="9cac" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">我们将使用Ownable契约，从项目根来看，它位于<code class="fe na nb nc nd b">@openzeppelin-solidity/contracts/access/Ownable.sol</code>中。</p><p id="f441" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">在<code class="fe na nb nc nd b">contracts/</code>文件夹中，创建一个导入<code class="fe na nb nc nd b">Ownable</code>合同的新实体文件。我打算把我的名字叫做<code class="fe na nb nc nd b">TestContract.sol</code>。</p><p id="9b80" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">第一件事是声明Solidity编译器版本，我们使用的是<code class="fe na nb nc nd b">0.6.0</code>；然后我们需要使用找到的路径导入<code class="fe na nb nc nd b">Ownable</code>契约；最后，我们需要声明契约，它从<code class="fe na nb nc nd b">Ownable</code>开始延伸。</p><p id="ab12" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">图2 <strong class="ma iu"> </strong>显示了我们完成所有这些后的框架契约。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2: TestContract.sol</p></figure><p id="fbc7" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">信不信由你，差不多就是这样！</p><p id="559d" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">在这个契约中编写新的函数时，我们可以在<code class="fe na nb nc nd b">public</code>、<code class="fe na nb nc nd b">private</code>、<code class="fe na nb nc nd b">internal</code>或<code class="fe na nb nc nd b">external</code>修饰符后添加<code class="fe na nb nc nd b">onlyOwner</code>修饰符，声明该函数只能由所有者运行。</p><p id="7170" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">这里有一个简单的例子:</p><pre class="kj kk kl km gt of nd og oh aw oi bi"><span id="a2d2" class="nt lh it nd b gy oj ok l ol om">// This function has no restrictions on who can call it<br/>function noRestrictions() public { ... }</span><span id="1808" class="nt lh it nd b gy pe ok l ol om">// This function is restricted only to the owner. Anyone else<br/>// who tries to call it will result in a reverted transaction<br/>function restrictedFunction() public onlyOwner { ... }</span></pre><p id="657b" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">要确保在添加了新的受限函数后契约能够编译，请运行:</p><pre class="kj kk kl km gt of nd og oh aw oi bi"><span id="961f" class="nt lh it nd b gy oj ok l ol om">truffle compile</span></pre><p id="a504" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">如果一切顺利的话，你可以开始着手<a class="ae ky" href="https://medium.com/swlh/develop-test-and-deploy-your-first-ethereum-smart-contract-with-truffle-14e8956d69fc" rel="noopener">将你的合同迁移到本地区块链</a>，<a class="ae ky" href="https://medium.com/better-programming/how-to-test-ethereum-smart-contracts-35abc8fa199d" rel="noopener">编写测试</a>，以及<a class="ae ky" href="https://medium.com/swlh/develop-test-and-deploy-your-first-ethereum-smart-contract-with-truffle-14e8956d69fc" rel="noopener">部署到公共测试网</a>！</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="5519" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">进一步阅读</h1><p id="3ca2" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如果你对区块链开发感兴趣，我会写一些教程、演练、提示以及如何开始和建立投资组合的技巧。查看以下资源:</p><div class="pf pg gp gr ph pi"><a href="https://medium.com/blockcentric/blockchain-development-resources-b44b752f3248" rel="noopener follow" target="_blank"><div class="pj ab fo"><div class="pk ab pl cl cj pm"><h2 class="bd iu gy z fp pn fr fs po fu fw is bi translated">区块链开发资源马上跟进</h2><div class="pp l"><h3 class="bd b gy z fp pn fr fs po fu fw dk translated">学习区块链、以太坊和DApp开发的资源列表</h3></div><div class="pq l"><p class="bd b dl z fp pn fr fs po fu fw dk translated">medium.com</p></div></div><div class="pr l"><div class="ps l pt pu pv pr pw ks pi"/></div></div></a></div></div></div>    
</body>
</html>