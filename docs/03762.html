<html>
<head>
<title>Responsive Charts in Angular With D3.js and CSS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有D3.js和CSS的Angular响应图表</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/angular-d3js-a-better-pattern-for-adjusting-charts-via-css-646992231901?source=collection_archive---------13-----------------------#2020-03-03">https://betterprogramming.pub/angular-d3js-a-better-pattern-for-adjusting-charts-via-css-646992231901?source=collection_archive---------13-----------------------#2020-03-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3c8c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">调整图表的更好模式</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/56e0e1b9dad36993b24b14ff1c812307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bFUigqlhmzWapyG0X0aWpA.png"/></div></div></figure><p id="1018" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">大家好。在这篇文章中，我将解释我以前每次在Angular和<a class="ae ln" href="https://d3js.org" rel="noopener ugc nofollow" target="_blank"> D3 </a>中使用视觉组件时都会发现的几个问题。</p><p id="f624" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了启发您，我将使用一个基于此示例的折线图:</p><div class="lo lp gp gr lq lr"><a href="https://bl.ocks.org/gordlea/27370d1eea8464b04538e6d8ced39e89" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd ir gy z fp lw fr fs lx fu fw ip bi translated">D3 v5折线图</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">戈尔德李街区27370 D1 ea 8464 b 04538 E6 D8 ced 39 e 89</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">bl.ocks.org</p></div></div></div></a></div><p id="8f8c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这没什么太复杂的——它只是用随机数据创建一些基本的东西，比如线形图<strong class="kt ir"> </strong>。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="710d" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">问题是</h1><p id="815d" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">在D3中用Angular初始化一个图表有很多方法，所以这可能是个问题。当然，如果你在Angular中做了三个以上的D3视觉组件，你每次做的方式都不一样。</p><p id="cd0b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我来解释一下调整图表的好方法。</p><p id="a368" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是第一步，我将给出用Angular和D3创建一个新项目的说明。</p><h2 id="d637" class="ne mi iq bd mj nf ng dn mn nh ni dp mr la nj nk mt le nl nm mv li nn no mx np bi translated">创建角度项目</h2><p id="aced" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">使用Angular CLI快速设置一个:</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="e6da" class="ne mi iq nr b gy nv nw l nx ny">$ npm install -g @angular/cli</span></pre><p id="9f22" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后开始一个新项目:</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="7427" class="ne mi iq nr b gy nv nw l nx ny">$ ng new ng-d3-css-example<br/>$ cd ng-d3-css-example</span></pre><h2 id="b199" class="ne mi iq bd mj nf ng dn mn nh ni dp mr la nj nk mt le nl nm mv li nn no mx np bi translated">集成D3</h2><p id="9749" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">它的打字稿:</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="96ed" class="ne mi iq nr b gy nv nw l nx ny">$ npm install d3 --save<br/>$ npm install <a class="ae ln" href="http://twitter.com/types/d3" rel="noopener ugc nofollow" target="_blank">@types/d3</a> --save-dev</span></pre><h2 id="07ae" class="ne mi iq bd mj nf ng dn mn nh ni dp mr la nj nk mt le nl nm mv li nn no mx np bi translated">生成组件</h2><p id="2ac9" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">让我们创建一个组件。</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="91e2" class="ne mi iq nr b gy nv nw l nx ny">$ ng generate component line-chart</span></pre><h2 id="b2f6" class="ne mi iq bd mj nf ng dn mn nh ni dp mr la nj nk mt le nl nm mv li nn no mx np bi translated">模板</h2><p id="a877" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">这里的要点是，对于D3的每个可视组件，我都使用这段代码。我喜欢它，因为它只有一个带<code class="fe nz oa ob nr b">svg</code>、一个<code class="fe nz oa ob nr b">class</code>的标签，以及一个稍后检索它的标识符。就是这样！</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="7cdc" class="ne mi iq nr b gy nv nw l nx ny">&lt;<strong class="nr ir">svg</strong> <strong class="nr ir">#chart</strong> class="<strong class="nr ir">chart</strong>"&gt;&lt;/svg&gt;</span></pre><h2 id="082e" class="ne mi iq bd mj nf ng dn mn nh ni dp mr la nj nk mt le nl nm mv li nn no mx np bi translated">风格</h2><p id="ee33" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">这里的焦点是<code class="fe nz oa ob nr b">.chart</code>类——它允许我们通过CSS调整图表。它将我们调整图表大小的方式与其他部分完全分开，并且只通过样式来完成。</p><p id="ed8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob nr b">line-chart.component.scss</code></p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="6743" class="ne mi iq nr b gy nv nw l nx ny">...<br/><br/><strong class="nr ir">.chart</strong> {<br/>    width: 240px;<br/>    height: 230px;<br/><br/>    ...<br/></span></pre><h2 id="0c2a" class="ne mi iq bd mj nf ng dn mn nh ni dp mr la nj nk mt le nl nm mv li nn no mx np bi translated">控制器</h2><p id="7259" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">快速看一下控制器——所有的魔法都在里面。然后，我将只对几件事进行评论。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div><p class="oe of gj gh gi og oh bd b be z dk translated">我们的控制者，奇迹发生的地方。请看下面的解释。</p></figure><p id="7d48" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">显然，导入D3:</p><p id="accc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob nr b">line-chart.component.ts</code></p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="6519" class="ne mi iq nr b gy nv nw l nx ny">import * as d3 from "d3";</span></pre><p id="4ec2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">另一项任务是通过<code class="fe nz oa ob nr b">@ViewChild</code>检索组件本身，以添加我们所有可视组件中始终存在的属性。</p><p id="591f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob nr b">line-chart.component.ts</code></p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="1bef" class="ne mi iq nr b gy nv nw l nx ny">@ViewChild("chart", { static: true }) protected chartContainer: ElementRef;</span><span id="12d1" class="ne mi iq nr b gy oi nw l nx ny">  svg: any;<br/>  g: any;</span><span id="5336" class="ne mi iq nr b gy oi nw l nx ny">  tooltip: any;</span><span id="d10e" class="ne mi iq nr b gy oi nw l nx ny">  margin: {top:number; right:number; bottom: number; left: number;};</span><span id="d2ac" class="ne mi iq nr b gy oi nw l nx ny">  contentWidth: number;<br/>  contentHeight: number;</span><span id="14a5" class="ne mi iq nr b gy oi nw l nx ny">  width: number;<br/>  height: number;</span></pre><p id="f91a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所有这些属性都必须初始化。事实上，我们可以在一个<code class="fe nz oa ob nr b">ngOnInit</code> <strong class="kt ir"> </strong>的循环中做到有角，因为我们已经拥有了一切。</p><p id="d9f0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob nr b">line-chart.component.ts</code></p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="f74f" class="ne mi iq nr b gy nv nw l nx ny">initChart() {<br/>    const element = this.chartContainer.nativeElement;<br/><br/>    this.svg = d3.select(element);<br/><br/>    this.margin = {<br/>      top: +this.svg.style("margin-top").replace("px", ""),<br/>      right: +this.svg.style("margin-right").replace("px", ""),<br/>      bottom: +this.svg.style("margin-bottom").replace("px", ""),<br/>      left: +this.svg.style("margin-left").replace("px", "")<br/>    };<br/><br/>    <strong class="nr ir">this.width = +this.svg.style("width").replace("px", "");<br/>    this.height = +this.svg.style("height").replace("px", "");</strong><br/><br/>    this.contentWidth = this.width - this.margin.left - this.margin.right;<br/>    this.contentHeight = this.height - this.margin.top - this.margin.bottom;<br/><br/>    this.g = this.svg.append("g").attr("transform", "translate(" + this.margin.left + "," + this.margin.top + ")");<br/>  }</span></pre><ul class=""><li id="6b72" class="oj ok iq kt b ku kv kx ky la ol le om li on lm oo op oq or bi translated">放一些页边距等等。在D3中，对内容进行一点限定几乎总是强制性的</li><li id="bcf0" class="oj ok iq kt b ku os kx ot la ou le ov li ow lm oo op oq or bi translated">我们将<code class="fe nz oa ob nr b">width</code>和<code class="fe nz oa ob nr b">height</code>转换成一个数值，<strong class="kt ir"> </strong>，这是这里的关键概念</li><li id="b440" class="oj ok iq kt b ku os kx ot la ou le ov li ow lm oo op oq or bi translated">事实上，即使你在风格中加入了<code class="fe nz oa ob nr b">%</code>、<code class="fe nz oa ob nr b">vw</code>、<code class="fe nz oa ob nr b">vh</code>或其他度量，它仍然会被正确设置</li></ul><h2 id="15ac" class="ne mi iq bd mj nf ng dn mn nh ni dp mr la nj nk mt le nl nm mv li nn no mx np bi translated"><strong class="ak">结果</strong></h2><p id="74ea" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">在设置了像<code class="fe nz oa ob nr b">width</code>和<code class="fe nz oa ob nr b">height</code>这样的CSS属性之后，你就可以检查它们了。</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="472d" class="ne mi iq nr b gy nv nw l nx ny">$ npm start</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/49dfef1b3644d0b94fe750f6ff5981bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d7kQsPLoBm8IyaZ-rDOCug.png"/></div></div><p class="oe of gj gh gi og oh bd b be z dk translated">记住，在我们把‘宽度:240px高度:230像素；'</p></figure></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><p id="a6c7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，看它是通过CSS修改的，当我为这个修改时:</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="9bc0" class="ne mi iq nr b gy nv nw l nx ny">.chart {<br/>      //width: 240px;<br/>      //height: 230px;</span><span id="6bf0" class="ne mi iq nr b gy oi nw l nx ny">      width: 100%;    <br/>      height: 100%;</span><span id="0389" class="ne mi iq nr b gy oi nw l nx ny">...</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/1722c8aa3afe88dece2cb94b64dacf84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*trjaA2l--ml_UmnqaL82_A.png"/></div></div><p class="oe of gj gh gi og oh bd b be z dk translated">是和<em class="oz"> '%' </em>一起工作吗？是的，正如我之前说过的，它们被神奇地从CSS中捕获并转换成数字。</p></figure><p id="4c99" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">D3将宽度设置为一个数字。然而，在它作为100%的最大大小从CSS中检索出来之前(<code class="fe nz oa ob nr b">.chart</code>类中的<code class="fe nz oa ob nr b">width</code>属性)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/ee9b071f17dd4b64923b4c4fcc5739ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WG6MzYj-20gEWj52vTdAFA.png"/></div></div><p class="oe of gj gh gi og oh bd b be z dk translated">截图看看它是如何自动转换成数字的</p></figure><p id="ab65" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，您也不需要在其他部分调整图表——无论是模板还是控制器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pb od l"/></div><p class="oe of gj gh gi og oh bd b be z dk translated"><em class="oz">回购至此(</em><a class="ae ln" href="https://stackblitz.com/edit/ng-d3-css-example-v2?file=src%2Fapp%2Fapp.component.html" rel="noopener ugc nofollow" target="_blank"><em class="oz">stack blitz</em></a><em class="oz">或</em><a class="ae ln" href="https://github.com/ackuser/ng-d3-css-example-v2/tree/part1/adjustingViaCss" rel="noopener ugc nofollow" target="_blank"><em class="oz">GitHub</em></a><em class="oz">上支开拓)</em></p></figure></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="15f8" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">结论</h1><p id="89f3" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">每当我必须用Angular和D3构建图表时，它都会让我头疼。现在，我想根据我的经验和知识，我已经找到了一个好方法至少初始化它们。</p><p id="a6da" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望你喜欢，也希望你学会了调整图表的新方法。感谢阅读。</p></div></div>    
</body>
</html>