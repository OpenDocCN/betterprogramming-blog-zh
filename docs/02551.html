<html>
<head>
<title>How I Got Rid of State Observables in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何在Angular中消除状态可观测量的</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-i-got-rid-of-state-observables-in-angular-2c69cbbbbd0e?source=collection_archive---------7-----------------------#2019-12-08">https://betterprogramming.pub/how-i-got-rid-of-state-observables-in-angular-2c69cbbbbd0e?source=collection_archive---------7-----------------------#2019-12-08</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="4d7b" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">我不会回去的</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/6a6376d326227426e30cdc114f0b2a76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYdkNZJ6KAf8kklvb3qlNw.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Kha Ruxury在pexels.com拍摄的照片</p></figure><p id="cc23" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在Angular中开发复杂的SPA时，使用状态管理库会使事情变得容易得多。</p><p id="e296" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">app store作为一个单一的事实来源，包含了对应用程序的正确运行至关重要的所有数据。多亏了这个商店，我可以从任何智能组件(或容器)中访问或编辑这些数据。</p><p id="13e0" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">然而，处理商店的所有订阅可能会令人沮丧；很多时候，我不得不在一个组件中处理多个<code class="fe lv lw lx ly b">@Select()</code> <em class="lz"> </em>，每个组件都返回其在app store中对应属性的一个可观察值。</p><p id="de57" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">对于这些可观察到的每一个，我需要创建一个订阅，该订阅将在组件生命周期结束时销毁…这需要很多代码！</p><p id="dbe4" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">但是，如果我们可以摆脱所有的可观测量呢？</p><p id="8f21" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在最简单的情况下，我们可以使用<code class="fe lv lw lx ly b">async</code>管道避免显式订阅，它将订阅可观察对象并读取为我们发出的最后一个值。</p><p id="f6f2" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">假设我们有这样一个<code class="fe lv lw lx ly b">@Select()</code> <em class="lz"> </em>装饰器<em class="lz"> : </em></p><pre class="kk kl km kn gu ma ly mb mc aw md bi"><span id="3e53" class="me mf iu ly b gz mg mh l mi mj">@Select(ListState.SelectAllItems) listItems: Observable&lt;string[]&gt;;</span></pre><p id="0ec6" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我们可以通过HTML中的<code class="fe lv lw lx ly b">async</code>管道立即使用它:</p><pre class="kk kl km kn gu ma ly mb mc aw md bi"><span id="469c" class="me mf iu ly b gz mg mh l mi mj">&lt;ul&gt;<br/> &lt;li *ngFor="let item of listItems | async"&gt;<br/>   {{item}}<br/> &lt;/li&gt;<br/>&lt;/ul&gt;</span></pre><p id="4ad6" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">另一方面，许多情况要求我们订阅组件中的可观察值，以便我们可以在其他方法中使用它们发出的值。</p><p id="4b87" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">(要了解如何设置店铺，在一个项目中看到以上例子，可以阅读我的文章<a class="ae mk" href="https://medium.com/better-programming/how-to-create-a-simple-store-in-angular-577a8f21a3d6?source=friends_link&amp;sk=1a40ae0d4e6f413cd84b1af52315a3b9" rel="noopener"> <em class="lz">如何在Angular </em> </a>中创建一个简单的店铺。)</p></div><div class="ab cl ml mm hy mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="in io ip iq ir"><h1 id="8183" class="ms mf iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">介绍@ngxs-labs/select-snapshot</h1><p id="c984" class="pw-post-body-paragraph kz la iu lb b lc nj jv le lf nk jy lh li nl lk ll lm nm lo lp lq nn ls lt lu in bi translated"><a class="ae mk" href="https://github.com/ngxs-labs/select-snapshot" rel="noopener ugc nofollow" target="_blank">@ ngxs-Labs/select-snapshot</a>是NGXS实验室为<a class="ae mk" href="https://www.ngxs.io/" rel="noopener ugc nofollow" target="_blank"> NGXS </a>开发的一个实验性特性。</p><p id="4e12" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">尽管它仍然不是官方NGXS软件包的一部分，但它很可能会很快成为官方特性。这个包允许我们用<code class="fe lv lw lx ly b">@SelectSnapshot()</code>替换<code class="fe lv lw lx ly b">@Select()</code>装饰器。</p><p id="af3d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">但是它们之间有什么区别呢？</p><p id="0df8" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">前者返回一个我们需要订阅的可观察对象，而后者为我们订阅存储并返回最后发出的值！要查看它的运行情况，让我们安装这个包:</p><pre class="kk kl km kn gu ma ly mb mc aw md bi"><span id="4a2d" class="me mf iu ly b gz mg mh l mi mj">npm install @ngxs-labs/select-snapshot</span></pre><p id="a937" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">然后，让我们将它包含在我们的<code class="fe lv lw lx ly b">appModule</code>中:</p><pre class="kk kl km kn gu ma ly mb mc aw md bi"><span id="5495" class="me mf iu ly b gz mg mh l mi mj">@NgModule({<br/>declarations: [<br/>AppComponent,<br/>ListContainerComponent,<br/>ListItemInputComponent,<br/>ListComponent<br/>],<br/>imports: [<br/>BrowserModule,<br/>AppRoutingModule,<br/>FormsModule,<br/>ReactiveFormsModule,<br/>NgxsModule.forRoot([ListState]),<br/>NgxsReduxDevtoolsPluginModule.forRoot(),<br/>NgxsSelectSnapshotModule.forRoot()<br/>],<br/>providers: [],<br/>bootstrap: [AppComponent]<br/>})<br/>export class AppModule {}</span></pre><p id="cdfe" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">现在我们可以替换<code class="fe lv lw lx ly b">@Select()</code>装饰器了:</p><pre class="kk kl km kn gu ma ly mb mc aw md bi"><span id="e569" class="me mf iu ly b gz mg mh l mi mj">//@Select(ListState.SelectAllItems) listItems: Observable&lt;string[]&gt;;</span><span id="4880" class="me mf iu ly b gz no mh l mi mj">@SelectSnapshot(ListState.SelectAllItems) listItems: string[];</span></pre><p id="39bd" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">并且使用商店发出的值而不订阅！</p><pre class="kk kl km kn gu ma ly mb mc aw md bi"><span id="7b88" class="me mf iu ly b gz mg mh l mi mj">&lt;ul&gt;<br/> &lt;li *ngFor="let item of listItems"&gt;<br/>   {{item}}<br/> &lt;/li&gt;<br/>&lt;/ul&gt;</span></pre><p id="cbd6" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">尽情享受吧！</p></div><div class="ab cl ml mm hy mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu np"><a href="https://medium.com/better-programming/how-to-create-a-simple-store-in-angular-577a8f21a3d6" rel="noopener follow" target="_blank"><div class="nq ab fp"><div class="nr ab ns cl cj nt"><h2 class="bd iv gz z fq nu fs ft nv fv fx it bi translated">如何在Angular中创建一个简单的商店</h2><div class="nw l"><h3 class="bd b gz z fq nu fs ft nv fv fx dk translated">用单一的事实来源增强你的应用</h3></div><div class="nx l"><p class="bd b dl z fq nu fs ft nv fv fx dk translated">medium.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od kt np"/></div></div></a></div><div class="oe of gq gs og np"><a href="https://medium.com/better-programming/a-new-way-of-dispatching-actions-with-ngxs-for-angular-7541f0adb812" rel="noopener follow" target="_blank"><div class="nq ab fp"><div class="nr ab ns cl cj nt"><h2 class="bd iv gz z fq nu fs ft nv fv fx it bi translated">一种利用Ngxs为Angular调度动作的新方法</h2><div class="nw l"><h3 class="bd b gz z fq nu fs ft nv fv fx dk translated">用这个新的库整理你的代码</h3></div><div class="nx l"><p class="bd b dl z fq nu fs ft nv fv fx dk translated">medium.com</p></div></div><div class="ny l"><div class="oh l oa ob oc ny od kt np"/></div></div></a></div></div></div>    
</body>
</html>