<html>
<head>
<title>You Might Need Those Semicolons in Your JavaScript After All</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">毕竟，您可能需要在JavaScript中使用这些分号</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/you-might-need-those-semicolons-in-your-javascript-after-all-b28154f93ea8?source=collection_archive---------12-----------------------#2019-12-09">https://betterprogramming.pub/you-might-need-those-semicolons-in-your-javascript-after-all-b28154f93ea8?source=collection_archive---------12-----------------------#2019-12-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2eb1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">把它们留在外面看起来很漂亮，但是可能会弄坏东西</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7e7860f37ddfeacfee88d9ea056e5d39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0MRVIMoI9zZ3hElz"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">妮可·沃尔夫在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="2dcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我第一次开始写JavaScript时，我认为分号是强制性的。当时我正在学习jQuery，我正在阅读的所有文档都在每条语句的末尾显示了一个分号。</p><p id="0feb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我有一些其他编程语言的背景，这与我已经知道的一致——分号是用来帮助计算机区分指令的。有道理。</p><p id="1b83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没过多久我就知道了JavaScript的<strong class="lb iu">自动分号插入(ASI) </strong>。基本上，如果您省略分号，JavaScript会自动为您添加分号。所以，它们毕竟不是强制性的。</p><p id="df31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这背后的历史很有意思。JavaScript最初并不像今天这样是编程语言的重量级。一开始，它的目的是让非专业人士能够轻松掌握。ASI是为了让外行人对这门语言更友好而加入的一个特性。至少，这是我的想法。</p><p id="d363" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了避免破坏互联网，JavaScript需要向后兼容。我们可以添加新功能(ES6、ES7、ES8等)，但我们不能取消功能，因为它们已经被使用和依赖。不管是有意还是无意，数百万行JavaScript需要ASI才能正常工作。所以，我们都被它困住了，但是我们中的一些人选择用不同的方式处理它。</p><p id="e2c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个阵营编写包含分号的代码。他们的代码看起来更像是需要分号的语言，比如C或PHP。</p><p id="0eba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个阵营没有使用分号，而是依赖ASI自动添加分号。他们的代码看起来更像Python或Ruby。</p><p id="9cf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">JavaScript社区在这个问题上仍然存在分歧。例如，<a class="ae ky" href="https://reactjs.org/docs/components-and-props.html" rel="noopener ugc nofollow" target="_blank"> React </a>在其文档中仍然包含分号，但是<a class="ae ky" href="https://vuejs.org/v2/guide/computed.html" rel="noopener ugc nofollow" target="_blank"> Vue </a>没有。</p><p id="2b9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在jQuery和React之后，Vue是我在JavaScript框架中的下一站，我决定采用文档中的无分号编码风格。我很喜欢它(它让你的代码看起来干净多了！)并开始将这种风格应用于Vue之外的其他JavaScript工作，例如Node.js。</p><p id="8e8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，我开始遇到问题…</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="749b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">依赖分号的自动插入是如何破坏事物的:一个具体的例子</h1><p id="f421" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我想为我正在从事的项目自动化端到端测试。我的想法是编写一个基本的机器人，它会进入我的网页，并把不同类型的输入放到一个表单中。如果机器人得到的输出是我所期望的，很好。如果没有，我可能有一个错误。</p><p id="0233" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/puppeteer/puppeteer" rel="noopener ugc nofollow" target="_blank">木偶师</a> (Headless Chrome Node.js API)似乎是一个很好的方法，所以我试了一下。这些文档提供了以下代码片段来帮助您入门:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c020" class="ne md it na b gy nf ng l nh ni">const puppeteer = require('puppeteer');</span><span id="33f3" class="ne md it na b gy nj ng l nh ni">(async () =&gt; {<br/>  const browser = await puppeteer.launch();<br/>  const page = await browser.newPage();<br/>  await page.goto('https://example.com');<br/>  await page.screenshot({path: 'example.png'});</span><span id="dd29" class="ne md it na b gy nj ng l nh ni">  await browser.close();<br/>})();</span></pre><p id="119c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本质上，这段代码的思想是导入Puppeteer，然后实现一个<code class="fe nk nl nm na b">async</code><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Glossary/IIFE" rel="noopener ugc nofollow" target="_blank">life</a>(立即调用的函数表达式)。这允许您使用<code class="fe nk nl nm na b">await</code>关键字在开始下一步(例如加载网页)之前等待异步操作(例如启动浏览器)完成。</p><p id="3db2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">经过测试，一切正常。木偶师去网页，按预期截图。太棒了。</p><p id="fc8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是我为这个项目编写的其余代码都是以无分号风格完成的。因此，为了保持一致，我去掉了分号:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="cd19" class="ne md it na b gy nf ng l nh ni">const puppeteer = require('puppeteer')</span><span id="e934" class="ne md it na b gy nj ng l nh ni">(async () =&gt; {<br/>  const browser = await puppeteer.launch()<br/>  const page = await browser.newPage()<br/>  await page.goto('https://example.com')<br/>  await page.screenshot({path: 'example.png'})</span><span id="de90" class="ne md it na b gy nj ng l nh ni">await browser.close()<br/>})()</span></pre><p id="a71e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，这一更改导致我的代码抛出了一个错误，而当包含分号时它并没有抛出:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="2ef7" class="ne md it na b gy nf ng l nh ni">/Users/chris/Documents/code/sandbox/nodejs/puppeteer-test/index.js:3<br/>(async () =&gt; {<br/>^</span><span id="c7ac" class="ne md it na b gy nj ng l nh ni">TypeError: require(...) is not a function</span></pre><p id="f80d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这令人困惑。代码运行得很好——然后就不好了。但是在深入调查之后，它开始变得有意义了。</p><p id="002c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Node.js不知道它应该在<code class="fe nk nl nm na b">const puppeteer = require('puppeteer')</code>之后停止——因为它没有分号可循。相反，它看到下面出现了一个左括号，并将其解释为一个函数调用。它认为代码是这样的:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ef3e" class="ne md it na b gy nf ng l nh ni">const puppeteer = require('puppeteer')(async () =&gt; {<br/>  const browser = await puppeteer.launch()<br/>  const page = await browser.newPage()<br/>  await page.goto('https://example.com')<br/>  await page.screenshot({path: 'example.png'})</span><span id="d45d" class="ne md it na b gy nj ng l nh ni">await browser.close()<br/>})()</span></pre><p id="16a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果没有分号，这段代码是不明确的。</p><p id="4ab5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于无分号阵营来说，这是一个大问题。IIFEs是JavaScript中的一种常见模式，而不是一种模糊的边缘情况，我们的代码样式需要与它们一起工作。仅仅为了避免分号而避免省略号是非常愚蠢的。</p><p id="68b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种情况并不经常出现——但有时会出现<em class="nn">和</em>, JavaScript开发人员应该为此做好准备。</p><p id="c5e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只有在绝对必要的时候才可以插入分号(例如在上面的require语句之后)，但是这样做很尴尬，原因有两个:</p><ul class=""><li id="b3c8" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">您可能并不总是事先知道哪里需要分号。事实上，当事情发生时，你可能根本不知道你正在处理一个ASI问题。默认情况下包含分号可能会为您节省大量调试时间。</li><li id="690c" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">只是在一些地方有分号而在另一些地方没有看起来是错误的——我的强迫症无法处理这种不一致。</li></ul><p id="210f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个解决方案是根据您当前的环境遵守不同的规则。可以说是随波逐流。</p><p id="3559" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，在编写普通的JavaScript、jQuery和Node.js时，可以包含分号，而在编写React和Vue时，可以不使用分号。这种不一致仍然困扰着我，但是我更喜欢这个解决方案，而不是上面提到的那个。</p><p id="8c69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以简单地在任何地方，任何时候都使用分号。尽管我很喜欢没有分号的JavaScript的外观，但默认情况下包含分号还是很有意义的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f054" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">摘要</h1><p id="f1b3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">不管是好是坏，JavaScript最初被设计成包括<strong class="lb iu">自动分号插入(ASI) </strong>，我们被它困住了。</p><p id="9438" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自从这种语言被发明以来，已经过去了将近25年，但是社区仍然没有就分号的最佳实践达成共识。一些开发者喜欢包含它们，一些开发者喜欢不包含它们。</p><p id="913d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论您属于哪个阵营，重要的是要理解省略分号会不时地伤害您，并且您可能没有预料到这一点。例如，对于无分号用户来说，IIFEs可能是一个有问题的模式。</p><p id="7bfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，分号不完全是强制性的，但也不完全是可选的。</p></div></div>    
</body>
</html>