# 源代码过去的幽灵

> 原文：<https://betterprogramming.pub/the-ghost-of-source-code-past-f7b27166880a>

## 如何重构代码僵尸

![](img/44119fb45228a1358fbd86e841dfa694.png)

尼尔·凯利通过[像素](https://www.pexels.com/photo/night-of-the-train-photo-751091/)拍摄的照片

如果你在软件工程领域工作过一段时间，你可能会遇到至少一个这样的例子:没人想碰的可怕代码。

# 为什么我必须杀死这条龙？

为什么一些代码需要重构，有一个非常简单的原因。

维持现状太痛苦了。没有人知道代码是做什么的。如果您试图从头开始重写代码，您可能会错过几个大家都已经忘记的重要(但模糊的)边缘情况。

# 简而言之就是重构

整个重构过程如下所示:

1.  做一个简单的改变。
2.  确保你没有打碎任何东西。
3.  重复一遍。

让我们深入这些步骤。

# 1.做一个简单的改变

因为你在一个可怕的代码库中工作，你需要找到方法来限制你所冒的风险。

做些浅显易懂的小改动相对安全。避免做出大的、彻底的改变，这可能会带来一些不正确的假设。

一些简单变化的例子:

*   重命名变量。
*   将一个函数从一个类移到另一个类。
*   将几行代码放入它们自己的函数中。
*   移除依赖项(假设您已经移除了对该代码的所有调用)。
*   创建新的空包或二进制文件。

# 2.确保你没有打碎任何东西

根据您正在工作的代码库，这可能是一项重要的任务。

在你重构代码之前添加测试覆盖*。这样，您可以确保每个重构步骤之前和之后的行为是相同的。使用代码覆盖工具来确保您的测试运行所有的代码路径。*

如果你运气不好，你正在处理的代码要么很难要么不可能自动测试。很抱歉，您必须手动测试您的更改。

如果这足够痛苦，你可能会想出一些创造性的方法来摆脱这种困境。有什么变通方法吗？测试代码的非常规方法？

# 3.重复

理想情况下，在每个重构步骤之后，您将提交到您的本地分支。在实践中，您可能会将几个更改捆绑在一起。

如果一个单独的重构步骤触及了许多文件，我通常会尽可能快地将那个变更签入到主分支中。您更改的文件越多，如果您在签入之前等待，遇到合并冲突的可能性就越大。

包含 50 多个文件的代码评审可能会让团队成员感到厌烦。如果您所做的只是重命名一个函数，因此所有 50 多个文件都以完全相同的方式进行了更改，那么代码审查将变得非常简单和快速。

如果你在一个可怕的代码库中工作，你希望避免不必要的风险。大而复杂的代码更改不是一个好主意。确保你的队友很容易理解你所做的所有改变。

小心下一次部署:避免在部署到生产之间积累巨大的变化。同时投入生产的变更越多，风险就越大。

# 为什么重构是一种享受，而不是技巧

我如此喜欢重构的一个关键原因是它的不可预测性。

你会发现秘密的关系和隐藏的宝石。有些代码会让你发笑。其他代码会让你内心哭泣。你可以从别人的错误中吸取教训，编制一份“不要做什么”的心理清单。

在你的重构之旅中，有许多创造性的途径可供你选择。随着你获得更多的经验，你会有更好的预感，知道哪条路能最快地带你到达目标。

# 被困在迷宫里

我总是不知道我应该从哪里开始。所以，我就选了一个地方，尝试了一些东西。

如果我感到特别困难，我会简单地更新代码，使其符合我团队的编码标准(描述“干净的代码”在你的团队中是什么样子的规则)。随着我清理工作的进展，我开始意识到我想改变的其他事情。

有时候，我最终会意识到我走错了方向。但是即使发生了这种情况，我也已经了解了一些关于我所工作的代码库的重要事情。不是白费力气。

如果有人试图告诉你下一步总是显而易见的，他们要么没有经验，不知何故知道别人不知道的事情，要么他们在骗你。

# 你已经驯服了这个怪物

恭喜你！趁现在好好享受吧。