# 通过错误配置的 SUDO 成为 Root

> 原文：<https://betterprogramming.pub/becoming-root-through-misconfigured-sudo-7b68e731d1f5>

## 利用 SUDO 权限提升 Linux 权限

![](img/96cd5ac6f6d19635cc7d683d14380de2.png)

由[瑜伽士普尔纳马](https://unsplash.com/@yogipurnama?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片。

欢迎回到 Linux 安全系列！在本系列中，我们将讨论影响 Linux 系统的安全问题以及导致这些问题的常见错误配置。我们开始吧！

权限提升是攻击者提升系统权限的一种方式。例如，假设一个攻击者已经获得了对您的 web 服务器的访问权，但只是作为一个低特权用户。他们不能读写敏感文件、执行脚本或更改系统配置。他们如何危害您的服务器并保持对服务器的访问？

如果他们可以找到一种方法来欺骗系统，使其认为自己是根用户，攻击者就可以进行更强大的攻击，如读写敏感文件和在系统中插入永久性后门。这就是特权升级的由来。

今天，我们来谈谈攻击者如何利用错误配置的 SUDO 权限来提升他们的特权。

# 什么是 SUDO？

SUDO 代表“超级用户”这是一种特殊权限，允许用户以另一个用户(通常是根用户)的安全权限运行程序。

管理员授予用户 SUDO 访问权限，以便他们可以作为根用户运行某些命令。如果管理员已经将命令的 SUDO 权限授予某个用户，该用户可以通过在实际命令前键入`sudo`命令，然后输入他们的密码，以 root 权限运行该命令。例如，要以 root 用户身份运行`whoami`命令，拥有 SUDO 权限的用户可以运行以下命令:

```
$ whoamivickieli$ sudo whoamiroot
```

大多数情况下，管理员只会授予用户对少数命令的 SUDO 权限。但即使这样，这些 SUDO 权限也会带来权限升级问题。

# SUDO 权限升级

那么，攻击者如何利用他们的 SUDO 权限以根用户身份执行任意命令呢？

如果攻击者对允许在系统上执行命令或任意写入文件的程序拥有 SUDO 权限，攻击者就可以利用临时超级用户访问权限在系统上以超级用户身份执行代码。您可以通过以下命令找到当前用户可以使用 SUDO 运行的命令:

```
sudo -l
```

例如，假设普通用户可以使用 SUDO 运行命令`find`，这样他们就可以搜索系统中的所有文件。`find`命令通常用于定位文件，通常具有 SUDO 权限，允许用户在系统中查找文件。但是`find`允许通过`-exec`标志执行系统命令！例如，要从`find`命令中运行`ls`命令，您可以使用命令`find . -exec ls \;`。因此，如果用户可以以 SUDO 身份运行`find`命令，他们就可以以 root 身份执行系统命令！

这些错误配置使得权限提升变得微不足道。例如，攻击者可以使用以根用户身份执行命令的能力，并将自己作为根用户添加到`/etc/passwd`文件中。该命令将完成以下任务:

```
find . -exec echo “vickie::0:0:System Administrator:/root/root:/bin/bash” >> /etc/passwd \;
```

该命令使用用户名`vickie`和空密码添加一个根用户。由于`0`是 root 用户的 UID，添加一个 UID 为`0`的用户将赋予该用户 root 权限。普通用户无法使用该命令，因为只有特权用户才能修改系统关键文件，如`/etc/password`文件。

很多程序都赋予用户执行系统命令的能力，`find`只是其中之一。其他例子包括`vim`、`python`、`less`和`more`。

# 更多的 SUDO 危险

使用 SUDO 运行时导致权限提升的程序不仅限于允许执行任意系统代码的程序。任何允许对系统文件进行任意写入的程序在使用 SUDO 运行时都会导致权限提升。

例如，如果文件编辑器 Nano 可以与 SUDO 一起运行，攻击者可以使用 Nano 的 root 权限打开`/etc/passwd`文件，并直接在文件编辑器中将自己添加为 root 用户！

并且系统实用程序 cp 用于复制和重写文件。如果它可以与 SUDO 一起运行，攻击者可以篡改系统上的任何文件，用其根权限覆盖原始文件！例如，攻击者可以在他们拥有的文件中创建原始文件`/etc/password`的副本。然后，他们可以通过编辑`passwd`文件的副本将自己添加为 root 用户。最后，他们使用`cp`命令用修改后的文件覆盖原来的`/etc/password`文件。

# 小心点！

应该谨慎授予 SUDO 权利。当然，有些程序需要它，因为它们需要 root 权限才能正常运行。但是，如果您向允许用户执行系统命令或写入随机系统文件的程序授予 SUDO 权限，就会在您的系统中引入权限提升漏洞。

感谢阅读！下一次，我们将深入探讨攻击者可以用来危害您的系统的更多特权提升技术。