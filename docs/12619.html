<html>
<head>
<title>How to Use Live Text APIs in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在SwiftUI中使用实时文本API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-live-text-apis-in-swiftui-db5a073b67b2?source=collection_archive---------14-----------------------#2022-06-16">https://betterprogramming.pub/how-to-use-live-text-apis-in-swiftui-db5a073b67b2?source=collection_archive---------14-----------------------#2022-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c924" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用现成的人工智能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5faba24129adb7a3215a8b2bd8e254f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XYq7AALNO6niKZh6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@lemonvlad?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拍摄的照片</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="bfe0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">去年，iOS 15附带了一个非常有用的功能，称为<a class="ae ky" href="https://support.apple.com/en-hk/HT212630" rel="noopener ugc nofollow" target="_blank">实时文本</a>。您可能听说过术语OCR(光学字符识别的缩写)，它是将文本图像转换为机器可读文本格式的过程。这就是实时文本的意义所在。</p><p id="8284" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实时文本内置在相机应用程序和照片应用程序中。如果你还没有尝试过这个功能，只需打开相机应用程序。当你将设备的摄像头对准文本图像时，你会在右下角发现一个动态文本按钮。轻按按钮，iOS会自动为您捕捉文本。然后，您可以将其复制并粘贴到其他应用程序中(如Notes)。</p><p id="fe01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于大多数用户来说，这是一个非常强大和方便的功能。作为一名开发人员，如果能够将这种实时文本功能融入到自己的应用程序中，岂不是很棒？在<a class="ae ky" href="https://www.appcoda.com/swiftui-4/" rel="noopener ugc nofollow" target="_blank"> iOS 16 </a>中，苹果发布了Live Text API，供开发者使用Live Text为其应用提供动力。在本教程中，让我们看看如何将Live Text API与SwiftUI一起使用。</p><h1 id="3790" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用DataScannerViewController启用实时文本</h1><p id="b3fe" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在关于<a class="ae ky" href="https://developer.apple.com/videos/play/wwdc2022-10025" rel="noopener ugc nofollow" target="_blank"> <em class="ms">用VisionKit </em> </a>捕捉机器可读代码和文本的WWDC会议上，苹果的工程师展示了如下图表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/722625325e575f27b27ccca46e83d317.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SHup-Vq9fgPh2Nit.png"/></div></div></figure><p id="5401" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文本识别并不是iOS 16的新功能。在旧版本的iOS上，您可以使用AVFoundation和Vision框架中的API来检测和识别文本。但是实现起来相当复杂，尤其是对于iOS开发新手来说。</p><p id="5471" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在iOS的下一个版本中，上述所有内容都简化为VisionKit中一个名为<code class="fe mu mv mw mx b">DataScannerViewController</code>的新类。通过使用这个视图控制器，您的应用程序可以自动显示具有实时文本功能的摄像头UI。</p><p id="8bc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用该类，首先要导入<code class="fe mu mv mw mx b">VisionKit</code>框架，然后检查设备是否支持数据扫描器特性:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="fbf4" class="nc lw it mx b gy nd ne l nf ng">DataScannerViewController.isSupported</span></pre><p id="76ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Live Text API仅支持2018年或更新版本发布的带有Neural engine的设备。除此之外，您还需要检查可用性，看看用户是否同意使用data scanner:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="da3e" class="nc lw it mx b gy nd ne l nf ng">DataScannerViewController.isAvailable</span></pre><p id="2547" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦两次检查都得出肯定的结果，您就可以开始扫描了。以下是启动带有实时文本的摄像机的示例代码:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="4055" class="nc lw it mx b gy nd ne l nf ng">let dataScanner = DataScannerViewController(<br/>                     recognizedDataTypes: [.text()],<br/>                     qualityLevel: .balanced,<br/>                     isHighlightingEnabled: true<br/>                  )</span><span id="29f7" class="nc lw it mx b gy nh ne l nf ng">present(dataScanner, animated: true) {<br/>   try? dataScanner.startScanning()<br/>}</span></pre><p id="48de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您只需要创建一个<code class="fe mu mv mw mx b">DataScannerViewController</code>的实例，并指定可识别的数据类型。对于文本识别，您传递<code class="fe mu mv mw mx b">.text()</code>作为数据类型。一旦实例准备好了，您就可以通过调用<code class="fe mu mv mw mx b">startScanning()</code>方法来呈现它并开始扫描过程。</p><h1 id="ad7f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在SwiftUI中使用DataScannerViewController</h1><p id="90cd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><code class="fe mu mv mw mx b">DataScannerViewController</code>类现在只支持UIKit。对于SwiftUI，它需要做一些工作。我们必须采用<code class="fe mu mv mw mx b">UIViewControllerRepresentable</code>协议来在SwiftUI项目中使用该类。在本例中，我创建了一个名为<code class="fe mu mv mw mx b">DataScanner</code>的新结构，如下所示:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="d94e" class="nc lw it mx b gy nd ne l nf ng">struct DataScanner: UIViewControllerRepresentable {<br/> .<br/> .<br/> .<br/>}</span></pre><p id="ea17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该结构接受两个绑定变量:一个用于触发数据扫描，另一个是用于存储扫描文本的绑定。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="7124" class="nc lw it mx b gy nd ne l nf ng">@Binding var startScanning: Bool<br/>@Binding var scanText: String</span></pre><p id="18a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了成功采用<code class="fe mu mv mw mx b">UIViewControllerRepresentable</code>协议，我们需要实现以下方法:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="bbf1" class="nc lw it mx b gy nd ne l nf ng">func makeUIViewController(context: Context) -&gt;DataScannerViewController {<br/>   let controller = DataScannerViewController(<br/>                       recognizedDataTypes: [.text()],<br/>                       qualityLevel: .balanced,<br/>                       isHighlightingEnabled: true<br/>                   )<br/>   <br/>   return controller<br/>}<br/>​<br/>func updateUIViewController(_ uiViewController:DataScannerViewController, context: Context) {<br/>   <br/>   if startScanning {<br/>       try? uiViewController.startScanning()<br/>   } else {<br/>       uiViewController.stopScanning()<br/>   }<br/>}</span></pre><p id="482c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mu mv mw mx b">makeUIViewController</code>方法中，我们返回一个<code class="fe mu mv mw mx b">DataScannerViewController</code>的实例。对于<code class="fe mu mv mw mx b">updateUIViewController</code>，我们根据<code class="fe mu mv mw mx b">startScanning</code>的值开始(或停止)扫描。</p><p id="069d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了捕获扫描的文本，我们必须采用下面的<code class="fe mu mv mw mx b">DataScannerViewControllerDelegate</code>方法:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="88f2" class="nc lw it mx b gy nd ne l nf ng">func dataScanner(_ dataScanner: DataScannerViewController, didTapOnitem: RecognizedItem) {<br/> .<br/> .<br/> .<br/>}</span></pre><p id="14bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当用户点击检测到的文本时，该方法被调用，因此我们将这样实现它:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="7d39" class="nc lw it mx b gy nd ne l nf ng">class Coordinator: NSObject, DataScannerViewControllerDelegate {<br/>   var parent: DataScanner<br/>   <br/>   init(_ parent: DataScanner) {<br/>       self.parent = parent<br/>   }<br/>   <br/>   func dataScanner(_ dataScanner: DataScannerViewController,didTapOn item: RecognizedItem) {<br/>       switch item {<br/>       case .text(let text):<br/>           parent.scanText = text.transcript<br/>       default: break<br/>       }<br/>   }<br/>   <br/>}<br/>​<br/>func makeCoordinator() -&gt; Coordinator {<br/>   Coordinator(self)<br/>}</span></pre><p id="3b13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们检查已识别的项目，如果识别出任何文本，就存储扫描的文本。最后，在<code class="fe mu mv mw mx b">makeUIViewController</code>方法中插入这一行代码来配置委托:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="8ad9" class="nc lw it mx b gy nd ne l nf ng">controller.delegate = context.coordinator</span></pre><p id="e971" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该控制器现在可以在SwiftUI视图中使用了。</p><h1 id="4091" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用DataScanner捕获文本</h1><p id="f193" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">例如，我们将构建一个具有非常简单的用户界面的文本扫描仪应用程序。当应用程序启动时，它会自动显示实时文本的摄像头视图。当检测到文本时，用户可以点击文本来捕获它。扫描的文本显示在屏幕的下部。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/70285e86d557c5ef0b3b050eb77732af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*viwknbjdjLvT61kr.png"/></div></div></figure><p id="c7ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您已经创建了一个标准的SwiftUI项目，打开<code class="fe mu mv mw mx b">ContentView.swift</code>和<code class="fe mu mv mw mx b">VisionKit</code>框架。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="c82e" class="nc lw it mx b gy nd ne l nf ng">import VisionKit</span></pre><p id="22d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，声明几个状态变量来控制数据扫描器和扫描文本的操作。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="e48e" class="nc lw it mx b gy nd ne l nf ng">@State private var startScanning = false<br/>@State private var scanText = ""</span></pre><p id="495e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe mu mv mw mx b">body</code>部分，让我们像这样更新代码:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="dba7" class="nc lw it mx b gy nd ne l nf ng">VStack(spacing: 0) {<br/>   DataScanner(startScanning: $startScanning, scanText: $scanText)<br/>       .frame(height: 400)<br/>   <br/>   Text(scanText)<br/>       .frame(minWidth: 0, maxWidth: .infinity, maxHeight:.infinity)<br/>       .background(in: Rectangle())<br/>       .backgroundStyle(Color(uiColor: .systemGray6))<br/>       <br/>}<br/>.task {<br/>   if DataScannerViewController.isSupported &amp;&amp;DataScannerViewController.isAvailable {<br/>       startScanning.toggle()<br/>   }<br/>}</span></pre><p id="bc88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当应用程序启动时，我们启动数据扫描仪。但在此之前，我们调用<code class="fe mu mv mw mx b">DataScannerViewController.isSupported</code>和<code class="fe mu mv mw mx b">DataScannerViewController.isAvailable</code>来确保设备支持实时文本。</p><p id="342b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">演示应用程序几乎可以测试了。由于Live Text需要摄像机访问，请记得转到项目配置。在<code class="fe mu mv mw mx b">Info.plist</code>文件中添加密钥<em class="ms">Privacy-Camera Usage Description</em>，并指定您的应用程序需要访问设备摄像头的原因。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/15b50f0ff107e0ac141437448db5bd74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3LDY4RA1Ph4FfNnd.png"/></div></div></figure><p id="8357" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更改后，您可以将应用程序部署到真实的iOS设备上，并测试实时文本功能。</p><p id="7265" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了英语，Live Text还支持法语、意大利语、德语、西班牙语、中文、葡萄牙语、日语和韩语。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/1a26d40b88d9c7ab7e3b93faa7f8f47a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iItM8OyWP4IaxRjvn7smtw.png"/></div></div></figure><p id="d1b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个演示项目的源代码，你可以在GitHub 上查看。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="0042" class="nc lw it mx b gy nd ne l nf ng"><strong class="mx iu">Note</strong>: To dive deeper into SwiftUI, you can check out our <a class="ae ky" href="https://www.appcoda.com/swiftui" rel="noopener ugc nofollow" target="_blank">Mastering SwiftUI book</a>. We are updating the book for iOS 16. You will receive a free update later this year.</span><span id="dc39" class="nc lw it mx b gy nh ne l nf ng">This article was originally published on <a class="ae ky" href="https://www.appcoda.com/live-text-api/" rel="noopener ugc nofollow" target="_blank">appcoda.com</a>.</span></pre></div></div>    
</body>
</html>