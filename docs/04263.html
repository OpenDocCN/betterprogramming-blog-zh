<html>
<head>
<title>Build a Board Game Without the Politics (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个没有政治的棋盘游戏(第2部分)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-board-game-without-the-politics-e18240b5bcf2?source=collection_archive---------16-----------------------#2020-04-01">https://betterprogramming.pub/a-board-game-without-the-politics-e18240b5bcf2?source=collection_archive---------16-----------------------#2020-04-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ad7a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过拖放使用SwiftUI</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d61c33587b92874740462161ca757eab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RIvw4AOJGVslQIlN"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@wimvanteinde?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">维姆·范因德</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="966d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文基于iOS 11.4和2020年3月下旬发布的Swift 5的一个版本。警告:如果你还没有更新你的iDevice和/或Xcode，显然它不会工作。</p><p id="eb09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将通过几个例子来介绍新的拖放协议的构建。最终目标是创建一个迷你数独板，然后您可以填充它。当我开始的时候，我没有意识到SwiftUI本身实际上是数字挑战。你会在最后找到解决办法的。我们的目标只是创建一个类似数独的棋盘，你可以在上面拖动棋子。当然，它可以是你想尝试和构建的任何棋盘游戏的任何棋盘。</p><p id="fb4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不管怎样，欢迎回来。这是第2部分。理想情况下，你应该先读完第1部分才能理解。</p><p id="72c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上次我们入住的时候，我正走运呢。实际上，我以为我是。下一关应该花两分钟完成，但是花了更长的时间。我最终使用了带有命名变量的循环。我很快也遇到了其他几个错误消息。事实上，在SwiftUI中实现嵌入式循环本身就是一种艺术形式。</p><p id="e653" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一天后，重新上线。我敢肯定你开始想知道数独的链接在哪里。让我们把“Hello World”标签换成数字，让它们变大，让我们的矩阵变大。我将发布<code class="fe lv lw lx ly b">ContentView.swift</code>的整个代码库，以确保我们都在同一页上。</p><p id="b8f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最终设法建立了一个更大的网格，但我还远远没有脱离险境:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="e189" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和一个稍加修改的<code class="fe lv lw lx ly b">InsideView</code>结构:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="bd22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您只是对第1部分做了一些小的调整，您应该能够再次编译并运行，您会发现自己正在看这个。尝试将数字拖到棋盘上，为自己创建一个迷你数独游戏。这比你想象的要困难得多。试着造一个。记住，每一行在行和列中都必须有一个唯一的数字。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/16ccb4145d22e0a81814b1f76a41d186.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r4Ze2NB38CSkwvX1HY0nww.png"/></div></div></figure><p id="ab9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数字挑战。我想要颜色。但是每次我在上面代码的循环中添加任何东西时，我都会得到这个错误消息:‘编译器无法在合理的时间内对这个表达式进行类型检查；尝试将表达式分解成不同的子表达式。“我在栈溢出上查了一下。我尝试关闭除Xcode之外的所有应用程序。我花了一两纳秒的时间考虑买一台新的更快的笔记本电脑。我试图简化它。什么都没用。我在这件事上又损失了一天。事实证明，用SwiftUI添加颜色极其困难。</p><p id="b678" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我回到SO寻找一些线索，也许是一个解决方案。当然，我一贴问题，就看到了答案。这是我代码中的一个简单表达式。SwiftUI好像数学很差。我不能内联添加它，但是我发现我可以通过函数调用来添加它。是的，一个简单的函数调用。</p><p id="9fc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我修改了绘制网格的函数，保存了坐标。现在，它会根据拖动到它上面的数字，在这样做和放置正确的颜色之间交替。那么是什么改变了呢？我终于能够让主循环绘制一个稍微复杂一点的矩阵:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="eb89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，对“去死吧”错误消息的解决方案是:</p><pre class="kj kk kl km gt mc ly md me aw mf bi"><span id="f883" class="mg mh it ly b gy mi mj l mk ml">func fCalc(c:Int, r:Int) -&gt; Int {<br/>  return (c + (r*4))<br/>}</span></pre><p id="eb6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以及对<code class="fe lv lw lx ly b">dropDelegate</code>代码的更改，根据拖动到位的数字设置正确的值:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="3f93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，您需要更改对<code class="fe lv lw lx ly b">dropDelegate</code>的调用，并将主循环中的新变量声明为:</p><pre class="kj kk kl km gt mc ly md me aw mf bi"><span id="ed29" class="mg mh it ly b gy mi mj l mk ml">@State private var textColors = [Color](repeating: Color.clear, count: 16)</span><span id="0ab5" class="mg mh it ly b gy mm mj l mk ml">let dropDelegate = TheDropDelegate(textID: $textID, textText: $textText, rect: $rect, textColors: $textColors)</span></pre><p id="fff0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你也应该能够添加颜色。这是一个可行的解决方案。当然，你应该能找到其他人:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/16abdf14f1d2656d5f03cf770890ba7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XN_aloFWDtPtdaUr1IfnlQ.png"/></div></div></figure><p id="fb5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来呢？让我们试着让矩阵变得更大。让我们把它变成一个不可能的，不可解的矩阵。这是一个挑战。</p><p id="efca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要做什么？嗯，应该很容易。我们需要检查瓷砖的间距和大小，剔除一些我们一开始就不应该添加的神奇数字，并更新一些静态的东西，比如颜色的名称。</p><p id="95d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">浏览代码，最不灵活的部分在我们的<code class="fe lv lw lx ly b">dropDelegate</code>中。这是一份我们需要修改的案件陈述。事实上，有一个更好的解决方案。这个，代替了我们的switch语句。注意<em class="mn"> -1 </em>是因为我的板从数字<em class="mn"> 1 </em>开始，我的数组从<em class="mn"> 0 </em>开始:</p><pre class="kj kk kl km gt mc ly md me aw mf bi"><span id="8d7a" class="mg mh it ly b gy mi mj l mk ml">self.textColors[self.textID!] = backgrounds[Int(text)! - 1]</span></pre><p id="a994" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用计数代替<code class="fe lv lw lx ly b">ForEach</code>语句中使用的幻数。所以第一个应该是这样的:</p><pre class="kj kk kl km gt mc ly md me aw mf bi"><span id="f4d6" class="mg mh it ly b gy mi mj l mk ml">ForEach((0 ..&lt; textValue.count), id: \.self) { column in</span></pre><p id="46ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个和第三个看起来基本相同。为了保持一致，我们应该将这个数字作为第三个参数提供给<code class="fe lv lw lx ly b">fCalc</code>函数:</p><pre class="kj kk kl km gt mc ly md me aw mf bi"><span id="4ecc" class="mg mh it ly b gy mi mj l mk ml">func fCalc(c:Int, r:Int, x:Int) -&gt; Int {<br/>  return (c + (r*x))<br/>}</span></pre><p id="a620" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">抱歉，这有点神秘，我写的时候心情不好。最后，我们需要更改文本框架中用于间距的幻数:</p><pre class="kj kk kl km gt mc ly md me aw mf bi"><span id="8e2e" class="mg mh it ly b gy mi mj l mk ml">let minWidith = CGFloat(32)<br/>let minHeight = CGFloat(40)<br/>let fontSize = CGFloat(40)</span></pre><p id="1931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们需要添加更多的颜色，更多的<code class="fe lv lw lx ly b">textValues</code>，增加我们的数组来考虑所有的事情。不幸的是，我们没有太多内置Swift颜色的选项，所以我们需要大胆尝试:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="1f13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这应该可以了。如果我们现在跑，我们将能得到一个真正的数独板。我连夜思考了这个系列，决定再写一篇文章。敬请期待！</p></div></div>    
</body>
</html>