<html>
<head>
<title>How to Embed Unity in a Native iOS Swift Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在原生iOS Swift项目中嵌入Unity</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-embed-unity-with-vuforia-in-a-native-ios-swift-project-e9c82dfe53c?source=collection_archive---------2-----------------------#2019-05-23">https://betterprogramming.pub/how-to-embed-unity-with-vuforia-in-a-native-ios-swift-project-e9c82dfe53c?source=collection_archive---------2-----------------------#2019-05-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8e10" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Vuforia将Unity嵌入Swift项目的视图控制器</h2></div><p id="fc5a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我正在使用Unity实现Vuforia的云识别，并希望将场景嵌入到我的Swift项目的视图控制器中。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/ab36719b0c3dbcc126117e3f2f18f565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W-u0FfQEhRv8RQGmRR1MmQ.jpeg"/></div></div></figure><p id="aebf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在网上找到的大部分教程要么用的是老版本的Unity和Objective-C，要么不用Vuforia。所以，我创建了这个教程。</p><p id="519d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">仅供参考，我用的是:Xcode版本:<code class="fe lq lr ls lt b">Version 10.2.1</code>，Unity版本:<code class="fe lq lr ls lt b">2018.3.8f1</code>，Vuforia版本:<code class="fe lq lr ls lt b">8.0.10</code></p><h1 id="2e9e" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">第1部分:导出Unity项目</h1><p id="6db2" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">导出是该过程的关键部分，请确保您正确遵循所有播放器设置。</p><ol class=""><li id="a406" class="mr ms it kk b kl km ko kp kr mt kv mu kz mv ld mw mx my mz bi translated">将这个<a class="ae na" href="https://github.com/jiulongw/swift-unity/blob/master/XcodePostBuild.cs" rel="noopener ugc nofollow" target="_blank">后期构建脚本</a>复制到<code class="fe lq lr ls lt b">YourUnityProjName/Assets/Editor</code>文件夹。</li></ol><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nb"><img src="../Images/c445759f4b8e9a39dc6bdb0937e7a414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*itgkFEYOYQIBLcA7Xu-lBw.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">将后期生成脚本添加到资源/编辑器文件夹</p></figure><p id="7488" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.根据我在脚本中所做的注释，找到并编辑下面两行:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="69dc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.文件-&gt;构建设置-&gt;切换到<code class="fe lq lr ls lt b">iOS</code>平台如果你还没有</p><p id="cd4b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4.文件-&gt;构建设置-&gt;播放器设置-&gt;其他设置</p><p id="61cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">a.取消勾选<code class="fe lq lr ls lt b">Auto Graphics API</code></p><p id="e12d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">b.如果使用的是<code class="fe lq lr ls lt b">Vuforia</code>，在<code class="fe lq lr ls lt b">Graphics API</code>中，删除<code class="fe lq lr ls lt b">Metal</code>，添加<code class="fe lq lr ls lt b">OpenGLES3</code>、<code class="fe lq lr ls lt b">OpenGLES2</code>。如果您不使用<code class="fe lq lr ls lt b">Vuforia</code>，您可以跳过这一步。</p><p id="3111" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">c.取消勾选<code class="fe lq lr ls lt b">Metal Editor Support</code> &amp; <code class="fe lq lr ls lt b">Strip Engine Code</code></p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ni"><img src="../Images/5f3aeca1146ccfb5c9aa42222e8385b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SuPnU5wM3yhwp0yY8s5WHQ.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">取消选中自动图形API和金属编辑器支持，选择打开栅格3，打开栅格2</p></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nj"><img src="../Images/520582b84be9bbfd61a50f6c29fb7f59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ieeg2nEWoIoB1v3rl-Rz4g.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">取消选中剥离引擎代码</p></figure><p id="7e05" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">d.构建并记下您导出Unity项目的位置。</p><p id="5aeb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">5.转到您的Xcode目标文件夹(包含<code class="fe lq lr ls lt b">YOUR_PROJ_NAME.xcodeproj</code>文件的文件夹)——已经创建了一个包含<code class="fe lq lr ls lt b">Exports.xcconfig</code>的<code class="fe lq lr ls lt b">Unity</code>文件夹。</p><h1 id="3804" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">第2部分:在iOS项目中嵌入Unity</h1><ol class=""><li id="2053" class="mr ms it kk b kl mm ko mn kr nk kv nl kz nm ld mw mx my mz bi translated">下载<a class="ae na" href="https://github.com/jiulongw/swift-unity/tree/master/demo/xcode/DemoApp/Unity" rel="noopener ugc nofollow" target="_blank"> Unity </a>文件夹，将里面的所有项目复制到Xcode目标文件夹下的<code class="fe lq lr ls lt b">Unity</code>文件夹。</li><li id="968b" class="mr ms it kk b kl nn ko no kr np kv nq kz nr ld mw mx my mz bi translated">在项目导航器中打开<code class="fe lq lr ls lt b">.xcworkspace</code>，将刚刚下载的<code class="fe lq lr ls lt b">Unity</code>文件夹拖拽到目标位置。选择<code class="fe lq lr ls lt b">Copy items if needed</code>和<code class="fe lq lr ls lt b">Create Groups</code>。</li><li id="d94a" class="mr ms it kk b kl nn ko no kr np kv nq kz nr ld mw mx my mz bi translated">转到Unity项目导出文件夹(不是步骤2中的那个)，将<code class="fe lq lr ls lt b">Classes</code>和<code class="fe lq lr ls lt b">Libraries</code>文件夹拖到项目导航器中的目标文件夹(一次一个文件夹)，选择<code class="fe lq lr ls lt b">Copy items if needed</code>和<code class="fe lq lr ls lt b">Create Groups</code>。</li><li id="e6e6" class="mr ms it kk b kl nn ko no kr np kv nq kz nr ld mw mx my mz bi translated">拖动<code class="fe lq lr ls lt b">Data</code>文件夹，取消<code class="fe lq lr ls lt b">Copy items if needed</code>选择<code class="fe lq lr ls lt b">Create Group Reference</code>。</li><li id="8ffc" class="mr ms it kk b kl nn ko no kr np kv nq kz nr ld mw mx my mz bi translated">拖动<code class="fe lq lr ls lt b">Framework</code>文件夹下的<code class="fe lq lr ls lt b">Vuforia.framework</code>，选择<code class="fe lq lr ls lt b">Copy items if needed</code>和<code class="fe lq lr ls lt b">Create Groups</code>。</li></ol><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/5b7bca4104169915c7dc187723aead2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*5hK4AXruSaaBNHJmxcuqyA.png"/></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">您的项目的层次结构现在应该如下所示</p></figure><p id="dc31" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">6.在项目导航器中选择您的项目，并转到<code class="fe lq lr ls lt b">info</code>选项卡。在<code class="fe lq lr ls lt b">Configurations</code>下，你应该看到<code class="fe lq lr ls lt b">Pods-YOUR_PROJ_NAME.debug</code>和<code class="fe lq lr ls lt b">Pods-yourproj.release</code>被默认设置为你的目标的<code class="fe lq lr ls lt b">Debug</code>和<code class="fe lq lr ls lt b">Release</code>配置文件。都改成<code class="fe lq lr ls lt b">Unity</code>。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nt"><img src="../Images/4fb102c372da17b120f57c7d77f1449c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WRKHlL-7GvPYrCznnBBo9Q.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">更改配置文件</p></figure><p id="0bf0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">7.转到<code class="fe lq lr ls lt b">Build Settings</code>选项卡，搜索<code class="fe lq lr ls lt b">Enable Testability</code>并将其设置为<code class="fe lq lr ls lt b">No</code>。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nu"><img src="../Images/3a6370f18ca1ca25a0b81ab46105ffd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HzIwvi4ZhV4bInhoaeevjw.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">将启用可测试性设置为否</p></figure><p id="fbaf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">8.点击你的目标，进入<code class="fe lq lr ls lt b">General</code>标签。在<code class="fe lq lr ls lt b">Embedded binaries</code>下，增加<code class="fe lq lr ls lt b">Vuforia.framework</code>。在<code class="fe lq lr ls lt b">Linked Frameworks and Libraries</code>下，增加<code class="fe lq lr ls lt b">AVKit.framework</code>。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nv"><img src="../Images/fa41f0d30ce8c7c4a3bd655f8e383973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uqKqBXFAEmowj2A-aXPavg.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">添加Vuforia.framework和AVKit.framework</p></figure><p id="f9ea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">9.如果您在原生iOS项目中使用<code class="fe lq lr ls lt b">Cocoapods</code>，请在<code class="fe lq lr ls lt b">Unity.xcconfig</code>文件的开头添加以下几行。</p><pre class="lf lg lh li gt nw lt nx ny aw nz bi"><span id="5696" class="oa lv it lt b gy ob oc l od oe">#include "../../Pods/Target Support Files/Pods-YOUR_PROJ_NAME/Pods-YOUR_PROJ_NAME.debug.xcconfig"<br/>#include "../../Pods/Target Support Files/Pods-YOUR_PROJ_NAME/Pods-YOUR_PROJ_NAME.release.xcconfig"</span></pre><p id="5a7e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">10.如果使用<code class="fe lq lr ls lt b">.NET 4.0</code>T34，<code class="fe lq lr ls lt b">Unity.xcconfig</code>中的，将<code class="fe lq lr ls lt b"><em class="of">-DNET_4_0</em></code>追加到<code class="fe lq lr ls lt b"><em class="of">OTHER_CFLAGS</em></code>中</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi og"><img src="../Images/1c9494f4848d667400c11a7f4c4074ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lYEw5s0YCMS570BqYCg2Eg.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">将<code class="fe lq lr ls lt b"><em class="oh">-DNET_4_0</em></code>追加到<code class="fe lq lr ls lt b"><em class="oh">OTHER_CFLAGS</em></code></p></figure><p id="d6a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">11.使用项目导航器中的过滤器搜索这两个文件:<code class="fe lq lr ls lt b">Unity/Classes</code>文件夹下的<code class="fe lq lr ls lt b">DynamicLibEngineAPI-functions.h</code>、<code class="fe lq lr ls lt b">DynamicLibEngineAPI.mm</code>，并使用<code class="fe lq lr ls lt b">Remove references only</code>删除它们。</p><p id="fb1e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">12.在<code class="fe lq lr ls lt b">Unity/Classes/UI</code>下搜索<code class="fe lq lr ls lt b">SplashScreen.mm</code>，将<code class="fe lq lr ls lt b">#include “Classes/Unity/UnitySharedDecls.h” </code>替换为<code class="fe lq lr ls lt b">#include “../Classes/Unity/UnitySharedDecls.h”</code>。</p><p id="414a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">13.在<code class="fe lq lr ls lt b">Unity/Classes/Unity</code>下搜索<code class="fe lq lr ls lt b">DeviceSettings.mm</code>，在第<code class="fe lq lr ls lt b">280</code> ( <code class="fe lq lr ls lt b">#endif</code>)行和第<code class="fe lq lr ls lt b">281</code> ( <code class="fe lq lr ls lt b">}</code>)行之间添加<code class="fe lq lr ls lt b">return deviceUnknown;</code>。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/4304d772eab8b75cbf3640918015995c.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*6ptoPd_jNEXuNrWv4RKHFQ.png"/></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">添加“返回设备未知”;'</p></figure><p id="b56d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">14.如果您正在使用<code class="fe lq lr ls lt b">Vuforia</code>，请转到您的<code class="fe lq lr ls lt b">Info.plist</code>，添加键<code class="fe lq lr ls lt b">Privacy — Camera Usage Description.</code>在这里您可以添加一条消息，告诉用户该应用程序需要使用摄像头。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oj"><img src="../Images/00bb7d58c480fdbb4a0800b07f00f00a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yXaIfxRyU7QvD5OqZ8EEsw.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">向Info.plist添加隐私-相机使用说明</p></figure><h1 id="4d01" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">第3部分:编辑原生iOS Swift文件</h1><ol class=""><li id="6b53" class="mr ms it kk b kl mm ko mn kr nk kv nl kz nm ld mw mx my mz bi translated">按照<a class="ae na" href="https://github.com/jiulongw/swift-unity/blob/master/demo/xcode/DemoApp/AppDelegate.swift" rel="noopener ugc nofollow" target="_blank">这个代码</a>编辑你的<code class="fe lq lr ls lt b">AppDelegate.swift</code>。</li><li id="2439" class="mr ms it kk b kl nn ko no kr np kv nq kz nr ld mw mx my mz bi translated">为您的Unity view添加新的视图控制器。</li><li id="d400" class="mr ms it kk b kl nn ko no kr np kv nq kz nr ld mw mx my mz bi translated">创建新的<code class="fe lq lr ls lt b">UnityViewController.swift</code></li><li id="dc39" class="mr ms it kk b kl nn ko no kr np kv nq kz nr ld mw mx my mz bi translated">在<code class="fe lq lr ls lt b">func viewDidLoad()</code>中添加这些行:</li></ol><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h1 id="9411" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">第4部分:运行项目</h1><p id="707e" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">就是这样，您应该能够在您的设备上运行您的项目了！</p><p id="bfc0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意:如果你正在使用Vuforia <strong class="kk iu">你将不能在模拟器中运行它——你将会得到无数的错误信息。</strong></p><h1 id="a32c" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">参考</h1><p id="7fd0" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">这里有一些我发现有用的其他教程。如果您仍然需要帮助，请尝试以下资源:</p><p id="5453" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae na" href="https://github.com/jiulongw/swift-unity" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">将Unity项目集成到Xcode Swift项目</strong> </a></p><p id="02f8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae na" href="https://github.com/rocketinsights/Unity-iOS" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> Unity-iOS </strong> </a></p><p id="9a10" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae na" href="https://medium.com/@IronEqual/how-to-embed-a-unity-game-into-an-ios-native-swift-app-772a0b65c82" rel="noopener"> <strong class="kk iu">如何将Unity游戏嵌入iOS原生Swift App </strong> </a></p><p id="d29c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae na" href="https://github.com/blitzagency/ios-unity5" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">如何在iOS应用内使用Unity 3D</strong></a></p></div></div>    
</body>
</html>