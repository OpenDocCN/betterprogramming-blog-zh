<html>
<head>
<title>Highlighting a Specific Word in an Input Image Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python高亮显示输入图像中的特定单词</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/highlighting-specific-word-in-an-input-image-1cf3d4f8ae27?source=collection_archive---------7-----------------------#2019-12-09">https://betterprogramming.pub/highlighting-specific-word-in-an-input-image-1cf3d4f8ae27?source=collection_archive---------7-----------------------#2019-12-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ba86" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">玩日常实时捕捉的图像</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1644901193f800b6e6d6b4eaa5ec1867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u9SiRU9O-uWeNj9qW3S5Kg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@halgatewood?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">哈尔·盖特伍德</a>在<a class="ae ky" href="https://unsplash.com/s/photos/word?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="eedc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图像处理是当今的一个新趋势。处理日常实时捕捉的图像也不例外。</p><p id="9781" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">传统上，光学字符识别(OCR)所做的是将手写或打印的文本转换为机器编码的文本，无论是扫描的文档还是文档的照片。</p><p id="3771" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们现在可以搜索一个关键字，并检查它是否存在于其中。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="293e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">目标</h1><p id="102c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果我们能够在图像中突出显示单词本身，那就太酷了，对吧(不必要的眉毛摆动)？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="92bb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">让我们开始吧</h1><p id="1377" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们使用流行的<a class="ae ky" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a> OCR，它是<code class="fe mz na nb nc b"><a class="ae ky" href="https://pypi.org/project/pytesseract/" rel="noopener ugc nofollow" target="_blank">pytesseract</a></code> <em class="nd">，</em>Google的<a class="ae ky" href="https://www.pyimagesearch.com/2017/07/10/using-tesseract-ocr-python/" rel="noopener ugc nofollow" target="_blank">tessera CT OCR</a>引擎的包装器。它基本上可以读取图像中的文本。</p><p id="78f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的输入图像是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/7e4fbffb15bd5785586ee48989f5b189.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sEyJx_biWxlnlbdasKLDjg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这里我们试图突出显示商家ID、交易ID及其值</p></figure><p id="3253" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们导入代码中将要用到的所有模块。</p><pre class="kj kk kl km gt nf nc ng nh aw ni bi"><span id="7386" class="nj md it nc b gy nk nl l nm nn">import pytesseract<br/>from pytesseract import Output<br/>import cv2</span></pre><p id="c4e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在处理图像，<a class="ae ky" href="https://opencv.org/" rel="noopener ugc nofollow" target="_blank"> OpenCV </a>怎么能缺席晚会？如果尚未安装，使用命令<code class="fe mz na nb nc b">pytesseract</code>和OpenCV。</p><pre class="kj kk kl km gt nf nc ng nh aw ni bi"><span id="c5a3" class="nj md it nc b gy nk nl l nm nn">pip install pytesseract</span><span id="5e99" class="nj md it nc b gy no nl l nm nn">pip install opencv-contrib-python</span></pre><p id="9c01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我见过一些<code class="fe mz na nb nc b">pytesseract</code>抛出错误的例子，比如:</p><pre class="kj kk kl km gt nf nc ng nh aw ni bi"><span id="d58c" class="nj md it nc b gy nk nl l nm nn">tesseract is not installed or it’s not in your path.</span></pre><p id="f574" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，请使用:</p><pre class="kj kk kl km gt nf nc ng nh aw ni bi"><span id="3fe5" class="nj md it nc b gy nk nl l nm nn">tessdata_dir_config = '--tessdata-dir "E:/opencvdemo/Tesseract-OCR/tessdata"'<br/>pytesseract.pytesseract.tesseract_cmd = 'C:/Program Files (x86)/Tesseract-OCR/tesseract.exe'</span></pre><p id="1479" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们阅读图像并探索pytesseract模块的强大功能。</p><pre class="kj kk kl km gt nf nc ng nh aw ni bi"><span id="b799" class="nj md it nc b gy nk nl l nm nn">img = cv2.imread('imagetext.jpg')<br/>d = pytesseract.image_to_data(img, output_type=Output.DICT, lang='eng', config=tessdata_dir_config)<br/>n_boxes = len(d['level'])</span></pre><p id="2227" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，<code class="fe mz na nb nc b">n_boxes</code>(这里等级给出如下，如下)给出了从pytesseract的<code class="fe mz na nb nc b">image_to_data</code>函数中检测到的项目的数量。</p><p id="d99d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">image_to_data()</code>会将图像转换为具有以下内容的数据输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/c61e5719981b817249b4f739c4e4acb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tUtjhVFe9OCz6u1kc8H0lQ.jpeg"/></div></div></figure><p id="666f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于<code class="fe mz na nb nc b">image_to_data()</code>的更多解释，请参考<a class="ae ky" href="https://github.com/tesseract-ocr/tesseract/wiki/Command-Line-Usage#tsv-output-currently-available-in-305-dev-in-master-branch-on-github" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。</p><pre class="kj kk kl km gt nf nc ng nh aw ni bi"><span id="f0dd" class="nj md it nc b gy nk nl l nm nn">overlay = img.copy()<br/>for i in range(n_boxes):<br/>    text = d['text'][i]<br/>    if text == 'Merchant' or text == 'Transaction':<br/>        (x, y, w, h) = (d['left'][i], d['top'][i], d['width'][i], d['height'][i])<br/>        (x1, y1, w1, h1) = (d['left'][i + 1], d['top'][i + 1], d['width'][i + 1], d['height'][i + 1])<br/>        (x2, y2, w2, h2) = (d['left'][i + 2], d['top'][i + 2], d['width'][i + 2], d['height'][i + 2])<br/>        # cv2.rectangle(img, (x, y), (x1 + w1, y1 + h1), (0, 255, 0), 2)<br/>        cv2.rectangle(overlay, (x, y), (x1 + w1, y1 + h1), (255, 0, 0), -1)<br/>        # cv2.rectangle(img, (x2, y2), (x2 + w2, y2 + h2), (0, 255, 0), 2)<br/>        cv2.rectangle(overlay, (x2, y2), (x2 + w2, y2 + h2), (0, 0, 255), -1)<br/>        # print(text)</span></pre><p id="547c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们复制图像以在图像上创建一个覆盖(标记类型的高亮)类型的遮罩，随着我们继续学习代码，您将会理解这一点。</p><p id="723f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们迭代直到框的总数(<code class="fe mz na nb nc b">n_boxes</code>)来找出我们的输入关键字是否存在。</p><p id="182d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">if</code>条件将过滤出我们需要的关键字，如果在第一次<em class="nd">迭代中存在</em>，那么我们将收集<code class="fe mz na nb nc b">left</code>、<code class="fe mz na nb nc b">top</code>、<code class="fe mz na nb nc b">width</code>和<code class="fe mz na nb nc b">height</code>来创建一个矩形。</p><p id="88d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“i+1”和“i+2”是连续两个框的关键字“商家”和“交易”，蛮蛮力的！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/11827c22928dd07ddb5eea11d36deb10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*HHzZztFZEEehUPQe5ey_Xg.png"/></div></figure><p id="0336" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们已经完成了将复制的图像叠加到原始图像上，原始图像包含填充了颜色的矩形框(您可以根据自己的需要使用颜色，但要记住它们是在BGR)。</p><p id="d610" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要让它变得透明一点，因为它们现在是不透明的。</p><pre class="kj kk kl km gt nf nc ng nh aw ni bi"><span id="4d97" class="nj md it nc b gy nk nl l nm nn">alpha = 0.4  # Transparency factor.<br/># Following line overlays transparent rectangle over the image<br/>img_new = cv2.addWeighted(overlay, alpha, img, 1 - alpha, 0)</span></pre><p id="5544" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">cv2.addWeighted</code>方法需要六个参数，就像<code class="fe mz na nb nc b">cv2.addWeighted(overlay, alpha, input image, beta, gamma)</code>一样。其中alpha是透明度因子，通过它，我们可以控制透明度。</p><pre class="kj kk kl km gt nf nc ng nh aw ni bi"><span id="9dcb" class="nj md it nc b gy nk nl l nm nn">r = 1000.0 / img_new.shape[1]  # resizing image without loosing aspect ratio<br/>dim = (1000, int(img_new.shape[0] * r))<br/># perform the actual resizing of the image and show it<br/>resized = cv2.resize(img_new, dim, interpolation=cv2.INTER_AREA)<br/>cv2.imshow('img', resized)<br/>cv2.waitKey(0)<br/>cv2.destroyAllWindows()</span></pre><p id="80b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这最后一步是可选的，是为了在不损失纵横比的情况下将图像调整到我们需要的尺寸。</p><p id="7b68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe mz na nb nc b">imshow()</code>方法，我们可以显示结果图像，然后用<code class="fe mz na nb nc b">waitKey(0)</code>保持窗口打开，再用<code class="fe mz na nb nc b">destroyAllWindows()</code>销毁所有窗口(非常简单，对吧！).</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/bbd7ae8ac81b9edaa629133b965a59af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YoYjNnwqJyt15sv8FiwfRQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">最终输出</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="20c2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="4ffa" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">希望你看懂这篇文章，如有疑问，在下面评论。</p><p id="9b15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我有任何错误，请纠正我，这是我的第一篇文章。</p></div></div>    
</body>
</html>