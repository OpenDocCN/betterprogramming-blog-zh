<html>
<head>
<title>Using Launch Arguments for Easier Core Data Debugging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用启动参数简化核心数据调试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-launch-arguments-for-easier-core-data-debugging-d1b835b6e5b3?source=collection_archive---------17-----------------------#2019-12-02">https://betterprogramming.pub/using-launch-arguments-for-easier-core-data-debugging-d1b835b6e5b3?source=collection_archive---------17-----------------------#2019-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f298" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我几乎每天都会用到的核心数据调试参数概述</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bda2172401fc44d7e7c6dc778056f146.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jynenzUyla3dTWLgJ388YQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">SpaceX 在<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的<a class="ae ky" href="https://unsplash.com/photos/OHOU-5UVIYQ" rel="noopener ugc nofollow" target="_blank"/></p></figure><p id="64b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在应用程序中使用核心数据，你可能会意识到你的设置变得越大越复杂，就越难调试。在这一点上，您可能开始对核心数据及其黑箱实现感到沮丧。你可能会认为你只需要相信核心数据会为你的应用做最理想的事情。</p><p id="453b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，您可能有一个包含多个托管对象上下文的设置，每个上下文都被限制在自己的线程中。当你的应用程序崩溃时，你会认为它与核心数据有某种关系，但你不确定如何调试它。尤其是因为你的应用只是偶尔崩溃，而不是一直崩溃。</p><p id="33a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我想向您展示一些与核心数据相关的启动参数，它们将帮助您调试和验证与核心数据相关的代码。让我们从使用启动参数开始，看看核心数据在幕后做了什么。接下来，我们将了解如何检测核心数据中的大多数线程问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="06cd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">了解核心数据在幕后的作用</h1><p id="4d17" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">有时，当您使用核心数据时，您希望打开底层的SQLite文件，以查看您的数据是否真正按照预期存储。或者，您可能想要检查数据库结构。为此，您需要知道核心数据存储SQLite文件的位置。当你在模拟器上运行时，这尤其具有挑战性。因为说实话，我们不知道我们的模拟器的UUID是什么，而且我们肯定不希望每次需要找到我们的SQLite文件时都必须找出它的位置。</p><p id="7620" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，您可以使用一个启动参数来获取核心数据，以便将一些信息记录到控制台。要添加启动参数，使用Xcode顶部的菜单进入<em class="mz">产品- &gt;方案- &gt;编辑方案… (cmd + &gt; ) </em>。选择<em class="mz">运行</em>配置，并转到<em class="mz">参数</em>选项卡，如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/27cfa4d2512cbe8a3063bbd64dee88bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IZp_episa4ZJcs0d"/></div></div></figure><p id="53c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要获取核心数据以将信息记录到控制台，请单击<em class="mz">启动参数</em>下的+按钮，并添加以下参数:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="0602" class="ng md it nc b gy nh ni l nj nk">-com.apple.CoreData.SQLDebug 1</span></pre><p id="a5e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/5231f07f74e33f813aa0f3978cfd7673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EenFgLqibpY9z-Mx"/></div></div></figure><p id="febd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果在设置此启动参数后运行Core Data应用程序，Core Data将开始记录基本信息，如支持SQLite文件的存储位置和执行的查询。</p><p id="fc0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以将日志级别一直增加到第四级。在这一点上，核心数据将记录你可能想知道的关于引擎盖下正在发生的事情和更多的一切。例如，这可能有助于您注意到核心数据正在执行大量SQLite查询来获取对象关系。基于这一发现，您可以通过设置获取请求的<code class="fe nm nn no nc b">relationshipKeyPathsForPrefetching</code>属性来决定某些获取请求应该自动获取某些关系。</p><p id="a44f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于好奇，下面的列表描述了不同的核心数据SQLDebug日志级别:</p><ol class=""><li id="0eb9" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">SQL语句及其执行时间</li><li id="9676" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">语句中绑定的值</li><li id="d290" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">已提取托管对象id</li><li id="f7d3" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">SQLite解释语句</li></ol><p id="bea6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这四个日志级别为您提供了大量信息，可用于改进您的应用程序。当然，某些日志级别(比如四级)的有用性完全取决于您对SQLite的了解。但是，即使您不精通SQLite，我也建议您有时查看一下所有的日志级别。他们可以产生一些有趣的输出。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="48ef" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">检测核心数据中的线程问题</h1><p id="2ce7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">核心数据可能遇到的最大挫折之一是线程问题导致的随机崩溃。您应该只在创建托管对象的线程上使用托管对象上下文和托管对象，违反这条规则可能会使您的应用程序崩溃。但是，通常你的应用不会崩溃，一切都很好。但时不时会出现随机崩溃。您可以看出它与核心数据相关，但是您可能不确定错误到底来自哪里。</p><p id="ba56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，Core Data团队已经想到了一种方法来帮助您摆脱这些崩溃。在Xcode中，可以添加<code class="fe nm nn no nc b">-com.apple.CoreData.ConcurrencyDebug 1</code> Launch参数，以一种额外严格的模式运行核心数据。每当核心数据遇到线程违规，你的应用就会立刻崩溃，Xcode会指出违规发生的确切行。</p><p id="608d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我可以推荐每个人在开发中使用这个启动参数，因为它将帮助您尽早发现线程问题。这也迫使你立即修复它们，而不是在你的应用程序已经发布到应用程序商店时得到一些令人讨厌的惊喜。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4d2c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">概括起来</h1><p id="b7ce" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">虽然您不能用调试标志消除所有的错误和性能问题，但它确实有助于您使用一些工具来使您的问题更加明显。无论是违反Core Data的线程规则导致应用崩溃，还是深入了解Core Data在幕后执行的不同SQLite查询，了解代码在幕后的行为总是有好处的。</p><p id="3481" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这些调试标志将帮助您节省大量时间，就像它们为我做的一样。</p></div></div>    
</body>
</html>