<html>
<head>
<title>A Custom Properties Snippet Builder for VS Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">VS代码的自定义属性代码段生成器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-custom-properties-snippet-builder-for-vscode-e6f415f2ccd7?source=collection_archive---------7-----------------------#2022-05-07">https://betterprogramming.pub/a-custom-properties-snippet-builder-for-vscode-e6f415f2ccd7?source=collection_archive---------7-----------------------#2022-05-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c878" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何编写一个小节点脚本来生成一个包含所有项目css自定义属性的VSCode片段</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2ad63f2f604d842327d746b964c61afa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aDii5n3ZkHvFSwN8"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@pankajpatel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pankaj Patel </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="d5e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很长一段时间以来，我越来越广泛地使用<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/CSS/--*" rel="noopener ugc nofollow" target="_blank"> CSS自定义属性</a>，当处理许多较大的项目时，很难记住它们。</p><p id="e4e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我使用VSCode进行编码，有一些Intellisense插件非常有用，但有时，出于某些原因，它们不能像我预期的那样工作。</p><p id="9ebb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了解决这个问题，我决定创建一个小脚本，它可以从我的文件中提取CSS属性列表，然后完全自动地生成一个<a class="ae kv" href="https://code.visualstudio.com/docs/editor/userdefinedsnippets" rel="noopener ugc nofollow" target="_blank"> VSCode片段</a>。</p><p id="86d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个相当原始的解决方案，但它做的工作。希望对某个人有用。</p><h1 id="12a3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">设置</h1><p id="b985" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">该脚本是基于节点的，所以第一步是<a class="ae kv" href="https://nodejs.org/it/download/" rel="noopener ugc nofollow" target="_blank">安装它</a>如果你以前从未这样做过。</p><p id="14ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，在VSCode中打开一个项目文件夹，如果需要的话创建一个<code class="fe mp mq mr ms b"><a class="ae kv" href="https://docs.npmjs.com/cli/v8/commands/npm-init" rel="noopener ugc nofollow" target="_blank">package.json</a></code> <a class="ae kv" href="https://docs.npmjs.com/cli/v8/commands/npm-init" rel="noopener ugc nofollow" target="_blank">文件</a>，确保它至少包含一个css文件(下面例子中的<code class="fe mp mq mr ms b">test.css</code>)。</p><p id="cb48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此时，您必须创建您的项目片段文件。有两种方法可以做到这一点:</p><ol class=""><li id="9497" class="mt mu iq ky b kz la lc ld lf mv lj mw ln mx lr my mz na nb bi translated">手动创建一个<code class="fe mp mq mr ms b">.vscode</code>文件夹和一个仅包含空括号的<code class="fe mp mq mr ms b">.code-snippets</code>文件(在我的例子中，我将其命名为<code class="fe mp mq mr ms b">my-proj.code-snippets</code>)。</li><li id="ab4e" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">遵循<a class="ae kv" href="https://code.visualstudio.com/docs/editor/userdefinedsnippets#_create-your-own-snippets" rel="noopener ugc nofollow" target="_blank"> VSCode片段帮助页面</a>上的说明。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/c257b41ec895b61bdb44410365a16f1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*GPI_JJtwAvd_pmsLlqb87g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">VSCode文件资源管理器中的项目文件</p></figure><p id="14a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您必须添加代码片段(除了我们稍后将生成的部分):</p><pre class="kg kh ki kj gt ni ms nj bn nk nl bi"><span id="61a3" class="nm lt iq ms b be nn no l np nq">{<br/>  "My-proj custom properties": {<br/>    "scope": "scss,css",<br/>    "prefix": [<br/>      "var",<br/>      "--prefix"<br/>    ],<br/>    "body": [],<br/>    "description": "custom properties list - NB this is a script-generated snippet"<br/>  }<br/>}</span></pre><p id="0f89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码片段keyname ( <code class="fe mp mq mr ms b">My-proj custom properties"</code>)将用于更新它，如果您更改它，您还需要更新脚本。</p><p id="dbf5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">脚本将更新<code class="fe mp mq mr ms b">body</code>元素，您可以随意定制代码片段的其余部分。</p><blockquote class="nr ns nt"><p id="2a76" class="kw kx nu ky b kz la jr lb lc ld ju le nv lg lh li nw lk ll lm nx lo lp lq lr ij bi translated">如果您需要帮助来构建代码片段，这个<a class="ae kv" href="https://snippet-generator.app/" rel="noopener ugc nofollow" target="_blank">生成器</a>可以帮助您</p></blockquote><h1 id="247a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">剧本</h1><p id="57fc" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们的脚本必须执行这些操作:</p><ul class=""><li id="9ebd" class="mt mu iq ky b kz la lc ld lf mv lj mw ln mx lr ny mz na nb bi translated">读取一些css文件的内容</li><li id="2fe6" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr ny mz na nb bi translated">搜索自定义属性字符串并提取它们</li><li id="1fb1" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr ny mz na nb bi translated">删除重复项并排序</li><li id="656a" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr ny mz na nb bi translated">更新代码段文件</li></ul><blockquote class="nr ns nt"><p id="7ba5" class="kw kx nu ky b kz la jr lb lc ld ju le nv lg lh li nw lk ll lm nx lo lp lq lr ij bi translated">我首先尝试解析css文件来执行更精确的提取，但是这大大增加了脚本的复杂性。最后，对我来说，对CSS字符串的简单处理就足以达到预期的目标了。</p></blockquote><p id="4a6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始在您的项目中创建一个<code class="fe mp mq mr ms b">index.mjs</code>(或者您喜欢的名称)文件。因为我们将使用ES6 modules语法，所以在您将一个值为module的顶级字段类型添加到您的<code class="fe mp mq mr ms b">package.json</code>之前，<code class="fe mp mq mr ms b">.mjs</code>扩展是必需的(参见节点文档中的<a class="ae kv" href="https://nodejs.org/docs/latest-v16.x/api/esm.html#modules-ecmascript-modules" rel="noopener ugc nofollow" target="_blank"> ECMAScript Modules </a>)。</p><p id="a1b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将以下代码复制到文件中:</p><pre class="kg kh ki kj gt ni ms nj bn nk nl bi"><span id="d6e7" class="nm lt iq ms b be nn no l np nq">/* eslint-env node */<br/>/* eslint-disable no-console */<br/><br/>import * as fs from 'fs';<br/><br/><br/>const sources = [<br/>    './test.css'<br/>  ],<br/>  snippet_file = './.vscode/my-proj.code-snippets',<br/>  snippet_key = 'My-proj custom properties',<br/>  custom_var_prefix = 'prefix-';<br/><br/>let custom_properties = [];<br/><br/>sources.forEach(css_file =&gt; {<br/>  let css_content = fs.readFileSync(css_file).toString();<br/><br/>  const regex = new RegExp(`--${custom_var_prefix}[a-zA-Z0-9._-]*?: ?(.*?)[;}]`, 'gi'),<br/>    this_cust_props = css_content.match(regex);<br/><br/>  custom_properties = custom_properties.concat(this_cust_props);<br/>});<br/><br/>// delete end `}` from compressed files<br/>custom_properties = custom_properties.map(item =&gt; item.replace(/}$/, ';'));<br/><br/>custom_properties = custom_properties.map(item =&gt; item.split(':')[0].trim());<br/>custom_properties.sort();<br/>custom_properties = [...new Set(custom_properties)];<br/><br/>let vscode_snippet_body = `var(--${custom_var_prefix}\${1|` +<br/>  custom_properties.reduce((result,item) =&gt; `${result},${item}`).replaceAll(`--${custom_var_prefix}`, '') +<br/>  '|})$0';<br/><br/><br/>// VSCODE snippets reading and update<br/>let snippets = JSON.parse(fs.readFileSync(snippet_file).toString());<br/><br/>if(snippets[snippet_key]) {<br/>  snippets[snippet_key].body = [vscode_snippet_body];<br/>  fs.writeFileSync(snippet_file, JSON.stringify(snippets, null, '  '));<br/><br/>  console.log('*** end ***'); <br/><br/>} else {<br/>  console.error(`******ERROR\n'${snippet_key}' snippet doesn't exist\n************`);<br/>}</span></pre><p id="65a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们导入节点<em class="nu">文件系统</em>模块(<code class="fe mp mq mr ms b">fs</code>，我们将使用它来读取css文件并写入更新的代码片段文件。</p><p id="5341" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后你需要设置一些常量:</p><pre class="kg kh ki kj gt ni ms nj bn nk nl bi"><span id="f500" class="nm lt iq ms b be nn no l np nq">const sources = [<br/>    './test.css'<br/>  ],<br/>  snippet_file = './.vscode/my-proj.code-snippets',<br/>  snippet_key = 'My-proj custom properties',<br/>  custom_var_prefix = 'prefix-';<br/>  <br/>let custom_properties = [];</span></pre><ul class=""><li id="e23c" class="mt mu iq ky b kz la lc ld lf mv lj mw ln mx lr ny mz na nb bi translated"><code class="fe mp mq mr ms b">sources</code>是要解析的css文件的数组，路径是相对于项目根的</li><li id="4932" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr ny mz na nb bi translated"><code class="fe mp mq mr ms b">snippet_file</code>:代码片段文件路径</li><li id="4235" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr ny mz na nb bi translated"><code class="fe mp mq mr ms b">snippet_key</code>:要更新的代码片段的keyname</li><li id="5408" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr ny mz na nb bi translated"><code class="fe mp mq mr ms b">custom_var_prefix</code>:所有自定义属性名称共享的可选前缀。一些框架(例如<a class="ae kv" href="https://getbootstrap.com/docs/5.1/customize/css-variables/" rel="noopener ugc nofollow" target="_blank"> Bootstrap </a>)使用它来避免冲突。不需要的话就设置成空字符串(<code class="fe mp mq mr ms b">''</code>)。</li></ul><p id="292a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，初始化<code class="fe mp mq mr ms b">custom_properties</code>数组。</p><p id="07c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此时，每个css文件都被打开，一个简单的正则表达式搜索所有定制属性字符串，所有匹配都被添加到<code class="fe mp mq mr ms b">custom_properties</code>数组中，(注意，RegExp也搜索定制属性值:这是对任何未来增强的一个补充，但目前不使用)。</p><p id="334f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的<code class="fe mp mq mr ms b">custom_properties</code>数组现在可以处理了:</p><pre class="kg kh ki kj gt ni ms nj bn nk nl bi"><span id="d5ca" class="nm lt iq ms b be nn no l np nq">custom_properties = custom_properties.map(item =&gt; item.split(':')[0].trim());<br/>custom_properties.sort();<br/>custom_properties = [...new Set(custom_properties)];<br/>let vscode_snippet_body = `var(--${custom_var_prefix}\${1|` +<br/>  custom_properties.reduce((result,item) =&gt; `${result},${item}`)<br/>    .replaceAll(`--${custom_var_prefix}`, '') + '|})$0';</span></pre><ul class=""><li id="d309" class="mt mu iq ky b kz la lc ld lf mv lj mw ln mx lr ny mz na nb bi translated"><code class="fe mp mq mr ms b">map</code>功能用于移除数值部分</li><li id="9953" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr ny mz na nb bi translated">使用<code class="fe mp mq mr ms b">Set</code>对生成的数组进行排序并移除重复项</li><li id="84dd" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr ny mz na nb bi translated">片段<code class="fe mp mq mr ms b">body</code>字段内容是使用<code class="fe mp mq mr ms b">reduce</code>函数作为<a class="ae kv" href="https://code.visualstudio.com/docs/editor/userdefinedsnippets#_choice" rel="noopener ugc nofollow" target="_blank">选择字符串</a>生成的。</li></ul><p id="d2ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以打开代码片段文件(再次使用<code class="fe mp mq mr ms b">fs</code>，JSON被解析。</p><blockquote class="nr ns nt"><p id="7c8a" class="kw kx nu ky b kz la jr lb lc ld ju le nv lg lh li nw lk ll lm nx lo lp lq lr ij bi translated">实际上，VSCode Snippets文档不是JSON文件，而是JSON-C(带注释的JSON)。这意味着如果有任何注释，在处理文件时将会抛出一个错误。您必须手动删除文件中的所有注释，或者实现一个注释保存解析器，比如<a class="ae kv" href="https://www.npmjs.com/package/comment-json" rel="noopener ugc nofollow" target="_blank"> comment-json </a></p></blockquote><p id="76b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了完成这项工作，我们只需要更新<code class="fe mp mq mr ms b">body</code>字段并保存代码片段文件。</p><p id="c58a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，文件中的任何其他代码片段都不会更改。</p></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><p id="4183" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们可以在终端中运行我们的脚本:</p><pre class="kg kh ki kj gt ni ms nj bn nk nl bi"><span id="f343" class="nm lt iq ms b be nn no l np nq">node index.mjs</span></pre><p id="8d76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您也可以将它添加到您的<code class="fe mp mq mr ms b">package.json</code>文件中，并通过VSCode中的<code class="fe mp mq mr ms b">Script Npm</code>面板(或从命令面板)运行它:</p><pre class="kg kh ki kj gt ni ms nj bn nk nl bi"><span id="9345" class="nm lt iq ms b be nn no l np nq">{<br/>  "scripts": {<br/>    "run": "node ./index.mjs"<br/>  }<br/>}</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/4fc1f2274596fac77613cbc4d390a875.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*LXYVwQD-B7OKo_oT9XbmjQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">“编写国家预防机制脚本”小组</p></figure><p id="e649" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在编辑<code class="fe mp mq mr ms b">css</code>或<code class="fe mp mq mr ms b">scss</code>文件时，键入<code class="fe mp mq mr ms b">var</code>或<code class="fe mp mq mr ms b">--prefix</code>(如代码片段的<code class="fe mp mq mr ms b">prefix</code>字段中所设置的)，您将能够访问您所有的定制属性列表:</p><div class="kg kh ki kj gt ab cb"><figure class="oh kk oi oj ok ol om paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/68290f5fc3aa8dafe950bd894663045c.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*f035lqoYhJzMKnZ7ob5TRQ.png"/></div></figure><figure class="oh kk on oj ok ol om paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/2e7a94b959c5565542fdf79544323dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*6_LMUJ57T7KLixfilfGrGQ.png"/></div></figure></div><p id="c3f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，每次编辑CSS时你都必须运行脚本，但是操作非常快，一旦定义了CSS，你可能就不需要经常这么做了…</p></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><p id="8e1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://medium.com/@massimo.cassandro/my-dev-publications-eacf6727e4a" rel="noopener"> <em class="nu">我的所有出版物</em> </a></p></div></div>    
</body>
</html>