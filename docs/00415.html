<html>
<head>
<title>Making a Verlet Physics Engine in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript制作一个Verlet物理引擎</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/making-a-verlet-physics-engine-in-javascript-1dff066d7bc5?source=collection_archive---------2-----------------------#2019-05-16">https://betterprogramming.pub/making-a-verlet-physics-engine-in-javascript-1dff066d7bc5?source=collection_archive---------2-----------------------#2019-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="62be" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在物理引擎的引擎盖下看一看</h2></div><p id="7b9c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有没有想过用JavaScript能不能做出自己的物理引擎？如果是这样，你来对地方了。我们打算用JavaScript从头开始构建一个物理引擎。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/1220e3c43f67ff92ae89bf09d723b2a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Pc5hJ1_RuRY_Ugdh"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">照片由<a class="ae lr" href="https://unsplash.com/@cakirchoff?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">查德·科尔乔夫</a>在<a class="ae lr" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="85b4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们开始之前，我应该提到这个教程假设你对向量有很好的理解。</p><p id="4005" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您还没有理解这一点，请不要担心——向量很简单:<a class="ae lr" href="https://anuraghazra.github.io/CanvasFun/src/lib/Vector.js" rel="noopener ugc nofollow" target="_blank">获取Vector.js </a></p><h1 id="ea89" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">什么是Verlet物理？</strong></h1><p id="a68f" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">根据维基百科:</p><blockquote class="mp mq mr"><p id="6924" class="kf kg ms kh b ki kj jr kk kl km ju kn mt kp kq kr mu kt ku kv mv kx ky kz la ij bi translated"><strong class="kh ir"> Verlet积分</strong>是一种用于积分牛顿运动方程的数值方法。在分子动力学模拟和计算机图形学中，它经常被用来计算粒子的轨迹。该算法于1791年由德朗布尔首次使用，此后被多次重新发现，最近一次是由Loup Verlet在20世纪60年代用于分子动力学。</p></blockquote><p id="7ce8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">简单来说，Verlet物理学只是一个由点连接而成的系统。</p><h2 id="6ba8" class="mw lt iq bd lu mx my dn ly mz na dp mc ko nb nc me ks nd ne mg kw nf ng mi nh bi translated">在Verlet系统中，我们有两个主要组件:</h2><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/d7e3dedc52e3d577cf7ec60169c52e48.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*k5B1cW0drtG6GNhBMW9Z5A.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">一个盒子。用点和棒连接</p></figure><ol class=""><li id="c1d7" class="nj nk iq kh b ki kj kl km ko nl ks nm kw nn la no np nq nr bi translated">点(圆点)</li><li id="b598" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la no np nq nr bi translated">约束(棒(</li></ol><h2 id="0878" class="mw lt iq bd lu mx my dn ly mz na dp mc ko nb nc me ks nd ne mg kw nf ng mi nh bi translated">点</h2><p id="2136" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">这些点应用了非常简单的物理原理。</p><p id="9d11" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们必须跟踪这些点的当前和旧的<strong class="kh ir">位置</strong>来给它们添加物理行为——当我们实际实现时你会看到这一点。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">点. js</p></figure><p id="a42d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有了基本的设置，现在让我们渲染点<em class="ms">和</em>让它们移动。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Dot.js - update()</p></figure><p id="6885" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更新函数将更新位置并处理点的物理特性。</p><p id="995d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">基本上，要做Verlet积分，我们必须根据点的旧位置计算速度。</p><p id="a721" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在第一行中，我们用旧位置减去当前位置得到期望的速度。计算出速度后，我们对这些点施加摩擦力，使它们停止运动，而不是永远滑动。</p><p id="b969" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们通过说<code class="fe nz oa ob oc b">this.oldpos.setXY(this.pos.x, this.pos.y)</code> <strong class="kh ir"> </strong>来更新旧的位置，并将速度和重力添加到位置。</p><p id="40bf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还想让它们留在画布内，所以我们必须添加一些检查。我们还将添加另一个功能:<code class="fe nz oa ob oc b">constrain()</code>:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">dot . js-constraint()</p></figure><p id="1572" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们添加渲染方法:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Dot.js - render()</p></figure><p id="1bcc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">设置:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">index.js -设置示例</p></figure><p id="e222" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在随机位置添加了更多的点，然后<code class="fe nz oa ob oc b">update() constrain() render()</code>它们。</p><p id="2090" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们看看这是什么样子:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="od ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Verlet Physics — Dot.js</p></figure><p id="f316" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很好——这只是一个开始，但我们终于有所收获了。</p><p id="5625" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们要添加棍子了！</p><h2 id="4461" class="mw lt iq bd lu mx my dn ly mz na dp mc ko nb nc me ks nd ne mg kw nf ng mi nh bi translated">插入</h2><p id="01c0" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">棍子是小柱物理学的核心。棍子确保点彼此不会太远或太近——它们将点限制在一定的距离内。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/d5d98b6ad4f5c8587fb152e965e3a346.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*VuR7pK6avYSxN6eXMqHYqQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><a class="ae lr" href="https://slsdo.github.io/blob-family/#constraint" rel="noopener ugc nofollow" target="_blank">https://slsdo.github.io/blob-family/#constraint</a></p></figure><p id="c87c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> Stick.js </strong>类相当简单。它需要两个<strong class="kh ir">点</strong>作为参数和长度。但是如果长度没有定义，我们将根据点的位置来计算长度。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Stick.js</p></figure><p id="13b7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们添加算法的实际核心。这将根据棍子的距离来解析和更新点的位置，最终将它约束到与所有其他点的特定距离。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Stick.js - update()</p></figure><p id="4771" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，我想我们可以走了！让我们添加渲染功能:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Stick.js - render()</p></figure><p id="aa7a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">设置:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">设置-创建盒子</p></figure><p id="1280" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们看看结果:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="od ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">一个简单的盒子</p></figure><p id="d040" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如你所见，我们有一个盒子！不管怎样，一个看起来像果冻做的盒子。这是因为在单个帧中，每根棍子更新一次不足以让点停留在它们的长度上。我们必须尽可能多地迭代模拟——迭代次数越多，刚性盒就越多。</p><p id="7ec9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将这几行代码添加到现有代码中会使该框变得僵化:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="a3f5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，让我们来看一个更新的例子:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="od ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">VerletPhysics —更新示例</p></figure><p id="b0fd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">看起来很神奇，不是吗？</p><h1 id="eae4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Entity.js:在一个地方管理点和棒</h1><p id="11b9" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">好了，现在我们有了Dot.js和Stick.js。它们都运行得很好，但问题是我们无法控制如何使用它们。</p><p id="96c2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将创建一个实体类，它将轻松处理Verlet对象的更新和呈现。我将把整个代码粘贴到这里—这没什么特别的:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Entity.js —基本OOP</p></figure><p id="7a6e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用实体类:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="3a04" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是的，这看起来非常干净和易于管理！</p><p id="21a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们来看看最后的结果:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="od ny l"/></div></figure><p id="e592" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以用这个Entity.js类创建许多有趣的Verlet形状！</p><h1 id="1ff6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Verly.js:我写的一个物理引擎</h1><p id="52a8" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">js是我写的一个健壮的Verlet物理引擎。它有许多很酷的功能:</p><ol class=""><li id="b986" class="nj nk iq kh b ki kj kl km ko nl ks nm kw nn la no np nq nr bi translated">吸引-排斥行为</li><li id="b575" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la no np nq nr bi translated">基本形状</li><li id="fa1c" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la no np nq nr bi translated">盒子，六角形，布，绳子，布娃娃</li><li id="5b36" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la no np nq nr bi translated">布料撕裂</li><li id="d0bc" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la no np nq nr bi translated">排版和文本</li></ol><p id="c39e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用Verly.js，您只需15行代码就能制作出可撕裂的布料:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Verly.js行代码的可撕布</p></figure><p id="cac4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">演示:<a class="ae lr" href="https://anuraghazra.github.io/Verly.js/" rel="noopener ugc nofollow" target="_blank">https://anuraghazra.github.io/Verly.js/</a></p><p id="2258" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">源代码:<a class="ae lr" href="https://github.com/anuraghazra/Verly.js" rel="noopener ugc nofollow" target="_blank">https://github.com/anuraghazra/Verly.js</a></p><p id="5fe7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例子:<a class="ae lr" href="https://anuraghazra.github.io/Verly.js/examples" rel="noopener ugc nofollow" target="_blank">https://anuraghazra.github.io/Verly.js/examples</a></p><p id="a706" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">看看我前段时间创建的物理引擎中的一些例子。我几乎把所有东西都加进了那个引擎。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi of"><img src="../Images/d7e1f2890faab2710f0d42fcf1b2842d.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*alaeeMAe-pnmA08SKb2R4g.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">球形<a class="ae lr" href="https://anuraghazra.github.io/Verly.js/examples" rel="noopener ugc nofollow" target="_blank"> anuraghazra.github.io </a></p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi og"><img src="../Images/54802351dd2f8137ee8e5f4abb93e5e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*k13KJb85HxqbqTHvY994uw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">吸引排斥行为<a class="ae lr" href="https://anuraghazra.github.io/Verly.js/examples" rel="noopener ugc nofollow" target="_blank"> anuraghazra.github.io </a></p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/dc676450b63a9c5a81bd772d45743d30.png" data-original-src="https://miro.medium.com/v2/resize:fit:266/format:webp/1*MMj1DB0-6UXqAuZgyijlHw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">布娃娃<a class="ae lr" href="https://anuraghazra.github.io/Verly.js/examples" rel="noopener ugc nofollow" target="_blank"> anuraghazra.github.io </a></p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/8797923c19fa92368dfd50b759eea20f.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*NbJsaxITUjGfx8v8YdUb-Q.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><a class="ae lr" href="https://anuraghazra.github.io/Verly.js/examples" rel="noopener ugc nofollow" target="_blank"> anuraghazra.github.io </a></p></figure><p id="a834" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Codepen示例:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="od ny l"/></div></figure><p id="a129" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Verly.js的API因为是实体组件结构，所以易用灵活。</p><p id="a238" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读——我希望你学到了一些东西！</p></div><div class="ab cl oj ok hu ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="ij ik il im in"><p id="de04" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">其他了解Verlet物理的地方:</strong></p><ol class=""><li id="a24a" class="nj nk iq kh b ki kj kl km ko nl ks nm kw nn la no np nq nr bi translated"><a class="ae lr" href="https://www.youtube.com/watch?v=3HjO_RGIjCU" rel="noopener ugc nofollow" target="_blank"> Keith Peter的CodingMath Verlet物理视频</a>。</li><li id="e77c" class="nj nk iq kh b ki ns kl nt ko nu ks nv kw nw la no np nq nr bi translated">http://datagenetics.com/blog/july22018/index.html数据遗传<a class="ae lr" href="http://datagenetics.com/blog/july22018/index.html" rel="noopener ugc nofollow" target="_blank">的惊人文章</a></li></ol></div></div>    
</body>
</html>