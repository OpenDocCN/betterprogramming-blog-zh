<html>
<head>
<title>Write Elegant and Clean Logging Code in Spring Boot Using AOP Loggers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AOP Loggers在Spring Boot编写优雅简洁的日志代码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/write-elegant-and-clean-logging-code-in-spring-boot-using-aop-loggers-6e44fb2e7552?source=collection_archive---------5-----------------------#2021-11-15">https://betterprogramming.pub/write-elegant-and-clean-logging-code-in-spring-boot-using-aop-loggers-6e44fb2e7552?source=collection_archive---------5-----------------------#2021-11-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7b74" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">与其编写大量难以阅读的日志样板代码，不如在Spring Boot使用面向方面编程(AOP)</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5b4df241a265be592c1820aff6722c8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FA_NG4fwjUga1uYr"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9e06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我是<code class="fe ls lt lu lv b">Logger.debug</code>的忠实粉丝，我喜欢记录尽可能多的信息。另一方面，我也是<code class="fe ls lt lu lv b">DRY</code>和<code class="fe ls lt lu lv b">KISS </code>原则的严格追随者。当我看到代码中的重复时，我感到强烈的焦虑。结合这些激情并不容易。很难不重复地记录所有的事情。即使这是可能的，通常也会使你的代码难以阅读。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><p id="3c42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们假设你有这个除法。一切看起来简单易读。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="f5ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，您开始在它周围添加日志，以便您可以查看发生了什么。您记录收到的参数和返回值。您应该在整个代码中放置一个try/catch来记录异常。如果这是你所关心的，你可能想要记录消耗的时间。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="3451" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您意识到之前，您已经用大量非功能性代码扩展了您的单行代码。你的代码变得难以阅读。更糟糕的是，当你开始在代码的所有地方都这样做的时候。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><p id="98f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们应该使用Spring Boot的面向方面编程(AOP)来解决我们的日志横切关注点，而不是编写大量难以阅读的日志样板代码。AOP是Spring框架的核心组件之一。AOP提供了使用简单的可插拔配置在实际逻辑之前、之后甚至周围添加横切关注点的方法。它使得现在和将来维护代码变得容易。</p><p id="6d25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以很容易地找到许多指南，展示如何通过创建我们的定制注释和建议来实现AOP日志记录。因此，我将引入一个现成的库<code class="fe ls lt lu lv b">im-aop-loggers</code>来完成这项工作，而不是重复所有这些。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><p id="f5b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">im-aop-loggers</code>是一套方便且可配置的基于注释的Spring Boot记录器，它可以在正常或异常进入或退出时记录方法的每次执行，而无需您编写一行样板代码。</p><p id="5973" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Spring Boot项目中使用<code class="fe ls lt lu lv b">im-aop-loggers</code>的第一步是将依赖项添加到项目的pom.xml文件中。你可以在<a class="ae kv" href="https://search.maven.org/artifact/com.github.andylke/im-aop-loggers" rel="noopener ugc nofollow" target="_blank"> Maven中心库</a>找到<code class="fe ls lt lu lv b">im-aop-loggers</code>的最新版本。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="1412" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦有了项目设置，就可以开始向方法中添加AOP注释了。</p><p id="ea75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据您的需要，您可能只需要通过在您的方法上添加<code class="fe ls lt lu lv b">@LogBefore</code>注释来记录您的方法收到了什么。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="f3fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您还可以通过在方法上添加<code class="fe ls lt lu lv b">@LogAfterReturning</code>注释，选择只在方法正常退出时写日志。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="b857" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您也可以通过在方法上添加<code class="fe ls lt lu lv b">@LogAfterThrowing</code>注释，选择只在方法遇到异常时写日志。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="1367" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更好的是，在编写日志时，您可以通过在<code class="fe ls lt lu lv b">@LogAfterThrowing</code>注释上添加<code class="fe ls lt lu lv b">ignoreExceptions </code>属性来选择忽略某种类型的异常。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="7005" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于全面的日志记录，也就是您想要记录的所有内容，请使用<code class="fe ls lt lu lv b">@LogAround</code>注释。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="7cbb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过在<code class="fe ls lt lu lv b">@LogAround</code>注释上添加<code class="fe ls lt lu lv b">elapseTimeLimit </code>和<code class="fe ls lt lu lv b">elapseTimeUnit </code>属性，您还可以选择在您的方法花费了比预期持续时间更长的时间来完成时记录一条警告消息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="b35e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以从<a class="ae kv" href="https://github.com/andylke/im-aop-loggers-sample" rel="noopener ugc nofollow" target="_blank"> GitHub </a>下载示例源代码，并使用以下maven命令运行应用程序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="4d19" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您应该会在您的控制台中看到如下内容。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="cf5a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在<code class="fe ls lt lu lv b">application.properties</code>中为每个记录器配置默认日志级别和消息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="1db6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果出于某种原因，您需要禁用所有这些事件记录，您可以在<code class="fe ls lt lu lv b">application.properties</code>中将<code class="fe ls lt lu lv b">enabled</code>属性设置为<code class="fe ls lt lu lv b">false</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="77be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以参考<a class="ae kv" href="https://github.com/andylke/im-aop-loggers" rel="noopener ugc nofollow" target="_blank"> GitHub </a>获取关于<code class="fe ls lt lu lv b">im-aop-loggers</code>的更多文档。感谢阅读。希望你会发现这是有用的。</p></div></div>    
</body>
</html>