<html>
<head>
<title>Flash Messages in Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django的简讯</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/django-flash-messages-6afbccd1b457?source=collection_archive---------3-----------------------#2021-02-10">https://betterprogramming.pub/django-flash-messages-6afbccd1b457?source=collection_archive---------3-----------------------#2021-02-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="62f5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在Django中使用、格式化和淡化“flash”消息，包括页面重载和异步JavaScript提交</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c1036081c536027facf9cf7f8883e075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0gpUupsqNH55TDZx1cMMdg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="7622" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，您将了解到<a class="ae lu" href="https://docs.djangoproject.com/en/3.1/ref/contrib/messages/" rel="noopener ugc nofollow" target="_blank"> Django messages framework </a>是如何工作的，以及如何使用它的强大功能，包括在通过JavaScript提交表单时淡化消息而无需重新加载页面的方法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/f504d594e39ed8c88795f912a4723aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*krLEux0mGfDDJ5vQVXiT-Q.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者GIF。</p></figure><blockquote class="lw lx ly"><p id="e5eb" class="ky kz lz la b lb lc ju ld le lf jx lg ma li lj lk mb lm ln lo mc lq lr ls lt im bi translated">“Django为匿名和认证用户提供了对基于cookie和基于会话的消息传递的全面支持。messages框架允许您在一个请求中临时存储消息，并在随后的请求(通常是下一个请求)中检索消息以供显示。每条消息都标有确定其优先级的特定<code class="fe md me mf mg b"><strong class="la iu">level</strong></code>(例如<code class="fe md me mf mg b"><strong class="la iu">info</strong></code>、<code class="fe md me mf mg b"><strong class="la iu">warning</strong></code>或<code class="fe md me mf mg b"><strong class="la iu">error</strong></code>)— <a class="ae lu" href="https://docs.djangoproject.com/en/3.1/ref/contrib/messages/" rel="noopener ugc nofollow" target="_blank">姜戈的文件</a></p></blockquote><p id="e480" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lz">注意:这篇文章介绍了设置、视图、CSS、HTML以及一些JS脚本。它假设您对Django框架中这些文件之间的相互作用有基本的了解。</em></p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="01c5" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">消息级别</h1><p id="aba6" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">如文档中的<a class="ae lu" href="https://docs.djangoproject.com/en/3.1/ref/contrib/messages/" rel="noopener ugc nofollow" target="_blank">所述，“消息框架基于可配置的层次架构，类似于</a><a class="ae lu" href="https://medium.com/better-programming/write-better-python-scripts-ce58c1ebf690#a4e1" rel="noopener"> Python日志模块</a>。”它使用相同的级别。</p><pre class="kj kk kl km gt nl mg nm nn aw no bi"><span id="c80e" class="np mp it mg b gy nq nr l ns nt"><strong class="mg iu">DEBUG    </strong>Development-related messages (ignored in production)<br/><strong class="mg iu">INFO     </strong>Informational messages for the user<br/><strong class="mg iu">SUCCESS  </strong>An action was successful<br/><strong class="mg iu">WARNING  </strong>A failure did not occur but may be imminent<br/><strong class="mg iu">ERROR    </strong>An action was <strong class="mg iu">not</strong> successful or some other failure occurred</span></pre></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="aae6" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">设置</h1><p id="99cf" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">Django消息框架是通过中间件和上下文实现的。在你的<code class="fe md me mf mg b">INSTALLED_APPS</code>里，加上<code class="fe md me mf mg b">django.contrib.messages</code>。在中间件和模板中，将下面代码中的第8-22行添加到Django项目的<code class="fe md me mf mg b">settings.py</code>中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="286c" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">视图</h1><p id="831b" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">在您的<code class="fe md me mf mg b">views.py</code>中使用以下代码将消息添加到您的视图中:</p><pre class="kj kk kl km gt nl mg nm nn aw no bi"><span id="a16d" class="np mp it mg b gy nq nr l ns nt"><strong class="mg iu">from</strong> <strong class="mg iu">django.contrib</strong> <strong class="mg iu">import</strong> messages<br/>messages.add_message(request, messages.INFO, 'Hello world.')</span></pre><p id="de21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是一个例子。在第8行，当用户注销并被重定向到主页时，会向用户添加一条消息。这还表明消息在会话中工作，因此对经过身份验证和未经身份验证的用户都是如此。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="8967" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">HTML前端</h1><p id="e4d3" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">接下来是在你的网页上显示信息。我使用了一个<code class="fe md me mf mg b">base.html</code>文件，其中包含了我想在每个页面上显示的所有HTML部分，比如页眉、页脚和Django的flash messages等元素:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="67fe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">消息级别在<code class="fe md me mf mg b">messages.tags</code>属性中。我使用Bootstrap的HTML框架，其中Python层对应于<a class="ae lu" href="https://getbootstrap.com/docs/4.0/components/alerts/" rel="noopener ugc nofollow" target="_blank"> Bootstrap层</a>，这意味着我可以使用Bootstrap的能力格式化我的消息！成功消息为绿色，信息消息为蓝色，依此类推。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/011e5eafdd07be374ddccb11338b7b4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/1*yTTfycIdeTbiA3-Ln-201w.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者GIF。</p></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="a1b2" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">CSS样式</h1><p id="a961" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">消息可以显示在每个页面上。当显示消息时，我不希望我的内容移动。相反，它们应该被设计在右上角，与页面内容重叠，并在彼此之下显示后续消息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="c46d" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">JavaScript提交</h1><p id="908b" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">但是，当您想通过AJAX、jQuery或普通JavaScript使用异步提交提交内容并返回flash消息<em class="lz">而不</em>重新加载页面时，该怎么办呢？</p><p id="1f00" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，我使用包含快速消息的<code class="fe md me mf mg b">level</code>和<code class="fe md me mf mg b">content/text</code>的响应属性<code class="fe md me mf mg b">msg</code>。然后，我将这条消息附加到<code class="fe md me mf mg b">messages-list</code>(我的消息列表的ID，如<code class="fe md me mf mg b">messages.html</code>所示):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="f6bb" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">JavaScript褪色消息</h1><p id="9ba0" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">然后我调用一个定制函数<code class="fe md me mf mg b">fade_alerts()</code>,它类似于Django页面重新加载消息周期的正常褪色效果。这个自定义函数使用一些jQuery(由于Bootstrap，我加载了这个函数，但是也可以使用<a class="ae lu" href="https://stackoverflow.com/questions/29017379/how-to-make-fadeout-effect-with-pure-javascript" rel="noopener ugc nofollow" target="_blank"> vanilla JS </a>)淡出元素。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="4177" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">结论</h1><p id="63d1" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">本文向您展示了如何在传统的Django messages框架中使用flash消息，以及如何在异步表单提交中使用flash消息作为Django项目中用户操作的反馈。</p><p id="859b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">更多Django的技巧和窍门，请看下面我的其他文章。编码快乐！</p><div class="nx ny gp gr nz oa"><a href="https://medium.com/better-programming/custom-view-decorators-in-django-af50ea9b3994" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">如何在Django中使用定制视图@decorators</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">防止未经授权的用户访问视图，并使用@decorator方法提供反馈，例如RECAPTCHA…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">medium.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ks oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://medium.com/better-programming/distributed-task-queues-with-celery-rabbitmq-django-703c7857fc17" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">Django、RabbitMQ和Celery的分布式任务队列</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">了解用于发出异步API请求的分布式任务队列</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">medium.com</p></div></div><div class="oj l"><div class="op l ol om on oj oo ks oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://medium.com/javascript-in-plain-english/create-interactive-data-visualisations-with-django-chart-js-8c4d0b98770e" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">用Django &amp; Chart.js创建交互式数据可视化</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">如何用交互式图形可视化您的数据</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">medium.com</p></div></div><div class="oj l"><div class="oq l ol om on oj oo ks oa"/></div></div></a></div></div></div>    
</body>
</html>