<html>
<head>
<title>How to Schedule Django Commands on AWS Elastic Beanstalk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在AWS Elastic Beanstalk上调度Django命令</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-schedule-a-django-command-on-aws-elastic-beanstalk-21c237ee635b?source=collection_archive---------11-----------------------#2020-12-22">https://betterprogramming.pub/how-to-schedule-a-django-command-on-aws-elastic-beanstalk-21c237ee635b?source=collection_archive---------11-----------------------#2020-12-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="50f9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用cron作业在AWS EBS上运行Django命令的最新指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4d398cae885fe5d3c6586966a6cd9d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yKjEkBTdTbPEtTFgeYO5xw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="1564" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最近，我希望每小时运行一次脚本，这也需要我的<a class="ae lu" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>应用上下文。虽然我确实找到了一些在线指南，但它们要么已经过时，要么不够全面，而且与最近<a class="ae lu" href="https://aws.amazon.com/elasticbeanstalk/" rel="noopener ugc nofollow" target="_blank">AWS Elastic Beanstalk</a>(EBS)的变化不一致。</p><p id="bd3f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">EBS允许我们以无缝和可管理的方式运行Django等web应用程序。这也意味着我们不应该在当前随机分配的EC2实例上设置任何本地cron作业。相反，我们是在我们的EBS环境中进行的。</p><p id="18bf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本指南中，我将概述如何定义Django命令、创建EBS配置文件，以及部署和测试新创建的调度脚本。</p><p id="7773" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设我们的脚本叫做<code class="fe lv lw lx ly b">update_emails.py</code>，它的目的是每天为一个特定的Gmail账户获取新邮件。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="bd75" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">姜戈指挥部</h1><p id="9ee1" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">首先，让我们创建Django命令。</p><ol class=""><li id="c82e" class="nd ne it la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">(可选)如果您还没有一个<code class="fe lv lw lx ly b">commands</code>目录，您需要创建一个。在您的项目中，在您选择的Django应用程序下，创建一个<code class="fe lv lw lx ly b">management</code>目录，然后创建一个<code class="fe lv lw lx ly b">commands</code>目录。确保它们被初始化为包目录(即它们有<code class="fe lv lw lx ly b">__init_.py</code>文件)。关于自定义<code class="fe lv lw lx ly b">manage.py</code>命令的更多信息可在文档中找到<a class="ae lu" href="https://docs.djangoproject.com/en/3.1/howto/custom-management-commands/" rel="noopener ugc nofollow" target="_blank">。</a></li></ol><p id="1107" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您的目录树应该如下所示:</p><pre class="kj kk kl km gt nm ly nn no aw np bi"><span id="e532" class="nq mh it ly b gy nr ns l nt nu">├── your_app<br/>│   ├── __init__.py<br/>│   ├── management<br/>│   │   ├── __init__.py<br/>│   │   └── commands<br/>│   │       └── __init__.py<br/>...</span></pre><p id="5756" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.在<code class="fe lv lw lx ly b">commands</code>目录下，创建一个名为<code class="fe lv lw lx ly b">fetch_emails.py</code>的新文件，并对其进行编辑，使其包含您的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="d5c6" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">弹性Beanstalk配置文件</h1><p id="d51b" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">现在我们已经准备好了自定义的Django命令，我们需要请求EBS定期运行它(例如，每天一次)。</p><p id="33bd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在您的根项目目录中，在<code class="fe lv lw lx ly b">.ebextensions</code>目录中，创建一个新的配置文件。确保其名称符合<a class="ae lu" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/ebextensions.html" rel="noopener ugc nofollow" target="_blank"> EBS惯例</a>。给我们的取名<code class="fe lv lw lx ly b">fetch_emails_cron.config</code>吧。</p><p id="b4e0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，编辑<code class="fe lv lw lx ly b">fetch_emails_cron.config</code>，使其包含以下脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="f8fe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"><em class="nx">2022年9月更新— </em> </strong> <em class="nx">参考</em> <a class="ae lu" href="https://stackoverflow.com/questions/19997343/run-manage-py-from-aws-eb-linux-instance/64599849#64599849" rel="noopener ugc nofollow" target="_blank"> <em class="nx">这个StackOverflow线程</em> </a> <em class="nx">更新的环境和app路径如果你用的是Python 3(感谢callout @</em><a class="ae lu" href="https://medium.com/@littleoduozu?source=user_profile-------------------------------------" rel="noopener">emmazarusu</a>)<em class="nx">。</em></p><p id="8fcd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的脚本首先创建两个文件，然后运行一个命令。这两个文件是:</p><ol class=""><li id="26a9" class="nd ne it la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">这是运行Django命令的bash文件。在它的内容中，您可以看到我们正在激活我们的本地虚拟环境，其中包括我们的Django上下文和已安装的包，然后运行我们的自定义Django命令。</li><li id="2636" class="nd ne it la b lb ny le nz lh oa ll ob lp oc lt ni nj nk nl bi translated"><code class="fe lv lw lx ly b">fetch_emails_cron</code> —这实际上不是一个文件，而是一个cron作业，它将在每天上午12点运行我们新创建的bash文件，正如我们在上面的EBS配置文件中指定的<code class="fe lv lw lx ly b">0 0 * * * </code>。如果你需要不同的时间表，你可以使用crontab Guru。</li></ol><p id="153e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后一个<code class="fe lv lw lx ly b">rm_old_cron</code>命令是删除我们cron作业的任何旧版本，这发生在每次向EBS部署新版本时。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="884b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">部署和测试</h1><p id="2fc5" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">如果你已经安装了<a class="ae lu" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3.html" rel="noopener ugc nofollow" target="_blank"> EB CLI </a>，你可以简单地运行<code class="fe lv lw lx ly b">eb deploy</code>。一旦完成，运行<code class="fe lv lw lx ly b">eb ssh</code>。这将建立一个到您的EB环境的SSH连接，以便您可以检查您的cron作业是否已经成功安装。</p><p id="1c72" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，在SSH终端中，运行<code class="fe lv lw lx ly b">ls /etc/cron.d/fetch_emails_cron</code>并确保cron作业确实存在。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="fd9b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="bc9d" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">就是这样。您已经成功地设置了Django命令，以便在您的EBS环境中重复运行。</p></div></div>    
</body>
</html>