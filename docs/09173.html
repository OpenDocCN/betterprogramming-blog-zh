<html>
<head>
<title>How To Mine the Blockchain in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何挖掘Java中的区块链</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-mine-the-blockchain-in-java-9647de36a8fc?source=collection_archive---------8-----------------------#2021-07-22">https://betterprogramming.pub/how-to-mine-the-blockchain-in-java-9647de36a8fc?source=collection_archive---------8-----------------------#2021-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3e32" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">面向用户和矿工的Java实现</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d441eb1556b6e5bb18f0fefa821e4104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ulvQ-o5zhR_9mryv"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">詹姆斯·柯文在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="54a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">加密货币开采可能是一个误称，并导致对矿工所做的一些误解。采矿通常会让人联想到开采某种东西的画面，但在加密货币采矿中，矿工们正在建造区块链，并为此获得报酬。矿工们争先恐后地收集所有新交易，将它们放在一个区块中，并提供一些人工工作证明。</p><p id="dfbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我关于区块链的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/the-blockchain-explained-with-a-java-implementation-27b74d478223">系列</a>的第三部分，也是最后一部分，我将在其中实现我的Java服务集合的用户和矿工。我已经完成了部分采矿工作，因为没有矿工的参与，就不可能有一个区块链。但是我还没有创建一个用户来添加在链的块中使用的地址，以识别合同中涉及的各方。矿工也是用户，因为他们需要一个地址来接收他们工作的积分。</p><p id="0e9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个项目的最终结果是一个脆弱的区块链，因为没有具体的价值交换，我们不需要确保所有东西都加起来。矿工们在维护区块链的工作中唯一得到的是好的业力。</p><p id="b6cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于像比特币这样的加密货币，我们需要找到一个地址的所有未用完的输出交易，以确保它们足以支付输入交易中交换的金额。我们还向矿商支付费用，并为他们能添加到区块链的每个区块支付一定数量的比特币。我们的区块链更像是一种以可验证的方式进行通信的方式，尽管它具有加密发生的某些方面，如输入和输出事务。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c1e9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建用户</h1><p id="03f2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们从为用户和矿工做一个新的服务开始。它将是区块链和节点的其他两个服务的副本，但是我们将添加一个新的控制器、服务和模型。因为矿工是用户(也就是说，他们需要一个地址来包含在交易中)，我们将从用户开始。让我们创建一个端点来添加、列出和获取用户信息。我将对<code class="fe mz na nb nc b">list</code>和<code class="fe mz na nb nc b">get</code>端点使用基本认证。<code class="fe mz na nb nc b">add</code>端点将是开放的，因为任何人都可以创建用户。</p><p id="7d51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我想演示某种级别的身份验证，但我不想陷入真正的身份验证系统的细节中。因此，为了模拟检查，用户名和密码必须相同，用于列出所有用户的特殊用户必须命名为admin。如果启动时不存在admin用户，我也会立即创建它。</p><p id="ec92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是我对控制器的要求:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="4b0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这项服务非常简单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a9f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe mz na nb nc b">application.yaml</code>设置MongoDB的参数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="056b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您可以使用<code class="fe mz na nb nc b">docker-compose.yaml</code>文件启动MongoDB并测试新的端点。您应该能够在系统中添加和列出用户。只要记住使用基本认证。重要的是要记住，基本身份验证使用用户名，而端点使用ID进行更有效的搜索。</p><p id="8d3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户除了ID和名字还有什么？在加密货币系统中，我们认为用户有一个钱包。钱包是一个地址和一个私钥/公钥对。在我们的系统中，我们将把它们放在一起，这样一个用户只能有一个“钱包”(即地址和私钥/公钥对)。这样，用户就可以创建事务。我们不能使用ID作为地址，因为每个用户都连接到一个节点，并且ID在节点之间不是唯一的。所以我们用UUID作为地址。那么就只需要创建私有/公共密钥对了。下面是更新后的<code class="fe mz na nb nc b">UserService.addUser</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="6ec9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们不想公开<code class="fe mz na nb nc b">privateKey</code>，我们将把这一行添加到<code class="fe mz na nb nc b">UserController</code>中任何返回用户或用户列表的链中:</p><pre class="kj kk kl km gt nf nc ng nh aw ni bi"><span id="85b5" class="nj md it nc b gy nk nl l nm nn">.doOnNext(u -&gt; u.setPrivateKey(null));</span></pre><p id="6253" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们准备代表用户创建一个事务。</p><p id="4bad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在区块链服务中有一个基本的事务创建端点，因此我们将删除它。我们将保留添加事务端点，我们可以从用户服务中的新端点调用它。控制器中的新端点如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5caa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">UserService</code>类中的新方法如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="bda8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到，我们获取了数据库中编码的私钥，并使用它来签署输入合同。就像我们创建了<code class="fe mz na nb nc b">withHash</code>方法一样，我们创建了<code class="fe mz na nb nc b">withSignature</code>方法，因为必须在应用数据后计算签名。我们懒得检查输出地址，因为地址没有唯一的真实来源。一些加密货币使用一些特定的地址格式来帮助防止将硬币交给不存在的地址，但没有办法确保你不会将硬币发送到众所周知的比特桶。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="addd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建矿工</h1><p id="8651" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这实际上比创建用户更容易，因为矿工是一个有能力创建块的用户。区块链服务已经创建了一个块，我们可以间接调用它。我们唯一需要的是地址，地址是用户的一部分。所以让我们给<code class="fe mz na nb nc b">UserController</code>添加一个新的端点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="93d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于矿工只是一个用户，我们可以使用相同的代码来认证它。我们不担心授权。每个人都有相同的授权级别。接下来，我们需要给<code class="fe mz na nb nc b">UserService</code>添加一个<code class="fe mz na nb nc b">createBlock</code>方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="0dc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以使用现有的端点来创建新的块，这样就完成了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3d89" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="de47" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">唷。把所有的碎片整理出来需要做大量的工作。在前三篇文章中，我们创建了一个基本的区块链，一个让所有人保持同步的对等网络，以及控制整个事情的用户/矿工。它可能需要很好的重构和一些集成类型的测试来运行所有不同的场景，但现在，我对拥有一个完整的服务系统感到满意，这些服务可以一起工作。</p><p id="d8bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在我的GitHub页面上找到所有代码:</p><div class="no np gp gr nq nr"><a href="https://github.com/rkamradt/blockchain/tree/v0.3" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">GitHub-rkamradt/区块链0.3版</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">yabc。在GitHub上创建一个帐户，为rkamradt/区块链的发展做出贡献。</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">github.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of ks nr"/></div></div></a></div><p id="e141" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是本系列的其他文章:</p><div class="no np gp gr nq nr"><a rel="noopener  ugc nofollow" target="_blank" href="/the-blockchain-explained-with-a-java-implementation-27b74d478223"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">如果你想了解区块链，请看这个Java实现</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">解放区块链</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">better编程. pub</p></div></div><div class="oa l"><div class="og l oc od oe oa of ks nr"/></div></div></a></div><div class="no np gp gr nq nr"><a rel="noopener  ugc nofollow" target="_blank" href="/build-a-set-of-blockchains-using-java-d99cd866931b"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">用Java建立一套区块链</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">通过对等网络建立信任</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">better编程. pub</p></div></div><div class="oa l"><div class="oh l oc od oe oa of ks nr"/></div></div></a></div></div></div>    
</body>
</html>