<html>
<head>
<title>How To Use Nullable Types Correctly in Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Kotlin中正确使用可空类型</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-nullable-types-correctly-in-kotlin-42ca3443eb85?source=collection_archive---------7-----------------------#2021-11-22">https://betterprogramming.pub/how-to-use-nullable-types-correctly-in-kotlin-42ca3443eb85?source=collection_archive---------7-----------------------#2021-11-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5f2b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解处理空元素的不同机制</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d95b6da778baf148daf0914c6483fe7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kdqUKNCP2wglJyMh"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">迈克尔·泽兹奇在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="4bf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用Java编写代码最烦人的一点是处理空元素。为了让我们的代码空安全，不得不到处设置空检查条件，这可能是我们大多数人经常遇到的事情。</p><p id="7940" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Kotlin提供了不同的机制来帮助解决这个问题。让我们先过一遍。</p><h1 id="2ac5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">不可为空的类型</h1><p id="900b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">默认情况下，Kotlin类型是不可空的，这意味着不可能给它们赋值null。这绝对是避免在我们的语言中处理空值的最好方法；虽然这总是可能的吗？</p><p id="2f46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不总是这样，我们的服务中可能会有一个<code class="fe ms mt mu mv b">findEmployee</code>方法，我们希望通过使用可空类型来表达找不到雇员的可能性。</p><p id="6d89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们以我们在<a class="ae ky" href="https://theboreddev.com/kotlins-either-bye-bye-exceptions/" rel="noopener ugc nofollow" target="_blank">上一篇Kotlin文章中使用的关于</a>的例子为例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="9584" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以稍微修改一下，以包括找不到雇员的可能性；为了实现这一点，我们将使用可空类型。我们也可以为此使用一个<code class="fe ms mt mu mv b">Problem</code>,但这将取决于您是否希望将其表示为有效的业务案例或例外案例。在我们的例子中，我们选择使用可空类型。那么它会是什么样子呢？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="ec4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所看到的，我们已经将404 (NOT_FOUND)响应映射到一个空的<code class="fe ms mt mu mv b">Employee</code>,作为可空的<code class="fe ms mt mu mv b">Employee</code>响应。</p><p id="f35b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如何从客户端处理这个问题？让我们快速浏览一下。</p><h1 id="110d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">处理可空类型</h1><p id="ea96" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Kotlin初学者倾向于做的一件事是，每当需要解决可空类型和不可空类型之间的编译问题时，使用<code class="fe ms mt mu mv b">!!</code>操作符。这是一个很大的错误，应该避免；如果实例为空,<code class="fe ms mt mu mv b">!!</code>将抛出一个<code class="fe ms mt mu mv b">NullPointerException</code>。<strong class="lb iu">根据经验，除非非常必要，否则总是避免使用</strong> <code class="fe ms mt mu mv b"><strong class="lb iu">!!</strong></code> <strong class="lb iu">操作符。</strong></p><p id="09ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们以我们的<code class="fe ms mt mu mv b">PayrollService</code>为例，我们可以这样举例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="0027" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很简单，但不幸的是，当我们的雇员为空时，它会引发一个<code class="fe ms mt mu mv b">NullPointerException</code>；如果你想抓住它，然后用它做其他事情，请不要！</p><p id="d323" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，我们怎样才能避免使用<code class="fe ms mt mu mv b">!!</code>操作符呢？让我们看看还有什么别的选择。</p><h1 id="7cef" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">无效支票</h1><p id="1578" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">其中一个选项当然是用一个<code class="fe ms mt mu mv b">if</code>条件检查实例是否为空。<code class="fe ms mt mu mv b">If</code>检查有点冗长，而且会严重污染我们的代码。我们可以以我们的<code class="fe ms mt mu mv b">PayrollService</code>为例，看看所有这些选项看起来会是什么样子；一旦我们引入空检查，它将会是这样的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="ae10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然这个选项是一个不错的处理方式，但是使用if条件的一个问题是，仅仅做一个非常简单的检查就需要多行代码，这最终会在多个地方污染我们的代码。在我们的例子中，这可能不是很明显，但是如果我们只想记录一个字段呢？我们必须在logger语句中嵌入一个完整的if条件，或者在调用它之前做一些检查。所以理想情况下，我们需要更简洁的东西，以便能够在一行程序中使用它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/4565b0b2d3cd048727e2b099cea98b18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qlzeBX-o5n8VsNgO.jpg"/></div></div></figure><p id="599c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">空检查的另一个问题是，它不是一个原子操作，所以在我们处理可变实例的情况下，由于值在空检查后立即改变，我们可能会陷入大问题。</p><p id="3628" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用更简洁的<code class="fe ms mt mu mv b">if</code>条件，尽管这也不理想，也不能解决空支票带来的一些问题。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="cf29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看在科特林还能做些什么。</p><h1 id="c132" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">安全通话</h1><p id="48ec" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Kotlin提供的一个好工具是安全调用。我们可以通过使用操作<strong class="lb iu">来使用安全调用？。</strong>；这将安全地访问空实例或其属性。我们还可以通过使用<a class="ae ky" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/let.html" rel="noopener ugc nofollow" target="_blank"> let方法</a>对实例执行任何操作来对实例应用操作。</p><p id="82b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值得一提的是，如果实例为null，安全调用将返回null。例如，如果employee实例为null，那么<code class="fe ms mt mu mv b">employee?.name</code>将“安全地”返回null，而不是引发<code class="fe ms mt mu mv b">NullPointerException</code>。</p><p id="ffd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，假设我们想在一个日志语句中记录雇员姓名。我们可以很容易地做到这一点，如下所示；在我们的员工为空的情况下，<code class="fe ms mt mu mv b">null</code>将被打印在我们的日志中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="a3c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就引出了下一个问题；如果我们想在日志中为员工姓名提供一个默认值，该怎么办？</p><h1 id="5e20" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Elvis操作员</h1><p id="a004" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><a class="ae ky" href="https://kotlinlang.org/docs/null-safety.html#elvis-operator" rel="noopener ugc nofollow" target="_blank"> elvis运算符</a>允许我们定义一个不可为空的值，以便在左侧返回空值的情况下使用。</p><p id="9750" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，在中，我们想在日志语句中定义一个默认值，我们可以这样做:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="1429" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这么简单！</p><p id="ca46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在知道了我们所学的一切，从我们的<code class="fe ms mt mu mv b">PayrollService</code>中处理可空类型的最好方法是什么？</p><h1 id="81d9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">把所有的放在一起</h1><p id="f41f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有了所有的选项，我们现在有了一个干净、简洁、安全和富有表现力的方法来处理一个可空的<code class="fe ms mt mu mv b">Employee</code>类型，可能是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="42f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那看起来简洁干净；可能会有一些反对它的论点，因为它不是“人类可读的”，但我可以保证，一旦你习惯了使用安全调用和<code class="fe ms mt mu mv b">let</code>方法，你会毫不费力地阅读它。</p><p id="085b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样值得一提的是，如果您正在处理可变变量(这是我不推荐的)，使用<code class="fe ms mt mu mv b">let</code>比使用<code class="fe ms mt mu mv b">if</code>条件更安全。这是因为在<code class="fe ms mt mu mv b">let</code>方法中传递给lambda的值不会改变，即使原始变量改变了它的值；这将使你的街区在这种特殊情况下更加安全。</p><h1 id="8bdc" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="d1cb" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Kotlin 对Java因其引发的所有问题而备受批评的领域之一进行了重大改进。像<a class="ae ky" href="https://en.wikipedia.org/wiki/Tony_Hoare" rel="noopener ugc nofollow" target="_blank">东尼·霍尔</a>这样的人甚至已经首先为发明<em class="mz"> null </em>道歉，所以我们不是在讨论一个微不足道的问题；由于各种原因，这在许多语言中都是昂贵而痛苦的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/6a14aa2ae771090b6b6b1bf40fbb3d81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ekHYN8mIWabaiwmi.jpg"/></div></div></figure><p id="fbfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">暂时就这样吧！我们希望你这次真的喜欢并学到了有用的东西！最后一件事，如果你觉得你需要提高你的科特林知识，需要一本好书，我们建议看看<a class="ae ky" href="https://geni.us/f4BI" rel="noopener ugc nofollow" target="_blank">科特林在行动</a>或<a class="ae ky" href="https://geni.us/VumcB" rel="noopener ugc nofollow" target="_blank">头先科特林</a>。我们认为这些是开始学习Kotlin的好资源，并对用它编写应用程序有了基本的了解。</p><p id="1ea4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读我们，如果你喜欢我们的内容，请订阅！</p></div></div>    
</body>
</html>