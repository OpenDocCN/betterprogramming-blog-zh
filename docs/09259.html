<html>
<head>
<title>How To Replace GIFs With Videos Using Sanity And Gatsby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Sanity和Gatsby将gif替换为视频</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-replace-gifs-with-videos-using-sanity-and-gatsby-f4502424b841?source=collection_archive---------11-----------------------#2021-08-03">https://betterprogramming.pub/how-to-replace-gifs-with-videos-using-sanity-and-gatsby-f4502424b841?source=collection_archive---------11-----------------------#2021-08-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5daa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在web应用程序中渲染动画</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c60161f727877139999767ac8ed86733.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zryltAwz7tohTVJLP3vJBQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">插图由<a class="ae ky" href="https://undraw.co/illustrations" rel="noopener ugc nofollow" target="_blank"> unDraw </a></p></figure><p id="44f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GIF ( <code class="fe lv lw lx ly b">.gif</code>)图像文件格式是一种非常古老的动画图像格式(<a class="ae ky" href="https://www.w3.org/Graphics/GIF/spec-gif89a.txt" rel="noopener ugc nofollow" target="_blank">1989年的最新版本</a>)，随着模因、在线聊天和论坛的大量使用，这种格式得到了广泛使用。</p><p id="0aa4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然你可以通过混合连续的静止图像帧来创建GIF图像，但是大部分的GIF图像都是从视频格式转换而来的，以便在网络上使用。这很讽刺。</p><p id="1f6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的观点是，你最好将那段视频<em class="lz">静音</em>并让它<em class="lz">循环播放</em>和<em class="lz">自动播放</em>(稍后会详细介绍)，而不必将其转换成GIF。那样的话，你可以节省几百千字节！由于压缩算法的原因，GIF图像和视频之间的文件大小差异很大(这里我就不详细介绍了)。但是，这里有一个来自我创建的<a class="ae ky" href="https://gif2video.com/" rel="noopener ugc nofollow" target="_blank">转换工具</a>的例子来证明我的观点:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ma"><img src="../Images/503060163f3cb8af98bfa928ef0e11ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kGkmer7j6jAPpEAm.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原始GIF图像(316 KB)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/521b802d5cf9d009840720848b5c9453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*z-5y8BBASwgurOu6.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">已转换的视频文件(WebM = 111 KB)</p></figure><p id="b8c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然Sanity还不支持将GIF图像转换为视频格式，但它目前支持两种类型的资源——各种<a class="ae ky" href="https://www.sanity.io/docs/file-type" rel="noopener ugc nofollow" target="_blank">文件格式</a>,您可以使用它们来呈现视频，以代替沉重的GIF图像。</p><p id="9d2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，您将无法重用您的图像模式来在同一个组件中上传图像和视频。在本文的后面，我们将讨论如何在Sanity studio中建立一个简单的上传视频组件的模式，以及如何在Gatsby web应用程序中呈现它们。</p><h2 id="1093" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">限制</h2><p id="cba5" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">所以，在我们继续之前，总结一下我的方法的一些局限性:</p><ol class=""><li id="39e0" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">Sanity的API还没有gif到视频的转换</li><li id="3d53" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">Sanity的API还没有提供mp4到webm的转换</li><li id="fde6" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">需要在Sanity Studio中使用一个单独的组件来向块内容添加视频动画</li></ol><p id="2f64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我可以接受上面的第三点。当然，我的主要问题是整个GIF和视频转换部分，这还不像Sanity的图像转换功能那么容易。我希望他们能尽快添加这一功能，因为这将节省时间，但最重要的是，它可能会推动更多的人采用这种方法，使网络更快，更少的数据饥渴。</p><h2 id="826c" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">理智+盖茨比中的视频动画</h2><p id="f71d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">对于这种方法的实施，让我们把它看作是一个由三部分组成的过程:</p><ol class=""><li id="0b00" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">在Sanity Studio中为新的视频动画组件创建模式</li><li id="9c06" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">渲染来自盖茨比内部的Sanity的API的视频</li><li id="4409" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">(可选)惰性加载盖茨比中的视频动画</li></ol><p id="0fc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>所谓的“<em class="lz">视频动画，</em>”我指的是以与GIF动画相同的方式观看的视频——静音、循环播放和自动播放——但它有一种视频格式，例如<code class="fe lv lw lx ly b"><em class="lz">mp4</em></code>、<code class="fe lv lw lx ly b"><em class="lz">webm</em></code>。</p><p id="28e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好吧，那我们就开门见山吧！</p><h1 id="760e" class="no md it bd me np nq nr mh ns nt nu mk jz nv ka mn kc nw kd mq kf nx kg mt ny bi translated">步骤Sanity Studio中的视频模式</h1><p id="f6a2" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在我们的Sanity studio项目中的<code class="fe lv lw lx ly b">studio/shemas/</code>目录下(或者你保存模式的任何地方),我们将创建一个新的文件来描述新的视频动画模式:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="aa87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">最佳实践:</strong><code class="fe lv lw lx ly b"><em class="lz">aspectratio</em></code>字段对于本文来说当然是可选的，但是如果您有兴趣为您的用户节省一些<a class="ae ky" href="https://web.dev/aspect-ratio/#example:-preventing-layout-shift" rel="noopener ugc nofollow" target="_blank">布局变化</a>，尤其是(但不仅仅是)如果您计划添加延迟加载，这是一个不错的选择。</p><p id="9cea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，如果您想在Sanity Studio中为您上传的视频添加预览，您可以在下面添加这些行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="448f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在为我们的新视频动画组件创建模式之后，不要忘记将它和所有其他定制模式一起包含在<code class="fe lv lw lx ly b">createSchema</code>方法中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="f3d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，将<code class="fe lv lw lx ly b">videoAnimation</code>类型作为一个选项包含在您的博客帖子或任何其他内容中。在我的例子中，我已经在我用来写文章的<code class="fe lv lw lx ly b">blockContent</code>组件中添加了这个选项:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/d5701b1ad1f9b24b4cf6e1a2d1c041c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wep7wvPM8PRvmNwHI41Xyw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Sanity Studio演示</p></figure><h1 id="3f8f" class="no md it bd me np nq nr mh ns nt nu mk jz nv ka mn kc nw kd mq kf nx kg mt ny bi translated">步骤2:渲染视频动画</h1><p id="a019" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在这一步，我们将在Gatsby中添加一些逻辑，以便我们渲染来自Sanity的CMS的每个视频动画。</p><p id="5879" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们创建一个视频动画组件，它将包含上述所有字段(<code class="fe lv lw lx ly b">webm</code>、<code class="fe lv lw lx ly b">fallback</code>、<code class="fe lv lw lx ly b">caption</code>、<code class="fe lv lw lx ly b">alt</code>等)。)作为我们盖茨比项目的道具:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="7d03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">提示:</strong>如果你对<code class="fe lv lw lx ly b"><em class="lz">getPaddingFromAspectRatio</em></code> util函数感兴趣，你可以在这里找到<a class="ae ky" href="https://www.charistheo.io/blog/2021/06/prevent-image-layout-shifts-in-sanity-gatsby/#step-3--calculate--padding" rel="noopener ugc nofollow" target="_blank">代码和逻辑</a>。</p><p id="b354" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在您的Sanity <a class="ae ky" href="https://github.com/sanity-io/block-content-to-react#usage" rel="noopener ugc nofollow" target="_blank">块内容序列化器</a>中，为在Sanity块内容中找到的每个<code class="fe lv lw lx ly b">videoAnimation</code>包含这个<code class="fe lv lw lx ly b">VideoAnimation</code>组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="ca39" class="no md it bd me np nq nr mh ns nt nu mk jz nv ka mn kc nw kd mq kf nx kg mt ny bi translated">步骤3:延迟加载视频动画</h1><p id="83a0" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">好吧，如果你做到了这一步，拍拍自己的背，我知道这可能是一个乏味的过程，有很多事情可能会出错。</p><p id="c076" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不过这最后一部分应该是最简单、最省事的。总而言之，为了让视频延迟加载正常工作，我们需要做以下更改:</p><ol class=""><li id="8525" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">运行<code class="fe lv lw lx ly b">npm i lozad</code>安装<code class="fe lv lw lx ly b"><a class="ae ky" href="https://github.com/ApoorvSaxena/lozad.js#example-with-video" rel="noopener ugc nofollow" target="_blank">lozad</a></code> <a class="ae ky" href="https://github.com/ApoorvSaxena/lozad.js#example-with-video" rel="noopener ugc nofollow" target="_blank"> npm包</a></li><li id="8b18" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">初始化<code class="fe lv lw lx ly b">useEffect</code>挂钩内的<code class="fe lv lw lx ly b">lozad</code>(第3-11行)</li><li id="42e2" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">将<code class="fe lv lw lx ly b">lozad</code> CSS类添加到<code class="fe lv lw lx ly b">&lt;video&gt;</code> HTML元素(第19行)</li><li id="390b" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">将<code class="fe lv lw lx ly b">src</code>属性重命名为<code class="fe lv lw lx ly b">data-src</code>(第21和22行)</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="813b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！你现在应该为你的用户少提供几百kb的服务，并且拥有一个比以前快得多的网站。</p><p id="b1c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你被困在某个地方，请随时联系LinkedIn或Twitter，看看我是否能以某种方式帮助你。对于现场最终产品，只需检查<a class="ae ky" href="https://www.charistheo.io/blog/2021/07/replace-gif-with-video-in-sanity-gatsby/" rel="noopener ugc nofollow" target="_blank">这一页</a>。</p><h1 id="c042" class="no md it bd me np nq nr mh ns nt nu mk jz nv ka mn kc nw kd mq kf nx kg mt ny bi translated">进一步阅读</h1><ul class=""><li id="1f10" class="na nb it lb b lc mv lf mw li oc lm od lq oe lu of ng nh ni bi translated"><a class="ae ky" href="https://web.dev/lazy-loading-video/" rel="noopener ugc nofollow" target="_blank">懒人加载视频</a> — web.dev</li><li id="3bb4" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu of ng nh ni bi translated"><a class="ae ky" href="https://web.dev/efficient-animated-content/" rel="noopener ugc nofollow" target="_blank">为动画内容使用视频格式</a> — web.dev</li><li id="3361" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu of ng nh ni bi translated"><a class="ae ky" href="https://web.dev/replace-gifs-with-videos/" rel="noopener ugc nofollow" target="_blank">用视频替换gif以加快页面加载速度</a> — web.dev</li></ul></div></div>    
</body>
</html>