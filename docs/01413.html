<html>
<head>
<title>Helm 3: Fun With the New Beta</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">头盔3:新测试版的乐趣</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/helm-3-fun-with-the-new-beta-8f91c70891ff?source=collection_archive---------4-----------------------#2019-09-07">https://betterprogramming.pub/helm-3-fun-with-the-new-beta-8f91c70891ff?source=collection_archive---------4-----------------------#2019-09-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4d92" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更干净、更简单、更安全，拥有您喜爱的先前功能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5c9d7a5f9fbcffb8ea7da84457483186.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jMd66ZJOa9-D_O1KG3nc6w.jpeg"/></div></div></figure><p id="b706" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一名Kubernetes 训练师首先把我的注意力带到了<a class="ae lq" href="https://github.com/helm/community/blob/master/helm-v3/000-helm-v3.md" rel="noopener ugc nofollow" target="_blank">头盔3 </a>。当时，人们对此知之甚少。以下是我所看到的:</p><ul class=""><li id="6636" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">不再有<a class="ae lq" href="https://github.com/helm/helm/tree/master/cmd/tiller" rel="noopener ugc nofollow" target="_blank">舵柄</a></li><li id="818a" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">Lua模板将和Go模板一起被引入</li></ul><p id="2c5c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我承认，当我看到Lua模板的样子时，我并不高兴。它似乎离我们试图模仿的最初的<a class="ae lq" href="https://yaml.org/" rel="noopener ugc nofollow" target="_blank"> YAML </a>更远了。至少在第一种情况下，Go模板仍然会得到支持，这让我们松了一口气。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="9f8e" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">但是现在，Helm 3 Beta出来了！</h1><p id="1836" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">而且比原来的目标瘦了一点。我将首先关注我们需要理解的东西，然后我将讨论丢失Lua模板的奇怪情况。</p><h2 id="c016" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">舵柄坏了</h2><p id="5c1c" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">是的，他们兑现了承诺。Tiller带来了一些严重的安全风险，并使Helm的安装复杂化。因此，现在一切都发生在客户端。使用客户端凭据直接从客户端计算机运行安装。这意味着您的集群中不需要上帝级别的服务帐户。</p><p id="f470" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这影响了功能。举个例子，从舵2发出的<code class="fe nv nw nx ny b">helm list</code>命令。输出如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/130d22fab8def1050ca0c854a51c3152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k7YkXsyeJg_tzvfDMC6e6Q.png"/></div></div></figure><p id="37f3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在头盔3中，柱子有些变化。应用版本不再列出，名称空间显示在名称旁边:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/f1df0d36e4383be275c7c05e8756be37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qmms870Inrn-XUHlBaet7Q.png"/></div></div></figure><p id="d778" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">他们为什么移动名称空间列，应用程序版本发生了什么变化？</p><h2 id="272d" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">App版本很简单</h2><p id="1a47" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">它还在那里。只需运行<code class="fe nv nw nx ny b">helm history &lt;my release&gt;</code>就可以看到合适的应用程序版本。</p><h2 id="55a8" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">名称空间现在更重要了</h2><p id="65d7" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">最初，针对Tiller存储一个释放。如果您有一个Tiller实例在运行，这意味着一个发布名称在集群中是惟一的。<code class="fe nv nw nx ny b">mariadb</code>只是指<code class="fe nv nw nx ny b">mariadb</code>的一个版本，而不是另一个版本。</p><p id="4944" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在头盔3中，随着舵杆的移除，这个功能已经消失了。相反，版本作为<code class="fe nv nw nx ny b">Secret</code>资源存储在安装版本的名称空间中。您可以通过在您的发布名称空间中运行<code class="fe nv nw nx ny b">kubectl get secret</code>来查看这一点。您会看到类似这样的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/e6aff65132a534a0f8a53140c540d5ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NUcZeyW-xEXS7y3LfJJlwg.png"/></div></div></figure><p id="7ee6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你拔出<code class="fe nv nw nx ny b">mariadb.v1</code>的YAML，你会看到一大块加密数据。这是版本<code class="fe nv nw nx ny b">v1</code>的完整版本。这大大简化了Helm的功能。它不执行不同的计算，而是简单地取出这个<code class="fe nv nw nx ny b">secret</code>，解密它并应用配置。</p><h2 id="d318" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">那么这对我的应用程序意味着什么呢？</h2><p id="63df" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">除非你对Helm做了什么特别奇怪的事情，否则这个改动应该不会带来太大的麻烦(抱歉)。唯一一次你会进入波涛汹涌的水域(再次抱歉)是如果你偏离了路线(我停不下来)并且滥用了工具。保持真实，乘风破浪(哦，男孩)。</p><h2 id="babf" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">回滚和原子发布仍然有效吗？</h2><p id="dcfe" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">是的，他们有。头盔2上的所有旗帜都在。早期出现的一个主要问题是如何保留分蘖组件的所有优点。碰巧的是，他们干得非常出色。</p><h2 id="4dfd" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">图表不需要再有创意了</h2><p id="f159" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">头盔3带来了一个全新的功能，<a class="ae lq" href="https://helm.sh/blog/helm-3-preview-pt6/" rel="noopener ugc nofollow" target="_blank">图书馆图表</a>。这些图表本身不需要声明任何资源。他们可以简单地定义模板供你的其他舵图使用。</p><p id="3a6e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这为存储关于您的应用程序的公共信息创造了一个很好的地方，而不需要在多个舵图表之间复制它。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="e108" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">那么我们应该注意什么样的事情呢？</h1><p id="9a50" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">我订阅了一些<a class="ae lq" href="https://github.com/helm" rel="noopener ugc nofollow" target="_blank">头盔库</a>:</p><ul class=""><li id="7ef8" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">有一个<a class="ae lq" href="https://github.com/helm/helm/pull/5582" rel="noopener ugc nofollow" target="_blank">打开的拉取请求</a>，用于包含从Helm 2到Helm 3的迁移文档。我很感兴趣地关注着。</li><li id="3de1" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated"><a class="ae lq" href="https://github.com/helm/helm/issues?utf8=%E2%9C%93&amp;q=is%3Aissue+is%3Aopen+helm3" rel="noopener ugc nofollow" target="_blank">所有问题</a>都与掌舵3有关。核心维护者很有帮助地将所有的问题都添加到前缀中，这样我们就可以很容易地跟踪它们。</li></ul><h2 id="290e" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">但是Lua模板呢？</h2><p id="08ad" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">别担心，我没忘记。我做了一些调查，发现了以下关于Github问题的回复:</p><blockquote class="oc od oe"><p id="ee63" class="ku kv of kw b kx ky ju kz la lb jx lc og le lf lg oh li lj lk oi lm ln lo lp im bi translated">…目前的计划是确保我们在Go SDK中打下基础，允许在3.0之后添加Lua库API。只要我们能够在没有任何兼容性破坏的情况下为3.0之后添加这一功能打下基础，那么这似乎是我们可以做的事情。— bacongobbler</p></blockquote><p id="e161" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，在未来的某个时候，我们仍然要处理Lua模板(不管是好是坏，我会抑制我的悲观情绪)，但是它们已经从最初的3.0版本中被删除了。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="3380" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">结论</h1><p id="8bb6" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">就我目前所见，可以肯定地说我很兴奋，印象深刻。看起来赫尔姆的人们真的带来了他们的A级比赛。头盔3更干净，更简单，更安全，同时保持了许多我们在以前版本中喜欢的功能。大家干得好！</p></div></div>    
</body>
</html>