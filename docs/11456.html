<html>
<head>
<title>2 Awesome Tools to Automate Client-side Performance Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2个了不起的工具来自动化客户端性能测试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/2-awesome-tools-to-automate-client-side-performance-testing-a77756bba16f?source=collection_archive---------5-----------------------#2022-03-22">https://betterprogramming.pub/2-awesome-tools-to-automate-client-side-performance-testing-a77756bba16f?source=collection_archive---------5-----------------------#2022-03-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bb86" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">看《灯塔与剧作家》</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c079fc4c4553a3bc5ea9d0639a87b1b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JfZg1zHhMjn_nbkH"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">保罗·埃施-洛朗在<a class="ae kv" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> unsplash </a>上拍摄的图片</p></figure><p id="134a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着应用程序变得越来越复杂，测试工作过度扩展，自动化我们的测试管道是至关重要的。</p><p id="d49b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将演示如何使用两个令人惊叹的工具轻松快速地覆盖多个测试领域。</p><h1 id="8f58" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">介绍谷歌的灯塔</h1><p id="37fa" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">谷歌的灯塔是一个开源的网站质量评估工具。<br/>它基于谷歌的<a class="ae kv" href="https://web.dev/vitals/" rel="noopener ugc nofollow" target="_blank"> web-vitals </a>指南，衡量5个质量因素:</p><h2 id="d4d4" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">1:性能</h2><p id="9294" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这个因素有三个方面:</p><ul class=""><li id="5282" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated"><a class="ae kv" href="https://web.dev/lcp/" rel="noopener ugc nofollow" target="_blank">最大含量涂料(LCP) </a>:测量<em class="nk">负载</em>性能。为了提供良好的用户体验，LCP应该在页面首次开始加载后的2.5秒内发生。</li><li id="199e" class="nb nc iq ky b kz nl lc nm lf nn lj no ln np lr ng nh ni nj bi translated"><a class="ae kv" href="https://web.dev/fid/" rel="noopener ugc nofollow" target="_blank">第一输入延迟(FID) </a>:测量<em class="nk">交互性</em>。为了提供良好的用户体验，页面的FID应该不超过100毫秒。</li><li id="991b" class="nb nc iq ky b kz nl lc nm lf nn lj no ln np lr ng nh ni nj bi translated"><a class="ae kv" href="https://web.dev/cls/" rel="noopener ugc nofollow" target="_blank">累积布局偏移(CLS) </a>:测量<em class="nk">视觉稳定性</em>。为了提供良好的用户体验，页面应该保持0.1的CLS。或者更少。</li></ul><h2 id="8421" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">2:可访问性</h2><p id="162a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我已经在这里详细阐述了可访问性及其在当代软件开发中的重要性。<br/>总的来说，lighthouse根据其<a class="ae kv" href="https://web.dev/lighthouse-accessibility/" rel="noopener ugc nofollow" target="_blank">网页可访问性指标</a>努力提高网站的可访问性。</p><h2 id="868d" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">3:最佳实践</h2><p id="bd1a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这将为web开发人员提供提高代码质量的机会。</p><h2 id="33bd" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">4:搜索引擎优化</h2><p id="c9d7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">优化搜索引擎结果</p><h2 id="06ec" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">5:渐进式网络应用程序(PWA)</h2><p id="59da" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让你的网站与现代技术保持同步。</p><p id="2591" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这5个因素中的每一个都会产生一个从0到100的分数，结果是一个关于所发现的问题和解决问题的机会的详细报告。</p><p id="e955" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以通过4种主要方式运行Lighthouse:</p><ol class=""><li id="3620" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr nq nh ni nj bi translated">来自chrome开发工具</li><li id="5527" class="nb nc iq ky b kz nl lc nm lf nn lj no ln np lr nq nh ni nj bi translated">在线的</li><li id="3904" class="nb nc iq ky b kz nl lc nm lf nn lj no ln np lr nq nh ni nj bi translated">从cli</li><li id="6034" class="nb nc iq ky b kz nl lc nm lf nn lj no ln np lr nq nh ni nj bi translated">作为节点包</li></ol><p id="b04b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们关注节点包选项:)</p><p id="280a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们需要安装来自NPM的灯塔软件包</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="026d" class="mp lt iq ns b gy nw nx l ny nz">npm install lighthouse</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="62c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的脚本中，我们启动了一个chrome实例，并使用它在一个演示网站上执行lighthouse。</p><p id="6453" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们只对性能、可访问性和最佳实践感兴趣。</p><p id="413a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以运行脚本了:</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="c947" class="mp lt iq ns b gy nw nx l ny nz">node pure-lighthouse.js</span></pre><p id="71f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最终结果是一个详细的HTML报告:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/ecabace476d6a6e9049c6558ef414b96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*76wLw7stN4m_QbThGXdJ7g.png"/></div></div></figure><p id="346f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Lighthouse提供了令人惊叹的细节报告，它真的可以帮助识别网页中的质量问题。</p><p id="50a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">准备好脚本后，我们可以在自动化管道中执行它，并轻松地解决这些问题。</p><p id="897d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种方法<strong class="ky ir">，</strong>的问题是我们只能测试应用程序的首页。</p><p id="4222" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要能够在页面之间导航，并在当前页面上运行灯塔。</p><h1 id="e85b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">介绍剧作家</h1><p id="89be" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">剧作家是一个开源的web测试自动化框架。</p><p id="28b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它由微软开发，旨在使用<a class="ae kv" href="https://chromedevtools.github.io/devtools-protocol/" rel="noopener ugc nofollow" target="_blank"> Chrome开发工具协议</a>，并在浏览器实例上执行操作，如导航、点击元素、文本插入、从下拉列表中选择选项等。</p><p id="9b7e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，让我们安装来自npm的剧作家:</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="1d76" class="mp lt iq ns b gy nw nx l ny nz">npm install playwright</span></pre><p id="6b6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们来看一个基本的剧作家剧本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="df11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个脚本中，我们创建了一个浏览器、一个上下文和一个页面，并将页面导航到我们的演示网站。</p><p id="f47a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们可以插入我们的用户名和密码，点击登录按钮，等待直到欢迎元素可见。</p><p id="767e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们运行这个脚本:</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="66b6" class="mp lt iq ns b gy nw nx l ny nz">node pure-playwright.js</span></pre><p id="1b71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个例子中，我们没有使用任何测试框架，我们希望这个例子框架是不可知的。</p><p id="9a25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，您可以轻松地使用任何基于JavaScript的框架并获得报告。</p><h1 id="2ce4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">介绍剧作家-灯塔</h1><p id="623f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在我们可以把所有的碎片拼起来。<br/>我们将使用灯塔来启动质量评估，剧作家来浏览页面，而<a class="ae kv" href="https://www.npmjs.com/package/playwright-lighthouse" rel="noopener ugc nofollow" target="_blank">剧作家-灯塔</a>将充当将这两者结合在一起的粘合剂。</p><p id="f87b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">策略是通过web应用程序导航页面，然后将该页面的实例发送给lighthouse auditor。</p><p id="6f14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先从NPM安装软件包:</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="a7ca" class="mp lt iq ns b gy nw nx l ny nz">npm install playwright-lighthouse</span></pre><p id="de50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们编写测试脚本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="aec8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们导航到仪表板，将页面实例传递给lighthouse auditor，并将性能、可访问性和最佳实践的阈值分别定义为90。</p><p id="e2e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们运行这个脚本:</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="a445" class="mp lt iq ns b gy nw nx l ny nz">node all-together.js</span></pre><p id="cc44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">控制台输出是:</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="aa3a" class="mp lt iq ns b gy nw nx l ny nz">-------- playwright lighthouse audit reports --------</span><span id="ca7d" class="mp lt iq ns b gy od nx l ny nz">c:\workspace-vscode\lighthouse-tutorial\node_modules\playwright-lighthouse\src\audit.js:79</span><span id="1964" class="mp lt iq ns b gy od nx l ny nz">throw new Error(label);</span><span id="ae34" class="mp lt iq ns b gy od nx l ny nz">^</span><span id="4682" class="mp lt iq ns b gy od nx l ny nz">Error: playwright lighthouse - Some thresholds are not matching the expectations.</span><span id="181c" class="mp lt iq ns b gy od nx l ny nz">performance record is 71 and is under the 90 threshold</span><span id="aa41" class="mp lt iq ns b gy od nx l ny nz">accessibility record is 55.00000000000001 and is under the 90 threshold</span><span id="01f2" class="mp lt iq ns b gy od nx l ny nz">best-practices record is 83 and is under the 90 threshold</span></pre><p id="b923" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太棒了。我们没有通过测试，我们可以看到什么失败了！</p><p id="a8fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们转到HTML报告，它将在<code class="fe oe of og ns b">${current_dir}/lighthouse</code>下</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/4f0f1d12e7700373a0a06631e56e91f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OPCUDFIkN0YWMMzNg9Nyhg.png"/></div></div></figure><h1 id="b25b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">哦不！</h1><p id="0977" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如您所见，lighthouse是在登录页面上执行的，而不是在仪表板页面上。</p><p id="9160" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是因为当lighthouse启动时，它会打开一个新的浏览器实例，所有重要的身份验证细节、cookies和存储都会丢失！<br/>我们需要做的是创建一个持久的浏览器，在整个测试过程中保持存储，这可以很容易地实现，这要感谢剧作家的惊人的API。</p><p id="0272" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，让我们修改脚本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="577c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，首先我们创建了一个临时目录，在其中保存所有相关的存储。然后，我们调用playwrights<a class="ae kv" href="https://playwright.dev/docs/api/class-browsertype#browser-type-launch-persistent-context" rel="noopener ugc nofollow" target="_blank">launchPersistentContext</a>来创建一个持久的浏览器上下文，然后我们在上下文之外创建了一个页面实例。</p><p id="8223" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其余的和我们之前一样，我们将持久页面传递给lighthouse auditor并调用质量评估过程。</p><p id="8628" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们运行新脚本:</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="cac1" class="mp lt iq ns b gy nw nx l ny nz">node all-together.js</span></pre><p id="5423" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">控制台输出:</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="c02b" class="mp lt iq ns b gy nw nx l ny nz">-------- playwright lighthouse audit reports --------</span><span id="0464" class="mp lt iq ns b gy od nx l ny nz">c:\workspace-vscode\lighthouse-tutorial\node_modules\playwright-lighthouse\src\audit.js:79</span><span id="55c5" class="mp lt iq ns b gy od nx l ny nz">throw new Error(label);</span><span id="223a" class="mp lt iq ns b gy od nx l ny nz">^</span><span id="72a1" class="mp lt iq ns b gy od nx l ny nz">Error: playwright lighthouse - Some thresholds are not matching the expectations.</span><span id="eebc" class="mp lt iq ns b gy od nx l ny nz">performance record is 19 and is under the 90 threshold</span><span id="3a7a" class="mp lt iq ns b gy od nx l ny nz">accessibility record is 67 and is under the 90 threshold</span><span id="5063" class="mp lt iq ns b gy od nx l ny nz">best-practices record is 75 and is under the 90 threshold</span></pre><p id="c68e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">酷，现在让我们来看看HTML报告:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/01d1ff461dcdf91039af2d2baa654f6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pBKdisIPz5rdZUGCObA7Pw.png"/></div></div></figure><p id="7a8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">厉害！</p></div></div>    
</body>
</html>