<html>
<head>
<title>Real-time apps with Hotwire, ActionText, and Rails 6</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Hotwire、ActionText和Rails 6的实时应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/hotwire-actiontext-and-rails-6-be025dce7d87?source=collection_archive---------5-----------------------#2020-12-30">https://betterprogramming.pub/hotwire-actiontext-and-rails-6-be025dce7d87?source=collection_archive---------5-----------------------#2020-12-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c996" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建实时应用程序的最快方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6c2308412e08518f2c56c997219bda84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kJw2DD4pxXNFeOFwICn47A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="767c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Hotwire是由Basecamp开发的一个全新的HTML-over-WebSocket框架。它的目的是使用<code class="fe lv lw lx ly b">ActionCable</code>和JavaScript执行实时DOM修补。你可以把它比作Phoenix LiveView，但与LiveView不同的是，Hotwire是无状态的。</p><p id="dd80" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我带着Hotwire和<code class="fe lv lw lx ly b">ActionText</code>一起进行了一次试驾，并且能够在不到30分钟的时间内建立一个实时的Twitter feed。你可以在GitHub 上找到完整的<a class="ae lu" href="https://github.com/donrestarone/test-hotwire-actiontext-rails" rel="noopener ugc nofollow" target="_blank">源代码。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/277ea2167ccd7947071d6b2032b7f3a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*JbwrDsChpPX9XC5VTjShqQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这是我建造的。</p></figure><p id="2d80" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你更喜欢视频，这里有一个关于Hotwire和Rails的速成课程，我可以在这里快速构建一个实时聊天应用程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="9b10" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们跳进来。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="add6" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">生成应用程序</h1><p id="560f" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我生成了一个新的应用程序，富有想象力地命名为<code class="fe lv lw lx ly b">test_hotwire</code>:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="5b5a" class="nk mk it ly b gy nl nm l nn no">rails new test_hotwire -d postgresql</span></pre><p id="5f76" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我运行<code class="fe lv lw lx ly b">ActionText</code>生成器来创建必要的样板文件:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="65d6" class="nk mk it ly b gy nl nm l nn no">rails action_text:install</span></pre><p id="2565" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将<code class="fe lv lw lx ly b">hotwire-rails</code>宝石添加到<code class="fe lv lw lx ly b">Gemfile</code>后，我运行了Hotwire的生成器:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="1f78" class="nk mk it ly b gy nl nm l nn no">rails hotwire:install</span></pre><p id="45dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个生成器做了很多事情，包括设置Redis(所以要确保有一个<code class="fe lv lw lx ly b">redis-server</code>在端口6379上运行)和<code class="fe lv lw lx ly b">ActionCable</code>。</p><p id="980b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了加快速度，我为Tweets生成了一个支架，它可以生成HTML模板，以及一个模型和一个控制器:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="566e" class="nk mk it ly b gy nl nm l nn no">rails g scaffold Tweet</span></pre><p id="087a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要使任何域模型可流式传输，您只需广播到一个名称空间并在视图中引用它。对于<code class="fe lv lw lx ly b">Tweet</code>模型，当以下事件发生时，Rails需要向WebSocket广播:</p><ol class=""><li id="fe8d" class="np nq it la b lb lc le lf lh nr ll ns lp nt lt nu nv nw nx bi translated">推文创作</li><li id="9b78" class="np nq it la b lb ny le nz lh oa ll ob lp oc lt nu nv nw nx bi translated">推文更新</li><li id="05ef" class="np nq it la b lb ny le nz lh oa ll ob lp oc lt nu nv nw nx bi translated">推特删除</li></ol><p id="939c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lv lw lx ly b">ActiveRecord</code>钩子非常适合这种事情，所以我在<code class="fe lv lw lx ly b">Tweet</code>模型中加入了下面的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od mb l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe lv lw lx ly b">app/models/tweet.rb</code></p></figure><p id="176a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，每当这些事件触发时，Rails将广播到一个名为<code class="fe lv lw lx ly b">“tweets”</code>的公共名称空间。</p><p id="bf6f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些广播事件的订户由<code class="fe lv lw lx ly b">Turbo</code>设置。要创建一个流，您只需将您需要的任何内容包装在一个Turbo帧中。所以对于tweets流，我做了以下事情:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od mb l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">app/views/tweets/index . html . erb</p></figure><p id="724d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在第13行，<code class="fe lv lw lx ly b">turbo_stream_from</code>将建立到<code class="fe lv lw lx ly b">tweets</code>流的WebSocket连接。每当从后端广播事件时，<code class="fe lv lw lx ly b">turbo_frame_tag</code>将包装tweets列表并修补DOM。</p><p id="177b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在部分<code class="fe lv lw lx ly b">app/views/tweets/_tweet.html.erb</code>中，我将每条tweet封装在引用其ID的<code class="fe lv lw lx ly b">turbo_frame_tag</code>中，这样编辑和删除可以引用DOM上的目标tweet。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od mb l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">app/views/tweets/_ tweet . html . erb</p></figure><p id="d968" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！在实际的应用程序中，您可能会为应用程序中的每个流设置名称空间，并以某种方式为它们添加前缀以进行访问控制。但是这个小例子显示了Rails和它的第一方库这些年来变得多么强大。</p><p id="2a5e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">编码快乐！</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><p id="9a69" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae lu" href="https://www.linkedin.com/in/shashike-jayatunge/" rel="noopener ugc nofollow" target="_blank">沙施克</a>是一名来自多伦多的软件工程师，也是<a class="ae lu" href="https://www.restarone.com" rel="noopener ugc nofollow" target="_blank"> Restarone Inc </a>的创始人。当他不开发软件时，他在Medium和YouTube上创作内容，帮助人们过渡到技术领域。</p></div></div>    
</body>
</html>