<html>
<head>
<title>Create Your Own Book-Recommendation Application Using Wit.ai and Beautiful Soup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Wit.ai和Beautiful Soup创建您自己的图书推荐应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-your-own-book-recommendation-application-using-wit-ai-and-beautiful-soup-8d0343288d28?source=collection_archive---------9-----------------------#2020-11-24">https://betterprogramming.pub/create-your-own-book-recommendation-application-using-wit-ai-and-beautiful-soup-8d0343288d28?source=collection_archive---------9-----------------------#2020-11-24</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="56db" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">网页抓取加上一个NLP应用程序</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/12b60a1ed6e4982f464aaefc2350dbe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6CRF4ALtuhO0vu2i"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kz" href="https://unsplash.com/@jaredd_craig?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jaredd Craig </a>拍照</p></figure><p id="7820" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本教程中，我们将构建一个图书推荐应用程序。我们将涵盖一些基本的人工智能(<a class="ae kz" href="https://en.wikipedia.org/wiki/Artificial_intelligence" rel="noopener ugc nofollow" target="_blank"> AI </a>)和自然语言处理(<a class="ae kz" href="https://en.wikipedia.org/wiki/Natural_language_processing" rel="noopener ugc nofollow" target="_blank"> NLP </a>)概念，以及<a class="ae kz" href="https://en.wikipedia.org/wiki/Web_scraping" rel="noopener ugc nofollow" target="_blank">网络抓取</a>技术。</p><p id="e8ee" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">听众:你不必是一个有经验的数据科学家，也能遵循本文中的步骤。对编程语言和NLP有基本的了解就够了。本教程结束时，您将能够创建自己的酷应用程序。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="760a" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">技术堆栈概述</h1><p id="abce" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated"><a class="ae kz" href="https://wit.ai/docs/quickstart" rel="noopener ugc nofollow" target="_blank"> Wit.ai </a>是一个NLP接口，用于将人类语音或文本转换成结构化数据。它最常见的用途之一是创建聊天机器人或任何其他与人互动的对话程序。</p><p id="ec6f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它已经有现成的NLP算法来训练你的应用。这样可以节省您大量的时间，因为您不必编写自己的训练模型。除此之外，它对私人和商业用途都是免费的。</p><p id="8ff5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank"> Beautiful Soup </a>是一个强大的Python库，用于从HTML和XML文档中提取数据。它允许我们在文档树中导航、搜索和修改数据。例如，如果您想从一个网站收集所有的URL，只需几行代码就可以完成。这是一个从网站获取数据的流行工具。</p><p id="cb02" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们开始吧！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="41e0" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">准备好你的Wit.ai应用</h1><h2 id="df7e" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">基本概念</h2><p id="bc6e" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在我们训练我们的应用程序之前，让我们看看一些基本的Wit.ai概念和术语。</p><ul class=""><li id="5464" class="nm nn iu lc b ld le lg lh lj no ln np lr nq lv nr ns nt nu bi translated"><strong class="lc iv">话语</strong>用于教Wit.ai如何理解你的语音或短信。它从您提供的示例输入数据中学习。产生的数据越多，识别就越准确。例如，话语可以是“现在是什么时间？”</li><li id="bb38" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">意图，顾名思义，就是你心中的目标。例如，您可能想知道当前时间。你将意图分配给所提供的话语，以表明你想要达到的目的。</li><li id="a040" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated"><strong class="lc iv">实体</strong>是指同一主题的单词或一系列单词。它们承载着我们想要从话语中捕捉的有意义的信息。您可以创建自定义实体或使用一些内置实体。Wit提供了大量的实体集合，比如一个人的年龄，一个名人等等。例如，如果您键入“谁是麦当娜？”这个程序可以识别出你指的是一个名人，在这个例子中，是麦当娜。</li></ul><h2 id="4e33" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">创建Wit应用程序</h2><ol class=""><li id="9ae0" class="nm nn iu lc b ld mv lg mw lj oa ln ob lr oc lv od ns nt nu bi translated">首先，你需要<a class="ae kz" href="https://wit.ai/" rel="noopener ugc nofollow" target="_blank">用你的脸书账户注册</a>你的应用程序。您可以使用您的GitHub帐户；但是，这种身份验证很快就会被弃用。</li><li id="2f34" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv od ns nt nu bi translated">点击“新建应用程序”按钮创建一个新的应用程序。我给我的取名<code class="fe oe of og oh b">BookRecommender</code>。</li></ol><p id="d2ac" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">3.点击“选择或添加意向”以创建新的意向。键入<code class="fe oe of og oh b">book_get</code>，并点击“+创建意图”</p><p id="1261" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">4.现在，我们需要创建实体来解析来自输入话语的关键字。要添加您自己的实体，请转到“管理”菜单下的“实体”，然后单击“+实体”创建一个自定义实体，并将其命名为<code class="fe oe of og oh b">book_keywords</code>。</p><p id="13c9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">5.点击“添加新关键字”添加新关键字。选择查找策略“关键字”我决定将与流派相关的关键词按类别分组。</p><p id="5d6c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面是我的关键词的一个例子:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oi"><img src="../Images/fdd49b56691d00dfdc599c16083b971e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fTJw1fLrY16cT2AIsshh2w.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">显示图书关键词的我的电脑截图</p></figure><p id="1c6e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">6.导航至左侧的“理解”部分以添加话语。由于这是一个书籍推荐应用程序，所以让我们添加类似“给我找一本超自然的书”这样的句子</p><p id="40ba" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你会看到程序会突出显示单词<code class="fe oe of og oh b">supernatural</code> <em class="oj"> </em>，因为它识别出它属于我们的<code class="fe oe of og oh b">book_keywords</code>列表。</p><p id="89fc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">将意向设置为<code class="fe oe of og oh b">book_get</code>。“解析值”应该是<code class="fe oe of og oh b">fantasy</code>。</p><p id="7c92" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这里有一个截图可以让你有个概念:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ok"><img src="../Images/7f07b097273a26d2e536cb2d8f85bfe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rI2cBHYD_03KeX4H2qjtrw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自我的电脑的屏幕截图，显示已解析的话语</p></figure><p id="5e3d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">正如我已经提到的，如果你提供更多的例子，Wit会更准确地理解你的意图。</p><p id="465b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面是我的一个例子:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ol"><img src="../Images/18e43c7e5e0f0f8678293c82d711d534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wetgZnBMAOan7COYeRMDPw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">我的电脑上显示话语的屏幕截图</p></figure><p id="0ac3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">8.完成设置后，点击“培训和验证”安排培训。应该需要大约一分钟左右。当训练完成后，应用程序将能够识别新的话语，并将其分配给我们的意图。</p><p id="92d5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果有的话，重复其余的例子。</p><p id="e0d8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">9.现在，让我们查询我们的应用程序。转到“管理”菜单下的“设置”。在“HTTP API”框中键入话语。例如，“我想要一本精彩的书。”</p><p id="6823" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它会生成一个HTTP请求。在终端窗口中复制并执行生成的curl命令。结果应该是这样的:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="5310" class="na me iu oh b gz oq or l os ot">{"text":"I want a fantastic book","intents":[{"id":"843319269761006","name":"book_get","confidence":1}],"entities":{"book_keywords:book_keywords":[{"id":"371862974083122","name":"book_keywords","role":"book_keywords","start":9,"end":23,"body":"fantastic book","confidence":0.9655,"entities":[],"value":"fantasy","type":"value"}]},"traits":{}}</span></pre><p id="4df3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">注意,<code class="fe oe of og oh b">value</code>已经被正确解析——<code class="fe oe of og oh b"> fantastic</code>属于<code class="fe oe of og oh b">fantasy</code>关键字。</p><p id="df29" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们已经完成了我们的Wit应用程序的设置！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="0290" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">准备Python代码</h1><p id="51a1" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">我们将用Python(版本3)编写程序，并利用一些库。</p><p id="1731" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">注意，错误处理超出了本教程的范围。</p><p id="191d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">安装<code class="fe oe of og oh b">pyaudio</code>启用语音记录:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="bbd3" class="na me iu oh b gz oq or l os ot">pip3 install pyaudio</span></pre><p id="12b1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">安装美汤可以提取数据。对于Debian/Ubuntu发行版:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="4da8" class="na me iu oh b gz oq or l os ot">sudo apt-get install python3-bs4</span></pre><p id="26bf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然后运行:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="3181" class="na me iu oh b gz oq or l os ot">pip3 install beautifulsoup4</span></pre><p id="6d09" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">安装<a class="ae kz" href="https://pypi.org/project/html5lib/" rel="noopener ugc nofollow" target="_blank"> html5lib </a>作为解析器库:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="e063" class="na me iu oh b gz oq or l os ot">apt-get insall python-html5lib<br/>pip3 install html5lib</span></pre><p id="420b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">成功安装后，我们就可以开始编码了。</p><ol class=""><li id="5832" class="nm nn iu lc b ld le lg lh lj no ln np lr nq lv od ns nt nu bi translated">创建一个名为<code class="fe oe of og oh b">audiorecorder.py</code>的文件，并粘贴以下代码:</li></ol><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ou ov l"/></div></figure><p id="7209" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">不要太担心这个文件，它会处理录音。当我们执行<code class="fe oe of og oh b">record_audio</code>函数时，我们将传递<code class="fe oe of og oh b">duration</code>和一个<code class="fe oe of og oh b">filename</code>作为参数。持续时间以秒为单位。该程序将创建一个包含我们演讲的<code class="fe oe of og oh b">wav</code>格式的文件。</p><p id="b271" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe oe of og oh b">read_audio</code>功能将打开语音文件并播放。</p><p id="b1ba" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">2.创建一个名为<code class="fe oe of og oh b">book_recommender.py</code>的文件。这是我们放置应用程序逻辑的地方。</p><p id="b7f1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">3.连同我们的<code class="fe oe of og oh b">audiorecorder</code>一起导入必要的库:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="065b" class="na me iu oh b gz oq or l os ot">import re<br/>import json<br/>import random<br/>import requests<br/>from bs4 import BeautifulSoup<br/>from  audiorecorder import record_audio, read_audio</span></pre><p id="ffd3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">4.为了能够从Python调用我们的Wit应用程序，我们需要一个访问令牌。要获取它，请返回Wit.ai并导航至“设置”。复制“服务器访问令牌”</p><p id="fc22" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">5.定义API端点和Wit令牌:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="619d" class="na me iu oh b gz oq or l os ot">WIT_API_ENDPOINT = 'https://api.wit.ai/speech'<br/>WIT_ACCESS_TOKEN = 'IXOH5HPPECPC2KIHJ6Q7MQAOKXFIFRRD'<br/>BOOK_API_ENDPOINT = 'https://www.goodreads.com/genres/'</span></pre><p id="4871" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Goodreads是我最喜欢查看书籍推荐的地方之一。我们将使用他们的网站来接收推荐列表。稍后，我们将把所需的流派作为URL参数传递。</p><p id="1cad" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">6.启动一个<code class="fe oe of og oh b">CATEGORIES</code>对象来保存我们的书籍类型和它们的类别:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="f954" class="na me iu oh b gz oq or l os ot">CATEGORIES = json.loads('[{"genre":"Art","category":"hobby"},{"genre":"Biography", "category":"biography"},{"genre":"Business","category":"entrepreneurship"},{"genre":"Children-s","category":"children"},{"genre":"Classics","category":"classic"},{"genre":"Cookbooks","category":"cooking"},{"genre":"Crime","category":"suspense"},{"genre":"Fantasy","category":"fantasy"},{"genre":"Fiction","category":"fantasy"},{"genre":"History","category":"history"},{"genre":"Horror","category":"fantasy"},{"genre":"Music","category":"music"},{"genre":"Mystery","category":"fantasy"},{"genre":"Paranormal","category":"fantasy"},{"genre":"Philosophy","category":"psychology"},{"genre":"Romance","category":"romance"},{"genre":"love","category":"romance"},{"genre":"Science","category":"hobby"},{"genre":"ScienceFiction","category":"fantasy"},{"genre":"Self-Help","category":"psychology"},{"genre":"Suspense","category":"suspense"},{"genre":"Spirituality","category":"psychology"},{"genre":"Sports","category":"hobby"},{"genre":"Thriller","category":"suspense"},{"genre":"Travel","category":"hobby"},{"genre":"Young Adult","category":"teen"}]')</span></pre><p id="6287" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，类别必须与我们在Wit应用程序的<code class="fe oe of og oh b">book_keywords</code>中创建的类别相匹配。</p><p id="2d89" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您看到的类型与Goodreads中的类型相匹配。</p><p id="b5ca" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">7.创建<code class="fe oe of og oh b">recognize_speech</code>功能:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="bb73" class="na me iu oh b gz oq or l os ot">def recognize_speech(filename, audio_length):<br/><br/>    # record an audio file for a given duration in seconds<br/>    record_audio(audio_length, filename)<br/><br/>    audio = read_audio(filename)<br/><br/>    headers = {'authorization': 'Bearer ' + WIT_ACCESS_TOKEN,<br/>               'Content-Type': 'audio/wav'}<br/><br/>    resp = requests.post(WIT_API_ENDPOINT, headers = headers,<br/>                         data = audio)<br/><br/>    data = json.loads(resp.content)<br/>    return data</span></pre><p id="de88" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个函数将从我们的<code class="fe oe of og oh b">audiorecorder.py</code>模块中调用<code class="fe oe of og oh b">record_audio</code>函数。它会向Wit发送一个包含录音的请求。基本上，这和我们用curl命令查询我们的应用程序是一样的。响应将是一个简单的JSON对象，我们稍后将对其进行解析。</p><p id="e191" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">8.定义一个<code class="fe oe of og oh b">analyze_speech</code>函数来处理用户输入:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="4c92" class="na me iu oh b gz oq or l os ot">def analyze_speech(recorded_speech):<br/>    book_types = ""<br/>    searched_book_type = ""<br/>    result_genres = []<br/><br/>    if 'book_keywords:book_keywords' in recorded_speech['entities']:<br/>        book_types = recorded_speech['entities']['book_keywords:book_keywords']<br/><br/>    if book_types:<br/>       for key in book_types:<br/>           searched_book_type = key['value']<br/><br/><br/>    for category in CATEGORIES:<br/>        if searched_book_type == category['category']:<br/>           result_genres.append(category['genre'])<br/><br/>    return result_genres</span></pre><p id="cfb4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">该功能将检查我们的话语是否包含任何<code class="fe oe of og oh b">book_keywords</code>。然后它会从录制的语音中提取图书关键词。</p><p id="e745" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们需要遍历提供的图书关键字来识别搜索到的图书类型。</p><p id="bdab" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们检查<code class="fe oe of og oh b">searched_book_type</code>是否与<code class="fe oe of og oh b">book_types</code>中的值匹配。例如，如果你说<code class="fe oe of og oh b">fantasy</code>，它会寻找一个匹配的值。</p><p id="da51" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果我们为搜索的图书类型找到多个类别，我们将它们添加到一个<code class="fe oe of og oh b">result_genres</code>列表中。例如，幻想类别可以被列入超自然、神秘或科幻类型。</p><p id="8959" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你可以根据自己的喜好随意修改类型。</p><p id="03f6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">9.创建另一个函数<code class="fe oe of og oh b">get_book_recommendations</code>，来检索图书推荐:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="6a15" class="na me iu oh b gz oq or l os ot">def get_book_recommendations(genre):<br/>    book_site_response = requests.get(BOOK_API_ENDPOINT + genre)<br/>    soup = BeautifulSoup(book_site_response.text, "html.parser")<br/>    book_entries = soup.find_all("div", class_="bookBox")<br/><br/>    for book in book_entries:<br/>        book_id = book.find("div", class_="coverWrapper")['id']<br/>        soup_string = str(book)<br/>        matcher = re.search(book_id + '\'\),\s(.*)(&lt;h2&gt;.*div&gt;)', soup_string)<br/>        innerBookHtml = matcher.group(2)<br/>        book_element = BeautifulSoup(innerBookHtml.replace(r"\"", '"').replace(r"\/", "/"), "html.parser")<br/>        book_title = book_element.find("a", class_="bookTitle").text<br/>        print("Title: ", book_title)<br/>        book_link = book_element.find("a", class_="bookTitle")['href']<br/>        print("Link: ", book_link)<br/>        book_author = book_element.find("a", class_="authorName").text<br/>        print("Author: ", book_author)<br/>        print("**************************************")</span></pre><p id="a6dd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我不得不提到，有几种方法可以从网站中提取数据。更简单的方法是使用API。如果网站提供了一个API，你只需要传递必要的参数就可以得到想要的响应。然而，问题是并不是所有的API都能满足定制需求。因此，你可能想使用一个web scraper来提取你需要的信息。这就是美丽的汤库发挥作用的时候了。</p><p id="5d59" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇文章中，我们将采用强硬的方式——我们将使用网络抓取。</p><p id="b227" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们的例子中，我们希望提取书名、作者和链接。</p><p id="3026" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Beautiful Soup会将来自网站的<code class="fe oe of og oh b">book_site_response</code>解析为HTML。</p><p id="c720" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们看一下回复摘录，看看文档是什么样子的。这样，您将更好地理解我们代码中即将出现的动作。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ow"><img src="../Images/7ef391bd3bba55629c4ce384494282c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rIziz51abaoGG6QHvAELAA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自我的电脑的屏幕截图，显示了部分响应HTML</p></figure><p id="2523" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可能已经注意到了，这不是一个标准的HTML文件。它包含一个带有字符数据(CDATA)的脚本。我们需要的信息，比如<code class="fe oe of og oh b">authorName</code>，驻留在CDATA部分中。</p><p id="96e9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">首先，我们希望通过找到所有包含一个<code class="fe oe of og oh b">bookBox</code>类的<code class="fe oe of og oh b">div</code>标签来提取图书条目。这样，更容易处理文档中更有意义的部分。我们将过滤后的文本存储在<code class="fe oe of og oh b">book_entries</code>变量中。</p><p id="c651" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在Beautiful Soup的帮助下，我们循环通过<code class="fe oe of og oh b">book_entries</code>来收集图书id。</p><p id="7ee8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">既然我们能够通过ID识别一本书，下一步就是收集每本书所需的信息。为了实现这一点，我们将使用正则表达式(regex)模式。</p><p id="fbee" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">收到的<code class="fe oe of og oh b">innerBookHtml</code>看起来是这样的:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ox"><img src="../Images/370914ee1198c5b8fed94e3fbfd41908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oydCIHPgrFvtVFufzCoDrw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">我的电脑截图，显示了包含图书数据的内部HTML</p></figure><p id="8a12" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这已经足够好了。然而，有一个问题HTML文本被转义了。所以，还不能用美人汤。首先，我们必须使用另一个正则表达式来隐藏HTML代码。最终的HTML存储在<code class="fe oe of og oh b">book_element</code>变量中。</p><p id="d71f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一旦我们有了有效的HTML代码，就很容易使用Beautiful Soup提取所需的信息。</p><p id="e554" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了在程序结束时看到结果，我们使用<code class="fe oe of og oh b">print</code>函数将它们显示给用户。</p><p id="4a64" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">10.最后，让我们创建运行程序的主要方法:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="0adc" class="na me iu oh b gz oq or l os ot">if __name__ == "__main__":<br/>    speech =  recognize_speech('speech.wav', 4)<br/>    print("\nRecognized speech: {}".format(speech['text']))<br/><br/>    possible_genres = analyze_speech(speech)<br/>    if possible_genres:<br/>       print("I have found something for you:", possible_genres)<br/>       if len(possible_genres) &gt; 1:<br/>           genre_param = random.choice(possible_genres)<br/>           print("picked a random genre from multiple categories:", genre_param)<br/>       else:<br/>           genre_param = possible_genres[0]<br/>       get_book_recommendations(genre_param)<br/>    else:<br/>     print("Sorry, I didn't find anything")</span></pre><p id="0d31" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，我已经将录音长度设置为4秒——如果您需要更多时间，可以随意更改。</p><p id="6012" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果我们收到一个单一类型的结果，我们将显示属于该类型的图书数据。然而，正如我们已经看到的，结果是有可能接收多个流派。在这种情况下，逻辑是从<code class="fe oe of og oh b">possible_genres</code>列表中随机选择一个流派。</p><p id="ba4b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">选择的流派作为参数传递给<code class="fe oe of og oh b">get_book_recommendations</code>函数，该函数返回请求的图书结果。</p><p id="44dc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果用户正在寻找一个在我们的<code class="fe oe of og oh b">book_keywords </code>列表中不存在的流派，或者录音不清晰，程序会显示一条消息通知用户没有找到。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="9dec" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">测试整个应用程序</h1><p id="e758" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在终端中使用这个Python命令运行<code class="fe oe of og oh b"> book_recommender.py</code>:</p><pre class="kk kl km kn gu om oh on oo aw op bi"><span id="e641" class="na me iu oh b gz oq or l os ot">python3 book_recommender.py</span></pre><p id="c7de" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">说个<code class="fe oe of og oh b">i want a romantic book</code>之类的。结果应该是这样的:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ow"><img src="../Images/3e6ccd0677806659ae975f2ffae48ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fn6ezuQWheIfUVJ3pFnw6Q.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk">´</p></figure><p id="2562" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你回到Wit.ai界面，点击“理解”，你会看到你在调用API时提供的新例子。您可以检查是否正确解析了意图和实体。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="bb91" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">结论</h1><p id="e33f" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">我们已经到了本教程的结尾。现在，你应该能够使用Wit.ai创建和训练自己的应用程序。你还学会了如何使用Beautiful Soup进行网页抓取，从网站中提取信息。</p><p id="e4be" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个项目的Python代码，以及我的Wit应用程序的ZIP文件，可以在下面链接的我的GitHub存储库中找到。</p><p id="b3ec" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我希望你喜欢这个教程。感谢您的阅读，祝您编码愉快！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="37b6" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">参考</h1><ul class=""><li id="89c7" class="nm nn iu lc b ld mv lg mw lj oa ln ob lr oc lv nr ns nt nu bi translated"><a class="ae kz" href="https://github.com/kirshiyin89/witai_bs_demo" rel="noopener ugc nofollow" target="_blank"> GitHub </a>仓库</li><li id="4da7" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated"><a class="ae kz" href="https://wit.ai/docs/quickstart" rel="noopener ugc nofollow" target="_blank">“打造你的第一款Wit应用”</a>通过Wit docs</li><li id="2786" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated"><a class="ae kz" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/#" rel="noopener ugc nofollow" target="_blank">美汤医生</a></li></ul></div></div>    
</body>
</html>