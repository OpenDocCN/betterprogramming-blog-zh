<html>
<head>
<title>How to Deploy Multiple Apps Under a Single GitHub Repository to Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将单个GitHub存储库下的多个应用程序部署到Heroku</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-deploy-multiple-apps-under-a-single-github-repository-to-heroku-f6177489d38?source=collection_archive---------3-----------------------#2020-07-15">https://betterprogramming.pub/how-to-deploy-multiple-apps-under-a-single-github-repository-to-heroku-f6177489d38?source=collection_archive---------3-----------------------#2020-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="defb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用一个存储库部署React和Node/Express应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e567f77d88b3cb5064418582cd8c73df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vu5pZbwHCCKbkAPh.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://coursework.vschool.io/deploying-mern-with-heroku/" rel="noopener ugc nofollow" target="_blank"> V校</a>。</p></figure><p id="2ce9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您正在开发一个全栈应用程序，其中客户端使用React，服务器端使用Node.js/Express.，您很可能会为每一个都拥有单独的<a class="ae ky" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>存储库。但是如果这两个都是子目录呢？让我们先来看看这个结构是什么样子的:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="885c" class="ma mb it lw b gy mc md l me mf">app (github repo)<br/>  |__frontend (react application)<br/>  |__backend (node/express application)</span></pre><p id="b9dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我使用这种方法来确定是否有可能将每个子目录部署到Heroku。将应用程序作为子目录并不常见，理想情况下它们应该有自己的GitHub存储库。</p><p id="b21c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们将<code class="fe mg mh mi lw b">app</code>初始化为存储库，将它部署到Heroku将不起作用。相反，目标是通过<code class="fe mg mh mi lw b">app</code>的GitHub库将<code class="fe mg mh mi lw b">frontend</code>和<code class="fe mg mh mi lw b">backend </code>部署到Heroku。</p><p id="fca5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本指南将介绍如何在一个GitHub资源库下部署多个应用程序。将假设应用程序已经被推送到GitHub，并带有最近的更改。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="db39" class="mq mb it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">先决条件</h1><ul class=""><li id="716d" class="nh ni it lb b lc nj lf nk li nl lm nm lq nn lu no np nq nr bi translated">确保安装了Heroku CLI 。</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e86c" class="mq mb it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">添加和/或重命名Heroku遥控器</h1><p id="ee07" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">我们将使用命令<code class="fe mg mh mi lw b">heroku create</code>在Heroku上创建一个新的空应用程序。同时会自动创建一个名为<code class="fe mg mh mi lw b">heroku</code>的遥控器(可以在终端中键入<code class="fe mg mh mi lw b">git remote -v</code>进行检查)。</p><h2 id="8d1c" class="ma mb it bd mr nv nw dn mv nx ny dp mz li nz oa nb lm ob oc nd lq od oe nf of bi translated">后端</h2><p id="80cf" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">我们将从建立<code class="fe mg mh mi lw b">backend</code>子目录开始。在您的命令行界面中，导航到主<code class="fe mg mh mi lw b">app</code>目录。到了那里，让我们用<code class="fe mg mh mi lw b">heroku create app-backend</code>生成Heroku后端应用程序。我选择将Heroku上的应用命名为<code class="fe mg mh mi lw b">app-backend</code>。您可以选择将其命名为任何名称，但是要确保它与其他命令保持一致。</p><p id="2543" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您运行<code class="fe mg mh mi lw b">git remote -v</code>但看不到遥控器<code class="fe mg mh mi lw b">heroku</code>，您必须使用命令<code class="fe mg mh mi lw b">heroku git:remote -a app-backend</code>添加遥控器。</p><p id="3504" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是重命名<code class="fe mg mh mi lw b">heroku</code>遥控器，因为我们将有多个遥控器。运行命令<code class="fe mg mh mi lw b">git remote rename heroku heroku-app-backend</code>。在这种情况下，我将其重命名为<code class="fe mg mh mi lw b">heroku-app-backend</code>，但是您可以选择将遥控器重命名为什么。</p><h2 id="ea5d" class="ma mb it bd mr nv nw dn mv nx ny dp mz li nz oa nb lm ob oc nd lq od oe nf of bi translated">前端</h2><p id="36a8" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">对于<code class="fe mg mh mi lw b">frontend</code>存储库将采取类似的步骤，但是它需要用一个buildpack来创建。在终端中，仍然在<code class="fe mg mh mi lw b">app</code>目录下，运行:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f320" class="ma mb it lw b gy mc md l me mf">heroku create app-frontend -b https://github.com/mars/create-react-app-buildpack.git<!-- --> </span></pre><p id="20a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还是那句话，我选择把app命名为<code class="fe mg mh mi lw b">app-frontend</code>。</p><p id="2b7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您在名称上犯了错误，您可以随时使用以下名称对其进行重命名:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="262e" class="ma mb it lw b gy mc md l me mf">heroku apps:rename new_name --app old_name</span></pre><p id="6311" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你运行<code class="fe mg mh mi lw b">git remote -v</code>并且没有看到遥控器<code class="fe mg mh mi lw b">heroku</code>，你必须用命令<code class="fe mg mh mi lw b">heroku git:remote -a app-frontend</code>添加它。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ba00" class="mq mb it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">为正确的Heroku遥控器设置脚本</h1><p id="5bf0" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">这一步可以被认为是可选的，但是通过设置这一步，以后向Heroku推送应用程序的新版本/更新版本会容易得多。因为我们有一个React和Node/Express应用程序，<code class="fe mg mh mi lw b">npm</code>可以作为一个工具来帮助发布到Heroku remotes。</p><p id="fbc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在每个<code class="fe mg mh mi lw b">frontend</code>和<code class="fe mg mh mi lw b">backend</code>子目录中，我们可以更新<code class="fe mg mh mi lw b">package.json</code>文件并添加命令来发布对Heroku remote的权限。让我们从<code class="fe mg mh mi lw b">backend</code>开始。使用<code class="fe mg mh mi lw b">cd backend</code>导航到该存储库，并打开<code class="fe mg mh mi lw b">package.json</code>。我们将在<code class="fe mg mh mi lw b">scripts</code>中添加以下内容:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e26f" class="ma mb it lw b gy mc md l me mf">"scripts": {</span><span id="b9f9" class="ma mb it lw b gy og md l me mf">   "publishToHeroku": "cd ../ &amp;&amp; git subtree push --prefix backend heroku- <br/>    app-backend master || true"</span><span id="d8c4" class="ma mb it lw b gy og md l me mf">}</span></pre><p id="e875" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们来分解一下。<code class="fe mg mh mi lw b">git subtree</code>命令必须从配置git的库的根目录运行。<code class="fe mg mh mi lw b">push --prefix backend</code>指定了我们想要推送的目录。<code class="fe mg mh mi lw b">heroku-app-backend master</code>指定遥控器的名称和要推送的分支的名称。<code class="fe mg mh mi lw b">|| true</code>只是为了避免任何npm错误代码。</p><p id="f73f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对<code class="fe mg mh mi lw b">frontend</code>目录遵循相同的步骤，但是以下内容将被添加到<code class="fe mg mh mi lw b">scripts</code>:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="79ac" class="ma mb it lw b gy mc md l me mf">publishToHeroku: cd ../ &amp;&amp; git subtree push --prefix frontend heroku-app-frontend master || true</span></pre><p id="2ee6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oh">注意:如果在运行上面的命令时有任何问题，请确保您引用了正确的目录和Heroku remotes的名称。</em></p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="6224" class="mq mb it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">部署</h1><p id="9a8e" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">在部署之前，如果您的应用程序的任何部分使用环境变量，请确保首先用Heroku设置它们。否则，部署的应用程序可能会崩溃。为此，从终端对每个环境变量使用<code class="fe mg mh mi lw b">heroku config:set KEY=VALUE</code>命令，并用<code class="fe mg mh mi lw b">heroku config</code>进行检查。</p><p id="30ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以使用之前设置的<code class="fe mg mh mi lw b">npm</code>和<code class="fe mg mh mi lw b">script</code>命令将每个目录部署到Heroku。让我们运行<code class="fe mg mh mi lw b">cd backend</code>来导航到<code class="fe mg mh mi lw b">backend</code>并运行<code class="fe mg mh mi lw b">npm run publishToHeroku</code>。相同的步骤适用于<code class="fe mg mh mi lw b">frontend</code>。</p><p id="ab65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应该可以成功部署应用程序。</p><p id="6b36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我成功地使用这种方法进行部署之前，我确实面临着许多问题。一个问题是在部署之前没有设置环境变量。在已经部署之后设置它仍然会给我带来问题。我不得不再次推动和重新部署。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e162" class="mq mb it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">警告</h1><p id="ceb6" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">本指南假设您正在使用<code class="fe mg mh mi lw b">npm</code>作为内置工具，但是只要执行了正确的脚本，它应该可以与任何其他工具一起工作。如果您需要发布一个除了<code class="fe mg mh mi lw b">master</code>之外的分支，您需要在<code class="fe mg mh mi lw b">script</code>中进行修改，以匹配您想要部署的分支的名称。例如:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8780" class="ma mb it lw b gy mc md l me mf">publishToHeroku: cd ../ &amp;&amp; git subtree push --prefix frontend heroku-app-frontend &lt;name_of_branch&gt;|| true</span></pre><p id="d3d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你正在使用另一个没有<code class="fe mg mh mi lw b">package.json</code>的框架，比如有一个Rails后端而不是Node/Express后端，你将不能设置一个脚本标签。相反，您可以尝试从根目录直接从终端运行该命令:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8b33" class="ma mb it lw b gy mc md l me mf">git subtree push — prefix backend heroku-app-backend master</span></pre><p id="7450" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我自己没有用Rails实现过这种方法，但是如果您正在将一个Rails应用程序部署到Heroku，请记住数据库必须是<code class="fe mg mh mi lw b">postgresql</code>。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="c516" class="mq mb it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">结束语</h1><p id="d38c" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">如前所述，在GitHub上将应用程序作为子存储库并不常见。React应用程序和Node/Express应用程序都应该有自己的存储库，但是为了便于组织，一些编码人员可能希望将两个存储库放在一个存储库中。通过一些额外的步骤，仍然有可能以这种方式部署到Heroku。</p><p id="0c1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。我希望这篇文章对你有用。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="0b9d" class="mq mb it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">资源</h1><ul class=""><li id="8568" class="nh ni it lb b lc nj lf nk li nl lm nm lq nn lu no np nq nr bi translated"><a class="ae ky" href="https://adampaxton.com/how-to-deploy-to-multiple-heroku-apps-from-the-same-git-repository/" rel="noopener ugc nofollow" target="_blank">https://adampaxton . com/how-to-deploy-to-multiple-heroku-apps-from-the-same-git-repository/</a></li><li id="0722" class="nh ni it lb b lc oi lf oj li ok lm ol lq om lu no np nq nr bi translated"><a class="ae ky" href="https://blog.heroku.com/deploying-react-with-zero-configuration" rel="noopener ugc nofollow" target="_blank">https://blog . heroku . com/deploying-react-with zero-configuration</a></li></ul></div></div>    
</body>
</html>