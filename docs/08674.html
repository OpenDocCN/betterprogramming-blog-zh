<html>
<head>
<title>How To Track Job Applications With Notion API, Node.js and FastifyJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用API、Node.js和FastifyJS跟踪求职申请</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-track-job-applications-with-notion-api-node-js-and-fastifyjs-26e070c92d7a?source=collection_archive---------4-----------------------#2021-05-28">https://betterprogramming.pub/how-to-track-job-applications-with-notion-api-node-js-and-fastifyjs-26e070c92d7a?source=collection_archive---------4-----------------------#2021-05-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2a0c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何在Node.js和FastifyJS中使用新的概念API</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e1ac18a50bfb2daa74aaec2bfc18cee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OrzaPyrj3ZAxRR3C"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·温克勒在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4bf6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">概念是一个生产力软件，允许你创建知识管理、项目管理和笔记系统。</p><p id="f56d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">他们最近向公众发布了他们的API。您可以使用API将您的概念数据集成到您想要的任何应用程序中。</p><p id="594d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，本文将向您展示:</p><ul class=""><li id="c42d" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">用概念构建Node.js API</li><li id="86f5" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">使用FastifyJS创建API</li></ul><p id="2b7a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事不宜迟，让我们开始配置您的概念工作空间。</p><h1 id="b70a" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">在观念上创造整合</h1><p id="8d94" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">转到您的<a class="ae kv" href="https://www.notion.com/my-integrations" rel="noopener ugc nofollow" target="_blank">概念整合</a>，点击“+新整合”按钮创建一个新的整合。之后，系统会提示您填写三个字段:</p><ul class=""><li id="dd3c" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">您的项目的名称</li><li id="cb7a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">项目的标志</li><li id="da8d" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">选择关联的工作空间</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/66d7668db8ac6d45cb2e039c1ea604e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aL_rJk7AGMSjTt7j.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图一。</p></figure><p id="1d8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的图1说明了设置过程。填写完所有字段后，单击“提交”按钮创建集成。</p><p id="4064" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">单击submit按钮后，您的集成就应该创建好了。您将被重定向到另一个页面，在那里您可以获取“**内部集成令牌* *”。图2显示了这一点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/63398e664844cde11350b147dda6f16b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3vuAUoztMJVJLsep.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图二。</p></figure><p id="718d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在继续之前，需要注意的是，您需要选中“<strong class="ky ir">内部集成</strong>”，如图2所示。</p><p id="88c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于创建概念集成的更深入的教程，我推荐查看他们的官方文档。</p><h1 id="cd44" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">分享您的想法页面</h1><p id="7edf" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">最后一步是与新创建的集成共享您想要的任何页面。转到您的概念帐户，选择您想要的任何页面。</p><p id="ffaf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">页面打开后，点击“共享”按钮，然后点击“添加人员、电子邮件、群组或集成”字段</p><p id="af18" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的图3说明了这一点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/c193565477f049a1caa2a3af07301795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bup-deGxBmhJVuNi.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图3。</p></figure><p id="d011" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">单击该字段后，系统会提示您选择希望与谁共享页面。选择您的集成。在我的例子中，我与我的集成共享“我的空间”页面，称为“我的概念空间”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/1a9001c2bce89bce15808539ceeadd62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5w_4hWVaOWYgrMiQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图4。</p></figure><p id="a649" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是你在配置概念时需要做的一切，做得很好！您已经完成了概念配置，并准备好使用概念API。</p><p id="9c8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注</strong>:如果你想和我用同一个文档，可以复制这个<a class="ae kv" href="https://www.notion.so/6c73f893f4c74718982504d36a6c43bb?v=345b93c08725486097551607ef394b8c" rel="noopener ugc nofollow" target="_blank">求职模板</a>。在您复制它之后，与您的集成共享它(参见上面的过程)并使用您的数据库ID(稍后您将看到如何获得数据库ID)。</p><h1 id="1f19" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">配置Node.js项目</h1><p id="0a9c" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">您需要使用JavaScript的概念SDK来与Node.js应用程序中的概念API进行交互。观念SDK是观念API的一个客户端，你可以在它的<a class="ae kv" href="https://github.com/makenotion/notion-sdk-js" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>上找到更多关于它的信息。</p><p id="dffc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一步是创建应用程序结构。创建一个新文件夹并初始化应用程序，如下所示:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="eb25" class="nl mh iq nh b gy nm nn l no np">mkdir notion-api-app<br/><br/>cd notion-api-app<br/><br/>npm init -y</span></pre><p id="d454" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">命令<code class="fe nq nr ns nh b">npm init -y</code>创建package.json文件并用默认值初始化它。如果您想要手动填充字段，请移除-y标志并按照说明进行操作。</p><p id="a63e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是安装创建应用程序所需的包。您将使用以下软件包:</p><ul class=""><li id="b533" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><strong class="ky ir">概念SDK </strong> —与概念API交互。</li><li id="70cc" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir"> FastifyJS </strong> —构建Node.js API。</li><li id="356f" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">dotenv</strong>——管理环境变量。</li></ul><p id="c922" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，您可以按如下方式安装软件包:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="62ac" class="nl mh iq nh b gy nm nn l no np">npm install @notionhq/client fastify dotenv</span></pre><p id="cda0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦安装了包，您需要创建一个文件来存储环境变量。您将在<code class="fe nq nr ns nh b">.env</code>文件中存储概念秘密令牌和数据库ID。因此，创建如下的<code class="fe nq nr ns nh b">.env</code>文件:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="c9c8" class="nl mh iq nh b gy nm nn l no np">touch .env</span></pre><p id="2f05" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在转到<a class="ae kv" href="https://notion.so/my-integrations" rel="noopener ugc nofollow" target="_blank">你的概念整合</a>并点击你的整合。您应该看到一个名为<strong class="ky ir">内部集成令牌</strong>的字段(参见图2)。单击“显示”按钮并复制令牌。</p><p id="95c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是转到您的<code class="fe nq nr ns nh b">.env</code>文件并添加令牌:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="c598" class="nl mh iq nh b gy nm nn l no np">NOTION_TOKEN=&lt;your_token&gt;</span></pre><p id="50b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注</strong>:用你之前复制的令牌替换<code class="fe nq nr ns nh b">&lt;your_token&gt;</code>。</p><p id="8873" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在继续之前，您还需要为应用程序创建文件夹结构。您需要创建以下文件夹:</p><ul class=""><li id="5945" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><strong class="ky ir"> app.js </strong> —您的服务器配置之家。</li><li id="1d83" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">src  —它托管所有其他文件夹。</li><li id="c4b3" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">路线</strong> —您的路线的主文件夹。</li><li id="3573" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">观念 —观念客户端驻留在这里。</li><li id="a26b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">控制器</strong> —您的业务逻辑的主文件夹。</li></ul><p id="5baa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以从命令行创建所有文件夹和文件，如下所示:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="656d" class="nl mh iq nh b gy nm nn l no np">touch app.js<br/>mkdir src<br/>mkdir src/routes src/notion src/controllers<br/>touch src/routes/routes.js<br/>touch src/notion/client.js<br/>touch src/controllers/controllers.js</span></pre><p id="4126" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，应用程序的结构应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/5d0bb6800fa1da9b7cef304eddc14987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vziFoFrnpEKhprPC.png"/></div></div></figure><p id="6199" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您已经准备好构建应用程序了！</p><h1 id="4773" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">在应用程序中配置概念</h1><p id="48f4" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">是时候配置概念客户机了，这样您就可以用它来操作数据。进入以下文件<code class="fe nq nr ns nh b">src/notion/client.js</code>并添加以下代码:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="6037" class="nl mh iq nh b gy nm nn l no np">const { Client } = require('@notionhq/client');<br/><br/>require('dotenv').config();</span></pre><p id="079f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第一行中，您导入了概念客户端，在第二行中，您导入了<code class="fe nq nr ns nh b">dotenv</code>包。这些导入的目的是允许您使用概念客户端和环境变量。</p><p id="c716" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是创建一个新的概念客户端。在同一个文件中，导入后，编写以下代码:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="c3f3" class="nl mh iq nh b gy nm nn l no np">const notion = new Client({<br/>    auth: process.env.NOTION_TOKEN<br/>});</span></pre><p id="a187" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用上面的代码，您创建了一个新的概念客户端实例，并传递了您的秘密令牌。最后，将它存储在<code class="fe nq nr ns nh b">notion</code>常量中，这样就可以重用客户端。</p><p id="eea0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在继续之前，您需要导出<code class="fe nq nr ns nh b">notion</code>常量，这样您就可以在编写业务逻辑时使用它。在同一个文件- <code class="fe nq nr ns nh b">src/notion/client.js</code> -的末尾，写下如下代码:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="dae5" class="nl mh iq nh b gy nm nn l no np">module.exports = {<br/>    notion<br/>};</span></pre><p id="e823" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您已经准备好使用概念客户机了。</p><p id="763b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查<a class="ae kv" href="https://gist.github.com/catalinpit/1cd4f8973fa6604fe2c856a3c939ec87" rel="noopener ugc nofollow" target="_blank">这个要点</a>看看你的文件<code class="fe nq nr ns nh b">client.js</code>应该如何查找到这一点。</p><h2 id="82a6" class="nl mh iq bd mi nu nv dn mm nw nx dp mq lf ny nz ms lj oa ob mu ln oc od mw oe bi translated">如何获得数据库ID</h2><p id="6ea6" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">在构建路线之前还有一个步骤。您需要数据库ID，以便执行以下操作:</p><ul class=""><li id="7c25" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">创建、读取和修改数据</li></ul><p id="dd1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以通过两种方式获得数据库ID。您可以从浏览器或通过编程来<strong class="ky ir">完成。</strong></p><p id="18d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您喜欢从浏览器中完成，请在浏览器中打开概念文档并复制ID，如图5所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/b2474c377715b02968b580b4618f69c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZBPAlwPh3OeIhrXY.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图5。</p></figure><p id="b5ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者，您可以通过编程方式获取数据库ID，如下面的代码片段所示:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="0798" class="nl mh iq nh b gy nm nn l no np">const getDatabases = async () =&gt; {<br/>    const databases = await notion.databases.list();<br/><br/>    console.log(databases);<br/>};</span></pre><p id="6bd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码片段列出了您所有的数据库以及关于它们的信息。有关可视化表示，请参见下面的图6。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/74082b26f7d7fc9a750fa2c6ca56703f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6egKNiL0NVo3v0TV.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图6。</p></figure><p id="2ab2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">无论您最终使用哪个选项，复制数据库ID并将其添加到您的<code class="fe nq nr ns nh b">.env</code>文件中。此时，您的<code class="fe nq nr ns nh b">.env</code>文件应该如下所示:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="fbc7" class="nl mh iq nh b gy nm nn l no np">NOTION_TOKEN=&lt;your_token&gt;<br/>DB_ID=&lt;your_DB_ID&gt;</span></pre><p id="2214" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您已经完成了项目中概念客户端的配置。下一步是创建路线和业务逻辑。</p><h1 id="9d3c" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">添加FastifyJS</h1><p id="941f" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">打开文件<code class="fe nq nr ns nh b">app.js</code>，在文件顶部导入FastifyJS。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="7669" class="nl mh iq nh b gy nm nn l no np">const app = require('fastify')({ logger: true });</span></pre><p id="4200" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，再次导入“dotenv”包，这样就可以使用在<code class="fe nq nr ns nh b">.env.</code>文件中定义的端口。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="653e" class="nl mh iq nh b gy nm nn l no np">require('dotenv').config();</span></pre><p id="87ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是注册路由，即使您还没有编写它们。在导入之后，添加以下行:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="fb0b" class="nl mh iq nh b gy nm nn l no np">app.register(require('./src/routes/routes'));</span></pre><p id="9e82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用上面的代码行，您注册了所有的路由。也就是说，您使路线可用，以便用户可以访问它们。</p><p id="b7e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，监听一个端口，以便运行应用程序。在文件底部添加以下代码:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="f476" class="nl mh iq nh b gy nm nn l no np">app.listen(process.env.PORT, (err, addr) =&gt; {<br/>    if (err) {<br/>        app.log.error(err);<br/>        process.exit(1);<br/>    }<br/><br/>    app.log.info(`Your server is listening on port ${process.env.PORT} 🧨`);<br/>});</span></pre><p id="f067" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应用程序监听您在<code class="fe nq nr ns nh b">.env</code>文件中定义的端口。如果有错误，它会记录错误。否则，它会在控制台中输出服务器正在运行以及运行在哪个端口上。</p><p id="0a30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在您的<code class="fe nq nr ns nh b">.env</code>文件中添加端口号— 3333。这个端口号只是一个例子；您可以使用任何想要的端口号。至此，您的<code class="fe nq nr ns nh b">.env</code>文件应该如下所示:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="70f8" class="nl mh iq nh b gy nm nn l no np">NOTION_TOKEN=&lt;your_token&gt;<br/>DB_ID=&lt;your_DB_ID&gt;<br/>PORT=3333</span></pre><p id="b5a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查<a class="ae kv" href="https://gist.github.com/catalinpit/e63824b86d13a736fd8efa6cccadde15" rel="noopener ugc nofollow" target="_blank">这个要点</a>看看你的文件<code class="fe nq nr ns nh b">app.js</code>应该如何查找到这一点。</p><h1 id="1196" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">建造路线</h1><p id="bdf1" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">下一步是创建路线。它们的目的是允许人们执行CRUD操作(<em class="oh">除了在本教程中删除数据</em>)。</p><p id="935c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，转到<code class="fe nq nr ns nh b">src/routes/routes.js</code>，在文件顶部导入控制器。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="03db" class="nl mh iq nh b gy nm nn l no np">const controller = require('../controllers/controllers');</span></pre><p id="09bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">即使您还没有编写业务逻辑，您也会需要它。之后，创建<code class="fe nq nr ns nh b">routes</code>函数并将其导出:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="efca" class="nl mh iq nh b gy nm nn l no np">async function routes(app, opts) {<br/>    // the code for routes go here<br/>};<br/><br/>module.exports = routes;</span></pre><p id="dc6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe nq nr ns nh b">routes</code>方法中，您配置应用程序的端点。对于每条路线，您至少要指定:</p><ul class=""><li id="1d23" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><strong class="ky ir"> HTTP方法</strong> —例如，使用<code class="fe nq nr ns nh b">GET</code> HTTP动词返回数据库中的所有项目。</li><li id="f789" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir"> URL </strong> —例如，您可以使用端点<code class="fe nq nr ns nh b">/job/applications</code>返回所有的工作申请。</li><li id="e8e0" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">处理程序</strong> —代表业务逻辑。例如，当人们访问端点<code class="fe nq nr ns nh b">/job/applications</code>时会发生什么。</li></ul><p id="e2ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您已经理解了FastifyJS中的路由是如何工作的，让我们来构建第一条路由。</p><h2 id="2015" class="nl mh iq bd mi nu nv dn mm nw nx dp mq lf ny nz ms lj oa ob mu ln oc od mw oe bi translated">显示所有工作申请</h2><p id="7b29" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">当用户向端点<code class="fe nq nr ns nh b">/job/applications</code>发出<code class="fe nq nr ns nh b">GET</code>请求时，第一条路由显示所有的工作申请。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="9c96" class="nl mh iq nh b gy nm nn l no np">app.route({<br/>    method: 'GET',<br/>    url: '/job/applications',<br/>    handler: controller.getAllApplications<br/>});</span></pre><h2 id="b9de" class="nl mh iq bd mi nu nv dn mm nw nx dp mq lf ny nz ms lj oa ob mu ln oc od mw oe bi translated">获得特定的工作申请</h2><p id="fccf" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">第二条路线只显示了一份工作申请。当用户向<code class="fe nq nr ns nh b">/job/applications/:id</code>路由发出<code class="fe nq nr ns nh b">GET</code>请求时，它只显示其ID与URL中提供的ID相匹配的作业应用程序。</p><p id="76f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第一条路线后编写以下代码:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="4593" class="nl mh iq nh b gy nm nn l no np">app.route({<br/>    method: 'GET',<br/>    url: '/job/applications/:id',<br/>    handler: controller.getApplication<br/>});</span></pre><h2 id="c1f1" class="nl mh iq bd mi nu nv dn mm nw nx dp mq lf ny nz ms lj oa ob mu ln oc od mw oe bi translated">筛选工作申请</h2><p id="d8b3" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">第三种方法允许用户按公司名称过滤工作申请。用户可以使用名为<code class="fe nq nr ns nh b">company</code>的查询参数来过滤结果。</p><p id="5770" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">URL的一个例子是<code class="fe nq nr ns nh b">/job/applications/filter?company="CatalinSoft"</code>。因此，通过向该URL发出一个<code class="fe nq nr ns nh b">GET</code>请求，应用程序只返回“CatalinSoft”公司的工作申请。</p><p id="17b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe nq nr ns nh b">routes.js</code>中编写以下代码:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="94bd" class="nl mh iq nh b gy nm nn l no np">app.route({<br/>    method: 'GET',<br/>    url: '/job/applications/filter',<br/>    handler: controller.filterApplications<br/>});</span></pre><h2 id="ef45" class="nl mh iq bd mi nu nv dn mm nw nx dp mq lf ny nz ms lj oa ob mu ln oc od mw oe bi translated">添加新的工作申请</h2><p id="8f20" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">第四种方法允许用户发出<code class="fe nq nr ns nh b">POST</code>请求，将工作申请添加到文档中。当您使用适当的主体向端点<code class="fe nq nr ns nh b">'/job/applications'</code>发出<code class="fe nq nr ns nh b">POST</code>请求时，它会将工作申请添加到概念文档中。</p><p id="a4c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编写以下代码:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="661c" class="nl mh iq nh b gy nm nn l no np">app.route({<br/>    method: 'POST',<br/>    url: '/job/applications',<br/>    handler: controller.addApplication<br/>});</span></pre><h2 id="3d2f" class="nl mh iq bd mi nu nv dn mm nw nx dp mq lf ny nz ms lj oa ob mu ln oc od mw oe bi translated">更新现有应用程序</h2><p id="1e6f" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">最后，您有一个允许人们更新现有工作申请的途径。用适当的主体向<code class="fe nq nr ns nh b">/job/applications/:id</code>发出一个<code class="fe nq nr ns nh b">PATCH</code>请求，您将更新记录。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="d06a" class="nl mh iq nh b gy nm nn l no np">app.route({<br/>    method: 'PATCH',<br/>    url: '/job/applications/:id',<br/>    handler: controller.updateApplication<br/>});</span></pre><p id="41eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些是所有的路线。如你所见，它们遵循相同的模式:</p><ol class=""><li id="2371" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr oi ly lz ma bi translated">您指定HTTP方法。</li><li id="303c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oi ly lz ma bi translated">您可以添加人们可以提出请求的URL。</li><li id="f66b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oi ly lz ma bi translated">您提供了处理程序，当向该路由发出请求时会触发该处理程序。</li></ol><p id="cb9d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，您可能已经注意到没有“删除”路径。这是因为概念API不允许你删除资源。</p><p id="393a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查此要点<a class="ae kv" href="https://gist.github.com/catalinpit/c865810e9a5c4d2261e1fa3133bd143b" rel="noopener ugc nofollow" target="_blank">以查看完整的<code class="fe nq nr ns nh b">routes.js</code>文件。</a></p><h1 id="bc55" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">添加业务逻辑</h1><p id="dc19" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">教程的最后一步是构建业务逻辑。业务逻辑指定当向特定端点发出特定HTTP请求时会发生什么。</p><p id="4e50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从在<code class="fe nq nr ns nh b">controllers.js</code>文件中导入概念客户端开始。打开文件，在文档顶部添加以下行:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="821d" class="nl mh iq nh b gy nm nn l no np">const { notion } = require('../notion/client');</span></pre><p id="08f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您可以使用客户机来操作数据。</p><h2 id="075e" class="nl mh iq bd mi nu nv dn mm nw nx dp mq lf ny nz ms lj oa ob mu ln oc od mw oe bi translated">检索所有工作申请</h2><p id="5696" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">您编写的第一个方法是返回所有工作申请的方法。在<code class="fe nq nr ns nh b">controllers.js</code>中编写以下代码:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="e922" class="nl mh iq nh b gy nm nn l no np">const getAllApplications = async (req, res) =&gt; {<br/>    const data = await notion.databases.query({<br/>        database_id: process.env.DB_ID<br/>    });<br/>}</span></pre><p id="33fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，您使用概念客户机来查询数据库。上面这段代码返回一个对象，该对象又包含一个数组，该数组包含数据库中的所有页面。</p><p id="051b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是您运行上述代码后得到的结果:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="6887" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从这个响应中，字段<code class="fe nq nr ns nh b">results</code>是您感兴趣的字段。这是包含数据库中所有页面的数组。</p><p id="fd6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为您有一个数组，所以您需要循环遍历它并只返回页面。回到方法<code class="fe nq nr ns nh b">getAllApplications</code>并添加剩余的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="40c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在代码的第二部分，映射到<code class="fe nq nr ns nh b">results</code>数组并返回一个自定义对象数组。这些自定义对象包含以下信息:</p><ul class=""><li id="2b7f" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">身份证</li><li id="aa68" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">当它被创造的时候</li><li id="d6be" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">上次更新的时间</li><li id="d47d" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">公司名称</li><li id="a066" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">你申请的职位</li><li id="2078" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">应用程序的状态</li><li id="b218" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">申请截止日期</li><li id="3c00" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">职位描述</li><li id="b6c8" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">附加注释</li></ul><p id="2e7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们向<code class="fe nq nr ns nh b">localhost:3333/job/applications</code>发出一个<code class="fe nq nr ns nh b">GET</code>请求，看看会发生什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/e7a672563c05af6e15e2a5b211b27b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*f7CQ_n_B6RbpPLGg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图7。</p></figure><p id="14aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图7展示了发出请求后会发生什么。您可以看到它返回了一个对象数组，这正是您在方法<code class="fe nq nr ns nh b">getAllApplications</code>中构造它们的方式。</p><h2 id="4bb1" class="nl mh iq bd mi nu nv dn mm nw nx dp mq lf ny nz ms lj oa ob mu ln oc od mw oe bi translated">获取特定的应用程序</h2><p id="7b91" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">下一步是添加仅检索特定工作申请的业务逻辑。这一次，你用不同的方法。不是查询数据库，而是检索特定的页面。</p><p id="f19b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在你的文件<code class="fe nq nr ns nh b">controllers.js</code>中写下下面的方法:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="0024" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该方法从URL获取页面的ID。因此，如果您向URL <code class="fe nq nr ns nh b">http://localhost:3333/job/applications/8e8e8f35-09ac-40fd-92a2-a3743b271e2e</code>发出一个<code class="fe nq nr ns nh b">GET</code>请求，该方法将从中获取页面ID。</p><p id="6df8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，它返回其ID与URL中提供的ID相匹配的页面。让我们提出一个请求，看看会发生什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/6849709e998c42040b7719399b79b161.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y2ClCfWFfiUJOVrH.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图8。</p></figure><p id="e4d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图8展示了它返回您在方法<code class="fe nq nr ns nh b">getApplication</code>中定义的定制页面对象。</p><h2 id="d987" class="nl mh iq bd mi nu nv dn mm nw nx dp mq lf ny nz ms lj oa ob mu ln oc od mw oe bi translated">过滤应用</h2><p id="e437" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">概念客户端还允许您过滤数据。例如，您可能希望按公司名称过滤结果。因此，您可以在URL中传递公司名称，它将只返回该公司的工作申请。</p><p id="26e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe nq nr ns nh b">controllers.js</code>中编写以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="b18e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种方法类似于第一种方法— <code class="fe nq nr ns nh b">getAllApplications</code>。唯一的区别是，当您查询概念数据库时，您还传递了<code class="fe nq nr ns nh b">filter</code>属性。</p><p id="3138" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">查询数据库返回一个list对象，该对象也包含一个名为<code class="fe nq nr ns nh b">results</code>的数组。<code class="fe nq nr ns nh b">results</code>数组包含所有匹配的记录。因此，您映射到<code class="fe nq nr ns nh b">results</code>数组并返回一个带有自定义对象的数组。</p><p id="f549" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如前所述，您按公司名称过滤结果。如果你向URL <code class="fe nq nr ns nh b">http://localhost:3333/job/applications/filter?company=Notion</code>发出一个<code class="fe nq nr ns nh b">GET</code>请求，你只会得到一个职位申请的概念。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/838c4489533f8416b5af9f576b9c5401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IvhNX59HBabyl8oA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图9。</p></figure><p id="8517" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图9说明了对<code class="fe nq nr ns nh b">http://localhost:3333/job/applications/filter?company=Notion</code>的一个<code class="fe nq nr ns nh b">GET</code>请求。您可以看到它只返回匹配<code class="fe nq nr ns nh b">?company=Notion</code>的记录。这就是求职申请的全部概念。</p><h2 id="212b" class="nl mh iq bd mi nu nv dn mm nw nx dp mq lf ny nz ms lj oa ob mu ln oc od mw oe bi translated">添加新应用程序</h2><p id="b6ff" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">到目前为止，您可以:</p><ul class=""><li id="8aa2" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">检索并显示所有工作申请</li><li id="e449" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">访问特定的职务申请</li><li id="21e7" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">按公司名称过滤数据</li></ul><p id="e524" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是你也需要添加新的工作申请，对吗？因此，在本步骤中，您将创建添加新职务申请的路线。</p><p id="1fe0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，在<code class="fe nq nr ns nh b">controllers.js</code>中编写以下代码，然后我将解释它的作用:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="c700" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的代码片段中，您使用概念客户端调用了<code class="fe nq nr ns nh b">create</code>方法，并传递了两件事情:</p><ol class=""><li id="9de6" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr oi ly lz ma bi translated"><strong class="ky ir">数据库父级</strong> —传递数据库父级。您可以通过使用来自<code class="fe nq nr ns nh b">.env</code>文件的数据库ID来实现。</li><li id="87b0" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oi ly lz ma bi translated"><strong class="ky ir">属性</strong> —这些属性表示概念文档字段。</li></ol><p id="3ac8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，对于每个属性，添加在请求体中传递的属性。使用以下数据发出<code class="fe nq nr ns nh b">POST</code>请求:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="d21d" class="nl mh iq nh b gy nm nn l no np">{<br/>    "company": "CatalinsTech",<br/>    "position": "Technical Writer",<br/>    "status": "Applied",<br/>    "deadline": "2021-12-12",<br/>    "url": "https://catalins.tech",<br/>    "comments": "I hope to get the job"<br/>}</span></pre><p id="ebd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">向概念文档添加新的职务申请。通过检查<a class="ae kv" href="https://www.notion.so/6c73f893f4c74718982504d36a6c43bb?v=345b93c08725486097551607ef394b8c" rel="noopener ugc nofollow" target="_blank">此链接</a>可以看到工作申请已被添加。</p><p id="121f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图10展示了对URL <code class="fe nq nr ns nh b"><a class="ae kv" href="http://localhost:3333/job/applications." rel="noopener ugc nofollow" target="_blank">http://localhost:3333/job/applications</a></code> <a class="ae kv" href="http://localhost:3333/job/applications." rel="noopener ugc nofollow" target="_blank">的POST请求。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/de289026c7ddbc7f5c68cdca5f32223b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZPforeK7PW1FWJEX.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图10。</p></figure><h2 id="0a69" class="nl mh iq bd mi nu nv dn mm nw nx dp mq lf ny nz ms lj oa ob mu ln oc od mw oe bi translated">更新现有应用程序</h2><p id="2b83" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">更新现有的工作申请与添加新的工作申请非常相似。有两个主要区别:</p><ul class=""><li id="197f" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">你使用<strong class="ky ir">更新</strong>的方法</li><li id="34e2" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">您传递的是页面ID 而不是数据库ID </li></ul><p id="d371" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您在URL中传递页面ID。例如，您将向<code class="fe nq nr ns nh b">/job/applications/:id</code> URL发出一个<code class="fe nq nr ns nh b">PATCH</code>请求，在那里用文档的实际ID替换<code class="fe nq nr ns nh b">:id</code>。您可以从请求参数- <code class="fe nq nr ns nh b">req.params.id</code>中的URL访问ID。</p><p id="5118" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe nq nr ns nh b">controllers.js</code>文件中写入以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="bcc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们修改添加到公司<code class="fe nq nr ns nh b">CatalinsTech</code>的最后一份工作申请。更新以下字段:</p><ul class=""><li id="36ab" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">状态—将其更新为<strong class="ky ir">已签署</strong></li><li id="d92c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">截止日期—将其更新为<strong class="ky ir">2021–05–27</strong></li><li id="481b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">评论—更新为<strong class="ky ir">我得到了工作</strong></li></ul><p id="f29e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，用下面的JSON数据向<code class="fe nq nr ns nh b">http://localhost:3333/job/applications/32f1f59b-9176-4b4b-ab52-1ce66a77df25</code>发出一个<code class="fe nq nr ns nh b">PATCH</code>请求:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="d813" class="nl mh iq nh b gy nm nn l no np">{<br/>    "company": "CatalinsTech",<br/>    "position": "Technical Writer",<br/>    "status": "Signed",<br/>    "deadline": "2021-05-27",<br/>    "url": "https://catalins.tech",<br/>    "comments": "I got the job"<br/>}</span></pre><p id="a135" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图11显示了请求成功。工作申请更新了，你可以在这里查看<a class="ae kv" href="https://www.notion.so/6c73f893f4c74718982504d36a6c43bb?v=345b93c08725486097551607ef394b8c" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/f44f1d9ceea4a13124f96c76ca46d38c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*boiUPh0_c80vlnZ5.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图11。</p></figure><p id="cd13" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，这就是如何以编程方式更新您现有的职务申请。</p><h2 id="3714" class="nl mh iq bd mi nu nv dn mm nw nx dp mq lf ny nz ms lj oa ob mu ln oc od mw oe bi translated">导出控制器</h2><p id="feae" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">在使用控制器之前，您需要导出它们。您需要导出它们的原因是您在<code class="fe nq nr ns nh b">routes.js</code>文件中使用它们。</p><p id="c689" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在名为<code class="fe nq nr ns nh b">controllers.js</code>的文件的末尾添加以下代码:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="91be" class="nl mh iq nh b gy nm nn l no np">module.exports = {<br/>    getAllApplications,<br/>    getApplication,<br/>    addApplication,<br/>    updateApplication,<br/>    filterApplications<br/>};</span></pre><p id="da07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您可以运行应用程序并使用它了！</p><p id="e9c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查<a class="ae kv" href="https://gist.github.com/catalinpit/5f419e72a6b56bf0bd51e1f1b700f1c0" rel="noopener ugc nofollow" target="_blank">此要点</a>以查看完整的<code class="fe nq nr ns nh b">controllers.js</code>文件。</p><h1 id="639d" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">如何运行应用程序</h1><p id="2d8b" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">您可以通过运行根文件夹中的<code class="fe nq nr ns nh b">node app.js</code>来启动应用程序。</p><p id="f401" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦运行了，应用程序应该会启动，您就可以发出HTTP请求了。但是，如果您从GitHub克隆应用程序，您需要首先安装依赖项。您可以通过运行以下命令来实现:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="be29" class="nl mh iq nh b gy nm nn l no np">npm install<br/>node app.js</span></pre><h1 id="7046" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">结论</h1><p id="f6c3" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">教程到此结束！您构建了一个Node.js API，它允许您:</p><ol class=""><li id="a783" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr oi ly lz ma bi translated">创建和更新工作申请</li><li id="df04" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oi ly lz ma bi translated">检索所有工作申请</li><li id="c5cc" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oi ly lz ma bi translated">仅访问特定的职务申请</li><li id="2196" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oi ly lz ma bi translated">按公司名称过滤求职申请</li></ol><p id="98ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不幸的是，概念API不允许我们删除资源。这就是为什么没有<code class="fe nq nr ns nh b">DELETE</code>端点的原因。</p><p id="7d9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">查看</strong> <a class="ae kv" href="https://github.com/catalinpit/notion-nodejs-api" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> GitHub资源库</strong> </a> <strong class="ky ir">上的完整应用代码。</strong></p></div></div>    
</body>
</html>