<html>
<head>
<title>Micro Frontends Using Single-SPA and Module Federation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用单SPA和模块联合的微前端</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/micro-frontends-using-single-spa-and-module-federation-81ec27d03aee?source=collection_archive---------0-----------------------#2021-01-11">https://betterprogramming.pub/micro-frontends-using-single-spa-and-module-federation-81ec27d03aee?source=collection_archive---------0-----------------------#2021-01-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="144f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们一起用微前端构建一个应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1a2a8e3645a62dec5670a737550b114a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3PnmLudnvuILcXlyHOqRg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3c12" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我将带您了解如何在Webpack中实现具有单spa和模块联合的微前端应用程序。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="f7c3" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">示例存储库</h1><p id="b631" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">以下是GitHub的最终代码:</p><div class="my mz gp gr na nb"><a href="https://github.com/manakuro/micro-frontends-single-spa-module-federation" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">mana kuro/微前端-单spa-模块-联盟</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">使用单spa和模块联合的微前端应用程序-manakuro/微前端-单spa-模块-联合</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ks nb"/></div></div></a></div></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="e7bf" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">内容</h1><ul class=""><li id="128b" class="nq nr it la b lb mt le mu lh ns ll nt lp nu lt nv nw nx ny bi translated"><a class="ae nz" href="#f212" rel="noopener ugc nofollow">微前端</a></li><li id="9a3c" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">法国温泉</li><li id="78a3" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated"><a class="ae nz" href="#a437" rel="noopener ugc nofollow">web pack中的模块联盟</a></li><li id="e4a8" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated"><a class="ae nz" href="#dc4b" rel="noopener ugc nofollow">应用概述</a></li></ul></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="f212" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">微前端</h1><p id="07a4" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">微前端从2016年开始出现在前端开发中。简而言之，微前端的想法是将monolith应用程序分解成更小的部分，使其更容易维护。</p><p id="aad1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">微前端允许您:</p><ul class=""><li id="0bd1" class="nq nr it la b lb lc le lf lh of ll og lp oh lt nv nw nx ny bi translated">独立部署</li><li id="da1c" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">在一个地方使用多个UI框架(React、Vue.js和Angular)</li><li id="631d" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">从大型代码库中分离出一部分UI组件</li></ul><p id="9c34" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还有一些缺点，如初始设置的复杂性和由重复代码引起的性能问题，但是单spa和模块联合可以解决这些问题</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="38c8" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">单温泉</h1><p id="7238" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated"><a class="ae nz" href="https://single-spa.js.org/docs/getting-started-overview" rel="noopener ugc nofollow" target="_blank"> single-spa </a>是一个框架，可以让你快速搭建一个微前端app。</p><p id="63bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过抽象整个应用程序的生命周期，single-spa允许您在同一个页面上使用多个UI框架。</p><p id="6d1e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它还能够:</p><ul class=""><li id="9aae" class="nq nr it la b lb lc le lf lh of ll og lp oh lt nv nw nx ny bi translated">独立部署</li><li id="db6c" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">执行延迟加载</li><li id="6281" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">引入新框架，无需对现有应用程序进行任何修改</li></ul><p id="4505" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用single-spa，您有两种选择来选择共享依赖关系的生态系统:</p><ul class=""><li id="2d5e" class="nq nr it la b lb lc le lf lh of ll og lp oh lt nv nw nx ny bi translated"><a class="ae nz" href="https://github.com/WICG/import-maps" rel="noopener ugc nofollow" target="_blank">导入地图</a></li><li id="1903" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">Webpack中的模块联合</li></ul><p id="ab6e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">导入映射的思想是将JavaScript导入语句的URL映射到库。例如，如果将<code class="fe oi oj ok ol b">moment</code>导入到代码中，</p><pre class="kj kk kl km gt om ol on oo aw op bi"><span id="da96" class="oq mc it ol b gy or os l ot ou">import moment from "moment";</span></pre><p id="91ec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您必须向浏览器提供以下地图:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="7d71" class="oy mc it ol b be oz pa l pb ou">&lt;script type="importmap"&gt;<br/>{<br/>  "imports": {<br/>    "moment": "/node_modules/moment/src/moment.js"<br/>  }<br/>}<br/>&lt;/script&gt;</span></pre><p id="c049" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这可以控制导入获取哪些URL。</p><p id="0164" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有了这个新功能和webpack externals，可以排除一些库，它将在应用程序中生成没有重复模块的捆绑包。</p><p id="b8fd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是我们不会在我们的应用程序中使用它。相反，我们将利用Webpack 5中的新技术。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="a437" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">Webpack中的模块联合</h1><p id="afa2" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated"><a class="ae nz" href="https://webpack.js.org/concepts/module-federation/" rel="noopener ugc nofollow" target="_blank">模块联合</a>是在Webpack 5中引入的。它的主要目的是在应用程序之间共享代码和库。</p><p id="31bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过模块联合，任何JavaScript代码——比如业务逻辑或库，以及状态管理代码——都可以在应用程序之间共享。它可以让多个微前端应用程序一起工作，就像你开发一个整体应用程序一样。</p><p id="a54e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可能想知道微前端和模块联合之间的区别。它们实际上覆盖了很多相同的领域。但是还是有区别的。</p><p id="0ae0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">微前端的唯一目的是在应用之间共享UI，而不是JavaScript逻辑。因此，捆绑的代码可以包含重复的代码。</p><p id="9362" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">模块联合的目的是在应用程序之间共享JavaScript代码，而不是UI。因此，共享代码可以在应用程序中使用。</p><p id="dd15" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它们实际上是互补的。因此，通过微前端应用中的模块联合，您可以避免重复的代码，并在整个应用中提供共享的UI组件。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="dc4b" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">应用程序概述</h1><p id="5cda" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">到目前为止，我们已经介绍了微前端和模块联合的基本概念。</p><p id="8d71" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们将通过实现一个简单的演示应用程序来了解它们是如何协同工作的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/da8fe219d778821c9b2c2a780a024d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1I7AeWyemjh3MzfBoGI-3w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">演示应用程序</p></figure><p id="a8a5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们来看一下该应用程序的组成概述:</p><ul class=""><li id="05a7" class="nq nr it la b lb lc le lf lh of ll og lp oh lt nv nw nx ny bi translated">一个处理所有微前端应用程序的家庭应用程序。</li><li id="f202" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">一个导航应用程序，显示React制作的页眉和页脚UI。</li><li id="966a" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">一个body app，展示Vue.js做的页面的body元素。</li></ul></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="3892" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">设置根package.json</h1><p id="f8d6" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">在实现微前端app之前，我们在根目录下创建一个package.json。这三个应用程序作为monorepo包含在一个repo中，因此我们将使用<a class="ae nz" href="https://classic.yarnpkg.com/en/docs/workspaces/" rel="noopener ugc nofollow" target="_blank"> yarn workspaces </a>在整个应用程序中共享一些包。</p><p id="8b09" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在根目录下创建一个<code class="fe oi oj ok ol b">package.json</code>，像这样:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="c400" class="oy mc it ol b be oz pa l pb ou">{<br/>  "name": "micro-frontend",<br/>  "version": "1.0.0",<br/>  "private": true,<br/>  "workspaces": [<br/>    "packages/*"<br/>  ],<br/>  "scripts": {<br/>    "start": "concurrently \"wsrun --parallel start\""<br/>  },<br/>  "devDependencies": {<br/>    "concurrently": "^5.3.0",<br/>    "wsrun": "^5.2.4",<br/>    "@types/node": "^14.14.17",<br/>    "@typescript-eslint/eslint-plugin": "^4.11.1",<br/>    "@typescript-eslint/parser": "^4.11.1",<br/>    "babel-eslint": "^10.1.0",<br/>    "eslint": "7.16.0",<br/>    "eslint-config-prettier": "^7.1.0",<br/>    "eslint-config-react-app": "^6.0.0",<br/>    "eslint-formatter-friendly": "^7.0.0",<br/>    "eslint-plugin-babel": "^5.3.1",<br/>    "eslint-plugin-flowtype": "5.2.0",<br/>    "eslint-plugin-import": "2.22.1",<br/>    "eslint-plugin-jsx-a11y": "6.4.1",<br/>    "eslint-plugin-prettier": "^3.3.0",<br/>    "eslint-plugin-react": "7.22.0",<br/>    "eslint-plugin-react-hooks": "4.2.0",<br/>    "prettier": "^2.2.1",<br/>    "typescript": "4.1.3",<br/>    "single-spa": "^5.8.3",<br/>    "webpack": "^5.72.0",<br/>    "webpack-cli": "^4.9.2",<br/>    "webpack-dev-server": "^4.8.1",<br/>    "html-webpack-plugin": "^5.5.0"<br/>  }<br/>}</span></pre><p id="b399" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，安装依赖项。</p><pre class="kj kk kl km gt om ol on oo aw op bi"><span id="37ba" class="oq mc it ol b gy or os l ot ou">yarn</span></pre></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="e50f" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">一款家庭应用</h1><p id="24b3" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">接下来，我们创建一个home应用程序来协调每个微前端应用程序。home处理呈现HTML页面和注册应用程序的JavaScript的任务。</p><p id="40e5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们来看看家庭结构:</p><pre class="kj kk kl km gt om ol on oo aw op bi"><span id="4882" class="oq mc it ol b gy or os l ot ou">├── packages<br/>│   └── home<br/>│       ├── package.json<br/>│       ├── public<br/>│       │   └── index.html<br/>│       ├── src<br/>│       │   └── index.ts<br/>│       ├── tsconfig.json<br/>│       └── webpack.config.js</span></pre><p id="8a4d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们逐步创建这些文件。</p><p id="ec31" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，创建一个<code class="fe oi oj ok ol b">package.json</code>:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="776a" class="oy mc it ol b be oz pa l pb ou">{<br/>  "name": "home",<br/>  "scripts": {<br/>    "start": "webpack serve --port 3000",<br/>    "build": "webpack --mode=production"<br/>  },<br/>  "version": "1.0.0",<br/>  "private": true,<br/>  "devDependencies": {<br/>    "@babel/core": "^7.8.6",<br/>    "@babel/preset-typescript": "^7.12.7",<br/>    "babel-loader": "^8.2.2"<br/>  }<br/>}</span></pre><p id="b60d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">又创造了一个<code class="fe oi oj ok ol b">webpack.config.js</code>:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="3081" class="oy mc it ol b be oz pa l pb ou">const HtmlWebpackPlugin = require('html-webpack-plugin')<br/>const ModuleFederationPlugin = require('webpack/lib/container/ModuleFederationPlugin')<br/>const path = require('path')<br/>const outputPath = path.resolve(__dirname, 'dist')<br/><br/>module.exports = {<br/>  entry: './src/index',<br/>  cache: false,<br/><br/>  mode: 'development',<br/>  devtool: 'source-map',<br/><br/>  optimization: {<br/>    minimize: false,<br/>  },<br/><br/>  output: {<br/>    publicPath: 'http://localhost:3000/',<br/>  },<br/><br/>  resolve: {<br/>    extensions: ['.jsx', '.js', '.json', '.ts', '.tsx'],<br/>  },<br/><br/>  devServer: {<br/>    static: {<br/>      directory: outputPath,<br/>    },<br/>  },<br/><br/>  module: {<br/>    rules: [<br/>      {<br/>        test: /\.tsx?$/,<br/>        loader: require.resolve('babel-loader'),<br/>        options: {<br/>          presets: [require.resolve('@babel/preset-typescript')],<br/>        },<br/>      },<br/>    ],<br/>  },<br/><br/>  plugins: [<br/>    new ModuleFederationPlugin({<br/>      name: 'home',<br/>      library: { type: 'var', name: 'home' },<br/>      filename: 'remoteEntry.js',<br/>      remotes: {},<br/>      exposes: {},<br/>      shared: [],<br/>    }),<br/>    new HtmlWebpackPlugin({<br/>      template: './public/index.html',<br/>    }),<br/>  ],<br/>}</span></pre><p id="4bd4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是TypeScipt的基本配置，但是您可以在plugins部分找到导入的模块联邦。</p><p id="0ab7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了理解它是如何工作的，我们将讨论三个基本概念。</p><h2 id="970f" class="oq mc it bd md pd pe dn mh pf pg dp ml lh ph pi mn ll pj pk mp lp pl pm mr pn bi translated">遥控器</h2><p id="1690" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated"><code class="fe oi oj ok ol b">remotes</code>字段使用联邦微前端应用程序的名称来消费代码。在这种情况下，主页应用程序将使用导航应用程序和正文应用程序，因此我们需要在<code class="fe oi oj ok ol b">remotes</code>字段中指定它们的名称，如下所示:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="bf85" class="oy mc it ol b be oz pa l pb ou">remotes: {<br/>  navigation: 'navigation',<br/>  body: 'body',<br/>},</span></pre><p id="2bbc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当实现一个导航和主体应用程序时，我们将进入更多的细节。</p><h2 id="a728" class="oq mc it bd md pd pe dn mh pf pg dp ml lh ph pi mn ll pj pk mp lp pl pm mr pn bi translated">暴露</h2><p id="8640" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated"><code class="fe oi oj ok ol b">exposes</code>字段用于将文件导出到其他应用程序。密钥应该是在其他应用程序中使用的导出名称。例如，如果您从代码中导出组件<code class="fe oi oj ok ol b">Button</code>,那么可以这样写:</p><pre class="kj kk kl km gt om ol on oo aw op bi"><span id="3e1a" class="oq mc it ol b gy or os l ot ou">exposes: {<br/>  Button: './src/Button',<br/>},</span></pre><h2 id="4d1e" class="oq mc it bd md pd pe dn mh pf pg dp ml lh ph pi mn ll pj pk mp lp pl pm mr pn bi translated">共享的</h2><p id="e794" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">这个<code class="fe oi oj ok ol b">shared</code>是支持导出文件的所有共享依赖项的列表。例如，如果您导出Vue.js组件，您必须在共享部分列出<code class="fe oi oj ok ol b">vue</code>,就像这样:</p><pre class="kj kk kl km gt om ol on oo aw op bi"><span id="695e" class="oq mc it ol b gy or os l ot ou">shared: ['vue'],</span></pre><p id="7565" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将防止应用程序包含重复的库，并将在应用程序之间共享单个实例，即使webpack编译器是完全独立的。</p><p id="f081" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们将创建<code class="fe oi oj ok ol b">public/index.html</code>:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="f7bb" class="oy mc it ol b be oz pa l pb ou">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>    &lt;link rel="stylesheet" href="https://cdn.rawgit.com/filipelinhares/ress/master/dist/ress.min.css" /&gt;<br/>    &lt;link<br/>      rel="stylesheet"<br/>      href="https://fonts.googleapis.com/css?family=Oswald:300,400,500,600,700|Roboto:400,700&amp;display=swap"<br/>    /&gt;<br/>  &lt;style&gt;<br/>    html, body {<br/>      scroll-behavior: smooth;<br/>      width: 100%;<br/>      height: 100%;<br/>    }<br/><br/>    body {<br/>      font-family: 'Roboto';<br/>    }<br/><br/>    table {<br/>      border-collapse: collapse;<br/>      border-spacing: 0;<br/>    }<br/><br/>    ul {<br/>      list-style-type: none;<br/>    }<br/><br/>    main &gt; * &gt; * {<br/>      height: 100%;<br/>    }<br/>  &lt;/style&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;div style="height: 100%; display: flex; flex-direction: column;"&gt;<br/>&lt;/div&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="5e5a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并创建一个<code class="fe oi oj ok ol b">src/index.ts</code>:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="881e" class="oy mc it ol b be oz pa l pb ou">import { start } from 'single-spa'<br/><br/>start()</span></pre><p id="92f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该文件将用于注册家庭应用中使用的微前端应用。现在，我们只是执行<code class="fe oi oj ok ol b">start</code>函数来提升应用程序。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="6641" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">导航应用程序</h1><p id="be7f" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">现在我们已经设置了home应用程序，让我们实现导航应用程序。</p><p id="f318" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">导航应用程序的结构如下:</p><pre class="kj kk kl km gt om ol on oo aw op bi"><span id="0d1d" class="oq mc it ol b gy or os l ot ou">├── packages<br/>│   ├── home<br/>│   │   ├── package.json<br/>│   │   ├── public<br/>│   │   │   └── index.html<br/>│   │   ├── src<br/>│   │   │   └── index.ts<br/>│   │   ├── tsconfig.json<br/>│   │   └── webpack.config.js<br/><strong class="ol iu">│   └── navigation<br/>│       ├── package.json<br/>│       ├── src<br/>│       │   ├── Footer.tsx<br/>│       │   ├── Header.tsx<br/>│       │   └── index.ts<br/>│       ├── tsconfig.json<br/>│       ├── webpack.config.js</strong></span></pre><p id="8bb0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将把<code class="fe oi oj ok ol b">Footer</code>和<code class="fe oi oj ok ol b">Header</code>组件导出到home应用程序。</p><p id="c673" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，我们首先创建这些文件。创建一个<code class="fe oi oj ok ol b">navigation/package.json</code>:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="0781" class="oy mc it ol b be oz pa l pb ou">{<br/>  "name": "navigation",<br/>  "scripts": {<br/>    "start": "webpack serve --port 3001",<br/>    "build": "webpack --mode=production"<br/>  },<br/>  "version": "1.0.0",<br/>  "private": true,<br/>  "devDependencies": {<br/>    "@types/react": "^17.0.0",<br/>    "@types/react-dom": "^17.0.0",<br/>    "@babel/core": "^7.8.6",<br/>    "@babel/preset-react": "^7.12.10",<br/>    "@babel/preset-typescript": "^7.12.7",<br/>    "babel-loader": "^8.2.2",<br/>    "single-spa-react": "^3.2.0"<br/>  },<br/>  "dependencies": {<br/>    "react": "^17.0.1",<br/>    "react-dom": "^17.0.1"<br/>  }<br/>}</span></pre><p id="1715" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">React将制作一个导航应用程序，因此安装依赖项并创建一个<code class="fe oi oj ok ol b">navigation/webpack.config.js</code>:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="811f" class="oy mc it ol b be oz pa l pb ou">const ModuleFederationPlugin = require('webpack/lib/container/ModuleFederationPlugin')<br/>const path = require('path')<br/>const outputPath = path.resolve(__dirname, 'dist')<br/><br/>module.exports = {<br/>  entry: './src/index',<br/>  cache: false,<br/><br/>  mode: 'development',<br/>  devtool: 'source-map',<br/><br/>  optimization: {<br/>    minimize: false,<br/>  },<br/><br/>  output: {<br/>    publicPath: 'http://localhost:3001/',<br/>  },<br/><br/>  resolve: {<br/>    extensions: ['.jsx', '.js', '.json', '.ts', '.tsx'],<br/>  },<br/><br/>  devServer: {<br/>    static: {<br/>      directory: outputPath,<br/>    },<br/>  },<br/><br/>  module: {<br/>    rules: [<br/>      {<br/>        test: /\.tsx?$/,<br/>        loader: require.resolve('babel-loader'),<br/>        options: {<br/>          presets: [<br/>            require.resolve('@babel/preset-react'),<br/>            require.resolve('@babel/preset-typescript'),<br/>          ],<br/>        },<br/>      },<br/>    ],<br/>  },<br/><br/>  plugins: [<br/>    new ModuleFederationPlugin({<br/>      name: 'navigation',<br/>      library: { type: 'var', name: 'navigation' },<br/>      filename: 'remoteEntry.js',<br/>      remotes: {},<br/>      exposes: {<br/>        './Header': './src/Header',<br/>        './Footer': './src/Footer',<br/>      },<br/>      shared: ['react', 'react-dom', 'single-spa-react'],<br/>    }),<br/>  ],<br/>}</span></pre><p id="f403" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">检查<code class="fe oi oj ok ol b">publicPath</code>和<code class="fe oi oj ok ol b">ModuleFederationPlugin</code>。</p><p id="b221" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe oi oj ok ol b">publicPath</code>是将在主页应用程序中使用的远程URL的基本名称。在这种情况下，将在<code class="fe oi oj ok ol b"><a class="ae nz" href="http://localshot:3001." rel="noopener ugc nofollow" target="_blank">http://localshot:3001</a></code> <a class="ae nz" href="http://localshot:3001." rel="noopener ugc nofollow" target="_blank">提供导航应用。</a></p><p id="348f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe oi oj ok ol b">exposes</code>字段由两部分组成，<code class="fe oi oj ok ol b">Header</code>和<code class="fe oi oj ok ol b">Footer</code>。这会将它们导出到home应用程序。</p><p id="1811" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如前所述，我们必须在<code class="fe oi oj ok ol b">shared</code>部分列出共享库。在这种情况下，我们需要写<code class="fe oi oj ok ol b">react</code>、<code class="fe oi oj ok ol b">react-dom</code>和<code class="fe oi oj ok ol b">single-spa-react</code>。</p><p id="ec43" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，创建一个<code class="fe oi oj ok ol b">src/Header.tsx</code>和<code class="fe oi oj ok ol b">src/Footer.tsx</code>:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="68d8" class="oy mc it ol b be oz pa l pb ou">import React from 'react'<br/>import ReactDOM from 'react-dom'<br/>import singleSpaReact from 'single-spa-react'<br/><br/>const Header: React.VFC = () =&gt; {<br/>  return (<br/>    &lt;header<br/>      style={{<br/>        width: '100%',<br/>        background: '#20232a',<br/>        color: '#61dafb',<br/>        padding: '2rem',<br/>        fontWeight: 'bold',<br/>      }}<br/>    &gt;<br/>      Header from React<br/>    &lt;/header&gt;<br/>  )<br/>}<br/><br/>const lifecycles = singleSpaReact({<br/>  React,<br/>  ReactDOM,<br/>  rootComponent: Header,<br/>})<br/><br/>export const bootstrap = lifecycles.bootstrap<br/>export const mount = lifecycles.mount<br/>export const unmount = lifecycles.unmount</span></pre><pre class="po om ol ov bn ow ox bi"><span id="cf4f" class="oy mc it ol b be oz pa l pb ou">import React from 'react'<br/>import ReactDOM from 'react-dom'<br/>import singleSpaReact from 'single-spa-react'<br/><br/>const Footer: React.VFC = () =&gt; {<br/>  return (<br/>    &lt;footer<br/>      style={{<br/>        width: '100%',<br/>        background: '#20232a',<br/>        color: '#61dafb',<br/>        padding: '2rem',<br/>        minHeight: '100px',<br/>        fontWeight: 'bold',<br/>      }}<br/>    &gt;<br/>      Footer from React<br/>    &lt;/footer&gt;<br/>  )<br/>}<br/><br/>const lifecycles = singleSpaReact({<br/>  React,<br/>  ReactDOM,<br/>  rootComponent: Footer,<br/>})<br/><br/>export const bootstrap = lifecycles.bootstrap<br/>export const mount = lifecycles.mount<br/>export const unmount = lifecycles.unmount</span></pre></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="24bf" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">注册导航应用程序</h1><p id="4be1" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">现在我们准备开始导出导航应用程序。</p><p id="d6dd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们在home应用中注册它。要注册微前端应用程序，需要以下步骤:</p><ul class=""><li id="30ed" class="nq nr it la b lb lc le lf lh of ll og lp oh lt nv nw nx ny bi translated">包括脚本标签</li><li id="193a" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">远程列表</li><li id="5cdd" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">添加注册</li><li id="bbae" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">包括一个容器<code class="fe oi oj ok ol b">div</code></li></ul><p id="2c32" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们来完成这些步骤。</p><h2 id="bb83" class="oq mc it bd md pd pe dn mh pf pg dp ml lh ph pi mn ll pj pk mp lp pl pm mr pn bi translated">包括脚本标签</h2><p id="e713" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">首先，要使用导航应用程序的代码，我们必须将它包含在HTML文件中。</p><p id="025a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">转到<code class="fe oi oj ok ol b">home/public/index.html</code>并包含脚本标签。</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="1e98" class="oy mc it ol b be oz pa l pb ou">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>+     &lt;script src="http://localhost:3001/remoteEntry.js"&gt;&lt;/script&gt;<br/>&lt;/head&gt;</span></pre><p id="9b5d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如前所述，某导航app的<code class="fe oi oj ok ol b">publicPath</code>为<code class="fe oi oj ok ol b">http://localhost:3001</code>，文件名为<code class="fe oi oj ok ol b">remoteEntry.js</code>。</p><h2 id="7e37" class="oq mc it bd md pd pe dn mh pf pg dp ml lh ph pi mn ll pj pk mp lp pl pm mr pn bi translated">远程列表</h2><p id="9813" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">接下来，转到<code class="fe oi oj ok ol b">home/webpack.config.js</code>并指定遥控器部分:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="c487" class="oy mc it ol b be oz pa l pb ou">remotes: {<br/>+   'home-nav': 'navigation',<br/>},</span></pre><p id="33ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe oi oj ok ol b">navigation</code>是<code class="fe oi oj ok ol b">navigation/webpack.config.js</code>中配置的名称:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="6c1b" class="oy mc it ol b be oz pa l pb ou">plugins: [<br/>  new ModuleFederationPlugin({<br/>+   name: 'navigation',<br/>    library: { type: 'var', name: 'navigation' },<br/>    filename: 'remoteEntry.js',<br/>    remotes: {},<br/>    exposes: {<br/>      './Header: './src/Header',<br/>      './Footer': './src/Footer',<br/>    },<br/>    shared: ['react', 'react-dom', 'single-spa-react'],<br/>  }),<br/>],</span></pre><p id="c76c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe oi oj ok ol b">home-nav</code>是home应用程序中使用的名称。</p><p id="7ba3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以通过将密钥更改为您想要的名称来更改导入的名称。</p><h2 id="2570" class="oq mc it bd md pd pe dn mh pf pg dp ml lh ph pi mn ll pj pk mp lp pl pm mr pn bi translated">添加注册</h2><p id="e17f" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">接下来，我们在<code class="fe oi oj ok ol b">home/src/index.ts</code>中注册导航app:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="dcc6" class="oy mc it ol b be oz pa l pb ou">import { registerApplication, start } from 'single-spa'<br/><br/>registerApplication(<br/>  'header',<br/>  // @ts-ignore<br/>  () =&gt; import('home-nav/Header'),<br/>  (location) =&gt; location.pathname.startsWith('/'),<br/>)<br/><br/>registerApplication(<br/>  'footer',<br/>  // @ts-ignore<br/>  () =&gt; import('home-nav/Footer'),<br/>  (location) =&gt; location.pathname.startsWith('/'),<br/>)<br/><br/>start()</span></pre><p id="b316" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe oi oj ok ol b">registerApplication</code>需要三样东西:</p><ul class=""><li id="5f1a" class="nq nr it la b lb lc le lf lh of ll og lp oh lt nv nw nx ny bi translated">应用程序名称</li><li id="b0dc" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">加载应用程序代码的函数</li><li id="3f26" class="nq nr it la b lb oa le ob lh oc ll od lp oe lt nv nw nx ny bi translated">确定应用程序何时活动或不活动的功能</li></ul><p id="f0e0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如上所述，导入函数指定了<code class="fe oi oj ok ol b">remotes</code>键的名称。</p><pre class="kj kk kl km gt om ol on oo aw op bi"><span id="824c" class="oq mc it ol b gy or os l ot ou">() =&gt; import('home-nav/Header'),</span></pre><h2 id="d4a9" class="oq mc it bd md pd pe dn mh pf pg dp ml lh ph pi mn ll pj pk mp lp pl pm mr pn bi translated">包括一个容器div</h2><p id="4f4b" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">最后，我们编写一个用于包含<code class="fe oi oj ok ol b">Header</code>和<code class="fe oi oj ok ol b">Footer</code>组件的<code class="fe oi oj ok ol b">div</code>容器。</p><p id="0721" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">转到<code class="fe oi oj ok ol b">home/public/index.html</code>并添加它们:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="a288" class="oy mc it ol b be oz pa l pb ou">&lt;body&gt;<br/>&lt;div style="height: 100%; display: flex; flex-direction: column;"&gt;<br/>  &lt;div id="single-spa-application:header"&gt;&lt;/div&gt;<br/>  &lt;main&gt;<br/>    body<br/>  &lt;/main&gt;<br/>  &lt;div id="single-spa-application:footer"&gt;&lt;/div&gt;<br/>&lt;/div&gt;<br/>&lt;/body&gt;</span></pre><p id="2a42" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">默认情况下，没有选项，single-spa将查找<code class="fe oi oj ok ol b">single-spa-application:{app name}</code>并呈现下面的HTML。</p><p id="3f32" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，我们已经将<code class="fe oi oj ok ol b">Header</code>和<code class="fe oi oj ok ol b">Footer</code>注册为<code class="fe oi oj ok ol b">header</code>和<code class="fe oi oj ok ol b">footer</code>，因此它将找到<code class="fe oi oj ok ol b">single-spa-application:header</code>和<code class="fe oi oj ok ol b">single-spa-application:footer</code>的id。</p><p id="3d58" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们试试这个。</p><p id="d9bb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在此之前，请确保安装依赖项:</p><pre class="kj kk kl km gt om ol on oo aw op bi"><span id="f4d4" class="oq mc it ol b gy or os l ot ou">yarn</span></pre><p id="40bd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并在根目录下启动服务器:</p><pre class="kj kk kl km gt om ol on oo aw op bi"><span id="12b1" class="oq mc it ol b gy or os l ot ou">yarn start</span></pre><p id="271e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，导航到<a class="ae nz" href="http://localhost:3000," rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>，您将发现两个React组件成功呈现。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/236488bac56f00e8d4adc2513e900f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7IFrYOp0moaxvqy7yTMcfw.png"/></div></div></figure><p id="3b2e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看起来效果不错。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="578c" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">身体应用程序</h1><p id="8f24" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">接下来，我们将创建一个body应用程序。Vue.js将制作一个body应用程序，但实现过程与导航应用程序几乎相同。</p><p id="c4f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们快点做它。</p><p id="744c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">body app的结构是:</p><pre class="kj kk kl km gt om ol on oo aw op bi"><span id="e4ba" class="oq mc it ol b gy or os l ot ou">├── packages<br/>│   ├── body<br/>│   │   ├── package.json<br/>│   │   ├── src<br/>│   │   │   ├── App.vue<br/>│   │   │   ├── app.js<br/>│   │   │   └── index.js<br/>│   │   ├── tsconfig.json<br/>│   │   └── webpack.config.js</span></pre><p id="fac3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建一个<code class="fe oi oj ok ol b">body/package.json</code>:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="8fd4" class="oy mc it ol b be oz pa l pb ou">{<br/>  "name": "body",<br/>  "scripts": {<br/>    "start": "webpack serve --port 3002",<br/>    "build": "webpack --mode=production"<br/>  },<br/>  "version": "1.0.0",<br/>  "private": true,<br/>  "devDependencies": {<br/>    "vue-loader": "16.0.0-beta.7",<br/>    "@babel/core": "^7.8.6",<br/>    "@babel/preset-env": "^7.10.3",<br/>    "@vue/compiler-sfc": "^3.0.0-rc.10",<br/>    "babel-loader": "^8.2.2",<br/>    "css-loader": "^3.5.3",<br/>    "postcss-loader": "^4.1.0",<br/>    "style-loader": "2.0.0",<br/>    "node-sass": "^5.0.0",<br/>    "vue-style-loader": "^4.1.2",<br/>    "sass-loader": "^10.1.0"<br/>  },<br/>  "dependencies": {<br/>    "autoprefixer": "^10.1.0",<br/>    "postcss": "^8.2.1",<br/>    "vue": "^3.0.0",<br/>    "single-spa-vue": "^2.1.0"<br/>  }<br/>}</span></pre><p id="a30c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并创建一个<code class="fe oi oj ok ol b">body/webpack.config.js</code>:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="db95" class="oy mc it ol b be oz pa l pb ou">const ModuleFederationPlugin = require('webpack/lib/container/ModuleFederationPlugin')<br/>const path = require('path')<br/>const outputPath = path.resolve(__dirname, 'dist')<br/>const { VueLoaderPlugin } = require('vue-loader')<br/><br/>module.exports = {<br/>  entry: './src/index',<br/>  cache: false,<br/><br/>  mode: 'development',<br/>  devtool: 'source-map',<br/><br/>  optimization: {<br/>    minimize: false,<br/>  },<br/><br/>  output: {<br/>    publicPath: 'http://localhost:3002/',<br/>  },<br/><br/>  resolve: {<br/>    extensions: ['.jsx', '.js', '.json', '.ts', '.tsx', '.vue'],<br/>  },<br/><br/>  devServer: {<br/>    static: {<br/>      directory: outputPath,<br/>    },<br/>  },<br/><br/>  module: {<br/>    rules: [<br/>      {<br/>        test: /\.s[ac]ss$/i,<br/>        use: [<br/>          'vue-style-loader',<br/>          'style-loader',<br/>          'css-loader',<br/>          'postcss-loader',<br/>          'sass-loader',<br/>        ],<br/>      },<br/>      {<br/>        test: /\.vue$/,<br/>        loader: 'vue-loader',<br/>      },<br/>      {<br/>        test: /\.js$/,<br/>        loader: 'babel-loader',<br/>      },<br/>      {<br/>        test: /\.tsx?$/,<br/>        loader: 'ts-loader',<br/>        options: {<br/>          appendTsSuffixTo: [/\.vue$/],<br/>        },<br/>        exclude: /node_modules/,<br/>      },<br/>    ],<br/>  },<br/><br/>  plugins: [<br/>    new VueLoaderPlugin(),<br/>    new ModuleFederationPlugin({<br/>      name: 'body',<br/>      library: { type: 'var', name: 'body' },<br/>      filename: 'remoteEntry.js',<br/>      remotes: {},<br/>      exposes: {<br/>        Body: './src/app',<br/>      },<br/>      shared: ['vue', 'single-spa', 'single-spa-vue'],<br/>    }),<br/>  ],<br/>}</span></pre><p id="3102" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建一个<code class="fe oi oj ok ol b">body/src/App.vue</code>和<code class="fe oi oj ok ol b">body/src/app.js</code>:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="a1ec" class="oy mc it ol b be oz pa l pb ou">&lt;template&gt;<br/>  &lt;div class="body"&gt;<br/>    &lt;div class="inner"&gt;<br/>      Body from Vue.js<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;style scoped lang="scss"&gt;<br/>  .body {<br/>    height: 100%;<br/>    display: flex;<br/>    justify-content: center;<br/>    align-items: center;<br/>  }<br/><br/>  .inner {<br/>    width: 300px;<br/>    height: 300px;<br/>    display: flex;<br/>    justify-content: center;<br/>    align-items: center;<br/>    background: #42b983;<br/>    color: #ffffff;<br/>  }<br/>&lt;/style&gt;</span></pre><pre class="po om ol ov bn ow ox bi"><span id="7f1a" class="oy mc it ol b be oz pa l pb ou">import singleSpaVue from 'single-spa-vue'<br/>import { h, createApp } from 'vue'<br/>import App from './App.vue'<br/><br/>const lifecycles = singleSpaVue({<br/>  createApp,<br/>  appOptions: {<br/>    render() {<br/>      return h(App, {<br/>        props: {<br/>          // single-spa props are available on the "this" object. Forward them to your component as needed.<br/>          // https://single-spa.js.org/docs/building-applications#lifecyle-props<br/>          name: this.name,<br/>          mountParcel: this.mountParcel,<br/>          singleSpa: this.singleSpa,<br/>        },<br/>      })<br/>    },<br/>  },<br/>})<br/><br/>export const bootstrap = lifecycles.bootstrap<br/>export const mount = lifecycles.mount<br/>export const unmount = lifecycles.unmount</span></pre></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="9717" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">注册身体应用程序</h1><p id="1bbc" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">接下来，我们将在home应用程序中注册身体，就像我们之前为导航所做的那样。</p><p id="86a4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">转到<code class="fe oi oj ok ol b">home/public/index.html</code>并添加一个脚本标签:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="1746" class="oy mc it ol b be oz pa l pb ou">&lt;head&gt;<br/>    &lt;script src="http://localhost:3001/remoteEntry.js"&gt;&lt;/script&gt;<br/>+   &lt;script src="http://localhost:3002/remoteEntry.js"&gt;&lt;/script&gt;<br/>&lt;/head&gt;</span></pre><p id="7981" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后去<code class="fe oi oj ok ol b">home/webpack.config.js</code>添加<code class="fe oi oj ok ol b">home-body</code>:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="5b7b" class="oy mc it ol b be oz pa l pb ou">remotes: {<br/>  'home-nav': 'navigation',<br/>+ 'home-body': 'body',<br/>},</span></pre><p id="e1ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，转到<code class="fe oi oj ok ol b">home/src/index.ts</code>进行注册:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="b3b5" class="oy mc it ol b be oz pa l pb ou">import { registerApplication, start } from 'single-spa'<br/><br/>registerApplication(<br/>  'header',<br/>  // @ts-ignore<br/>  () =&gt; import('home-nav/Header'),<br/>  (location) =&gt; location.pathname.startsWith('/'),<br/>)<br/><br/>registerApplication(<br/>  'footer',<br/>  // @ts-ignore<br/>  () =&gt; import('home-nav/Footer'),<br/>  (location) =&gt; location.pathname.startsWith('/'),<br/>)<br/><br/>registerApplication(<br/>  'body',<br/>  // @ts-ignore<br/>  () =&gt; import('home-body/Body'),<br/>  (location) =&gt; location.pathname.startsWith('/'),<br/>)<br/><br/>start()</span></pre><p id="ae5b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，在<code class="fe oi oj ok ol b">home/public/index.html</code>中添加一个<code class="fe oi oj ok ol b">div</code>容器:</p><pre class="kj kk kl km gt om ol ov bn ow ox bi"><span id="e528" class="oy mc it ol b be oz pa l pb ou">&lt;body&gt;<br/>&lt;div style="height: 100%; display: flex; flex-direction: column;"&gt;<br/>  &lt;div id="single-spa-application:header"&gt;&lt;/div&gt;<br/>  &lt;main style="display: flex; flex: 1;"&gt;<br/>    &lt;div id="single-spa-application:body" style="width: 100%"&gt;&lt;/div&gt;<br/>  &lt;/main&gt;<br/>  &lt;div id="single-spa-application:footer"&gt;&lt;/div&gt;<br/>&lt;/div&gt;<br/>&lt;/body&gt;</span></pre><p id="8f5c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们来测试一下。</p><p id="8937" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">运行安装依赖项:</p><pre class="kj kk kl km gt om ol on oo aw op bi"><span id="820e" class="oq mc it ol b gy or os l ot ou">yarn</span></pre><p id="657b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并在根目录下启动服务器:</p><pre class="kj kk kl km gt om ol on oo aw op bi"><span id="9a47" class="oq mc it ol b gy or os l ot ou">yarn start</span></pre><p id="55dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">导航到<a class="ae nz" href="http://localhost:3000," rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/da8fe219d778821c9b2c2a780a024d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1I7AeWyemjh3MzfBoGI-3w.png"/></div></div></figure><p id="18a0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太好了——您可以看到Vue组件被成功渲染。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="ad10" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">结论</h1><p id="cccf" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">在本文中，我们介绍了如何使用Webpack中的单个SPA和模块联合来实现微前端应用程序。</p><p id="601a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">微前端在灵活性、可扩展性和可维护性方面有利于团队开发，尤其是大型团队，因为它为您提供了独立部署、混合框架的使用和关注点的分离。</p><p id="c18f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然也有不好的一面，比如配置复杂，学习成本高，但是我认为上面说的优点大于缺点。</p><p id="07cd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望这篇文章能让你对微前端感兴趣！</p><div class="my mz gp gr na nb"><a href="https://github.com/manakuro/micro-frontends-single-spa-module-federation" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">mana kuro/微前端-单spa-模块-联盟</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">使用单spa和模块联合的微前端应用程序—manakuro/微前端—单spa—模块联合</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ks nb"/></div></div></a></div></div></div>    
</body>
</html>