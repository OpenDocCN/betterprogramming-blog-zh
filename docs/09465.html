<html>
<head>
<title>How to Design Awesome RESTful Endpoints</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何设计出色的RESTful端点</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/designing-awesome-restful-endpoints-8fc816752ec2?source=collection_archive---------2-----------------------#2021-08-28">https://betterprogramming.pub/designing-awesome-restful-endpoints-8fc816752ec2?source=collection_archive---------2-----------------------#2021-08-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7da0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你的网络开发者会因此而喜欢你的</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/dc696826fdc78ac749e80cc872169870.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*192UJ25gIZgVU0It"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@euwars?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">法尔扎德·纳齐菲</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="8846" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">构建REST APIs很像构建网页。当你设计一个网站时，你希望用户对你的网站有很好的体验，并且因为他们喜欢使用它而不断回来。</p><p id="227e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">REST APIs也是如此，只是您的用户是web开发人员或其他希望与您的应用程序集成的应用程序开发人员。你仍然希望他们有一个惊人的体验，并发现你的API直观易用。</p><p id="57df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在构建REST API时，在端点设计上投入大量的前期时间是非常重要的。设计良好的端点将使web开发人员能够很容易地确定他们要为特定任务使用哪个端点以及如何使用它。</p><p id="9e6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么设计良好的REST端点到底是什么样子的呢？首先，他们应该遵循行业最佳实践，以减少不熟悉API的开发人员的学习曲线。它们应该在资源命名方法、HTTP方法和状态代码的使用上保持一致，并在出错时提供有意义的错误消息。</p><p id="2981" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我认为讨论端点设计最简单的方法是使用例子，所以我将浏览一些具体的用例，并考虑如何为它们设计端点。</p><p id="a1ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">顺便说一句，在这一点上值得注意的是，在与REST架构中的资源进行交互时，您不必使用HTTP，也不必使用JSON来表示这些资源。然而，HTTP和JSON的组合可能是最常见的实现，这也是大多数人在谈论REST APIs时想到的，所以这也是我在这里重点关注的。</p><h1 id="9109" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">检索整个资源集合</h1><p id="0718" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们从一个简单的场景开始，我们希望检索特定类型的所有资源。例如，假设我们想要构建一个API来管理在线学校的课程，并且我们想要提供一个列出所有课程的端点。</p><p id="47ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以使用下面的端点来检索整个课程集合。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="338a" class="mu lt iq mq b gy mv mw l mx my">GET /courses</span></pre><p id="73a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们正在检索资源，所以我们使用GET方法。路径标识了我们感兴趣的资源集合。我们想要获取的资源称为<code class="fe mz na nb mq b">course</code>，因此集合的名称是复数形式，也是小写形式，即<code class="fe mz na nb mq b">courses</code>。</p><p id="080e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个端点应该返回一个HTTP状态代码“200 OK”和一个JSON对象数组，其中每个对象保存一个不同的<code class="fe mz na nb mq b">course</code>的细节，如下所示。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="e805" class="mu lt iq mq b gy mv mw l mx my">[<br/>  { <br/>    "id": 1,<br/>    "code": "PHY_Q_1",<br/>    "name": "Quantum Physics",<br/>    "faculty": "Science",<br/>    "level": 1<br/>  },<br/>  { <br/>    "id": 2,<br/>    "code": "ENG_3",<br/>    "name": "English",<br/>    "faculty": "Arts",<br/>    "level": 3<br/>  },<br/>  ...<br/>]</span></pre><h1 id="be20" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">搜索资源</h1><p id="52fe" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果我们的客户不想检索整个资源集合，而是想搜索符合搜索标准的资源子集，那该怎么办？我们通过添加查询参数来实现这一点。</p><p id="987d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，我们可以通过采用上一个示例中的端点并添加一个“教员”查询参数来支持按教员搜索课程。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="9f51" class="mu lt iq mq b gy mv mw l mx my">GET /courses?faculty=Science</span></pre><p id="63c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个端点将继续返回一个HTTP状态代码<code class="fe mz na nb mq b">200 OK</code>和一个数组，该数组只包含那些由“科学”教师提供的课程。</p><p id="38a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里有几个反模式需要注意。</p><ul class=""><li id="2cb1" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated"><em class="nl">当没有资源返回时，返回HTTP状态码“404未找到”。</em>404状态代码仅适用于集合本身不存在的情况，例如，您拼错了集合名称，如<code class="fe mz na nb mq b">coarses</code>。如果没有符合我们搜索标准的课程，那么仍然会返回一个HTTP状态代码<code class="fe mz na nb mq b">200 OK</code>,并带有一个空数组。</li><li id="c7b5" class="nc nd iq ky b kz nm lc nn lf no lj np ln nq lr nh ni nj nk bi translated"><em class="nl">当只找到一个资源时，返回一个资源而不是一个资源数组。</em>即使只有一个资源符合搜索条件，我们也应该在使用查询参数过滤集合时返回一个数组。</li></ul><h1 id="a498" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">限制搜索结果的大小</h1><p id="ce44" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">对于大型集合，通常希望限制返回的资源数量，因为大型结果集会导致响应时间很短。这里我们可以采用多种设计方法。</p><p id="d4b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以添加一个查询参数来限制结果的数量。如果没有传入，我们可以使用默认值。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="c76f" class="mu lt iq mq b gy mv mw l mx my">GET /courses?faculty=Science&amp;numberOfResults=100</span></pre><p id="4154" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以更复杂一点，通过添加查询参数来指定页码和大小，从而支持分页。Web开发人员经常需要以分页的形式呈现搜索结果，这样他们就会喜欢这个特性。下面的示例将返回10个结果中的第2页(如果我们假设页码从1开始，则相当于结果11–20)。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="58fc" class="mu lt iq mq b gy mv mw l mx my">GET /courses?faculty=Science&amp;pageNumber=2&amp;pageSize=10</span></pre><p id="3060" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者我们可以用查询参数实现同样的事情，指定开始和结束结果。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="9cde" class="mu lt iq mq b gy mv mw l mx my">GET /courses?faculty=Science&amp;startResult=11&amp;endResult=20</span></pre><h1 id="e436" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用ID检索单个资源</h1><p id="6660" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果一个API客户端知道一个资源的唯一标识符(可能在搜索之后)，那么他们应该能够使用它来检索那个资源。例如，下面的端点可以用来返回一个<code class="fe mz na nb mq b">course</code>的细节，其中<code class="fe mz na nb mq b">course</code> ID等于1。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="df1a" class="mu lt iq mq b gy mv mw l mx my">GET /courses/1</span></pre><p id="b59b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这应该会返回一个HTTP状态<code class="fe mz na nb mq b">200 OK</code>和一个单独的课程(这次不是一个数组)。如果提供了一个没有课程的<code class="fe mz na nb mq b">course</code> ID，则返回一个<code class="fe mz na nb mq b">404 Not Found</code>是合适的。</p><p id="6cd5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，在上面的例子中，我们在<code class="fe mz na nb mq b">course</code>资源中包含了一个代码，例如，1级量子物理学的代码是<code class="fe mz na nb mq b">PHY_Q_1</code>。如果代码是独一无二的，那么这就引出了一个问题，我们是否也可以在检索时使用代码来识别<code class="fe mz na nb mq b">course</code>。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="99a9" class="mu lt iq mq b gy mv mw l mx my">GET /courses/PHY_Q_1</span></pre><p id="4d54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的观点是端点应该只使用一个属性作为标识符，所以在这种情况下应该决定是使用<code class="fe mz na nb mq b">id</code>还是<code class="fe mz na nb mq b">code</code>属性。如果我们决定<code class="fe mz na nb mq b">id</code>将成为资源标识符，那么代码仍然可以如下使用:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="ef29" class="mu lt iq mq b gy mv mw l mx my">GET /courses?code=PHY_Q_1</span></pre><p id="9674" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，如前所述，这将返回一个包含单个资源的<em class="nl">数组</em>。</p><h1 id="06f3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">嵌套资源</h1><p id="b414" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在这一点上，有必要花点时间来讨论我们是否要嵌套资源的问题。在上面的例子中，我们一直将课程视为顶级资源。</p><p id="98c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，让我们假设所有的课程都属于同一个院系，并且这种情况会一直存在。换句话说，院系和课程之间有非常强的亲子关系。在这种情况下，我们可以使用下面的端点来返回科学学院提供的所有课程。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="9302" class="mu lt iq mq b gy mv mw l mx my">GET /faculties/science/courses</span></pre><p id="25c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，我使用一个代码(在本例中是<code class="fe mz na nb mq b">science</code>)来标识教员，而不是一个数字ID。因此，这个端点的意思是，我们想要获取<code class="fe mz na nb mq b">faculties</code>集合，找到由代码<code class="fe mz na nb mq b">science</code>标识的院系，然后获取该院系下的<code class="fe mz na nb mq b">courses</code>集合。</p><p id="b6ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，我们讨论的所有其他内容都将继续适用，因此，如果您想要搜索3级科学课程，您只需添加如下查询参数。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="cc29" class="mu lt iq mq b gy mv mw l mx my">GET /faculties/science/courses?level=3</span></pre><h1 id="4621" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">创建资源</h1><p id="20c4" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">到目前为止，我们所做的一切都涉及到资源的检索。但是如果我们想要创建一个资源呢？如果我们想支持添加一个新的课程，那么我们可以使用下面的端点。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="0b41" class="mu lt iq mq b gy mv mw l mx my">POST /courses</span></pre><p id="706b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，我们在添加资源时使用“POST”HTTP方法，路径标识了要添加资源的集合。请求体应该是包含资源属性的JSON对象。</p><p id="ec4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果成功地创建了资源，那么应该返回一个HTTP状态代码“201 Created ”,尽管有时也使用“200 OK”。如果由于请求体中的无效数据而无法创建资源，那么应该返回“400错误请求”。</p><h1 id="ce4e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">更新资源</h1><p id="de14" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">说到更新资源，我们有几个选项，现在我们来看看其中的一些。一种方法是使用“PUT”HTTP方法，这种方法应该在替换整个资源时使用。这假设API消费者将知道他们想要改变的资源的所有属性(可能在第一次执行GET之后)，并且能够覆盖所有属性。</p><p id="3eff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用下面的端点可以支持这一点，其中请求体应该是包含资源所有属性的JSON对象。请注意，路径使用唯一标识符来标识单个资源。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="1efb" class="mu lt iq mq b gy mv mw l mx my">PUT /courses/1</span></pre><p id="733c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">HTTP状态代码与创建资源的状态代码相同，即“200 OK”表示成功更新，而“400 Bad Request”表示请求体包含无效数据。</p><p id="c7cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一种方法是提供针对特定属性更新的端点，如下所示。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="2617" class="mu lt iq mq b gy mv mw l mx my">PUT /courses/1/description</span></pre><p id="ceab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，我们仍然是在做一个完全的替换，而是一个特定属性的完全替换。</p><p id="0639" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还有一种方法是使用“补丁”HTTP方法，该方法旨在允许部分更新资源。这个操作使用起来有点棘手，也是我个人避免使用的，但是为了完整起见，我想在这里提一下。</p><h1 id="b878" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">删除资源</h1><p id="87d8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">毫不奇怪，当我们想要删除资源时，我们使用“DELETE”HTTP方法。例如，我们将使用下面的端点来删除一个课程。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="59f9" class="mu lt iq mq b gy mv mw l mx my">DELETE /courses/1</span></pre><p id="4904" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，我们使用资源的惟一标识符来标识要删除的资源。如果删除成功，该操作应该返回“204 No Content ”,但是有时会返回“200 OK”。如果资源不存在，应该返回“404 Not Found”。</p><h1 id="6e6f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">对资源执行其他操作</h1><p id="12f1" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">有时候，我们希望执行简单的创建、更新和删除资源之外的操作。例如，假设我们想要取消一门课程，这将具有更新课程状态、注册任何学生以及通知学生取消的效果。</p><p id="7009" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然课程资源将被更新，但是这个操作显然不仅仅是简单的更新。对于简单CRUD操作之外的任何场景，我们应该使用POST方法。那么我们的终点会是什么样子呢？</p><p id="decc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一种选择是将动作包含在路线中，如下所示。然而，有些人可能不喜欢这种方法，因为路由不再用于简单地识别资源或集合。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="d66c" class="mu lt iq mq b gy mv mw l mx my">POST /courses/1/cancel</span></pre><p id="da3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一种选择是使用查询参数来指示操作，如下面的两个示例所示。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="0bcd" class="mu lt iq mq b gy mv mw l mx my">POST /courses/1?action=cancel<br/>POST /courses/1?cancel=true</span></pre><p id="0e8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第三种选择是在请求体中包含操作和任何其他相关信息。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h1 id="dca4" class="ls lt iq bd lu lv ny lx ly lz nz mb mc jw oa jx me jz ob ka mg kc oc kd mi mj bi translated">总结</h1><p id="e452" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">所以有一些关于RESTful端点设计的想法。我们并没有考虑到所有的情况，但是希望你已经掌握了一些有用的技巧，可以应用到你的场景中。</p><p id="44fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">祝您愉快地设计令人惊叹的RESTful端点。你的网络开发者真的会因此而爱上你！</p></div></div>    
</body>
</html>