# 当干燥不起作用时，去湿的

> 原文：<https://betterprogramming.pub/when-dry-doesnt-work-go-wet-6befda0444bf>

## 如果你重复你自己也没关系

![](img/4c96e54bb573fd7fd3a412e9b58caebc.png)

由[舒米洛夫·卢德米拉](https://unsplash.com/@lsfineartphotography?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

这个错误我见过很多次了，我自己也犯过。当你第一次读到干式编程的概念时，你可能误解了它。

你脑子里在想的是:

维基百科:DRY 代表不重复相同的代码两次。你:嗯，好吧，我会用抽象代替我所有的复制品。

这似乎是一个很好的解决方案，但事实并非如此。你的抽象往往是错误的。

原因如下:

1.  你看到了重复。
2.  您将复制提取到一个新的抽象中(方法，类)。
3.  你用新的抽象代替了复制。
4.  你认为你的代码是完美的。
5.  时光流逝。
6.  产品经理有了新的要求。你的抽象对他们来说几乎是完美的。
7.  你开始实现新的需求。
8.  这里有一个小的*但是* :
    你的抽象几乎是完美的。为什么？新的需求只影响您提取到抽象中的 95%的旧代码。另外 5%不受影响。你决定改变你的抽象的代码，而不是用当前代码的 95%来创建一个新的抽象。
    您添加了一个条件语句，例如`if..else`，并传递了一个参数，因此您的抽象可以针对不同的决策执行不同的操作。
9.  现在你的抽象对于不同的情况有不同的表现。
10.  另一个新的要求来了。另一个附加参数。又一个新条件。(循环直到代码变得非常难以理解和维护。)
11.  恭喜你，你创造了一个错误的抽象。

代码不再代表单一的、公共的抽象。它变成了一个充满条件的过程。很难理解，也很容易坏。添加新特性非常困难，每一个新特性都会使代码更加复杂。

这是一个无限循环。

那怎么办呢？

什么都写两遍。

# 湿的

湿(每样东西写两遍)和干是相反的概念。当你开始开发一个新系统时，你并不知道所有的未来需求。所以不要急于抽象。

你需要记住:复制比错误的抽象要便宜得多。

例如，您正在构建一个 web 应用程序，但现在还没有针对所有页面的 UI 设计。但是你也有许多按钮，并且它们在每一页上都是相似的。您决定将它们移到一个名为`Button`的组件中，并在每个页面上重用它。似乎合乎逻辑。

“嘿嘿！”新的页面设计来自产品经理。你看着它，发现在页面底部有一个新的、别致的按钮。

它看起来像旧的按钮，但它有一个“小东西”要实现它，您需要重写 10%的`Button`组件，并添加条件语句和新参数。

现在你有一个难题:

1.  改变`Button`。重写 10%的抽象代码(添加逻辑条件以支持新的花式按钮逻辑)。
2.  创建两个抽象:`FancyButton`和`Button`。将 90%的代码从`Button`复制到`FancyButton`。

我知道你想选择第一个选项。你认为你能处理好。你不会构建错误的抽象。

但可悲的事实是，你会的(除非你是一个有经验的程序员，并且知道你在做什么)。

复制代码。不要害怕。

过一段时间你就知道你的按钮以后是什么样子了。然后，您可以分析当前的代码库，在按钮组件中找到重复的代码，并将它们移动到良好的抽象中。

# 如果太晚了

如果你发现处理一个错误的抽象为时已晚，那么前进的最快方式就是后退。

请执行以下操作:

1.  将抽象的代码移回。
2.  删除传递给抽象的未使用的参数，为不同的决策执行不同的操作。
3.  删除未使用的逻辑。

这移除了每个调用者的抽象和条件语句。

# 最后…

如果您发现自己通过共享代码传递参数和添加条件语句，那么您的抽象就是错误的。

比起错误的抽象，我更喜欢复制。

感谢阅读！(灵感来自[错误的抽象](https://sandimetz.com/blog/2016/1/20/the-wrong-abstraction))

干杯，

–[尼克](https://twitter.com/nickbulljs)

如果你喜欢这篇文章，你需要知道，每周一，我都会给 4000 多名 web 开发人员发一封信，里面有 3 篇来自技术世界的精选文章、2 篇 Web 开发指南和 1 篇本周最佳 Tweet

***“你的通迅真是混账牛逼*** *，真是尼克。这给了我一周的良好开端，让我学到了很多重要的知识。”*

在这里 **加入免费获得短小精悍知识信的聪明开发者 [**。**](https://nickbulljs.com/3-2-1/)**