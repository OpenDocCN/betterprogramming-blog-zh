<html>
<head>
<title>Understand Island Architecture and How the Client Receives No JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解孤岛架构以及客户端如何接收不到JavaScript</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/understand-island-architecture-how-the-client-receives-no-js-9c6dfa6d7732?source=collection_archive---------2-----------------------#2022-09-14">https://betterprogramming.pub/understand-island-architecture-how-the-client-receives-no-js-9c6dfa6d7732?source=collection_archive---------2-----------------------#2022-09-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="382d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用我的GitHub repo来演示岛屿建筑是如何工作的</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/21d816f5a0e1acdddf28516d1e62324c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9uEqOCwJr0qehv9_dE093g.png"/></div></div></figure><p id="937a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">“组件岛”模式是由Etsy的前端架构师Katie Sylor-Miller创建的。当您发布使用您喜欢的框架(如React、Vue或Angular)构建的最新应用程序时，每个组件都包含JavaScript。</p><p id="15b1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是岛屿建筑的由来。即使它是一个静态文件，比如一个导航链接，或者只是一个带有文本的图像。通过孤岛架构，您可以控制项目附带的所有JavaScript以及它如何与用户交互。岛式建筑也被称为部分水合。</p><h1 id="95ee" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">什么是海岛建筑(部分水化)？</h1><p id="ff60" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">短语“孤岛架构”是指静态HTML网站上的交互式用户界面组件。一个岛总是单独呈现，一页上可能有几个岛。把它们想象成静态的、不活跃的HTML海洋中的孤岛。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/ef0cde57a67ba3eb4618c3932723397f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A063HvTkH3PYUxkMDLc10A.png"/></div></div></figure><p id="e12f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">“孤岛”架构的核心概念很简单:在服务器上呈现HTML页面，并在高度动态的区域周围插入占位符或插槽。这些占位符/槽保存由服务器上适当的小部件生成的HTML输出。他们指定一些区域，这些区域稍后可以在客户机上被“水合”成小的自包含部件，重用服务器产生的初始HTML。</p><p id="d3ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">乍一看，这可能感觉像“微前端”。这两种方法都基于将应用程序划分为独立单元的思想。尽管“微前端”通常并不意味着这些单元的组合是使用HTML实现的。</p><h1 id="aa51" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">它是如何工作的？</h1><p id="e9c6" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">在大多数情况下，页面包含静态和动态内容。一个页面通常由静态信息和一些独立的交互部分组成。例如:</p><ul class=""><li id="849c" class="ml mm iq kt b ku kv kx ky la mn le mo li mp lm mq mr ms mt bi translated">博客帖子、新闻文章和组织主页包括文本和图像以及交互式元素，如社交媒体嵌入和聊天。</li><li id="94b8" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated">电子商务网站上的产品页面链接到应用程序中的其他页面，并包括静态产品描述。页面的不同区域提供交互式元素，如搜索和图像传送带。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/0a78710e64dea391ba1f4aa8c7391eb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ltz4UJa7F9k6EbStkKMuUQ.png"/></div></div></figure><p id="6dde" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">静态内容在呈现后不需要再水化，也不会触发事件。动态内容(按钮、过滤器和搜索栏)在呈现后需要重新连接到其事件。在客户端，需要再次生成DOM(虚拟DOM)。提供给客户端的JavaScript包括这些用于再生、再水合和事件处理的例程。</p><p id="9f76" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">孤岛架构使得在服务器上呈现包含所有静态内容的页面成为可能。但是，在这种情况下，动态内容的占位符将出现在输出HTML中。每个小部件都将服务器呈现的输出与JavaScript相结合，JavaScript用于在客户端上合成应用程序。</p><h1 id="401d" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">孤岛实施</h1><p id="9b3e" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">如今，各种框架都可以支持孤岛架构。其中包括:</p><h1 id="ada8" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated"><a class="ae na" href="https://fresh.deno.dev/" rel="noopener ugc nofollow" target="_blank">新鲜的</a></h1><p id="4990" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">在Fresh中，孤岛支持客户端交互。孤岛是在客户端上隔离和呈现的预先动作组件。这不同于所有其他经常在服务器上呈现的新鲜组件。在新项目中，通过在islands/文件夹中创建文件来定义孤岛。</p><h1 id="457a" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated"><a class="ae na" href="https://astro.build/" rel="noopener ugc nofollow" target="_blank">阿童木</a></h1><p id="e6f7" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">Astro是一个静态站点构建器，能够使用其他框架(如React、Preact、Svelte、Vue等)中构建的UI组件生成轻量级静态HTML页面。需要客户端JavaScript的组件以及它们的依赖项是单独加载的。因此，它具有内在的部分水合作用。Astro还可以基于组件的可见性来延迟加载组件。下一节包括一个使用Astro的示例实现。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/46b4b83c62682fce9910d7eff1930116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0asDRgfa7tJ6MrDlbJNFhA.png"/></div></div></figure><p id="b52c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦组件JavaScript到达用户的视口，就对其进行加载和水合。为了跟踪可见性，它在内部使用一个IntersectionObserver。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/01a1dcb16a67659946fb23560fec9a22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZfb8ph9hqcWuZF1iRYm1g.png"/></div></div></figure><h1 id="3887" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated"><a class="ae na" href="https://markojs.com/" rel="noopener ugc nofollow" target="_blank">马尔科</a></h1><p id="53f5" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">Marko是一个由易贝建立和维护的开源框架，用于提高服务器渲染性能。它通过集成流式渲染和自动部分水合来支持岛式架构。当HTML和其他静态材料准备好了，它们就被传输到客户机。自动部分水合使交互组件能够自水合。</p><h1 id="6279" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">岛式建筑的优势</h1><h2 id="c662" class="nd lo iq bd lp ne nf dn lt ng nh dp lx la ni nj lz le nk nl mb li nm nn md no bi translated">表演</h2><p id="825e" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">网站的大部分内容都被转换成了快速、静态的HTML，JavaScript只为需要它的单个组件加载。JavaScript是每个字节加载最慢的文件之一，因此每个字节都很重要。</p><h2 id="6177" class="nd lo iq bd lp ne nf dn lt ng nh dp lx la ni nj lz le nk nl mb li nm nn md no bi translated">并行或并发加载</h2><p id="82e8" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">不需要低优先级的“图像传送带”岛来阻挡高优先级的“标题”岛。页眉立即变得可交互，而不必等待更重的传送带加载到页面的更下方，因为两者同时加载并独立水合。</p><h2 id="ba3b" class="nd lo iq bd lp ne nf dn lt ng nh dp lx la ni nj lz le nk nl mb li nm nn md no bi translated">区分重要内容的优先级</h2><p id="d377" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">更好的是，你可以命令Astro何时以及如何渲染每个组件。如果图片传送带加载代价太高，你可以添加一个特殊的客户端指令，指示Astro只加载出现在页面上的图片传送带。如果用户看不到它，它就不会加载。</p><h2 id="734e" class="nd lo iq bd lp ne nf dn lt ng nh dp lx la ni nj lz le nk nl mb li nm nn md no bi translated">搜索引擎优化</h2><p id="4900" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">页面是SEO友好的，因为所有静态信息都呈现在服务器上。</p><h1 id="d143" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">岛屿建筑的缺点</h1><h2 id="88b4" class="nd lo iq bd lp ne nf dn lt ng nh dp lx la ni nj lz le nk nl mb li nm nn md no bi translated">对于高度交互的页面无效</h2><p id="5fe1" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">这种架构对于高度互动的页面来说是无效的，比如社交媒体应用，这几乎肯定需要数千个岛。</p><h2 id="e295" class="nd lo iq bd lp ne nf dn lt ng nh dp lx la ni nj lz le nk nl mb li nm nn md no bi translated">有限的框架</h2><p id="431a" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">开发人员实现孤岛的唯一选择是使用少数可用的框架之一，或者自己开发架构。将现有网站转移到Astro或Marko将需要额外的任务。</p><h1 id="84c9" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">结论</h1><p id="5b67" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">岛架构概念是新的，但由于其性能优势，预计它将加速发展。它强调使用SSR进行静态内容呈现，同时通过动态组件提供交互性，对页面性能的影响最小。我们希望未来在这个领域看到更多的公司，以及更广泛的实施解决方案。</p><p id="6a04" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以查看我的GitHub存储库，在那里我做了一些实际的实现来了解孤岛架构是如何工作的。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="3fb1" class="nd lo iq nq b gy nu nv l nw nx">GitHub Link: <a class="ae na" href="https://github.com/coolpinkzz/island-architecture" rel="noopener ugc nofollow" target="_blank">https://github.com/coolpinkzz/island-architecture</a> <br/>Deployed Link: <a class="ae na" href="https://island-architecture.netlify.app/" rel="noopener ugc nofollow" target="_blank">https://island-architecture.netlify.app/</a></span></pre></div></div>    
</body>
</html>