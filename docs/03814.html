<html>
<head>
<title>Dictionary Merging and Updating in Python 3.9</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 3.9中的字典合并和更新</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/dictionary-merging-and-updating-in-python-3-9-4ac67c667ce?source=collection_archive---------3-----------------------#2020-03-06">https://betterprogramming.pub/dictionary-merging-and-updating-in-python-3-9-4ac67c667ce?source=collection_archive---------3-----------------------#2020-03-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0263" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">快速浏览Python 3.9的新merge |和update |=操作符</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/19db0af98301bed54e12008ec55074ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k88CNDUcMzSPfss7ZuXkMw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@pisitheng?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">皮斯特亨</a>在<a class="ae ky" href="https://unsplash.com/s/photos/dictionary?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="e8e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python 3.9正在积极开发中，计划于今年10月发布。2月26日，开发团队发布了它的alpha 4版本。与几乎所有Python程序员相关的一个新特性是引入了新的merge <code class="fe lv lw lx ly b">(|)</code>和update <code class="fe lv lw lx ly b">(|=)</code>操作符。</p><p id="3365" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们快速浏览一下这篇文章中的内容。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="3c33" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">字典</h1><p id="fcff" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">字典，俗称<code class="fe lv lw lx ly b">dict</code>，是Python中最重要的内置数据类型之一。这种数据类型是一个大小灵活的键-值对集合，由于它的散列实现，它最出名的是具有固定的数据查找时间。</p><p id="97d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是一些常见的用法:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="1c25" class="nh mh it ly b gy ni nj l nk nl"># Declare a dict<br/>student = {'name': 'John', 'age': 14}</span><span id="d6a0" class="nh mh it ly b gy nm nj l nk nl"># Get a value<br/>age = student['age']<br/># age is 14</span><span id="b74e" class="nh mh it ly b gy nm nj l nk nl"># Update a value<br/>student['age'] = 15<br/># student becomes {'name': 'John', 'age': 15}</span><span id="4754" class="nh mh it ly b gy nm nj l nk nl"># Insert a key-value pair<br/>student['score'] = 'A'<br/># student becomes {'name': 'John', 'age': 15, 'score': 'A'}</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="2165" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">合并字典——老方法</h1><p id="0db3" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">有时，我们需要合并两个字典进行进一步的处理。在3.9正式发布之前，我们有几种方法可以做到这一点。假设我们有两个<code class="fe lv lw lx ly b">dict</code>:T4和T5。我们想要创建一个名为<code class="fe lv lw lx ly b">d3</code>的新<code class="fe lv lw lx ly b">dict</code>，由<code class="fe lv lw lx ly b">d1</code>和<code class="fe lv lw lx ly b">d2</code>组成。为了说明如果在合并的<code class="fe lv lw lx ly b">dict</code>之间有一些重叠的键，我们应该做什么，我们有另一个<code class="fe lv lw lx ly b">dict</code> <code class="fe lv lw lx ly b">d2a</code>，它有一个与<code class="fe lv lw lx ly b">d1</code>重叠的键。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="8c25" class="nh mh it ly b gy ni nj l nk nl"># two dicts to start with<br/>d1 = {'a': 1, 'b': 2}<br/>d2 = {'c': 3, 'd': 4}<br/>d2a = {'a': 10, 'c': 3, 'd': 4}</span><span id="cdb4" class="nh mh it ly b gy nm nj l nk nl"># target dict<br/>d3 = {'a': 1, 'b': 2, 'c': 3, 'd': 4}</span></pre><h2 id="c1a3" class="nh mh it bd mi nn no dn mm np nq dp mq li nr ns ms lm nt nu mu lq nv nw mw nx bi translated">使用update()方法</h2><p id="5ec5" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">第一种方法是使用<code class="fe lv lw lx ly b">dict</code>的方法<code class="fe lv lw lx ly b">update()</code>。下面的代码片段向您展示了如何做到这一点。注意，我们必须首先创建一个<code class="fe lv lw lx ly b">d1</code>的副本，因为<code class="fe lv lw lx ly b">update()</code>函数将修改原始的<code class="fe lv lw lx ly b">dict</code>。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="7649" class="nh mh it ly b gy ni nj l nk nl"># create a copy of d1, as update() modifies the dict in-place<br/>d3 = d1.copy()<br/># d3 is {'a': 1, 'b': 2}</span><span id="9361" class="nh mh it ly b gy nm nj l nk nl"># update the d3 with d2<br/>d3.update(d2)<br/># d3 now is {'a': 1, 'b': 2, 'c': 3, 'd': 4}</span></pre><p id="d73b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当存在重叠的键时，我们必须更加谨慎地考虑要保留哪些值。正如您在下面看到的，在<code class="fe lv lw lx ly b">update()</code>方法中作为参数传递的<code class="fe lv lw lx ly b">dict</code>将通过拥有重叠键(即<code class="fe lv lw lx ly b">‘a’</code>)的值(即10)来“赢得”游戏。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="ff1f" class="nh mh it ly b gy ni nj l nk nl">d3 = d1.copy()<br/>d3.update(d2a)<br/># d3 now is {'a': 10, 'b': 2, 'c': 3, 'd': 4}<br/># This is not the way that we want</span><span id="28f0" class="nh mh it ly b gy nm nj l nk nl">d3 = d2a.copy()<br/>d3.update(d1)<br/># d3 now is {'a': 1, 'c': 3, 'd': 4, 'b': 2}<br/># This is the way that we want</span></pre><h2 id="a59b" class="nh mh it bd mi nn no dn mm np nq dp mq li nr ns ms lm nt nu mu lq nv nw mw nx bi translated">打开字典包装</h2><p id="8326" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">第二种方法是使用字典的解包。与上面的方法类似，当有重叠的键时，“最后看到的获胜”。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="3f75" class="nh mh it ly b gy ni nj l nk nl"># unpacking<br/>d3 = {**d1, **d2a}<br/># d3 is {'a': 10, 'b': 2, 'c': 3, 'd': 4}<br/># Not right</span><span id="99bf" class="nh mh it ly b gy nm nj l nk nl">d3 = {**d2a, **d1}<br/># d3 is {'a': 1, 'c': 3, 'd': 4, 'b': 2}<br/># Good</span></pre><h2 id="ea7c" class="nh mh it bd mi nn no dn mm np nq dp mq li nr ns ms lm nt nu mu lq nv nw mw nx bi translated">使用<strong class="ak">字典</strong> ( <em class="ny">可重复</em>、<em class="ny">* *夸格</em>)</h2><p id="b5f6" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">用Python创建dict的一种方法是使用<code class="fe lv lw lx ly b">dict(iterable, **kwarg) </code>方法。与当前主题特别相关的是，当<code class="fe lv lw lx ly b">iterable</code>是一个<code class="fe lv lw lx ly b">dict</code>时，将用相同的键-值对创建一个新的<code class="fe lv lw lx ly b">dict</code>。对于关键字参数，我们可以传递另一个<code class="fe lv lw lx ly b">dict</code>，这样它会将键值对添加到将要创建的<code class="fe lv lw lx ly b">dict</code>中。请注意，这个关键字参数<code class="fe lv lw lx ly b">dict</code>将使用相同的键替换该值——类似于“上次看到的获胜”请看下面的例子。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="8fc9" class="nh mh it ly b gy ni nj l nk nl">d3 = dict(d1, **d2)<br/># d3 is {'a': 1, 'b': 2, 'c': 3, 'd': 4}<br/># Good, it's what we want</span><span id="b93a" class="nh mh it ly b gy nm nj l nk nl">d3 = dict(d1, **d2a)<br/># d3 is {'a': 10, 'b': 2, 'c': 3, 'd': 4}<br/># Not right, 'a' value got replaced</span></pre><p id="6238" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的一点是，只有当关键字参数<code class="fe lv lw lx ly b">dict</code>将字符串作为它们的键时，这个方法才有效。如下图所示，使用<code class="fe lv lw lx ly b">int</code>作为键的<code class="fe lv lw lx ly b">dict</code>无法工作。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="c700" class="nh mh it ly b gy ni nj l nk nl">&gt;&gt;&gt; dict({'a': 1}, **{2: 3})<br/>Traceback (most recent call last):<br/>  File "&lt;stdin&gt;", line 1, in &lt;module&gt;<br/>TypeError: keywords must be strings<br/>&gt;&gt;&gt; dict({'a': 1}, **{'2': 3})<br/>{'a': 1, '2': 3}</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="c445" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">合并词典—新功能</h1><p id="67e2" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在最新发布的Python 3.9.0a4中，我们可以非常方便地使用合并运算符|来合并两个<code class="fe lv lw lx ly b">dict</code>。下面给出一个例子。您可能已经注意到，当这两个<code class="fe lv lw lx ly b">dict</code>之间有重叠的键时，最后看到的键会胜出，这种行为与我们前面看到的一致，例如<code class="fe lv lw lx ly b">update()</code>方法。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="5114" class="nh mh it ly b gy ni nj l nk nl"># use the merging operator |<br/>d3 = d1 | d2<br/># d3 is now {'a': 1, 'b': 2, 'c': 3, 'd': 4}<br/># good</span><span id="eb70" class="nh mh it ly b gy nm nj l nk nl">d3 = d1 | d2a<br/># d3 is now {'a': 10, 'b': 2, 'c': 3, 'd': 4}<br/># not good</span></pre><p id="af70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与这个合并操作符相关的是扩充赋值版本，它就地操作(即更新左侧<code class="fe lv lw lx ly b">dict</code>)。本质上，其功能与<code class="fe lv lw lx ly b">update()</code>方法相同。下面的代码片段向您展示了它的用法:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="39c5" class="nh mh it ly b gy ni nj l nk nl"># Create a copy for d1<br/>d3 = d1.copy()</span><span id="4b1e" class="nh mh it ly b gy nm nj l nk nl"># Use the augmented assignment of the merge operator<br/>d3 |= d2<br/># d3 now is {'a': 1, 'b': 2, 'c': 3, 'd': 4}<br/># good</span><span id="57c1" class="nh mh it ly b gy nm nj l nk nl">d3 |= d2a<br/># d3 now is {'a': 10, 'b': 2, 'c': 3, 'd': 4}<br/># not good</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="da7a" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结束语</h1><p id="fedb" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">本文回顾了Python 3.9中合并和更新字典的新特性。在几个模块中还有其他几个新的更新/改进，例如<code class="fe lv lw lx ly b">asyncio</code>、<code class="fe lv lw lx ly b">math</code>和<code class="fe lv lw lx ly b">os</code>模块。详见<a class="ae ky" href="https://docs.python.org/3.9/whatsnew/3.9.html" rel="noopener ugc nofollow" target="_blank">官网</a>。我迫不及待地想在10月份的正式发布中一探究竟！</p><p id="2394" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你准备好迎接Python 3.9了吗？敬请期待它正式发布时对其新功能的评论！</p></div></div>    
</body>
</html>