<html>
<head>
<title>Iterate Faster With Github Actions for React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Github Actions for React Native加快迭代速度</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/iterate-faster-with-github-actions-for-react-native-55297e9975b4?source=collection_archive---------14-----------------------#2020-02-26">https://betterprogramming.pub/iterate-faster-with-github-actions-for-react-native-55297e9975b4?source=collection_archive---------14-----------------------#2020-02-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="eac5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过自动化工作节省时间、金钱和神经细胞</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8c938b3c52e20bebd8e86d5e46d0abca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C4PkMOdELOmnHPVp.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/photos/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=918735" rel="noopener ugc nofollow" target="_blank"> Free-Photos </a>来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=918735" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><p id="097d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://reactnative.dev/" rel="noopener ugc nofollow" target="_blank"> React Native </a>，连同<a class="ae ky" href="https://expo.io/" rel="noopener ugc nofollow" target="_blank"> Expo SDK </a>，极大地加速了移动app开发的进程。如果说您可以通过采用持续集成和部署实践来进一步推动它<em class="lv">呢？</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="d867" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">什么是CI/CD？</h1><p id="c7f6" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">CI/CD代表持续集成和持续部署。<a class="ae ky" href="https://en.wikipedia.org/wiki/Continuous_integration" rel="noopener ugc nofollow" target="_blank">持续集成</a>是将代码中的一些变化集成到代码库的其余部分中的实践，以确保它不会破坏任何东西(使用单元测试和集成测试)。</p><p id="62c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Continuous_deployment" rel="noopener ugc nofollow" target="_blank">持续部署</a>是部署过程的自动化，允许团队节省时间和更快地迭代。结合起来，这些实践减少了拥有大型团队和代码库的开销，确保您的代码是干净和一致的，并允许开发人员专注于代码而不是基础设施。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4f54" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">什么是Github动作？</h1><p id="c0a6" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><a class="ae ky" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> Github Actions </a>是一些小脚本，可以插入常见的Github特性，比如打开一个pull请求、创建一个问题、合并到master等等。</p><p id="644c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">已经创建了数千个可以在项目中使用的操作。Github Actions可以让你自动完成你能想到的任何事情，包括运行测试、将构建部署到生产环境、根据更改的文件标记PRs等等。</p><p id="0c97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哦，我提到过Github动作对公共存储库是完全免费的吗？</p><h1 id="9ab7" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">创建一个示例项目</h1><p id="4318" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为了向您展示Github Actions的强大功能，我将带您创建一个简单的Expo移动应用程序，并设置Github Actions来自动化其测试和部署。本教程不是关于React Native的，所以我假设你对移动开发有所了解。如果没有，<a class="ae ky" href="https://reactnative.dev/docs/tutorial" rel="noopener ugc nofollow" target="_blank">先看看这个教程。</a></p><p id="84b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建一个新的Expo SDK项目，首先通过运行以下命令确保您已经安装了<code class="fe nf ng nh ni b">expo-cli</code>:</p><pre class="kj kk kl km gt nj ni nk nl aw nm bi"><span id="7bce" class="nn me it ni b gy no np l nq nr">npm i -g expo-cli</span></pre><p id="d3c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您可以创建一个项目:</p><pre class="kj kk kl km gt nj ni nk nl aw nm bi"><span id="de77" class="nn me it ni b gy no np l nq nr">expo init</span></pre><p id="06bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Expo会问你几个配置问题。选择“空白”作为应用程序模板，并输入项目的名称。几分钟后，项目将被创建。您可以通过打开项目文件夹并运行以下命令来检查一切是否正常:</p><pre class="kj kk kl km gt nj ni nk nl aw nm bi"><span id="0146" class="nn me it ni b gy no np l nq nr">expo start</span></pre><p id="26c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">注意:您需要一部手机或安装了Expo客户端的模拟器来运行您的应用程序。</em></p><p id="3306" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/37e54a72767ee66b8e8be86dcf6f4368.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/0*laTQ8xsU3M5llg7r"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="726a" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">在Github上发布您的项目</h1><p id="d380" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">要使用Github动作，你的项目需要托管在Github上(显然！)</p><p id="e03a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，在Github上创建一个repo。<a class="ae ky" href="https://github.com/new" rel="noopener ugc nofollow" target="_blank">此链接</a>将带您进入新的回购页面。输入新回购的名称和描述(如果需要)。创建好repo之后，就可以将项目发布到Github了。在项目文件夹中打开终端，并在其中运行以下命令:</p><pre class="kj kk kl km gt nj ni nk nl aw nm bi"><span id="acc4" class="nn me it ni b gy no np l nq nr">git remote add origin remote YOUR_REPO_URL_HERE <br/>git push origin master</span></pre><p id="b87e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你可以在Github上打开你的回购，并验证一切都在那里。我还公布了我的回购协议，并公之于众，你可以在任何时候<a class="ae ky" href="https://github.com/r3dm1ke/rn-cicd-tutorial" rel="noopener ugc nofollow" target="_blank">参考</a>它。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="22fe" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">添加单元测试框架</h1><p id="43d2" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">最流行的CI操作之一是对每个pull请求运行单元测试。当然，要运行单元测试，我们首先需要有单元测试。在这里，我不会详细介绍React本地项目的单元测试，但是可以随时查看本文以供参考:</p><div class="nt nu gp gr nv nw"><a href="https://medium.com/@mihalkrasnov/testing-react-native-apps-with-jest-1d575ded6a2c" rel="noopener follow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd iu gy z fp ob fr fs oc fu fw is bi translated">用Jest测试React本地应用</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">在这篇文章中，我将解释为什么单元测试是重要的，单元测试的一些原则，并向你展示它是如何…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">medium.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok ks nw"/></div></div></a></div><p id="c671" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了设置单元测试，我们需要更多的包:</p><pre class="kj kk kl km gt nj ni nk nl aw nm bi"><span id="c84c" class="nn me it ni b gy no np l nq nr">npm i -S jest jest-expo react-native-testing-library</span></pre><p id="1bf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">jest</code>是试车员。它将收集我们的测试，运行它们，并报告结果。<code class="fe nf ng nh ni b">jest-expo</code>有一些专门针对世博项目的配置。<code class="fe nf ng nh ni b">react-native-testing-library</code>有一组帮助器来渲染和触发组件上的动作。安装好所有东西后，创建一个文件<code class="fe nf ng nh ni b">jest.config.js</code>,其中包含以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="8acb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个配置告诉<code class="fe nf ng nh ni b">jest</code>使用<code class="fe nf ng nh ni b">jest-expo</code>预置，并针对Android和iOS运行两次测试。要运行测试，请将这一行添加到package.json的脚本部分:</p><pre class="kj kk kl km gt nj ni nk nl aw nm bi"><span id="e9d5" class="nn me it ni b gy no np l nq nr">"test": "jest"</span></pre><p id="14be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以尝试现在用<code class="fe nf ng nh ni b">npm test</code>运行测试，但是它会失败，因为我们现在没有任何测试。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ea44" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">添加功能和单元测试</h1><p id="ea8c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">要添加单元测试，我们需要测试一些东西。让我们添加一个计数器和一个按钮，这将增加一个计数器。将此代码添加到<code class="fe nf ng nh ni b">App.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="59f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它在手机上应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/50ec23f4cb35599805e297c486182d3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/0*CaWZCR-PHUxWrlwl"/></div></figure><p id="d25e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们需要测试它。默认情况下，jest会在每个以<code class="fe nf ng nh ni b">test.js</code>结尾的文件中选取测试。创建一个文件<code class="fe nf ng nh ni b">App.test.js</code>并将以下代码添加到其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="6dc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该测试套件将检查:</p><ol class=""><li id="e889" class="on oo it lb b lc ld lf lg li op lm oq lq or lu os ot ou ov bi translated">快照</li><li id="ccb7" class="on oo it lb b lc ow lf ox li oy lm oz lq pa lu os ot ou ov bi translated">计数器初始值为0</li><li id="042a" class="on oo it lb b lc ow lf ox li oy lm oz lq pa lu os ot ou ov bi translated">当按下按钮时，计数器增加到1</li></ol><p id="9bd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以用<code class="fe nf ng nh ni b">npm test</code>来运行它。输出应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/0ae090b20cb59f9528fd93494edb6a18.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/0*N03W-OBN4Pz4IS8t.png"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8c88" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">添加您的第一个Github动作</h1><p id="ed00" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Github动作是用<a class="ae ky" href="https://yaml.org/" rel="noopener ugc nofollow" target="_blank"> YAML </a>编写的。YAML是一种配置语言——非常像JSON，但是更易于阅读。这些配置存储在<code class="fe nf ng nh ni b">.github/workflows</code>中。</p><p id="06c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用以下内容创建一个文件<code class="fe nf ng nh ni b">.github/workflows/tests.yml</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="dc3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个文件定义了一个名为<code class="fe nf ng nh ni b">Run test suite</code>的Github动作(第1行)。</p><p id="fbc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我指定它在任何拉请求时运行(第3行)。</p><p id="70b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">jobs</code>部分定义了要完成的任务。在我们的例子中，它只有一个:<code class="fe nf ng nh ni b">build</code>(第5-6行)。</p><p id="f5e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">strategy</code> <em class="lv"> / </em> <code class="fe nf ng nh ni b">matrix</code>部分是为了确保我们的测试在不同的环境中是一致的。它可以测试操作系统(win、lin、mac)和节点版本(8、10、12)的所有组合。</p><p id="7879" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个非常健壮的解决方案，但是将占用大量资源(每个测试用例将运行3*3=9次)。如果你在付费计划中，你应该考虑取消一些选项。</p><p id="bb90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">steps</code>部分定义了要采取的具体步骤。<code class="fe nf ng nh ni b">-uses: actions/checkout@v1</code>行(14)使用另一个动作将代码从分支中签出到环境中。然后，<code class="fe nf ng nh ni b">actions/setup-node@v1</code>(第17行)动作将Node安装到相同的环境中。</p><p id="5596" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，第21-23行列出了将要运行的实际终端命令。<code class="fe nf ng nh ni b">npm ci</code>与<code class="fe nf ng nh ni b">npm install</code>相同，但设计时考虑了CI/CD环境。首先，它从<code class="fe nf ng nh ni b">package-lock.json</code>而不是<code class="fe nf ng nh ni b">package.json</code>获取依赖信息。</p><p id="095f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一个命令运行测试。如果任何测试失败，jest将返回一个非零代码，Github会将其视为失败。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="0f36" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">测试您的第一个动作</h1><p id="92fb" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在您将您的更改提交并推送到Github之后，您的操作将是活动的。为了测试它，创建一个新的分支:</p><pre class="kj kk kl km gt nj ni nk nl aw nm bi"><span id="764a" class="nn me it ni b gy no np l nq nr">git checkout -b testing-tests-action</span></pre><p id="cc61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了创造一个公共关系，我们必须改变一些事情。让我们更改<code class="fe nf ng nh ni b">App.js</code>中的文本，这样我们的快照会失败，我们稍后会更新它们以使测试通过。我只是把第12行的<code class="fe nf ng nh ni b">clicked</code>改成了<code class="fe nf ng nh ni b">pressed</code>。现在，提交并将您的分支推送到GitHub:</p><pre class="kj kk kl km gt nj ni nk nl aw nm bi"><span id="8785" class="nn me it ni b gy no np l nq nr">git add . <br/>git commit -m 'dummy commit' <br/>git push origin testing-tests-action</span></pre><p id="9040" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后上Github开个PR:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/8f7083977851a48b1d61b63da5f4b2e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/0*HPdVs9BKbmb17pr3.png"/></div></figure><p id="4267" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您打开PR，Github将立即运行您的操作:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/9a7ef622eba61dbe6af8b6233eadec9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1bCitTXm6Zt9dCQq.png"/></div></div></figure><p id="410c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几分钟后，测试将会失败。这是因为我们更新了UI，但没有更新快照。您可以通过单击“详细信息”来检查脚本的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/fa5435c9fc66eab07365a2fc667d1655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MuBsk4eb97ARxp5l.png"/></div></div></figure><p id="76b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，Jest告诉我们快照正在失败。要修复它，运行项目文件夹中的<code class="fe nf ng nh ni b">npm test -- -u</code>。这将更新<code class="fe nf ng nh ni b">snap.android</code>和<code class="fe nf ng nh ni b">snap.ios</code>文件。一旦它们被更新，提交并再次推送它们。由于您对PR进行了更改，Github将再次运行您的操作。几分钟后，您的测试应该会通过:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/00cfb905436bc08c66b7be49d826b328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uruIKncw-1HehnZb.png"/></div></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="653d" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">用Github动作简化评论</h1><p id="8b6e" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">单元测试是好的，但是你通常也想在你的手机上测试。当然，您可以在PC上克隆PR并构建它，但这听起来工作量太大了。让我们实现自动化吧！</p><p id="c31d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到<code class="fe nf ng nh ni b">master</code>分支，用以下代码创建一个文件<code class="fe nf ng nh ni b">.github/workflows/review.yml</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="3645" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你会注意到这个动作也在每个PR上运行，并且使用现在熟悉的<code class="fe nf ng nh ni b">checkout</code>和<code class="fe nf ng nh ni b">setup-node</code>动作。这里的三个新概念是<code class="fe nf ng nh ni b">expo/expo-github-action</code>、<code class="fe nf ng nh ni b">unsplash/comment-on-pr</code>和<code class="fe nf ng nh ni b">secrets</code>。</p><p id="8f47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">expo-github-action</code>具有操作<code class="fe nf ng nh ni b">expo-cli</code>的功能。它允许我们测试、构建和发布世博会项目。要工作，它需要一个工作博览会帐户。如果您没有，请在此处创建一个<a class="ae ky" href="https://expo.io/signup" rel="noopener ugc nofollow" target="_blank">。此操作使用PR ID将应用程序发布到特定的发布渠道。</a></p><p id="7f0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">unsplash/comment-on-pr</code>行动用于对PR上的世博会构建链接进行评论。URL是在第24行构建的。请务必将<code class="fe nf ng nh ni b">YOUR_APP_SLUG_HERE</code>更改为您实际的应用程序块(您可以在<code class="fe nf ng nh ni b">app.json</code>中找到它)</p><p id="dca7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">secrets</code>是一种将凭证传递给动作而不在回购中暴露它们的安全方式。如果您检查代码，您可以看到我们需要<code class="fe nf ng nh ni b">EXPO_CLI_USERNAME</code>、<code class="fe nf ng nh ni b">EXPO_CLI_PASSWORD</code>和<code class="fe nf ng nh ni b">GITHUB_TOKEN</code>。世博秘笈是您之前创建的世博账户的凭证。<code class="fe nf ng nh ni b">GITHUB_TOKEN</code>是Github API的访问令牌，由Github自动为您注入。</p><p id="26b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要将这些凭证添加到secrets，请打开repo的<code class="fe nf ng nh ni b">Settings</code>部分，然后选择<code class="fe nf ng nh ni b">Secrets</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/c881279c049f464647e184db5c6018d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mmYwEPBE-XR1uGn0.png"/></div></div></figure><p id="2568" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在添加世博会证书:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/19c0f378131e1f5c55e0b4b6cf63e630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*btN1MD2CT1oXlgZH.png"/></div></div></figure><p id="926a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的行动应该准备好了。要检查它，创建一个新的分支，改变一些东西(我把背景颜色设为绿色)，然后打开一个PR。我们之前已经做过了，所以我不打算再按部就班地做了。完成后，此操作将构建您的应用程序，发布它并在PR上评论一个链接:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/f9634ec4405f61cd3116e1ed6a699d90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vJpmaLPbA7AZDlam.png"/></div></div></figure><p id="2eaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您团队中的任何人都可以在他们的手机上点击这个链接，打开这个非常公关！这与Github移动客户端配合得特别好。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="1c51" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用Github动作自动化您的部署</h1><p id="1e37" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">你可能会在这一点上停下来，但我非常懒惰，这就是为什么我们也将自动部署Expo应用程序。它将在每次提交/合并到<code class="fe nf ng nh ni b">master</code>分支时运行。一般来说，你的开发会集中在类似于<code class="fe nf ng nh ni b">develop</code>分支的东西上，你会通过把它合并到<code class="fe nf ng nh ni b">master</code>中(或者使用一个中间分支，比如<code class="fe nf ng nh ni b">release-candidate</code>)来做一个发布。</p><p id="80e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，部署操作非常简单，与上一个相似。用以下代码创建一个文件<code class="fe nf ng nh ni b">.github/workflows/deploy.yml</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="bc7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如我所说，此时一切都应该看起来很熟悉。我们检查代码，安装Node和Expo，运行测试，然后发布。运行测试似乎是多余的，但是我们这样做只是为了确保不完整的版本不会进入生产。</p><p id="71b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以通过将任何内容推送到主分支来测试这个脚本(不过，要确保测试通过)。然后，您的应用程序应该可以通过Expo客户端获得，如果您进行了任何生产构建，它们也应该得到更新。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="0f4b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结束语</h1><p id="9e43" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">感谢您的阅读，希望本指南能对您的项目有所帮助。请在评论中告诉我你的想法以及你能想到的其他CI/CD行动！</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2e44" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">资源</h1><ul class=""><li id="c9b7" class="on oo it lb b lc mv lf mw li pj lm pk lq pl lu pm ot ou ov bi translated"><a class="ae ky" href="https://github.com/r3dm1ke/rn-cicd-tutorial" rel="noopener ugc nofollow" target="_blank">同伴回购</a></li><li id="0a2a" class="on oo it lb b lc ow lf ox li oy lm oz lq pa lu pm ot ou ov bi translated"><a class="ae ky" href="https://www.infoworld.com/article/3113680/5-common-pitfalls-of-cicd-and-how-to-avoid-them.html" rel="noopener ugc nofollow" target="_blank">CI/CD的5个常见陷阱</a></li><li id="a8c8" class="on oo it lb b lc ow lf ox li oy lm oz lq pa lu pm ot ou ov bi translated"><a class="ae ky" href="https://ieeexplore.ieee.org/document/7884954" rel="noopener ugc nofollow" target="_blank">持续集成、交付和部署:对方法、工具、挑战和实践的系统审查</a></li><li id="2c55" class="on oo it lb b lc ow lf ox li oy lm oz lq pa lu pm ot ou ov bi translated"><a class="ae ky" href="https://github.com/marketplace?type=actions" rel="noopener ugc nofollow" target="_blank"> Github行动市场</a></li><li id="1a74" class="on oo it lb b lc ow lf ox li oy lm oz lq pa lu pm ot ou ov bi translated"><a class="ae ky" href="https://www.widgetsandburritos.com/posts/2019-01-09/important-security-implications-github-actions" rel="noopener ugc nofollow" target="_blank">Github动作的安全含义</a></li><li id="bd1d" class="on oo it lb b lc ow lf ox li oy lm oz lq pa lu pm ot ou ov bi translated"><a class="ae ky" href="https://docs.expo.io/versions/latest/guides/setting-up-continuous-integration/" rel="noopener ugc nofollow" target="_blank">CI/CD上的Expo SDK文档</a></li></ul></div></div>    
</body>
</html>