<html>
<head>
<title>How To Handle Big Data With Node.js, AWS Kinesis, AWS S3, and AWS Athena</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Node.js、AWS Kinesis、AWS S3、AWS雅典娜处理大数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/handling-big-data-with-node-js-aws-kinesis-aws-s3-and-aws-athena-a7e5757b25f5?source=collection_archive---------3-----------------------#2021-06-25">https://betterprogramming.pub/handling-big-data-with-node-js-aws-kinesis-aws-s3-and-aws-athena-a7e5757b25f5?source=collection_archive---------3-----------------------#2021-06-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b258" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建一个在AWS S3中管理和存储数据的Node.js应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5f0c82e6c5cad5ea7618ed28b1f59edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pVSoPjNzlZbgpB-nEJpSSw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://www.pexels.com/photo/red-lights-in-line-on-black-surface-158826/" rel="noopener ugc nofollow" target="_blank">https://www . pexels . com/photo/red-lights-in-line-on-black-surface-158826/</a></p></figure><p id="3eb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们试图构建一个接收持续数据流的应用程序。这些数据将是大量的，需要被存储，不会改变，并且需要在以后被查询，例如，网络分析，物联网信号，或者一个投票应用。AWS提供了许多工具来实现这样的用例。</p><p id="aa1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将研究如何构建一个简单的应用程序，该应用程序从<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>服务器接收数据，将其存储到<a class="ae ky" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> AWS S3 </a>，并使用<a class="ae ky" href="https://aws.amazon.com/athena/?whats-new-cards.sort-by=item.additionalFields.postDateTime&amp;whats-new-cards.sort-order=desc" rel="noopener ugc nofollow" target="_blank"> AWS Athena </a>启用SQL查询。我们的数据管道看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/4f7f4c6ba40a64fc62451e0585c24aca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0RjB21AJe0jwmpphHwosjw.png"/></div></div></figure><h1 id="4bf9" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第一步。创建AWS S3存储桶</h1><p id="aa16" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在你的AWS管理控制台，前往亚马逊S3，并点击创建桶。输入存储桶名称，然后继续创建此存储桶。我们将在后面的过程中使用这个铲斗。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/f1be6d37e302819dd251884d3ed54570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o5ZyngkUthYMvbGsQBYyng.png"/></div></div></figure><h1 id="1986" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">第二步。创建一个AWS Kinesis数据流</strong></h1><p id="2cb7" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在你的AWS管理控制台中，前往<a class="ae ky" href="https://aws.amazon.com/kinesis/" rel="noopener ugc nofollow" target="_blank"> Amazon Kinesis </a>，并进入数据流选项卡。然后点击“创建数据流”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/fe8bda0f97fd804dc6bbb9545aaaa27c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jcoKqFtiDxHid-nI44cecQ.png"/></div></div></figure><p id="f2da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，输入您的流的名称。我们要用<code class="fe mv mw mx my b">voting-app</code>。您可以在这里写任何东西，这个名称将在后面的Node.js应用程序中使用。在“数据流容量”<strong class="lb iu"> </strong>下，您可以在“打开碎片数”下输入1<strong class="lb iu"> </strong>在同一个页面上，你会看到Shard estimator，以防你想计算你需要多少个Shard。你可以随时编辑这个数字，所以我们现在用1。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/a1699e3d0665a844feeb989265d39a93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t10PMuHkYzCaWAvopU-oKQ.png"/></div></div></figure><p id="d91d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据流创建完成后，点击“处理交付流”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/9fb032ba1fff9c3d9ea5ada605f35a9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y7DlSh9KQ2A0yIAt7Ysmug.png"/></div></div></figure><h1 id="2160" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第三步。创建AWS数据消防水带交付流</h1><p id="65db" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在下一个屏幕(New delivery system)中，添加一个交付流名称，并选择我们之前创建的数据流。交付流将允许我们(简单地说)从数据流中提取数据，并将其存储在S3。添加完这两个字段后，单击下一步。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/4a8c6dc9900cdf2cd126058466e740ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UDo471D9EPltU-dNDa5M2g.png"/></div></div></figure><p id="1978" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一页上，为“转换记录格式”选择Enabled，并在Output format下选择Apache Parquet。众所周知，Apache Parquet的查询效率比JSON高。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/95957237cd0262c33e52ce6ca2abe802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SaEtsGJ8ByLXAQhcwd5XdQ.png"/></div></div></figure><p id="43cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了将我们的JSON数据转换成Parquet，我们将使用AWS Glue。我们将在下一步中这样做。现在点击“在AWS Glue中手动创建一个新表格”这将打开一个新标签。</p><p id="1e98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">不要关闭当前标签页。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/0944c3531de1d6416cd95faaa6420baa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8U92ZmEi_FapK1xq0lqz_A.png"/></div></div></figure><h1 id="d8c7" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第四步。创建AWS粘合表和数据库</h1><p id="ca94" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在新打开的选项卡中，我们将创建一个表和一个数据库。输入一个表名，然后单击添加数据库。在弹出模式中，输入数据库名称。然后选择那个数据库。单击下一步继续。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/e324b4f6c5e960b525b7bd272e47d5e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D_ygpBDye7Ad8DucVQAlpQ.png"/></div></div></figure><p id="ffa4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一页，确保选择S3，然后选择我们在步骤1中创建的桶。你可以点击右边的小文件夹图标来选择你的S3桶。单击下一步继续。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/135b6c437e4dc408f2597ec4dfee905a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*No34Sv1ObsdsrI6hc2iZmQ.png"/></div></div></figure><p id="d325" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择下一页的拼花地板。单击下一步。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/28653d70fc573cee221be11b26a72c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8UygNS0t-03MgChIUpLpow.png"/></div></div></figure><p id="3c32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个页面上，我们为我们的数据添加模式。让我们假设每条记录的数据如下例所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/88dde2d89d4508e80c3ba6044dfc19e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*Hdgcd0ulfzkWgcZFJsrx5Q.png"/></div></figure><p id="836b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我们有两列，都是字符串。单击“添加列”来添加我们的两个列。</p><p id="a443" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们添加了这两列，我们应该会看到类似这样的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/7bf6692c007b38b348c208443a6d61c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1MZZDJ-c7GsBlafZjmf6Rw.png"/></div></div></figure><p id="4864" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击下一步继续。<strong class="lb iu">跳过添加分区索引</strong>。</p><p id="1d2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一页是我们表格的摘要—单击Finish。</p><p id="8ab4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在回到我们之前的选项卡。单击refresh按钮，选择我们刚刚在上面创建的Glue数据库和Glue表。单击下一步继续。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/188e9815dbe537f09a65dace3a2c2f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OmtOgadijvZRkR_vTafIpw.png"/></div></div></figure><p id="cfcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一页，选择我们之前创建的同一个S3存储区，然后单击next继续。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/814f8865a1d9f2a23aa841c011af014f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0gqtMYXhsEVw8j-c8CeLmQ.png"/></div></div></figure><p id="07ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一页，我们将确定缓冲区大小和缓冲区间隔。一旦满足这些条件中的任何一个，就会触发记录传送。我选择128MB的缓冲区大小和60秒的缓冲区间隔。单击下一步继续。在下一个摘要页面上，单击“创建交付流”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/cba61a850903f67bf989ab2de71af30f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ZESRqR06mO-f6q0tQ9h9Q.png"/></div></div></figure><p id="15b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你将来到这个页面，这意味着你已经成功地创建了你的交付流。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/caaadabe0e04ea466278d2960e1fc493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yHII-MTkpmHbzGlUQRfvVA.png"/></div></div></figure><h1 id="f4a0" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第五步。为AWS SDK创建AWS凭据</h1><p id="515a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">接下来，我们必须创建用户凭证，以便在Node.js应用程序中运行AWS SDK。在管理控制台中，转到IAM。</p><p id="d4c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个具有编程访问权限的用户，并为Kinesis、S3和雅典娜附加策略。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/36f2938a1c4573bdfae027d7d8813b84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YyBN9zV9MhuX2mSht_lbgw.png"/></div></div></figure><p id="20ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保存该用户并确保保留凭据。</p><h1 id="6a38" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第六步。向AWS Kinesis数据流发送数据</h1><p id="122f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">让我们假设您有一个Node.js应用程序。例如，您可能有一个带有POST route的Express应用程序，它接收要发送到流的数据。</p><p id="4868" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要向我们的Kinesis数据流添加数据，我们必须首先安装AWS SDK。您可以使用以下方法为您的应用程序实现这一点:</p><pre class="kj kk kl km gt no my np nq aw nr bi"><span id="0829" class="ns lx it my b gy nt nu l nv nw">npm install aws-sdk</span></pre><div class="nx ny gp gr nz oa"><a href="https://github.com/aws/aws-sdk-js" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">aws/aws-sdk-js</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">浏览器和Node.js中的AWS SDK for JavaScript。通过在…上创建帐户，为aws/aws-sdk-js开发做出贡献</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ks oa"/></div></div></a></div><p id="9b49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的应用程序中，我们只需要创建一个新的Kinesis实例并调用<code class="fe mv mw mx my b">putRecord</code>方法。下面是Node.js中向数据流添加数据的一个简单示例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="4933" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以多次运行上面的代码(无论您喜欢哪种方式)。我建议使用<code class="fe mv mw mx my b">setInterval</code>并向流发送一堆测试数据。</p><p id="5afc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您已经成功地将数据发送到流，您将会看到如下所示的日志:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/4f7b0b25c6a5e6c0e726ef1b2696c8e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JpsxXPtTTPVcZDw1143x0w.png"/></div></div></figure><p id="0a89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">等待几分钟。</strong></p><p id="259a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以检查数据是否已经发送到您的S3存储桶。您将看到一个以当前年份为名称的文件夹。继续点击文件夹，您会看到一个<code class="fe mv mw mx my b">.parquet</code>文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/368d85b491562e99e99f0a01c7ff0346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oh1B0W8B1vXebIXvBWNZTQ.png"/></div></div></figure><p id="011e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想下载并检查这个文件，您可以使用VS代码扩展。</p><div class="nx ny gp gr nz oa"><a href="https://marketplace.visualstudio.com/items?itemName=dvirtz.parquet-viewer" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">拼花地板-查看器- Visual Studio市场</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">将Apache Parquet文件视为JSON。当打开一个拼花文件时，文件的JSON表示将打开…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">marketplace.visualstudio.com</p></div></div><div class="oj l"><div class="ot l ol om on oj oo ks oa"/></div></div></a></div><h1 id="70ef" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第七步。使用AWS Athena查询数据</h1><p id="1386" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在我们已经发送了一些测试数据，我们可以使用AWS Athena查询这些数据。但是在此之前，我们必须创建另一个S3存储桶来存储Athena的结果。前往您的管理控制台，并前往AWS S3。创建一个名为<code class="fe mv mw mx my b">voting-app-result</code>的存储桶。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/eb3d23efb83d9887c96ca076f9451998.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dYsMLxCAh1EYrlioUWormg.png"/></div></div></figure><p id="0f71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前往您的管理控制台并访问AWS Athena。</p><p id="a552" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们要做的第一件事是设置查询结果位置。单击Settings并添加我们在上面创建的bucket作为结果位置。单击保存并退出设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/6789625af88cd6b662d8db06a04f74da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JwT-VGAgbmGIL2v3u0yGBw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/e45dee700cdddc28c75c939f2c27ee19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d2NS8LWd9ZIs5XIBkCJTQA.png"/></div></div></figure><p id="d44c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，确保数据库设置为我们之前创建的数据库。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/53ddf2ca99f9d8f0e68a51234dbf5cff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_xXE-5Dge-Y7E07FOEGyEg.png"/></div></div></figure><p id="00ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们准备好查询我们的数据。在“表格”下，单击表格名称旁边的三个垂直点图标，然后单击“预览结果”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/aaa59d4c1b4410d1016984e8b483c8a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wKDgIhMTlNWfCtlkLKs1Bw.png"/></div></div></figure><p id="9bc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将在编辑器中看到SQL查询，数据将在底部加载。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/c84c1ff9feab304655e184596617e812.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rDwF8KaY0fa2dQq8EMh55Q.png"/></div></div></figure><p id="c4da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们试着统计一下每个<code class="fe mv mw mx my b">choice</code>我们得到了多少票。我们可以使用下面的查询来获得这些数据:</p><pre class="kj kk kl km gt no my np nq aw nr bi"><span id="a362" class="ns lx it my b gy nt nu l nv nw">SELECT choice, count(choice) AS count<br/>FROM "voting-app-db"."voting-app-table"<br/>GROUP BY choice</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/9ab144b4dc1098d2f963866a191a815d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_yzY29CWY3Uf5yEMPpBVAA.png"/></div></div></figure><h1 id="4bf3" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第八步。用Node.js查询Athena</h1><p id="d792" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">接下来，我们将使用Node.js进行类似的查询。通常，您可以通过GET route或在后台进程中实现这一点。</p><p id="9362" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一些示例代码。我们使用Lodash和Async库来构建一些助手函数。此代码已根据以下源代码进行了修改:</p><div class="nx ny gp gr nz oa"><a href="https://www.npmjs.com/package/lodash" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">洛达什</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">Lodash模块化实用程序。</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">www.npmjs.com</p></div></div><div class="oj l"><div class="pb l ol om on oj oo ks oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://www.npmjs.com/package/async" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">异步ˌ非同步(asynchronous)</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">异步代码的高阶函数和常见模式</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">www.npmjs.com</p></div></div><div class="oj l"><div class="pc l ol om on oj oo ks oa"/></div></div></a></div><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基于:<a class="ae ky" href="https://docs.aws.amazon.com/code-samples/latest/catalog/javascript-athena-index.js.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/code-samples/latest/catalog/JavaScript-Athena-index . js . html</a></p></figure><p id="cb5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将在控制台日志中看到您的数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/d89c2917b634519a9aaddba225cc5c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*euxxqEiiz6qTetRs1_L_XA.png"/></div></div></figure><h1 id="e2d4" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">仅此而已！我们完了。</h1><p id="f350" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">享受数据带来的乐趣。如果您想了解AWS数据架构的其他部分，请留下您的评论。</p></div></div>    
</body>
</html>