<html>
<head>
<title>Driving TypeScript Adoption With Automated Reports</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过自动化报告推动TypeScript的采用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/driving-typescript-adoption-with-automated-reports-dee725298302?source=collection_archive---------14-----------------------#2022-01-09">https://betterprogramming.pub/driving-typescript-adoption-with-automated-reports-dee725298302?source=collection_archive---------14-----------------------#2022-01-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="789f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何优先清理你的代码库</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/96f5f2b8b1388eeafa87558ef856f836.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SNpUA355r1M8pV6G"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@landall?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">蓝登</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="a23f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一，TypeScript好。但这不是这篇文章的内容。它是关于如果你工作中的代码库没有足够的代码该怎么办。</p><blockquote class="ls lt lu"><p id="c1ca" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">"你在你的React代码库中使用类型脚本吗？"我在一次求职面试中问我未来的老板。</p><p id="a02a" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">“是的。”答案是。</p><p id="9a30" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">“太好了！”</p></blockquote><p id="d259" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，唉，这并不伟大。我应该问，“你在多大程度上使用了TypeScript？”。TypeScript采用不是二元状态，而是一个谱。</p><p id="8205" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像许多老的React项目一样，代码库被重写为TypeScript，以一种“用TypeScript写新东西，有时间时修复旧东西”的方式。但是，如果没有一个设定的目标和一个衡量进展的标准，激励总是放在提供新功能上，而不是解决技术债务。</p><p id="af15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">切换后几个月，大部分代码仍然是无类型的，进展缓慢。我们知道从长远来看重写打字稿是有价值的。但是为了证明在它上面花费开发时间的合理性，我们想要跟踪和可视化我们的进展。</p><h1 id="4831" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated"><strong class="ak">游戏化最终目标</strong></h1><ol class=""><li id="6084" class="mr ms iq ky b kz mt lc mu lf mv lj mw ln mx lr my mz na nb bi translated">向您的决策者解释，在任何地方启用TypeScript都将有助于您提高运输速度和睡眠质量。</li><li id="9ca3" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">建立一个进度条给他们看。</li></ol><p id="1793" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样。<a class="ae kv" href="https://dl.acm.org/doi/10.1145/317456.317459" rel="noopener ugc nofollow" target="_blank">进度条很神奇</a>。它们简单得有些愚蠢，但却很有效。RPG玩家会苦干几个小时让他们的老圣骑士升到75级或者别的什么。目标清晰推动动力。人们做事是为了看到数字上升。出于同样的原因，开发人员会修复TypeScript错误。你可以在每个重要的里程碑给他们买披萨。</p><p id="a07c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不要误解我的意思，开发人员本质上是并且应该被激励去提高代码质量。但是这种情况发生了:</p><blockquote class="ls lt lu"><p id="e3fe" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">“为什么这项任务需要这么长时间？”— PM</p><p id="0323" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">"嗯，有许多打字稿要添加和修改."—开发</p><p id="1e48" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">“呃，好吧，听起来像是一个借口，但无论如何，我们能专注于提供客户价值吗？”— PM(可能在他的脑子里)</p></blockquote><p id="b544" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也许下一次你会把代码弄得和你发现的一样乱，以便在下一个任务中取得进展。你解决技术债务的工作是看不见的，只会碍事。或者对话可以这样进行:</p><blockquote class="ls lt lu"><p id="6440" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">“为什么这项任务需要这么长时间？”— PM</p><p id="107c" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">“嗯，有很多打字稿需要添加和修改，所以我把它修好了。看到进度条了吗？在这个冲刺阶段，我们将打字稿覆盖率从54%提高到了60%。我们越接近100，我们作为一个团队的长期速度就越快。”—开发</p><p id="09cf" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">“我明白了，干得好。”— PM</p></blockquote><p id="8aec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你的工作不再是无形的了。它使团队朝着既定目标<strong class="ky ir">前进了特定的量</strong>。<strong class="ky ir"> </strong>“有所衡量，有所作为”在这里很适用。</p><h1 id="3a6d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">衡量正确的事情</h1><p id="9d01" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">衡量TypeScript的适应性取决于您是否真的采用了TypeScript。</p><p id="2959" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也许你有<code class="fe nk nl nm nn b">.js(x)</code>和<code class="fe nk nl nm nn b">.ts(x)</code>档并排生活。这是最干净的选择。你可以用一个小魔术来计算它们:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数一数。js(x)和。ts(x)文件来计算类型脚本覆盖率</p></figure><p id="ee55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事实上，GitHub和GitLab都会自动显示你的库的语言统计数据。</p><p id="ce2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也许你所有的文件都是<code class="fe nk nl nm nn b">.ts</code>，但是你输入的所有文件都是<code class="fe nk nl nm nn b">any</code>。最好使用一种工具来分析你的<code class="fe nk nl nm nn b">any</code>使用情况并给出报告:</p><ul class=""><li id="a466" class="mr ms iq ky b kz la lc ld lf nq lj nr ln ns lr nt mz na nb bi translated"><a class="ae kv" href="https://github.com/plantain-00/type-coverage" rel="noopener ugc nofollow" target="_blank">类型-覆盖范围</a></li><li id="d129" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr nt mz na nb bi translated"><a class="ae kv" href="https://github.com/alexcanessa/typescript-coverage-report" rel="noopener ugc nofollow" target="_blank">打印-覆盖-报告</a></li></ul><p id="2640" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也许你的情况很乱。你的文件是<code class="fe nk nl nm nn b">.ts</code>并且包含一些类型，但是大多数都有<code class="fe nk nl nm nn b">@ts-nocheck</code>标志在最上面。然后，您需要计算违规文件的数量:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">计算包含@ts-nocheck的文件的百分比，以计算TypeScript覆盖率</p></figure><p id="01a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以对<code class="fe nk nl nm nn b">@ts-ignore</code>做类似的事情。无论问题是什么，你都需要相应地调整你的测量。</p><h1 id="0d0a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">构建报告</h1><p id="7622" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">百分比很好，但是你真的想要一个漂亮的彩色进度条。红色是坏的，绿色是好的。至关重要的是，它有助于及时看到进展，看到绿色慢慢击败红色，慢慢走向胜利。时间表也会有所帮助。</p><p id="1cf7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的报告——在一天的黑客马拉松中拼凑而成——看起来像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/2c880632ec9827dfdc774aa2973fc7aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8OCNXGBPa_E3dhRT8aei3Q.png"/></div></div></figure><p id="2e6d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用bash脚本对文件进行计数，并生成一个带有表格和图表的HTML文件。但是你可以用任何东西。</p><h1 id="cd91" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">自动化报告</h1><p id="eb3e" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">如果没有人看，进度条是没有用的。把数字放在人们面前很重要，这样他们就不用去挖了。尽可能消除摩擦。在我们的案例中，这意味着每周安排一次GitLab管道:</p><ol class=""><li id="14d0" class="mr ms iq ky b kz la lc ld lf nq lj nr ln ns lr my mz na nb bi translated">在我们的存储库上运行<code class="fe nk nl nm nn b">ts-report</code> bash脚本并生成报告。</li><li id="2c9c" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">将报告上传到<a class="ae kv" href="https://docs.gitlab.com/ee/user/project/pages/#how-it-works" rel="noopener ugc nofollow" target="_blank"> GitLab页面</a>。</li><li id="c4b7" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/microsoftteams/platform/webhooks-and-connectors/how-to/add-incoming-webhook" rel="noopener ugc nofollow" target="_blank">向团队频道</a>发送带有报告链接的消息。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的<code class="fe nk nl nm nn b">.gitlab-ci.yml</code>文件中的<code class="fe nk nl nm nn b">pages</code>作业(简体)</p></figure><p id="d060" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后每周一次，我们得到这个:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/ac51023b3c091e54919977d9e822d8ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cr3Zi96YYAZwcAfJZ22z5A.png"/></div></div></figure><p id="4867" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将报告直接放在消息中会更好，但现在这样就可以了。延期通知或电子邮件也可以。选择你的团队最常用的沟通工具。</p><h1 id="13ae" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">让自己负起责任</h1><p id="9e1b" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">最后一步是分享你的进步。我们的sprint评论有一个关于技术债务更新的专用幻灯片，所以我们在那里讨论我们的TypeScript覆盖范围。进度条可能是有效的，即使只在团队内部使用。但是更好的办法是公开承诺一个目标，并定期向利益相关者更新。</p><p id="6b2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">自构建报告以来，我们的TypeScript采用速度显著提高。(新团队成员等其他因素也有帮助。)</p><p id="26e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这一次是打字稿覆盖，但是您可以将相同的想法应用于不同类型的长期技术债务:</p><p id="b4d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lv">让看不见的工作不仅仅是看得见的，还要让看得见的工作变得容易，这样工作会完成得更快。</em></p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="4f7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读！你知道更好的方法吗？</p></div></div>    
</body>
</html>