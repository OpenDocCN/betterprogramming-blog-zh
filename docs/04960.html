<html>
<head>
<title>Build a React Weather App With Geolocation API and Open Weather Map API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用地理定位API和开放天气地图API构建React天气应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/react-weather-app-with-geolocation-api-and-open-weather-map-api-part-1-21d335d6aa34?source=collection_archive---------6-----------------------#2020-05-26">https://betterprogramming.pub/react-weather-app-with-geolocation-api-and-open-weather-map-api-part-1-21d335d6aa34?source=collection_archive---------6-----------------------#2020-05-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6302" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我如何解决这个带回家的面试问题</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f17510cddcf810dff1a44ad5ad5e53c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2M-93esqIwamkJHzoggrXQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者GIF。</p></figure><p id="f700" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我最近申请了一家公司的工作，现在还在和他们面试。我参加了第一次面试，之后我收到了一个GitHub库的链接，上面有一个需要在周末完成的代码挑战。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="d079" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">项目</h1><p id="9476" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">回购包含以下说明:</p><blockquote class="my mz na"><p id="ccce" class="ky kz nb la b lb lc ju ld le lf jx lg nc li lj lk nd lm ln lo ne lq lr ls lt im bi translated">“使用<a class="ae nf" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> Create React App </a>用<a class="ae nf" href="https://redux.js.org/" rel="noopener ugc nofollow" target="_blank"> Redux </a>或Context API编写一个小的单页面web应用。我们知道这个应用程序中没有太多的状态，但是构建一个状态管理库可以让我们更好地理解您的风格。</p><p id="eab0" class="ky kz nb la b lb lc ju ld le lf jx lg nc li lj lk nd lm ln lo ne lq lr ls lt im bi translated">如果您不喜欢React和/或更喜欢另一种web框架。没问题！我们使用React并享受它，但你不必现在就这样。随意使用Vue，Angular等，甚至普通JS，只要你完成下面的要求。但是，如果您使用React，请使用Create React App和一些状态管理库。"</p></blockquote></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="2a6a" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">要求</h1><blockquote class="my mz na"><p id="c777" class="ky kz nb la b lb lc ju ld le lf jx lg nc li lj lk nd lm ln lo ne lq lr ls lt im bi translated">“-中间有一个名为“当前天气”的按钮</p><p id="718e" class="ky kz nb la b lb lc ju ld le lf jx lg nc li lj lk nd lm ln lo ne lq lr ls lt im bi translated">-点击后，它使用内置浏览器<a class="ae nf" href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API" rel="noopener ugc nofollow" target="_blank">地理定位API </a>获取用户的位置</p><p id="89a5" class="ky kz nb la b lb lc ju ld le lf jx lg nc li lj lk nd lm ln lo ne lq lr ls lt im bi translated">-然后应用程序从<a class="ae nf" href="https://openweathermap.org/current" rel="noopener ugc nofollow" target="_blank"> OpenWeatherMap </a>获取该位置的当前天气，并将其显示在页面上。</p><p id="48d1" class="ky kz nb la b lb lc ju ld le lf jx lg nc li lj lk nd lm ln lo ne lq lr ls lt im bi translated">-在某个地方部署您的项目(<a class="ae nf" href="https://surge.sh/" rel="noopener ugc nofollow" target="_blank"> Surge.sh </a>是一个很好的简单解决方案)</p><p id="770f" class="ky kz nb la b lb lc ju ld le lf jx lg nc li lj lk nd lm ln lo ne lq lr ls lt im bi translated">我们主要考察您编写整洁有序的代码、与外部API交互以及处理异步JavaScript的能力。因此，虽然这个项目并不大，但我们希望你给我们发送你认为是高质量的代码。您的提交历史应该清楚地显示您在应用程序中的进度。"</p></blockquote><p id="0323" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一次有趣的练习，也是一次很好的回顾。作为一个在过去一个月左右一直在练习棱角技巧的人，我不得不承认我有点生疏了。</p><p id="db34" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在这里告诉你我的过程以及分享代码。我今天发现工程团队已经看到了我的提交，并希望明天通过Zoom查看它。我非常期待！我写这篇文章是为了让我的神经平静下来。</p><p id="f9b5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如标题所示，这将是一篇由两部分组成的文章。这是可以期待的。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="5502" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated"><strong class="ak">我们开始吧！</strong></h1><p id="9bc8" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">我喜欢从待办事项列表开始。我是一个守旧派，喜欢把我的待办事项写在一张纸上，因为没有什么比划掉清单上的一项并得到多巴胺激增的奖励更令人满意的了。我最近还从我最喜欢的YouTube频道之一了解到，简单地制定一个如何以及何时完成一项任务的计划可以帮助消除伴随着未完成任务而来的焦虑。</p><p id="37b8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后我收拾好我所有的工具。我的意思是，我已经阅读了足够多的关于地理定位API以及如何使用它的入门知识。我知道我稍后才需要天气API，但是我还是创建了一个帐户并请求了一个API密钥。激活它只需要几个小时，但其他API并不总是这样(有时可能需要几天)，我想确保它在我需要的时候准备好。我浏览了文档，并确信我已经拥有了启动这个应用程序所需的一切。</p><p id="72f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我创建了一个新目录，给我的应用取了一个吸引人的名字(为什么“Weatherly”还不是一个天气应用呢？)<em class="nb">，</em>在我的终端里键入create-react-app，让它施展魔法。</p><p id="190e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我喜欢从小处着手，然后从那里开始建设。所以我做的第一件事是确保有一个按钮可以工作，并且我正确地使用了地理定位API。</p><p id="0087" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我告诉你，这是我做过的最简单的事。他们的<a class="ae nf" href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API" rel="noopener ugc nofollow" target="_blank">文档</a>非常简单，你不需要在你的组件中安装、要求或导入任何额外的东西。我要特别注意的唯一一件事是确保所有的API调用都是针对HTTPS端点，而不是默认的HTTP。我指的是所有的API调用。我必须确保我所有的Open Weather Map API调用都是在安全的环境下进行的，并且我部署的应用程序链接也是安全的。为了安全起见，确保你所有的链接都是HTTPSs…否则(在第2部分会有更多)。</p><p id="a48c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我进一步讨论我的按钮组件之前，我想让您快速看一下我的文件设置。这是一个偏好，而不是一个要求，在这种规模的应用程序中当然没有必要，但是我喜欢坚持<a class="ae nf" href="https://www.oreilly.com/library/view/programming-javascript-applications/9781491950289/ch05.html" rel="noopener ugc nofollow" target="_blank">关注点分离原则</a>，把我的Redux组织到单独的文件夹中。如果你想要一个关于如何在你的应用中配置Redux商店的好指南，我强烈推荐官方Redux文档。但是，如何组织你的文件取决于你自己，下面是我选择的方法:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/3ac527fcca27ec7248ba225c2941f91d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*66k0r_856gS78AxkcVnR4A.png"/></div></figure><p id="da33" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我喜欢将我的存储、动作和减少器分开，甚至可以在一个更大的项目中给动作和减少器分开的文件夹。</p><p id="354c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想仔细看看我的文件，可以看看我的<a class="ae nf" href="https://github.com/jwkuchta/lu-code-challenge-weather-app/tree/master/src/redux" rel="noopener ugc nofollow" target="_blank"> redux文件夹</a>。</p><p id="e6c0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我为我的按钮创建了一个组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="2a4e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里有几件事:</p><ul class=""><li id="db6f" class="nj nk it la b lb lc le lf lh nl ll nm lp nn lt no np nq nr bi translated">我喜欢我的组件是功能性的，<em class="nb"> </em>因为这使它们更轻便，更容易调试，但是我通常从类组件开始，直到我确信一切正常后再进行重构。我专注于让事物工作，然后让它们对用户看起来更好，然后为了性能而重构。如果你认为有更好的方法，我欢迎你的想法。</li><li id="42e9" class="nj nk it la b lb ns le nt lh nu ll nv lp nw lt no np nq nr bi translated">如您所见，我正在从我的redux导入几个动作。正如我前面提到的，这种规模的应用程序通常不会保证使用Redux，本地状态也很好(也可能将所有代码保存在一个组件中)，但为了练习和证明我了解Redux，这就是我最后的结果。</li><li id="1f19" class="nj nk it la b lb ns le nt lh nu ll nv lp nw lt no np nq nr bi translated">我压缩了Geolocation API Navigator提供的方法，并将它们包装在我自己的函数中，在这个函数中，我访问位置数据并提取纬度和经度坐标(第12-21行)。</li><li id="f465" class="nj nk it la b lb ns le nt lh nu ll nv lp nw lt no np nq nr bi translated">当然，在我让它看起来很漂亮之前，我首先测试了按钮，并查看了我的数据，通过将按钮直接连接到方法来了解我正在处理什么。它看起来有点像这样:</li></ul><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="558d" class="oc mc it ny b gy od oe l of og">&lt;button <br/>onClick={navigator.geolocation.getCurrentPosition(position =&gt;       console.log(position))}&gt;<br/>Current Location<br/>&lt;/button&gt;</span></pre><p id="9246" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是数据的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/8202687d13862e05f2684f1a7877335d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q8Rpns3Y0zWsai19L0L5Ug.png"/></div></div></figure><p id="9c18" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是我知道如何访问纬度和经度数据的方法。</p><p id="8420" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我是一切事物的忠实粉丝，在我继续前进之前熟悉这些数据。</p><p id="3c6a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是地理定位API。真的就这么简单。第一次请求地理定位时，用户将被要求给予许可，但在以后的请求中不会被要求给予许可(除非您清空缓存)。此外，记得让你所有的链接与HTTPS安全。我遇到了几个问题，直到我发现通过HTTP获取的一个天气图标才是问题所在。永远从你的错误中学习。</p><p id="2589" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">至于我的组件，我喜欢把所有的东西都分开，尽管在这种规模的应用中完全没有必要。我也喜欢把大多数东西放在我的<code class="fe oi oj ok ny b">App.js</code>之外，尽管我知道开发人员喜欢把它作为家庭组件——这也很好。</p><p id="6b1d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我的<code class="fe oi oj ok ny b">App.js</code>就像他们得到的一样简单，并且包装了真正神奇发生的<code class="fe oi oj ok ny b">HomePage</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="7208" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在已经完成了，让我们深入到<a class="ae nf" href="https://openweathermap.org/api" rel="noopener ugc nofollow" target="_blank">开放天气地图API </a>以及我是如何压扁一些出现的bug的。</p><p id="d2b6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">出于本练习的目的，我使用当前的地理坐标来获取天气数据，这些数据与我之前通过ping Geolocation API获得的坐标相同。</p><p id="963c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae nf" href="https://openweathermap.org/current" rel="noopener ugc nofollow" target="_blank">这些</a>是Open Weather Map API提供给其用户的所有可用端点，下面是我使用的一个:</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="c6e0" class="oc mc it ny b gy od oe l of og"><strong class="ny iu">api.openweathermap.org/data/2.5/weather?lat={lat}&amp;lon={lon}&amp;appid={apiKey}</strong></span></pre><p id="f903" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如您所看到的，这些并不是您可以使用的所有参数，在我的例子中，我选择指定我希望温度信息提供给“英制”的单位(如第2行所示):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="2dcb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是我的<code class="fe oi oj ok ny b">WeatherOutput</code>组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="1cde" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是根据摄氏/华氏选择的输出:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="a0f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，我选择不再次获取数据(这次使用摄氏温度)，而是编写了一个简单的函数，将已经存储在redux存储中的数据转换为摄氏温度(默认情况下，它是以华氏温度获取的，您可以在前面看到)。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="e2cb" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated"><strong class="ak">TL；博士</strong></h1><p id="630b" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">这里是<a class="ae nf" href="https://github.com/jwkuchta/lu-code-challenge-weather-app" rel="noopener ugc nofollow" target="_blank"> GitHub回购</a>。下面是部署在<a class="ae nf" href="https://obsolete-winter.surge.sh/" rel="noopener ugc nofollow" target="_blank"> Surge </a>上的直播app。</p><p id="2d93" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您有任何问题或意见，请随时联系我们。</p><p id="9e4e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我喜欢学习和帮助他人学习。</p></div></div>    
</body>
</html>