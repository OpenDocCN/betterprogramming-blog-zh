<html>
<head>
<title>Use Android Build Variants To Manage Server Environments</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Android构建变体来管理服务器环境</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/use-android-build-variants-to-manage-server-environments-146125ae31d2?source=collection_archive---------6-----------------------#2021-02-05">https://betterprogramming.pub/use-android-build-variants-to-manage-server-environments-146125ae31d2?source=collection_archive---------6-----------------------#2021-02-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1beb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">同时构建、运行和部署多个应用</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a0a1b0ad4806d33eb293a9557e9f4a9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jKdtSSX3N9Ki2N4l"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://unsplash.com/@hackcapital?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">黑客资本</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="81c9" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">从文章中摘录</h1><p id="cd1d" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">到本文结束时，您将学会如何使用构建变体来管理您的服务器的开发、试运行和生产环境。使用这种方法，您不再需要在生成apk之前更新任何东西。</p><p id="a20b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">注:</strong>这是一个实验性的方法；如果你有任何改进的建议或者发现了错误，请在评论中告诉我。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="d5de" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">介绍</h1><p id="9e95" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">默认情况下，Android使用两种构建类型:调试和发布。当你通过Android studio运行一个应用程序时，它会安装调试APK，当构建签名APK时，你可以看到两种构建类型。</p><p id="c0b6" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果您已经实现了任何产品风格，您将会看到每种风格的这两种变体。构建类型不同于产品风格。产品风格是应用程序变体的顶级分布，构建类型是每个风格的内部变体。</p><p id="5f63" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">展示产品风格和构建变体的一个常见用例是免费和付费版本。这里免费和付费是产品风格，而发布和调试是构建变体。最后，您将得到四个构建变体，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/70a59ef6ea13b31c390e354b78295440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*c0mCRq2MKR0A2xgh.png"/></div></div></figure><p id="31e7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">产品风格是Android <a class="ae ky" href="https://gradle.org/" rel="noopener ugc nofollow" target="_blank"> Gradle </a>系统中的一个强大功能，允许你用相同的代码库创建不同的应用程序变体。它提供了灵活性，可以在主模块上维护所有变体中所需的任何内容，并为每种风格创建一个单独的模块来实现独立的代码。要了解更多信息，请阅读以下文章:</p><div class="na nb gp gr nc nd"><a href="https://sgkantamani.medium.com/android-product-flavors-eb526e35f9f1" rel="noopener follow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd iu gy z fp ni fr fs nj fu fw is bi translated">Android产品口味</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">这里是你需要知道的关于产品口味和解决方案的实时问题的一切</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">sgkantamani.medium.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr ks nd"/></div></div></a></div><p id="9f86" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">不要混淆产品风格和构建变体；产品风格是应用程序变体的顶级分布，构建类型是每个风格的内部变体。</p><p id="e248" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在您已经知道了产品风格和构建变体之间的区别，是时候使用构建变体来管理服务器环境了。通常，开发过程包含三个环境:开发、试运行和生产。</p><p id="1ff4" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">开发:</strong>通常，开发人员在这个环境中构建和测试新的实现。</p><p id="d48c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">试运行:</strong>一旦开发人员完成了实现和测试，他们将转移到试运行阶段，在那里进行主要测试和最终批准以转移生产。</p><p id="f6c7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">生产:</strong>如果应用程序获得批准，它将进入生产服务器，最终用户可以在那里使用它。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="d504" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">具有构建变体的服务器环境</h1><p id="5fc8" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">现在我们知道了什么是构建变体和不同的服务器环境，是时候利用构建变体来生成不同的服务器环境构建了。</p><p id="e91b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">通常，开发人员为每个变体维护三组不同的细节。在任何给定时间，只有一组是活动的；我们必须根据生成的构建类型手动更新它。这是我多年来一直遵循的过程，但我不认为这是最好的方法，因为它涉及到每一代构建的手工工作。它有自动化的范围。</p><p id="54af" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我自动化这个过程的想法是维护三个不同的构建变体，为每个服务器环境服务。我们需要在<code class="fe ns nt nu nv b">android</code>标签中声明构建变量<code class="fe ns nt nu nv b">buildTypes</code>。这导致了五种构建变体:<code class="fe ns nt nu nv b">release</code>、<code class="fe ns nt nu nv b"> debug</code>、<code class="fe ns nt nu nv b">prod</code>、<code class="fe ns nt nu nv b">stg</code>和<code class="fe ns nt nu nv b">dev</code>。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="ce63" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">服务器环境的关键变化之一是基本URLs我们可以使用<code class="fe ns nt nu nv b">buildConfigField</code>特性在每个变体中声明适当的基本URL。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="3f94" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们基本上所做的是，我们已经移除了在生成构建类型时需要做的所有手工工作，并在每个构建类型中使用<code class="fe ns nt nu nv b">buildConfigField</code>来自动化它们。我们只需要选择所需的构建类型；链接到该构建类型的所有服务器配置都会自动捆绑到生成的APK中。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="f231" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">实时梯度提示</h1><h2 id="59c7" class="ny lh it bd li nz oa dn lm ob oc dp lq mh od oe ls ml of og lu mp oh oi lw oj bi translated">使用initWith</h2><p id="0b22" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">通常，当你创建一个新的风格时，你要么申请调试，要么启用<a class="ae ky" href="https://www.guardsquare.com/en/products/proguard" rel="noopener ugc nofollow" target="_blank">progguard</a>规则。默认情况下，调试版本处于调试模式，而发布版本启用了ProGuard。因此，当您创建一个新的变体时，我们可以使用<code class="fe ns nt nu nv b">initWith</code>从每个变体中继承适当的属性。</p><p id="6007" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">例如，假设在上面的例子中，我们已经为<code class="fe ns nt nu nv b">prod</code>和<code class="fe ns nt nu nv b">stg</code>变量应用了ProGuard规则，并手动调试了<code class="fe ns nt nu nv b">dev</code>变量。我们可以通过<code class="fe ns nt nu nv b">initWith</code>重用发布和调试模式中的规则来增强代码，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="143f" class="ny lh it bd li nz oa dn lm ob oc dp lq mh od oe ls ml of og lu mp oh oi lw oj bi translated">不同的工作流程采用不同的方法</h2><p id="9e4b" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">并非所有工作流都有三个环境；可能会有更多的阶段，比如测试环境。我们可以根据需要用尽可能多的<code class="fe ns nt nu nv b">buildConfigFields</code>创建尽可能多的构建变体。</p><p id="57ee" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们可以为每个变体添加不同的主机名、不同的脸书、Twitter和其他API键，以及不同的Firebase JSON配置文件。这使得跟踪不同级别的指标变得更加容易。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="fa84" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">目前就这些。希望你学到了有用的东西，感谢阅读。</p></div></div>    
</body>
</html>