<html>
<head>
<title>Convert Web Pages Into PDFs With Puppeteer and Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Puppeteer和Node.js将网页转换成pdf</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/convert-web-pages-into-pdfs-with-puppeteer-and-node-js-8e72fb3d0bd2?source=collection_archive---------4-----------------------#2020-12-28">https://betterprogramming.pub/convert-web-pages-into-pdfs-with-puppeteer-and-node-js-8e72fb3d0bd2?source=collection_archive---------4-----------------------#2020-12-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c478" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Node、Puppeteer和Chromium从任何网页生成PDF文档</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5976e9c11d8187a888cec42dcfb0175b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RK6rGfDoWXfJnFGXXpv49Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="08dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为web开发人员，您可能希望生成网页的PDF文件以与客户共享，在演示文稿中使用它，或者将其作为新功能添加到您的web应用程序中。不管你的理由是什么，<a class="ae lu" href="https://developers.google.com/web/tools/puppeteer" rel="noopener ugc nofollow" target="_blank">木偶师</a>——谷歌的无头浏览器和浏览器节点API让你的任务变得非常简单。</p><p id="0b9a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本教程中，我们将看到如何使用Puppeteer和Node.js将网页转换为PDF。让我们从快速介绍什么是Puppeteer开始这项工作。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2f2f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是木偶戏，为什么它很棒？</h1><p id="ca14" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">用<a class="ae lu" href="https://github.com/puppeteer/puppeteer" rel="noopener ugc nofollow" target="_blank">谷歌自己的话说</a>:</p><blockquote class="mz"><p id="83d5" class="na nb it bd nc nd ne nf ng nh ni lt dk translated">“Puppeteer是一个节点库，它提供了一个高级API来控制无头Chrome或DevTools协议上的Chrome。”</p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1efa" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是无头浏览器？</h1><p id="5a29" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">如果你不熟悉术语<em class="nj">无头浏览器</em>，它只是一个没有GUI的浏览器。从这个意义上来说，无头浏览器只是另一个理解如何呈现HTML网页和处理JavaScript的浏览器。由于缺少GUI，与无头浏览器的交互通过命令行进行。</p><p id="1905" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">即使Puppeteer主要是一个无头浏览器，您也可以将其配置为使用非无头Chrome或Chrome。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bf10" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">你能用木偶师做什么？</h1><p id="b5b1" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">Puppeteer强大的浏览器功能使其成为web应用测试和web抓取的完美候选。</p><p id="f082" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">举几个例子，Puppeteer为web开发人员提供了完美的功能:</p><ul class=""><li id="8269" class="nk nl it la b lb lc le lf lh nm ll nn lp no lt np nq nr ns bi translated">生成pdf和网页截图。</li><li id="b943" class="nk nl it la b lb nt le nu lh nv ll nw lp nx lt np nq nr ns bi translated">自动化表单提交。</li><li id="8b76" class="nk nl it la b lb nt le nu lh nv ll nw lp nx lt np nq nr ns bi translated">抓取网页。</li><li id="27b6" class="nk nl it la b lb nt le nu lh nv ll nw lp nx lt np nq nr ns bi translated">执行自动化UI测试，同时保持测试环境最新。</li><li id="66b1" class="nk nl it la b lb nt le nu lh nv ll nw lp nx lt np nq nr ns bi translated">为单页应用程序(spa)生成预呈现内容。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="80bc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置项目环境</h1><p id="fa51" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">你可以在后端和前端使用木偶师来生成pdf。在本教程中，我们将使用节点后端来完成任务。</p><p id="7f50" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">初始化NPM并设置常用的Express服务器，开始学习本教程:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="c01d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在开始之前，请确保使用以下命令安装木偶师NPM软件包:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="19df" class="of md it ob b gy og oh l oi oj">npm install puppeteer</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0709" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将网页转换为PDF</h1><p id="6549" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">现在我们进入教程中激动人心的部分。使用Puppeteer，我们只需要几行代码就可以将网页转换成PDF。</p><p id="5a04" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，使用Puppeteer的<code class="fe ok ol om ob b">launch</code>函数创建一个浏览器实例:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="b23c" class="of md it ob b gy og oh l oi oj">const browser = await puppeteer.launch();</span></pre><p id="a2f8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们创建一个新的页面实例，并使用Puppeteer访问给定的页面URL:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="698e" class="of md it ob b gy og oh l oi oj">const webPage = await browser.newPage();</span><span id="32aa" class="of md it ob b gy on oh l oi oj">const url = "https://livecodestream.dev/post";</span><span id="1b9e" class="of md it ob b gy on oh l oi oj">await webPage.goto(url, {<br/>    waitUntil: "networkidle0"<br/>});</span></pre><p id="d3c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们已经将<code class="fe ok ol om ob b">waitUntil</code>选项设置为<code class="fe ok ol om ob b">networkidle0</code>。当我们使用<code class="fe ok ol om ob b">networkidle0</code>选项时，木偶师会一直等到最后500毫秒内没有新的网络连接。这是一种确定站点是否已经完成加载的方法。这并不准确，木偶师还提供了其他选择，但在大多数情况下是可靠的。</p><p id="59a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们从抓取的页面内容创建PDF，并将其保存到我们的设备:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="8904" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">打印到<a class="ae lu" href="https://github.com/puppeteer/puppeteer/blob/v5.5.0/docs/api.md#pagepdfoptions" rel="noopener ugc nofollow" target="_blank"> PDF功能</a>相当复杂，允许大量定制，这太棒了。以下是我们使用的一些选项:</p><ul class=""><li id="9fcf" class="nk nl it la b lb lc le lf lh nm ll nn lp no lt np nq nr ns bi translated"><code class="fe ok ol om ob b">printBackground</code>:当此选项设置为<code class="fe ok ol om ob b">true</code>时，木偶师会将您在网页上使用的任何背景色或图像打印到PDF中。</li><li id="506c" class="nk nl it la b lb nt le nu lh nv ll nw lp nx lt np nq nr ns bi translated"><code class="fe ok ol om ob b">path</code>:指定保存生成的PDF文件的位置。您还可以将它存储到内存流中，以避免写入磁盘。</li><li id="7fd9" class="nk nl it la b lb nt le nu lh nv ll nw lp nx lt np nq nr ns bi translated"><code class="fe ok ol om ob b">format</code>:您可以将PDF格式设置为给定的选项之一:<code class="fe ok ol om ob b">Letter</code>、<code class="fe ok ol om ob b">A4</code>、<code class="fe ok ol om ob b">A3</code>、<code class="fe ok ol om ob b">A2</code>等。</li><li id="2643" class="nk nl it la b lb nt le nu lh nv ll nw lp nx lt np nq nr ns bi translated"><code class="fe ok ol om ob b">margin</code>:您可以使用此选项为生成的PDF指定边距。</li></ul><p id="3e7d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">PDF创建完成后，用<code class="fe ok ol om ob b">browser.close()</code>关闭浏览器连接。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c706" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">构建一个API来从URL生成并响应pdf</h1><p id="8df0" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">根据我们目前收集的知识，我们现在可以创建一个新的端点，它将接收一个URL作为查询字符串，然后将生成的PDF流回客户端。</p><p id="b982" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="244e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您启动服务器并使用包含我们想要转换的URL的<code class="fe ok ol om ob b">target</code>查询参数访问<code class="fe ok ol om ob b">/pdf</code>路径，服务器将直接提供生成的PDF，而不会将其存储在磁盘上。</p><p id="5092" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是一个URL的例子:<code class="fe ok ol om ob b"><a class="ae lu" href="http://localhost:3000/pdf?target=https://google.com" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/pdf?target=https://google.com</a></code>。</p><p id="0e11" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它将在图像上生成以下PDF:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/25196bb7c7830cb84ee01522eac6488b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qkph3Xf3CiwjkUr1ZQ5sZw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例PDF捕获</p></figure><p id="2f72" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！您已经完成了网页到PDF的转换。那不是很容易吗？</p><p id="930b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如前所述，木偶师提供了许多定制选项，所以请确保您有机会获得不同的结果。</p><p id="da00" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们可以改变视窗大小，以捕捉不同分辨率下的网站。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1320" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用不同的视口捕捉网站</h1><p id="f3cc" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在之前创建的PDF中，我们没有为木偶师访问的网页指定视窗大小。相反，我们使用默认的视窗尺寸:800×600像素。</p><p id="6e81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，我们可以在抓取页面之前精确设置页面的视窗大小:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="dec1" class="of md it ob b gy og oh l oi oj">await webPage.setViewport({ width: 1200, height: 800 });<br/></span><span id="3ba9" class="of md it ob b gy on oh l oi oj">await webPage.goto(url, {<br/>    waitUntil: "networkidle0"<br/>});</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c06a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="8cd3" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在今天的教程中，我们使用了puppet eer——一个用于headless Chrome的节点API来生成给定网页的PDF。既然您现在已经熟悉了Puppeteer的基础知识，您可以在将来使用这些知识来创建pdf，甚至用于其他目的，如web抓取和UI测试。</p><p id="ca68" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读！</p></div></div>    
</body>
</html>