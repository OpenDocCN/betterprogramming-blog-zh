<html>
<head>
<title>Deciding Where to Store Data on iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">决定在iOS上存储数据的位置</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deciding-where-to-store-data-on-ios-3f71e5d850c8?source=collection_archive---------4-----------------------#2019-11-29">https://betterprogramming.pub/deciding-where-to-store-data-on-ios-3f71e5d850c8?source=collection_archive---------4-----------------------#2019-11-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="aa46" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从UserDefaults到CoreData，不同存储选项的全面概述</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/637389afcc418b0ecb75e6a4bd7e93da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8iX2gOs4x494fp6N4n5tTQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@leecampbell" rel="noopener ugc nofollow" target="_blank">李·坎贝尔</a>在<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="b18b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开发人员通常需要代表他们的用户存储数据。有时，它是少量的简单数据，但其他时候，它是大量的复杂数据。可能是高度敏感的数据，也可能是不太敏感甚至公开的数据。选择存储这些数据的位置通常并不简单，尤其是当您可能不知道可用的选项或需要记住的安全注意事项时。</p><p id="1b1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将向您展示几个可供iOS开发者使用的存储选项。我还将解释每种存储方法的优缺点。</p><p id="c021" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇博文中，您将了解以下存储机制:</p><ul class=""><li id="f973" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe me mf mg mh b">UserDefaults</code></li><li id="91ef" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated">磁盘上的文件</li><li id="5292" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated">钥匙链</li><li id="de05" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated">数据库(如CoreData和SQLite)</li></ul><blockquote class="mn mo mp"><p id="5f29" class="kz la mq lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">免责声明:</em> </strong> <em class="it">请注意，我不是安全或加密专家。出于这个原因，我将只讨论每种存储机制的“正常”基本用法。我不会讨论如何最好地加密数据，以提高任何列出的存储机制的安全性。一般来说，您应该</em>至少<em class="it">考虑到您存储在设备上的任何数据都可能被能够访问物理设备的攻击者访问到。</em></p></blockquote><p id="cf5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">排除了免责声明，让我们开始探索iOS上的存储选项，好吗？</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="5b22" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">利用用户默认存储</h1><p id="ce63" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">iOS上最著名、最容易使用的存储可能是用户默认存储。您通常将此存储用于简单的用户首选项或存储有助于改善用户体验的简单值。在我关于<a class="ae ky" href="https://www.donnywals.com/optimizing-your-applications-reviews/" rel="noopener ugc nofollow" target="_blank">优化你的应用商店评论</a>的博客文章中，我讨论了如何使用用户默认值来跟踪几个指标，比如用户第一次启动应用时的启动次数，以及如何找出向用户显示评论提示的最佳时机。</p><h2 id="473d" class="ny nc it bd nd nz oa dn nh ob oc dp nl li od oe nn lm of og np lq oh oi nr oj bi translated">用户默认值中应该存储什么</h2><p id="9f9a" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">您可以在用户默认值中存储大量数据，但是不鼓励存储大量数据、图像和其他大型数据结构。出现这种情况的主要原因是，你被限制在最大1MB的数据，而苹果公司建议不要超过512KB。如果只存储简单的数据，比如布尔值、数字或字符串，那么这个存储量是很大的。这些类型的数据很小，非常适合键值存储。更大的东西会很快填满你的商店。</p><h2 id="0308" class="ny nc it bd nd nz oa dn nh ob oc dp nl li od oe nn lm of og np lq oh oi nr oj bi translated">用户默认值和安全性</h2><p id="9ced" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">您不应该在用户默认值中存储任何敏感数据。这种存储根本没有加密，因此如果您自己的应用程序之外的应用程序获得了对您的用户默认存储的访问权限，您的用户数据就会受到威胁。</p><p id="dda9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，不能用来识别用户的简单首选项可以存储在用户默认设置中。但是，用户的电子邮件地址、密码和其他类似数据应该存储在更安全的地方。</p><h2 id="2689" class="ny nc it bd nd nz oa dn nh ob oc dp nl li od oe nn lm of og np lq oh oi nr oj bi translated">使用用户默认值存储</h2><p id="0dea" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">如果您希望使用用户默认存储，您可以通过<code class="fe me mf mg mh b">UserDefaults</code>类来实现。您可以使用对您的应用程序始终可用的<code class="fe me mf mg mh b">default</code>用户商店，或者您可以使用自己的唯一标识符创建自己的用户默认商店。我总是推荐后者，因为它可以更容易地将你的用户默认存储换成另一个。它还允许您将您自己的用户默认设置与您可能包含在应用程序中的外部依赖项可以访问的用户默认设置分开。</p><p id="8e60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从用户默认值中读取真的很快，因为当你的应用启动时，你的应用的偏好被加载到内存中。这意味着您根本不需要访问底层磁盘存储来使用<code class="fe me mf mg mh b">UserDefaults</code>类检索值。</p><p id="d005" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以创建和使用自己的用户默认值存储，如下所示:</p><pre class="kj kk kl km gt ok mh ol om aw on bi"><span id="2a56" class="ny nc it mh b gy oo op l oq or">let myDefaults = UserDefaults(suiteName: “com.donnywals.myapp”)</span><span id="1b52" class="ny nc it mh b gy os op l oq or">myDefaults?.set(true, forKey: “com.donnywals.myapp.user-is-awesome”)</span><span id="4ed5" class="ny nc it mh b gy os op l oq or">let isUserAwesome = myDefaults?.bool(forKey: “com.donnywals.myapp.user-is-awesome”)</span></pre><p id="03ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，您可能希望使用Swift 5强大的属性包装器或围绕<code class="fe me mf mg mh b">UserDefaults</code>的包装器来使访问您的用户默认设置更加简洁，因为在键入您的用户默认设置键时很容易出错。尤其是当它们很长或者很复杂的时候，就像你刚刚读到的例子一样。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="c67d" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">在磁盘上存储文件</h1><p id="dee3" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">有时，您需要比用户默认提供的有限存储更多的存储。如果是这种情况，您可能需要考虑在用户的文件系统上存储文件。文件系统通常有大量的可用存储，但是从其中读取大量数据可能会相对较慢。和所有事情一样，这是一种权衡。只有通过测量和测试，您才能知道是否需要比磁盘访问更快的东西，比如SQLite存储或内存存储。</p><h2 id="ef9a" class="ny nc it bd nd nz oa dn nh ob oc dp nl li od oe nn lm of og np lq oh oi nr oj bi translated">应该在磁盘上存储什么</h2><p id="0a28" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">通常，您将使用磁盘存储来存储大量数据。例如，图像、视频或大型JSON文件适合存储在磁盘上。这些类型的文件被称为二进制数据，例如，它们没有您可能想要在数据库中查询的属性。</p><p id="c73f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果可能的话，用户创建的文档，如文本文件或pdf，通常也存储在磁盘上。对于开发人员来说，让他们希望存储在磁盘上的数据结构符合<code class="fe me mf mg mh b">Codable</code>并不罕见，这样他们就可以轻松地将他们的对象转换为<code class="fe me mf mg mh b">Data</code>，然后可以将其写入文件系统上的文件。如果你想创建一个从网络上收到的响应的缓存，或者如果你只是想确保某些对象在应用程序启动时保持不变，那么使用磁盘存储来存储你的<code class="fe me mf mg mh b">Codable</code>对象是非常好的。</p><h2 id="bebd" class="ny nc it bd nd nz oa dn nh ob oc dp nl li od oe nn lm of og np lq oh oi nr oj bi translated">磁盘存储和安全性</h2><p id="4054" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">没有任何自定义加密，磁盘存储是非常不安全的。苹果会在设备锁定时对其进行加密，但一旦设备解锁且你的应用程序处于活动状态，一切就都完了。您应该不惜一切代价避免将用户名、密码等敏感数据存储在写入磁盘的文件中。</p><h2 id="7b79" class="ny nc it bd nd nz oa dn nh ob oc dp nl li od oe nn lm of og np lq oh oi nr oj bi translated">将文件写入磁盘</h2><p id="0d81" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">最常见的情况是，将文件写入documents目录，或者如果数据被用作缓存并且可以很容易地重新创建，则写入caches目录。以下示例显示了如何将数据写入documents目录:</p><pre class="kj kk kl km gt ok mh ol om aw on bi"><span id="d851" class="ny nc it mh b gy oo op l oq or">do {<br/>  let fileManager = FileManager.default<br/>  let docs = try fileManager.url(for: .documentDirectory,<br/>                                 in: .userDomainMask,<br/>                                appropriateFor: nil, create: false)</span><span id="4e3b" class="ny nc it mh b gy os op l oq or">  let path = docs.appendingPathComponent(“myFile.txt”)<br/>  let data = “Hello, world!”.data(using: .utf8)!<br/>  <br/>  fileManager.createFile(atPath: path.absoluteString, <br/>                         contents: data, attributes: nil)<br/>} catch {<br/>  // handle error<br/>}</span></pre><p id="f5b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前面的代码片段在documents目录下创建了一个名为<code class="fe me mf mg mh b">myFile.txt</code>的文件，其内容为<code class="fe me mf mg mh b">Hello, world!</code>。可以使用任何一种<code class="fe me mf mg mh b">Data</code>作为<code class="fe me mf mg mh b">contents</code>的值。例如，您可能希望使用<code class="fe me mf mg mh b">JSONEncoder</code>将一个结构编码到JSON中，或者获取一些图像数据。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="681c" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">使用钥匙串来储存数据</h1><p id="cc64" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">第三个要考虑的存储机制是钥匙串。这是iOS存储各种敏感用户数据的地方，比如用户名、密码、证书等等。如果你有安全的数据需要储存在某个地方，钥匙链应该是你的去处。</p><h2 id="7988" class="ny nc it bd nd nz oa dn nh ob oc dp nl li od oe nn lm of og np lq oh oi nr oj bi translated">钥匙串中应该储存什么</h2><p id="7f7b" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">钥匙串旨在储存用户的敏感机密数据。我个人使用Keychain来存储OAuth令牌之类的东西，这些令牌针对web服务对用户进行身份验证。苹果自己使用钥匙串不仅仅是为了令牌——他们甚至将整个安全证书存储在钥匙串中。</p><h2 id="bc0f" class="ny nc it bd nd nz oa dn nh ob oc dp nl li od oe nn lm of og np lq oh oi nr oj bi translated">钥匙串和安全性</h2><p id="a3ae" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">在iOS上，钥匙串可能是储存数据的最安全的地方。然而，像设备上的所有东西一样，钥匙链可能会被破解，你应该记住这一点。尽管苹果对钥匙链非常有信心，以至于他们用它来存储用户名和密码组合，但我对此有点过于偏执。如果我能避免存储密码，我会的。我宁愿存储一个对用户没有特殊意义的令牌，也不愿存储(并可能丢失)像用户名和密码这样敏感的东西。</p><h2 id="f899" class="ny nc it bd nd nz oa dn nh ob oc dp nl li od oe nn lm of og np lq oh oi nr oj bi translated">读写钥匙串</h2><p id="2579" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">不幸的是，Keychain的API很难导航和使用。好消息是CocoaPods、Carthage和Swift Package Manager上都有包装器，使得使用Keychain更加容易。我个人非常喜欢<a class="ae ky" href="https://github.com/kishikawakatsumi" rel="noopener ugc nofollow" target="_blank">岸川胜美</a>的<a class="ae ky" href="https://github.com/kishikawakatsumi/KeychainAccess" rel="noopener ugc nofollow" target="_blank"> KeychainAccess </a>。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="9def" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">数据库ˌ资料库</h1><p id="a3ce" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">在这个比较中，我将介绍的最后一个存储选项是使用数据库。数据库非常擅长高效地存储大量结构化数据。它们不仅擅长存储数据，还非常擅长检索和过滤数据。因此，每当您有一组较大的数据需要过滤、存储或扩展时，使用普通SQLite或Realm或CoreData等数据库包装器/管理器访问的数据库可能是您的理想选择。我不打算比较每个选项的性能和使用情况，因为归根结底，它们都擅长于所有数据库都擅长的事情。</p><h2 id="b966" class="ny nc it bd nd nz oa dn nh ob oc dp nl li od oe nn lm of og np lq oh oi nr oj bi translated">数据库中应该存储什么</h2><p id="0441" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">如果您有大型结构化数据对象，如用户的待办事项列表、用户在您的应用程序中创建的文档的元数据或用户每周跑步锻炼的数据，您可能需要一个数据库。如果这些对象中的任何一个都有大型二进制blob，如图像，您可能需要考虑混合使用磁盘存储和数据库存储，方法是将大型blob数据写入磁盘，并将数据的路径存储在数据库中。</p><h2 id="db02" class="ny nc it bd nd nz oa dn nh ob oc dp nl li od oe nn lm of og np lq oh oi nr oj bi translated">数据库和安全性</h2><p id="7f25" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">iOS上的数据库存储在设备上，通常在文档目录中。这意味着，除非您应用了自己的加密层，否则您应该认为写入数据库的任何数据都受到了威胁。像往常一样，对您存储的内容要非常小心，避免存储任何敏感数据，如用户名、密码和访问令牌。钥匙串更适合这些类型的数据。</p><h2 id="f4b3" class="ny nc it bd nd nz oa dn nh ob oc dp nl li od oe nn lm of og np lq oh oi nr oj bi translated">读取和写入数据库</h2><p id="952c" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">根据您选择的数据库，您将使用SQL查询、谓词或其他东西来访问和过滤数据库中的数据。请记住，数据库通常不是线程安全的，因此在从不同的线程读取和写入数据时，您需要小心。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="9b8d" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">概括起来</h1><p id="d629" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">在这篇博文中，你已经了解了很多关于iOS上不同存储选项的知识。您了解到钥匙串是储存用户机密的最安全的地方。用户默认值非常适合代表用户偏好的简单键值对。文件存储非常适合存储大型数据块，最后，数据库应该用于存储结构化数据。</p><p id="419f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于安全考虑，最好重申一下，存储在设备上的任何数据都应被视为受到了威胁。这实际上只是提取和解密数据有多复杂的问题。总是问自己是否真的需要存储用户敏感的东西。</p><p id="2438" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇博文能帮助你在数据存储方面做出明智的决定。</p></div></div>    
</body>
</html>