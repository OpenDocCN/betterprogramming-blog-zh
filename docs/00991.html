<html>
<head>
<title>Swift Optionals: Beyond Basics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift选项:超越基础</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swift-optionals-beyond-basics-6f55e8d19619?source=collection_archive---------6-----------------------#2019-08-04">https://betterprogramming.pub/swift-optionals-beyond-basics-6f55e8d19619?source=collection_archive---------6-----------------------#2019-08-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="24ae" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更清晰代码的映射和平面映射选项</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/63bc162f8396bd8589c33a84dec14aac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pQsEqRx5QHTONZ9UZ0YYTA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马克斯·尼尔森在<a class="ae ky" href="https://unsplash.com/search/photos/swift?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="49f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个阶段，你可能知道斯威夫特(Swift)<code class="fe lv lw lx ly b">Optional</code>只是服用了类固醇的<code class="fe lv lw lx ly b">enum</code>:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="36fd" class="md me it ly b gy mf mg l mh mi">enum Optional&lt;Wrapped&gt; {<br/>  case none<br/>  case some(Wrapped)<br/>}</span></pre><p id="fd98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，您可以使用<em class="mj">长格式</em>来使用它们:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="3ff3" class="md me it ly b gy mf mg l mh mi">let longFormSomeOptional = Optional&lt;Int&gt;.some(1)<br/>let longFormNoneOptional = Optional&lt;Int&gt;.none</span></pre><p id="fa71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能还知道如何使用<code class="fe lv lw lx ly b">Optional</code>绑定(<code class="fe lv lw lx ly b">if let</code>、<code class="fe lv lw lx ly b">guard let</code>和<code class="fe lv lw lx ly b">switch</code>)、<code class="fe lv lw lx ly b">Optional</code>链接、零合并操作符以及强制展开。</p><p id="e87f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，你可能不知道下面解释的其他一些可以让你的生活更轻松的操作。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="46cf" class="mr me it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">映射可选的</h1><p id="9756" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated"><code class="fe lv lw lx ly b">Optional</code> <code class="fe lv lw lx ly b">enum</code>中有一个映射操作，允许我们映射它的展开值:</p><p id="258e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">func map&lt;U&gt;(_ transform: (Wrapped) throws -&gt; U) rethrows -&gt; U?</code></p><p id="5d02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当<code class="fe lv lw lx ly b">Optional</code>不是<code class="fe lv lw lx ly b">nil</code>时，该函数计算闭包，将展开的值作为参数传递。它返回闭包的结果，或者当<code class="fe lv lw lx ly b">Optional</code>为<code class="fe lv lw lx ly b">nil</code>时只返回<code class="fe lv lw lx ly b">nil</code>。</p><p id="d6e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一个例子:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="48f1" class="md me it ly b gy mf mg l mh mi">let someNumber: Int? = 2<br/>let noneNumber: Int? = nil</span><span id="8e9a" class="md me it ly b gy nn mg l mh mi">// closure will be evaluated and result1 is Optional(4)<br/>let result1 = someNumber.map { $0 * $0 }</span><span id="5de0" class="md me it ly b gy nn mg l mh mi">// closure won't be evaluated and result2 is Optional(nil)<br/>let result2 = noneNumber.map { $0 * $0 }</span></pre><p id="0900" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们将<code class="fe lv lw lx ly b">map</code>与nil-coalescing操作符一起使用，我们有一个很好的替代丑陋的<code class="fe lv lw lx ly b">var-if-let-else</code>:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="c61d" class="md me it ly b gy mf mg l mh mi">let someNumber: Int? = 2<br/>let noneNumber: Int? = nil</span><span id="ba21" class="md me it ly b gy nn mg l mh mi">// closure will be evaluated and result1 is 4<br/>let result1 = someNumber.map { $0 * $0 } ?? 0</span><span id="6f7f" class="md me it ly b gy nn mg l mh mi">// closure won't be evaluated and result2 is 0<br/>let result2 = noneNumber.map { $0 * $0 } ?? 0</span></pre></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="0f55" class="mr me it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">与地图的可选绑定</h1><p id="b95e" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated"><code class="fe lv lw lx ly b">map</code>函数对于<code class="fe lv lw lx ly b">Optional</code> s有一个特殊的用法，我认为知道这个很好。</p><p id="f87e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们再次检查<code class="fe lv lw lx ly b">map</code>签名:</p><p id="f0ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">func map&lt;U&gt;(_ transform: (Wrapped) throws -&gt; U) rethrows -&gt; U?</code></p><p id="0a39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，当<code class="fe lv lw lx ly b">U</code>为<code class="fe lv lw lx ly b">Void</code>时，地图将返回nothing(形式上为<code class="fe lv lw lx ly b">Void?</code> <em class="mj"> </em>或<em class="mj"> </em> <code class="fe lv lw lx ly b">()?</code>)。因此，我们可以使用这里的<code class="fe lv lw lx ly b">map</code>作为<code class="fe lv lw lx ly b">Optional</code>绑定。</p><p id="df57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一个例子:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="297a" class="md me it ly b gy mf mg l mh mi">func log(_ message: String) {<br/>  print(message)<br/>}</span><span id="0883" class="md me it ly b gy nn mg l mh mi">let someMessage: String? = "Hello World"<br/>let noneMessage: String? = nil</span><span id="aaa7" class="md me it ly b gy nn mg l mh mi">// closure will be evaluated<br/>someMessage.map { log($0) }</span><span id="6d06" class="md me it ly b gy nn mg l mh mi">// closure won't be evaluated<br/>noneMessage.map { log($0) }</span></pre><p id="fd29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们没有正式地<em class="mj">映射</em>上面的选项，而是使用它作为<code class="fe lv lw lx ly b">if-let</code>的替代，以防它更适合您的代码。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="99b9" class="mr me it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">平面映射可选</h1><p id="284a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">假设前面的<em class="mj">转换</em>闭包返回一个可选的。然后，<code class="fe lv lw lx ly b">map</code>将返回一个double可选值。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="e919" class="md me it ly b gy mf mg l mh mi">let someString: String? = "2"<br/>let result1 = someString.map { Int($0) } // result1 is Int??</span></pre><p id="d655" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，你可能想用<code class="fe lv lw lx ly b">flatMap</code>这个可选的来代替，这样闭包的结果就变平了。</p><p id="30c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">func flatMap&lt;U&gt;(_ transform: (Wrapped) throws -&gt; U?) rethrows -&gt; U?</code></p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="3fe3" class="md me it ly b gy mf mg l mh mi">let someString: String? = "2"<br/>let result1 = someString.flatMap { Int($0) } // result1 is Int?</span></pre><p id="007b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与我提到的<code class="fe lv lw lx ly b">map</code>操作一样，我们可以使用带有零合并操作符的<code class="fe lv lw lx ly b">flatMap</code>作为丑陋的<code class="fe lv lw lx ly b">var-if-let-else</code>的替代。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="118e" class="md me it ly b gy mf mg l mh mi">let someString: String? = "2"<br/>let noneString: String? = nil</span><span id="a4f6" class="md me it ly b gy nn mg l mh mi">// closure will be evaluated and result1 is 2<br/>let result1 = someString.flatMap { Int($0) } ?? 0</span><span id="436c" class="md me it ly b gy nn mg l mh mi">// closure won't be evaluated and result2 is 0<br/>let result2 = noneString.flatMap { Int($0) } ?? 0</span></pre><p id="01dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>