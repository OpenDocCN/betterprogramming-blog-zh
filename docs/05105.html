<html>
<head>
<title>The ‘SameSite’ Issue With Rails 4.2.0 in Chrome</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Chrome中Rails 4.2.0的“相同站点”问题</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-samesite-issue-with-rails-4-2-0-in-chrome-be8deced023e?source=collection_archive---------6-----------------------#2020-06-09">https://betterprogramming.pub/the-samesite-issue-with-rails-4-2-0-in-chrome-be8deced023e?source=collection_archive---------6-----------------------#2020-06-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1164" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">带有“SameSite=None”的跨站点请求</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c54a18289619661f61495f9ec130d682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_BFLYUasYrFtybhFIow87w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@sickhews?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">韦斯·希克斯</a>在<a class="ae ky" href="https://unsplash.com/collections/9969679/technology?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="d0c0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么是‘T0’？</h1><p id="0a92" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated"><code class="fe lr ls lt lu b"><a class="ae ky" href="https://web.dev/samesite-cookies-explained/" rel="noopener ugc nofollow" target="_blank">SameSite</a></code>是新推荐的保护网站安全的方法。这会让<code class="fe lr ls lt lu b">CSRF</code>更加安全。<code class="fe lr ls lt lu b">SameSite</code>属性允许服务器断言cookie不应该与跨站点请求一起发送。这种变化提供了一些针对跨站点请求伪造攻击的保护。</p><p id="2483" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">简单来说，不包含<code class="fe lr ls lt lu b">SameSite=None</code>和<code class="fe lr ls lt lu b">Secure</code>标签的cookies将无法被第三方访问。这种行为改变是谷歌于2020年2月4日<em class="mw">推出的<a class="ae ky" href="https://www.chromestatus.com/feature/5088147346030592" rel="noopener ugc nofollow" target="_blank">。</a></em></p><p id="cb2e" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">让我们来理解Rails应用程序中的场景。如果您的Rails应用程序提供了使用cookie进行身份验证的API，那么cookie的这种新行为将打破这种局面。因为现在<code class="fe lr ls lt lu b">SameSite</code>的默认值是<code class="fe lr ls lt lu b">Lax</code>，它不会将cookies发送回第三方网站。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="9a71" class="kz la it bd lb lc ne le lf lg nf li lj jz ng ka ll kc nh kd ln kf ni kg lp lq bi translated">在Rails 4.2.0中，你如何解决这个问题？</h1><p id="7ef5" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">为了解决Rails中的这个问题，我们需要用<code class="fe lr ls lt lu b">SameSite=None</code>显式地设置cookies。为了设置<code class="fe lr ls lt lu b">SameSite=None</code>，我们需要在Rails应用程序的<code class="fe lr ls lt lu b">config/intializers</code>中创建一个文件<code class="fe lr ls lt lu b">rack.rb</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="dff9" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">如果您想将它附加到应用程序cookie密钥，那么您需要用以下代码更新<code class="fe lr ls lt lu b">rack.rb</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4365" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">您需要用您的应用密钥替换<code class="fe lr ls lt lu b">key name</code>。在哪里可以找到这个应用程序cookie密钥名称？您将从<code class="fe lr ls lt lu b">session_store.rb</code>文件中获得这个cookie密钥名。</p><p id="db9c" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">就是这样！您的应用程序将在Chrome中完美运行。干杯！</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="27a1" class="kz la it bd lb lc ne le lf lg nf li lj jz ng ka ll kc nh kd ln kf ni kg lp lq bi translated"><strong class="ak">参考文献</strong></h1><ul class=""><li id="0895" class="nl nm it lx b ly lz mb mc me nn mi no mm np mq nq nr ns nt bi translated"><a class="ae ky" href="https://digiday.com/media/what-is-chrome-samesite/" rel="noopener ugc nofollow" target="_blank">“WTF是Chrome的SameSite cookie更新？”通过Digiday </a></li><li id="b03b" class="nl nm it lx b ly nu mb nv me nw mi nx mm ny mq nq nr ns nt bi translated"><a class="ae ky" href="https://web.dev/samesite-cookies-explained/" rel="noopener ugc nofollow" target="_blank">“same site cookies解释”通过web.dev </a></li><li id="f464" class="nl nm it lx b ly nu mb nv me nw mi nx mm ny mq nq nr ns nt bi translated"><a class="ae ky" href="https://www.netsparker.com/blog/web-security/same-site-cookie-attribute-prevent-cross-site-request-forgery/" rel="noopener ugc nofollow" target="_blank">“使用同站点Cookie属性防止CSRF攻击”通过Netsparker </a></li></ul></div></div>    
</body>
</html>