<html>
<head>
<title>Run a Scheduled Task Using AWS Fargate With CI/CD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Fargate和CI/CD运行计划任务</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/run-a-scheduled-task-using-aws-fargate-with-ci-cd-fe77f20aeb2b?source=collection_archive---------7-----------------------#2019-11-10">https://betterprogramming.pub/run-a-scheduled-task-using-aws-fargate-with-ci-cd-fe77f20aeb2b?source=collection_archive---------7-----------------------#2019-11-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="786f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你听说过cron jobs，但是让我们来谈谈cron表达式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c2640d66f0635800b4aa151a7b256fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V1yXVoGIqIXEmwlMKZYziw.jpeg"/></div></div></figure><p id="524f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你需要用任何语言运行你自己的脚本，以预定的方式或者用特定的指令重复运行，这是为你准备的。</p><p id="6105" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在许多应用程序中，通常在数据可视化应用程序中，我们需要在固定的时间、日期或间隔运行一些代码。这些代码块可以进行API调用，从数据库中获取数据，进行一些处理，或者做任何你想做的事情。</p><p id="fe50" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这里，您将了解一种根据预定义的时间表运行这样一个脚本的简单方法。</p><p id="3606" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Cron jobs 是一个流行的作业调度器，它提供了一个实用程序，用于在<a class="ae lq" href="https://en.wikipedia.org/wiki/Unix-like" rel="noopener ugc nofollow" target="_blank">类Unix</a>计算机<a class="ae lq" href="https://en.wikipedia.org/wiki/Operating_system" rel="noopener ugc nofollow" target="_blank">操作系统</a>中调度任何类型的任务。当我们使用cron作业时，要记住的一件重要事情是<em class="lr"> cron表达式。</em></p><p id="e30f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">cron表达式通常用于定义任务应该何时运行。系统中使用的cron表达式有不同的变体，如<a class="ae lq" href="https://jenkins.io/" rel="noopener ugc nofollow" target="_blank"> Jenkins </a>、<a class="ae lq" href="https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/" rel="noopener ugc nofollow" target="_blank"> Kubernetes CronJob </a>、<a class="ae lq" href="https://aws.amazon.com/about-aws/whats-new/2018/08/aws-fargate-now-supports-time-and-event-based-task-scheduling/" rel="noopener ugc nofollow" target="_blank"> Fargate调度任务</a>等。使用前一定要检查它的说明。</p><p id="b0c5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们进入主题。</p><p id="f48c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们都希望尽可能简单高效地安排重复性任务。在每个复杂的项目中，更新数据、接收数据或类似的用例都需要这样做。</p><p id="2ea4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有了AWS Fargate，就有可能拥有编排好的集群，您可以在其上运行Docker容器中的任务。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="01a8" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">开始之前，您需要</h1><ul class=""><li id="4fdd" class="mr ms it kw b kx mt la mu ld mv lh mw ll mx lp my mz na nb bi translated">詹金斯的<a class="ae lq" href="https://jenkins.io/download/" rel="noopener ugc nofollow" target="_blank">服务器安装完毕。</a></li><li id="2084" class="mr ms it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">带有GitHub存储库的GitHub帐户。</li><li id="817e" class="mr ms it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">如果您使用的是企业GitHub帐户，首先您需要生成私钥和公钥(<a class="ae lq" href="https://www.ssh.com/ssh/keygen/" rel="noopener ugc nofollow" target="_blank"> <em class="lr"> ssh-keygen </em> </a>)。</li><li id="5947" class="mr ms it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">向Jenkins服务器添加凭据。</li><li id="065e" class="mr ms it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">通过在那里添加您的公钥来配置您的GitHub帐户。</li><li id="e212" class="mr ms it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">在你的电脑上设置Docker。Docker docs 会给你更多这方面的信息。</li><li id="2ca9" class="mr ms it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">AWS帐户。</li><li id="8b5c" class="mr ms it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">要调度的脚本的Dockerfile。</li></ul></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="0ece" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated"><strong class="ak">什么是AWS Fargate？</strong></h1><p id="614b" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">对于不了解AWS Fargate的人，这里有一个介绍。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/4d8087009d711be120edbf7d2db029f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IwlvQ-6SkP0zL98P.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">AWS Fargate服务</p></figure><blockquote class="np nq nr"><p id="67b6" class="ku kv lr kw b kx ky ju kz la lb jx lc ns le lf lg nt li lj lk nu lm ln lo lp im bi translated"><strong class="kw iu"> " </strong> AWS Fargate是亚马逊ECS的一个计算引擎，它允许你运行<a class="ae lq" href="http://aws.amazon.com/what-are-containers" rel="noopener ugc nofollow" target="_blank">容器</a>，而不必管理服务器或集群。</p><p id="6a07" class="ku kv lr kw b kx ky ju kz la lb jx lc ns le lf lg nt li lj lk nu lm ln lo lp im bi translated">有了AWS Fargate，您不再需要供应、配置和扩展虚拟机集群来运行容器。这消除了选择服务器类型、决定何时扩展集群或优化集群打包的需要。</p><p id="0bca" class="ku kv lr kw b kx ky ju kz la lb jx lc ns le lf lg nt li lj lk nu lm ln lo lp im bi translated">AWS Fargate消除了您与服务器或集群交互或考虑它们的需要。Fargate让您专注于设计和构建您的应用程序，而不是管理运行它们的基础设施。<strong class="kw iu">——</strong><a class="ae lq" href="https://aws.amazon.com/fargate/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/fargate/</a></p></blockquote><p id="002f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Fargate发布之前，使用Amazon ECS的唯一方法是提供一个由Amazon管理的EC2实例集群(用于软件、更新和配置)。</p><p id="ca22" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">面临的问题包括集群的成本、任务的扩展以及配置和维护有效的自动扩展系统以避免缺乏足够的容器资源。</p><p id="a5c0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">AWS Fargate允许将所有这些管理开销交给AWS，即通过只为实际执行时间付费来启动基于容器的服务。不需要担心底层集群，因为AWS会处理得很好。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="bf9d" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated"><strong class="ak">什么是亚马逊ECS？</strong></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/7f3777ab241f11dd807020bc53ea8b98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*7sfavSZruS8tdfAD.png"/></div><p class="nl nm gj gh gi nn no bd b be z dk translated">AWS弹性集装箱服务</p></figure><p id="6adb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://aws.amazon.com/ecs/" rel="noopener ugc nofollow" target="_blank">弹性容器服务</a> (ECS)是一个AWS服务，它处理EC2集群中的Docker容器编排。它是Kubernetes、<a class="ae lq" href="https://docs.docker.com/engine/swarm/" rel="noopener ugc nofollow" target="_blank"> Docker Swarm </a>和其他也处理伸缩的编排服务的替代方案。</p><p id="2e66" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其中的一个关键特性是，Amazon ECS允许您在Amazon EC2按需实例、保留实例或spot实例上使用托管或定制调度程序运行批处理工作负载。</p><p id="0a44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，当containers在Amazon<a class="ae lq" href="https://aws.amazon.com/ec2/spot/" rel="noopener ugc nofollow" target="_blank">EC2 spot instances</a>上运行时，与按需价格相比，我们将获得高达90%的折扣。除此之外，你可能有很多理由使用亚马逊ECS。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="cc32" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated"><strong class="ak">什么是AWS ECR？</strong></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/1b6cb26d454d5a460651560fa792859a.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/0*kPDNQRWa8SOVELhv.png"/></div><p class="nl nm gj gh gi nn no bd b be z dk translated"><em class="nx">亚马逊弹性容器注册处(ECR) </em></p></figure><p id="942e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个过程中，我们也将使用AWS Fargate。因为我们在部署脚本时使用Docker，这需要调度，所以这是一种更简单的方法。</p><blockquote class="np nq nr"><p id="90aa" class="ku kv lr kw b kx ky ju kz la lb jx lc ns le lf lg nt li lj lk nu lm ln lo lp im bi translated">“Amazon Elastic Container Registry(ECR)是一个完全托管的<a class="ae lq" href="https://aws.amazon.com/docker/" rel="noopener ugc nofollow" target="_blank"> Docker </a>容器注册表，它使开发人员可以轻松地存储、管理和部署Docker容器映像。”——【https://aws.amazon.com/ecr/ T2】</p></blockquote><p id="bdfd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用ECS时使用ECR的另一个原因是，由于ECR和ECS是集成的，它减少了我们必须经历的工作流程。</p><p id="0b31" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，从这里开始，我将使用一步一步的方法来描述如何在AWS Fargate中使用CI/CD调度脚本。如果您已经完成了这些步骤的先决条件，那么您已经配置了Jenkins服务器、GitHub repo和AWS帐户。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="1f95" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">第一步</h1><ul class=""><li id="5c09" class="mr ms it kw b kx mt la mu ld mv lh mw ll mx lp my mz na nb bi translated">用正确的名称在ECR中创建一个存储库。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/f5ba35bfb73470b6d0ecd3896cd981e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G9BS9-QXfpqycxI9oNSXbg.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">在ECR中创建回购</p></figure><ul class=""><li id="25ec" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">您可以使用此处显示的切换来激活标签不变性或在推送图像时扫描。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/783fc618492ae39f1e849904ee52bc44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZT7kPwP3iWWXQaP3E2DzVA.png"/></div></div></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="af23" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">第二步</h1><ul class=""><li id="5b97" class="mr ms it kw b kx mt la mu ld mv lh mw ll mx lp my mz na nb bi translated">在Jenkins上创建一个新项目作为自由式项目。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/b30ee9151a792f782dd2354f9e1c7ec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUi-e03nr9vED6qz8RFzlQ.jpeg"/></div></div></figure><ul class=""><li id="fd46" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">配置Jenkins管道以从GitHub repo获取源代码，并将Docker映像推送到ECR中的repo。(转到<em class="lr">源代码管理</em>部分→选择选项<em class="lr"> Git。</em>)</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/7284b203e3137874e76f887e0c756267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rX8_j9VRhZKXBa383tKG7Q.png"/></div></div></figure><ul class=""><li id="7ab9" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">如果您已经使用我前面提到的ssh-key对配置了Jenkins和GitHub，那么在<em class="lr">凭证</em>下拉列表中，您将找到之前配置的密钥。</li><li id="afc4" class="mr ms it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">您可以指定想要从中获取代码的分支，这在CI/CD中很方便。</li><li id="e272" class="mr ms it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">转到您的ECR，单击您创建的存储库。然后点击<em class="lr">查看推送命令</em> <strong class="kw iu"> </strong>按钮。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/52e662785401d30a45abd53b863db49a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nSe1j28Hx480D6qzlzOAcQ.png"/></div></div></figure><ul class=""><li id="3c8e" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">接下来，我们应该将ECR报告中指定的推送命令交给Jenkins。(转到<em class="lr">构建</em>部分→点击<em class="lr">添加构建步骤</em> <strong class="kw iu"> </strong> →从下拉菜单中选择<em class="lr">执行shell </em> <strong class="kw iu"> </strong>。)</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/a54789c54b8b1c074d75b31cff09c7ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UhbRpVE3v_6Ni5QAldt-_w.png"/></div></div></figure><ul class=""><li id="2a50" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">当你完成配置后，你可以点击<em class="lr">应用</em>，然后<em class="lr">保存</em>。现在管道完成了。</li></ul></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="0ee2" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">第三步</h1><ul class=""><li id="489b" class="mr ms it kw b kx mt la mu ld mv lh mw ll mx lp my mz na nb bi translated">转到AWS ECS并创建集群。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/1e2fe9c819a83970d62e131b2129c4ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3TvT0cYKqDxU-RnBfooyvg.png"/></div></div></figure><ul class=""><li id="0f69" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">您可以从以下选项中选择<em class="lr">仅联网</em>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/ed6316f6a8db05c92a8309d44b886eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6MfaGy67x7LlfwKPqCpDPw.png"/></div></div></figure><ul class=""><li id="6cc3" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">然后，您必须为您的集群和任何其他配置命名，比如创建一个新的VPC、标记和启用容器洞察。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/342b2c4c4931ce92b41927e2fce765a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQL5zGAkNHvD-0G7lek1lQ.png"/></div></div></figure><ul class=""><li id="ff04" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">一旦您按下<em class="lr">创建</em> <strong class="kw iu"> </strong>按钮，集群将被创建，您可以查看集群。</li></ul></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="760f" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">第四步</h1><ul class=""><li id="6dbc" class="mr ms it kw b kx mt la mu ld mv lh mw ll mx lp my mz na nb bi translated">创建任务定义。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/7c357070e8fb767c61ddb2c09031409d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0WT9kM6iXMPHSsjSCPtlTg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/131c9852e0d7c79f8a350f651dba7a55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k6F4Q1z9OyM6kTg3zcYsLA.png"/></div></div></figure><ul class=""><li id="f5af" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">现在开始在下面的视图中配置任务定义。在这里，您可以根据您的任务大小指定IAM角色、任务内存和任务CPU。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/7272b5770408c0d722170c49d0f8f23e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LVhFCaej2BQb4Hra9MOm8g.png"/></div></div></figure><ul class=""><li id="4a6a" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">当你在配置时，你也必须在下面的视图中配置容器，我们在点击<em class="lr">添加容器</em>按钮后得到这个视图。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/399538f8567f71d20fafcccbc08506fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1PNDCh-kPEpmHKFXAYQ9RQ.png"/></div></div></figure><ul class=""><li id="798d" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">这里，存储库URL/image标签应该取自您在ECR中创建的存储库。其他配置，比如添加内存限制、端口映射和配置env变量，也可以在这里完成。</li></ul></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="d273" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">第五步</h1><ul class=""><li id="b01a" class="mr ms it kw b kx mt la mu ld mv lh mw ll mx lp my mz na nb bi translated">最后一步是创建一个调度任务，给出调度信息。(转到亚马逊ECS下的<em class="lr">集群</em>→选择您创建的集群→点击<em class="lr">计划任务</em> <strong class="kw iu"> </strong>标签→点击表格顶部的<em class="lr">创建</em> <strong class="kw iu"> </strong>按钮<strong class="kw iu"> </strong>。)</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/303908648e3306a1795381ad66caeb76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rIn1VRTjcnc8UvX-gYyq0w.png"/></div></div></figure><ul class=""><li id="59a2" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">在这里您可以选择<em class="lr">调度规则类型。</em> <strong class="kw iu"> </strong>您可以根据需要选择<em class="lr">定期运行</em>或<em class="lr"> Cron表达式</em>。这里，我们使用了cron表达式。你可以在这里获得更多关于cron表情的信息。</li><li id="5d2d" class="mr ms it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">如果向下滚动，您将能够看到更多关于目标的配置。您应该从下拉菜单中选择<em class="lr"> Fargate </em>作为启动类型和您创建的任务定义。</li><li id="af20" class="mr ms it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">也可以在这里配置VPC和安全组。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/91822f37a6983f8763ea09e4e91e47e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0qOyz_uElvV5RRsVPoDsBg.png"/></div></div></figure><ul class=""><li id="ab73" class="mr ms it kw b kx ky la lb ld nz lh oa ll ob lp my mz na nb bi translated">完成配置后，您可以在<em class="lr">计划任务</em>选项卡下查看您的计划任务。</li></ul><p id="bad1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以现在您可以对您的脚本进行更改，然后将它推送到您在Jenkins中配置的分支。然后，一旦您通过点击<em class="lr"> Build </em>使用Jenkins构建了图像，Docker图像将被推送到带有标签的ECR。</p><p id="ec73" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，一旦完成，计划的作业将根据您指定的规则运行。您还可以做的一件事是添加GitHub webhook，这样管道将完全自动化。</p><p id="be6f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请分享你的结果、观察、疑惑和想法。下一次再见！</p></div></div>    
</body>
</html>