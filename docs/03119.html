<html>
<head>
<title>How to Use WebAssembly to Transform Images Without a Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用WebAssembly在没有服务器的情况下转换图像</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-webassembly-to-transform-images-without-a-server-39db1a6e8c5?source=collection_archive---------17-----------------------#2020-01-21">https://betterprogramming.pub/how-to-use-webassembly-to-transform-images-without-a-server-39db1a6e8c5?source=collection_archive---------17-----------------------#2020-01-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bf26" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个实用而现实的WebAssembly用例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/afec0658d37f79a95e9bd7709fe63ccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F4AKT8PDljHLLHaM3Ln4dw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/s/photos/image?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@tosshio?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Jatniel Tunon </a>拍摄</p></figure><p id="133d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你经常阅读科技博客，你可能已经接触过<a class="ae ky" href="https://webassembly.org/" rel="noopener ugc nofollow" target="_blank">网络组装</a> (Wasm)以及围绕它的大肆宣传。</p><p id="ad98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，WebAssembly是一个可以由web浏览器执行的字节代码，这意味着用任何语言编写的应用程序都可以编译成WebAssembly，然后在您的浏览器中执行。</p><p id="a00f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大肆宣传带来了许多高质量的文章和演讲，展示了用例及优势，比如用C++完全编码你的GUI 。</p><p id="f12f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让你的应用程序进入Google Play是一件容易的事情，但是苹果的应用程序商店让事情变得有点困难。在许多要求中，你的应用程序图标图像不能有alpha通道。即使所述阿尔法通道未被使用。</p><p id="d115" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，删除alpha通道不是火箭科学，只需几分钟，使用<a class="ae ky" href="https://www.imagemagick.org/" rel="noopener ugc nofollow" target="_blank"> ImageMagick </a>(用C++编写)可以通过一个简单的命令行程序实现:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1335" class="ma mb it lw b gy mc md l me mf">magick convert icon.png -background white -alpha off new-icon.png</span></pre><p id="4242" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，如果我们想创建一个网站，我们可以提供我们的图像，并自动删除所有阿尔法通道？典型的架构可能是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/f988788552151444beb4519fce614d4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*6sFaduvWuUTCC9rHo1nvXQ.png"/></div></figure><p id="82ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的一个问题是，一旦用户离线，我们的web应用程序将不再有用。此外，ImageMagick必须安装在后端服务器上，客户端需要使用一个端点，因此需要将所有图像上传到服务器。</p><p id="c99c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然这不是一个大问题，并且对于处理图像操作的web应用程序来说是典型的，但是使用Wasm，我们可以做得更好！</p><p id="6d45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的目标是创建一个<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps" rel="noopener ugc nofollow" target="_blank">渐进式网络应用</a>，它在没有活跃的互联网连接的情况下也是有用的(当然是在加载网站至少一次之后)。如果我们的图像操作发生在服务器上，这是不可能的，所以让我们来看看我们简化的架构:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/05abd6398c0e77fda65ca38e9e0420d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/format:webp/1*3v-Ln67oe5_ed0VMbMB0CA.png"/></div></figure><p id="10f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对，就是这样。我们将所有的逻辑放在前端(人们可能会倾向于使用术语“无服务器”，遗憾的是，这个词是为完全不同的东西保留的)，没有图像被上传到任何服务器。</p><p id="350c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是我们不会使用任何JavaScript图像操作库，相反，我们希望使用ImageMagick，这是我们已经知道并喜欢的。但是有一个问题，它是一个可执行文件，我们如何将它放入我们的代码库中，以便我们可以从我们的JS中执行它？</p><p id="6ecc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，已经有人<a class="ae ky" href="https://github.com/KnicKnic/WASM-ImageMagick" rel="noopener ugc nofollow" target="_blank">为我们</a>完成了大部分工作，并将ImageMagick代码库重新编译成WebAssembly，准备在浏览器中使用。通过简单地使用高级Javascript API，我们现在可以在前端使用ImageMagick的全部功能(几乎是)。</p><p id="69e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简单起见，让我们从使用脚本标记导入ES模块开始。该封装也可在<a class="ae ky" href="https://www.npmjs.com/package/wasm-imagemagick" rel="noopener ugc nofollow" target="_blank"> npm </a>上获得。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="12c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以在应用程序中使用<code class="fe mk ml mm lw b">window.magick</code>对象对我们的图像执行ImageMagick命令。</p><p id="5d7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们剩下要做的就是构建我们的UI，并使用<a class="ae ky" href="https://github.com/KnicKnic/WASM-ImageMagick" rel="noopener ugc nofollow" target="_blank"> WASM-ImageMagick </a> API来转换我们的图像，使用的调用本质上与我们在命令行中所做的相同，代码可能看起来像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="42d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们只需将文件名、内容和所需的ImageMagick命令传递给导入的<code class="fe mk ml mm lw b">window.magick </code>对象，并接收一个没有alpha通道的图像。</p><p id="cb78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mk ml mm lw b">ReadFile</code>方法利用WASM-ImageMagick库提供的帮助函数，以合适的结构获取文件名和内容。我们现在在浏览器中有了ImageMagick的功能，可能性是无限的。</p><p id="1b57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于完整的工作示例，包括将处理后的图像作为“下载”发送回用户，请查看<a class="ae ky" href="https://removealphachannel.com/" rel="noopener ugc nofollow" target="_blank">移除Alpha通道</a>。</p><p id="3ae8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在您选择的开发工具中访问完整的源代码，毕竟不涉及服务器端代码！</p><p id="4bcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这些简单的用例能让您更好地感受到WebAssembly所涵盖的功能和日常用例。感谢阅读。</p></div></div>    
</body>
</html>