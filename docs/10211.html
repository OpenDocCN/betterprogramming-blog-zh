<html>
<head>
<title>Query Databases With 5 Principles To Rule Them All</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用5个原则来查询数据库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/querying-databases-5-principles-to-rule-them-all-afa61403b77d?source=collection_archive---------9-----------------------#2021-12-13">https://betterprogramming.pub/querying-databases-5-principles-to-rule-them-all-afa61403b77d?source=collection_archive---------9-----------------------#2021-12-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b0b8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">不管数据库类型如何，编写优化查询的准则</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/84dd50b5aa85c926478cc55876224b85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*36_iZCcqlP3-JyQJxTXYUg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自<a class="ae kv" href="https://unsplash.com/photos/diGdJKdr9n0" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="e26a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您曾经遭受过沉重的仪表板或超时查询的困扰吗？问题可能不是来自您的可视化工具或数据仓库，而是来自您的SQL查询本身。</p><p id="cb12" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为一名大量使用数据的人，我在过去的工作中花费了大量时间查询数千万亿字节的分析数据，以做出正确的决策。复杂的查询需要精心构建。无论是与数据仓库、数据湖还是流服务交互，都要应用相同的原则来确保执行中的性能。‍</p><p id="79c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是我多年来收集的一些技巧，并归纳为5个主要原则:</p><h1 id="6e4e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">1.不是越多越好</h1><p id="f008" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为了避免调动不必要的系统资源，从确定用例所需数据的范围开始，并利用所有SLQ技巧来达到目的:</p><ul class=""><li id="0ba8" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">在查询中总是使用<code class="fe my mz na nb b">WHERE</code>语句来过滤掉不相关的数据</li><li id="eb23" class="mp mq iq ky b kz nc lc nd lf ne lj nf ln ng lr mu mv mw mx bi translated">在大型表存储为多个文件和目录的基础设施中，利用<code class="fe my mz na nb b">WHERE</code>子句中的分区键</li><li id="f73b" class="mp mq iq ky b kz nc lc nd lf ne lj nf ln ng lr mu mv mw mx bi translated">避免使用<code class="fe my mz na nb b">SELECT *</code>,而是指定您需要的列名</li><li id="d221" class="mp mq iq ky b kz nc lc nd lf ne lj nf ln ng lr mu mv mw mx bi translated">在可能的情况下，使用<code class="fe my mz na nb b">LIMIT</code>对输出中的查询结果进行采样<br/> ‍</li></ul><h1 id="56fe" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">2.文字是免费的，但你如何使用它们可能会让你付出代价</h1><p id="ade8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">尽管有明显的重叠，但每个SQL函数都是为特定的需求而设计的，使用正确的函数对于防止效率低下至关重要。下面列出了一些提示，即使是很小的调整也会对性能产生重大影响:</p><ul class=""><li id="3ac4" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">除非需要与GROUP BY一起使用，否则不要用<code class="fe my mz na nb b">HAVING</code>代替<code class="fe my mz na nb b">WHERE</code>。</li><li id="7138" class="mp mq iq ky b kz nc lc nd lf ne lj nf ln ng lr mu mv mw mx bi translated">默认情况下，不要对数据进行重复数据删除，<code class="fe my mz na nb b">DISTINCT</code>是一项非常昂贵的操作。</li><li id="4c29" class="mp mq iq ky b kz nc lc nd lf ne lj nf ln ng lr mu mv mw mx bi translated">不要滥用通配符，在输入的末尾使用通配符(' xxx <strong class="ky ir"> % </strong>')来减少搜索的可能结果。</li></ul><h1 id="e0dc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">3.让你的加入和你一起工作，而不是和你作对</h1><p id="16b2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">组合不同表中的列是非常常见的。在某些情况下，您正在将第一个表中的每一行连接到第二个表中的每一行，查询甚至可能没有完成。明智地:</p><ul class=""><li id="424f" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">根据您的需求选择<a class="ae kv" href="https://www.metabase.com/learn/sql-questions/sql-join-types" rel="noopener ugc nofollow" target="_blank">正确的连接类型</a>。</li><li id="64a2" class="mp mq iq ky b kz nc lc nd lf ne lj nf ln ng lr mu mv mw mx bi translated">在on表达式中而不是在WHERE条件中插入连接条件，以缩小连接的行数，因为这是一个开销非常大的操作。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/c770d6e4f479a9f8481dcb6ccf2b9aa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*N1Nm_OxaO7-TDSvz.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:<a class="ae kv" href="https://www.siffletapp.com/" rel="noopener ugc nofollow" target="_blank"> Sifflet </a></p></figure><h1 id="0436" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.分而治之，又名使用通用表格表达式(CTE)</h1><p id="91e1" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">公用表表达式是一个临时表，可以在同一个查询中定义一次并多次使用。cte非常有助于提高代码的可读性，降低代码的复杂性，优化代码的执行资源。</p><p id="9329" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">cte可以在查询开始时用指令<code class="fe my mz na nb b">WITH table_name AS</code>定义</p><h1 id="40be" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">5.健康身体中的健康思想</h1><p id="439a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">关心你的查询格式是必要的。这些简单的最佳实践可以使您的查询可读性强、易于调试和共享:</p><ul class=""><li id="2236" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">大写SQL关键字</li><li id="d227" class="mp mq iq ky b kz nc lc nd lf ne lj nf ln ng lr mu mv mw mx bi translated">对表和列的名称和别名使用snake case</li><li id="6545" class="mp mq iq ky b kz nc lc nd lf ne lj nf ln ng lr mu mv mw mx bi translated">缩进和空格</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="aaa6" class="ls lt iq bd lu lv nr lx ly lz ns mb mc jw nt jx me jz nu ka mg kc nv kd mi mj bi translated"><strong class="ak">结论</strong></h1><p id="91d8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">随着新技术塑造现代数据堆栈，无论用户的专业技术水平如何，他们都越来越容易访问数据。</p><p id="f99e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据民主化固然很好，但确保数据平台的运行效率和健康却是一个真正的挑战。尽管没有神奇的手册或放之四海而皆准的方法，但实施一些最佳实践(如本文中所述)可以在确保数据操作的可持续性方面发挥不可或缺的作用。</p><p id="d924" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">I‍f:你喜欢讨论数据话题，请点击这里<a class="ae kv" href="https://www.linkedin.com/in/wissem-fathallah-6058b578/" rel="noopener ugc nofollow" target="_blank">联系我们</a>。</p></div></div>    
</body>
</html>