<html>
<head>
<title>How to Migrate Your Local MongoDB Database Between Computers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在计算机之间迁移本地MongoDB数据库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-migrate-your-local-mongodb-database-between-computers-debe57092ab5?source=collection_archive---------1-----------------------#2020-07-31">https://betterprogramming.pub/how-to-migrate-your-local-mongodb-database-between-computers-debe57092ab5?source=collection_archive---------1-----------------------#2020-07-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d11d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">MongoDB迁移的完整指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/33b87abea0d99a6048824ea30513e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tB5uMxlXi4bFSiZk"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@7bbbailey?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">巴斯贝利</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="5544" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将记录将MongoDB迁移到新机器所需的步骤。在本文结束时，您将拥有一个MongoDB，其中的集合和文档与之前的机器完全相同。事不宜迟，我们开始吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b788" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">问题陈述</h1><p id="b23e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我需要切换我的开发机器，并且需要将本地MongoDB中的数据迁移到新机器上。</p><h2 id="e68e" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">主要目标</h2><ul class=""><li id="238f" class="nl nm it lb b lc mu lf mv li nn lm no lq np lu nq nr ns nt bi translated">避免浪费时间和精力在MongoDB中重新创建虚拟数据。我的项目有7-8个微服务和数据库；每个微服务大概有2-3个集合。因此，我无法想象重新创建这些数据。</li></ul><p id="98a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我的问题是专门针对开发机器的数据迁移，但我相信只要您正在为MongoDB执行迁移，本文就能对您有所帮助。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fa44" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">溶液分析</h1><p id="bee3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当我知道我需要做这个迁移的时候，我有点惊慌。我在进行MongoDB迁移方面毫无经验。保持冷静(有时我做不到)并一点一点地解决问题是很重要的。我会把它分成两部分:</p><ul class=""><li id="dbb2" class="nl nm it lb b lc ld lf lg li nu lm nv lq nw lu nq nr ns nt bi translated">备份MongoDB数据</li><li id="49d5" class="nl nm it lb b lc nx lf ny li nz lm oa lq ob lu nq nr ns nt bi translated">将数据恢复到新机器</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dd53" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">备份MongoDB数据</h1><p id="9aad" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们可以使用<code class="fe oc od oe of b">mongodump</code>命令来备份我们自己的数据库。打开您的终端，并运行以下命令。您将能够生成转储文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="b7fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我使用上面的命令备份了MongoDB中的所有数据库。以下是<code class="fe oc od oe of b">mongodump</code>选项的详细信息:</p><ul class=""><li id="f477" class="nl nm it lb b lc ld lf lg li nu lm nv lq nw lu nq nr ns nt bi translated"><code class="fe oc od oe of b">--host</code>:默认值:<code class="fe oc od oe of b">localhost:27017</code>。我在这里明确声明，这样事情会更清楚，每个选项也更容易理解。</li><li id="6e30" class="nl nm it lb b lc nx lf ny li nz lm oa lq ob lu nq nr ns nt bi translated"><code class="fe oc od oe of b">--username</code>:用于验证MongoDB或特定数据库的用户名</li><li id="8217" class="nl nm it lb b lc nx lf ny li nz lm oa lq ob lu nq nr ns nt bi translated"><code class="fe oc od oe of b">--password</code>:用于验证MongoDB或特定数据库的密码</li><li id="f411" class="nl nm it lb b lc nx lf ny li nz lm oa lq ob lu nq nr ns nt bi translated"><code class="fe oc od oe of b">--out</code>:要保存转储文件的文件目录。默认情况下，它保存在位于当前目录的<code class="fe oc od oe of b">dump</code>目录下。</li></ul><p id="f942" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我的转储文件的输出。参考下面的截图。每个文件夹代表一个数据库。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/6589507f756b945dac425d22230586d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*kk0PAItso94QQgtrygGZpg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为每个数据库转储文件</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="89fc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">恢复MongoDB数据</h1><p id="983b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在这个阶段，您已经在新机器中拥有了转储文件目录。接下来，我们可以继续恢复MongoDB数据。</p><p id="6e2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我在这个路径<code class="fe oc od oe of b">~/Downloads/mongo-migration</code>保存了我的转储目录。</p><p id="bd3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以使用MongoDB中的默认root角色来恢复数据库。请参考下面的命令。</p><p id="e1af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用这个命令来恢复所有的数据库，您将拥有与以前完全相同的数据库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="750e" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">恢复多个数据库</h2><p id="0468" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">但是，可能会有这样一种情况，您只想恢复几个数据库，从转储目录中排除几个数据库。</p><p id="3605" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">比如我想在这一轮恢复<code class="fe oc od oe of b">audit</code>和<code class="fe oc od oe of b">client</code>表。我们可以通过在<code class="fe oc od oe of b">mongorestore</code>中使用<code class="fe oc od oe of b">--nsInclude</code>和<code class="fe oc od oe of b">nsExclude</code>选项来做到这一点。</p><p id="4831" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">使用</strong>的例子<code class="fe oc od oe of b"><strong class="lb iu">--nsInclude</strong></code></p><p id="0560" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<code class="fe oc od oe of b">--nsInclude</code>只选择我们想要恢复的数据库和集合。在下面的命令中，我们使用<code class="fe oc od oe of b">audit.*</code>恢复审计数据库中的所有集合，使用<code class="fe oc od oe of b">client.*</code>恢复客户端数据库中的所有集合。</p><p id="9995" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点符号后的通配符表示数据库中的所有集合。如果您想包含或排除多个数据库，您需要将其指定为<code class="fe oc od oe of b">nsInclude</code>或<code class="fe oc od oe of b">nsExclude</code>。参考下面的例子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="494e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">使用</strong>的例子<code class="fe oc od oe of b"><strong class="lb iu">--nsExclude</strong></code></p><p id="83c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<code class="fe oc od oe of b">nsExclude</code>来排除我们不想恢复的数据库和集合。在下面的命令中，我们排除了<code class="fe oc od oe of b">partner</code>、<code class="fe oc od oe of b">promotions</code>、<code class="fe oc od oe of b">transaction</code>和<code class="fe oc od oe of b">utilities</code>数据库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="0caa" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">恢复单个数据库</h2><p id="caff" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最后，这是恢复单个数据库的命令。这里有几点需要注意:</p><ul class=""><li id="9e57" class="nl nm it lb b lc ld lf lg li nu lm nv lq nw lu nq nr ns nt bi translated"><code class="fe oc od oe of b">-d</code>选项:指定要还原的数据库名称。这是一个<em class="oj">必需的</em>选项。</li><li id="cee3" class="nl nm it lb b lc nx lf ny li nz lm oa lq ob lu nq nr ns nt bi translated">指定正确的转储目录。例如，如果我正在恢复<code class="fe oc od oe of b">utilities</code>数据库，我必须指定<code class="fe oc od oe of b">utilities</code>数据库转储目录。</li></ul><p id="e740" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请参考下面的命令。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7e24" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="1d7d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">以下是这篇文章的要点:</p><ul class=""><li id="1a19" class="nl nm it lb b lc ld lf lg li nu lm nv lq nw lu nq nr ns nt bi translated">我们讨论了如何使用<code class="fe oc od oe of b">mongodump</code>备份MongoDB</li><li id="ec38" class="nl nm it lb b lc nx lf ny li nz lm oa lq ob lu nq nr ns nt bi translated">我们讨论了如何使用<code class="fe oc od oe of b">mongorestore</code>恢复一个数据库、多个数据库和单个数据库</li></ul><p id="4f29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。下一篇文章再见。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="da70" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><ul class=""><li id="3770" class="nl nm it lb b lc mu lf mv li nn lm no lq np lu nq nr ns nt bi translated"><a class="ae ky" href="https://dba.stackexchange.com/questions/113017/how-restore-a-specific-database-from-backup-using-mongorestore-command" rel="noopener ugc nofollow" target="_blank">堆栈溢出</a>线程上使用<code class="fe oc od oe of b">mongorestore</code>来恢复特定的数据库</li><li id="5119" class="nl nm it lb b lc nx lf ny li nz lm oa lq ob lu nq nr ns nt bi translated"><code class="fe oc od oe of b">mongodump</code>正式<a class="ae ky" href="https://docs.mongodb.com/manual/reference/program/mongodump/" rel="noopener ugc nofollow" target="_blank">文件</a></li><li id="851b" class="nl nm it lb b lc nx lf ny li nz lm oa lq ob lu nq nr ns nt bi translated"><code class="fe oc od oe of b">mongorestore</code>官方<a class="ae ky" href="https://docs.mongodb.com/manual/reference/program/mongorestore/" rel="noopener ugc nofollow" target="_blank">文件</a></li></ul></div></div>    
</body>
</html>