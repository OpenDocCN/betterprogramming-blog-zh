<html>
<head>
<title>How to Set Up Payments in Your App With Stripe, Angular, and Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在你的应用中使用Stripe、Angular和Express设置付款</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/payments-simplified-stripe-angular-express-4a88bf69f82e?source=collection_archive---------0-----------------------#2020-01-26">https://betterprogramming.pub/payments-simplified-stripe-angular-express-4a88bf69f82e?source=collection_archive---------0-----------------------#2020-01-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f0d5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">现在就把你的用户变成顾客</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e00988684443d09ca3daedfa25adaa25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M4LdQEGi24Y3BnkhVYGM5A.jpeg"/></div></div></figure><p id="8e80" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我们将使用Angular在前端和Node.js后端实现一个带有<a class="ae lq" href="https://stripe.com/" rel="noopener ugc nofollow" target="_blank"> Stripe </a>的完整结账流程。</p><p id="f66d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Stripe是一种支付处理器，这意味着它支持从客户银行(发卡银行)向商户银行(收款银行)进行电子转账，以支付用信用卡购买的商品或服务。</p><p id="9587" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我将跳过项目创建和Stripe帐户创建，我想专注于<a class="ae lq" href="https://stripe.com/docs/js" rel="noopener ugc nofollow" target="_blank"> Stripe.js </a>和Stripe API。</p><p id="299e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将在本帖中构建的流程遵循以下步骤。只有第一步和第二步在前端。</p><ol class=""><li id="f892" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">收集卡信息。</li><li id="8d34" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">将信息标记化并将其发送到后端。</li><li id="deb4" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">对卡进行保留(授权)。</li><li id="75b6" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">一些自定义业务逻辑。</li><li id="c5e1" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">授权资金的清算流程。</li></ol></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="5c4d" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">我们将建造什么</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/5bad71c3872b8e985caf88925c36dbd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4Gs_Wdb-VPBLw1Y7HPg2VQ.gif"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">从条纹文档</p></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="92ee" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">前端</h1><p id="2b08" class="pw-post-body-paragraph ku kv it kw b kx nj ju kz la nk jx lc ld nl lf lg lh nm lj lk ll nn ln lo lp im bi translated">让我们从实现第一步开始。为此，我们可以从Stripe.js获得一些支持，这是Stripe为前端构建的一个库。<br/>我们需要做的第一件事是将这个库包含在<code class="fe no np nq nr b">index.html</code>中。</p><p id="74a3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在项目中包含Stripe.js:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="fa58" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们已经包括了stripe.js的v3，并且我们已经告诉stripe我们使用谁作为Stripe可发布密钥，该密钥可以在Stripe仪表板上找到。</p><p id="7887" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，要使用<code class="fe no np nq nr b">elements</code>和<code class="fe no np nq nr b">stripe</code>常量，我们需要在<code class="fe no np nq nr b">typings.d.ts</code>中声明它们，因为当试图访问<code class="fe no np nq nr b">stripe</code>或<code class="fe no np nq nr b">elements</code>时，TypeScript通常会报错。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/7084c5ce126d3b77adc2b1c7879d540d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*cPG7pNzVK-BKZQv9QdpFhQ.png"/></div></figure><p id="b3eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们已经在项目中包含了Stripe.js，所以下一步是初始化Stripe元素。</p><p id="c87a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Stripe元素是可定制的UI组件，用于收集支付表单中的敏感信息。</p><p id="5598" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们编写一个从客户那里获取卡信息的表单。我们的表单将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/1cd51431364683ed362264b6b1cf7a82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IwqS2JqzgHxYwzlWdbfvHw.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="11d1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不要忘记在你的<code class="fe no np nq nr b">app.module</code>或者第一个父模块的导入数组中包含<code class="fe no np nq nr b">FormsModule</code>。</p><p id="9fe2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，模板的打字稿。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="1a69" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在这里做的是创建一个card元素，并将其安装到模板中的<code class="fe no np nq nr b">#cardInfo</code>元素。</p><p id="b022" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe no np nq nr b">createStripeToken()</code>方法将尝试使用<code class="fe no np nq nr b">card</code>元素创建一个条带令牌，并将根据情况调用<code class="fe no np nq nr b">onSuccess()</code>或<code class="fe no np nq nr b">onError()</code>。我已经在一个<code class="fe no np nq nr b">MatDialog</code>上实现了这个表单，这只是一个偏好。</p><p id="9e84" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对话框关闭后，我获取结果并调用服务，该服务带有一个已经从客户处获取的订单和一个令牌，该令牌将获取该订单所需的资金。</p><p id="41de" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于成功的令牌创建，来自Stripe的响应将是:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="d024" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将只使用这个响应的ID属性。下面的方法是打开支付对话框的方法，它正在等待对话框的结果对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="54fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此时，我们需要做的就是用订单数据和请求负载中的条带令牌调用所需的服务。这是由助手方法<code class="fe no np nq nr b">createOrder(token: string)</code>完成的。</p><p id="8607" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，退房流程的前端已经结束。我们创建了一个Stripe元素来获取卡信息，使用stripe.js对该信息进行令牌化，以避免将任何敏感数据传递到我们的后端，并将该一次性令牌发送到后端。</p><p id="d1b0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们转到后端，看看这里会发生什么。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="5202" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">移动到后端</h1><p id="ba41" class="pw-post-body-paragraph ku kv it kw b kx nj ju kz la nk jx lc ld nl lf lg lh nm lj lk ll nn ln lo lp im bi translated">首先，让我们安装软件包。我们有一个名为Stripe for npm的很棒的库，它在使用Stripe API方面帮了我们很多。</p><pre class="kj kk kl km gt nw nr nx ny aw nz bi"><span id="b25d" class="oa mn it nr b gy ob oc l od oe">npm install stripe</span></pre><p id="e35e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">安装完成后，我们需要在将要处理的文件中包含<code class="fe no np nq nr b">stripe</code>，在本例中是<code class="fe no np nq nr b">controller.js</code>或<code class="fe no np nq nr b">helper.js</code>。将以下内容和您的密钥添加到文件的开头。</p><p id="c374" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">包含在项目中:</p><pre class="kj kk kl km gt nw nr nx ny aw nz bi"><span id="db80" class="oa mn it nr b gy ob oc l od oe">const stripe = require('stripe')('<em class="of">change this to your secret key</em>');</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="194d" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">条纹集成</h1><p id="3aff" class="pw-post-body-paragraph ku kv it kw b kx nj ju kz la nk jx lc ld nl lf lg lh nm lj lk ll nn ln lo lp im bi translated">我们在后端要做的是获取订单数据和条带令牌<strong class="kw iu"> </strong>并实现我们的自定义逻辑。因此，我们将分三个主要步骤来完成。</p><ol class=""><li id="a234" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">我们将立即创建一个条纹电荷，但不捕获它(<code class="fe no np nq nr b">capture: false</code>)。</li><li id="92f3" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">操作订单的创建。</li><li id="c5b9" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">订单创建后，如果成功，我们将收取授权资金，否则，我们将退还给客户。</li></ol><p id="e730" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">假设我们有这样一个API端点:</p><pre class="kj kk kl km gt nw nr nx ny aw nz bi"><span id="c981" class="oa mn it nr b gy ob oc l od oe">// index.js<br/>router.post('order',<br/>token({ required: true }),<br/>controller.create)</span></pre><p id="84a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe no np nq nr b">create()</code>控制器中，我们需要获取该订单的定价，然后使用<code class="fe no np nq nr b">request.body</code>中的Stripe令牌在Stripe上创建该价格的费用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="74ed" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们在这里注意两件关键的事情。</p><p id="f16f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">1.我们用一个辅助函数来定价。<br/> 2。我们把它兑换成便士。</p><p id="9912" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可能已经在<code class="fe no np nq nr b">request.body</code>中有了定价，现在您可能认为:“哦，是的，他正在通过助手获得价格，因为他还没有在订单数据中获得价格”，但这是错误的。</p><p id="fd27" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">即使你有一个类似<code class="fe no np nq nr b">req.body.order.price</code>的属性，也不要用它在条纹上创建一个电荷对象。很容易操纵来自前端的请求有效负载，并且<code class="fe no np nq nr b">req.body</code>中的价格可能不是该订单的真实价格。</p><p id="90d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">总是在后端侧重新计算，相比前端是更安全的环境。</p><p id="e434" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">“这个转换呢？”你可能会问。这是因为Stripe只接受便士价格，而且必须是整数，而不是小数。所以，如果你要收1美元，金额就是1 x 100美元= 100便士。如果你要收100美元，金额必须是10000便士。</p><p id="3e61" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一件需要注意的重要事情。如果电荷创建将在许多控制器上发生，我强烈建议编写<code class="fe no np nq nr b">createCharge()</code>和<code class="fe no np nq nr b">getChargeData()</code>助手函数，在我们必须创建电荷的任何地方使用。</p><p id="ac46" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是我在日常工作中处理实现的方式，以减少出错的可能性。因此，助手看起来会像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="6002" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们回到我们制造电荷的那一点。这里需要注意的一件重要事情是<code class="fe no np nq nr b">capture: false</code>属性。</p><p id="e734" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">默认情况下，Stripe将立即创建并向客户端收取给定的金额。我们想要的是搁置，因为我们想授权这些资金。这是因为我们不确定订单是否会成功创建。</p><p id="2778" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果可以成功创建收费，Stripe的响应将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="3d6c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此时，我们已经为与令牌<strong class="kw iu"> </strong>相关的客户端<strong class="kw iu"> </strong>和我们指定的金额<strong class="kw iu"> </strong>创建了一个收费对象，但<em class="of">未在条带端捕获</em> <strong class="kw iu"> </strong>。</p><p id="c36f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们创建了一个电荷对象，这意味着什么？这意味着我们已经将客户订单所需的资金从客户的银行转移到Stripe，并且我们已经对该卡进行了暂挂。</p><p id="20ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们不会把这些资金转移到我们这边。他们只是被Stripe屏蔽了，会被搁置七天。这是另一个重要的部分。这个授权过程最多可以持续。七天。</p><p id="5505" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之后会发生什么？在此之后，Stripe将自动退还该费用从客户处扣留的所有资金。</p><p id="7b20" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，如果您的流程需要一些时间来了解您提供的服务或商品是否可以发送到客户端，请确保这个时间不超过七天，或者选择另一个结账流程。</p><p id="0abd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好了，现在，让我们创建客户的订单，然后获取这些资金。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="61e8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe no np nq nr b">makeOrderCreation()</code>内部发生了什么？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="d68d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，我们使用了另一个助手函数在数据库中创建订单，然后在订单创建后，我们将成功响应返回给前端。之后，我们将获得授权资金。</p><p id="8ed9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要捕获以前创建的费用，我们需要执行一个捕获操作，我们需要的只是费用的ID。</p><p id="2184" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们执行捕获操作，它就像下面这样简单。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><blockquote class="og"><p id="ee45" class="oh oi it bd oj ok ol om on oo op lp dk translated"><em class="oq">“获取费用总是成功的，除非费用已经被退款、过期、获取，或者指定了无效的获取金额<br/>，在这种情况下，此方法将抛出错误。”—条带文档</em></p></blockquote><p id="4644" class="pw-post-body-paragraph ku kv it kw b kx or ju kz la os jx lc ld ot lf lg lh ou lj lk ll ov ln lo lp im bi translated">现在，默认情况下，如果您不指定要捕获的数量，Stripe将捕获该电荷对象中的全部数量，这正是我们想要的。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="4022" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">退款流程</h1><p id="66d5" class="pw-post-body-paragraph ku kv it kw b kx nj ju kz la nk jx lc ld nl lf lg lh nm lj lk ll nn ln lo lp im bi translated">如果订单无法创建会发生什么？我们已经授权了所需的资金，但我们无法创建订单。那么，现在该怎么办呢？</p><p id="74ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然Stripe将在七天后自动退还这笔费用，但作为一个失败订单的客户，在您的对账单上看到一笔费用并不是一件好事。因此，我们可以做的是为该费用创建退款。</p><p id="4afc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在<code class="fe no np nq nr b">createOrder().catch()</code>方法中创建退款。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="ecf6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在这里做的是创建费用的全额退款，因为我们无法创建订单，所以我们不想无缘无故地扣留我们客户的资金。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="765e" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">结论</h1><p id="94df" class="pw-post-body-paragraph ku kv it kw b kx nj ju kz la nk jx lc ld nl lf lg lh nm lj lk ll nn ln lo lp im bi translated">我们使用Stripe、Angular和Express实现了完整的结账流程。有了Stripe，结账流程可高度定制，让您能够满足自己的需求。</p><p id="28e8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在本文中遵循的流程是:</p><ol class=""><li id="69a8" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">使用Stripe.js收集信息</li><li id="acbb" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">使用Stripe.js对信息进行标记化。</li><li id="733f" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">将令牌与订单数据一起发送到后端。</li><li id="9507" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">使用该令牌在条带上创建费用。</li><li id="c73a" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">订单的创建。</li><li id="16cb" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">获取或退还Stripe上的费用。</li></ol><p id="a325" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请随时问我任何问题或给我任何建议。</p><p id="cab5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读和快乐编码！</p></div></div>    
</body>
</html>