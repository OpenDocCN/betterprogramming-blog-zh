<html>
<head>
<title>How To Fetch Specific Messages in Apache Kafka</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在阿帕奇卡夫卡中获取特定信息</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-fetch-specific-messages-in-apache-kafka-4133dad0b4b8?source=collection_archive---------4-----------------------#2021-03-08">https://betterprogramming.pub/how-to-fetch-specific-messages-in-apache-kafka-4133dad0b4b8?source=collection_archive---------4-----------------------#2021-03-08</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="f480" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">掌握Kafka控制台消费者和kafkacat</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/d843e31c160f88f8976a586d17bb0ce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bHEliXK4VgfdEnOm"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@alfonsmc10" rel="noopener ugc nofollow" target="_blank">阿尔方斯·莫拉莱斯</a>在<a class="ae kz" href="https://unsplash.com/photos/YLSwjSy7stw" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="07f6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一个人可以用Kafka执行的最基本的操作之一显然是消费来自特定主题的消息。有时我们只需要获取最后一批消息，但在其他一些情况下，我们可能需要使用两个偏移量或时间戳内的消息。</p><p id="b07a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本文中，我们将讨论如何使用Kafka控制台消费者和一个名为<code class="fe lw lx ly lz b">kafkacat</code>的命令行工具来消费Kafka主题中产生的消息。具体来说，在以下几节中，我们将探讨如何消费:</p><ul class=""><li id="5609" class="ma mb iu lc b ld le lg lh lj mc ln md lr me lv mf mg mh mi bi translated">所有的信息。</li><li id="9db3" class="ma mb iu lc b ld mj lg mk lj ml ln mm lr mn lv mf mg mh mi bi translated">第<em class="mo"> N </em>条消息。</li><li id="aa15" class="ma mb iu lc b ld mj lg mk lj ml ln mm lr mn lv mf mg mh mi bi translated">下一个<em class="mo"> N个</em>消息。</li><li id="2128" class="ma mb iu lc b ld mj lg mk lj ml ln mm lr mn lv mf mg mh mi bi translated">最后的第N条消息。</li><li id="4cb4" class="ma mb iu lc b ld mj lg mk lj ml ln mm lr mn lv mf mg mh mi bi translated">两个时间戳之间的消息。</li><li id="72fb" class="ma mb iu lc b ld mj lg mk lj ml ln mm lr mn lv mf mg mh mi bi translated">两个偏移量之间的消息。</li></ul></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h1 id="91d0" class="mw mx iu bd my mz na nb nc nd ne nf ng ka nh kb ni kd nj ke nk kg nl kh nm nn bi translated"><strong class="ak">卡夫卡控制台消费者</strong></h1><p id="966b" class="pw-post-body-paragraph la lb iu lc b ld no jv lf lg np jy li lj nq ll lm ln nr lp lq lr ns lt lu lv in bi translated"><code class="fe lw lx ly lz b">kafka-console-consumer</code>是一个工具，用于消费指定主题的消息。它通常用于以下两个目的:</p><ul class=""><li id="2103" class="ma mb iu lc b ld le lg lh lj mc ln md lr me lv mf mg mh mi bi translated">测试或调试消息的基本消费，而不必使用编程语言编写消费者。</li><li id="10e9" class="ma mb iu lc b ld mj lg mk lj ml ln mm lr mn lv mf mg mh mi bi translated">根据您编写的相应消费者应用程序测试、调试和比较消费的消息。</li></ul><p id="e74b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">命令行工具从Kafka主题中读取数据，并将其输出到标准输出。它有以下选项:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h1 id="5404" class="mw mx iu bd my mz na nb nc nd ne nf ng ka nh kb ni kd nj ke nk kg nl kh nm nn bi translated"><strong class="ak">什么是卡夫卡？</strong></h1><p id="27d0" class="pw-post-body-paragraph la lb iu lc b ld no jv lf lg np jy li lj nq ll lm ln nr lp lq lr ns lt lu lv in bi translated"><code class="fe lw lx ly lz b"><a class="ae kz" href="https://github.com/edenhill/kafkacat" rel="noopener ugc nofollow" target="_blank">kafkacat</a></code> <em class="mo"> </em>是一个快速轻量的命令行工具，与<code class="fe lw lx ly lz b">kafka-console-consumer</code>和<code class="fe lw lx ly lz b">kafka-console-producer</code>相比，它提供了一套更全面的实用程序。它主要用于调试或测试Kafka设置。具体来说，它可以用于从Kafka主题生成或消费消息，并为集群、特定主题、分区或副本获取元数据。要安装<code class="fe lw lx ly lz b">kafkacat</code>，您只需运行:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="202e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">可以传递给<code class="fe lw lx ly lz b">kafkacat</code>的选项如下所示:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="c8e0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在我们已经介绍了Kafka控制台消费者和<code class="fe lw lx ly lz b">kafkacat</code>，是时候看看它们的实际应用了。</p></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h1 id="312a" class="mw mx iu bd my mz na nb nc nd ne nf ng ka nh kb ni kd nj ke nk kg nl kh nm nn bi translated">如何使用所有的消息</h1><p id="c985" class="pw-post-body-paragraph la lb iu lc b ld no jv lf lg np jy li lj nq ll lm ln nr lp lq lr ns lt lu lv in bi translated">为了使用控制台消费者来消费Kafka主题的所有消息，我们只需要传递<code class="fe lw lx ly lz b">--from-beginning</code>选项，这样消费者就可以从最早的可用偏移量获取消息:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="52f6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">kafkacat</code>的等效命令如下所示。注意<code class="fe lw lx ly lz b">-o</code>选项(对应于偏移)需要设置为<code class="fe lw lx ly lz b">beginning</code>:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h1 id="fe93" class="mw mx iu bd my mz na nb nc nd ne nf ng ka nh kb ni kd nj ke nk kg nl kh nm nn bi translated"><strong class="ak">如何消费前N条消息</strong></h1><p id="8910" class="pw-post-body-paragraph la lb iu lc b ld no jv lf lg np jy li lj nq ll lm ln nr lp lq lr ns lt lu lv in bi translated">为了使用Kafka控制台消费者来消费第一个<em class="mo"> N </em>消息，我们必须同时提供<code class="fe lw lx ly lz b">--from-beginning</code>和<code class="fe lw lx ly lz b">--max-messages</code>选项。假设我们需要使用前十条消息，下面的命令将会完成这个任务:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="e135" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">使用<code class="fe lw lx ly lz b">kafkacat</code>可以得到相同的结果，如下所示。同样，我们需要提供偏移量。此外，我们需要通过<code class="fe lw lx ly lz b">-c</code>选项传递计数:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h1 id="9e9f" class="mw mx iu bd my mz na nb nc nd ne nf ng ka nh kb ni kd nj ke nk kg nl kh nm nn bi translated">如何消费接下来的N条消息</h1><p id="201a" class="pw-post-body-paragraph la lb iu lc b ld no jv lf lg np jy li lj nq ll lm ln nr lp lq lr ns lt lu lv in bi translated">现在，为了使用控制台消费者来消费下一个<em class="mo"> N </em>消息，我们需要提供<code class="fe lw lx ly lz b">--max-messages</code>选项并省略<code class="fe lw lx ly lz b">--from-beginning</code>以便消费者将从最新的偏移量开始消费。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="83a5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">kafkacat</code> <em class="mo"> </em>中的等效命令如下所示。由于我们想要获取下一个<em class="mo"> N </em>消息，我们应该省略偏移选项(即<code class="fe lw lx ly lz b">-o</code>):</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h1 id="4d2b" class="mw mx iu bd my mz na nb nc nd ne nf ng ka nh kb ni kd nj ke nk kg nl kh nm nn bi translated">如何消耗最后N条消息</h1><p id="c98f" class="pw-post-body-paragraph la lb iu lc b ld no jv lf lg np jy li lj nq ll lm ln nr lp lq lr ns lt lu lv in bi translated">为了消费已经产生的最后的<em class="mo"> N </em>条消息，我们需要指定一个分区和一个特定的偏移量，消费者将从这个偏移量开始获取消息。假设我们想从偏移量<code class="fe lw lx ly lz b">12873</code>开始使用分区<code class="fe lw lx ly lz b">1</code>中的最后一条消息，下面的方法应该可以做到。还要注意，对于这个场景，我们使用的是<code class="fe lw lx ly lz b">kafka-simple-consumer-shell.sh</code>:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="f08c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有了<code class="fe lw lx ly lz b">kafkacat</code>，从指定的主题和分区获取最后的<em class="mo"> N </em>条消息是否更容易，因为我们不需要显式地提供偏移量。我们只需要指定一个负的偏移量。在<code class="fe lw lx ly lz b">kafkacat</code>中，负偏置<code class="fe lw lx ly lz b">-o</code>表示从末端的相对偏置。此外，我们提供了<code class="fe lw lx ly lz b">-e</code>标志，以便消费者在检索到最后一条消息时能够成功退出。</p><p id="a71d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以下命令将从主题<code class="fe lw lx ly lz b">testTopic</code>中带有<code class="fe lw lx ly lz b">id=1</code>的分区获取最后十条消息:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h1 id="a7a8" class="mw mx iu bd my mz na nb nc nd ne nf ng ka nh kb ni kd nj ke nk kg nl kh nm nn bi translated">如何在两个时间戳之间使用消息</h1><p id="5a07" class="pw-post-body-paragraph la lb iu lc b ld no jv lf lg np jy li lj nq ll lm ln nr lp lq lr ns lt lu lv in bi translated">当谈到时间戳和偏移量时，<code class="fe lw lx ly lz b">kafkacat</code>是合适的，所以我将只讨论使用该工具执行某些操作。</p><p id="9faa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了使用两个时间戳之间的消息，我们必须提供开始和结束时间戳(以毫秒为单位)，如下所示:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure><ul class=""><li id="e326" class="ma mb iu lc b ld le lg lh lj mc ln md lr me lv mf mg mh mi bi translated"><code class="fe lw lx ly lz b">s@..</code>表示起始时间戳。</li><li id="5359" class="ma mb iu lc b ld mj lg mk lj ml ln mm lr mn lv mf mg mh mi bi translated"><code class="fe lw lx ly lz b">e@..</code>表示结束时间戳(不含)。</li></ul></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h1 id="fd9d" class="mw mx iu bd my mz na nb nc nd ne nf ng ka nh kb ni kd nj ke nk kg nl kh nm nn bi translated">如何在两个偏移量之间使用消息</h1><p id="cb3b" class="pw-post-body-paragraph la lb iu lc b ld no jv lf lg np jy li lj nq ll lm ln nr lp lq lr ns lt lu lv in bi translated">最后，为了使用两个偏移量之间的消息，您只需要提供一个起始偏移量和表示结束偏移量和起始偏移量之差的计数。</p><p id="7352" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">假设我们想要使用偏移量<code class="fe lw lx ly lz b">11</code>和<code class="fe lw lx ly lz b">21</code>之间的消息，我们需要运行下面的<code class="fe lw lx ly lz b">kafkacat</code>命令:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="1484" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">-o 11</code>表示消费者应该从偏移量<code class="fe lw lx ly lz b">11</code>开始获取消息，<code class="fe lw lx ly lz b">-c 10</code>指定我们只需要消费从偏移量<code class="fe lw lx ly lz b">11</code>开始的前十条消息。</p></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h1 id="a898" class="mw mx iu bd my mz na nb nc nd ne nf ng ka nh kb ni kd nj ke nk kg nl kh nm nn bi translated">结论</h1><p id="8aa3" class="pw-post-body-paragraph la lb iu lc b ld no jv lf lg np jy li lj nq ll lm ln nr lp lq lr ns lt lu lv in bi translated">在本文中，我们讨论了如何使用来自特定Kafka主题的特定消息。我们介绍了Kafka控制台消费者以及<code class="fe lw lx ly lz b">kafkacat</code>，一个非常强大的命令行工具。我们探索了所有可能需要消息消费的场景。我们展示了如何使用最新和最早的消息。此外，我们讨论了在两个时间戳或偏移量之间使用消息的可能方式。</p><p id="cebd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">总的来说，<code class="fe lw lx ly lz b">kafkacat</code>是一个非常强大的工具，比Kafka自带的控制台消费者和生产者功能更丰富。它以更简单的方式提供了更全面的功能，我强烈建议人们使用这个工具。</p></div></div>    
</body>
</html>