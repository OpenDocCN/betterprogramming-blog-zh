<html>
<head>
<title>How to Test Electron Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何测试电子应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-test-electron-apps-1e8eb0078d7b?source=collection_archive---------2-----------------------#2021-10-28">https://betterprogramming.pub/how-to-test-electron-apps-1e8eb0078d7b?source=collection_archive---------2-----------------------#2021-10-28</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="631a" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">探索剧作家工具</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/bd0ce350902c270b3f7037af50b938f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fj7JGM2d17R1YH27ULtcYg.jpeg"/></div></div></figure><p id="d90c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在我的上一篇文章中，我谈到了如何测试苗条的组件和NPM包。我的旅程还没有结束。我还得弄清楚如何测试电子应用程序。</p><h1 id="d5ae" class="lr ls iu bd lt lu lv lw lx ly lz ma mb ka mc kb md kd me ke mf kg mg kh mh mi bi translated">可用的工具</h1><p id="0448" class="pw-post-body-paragraph kv kw iu kx b ky mj jv la lb mk jy ld le ml lg lh li mm lk ll lm mn lo lp lq in bi translated">测试电子应用程序的主要问题是缺乏已建立和更新的框架。几乎所有的指南都推荐使用<a class="ae mo" href="https://www.electronjs.org/spectron" rel="noopener ugc nofollow" target="_blank"> Spectron </a>。但是Spectron只支持13以下的电子版本:<a class="ae mo" href="https://github.com/electron-userland/spectron/issues/896" rel="noopener ugc nofollow" target="_blank">更新的版本不工作</a>。这对我来说毫无用处。</p><p id="a8ae" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Spectron的最佳替代方案是<a class="ae mo" href="https://playwright.dev/" rel="noopener ugc nofollow" target="_blank">剧作家</a>:一个由微软创建和维护的框架，此外还集成了TypeScript。</p><h1 id="2815" class="lr ls iu bd lt lu lv lw lx ly lz ma mb ka mc kb md kd me ke mf kg mg kh mh mi bi translated">安装剧作家</h1><p id="472e" class="pw-post-body-paragraph kv kw iu kx b ky mj jv la lb mk jy ld le ml lg lh li mm lk ll lm mn lo lp lq in bi translated">我一直在做我的模板，<a class="ae mo" href="https://github.com/el3um4s/memento-svelte-electron-typescript" rel="noopener ugc nofollow" target="_blank">MEMENTO——苗条，尾翼，电子，打字稿</a>。首先，我将剧作家添加到项目依赖项中:</p><pre class="kk kl km kn gu mp mq mr ms aw mt bi"><span id="74a9" class="mu ls iu mq b gz mv mw l mx my">npm i -D playwright @playwright/test</span></pre><p id="c1c0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">因为我只对测试电子感兴趣，所以我没有安装其他浏览器(我不使用<code class="fe mz na nb mq b">npx playwright install</code>因为我不需要它们)。但是我给<code class="fe mz na nb mq b">package.json</code>添加了一个脚本:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><h1 id="d88e" class="lr ls iu bd lt lu lv lw lx ly lz ma mb ka mc kb md kd me ke mf kg mg kh mh mi bi translated">创建第一个测试:电子启动</h1><p id="4345" class="pw-post-body-paragraph kv kw iu kx b ky mj jv la lb mk jy ld le ml lg lh li mm lk ll lm mn lo lp lq in bi translated">我从创建第一个测试开始。我建立了一个<code class="fe mz na nb mq b">test</code>文件夹，里面是<code class="fe mz na nb mq b">base.test.ts</code>文件。我想检查的是电子应用程序启动并显示一个窗口。</p><p id="6fa0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">阅读剧作家文档，我可以找到两个实验类:<a class="ae mo" href="https://playwright.dev/docs/api/class-electron/" rel="noopener ugc nofollow" target="_blank">电子</a>和<a class="ae mo" href="https://playwright.dev/docs/api/class-electronapplication" rel="noopener ugc nofollow" target="_blank">电子应用</a>。</p><p id="e2e3" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我还需要<a class="ae mo" href="https://playwright.dev/docs/api/class-test/" rel="noopener ugc nofollow" target="_blank"> Test </a>类，来运行各种测试并指出我期望达到的结果。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><p id="dc46" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我必须编写的测试是异步的:电子打开并不总是即时的，所以我想确保只在实际可能的时候执行各种操作。首先要做的是启动电子:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><p id="6fec" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">启动应用程序后，检查是否有可见窗口。我用<code class="fe mz na nb mq b"><a class="ae mo" href="https://playwright.dev/docs/api/class-electronapplication#electron-application-evaluate" rel="noopener ugc nofollow" target="_blank">electronApplication.evaluate(pageFunction[, arg])</a></code></p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><p id="a3bb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这样我最终得到一个包含电子窗口状态的<code class="fe mz na nb mq b">windowState</code>对象。我希望窗口是可见的，开发窗口是关闭的，应用程序不会崩溃。翻译成代码:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><p id="5dd5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">运行完测试后，我关闭电子:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><p id="9e6e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在我把它们放在一起，这是我的第一个测试:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><p id="ccbc" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">要运行它，我使用以下命令:</p><pre class="kk kl km kn gu mp mq mr ms aw mt bi"><span id="c9a6" class="mu ls iu mq b gz mv mw l mx my">npm run test</span></pre><h1 id="87d5" class="lr ls iu bd lt lu lv lw lx ly lz ma mb ka mc kb md kd me ke mf kg mg kh mh mi bi translated">检查窗口的内容</h1><p id="d1e4" class="pw-post-body-paragraph kv kw iu kx b ky mj jv la lb mk jy ld le ml lg lh li mm lk ll lm mn lo lp lq in bi translated">应用程序启动了。接下来检查的是内容。因为我将在同一个页面上依次运行多个测试，所以我使用了<code class="fe mz na nb mq b">test.describe</code></p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><p id="ade7" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我可以与页面的各种元素进行交互，并检查它们的HTML代码。例如，我可以确定页面标题是什么:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><p id="0caf" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">或者，我可以检查应用程序的版本号是否确实显示出来:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><h1 id="a9ba" class="lr ls iu bd lt lu lv lw lx ly lz ma mb ka mc kb md kd me ke mf kg mg kh mh mi bi translated">检查图形</h1><p id="7983" class="pw-post-body-paragraph kv kw iu kx b ky mj jv la lb mk jy ld le ml lg lh li mm lk ll lm mn lo lp lq in bi translated">除了内容，一个有用的东西是检查电子外观和感觉的能力。为此，我必须截取窗口的截图，并与参考图像进行比较。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><p id="08c7" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">每次我运行测试时，剧作家都会将窗口截图(保存在<code class="fe mz na nb mq b">tests/screenshot/firstWindow.png</code>中)与参考截图进行比较。引用映像是在测试的第一次开始时创建的，并且是不可变的，除非您明确指出您想要更新它。</p><p id="8a8f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我给<code class="fe mz na nb mq b">package.json</code>添加了一个脚本来改变参考图像:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><h1 id="340a" class="lr ls iu bd lt lu lv lw lx ly lz ma mb ka mc kb md kd me ke mf kg mg kh mh mi bi translated">定制剧作家</h1><p id="6790" class="pw-post-body-paragraph kv kw iu kx b ky mj jv la lb mk jy ld le ml lg lh li mm lk ll lm mn lo lp lq in bi translated">我可以通过创建一个<code class="fe mz na nb mq b">playwright.config.ts</code>文件来配置剧作家的整体行为。我对定制<code class="fe mz na nb mq b">toMatchSnapshot</code>的灵敏度很感兴趣，所以写:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><h1 id="0dd9" class="lr ls iu bd lt lu lv lw lx ly lz ma mb ka mc kb md kd me ke mf kg mg kh mh mi bi translated">记录测试</h1><p id="5354" class="pw-post-body-paragraph kv kw iu kx b ky mj jv la lb mk jy ld le ml lg lh li mm lk ll lm mn lo lp lq in bi translated">剧作家的另一个有用的功能是能够记录各种测试并在屏幕上播放它们。它可以用来检查应用程序的行为，最重要的是了解什么不工作。我需要<a class="ae mo" href="https://playwright.dev/docs/api/class-tracing" rel="noopener ugc nofollow" target="_blank">跟踪</a>类。用<code class="fe mz na nb mq b">start</code>和<code class="fe mz na nb mq b">stop</code>我可以控制录音:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure><p id="a839" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">记录保存在<code class="fe mz na nb mq b">zip</code>文件中。为了能够轻松打开它，我给<code class="fe mz na nb mq b">package.json</code>添加了一个脚本:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nc nd l"/></div></figure></div><div class="ab cl ne nf hy ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="in io ip iq ir"><h1 id="89eb" class="lr ls iu bd lt lu nl lw lx ly nm ma mb ka nn kb md kd no ke mf kg np kh mh mi bi translated">结论</h1><p id="409c" class="pw-post-body-paragraph kv kw iu kx b ky mj jv la lb mk jy ld le ml lg lh li mm lk ll lm mn lo lp lq in bi translated">显然，这只是对剧作家的概述:我最近开始使用这个工具，充满了选择和可能性。我在网上没有找到太多资料，所以我建议从官方文档开始:</p><ul class=""><li id="e796" class="nq nr iu kx b ky kz lb lc le ns li nt lm nu lq nv nw nx ny bi translated"><a class="ae mo" href="https://playwright.dev/docs/intro/" rel="noopener ugc nofollow" target="_blank">剧作家入门</a></li><li id="4af5" class="nq nr iu kx b ky nz lb oa le ob li oc lm od lq nv nw nx ny bi translated"><a class="ae mo" href="https://playwright.dev/docs/api/class-page" rel="noopener ugc nofollow" target="_blank">剧作家:第</a>页</li><li id="c7b6" class="nq nr iu kx b ky nz lb oa le ob li oc lm od lq nv nw nx ny bi translated">编剧:电子</li><li id="4923" class="nq nr iu kx b ky nz lb oa le ob li oc lm od lq nv nw nx ny bi translated">剧作家:电子应用</li><li id="ec7d" class="nq nr iu kx b ky nz lb oa le ob li oc lm od lq nv nw nx ny bi translated"><a class="ae mo" href="https://playwright.dev/docs/test-snapshots/" rel="noopener ugc nofollow" target="_blank">剧作家:视觉对比</a></li></ul><p id="34d6" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我发现这些存储库很有用:</p><ul class=""><li id="f924" class="nq nr iu kx b ky kz lb lc le ns li nt lm nu lq nv nw nx ny bi translated"><a class="ae mo" href="https://github.com/cawa-93/vite-electron-builder/blob/7d2df55fd8a0b3a803963d62558f719c9034ba2a/tests/app.spec.js" rel="noopener ugc nofollow" target="_blank">cawa-93/vite-electron-builder</a></li><li id="3e39" class="nq nr iu kx b ky nz lb oa le ob li oc lm od lq nv nw nx ny bi translated"><a class="ae mo" href="https://github.com/microsoft/playwright/tree/master/tests/electron" rel="noopener ugc nofollow" target="_blank">微软/剧作家—测试/电子</a></li><li id="be46" class="nq nr iu kx b ky nz lb oa le ob li oc lm od lq nv nw nx ny bi translated"><a class="ae mo" href="https://github.com/spaceagetv/electron-playwright-example" rel="noopener ugc nofollow" target="_blank">太空电视/电子-剧作家-例子</a></li></ul><p id="6d66" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">当然，还有我的模板存储库:</p><div class="oe of gq gs og oh"><a href="https://github.com/el3um4s/memento-svelte-electron-typescript" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fp"><div class="oj ab ok cl cj ol"><h2 class="bd iv gz z fq om fs ft on fv fx it bi translated">GitHub-El 3um 4s/memento-svelte-electronic-typescript:使用Svelte创建桌面应用程序的模板…</h2><div class="oo l"><h3 class="bd b gz z fq om fs ft on fv fx dk translated">模板创建一个桌面应用程序与苗条，TailwindCSS，电子和打字稿(与电子更新…</h3></div><div class="op l"><p class="bd b dl z fq om fs ft on fv fx dk translated">github.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov kt oh"/></div></div></a></div></div><div class="ab cl ne nf hy ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="in io ip iq ir"><p id="3191" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">感谢阅读！敬请关注更多内容。</p></div><div class="ab cl ne nf hy ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="in io ip iq ir"><p id="9ef0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><strong class="kx iv"> <em class="ow">不要错过我的下一篇文章—报名参加我的</em> </strong> <a class="ae mo" href="https://medium.com/subscribe/@el3um4s" rel="noopener"> <strong class="kx iv"> <em class="ow">中邮箱列表</em> </strong> </a></p><div class="oe of gq gs og oh"><a href="https://el3um4s.medium.com/membership" rel="noopener follow" target="_blank"><div class="oi ab fp"><div class="oj ab ok cl cj ol"><h2 class="bd iv gz z fq om fs ft on fv fx it bi translated">通过我的推荐链接加入Medium—Samuele</h2><div class="oo l"><h3 class="bd b gz z fq om fs ft on fv fx dk translated">阅读萨缪尔的每一个故事(以及媒体上成千上万的其他作家)。不是中等会员？在这里加入一块…</h3></div><div class="op l"><p class="bd b dl z fq om fs ft on fv fx dk translated">el3um4s.medium.com</p></div></div><div class="oq l"><div class="ox l os ot ou oq ov kt oh"/></div></div></a></div><p id="adaf" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><em class="ow">原载于【https://blog.stranianelli.com】<a class="ae mo" href="https://blog.stranianelli.com/how-to-test-electronjs-app-english/" rel="noopener ugc nofollow" target="_blank"><em class="ow"/></a></em></p></div></div>    
</body>
</html>