<html>
<head>
<title>How to Version Your Code in 2020</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在2020年发布您的代码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-version-your-code-in-2020-60bdd221278b?source=collection_archive---------2-----------------------#2020-07-08">https://betterprogramming.pub/how-to-version-your-code-in-2020-60bdd221278b?source=collection_archive---------2-----------------------#2020-07-08</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="1097" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">碰撞版本合并和更多</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/bd02333eb619e0b024647e1b950938e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G41n2RgssJI6E0LqeE75GQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者照片。</p></figure><p id="df39" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我在过去写过关于如何版本化的文章，但是事情发生了变化。这是2020年最新最棒的一次代码版本化。</p><p id="d32b" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我将假设您在本文中使用的是CI工具，示例将基于GitHub操作。但是，您应该能够轻松地将它们应用于任何CI工具。我还假设您正在使用类似git的服务，如GitHub，用于拉取请求或某种代码审查。</p><p id="8a2e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">许多现代工具现在使用git标签作为版本化代码的实际位置。版本标签的格式使用<a class="ae lv" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">语义版本</a>，遵循此方案:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="963e" class="mb mc iu lx b gz md me l mf mg">v1.2.3</span></pre><p id="56eb" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">本文将向您展示如何轻松地自动对您的代码进行版本控制。</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="9a3c" class="mo mc iu bd mp mq mr ms mt mu mv mw mx ka my kb mz kd na ke nb kg nc kh nd ne bi translated">第1步:合并时提升版本</h1><p id="6637" class="pw-post-body-paragraph kz la iu lb b lc nf jv le lf ng jy lh li nh lk ll lm ni lo lp lq nj ls lt lu in bi translated">一个开发人员提交一个拉请求(PR)，其他人审查PR，然后它被合并到您的主分支(通常是master)。在合并到主分支时，这将启动一些操作，比如修改版本号和部署代码。</p><p id="8c9a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">下面是一个GitHub动作，它可以自动获取您的最新版本，添加补丁号，标记补丁，然后推送标签:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nk nl l"/></div></figure><p id="6711" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">只要把它扔进去<code class="fe nm nn no lx b">.github/workflows/bump.yml</code>就大功告成了！如果你想知道它到底在做什么，请阅读gitbump.sh 文件。</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="580e" class="mo mc iu bd mp mq mr ms mt mu mv mw mx ka my kb mz kd na ke nb kg nc kh nd ne bi translated">步骤2:如果需要，在代码中使用新的版本号</h1><p id="79f8" class="pw-post-body-paragraph kz la iu lb b lc nf jv le lf ng jy lh li nh lk ll lm ni lo lp lq nj ls lt lu in bi translated">如果您想要使用您在步骤1中创建的版本标记(例如，在您的UI中打印版本号或者当有人键入<code class="fe nm nn no lx b">yourapp --version</code>时)，那么您需要在一些代码中替换版本号。</p><p id="bb60" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">您可以通过以下方式从您的GitHub标签获取最新版本:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="c81c" class="mb mc iu lx b gz md me l mf mg">$(git tag --sort=-v:refname --list "v[0-9]*" | head -n 1 | cut -c 2-)</span></pre><p id="005d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">要在GitHub动作中做到这一点，使用下面的代码来设置一个可以在整个过程中使用的<code class="fe nm nn no lx b">VERSION</code> env变量:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="6be6" class="mb mc iu lx b gz md me l mf mg">echo "VERSION=$(git tag --sort=-v:refname --list "v[0-9]*" | head -n 1 | cut -c 2-)" &gt;&gt; $GITHUB_ENV</span></pre><h2 id="bbfb" class="mb mc iu bd mp np nq dn mt nr ns dp mx li nt nu mz lm nv nw nb lq nx ny nd nz bi translated">更新任何文件中的版本</h2><p id="51c3" class="pw-post-body-paragraph kz la iu lb b lc nf jv le lf ng jy lh li nh lk ll lm ni lo lp lq nj ls lt lu in bi translated">如果您想自动更新文件中的某个版本，您可以使用:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="66e2" class="mb mc iu lx b gz md me l mf mg">docker run --rm -i -v $PWD:/app -w /app treeder/bump --filename index.html --replace $VERSION</span></pre><p id="237d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这将找到一个X.Y.Z格式的版本，并用新版本替换它。如果文件中有多个版本，您可以向treeder/bump传递额外的标志，使其按照您的要求工作。<a class="ae lv" href="https://github.com/treeder/bump" rel="noopener ugc nofollow" target="_blank">参见自述文件</a>。</p><h2 id="dd25" class="mb mc iu bd mp np nq dn mt nr ns dp mx li nt nu mz lm nv nw nb lq nx ny nd nz bi translated">在Go程序中更新版本</h2><p id="3796" class="pw-post-body-paragraph kz la iu lb b lc nf jv le lf ng jy lh li nh lk ll lm ni lo lp lq nj ls lt lu in bi translated">对于Go (golang)程序，您可以像这样使用构建标志(在您的主包中必须有一个<code class="fe nm nn no lx b">var Version string</code>):</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="f0fc" class="mb mc iu lx b gz md me l mf mg">go build -ldflags "-X main.Version=$VERSION"</span></pre><h2 id="c56c" class="mb mc iu bd mp np nq dn mt nr ns dp mx li nt nu mz lm nv nw nb lq nx ny nd nz bi translated">更新Docker映像的版本</h2><p id="8302" class="pw-post-body-paragraph kz la iu lb b lc nf jv le lf ng jy lh li nh lk ll lm ni lo lp lq nj ls lt lu in bi translated">要使用此新版本对Docker映像进行版本控制和推送，请执行以下操作:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="f73b" class="mb mc iu lx b gz md me l mf mg">docker build -t treeder/myimage:latest .<br/>docker tag treeder/myimage:latest treeder/myimage:$VERSION<br/>docker push treeder/myimage:$VERSION<br/>docker push treeder/myimage:latest</span></pre></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="2ca1" class="mo mc iu bd mp mq mr ms mt mu mv mw mx ka my kb mz kd na ke nb kg nc kh nd ne bi translated">结论</h1><p id="8697" class="pw-post-body-paragraph kz la iu lb b lc nf jv le lf ng jy lh li nh lk ll lm ni lo lp lq nj ls lt lu in bi translated">现在你有了它:完全自动化的版本控制，与你在git中的代码相匹配。小菜一碟，对吧？</p><p id="fcde" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果你有任何问题，请在下面的评论中告诉我。</p></div></div>    
</body>
</html>