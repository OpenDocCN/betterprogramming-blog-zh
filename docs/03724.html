<html>
<head>
<title>React Hooks Slider: How to Build an Image Slider With Autoplay</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Hooks Slider:如何用自动播放构建图像滑块</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/react-hooks-slider-how-to-build-an-image-slider-with-autoplay-part-2-c94deaf763c4?source=collection_archive---------2-----------------------#2020-03-01">https://betterprogramming.pub/react-hooks-slider-how-to-build-an-image-slider-with-autoplay-part-2-c94deaf763c4?source=collection_archive---------2-----------------------#2020-03-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2fa2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">第二部分</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9912e8a7374b6ac703ca5beae26f0c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qqpmY2AEt_e6qJuzCBDfYg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><p id="9905" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在React Hooks滑块系列的第二部分中，我们现在将在组件中构建一个自动播放功能。激活后，此功能将隐藏导航箭头，并无限循环地浏览所有图像幻灯片。</p><p id="8167" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在本文末尾提供了本系列第一部分和第三部分的链接、包含代码和工作示例的资源库以及视频教程。</p><p id="20db" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">P.S .如果你喜欢这篇文章，可以看看我在<a class="ae lu" href="https://dzuz14.medium.com/simple-file-uploading-with-react-hooks-fe89c225db57" rel="noopener">上传文件的文章，这里用钩子反应</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="be4d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">快速回顾</h1><p id="b719" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在<a class="ae lu" href="https://medium.com/better-programming/build-an-image-slider-with-react-es6-264368de68e4" rel="noopener">第1部分</a>的结尾，这是我们在<code class="fe mz na nb nc b">Slider</code>组件中结束的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="aa53" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有趣的是，我们实现自动播放功能所需的大部分代码都已经写好了。我们将利用之前构建的<code class="fe mz na nb nc b">nextSlide</code>函数，并使用几个React钩子和一个<code class="fe mz na nb nc b"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval" rel="noopener ugc nofollow" target="_blank">setInterval</a></code>来完成它。</p><p id="5a14" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请记住，我包含的任何片段都是在<code class="fe mz na nb nc b"><strong class="la iu">Slider.</strong></code>内部编写的，我们不需要接触我们之前创建的任何其他组件。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="89ca" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">useRef和useEffect挂钩</h1><p id="71d0" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">为了开始，我们将使用两个React钩子，<code class="fe mz na nb nc b"><a class="ae lu" href="https://reactjs.org/docs/hooks-reference.html#useref" rel="noopener ugc nofollow" target="_blank">useRef</a></code>和<code class="fe mz na nb nc b">useEffect</code>。通过重新渲染，<code class="fe mz na nb nc b">useRef</code>钩子将允许我们存储对包含最新状态变量的函数的引用，而<code class="fe mz na nb nc b">useEffect</code>钩子将用于确保我们的ref具有该功能。</p><p id="c173" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">基本上，他们将一前一后地工作。下面的代码片段展示了它们的实际应用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="f67b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在每次重新渲染时，我们将ref的current属性值设置为最新版本的<code class="fe mz na nb nc b">nextSlide</code>函数。我们需要做的就是利用另一个<code class="fe mz na nb nc b">useEffect</code>调用，我们100%拥有自动播放功能。很神奇，对吧？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7ad3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在初始滑块渲染上使用效果</h1><p id="8f21" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">如果你熟悉基于类的React组件，有一个叫做<code class="fe mz na nb nc b"><a class="ae lu" href="https://reactjs.org/docs/react-component.html#componentdidmount" rel="noopener ugc nofollow" target="_blank">componentDidMount</a></code>的方法，它将执行你给它的任何代码，只在初始渲染时。有了钩子，只运行一次代码也很容易，这就是我们如何完成我们的自动播放功能。</p><p id="0e6e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们需要设置某种类型的重复计时器来无限执行我们的<code class="fe mz na nb nc b">nextSlide</code>。我们可以使用JavaScript的内置<code class="fe mz na nb nc b">setInterval</code>函数来实现这一点。</p><p id="4eca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是我们的第二个<code class="fe mz na nb nc b">useEffect</code>调用的样子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="fcd3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你对着你的显示器大喊“WTF是<code class="fe mz na nb nc b">props.autoplay</code>？”别担心，我们会在最后一步添加那个道具，作为我们的锦上添花。</p><p id="b074" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将一个空数组作为第二个参数传递给<code class="fe mz na nb nc b">useEffect</code>可以确保它只运行一次。创建一个封装对<code class="fe mz na nb nc b">autoPlayRef.current</code>的调用的函数是非常重要的，因为任何在<code class="fe mz na nb nc b">useEffect</code>调用中声明的变量(只在初始渲染时装载)将总是存储在初始渲染时观察到的值<em class="nf">。</em></p><p id="0c11" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过将调用封装在函数中，<code class="fe mz na nb nc b">autoPlayRef.current</code>的初始值永远不会被存储。JavaScript就是这样工作的；在函数执行之前，函数内部的任何东西都不会被计算。</p><p id="59ea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于闭包的概念，当这个函数每次在我们的<code class="fe mz na nb nc b">setInterval</code>函数中执行时，没有引用<code class="fe mz na nb nc b">autoPlayRef</code>是什么。因此，JS将在调用<code class="fe mz na nb nc b">useEffect</code>的范围之外检查它，其中<code class="fe mz na nb nc b">autoPlayRef.current</code>总是最新的。</p><p id="56ae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好吧，让我们创造我刚才说的那个道具。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="366e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置自动播放道具</h1><p id="cb18" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在我们的<code class="fe mz na nb nc b">index.js</code>文件中，我们将设置一个<code class="fe mz na nb nc b">autoPlay</code>属性，并向它传递一个常规整数，该整数代表我们希望在幻灯片切换之间传递的秒数。</p><p id="d73e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于<code class="fe mz na nb nc b">setInterval</code>需要毫秒值，我们在初始渲染调用<code class="fe mz na nb nc b">useEffect</code>中将<code class="fe mz na nb nc b">props.autoPlay</code>乘以1000。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="20a1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Tada！我们完了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="edd0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">图像滑块摘要</h1><p id="60b4" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在我为图像滑块编写自动播放功能之前，我认为它需要比我们这里多得多的代码。正如您所看到的，React钩子提供了一种很好的方式来完成这项工作。</p><p id="20eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请查看下面的视频和链接。这是第2部分滑块的最终版本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6b23" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">链接</h1><p id="7ea3" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">第一部分。<a class="ae lu" href="https://medium.com/better-programming/build-an-image-slider-with-react-es6-264368de68e4" rel="noopener"> React Hooks Slider:如何用React Hooks构建图像滑块</a></p><p id="edf4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第三部分。<a class="ae lu" href="https://medium.com/p/8a99859ac471/edit" rel="noopener"> React Hooks Slider:如何构建一个平滑过渡和自动调整大小的图像滑块</a></p><p id="052b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae lu" href="https://github.com/DZuz14/react-hooks-image-slider" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng ne l"/></div></figure></div></div>    
</body>
</html>