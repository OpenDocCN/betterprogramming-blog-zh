<html>
<head>
<title>Implement a Service-Oriented Architecture in Swift 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Swift 5中实施面向服务的架构</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/implement-a-service-oriented-architecture-in-swift-5-fc70b8117616?source=collection_archive---------1-----------------------#2020-01-24">https://betterprogramming.pub/implement-a-service-oriented-architecture-in-swift-5-fc70b8117616?source=collection_archive---------1-----------------------#2020-01-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9a14" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为什么只用MVC/MVVM/蝰蛇还不够</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6e71387184904364719800a04fea18a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9DgB26T5qRTtG__q"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">丘特尔斯纳普</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="466f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="f30d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为什么仅仅用<a class="ae ky" href="https://medium.com/better-programming/this-is-how-you-implement-mvc-architecture-in-2020-b39d65b4212f" rel="noopener"> MVC </a>、<a class="ae ky" href="https://medium.com/better-programming/reactive-mvvm-and-the-coordinator-pattern-done-right-88248baf8ca5" rel="noopener"> MVVM </a>、<a class="ae ky" href="https://medium.com/better-programming/implement-a-model-view-presenter-architecture-in-swift-5-dfa21bbb8e0b" rel="noopener"> MVP </a>，或者<a class="ae ky" href="https://medium.com/better-programming/how-to-implement-viper-architecture-in-your-ios-app-rest-api-and-kingfisher-f494a0891c43" rel="noopener">蝰蛇</a>还不够？这些架构模式只处理应用程序的高层(UI)。但是通常，您还必须实现网络管理器、API客户端、数据源、持久性容器等等。面向服务的体系结构通过构建高层和低层实现之间的交互，使您的生活更加轻松。</p><p id="2fef" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文中，我将向您展示如何实现面向服务的架构(SOA)。我是通过使用我为我的<a class="ae ky" href="https://medium.com/better-programming/how-to-implement-viper-architecture-in-your-ios-app-rest-api-and-kingfisher-f494a0891c43" rel="noopener"> VIPER片段</a>创建的一个<a class="ae ky" href="https://github.com/zafarivaev/VIPER-Demo-App" rel="noopener ugc nofollow" target="_blank">演示应用</a>并根据SOA建议重构它来做到这一点的。</p><p id="40b7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该项目的源代码可在GitHub 上获得<a class="ae ky" href="https://github.com/zafarivaev/SOA-Demo-App" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="c7fa" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">项目结构</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/32852c572bc61fe948bd20b83cc0b3fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*WM_j93Ytz8gN6hXgMd6XZg.png"/></div></figure><p id="4a7d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">项目的根分为三个文件夹:<code class="fe nf ng nh ni b">Classes</code>、<code class="fe nf ng nh ni b">Resources</code>和<code class="fe nf ng nh ni b">Supporting Files</code>。<code class="fe nf ng nh ni b">Resources</code>文件夹包含<code class="fe nf ng nh ni b">Assets.xcassets</code>、<em class="nj">、T30，<code class="fe nf ng nh ni b">Supporting Files</code>文件夹包含<code class="fe nf ng nh ni b">LaunchScreen.storyboard</code>和<code class="fe nf ng nh ni b">Info.plist</code>。</em></p><p id="c27f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如您所见，在<code class="fe nf ng nh ni b">Classes</code>中，我们有以下文件夹:</p><ul class=""><li id="926a" class="nk nl it lt b lu mn lx mo ma nm me nn mi no mm np nq nr ns bi translated"><code class="fe nf ng nh ni b">ApplicationLayer</code> <strong class="lt iu"> </strong>文件夹包含了<code class="fe nf ng nh ni b">AppDelegate.swift</code>文件</li><li id="e1df" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated"><code class="fe nf ng nh ni b">PresentationLayer</code>文件夹有两个VIPER模块:<code class="fe nf ng nh ni b">Quotes</code>和<code class="fe nf ng nh ni b">QuoteDetail</code></li><li id="94b9" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated"><code class="fe nf ng nh ni b">BusinessLogicLayer</code> <strong class="lt iu"> </strong>文件夹包含<code class="fe nf ng nh ni b">Services</code>和<code class="fe nf ng nh ni b">Entities</code>【也就是MV(X)中的<em class="nj">车型</em></li><li id="b4c7" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated"><code class="fe nf ng nh ni b">Services</code> <strong class="lt iu"> </strong>文件夹有三个我们在app中使用的服务:<code class="fe nf ng nh ni b">QuoteService</code>，从API中获取报价；<code class="fe nf ng nh ni b">KingfisherService</code>，从URL获取图像数据；以及<code class="fe nf ng nh ni b">ImageDataService</code>，其从该数据生成图像</li><li id="8ab2" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated"><code class="fe nf ng nh ni b">CoreLayer</code>文件夹包含我们使用服务需要的所有助手文件:<code class="fe nf ng nh ni b">ApiUrls</code>、请求配置器和网络客户机</li></ul></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="ad3d" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">定义服务</h1><p id="abcf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">首先，我们需要提供一个服务的基本功能，它将在未来被特定的服务所子类化:</p><h2 id="935e" class="ny la it bd lb nz oa dn lf ob oc dp lj ma od oe ll me of og ln mi oh oi lp oj bi translated"><strong class="ak"> Service.swift </strong></h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="acc2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">每个服务必须有一个唯一的<code class="fe nf ng nh ni b">serviceName</code>和一个<code class="fe nf ng nh ni b">register()</code>方法。</p><p id="ddb5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">通过使用<code class="fe nf ng nh ni b">ServiceRegistryImplementation</code>，我们将在<code class="fe nf ng nh ni b">AppDelegate.swift</code>中注册我们的服务。</p><p id="570e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">完成基本实现后，现在我们准备为我们的应用程序定义特定的服务。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="e723" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">报价服务</h1><p id="37b1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">该服务负责从API获取报价。</p><p id="21d6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们是这样定义的:</p><h2 id="a87d" class="ny la it bd lb nz oa dn lf ob oc dp lj ma od oe ll me of og ln mi oh oi lp oj bi translated">QuoteService.swift </h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="721b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在<code class="fe nf ng nh ni b">QuoteService</code>的<code class="fe nf ng nh ni b">extension</code>中，我们实现了实际的组网:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="adc5" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">翠鸟服务</h1><p id="c87d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">该服务负责从URL获取图像数据。</p><p id="ef95" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">其定义与<code class="fe nf ng nh ni b">QuoteService</code>类似:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="800d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在<code class="fe nf ng nh ni b">KingfisherService</code>的<code class="fe nf ng nh ni b">extension</code>中，我们实现图像数据下载:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="4752" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">图像数据服务</h1><p id="7253" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe nf ng nh ni b">ImageDataService</code>给定<code class="fe nf ng nh ni b">Data</code>时提供一个<code class="fe nf ng nh ni b">UIImage</code>。</p><p id="5944" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">是的，没有惊喜。我们使用类似的实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="8505" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在扩展中实现的数据到图像的转换:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="9c1e" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">注册服务</h1><p id="b020" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了在应用程序中使用服务，我们在<code class="fe nf ng nh ni b">AppDelegate</code>中定义了一个<code class="fe nf ng nh ni b">ServiceRegistryImplementation</code>:</p><h2 id="a637" class="ny la it bd lb nz oa dn lf ob oc dp lj ma od oe ll me of og ln mi oh oi lp oj bi translated"><strong class="ak"> AppDelegate.swift </strong></h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="5005" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">使用服务</h1><p id="f997" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们看看如何使用<code class="fe nf ng nh ni b">QuoteService</code>来获取要在<code class="fe nf ng nh ni b">QuotesViewController</code>中显示的报价列表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="6ad3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您不熟悉<a class="ae ky" href="https://medium.com/better-programming/how-to-implement-viper-architecture-in-your-ios-app-rest-api-and-kingfisher-f494a0891c43" rel="noopener"> VIPER架构</a>，只需知道<code class="fe nf ng nh ni b">QuotesInteractor</code>通过将<code class="fe nf ng nh ni b">QuoteService</code>作为依赖项传递并调用其<code class="fe nf ng nh ni b">getQuotes</code>方法来处理与报价屏幕相关的所有业务逻辑。如果你遵循MVC架构，或者在<a class="ae ky" href="https://medium.com/better-programming/reactive-mvvm-and-the-coordinator-pattern-done-right-88248baf8ca5" rel="noopener"> MVVM </a>的情况下遵循<code class="fe nf ng nh ni b">ViewModel</code>，你可以在<code class="fe nf ng nh ni b">UIViewController</code>中调用相同的方法。</p><p id="ef16" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">类似地，这就是我们如何使用<code class="fe nf ng nh ni b">KingfisherService</code>在<code class="fe nf ng nh ni b">QuotesDetailViewController</code>中显示角色的图像:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="ce8c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe nf ng nh ni b">ImageDataService</code>的用法也很简单，但与VIPER有些细微差别:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="ebb5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在VIPER中，<code class="fe nf ng nh ni b">Presenter</code>负责从<code class="fe nf ng nh ni b">Interactor</code>接收业务操作的结果，将其准备成UI可显示的格式，并将其转发给<code class="fe nf ng nh ni b">ViewController </code>——它实现了<code class="fe nf ng nh ni b">InteractorToPresenterQuoteDetailProtocol</code>。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="58fb" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">包扎</h1><p id="1eaa" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果您对其他人如何实现面向服务的架构感到好奇，可以考虑查看这些资源:<a class="ae ky" href="https://itnext.io/service-oriented-architecture-in-swift-362dc454fc09" rel="noopener ugc nofollow" target="_blank">Swift中的SOA</a>，<a class="ae ky" href="https://github.com/mvalentiner/SOA-Services" rel="noopener ugc nofollow" target="_blank"> SOA-Services </a>。</p><p id="ebf3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你对不同的建筑模式感到好奇，请随意查看我的其他相关作品:</p><div class="om on gp gr oo op"><a href="https://medium.com/better-programming/reactive-mvvm-and-the-coordinator-pattern-done-right-88248baf8ca5" rel="noopener follow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">反应式MVVM和协调模式做对了</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">使用Swift 5、RxSwift和RxDataSources</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">medium.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd ks op"/></div></div></a></div><div class="om on gp gr oo op"><a href="https://medium.com/better-programming/how-to-implement-viper-architecture-in-your-ios-app-rest-api-and-kingfisher-f494a0891c43" rel="noopener follow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">如何使用Swift 5在您的iOS应用中实现VIPER架构</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">使用方便的Xcode模板和参考报告</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">medium.com</p></div></div><div class="oy l"><div class="pe l pa pb pc oy pd ks op"/></div></div></a></div><div class="om on gp gr oo op"><a href="https://medium.com/better-programming/this-is-how-you-implement-mvc-architecture-in-2020-b39d65b4212f" rel="noopener follow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">新MVC:单一责任原则和委托</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">苹果的模型视图控制器，终于做对了</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">medium.com</p></div></div><div class="oy l"><div class="pf l pa pb pc oy pd ks op"/></div></div></a></div><div class="om on gp gr oo op"><a href="https://medium.com/better-programming/implement-a-model-view-presenter-architecture-in-swift-5-dfa21bbb8e0b" rel="noopener follow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">在Swift 5中实施模型-视图-演示者架构</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">使用领域数据库作为业务逻辑层</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">medium.com</p></div></div><div class="oy l"><div class="pg l pa pb pc oy pd ks op"/></div></div></a></div><p id="c45d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">非常感谢您的阅读！</p></div></div>    
</body>
</html>