<html>
<head>
<title>Detecting NFT Front Running with Graph Algorithms</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用图算法检测NFT前沿</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/detecting-nft-front-running-with-graph-algorithms-3fddadbff4a7?source=collection_archive---------6-----------------------#2021-12-02">https://betterprogramming.pub/detecting-nft-front-running-with-graph-algorithms-3fddadbff4a7?source=collection_archive---------6-----------------------#2021-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="31db" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对加密数据的精细深入研究</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f77ae823fd714dbb67856a996a818341.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*z59CIN3DoGvmzCUz"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">艾莉娜·格鲁布尼亚克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="358a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我之前的帖子中，我分享了一个例子，说明如何使用加密数据来<a class="ae ky" href="https://towardsdatascience.com/the-data-behind-the-nft-hype-32f6f92c27cb" rel="noopener" target="_blank">理解NFT生态系统的宏观进化</a>。在本帖中，我们将通过用图形算法检测NFT前端运行，进行一次粒度用户级分析。</p><p id="83d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我所说的NFT抢先一步的一些背景:2021年9月，NFT市场Opensea的产品负责人Nate Chastain被发现<a class="ae ky" href="https://twitter.com/0xZuwu/status/1437921263394115584" rel="noopener ugc nofollow" target="_blank">在NFT出现在Opensea主页之前购买了它们，并在之后立即出售以获取利润。他利用内部信息，即NFT将被Opensea推广的信息，获得不公平的优势。这是一个有事业心的人发现的</a></p><ol class=""><li id="443f" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">利用内特拥有NFT 3501号密码朋克的事实，确定了他的主要钱包</li><li id="7045" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">追踪资金从这个主钱包流向他的一次性钱包，一次性钱包通过买卖NFT获利，最终将利润返还给主钱包</li><li id="fdf1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将NFT的交易时间戳与Opensea的有问题的NFTs的首页促销时间戳相匹配</li></ol><p id="31c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个人通过在Etherscan上倾倒交易来手动完成大部分分析，这非常耗时，并且很可能错过了至少一些发生类似行为的实例。</p><p id="b140" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过<a class="ae ky" href="https://towardsdatascience.com/what-is-crypto-data-fef70ecadf7b" rel="noopener" target="_blank">加密数据</a>实现的透明性，我们可以使用图形算法系统地识别这种行为，通过识别这种类型的前置运行的签名是</p><ol class=""><li id="3511" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">从主钱包到一个或多个一次性钱包的一系列资金转移，意在掩盖演员的真实身份</li><li id="0b76" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在短时间内购买NFT，然后出售NFT以获取利润——表明知道价格即将上涨</li><li id="e70f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将一次性钱包中的利润返还给主钱包</li></ol><p id="895b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们将数据建模为一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Multigraph#:~:text=A%20multidigraph%20is%20a%20directed,directed%20edges%2C%20arcs%20or%20arrows." rel="noopener ugc nofollow" target="_blank">定向多图</a>，其中节点是用户钱包和智能合约地址，边是资金转移和NFT购买/销售，那么我们可以使用<a class="ae ky" href="https://en.wikipedia.org/wiki/Cycle_(graph_theory)" rel="noopener ugc nofollow" target="_blank">周期检测算法</a>来寻找这个特定的签名。这不仅实现了对Nate参与抢注的所有时间的系统回顾，还实现了在未来主动监控和监管这种行为的方法。</p><p id="7d8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检测算法的实现可在本报告中找到。该算法的主要工具是<code class="fe mj mk ml mm b">find_cycles</code>函数:</p><pre class="kj kk kl km gt mn mm mo mp aw mq bi"><span id="5744" class="mr ms it mm b gy mt mu l mv mw"># find all nodes that are n degrees removed from a given node u in the graph G<br/>def findPaths(G,u,n):<br/>    if n==0:<br/>        return [[u]]<br/>    paths = [[u]+path for neighbor in G.neighbors(u) for path in findPaths(G,neighbor,n-1)]<br/>    return paths</span><span id="d9b7" class="mr ms it mm b gy mx mu l mv mw"># find all nodes that are n degrees removed from a given node u in the graph G, which form a closed cycle<br/>def find_cycles(G,u,n):<br/>    paths = findPaths(G,u,n)<br/>    return [tuple(path) for path in paths if (path[-1] == u) and sum(x ==u for x in path) == 2]</span></pre><p id="ae78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">…以及可疑会话匹配循环:</p><pre class="kj kk kl km gt mn mm mo mp aw mq bi"><span id="1021" class="mr ms it mm b gy mt mu l mv mw">session_active = False<br/>suspicision_sessions = []<br/>session_id = 0</span><span id="1c0f" class="mr ms it mm b gy mx mu l mv mw">session_holder = []<br/>nate_outflow = 0<br/>nate_inflow = 0<br/>opensea_buy = False<br/>opensea_sell = False</span><span id="b648" class="mr ms it mm b gy mx mu l mv mw">def reset_session():<br/>    global session_holder<br/>    global nate_outflow<br/>    global nate_inflow<br/>    global opensea_buy<br/>    global opensea_sell<br/>    if (nate_outflow &gt; 0 and nate_inflow &gt; 0 and opensea_buy and opensea_sell):<br/>        suspicision_sessions.append(copy.deepcopy(session_holder))<br/>    session_holder = []<br/>    nate_outflow = 0<br/>    nate_inflow = 0<br/>    opensea_buy = False<br/>    opensea_sell = False</span><span id="0d0c" class="mr ms it mm b gy mx mu l mv mw">progress_counter = 0</span><span id="7b19" class="mr ms it mm b gy mx mu l mv mw">for size in [2, 3]:<br/>    cycles = find_cycles(G,'0xa3a4548b39da96eb065ff91811ca30da40431c0d', size)<br/>    for c in cycles:<br/>        if '0x7be8076f4ea4a4ad08075c2508e481d6c946d12b' not in c:<br/>            progress_counter += 1<br/>            if (progress_counter %5 == 0):<br/>                print(progress_counter)<br/>            reset_session()<br/>            prev_time = pendulum.now()<br/>            sub = list(G.subgraph(list(c) + ['0x7be8076f4ea4a4ad08075c2508e481d6c946d12b']).edges(data=True))<br/>            sub.sort(key=lambda x: x[2]['block_timestamp'])</span><span id="217a" class="mr ms it mm b gy mx mu l mv mw">for e in sub:<br/>                cur_time = pendulum.parse(e[2]['block_timestamp'][0:-5])<br/>                diff_time = (cur_time - prev_time).in_hours()</span><span id="d947" class="mr ms it mm b gy mx mu l mv mw">if not session_active and map_node(e[0]) == 'Nate':<br/>                    session_active = True<br/>                    session_holder.append(e)<br/>                    session_id += 1<br/>                    nate_outflow += e[2]['value']/1e18<br/>                elif session_active and diff_time &gt; 36:<br/>                    if map_node(e[0]) == 'Nate':<br/>                        reset_session()<br/>                        session_holder.append(e)<br/>                        session_id += 1<br/>                        nate_outflow += e[2]['value']/1e18<br/>                    else:<br/>                        reset_session()<br/>                        session_active = False<br/>                elif session_active:<br/>                    session_holder.append(e)<br/>                    if map_node(e[0]) == 'Nate':<br/>                        nate_outflow += e[2]['value']/1e18<br/>                    elif map_node(e[1]) == 'Nate':<br/>                        nate_inflow += e[2]['value']/1e18<br/>                    elif map_node(e[0]) == 'Opensea Exchange':<br/>                        opensea_sell = True<br/>                    elif map_node(e[1]) == 'Opensea Exchange':<br/>                        opensea_buy = True</span><span id="9ba1" class="mr ms it mm b gy mx mu l mv mw">prev_time = cur_time</span><span id="f652" class="mr ms it mm b gy mx mu l mv mw">print('{} suspicious sessions found'.format(len(suspicision_sessions)))</span></pre><p id="20ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用简单的英语来说，它会执行以下操作:</p><ol class=""><li id="95b0" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">在图G中找到涉及Nate的主钱包的闭合循环，图G包含与Nate的主钱包相差3度或更小的所有交易和地址——这些循环是至少匹配前端运行签名的资金转移部分的候选循环</li><li id="6b86" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">对于每个周期，生成一个子图，只包含周期中的节点和Opensea交换节点——这使我们能够寻找任何与资金转移周期一致的可疑NFT交易</li><li id="f104" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">按时间顺序遍历每个子图中的活动(或边),标记任何会话(定义为连续活动之间少于36小时),该会话以连续顺序匹配1)从主钱包到一次性钱包的资金转移，2)购买后销售获利，3)资金转移回主钱包的完整前端运行签名。</li></ol><p id="2703" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">利用这种算法，我们发现了17种不同的情况，内特的主钱包可能与一种领先模式相关联。其中最早的一次发生在2021年5月7日，比现在臭名昭著的Twitter帖子中标记的2021年9月14日的例子早了4个多月。</p><p id="cb8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，Nate将0.035ETH转移到一个一次性账户，以0ETH的价格(仅支付汽油费)购买了<a class="ae ky" href="https://opensea.io/assets/0x495f947276749ce646f68ac8c248420045cb7b5e/19707794715962039650013670819326392846345927146224565303908839162091770216449" rel="noopener ugc nofollow" target="_blank">这辆NFT </a>，不到5小时后以0.263ETH的价格出售，然后在出售后不到30分钟将0.124ETH的利润转移回他的主账户。虽然我没有Opensea在NFT的推广时间表，但我强烈怀疑，鉴于买卖之间的短暂时间，内特知道价格上涨。按时间顺序排列的这一系列活动如下所示:</p><pre class="kj kk kl km gt mn mm mo mp aw mq bi"><span id="3cf1" class="mr ms it mm b gy mt mu l mv mw">2021-05-07T21:47:44 Nate -&gt; 0x3ff308e7b0dfc0724900be69d61c71395dbce97a, transfer 0.035ETH</span><span id="1d08" class="mr ms it mm b gy mx mu l mv mw">2021-05-07T21:49:37 0x3ff308e7b0dfc0724900be69d61c71395dbce97a -&gt; Opensea Exchange, bought OpenSea Shared Storefront-19707794715962039650013670819326392846345927146224565303908839162091770216449 for 0.000ETH</span><span id="d62c" class="mr ms it mm b gy mx mu l mv mw">2021-05-08T03:42:13 Opensea Exchange -&gt; 0x3ff308e7b0dfc0724900be69d61c71395dbce97a, sold OpenSea Shared Storefront-19707794715962039650013670819326392846345927146224565303908839162091770216449 for 0.263ETH</span><span id="032f" class="mr ms it mm b gy mx mu l mv mw">2021-05-08T04:10:19 0x3ff308e7b0dfc0724900be69d61c71395dbce97a -&gt; Nate, transfer 0.124ETH</span></pre><p id="ce5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用D3.js，我们可以创建图形等价物，更直观地描述这里检测到的前端运行签名。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/3e9dca263b691f65acbd184ecceb47e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_4DtVdHG5_o48iOIK_3GaQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">已知最早的NFT前线跑步链接到内特的主钱包-作者图片</p></figure><p id="bcaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是几个月后发生的另外两个例子，涉及到一个稍微复杂一点的计划，有两个一次性钱包，和更多的以太币。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/70234cdaa6277364b7b9a6241daeefa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4lPj8KO8_hawNRyIuWigOQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">NFT领先的实例链接到内特的主钱包-图片由作者提供</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/6ce7313ca5f4143f60eaf4995d0cbf98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xo1ZHZtKQpz_JziWw3rTqA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">NFT领先的实例链接到内特的主钱包-图片由作者提供</p></figure><p id="e6c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这三种情况下，快速买入和卖出的特征，以及随之而来的利润回流都非常明显。我将避免在这里复制所有17个实例——鼓励好奇的读者亲自查看回购中的数据和代码。有关如何创建该可视化的详细信息，请查看<a class="ae ky" href="https://github.com/yifeihuang/nft-frontrunning" rel="noopener ugc nofollow" target="_blank">完整报告</a>中的示例。</p><h1 id="bd51" class="nb ms it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">结束语</h1><p id="ff39" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">我的意图不是重新提起内特的可疑行为。相反，它表明加密数据带来的透明性是一种强大的工具，可以在生态系统参与者之间加强更大程度的问责制和公平性。Opensea或任何人现在都可以利用这种算法来监控可疑的交易行为，并标记违规的用户钱包。我们可能无法完全阻止不良行为者，但我们可以通过从数据中学习和增加工具来更好地打击和监管他们。这种通过数据不断学习和改善生态系统的能力是Crypto如此令人兴奋的原因。</p><p id="8789" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望这是一次有用的讨论，我已经帮助你对加密数据的应用有了更好的直觉。在我的下一篇文章中，我将探索索拉纳区块链和它的数据耗尽。如果你想在帖子发布时得到通知，请务必点击电子邮件图标进行订阅。</p><p id="fc96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nx">一如既往，感谢您的阅读，如果您对我想写的内容有任何问题或建议，请随时联系我。</em> <a class="ae ky" href="https://twitter.com/yifei_huang" rel="noopener ugc nofollow" target="_blank"> <em class="nx">推特</em> </a> <em class="nx"> | </em> <a class="ae ky" href="https://www.linkedin.com/in/yifeihuangdatascience/" rel="noopener ugc nofollow" target="_blank"> <em class="nx">领英</em> </a></p></div></div>    
</body>
</html>