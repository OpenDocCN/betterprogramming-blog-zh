<html>
<head>
<title>Extracting REST API Data Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python提取REST API数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/extracting-rest-api-data-using-python-with-an-example-e800b03bb62e?source=collection_archive---------3-----------------------#2022-01-10">https://betterprogramming.pub/extracting-rest-api-data-using-python-with-an-example-e800b03bb62e?source=collection_archive---------3-----------------------#2022-01-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="868a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Polygon.io获取所有可用的股票报价机</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0d46ea614e679c951310e8cc73d882bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RVPRxqz2VUuY7NGXSXzmtw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://unsplash.com/@kmuza" rel="noopener ugc nofollow" target="_blank">卡洛斯·穆扎</a>在<a class="ae kv" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="9483" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与传统观点相反，数据不一定是新数字经济的润滑油，至少原始数据不是。REST APIs旨在弥合原始信息和结构化数据之间的鸿沟。</p><p id="f6e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，我将解释如何使用Python的请求库提取数据，并提供一个补充示例。</p><p id="c463" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我开始我的数据科学之旅时，<a class="ae kv" href="https://www.kaggle.com/" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>和<a class="ae kv" href="https://archive.ics.uci.edu/ml/index.php" rel="noopener ugc nofollow" target="_blank"> UC Irvine机器学习库</a>是我的主要数据来源。然而，API提供了更多可定制的、精确的和相关的数据。例如，如果你想从雅虎财经的筛选程序中提取财务指标，雅虎财经有自己的REST API。同样，如果你想收集你最喜欢的艺术家或有影响力的人的推文，不用再找了。Twitter为开发者提供API！然而，许多REST APIs并不是免费的，并且经常有限制和成本。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="937c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">图书馆</h1><p id="3357" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Python3安装了内置库，这些库将数据提取、处理和结构化简化为几行代码。让我们导入下面的代码块。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="a825" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">示例使用案例</h1><h2 id="27d6" class="nd ma iq bd mb ne nf dn mf ng nh dp mj lf ni nj ml lj nk nl mn ln nm nn mp no bi translated">使用Polygon.io提取股票行情</h2><p id="0de2" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">本文的重点不是建议或推广某个特定的API。为了举例说明API提取方法，我认为Polygon.io适合本教程。</p><p id="5c42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的目标是提取Polygon.io上所有可用的普通股票报价机。</p><h1 id="d397" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">定价</h1><p id="22ab" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在我们开始数据提取之前，我们应该始终分析定价页面并探索免费层的局限性。在早期的原型、开发或数据提取阶段，对文档和响应对象有所了解是很重要的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/ba58ed48b2998cabf16aaa42a2ba1d4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6BkDDt38kr5M0u9ibRB8DQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">截图来自<a class="ae kv" href="https://polygon.io/pricing" rel="noopener ugc nofollow" target="_blank"> Polygon.io </a></p></figure><p id="1228" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完美！似乎没有每天通话的限制，但我们在免费层每分钟只能打5次电话。</p><h1 id="219f" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">证明文件</h1><p id="97cc" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">接下来，我们将寻找提供我们需要的数据的端点。在跑马灯提取的情况下，<code class="fe nq nr ns nt b">GET /v3/reference/tickers</code> <strong class="ky ir"> </strong>端点似乎适合我们的任务。</p><p id="c153" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">10个查询参数帮助我们过滤响应数据，并返回各种ticker属性和元数据。我强烈建议观众探索这个<a class="ae kv" href="https://polygon.io/docs/stocks/get_v3_reference_tickers" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">链接</strong> </a>来了解更多关于端点的信息。</p><h1 id="e0ed" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">API密钥</h1><p id="5bdd" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如果您还没有使用Polygon.io创建帐户，您必须这样做才能发出请求。您将获得一个API密钥，不要与公众分享。</p><p id="df0f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通常，您不希望将API密钥存储在客户端代码中，但是为了简单起见，它将包含在同一个程序中。要了解如何保护您的密钥，请查看这篇简单而信息丰富的文章<a class="ae kv" href="https://medium.com/black-tech-diva/hide-your-api-keys-7635e181a06c" rel="noopener"/>！</p><h1 id="ab6c" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">提取功能</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="1324" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请求函数本身相当简单，仅由URL和查询参数组成。但是，由于每页1000个报价器的限制，我们必须使用<code class="fe nq nr ns nt b">next_url</code> <strong class="ky ir"> </strong>响应属性来获取下一页的信息。</p><p id="f84c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，<strong class="ky ir"> </strong>时间库<strong class="ky ir"> </strong>允许我们根据API请求限制执行请求。在我们的例子中，我们在代码中触发一个“睡眠”来适应每分钟5次调用的限制。</p><h1 id="7e0a" class="lz ma iq bd mb mc my me mf mg mz mi mj jw na jx ml jz nb ka mn kc nc kd mp mq bi translated">写出数据</h1><p id="f837" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我将展示两种写出数据的流行方法，这样用户就可以在自己的桌面/文件夹上访问数据。</p><ol class=""><li id="5735" class="nu nv iq ky b kz la lc ld lf nw lj nx ln ny lr nz oa ob oc bi translated">使用<code class="fe nq nr ns nt b">Pandas</code>库写出一个<code class="fe nq nr ns nt b">.csv</code> <strong class="ky ir"> </strong>文件。</li><li id="852e" class="nu nv iq ky b kz od lc oe lf of lj og ln oh lr nz oa ob oc bi translated">利用<code class="fe nq nr ns nt b">JSON</code>库写出一个<code class="fe nq nr ns nt b">.txt</code> <strong class="ky ir"> </strong>文件。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="5e43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们必须首先调用提取函数并用返回的数据初始化一个变量。要写出CSV文件，必须将响应转换成Pandas数据帧，然后利用<code class="fe nq nr ns nt b">.to_csv()</code>方法。</p><p id="a803" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要写成文本文件，我们必须使用<code class="fe nq nr ns nt b">json.dump()</code>方法。</p><p id="a078" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果输出应该如下所示:</p><h2 id="0b5c" class="nd ma iq bd mb ne nf dn mf ng nh dp mj lf ni nj ml lj nk nl mn ln nm nn mp no bi translated">CSV文件</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/b5ab60160276f880fe978d393527d248.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wpfVcJYS9fWEiNRrSfvEbA.png"/></div></div></figure><h2 id="da38" class="nd ma iq bd mb ne nf dn mf ng nh dp mj lf ni nj ml lj nk nl mn ln nm nn mp no bi translated">文本文件</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/3230f44c91a39e737d663eff9bd88c30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*1Q-x4Y0v-F7essFWcNPffA.png"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="ac74" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="4146" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这总结了使用Python提取REST API数据的基础。</p><p id="8134" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你需要一个适合你特殊兴趣或项目的数据集，公共API通常是可用的。</p><p id="020e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管请记住，数据集越是专有和有价值，其成本和局限性就越高。</p></div></div>    
</body>
</html>