<html>
<head>
<title>Safely Keep Your Application Secrets in Repos Even if They’re Public Using Git-Crypt</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Git-Crypt在Repos中安全地保存您的应用程序秘密，即使它们是公开的</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/safely-keep-your-application-secrets-in-repos-even-if-theyre-public-using-git-crypt-735d74b011bd?source=collection_archive---------10-----------------------#2020-11-03">https://betterprogramming.pub/safely-keep-your-application-secrets-in-repos-even-if-theyre-public-using-git-crypt-735d74b011bd?source=collection_archive---------10-----------------------#2020-11-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cce5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">秘密处理的另一种方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a3ec4a486a4bf2ba2492339b442d39d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*byiJBkn81pa-bZi4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">斯科特·韦伯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="976e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多软件项目使用秘密，通常是外部API的密钥或凭证来访问外部资源，如数据库。您的应用程序在运行时需要这些密钥，因此您需要能够在部署应用程序时提供它们，或者作为准备部署环境的一个步骤。</p><p id="dae4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示如何使用<a class="ae ky" href="https://github.com/AGWA/git-crypt" rel="noopener ugc nofollow" target="_blank"> git-crypt </a>，以便您可以安全地将您的应用程序秘密保存在您的源代码库中——即使它们是公开的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="86ff" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">应用程序机密的问题是</h1><p id="c24f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">大多数项目都有某种秘密密钥或凭证。例如，如果您的应用程序托管在<a class="ae ky" href="https://www.heroku.com" rel="noopener ugc nofollow" target="_blank"> Heroku </a>上，您可以使用如下命令向Heroku应用程序提供一个API密钥:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="bd79" class="ne md it na b gy nf ng l nh ni">$ heroku config:set API_KEY=my-sooper-sekrit-api-key</span></pre><p id="0d84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过在(重新)部署应用程序之前运行这个命令，您可以在运行时给它一个名为<code class="fe nk nl nm na b">API_KEY</code>的环境变量<em class="nj">和值<code class="fe nk nl nm na b">my-sooper-sekrit-api-key</code>。然而，在Heroku的</em>之外(或者您部署应用程序的任何地方)跟踪这些秘密值<em class="nj">仍然是一个挑战。</em></p><p id="53b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我总是试图设置我的项目，以便我可以运行一个命令来从头开始部署它们，而不需要任何单独的手动步骤。对于我们的例子，这意味着我需要将值<code class="fe nk nl nm na b">my-sooper-sekrit-api-key</code> <em class="nj">存储在某个地方</em>，以便我的部署代码可以使用它(在本例中，运行上面的<code class="fe nk nl nm na b">heroku config:set...</code>命令)。</p><p id="229f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的项目源代码总是存储在Git中，通常托管在GitHub、Bitbucket或其他一些源代码托管服务上。我<em class="nj">可以</em>在我的源代码库中存储我的<code class="fe nk nl nm na b">API_KEY</code>值。然而，这也有一些缺点:</p><ul class=""><li id="a4a7" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">我不能和任何人分享我的知识库，除非我对他们访问我的秘密感到舒服。这意味着我所有包含秘密的应用程序存储库都必须是私有的。</li><li id="c2ea" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">据推测，GitHub/bit bucket/anywhere的许多工作人员也会接触到我的秘密，这我可能会不同意(取决于秘密)。</li><li id="73f1" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">如果我后来选择公开，很容易忘记私有存储库中的秘密。所以我可能会不小心泄露重要的秘密。</li></ul><p id="cdfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我可以将我的秘密存储在与我的应用程序源代码分开的地方，但是这有它自己的问题:</p><ul class=""><li id="2280" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">我需要一种方法从部署时或部署前存储的任何地方获取我的秘密，并允许我的部署代码访问它们。</li><li id="e936" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">我的秘密可能没有我的源代码存储得那么可靠。例如，我可以将秘密保存在笔记本电脑上的一个<code class="fe nk nl nm na b">.env</code>文件中，并确保我永远不会将它签入Git存储库。但是，如果我丢失了该文件(例如，如果我的笔记本电脑损坏/被盗)，那么我也就失去了那个秘密。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b769" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">git-crypt</h1><p id="30c9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Git-crypt旨在解决这个问题，每当您将秘密推送到您的Git存储库时对它们进行加密，每当您取出它们时对它们进行解密。从你的角度来看，这是显而易见的。因此，就您和您的部署代码而言，这些秘密是明文形式的，但是其他人无法阅读它们——即使您的源代码在公共GitHub存储库中。</p><p id="2b16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一个例子。</p><h2 id="3955" class="ne md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated">1.安装git-crypt</h2><p id="fe20" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在<a class="ae ky" href="https://github.com/AGWA/git-crypt/blob/master/INSTALL.md" rel="noopener ugc nofollow" target="_blank"> git-crypt安装页面</a>上有针对Linux、Mac和Windows的说明。</p><p id="a616" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果像我一样，你正在使用安装了<a class="ae ky" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">家酿</a>的Mac，你可以运行:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="83c9" class="ne md it na b gy nf ng l nh ni">$ brew install git-crypt</span></pre><h2 id="c2c7" class="ne md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated">2.创建新的Git存储库</h2><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="294d" class="ne md it na b gy nf ng l nh ni">$ mkdir myproject <br/>$ cd myproject <br/>$ git init <br/>$ echo "This is some text" &gt; file.txt <br/>$ git add file.txt <br/>$ git commit -m "Initial commit"</span></pre><p id="618a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了一个包含单个文本文件的Git存储库。</p><h2 id="021a" class="ne md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated">3.设置存储库以使用git-crypt</h2><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="43ac" class="ne md it na b gy nf ng l nh ni">$ git-crypt init</span></pre><p id="c1bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会看到输出:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="0247" class="ne md it na b gy nf ng l nh ni">Generating key...</span></pre><p id="54dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们做任何其他事情之前，请运行以下命令:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1e11" class="ne md it na b gy nf ng l nh ni">$ git-crypt export-key ../git-crypt-key</span></pre><p id="308a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个命令创建了为这个存储库生成的git-crypt对称密钥的副本。我们把它放在这个存储库上面的目录中，这样我们就可以在多个g it存储库中重用同一个密钥。</p><p id="58dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，git-crypt将生成的密钥存储在文件<code class="fe nk nl nm na b">.git/git-crypt/keys/default</code>中，因此您可以通过运行<code class="fe nk nl nm na b">cp .git/git-crypt/keys/default ../git-crypt-key</code>获得相同的结果。</p><p id="99e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个<code class="fe nk nl nm na b">git-crypt-key</code>文件很重要。这是能解开我们仓库里所有加密文件的钥匙。我们稍后会看到如何使用这个键。</p><h2 id="369c" class="ne md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated">4.告诉git-crypt加密哪些文件</h2><p id="e545" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设我们的应用程序需要一个API密匙，我们希望将它存储在一个名为<code class="fe nk nl nm na b">api.key</code>的文件中。</p><p id="9474" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们将该文件添加到我们的存储库之前，我们将告诉git-crypt，我们希望在提交时对<code class="fe nk nl nm na b">api.key</code>文件进行加密。</p><p id="b897" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们通过使用<code class="fe nk nl nm na b">.gitattributes</code>文件来实现。这是一个我们可以用来向Git存储库添加额外元数据的文件。它不是特定于git-crypt的，所以您的存储库中可能已经有了一个<code class="fe nk nl nm na b">.gitattributes</code>文件。如果有，就添加相关的行。不要替换整个文件。</p><p id="5234" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，我们没有一个<code class="fe nk nl nm na b">.gitattributes</code>文件，所以我们需要创建一个。<code class="fe nk nl nm na b">.gitattributes</code>文件包含以下形式的行:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8cc9" class="ne md it na b gy nf ng l nh ni">[file pattern] attr1=value1 attr2=value2</span></pre><p id="93a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于git-crypt，文件模式需要匹配我们希望git-crypt加密的所有文件，并且属性总是相同的:<code class="fe nk nl nm na b">filter</code>和<code class="fe nk nl nm na b">diff</code>，这两个属性我们都设置为<code class="fe nk nl nm na b">git-crypt</code>。</p><p id="6357" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们的<code class="fe nk nl nm na b">.gitattributes</code>文件应该包含以下内容:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b697" class="ne md it na b gy nf ng l nh ni">api.key filter=git-crypt diff=git-crypt</span></pre><p id="4a2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建该文件，并将其添加并提交到您的Git存储库:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="553b" class="ne md it na b gy nf ng l nh ni">$ echo "api.key filter=git-crypt diff=git-crypt" &gt; .gitattributes <br/>$ git add .gitattributes <br/>$ git commit -m "Tell git-crypt to encrypt api.key"</span></pre><p id="b3ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在我的<code class="fe nk nl nm na b">.gitattributes</code>文件中使用了字面文件名<code class="fe nk nl nm na b">api.key</code>，但是它可以是包含您想要加密的文件的任何文件模式，所以我可以使用<code class="fe nk nl nm na b">*.key</code>，例如。或者，您可以为每个要加密的文件添加一行。</p><p id="d36c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您试图用一个模式条目保护几个文件，那么很容易在您的<code class="fe nk nl nm na b">.gitattributes</code>文件中出错。因此，我强烈推荐阅读<a class="ae ky" href="https://github.com/AGWA/git-crypt#gitattributes-file" rel="noopener ugc nofollow" target="_blank"> git-crypt自述文件</a>的这一部分，它强调了一些常见的问题。</p><h2 id="9e90" class="ne md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated">5.添加一个秘密</h2><p id="cf6e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们已经告诉git-crypt我们想要加密<code class="fe nk nl nm na b">api.key</code>文件，让我们将它添加到我们的存储库中。</p><p id="76e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在提交真正的秘密之前，先添加一个虚拟值并确认它已成功加密，这是测试您的设置的一个好主意。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5231" class="ne md it na b gy nf ng l nh ni">$ echo "dummy value" &gt; api.key</span></pre><p id="08a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还没有将<code class="fe nk nl nm na b">api.key</code>添加到Git中，但是我们可以通过运行以下命令来检查<em class="nj">要</em>做什么:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b96c" class="ne md it na b gy nf ng l nh ni">$ git-crypt status</span></pre><p id="1507" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会看到以下输出:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8f07" class="ne md it na b gy nf ng l nh ni">encrypted: api.key <br/>not encrypted: .gitattributes <br/>not encrypted: file.txt</span></pre><p id="4b70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，即使<code class="fe nk nl nm na b">api.key</code>文件还没有提交到我们的Git存储库中，这也告诉您git-crypt会为您加密它。</p><p id="2bc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们添加并提交文件:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="aee4" class="ne md it na b gy nf ng l nh ni">$ git add api.key <br/>$ git commit -m "Added the API key file"</span></pre><h2 id="5e24" class="ne md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated">6.确认我们的秘密被加密了</h2><p id="2107" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们已经告诉git-crypt加密<code class="fe nk nl nm na b">api.key</code>，并且我们已经将<code class="fe nk nl nm na b">api.key</code>添加到我们的存储库中。然而，如果我们看一下<code class="fe nk nl nm na b">api.key</code>，似乎没有什么不同:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="2e3b" class="ne md it na b gy nf ng l nh ni">$ cat api.key <br/>dummy value</span></pre><p id="65fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原因是git-crypt透明地加密和解密文件，就像你把它们推入和拉出你的仓库一样。因此，<code class="fe nk nl nm na b">api.key</code>文件看起来像一个普通的明文文件。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="3e5b" class="ne md it na b gy nf ng l nh ni">$ file api.key <br/>api.key: ASCII text</span></pre><p id="afce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确认你的文件真的被加密了的一个方法是把你的库推到GitHub。当您使用GitHub web界面查看<code class="fe nk nl nm na b">api.key</code>文件时，您会看到它是一个加密的二进制文件，而不是文本。</p><p id="3ce9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一种更简单的方法是运行以下命令，看看没有解密密钥的存储库会是什么样子:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="3748" class="ne md it na b gy nf ng l nh ni">$ git-crypt lock</span></pre><p id="e6eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果我们看一下我们的<code class="fe nk nl nm na b">api.key</code>文件，事情就不同了:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="92e1" class="ne md it na b gy nf ng l nh ni">$ file api.key <br/>api.key: data </span><span id="22af" class="ne md it na b gy om ng l nh ni">$ cat api.key <br/>GITCRYPTROܮ7y\R*^</span></pre><p id="a4c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将看到一些与我得到的不同的垃圾输出，但很明显文件是加密的。这是存储在GitHub上的内容。</p><p id="1eb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要恢复明文<code class="fe nk nl nm na b">api.key</code>文件，运行:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="3569" class="ne md it na b gy nf ng l nh ni">$ git-crypt unlock ../git-crypt-key</span></pre><p id="a0e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm na b">../git-crypt-key</code>文件是我们之前使用<code class="fe nk nl nm na b">git-crypt export-key...</code>保存的文件。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5162" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">检查站</h1><p id="1742" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们快速回顾一下我们现在所处的位置:</p><ul class=""><li id="f658" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">使用<code class="fe nk nl nm na b">git-crypt init</code>在git存储库上初始化git-crypt。</li><li id="a550" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">使用<code class="fe nk nl nm na b">.gitattributes</code>中的文件模式告诉git-crypt加密哪些文件。</li><li id="91b0" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">将加密我们存储库中所有指定的文件。</li><li id="3c7e" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated"><code class="fe nk nl nm na b">git-crypt unlock [path to keyfile]</code>将解密加密的文件。</li></ul><p id="573e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm na b">git-crypt-key</code>文件很重要。没有它，您将无法解密存储库中的任何加密文件。拥有该文件副本的任何人都可以访问您存储库中的所有加密机密。所以你需要保证文件的安全。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4051" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">重用您的git-crypt密钥文件</h1><p id="434d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们使用<code class="fe nk nl nm na b">git-crypt init</code>和<code class="fe nk nl nm na b">git-crypt export-key</code>来创建我们的<code class="fe nk nl nm na b">git-crypt-key</code>文件。但是，如果我们必须为我们的每个存储库拥有一个单独的密钥文件，那么我们就没有很好地改进我们的秘密管理。</p><p id="8420" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，对多个git存储库使用相同的git-crypt密钥文件非常容易。</p><p id="2941" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用现有的密钥文件，只需在设置git存储库以使用git-crypt时使用<code class="fe nk nl nm na b">git-crypt unlock</code>而不是<code class="fe nk nl nm na b">git-crypt init</code>，如下所示:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="895b" class="ne md it na b gy nf ng l nh ni">$ mkdir my-other-project   # At the same directory level as `myproject` <br/>$ cd my-other-project <br/>$ git init <br/>$ echo "Something" &gt; file.txt <br/>$ git add file.txt <br/>$ git commit -m "initial commit" <br/>$ git-crypt unlock ../git-crypt-key</span></pre><p id="ec03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果在将任何文件添加到Git存储库之前运行<code class="fe nk nl nm na b">git-crypt unlock</code>命令，您将看到如下消息:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c791" class="ne md it na b gy nf ng l nh ni">fatal: You are on a branch yet to be born <br/>Error: 'git checkout' failed <br/>git-crypt has been set up but existing encrypted files have not been decrypted</span></pre><p id="50e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这仍然工作得很好，但是有点混乱，所以我确保在运行<code class="fe nk nl nm na b">git-crypt unlock...</code>之前添加并提交至少一个文件。</p><p id="2f24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重用您的git-crypt密钥文件很方便，但这确实意味着如果其他人得到了您的密钥文件的副本，<em class="nj">您所有的加密秘密就会暴露。</em></p><p id="4fa9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这与使用像<a class="ae ky" href="https://www.lastpass.com/" rel="noopener ugc nofollow" target="_blank"> LastPass </a>或<a class="ae ky" href="https://1password.com/" rel="noopener ugc nofollow" target="_blank"> 1password </a>这样的密码管理器是同样的安全权衡。你不用管理多个秘密(密码)，每个都有暴露的风险，而是把它们都放在一个安全的地方，用一个主密码来打开那个的<em class="nj">。</em></p><p id="6dec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的想法是，管理一个重要的秘密比管理许多次要的秘密更容易。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cd62" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">何时不使用git-crypt</h1><p id="d289" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Git-crypt是一种很好的方法，可以将应用程序需要的秘密保存在Git存储库中，与应用程序源代码放在一起。然而，就像其他安全措施一样，并不是<em class="nj">总是</em>合适或明智的。</p><p id="1bfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是一些需要考虑的事项，以确定它是否是您特定项目的正确解决方案:</p><ul class=""><li id="efb6" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">git-crypt是为git存储库中的大多数文件可以保持明文形式的情况而设计的，您只需要加密一些包含秘密的文件。如果您需要加密存储库中的大部分或所有文件，那么其他解决方案可能更合适。</li><li id="7115" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">一旦某人有了密钥文件，就没有简单的方法来撤销对存储库中秘密的访问，也没有简单的方法来轮换(即替换)密钥文件(尽管更改git-crypt密钥文件没有多大帮助，除非您也轮换存储库中的所有实际秘密)。</li><li id="1c9b" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">git-crypt只加密文件的<em class="nj">内容</em>。因此，如果您的存储库的<em class="nj">元数据</em>也是敏感的(例如，文件名、修改日期、提交消息等等)，这就不合适了。</li><li id="d631" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">一些GUI Git应用程序可能无法可靠地使用git-crypt。<em class="nj">注:虽然自述中提到的Atlassian SourceTree的具体情况，已经被</em> <a class="ae ky" href="https://jira.atlassian.com/browse/SRCTREE-2511" rel="noopener ugc nofollow" target="_blank"> <em class="nj">固定</em> </a> <em class="nj">。</em></li></ul><p id="4a91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://github.com/AGWA/git-crypt#limitations" rel="noopener ugc nofollow" target="_blank"> git-crypt自述文件</a>的这一部分有更多的信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ada9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用git-crypt的更好方法</h1><p id="aeb0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">与直接管理git-crypt密钥文件相比，有一种更好的方法来管理加密的存储库:将git-crypt与<a class="ae ky" href="https://gnupg.org/" rel="noopener ugc nofollow" target="_blank"> gpg </a>集成，这样您就可以使用gpg私钥来解密git存储库。这也允许您向Git存储库添加多个合作者，而无需在各方之间传递任何秘密。</p><p id="871d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，这需要更复杂的设置，所以我们将在另一篇文章中讨论。</p></div></div>    
</body>
</html>