<html>
<head>
<title>How to Use SQLite in Your Ionic App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在你的Ionic应用中使用SQLite</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-sqlite-in-your-ionic-app-ef441f4933ca?source=collection_archive---------5-----------------------#2019-08-09">https://betterprogramming.pub/how-to-use-sqlite-in-your-ionic-app-ef441f4933ca?source=collection_archive---------5-----------------------#2019-08-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="690b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将古腾堡项目中的开源书籍转化为应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b6dc6c9abfd06dd67a17e8c3c5904fe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t6MbnbYe2M_oAHH8VC4W5A.png"/></div></div></figure><p id="8468" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">SQLite是一个用于Android应用程序的通用数据库，因为它很小，可移植，并且使用通用的SQL语法。大多数数据库驱动的Android应用程序都使用SQLite。使用SQLite原生插件将它集成到Ionic应用程序中也很容易。</p><p id="9fc2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">古腾堡计划是一项数字化和存档文化作品的志愿者工作，其图书馆中包含大量书籍。它既存储有版权的书籍，也存储公共领域的书籍。它们有多种格式可供任何人下载。然而，它们不能作为独立的应用程序使用。</p><p id="c48d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这一块，我们将把它们转换成一个应用程序。您可以添加许多功能，如字体大小调整、书签、文本到语音等。然而，我们将保持简单。我们的应用程序将允许你阅读这本书，调整字体大小，并保存字体设置。</p><p id="ff0a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了实现这一点，我们将它构建为一个Ionic应用程序，它使用Angular框架作为其基础。这允许你构建一个Angular应用程序，作为一个具有一些原生功能的Android应用程序。</p><p id="cfe6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因为我们的应用程序是一本书，它只需要一个简单的本地特性，SQLite数据库访问。为了将古腾堡电子书转换为应用程序，我们提取ePub文件，将提取的内容加载到SQLite数据库中，将内容转储到<code class="fe lq lr ls lt b">.sql</code>文件中，然后通过Ionic的SQLitePorter本机插件将其导入到我们的应用程序中。</p><p id="86d2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个练习中，我们将下载古腾堡的《肮脏的财富》一书，并将其转换成Android应用程序。</p><p id="72ee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ePub只是一个带有一些额外元数据的ZIP存档，所以我们可以使用任何存档工具提取它。解压缩之后，您应该会看到一堆HTML文件。然后我们编写以下Python脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="130c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该脚本读取提取的HTML文件，并将其加载到SQLite数据库中，每个条目一个文件。在加载之前，我们用普通的div标签替换body标签，因为我们的应用程序中已经有一个body标签。此外，我们改变了图像路径到<code class="fe lq lr ls lt b">assets</code>文件夹，这样它们可以留在我们的应用程序项目文件夹的<code class="fe lq lr ls lt b">assets</code>文件夹中。</p><p id="5d54" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们通过运行以下命令来运行脚本:</p><pre class="kj kk kl km gt lw lt lx ly aw lz bi"><span id="1986" class="ma mb it lt b gy mc md l me mf">C:\epub-to-sqlite\epub-to-sqlite.py C:\epub-to-sqlite\pg59849-images\OEBPS filthy-rich</span></pre><p id="32ef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">假设所有东西都在这些文件夹中的正确位置，它应该是成功的。如果没有，请相应地更改路径。<code class="fe lq lr ls lt b">filthy-rich</code>是数据库名称。<code class="fe lq lr ls lt b">C:\epub-to-sqlite\pg59849-images\OEBPS</code>是ePub的HTML文件所在的位置。</p><p id="6996" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们用DB Browser for SQLite打开SQLite文件，可以在https://sqlitebrowser.org<a class="ae mg" href="https://sqlitebrowser.org/" rel="noopener ugc nofollow" target="_blank">的</a>买到。打开我们生成的SQLite数据库，然后单击文件菜单和路径，导出→数据库到SQL文件并转储<code class="fe lq lr ls lt b">sections</code>表。将every保留为默认值。确保下拉菜单上的最后一个选项是“覆盖旧模式”(删除表，然后创建表)。这确保书籍的内容总是在加载时导入。</p><p id="3674" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们可以编写应用程序了。如果你不熟悉构建Ionic应用程序，这里的<a class="ae mg" href="https://medium.com/@hohanga/how-to-build-android-apps-with-ionic-framework-5e3c2fdf2a1" rel="noopener">是一篇很好的文章供你阅读。</a></p><p id="8b50" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们像往常一样用<code class="fe lq lr ls lt b">ionic new filthy-rich sidemenu</code>搭建应用程序，其中<code class="fe lq lr ls lt b">filthy-rich</code>是应用程序名称。然后，我们将SQLite转储文件复制到app文件夹中的一个新文件中。将新文件命名为<code class="fe lq lr ls lt b">sql.ts</code>。</p><p id="a0c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在是时候翻开新的一页了。运行<code class="fe lq lr ls lt b">ionic g component homePage</code>、<code class="fe lq lr ls lt b">ionic g component endPage</code>和<code class="fe lq lr ls lt b">ionic g component sectionPage</code>。我们需要存储当前页面被集中读取的状态，所以我们必须使用<code class="fe lq lr ls lt b">@ngrx/store</code>。这可以通过运行<code class="fe lq lr ls lt b">npm i @ngrx/store.</code>来安装</p><p id="0daf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当我们运行<code class="fe lq lr ls lt b">ng add @ngrx/store</code>时，你应该会看到一个<code class="fe lq lr ls lt b">reducers</code>文件夹。在那里，应该有一个<code class="fe lq lr ls lt b">index.ts</code>文件。我们还必须为我们的reducer创建一个文件来存储当前页面。这是通过将当前目录更改为<code class="fe lq lr ls lt b">reducers</code>文件夹并运行<code class="fe lq lr ls lt b">ng g class pageReducer</code>来完成的。</p><p id="8dc2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开Genymotion仿真器后，我们通过运行<code class="fe lq lr ls lt b">ionic cordova run android -l</code>来运行我们的应用程序，如这里的<a class="ae mg" href="https://medium.com/@hohanga/how-to-build-android-apps-with-ionic-framework-5e3c2fdf2a1" rel="noopener">所示</a>，其中<code class="fe lq lr ls lt b">-l</code>用于实时重新加载。</p><p id="bd02" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们添加一些代码。在<code class="fe lq lr ls lt b">page-reducer.ts</code>中增加:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="4cac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lq lr ls lt b">reducers/index.ts</code>中，我们应该有:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="bd22" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lq lr ls lt b">home-page.component.ts</code>中，我们用以下内容替换现有内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="51bc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们利用SQLite插件打开数据库，加载每个部分，并显示标题。<code class="fe lq lr ls lt b">currentPage</code>存储在本地存储器中。在<code class="fe lq lr ls lt b">home-page.component.html</code>中，我们有:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="edd3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将显示每个部分的标题以及指向主页和设置页面的链接。</p><p id="9c99" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lq lr ls lt b">end-page.component.html</code>中，我们有:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="59d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lq lr ls lt b">section-page.component.html</code>中，我们有:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="6c80" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们获取字体大小和当前页面，这样我们就可以显示当前页面，并且根据您所在的页面，显示后退和前进按钮。如果您在倒数第二页，那么“下一页”按钮将转到最后一页。如果没有，则进入下一页。右侧部分将从查询参数中的部分编号中检索。</p><p id="c2a5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">section-page.component.html</code>将有:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="0119" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将显示内容。</p><p id="e9cc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lq lr ls lt b">app.component.ts</code>中，我们有:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="b3bb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是我们的应用程序的入口点，所以我们使用SQLitePorter将所有数据加载到数据库中，因为没有办法使用预加载数据的数据库。</p><p id="c63e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lq lr ls lt b">app.component.html</code>我们有:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="d7f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将显示我们的侧菜单。</p><p id="2464" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lq lr ls lt b">app.module.ts</code>我们有:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="eaae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lq lr ls lt b">app.routing.module.ts</code>中，我们有自己的路线:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="ad9a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在可以导航到我们的页面。</p><p id="567a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，我们有一个设置页面来保存书籍文本的字体大小。</p><p id="81d6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lq lr ls lt b">settings-page.component.ts</code>中，我们有:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="5ab4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那么在<code class="fe lq lr ls lt b">settings-page.component.html</code>中我们有:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="90a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">ion-range</code>滑块用于调整字体大小并保存。</p><p id="9659" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，我们将图像从提取的ePub复制到<code class="fe lq lr ls lt b">assets</code>文件夹中，这样我们就可以看到图像了。</p><p id="7e9f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后我们得到了这个:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/34c7a03b03b23947dba9943d4fed8b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*rn18CnaxHDPZdLW4rgUpJw.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/d81361b44a61feba0dcd67e21a355ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*eL474-Phw_1g9JXy1B48TA.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/72d39e929b3564b3abba19ac2f8ea19a.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*S_UPaR7iLWvjgnYs61PsjA.png"/></div></figure><p id="dc03" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最终产品在此发布<a class="ae mg" href="https://play.google.com/store/apps/details?id=com.filthyrich.book" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="0e94" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意:只制作像这样的来自公共领域书籍的应用。将受版权保护的书籍转换成应用程序是非法的。</strong></p></div></div>    
</body>
</html>