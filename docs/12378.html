<html>
<head>
<title>The Effective Way To Write Bash Scripts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写Bash脚本的有效方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/effective-bash-scripts-108d976026bc?source=collection_archive---------7-----------------------#2022-06-01">https://betterprogramming.pub/effective-bash-scripts-108d976026bc?source=collection_archive---------7-----------------------#2022-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6f45" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用Bashy库实现更好的输入解析和脚本管理</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2f912809457ea8cdeefd75d8bf3fac22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-wHZXRiOreqymsRm"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@markuswinkler?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马库斯·温克勒</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="e160" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如今，大多数工具和脚本引擎都有一些非常重要的特性，可以节省我们大量的时间。在我的日常工作中，我最欣赏这些脚本:</p><ul class=""><li id="f989" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">参数解析和帮助支持:能够自我记录正在启动的命令，枚举所有参数</li><li id="853c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">脚本共享:与他人共享您创建的脚本的机会。</li></ul><p id="bafa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个特征都是通过现代语言实现的。试想一下，在node，。net或PHP，您有一个包的存储库，您可以下载包管理器安装在您的本地的可执行文件。通过这种方式，内容可以用来与使用公共或私有存储库的其他人共享您创建的程序。</p><p id="0704" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些语言都提供了(直接或使用易于集成的库)自由构建关于控制台命令和选项列表的信息的方法。此外，该解决方案还解决了参数解析问题。但是巴什怎么办？</p><p id="7776" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将发现用Go编写的工具<a class="ae ky" href="https://github.com/zeppaman/bashy" rel="noopener ugc nofollow" target="_blank"> Bashy </a>，它旨在通过授权BASH脚本使用声明性清单和脚本共享来解析参数，从而解决所有这些问题。</p><p id="fbf9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/72b5c0d0a58540209a54becfabf17f9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OVyLhe0wxMKtHTdc"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Gabriel Heinzer 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="2b7f" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">Bash清单和参数解析</h1><p id="bcfc" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我敢肯定，我们大多数人都喜欢这样一个事实:如果你在一个命令后输入<code class="fe nh ni nj nk b">--help</code>(例如<code class="fe nh ni nj nk b">mytool --help</code>)，你会得到所有的选项和参数。那么，你们中有多少人喜欢写实现它的代码呢？在最高级的语言(C#、GO、PHP)中，有这样做的库和帮助器，但是在bash中，最常见的选择是编写如下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="a054" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，这段代码不容易维护，每次添加参数时都必须更新。我们的生活会随着巴希而改变！</p><p id="eee3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这与使用Bashy是一样的(参数被自动解析):</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="a33b" class="nr ml it nk b gy ns nt l nu nv">echo "FILE EXTENSION  = ${EXTENSION}"<br/>echo "SEARCH PATH     = ${SEARCHPATH}"<br/>echo "DEFAULT         = ${DEFAULT}"<br/>echo "Number files in SEARCH PATH with EXTENSION:" $(ls -1 "${SEARCHPATH}"/*."${EXTENSION}" | wc -l)</span></pre><p id="9507" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">怎么可能呢？Bashy为我们的脚本使用了一种描述性格式。因此，我们将能够通过添加YAML配置文件的一些行来解释脚本的参数。因此，解释器将知道参数是如何产生的，并且您将得到填充了正确值的变量。更容易，对吗？</p><p id="4d08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的代码片段中，您将找到显示输入数据的简单脚本的YAML描述。您可以将bash脚本嵌入清单或链接到外部文件。在这个例子中，为了简洁起见，我使用了一个嵌入式的，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="b87c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经看到事情是如何变得更容易的，让我们开始创建我们的第一个bash脚本。</p><h1 id="9f49" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">如何创建你的第一个Bashy脚本</h1><p id="8a5a" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">正如我们在上一节中介绍的，Bashy脚本只不过是一个带有相关清单的常规BASH脚本。Bashy解释器通过用YAML清单中的信息解析参数来包装脚本，将值提供给脚本，并将它们作为常规变量注入。</p><p id="53e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这创造了奇迹！</p><p id="412b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于简短的脚本，您可以将bash代码直接嵌入YAML文件中。当然，较长的脚本可以作为外部独立文件保存。使用这些，您将添加文件的路径(它也可以是允许从互联网下载的URL)。</p><p id="f681" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将始终使用嵌入式版本来简化阅读，避免在教程的每个步骤中使用多个代码片段。</p><p id="bc72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步是在中创建一个YAML文件，您可以填充所有元数据，如下面的代码片段所示:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="035f" class="nr ml it nk b gy ns nt l nu nv">name: Name<br/>description: the command description<br/>argsusage: help text</span></pre><p id="ee5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令的名称将是用于调用脚本的名称。同时，<code class="fe nh ni nj nk b">description</code>和<code class="fe nh ni nj nk b">arg</code>用法将用于显示帮助文本。描述命令的另一个元素是参数列表。我们可以通过配置元素<code class="fe nh ni nj nk b">params</code>来添加它:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="ce62" class="nr ml it nk b gy ns nt l nu nv">params:<br/>- name: "name"<br/>  desc: "enter your name"<br/>- name: "surname"<br/>  desc: "enter your surname"</span></pre><p id="99ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以添加脚本命令。它可以逐行添加，也可以链接到外部脚本。所有的方法都可以共存，并且会按顺序执行。在这种情况下，我们使用的是嵌入式版本:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="c8fd" class="nr ml it nk b gy ns nt l nu nv">cmd: echo "commmand executing with $name and $surname" </span></pre><p id="16da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以通过使用变量来获取输入值。每个输入都有一个变量，其名称由您在清单中选择。在我们的例子中，它们是<code class="fe nh ni nj nk b">$name</code>和<code class="fe nh ni nj nk b">$surname</code>。</p><p id="c118" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过将它添加到存储库中来测试它:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="eabc" class="nr ml it nk b gy ns nt l nu nv">bashy repo add ./samples/bash.yml</span></pre><p id="bbec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，脚本可用了，您可以通过键入以下命令来检查它:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="3887" class="nr ml it nk b gy ns nt l nu nv"># basky Name<br/>NAME:<br/>   main Name -</span><span id="bbc6" class="nr ml it nk b gy nw nt l nu nv">USAGE:<br/>   main Name [command options] [arguments...]</span><span id="8d98" class="nr ml it nk b gy nw nt l nu nv">DESCRIPTION:<br/>   the command description</span><span id="6b22" class="nr ml it nk b gy nw nt l nu nv">OPTIONS:<br/>   --name value     enter your name<br/>   --surname value  enter your surname<br/>   --help, -h       show help (default: false)</span></pre><p id="9b3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">脚本的执行只需要:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="866b" class="nr ml it nk b gy ns nt l nu nv"># basky Name --name myname --surname mysurname</span><span id="66e0" class="nr ml it nk b gy nw nt l nu nv">commmand executing with myname and mysurname</span></pre><p id="6ca3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，如果您已经将bashy的bin文件夹包含到路径文件中，您可以直接调用该命令，因为它是一个物理脚本:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="aa85" class="nr ml it nk b gy ns nt l nu nv">Name --name myname --surname mysurname # No "bahy" command here</span><span id="1968" class="nr ml it nk b gy nw nt l nu nv">commmand executing with myname and mysurname</span></pre><p id="495b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样。现在你的第一个脚本已经完成，看看如何与他人分享。</p><h1 id="ebff" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">部署和使用脚本</h1><p id="a321" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">像最常见的软件包管理器一样，Bashy可以在您的本地。因为它是对内部用户估计的(bash脚本主要由技术人员使用)，所以它被认为是尽可能平滑的。</p><p id="a1d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，Bashy下载并安装任何YAML文件——本地或通过HTTP。这意味着您的团队可以通过将文件发布到共享文件夹或任何HTTP存储库(网站或artefact存储库)来共享文件。这一部分非常好，因为它不强迫你安装和采用(也许还要付费)任何第三方工具。</p><p id="6882" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将脚本添加到本地存储库的命令是:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="148f" class="nr ml it nk b gy ns nt l nu nv"># bashy repo add <a class="ae ky" href="https://raw.githubusercontent.com/zeppaman/bashy/master/samples/bash.yml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/zeppaman/bashy/master/samples/bash.yml</a></span><span id="f612" class="nr ml it nk b gy nw nt l nu nv">List of the script added:<br/>/root/.bashy/scripts/Name.yml<br/>/root/.bashy/scripts/SecondCommand.yml<br/>/root/.bashy/scripts/RemoteCommand.yml</span></pre><p id="14e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在命令可用了，您可以使用脚本了！</p><h1 id="bced" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">结论</h1><p id="aa48" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在本文中，我们看到了如何使用Bashy来简化BASH脚本的使用。这个工具增强了Bash脚本，使其符合最新的标准，并且节省了我们大量的时间。换句话说，它帮助我们以同样的努力提高更高效的脚本的质量和交付。</p><p id="2604" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，你只需要测试它😃。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="0c28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">喜欢这篇文章吗？成为 <a class="ae ky" href="https://daniele-fontani.medium.com/membership" rel="noopener"> <em class="oe">中等会员</em> </a> <em class="oe">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><h1 id="ff23" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">参考</h1><ul class=""><li id="2601" class="lv lw it lb b lc nc lf nd li of lm og lq oh lu ma mb mc md bi translated">GitHub上的回购<a class="ae ky" href="https://github.com/zeppaman/bashy" rel="noopener ugc nofollow" target="_blank">https://github.com/zeppaman/bashy</a></li></ul></div></div>    
</body>
</html>