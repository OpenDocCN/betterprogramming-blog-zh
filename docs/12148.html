<html>
<head>
<title>Deploying a Basic Express API on Amazon EC2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Amazon EC2上部署基本的Express API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deploying-a-basic-express-api-on-amazon-ec2-eea0b54a825?source=collection_archive---------1-----------------------#2022-05-16">https://betterprogramming.pub/deploying-a-basic-express-api-on-amazon-ec2-eea0b54a825?source=collection_archive---------1-----------------------#2022-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="da21" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">循序渐进的指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8f1d6085df94e10ddd0ee37b47ba3b8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_BgLBTYzH9Jh-gTz.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自Unsplash</p></figure><p id="c606" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我计划在未来发表的几篇文章需要在EC2实例上运行express API，所以我想提供一个一站式解决方案，我的读者可以参考这个方案，帮助他们在AWS EC2实例上部署一个全功能的express API。</p><h1 id="10c2" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">先决条件</h1><p id="ad70" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">您应该有一个有效的AWS帐户。</p><p id="8251" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">注</strong>:最初，AWS提供积分让你试用其服务，但EC2、route53等服务。，现在成本。在使用它们之前，请注意这一点，并通过AWS的<a class="ae mo" href="https://aws.amazon.com/aws-cost-management/aws-cost-explorer/" rel="noopener ugc nofollow" target="_blank">成本浏览器持续跟踪您的成本。</a></p><h1 id="870b" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">在AWS上初始化EC2实例</h1><p id="129f" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">第一步是在AWS上初始化EC2实例。为此，请前往https://aws.amazon.com/ec2/。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/6d52d41ded56492a6c194b8228b8068b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qpNx1P9EdrFOlq8Ww-at_w.png"/></div></div></figure><p id="3fc6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点击“亚马逊EC2入门”如果您有AWS帐户，请登录，您将被重定向到以下页面:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/edb19d84d813364be6e3a115982aa88d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LA-KUMXqDxCem7PqkYqL7w.png"/></div></div></figure><p id="7379" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点击“启动实例”按钮，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/b8224efdd52802c1a614ac3f7bc36235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1p2oAMANLnGXanZ4zOzoiA.png"/></div></div></figure><p id="f767" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在下一页，选择操作系统“Ubuntu”，并为您的服务器提供一个名称。</p><p id="5298" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后选择一个实例类型。我选择了t2 micro，它为我们提供了1 GB的内存和1个CPU内核。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/fd03e73617a0d6c7c07c99b6ee21622a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Kn0fjLnjbFeplOAP7006g.png"/></div></div></figure><p id="c64b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，您需要提供一个SSH密钥对，以便实例能够验证您的<code class="fe mr ms mt mu b">ssh</code>请求。这是一张图片:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/364fddc2c1f387e5a73daf711fc8ad59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9IWQgsuddFKw0NFnLDy1bA.png"/></div></div></figure><p id="289c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您已经实例化了一个<code class="fe mr ms mt mu b">ssh</code>密钥对，您可以使用它，或者点击“创建一个新的密钥对”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/c60f9ecbcc7dc7d5e3234af1dcf3a632.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kQMsuLVlMHfpGVyx7Np82g.png"/></div></div></figure><p id="6e49" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为密钥提供一个名称，然后单击创建。包含密钥的压缩文件将被下载到您的系统中。</p><p id="4f3b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">请确保将文件提取并保存在本地；它将在稍后阶段用于连接到我们的远程实例。</p><p id="3dc5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后在网络设置中，允许通过SSH(用于远程访问您的服务器)、HTTP和HTTPS(用于访问我们的API)的流量。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/8a86937ecfa274a84cb6ef7c306a8bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O4oxsDbNm3qsm1iY5fkR1Q.png"/></div></div></figure><p id="f47c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将其余设置保留为默认设置，然后单击“启动实例”按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/ec049f8a73a2b8353be65de47a332035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I4rZMcmULq3yoBCbWdf6Mg.png"/></div></div></figure><p id="1041" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">启动后，您将看到以下屏幕:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/5fc1012ea202453739387c51cc5d69fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f0cz9dkzGgVWGryTNwzG5A.png"/></div></div></figure><p id="af8b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这里，单击“查看所有实例”从这里，您将被重定向到可以看到所有实例的屏幕。</p><p id="22d3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在此屏幕上，复制实例的公共ipv4地址。在下一部分中，我们需要这个地址和保存的<code class="fe mr ms mt mu b">.pem</code>文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/f933155e3c331bd3db3440a192cbf96a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D8JauJ-gpFiahDyiL6AyDA.png"/></div></div></figure><h1 id="2d73" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">设置实例环境</h1><p id="4857" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">要设置我们的实例，我们需要首先连接到它。为此，我们将使用这个<code class="fe mr ms mt mu b">ssh</code>协议。</p><p id="1efb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为此，打开我们操作系统的终端，移动到包含我们保存的<code class="fe mr ms mt mu b">.pem</code>文件(我们在上一节中生成的)的目录，并运行以下命令:</p><pre class="kg kh ki kj gt mz mu na nb aw nc bi"><span id="fcb9" class="nd ls iq mu b gy ne nf l ng nh">ssh -i aws-test-key.pem ubuntu@54.234.113.208</span></pre><p id="9bf0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注意，您必须根据您的上下文修改上面的命令。</p><pre class="kg kh ki kj gt mz mu na nb aw nc bi"><span id="1f82" class="nd ls iq mu b gy ne nf l ng nh">ssh -i &lt;PEM_FILE_NAME&gt; OPERATING_SYSTEM@SERVER_IPV4_ADDRESS</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/3a78798ab667a7f70d31214c99f2a1bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kL0nPNBStz32iyOFwwt7dQ.png"/></div></div></figure><p id="7105" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">登录后，您会看到一个类似的终端。</p><p id="227d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，我们必须安装NodeJS和一些其他依赖项，以便在实例上运行我们的express服务器。</p><p id="a6be" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要安装NodeJS，您可以使用官方<a class="ae mo" href="https://github.com/nodesource/distributions/blob/master/README.md#installation-instructions" rel="noopener ugc nofollow" target="_blank"> GitHub页面</a>上的任何curl命令(取决于您想要安装的版本)。</p><p id="e2c0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于我们的情况，我将使用以下内容:</p><pre class="kg kh ki kj gt mz mu na nb aw nc bi"><span id="b227" class="nd ls iq mu b gy ne nf l ng nh">curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -<br/>sudo apt-get install -y nodejs</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/4625063aadf0a76bfd64395ec93b3ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dyWkFN4JeoBqmSNUT2RP2w.png"/></div></div></figure><p id="b084" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将在安装后看到以下输出。</p><p id="90e1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以通过运行以下命令来验证节点是否安装成功:</p><pre class="kg kh ki kj gt mz mu na nb aw nc bi"><span id="cedb" class="nd ls iq mu b gy ne nf l ng nh">node --version</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/5c4bd5bb09e9467986190cd7476e62d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xiT7LRNimwtjgweQSM5Yw.png"/></div></div></figure><p id="5368" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们将安装一个名为<code class="fe mr ms mt mu b">pm2</code>的包管理器来管理我们的NodeJs进程，这样即使我们关闭了当前的终端会话，它们也能继续运行。</p><p id="00c1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要安装<a class="ae mo" href="https://pm2.keymetrics.io/" rel="noopener ugc nofollow" target="_blank"> pm2 </a>，运行以下命令:</p><pre class="kg kh ki kj gt mz mu na nb aw nc bi"><span id="c4d6" class="nd ls iq mu b gy ne nf l ng nh">sudo npm install -g pm2</span></pre><p id="53c5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">再次验证安装，运行以下命令:</p><pre class="kg kh ki kj gt mz mu na nb aw nc bi"><span id="597b" class="nd ls iq mu b gy ne nf l ng nh">pm2 --version</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/0a14cf4c8516cddfc5caa167a78ea28a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cWfUt11r29xJZ2CXrClp6Q.png"/></div></div></figure><h1 id="f855" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">初始化我们的快递服务器</h1><p id="d6e1" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">您可以在实例中初始化您自己的express服务器，或者您可以使用这个命令克隆下面的<a class="ae mo" href="https://github.com/AkshayCHD/node-basic.git" rel="noopener ugc nofollow" target="_blank">存储库</a>:</p><pre class="kg kh ki kj gt mz mu na nb aw nc bi"><span id="9bad" class="nd ls iq mu b gy ne nf l ng nh">git clone <a class="ae mo" href="https://github.com/AkshayCHD/node-basic.git" rel="noopener ugc nofollow" target="_blank">https://github.com/AkshayCHD/node-basic.git</a></span></pre><p id="5a1d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本质上，该项目包含一个<code class="fe mr ms mt mu b">index.js</code>文件，用于初始化以下express服务器:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="710a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">之后，进入目录并运行以下命令:</p><pre class="kg kh ki kj gt mz mu na nb aw nc bi"><span id="cf01" class="nd ls iq mu b gy ne nf l ng nh">cd node-basic &amp;&amp; npm install</span></pre><p id="7ed5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，要生成pm2进程，运行以下命令:</p><pre class="kg kh ki kj gt mz mu na nb aw nc bi"><span id="e2db" class="nd ls iq mu b gy ne nf l ng nh">pm2 start index.js</span></pre><p id="b498" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">运行此命令后，您可以通过运行一个简短的命令来验证该过程是否已正确启动:</p><pre class="kg kh ki kj gt mz mu na nb aw nc bi"><span id="9538" class="nd ls iq mu b gy ne nf l ng nh">pm2 logs</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/dd680dd62f4c848c346003e4572788db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V1kQHUSAKqjp36uYKCYCqA.png"/></div></div></figure><p id="3f7f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您应该会看到以下输出。</p><p id="e532" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，如果我们想向外界公开我们的API，我们必须在默认的HTTP端口<code class="fe mr ms mt mu b">port 80</code>上启动我们的进程，或者我们必须以某种方式将我们的进程(运行在<code class="fe mr ms mt mu b">port 5000</code>上)映射到<code class="fe mr ms mt mu b">port 80</code>。</p><p id="1234" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">实现这一点的正确方法是通过Nginx这样的反向代理，我们将在下一篇文章中使用它。现在，我们将在系统的IPtable中使用一种不太理想的方式来映射<code class="fe mr ms mt mu b">port 80</code>到<code class="fe mr ms mt mu b">5000</code>，使用以下命令:</p><pre class="kg kh ki kj gt mz mu na nb aw nc bi"><span id="4a9f" class="nd ls iq mu b gy ne nf l ng nh">sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 5000</span></pre><p id="69bd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，当您在浏览器中键入实例的IP时，您将看到以下消息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/b6f3cd4dfd9f49e94f81303a456df4ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*jj9XaQDXhu-QhYvSx8cQiw.png"/></div></figure><p id="29ea" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这意味着我们的服务器运行良好。</p><h1 id="048e" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">结论</h1><p id="b512" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">按照上面的步骤，您可以实例化一个裸机Ec2实例，它将运行一个向外界公开的简单express API。</p><p id="7694" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本系列的下一篇文章中，我们将学习如何为我们的API设置一个反向代理，从而使它更加高效、安全和可扩展。</p></div></div>    
</body>
</html>