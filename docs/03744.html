<html>
<head>
<title>JavaScript Service Workers, Visualized</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript服务人员，可视化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/javascript-service-workers-visualized-308ca3292b6a?source=collection_archive---------13-----------------------#2020-03-02">https://betterprogramming.pub/javascript-service-workers-visualized-308ca3292b6a?source=collection_archive---------13-----------------------#2020-03-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="517b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">服务人员是如何工作的，举几个例子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d6fe4aa515ec91137b0a657a0e66b3f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZX8H8ABjHCa4dg9MaIFbrw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">服务人员——作者</p></figure><p id="af72" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">很可能，你们中的大多数人都以这样或那样的方式听说过JavaScript生态系统中的新成员。我说的是服务工作者，他们是现代网络开发的关键部分。它们在最近几年获得了牵引力，这都要归功于渐进式网络应用程序的流行，或称之为<em class="lu"> PWAs </em>。</p><p id="59b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我听到这个消息时，我的一个大问题是:“我们什么时候应该使用服务人员？我们可以在哪些场景或背景下应用它们？”</p><p id="3079" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇文章中，我们将会看到一些他们适合的实际案例，并且将会为我们的最终用户的利益做一件伟大的工作。最终的想法是让他们真正快乐，对吗？。</p><p id="430e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">话虽如此，但在进入实际案例之前，我认为最好先了解一下服务人员的一些基本知识。对于新来的人来说，这将是一个很好的底线，为了向他们表示敬意，让我们放入一张表中。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3cdb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是服务人员？</h1><p id="e241" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">服务人员本质上是您的浏览器在后台运行的脚本。请记住，它完全独立于它正在处理或服务的网页。</p><p id="e33d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">实际上，它们充当代理服务器，位于web应用程序、浏览器和网络之间。目前有什么疑问吗？我希望不会。</p><p id="e0fa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">服务人员赋予web应用程序像本地应用程序一样工作的能力。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b96c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">关于服务人员需要考虑的事实</h1><ul class=""><li id="e790" class="mz na it la b lb mu le mv lh nb ll nc lp nd lt ne nf ng nh bi translated">他们不能直接访问DOM。它使用一种机制来响应通过<a class="ae ni" href="https://html.spec.whatwg.org/multipage/workers.html#dom-worker-postmessage" rel="noopener ugc nofollow" target="_blank"> postMessage </a>接口发送的消息。</li><li id="e977" class="mz na it la b lb nj le nk lh nl ll nm lp nn lt ne nf ng nh bi translated">不使用时终止。这意味着它们是事件驱动的。</li><li id="dfad" class="mz na it la b lb nj le nk lh nl ll nm lp nn lt ne nf ng nh bi translated">利用ES6承诺。</li><li id="edb7" class="mz na it la b lb nj le nk lh nl ll nm lp nn lt ne nf ng nh bi translated">因为它们非常强大，所以只需要通过HTTPS使用它们，除非在本地主机上，没有HTTPS也可以使用它们。然而，如果你上传到远程服务器，他们需要安装HTTPS。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1a32" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">服务人员如何工作？一目了然</h1><p id="abb8" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">基本上，它们让应用程序能够拦截网络请求，缓存这些请求以增强应用程序的性能。这种增强是因为您已经缓存了所有内容。</p><p id="64d4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，“一张图胜过千言万语”，所以，为了更好的理解，我们来看下一张图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/005e2dc663c0eacf2f37817b064db5f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*pY5oSrjUqZ8Fr4YIKKX_6Q.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">服务人员如何工作——作者</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3730" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">服务工作者生命周期</h1><p id="5636" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">正如我前面提到的，服务人员独立于它所控制的页面工作。如果你想在你的web应用中安装一个服务人员，首先要做的就是注册它。</p><p id="c6d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完成后，启动服务人员安装的浏览器将进入后台。为了更好的理解，让我们看下一张图片。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/71fd5d2e6e40fa3b20fb17180681b346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MGS11eUn4T8pCfPuW93ccg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">服务工作者的生命周期——作者</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7781" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最常见的使用案例</h1><p id="5dbb" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">现在，我们对服务人员的工作方式有了更好的了解，是时候了解他们最常见的用法了。</p><h2 id="e326" class="no md it bd me np nq dn mi nr ns dp mm lh nt nu mo ll nv nw mq lp nx ny ms nz bi translated">缓存支持</h2><p id="f31d" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">服务工作者可以在一系列缓存策略下使用。关于这些缓存策略，有以下使用案例:</p><ul class=""><li id="af1c" class="mz na it la b lb lc le lf lh oa ll ob lp oc lt ne nf ng nh bi translated">仅缓存—您拥有从不改变的静态内容。</li><li id="9a76" class="mz na it la b lb nj le nk lh nl ll nm lp nn lt ne nf ng nh bi translated">网络或缓存—如果您想向用户显示最新的内容，唯一的条件/愿望是您想更快地加载它。</li><li id="cb4b" class="mz na it la b lb nj le nk lh nl ll nm lp nn lt ne nf ng nh bi translated">缓存和更新—您希望即时显示内容，并且不介意暂时与服务器不同步。</li><li id="f9e5" class="mz na it la b lb nj le nk lh nl ll nm lp nn lt ne nf ng nh bi translated">缓存、更新和刷新—您希望在后台检索新内容的同时即时显示内容。一旦新内容可用，您希望以某种方式显示它。</li></ul><h2 id="2156" class="no md it bd me np nq dn mi nr ns dp mm lh nt nu mo ll nv nw mq lp nx ny ms nz bi translated">网页推送</h2><p id="3396" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">Web push允许应用程序发送推送通知，然后在收到通知后返回内容。</p><ul class=""><li id="02e4" class="mz na it la b lb lc le lf lh oa ll ob lp oc lt ne nf ng nh bi translated">推送和检索有效负载—您希望在内容到达时交付并带回内容。</li><li id="2616" class="mz na it la b lb nj le nk lh nl ll nm lp nn lt ne nf ng nh bi translated">推送有效载荷——你不仅要发送文本，还要发送不同种类的有效载荷，使你的信息更加丰富。</li><li id="d065" class="mz na it la b lb nj le nk lh nl ll nm lp nn lt ne nf ng nh bi translated">丰富推送——你想展示一幅图像、一种振动，以及任何能丰富你想要传达的信息的东西。</li><li id="2c54" class="mz na it la b lb nj le nk lh nl ll nm lp nn lt ne nf ng nh bi translated">推送客户端—您想要根据应用程序的状态显示不同的通知。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0aed" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">更复杂的用例</h1><h2 id="1840" class="no md it bd me np nq dn mi nr ns dp mm lh nt nu mo ll nv nw mq lp nx ny ms nz bi translated">API分析</h2><p id="5ad5" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我有一个网络应用程序。因此，我想添加跟踪其使用情况的能力，并使用sync API不时上传收集的数据。</p><h2 id="ec63" class="no md it bd me np nq dn mi nr ns dp mm lh nt nu mo ll nv nw mq lp nx ny ms nz bi translated">负载平衡器</h2><p id="b0b4" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">您希望根据服务器可用性动态选择最佳内容提供商。在这种情况下，您需要一个服务工作者来拦截对资源的请求，并根据其可用性选择最合适的内容提供者。</p><p id="49c6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我强烈推荐你查看关于如何在<a class="ae ni" href="https://serviceworke.rs/" rel="noopener ugc nofollow" target="_blank">services workers . RS</a>上使用service worker的全部集合、实际例子和更多内容。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5694" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">通过弄脏你的手来掌握你的手艺</h1><p id="4ebb" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">正如我常说的:“跳进水里，看看你会不会游泳。”读这篇文章很好也很有趣，但是真正的娱乐是从你弄脏手指开始的。</p><h2 id="575a" class="no md it bd me np nq dn mi nr ns dp mm lh nt nu mo ll nv nw mq lp nx ny ms nz bi translated">注册服务人员</h2><p id="d60d" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">如果我们快速回忆一下上面描述服务人员生命周期的图片，首先要做的是安装它。要做到这一点，它需要注册的步骤。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/daf09d8dd62922fc843a99b1afff0a06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RgW-rGFd-DGlfT2Ni07LcQ.png"/></div></div></figure><p id="d568" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，你可以通过进入<code class="fe oe of og oh b">Chrome://inspect/#service-workers</code>来检查所有的服务人员都在运行(Chrome inspect image)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/0c59894b6f324cd5cf09d70964236bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2uMdB4WobEEsUS-5MVnT5w.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">镀铬检查—维修工人</p></figure><p id="9b5c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">同样，如果你打开Chrome开发者工具，进入<em class="lu">应用</em> tab - &gt; <em class="lu">服务工作者</em>，你会看到关于服务工作者状态的所有信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/ef5e887cadb6b774f673b1499c56f893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mZvcEtwn78x6502jsG7dfg.gif"/></div></div></figure><h2 id="4bd3" class="no md it bd me np nq dn mi nr ns dp mm lh nt nu mo ll nv nw mq lp nx ny ms nz bi translated">正在安装</h2><p id="be8c" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们需要做的最基本的例子是缓存所有文件。此外，您可以定义要缓存哪些文件。因此，我们可以在<em class="lu">安装</em>步骤中处理这个问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/6f2b26b23308457ff3379598dd3bab7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*52dS-ZXMVPI45M8oKz_C2A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安装维修工人</p></figure><p id="5226" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的代码中，我们所做的是:</p><ol class=""><li id="29a8" class="mz na it la b lb lc le lf lh oa ll ob lp oc lt ok nf ng nh bi translated">为我们的缓存定义一个名称(<code class="fe oe of og oh b">mullinstack.com-v1</code>)。</li><li id="b1d5" class="mz na it la b lb nj le nk lh nl ll nm lp nn lt ok nf ng nh bi translated">定义我们想要缓存的文件。我们定义了一个数组。</li><li id="a400" class="mz na it la b lb nj le nk lh nl ll nm lp nn lt ok nf ng nh bi translated">在<code class="fe oe of og oh b">install eventListener</code>中，我们对浏览器说等待，直到承诺被解决，并且在该函数中，我们打开了一个缓存，它将被存储在名称<code class="fe oe of og oh b">mullinstack.com-v1</code>下。</li><li id="668e" class="mz na it la b lb nj le nk lh nl ll nm lp nn lt ok nf ng nh bi translated">最后，我们将之前定义的所有文件添加到缓存中。</li></ol><h2 id="c672" class="no md it bd me np nq dn mi nr ns dp mm lh nt nu mo ll nv nw mq lp nx ny ms nz bi translated">移除所有不需要的缓存</h2><p id="7841" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">现在，我们需要删除所有不需要的旧版本缓存。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/6f372f7c270a5114625ac38b324bbe41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uxYGeBrKP9-FsjF7udTZgA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">不需要的缓存</p></figure><h2 id="f3f8" class="no md it bd me np nq dn mi nr ns dp mm lh nt nu mo ll nv nw mq lp nx ny ms nz bi translated">返回响应</h2><p id="eedf" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">如果我们不能返回缓存的内容，上面所说的都不重要。所以，你可能想返回一个缓存的响应，对吗？</p><p id="00ff" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这在我们现在将要创建的<em class="lu">获取事件</em>中是可能的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/3475ff18f92b81f881600f781af82311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*erCgeO2hG1Qug7tdkEn2cw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从缓存内容返回响应</p></figure><h2 id="f4a9" class="no md it bd me np nq dn mi nr ns dp mm lh nt nu mo ll nv nw mq lp nx ny ms nz bi translated">完全码</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">【https://codesandbox.io/s/service-workers-5twws T4】</p></figure><p id="1c6a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读！我希望这篇文章对你有所帮助。</p></div></div>    
</body>
</html>