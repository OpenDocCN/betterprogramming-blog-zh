<html>
<head>
<title>Set Up Your Serverless Project With TypeScript, Ready to Deploy to AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用TypeScript设置您的无服务器项目，准备部署到AWS</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/set-up-your-serverless-project-with-typescript-ready-to-deploy-to-aws-6cfd7b2e5263?source=collection_archive---------1-----------------------#2020-06-02">https://betterprogramming.pub/set-up-your-serverless-project-with-typescript-ready-to-deploy-to-aws-6cfd7b2e5263?source=collection_archive---------1-----------------------#2020-06-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="06b1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建一个简单的无服务器TypeScript应用程序启动模板，并设置部署到AWS所需的凭据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e0805bd79804d1f1a38ed9d2cd3407d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_4pLHWd2o1LJ9XvpZEs7WQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:作者</p></figure><p id="3ee7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">作为Doctissimo<a class="ae lr" href="https://www.welcometothejungle.com/en/companies/doctissimo" rel="noopener ugc nofollow" target="_blank">一个伟大团队的首席开发人员，我已经潜心研究云计算三年多了。几个月前，我有机会启动了一个全新的全无服务器项目并为其奠定了基础，该项目旨在管理我们的各种内容索引、更新和发布工作流。</a></p><p id="47ca" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我首先尝试从不同的现有项目模板中获取灵感，尽可能地遵循最佳实践，没有多余的东西。</p><p id="5932" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所以我在这里，通过这个小小的丰富经验，编写一个简单的分步指南，介绍如何构建一个准备部署到AWS的无服务器Typescript项目模板。</p><p id="58f2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是我们要处理的一些事情:</p><ul class=""><li id="137f" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated"><a class="ae lr" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a></li><li id="fc3b" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">以打字打的文件</li><li id="8b5f" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">埃斯林特，更漂亮</li><li id="7d5d" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">AWS身份证明(IAM用户、组、策略)</li><li id="f3c9" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">使用无服务器部署到AWS(创建Lambda、API网关端点等。)</li></ul><p id="b08f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以在<a class="ae lr" href="https://github.com/saybou/serverless-typescript-aws" rel="noopener ugc nofollow" target="_blank"> my GitHub </a>上找到最终结果，准备好与Docker一起使用。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="3071" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">要求</h1><ul class=""><li id="d0ea" class="ls lt iq kx b ky nf lb ng le nh li ni lm nj lq lx ly lz ma bi translated"><a class="ae lr" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a></li><li id="5f1a" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">无服务器</li></ul><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="08b3" class="np mo iq nl b gy nq nr l ns nt">npm install -g serverless</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="e5d2" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">项目初始化</h1><p id="a291" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">让我们开始用无服务器模板aws-nodejs-typescript初始化我们的项目。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="de15" class="np mo iq nl b gy nq nr l ns nt">serverless create --template aws-nodejs-typescript</span></pre><p id="b91d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们有了一个包含一些初始文件的基本模板:示例函数(<code class="fe nx ny nz nl b">handler.ts</code>)、无服务器配置(<code class="fe nx ny nz nl b">serverless.yml</code>)、类型脚本配置(<code class="fe nx ny nz nl b">tsconfig.json</code>)和<code class="fe nx ny nz nl b">webpack.config.js</code>。</p><p id="d23d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们添加一些配置来增强我们的应用程序。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="dc11" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">添加支持类型脚本的ESLint</h1><p id="e3a0" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated"><a class="ae lr" href="https://github.com/typescript-eslint/typescript-eslint/" rel="noopener ugc nofollow" target="_blank">打字稿ESLint </a></p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="5476" class="np mo iq nl b gy nq nr l ns nt">npm install --save-dev eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin</span></pre><ul class=""><li id="1740" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">创造<code class="fe nx ny nz nl b">.eslintrc.js</code></li></ul><p id="4bdb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个文件在这里配置我们的林挺过程，以保持我们的代码质量容易。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><ul class=""><li id="0b63" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">创建<code class="fe nx ny nz nl b">.eslintignore</code>(我们不想丢弃的文件):</li></ul><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="4a1a" class="np mo iq nl b gy nq nr l ns nt">node_modules<br/>.serverless<br/>.vscode<br/>*.config.js<br/>.webpack<br/>**/*.js</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="4b7d" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">添加更漂亮</h1><p id="cd4b" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated"><a class="ae lr" href="https://prettier.io/docs/en/integrating-with-linters.html" rel="noopener ugc nofollow" target="_blank">有绒毛的更漂亮</a></p><p id="5a75" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">只是为了确保我们保持干净的代码格式。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="2328" class="np mo iq nl b gy nq nr l ns nt">npm install --save-dev prettier eslint-config-prettier eslint-plugin-prettier</span></pre><ul class=""><li id="24da" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">创建<code class="fe nx ny nz nl b">.prettierrc.js</code>(只是一个简单漂亮的启动配置):</li></ul><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="b9b9" class="np mo iq nl b gy nq nr l ns nt">module.exports = {<br/>  printWidth: 120,<br/>  singleQuote: true,<br/>  trailingComma: 'all',<br/>};</span></pre><ul class=""><li id="b06f" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">创建<code class="fe nx ny nz nl b">.prettierignore</code>(我们不想运行得更好的文件):</li></ul><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="0598" class="np mo iq nl b gy nq nr l ns nt">node_modules<br/>.serverless<br/>.webpack</span></pre><ul class=""><li id="37a9" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">更新<code class="fe nx ny nz nl b">.eslintrc.js</code>扩展规则(只需添加两个规则来正确地将Prettier集成到我们的林挺工作流中，并防止冲突):</li></ul><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="38cf" class="np mo iq nl b gy nq nr l ns nt">extends: [<br/>  'eslint:recommended',<br/>  'plugin:@typescript-eslint/eslint-recommended',<br/>  'plugin:@typescript-eslint/recommended',<br/>  'prettier/@typescript-eslint',<br/>  'plugin:prettier/recommended',<br/>],</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="3829" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">网络包</h1><p id="fb2a" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">启用在单独的进程上运行TypeScript类型检查器的Webpack插件。</p><p id="d856" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">更新<code class="fe nx ny nz nl b">webpack.config.js</code>:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="f873" class="np mo iq nl b gy nq nr l ns nt">plugins: [<br/>  new ForkTsCheckerWebpackPlugin({<br/>    eslint: true,<br/>    eslintOptions: {<br/>      cache: true,<br/>    },<br/>  }),<br/>],</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="f394" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">用正确的类型更新处理程序</h1><p id="da1a" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">让我们更新<code class="fe nx ny nz nl b">handler.ts</code>，设置正确的类型，以便类型检查验证可以成功。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="75a1" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">NPM剧本</h1><p id="0aab" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">让我们为<code class="fe nx ny nz nl b">package.json</code>中的应用程序添加一些运行脚本:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="29c9" class="np mo iq nl b gy nq nr l ns nt">"scripts": {<br/>  "lint": "eslint . --ext js,ts --cache --fix",<br/>  "prettier": "prettier --list-different './**/*.{js,ts}'",<br/>  "typecheck": "tsc --noEmit",<br/>  "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"<br/>},</span></pre><p id="eb7a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">测试它:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="d228" class="np mo iq nl b gy nq nr l ns nt"># linter<br/>npm run lint</span><span id="e59f" class="np mo iq nl b gy oc nr l ns nt"># prettier<br/>npm run prettier</span><span id="7101" class="np mo iq nl b gy oc nr l ns nt"># type checking<br/>npm run typecheck</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><p id="35ed" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们已经准备好将我们的应用程序部署到AWS。不完全是。我们需要设置一些AWS凭证，特别是我们需要一个AWS用户来部署我们的应用程序。</p><p id="523c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您还没有AWS帐户，我邀请您尽快<a class="ae lr" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">创建一个</a>。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="0a44" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">配置AWS凭据</h1><p id="21d9" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">在这里，我们希望创建一个新的IAM策略，并将其附加到一个新的IAM组，我们将把我们的新用户附加到该组。</p><h2 id="9317" class="np mo iq bd mp od oe dn mt of og dp mx le oh oi mz li oj ok nb lm ol om nd on bi translated">创建IAM用户</h2><p id="725e" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">登录到您的AWS控制台，然后转到身份和访问管理(IAM)服务。创建一个新用户<code class="fe nx ny nz nl b">serverless-deploy</code>，具有编程访问权限。不要给它任何权限。</p><p id="3e61" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，您将能够保存您的用户凭证(不要丢失它们，否则您将需要获取新的凭证)。</p><p id="c876" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面让我们看看如何使用您的凭据。(您可以在<a class="ae lr" href="https://www.serverless.com/framework/docs/providers/aws/guide/credentials/" rel="noopener ugc nofollow" target="_blank">官方文档</a>中找到使用无服务器凭证的不同方式。)</p><h2 id="62cd" class="np mo iq bd mp od oe dn mt of og dp mx le oh oi mz li oj ok nb lm ol om nd on bi translated">使用无服务器设置您的用户凭据</h2><p id="9928" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">将您的AWS配置文件声明到<code class="fe nx ny nz nl b">~/.aws/credentials</code>(不要忘记设置您自己的值):</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="57a4" class="np mo iq nl b gy nq nr l ns nt">[serverless-deploy]<br/>aws_access_key_id = XXX<br/>aws_secret_access_key = XXX<br/>region = XXX</span></pre><p id="8ca9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在您的<code class="fe nx ny nz nl b">serverless.yml</code>中设置此配置文件，以便无服务器可以使用它进行部署。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="93f3" class="np mo iq nl b gy nq nr l ns nt">provider:<br/>  profile: serverless-deploy</span></pre><p id="cd64" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">或者可以用<code class="fe nx ny nz nl b">--profile</code>参数将它传递给<code class="fe nx ny nz nl b">serverless deploy</code>命令。</p><p id="5704" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，尝试部署您的无服务器应用程序。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="eb80" class="np mo iq nl b gy nq nr l ns nt">serverless deploy -v</span><span id="9040" class="np mo iq nl b gy oc nr l ns nt"># -v enables verbose output so you can see what happens</span></pre><p id="393b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您应该会看到以下错误:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="2329" class="np mo iq nl b gy nq nr l ns nt">serverless-deploy is not authorized to perform: cloudformation:DescribeStacks</span></pre><p id="2447" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这已经足够清楚了:)所以我们现在需要将这个IAM用户权限授予我们的用户。</p><h2 id="d36d" class="np mo iq bd mp od oe dn mt of og dp mx le oh oi mz li oj ok nb lm ol om nd on bi translated">IAM组和IAM策略</h2><p id="a651" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">让我们回到AWS控制台，创建一个没有任何策略的新IAM组<code class="fe nx ny nz nl b">serverless-deploy-group</code>。</p><p id="ee60" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，让我们创建一个新的IAM策略:</p><ul class=""><li id="9a25" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">创建新的IAM策略。</li><li id="0ef7" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">为CloudFormation服务添加一个策略，允许<code class="fe nx ny nz nl b">List:DescribeStacks</code>操作。</li><li id="6125" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">指明将此权限应用于所有资源，然后单击“审阅策略”按钮。(如有必要，您可以指定特定的资源来应用权限。)</li><li id="25d7" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">将这个策略命名为<code class="fe nx ny nz nl b">serverless-deploy-policy</code>(只是为了保持一致)，然后完成创建。</li></ul><p id="4c31" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在回到我们创建的组<code class="fe nx ny nz nl b">serverless-deploy-group</code>,并将其附加到该策略。</p><p id="b834" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后返回到用户<code class="fe nx ny nz nl b">serverless-deploy</code>并将其附加到组<code class="fe nx ny nz nl b">serverless-deploy-group</code>。</p><p id="df30" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们再次尝试部署:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="efce" class="np mo iq nl b gy nq nr l ns nt">serverless deploy -v</span></pre><p id="06c3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，您应该看到以下新错误:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="7a21" class="np mo iq nl b gy nq nr l ns nt">serverless-deploy is not authorized to perform: cloudformation:CreateStack on resource</span></pre><p id="7996" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们现在必须编辑我们的策略并添加一些新的权限。</p><h2 id="dc93" class="np mo iq bd mp od oe dn mt of og dp mx le oh oi mz li oj ok nb lm ol om nd on bi translated">扩展您的IAM策略</h2><p id="4312" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">回到我们创建的<code class="fe nx ny nz nl b">serverless-deploy-policy</code>策略，编辑它，并为CloudFormation服务添加<code class="fe nx ny nz nl b">CreateStack</code>权限。</p><p id="9fe2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以尝试再次部署并添加每个缺失的策略。这是确保只添加必要权限的最佳方式。有时需要逐步手动删除资源，以便能够再次测试新的完整部署。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="a8c7" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">基本策略示例</h1><p id="d8ac" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">对于此示例项目，以下是所需的最低权限:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在AWS上部署无服务器应用程序的基本IAM策略</p></figure><p id="6834" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦您设置了最终策略，您就可以执行完全部署了。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="3bc3" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">部署</h1><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="bbe4" class="np mo iq nl b gy nq nr l ns nt">serverless deploy -v</span></pre><p id="d36f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">默认情况下假定为开发阶段。</p><p id="ae85" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">无服务器是做什么的？</p><ul class=""><li id="1db0" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">打包我们的应用程序(使用webpack)</li><li id="a9e6" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">创建云形成堆栈</li><li id="f98e" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">创建一个S3桶</li><li id="ec4a" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">上传云层模板到S3</li><li id="3d8c" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">将我们的应用程序包上传到S3</li><li id="2930" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">设置IAM角色</li><li id="7054" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">设置日志组</li><li id="52c0" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">配置ApiGateway端点</li><li id="544d" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">为我们的服务提供Lambda函数</li></ul><p id="ea0f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您现在可以调用您的服务:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="1358" class="np mo iq nl b gy nq nr l ns nt">serverless invoke -f hello -l</span><span id="91d8" class="np mo iq nl b gy oc nr l ns nt"># -f specifies the function name, -l specifies to output the logs to the console</span></pre><p id="d43b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您还可以使用API网关端点来测试它，当部署结束时，它会打印在您的终端中。它应该是这样的(替换[xxxxxx]和[region]):</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="4345" class="np mo iq nl b gy nq nr l ns nt"><a class="ae lr" href="https://[xxxxxx].execute-api.[region].amazonaws.com/dev" rel="noopener ugc nofollow" target="_blank">https://[xxxxxx].execute-api.[region].amazonaws.com/dev</a></span></pre><h1 id="935e" class="mn mo iq bd mp mq oo ms mt mu op mw mx jw oq jx mz jz or ka nb kc os kd nd ne bi translated">删除您的服务</h1><p id="a799" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">您可以简单地删除所有以前创建的堆栈。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="69f0" class="np mo iq nl b gy nq nr l ns nt">serverless remove</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="acb5" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">包扎</h1><p id="b5e7" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">感谢阅读！我希望你喜欢这篇文章，并从中获得一些有用的东西。现在，您应该准备好使用Serverless、TypeScript和ESLint启动自己的项目，并将其部署到AWS。</p><p id="4cb9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以在<a class="ae lr" href="https://github.com/saybou/serverless-typescript-aws" rel="noopener ugc nofollow" target="_blank"> my GitHub </a>上找到这篇文章的最终结果，准备与Docker一起使用。</p><p id="e1d2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在是你的时候了！更新您的功能，更新您的无服务器提供商配置，创建新的功能，并根据您的需要部署您自己的服务！</p></div></div>    
</body>
</html>