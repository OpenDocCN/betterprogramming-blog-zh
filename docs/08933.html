<html>
<head>
<title>How To Send Form Data With Files Using Python’s Flask and Dropzone.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python的Flask和Dropzone.js发送带有文件的表单数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-send-form-data-with-files-using-pythons-flask-and-dropzone-js-855b0ef8f000?source=collection_archive---------4-----------------------#2021-06-28">https://betterprogramming.pub/how-to-send-form-data-with-files-using-pythons-flask-and-dropzone-js-855b0ef8f000?source=collection_archive---------4-----------------------#2021-06-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c303" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用web应用程序传递多个文件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4bf0afdb1a1fe1e2bd97c3dc7300b506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PzfOHeVIl7LNGUlV"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@homajob?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯科特·格雷厄姆</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="4cb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.dropzonejs.com/" rel="noopener ugc nofollow" target="_blank"> Dropzone.js </a>是一个非常酷的JavaScript库，你可以通过拖拽文件到一个区域来立即上传文件。然后Dropzone完成剩下的工作，把你的文件发送到你指定的地方保存。您可以删除多个文件或单个文件。Flask 是一个WSGI web应用程序框架，使构建web应用程序变得容易。如果你想使用基本的Dropzone，有一个很棒的教程叫做“<a class="ae ky" href="https://blog.miguelgrinberg.com/post/handling-file-uploads-with-flask" rel="noopener ugc nofollow" target="_blank">用Flask </a>处理文件上传。”</p><p id="5f83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您想将Dropzone添加到现有表单中，并通过Flask后端接收文件和表单数据，该怎么办呢？这是一个我在网上看到被问了不止一次的问题，所以这里有一个简单的方法来使用Flask和Dropzone发送多个文件和表单数据，只需点击一个“提交”按钮。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3356" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么要一起发送文件和表单数据？</h1><p id="77c4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可能希望同时发送文件和表单数据有几个原因:</p><ul class=""><li id="f4e4" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">如果您想要将正在收集的文件发送到API，您可能需要收集API密钥、令牌或类似的东西来完成上传。</li><li id="eccb" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">如果您希望将文件与某个人或有关文件的数据相关联，您可能需要收集表单数据来实现这一目的。</li><li id="f47a" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">如果您希望允许其他人在发送时修改他们的文件信息。例如，您可能想让他们有机会在发送文件时更改文件名。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4b0e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">先决条件</h1><p id="e866" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你需要准备一些东西来开始:</p><ul class=""><li id="281c" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">Python已安装。</li><li id="7124" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">项目的虚拟环境(可选，但推荐)。</li><li id="aad3" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">烧瓶安装完毕。</li><li id="e0ea" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">请求已安装。</li><li id="5154" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">参见GitHub 上的项目<a class="ae ky" href="https://github.com/erikkai/flask_and_dropzone/tree/main" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><p id="41dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nn">注:本项目基于</em> <a class="ae ky" href="https://blog.miguelgrinberg.com/post/handling-file-uploads-with-flask" rel="noopener ugc nofollow" target="_blank"> <em class="nn">米格尔·格林伯格的烧瓶和Dropzone教程</em> </a> <em class="nn">。</em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="567a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">HTML文件里有什么？</h1><p id="d890" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了简单起见，我创建了一个简单的表单。让我们来看看HTML的不同部分。</p><h2 id="0df5" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">表单</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="df4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我包含了这个片段以供参考。如果您想一起查看所有内容，请从<a class="ae ky" href="https://github.com/erikkai/flask_and_dropzone" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中抓取代码示例。您可以在正文标签之间看到，表单正在做一些事情:</p><ol class=""><li id="4b4d" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu oc nf ng nh bi translated"><code class="fe od oe of og b">form action=“/”</code> <strong class="lb iu"> </strong>当您点击“提交”按钮时，会告诉您想要将信息发送到哪里。您也可以通过Dropzone配置包含此信息。我在这里描述它，因为一个容易犯的错误是假设Dropzone自动知道将所有东西发送到哪里。如果您指定使用Dropzone，或者，正如我所选择的，使用表单操作，就会出现这种情况。</li><li id="2da4" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu oc nf ng nh bi translated"><code class="fe od oe of og b">class=“dropzone”</code>让Dropzone知道您想在哪里放置一个区域。</li><li id="8a76" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu oc nf ng nh bi translated"><code class="fe od oe of og b">id=“my-dropzone”</code> <strong class="lb iu"> </strong>是您需要引用表单并添加您的配置选项的Dropzone。</li><li id="4bd5" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu oc nf ng nh bi translated"><code class="fe od oe of og b">method=“POST”</code> <strong class="lb iu"> </strong>明确表示希望<code class="fe od oe of og b">POST</code>形成数据和文件。如果您不选择该选项，它会尝试用<code class="fe od oe of og b">GET</code>发送您的信息，这意味着该文件将被忽略。</li></ol><p id="f748" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">表单的其余部分只是设置“提交”按钮和您想要的字段。如果您想知道多部分设置在哪里，您不需要它，因为您正在使用Dropzone。根据您决定创建的内容，您可能需要添加它。</p><h2 id="c70d" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">属国</h2><p id="ec5f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在<code class="fe od oe of og b">head</code>标签之间，您可以看到您需要的所有不同的脚本和样式表。Dropzone很灵活，所以如果你想用不同的方式做事，你可以。您也可以将Dropzone <code class="fe od oe of og b">.js</code>和<code class="fe od oe of og b">.css</code>文件放入一个静态文件夹中，以便Flask查找。我选择用cdn代替它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h2 id="614a" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">Dropzone配置脚本</h2><p id="231f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可以将Dropzone的配置脚本放在几个地方，包括在您引用的单独文件中。我选择使用脚本标签将它添加到HTML文件的依赖项下。配置如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="4a88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要设置，您有<code class="fe od oe of og b">myDropzone</code>。这是对您的表单的引用，在该表单中，您将id放置为“my-dropzone”。无论您选择什么名字，您都要根据破折号的位置将名字放在camel大小写中。所以如果你有“我的-惊人的-dropzone”，它将是<code class="fe od oe of og b">myAmazingDropzone</code>。对于这些选项，您可以设置:</p><ul class=""><li id="47ad" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><code class="fe od oe of og b">autoProcessQueue</code>至<code class="fe od oe of og b">false</code>。这告诉Dropzone不要自动抓取您的文件并将其发送出去。</li><li id="a984" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe od oe of og b">uploadMultiple</code>到<code class="fe od oe of og b">true</code>。如果你想一次拖放一堆文件，你需要将这个设置为<code class="fe od oe of og b">true</code>。</li><li id="fa98" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe od oe of og b">parallelUploads</code>到<code class="fe od oe of og b">10</code>,因为我认为用十个来测试对这个演练来说可能已经足够了。这是同时尝试上传的文件数量。</li><li id="a3e6" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe od oe of og b">maxFiles</code>表示您希望某人一次能放下多少文件。我又放<code class="fe od oe of og b">10</code>了。</li></ul><p id="97b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们向“提交”按钮添加一个事件监听器。我们可以通过按钮的类型来引用它，所以不需要ID。然后我们告诉Dropzone在点击“提交”按钮时上传所有内容。表格到此为止。接下来我们一起去看看<code class="fe od oe of og b">app.py</code>吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5a36" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">app.py文件里有什么？</h1><p id="0d3d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe od oe of og b">app.py</code>的代码看起来是这样的(完整代码，请访问<a class="ae ky" href="https://github.com/erikkai/flask_and_dropzone/blob/main/app.py" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上的示例):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="6bf9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在格林伯格的教程中阅读关于这段代码的详细讨论。我在这里所做的更改是:</p><ul class=""><li id="3832" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">制作这个关于视频的样本。对于上传扩展，我只允许上传视频。您可以将其更改为文本文件或图像。或者，如果你根本不担心保护你的文件，你可以摆脱上传扩展配置。</li><li id="1af6" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">使得处理表单数据和文件成为可能。需要注意的重要一点是，您的文件和表单位于请求信息的两个不同部分。<code class="fe od oe of og b">request.form</code>将包含您添加的所有字段，而<code class="fe od oe of og b">request.files</code>将包含您的文件信息。文件在一个不可变的多字典中。</li><li id="0d9c" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">保留<code class="fe od oe of og b">files</code>对象。您可以看到，我只是更新了项目中的文件名，而不是从<code class="fe od oe of og b">my_files</code>中的项目中取出文件名。</li><li id="f911" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">添加一个点，在这里我获取表单数据并将其写入文本文件。你可以做很多其他的事情，比如添加一个数据库或者以其他方式处理这些信息。这只是提供一个简单的例子。顺便说一下，在这个例子中，所有文件都存储在同一个目录中。</li></ul><p id="c3bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你正在处理图像并且想要缩略图，你可能想要浏览格林伯格的教程，因为他提供了一种方法。如果您想了解代码片段中的各种安全特性，这也是一个有用的教程。</p><p id="349c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据文件的大小，您可能想要更改<code class="fe od oe of og b">MAX_CONTENT_LENGTH</code>配置以接受更大的文件，而不仅仅是<code class="fe od oe of og b">1024 * 1024</code>。</p><p id="77a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以在<a class="ae ky" href="https://www.dropzonejs.com/" rel="noopener ugc nofollow" target="_blank"> Dropzone.js </a>网站上找到更多Dropzone信息。我希望这有助于您开始使用Dropzone处理多个文件和表单数据！</p></div></div>    
</body>
</html>