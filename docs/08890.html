<html>
<head>
<title>Manage Secrets in Your iOS App Using Xcode Configuration Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Xcode配置文件管理iOS应用程序中的机密</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/manage-secrets-in-your-ios-app-using-xcode-configuration-files-fbceb6e97f47?source=collection_archive---------5-----------------------#2021-06-23">https://betterprogramming.pub/manage-secrets-in-your-ios-app-using-xcode-configuration-files-fbceb6e97f47?source=collection_archive---------5-----------------------#2021-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c38a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">保护您的API密钥和其他敏感数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/aad6f7188b725e3a61e4b1a041fba3f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A9eBHrLrFkRTz4nt"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Dmitry Chernyshov 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="56f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将学习如何使用Xcode配置文件(<code class="fe lv lw lx ly b">.xcconfig</code>)管理iOS应用中的API键等敏感数据。这是我们将在本教程中掌握的内容:</p><ul class=""><li id="d9e7" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated">如何创建Xcode配置文件？</li><li id="ad1a" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">如何从Swift代码中的配置文件访问API密钥。</li><li id="34f4" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">如何运行和管理不同的生成配置。</li></ul></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="67df" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">我们开始吧</h1><p id="148d" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">考虑这个名为“ManagingSecrets”的空项目，它还不包含任何内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/4f859b7ead7510a944aa11ba10d7b1f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*HK0n26jkUV0www-mAMaCHw.png"/></div></figure><p id="fecd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的目标是保护一个API密钥，并在一个<code class="fe lv lw lx ly b">ViewController.swift</code>文件中访问它。首先，让我们创建一个配置设置文件。点击文件&gt;新建，并在搜索字段中输入“配置”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/3288fc123e5dbed308d5b6f575f1db4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fpJX2HMps89BLOg02YwQwA.png"/></div></div></figure><p id="9d07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，选择“下一步”，并将文件命名为<code class="fe lv lw lx ly b">Secrets.xcconfig</code>(不要将该文件附加到目标上):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/955732266afa5c207e8dc4661fe8de44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q3S4s6-A03X72wD4WNv57A.png"/></div></div></figure><p id="33e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以打开文件并添加我们的API密钥:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/20584e6d4832065923aca9c83b152e95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bxG0kfIXd5IiYLbJAmsZsQ.png"/></div></div></figure><p id="f716" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了！我们的API密钥已经添加。现在让我们点击项目，选择“信息”选项卡，并展开<em class="nv">调试</em>和<em class="nv">发布</em>配置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/57f6fcf78019414a7a7258eaeb22f108.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*azET3C4Glku-Du3qqt5uzQ.png"/></div></div></figure><p id="c512" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是将<code class="fe lv lw lx ly b">Secrets.xcconfig</code>文件附加到每个配置，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/3e8ace7fe9889ebd4fe1475dd3a2963e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IFURDuoxXl0Q-yR72vrJzg.png"/></div></div></figure><p id="0502" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成后，配置如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/db0ce2b80c35371770a7463f1447042c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*glYDBMszMZV8MxOMqjAOKw.png"/></div></div></figure><p id="93d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在实际访问代码中的API键之前，我们需要做的最后一步是用一个新的<code class="fe lv lw lx ly b">API_KEY</code>字段更新我们的<code class="fe lv lw lx ly b">Info.plist</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/58dc0e9722cf1cec23a01bfac8fd73c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MDsNEMMX51smvTPyNlS0Tg.png"/></div></div></figure><p id="4344" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们准备在<code class="fe lv lw lx ly b">ViewController.swift</code>文件中获取我们的API密钥。让我们按如下方式更新<code class="fe lv lw lx ly b">viewDidLoad()</code>方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><ol class=""><li id="3c51" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu oc mf mg mh bi translated">我们在<code class="fe lv lw lx ly b">Info.plist</code>文件中搜索<code class="fe lv lw lx ly b">“API_KEY”</code>值。</li><li id="3c20" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu oc mf mg mh bi translated">我们确保密钥不为空。</li><li id="39be" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu oc mf mg mh bi translated">如果是空的，我们就打印一条消息。</li><li id="79fa" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu oc mf mg mh bi translated">否则，我们打印找到的API密钥。</li></ol><p id="01b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们构建并运行该应用程序，我们将会看到如预期的那样打印出API密钥:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/0b23e1f2e153bcdcca7de2bdefc96547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6XIWfrlgVBY6MXBSO4amxg.png"/></div></div></figure><p id="2878" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很好，但是我们如何为<code class="fe lv lw lx ly b">Debug</code>和<code class="fe lv lw lx ly b">Release</code>配置创建不同的API键呢？事实证明这非常容易，您将能够忘记每次在调试和生产服务器API之间切换时手动更改硬编码的字符串。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="192a" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">管理不同的配置</h1><p id="f4b6" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我们只需要创建两个不同的<code class="fe lv lw lx ly b">.xcconfig</code>文件，即<code class="fe lv lw lx ly b">SecretsDebug.xcconfig</code>和<code class="fe lv lw lx ly b">SecretsRelease.xcconfig</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/2c25ed99813250798556c49fde8a2864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*taYimvFPmX2lpB5wki7O-g.png"/></div></figure><p id="8a22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个文件包含不同的<code class="fe lv lw lx ly b">API_KEY</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/fb890db721ec417b8bd350c6bb1756eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YILFLiMKtudRqh0sJgn_zQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">SecretsDebug.xcconfig</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/d99995bd2ce34a2849d4fcc910808c4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eQ5I8SPqvGd1AceVFXe8Zw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">SecretsRelease.xcconfig</p></figure><p id="01b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们应该将<code class="fe lv lw lx ly b">SecretsDebug.xcconfig</code>分配给<code class="fe lv lw lx ly b">Debug</code>配置，将<code class="fe lv lw lx ly b">SecretsRelease.xcconfig</code>分配给<code class="fe lv lw lx ly b">Release</code>配置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/9200f5d42f57ba4885321e741a76521a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4H-1TNG__BwtrqC-1goqVw.png"/></div></div></figure><p id="6657" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的<code class="fe lv lw lx ly b">Info.plist</code>不变。它只是引用当前活动配置文件中的<code class="fe lv lw lx ly b">API_KEY</code>值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/9f85d6fd4d623d08ed3c5d12d862285d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*myijeRG35OYMUZhsYKuFQQ.png"/></div></div></figure><p id="4879" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，当我们在Simulator中运行应用程序时，会选择一个<code class="fe lv lw lx ly b">Debug</code>配置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/c4e44b512f38f94cd45ddaa05b402712.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ihv175aH06HAhkeu1J85mQ.png"/></div></div></figure><p id="b4c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要切换到<code class="fe lv lw lx ly b">Release</code>配置，我们需要做的就是改变我们应用的方案:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/247e58cd98de2da40573421f452830ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJ-bJ-rqH_lpI0Lv-eRMbQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/cb615a6d213787173b74eceb6c15e52a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_XEcykqM3qpene1inzS_cg.png"/></div></div></figure><p id="8067" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们构建并运行应用程序，我们会看到使用了API密钥的发布版本:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/5c563d89281eec131ec2c291d1b0b7e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hue-e1AR64xGLlyVRYtfoQ.png"/></div></div></figure><p id="faa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了！我们设法方便地使用不同的API键，而不改变我们代码库中的一个<code class="fe lv lw lx ly b">String</code>。</p><p id="489a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">注意:一定要记住将这些</em> <code class="fe lv lw lx ly b"><em class="nv">Secret.xcconfig</em></code> <em class="nv">文件置于版本控制之外。只需将它们包含在您的</em> <code class="fe lv lw lx ly b"><em class="nv">.gitignore</em></code> <em class="nv">文件中，您就可以避免将您的敏感数据泄露给其他人。即使你在一个团队中工作，其他开发人员也会使用他们自己的本地</em> <code class="fe lv lw lx ly b"><em class="nv">.xcconfig</em></code> <em class="nv">文件来保存这些秘密。</em></p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="91e6" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">包扎</h1><p id="accd" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">为了更深入地了解这种管理环境的方法和使用不同目标的方法之间的区别，我建议看一看<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-create-development-staging-and-production-configs-in-xcode-ec58b2cc1df4">这篇由<a class="on oo ep" href="https://medium.com/u/888a93a11b2d?source=post_page-----fbceb6e97f47--------------------------------" rel="noopener" target="_blank">斯文·科塞特</a>撰写的伟大文章</a>。</p><p id="66ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这个教程对你有用。感谢阅读！</p></div></div>    
</body>
</html>