<html>
<head>
<title>Build the Apple Stocks App Using Flutter (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flutter构建苹果股票应用程序(第2部分)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-the-apple-stocks-app-using-flutter-part-2-b1d4f04f7e4a?source=collection_archive---------16-----------------------#2020-01-14">https://betterprogramming.pub/build-the-apple-stocks-app-using-flutter-part-2-b1d4f04f7e4a?source=collection_archive---------16-----------------------#2020-01-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="778b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">跨平台股票报价</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/22b32a5361390e7daadd972547e470a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mEVBoU_WViTu1DS_q7b89Q.png"/></div></div></figure><p id="27c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本系列的第一篇文章中，我们介绍了如何在你的Flutter应用程序中显示股票。我们创建了一个JSON API，内置Node和Express，它将虚拟股票返回给Flutter应用程序。</p><p id="2990" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这段代码中，我们将通过在自定义新闻视图中显示新闻来完成股票应用程序。用户还可以使用手势在新闻视图上执行向上滑动和向下滑动操作。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="8fb1" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">更新服务器</h1><p id="a1f6" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">我们将首先向我们的<a class="ae lq" href="https://glitch.com/edit/#!/silicon-rhinoceros?path=README.md:1:0" rel="noopener ugc nofollow" target="_blank">服务器</a>添加一个新的端点，它将负责向用户提供假的JSON新闻。实现如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="d13c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">与股票端点一样，我们只是简单地返回一个文章列表作为硬编码的JSON响应。如果你喜欢冒险，你可以试试NewsAPI.org T21服务，它可以用来传回实时新闻。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="0c68" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">使用Flutter获取头条新闻</h1><p id="a1e9" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">下一步是从JSON API获取新闻。这是我们的HTTP客户端的责任，由<code class="fe mx my mz na b">Webservice</code>类表示。<code class="fe mx my mz na b">getTopNews</code>功能的实现如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="5230" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">函数<code class="fe mx my mz na b">getTopNews</code>类似于<code class="fe mx my mz na b">getStocks</code>，它只是使用URL来获取数据。稍后，数据被填充到<code class="fe mx my mz na b">NewsArticle</code>模型中。<code class="fe mx my mz na b">NewsArticle</code>模型的实现如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="4f3d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">NewsArticle</code>模型由三个属性组成:标题、出版物和imageURL。<code class="fe mx my mz na b">fromJson</code> <strong class="kw iu"> </strong>函数作为工厂方法，基于json对象创建一个新的<code class="fe mx my mz na b">NewsArticle</code>实例。既然我们的web服务和模型已经完成，我们就可以专注于实现视图模型了。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="842d" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">实现NewsArticleViewModel</h1><p id="4d67" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated"><code class="fe mx my mz na b">NewsArticleViewModel</code>负责向视图提供新闻数据。<code class="fe mx my mz na b">NewsArticleViewModel</code>的实现如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="106e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">NewsArticleViewModel</code>接受<code class="fe mx my mz na b">NewsArticle</code>模型作为参数，并公开几个属性来访问与<code class="fe mx my mz na b">title</code>、<code class="fe mx my mz na b">publication</code>和<code class="fe mx my mz na b">imageURL</code>相关的数据。</p><p id="3a1a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们可以更新我们的<code class="fe mx my mz na b">StockListViewModel</code>来添加一个新的<code class="fe mx my mz na b">load</code>函数。这将负责从我们的自定义API获取股票和新闻。<code class="fe mx my mz na b">load</code>功能实现如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="741b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在load函数中，我们使用<code class="fe mx my mz na b">Future.wait</code>来等待两个期货的完成。一旦期货完成，它返回与期货相关的值的列表。我们使用数组上的第一个和最后一个辅助函数来访问这些值，最后调用<code class="fe mx my mz na b">notifyListeners()</code>。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="2cb7" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">显示头条新闻</h1><p id="19b2" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">下一步是在视图上显示热门新闻文章。我们实现了一个<code class="fe mx my mz na b">NewsList</code>小部件，它将负责在屏幕上填充新闻。<code class="fe mx my mz na b">NewsList</code>小部件需要三个参数:</p><ul class=""><li id="c046" class="nb nc it kw b kx ky la lb ld nd lh ne ll nf lp ng nh ni nj bi translated"><code class="fe mx my mz na b">articles</code> —代表要在屏幕上显示的新闻文章</li><li id="9db9" class="nb nc it kw b kx nk la nl ld nm lh nn ll no lp ng nh ni nj bi translated"><code class="fe mx my mz na b">onHeaderTap</code> —当用户点击标题时触发的回调函数</li><li id="59e4" class="nb nc it kw b kx nk la nl ld nm lh nn ll no lp ng nh ni nj bi translated"><code class="fe mx my mz na b">onDragUpdate</code> —当用户拖动视图时触发的回调函数</li></ul><p id="3fd1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们没有在<code class="fe mx my mz na b">NewsList</code>视图中处理事件，而是给了父视图机会。这意味着父节点负责传递文章和实现<code class="fe mx my mz na b">onHeaderTap</code>和<code class="fe mx my mz na b">onDragUpdate</code>事件。</p><p id="be7c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是<code class="fe mx my mz na b">NewsList</code>小部件的完整实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="9816" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">大部分代码用于设置<code class="fe mx my mz na b">NewsList</code>的用户界面。我们还使用了<code class="fe mx my mz na b">GestureDetector</code>来处理触摸事件。<code class="fe mx my mz na b">onTap</code>和<code class="fe mx my mz na b">onVerticalDragUpdate</code>事件被映射到<code class="fe mx my mz na b">onHeaderTapped</code>和<code class="fe mx my mz na b">onDragUpdate</code>闭包，这意味着它们将由父事件处理。</p><p id="1af4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在父视图中，我们使用<code class="fe mx my mz na b">AnimatedContainer</code>来制作拖动动作的动画。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="4aa5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">基于拖动的方向，我们扩展和压缩<code class="fe mx my mz na b">NewsList </code>视图。动画如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/af7a336fcd2cb5419e1db51b3a0f5b82.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/1*UECrI4jNa8sFnRkA6_l1IQ.gif"/></div></figure><p id="1df3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个由两部分组成的系列中，您了解了如何在Flutter中创建一个Apple Stocks应用程序。我们还使用了<code class="fe mx my mz na b">MVVM</code>和<code class="fe mx my mz na b">Provider</code>模式来构建我们的Flutter应用程序，这导致了一个更加结构化和可维护的代码库。</p><p id="aa3f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://github.com/azamsharp/AppleStocksFlutter" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="36e5" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">资源</h1><ul class=""><li id="f9cc" class="nb nc it kw b kx mq la mr ld nq lh nr ll ns lp ng nh ni nj bi translated"><a class="ae lq" href="https://medium.com/better-programming/building-apple-stocks-app-using-flutter-part-1-ea1c7477d58d" rel="noopener">使用Flutter Part 1 </a>构建苹果股票应用程序</li><li id="fd6e" class="nb nc it kw b kx nk la nl ld nm lh nn ll no lp ng nh ni nj bi translated"><a class="ae lq" href="https://www.udemy.com/course/flutter-dart-mvvm-design-pattern/?referralCode=3E32698D188E47553501" rel="noopener ugc nofollow" target="_blank">飘起&amp;飞镖——使用MVVM设计模式构建应用</a></li></ul></div></div>    
</body>
</html>