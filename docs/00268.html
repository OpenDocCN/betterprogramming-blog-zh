<html>
<head>
<title>4 Ways to Calculate a Running Total With SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SQL计算累计的4种方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/4-ways-to-calculate-a-running-total-with-sql-986d0019185c?source=collection_archive---------0-----------------------#2019-01-14">https://betterprogramming.pub/4-ways-to-calculate-a-running-total-with-sql-986d0019185c?source=collection_archive---------0-----------------------#2019-01-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c025" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">描述和解释“添加”到你的武器库中的方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5fba0dde450878ac27860a32382a956f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p2otplWrqykjC0As_v3ieg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯·贾维斯在<a class="ae ky" href="https://unsplash.com/search/photos/addition?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6cb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在SQL中计算累计/滚动和是一项有用的技能。</p><p id="ae9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于报告，甚至在开发应用程序时，它经常会派上用场。也许你的用户可能想看到他们获得的积分或他们赚到的钱的累计。像<a class="ae ky" href="https://www.theseattledataguy.com/how-to-write-better-sql-advanced-sql-episode-1/" rel="noopener ugc nofollow" target="_blank"> SQL </a>中的大多数问题一样，有多种方法可以解决这个问题。</p><p id="2dae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用分析函数、自联接或跟踪运行总和的聚合表。让我们来看几个例子。</p><p id="c9d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想看视频形式的解释，请直接跳到底部。</p><h1 id="348e" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">加入我们的时事通讯</h1><p id="2c71" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在继续滚动之前，为什么不加入我们团队的时事通讯，了解数据科学、数据工程和技术的最新动态！<a class="ae ky" href="https://seattledataguy.substack.com/" rel="noopener ugc nofollow" target="_blank">在这里了解更多</a>。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="df5b" class="lw lx it bd ly lz na mb mc md nb mf mg jz nc ka mi kc nd kd mk kf ne kg mm mn bi translated">使用解析函数</h1><p id="88cc" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">使用分析函数是计算累计最简单的方法。分析函数允许您按特定字段对数据进行分区。例如，在这种情况下，我们可以通过driver_id和month来分解滚动总和。这将给我们按客户和月份的运行总数。所以每个月都会从0重新开始。</p><p id="d860" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请参见下面的查询，了解如何使用分析函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="3611" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可能有助于比较司机每月每天带来的利润。您可能能够发现某种趋势，并帮助您注意到不良驱动程序，或者使用它来生成驱动程序的性能报告。</p><p id="1ce5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们可以很容易地在不同的日子之间切换，看看他们在一个月的某一天赚了多少。</p><p id="a96f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在面试中使用分析功能有时会让面试官问你是否知道解决问题的不同方法。这并不是说你的答案是错的，只是他们可能对你的想法感兴趣。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="bb4d" class="lw lx it bd ly lz na mb mc md nb mf mg jz nc ka mi kc nd kd mk kf ne kg mm mn bi translated">使用自联接</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/82728fa33c383a08a345d0e6969f95b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*ygSaANMlTCPsWYeuDQBtzA.png"/></div></figure><p id="ed2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决累计问题的另一个选择是使用自连接。自联接是指将表联接到自身。与对所有值使用“=”的典型连接不同，我们将对多个值进行连接。首先，我们将正常地加入驾驶员id和月份/年份，然后我们将加入旅行的日期。当我们加入旅行日期时，我们将使用&gt; =符号。这将联接一个表中大于另一个表中的所有日期。</p><p id="4cca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果我们看下面的查询，我们会看到这个基本结构。这比仅仅使用解析函数要稍微复杂一点。如果你能自己想出这个，干得好！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="c450" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是数据在子查询中的样子。如果您注意到t1.day字段在t1.day大于t2.day的日期中有重复值，那么您可以在t1.day进行聚合并获得累计值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/be0254d2f18510145d3a45eb2c4c20d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mc3CWvSOPXBqilD7HJ-qYQ.png"/></div></div></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="7484" class="lw lx it bd ly lz na mb mc md nb mf mg jz nc ka mi kc nd kd mk kf ne kg mm mn bi translated">在Select子句中使用子查询</h1><p id="4a3a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们看到的最后一种计算累计的方法是在select语句中使用子查询。这与自联接有一些相似之处，只是自联接发生在select语句内部。这通常是不可取的，因为使用这种方法通常会强制查询重新扫描表中存在于原始表中的每一行。这往往是非常低效的，但我们觉得对所有可能的选择有一个大致的了解总是好的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="438b" class="lw lx it bd ly lz na mb mc md nb mf mg jz nc ka mi kc nd kd mk kf ne kg mm mn bi translated">设计一个表来跟踪滚动总和</h1><p id="5ca3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">除了使用直接的即席查询，另一种选择是设计一个表来跟踪运行总数。这个设计看起来像什么将根据目标的不同而不同。目标很可能是填充应用程序或仪表板。根据需求改变整体设计。如果我们保持简单，就像上面的例子，我们有一个用户每月的滚动总和，那么你只需要插入一个新的行，如果是相同的月份和年份，就追加上一个值。</p><p id="3bc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将限制动态的容易程度。例如，如果您决定要查看每三个月的运行总数，该怎么办？</p><p id="2d41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有什么想法吗？</p><p id="8bfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有几种方法可以解决这个问题，包括上面的一些方法。我们会让你仔细考虑的！</p><p id="8a62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们正在关注一个解决问题的系列，很想知道你正在努力解决什么问题，或者你希望看到什么问题得到解决。如果您有任何疑问，请立即联系我们！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj ng l"/></div></figure></div></div>    
</body>
</html>