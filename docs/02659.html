<html>
<head>
<title>Prevent Object Properties From Being Modified With JavaScript’s Freeze Function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">防止对象属性被JavaScript的冻结功能修改</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/prevent-object-properties-from-being-modified-with-javascripts-freeze-function-dd13e5bdc920?source=collection_archive---------14-----------------------#2019-12-15">https://betterprogramming.pub/prevent-object-properties-from-being-modified-with-javascripts-freeze-function-dd13e5bdc920?source=collection_archive---------14-----------------------#2019-12-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7514" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何创建不能更改的对象</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e056e3a1fe06c30f63a1c73b334f11a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pfii7XY2lutQVvHnGE1Icg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">亚历山大·席默克在<a class="ae ky" href="https://unsplash.com/s/photos/secure?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="2937" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Object.freeze()</h1><p id="8862" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这将防止对象被修改。一旦我们冻结了一个对象，我们就不能:</p><ul class=""><li id="1254" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">删除属性</li><li id="ce6f" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">添加新的属性</li><li id="4ba5" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">更改属性的可枚举性、可配置性或可写性</li><li id="a721" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">更改现有属性的值</li></ul><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="1b87" class="ni la it ne b gy nj nk l nl nm">var user = {<br/>    name : "John",<br/>    age  : 20<br/>}</span><span id="b5bd" class="ni la it ne b gy nn nk l nl nm">var frozenUser = Object.freeze(user);</span><span id="a3b8" class="ni la it ne b gy nn nk l nl nm">frozenUser === user ; // true</span></pre><p id="10ca" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">当我们使用一个对象的<code class="fe nr ns nt ne b">delete</code>属性时，它返回<code class="fe nr ns nt ne b">false</code>，对象属性不会被移除。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="fbc5" class="ni la it ne b gy nj nk l nl nm">delete frozenUser.name; // false</span><span id="3ea4" class="ni la it ne b gy nn nk l nl nm">log(frozenUser); // {name: "John", age: 20}</span></pre><p id="1aa5" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">当我们试图添加一个新的属性时，它不会将该属性添加到对象中。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="2a4a" class="ni la it ne b gy nj nk l nl nm">frozenUser.profession = "doctor 👨‍⚕️ ";</span><span id="37ee" class="ni la it ne b gy nn nk l nl nm">log(frozenUser); // {name: "John", age: 20}</span></pre><p id="f272" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">我们不能改变现有财产的价值。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="2a9a" class="ni la it ne b gy nj nk l nl nm">frozenUser.age = 22; // it will not change the value</span><span id="37b5" class="ni la it ne b gy nn nk l nl nm">log(frozenUser); // {name: "John", age: 20}</span></pre><p id="077d" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">或者更改属性的可枚举性、可配置性或可写性。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="2ad9" class="ni la it ne b gy nj nk l nl nm">Object.defineProperty(frozenUser, 'name', {enumerable : false});<br/>//throws an error cannot redefine property</span></pre><p id="fa87" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">以上所有方法都会在<code class="fe nr ns nt ne b">strict mode</code>中抛出一个<code class="fe nr ns nt ne b">TypeError</code>异常。</p><p id="84fa" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">我们也可以冻结一个<code class="fe nr ns nt ne b">array</code>。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="f2e4" class="ni la it ne b gy nj nk l nl nm">var array = [1,2,3,4,5]</span><span id="0355" class="ni la it ne b gy nn nk l nl nm">var frozenArray = Object.freeze(array);</span><span id="97d3" class="ni la it ne b gy nn nk l nl nm">frozenArray[0] = 10;</span><span id="bd9d" class="ni la it ne b gy nn nk l nl nm">log(frozenArray); // [1,2,3,4,5]</span></pre><p id="7f4c" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">当我们试图添加或删除一个值时，它会抛出一个<code class="fe nr ns nt ne b">TypeError</code>。</p><p id="8d17" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">object <code class="fe nr ns nt ne b">freeze</code>方法只做一个浅层冻结，这意味着如果属性值是对象本身，那么这些对象不会被冻结。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="4841" class="ni la it ne b gy nj nk l nl nm">var user = {<br/>   name : "John",<br/>   address : {<br/>      doorNo : 20<br/>   } <br/>}</span><span id="0982" class="ni la it ne b gy nn nk l nl nm">Object.freeze(user);</span></pre><p id="4ad1" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">上述代码将防止添加、删除和修改属性。但是如果<code class="fe nr ns nt ne b">property address</code>的值本身就是一个对象，<code class="fe nr ns nt ne b">Object.freeze</code>方法就不会冻结<code class="fe nr ns nt ne b">address</code>对象。我们可以改变地址对象。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="87f0" class="ni la it ne b gy nj nk l nl nm">user.address.doorNo = 100;</span><span id="5635" class="ni la it ne b gy nn nk l nl nm">log(user.address); // {doorNo: 100}</span><span id="6a1b" class="ni la it ne b gy nn nk l nl nm">user.address.street = "First Street";</span><span id="e434" class="ni la it ne b gy nn nk l nl nm">log(user.address); // {doorNo: 100, street: "First Street"}</span></pre></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="f0b3" class="kz la it bd lb lc ob le lf lg oc li lj jz od ka ll kc oe kd ln kf of kg lp lq bi translated">来自MDN的深度冻结</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="8107" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">要检查一个对象是否被冻结，我们可以使用<code class="fe nr ns nt ne b">Object.isFrozen</code>。只有当一个对象的所有立即属性不是<code class="fe nr ns nt ne b">Extensible</code>、不是<code class="fe nr ns nt ne b">Writable</code>和不是<code class="fe nr ns nt ne b">Configurable</code>时，该方法才返回<code class="fe nr ns nt ne b">true</code>。</p><p id="3573" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">示例1:</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="3ad4" class="ni la it ne b gy nj nk l nl nm">var user = {<br/>   name : "John"<br/>}</span><span id="aadb" class="ni la it ne b gy nn nk l nl nm">Object.freeze(user);</span><span id="4a19" class="ni la it ne b gy nn nk l nl nm">Object.isFrozen(user); // true</span></pre><p id="5d46" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">示例2:</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="8af7" class="ni la it ne b gy nj nk l nl nm">var obj = {<br/>  name : "John"<br/>}</span><span id="f8ca" class="ni la it ne b gy nn nk l nl nm">Object.isFrozen(obj); // false</span><span id="3e94" class="ni la it ne b gy nn nk l nl nm">Object.defineProperty(obj, 'name', {<br/>   <!-- -->writable: false,<br/>   <!-- -->configurable: false<br/>});</span><span id="1965" class="ni la it ne b gy nn nk l nl nm">Object.isFrozen(obj); // false because the name is still extensible</span><span id="d91c" class="ni la it ne b gy nn nk l nl nm">Object.preventExtensions(obj);</span><span id="014e" class="ni la it ne b gy nn nk l nl nm">Object.isFrozen(obj); //true</span></pre></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="39f7" class="kz la it bd lb lc ob le lf lg oc li lj jz od ka ll kc oe kd ln kf of kg lp lq bi translated">对象。海豹</h1><p id="fe38" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果我们需要改变现有属性的值，那么我们需要使用<code class="fe nr ns nt ne b">Object.seal</code>方法。</p><p id="021f" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated"><code class="fe nr ns nt ne b">Object.seal</code>方法阻止一个对象添加新属性，将所有现有属性标记为不可配置(不可删除)。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="7cc6" class="ni la it ne b gy nj nk l nl nm">var user = {<br/>   name : "John"<br/>}</span><span id="7ef3" class="ni la it ne b gy nn nk l nl nm">user.age  = "20";</span><span id="9257" class="ni la it ne b gy nn nk l nl nm">user; // {name: "John", age: "20"}</span></pre><p id="c8af" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">密封后，</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="f68c" class="ni la it ne b gy nj nk l nl nm">var sealedUser = Object.seal(user);</span><span id="0ae8" class="ni la it ne b gy nn nk l nl nm">user === sealedUser // true</span></pre><p id="9ac9" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">我们可以改变现有财产的价值。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="b85a" class="ni la it ne b gy nj nk l nl nm">sealedUser.name = "JOHN";</span><span id="10f0" class="ni la it ne b gy nn nk l nl nm">log(sealedUser); // {name: "JOHN", age: "20"}</span></pre><p id="2246" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">但是我们不能添加新的属性。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="e715" class="ni la it ne b gy nj nk l nl nm">sealedUser.profession = "programmmer";</span><span id="200b" class="ni la it ne b gy nn nk l nl nm">log(sealedUser); // {name: "JOHN", age: "20"}</span></pre><p id="bddb" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">此外，我们不能删除属性。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="56c9" class="ni la it ne b gy nj nk l nl nm">delete sealedUser.age;</span><span id="c7bb" class="ni la it ne b gy nn nk l nl nm">log(sealedUser); // {name: "JOHN", age: "20"}</span></pre><p id="2330" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">要检查一个对象是否被密封，我们可以使用<code class="fe nr ns nt ne b">isSealed</code>。一个物体被认为是密封的，如果</p><ul class=""><li id="4502" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">它是不可扩展的(不能添加新属性)</li><li id="637d" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">如果其所有属性都是不可配置的(不可移除的)</li></ul><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="063b" class="ni la it ne b gy nj nk l nl nm">var user = {<br/>   name : "John"<br/>}</span><span id="3aea" class="ni la it ne b gy nn nk l nl nm">Object.isSealed(user); // false</span><span id="b60c" class="ni la it ne b gy nn nk l nl nm">Object.seal(user);</span><span id="d6a0" class="ni la it ne b gy nn nk l nl nm">Object.isSealed(user); // true</span></pre><p id="55ee" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma no mc md me np mg mh mi nq mk ml mm im bi translated">参考:<a class="ae ky" href="https://developer.mozilla.org/en-US/" rel="noopener ugc nofollow" target="_blank"> MDN网络文档</a></p></div></div>    
</body>
</html>