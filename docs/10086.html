<html>
<head>
<title>How URL Shorteners Work and How to Build One</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网址缩写如何工作以及如何建立一个</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-url-shorteners-work-and-how-to-build-one-77352e12be95?source=collection_archive---------1-----------------------#2021-11-25">https://betterprogramming.pub/how-url-shorteners-work-and-how-to-build-one-77352e12be95?source=collection_archive---------1-----------------------#2021-11-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8de9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索为了便于分享，隐藏恶意链接和更好的外观，URL被缩短了多长</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bc68fa9b487e9ed4bdb50a907d703b4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yn8tnS_dc7_6joAv"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">帕特丽夏·塞尔纳在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9d08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">网址无处不在。你送他们；你接受它们；您可以在网络浏览器中使用它们。不过，有时它们会变得很长，以至于它们变得很烦人。这就是URL缩写派上用场的时候了。它们实际上是一种缩短URL的工具，并且由于各种原因而被广泛使用，包括:</p><ul class=""><li id="0e1d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">缩短网址，使它们更适合网页，或者可以人工复制，如果还有人这样做的话。</li><li id="294f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">隐藏恶意网址背后的匿名缩短。隐藏的链接可能指向黑客的网站，该网站可能会为您带来恶意软件或诱使您泄露敏感信息。</li><li id="9b4a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">流量跟踪执行分析谁访问您的网页通过网址缩写。</li><li id="c69e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" rel="noopener ugc nofollow" target="_blank">瑞克罗林</a>。</li></ul><h2 id="59b9" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">网址缩写是如何工作的</h2><p id="2310" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">现在我将简单回顾一下当你使用URL缩写时会发生什么。然后，我将在代码部分提供更详细的解释。</p><p id="0372" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，用户将他的长URL插入到shortener网页上的一个表单中。然后它被发送到服务器，服务器验证链接并检查潜在的<a class="ae ky" href="https://en.wikipedia.org/wiki/Code_injection" rel="noopener ugc nofollow" target="_blank">注入</a>。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="d434" class="mj mk it ni b gy nm nn l no np">https://github.com/nic-obert/virtual-machine/blob/main/src/assembler/arguments_table.py#:~:text=)%2C-,%27mov%27%3A%20(,-%23%20Register</span></pre><p id="98d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，服务器尝试将提供的URL插入到数据库中。如果成功，它将以短URL的形式向用户返回一个标识码，用于检索存储的长链接。现在，用户可以在网页中或通过任何其他方式共享缩短的URL。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="0e52" class="mj mk it ni b gy nm nn l no np">https://my.shortener/?id=7486</span></pre><p id="1c3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一段时间后，另一个用户在web浏览器中插入缩短的URL。服务器接收带有识别码的请求，识别码将用于从数据库中检索长URL。如果资源存在，用户将被重定向到目标。否则，他应该被重定向到一个错误页面，解释请求的URL不存在。</p><h2 id="7fdb" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">用Python，Flask和SQLite构建一个URL缩短器</h2><p id="ce5c" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在下面的指南中，我将使用Python作为代码示例。我相信当提到简单性和可读性时，它是最好的选择；任何人都应该能够理解它的类似英语的语法。无论如何，任何其他技术栈都可以很好地完成这项工作。</p><p id="a3a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从最简单的部分开始，网页。主要想法是创建一个HTML表单，用户可以像这样输入他的长URL:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/23579fd5da024c95d153252bae3e5709.png" data-original-src="https://miro.medium.com/v2/resize:fit:636/format:webp/1*g83Vo9EB-rFww_1MFv2BUw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GUI界面。</p></figure><p id="89b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个简单界面的代码是:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">URL缩写HTML表单。</p></figure><p id="da70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该表单从用户处获取一个URL，并通过一个<a class="ae ky" href="https://www.w3schools.com/tags/ref_httpmethods.asp" rel="noopener ugc nofollow" target="_blank"> GET请求</a>将其发送到服务器的<code class="fe nt nu nv ni b">/</code>路由。</p><p id="40b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个代码块可能看起来不寻常。事实上，那不是普通的HTML，而是<a class="ae ky" href="https://palletsprojects.com/p/jinja/" rel="noopener ugc nofollow" target="_blank"> Jinja符号</a>。Jinja是一个功能强大的工具，用于使用类似Python的语法在HTML文档中插入逻辑。在这种情况下，它检查是否设置了<code class="fe nt nu nv ni b">url</code>变量(包含缩短的URL)。如果是，那就表现出来；如果不是，就不要展示任何东西。</p><p id="c7ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将这个HTML文件放在一个名为<code class="fe nt nu nv ni b">templates</code>的文件夹中，这是用Python编写的微型web框架<a class="ae ky" href="https://en.wikipedia.org/wiki/Flask_(web_framework)" rel="noopener ugc nofollow" target="_blank"> Flask </a>中模板文件的默认名称。最终的文件夹结构将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/af5a2a07fc95cefdb350f560c526fd58.png" data-original-src="https://miro.medium.com/v2/resize:fit:222/format:webp/1*_Nvj6AQ_DgF5cTr8YRy96A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">文件夹结构。</p></figure><p id="c9f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们移动到后端部分。我决定把它分解成小块，这样更容易消化。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="dcf8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个片段非常简单明了。我导入了一些我们将在代码中使用的包。然后，我创建一个Flask应用程序，并为数据库文件选择一个名称。最后一个代码块是Python定义主函数的方式。在那里，我首先检查并初始化数据库(我们稍后将定义<code class="fe nt nu nv ni b">initialize_database()</code>，然后在调试模式下运行应用程序。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据库接口的代码。</p></figure><p id="3197" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是代码片段，下面是数据库界面。这些功能将用于在更高层次上与它进行交互。请注意，在这段代码中，我使用了Python的类型提示功能，以使代码更加清晰。如果您不熟悉这种符号，我建议您查看我在Python 中发表的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-write-clearer-python-code-with-type-hints-330216291b7c">类型提示文章。</a></p><p id="8bb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我导入代码中需要的一些包。函数<code class="fe nt nu nv ni b">initialize_database()</code>首先检查数据库文件是否存在。如果有，它就连接到它并获得一个游标，一个用于执行查询的接口。然后，它评估一个SQL查询，检查数据库是否已经包含一个名为<code class="fe nt nu nv ni b">urls</code>的表。如果该表不存在，就会被创建。</p><p id="e05e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果数据库文件不存在，它会和<code class="fe nt nu nv ni b">urls</code>表一起创建。该表保存一个整数作为主键，用于标识所请求的长URL。文本字段只存储长URL。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="ee3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数接受一个整数，即长URL id，并返回URL(如果存在的话)。如果没有，则返回<code class="fe nt nu nv ni b">None</code>(在其他语言中可能翻译为<code class="fe nt nu nv ni b">NULL</code>或<code class="fe nt nu nv ni b">null</code>)。</p><p id="af4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个到数据库的连接以及一个游标。执行SQL查询来获取对应于所提供的id的所请求的URL。在检查了<code class="fe nt nu nv ni b">data</code>实际包含的内容之后，返回它的结果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="f1e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nt nu nv ni b">store_url()</code>函数的行为类似于我之前解释过的那个。它连接到数据库并执行一个查询，将提供的长URL插入到数据库的<code class="fe nt nu nv ni b">urls</code>表中。然后，它返回表中新创建的条目的整数id。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="db8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nt nu nv ni b">exists_url()</code>函数连接到数据库，并使用SQL查询检查所提供的URL是否已经存在于<code class="fe nt nu nv ni b">urls</code>表中。最后一个表达式用于将<code class="fe nt nu nv ni b">cursor.fetchone()</code>的返回值解释为布尔值。具体来说，如果URL不是<code class="fe nt nu nv ni b">None</code> (aka它存在)，它返回<code class="fe nt nu nv ni b">True</code>；否则，返回<code class="fe nt nu nv ni b">False</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="fff4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nt nu nv ni b">get_url_id()</code>函数连接到数据库，选择并返回与所提供的长URL相对应的整数id。</p><p id="c4f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们转到接收用户请求和响应的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="adc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我为接受GET请求的应用程序创建了一个路由。路线名称为<code class="fe nt nu nv ni b">/</code>，基本路线。如果网址域名为“my.shortener”，则<code class="fe nt nu nv ni b">/</code>路由对应<code class="fe nt nu nv ni b">http(s)://my.shortener/</code> URL。</p><p id="92fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，它检查是否有任何id作为GET请求中的参数被发送。这样一个请求的URL应该是这样的，其中<code class="fe nt nu nv ni b">id</code>用于从数据库中检索长URL。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="de16" class="mj mk it ni b gy nm nn l no np">http(s)://my.shortener/?id=4513</span></pre><p id="cc18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果提供了一个id，它将被验证。在这种情况下，它必须是一个整数。如果不是，显示一个错误页面。然后它被转换成一个整数(从一个字符串)并用于检索长URL。如果后者存在，将用户重定向到它；否则，显示错误页面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/b91b9f53a06ca5e0aaad052ee0d8b1f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*nmwB1YQBsqXA9mAohlDH2w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">无效URL的错误页面。</p></figure><p id="8481" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个代码块只有在设置了<code class="fe nt nu nv ni b">id</code>参数的情况下才会被执行。首先，检查是否设置了<code class="fe nt nu nv ni b">url</code> GET请求参数。如果是，调用<code class="fe nt nu nv ni b">shorten_url()</code>函数使其缩短；我们以后再定义。<code class="fe nt nu nv ni b">url.strip()</code>删除字符串中的尾随和前导空格。最后，在主网页中向用户显示缩短的URL。</p><p id="be59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nt nu nv ni b">render_template()</code>函数将HTML模板文件名作为参数，它包含在我之前提到的<code class="fe nt nu nv ni b">templates</code>文件夹中。可选地，您可以提供一些关键字参数(在本例中是<code class="fe nt nu nv ni b">url=shortened_url</code>)，Jinja模板引擎将使用它们来创建web页面。</p><p id="ec2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果没有设置GET请求参数(<code class="fe nt nu nv ni b">url</code>和<code class="fe nt nu nv ni b">id</code>)，就返回网页。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="c24d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nt nu nv ni b">shorten_url()</code>函数将长URL作为参数，并返回一个用于访问给定资源的短链接。它首先检查提供的长URL是否已经存在，并获取其id。如果它不在数据库中，存储它并获取id。</p><p id="001e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，构建并返回短URL。<code class="fe nt nu nv ni b">request.base_url</code>是被请求的基本URL，例如<code class="fe nt nu nv ni b">http(s)://my.shortener/</code>。然后使用后跟指定参数的<code class="fe nt nu nv ni b">?</code>添加<code class="fe nt nu nv ni b">id</code> GET请求参数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/c4f1eebd6d69419ae6d769d365101540.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*KdHvN5F3qsT3GfUiA37shw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">接口返回缩短的URL。</p></figure><p id="a6f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意服务器地址是<code class="fe nt nu nv ni b">127.0.0.1:5000</code>(本地主机端口5000)。这意味着您不能在本地机器之外访问URL shortener服务器。继续阅读，了解如何从外部网络访问网站。</p><p id="911b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你感兴趣，这是我这篇文章所基于的GitHub库。您可以在那里找到完整的源代码。</p><h1 id="141f" class="nz mk it bd ml oa ob oc mo od oe of mr jz og ka mu kc oh kd mx kf oi kg na oj bi translated">更多提示</h1><p id="3e09" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">这个项目只是一个演示如何网址缩写工作。我的方法肯定不是最安全的，因为它不执行对恶意URL的检查，也不能有效地处理成千上万的用户。</p><p id="1fea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以实现创建自定义字符串链接的可能性，比如<code class="fe nt nu nv ni b">http(s)://my.shortener/science-presentation</code>。</p><p id="0275" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使URL shortener可从您的本地机器网络或局域网外部访问，您可能需要依靠云服务提供商来托管您的服务器。这种方法可以为您节省一些时间，因为您不必自己设置服务器。此外，许多服务提供商甚至为个人提供免费计划。我建议你看看我关于免费云服务提供商的文章，了解更多信息:</p><div class="ok ol gp gr om on"><a rel="noopener  ugc nofollow" target="_blank" href="/7-free-cloud-hosting-service-providers-for-software-developers-99ed433ccdc6"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd iu gy z fp os fr fs ot fu fw is bi translated">7家面向软件开发人员的免费云托管服务提供商</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">AWS、Pythonanywhere等等</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">better编程. pub</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb ks on"/></div></div></a></div><p id="d471" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>