<html>
<head>
<title>How to Make ComponentDidMount Using React Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用React挂钩安装组件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-make-componentdidmount-with-react-hooks-215a252f68bc?source=collection_archive---------2-----------------------#2020-12-28">https://betterprogramming.pub/how-to-make-componentdidmount-with-react-hooks-215a252f68bc?source=collection_archive---------2-----------------------#2020-12-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7128" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让旧的和新的一起工作</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1db685cceb4c93d1cd07e0de8dbc8ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gb-Bg7Vk7qCisgOMMZnO8g.png"/></div></div></figure><p id="7a3a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在浏览了互联网上关于如何使用<code class="fe ln lo lp lq b">useEffect</code>模仿<code class="fe ln lo lp lq b">componentDidMount</code>的一堆文章和例子之后，它似乎总是不太像它应该被实现的那样。</p><p id="5016" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以这个类组件为例:</p><pre class="kg kh ki kj gt lr lq ls lt aw lu bi"><span id="6276" class="lv lw iq lq b gy lx ly l lz ma">import React, { Component } from 'react';</span><span id="a810" class="lv lw iq lq b gy mb ly l lz ma">export default class App extends Component {<br/>  componentDidMount() {<br/>    // code to run on component mount<br/>  }</span><span id="b4cd" class="lv lw iq lq b gy mb ly l lz ma">  render() {<br/>    return &lt;div&gt;hello&lt;/div&gt;<br/>  }<br/>}</span></pre><p id="cf7f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里将会发生的是，在组件被挂载之后，<code class="fe ln lo lp lq b">componentDidMount()</code>方法中的任何代码都会被立即调用。您可能会发现模拟这种情况的典型重构如下所示:</p><pre class="kg kh ki kj gt lr lq ls lt aw lu bi"><span id="aa58" class="lv lw iq lq b gy lx ly l lz ma">import React, {useEffect} from 'react';</span><span id="fd61" class="lv lw iq lq b gy mb ly l lz ma">function App() {<br/>  useEffect(() =&gt; {<br/>    // Runs after the first render() lifecycle<br/>    console.log('mounted');  <br/>  }, []);<br/><br/>  return &lt;h1&gt;Hello&lt;/h1&gt;;<br/>}</span></pre><p id="b68a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">假设我们希望<code class="fe ln lo lp lq b">useEffect</code>中有依赖关系，并且只希望依赖关系更新产生影响。</p><pre class="kg kh ki kj gt lr lq ls lt aw lu bi"><span id="2ae5" class="lv lw iq lq b gy lx ly l lz ma">import React from 'react';</span><span id="ad68" class="lv lw iq lq b gy mb ly l lz ma">function App() {<br/>  const [state, setState] = React.useState(0)</span><span id="f69f" class="lv lw iq lq b gy mb ly l lz ma">  React.useEffect(() =&gt; {<br/>    // Runs after the first render() lifecycle<br/>    console.log('state udpated');</span><span id="daa3" class="lv lw iq lq b gy mb ly l lz ma">  }, [state]);<br/><br/>  return &lt;h1&gt;Hello&lt;/h1&gt;;<br/>}</span></pre><p id="643a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正如您将注意到的，当您运行这个程序时，即使我们没有手动更新状态，也会立即调用<code class="fe ln lo lp lq b">console.log</code>。</p><p id="0620" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们尝试使用<code class="fe ln lo lp lq b">useRef</code>和<code class="fe ln lo lp lq b">useEffect</code>来定制<code class="fe ln lo lp lq b">componentDidMount</code>。</p><pre class="kg kh ki kj gt lr lq ls lt aw lu bi"><span id="a013" class="lv lw iq lq b gy lx ly l lz ma">import React, { useRef, useEffect }from 'react';</span><span id="a10a" class="lv lw iq lq b gy mb ly l lz ma">function useDidMount() {<br/>  const didMountRef = useRef(true);<br/>  <br/>  useEffect(() =&gt; {<br/>    didMountRef.current = false;<br/>  }, []);<br/>  return didMountRef.current;<br/>};</span></pre><p id="d094" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里发生的事情是，我们在成功重新呈现后返回<code class="fe ln lo lp lq b">false</code>之前，为我们的<code class="fe ln lo lp lq b">didMountRef</code>返回一个初始值<code class="fe ln lo lp lq b">true</code>。如果在我们的功能组件中使用它，我们可以看到它的效果。</p><pre class="kg kh ki kj gt lr lq ls lt aw lu bi"><span id="8f7b" class="lv lw iq lq b gy lx ly l lz ma">import React, { useRef, useEffect }from 'react';</span><span id="d414" class="lv lw iq lq b gy mb ly l lz ma">function useDidMount() {<br/>  const didMountRef = useRef(true);<br/>  <br/>  useEffect(() =&gt; {<br/>    didMountRef.current = false;<br/>  }, []);<br/>  return didMountRef.current;<br/>};</span><span id="890a" class="lv lw iq lq b gy mb ly l lz ma">function App() {<br/>  const didMount = useDidMount();<br/>  <!-- -->const [state, setState] = React.useState(0);</span><span id="7eef" class="lv lw iq lq b gy mb ly l lz ma">  React.useEffect(() =&gt; {<br/>    if(didMount) {<br/>      console.log('mounted');<br/>    } else {<br/>      console.log('state updated');<br/>    }</span><span id="dfee" class="lv lw iq lq b gy mb ly l lz ma">}, [state, didMount]);<br/><br/>  return &lt;h1&gt;Hello&lt;/h1&gt;;<br/>}</span></pre><p id="3b93" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你运行这个，<code class="fe ln lo lp lq b">mounted</code>将会在控制台中打印出来，因为<code class="fe ln lo lp lq b">true</code>将会是<code class="fe ln lo lp lq b">didMount</code>的初始值，这与我们的渲染条件相匹配。让我们添加一个按钮来更新我们的状态，看看会发生什么。</p><pre class="kg kh ki kj gt lr lq ls lt aw lu bi"><span id="224e" class="lv lw iq lq b gy lx ly l lz ma">import React, { useRef, useEffect }from 'react';</span><span id="c2b1" class="lv lw iq lq b gy mb ly l lz ma">function useDidMount() {<br/>  const didMountRef = useRef(true);<br/>  <br/>  useEffect(() =&gt; {<br/>    didMountRef.current = false;<br/>  }, []);<br/>  return didMountRef.current;<br/>};</span><span id="6d9b" class="lv lw iq lq b gy mb ly l lz ma">function App() {<br/>  const didMount = useDidMount();<br/>  <!-- -->const [state, setState] = React.useState(0);</span><span id="4989" class="lv lw iq lq b gy mb ly l lz ma">  const update = () =&gt; {<br/>   setState(prev =&gt; ++prev)<br/>  }</span><span id="2711" class="lv lw iq lq b gy mb ly l lz ma">  useEffect(() =&gt; {<br/>    if(didMount) {<br/>     console.log('mounted');<br/>    } else {<br/>     console.log('called', state);<br/>    }<br/>  }, [state, didMount]);<br/><br/>  return (&lt;div&gt;<br/>    <!-- -->&lt;button onClick = {update}&gt;Click Me&lt;/button&gt;<br/>    <!-- -->&lt;h1&gt;Hello&lt;/h1&gt;<br/>  &lt;/div&gt;);<br/>}</span></pre><p id="2f1e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们保存并重新运行，最初会显示<code class="fe ln lo lp lq b">mounted</code>，然后当我们开始点击按钮时，<code class="fe ln lo lp lq b">called</code>会随着按钮被点击次数的增加而显示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mc"><img src="../Images/b6d7575d3c8f221a9c3d54d8642915b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-8WoGdKJahD9Mu1pq5GKDw.png"/></div></div></figure><p id="0535" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以在下面的操作中看到这一点。只需点击并打开控制台，看看当你点击按钮时会发生什么。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="ebea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">记得点击刷新按钮查看显示的<code class="fe ln lo lp lq b">mounted</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/5dc2e382eb96a4eb87c9fb3806214194.png" data-original-src="https://miro.medium.com/v2/resize:fit:334/format:webp/1*IVZqQ5II4wW31iEqwTSvrQ.png"/></div></figure><p id="30bb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">至此，我将结束这篇文章，希望您会发现这很有用。感谢阅读！</p></div></div>    
</body>
</html>