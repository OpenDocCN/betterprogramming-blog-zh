<html>
<head>
<title>How To Add Infinite Scrolling to Your Angular App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何给你的Angular应用添加无限滚动</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-add-infinite-scrolling-to-your-angular-app-51c3826da4dc?source=collection_archive---------0-----------------------#2019-09-22">https://betterprogramming.pub/how-to-add-infinite-scrolling-to-your-angular-app-51c3826da4dc?source=collection_archive---------0-----------------------#2019-09-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d7bbd9718076af512abd5037f99249ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9I_by3LwrHVVr6HVO5Y3lw.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://unsplash.com/@tannermardis?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">坦纳·马迪斯</a>在<a class="ae kf" href="https://unsplash.com/s/photos/scroll?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="1529" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">无限滚动效应是指当您向下滚动页面时，页面不断加载新数据，只有在加载完所有可能的数据后才会停止。</p><p id="f183" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用Angular可以很容易地将无限滚动添加到应用程序中。有很多库可以给你的Angular应用添加这种效果</p><p id="1813" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个故事中，我们将建立一个具有搜索功能和无限滚动的单页照片库应用程序，以及另一个显示随机照片幻灯片的页面。</p><p id="5559" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用Angular Material来利用其好看的表单元素和网格以及名为<code class="fe le lf lg lh b">ng-simple-slideshow</code>的幻灯片库来显示幻灯片。它的左侧会有一个菜单。</p><p id="0668" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们照片的来源将来自Pexels API。你需要一个API密匙，通过在<a class="ae kf" href="https://www.pexels.com/api/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/api/</a>注册一个来免费访问API。它被限制在每小时200个API调用，所以不要做太多的请求。为了给应用程序添加无限滚动，我们使用了为Angular设计的<code class="fe le lf lg lh b">ngx-infinite-scroll</code>包。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="9553" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">入门指南</h1><p id="fe06" class="pw-post-body-paragraph kg kh it ki b kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">为了开始构建应用程序，我们首先通过运行<code class="fe le lf lg lh b">npm i @angular/cli</code>来安装Angular CLI。安装完成后，我们运行<code class="fe le lf lg lh b">ng new image-gallery</code>为我们的图片库应用程序创建一个新的Angular。我们还创建了一个Flux store来存储菜单的状态。</p><p id="c9ca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们安装应用程序的库。我们运行<code class="fe le lf lg lh b">npm i @angular/cdk @angular/material ng-simple-slideshow ngx-infinite-scroll @ngrx/store</code>来安装我们需要显示照片和展示照片幻灯片的库。然后我们运行<code class="fe le lf lg lh b">ng add @ngrx/store</code>来添加代码。</p><p id="39f3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们为将要编写的代码添加框架代码。为此，我们运行以下命令:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="a435" class="na lq it lh b gy nb nc l nd ne">ng g component homePage<br/>ng g component randomSlideshowPage<br/>ng g component topBar<br/>ng g class httpReqInterceptor<br/>ng g service photo</span></pre><p id="1ef9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将创建用于显示的组件。<code class="fe le lf lg lh b">httpReqInterceptor</code>类用于将API键附加到每个请求的请求头。照片服务是调用Pexels API的代码所在的地方。</p><p id="8562" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">environment.ts</code>中，我们把让我们把你的API密匙导入到其他文件中。：</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="be80" class="na lq it lh b gy nb nc l nd ne">export const environment = {<br/>  production: false,<br/>  pexelsApiKey: 'your pexels api key'<br/>};</span></pre><p id="f576" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">http-req-interceptor.ts</code>中，我们添加:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="4d18" class="na lq it lh b gy nb nc l nd ne">import { Injectable } from '<a class="ae kf" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import {<br/>    HttpEvent,<br/>    HttpInterceptor,<br/>    HttpHandler,<br/>    HttpResponse,<br/>    HttpRequest<br/>} from '<a class="ae kf" href="http://twitter.com/angular/common" rel="noopener ugc nofollow" target="_blank">@angular/common</a>/http';<br/>import { Observable } from 'rxjs';<br/>import { environment } from '../environments/environment'<br/>import { tap } from 'rxjs/operators';<br/><a class="ae kf" href="http://twitter.com/Injectable" rel="noopener ugc nofollow" target="_blank">@Injectable</a>()<br/>export class HttpReqInterceptor implements HttpInterceptor {<br/>    constructor() { }</span><span id="47fb" class="na lq it lh b gy nf nc l nd ne">intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; {<br/>        let modifiedReq = req.clone({});<br/>        modifiedReq = modifiedReq.clone({<br/>            setHeaders: {<br/>                'Authorization': environment.pexelsApiKey<br/>            }<br/>        });</span><span id="ee0c" class="na lq it lh b gy nf nc l nd ne">return next.handle(modifiedReq).pipe(tap((event: HttpEvent&lt;any&gt;) =&gt; {<br/>            if (event instanceof HttpResponse) {</span><span id="653f" class="na lq it lh b gy nf nc l nd ne">}<br/>        }));<br/>    }<br/>}</span></pre><p id="d275" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将我们的令牌附加到每个请求的<code class="fe le lf lg lh b">Authorization</code>请求头，请求块:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="ad9b" class="na lq it lh b gy nb nc l nd ne">let modifiedReq = req.clone({});<br/>  modifiedReq = modifiedReq.clone({<br/>    setHeaders: {<br/>      'Authorization': environment.pexelsApiKey<br/>    }<br/>});</span></pre><p id="356d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">photo.service.ts</code>中，我们把:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="da43" class="na lq it lh b gy nb nc l nd ne">import { Injectable } from '<a class="ae kf" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { HttpClient } from '<a class="ae kf" href="http://twitter.com/angular/common" rel="noopener ugc nofollow" target="_blank">@angular/common</a>/http';</span><span id="77cc" class="na lq it lh b gy nf nc l nd ne"><a class="ae kf" href="http://twitter.com/Injectable" rel="noopener ugc nofollow" target="_blank">@Injectable</a>({<br/>  providedIn: 'root'<br/>})<br/>export class PhotoService {</span><span id="f904" class="na lq it lh b gy nf nc l nd ne">constructor(<br/>    private http: HttpClient<br/>  ) { }</span><span id="be45" class="na lq it lh b gy nf nc l nd ne">randomPhotos(page: number = 1) {<br/>    return this.http.get(`<a class="ae kf" href="https://api.pexels.com/v1/curated?per_page=15&amp;page=${page}`" rel="noopener ugc nofollow" target="_blank">https://api.pexels.com/v1/curated?per_page=15&amp;page=${page}`</a>)<br/>  }</span><span id="b730" class="na lq it lh b gy nf nc l nd ne">searchPhotos(query: string, page: number = 1) {<br/>    return this.http.get(`<a class="ae kf" href="https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&amp;per_page=15&amp;page=${page}`)" rel="noopener ugc nofollow" target="_blank">https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&amp;per_page=15&amp;page=${page}`)</a><br/>  }<br/>}</span></pre><p id="5d58" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这让我们可以向Pexels API发出请求。我们在应用程序中使用了精选照片和分页搜索端点。</p><p id="e25d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来在<code class="fe le lf lg lh b">home-page.component.ts</code>中，我们放入:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="eb2c" class="na lq it lh b gy nb nc l nd ne">import { Component, OnInit } from '<a class="ae kf" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { NgForm } from '<a class="ae kf" href="http://twitter.com/angular/forms" rel="noopener ugc nofollow" target="_blank">@angular/forms</a>';<br/>import { PhotoService } from '../photo.service';</span><span id="c6bd" class="na lq it lh b gy nf nc l nd ne"><a class="ae kf" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-home-page',<br/>  templateUrl: './home-page.component.html',<br/>  styleUrls: ['./home-page.component.scss']<br/>})<br/>export class HomePageComponent implements OnInit {<br/>  query: any = &lt;any&gt;{};<br/>  photoUrls: string[] = [];<br/>  page: number = 1;</span><span id="f8ad" class="na lq it lh b gy nf nc l nd ne">constructor(<br/>    private photoService: PhotoService<br/>  ) { }</span><span id="c7e3" class="na lq it lh b gy nf nc l nd ne">ngOnInit() {<br/>    this.getPhotos();<br/>  }</span><span id="d15b" class="na lq it lh b gy nf nc l nd ne">getPhotos() {<br/>    this.photoService.randomPhotos(this.page)<br/>      .subscribe(res =&gt; {<br/>        this.photoUrls = this.photoUrls.concat((res as any).photos.map(p =&gt; p.src.landscape));<br/>      })<br/>  }</span><span id="2c41" class="na lq it lh b gy nf nc l nd ne">searchPhotos(searchForm: NgForm) {<br/>    if (searchForm.invalid) {<br/>      return;<br/>    }<br/>    this.page = 1;<br/>    this.photoUrls = [];<br/>    this.requestSearchPhotos();<br/>  }</span><span id="6b4e" class="na lq it lh b gy nf nc l nd ne">requestSearchPhotos() {<br/>    this.photoService.searchPhotos(this.query.search, this.page)<br/>      .subscribe(res =&gt; {<br/>        this.photoUrls = this.photoUrls.concat((res as any).photos.map(p =&gt; p.src.landscape));<br/>      })<br/>  }</span><span id="2cf6" class="na lq it lh b gy nf nc l nd ne">onScroll() {<br/>    this.page++<br/>    if (!this.query.search) {<br/>      this.getPhotos();<br/>    }<br/>    else {<br/>      this.requestSearchPhotos();<br/>    }</span><span id="fa44" class="na lq it lh b gy nf nc l nd ne">}<br/>}</span></pre><p id="0112" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我们从策展照片端点(位于这里的<a class="ae kf" href="https://api.pexels.com/v1/curated?per_page=15&amp;page=1" rel="noopener ugc nofollow" target="_blank"/>)获取照片的地方，通过调用响应的照片字段上的<code class="fe le lf lg lh b">map</code>来获取图像URL。</p><p id="fc10" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果输入一个搜索词，我们将使用搜索照片端点<a class="ae kf" href="https://api.pexels.com/v1/search?query=example+query&amp;per_page=15&amp;page=1" rel="noopener ugc nofollow" target="_blank">这里的</a>并用<code class="fe le lf lg lh b">map</code>功能做同样的事情。我们有无限滚动，所以当用户滚动到页面底部时，我们增加页码，并不断向我们的数组添加更多的图像URL。</p><p id="c080" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">home-page.component.html</code>中，我们把:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="e1fc" class="na lq it lh b gy nb nc l nd ne">&lt;form #searchForm='ngForm' (ngSubmit)='searchPhotos(searchForm)'&gt;<br/>    &lt;mat-form-field&gt;<br/>        &lt;input matInput placeholder="Search Photos" required #search='ngModel' name='search' [(ngModel)]='query.search'&gt;<br/>        &lt;mat-error *ngIf="search.invalid &amp;&amp; (search.dirty || search.touched)"&gt;<br/>            &lt;div *ngIf="search.errors.required"&gt;<br/>                Search query is required.<br/>            &lt;/div&gt;<br/>        &lt;/mat-error&gt;<br/>    &lt;/mat-form-field&gt;<br/>    &lt;br&gt;<br/>    &lt;button mat-raised-button type='submit'&gt;Search&lt;/button&gt;<br/>&lt;/form&gt;<br/>&lt;br&gt;<br/>&lt;div infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollThrottle]="50" (scrolled)="onScroll()"&gt;<br/>    &lt;mat-grid-list cols="2" rowHeight="2:1"&gt;<br/>        &lt;mat-grid-tile *ngFor='let p of photoUrls'&gt;<br/>            &lt;img [src]='p' class="tile-image" &gt;<br/>        &lt;/mat-grid-tile&gt;<br/>    &lt;/mat-grid-list&gt;<br/>&lt;/div&gt;</span></pre><p id="5145" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这显示了搜索表单，并将我们的照片网格包装成无限滚动<code class="fe le lf lg lh b">div</code>，因此当用户向下滚动时，它将加载新的图像。</p><p id="2e38" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">infiniteScrollDistance</code>是页面位置距页面底部的百分比，因此<code class="fe le lf lg lh b">2</code>意味着当我们滚动完页面中98%的当前内容时，将触发无限滚动。</p><p id="e4d0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">infiniteScrollThrottle</code>是用户停止滚动后触发无限滚动前的毫秒数。当用户向下滚动页面时，触发<code class="fe le lf lg lh b">scrolled</code>。这些都是可选的，可以按照你想要的方式进行调整。</p><p id="7bf2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">home-page.component.scss</code>中，我们添加:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="aa26" class="na lq it lh b gy nb nc l nd ne">.tile-image {<br/>  width: 100%;<br/>  height: auto;<br/>}</span></pre><p id="4092" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这使得图像充满网格框。</p><p id="406f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">random-slideshow-page.component.ts</code>中，我们输入:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="3de4" class="na lq it lh b gy nb nc l nd ne">import { Component, OnInit } from '<a class="ae kf" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { PhotoService } from '../photo.service';</span><span id="7d98" class="na lq it lh b gy nf nc l nd ne"><a class="ae kf" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-random-slideshow-page',<br/>  templateUrl: './random-slideshow-page.component.html',<br/>  styleUrls: ['./random-slideshow-page.component.scss']<br/>})<br/>export class RandomSlideshowPageComponent implements OnInit {<br/>  photoUrls: string[] = [];</span><span id="9c4b" class="na lq it lh b gy nf nc l nd ne">constructor(<br/>    private photoService: PhotoService<br/>  ) { }</span><span id="fe8f" class="na lq it lh b gy nf nc l nd ne">ngOnInit() {<br/>    this.getPhotos();<br/>  }</span><span id="0077" class="na lq it lh b gy nf nc l nd ne">getPhotos() {<br/>    this.photoService.randomPhotos(1)<br/>      .subscribe(res =&gt; {<br/>        this.photoUrls = (res as any).photos.map(p =&gt; p.src.landscape);<br/>      })<br/>  }<br/>}</span></pre><p id="9086" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我们从策展照片端点获取随机照片的地方。</p><p id="2d8a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">random-photos-page.component.html</code>中，我们添加:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="8a84" class="na lq it lh b gy nb nc l nd ne">&lt;div class="center"&gt;<br/>    &lt;h1&gt;Random Photos&lt;/h1&gt;<br/>&lt;/div&gt;<br/>&lt;slideshow [imageUrls]="photoUrls" [height]="height" [minHeight]="'60vh'" [autoPlay]="true" [showArrows]="false"&gt;<br/>&lt;/slideshow&gt;</span></pre><p id="ff2b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这显示了照片的幻灯片。</p><p id="51b4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们创建一个名为<code class="fe le lf lg lh b">menu-reducer.ts</code>的文件，并添加以下内容来存储菜单状态:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="03e3" class="na lq it lh b gy nb nc l nd ne">const TOGGLE_MENU = 'TOGGLE_MENU';</span><span id="47cf" class="na lq it lh b gy nf nc l nd ne">function menuReducer(state, action) {<br/>    switch (action.type) {<br/>        case TOGGLE_MENU:<br/>            state = action.payload;<br/>            return state;<br/>        default:<br/>            return state<br/>    }<br/>}</span><span id="f9c5" class="na lq it lh b gy nf nc l nd ne">export { menuReducer, TOGGLE_MENU };</span></pre><p id="fe54" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">reducers/index.ts</code>中，我们输入:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="46c1" class="na lq it lh b gy nb nc l nd ne">import { menuReducer } from './menu-reducer';</span><span id="f78c" class="na lq it lh b gy nf nc l nd ne">export const reducers = {<br/>  menu: menuReducer,<br/>};</span></pre><p id="4821" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这允许<code class="fe le lf lg lh b">@ngrx/store</code>的<code class="fe le lf lg lh b">StoreModule</code>使用菜单缩减器来存储状态。</p><p id="b152" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">app.component.ts</code>中，我们添加:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="ba95" class="na lq it lh b gy nb nc l nd ne">import { Component, HostListener } from '<a class="ae kf" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { Store, select } from '<a class="ae kf" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';<br/>import { TOGGLE_MENU } from './reducers/menu-reducer';</span><span id="8a26" class="na lq it lh b gy nf nc l nd ne"><a class="ae kf" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-root',<br/>  templateUrl: './app.component.html',<br/>  styleUrls: ['./app.component.scss']<br/>})<br/>export class AppComponent {<br/>  menuOpen: boolean;</span><span id="0b39" class="na lq it lh b gy nf nc l nd ne">constructor(<br/>    private store: Store&lt;any&gt;,<br/>  ) {<br/>    store.pipe(select('menu'))<br/>      .subscribe(menuOpen =&gt; {<br/>        this.menuOpen = menuOpen;<br/>      })<br/>  }</span><span id="37d3" class="na lq it lh b gy nf nc l nd ne"><a class="ae kf" href="http://twitter.com/HostListener" rel="noopener ugc nofollow" target="_blank">@HostListener</a>('document:click', ['$event'])<br/>  public onClick(event) {<br/>    const isOutside = !event.target.className.includes("menu-button") &amp;&amp;<br/>      !event.target.className.includes("material-icons") &amp;&amp;<br/>      !event.target.className.includes("mat-drawer-inner-container")<br/>    if (isOutside) {<br/>      this.menuOpen = false;<br/>      this.store.dispatch({ type: TOGGLE_MENU, payload: this.menuOpen });<br/>    }<br/>  }</span><span id="e7c2" class="na lq it lh b gy nf nc l nd ne">}</span></pre><p id="540c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将自动关闭左侧菜单时，改变页面，如果你没有点击菜单按钮。我们获取商店中的菜单状态，如果菜单需要通过导航或点击菜单外部来关闭，我们关闭菜单并在商店中设置状态。</p><p id="cfdb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">top-bar.component.ts</code>中，我们把:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="5e66" class="na lq it lh b gy nb nc l nd ne">import { Component, OnInit } from '<a class="ae kf" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { Store, select } from '<a class="ae kf" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';<br/>import { TOGGLE_MENU } from '../reducers/menu-reducer';</span><span id="5270" class="na lq it lh b gy nf nc l nd ne"><a class="ae kf" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-top-bar',<br/>  templateUrl: './top-bar.component.html',<br/>  styleUrls: ['./top-bar.component.scss']<br/>})<br/>export class TopBarComponent implements OnInit {<br/>  menuOpen: boolean;</span><span id="56f6" class="na lq it lh b gy nf nc l nd ne">constructor(<br/>    private store: Store&lt;any&gt;<br/>  ) {<br/>    store.pipe(select('menu'))<br/>      .subscribe(menuOpen =&gt; {<br/>        this.menuOpen = menuOpen;<br/>      })<br/>  }</span><span id="82bd" class="na lq it lh b gy nf nc l nd ne">ngOnInit() {<br/>  }</span><span id="61be" class="na lq it lh b gy nf nc l nd ne">toggleMenu() {<br/>    this.store.dispatch({ type: TOGGLE_MENU, payload: !this.menuOpen    });<br/>  }<br/>}</span></pre><p id="dd43" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这允许我们切换菜单并将状态存储在存储中。</p><p id="eda1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">app.component.html</code>中，我们有:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="768b" class="na lq it lh b gy nb nc l nd ne">&lt;mat-sidenav-container class="example-container"&gt;<br/>  &lt;mat-sidenav mode="side" [opened]='menuOpen'&gt;<br/>    &lt;ul&gt;<br/>      &lt;li&gt;<br/>        &lt;b&gt;<br/>          Image Gallery App<br/>        &lt;/b&gt;<br/>      &lt;/li&gt;<br/>      &lt;li&gt;<br/>        &lt;a routerLink='/'&gt;Home&lt;/a&gt;<br/>      &lt;/li&gt;<br/>      &lt;li&gt;<br/>        &lt;a routerLink='/random'&gt;Random Photos Slideshow&lt;/a&gt;<br/>      &lt;/li&gt;<br/>    &lt;/ul&gt;</span><span id="a6e8" class="na lq it lh b gy nf nc l nd ne">&lt;/mat-sidenav&gt;<br/>  &lt;mat-sidenav-content&gt;<br/>    &lt;app-top-bar&gt;&lt;/app-top-bar&gt;<br/>    &lt;div id='content'&gt;<br/>      &lt;router-outlet&gt;&lt;/router-outlet&gt;<br/>    &lt;/div&gt;<br/>  &lt;/mat-sidenav-content&gt;<br/>&lt;/mat-sidenav-container&gt;</span></pre><p id="47b1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这显示了导航的左侧菜单，<code class="fe le lf lg lh b">router-outlet</code>让用户在点击上面的链接或直接输入网址时看到我们的页面。</p><p id="18ec" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">app.component.scss</code>中，我们添加:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="e894" class="na lq it lh b gy nb nc l nd ne">#content {<br/>  padding: 20px;<br/>  min-height: 130vh;<br/>}</span><span id="4f46" class="na lq it lh b gy nf nc l nd ne">ul {<br/>  list-style-type: none;<br/>  margin: 0;<br/>  li {<br/>    padding: 20px 5px;<br/>  }<br/>}</span></pre><p id="ec34" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将添加一些填充并删除页面上的边距。</p><p id="f421" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后在<code class="fe le lf lg lh b">app.module.ts</code>中，我们把:</p><pre class="ms mt mu mv gt mw lh mx my aw mz bi"><span id="8268" class="na lq it lh b gy nb nc l nd ne">import { BrowserModule } from '<a class="ae kf" href="http://twitter.com/angular/platform-browser" rel="noopener ugc nofollow" target="_blank">@angular/platform-browser</a>';<br/>import { NgModule } from '<a class="ae kf" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import {<br/>  MatButtonModule,<br/>  MatCheckboxModule,<br/>  MatInputModule,<br/>  MatMenuModule,<br/>  MatSidenavModule,<br/>  MatToolbarModule,<br/>  MatTableModule,<br/>  MatDialogModule,<br/>  MatDatepickerModule,<br/>  MatSelectModule,<br/>  MatCardModule,<br/>  MatFormFieldModule,<br/>  MatGridListModule<br/>} from '<a class="ae kf" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>';<br/>import { BrowserAnimationsModule } from '<a class="ae kf" href="http://twitter.com/angular/platform-browser" rel="noopener ugc nofollow" target="_blank">@angular/platform-browser</a>/animations';<br/>import { AppRoutingModule } from './app-routing.module';<br/>import { AppComponent } from './app.component';<br/>import { StoreModule } from '<a class="ae kf" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';<br/>import { reducers } from './reducers';<br/>import { TopBarComponent } from './top-bar/top-bar.component';<br/>import { FormsModule } from '<a class="ae kf" href="http://twitter.com/angular/forms" rel="noopener ugc nofollow" target="_blank">@angular/forms</a>';<br/>import { HttpClientModule, HTTP_INTERCEPTORS } from '<a class="ae kf" href="http://twitter.com/angular/common" rel="noopener ugc nofollow" target="_blank">@angular/common</a>/http';<br/>import { HomePageComponent } from './home-page/home-page.component';<br/>import { RandomSlideshowPageComponent } from './random-slideshow-page/random-slideshow-page.component';<br/>import { InfiniteScrollModule } from 'ngx-infinite-scroll';<br/>import { SlideshowModule } from 'ng-simple-slideshow';<br/>import { HttpReqInterceptor } from './http-req-interceptor';<br/>import { PhotoService } from './photo.service';</span><span id="c824" class="na lq it lh b gy nf nc l nd ne"><a class="ae kf" href="http://twitter.com/NgModule" rel="noopener ugc nofollow" target="_blank">@NgModule</a>({<br/>  declarations: [<br/>    AppComponent,<br/>    TopBarComponent,<br/>    HomePageComponent,<br/>    RandomSlideshowPageComponent<br/>  ],<br/>  imports: [<br/>    BrowserModule,<br/>    AppRoutingModule,<br/>    FormsModule,<br/>    MatButtonModule,<br/>    StoreModule.forRoot(reducers),<br/>    BrowserAnimationsModule,<br/>    MatButtonModule,<br/>    MatCheckboxModule,<br/>    MatFormFieldModule,<br/>    MatInputModule,<br/>    MatMenuModule,<br/>    MatSidenavModule,<br/>    MatToolbarModule,<br/>    MatTableModule,<br/>    HttpClientModule,<br/>    MatDialogModule,<br/>    MatDatepickerModule,<br/>    MatSelectModule,<br/>    MatCardModule,<br/>    MatGridListModule,<br/>    InfiniteScrollModule,<br/>    SlideshowModule,<br/>  ],<br/>  providers: [<br/>    {<br/>      provide: HTTP_INTERCEPTORS,<br/>      useClass: HttpReqInterceptor,<br/>      multi: true<br/>    },<br/>    PhotoService<br/>  ],<br/>  bootstrap: [AppComponent]<br/>})<br/>export class AppModule { }</span></pre><p id="29c5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这包括所有的库，HTTP拦截器，以及我们需要使应用程序运行的服务。</p><p id="f9ea" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们在完成的应用程序中有以下内容:</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/eb963d21dbd2a3ed8ebace4a86a5d9c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9--6NnMi-U5Q6O6iN0KGLg.png"/></div></div></figure><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/a90fd9db72fbcc8047ce6ed94e295e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cy31iuSBHc_GB3WuA0Pc9Q.png"/></div></div></figure><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/bea0bba7afc48288070af7aaf67810c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auRbF33JfbLroK-fbCPq_Q.png"/></div></div></figure><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/e918bdcaba1dbe306d57bfb223464660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lOeKNwT0D2JeSfirXrApaA.png"/></div></div></figure></div></div>    
</body>
</html>