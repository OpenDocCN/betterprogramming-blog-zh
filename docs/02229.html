<html>
<head>
<title>Edit PDFs, Images, and Videos Using Quick Look in iOS 13</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS 13中使用快速查看来编辑pdf、图像和视频</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/edit-pdfs-images-and-videos-using-quick-look-in-ios-13-ad2131080587?source=collection_archive---------13-----------------------#2019-11-14">https://betterprogramming.pub/edit-pdfs-images-and-videos-using-quick-look-in-ios-13-ad2131080587?source=collection_archive---------13-----------------------#2019-11-14</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="6998" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated"><code class="fe kj kk kl km b">The QuickLook framework introduced an editing mode</code></h2></div><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gi gj kn"><img src="../Images/1d6efe58b06d539ccf3e06591b310395.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4PAyvGEdkoz9Tl22EbRaFg.png"/></div></div><p class="kz la gk gi gj lb lc bd b be z dk translated">由<a class="ae ld" href="https://undraw.co/search" rel="noopener ugc nofollow" target="_blank">未绘制的插图</a></p></figure><p id="b08a" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated">作为iOS中不太为人所知的瑰宝之一，Quick Look框架对于在应用程序中预览文档非常有用。在WWDC 2019期间，随着编辑模式的引入，该框架得到了很好的升级。</p><p id="05dd" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated"><code class="fe kj kk kl km b">QLPreviewController</code>是负责在视图控制器中呈现不同类型内容的控制器。目前，它支持图像、视频、pdf、CSV和iWork文件类型。</p><p id="d848" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated"><code class="fe kj kk kl km b">QLPreviewItemEditingMode</code>是该框架的新成员，它允许我们轻松地对图像和pdf进行注释，并对视频进行修剪或转换。</p><p id="3926" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated"><code class="fe kj kk kl km b">QLPreviewItemEditingMode</code>嵌入<a class="ae ld" href="https://medium.com/better-programming/an-introduction-to-pencilkit-in-ios-4d40aa62ba5b" rel="noopener"> PencilKit </a>框架，用于编辑图像和pdf。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="348e" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">我们的目标</h1><ul class=""><li id="2665" class="mz na iu lg b lh nb lk nc ln nd lr ne lv nf lz ng nh ni nj bi translated">探索快速查看框架中的新增功能</li><li id="8bad" class="mz na iu lg b lh nk lk nl ln nm lr nn lv no lz ng nh ni nj bi translated">构建使用Quick Look编辑文档的iOS应用程序</li><li id="20c3" class="mz na iu lg b lh nk lk nl ln nm lr nn lv no lz ng nh ni nj bi translated">使用<code class="fe kj kk kl km b">FileManager</code>将编辑好的文档保存在文档目录中</li></ul><h2 id="f2f9" class="np mi iu bd mj nq nr dn mn ns nt dp mr ln nu nv mt lr nw nx mv lv ny nz mx oa bi translated">最终目的地</h2><p id="9e36" class="pw-post-body-paragraph le lf iu lg b lh nb jv lj lk nc jy lm ln ob lp lq lr oc lt lu lv od lx ly lz in bi translated">在这篇文章结束时，我们将能够编辑和保存图像、视频和pdf，如下所示:</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gi gj oe"><img src="../Images/6444c4e41744a4ac4502a708bb2ea6a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y5gmtds2hlufUxlVL4mc9Q.png"/></div></div><p class="kz la gk gi gj lb lc bd b be z dk translated">未来的一瞥</p></figure></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="04e5" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">iOS 13 QuickLook有什么新功能？</h1><p id="86a3" class="pw-post-body-paragraph le lf iu lg b lh nb jv lj lk nc jy lm ln ob lp lq lr oc lt lu lv od lx ly lz in bi translated">除了增加<code class="fe kj kk kl km b">QLPreviewItemEditingMode</code>之外，<code class="fe kj kk kl km b">QLPreviewControllerDelegate</code>协议还引入了三个新的可选委托方法。</p><h2 id="7287" class="np mi iu bd mj nq nr dn mn ns nt dp mr ln nu nv mt lr nw nx mv lv ny nz mx oa bi translated">处理编辑模式功能</h2><p id="51db" class="pw-post-body-paragraph le lf iu lg b lh nb jv lj lk nc jy lm ln ob lp lq lr oc lt lu lv od lx ly lz in bi translated">我们可以通过实现以下方法来处理编辑模式:</p><pre class="ko kp kq kr gu of km og oh aw oi bi"><span id="c923" class="np mi iu km b gz oj ok l ol om">optional func previewController(_ controller: QLPreviewController, <strong class="km iv">editingModeFor</strong> previewItem: QLPreviewItem) -&gt; QLPreviewItemEditingMode</span></pre><p id="b3f3" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated">在上述方法中，我们可以将返回类型设置为<code class="fe kj kk kl km b">createCopy</code>、<code class="fe kj kk kl km b">default</code>或<code class="fe kj kk kl km b">updateContents</code>来相应地处理编辑结果。<code class="fe kj kk kl km b">updateContents</code>覆盖<code class="fe kj kk kl km b">FileManager</code>中QLPreviewItems的内容。默认情况下，编辑模式是关闭的。</p><h2 id="5d9b" class="np mi iu bd mj nq nr dn mn ns nt dp mr ln nu nv mt lr nw nx mv lv ny nz mx oa bi translated">保存编辑的内容</h2><p id="6518" class="pw-post-body-paragraph le lf iu lg b lh nb jv lj lk nc jy lm ln ob lp lq lr oc lt lu lv od lx ly lz in bi translated">编辑完成后，我们可以使用以下可选方法保存修改后的内容:</p><pre class="ko kp kq kr gu of km og oh aw oi bi"><span id="b641" class="np mi iu km b gz oj ok l ol om">func previewController(_ controller: QLPreviewController, didSaveEditedCopyOf previewItem: QLPreviewItem, at modifiedContentsURL: URL)</span></pre><p id="7794" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated">当<code class="fe kj kk kl km b">EditingMode</code>为<code class="fe kj kk kl km b">createsCopy</code>时，上述方法被触发。它返回修改内容的URL(内容驻留在一个临时位置)。然后，我们可以选择处理URL并将其保存在<code class="fe kj kk kl km b">FileManager</code>中。</p><h2 id="dc54" class="np mi iu bd mj nq nr dn mn ns nt dp mr ln nu nv mt lr nw nx mv lv ny nz mx oa bi translated">通知已编辑的内容</h2><p id="3f81" class="pw-post-body-paragraph le lf iu lg b lh nb jv lj lk nc jy lm ln ob lp lq lr oc lt lu lv od lx ly lz in bi translated">我们可以选择在得到成功更新QLPreviewItem的通知后更新用户界面。当编辑模式为<code class="fe kj kk kl km b">updatesContent</code>时触发:</p><pre class="ko kp kq kr gu of km og oh aw oi bi"><span id="de43" class="np mi iu km b gz oj ok l ol om">func previewController(_ controller: QLPreviewController, didUpdateContentsOf previewItem: QLPreviewItem)</span></pre><p id="9428" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated">在下一节中，我们将创建一个简单的iOS应用程序，它使用源代码中提供的示例图像、视频和PDF来调用快速预览。只需在您的ViewController中输入<code class="fe kj kk kl km b">import QuickLook</code>即可开始。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="1af7" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">设置QLPreviewController</h1><p id="f51e" class="pw-post-body-paragraph le lf iu lg b lh nb jv lj lk nc jy lm ln ob lp lq lr oc lt lu lv od lx ly lz in bi translated">以下代码用于在我们的应用程序的view controller中显示快速查看预览控制器，并启用编辑模式:</p><pre class="ko kp kq kr gu of km og oh aw oi bi"><span id="6d97" class="np mi iu km b gz oj ok l ol om">@objc func onButtonClick(sender: UIButton){<br/>        <br/>        let previewController = QLPreviewController()<br/>        previewController.dataSource = self<br/>        previewController.delegate = self<br/><strong class="km iv">        previewController.setEditing(true, animated: true)</strong><br/>        self.present(previewController, animated: true, completion: nil)<br/>}</span></pre><p id="ac1e" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated">接下来，您需要遵循<code class="fe kj kk kl km b">QLPreviewControllerDelegate</code>、<code class="fe kj kk kl km b">QLPreviewControllerDataSource</code>协议，并在您的类中实现委托函数。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="7b22" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">设置我们的数据源</h1><p id="e020" class="pw-post-body-paragraph le lf iu lg b lh nb jv lj lk nc jy lm ln ob lp lq lr oc lt lu lv od lx ly lz in bi translated">对于数据源，我们已经设置了一个文件名文字数组，用于显示如下所示的<code class="fe kj kk kl km b">QLPreviewItems</code>:</p><pre class="ko kp kq kr gu of km og oh aw oi bi"><span id="ff42" class="np mi iu km b gz oj ok l ol om">var items : [String] = ["sampleVideo.mp4", "samplePDF.pdf", "sampleImage.png"]</span></pre><p id="f461" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated">接下来，我们需要实现数据源协议方法，以便显示<code class="fe kj kk kl km b">QLPreviewItems</code>。下面的代码负责显示<code class="fe kj kk kl km b">QLPreviewItems</code>中的数据源文件:</p><pre class="ko kp kq kr gu of km og oh aw oi bi"><span id="c84a" class="np mi iu km b gz oj ok l ol om">extension ViewController: QLPreviewControllerDataSource {<br/>    func numberOfPreviewItems(in controller: QLPreviewController) -&gt; Int {<br/>        return items.count<br/>    }<br/>    <br/>    func previewController(_ controller: QLPreviewController, previewItemAt index: Int) -&gt; QLPreviewItem {<br/>        <br/>        print(controller.isEditing)<br/>        <br/>        let name = self.items[index]<br/>        let file = name.components(separatedBy: ".")<br/>        let path = Bundle.main.path(forResource: file.first!, ofType: file.last!)<br/>        let url = NSURL(fileURLWithPath: path!)<br/>        return url as QLPreviewItem<br/>    }<br/>}</span></pre></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="e4a8" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">保存更新的内容</h1><p id="98c6" class="pw-post-body-paragraph le lf iu lg b lh nb jv lj lk nc jy lm ln ob lp lq lr oc lt lu lv od lx ly lz in bi translated">最后，我们将添加可选的委托功能，以便使用<code class="fe kj kk kl km b">FileManager</code>将编辑的内容保存为副本:</p><figure class="ko kp kq kr gu ks"><div class="bz fq l di"><div class="on oo l"/></div></figure><p id="4d49" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated">在上面的代码中，我们使用<code class="fe kj kk kl km b">modifiedContentsURL</code>检索文件路径。使用文件管理器，我们将编辑后的文件保存到应用程序的文档目录中。</p><p id="ccd4" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated">结果，我们得到了下面的应用程序并开始运行！</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div class="gi gj op"><img src="../Images/022f86cfb4e277154117cd6e817065a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:506/1*0s8Wp_3HS3cIz1YZ_gg1rg.gif"/></div></figure><p id="01a4" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated">我们已经使用新的<a class="ae ld" href="https://medium.com/better-programming/ios-13-context-menus-and-sf-symbols-a03b032fe330" rel="noopener"> iOS 13系统符号</a>设置了我们的按钮。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="0206" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">结论</h1><p id="5ea9" class="pw-post-body-paragraph le lf iu lg b lh nb jv lj lk nc jy lm ln ob lp lq lr oc lt lu lv od lx ly lz in bi translated">因此，我们探索了在2019年WWDC奥运会期间很大程度上被忽视的小宝石。快速查看编辑模式是一个有趣的特性，因为它允许我们使用内置的PencilKit框架在应用程序中快速注释pdf。完整的源代码可以在<a class="ae ld" href="https://github.com/anupamchugh/iowncode/tree/master/iOS13QuickLook" rel="noopener ugc nofollow" target="_blank"> Github资源库</a>中找到。</p><p id="4f4e" class="pw-post-body-paragraph le lf iu lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated">这一次到此为止。我希望你喜欢阅读。</p></div></div>    
</body>
</html>