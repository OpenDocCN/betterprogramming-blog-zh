<html>
<head>
<title>SwiftUI in Production</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">生产中的SwiftUI</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swiftui-in-production-678af4db19c9?source=collection_archive---------0-----------------------#2020-07-18">https://betterprogramming.pub/swiftui-in-production-678af4db19c9?source=collection_archive---------0-----------------------#2020-07-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5a33" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不管你可能听到什么，SwiftUI在生产中运行良好</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/23238802ad6dd68ed2f2ec7263912043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fDdVaLiRu0uSqIVZ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@dianamia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> C Dustin </a>拍摄的照片。</p></figure><p id="6887" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的应用程序<a class="ae ky" href="https://apps.apple.com/us/app/soccer-puzzles/id1511159096" rel="noopener ugc nofollow" target="_blank">足球拼图</a>在应用商店上线已经一个月了(在我写这篇文章的时候),它的篮球兄弟<a class="ae ky" href="https://apps.apple.com/us/app/basketball-puzzles/id1520915346" rel="noopener ugc nofollow" target="_blank">篮球拼图</a>也上线一天了。它们都是在SwiftUI中开发的。在App Store上直播一个月可以对苹果的新UI框架在App Store上的表现提供一些信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f863" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="4168" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">是的，SwiftUI可以用在生产应用程序中，而且大多数时候都运行得很好。然而，也有一些小故障。欲知详情，请继续阅读。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="47c8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">该应用程序</h1><p id="d67e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">虽然是个琐事/竞猜游戏，但app本身并不琐碎。它有大约10K行代码，有同步机制，应用内购买，游戏逻辑(解锁级别，成就)，以及大量数据通过它。它还有一个绘图引擎，可以根据位置绘制不同的足球(和篮球)阵型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/1df1559a773249c7fc0b9df8d8265bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/0*1OUwgf7tbskzvAv_"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5c19" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">足球</h1><p id="b470" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于那些不太看足球的人来说，阵型类似于一个app的架构——球队是如何被结构化和组织在一起的。关注点是分离的。例如，守门员和后卫的主要目标是阻止对方进球。他们在后面(数据模型)，他们通常给球队他们的身份和力量，队长经常来自球场的那一部分。前锋(观点)负责进球。每个人都看到他们，他们通常是英雄，但没有团队的支持，他们做不了什么。中场球员(控制者)将一切联系在一起，给比赛带来活力。</p><p id="3f24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些部分有很多种组织方式，像经典的4-4-2 (MVC？)，最流行的4-3-3 (MVVM？)，还有更复杂的像4-1-2-1-2(蝰蛇？).这里有一些直观的例子，但可以有许多不同的组合:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/b0fe61f1e6290ccf217ea96e33b8e8ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z7ELlvhqYcCHrzwzRP47sw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/3c8cfb5b5c0225fad5805bd57e383499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eghRxEpGY9eVuxp-uc6rjw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/2f90b4214953a00242f7405cc5fb9b45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mh70vrNl6rPUoAYIC6Fj2A.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d246" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">赞成者</h1><p id="c233" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">SwiftUI非常适合这项任务。如果你把这个区域分成不同的部分(和子部分),分别是守门员、防守、中场和进攻，并且只使用间隔和偏移，你就可以很好地表现一个足球阵型，而不用做太多的计算。如果我不得不在UIKit中这样做，那将会是很大的工作量。</p><p id="8425" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为奖励，当你浏览问题时，有一些很好的动画，你只需要调用<code class="fe nb nc nd ne b">animate</code>修改器。同样，在UIKit中做这件事需要更多的工作。根据问题类型的不同，问题本身有许多不同的表现形式。使用SwiftUI的组合方法，重用组件、移动组件等等变得非常容易。</p><p id="4ff5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一点是设计和UX，这是原型和创建的方式。有一次，一个视图在顶部，然后被移到底部。在SwiftUI中，这是一个非常快的变化，而在UIKit中，您将不得不一直处理约束。</p><p id="8a2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与联合收割机一起工作也是一次非常好的经历。这在同步机制中帮助很大，我为我的存储库创建了定制的发布者。存储库将首先获取并返回一些缓存或绑定的数据，然后与Firebase同步以获得最新的更改。对于一个数据中不能有错误的琐事应用程序来说，这非常有帮助。</p><p id="a3f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是我如何进行回购认购的一瞥:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/ff0532531bf766d1d83d6eec0fd80ed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1T3f4uDTcAM0Q5oXW1Oe1g.png"/></div></div></figure><p id="aea9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在这个应用程序中使用了标准的MVVM模式，并结合得非常好。视图模型是从外部创建并传递给视图的<code class="fe nb nc nd ne b">@ObservableObjects</code>。因此，我不会对iOS 14做任何改变，也没有必要使用新的<code class="fe nb nc nd ne b">@StateObject</code>。</p><p id="2346" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个很好的方法是使用依赖容器的层次结构。使用SwiftUI预览特性时，拥有创建视图和视图模型的容器也非常有用，因为视图和视图模型可以有复杂的初始化方法。例如，如果我想创建一个<code class="fe nb nc nd ne b">FootballTeamView</code>，它有一个<code class="fe nb nc nd ne b">FootballTeamViewModel</code>，后者有一个<code class="fe nb nc nd ne b">PlayersRepository</code>、<code class="fe nb nc nd ne b">AnswersRepository</code>和<code class="fe nb nc nd ne b">UsersService</code>，并且它们还有其他依赖项，预览会变得非常混乱。</p><p id="cc35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我首先做的是为上述类型中的所有依赖项使用协议。然后，我创建了一个实现了<code class="fe nb nc nd ne b">PreviewProvider</code>的<code class="fe nb nc nd ne b">PreviewsContainer</code>。在这个提供程序中，我创建了模拟存储库和显示在预览中的数据。因此，在SwiftUI预览中创建依赖关系非常容易。好的一面是，由于<code class="fe nb nc nd ne b">PreviewsContainer</code>实现了<code class="fe nb nc nd ne b">PreviewProvider</code>，它不会出现在你的应用程序的发布版本中。另一个好处是，您可以在单元测试中使用那些相同的模拟实现。</p><p id="5eda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了乐趣因素之外，这些是使用SwiftUI/Combine的一些好处，对于下班后完成的宠物项目来说，这是驱动你的动力。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="23b4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">坏处</h1><p id="77c8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当然，SwiftUI并不完美。我最不喜欢的是那些可以神奇出现的小版本差异和bugs尤其是13.0/13.1版本。因此，您应该在所有次要版本甚至多个设备上进行测试。</p><p id="18a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我在进入生产环境并查看崩溃日志后发现的一个具体例子:在一些iOS 13.1.2设备上出现了崩溃。崩溃日志不是很有帮助。一些<code class="fe nb nc nd ne b">AttributeGraph</code>崩溃，没有进一步的细节。然而，如果您选择相同的iOS/iPhone组合，您可以很容易地在Xcode中重现崩溃。即使这样，也真的很难调试，很难找出问题出在哪里。</p><p id="8677" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">粗暴的方法是注释掉事物，直到它停止崩溃。原来，在我给列表添加了一个ID修饰符后，崩溃就消失了。</p><p id="8f13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个问题是现在的修改器，在iOS 13.1版本中也有问题。我有一个在应用内购买或广告加载时出现的加载视图。然而，在这些设备上，我只看到了一个白色的屏幕，这对于用户(无法赚取更多的硬币来玩游戏)或我(我无法为这些用户赚钱)来说不是很有帮助。</p><p id="7f53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，这很难调试，我想出的快速解决方案非常愚蠢——没有对那些版本使用现在修饰词(如果有人知道更好的，请分享)。在这种情况下，可以使用条件修饰符。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/b87871a783d169e2cbdcf9ea0b824449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vLfcWkR9Xp8F5AVSvJpFhA.png"/></div></div></figure><p id="f84d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我见过的其他小故障涉及导航栏的标题。有时候，之前的头衔并没有消失。它与当前标题合并，您无法阅读任何内容。另一件事是文本视图的动画。有时候，有些省略号会出现，但永远不会消失。要解决这个问题，您需要显式地禁用文本视图的动画。</p><p id="0b4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前，应用程序更加稳定，只有一个崩溃，没有更多关于如何修复它的细节，可能每隔几天一次。比如就这个:<code class="fe nb nc nd ne b">AttributeGraph: 0x1cb4e3000 + 205760</code>。在堆栈跟踪中，有一个对app的main方法的调用，并在<code class="fe nb nc nd ne b">GraphicsServices</code>中崩溃。</p><p id="a94c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们希望这样的问题不会出现在新的SwiftUI版本中。</p><p id="3ebd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在网上阅读SwiftUI为什么还没有准备好投入生产时，还提到了其他一些事情，比如缺少一些标准的UI组件和没有导航堆栈信息。对于第一个问题，您可以轻松地包装UIKit等价物，甚至构建自己的定制组件。对于导航栈，由于苹果甚至在iOS 14中也不提供，也许是时候重新思考我们如何在应用中设计导航了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e5cd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="3d66" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">SwiftUI可以用于生产，但是你需要记住上面提到的小故障。我很确定这些问题会随着时间的推移得到解决。可能有些已经在iOS 14中修复了。是的，你会有偶尔的崩溃和一星评级，但这与连续几个小时的持续崩溃相比不算什么，因为你已经包括了第三方SDK(你知道是哪一个)。</p><p id="8c40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果你现在开始一个新项目——即使是一个更复杂的项目——我相信SwiftUI是一个不错的选择。我这样做是为了一个月前开始的更大的工作项目，到目前为止，一切顺利。</p><p id="d21e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你对这个话题有什么想法？SwiftUI准备好生产了吗？</p><p id="9c26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你也可以看看我的SwiftUI驱动的拼图应用程序，<a class="ae ky" href="https://apps.apple.com/us/app/soccer-puzzles/id1511159096" rel="noopener ugc nofollow" target="_blank">足球拼图</a>和<a class="ae ky" href="https://apps.apple.com/us/app/basketball-puzzles/id1520915346" rel="noopener ugc nofollow" target="_blank">篮球拼图</a>，并找到更多SwiftUI错误。</p><p id="b37f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>