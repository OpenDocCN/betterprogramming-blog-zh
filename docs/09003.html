<html>
<head>
<title>How To Correctly Store Passwords in a Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在数据库中正确存储密码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-correctly-store-passwords-in-a-database-5d261f49f605?source=collection_archive---------1-----------------------#2021-07-06">https://betterprogramming.pub/how-to-correctly-store-passwords-in-a-database-5d261f49f605?source=collection_archive---------1-----------------------#2021-07-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9227" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如此简单的事情同时也可能是危险的</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1deb1e3da5b939ed882e05ab2be85b8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-IEveEBLJ63zc2yh5f9BAg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/@pixabay?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">皮查拜</a>从<a class="ae ky" href="https://www.pexels.com/photo/black-android-smartphone-on-top-of-white-book-39584/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">派克斯</a>拍摄。</p></figure><p id="3b9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在数据库中保存用户密码很常见，但并不是每个开发人员都做得很好。例如，在今天的代码审查中，我发现密码是明文的。当我问开发人员以这种方式保存它有什么危险时，他们很快意识到这个问题，并想知道解决方案是不是加密它。我回答:“没有。”</p><p id="d4d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将解释一个正确而简单的方法。我们开始吧。</p><p id="6120" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">难度:容易</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="bc36" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">存储密码</h1><p id="3712" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">将密码存储为纯文本字段是一个糟糕的想法，但是使用双向算法加密存储也是一个糟糕的想法。</p><p id="8b5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么？因为如果我们使用一个加密密钥和一个允许我们加密和解密密码的算法来加密和存储密码，任何拥有加密密钥的人都可以解密它。</p><h2 id="2caa" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">那么正确的做法是什么呢？</h2><p id="21e3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在大多数情况下，将密码的表示存储在数据库中是正确的做法。</p><p id="ecfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，您必须使用单向算法对每个用户使用不同的salt散列密码，并存储结果，删除原始密码。然后，当您想要验证密码时，使用相同的散列算法和相同的salt再次散列纯文本密码，并将其与数据库中的散列存储值进行比较。</p><h2 id="180f" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">好吧，但是你对每个用户使用不同的盐是什么意思？</h2><p id="cc95" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">salt是随机数据，用作对数据进行哈希运算的单向算法的额外输入。过去，系统上只存储密码的加密哈希函数，但随着时间的推移，开发了额外的保护措施来防止常见或重复的密码被识别。</p><h2 id="b519" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">让我们来看一个实际案例</h2><p id="a2cb" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">假设我们在数据库中有一个表来存储我的应用程序的用户。该表包含以下字段，我们将使用这些字段来存储用户和密码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Postgres创建一个表</p></figure><p id="5953" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是每当我们在该表中创建一个用户时，为每个用户生成一个唯一的salt。为此，我将使用Java定义一个类，其中包含一个生成salt的方法。使用任何其他编程语言都是类似的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><ol class=""><li id="f7b1" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">在第7行，我们定义了盐的长度。</li><li id="6db1" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">在第11行，我们创建了一个<code class="fe oc od oe of b">SecureRandom</code>类的实例。这个类提供了一个由JDK提供的加密的强随机数生成器(对于其他语言，我们有类似的库)。</li><li id="5a18" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">在第16行，我们创建了salt值，然后返回Base64字符串。</li></ol><p id="be95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们有了用户的salt，下一步就是使用salt散列纯文本密码。为此，我们将在我们的类中添加一个名为<code class="fe oc od oe of b">hashThePlainTextPassword</code>的方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">hashThePlainTextPassword方法</p></figure><ol class=""><li id="900b" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">在第10行，我们指定了迭代次数和<code class="fe oc od oe of b">PBEKey</code>的长度。</li><li id="2710" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">在第13行，我们获得了一个<code class="fe oc od oe of b">SecretKeyFactory</code>的实例。</li><li id="04da" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">在第14行，我们生成了密钥。</li><li id="47d7" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">在第15行，我们返回Base64字符串形式的散列密码。</li></ol><p id="b28f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们的密码被加盐，我们就可以把它和它的盐一起存储在用户的桌子上。注意<strong class="lb iu"> </strong>当使用单向算法解码密码时，我们将永远无法知道明文中密码的原始值。所以即使你得到了用户的salt，如果你不知道原始明文密码，你也永远不会生成相同的hash。</p><h2 id="6512" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">那么我怎么知道密码是否正确呢？</h2><p id="8c99" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">非常容易。如果我们想要验证一个密码，我们再次散列该值(使用相同的散列算法和salt ),并将其与数据库中用户的散列值进行比较。</p><p id="d24c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们将在类中添加一个名为<code class="fe oc od oe of b">verifyThePlainTextPassword</code>的方法。这个方法用原始的salted值散列明文密码。现在，如果用户在数据库中存储的值和生成的哈希值相同，密码也相同。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">verifyThePlainTextPassword方法</p></figure><h2 id="f4a3" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">一起</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PasswordUtils类</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4808" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="d6f0" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如您所见，在数据库中正确保存密码很简单，正确地这样做可以避免许多问题。</p><p id="e255" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这篇文章，可以考虑通过我的<a class="ae ky" href="https://kesk.medium.com/membership" rel="noopener">个人资料</a>订阅Medium。谢谢大家！</p></div></div>    
</body>
</html>