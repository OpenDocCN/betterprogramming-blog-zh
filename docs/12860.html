<html>
<head>
<title>How to Share API Changes With Your Team</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何与你的团队分享API的变化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-share-api-changes-with-your-team-d5753df38c38?source=collection_archive---------23-----------------------#2022-07-06">https://betterprogramming.pub/how-to-share-api-changes-with-your-team-d5753df38c38?source=collection_archive---------23-----------------------#2022-07-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fd29" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">确保使用您的API的团队可以轻松迁移到更新版本的最佳实践</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/e5b82a9c20a7cccc8729473460b8b45a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*lhmITOKrgW1zObNC_LsBKg.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">照片由<a class="ae ku" href="https://unsplash.com/@romaindancre?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">罗曼·丹斯克</a>在<a class="ae ku" href="https://unsplash.com/s/photos/document?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="8f89" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果你的团队正在开发或更新一个API作为你的软件项目的一部分，你需要小心对那个API进行修改。这些变更可能会导致意想不到的错误或失败，并给不知道这些变更的团队成员留下不愉快的惊喜。缺乏沟通或协调会使你组织的小问题变成大问题。</p><p id="8e13" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">记录API的变化并与你的团队和其他利益相关者分享是很重要的。在本文中，您将了解一些最佳实践，您可以使用这些实践来共享API更改并避免由于API更新而导致的错误。您还将了解像<a class="ae ku" href="https://www.useoptic.com/" rel="noopener ugc nofollow" target="_blank"> Optic </a>这样的工具，您可以使用它们来跟踪和共享API变更。</p><h1 id="252e" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">什么样的API变化导致了问题？</h1><p id="9620" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">下面是一些可能导致软件错误的API变化的例子。</p><h2 id="dda7" class="mo ls it bd lt mp mq dn lx mr ms dp mb le mt mu md li mv mw mf lm mx my mh mz bi translated">更改端点的响应对象</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/a3ec55e5552abeedc0de9efc3fef30f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UDctcwVRHGd4F5Zd.png"/></div></div></figure><p id="d877" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">假设您有一个简单的Flask API。左边是带有单个端点的原始API，它返回ID、名字、姓氏和全名等信息。您认为名和姓是多余的，因为它们可以通过简单的拆分操作从全名中派生出来；右边是带有更新的响应对象的同一个端点。</p><p id="bc25" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果您的团队成员之一使用您的API，如下面的代码片段所示，对API的更改将会破坏他们的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="1faa" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果更新响应对象中某些字段的名称或数据类型，也会出现这种错误。</p><h2 id="8174" class="mo ls it bd lt mp mq dn lx mr ms dp mb le mt mu md li mv mw mf lm mx my mh mz bi translated">更改端点的名称或结构</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/46793405be2b8a61d7a222c12dd34762.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YufFCZSpuyBx_W96.png"/></div></div></figure><p id="d786" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">上面的两个代码片段只有一个字母不同。在左边，端点使用<code class="fe nh ni nj nk b">user</code>，而在右边，它使用<code class="fe nh ni nj nk b">users</code>。</p><p id="aa20" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果团队成员使用如下所示的API，更新会破坏他们的代码，因为请求会发送到一个不存在的URL:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="a12c" class="mo ls it bd lt mp mq dn lx mr ms dp mb le mt mu md li mv mw mf lm mx my mh mz bi translated">更新端点的响应代码</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/a0b79cfff938b87605818e64618143ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MLrzp5x9kCZzqMFN.png"/></div></div></figure><p id="e561" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果您将其中一个API端点的错误响应代码从<code class="fe nh ni nj nk b">500</code>更新到<code class="fe nh ni nj nk b">404</code>，这可能会导致一个bug。考虑下面的代码片段:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="a2dc" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果有人实现了错误处理，但是检查了状态代码<code class="fe nh ni nj nk b">500</code>，那么新的响应代码<code class="fe nh ni nj nk b">404</code>将不会被处理。结果，<code class="fe nh ni nj nk b">else</code>块中的代码将被执行并导致错误。</p><h1 id="98d7" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">需要可选参数</h1><p id="2373" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">如果您使可选参数成为必需的，您可能会遇到另一个问题。假设您有一个从图书数据库返回图书的端点。端点接受要返回的书籍数量的可选参数，默认设置为10。如果您后来决定将书籍数量作为一个必需的参数，那么任何以前使用过您的端点而没有传递可选参数的人都将面临错误。</p><p id="a8b5" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">以上只是一些可能出现问题的变化。甚至更新诸如身份验证或速率限制值之类的东西也会导致团队成员的代码出现错误。</p><h1 id="bf6a" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">为什么要和你的团队分享API的变化？</h1><p id="2479" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">除了中断变更的可能性之外，以下是与您的团队共享变更的其他原因:</p><ul class=""><li id="8125" class="nl nm it kx b ky kz lb lc le nn li no lm np lq nq nr ns nt bi translated">团队成员可以提供有价值的反馈，否则可能会丢失。在采取行动之前考虑任何API变化的潜在影响是很重要的，让您的团队参与进来将有助于确保您做出正确的选择。</li><li id="2ebb" class="nl nm it kx b ky nu lb nv le nw li nx lm ny lq nq nr ns nt bi translated">他们需要为API的变化做准备。这可能包括测试更改或确保他们的代码与新的API兼容。他们需要能够解释他们代码中的变化；否则，他们可能会被意想不到的问题或错误弄得措手不及，这可能会破坏团队成员之间的关系。</li><li id="cf0a" class="nl nm it kx b ky nu lb nv le nw li nx lm ny lq nq nr ns nt bi translated">更改不仅会破坏您的API，还会对使用该API的其他应用程序造成损害。如果你的团队不知道这些变化，他们就不会准备好处理这些后果。</li></ul><h1 id="074b" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">你应该如何分享API的变化？</h1><p id="6c3f" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">有多种方法可以让您的团队了解变化。这里有一些选择。</p><h1 id="1d0e" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">代码审查</h1><p id="176b" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">您可以建立一个代码审查系统，以确保对API的任何更新在最终确定之前都经过团队成员的审查。这让您的团队有机会发现问题并提出改进建议。</p><p id="d002" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">像<a class="ae ku" href="https://www.useoptic.com/" rel="noopener ugc nofollow" target="_blank">光学</a>这样的工具允许你回顾这些类型的变化。以下是Optic生成的API变更日志示例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/cf260e2515882d2c70f75e4e3297c170.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*A7Nl0eUivi3WbAwz.png"/></div></div></figure><p id="eb85" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">Optic还提供了一个<a class="ae ku" href="https://www.useoptic.com/blog/launching-the-optic-gitbot/" rel="noopener ugc nofollow" target="_blank"> GitBot </a>，它可以将API变更日志添加到您发出的每个拉取请求中。这里有一个例子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/ada1812a51620efe9c447fd6e66b8769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*38J2J0BKTs2Lp_Se.png"/></div></div></figure><h1 id="57c1" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">沟通渠道</h1><p id="e08c" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">确保您的团队了解任何API变更的一个方法是使用一个单独的渠道来共享这些变更——例如，一个Slack渠道或一个电子邮件列表。这将确保每个人都知道会发生什么。以下是管理这种渠道的一些技巧:</p><ul class=""><li id="ee14" class="nl nm it kx b ky kz lb lc le nn li no lm np lq nq nr ns nt bi translated">使其成为只读频道，以避免任何讨论。您的团队应该能够检查通知，而不必滚动查看其他消息。</li><li id="2a0d" class="nl nm it kx b ky nu lb nv le nw li nx lm ny lq nq nr ns nt bi translated">确保清楚记录潜在的突破性变化。你可以在信息的开头加上<code class="fe nh ni nj nk b">[IMPORTANT]</code>或者加上红色背景。</li><li id="e20d" class="nl nm it kx b ky nu lb nv le nw li nx lm ny lq nq nr ns nt bi translated">提前就这些变化进行沟通。这将让你的团队有时间做好准备。</li></ul><h1 id="c81f" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">API文档更新</h1><p id="8d72" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">当涉及到API变更时，拥有全面和最新的文档是必不可少的。这将有助于确保团队中的每个人都理解这些变化，并知道如何实现它们。</p><p id="2e01" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">文档既可以手动更新，也可以通过Swagger或Postman等自动化服务进行更新。例如，<a class="ae ku" href="https://www.useoptic.com/" rel="noopener ugc nofollow" target="_blank"> Optic </a>分析对API的请求、响应和流量，以便更准确地记录和呈现变化。<a class="ae ku" href="https://www.useoptic.com/blog/four-approaches-for-documenting-apis#method-4-documentation-diffs-with-optic" rel="noopener ugc nofollow" target="_blank">阅读更多</a>关于Optic如何处理文档中的API变更。</p><h2 id="e7a3" class="mo ls it bd lt mp mq dn lx mr ms dp mb le mt mu md li mv mw mf lm mx my mh mz bi translated">API合同测试</h2><p id="ec03" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">如果你根据用户的反馈更新你的API，你可以和你的团队或者利益相关者一起建立一个API契约来描述你的API应该如何工作。您可以使用JSON模式来记录API的端点响应代码并设置契约。</p><p id="b83b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">该合同必须为各方所接受。然后，对API所做的任何更改在被批准之前都必须通过合同测试。合同测试可以自动化并整合到您的CI/CD渠道中。契约测试工具包括<a class="ae ku" href="https://docs.pact.io/" rel="noopener ugc nofollow" target="_blank">契约</a>和<a class="ae ku" href="https://spring.io/projects/spring-cloud-contract" rel="noopener ugc nofollow" target="_blank">春云契约</a>。</p><h2 id="af59" class="mo ls it bd lt mp mq dn lx mr ms dp mb le mt mu md li mv mw mf lm mx my mh mz bi translated">文档驱动的开发</h2><p id="8a62" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">这类似于测试驱动的开发，但是您将在开发API之前编写文档，而不是首先编写测试。这意味着对你的API所做的任何改变都必须首先被记录下来。您可以遵循OpenAPI标准来编写文档，或者使用类似于<a class="ae ku" href="https://www.useoptic.com/" rel="noopener ugc nofollow" target="_blank"> Optic </a>的服务来编译文档，而不是手动完成。</p><h1 id="c6e2" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">版本化API</h1><p id="1500" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">使用版本化API允许团队成员和最终用户继续使用旧版本的API，同时更新他们的代码以使用新版本。这大大降低了任何重大API变更的影响。但是这是有代价的，因为您可能仍然需要为旧版本提供支持。</p><p id="5e8d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您还需要维护额外的文档，以确保用户仍然可以使用旧版本。</p><p id="73b1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">确保您的API是向后兼容的；如果一个用户能够使用你的API的一个以前的版本，他们应该或者能够使用你的API的将来的版本而不做任何改变，或者仍然能够使用以前的版本。这可以通过为API的两个版本提供支持，并向旧API添加一个弃用警告来让用户知道他们必须尽快迁移来实现。</p><p id="54e6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您还可以定义API URLs，以便包含版本号。例如:</p><pre class="kj kk kl km gt nz nk oa ob aw oc bi"><span id="ffa1" class="mo ls it nk b gy od oe l of og"><a class="ae ku" href="http://www.myapi.com/v1/getBooks" rel="noopener ugc nofollow" target="_blank">www.myapi.com/v1/getBooks</a></span></pre><p id="60ac" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这将确保您的API的任何更新或新发布不会破坏您的团队成员或最终用户的代码，如果他们使用以前的版本。</p><h1 id="1923" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">结论</h1><p id="452e" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">即使对API的响应对象或URL进行很小的更改，也会对其他团队成员或利益相关者产生很大的影响。让你的团队了解情况很重要。拥有一个好的工作流来共享API变更、记录它们并测试它们，将会防止错误或其他问题。</p><p id="dfa4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">改进API开发工作流程的一个方法是使用<a class="ae ku" href="https://www.useoptic.com/" rel="noopener ugc nofollow" target="_blank"> Optic </a>来自动化测试、文档和变更的透明性。该工具通过生成changelog来跟踪和检查API更改，然后使用对API的请求、响应和流量来生成文档。</p><p id="3a1a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">想了解更多？Optic是一个开源项目，所以你可以<a class="ae ku" href="https://www.useoptic.com/docs/" rel="noopener ugc nofollow" target="_blank">加入社区</a>努力使编写文档变得容易。</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt nz nk oa ob aw oc bi"><span id="e668" class="mo ls it nk b gy od oe l of og"><strong class="nk iu">Want to Connect?</strong></span><span id="cd07" class="mo ls it nk b gy oo oe l of og">This article was originally posted on <a class="ae ku" href="https://realjavascriptproject.com/how-to-share-api-changes-with-your-team/" rel="noopener ugc nofollow" target="_blank">realjavascriptproject.com</a></span><span id="8d02" class="mo ls it nk b gy oo oe l of og">LinkedIn: <a class="ae ku" href="https://www.linkedin.com/in/rahulbanerjee2699/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/rahulbanerjee2699/</a></span></pre></div></div>    
</body>
</html>