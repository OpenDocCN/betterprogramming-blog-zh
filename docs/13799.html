<html>
<head>
<title>Reading Simple Errors in TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">读取TypeScript中的简单错误</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-typescript-guide-i-wish-i-had-reading-errors-part-1-68a1c82d9303?source=collection_archive---------9-----------------------#2022-09-28">https://betterprogramming.pub/the-typescript-guide-i-wish-i-had-reading-errors-part-1-68a1c82d9303?source=collection_archive---------9-----------------------#2022-09-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4104" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用直观的指南和简单的语言</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/d9621de790505d4b466c5a131e8acc95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*5XjgqlV781SdKII_yDFkOQ.jpeg"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="3107" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">TypeScript可能充斥着错误和警告，似乎是为了每一件小事。以这个函数为例:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="077b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">(如果您不确定<code class="fe lp lq lr ls b">:number</code>在函数参数中的含义，我会在本指南的<a class="ae lt" href="https://medium.com/@conraddavisjr/the-typescript-guide-i-wish-i-had-185087d66dd1" rel="noopener">章节中介绍更多内容。但是不要担心，我们也会在本文中轻松地重温它。)</a></p><p id="41a7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在严格模式下，使用TS eslint设置，TypeScript实际上会对这个使用TypeScript的完美工作函数发出警告！错误应该是这样的:<code class="fe lp lq lr ls b">Missing return type on function</code>。</p><p id="04d0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查找错误是一件令人头疼的事情，所以在这篇文章中，我们将深入讨论一系列错误以及如何理解和解决它们。由于在TypeScript中有大量不同的错误，本章将被分成许多部分，以尽量涵盖广泛的错误。如果你将来遇到这些讨厌的错误，请随意将它加入书签并重新阅读。我们开始吧！</p><h2 id="3980" class="lu lv iq bd lw lx ly dn lz ma mb dp mc la md me mf le mg mh mi li mj mk ml mm bi translated">1."函数缺少返回类型"</h2><p id="9f35" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">原因:</p><p id="ac24" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们没有告诉TypeScript我们期望从函数中返回什么。很多时候，TypeScript可以假设这一点，但是在严格模式下，它会要求您声明这一点。</p><p id="c42b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">解决方案:</p><p id="0f0c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在函数参数的结束参数后加一个冒号，并写出函数返回的类型，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/0cd028cad2575cf939e91c61fec8c258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*Esqxr45NoOGzAEDD550hEQ.jpeg"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">一个简单的函数，addTwoNumbers，将提供的第一个和第二个数字相加。该函数被分配一个数字类型作为返回值</p></figure><p id="0ebc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">提示</strong>:如果您不确定哪个(些)类型可以从您的函数返回，您可以将鼠标悬停在您的文本编辑器中的函数名称上，TypeScript将向您显示可以使用的返回类型。这将在99%的情况下有效！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/514d422108aa1eb48e306f28e6452075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*P-ZD5zGoV2zHjGQlaVzPWA.gif"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">GIF，显示typescript如何解释函数返回类型</p></figure><p id="0953" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为什么返回类型很重要:</p><p id="d605" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">函数可能会返回许多不同的结果。甚至像<code class="fe lp lq lr ls b">addTwoNumbers</code>这样简单的东西也可以返回<code class="fe lp lq lr ls b">number</code>、<code class="fe lp lq lr ls b">NaN</code>、<code class="fe lp lq lr ls b">null</code>、<code class="fe lp lq lr ls b">void</code>，甚至是<code class="fe lp lq lr ls b">string</code>，这取决于你如何设计它。因此，TS希望您清楚地列出它应该期望的所有可能的返回值。</p><p id="3ac7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您正在构建一个其他人会使用的API，这一点尤其有用。帮助他们可靠地知道预期的数据类型可以将您的API与其他API区分开来。</p><p id="714e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">返回一个类型最酷的地方在于，当你重构或更新一个函数时，如果你不小心(或不知不觉地)忘记了返回一个重要的、期望的属性，TS会让你知道。此外，它可以为您自动完成一个可用属性列表，帮助您发现代码中正在处理的数据的更多信息。我们将很快介绍所有这些内容。</p><p id="ceaf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用我为本文制作的这个小应用程序来查看其他几个错误(和好处)。你可以在那里随意探索…我们会详细讨论的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu lo l"/></div></figure><p id="5456" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们打开上面的应用程序。在第<code class="fe lp lq lr ls b">25</code>行，我们使用一个<code class="fe lp lq lr ls b">getUserByRole</code>函数根据用户的<code class="fe lp lq lr ls b">role</code>返回一些用户数据。在这个应用程序中，用户可以是一个<code class="fe lp lq lr ls b">admin</code>，也可以是一个<code class="fe lp lq lr ls b">guest</code>。</p><p id="a36a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用一个接口，我们可以描述一个<code class="fe lp lq lr ls b">AdminUser</code>和一个<code class="fe lp lq lr ls b">GuestUser</code>看起来像什么，并通过把<code class="fe lp lq lr ls b">:AdminUser | GuestUser</code>放在它的参数体之后，把它传达给我们的函数。我喜欢这样想象它:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/81a46da693561f91ed2b8032dc79005b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PprmE7X3MDmt6DPqSNWcJA.jpeg"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">显示接口如何分配给方法的图形</p></figure><p id="7ea7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">既然我们定义了一个<code class="fe lp lq lr ls b">AdminUser</code>和一个<code class="fe lp lq lr ls b">GuestUser</code>的样子，TypeScript可以为我们做很多很酷的事情。以这段代码为例:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="8290" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">仅仅通过编写<code class="fe lp lq lr ls b">if (role === 'admin')</code>，TypeScript就可以<em class="na">告诉</em>我们正在讨论<code class="fe lp lq lr ls b">AdminUser</code>，并准备好期待返回它们特定形式的数据。这称为类型收缩。当你将一个类型列表(官方称为union，看起来像这样→ <code class="fe lp lq lr ls b">type1 | type2</code>)缩小到一个更小、更具体的列表，比如<code class="fe lp lq lr ls b">AdminUser | GuestUser</code>到仅仅<code class="fe lp lq lr ls b">AdminUser</code>。TypeScript可以通过评估属于我们提供的类型的属性来解决这个问题。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nb"><img src="../Images/323f3f5403ece11741c9265d0decab6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-qT-egbnM548dXM-uW35rg.jpeg"/></div></div></figure><p id="00b4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">TypeScript有助于为<code class="fe lp lq lr ls b">AdminUser</code>提供可用的属性列表。这可以让我们对物体有更深入的了解。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mt"><img src="../Images/eab627ef55e5ebfc5ae277180700b8cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*hI-Dgf1IdjcQgkXlg55uHg.gif"/></div></div></figure><p id="3cec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你自己试试吧！在下面的应用程序中，注释行<code class="fe lp lq lr ls b">33–35.</code>然后，当你的光标在对象体内时，按<code class="fe lp lq lr ls b">ctrl + I</code>或<code class="fe lp lq lr ls b">cmd + I</code>(对于Mac)来获得属于<code class="fe lp lq lr ls b">AdminUser</code>的属性的完整列表！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu lo l"/></div></figure><p id="271e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">注意</strong>:属性列表将只显示当前没有列出的对象属性。因此，如果您已经返回了它的所有属性，该命令将不会显示更多可用的属性。</p><p id="7f5c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们试图检查一个角色不存在的用户，比如“writer”呢？如<code class="fe lp lq lr ls b">if (role === ‘writer’)</code>。这会导致我们的下一个错误。</p><h2 id="4bab" class="lu lv iq bd lw lx ly dn lz ma mb dp mc la md me mf le mg mh mi li mj mk ml mm bi translated">2.此条件将始终返回“false”，因为类型“UserRoles”和“<code class="fe lp lq lr ls b">writer</code>”没有重叠。</h2><p id="0eed" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">原因:</p><p id="17c2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们试图比较的一个(或多个)值与TypeScript被告知的不一致。在上面的应用示例中，这是因为我们只有两个角色，“admin”和“guest”在我们的定义中,“作家”角色并不存在。我喜欢这样想象它:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/e2c53a564e3437f7743d6271f447ec18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*0VwPou2G6K4g4CZCXCaurA.jpeg"/></div></figure><blockquote class="nd"><p id="7523" class="ne nf iq bd ng nh ni nj nk nl nm lm dk translated"><code class="fe lp lq lr ls b">This condition will always return ‘false’ since the types ‘UserRoles’ and ‘“writer”’ have no overlap</code></p></blockquote><p id="f315" class="pw-post-body-paragraph kr ks iq kt b ku nn jr kw kx no ju kz la np lc ld le nq lg lh li nr lk ll lm ij bi translated">让我们一字不差地分析错误。</p><p id="4c30" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe lp lq lr ls b">This condition</code> —条件评估。那是<code class="fe lp lq lr ls b">if</code>座，也可能是<code class="fe lp lq lr ls b">ternary</code>座等等。比较<code class="fe lp lq lr ls b">true</code>或<code class="fe lp lq lr ls b">false</code>中的值和结果的任何东西。</p><p id="4810" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe lp lq lr ls b">will always return ‘false’</code> —它永远不会运行那部分代码！它不会进入条件语句，因为它总是假的…基本上是这样的:<code class="fe lp lq lr ls b">if(false) {/* will never run */}</code>。</p><p id="0232" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe lp lq lr ls b">since the types ‘UserRoles’</code> —在这种情况下，“用户角色”是TypeScript作为其真实来源引用的值。请注意，<code class="fe lp lq lr ls b">UserRoles</code>是我选择的名字，它可以是你想要的任何名字。在您的应用程序中，这将匹配提供给TS的任何类型。</p><p id="d004" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe lp lq lr ls b">and ‘“writer”’</code> —这是您试图使用的导致错误的值。</p><p id="38a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe lp lq lr ls b">have no overlap</code> —您尝试使用的值不存在于TypeScript所引用的真理来源(<code class="fe lp lq lr ls b">UserRoles</code>)中。您可以将它添加到提供给TS的列表中，或者坚持使用union中的一个值(<code class="fe lp lq lr ls b">UserRoles</code>)。</p><p id="75a0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">解决方案:</p><p id="1c07" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下方法之一将有效:</p><p id="e19b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">A.更新类型<code class="fe lp lq lr ls b">UserRoles</code>(在本例中)以包含“writer”，比如:<code class="fe lp lq lr ls b">type UserRoles = ‘admin’ | ‘guest’ | ‘writer’</code>。</p><p id="46e1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">或者</p><p id="27ff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">B.回退到使用<code class="fe lp lq lr ls b">UserRoles</code>中提供的值(在本例中为‘admin’或‘guest’)，这样我们就可以在使用的值中获得“重叠”。</p></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><p id="a23d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于下一个错误(TS中最常见的错误之一)，进入下面的文本编辑器，将任何字符串值更改为不同的数据类型，比如数字。例如，在第<code class="fe lp lq lr ls b">40</code>行，将<code class="fe lp lq lr ls b">guest123</code>改为一个数字，如<code class="fe lp lq lr ls b">2</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu lo l"/></div></figure><h2 id="848b" class="lu lv iq bd lw lx ly dn lz ma mb dp mc la md me mf le mg mh mi li mj mk ml mm bi translated">3.类型“number”不可赋给类型“string”</h2><p id="3ab1" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">或者<code class="fe lp lq lr ls b">Type ‘[TYPE_1]’ is not assignable to type ‘[TYPE_2]’</code></p><p id="4087" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">原因:</p><p id="58ac" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们正在尝试使用与TypeScript期望的类型不匹配的类型。第一种类型，<code class="fe lp lq lr ls b">TYPE_1</code>，是我们正在尝试使用的。另一种类型，<code class="fe lp lq lr ls b">TYPE_2</code>，是TypeScript所期望的类型。下面是我对这个错误的形象化描述:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/fe0375b62ee09bad4c6a23474620bf6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*zc75r_g1yPIc3-v2q6y3sg.jpeg"/></div></figure><p id="d3b3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们告诉TypeScript，<code class="fe lp lq lr ls b">role</code>只能是“客人”，然后我们转身尝试设置一个数字<code class="fe lp lq lr ls b">78</code>，作为<code class="fe lp lq lr ls b">role</code>的值。这种情况经常发生，尤其是对于我们没有构建的复杂数据和API。</p><p id="5172" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">解决方案:</p><p id="4461" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使您的类型与预期相符，或者更新预期。在上面的例子中，一个解决方案可以是将数字<code class="fe lp lq lr ls b">78</code>改为<code class="fe lp lq lr ls b">"guest"</code>，或者，如果我们想特别允许数字<code class="fe lp lq lr ls b">78</code>的话。我们可以更新<code class="fe lp lq lr ls b">GuestUser</code>接口以允许<code class="fe lp lq lr ls b">78</code>或任何通用的<code class="fe lp lq lr ls b">number</code>值。这里有一个例子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ln lo l"/></div></figure></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><p id="8823" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢阅读。敬请关注更多内容。</p></div></div>    
</body>
</html>