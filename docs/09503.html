<html>
<head>
<title>Two Ways To Unsubscribe Angular Observables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">取消订阅角度可观测量的两种方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/two-ways-to-unsubscribe-angular-observables-fc59d5a56dae?source=collection_archive---------7-----------------------#2021-09-01">https://betterprogramming.pub/two-ways-to-unsubscribe-angular-observables-fc59d5a56dae?source=collection_archive---------7-----------------------#2021-09-01</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="4e57" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">以一种简单的方式清理有角度的观察点</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/5dcd2b5d201e9c1c234febd61881c293.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vcy2k5n2BEtdZIQORHkuRQ.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@charissek?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Charisse Kenion </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由作者编辑</p></figure><p id="dc75" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Angular充满了可观察的事物。但是，有没有一种机制可以在组件被破坏时自动取消订阅您的可观测量？</p><p id="8be8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我读了很多关于清理你的订阅的不同帖子。有这么多不同的方法，但我错过了一个帖子，告诉我你应该如何处理你的订阅和什么时候。</p><p id="a7bb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了防止你像我一样阅读所有这些帖子，这里有一个实用的帖子，解释如何轻松取消订阅你的Observables。</p><h1 id="04e9" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">TLDR；</h1><p id="28d5" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">简短的版本，给那些不想深入了解的人😅。以下是解决方案。</p><h2 id="8023" class="mt lx iu bd ly mu mv dn mc mw mx dp mg lj my mz mi ln na nb mk lr nc nd mm ne bi translated">异步管道</h2><p id="3630" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">异步管道让你可以处理HTML模板中的可观察对象。在组件的销毁过程之后，异步管道自动运行取消订阅过程。</p><h2 id="a7e6" class="mt lx iu bd ly mu mv dn mc mw mx dp mg lj my mz mi ln na nb mk lr nc nd mm ne bi translated">直到</h2><p id="856a" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated"><code class="fe nf ng nh ni b">takeUntil</code>可以在你订阅之前在<code class="fe nf ng nh ni b">.pipe()</code>方法中调用。通过这种方法，您可以将您的订阅添加到<code class="fe nf ng nh ni b">Subject</code>。如果你有一些订阅，你可以通过<code class="fe nf ng nh ni b">.next()</code>和<code class="fe nf ng nh ni b">.complete()</code>方法在<code class="fe nf ng nh ni b">ngOnDestroy</code>事件中取消订阅。</p></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h1 id="a63f" class="lw lx iu bd ly lz nq mb mc md nr mf mg ka ns kb mi kd nt ke mk kg nu kh mm mn bi translated">1.具有异步管道的HTML模板中的可观察对象</h1><p id="3fde" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">Angular提供了一种简单的方法，通过异步管道<code class="fe nf ng nh ni b">| async</code>来处理HTML模板中的观察值。最棒的是，Angular替你完成了退订过程，而不是自己动手。</p><p id="7ef6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于奇异值，可以使用异步管道。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nv nw l"/></div></figure><p id="b0ea" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">或者可以将它用于对象或数组的值。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nv nw l"/></div></figure><p id="8aeb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以在这个组件中，你不需要用<code class="fe nf ng nh ni b">ngOnDestroy</code>触发什么东西，但是它会在组件的销毁过程中自动退订订阅。</p></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><blockquote class="nx ny nz"><p id="8ab6" class="la lb oa lc b ld le jv lf lg lh jy li ob lk ll lm oc lo lp lq od ls lt lu lv in bi translated">如果你想了解更多关于Angular中异步管道的知识，可以看看这篇由Erxk 撰写的文章“<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/angular-rxjs-async-pipe-deep-dive-2510b56f793a"> Angular和RxJS:深入研究异步管道</a></p></blockquote></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h1 id="526d" class="lw lx iu bd ly lz nq mb mc md nr mf mg ka ns kb mi kd nt ke mk kg nu kh mm mn bi translated">2.使用takeUntil方法的可观察值</h1><p id="8200" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">假设您正在通过<code class="fe nf ng nh ni b">HttpClient</code>发出多个AJAX请求。你不会直接把它传递给HTML，而是先对数据做些别的事情。所以<code class="fe nf ng nh ni b">| async</code>管不适合这种情况。</p><p id="82b4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在您有多个订阅！</p><p id="eb02" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">怎样才能一次全部退订，而不是一个一个退订？</p><p id="b2b5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">首先，我们必须在组件中创建一个<code class="fe nf ng nh ni b">Subject</code>。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nv nw l"/></div></figure><p id="d2d0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个<code class="fe nf ng nh ni b">Subject</code>将用于存储我们的订阅。</p><p id="b8f1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在让我们用<code class="fe nf ng nh ni b">HttpClient</code>在我们的<code class="fe nf ng nh ni b">ngOnInit</code>进行一些订阅。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nv nw l"/></div></figure><p id="a1d3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如你所见，在<code class="fe nf ng nh ni b">get()</code>方法之后还有一个<code class="fe nf ng nh ni b">pipe(takeUntil(this.unsubscribe$))</code>。使用<code class="fe nf ng nh ni b">takeUntil</code>,我们从这个可观察对象添加一个引用到<code class="fe nf ng nh ni b">unsubscribe$</code>主题。</p><p id="c5c3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在订阅过程中,<code class="fe nf ng nh ni b">Subject</code>保存对这两个可观测量的引用。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nv nw l"/></div></figure><p id="34c7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在一个组件将要被销毁之前，调用<code class="fe nf ng nh ni b">ngOnDestroy()</code>方法。</p><p id="2a91" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这个方法中，我们调用两个方法。</p><p id="5472" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe nf ng nh ni b">next()</code>将向订阅传递一个空值。使用<code class="fe nf ng nh ni b">complete()</code>，我们告诉订阅它已经完成了对新值的监听。</p><p id="4e50" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在我们不必担心通过<code class="fe nf ng nh ni b">HttpClient</code>发出一个或更多的请求；我们可以立刻阻止他们。</p><blockquote class="nx ny nz"><p id="bfd1" class="la lb oa lc b ld le jv lf lg lh jy li ob lk ll lm oc lo lp lq od ls lt lu lv in bi translated">小心使用这个方法，不要忘记给你的组件添加<code class="fe nf ng nh ni b">ngOnDestroy</code>方法。我们是人，所以我们忘了他们。</p></blockquote></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><p id="1dd2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://blog.byrayray.dev/subscribe" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iv">通过电子邮件获取我的文章点击这里</strong> </a> <strong class="lc iv"> | </strong> <a class="ae kz" href="https://blog.byrayray.dev/membership" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iv">购买5美元中等会员</strong> </a></p></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h1 id="d476" class="lw lx iu bd ly lz nq mb mc md nr mf mg ka ns kb mi kd nt ke mk kg nu kh mm mn bi translated">结论</h1><p id="739a" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">这两个策略在十之八九的情况下都是可用的，所以这是一个在角度应用中实现的好计划。</p><p id="52d7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你对如何以简单的方式处理角度应用中的可观测量有其他想法，请告诉我。</p></div></div>    
</body>
</html>