<html>
<head>
<title>How to Support Over-the-Air Updates on Multiple Expo SDKs in Parallel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何并行支持多个Expo SDKs的空中更新</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-support-over-the-air-updates-on-multiple-expo-sdks-in-parallel-3bd65c62d230?source=collection_archive---------3-----------------------#2020-09-27">https://betterprogramming.pub/how-to-support-over-the-air-updates-on-multiple-expo-sdks-in-parallel-3bd65c62d230?source=collection_archive---------3-----------------------#2020-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f03d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更新Expo SDKs时要记住一件事</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/10f0a2ec223407765ff6e449d9a9650d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dnDzthDPA2q74fq5"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@cobblepot?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">基特·苏曼</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="f123" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">世博会太棒了。它帮助您从相同的代码库开发、构建和部署iOS、Android和web应用程序。</p><p id="efb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它在其服务器上为Android和iOS构建二进制文件，并为发布渠道和空中下载(OTA)更新提供支持。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ba56" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">OTA更新</h1><p id="521f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">OTA更新适用于JS包的任何已发布的更改。您将新功能添加到应用程序中，运行Expo build，然后发布。仅此而已。用户可以在他们的设备上立即获得更新——在后台，无需更新本机应用程序。到目前为止一切看起来都很好！</p><h2 id="a362" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">升级Expo SDK</h2><p id="0013" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当你决定升级Expo SDK时，有一点你必须记住:SDK升级需要在应用商店(App Store，Google Play)上更新原生应用。</p><p id="b699" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要通过OTA更新获得新的捆绑包，已安装应用程序上的SDK必须与发布的SDK相匹配。但不能保证所有用户都能立即安装更新。这就是问题所在。</p><p id="9710" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是描述Expo如何确定向用户返回哪个版本的流程图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/cc348ba3e46c8ee764543b502ef6bd2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/0*7QmJ_YyFq4DTqAaw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通过<a class="ae ky" href="https://docs.expo.io/workflow/publishing/" rel="noopener ugc nofollow" target="_blank">世博文件</a>进行说明</p></figure><p id="731e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里找到关于发布过程<a class="ae ky" href="https://docs.expo.io/workflow/publishing/" rel="noopener ugc nofollow" target="_blank">的更多细节。</a></p><p id="08e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">情况是，在用户更新原生应用程序之前，使用旧SDK构建的原生应用程序不会收到任何后续SDK版本的任何OTA更新。</p><p id="df89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，我明白。你可能只是想告诉用户应该更新应用程序——在旧版本上部署一个微妙的“请更新应用程序”横幅，然后忘记这件事。</p><p id="4601" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很公平。这在大多数情况下是可以的。</p><p id="7431" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，在内心深处，您可能会意识到，您真正想要的是能够为旧版本发布任何安全和稳定性补丁。您可能还希望能够添加一些紧急功能，为您添加的新服务显示CTA按钮，比方说，因为疫情。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b980" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">方法</h1><p id="866d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你可以假设你只支持最新的版本。</p><p id="41ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我建议你查看一下申请统计数据。指定您希望更新覆盖的用户的百分比阈值。在此基础上，定义您必须支持的确切SDK版本。</p><h2 id="3806" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">贮藏室ˌ仓库</h2><p id="b974" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">就在SDK升级之前，从<code class="fe nm nn no np b"><a class="ae ky" href="https://github.com/github/renaming" rel="noopener ugc nofollow" target="_blank">main</a></code>创建一个分支。如果太晚，使用升级前的最后一次提交。</p><p id="e311" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">比如<code class="fe nm nn no np b">$ git switch main; git switch -c main-expo-sdk-36</code>。</p><p id="182a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">照常将任何特征分支合并到<code class="fe nm nn no np b">main</code>。此外，将该特性也应用到其他SDK分支。假设你想从<code class="fe nm nn no np b">feature/cta-button</code>分支中合并CTA按钮功能。</p><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="d73f" class="mz md it np b gy nu nv l nw nx">(main) $ git merge feature/cta-button<br/>(main) $ git push<br/>(main) $ git switch main-expo-sdk36<br/>(main-expo-sdk-36) $ git merge feature/cta-button<br/>(main-expo-sdk-36) $ git push</span></pre><h2 id="c32b" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">部署</h2><p id="e0bc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">流程保持不变，除了您必须对每个<code class="fe nm nn no np b">main-expo-sdk-*</code>分支做同样的事情。它可以被部署到同一个发布通道(见上图)。</p><h2 id="ca22" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">地方发展</h2><p id="4435" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">使用相同的源文件夹非常耗时。</p><p id="fbc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在SDK版本之间切换时，您必须重新安装节点模块。如果您想要执行多次更新，这可能会很麻烦。</p><p id="c6f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决方案是创建多个项目实例，每个实例对应您将支持的SDK的一个版本。这将在下一节中解释。</p><p id="ec85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将回购克隆到不同的文件夹，并在那里的<code class="fe nm nn no np b">main-expo-sdk-*</code>分支上工作。假设你有一个<code class="fe nm nn no np b">my-app</code> app，你想支持SDK 36。</p><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="e1f0" class="mz md it np b gy nu nv l nw nx"># clone the same repository to my-app-sdk-36<br/>$ git clone git@server:my-app.git ~/repos/my-app-sdk-36;</span><span id="cd3a" class="mz md it np b gy ny nv l nw nx"># it should be a new folder here<br/>$ ls ~/repos;<br/>my-app<br/>my-app-expo-sdk-36</span><span id="7064" class="mz md it np b gy ny nv l nw nx"># enter the new folder and switch the branch to the SDK <br/>$ cd my-app-expo-36;<br/>$ git switch main-expo-sdk-36;<br/></span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0ea0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">摘要</h1><p id="9f60" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这种解决方案可以让大多数用户获得<em class="nz">紧急</em>更新。</p><p id="0894" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您升级Expo SDK时，这并不意味着每个设备都立即获得了更新。后续的OTA更新不适用于带有旧SDK的设备。</p><p id="3f61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这对于大多数情况来说是可以的，但是现在您也为其他场景做好了准备。</p></div></div>    
</body>
</html>