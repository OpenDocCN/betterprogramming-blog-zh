<html>
<head>
<title>Load Testing WebSockets With k6</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用k6负载测试WebSockets</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/load-testing-websockets-with-k6-feb99bf75798?source=collection_archive---------3-----------------------#2021-03-02">https://betterprogramming.pub/load-testing-websockets-with-k6-feb99bf75798?source=collection_archive---------3-----------------------#2021-03-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="86d4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用内置的WebSocket客户端来测试服务器的性能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b6e1e537911e1a83f7623d5b9593b0a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WKkekWBVxuhkBBCcYjp54A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="bd3f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">基于我之前关于k6的文章，本文的主题是负载测试WebSocket。与HTTP不同，WebSocket通过单个TCP连接提供全双工通信通道。这使您的服务器能够直接向用户发送推送通知。</p><p id="8580" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">幸运的是，k6提供了自己的基于WebSocket协议的<code class="fe lv lw lx ly b">ws</code>客户端。它与<code class="fe lv lw lx ly b">http</code>客户端略有不同，因为每个VU运行在一个异步事件循环上。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="cb0e" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">设置</h1><h2 id="0af0" class="my mh it bd mi mz na dn mm nb nc dp mq lh nd ne ms ll nf ng mu lp nh ni mw nj bi translated">k6安装</h2><p id="634c" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">在我们开始之前，确保您已经为k6安装了必要的包和模块。请参考<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/an-introduction-to-k6-an-api-load-testing-tool-132a0d87827d">我之前的文章</a>关于如何在你的本地机器上安装k6。</p><h2 id="9404" class="my mh it bd mi mz na dn mm nb nc dp mq lh nd ne ms ll nf ng mu lp nh ni mw nj bi translated">使用自己的WebSocket服务器(可选)</h2><p id="54c2" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">本教程假设您已经有一个WebSocket服务器。如果您没有，请使用基于FastAPI的<a class="ae lu" href="https://gist.github.com/wfng92/7f62108abdbe3680acacd2904e8969a9" rel="noopener ugc nofollow" target="_blank">脚本</a>。它将回显用户通过WebSocket发送的消息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="0067" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在以下文档的<a class="ae lu" href="https://fastapi.tiangolo.com/advanced/websockets/" rel="noopener ugc nofollow" target="_blank">中找到安装步骤。</a></p><p id="a37e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过以下命令运行它:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="eee5" class="my mh it ly b gy nv nw l nx ny">uvicorn myapp:app</span></pre><h2 id="d4cd" class="my mh it bd mi mz na dn mm nb nc dp mq lh nd ne ms ll nf ng mu lp nh ni mw nj bi translated">使用公共WebSocket服务器</h2><p id="0327" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">如果您在设置FastAPI时遇到问题，并且想要测试k6，只需用任何公共WebSocket URL替换websocket URL。</p><p id="d8cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，您可以使用来自<a class="ae lu" href="https://javascript.info/websocket" rel="noopener ugc nofollow" target="_blank"> javascript.info </a>的以下链接:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="7e50" class="my mh it ly b gy nv nw l nx ny">wss://javascript.info/article/websocket/demo/hello</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="10ea" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">基础知识</h1><p id="44c3" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">为了使用<code class="fe lv lw lx ly b">ws</code>客户端，你必须如下导入它:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="6768" class="my mh it ly b gy nv nw l nx ny">import ws from 'k6/ws';</span></pre><p id="6721" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，您可以调用内置的<code class="fe lv lw lx ly b">connect</code>函数来建立到您的服务器的连接。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="a625" class="my mh it ly b gy nv nw l nx ny">const url = 'ws://localhost:8000/ws';<br/>const res = ws.connect(url, null, function (socket) {<br/>    ...<br/>}</span></pre><p id="2fd4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lv lw lx ly b">connect</code>功能接受以下输入参数:</p><ul class=""><li id="d081" class="nz oa it la b lb lc le lf lh ob ll oc lp od lt oe of og oh bi translated"><code class="fe lv lw lx ly b">url</code> —请求的字符串URL</li><li id="1c3e" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated"><code class="fe lv lw lx ly b">params</code> —包含附加参数的对象</li><li id="4122" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated"><code class="fe lv lw lx ly b">callback</code>—web socket连接发起时将调用的回调函数。它代表<code class="fe lv lw lx ly b">Socket</code>对象。</li></ul><p id="f9a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lv lw lx ly b">Socket</code>对象带有以下方法:</p><ul class=""><li id="93ee" class="nz oa it la b lb lc le lf lh ob ll oc lp od lt oe of og oh bi translated"><code class="fe lv lw lx ly b">close</code> —关闭连接</li><li id="a0d9" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated"><code class="fe lv lw lx ly b">on (event, callback)</code> —以下事件的事件监听器:打开、消息、乒、乓、关闭、错误</li><li id="b2b5" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated"><code class="fe lv lw lx ly b">ping</code> —向WebSocket服务器发送ping请求</li><li id="5fc2" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated"><code class="fe lv lw lx ly b">send (data)</code> —向WebSocket服务器发送数据</li><li id="80e7" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated"><code class="fe lv lw lx ly b">setInterval(callback, interval)</code> —每隔一段时间重复调用一个函数</li><li id="b5fc" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated"><code class="fe lv lw lx ly b">setTimeout(callback, timeout)</code> —延迟后调用函数</li></ul><p id="788b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们用示例代码片段逐一查看它们。</p><h2 id="7e56" class="my mh it bd mi mz na dn mm nb nc dp mq lh nd ne ms ll nf ng mu lp nh ni mw nj bi translated">关闭</h2><p id="0c4b" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">完成后，您需要关闭与WebSocket服务器的连接。您可以简单地调用<code class="fe lv lw lx ly b">socket.close()</code>来完成这项工作。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="d2ac" class="my mh it ly b gy nv nw l nx ny">const res = ws.connect(url, null, function (socket) {<br/>  ...<br/>  <!-- -->socket.close();<br/>}</span></pre><h2 id="26a0" class="my mh it bd mi mz na dn mm nb nc dp mq lh nd ne ms ll nf ng mu lp nh ni mw nj bi translated">开(事件，回调)</h2><p id="7287" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated"><code class="fe lv lw lx ly b">on</code>函数支持创建事件监听器。当连接建立时，您可以使用它来记录消息，甚至检查服务器发送的数据。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="23ca" class="my mh it ly b gy nv nw l nx ny">const res = ws.connect(url, null, function (socket) {<br/>  ...<br/>  <!-- -->socket.on('open', () =&gt; console.log('connected'));<br/>  socket.on('message', (data) =&gt; console.log('Received: ', data));<br/>  socket.on('close', () =&gt; console.log('disconnected'));<br/>}</span></pre><h2 id="4f7d" class="my mh it bd mi mz na dn mm nb nc dp mq lh nd ne ms ll nf ng mu lp nh ni mw nj bi translated">砰</h2><p id="741b" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">发送ping请求是检查服务器健康状态的常用方法。您可以通过以下代码来实现:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="9836" class="my mh it ly b gy nv nw l nx ny">const res = ws.connect(url, null, function (socket) {<br/>  ...<br/>  <!-- -->socket.ping();<br/>}</span></pre><h2 id="3d12" class="my mh it bd mi mz na dn mm nb nc dp mq lh nd ne ms ll nf ng mu lp nh ni mw nj bi translated">发送(数据)</h2><p id="8e7e" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">发送数据就像调用<code class="fe lv lw lx ly b">send</code>函数一样简单。它接受一个输入字符串。对于发送JavaScript对象，只需在发送之前通过<code class="fe lv lw lx ly b">JSON.stringify</code>将其转换成JSON字符串。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="772f" class="my mh it ly b gy nv nw l nx ny">const res = ws.connect(url, null, function (socket) {<br/>  ...<br/>  <!-- -->socket.send('text');<br/>  socket.send(JSON.stringify({ data: 'hello' }));<br/>}</span></pre><h2 id="68c7" class="my mh it bd mi mz na dn mm nb nc dp mq lh nd ne ms ll nf ng mu lp nh ni mw nj bi translated">setInterval(回调，间隔)</h2><p id="aa2f" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">您可以通过<code class="fe lv lw lx ly b">setInterval</code>功能以一定的间隔重复执行一个功能。例如，只要连接仍然打开，就可以每秒钟向WebSocket服务器重复发送一次数据。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="fc3d" class="my mh it ly b gy nv nw l nx ny">const res = ws.connect(url, null, function (socket) {<br/>  ...<br/>  socket.setInterval(function interval() {<br/>    socket.send('Hello');<br/>  }, 1000);<br/>}</span></pre><p id="05a5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lv lw lx ly b">interval</code>以毫秒为单位。对于一秒钟的间隔，您必须使用<code class="fe lv lw lx ly b">1000</code>作为输入参数。</p><h2 id="bec4" class="my mh it bd mi mz na dn mm nb nc dp mq lh nd ne ms ll nf ng mu lp nh ni mw nj bi translated">setTimeout(回调，超时)</h2><p id="251f" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated"><code class="fe lv lw lx ly b">setTimeout</code>是另一个有用的功能。它会在延迟后触发一个功能。例如，您可以使用它在几秒钟的延迟后关闭到WebSocket服务器的连接。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="a5c7" class="my mh it ly b gy nv nw l nx ny">const res = ws.connect(url, null, function (socket) {<br/>  ...<br/>  socket.setTimeout(function () {<br/>    socket.close();<br/>  }, 5000);<br/>}</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="8f34" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">履行</h1><p id="5a0f" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">让我们结合您所学的所有知识，构建一个简单的负载测试脚本。创建一个名为<code class="fe lv lw lx ly b">k6-websocket-script.js</code>的新JavaScript文件。</p><h2 id="97cc" class="my mh it bd mi mz na dn mm nb nc dp mq lh nd ne ms ll nf ng mu lp nh ni mw nj bi translated">导入</h2><p id="24a0" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">在文件顶部添加以下import语句。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="2e7f" class="my mh it ly b gy nv nw l nx ny">import ws from 'k6/ws';<br/>import { check } from 'k6';</span></pre><h2 id="1a28" class="my mh it bd mi mz na dn mm nb nc dp mq lh nd ne ms ll nf ng mu lp nh ni mw nj bi translated">选择</h2><p id="1235" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">接下来，设置用于测试的选项。测试包括以下几个阶段:</p><ul class=""><li id="8f8e" class="nz oa it la b lb lc le lf lh ob ll oc lp od lt oe of og oh bi translated">从在10秒内生成30个新vu开始</li><li id="e087" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated">保持真空状态30秒</li><li id="7060" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated">继续在20秒内将VUs升至60</li><li id="7589" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated">保持真空状态30秒</li><li id="7acc" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated">在20秒内将VUs缩减至30</li><li id="d91f" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated">保持真空状态30秒</li><li id="c2f1" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated">在10秒钟内慢慢将VUs降至0</li></ul><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="bbbc" class="my mh it ly b gy nv nw l nx ny">export let options = {<br/>  stages: [<br/>    { duration: '10s', target: 30 },<br/>    { duration: '30s', target: 30 },<br/>    { duration: '20s', target: 60 },<br/>    { duration: '30s', target: 60 },<br/>    { duration: '20s', target: 30 },<br/>    { duration: '30s', target: 30 },<br/>    { duration: '10s', target: 0 },<br/>  ],<br/>};</span></pre><p id="551b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以根据自己的喜好随意修改vu的数量。</p><h2 id="68a0" class="my mh it bd mi mz na dn mm nb nc dp mq lh nd ne ms ll nf ng mu lp nh ni mw nj bi translated">主要功能</h2><p id="daac" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">使用以下变量创建一个新的默认函数:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="765d" class="my mh it ly b gy nv nw l nx ny">export default function () {<br/>  const text = 'Echo';<br/>  const url = 'ws://localhost:8000/ws';<br/>}</span></pre><p id="7af9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">继续在它下面添加下面的代码。它将首先建立到WebSocket服务器的连接，并设置一个事件监听器。在监听器内部，它包含了<code class="fe lv lw lx ly b">setInterval</code>函数，这个函数会每秒钟向服务器重复发送一次数据。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="fac9" class="my mh it ly b gy nv nw l nx ny">export default function () {<br/>  ...<br/>  const res = ws.connect(url, null, function (socket) {<br/>    socket.on('open', function open() {<br/>      console.log('connected');<br/>      socket.setInterval(function interval() {<br/>        socket.send(text);<br/>        console.log('Message sent: ', text);<br/>      }, 1000);<br/>    });<br/>  });<br/>}</span></pre><p id="4795" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">之后，再实现两个事件侦听器:</p><ul class=""><li id="0713" class="nz oa it la b lb lc le lf lh ob ll oc lp od lt oe of og oh bi translated">检查从服务器收到的消息的传入数据，并将其记录到控制台</li><li id="2b89" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated">套接字关闭时记录到控制台</li></ul><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="6b81" class="my mh it ly b gy nv nw l nx ny">export default function () {<br/>  ...<br/>  const res = ws.connect(url, null, function (socket) {<br/>    ...<br/>    socket.on('message', function message(data) {<br/>      console.log('Message received: ', data);<br/>      check(data, { 'data is correct': (r) =&gt; r &amp;&amp; r === text });<br/>    });</span><span id="5dbd" class="my mh it ly b gy on nw l nx ny">    socket.on('close', () =&gt; console.log('disconnected'));<br/>  });<br/>}</span></pre><p id="dfc0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">关闭连接最简单的方法是通过<code class="fe lv lw lx ly b">setTimeout</code>功能。让我们配置它在五秒钟(<code class="fe lv lw lx ly b">5000</code>毫秒)后关闭。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="7fbd" class="my mh it ly b gy nv nw l nx ny">export default function () {<br/>  ...<br/>  const res = ws.connect(url, null, function (socket) {<br/>    ...<br/>    socket.setTimeout(function () {<br/>      console.log('5 seconds passed, closing the socket');<br/>      socket.close();<br/>    }, 5000);<br/>}</span></pre><p id="1781" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，添加一个最终检查函数来确定返回的响应对象是否处于状态<code class="fe lv lw lx ly b">101</code>。它代表WebSockets使用的交换协议。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="02ba" class="my mh it ly b gy nv nw l nx ny">check(res, { 'status is 101': (r) =&gt; r &amp;&amp; r.status === 101 });</span></pre><p id="93ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在下面的链接中找到<code class="fe lv lw lx ly b"><a class="ae lu" href="https://gist.github.com/wfng92/cbeb5e62a3f8ca651c88e10c953463f5" rel="noopener ugc nofollow" target="_blank">script.js</a></code>T7的完整代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="e455" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">试验</h1><p id="fd87" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">让我们通过在新的终端中运行以下命令来测试这个脚本。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="ba58" class="my mh it ly b gy nv nw l nx ny">k6 run k6-websocket-script.js</span></pre><p id="6ef6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您应该在控制台中看到下面的用户界面，它表明测试正在运行，没有错误。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/f6d429c50dc2043806f5c440717d53ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XWBdTHaQDZOIWruWD7n6Zw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="91ea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在测试结束时，您应该得到下面的输出，指示负载测试的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/1382884b2f77e8228ec4681d4357075c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aky1Laq-NSBRsHMZNujTaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="17d8" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="c59d" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">让我们回顾一下今天学到的内容。</p><p id="bb81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本教程首先简要解释了WebSocket和HTTP之间的区别。</p><p id="e61f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下一步是设置和安装必要的包。</p><p id="cf44" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">稍后，本文将引导您深入探索k6提供的WebSocket模块背后的基本概念和用法。</p><p id="55f8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">之后，我们进入实现部分，在这里您构建了自己的负载测试脚本，它验证了<code class="fe lv lw lx ly b">Response</code>状态是否为<code class="fe lv lw lx ly b">101</code>，并检查了WebSocket服务器发送的消息。它会在五秒钟后与服务器断开连接。</p><p id="f713" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，测试部分介绍了如何运行脚本并分析测试结果。</p><p id="9ed6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读。希望在下一篇文章中再见到你！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="b90b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">参考</h1><ol class=""><li id="4d79" class="nz oa it la b lb nk le nl lh oq ll or lp os lt ot of og oh bi translated"><a class="ae lu" href="https://k6.io/docs/using-k6/protocols/websockets" rel="noopener ugc nofollow" target="_blank"> k6 — WebSockets </a>教程</li><li id="c8d6" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt ot of og oh bi translated"><a class="ae lu" href="https://k6.io/docs/javascript-api/k6-ws" rel="noopener ugc nofollow" target="_blank"> k6 — WebSockets API </a></li><li id="2665" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt ot of og oh bi translated"><a class="ae lu" href="https://fastapi.tiangolo.com/advanced/websockets/" rel="noopener ugc nofollow" target="_blank"> FastAPI — WebSockets </a></li></ol></div></div>    
</body>
</html>