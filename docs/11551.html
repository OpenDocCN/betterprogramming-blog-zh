<html>
<head>
<title>Build a Scalable API in Go with Gin (2022)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Go with Gin (2022)中构建可扩展的API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-scalable-api-in-go-with-gin-131af7f780c0?source=collection_archive---------0-----------------------#2022-03-30">https://betterprogramming.pub/build-a-scalable-api-in-go-with-gin-131af7f780c0?source=collection_archive---------0-----------------------#2022-03-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c226" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Gin、GORM和Postgres在Go中创建可伸缩API的指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/23f937edbc4b29af658738794f9ca9d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xhmrl5RePhjf7_DKsIvLsA.png"/></div></div></figure><p id="50c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">除了TypeScript，我还使用2012年发布的谷歌编程语言Go。它是一种伟大而高效的编程语言，每年都在软件开发人员中受到越来越多的欢迎。</p><p id="65d4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是值得学习的，所以在这篇文章中，我想给你一个简单的指导，告诉你如何使用Gin和GORM在Go中开发一个可扩展的简单API。为了简单起见，我们不使用Docker。</p><p id="c477" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们开始之前，让我在<a class="ae lq" href="https://github.com/hellokvn/go-gin-api-medium" rel="noopener ugc nofollow" target="_blank"> Github </a>上分享这篇文章的资源库。</p><div class="lr ls gp gr lt lu"><a href="https://github.com/hellokvn/go-gin-api-medium" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab fo"><div class="lw ab lx cl cj ly"><h2 class="bd iu gy z fp lz fr fs ma fu fw is bi translated">GitHub-hello kvn/go-gin-API-medium</h2><div class="mb l"><h3 class="bd b gy z fp lz fr fs ma fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mc l"><p class="bd b dl z fp lz fr fs ma fu fw dk translated">github.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi ks lu"/></div></div></a></div><h1 id="dbc0" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">杜松子酒是什么？</h1><p id="a55b" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">Gin是Go (Golang)最流行的高性能框架，可用于构建web应用程序。它类似于ExpressJS，所以如果你熟悉ExpressJS，Gin就是你要走的路。</p><h1 id="df5e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">我们要建造什么？</h1><p id="52b9" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">这个项目将会非常经典。我们将构建一个简单的图书API。别担心，即使你的项目是基于一个可扩展的方法，API本身也会很简单。你跟上不会有任何困难。</p><h1 id="b1fe" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">先决条件</h1><p id="00cf" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">你需要对围棋有一个基本的了解。我会选择<a class="ae lq" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>作为我的代码编辑器。你可以用你喜欢的任何东西。但是请记住，您将在本文中看到一次命令<code class="fe ng nh ni nj b">code .</code>。这是一个特定于VSCode (Visual Studio Code)的命令，用于打开VSCode中的当前目录。</p><p id="1cf4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您还需要安装这些:</p><ul class=""><li id="026d" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">在本地机器上安装<a class="ae lq" href="https://go.dev/doc/install" rel="noopener ugc nofollow" target="_blank"> Go </a></li><li id="8b35" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">在您的本地机器上安装<a class="ae lq" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a></li></ul><h1 id="718a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">创建数据库</h1><p id="3856" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">首先，我们需要创建PostgreSQL数据库。我知道，每个人都有不同的处理方式，有些人使用GUI，但我们将使用我们的终端。同样，您需要在您的机器上安装PostgreSQL。如果您安装了PostgreSQL，以下四个命令将在Linux、Mac和Windows机器上运行。</p><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="1f80" class="oc mk it nj b gy od oe l of og">$ psql postgres<br/>$ CREATE DATABASE go_medium_api;<br/>$ \l<br/>$ \q</span></pre><ul class=""><li id="c0cd" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated"><code class="fe ng nh ni nj b">psql postgres</code>使用用户<code class="fe ng nh ni nj b">postgres</code>打开<code class="fe ng nh ni nj b">psql</code> CLI</li><li id="fa8e" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><code class="fe ng nh ni nj b">CREATE DATABASE go_medium_api;</code>创建我们需要的数据库</li><li id="2c9d" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><code class="fe ng nh ni nj b">\l</code>列出所有数据库</li><li id="cbe2" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">CLI退出</li></ul><p id="ad65" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们成功地执行了所有四个命令之后，我的终端看起来应该是这样的。如我们所见，数据库<code class="fe ng nh ni nj b">go_api_medium</code>被创建。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/40a87a13722ff44bb0274ce8e08216cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xDaAlvmWlHle15aIsGShNg.png"/></div></div></figure><h1 id="46b0" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">项目设置</h1><p id="acf5" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">首先，我们将启动我们的项目并安装我们需要的模块。</p><blockquote class="oi oj ok"><p id="6d54" class="ku kv ol kw b kx ky ju kz la lb jx lc om le lf lg on li lj lk oo lm ln lo lp im bi translated"><strong class="kw iu"> <em class="it">小心:</em> </strong> <em class="it">用你的Github用户名替换你的_用户名。</em></p></blockquote><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="a550" class="oc mk it nj b gy od oe l of og">$ mkdir go-gin-api-medium<br/>$ cd go-gin-api-medium<br/>$ code .<br/>$ go mod init github.com/YOUR_USERNAME/go-gin-api-medium</span></pre><p id="68f9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在让我们安装Gin、GORM和Viper。我们使用Viper来管理环境变量。</p><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="0dce" class="oc mk it nj b gy od oe l of og">$ go get github.com/spf13/viper<br/>$ go get github.com/gin-gonic/gin<br/>$ go get gorm.io/gorm<br/>$ go get gorm.io/driver/postgres</span></pre><p id="8bbc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们继续最后的项目结构。</p><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="6979" class="oc mk it nj b gy od oe l of og">$ mkdir -p cmd pkg/books pkg/common/db pkg/common/envs pkg/common/models</span></pre><p id="bc2a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另外，让我们添加一些文件。</p><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="563b" class="oc mk it nj b gy od oe l of og">$ touch Makefile cmd/main.go pkg/books/add_book.go pkg/books/controller.go pkg/books/delete_book.go pkg/books/get_book.go pkg/books/get_books.go pkg/books/update_book.go pkg/common/db/db.go pkg/common/envs/.env pkg/common/models/book.go</span></pre><p id="f774" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，在创建我们的项目后，文件结构应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/c7a2fad9585d45897b93e1379eb1e00e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c5FpqTltgl6lbu5nEt0tgA.png"/></div></div></figure><p id="4e63" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，该编码了。</p><h1 id="7ee3" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">环境变量</h1><p id="aef1" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">首先，我们需要添加一些环境变量来存储我们将要监听的应用程序端口和数据库的URL。请记住，用您的数据库数据替换<code class="fe ng nh ni nj b">DB_USER</code>、<code class="fe ng nh ni nj b">DB_PASSWORD</code>、<code class="fe ng nh ni nj b">DB_HOST</code>和<code class="fe ng nh ni nj b">DB_PORT</code>。</p><p id="a770" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们给<code class="fe ng nh ni nj b">pkg/common/envs/.env</code>添加代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="b891" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，它在我的本地机器上会是什么样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h1 id="4c2d" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">配置</h1><p id="bca6" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">让我们给<code class="fe ng nh ni nj b">pkg/common/config/config.go</code>添加代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h1 id="2a35" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">书籍模型</h1><p id="61c4" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">在这里，我们将创建图书模型/实体。<code class="fe ng nh ni nj b">gorm.Model</code>会为我们添加<code class="fe ng nh ni nj b">ID</code>、<code class="fe ng nh ni nj b">CreatedAt</code>、<code class="fe ng nh ni nj b">UpdatedAt</code>、<code class="fe ng nh ni nj b">DeletedAt</code>等属性。</p><p id="1b87" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，我们添加了3个字符串属性。最后的<code class="fe ng nh ni nj b">json</code>标签为GORM提供了Postgres数据库中每一列名称的信息。</p><p id="0217" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们给<code class="fe ng nh ni nj b">pkg/common/models/book.go</code>添加代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h1 id="f0fd" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">数据库初始化</h1><p id="acf4" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">书模型做好了。现在，我们配置GORM并自动迁移我们刚刚创建的模型。只要我们运行这个应用程序，这个<code class="fe ng nh ni nj b">AutoMigrate</code>函数就会为我们创建<code class="fe ng nh ni nj b">books</code>表。</p><p id="dcca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们给<code class="fe ng nh ni nj b">pkg/common/db/db.go</code>添加代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h1 id="39e9" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">主文件</h1><p id="12f5" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">这是我们的引导文件。我们会在这里做很多事情。</p><ul class=""><li id="7f77" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">初始化Viper来处理我们的环境变量</li><li id="aca4" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">基于GORM的数据库初始化</li><li id="5c1f" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">添加简单的“/”路线</li><li id="016c" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">启动应用程序</li></ul><p id="dcee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们稍后将再次更改该文件。</p><p id="7aed" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们给<code class="fe ng nh ni nj b">cmd/main.go</code>添加代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="7906" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们测试我们项目的当前版本。通常，应用程序会在调试模式下运行，所以我们会得到一些警告，忽略它们。</p><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="41ea" class="oc mk it nj b gy od oe l of og">$ go run cmd/main</span></pre><p id="e839" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">控制台内部的输出。最后一行很重要。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/4163a0d3911fc86dc82628674c93a7cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3dTWIksI95o2Z96kentQHg.png"/></div></div></figure><p id="bf2f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们访问http://localhost:3000</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/e5e2d48d5ad1a838d56e87a9d2e6ab13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r1NqMICBQpAo1W6XI9nV0w.png"/></div></div></figure><h1 id="68aa" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">图书管理员</h1><p id="e4af" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">太好了，一切正常。我们将替换这个输出，所以不要担心。现在，让我们为我们的图书API添加一些处理程序。</p><h2 id="3600" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">控制器</h2><p id="b85b" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">图书处理程序/路径将基于所谓的<a class="ae lq" href="https://go.dev/tour/methods/4" rel="noopener ugc nofollow" target="_blank">指针接收器</a>，为此，我们定义了它的结构。这个结构稍后将接收数据库信息，因此每当我们调用图书处理程序/路由时，我们都可以访问GORM。我们稍后将再次更改该文件。</p><p id="e3fb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们给<code class="fe ng nh ni nj b">pkg/books/controller.go</code>添加代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h2 id="1263" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">添加图书处理程序</h2><p id="afea" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">所以这个文件很有意思。导入之后，我们为请求体定义一个结构。在第16行你可以看到我们在上一步定义的<strong class="kw iu">指针接收器</strong>。在第31行你可以看到，我们使用了这个<strong class="kw iu">指针接收器</strong>，它的变量名就是简单的<code class="fe ng nh ni nj b">h</code>。</p><p id="8468" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其他一切都很简单。我们获取请求体，声明一个新的book变量，将请求体与这个book变量合并，并创建一个新的数据库条目。然后，我们用图书信息创建一个响应。</p><p id="6fee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们添加代码到<code class="fe ng nh ni nj b">pkg/books/add_book.go</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h2 id="c70f" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">获取书籍处理程序</h2><p id="3169" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">在这条路线上，我们将返回数据库中的所有书籍。这种方法现在工作得很快，但是一旦有更大的数据需要处理，最好使用分页方法。</p><p id="aa81" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们给<code class="fe ng nh ni nj b">pkg/books/get_books.go</code>添加代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h2 id="f967" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">获取图书处理程序</h2><p id="9836" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">在这里，我们只根据从参数中获得的ID来响应一本书。</p><p id="2936" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们添加代码到<code class="fe ng nh ni nj b">pkg/books/get_book.go</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h2 id="c785" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">更新图书处理程序</h2><p id="c666" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">如果我们添加一本书，我们也应该有更新已创建书籍的选项。这条路线类似于我们之前编码的<code class="fe ng nh ni nj b">AddBook</code>路线。</p><p id="dc1d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们给<code class="fe ng nh ni nj b">pkg/books/update_book.go</code>添加代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h2 id="21f0" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">删除图书处理程序</h2><p id="c278" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">这是我们在本文中的最后一条路线。这里，我们根据ID删除一本书，但前提是数据库中存在所需的条目。我们只用一个HTTP状态码来响应。</p><p id="3e1e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们给<code class="fe ng nh ni nj b">pkg/books/delete_book.go</code>添加代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h2 id="05e7" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">控制器(再次)</h2><p id="4e95" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">路线完成了。现在我们需要再次修改控制器文件。这一次，我们创建了一个名为<code class="fe ng nh ni nj b">RegisterRoutes</code>的函数，它很好地解释了它的作用，对吗？</p><p id="58d3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你记得听筒指针吗？这里我们得到了路由/处理程序的接收指针。</p><p id="0b67" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们将文件<code class="fe ng nh ni nj b">pkg/books/controller.go</code>从:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="bfa2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">到</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h2 id="f381" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">主文件(再次)</h2><p id="b85f" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">此外，我们必须再次修改我们的主文件。之前，我们只是初始化数据库。但是这一次，我们得到了它的返回并注册了我们的路由/处理程序。</p><p id="d573" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们将文件<code class="fe ng nh ni nj b">cmd/main.go</code>从:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="7c73" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">到</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h1 id="3cb0" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">生成文件</h1><p id="109d" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">这是可选的。这里我们可以设置一些脚本来简化命令。例如，我们定义一个<code class="fe ng nh ni nj b">server</code>脚本来运行应用程序。因此，我们不是由<code class="fe ng nh ni nj b">go run cmd/main</code>来运行应用程序，而是由<code class="fe ng nh ni nj b">make server</code>来运行它。这个例子并不好，因为实际的命令非常短，但是想象一下，您将不得不处理更长的命令。</p><p id="a4e4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们将代码添加到根目录中的<code class="fe ng nh ni nj b">Makefile</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h1 id="ce2f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">运行应用程序</h1><p id="41cc" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">一切都搞定了！不再编码了。现在，让我们运行应用程序。</p><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="4f31" class="oc mk it nj b gy od oe l of og">$ make server</span></pre><p id="29f6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">或者</p><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="eb60" class="oc mk it nj b gy od oe l of og">$ go run cmd/main.go</span></pre><p id="05a9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">输出应该是这样的。除了警告之外，我们可以看到，我们的路由已经确定，应用程序在端口3000上运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/b5c19323b37625f17a1d93315ca4b1ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t6SibR4o8iEnrm3IYr9GxA.png"/></div></div></figure><h1 id="d4f7" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">测试端点</h1><p id="db04" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">现在，我们可以测试刚刚创建的两条路由。我们可以测试它，通过使用软件如<a class="ae lq" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮差</a>、<a class="ae lq" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">失眠</a>，或者我们简单地运行CURL命令。</p><h2 id="d4dc" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">帖子:添加新书</h2><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="dc14" class="oc mk it nj b gy od oe l of og">$ curl --request POST \<br/>  --url http://localhost:3000/books/<em class="ol"> \<br/>  </em>--header 'Content-Type: application/json' \<br/>  --data '{<br/>    "title": "Book A",<br/>    "author": "Kevin Vogel",<br/>    "description": "Some cool description"<br/>  }'</span></pre><h2 id="eacc" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">获取:获取所有书籍</h2><p id="6e98" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">别忘了，您也可以在浏览器中运行get命令。</p><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="8915" class="oc mk it nj b gy od oe l of og">$ curl --request GET --url <a class="ae lq" href="http://localhost:3000/books/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/books/</a></span></pre><h2 id="3377" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">获取:通过ID获取图书</h2><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="4586" class="oc mk it nj b gy od oe l of og">$ curl --request GET --url http://localhost:3000/books/1/</span></pre><h2 id="a03f" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">PUT:按ID更新图书</h2><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="1bfe" class="oc mk it nj b gy od oe l of og">$ curl --request PUT \<br/>  --url http://localhost:3000/books/1/ \<br/>  --header 'Content-Type: application/json' \<br/>  --data '{<br/> "title": "Updated Book Name",<br/> "author": "Kevin Vogel",<br/> "description": "Updated description"<br/>}'</span></pre><h2 id="7648" class="oc mk it bd ml ot ou dn mp ov ow dp mt ld ox oy mv lh oz pa mx ll pb pc mz pd bi translated">删除:按ID删除图书</h2><pre class="kj kk kl km gt ny nj nz oa aw ob bi"><span id="3e3a" class="oc mk it nj b gy od oe l of og">$ curl --request DELETE --url http://localhost:3000/books/1/</span></pre><p id="e450" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们完了！太好了。别忘了，我已经在<a class="ae lq" href="https://github.com/hellokvn/go-gin-api-medium" rel="noopener ugc nofollow" target="_blank"> Github </a>上传了这个项目。</p><p id="5689" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢您阅读这篇关于如何在Go with Gin中构建可扩展但简单的API的文章。我希望，你能学到新的东西。如果你有问题，请告诉我。</p><p id="ed6b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">干杯！</p></div></div>    
</body>
</html>