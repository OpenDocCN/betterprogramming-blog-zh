<html>
<head>
<title>Partial Sync DynamoDB to Firestore Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">部分同步DynamoDB到Firestore数据库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/partial-sync-dynamodb-to-firestore-database-2dcb54a3f9ae?source=collection_archive---------7-----------------------#2022-05-24">https://betterprogramming.pub/partial-sync-dynamodb-to-firestore-database-2dcb54a3f9ae?source=collection_archive---------7-----------------------#2022-05-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="db78" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">但是为什么呢？嗯，这是很酷的AF，解决了一个非常常见的用例！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1034e3540dd1b6388b877b5853a24ebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*be3c301Er4fwDnidtz77Aw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">设置</p></figure><p id="e9b8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这不会是两种数据库产品之间的直接比较。主要是因为它们不能直接比较。尽管它们都是NoSQL文档商店，但许多东西是不同的。以下内容不会帮助您决定使用哪个数据库，因为这完全取决于您的需求。</p><p id="c026" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，Firestore数据库是Google云服务，而DynamoDB是AWS服务。这本身对服务的细节没有什么影响。但是，如果您的许多其他服务已经托管在其中一个提供商处，您可以获得一些优势。整合和协同将变得更加容易。</p><p id="4d1f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这让我想到了手边的用例！</p><p id="7714" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我发现这两个服务(Firestore和DynamoDB)都很有用，并希望使用它们来提供一些很酷的工作流和数据结构。这意味着我们可以利用两种服务的力量，而不会“滥用”其中任何一种。</p><h1 id="ed2f" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">介绍</h1><p id="cbea" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">我们有一个DynamoDB表，包含大约1000条记录。预计这一数字今后还会增加。每个文档都很大，包含一个嵌套的JSON结构。每个对象的大小可以不同，但是理论上，这些对象的大小没有限制(除了DynamoDB所允许的)。</p><p id="ac5a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们想象DynamoDB中的一个文档是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">虚拟测功机项目</p></figure><p id="6825" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">DynamoDB非常擅长保存这些嵌套文档。</p><p id="5812" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我可以添加和删除任意多的对象(只要不超过400kb)。在许多情况下，规范化您的模式(使结构更扁平)会更好，这样您可以将数据分布在多个表中，但是现在，让我们假设这不是一个选项。</p><p id="726e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里不详细描述访问模式和模式策略，而是非常简单地描述如何从DynamoDB中获取数据。</p><p id="e10f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">DynamoDB有两个获取数据的API:<code class="fe mq mr ms mt b">scan</code>和<code class="fe mq mr ms mt b">query</code>。</p><p id="2333" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe mq mr ms mt b">Scan</code>将遍历整个表(直到达到1 MB的限制)，而Query将使用表的索引来获取更多特定的项。如果你有<code class="fe mq mr ms mt b">Partition</code>键，你可以更快地取回你的物品。所以，如果可能的话，你会想做一个<code class="fe mq mr ms mt b">query</code>。</p><h2 id="2eef" class="mu ls iq bd lt mv mw dn lx mx my dp mb le mz na md li nb nc mf lm nd ne mh nf bi translated">问题</h2><p id="2b0a" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">从上面可以看出，如果我们想从数据库中的所有项目中检索所有的<code class="fe mq mr ms mt b">lastUpdatedBy</code>属性，我们会很快遇到一些非常慢的<code class="fe mq mr ms mt b">scans</code>和大量的过度获取，因为我们不想将整个对象发送给客户端。</p><p id="b36b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，下个月，我们需要呈现应用程序中所有项目的字段<code class="fe mq mr ms mt b">name</code>。这就是DynamoDB和Firebase的结合可以让我们变得非常容易的地方。</p><p id="5f12" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要以下物品:</p><ul class=""><li id="4490" class="ng nh iq kx b ky kz lb lc le ni li nj lm nk lq nl nm nn no bi translated">DynamoDB流</li><li id="69b5" class="ng nh iq kx b ky np lb nq le nr li ns lm nt lq nl nm nn no bi translated">AWS函数</li><li id="08ca" class="ng nh iq kx b ky np lb nq le nr li ns lm nt lq nl nm nn no bi translated">谷歌Firebase</li></ul><h2 id="27fd" class="mu ls iq bd lt mv mw dn lx mx my dp mb le mz na md li nb nc mf lm nd ne mh nf bi translated">DynamoDB流</h2><p id="6338" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">流使得这一切以一种分离的方式成为可能。</p><p id="65db" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">基本上，这是一个AWS将记录从DynamoDB发送到Lambda函数的特性。除了记录之外，还会告诉您什么操作会触发lambda(记录更改、创建或删除)。你怎么处理那张唱片取决于你自己。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/c4ab559e483dddf1737dd6b7110ba71c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BndaLZNKHqq6lQ86.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">快速概述</p></figure><p id="ea23" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们的例子中，我们使用记录来选择一个特定的属性，将其“同步”到另一个数据库。在其他情况下，您可以简单地通知Slack已经插入了一条记录，或者做您想象中允许的任何事情。</p><h1 id="f920" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">自动气象站λ</h1><p id="31f3" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">当从DynamoDB流发送一条记录时，我们需要一个<code class="fe mq mr ms mt b">Lambda</code>处理程序(一个函数)。</p><p id="d7ac" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是一个处理程序的简单例子，它将处理流发送的每个记录。对于每条记录，<code class="fe mq mr ms mt b">lastUpdatedBy</code>作为唯一的字段保存在Firebase中(和一个键一起)。如果您想让另一个字段从DynamoDB同步到Firebase，这使得修改这个函数变得非常容易。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">AWS lambda DynamoDB插入处理程序</p></figure><h2 id="9de0" class="mu ls iq bd lt mv mw dn lx mx my dp mb le mz na md li nb nc mf lm nd ne mh nf bi translated">重火力点</h2><p id="aebe" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">Firebase是迄今为止最容易连接的数据库。最流行的框架都有自己的库。这个数据库的美妙之处在于firebase库将创建一个与大多数集成的WebSocket连接。这意味着您可以轻松地连接到您的数据，而且还可以即时获得更新。</p><h1 id="70dc" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">结案陈词</h1><p id="c342" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">流的特性使得分离我们的两个数据库变得非常容易。这意味着，如果您不要求始终同步100%的数据，同步数据的过程会变得相对简单。</p><p id="7e19" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Firebase带来了一些特性，使得它非常适合前端使用，DynamoDB在安全性、数据存储、与AWS的集成和定价方面有更多的特性。</p><p id="9ee6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用这种设置，如果需求需要，可以很容易地向Firebase添加更多的字段。更换<code class="fe mq mr ms mt b">lambda</code>手柄很简单——然后嘣！—你完了。</p><p id="5b11" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有许多方法可以实现这种部分同步，但是我发现这种方法非常划算，易于维护和设置。</p><blockquote class="nv nw nx"><p id="870e" class="kv kw ny kx b ky kz jr la lb lc ju ld nz lf lg lh oa lj lk ll ob ln lo lp lq ij bi translated">保持同步！</p></blockquote></div></div>    
</body>
</html>