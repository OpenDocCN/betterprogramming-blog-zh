<html>
<head>
<title>Deploy Your ZEIT Now App With GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub操作部署您的ZEIT Now应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deploy-your-zeit-now-app-with-github-actions-ca3977806b40?source=collection_archive---------15-----------------------#2019-09-02">https://betterprogramming.pub/deploy-your-zeit-now-app-with-github-actions-ca3977806b40?source=collection_archive---------15-----------------------#2019-09-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8710" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在GitHub中处理CI/CD的一种新的简单方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/66401a3519771083cbe64309f0d3483b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZ_jv-xjX_FfJR5fQH_6UQ.png"/></div></div></figure><p id="bb11" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我最近访问了<a class="ae lq" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>，并决定在<a class="ae lq" href="https://zeit.co/home" rel="noopener ugc nofollow" target="_blank"> ZEIT Now </a>中进行简单部署来测试它。我的第一步是看莱昂哈德·梅尔策的这篇精彩文章。</p><p id="3287" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它包含了很多有用的信息，但不幸的是，它使用了旧的工作流语法，现在已经被弃用，取而代之的是YAML。我花了很多时间进行转换，所以这里有一篇关于我如何用一个<code class="fe lr ls lt lu b">yml</code>文件实现它的文章。</p><h2 id="7230" class="lv lw it bd lx ly lz dn ma mb mc dp md ld me mf mg lh mh mi mj ll mk ml mm mn bi translated">要求</h2><ul class=""><li id="8b7c" class="mo mp it kw b kx mq la mr ld ms lh mt ll mu lp mv mw mx my bi translated">在我写这篇文章的时候，GitHub Actions还在测试阶段。您可以在这里请求访问<a class="ae lq" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank">并等待您的请求被接受。</a></li><li id="cfb9" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated">你还需要一个T21的账号。</li><li id="f2a9" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated">当然，你需要一个GitHub账户和一个存储库来存储你的应用源代码。</li><li id="df7e" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated">最后但同样重要的是，要部署的应用程序。</li></ul></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="855d" class="nl lw it bd lx nm nn no ma np nq nr md jz ns ka mg kc nt kd mj kf nu kg mm nv bi translated">开始</h1><p id="91f4" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld nw lf lg lh nx lj lk ll ny ln lo lp im bi translated">因为我主要使用React，所以我将给你一个使用<code class="fe lr ls lt lu b">create-react-app</code>应用程序的例子，但是你可以随意使用任何你喜欢的库。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="af3d" class="nl lw it bd lx nm nn no ma np nq nr md jz ns ka mg kc nt kd mj kf nu kg mm nv bi translated">ZEIT Now配置</h1><p id="c15c" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld nw lf lg lh nx lj lk ll ny ln lo lp im bi translated">现在在存储库的根目录下需要一个名为<code class="fe lr ls lt lu b">now.json</code>的配置文件，它包含托管环境中的应用配置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div><p class="ob oc gj gh gi od oe bd b be z dk translated">现在示例配置文件</p></figure><p id="0a85" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们考虑一下这个文件的重要部分:</p><ul class=""><li id="66fe" class="mo mp it kw b kx ky la lb ld of lh og ll oh lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">version</code>:配置文件版本。您可以简单地使用2，因为版本1已经过时。</li><li id="06b0" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">name</code>:我们在ZEIT仪表盘上使用的应用程序的名称。它将在你的应用程序上创建一个自定义子域。</li><li id="f57e" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">builds</code>:如何构建应用程序。当我部署一个<code class="fe lr ls lt lu b">create-react-app</code>时，我使用<code class="fe lr ls lt lu b">@now/static-build</code>，但是还有<a class="ae lq" href="https://zeit.co/docs/v2/advanced/builders" rel="noopener ugc nofollow" target="_blank">许多其他选项你可能想考虑</a>。</li><li id="3fe2" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">regions</code>:我们希望应用程序部署的位置。我选择了<code class="fe lr ls lt lu b">bru</code>在布鲁塞尔使用GCP，但是你可以在那个列表上选择你最喜欢的一个<a class="ae lq" href="https://zeit.co/docs/v2/network/regions-and-providers" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="e8e6" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">routes</code>:简单地映射任何传入请求应该指向的位置。请注意，所有未知的内容都将被重定向到<code class="fe lr ls lt lu b">index.html</code>文件。</li></ul><p id="da59" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">还有呢！由于我使用的<code class="fe lr ls lt lu b">@now/static-build</code>有一些约束，我需要尊重它们:</p><ul class=""><li id="8bdd" class="mo mp it kw b kx ky la lb ld of lh og ll oh lp mv mw mx my bi translated">我们需要在<code class="fe lr ls lt lu b">package.json</code>文件中添加一个<code class="fe lr ls lt lu b">now-build</code>脚本，它将由构建器的入口点运行。</li><li id="8fb9" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated">输出数据应该包含在<code class="fe lr ls lt lu b">dist</code>文件夹中，而<code class="fe lr ls lt lu b">create-react-app</code>将内容设置在<code class="fe lr ls lt lu b">build</code>文件夹中。</li></ul><p id="51ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">把所有的东西放在一起，我们的<code class="fe lr ls lt lu b">package.json</code>文件看起来会像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div><p class="ob oc gj gh gi od oe bd b be z dk translated">为了简化要点，我只保留了名称、版本和脚本键</p></figure><p id="f217" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好了，一切准备就绪。我们的下一步是实现适当的GitHub动作。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="14ee" class="nl lw it bd lx nm nn no ma np nq nr md jz ns ka mg kc nt kd mj kf nu kg mm nv bi translated">GitHub操作配置</h1><p id="b2b8" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld nw lf lg lh nx lj lk ll ny ln lo lp im bi translated">为了创建一个新的部署工作流，我们需要在我们的存储库的根目录下创建一个<code class="fe lr ls lt lu b">.github</code>文件夹。如果您使用<a class="ae lq" href="https://help.github.com/en/articles/creating-issue-templates-for-your-repository" rel="noopener ugc nofollow" target="_blank">问题模板</a>，您可能已经在使用它了。</p><p id="3f99" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，添加一个<code class="fe lr ls lt lu b">workflows</code>子文件夹，它将包含您想要的任意数量的工作流。</p><p id="54d9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们将创建一个与我们想要的部署工作流相对应的YAML文件。例如，您可以创建许多文件来创建多个工作流，一个用于测试，一个用于部署。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="1e82" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们分析一下我们在文件中写了什么:</p><ul class=""><li id="0e28" class="mo mp it kw b kx ky la lb ld of lh og ll oh lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">name</code>:我们将在GitHub中看到的一个漂亮的工作流名称。</li><li id="7765" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">on</code>:工作流程应该执行的时间。<a class="ae lq" href="https://help.github.com/en/articles/events-that-trigger-workflows" rel="noopener ugc nofollow" target="_blank">有很多事件我们可以挑选。</a></li><li id="2279" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">jobs</code>:要执行的作业列表。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/02005f5ab242446c73e83430a2da27ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQRdaWkdiS5gB4uakwD6fg.png"/></div></div><p class="ob oc gj gh gi od oe bd b be z dk translated">GitHub界面中的作业列表</p></figure><p id="f47b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些工作看起来几乎一样。我将只展示包含比其他版本更多信息的版本。</p><ul class=""><li id="3bc7" class="mo mp it kw b kx ky la lb ld of lh og ll oh lp mv mw mx my bi translated">再次，一个漂亮的名字来标识当前的工作。</li><li id="7c5c" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">runs-on</code>:将执行作业的操作系统。这里列出的<a class="ae lq" href="https://help.github.com/en/articles/workflow-syntax-for-github-actions#jobsjob_idruns-on" rel="noopener ugc nofollow" target="_blank">可能性很少</a>。</li><li id="f188" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">needs</code>:执行此任务前需要的任务。GitHub动作很智能；他们会遵循<code class="fe lr ls lt lu b">needs</code>的顺序，所以你不必担心你的工作是如何排序的。你会在下面的截图中看到说明。</li><li id="7570" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">steps</code>:要执行的动作列表</li></ul><p id="8dc2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们再一次深入了解步骤是如何配置的:</p><ul class=""><li id="0968" class="mo mp it kw b kx ky la lb ld of lh og ll oh lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">name</code>:猜猜看？这个动作的名字真好听！</li><li id="ff64" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">uses</code>:最后要执行的动作。有很多可用的操作。我使用的两个是<code class="fe lr ls lt lu b">actions/checkout@v1</code>来获取我的存储库文件，而<code class="fe lr ls lt lu b">actions/zeit-not@master</code>用于与ZEIT-Now相关的操作。动作的结构是首先有存储库(例如动作/检出)，然后是我们想要使用的分支(例如主)。</li><li id="0d26" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">env</code>:存储在GitHub接口中的环境变量。</li><li id="6020" class="mo mp it kw b kx mz la na ld nb lh nc ll nd lp mv mw mx my bi translated"><code class="fe lr ls lt lu b">with</code>:允许配置一些变量的动作。在本例中，我们只想将<code class="fe lr ls lt lu b">--prod</code>参数添加到将要执行的<code class="fe lr ls lt lu b">now</code>命令中。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/714f1824bd8b3345425249843c743c14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tb__ZlqkA42Z6dtscs1cew.png"/></div></div><p class="ob oc gj gh gi od oe bd b be z dk translated">工作在左边，台阶在右边</p></figure><h2 id="29c9" class="lv lw it bd lx ly lz dn ma mb mc dp md ld me mf mg lh mh mi mj ll mk ml mm mn bi translated">存储秘密</h2><p id="dc77" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld nw lf lg lh nx lj lk ll ny ln lo lp im bi translated">在YAML文件中，我们使用一个<code class="fe lr ls lt lu b">ZEIT_TOKEN</code>秘密。您可以在<em class="oj">设置</em>菜单中进行设置，在那里我们可以找到一个<em class="oj">秘密</em>菜单。一旦您添加了一个秘密，您将无法再次获得该值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/1486364c5931b4f9e88ee9cb67c159ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ix-D9z26HYO0D8Qtt3V99g.png"/></div></div></figure></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="5205" class="nl lw it bd lx nm nn no ma np nq nr md jz ns ka mg kc nt kd mj kf nu kg mm nv bi translated">结论</h1><p id="de87" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld nw lf lg lh nx lj lk ll ny ln lo lp im bi translated">设置GitHub操作一开始有点复杂，尤其是因为你在互联网上找到的故事使用的是旧语法。但是，最终，对于一个测试版特性来说，一切都非常简单和实用。</p><p id="ee86" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当然，关于用法还有更多要说的，比如考虑构建性能。但那将是另一个故事的内容。敬请期待！</p><p id="7225" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我喜欢探索API，我希望你会和我一样兴奋地开始挖掘行动！</p></div></div>    
</body>
</html>