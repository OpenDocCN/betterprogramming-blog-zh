<html>
<head>
<title>PySpark Development Made Simple</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PySpark开发变得简单</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/pyspark-development-made-simple-9449a893ab17?source=collection_archive---------5-----------------------#2022-09-30">https://betterprogramming.pub/pyspark-development-made-simple-9449a893ab17?source=collection_archive---------5-----------------------#2022-09-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="090b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用VS代码、Jupyter笔记本和Docker</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f6c7a7fce7d6140f3d3909cfdef01de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6DROvAbbSlWimgPKKnGovQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="506d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">几周前，我在寻找一个描述如何在Mac上用Jupyter笔记本和PySpark使用VS代码的教程的圣杯。令人惊讶的是，我什么也没找到。好吧，没有一个通过了我的“像我五岁一样解释”测试。</p><p id="cf70" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这篇文章是一个痛苦的周六下午的成果。</p><h1 id="bcdd" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">阻力最小的路径:回复救援</h1><p id="0ca1" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">这些天来，我几乎没有时间玩新技术。当我这么做的时候，我希望它尽可能的没有痛苦。最重要的是，我希望它是有趣的——否则，何苦呢？</p><p id="ca85" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，没有什么比浪费您的空闲时间来配置开发环境更糟糕的了。只是很痛苦。</p><h2 id="9883" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">Jupyter笔记本VS代码</h2><p id="e6b5" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我是快速开发的复制器的忠实粉丝——例如，评估一个新的框架，分析数据，数据修复，等等。</p><p id="1176" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这些情况下，我不想配置一个新的项目，并陷入琐碎的设置复杂性。我只需要一个便笺簿来研究出一些代码。</p><p id="a457" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Jupyter Notebooks是一个位于REPL的系统，旨在对数据进行分析、可视化和协作。他们也是伟大的便签簿。</p><h2 id="0b7b" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">什么是REPL？</h2><blockquote class="nd ne nf"><p id="6bed" class="ky kz ng la b lb lc ju ld le lf jx lg nh li lj lk ni lm ln lo nj lq lr ls lt im bi translated">读取-评估-打印循环(REPL)，也称为交互式顶层或语言外壳，是一个简单的交互式<a class="ae nk" href="https://en.wikipedia.org/wiki/Computer_programming" rel="noopener ugc nofollow" target="_blank">计算机编程</a>环境，接受单个用户输入，执行它们，并将结果返回给用户；在REPL环境中编写的程序是分段执行的。<br/> <a class="ae nk" href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></blockquote><p id="101e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Visual Studio代码对<a class="ae nk" href="https://code.visualstudio.com/blogs/2021/11/08/custom-notebooks" rel="noopener ugc nofollow" target="_blank">笔记本</a>有原生支持，包括Jupyter。</p><h1 id="5a6e" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">设置</h1><h2 id="714f" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">先决条件</h2><ul class=""><li id="38e4" class="nl nm it la b lb mm le mn lh nn ll no lp np lt nq nr ns nt bi translated">安装Docker <br/> <em class="ng">如果你使用的是Mac，由于许可限制无法安装Docker Desktop，请查看</em><a class="ae nk" href="https://github.com/abiosoft/colima" rel="noopener ugc nofollow" target="_blank"><em class="ng">Colima</em></a><em class="ng">。</em></li><li id="001b" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nq nr ns nt bi translated">安装VS代码</li></ul><h2 id="a065" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">VS代码开发容器</h2><ol class=""><li id="c7fe" class="nl nm it la b lb mm le mn lh nn ll no lp np lt nz nr ns nt bi translated">为您的项目创建新目录。</li><li id="2758" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nz nr ns nt bi translated">使用下面的代码在项目目录的根目录下创建一个Docker文件。在撰写本文时，当前的PySpark版本是3.3.0。我会检查这里的<a class="ae nk" href="https://pypi.org/project/pyspark/" rel="noopener ugc nofollow" target="_blank">以确保您使用的是最新版本。</a></li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="1314" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.创建名为<code class="fe oc od oe of b">.devcontainer</code>的目录。</p><p id="3428" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.在<code class="fe oc od oe of b">.devcontainer</code>目录中，添加以下JSON配置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="3b6d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.在VS代码的左下角，点击打开远程窗口按钮→在容器中打开。</p><p id="6610" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="ng">点击</em> <a class="ae nk" href="https://code.visualstudio.com/docs/remote/remote-overview" rel="noopener ugc nofollow" target="_blank"> <em class="ng">此处</em> </a> <em class="ng">了解更多关于VS代码内远程开发的信息。</em></p><p id="bf73" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">VS代码将重新启动IDE并连接到VS代码开发容器——从步骤2中定义的Docker映像实例化。</p><p id="dba7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是设置。</p><h1 id="3279" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">开发您的第一个PySpark应用程序</h1><h2 id="cfae" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">创建笔记本</h2><ol class=""><li id="bc1d" class="nl nm it la b lb mm le mn lh nn ll no lp np lt nz nr ns nt bi translated">在项目目录中创建一个扩展名为. ipynb的新文件。</li><li id="5798" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nz nr ns nt bi translated">打开文件——您应该会看到VS代码笔记本体验。</li></ol><h2 id="6468" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">测试数据</h2><ol class=""><li id="dc42" class="nl nm it la b lb mm le mn lh nn ll no lp np lt nz nr ns nt bi translated">在根目录中，添加一个名为data的新文件夹。</li><li id="e4e1" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nz nr ns nt bi translated">在数据目录中，创建一个名为<code class="fe oc od oe of b">users.csv</code>的新CSV文件，并添加以下数据:</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h2 id="970d" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">示例:火花应用</h2><p id="9097" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">本节假设您已经安装了Docker，配置了VS代码开发容器，并创建了一个空笔记本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="3a87" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好吧，让我们一个细胞一个细胞地分解。</p><ol class=""><li id="e99d" class="nl nm it la b lb lc le lf lh og ll oh lp oi lt nz nr ns nt bi translated">导入库:第一个单元格导入PySpark和Pandas Python库。</li><li id="eb03" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nz nr ns nt bi translated">连接到Spark:第二个单元格是我们定义连接到Spark的地方。因为我们是在本地模式下运行，所以不需要担心连接字符串。</li><li id="4a68" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nz nr ns nt bi translated">将CSV读入一个临时视图:在第三个单元中，我们将一个CSV文件从本地文件系统读入Spark——CSV包含测试数据。<br/>第二步创建一个名为‘users’的临时视图——这允许我们使用普通的旧SQL查询该表。</li><li id="6a91" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nz nr ns nt bi translated">查询:在最后一个单元格中，我们定义了一个SQL查询，它将按性别返回所有用户的平均年龄。函数调用toPandas()，将Spark数据帧转换为Panda的数据帧——允许我们使用VS Code的数据帧渲染。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/0de1f1b1596f2f71bb800cf5b19cfc97.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*bLVoxtiISzMlrVZhPCMLFw.png"/></div></figure><p id="9841" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.单击顶部的全部运行，执行笔记本中的所有单元格。如果可以的话，您应该会看到一个两行的数据帧——如上图所示。</p><h1 id="af32" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">最后的想法</h1><p id="2fff" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在Jupyter笔记本和Docker上使用Visual Studio代码是开始使用PySpark的简单方法。</p><p id="adea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你有任何改进上述开发工作流程的建议，请在评论中告诉我。</p><p id="192c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望你觉得这很有趣。</p><p id="4223" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">山药山药建筑师。</p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><p id="6986" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢阅读这样的故事，并想支持我成为一名作家，可以考虑<a class="ae nk" href="https://medium.com/@yam-yam-architect/membership" rel="noopener">注册成为一名媒体会员</a>。每月5美元，你可以无限制地阅读媒体上的故事。如果你用我的链接注册，我会赚一点佣金。</p><div class="or os gp gr ot ou"><a href="https://medium.com/@yam-yam-architect/membership" rel="noopener follow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">通过我的推荐链接加入Medium-yam yam architect</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">阅读yam yam architect(以及媒体上成千上万的其他作者)的每一个故事。您的会员费直接…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">medium.com</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi ks ou"/></div></div></a></div></div></div>    
</body>
</html>