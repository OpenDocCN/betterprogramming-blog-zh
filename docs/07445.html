<html>
<head>
<title>Best Practices for Using ViewModels in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android中使用视图模型的最佳实践</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/best-practices-for-using-viewmodels-in-android-e986b25dc78f?source=collection_archive---------1-----------------------#2021-01-15">https://betterprogramming.pub/best-practices-for-using-viewmodels-in-android-e986b25dc78f?source=collection_archive---------1-----------------------#2021-01-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="800c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何正确设置和使用Java和Kotlin视图模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6b8fe14d7e0d8e7e62e8875622b82a7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jq4uFaP5DQ1AqO97"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Christian Wiediger 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="ec5e" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">为什么应该使用视图模型？</h1><p id="dbfc" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在开始使用<code class="fe mu mv mw mx b">ViewModels</code>的最佳实践之前，我们应该问自己为什么我们应该使用<code class="fe mu mv mw mx b">ViewModel</code>。答案很简单:关注点分离(SoC)。这使得应用程序可维护、可扩展和可测试。</p><p id="8791" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">这也可以通过演示者(MVP)来实现，但我更喜欢<code class="fe mu mv mw mx b">ViewModels</code>(干净的建筑或MVVM)，因为它们不会在用户切换配置(横向和纵向)时被瞬间破坏。这解决了许多传统问题，例如不执行昂贵的操作，如在配置更改时从服务器加载数据。</p><p id="f67f" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">足球就是分而治之。理解SoC的一个最好的真实例子是在一个软件开发公司中有不同的部门(人力资源、财务、质量保证、工程等。).在我们的例子中，我们使用<code class="fe mu mv mw mx b">ViewModels</code>从UI相关的代码中深入到业务逻辑和后台任务中。</p><p id="ecdf" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">在Android术语中，他们使活动和片段尽可能精简，导致很少或没有生命周期相关的问题。这被认为是最佳实践之一，因为活动和片段只不过是Android操作系统和应用程序之间的桥梁。这意味着操作系统可以在任何给定的时间销毁它们。</p><p id="3237" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">在本文中，我将讨论我在与<code class="fe mu mv mw mx b">ViewModels</code>打交道的经验中看到的最佳实践和常见错误。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="23bb" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">不要传递上下文</h1><p id="2785" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我见过许多开发人员将上下文传递给<code class="fe mu mv mw mx b">ViewModel</code>函数，尽管使用<code class="fe mu mv mw mx b">ViewModels</code>的主要目的是将繁重的任务与UI相关的代码分开。</p><p id="7248" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">通常，当开发人员试图创建类的对象(例如，一个共享的首选项或需要<code class="fe mu mv mw mx b">ViewModel</code>中上下文的网络库)而不是使用像Dagger2或Koin这样的依赖机制时，就会发生这种类型的错误。</p><p id="df97" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">这个问题的解决方案是使用一个合适的依赖注入库(最好是未来几天的Hilt)并通过<code class="fe mu mv mw mx b">ViewModel</code>构造函数传递必要的依赖。</p><p id="1ae9" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">发生这类错误的第二个原因很有趣:一些开发人员倾向于从<code class="fe mu mv mw mx b">ViewModel</code>开始显示进度条，他们需要上下文。这个问题的解决方案是使用密封类和活动数据。要了解更多信息，请阅读本文。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="605f" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">清除资源</h1><p id="4691" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">作为应用程序开发人员，一项至关重要的任务是在不耗尽移动健康的情况下有效地管理资源。为了实现这一点，清理资源对于有效地使用它们同样重要。</p><p id="a5fd" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">在现代Android开发中证明这一点的最好例子之一是维护一个<code class="fe mu mv mw mx b">CompositeDisposable</code>,并向其中添加所有与RxJava相关的任务。然后在<code class="fe mu mv mw mx b">onCleared</code>函数中立即清除它们。这将减少内存泄漏并提高性能，因为我们清除了不必要的资源。</p><p id="6c16" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">如果您正在使用协程，那么您可以用协程作用域做同样的事情。在适当的组件中维护一个范围是一个好的实践，比如<code class="fe mu mv mw mx b">ViewModel</code>、片段和活动来限制功能。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="19c0" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">带底座延伸</h1><p id="b09d" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在上一节中，我们看到了当不再需要资源时清除它们的好处。虽然它很好，但也需要大量的手工操作。</p><p id="51e9" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">减少手工工作的最好方法之一是维护一个带有开放关键字的基础组件(如<code class="fe mu mv mw mx b">Baseviewmodel</code>)并执行常见任务。</p><p id="9fed" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">这不是什么新鲜事。这是Android环境中的标准继承层次。Android中的<code class="fe mu mv mw mx b">Application</code>类是Android应用程序中的基类，包含所有其他组件，如活动和服务(例如appcompatativity&gt;FragmentActivity&gt;Activity)。</p><p id="030f" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">我们可以对其他组件做同样的事情，比如片段和活动，以集中公共任务并减少重复代码。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="559f" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">不要实现广泛的业务逻辑</h1><p id="0caa" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">创建<code class="fe mu mv mw mx b">ViewModels</code>是为了将与UI相关的代码与其他任务分开，但是<code class="fe mu mv mw mx b">ViewModels</code>中大量的业务逻辑可能会复制样板代码。</p><p id="e5be" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">我们需要将业务逻辑和其他广泛的操作从<code class="fe mu mv mw mx b">ViewModels</code>转移到用例或存储库中来解决这个问题。这将为我们提供重用它们的杠杆，并使它们易于测试和维护。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="2904" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">奖金</h1><p id="0e73" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">要了解有关高级Android开发的更多信息，请阅读以下文章:</p><ul class=""><li id="c333" class="nd ne it ma b mb my me mz mh nf ml ng mp nh mt ni nj nk nl bi translated"><a class="ae ky" href="https://medium.com/@sgkantamani/android-product-flavors-eb526e35f9f1" rel="noopener">“安卓产品口味”</a></li><li id="bbe6" class="nd ne it ma b mb nm me nn mh no ml np mp nq mt ni nj nk nl bi translated"><a class="ae ky" href="https://medium.com/@sgkantamani/how-to-create-and-publish-an-android-library-f37bf715932" rel="noopener">“如何创建和发布Android库”</a></li></ul><p id="93d1" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh na mj mk ml nb mn mo mp nc mr ms mt im bi translated">目前就这些。希望你学到了有用的东西。感谢阅读！</p></div></div>    
</body>
</html>