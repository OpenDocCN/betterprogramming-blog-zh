<html>
<head>
<title>5 Useful Tricks To Rewrite Your Git History</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">改写Git历史的5个有用技巧</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/5-useful-tricks-to-rewrite-your-git-history-92268f8b6933?source=collection_archive---------6-----------------------#2021-05-10">https://betterprogramming.pub/5-useful-tricks-to-rewrite-your-git-history-92268f8b6933?source=collection_archive---------6-----------------------#2021-05-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cb0f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">挤压、撤消最新提交，等等</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/55bd50fada12f87c871fbdd5466b54f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RpdCB8ssHVk6dpHL31rKbA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@yancymin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">扬西·敏</a>在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="5e7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我相信现在每一个开发都应该和Git一起完成，Git是一个强大的协作工具，可以跟踪项目中发生的每一个变化，这样开发人员就可以有一个很长的历史记录。这是非常有用的，尤其是当我们在团队中工作的时候。但是我个人会把它添加到我所有的项目中，即使我是一个人在工作。为什么？因为我可以很容易地跟踪我过去做了什么，并且很快地跟踪到错误和错误。</p><p id="2bc6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将讨论一些有用的技巧，我们可以用它们来干净地管理我们的Git提交。</p><ol class=""><li id="f5ae" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">组合多个提交(挤压)</li><li id="1664" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">编辑旧的提交消息</li><li id="7f10" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">撤消最近的<em class="mg"> N次</em>提交</li><li id="3d79" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">删除旧的提交(在历史列表的中间)</li><li id="e2b5" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">将修改后的提交(之前已经提交过)推送到您的远程存储库</li></ol><p id="4260" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如Git <a class="ae kv" href="https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History" rel="noopener ugc nofollow" target="_blank">文档</a>中提到的，它基本上没有提供修改历史工具，但是我们可以利用<code class="fe mh mi mj mk b">rebase</code> <a class="ae kv" href="https://git-scm.com/docs/git-rebase" rel="noopener ugc nofollow" target="_blank">工具</a>来交互式地修改旧的提交。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="0e96" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">我需要修改我的旧提交吗？</h1><p id="2178" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">首先，我们来了解一些场景。</p><h2 id="a304" class="np mt iq bd mu nq nr dn my ns nt dp nc lf nu nv ne lj nw nx ng ln ny nz ni oa bi translated">场景1。</h2><p id="7f52" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">作为一名开发人员，大多数时候，当更新代码时，我总是希望将它保存在Git中，这样我就可以跟踪更改，即使更改非常小(以便轻松跟踪哪些代码工作正常，哪些代码有bug)。所以我放了一个简单的信息，让我知道发生了什么变化。我不断地为每一个小的变化添加更多的提交。过一会儿，当任务完成时，我需要将所有这些小的更改合并到一个提交中。是的，这需要一个技巧来完成。</p><h2 id="771c" class="np mt iq bd mu nq nr dn my ns nt dp nc lf nu nv ne lj nw nx ng ln ny nz ni oa bi translated">场景2。</h2><p id="2a5d" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">在第二个场景中，我需要编辑一些提交消息(我之前已经添加了)。例如，开发实践中总是在提交消息前添加一个票证问题编号，如“问题-781:修复了设置页面中按钮动画的小故障”或“#541:已解决的约束错误”</p><h2 id="ec62" class="np mt iq bd mu nq nr dn my ns nt dp nc lf nu nv ne lj nw nx ng ln ny nz ni oa bi translated"><strong class="ak">小心点</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/7e74f4cba5157f2a0297ac90a15c65b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lK9pXkSHYqzelKLFBOWnHQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@mriechers?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马克·里切尔斯</a>在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="a7f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章中的技巧很简单，但不要太容易。<strong class="ky ir">请仔细阅读每条指令，以防止任何提交丢失</strong>。请至少尝试在一个样本项目(不是至关重要的项目)上做一些练习。此外，为了更安全，您可以在执行修改之前将项目复制或备份到另一个目录。一旦您对修改足够有信心，并且没有发生数据丢失，就可以删除备份项目。</p><p id="00ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不建议修改已经推送到服务器的提交。它会让其他开发人员对历史变更感到困惑。避免这样做，除非它非常重要，并且其他团队成员知道该修改。</p><p id="dcf8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么，我们如何管理旧的提交呢？</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="d86f" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated"><strong class="ak"> 1。组合多个提交(挤压)</strong></h1><p id="844c" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">正如在上面的第一个场景中提到的，我们不想错过任何更改，所以我们继续为小的更新进行Git提交。假设我们有一个任务“创建配置文件页面”，我们有五个提交来执行子任务。最后，一旦模块完成，我们希望将所有的提交合并成一个提交，并重新表述消息。</p><p id="12d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，打开终端并转到特定的项目目录。运行<code class="fe mh mi mj mk b">git log</code>来检查当前已经完成的提交。在下图中，我有五个与我想要合并的相同任务相关的最新提交。</p><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="cdcb" class="np mt iq mk b gy og oh l oi oj">$ git log</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/a44d596dc63f229ebc3dc2a3849120af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IyUAuooogXVvf-TT9V7LIg.png"/></div></div></figure><p id="a169" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是使用<a class="ae kv" href="https://ohmyz.sh" rel="noopener ugc nofollow" target="_blank"> zsh </a>的<code class="fe mh mi mj mk b">glog</code>命令的简单输出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/552f5a60b33c340146714ca90111614b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VNfi93tnynC2uaks7D4FeA.png"/></div></div></figure><h2 id="2247" class="np mt iq bd mu nq nr dn my ns nt dp nc lf nu nv ne lj nw nx ng ln ny nz ni oa bi translated"><strong class="ak">第一步。</strong></h2><p id="58f5" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">运行此命令修改之前的<em class="mg"> N </em>次提交。在本例中，我有五个提交需要压缩并合并成一个提交。命令末尾的<code class="fe mh mi mj mk b">5</code>表示我们要重定多少次提交。它可能会有所不同，这取决于您正在修改的提交数量。</p><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="cd29" class="np mt iq mk b gy og oh l oi oj">$ git rebase -i HEAD~5</span></pre><p id="c497" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将获得类似的输出，如下图所示。它将显示您经常使用的通用终端编辑器(在我的例子中是vi编辑器)。顶部显示的五个提交已经准备好进行修改了。底部(黄色框中)是我们可以执行的可用操作。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/07445f793ef07313135f489b2b27198a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y9rJAW8oTql66F5W2DInCg.png"/></div></div></figure><h2 id="ec96" class="np mt iq bd mu nq nr dn my ns nt dp nc lf nu nv ne lj nw nx ng ln ny nz ni oa bi translated"><strong class="ak">第二步。</strong></h2><p id="b698" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">将单词<code class="fe mh mi mj mk b">pick</code>改为<code class="fe mh mi mj mk b">s</code>或<code class="fe mh mi mj mk b">squash</code>来压缩这四个提交，并将最早的提交放在顶部。然后保存更改(取决于编辑器—对于vi编辑器，是Esc，然后是<code class="fe mh mi mj mk b">:wq</code>)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/d50efbdeb4a593d16368c21110f5ab14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YAQwxKiMNjs8rToiTni_qg.png"/></div></div></figure><p id="4877" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保存后，系统会提示您编写提交消息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/8719233c56c40eedfa80e5b9614c3525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ewuxox8y6yD_UC1saVkAA.png"/></div></div></figure><h2 id="7f3c" class="np mt iq bd mu nq nr dn my ns nt dp nc lf nu nv ne lj nw nx ng ln ny nz ni oa bi translated">第三步。</h2><p id="5604" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">有三个选项可以更新消息。</p><p id="7668" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1)立即保存，不做任何更改。您将得到的结果是提交所有消息(写在多行中)。</p><p id="6800" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2)删除所有以前的消息，并编写一个新消息。(有时我用这个来简化提交消息。)</p><p id="510d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3)您可以在顶部修改新消息，并留下其他提交消息(推荐)。例如，添加的新提交是“模块-134:完成的概要文件模块”所以我们仍然可以保留所有以前的消息。最终的提交消息将类似于下图所示。</p><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="d5ae" class="np mt iq mk b gy og oh l oi oj"><strong class="mk ir">Module-134: Completed Profile module </strong>// newly added</span><span id="e1ef" class="np mt iq mk b gy op oh l oi oj">Added Profile page and custom HeaderView</span><span id="cbdc" class="np mt iq mk b gy op oh l oi oj">Modified Profile image with shadow</span><span id="3fba" class="np mt iq mk b gy op oh l oi oj">Added edit Profile button</span><span id="d84a" class="np mt iq mk b gy op oh l oi oj">Added API service for profile</span><span id="f9c2" class="np mt iq mk b gy op oh l oi oj">Fixed API service error handling</span></pre><p id="208b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，我们将使用第三个选项。您可以在顶部添加一条新消息作为组合消息。输出将是这样的。(注意，<code class="fe mh mi mj mk b">#</code>之后的文本不会出现在提交消息中，所以可以忽略它。)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/71cff4313040f823d5791efe6b69196d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EvFT9BnPA4mQhePfIIGXYw.png"/></div></div></figure><p id="b9c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦成功保存，终端输出将类似于下图。</p><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="34bb" class="np mt iq mk b gy og oh l oi oj">$ git rebase -i HEAD~5</span><span id="5c08" class="np mt iq mk b gy op oh l oi oj">[detached HEAD c4aeecc] Module-134: Completed Profile module<br/>Date: Sun May 9 10:05:08 2021 +0800</span><span id="d40a" class="np mt iq mk b gy op oh l oi oj">5 files changed, 5 insertions(+)</span><span id="be24" class="np mt iq mk b gy op oh l oi oj">create mode 100644 ProfileViewController.swift<br/>create mode 100644 ProfileHeaderView.swift<br/>create mode 100644 ProfileApiService.swift<br/>Successfully rebased and updated refs/heads/master.</span></pre><p id="2061" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很好，让我们检查一下我们修改的提交中发生了什么。您可以使用<code class="fe mh mi mj mk b">git log</code>或<a class="ae kv" href="https://www.sourcetreeapp.com" rel="noopener ugc nofollow" target="_blank"> Sourcetree </a>进行检查。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/8e1c70c02b02e651c8fd6472b9b615c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ZdwqYEraTsLzU0Zz8eQ7A.png"/></div></div></figure><p id="dfcb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">耶，我们做到了。现在，它变成了包含所有五条消息的单个提交。</p><h2 id="61a0" class="np mt iq bd mu nq nr dn my ns nt dp nc lf nu nv ne lj nw nx ng ln ny nz ni oa bi translated">这个怎么样？</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/73c2660a08f8bd325557add858ec5b22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eai5mu1dx7VvsEmo_7iwWA.png"/></div></div></figure><p id="b976" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看看上面的图片。它展示了当我们试图修复一些讨厌的bug时经常犯的错误。这一招很有用，让它干净。运行这个命令，并遵循上面讨论的相同步骤。厉害！</p><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="b01b" class="np mt iq mk b gy og oh l oi oj">$ Git rebase -i HEAD~4</span></pre></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="ae33" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">2.编辑旧的提交消息</h1><p id="b6b6" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated"><em class="mg">“哦，不，我只需要更新我提交消息中的错别字！”</em></p><p id="a3db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是的，这也是我们经常做的事情，让一个Git提交一个错别字。在这一部分，我们将学习如何简单地编辑提交消息。当我们需要在旧消息前添加票据/问题编号时，这是必要的，否则它可能会出现打印错误。</p><p id="93ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该命令与之前相同，除了您需要选择的选项是<code class="fe mh mi mj mk b">r</code>或<code class="fe mh mi mj mk b">reword</code>。</p><p id="d778" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个例子中，我需要在所有这四个提交前面加上一个特定于吉拉的问题号，即“WR-453”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/551f3730f6bf40479b66bb2d546aa9b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ixm0k64xc5tq80MMg4q3-g.png"/></div></div></figure><h2 id="b953" class="np mt iq bd mu nq nr dn my ns nt dp nc lf nu nv ne lj nw nx ng ln ny nz ni oa bi translated">第一步。</h2><p id="079d" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">运行相同的Git <code class="fe mh mi mj mk b">rebase</code>命令，其中<em class="mg"> N </em>等于<code class="fe mh mi mj mk b">4</code>。</p><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="f2bd" class="np mt iq mk b gy og oh l oi oj">$ git rebase -i HEAD~4</span></pre><h2 id="8688" class="np mt iq bd mu nq nr dn my ns nt dp nc lf nu nv ne lj nw nx ng ln ny nz ni oa bi translated">第二步。</h2><p id="c890" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">将<code class="fe mh mi mj mk b">pick</code>更改为<code class="fe mh mi mj mk b">r</code>或<code class="fe mh mi mj mk b">reword</code>，并保存。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/5b4187258148552524ae4774b49a07be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BkmjnKSirDrroTBc_p4tww.png"/></div></div></figure><p id="7ac2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，您将被提示以交互方式一个接一个地编辑这些消息四次。很好。继续编辑每条消息并保存，直到完成所有步骤。</p><p id="cc73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看看下面的屏幕。它在消息的顶部显示我们正在编辑，在底部突出显示已完成和剩余步骤的注释。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/47d536627e03528b40082c31563b2942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4iVBRIZeUL_J1Rb6YLRKnQ.png"/></div></div></figure><p id="51b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成后，终端输出中显示的结果将类似于下图。此外，我们可以使用<code class="fe mh mi mj mk b">git log</code>进行检查，以确保提交消息得到了相应的更新。</p><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="51c0" class="np mt iq mk b gy og oh l oi oj">$ git rebase -i HEAD~4</span><span id="bbf2" class="np mt iq mk b gy op oh l oi oj">[detached HEAD 71ebada] <strong class="mk ir">WR-453: Fix crashes cause by improper nil </strong>handler<br/>Date: Sun May 9 17:31:47 2021 +0800<br/>1 file changed, 1 insertion(+)<br/>create mode 100644 ViewController.swift</span><span id="2562" class="np mt iq mk b gy op oh l oi oj">[detached HEAD d48428a] <strong class="mk ir">WR-453: Again fix as previous</strong><br/>Date: Sun May 9 17:32:19 2021 +0800<br/>1 file changed, 1 insertion(+)</span><span id="7655" class="np mt iq mk b gy op oh l oi oj">[detached HEAD 4c74ecc] <strong class="mk ir">WR-453: Added viewModel for Auth page</strong><br/>Date: Sun May 9 18:06:45 2021 +0800<br/>1 file changed, 1 insertion(+)<br/>create mode 100644 AuthViewModel.swift</span><span id="f53b" class="np mt iq mk b gy op oh l oi oj">[detached HEAD a45b5fc] <strong class="mk ir">WR-453: Added auth vc and viewModel</strong><br/>Date: Sun May 9 20:16:50 2021 +0800<br/>2 files changed, 2 insertions(+)</span><span id="177a" class="np mt iq mk b gy op oh l oi oj">Successfully rebased and updated refs/heads/main.</span></pre></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="23e9" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated"><strong class="ak"> 3。撤销最近一次提交</strong></h1><p id="640c" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">撤销过程有点危险，尤其是当你想要撤销一个重要的或者大的提交时。一般来说，有两种方法可以撤销提交(除了使用<code class="fe mh mi mj mk b">rebase</code>)。</p><h2 id="e256" class="np mt iq bd mu nq nr dn my ns nt dp nc lf nu nv ne lj nw nx ng ln ny nz ni oa bi translated">撤消提交并分阶段保存文件(推荐)</h2><p id="4a66" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">使用这种方法，您不会丢失更改，并且您可以再次修改文件以供将来修改，或者干脆将它们扔进储藏室。“stages”通常发生在我们调用Git add命令时(记住<a class="ae kv" href="https://githowto.com/staging_changes" rel="noopener ugc nofollow" target="_blank"> stage和unstage </a>)。</p><p id="a8b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该命令背后的过程是将Git头重置为先前指向的提交，并将受影响的文件从头之后的提交移动到阶段中。</p><p id="fde4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，在我的例子中，我有两个提交要撤销。您可以根据想要撤销的提交数量来更改后面的数字。如果你只需要撤销最后一次提交，那么把它改成<code class="fe mh mi mj mk b">1</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/4aaf11cb27477192b1535a2b9a35889a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lpVCsYDgUeu9ejmJ0Sclcw.png"/></div></div></figure><p id="4850" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行下面的命令，并使用<code class="fe mh mi mj mk b">--soft</code>标志来执行，以保持文件在暂存状态。</p><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="42d2" class="np mt iq mk b gy og oh l oi oj">$ git reset --soft HEAD~2</span></pre><p id="8738" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，当您运行<code class="fe mh mi mj mk b">git status</code>来检查结果时，您将会看到撤消的文件仍然在阶段中。太好了！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/d9bd3fd84682f84c3d6b1a8af4c71f78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qRLnujN7UXSt14mkrwlrfg.png"/></div></div></figure><h2 id="4b84" class="np mt iq bd mu nq nr dn my ns nt dp nc lf nu nv ne lj nw nx ng ln ny nz ni oa bi translated">撤消提交并放弃所有更改</h2><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="1352" class="np mt iq mk b gy og oh l oi oj">$ git reset --hard HEAD~2</span></pre><p id="4f0d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">小心</strong>并确保在命令末尾指定了正确的撤销数字。这与之前的安全撤销非常相似，除了这会用<code class="fe mh mi mj mk b">--hard</code>标志替换<code class="fe mh mi mj mk b">--soft</code>来忽略撤销提交中的更改。你可以参考<a class="ae kv" href="https://stackoverflow.com/q/927358/6132334" rel="noopener ugc nofollow" target="_blank">堆栈溢出</a>中关于撤销提交的详细讨论。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="ec30" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">4.删除旧的提交(在历史列表的中间)</h1><p id="ff76" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">这很少实现，因为我们应该保留旧的提交，尽管提交中有错误。但是对于仍然在本地开发中并且需要一些清理的提交，我们可以使用这个技巧。</p><p id="c7bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，我们需要检查我们想要删除哪个目标提交，并从最近的提交中计数<em class="mg"> N </em>。然后我们使用与第一个技巧中演示的相同的git <code class="fe mh mi mj mk b">rebase</code>命令，但是现在使用了<code class="fe mh mi mj mk b">drop</code>选项。</p><p id="286e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下面的例子中，我想删除旧的提交(“添加的视差头……”)，它有错误，目前不需要。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/bb71280108b235ab838161d76cb91c90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qwr2q0uEkGBE9kznk1zyOQ.png"/></div></div></figure><p id="7cee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行该命令，将目标提交的<code class="fe mh mi mj mk b">pick</code>更改为<code class="fe mh mi mj mk b">d</code>或<code class="fe mh mi mj mk b">drop</code>。在这种情况下，我们必须确保我们<code class="fe mh mi mj mk b">rebase</code>直到完成六次提交(从顶部开始计数)。</p><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="6af3" class="np mt iq mk b gy og oh l oi oj">$ git rebase -i HEAD~6</span></pre><p id="9476" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">终端输出将交互提示要修改哪个提交。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/64b59b9eda4e603a5451c21a1901bd0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1XWvsjNwD2L4zC4hWpYGfg.png"/></div></div></figure><p id="c811" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了！完成后，终端将显示成功消息:</p><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="4343" class="np mt iq mk b gy og oh l oi oj">Successfully rebased and updated refs/heads/main.</span></pre><p id="0f38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们运行Git日志来确保提交已经从这个世界上消失了。厉害！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/13a72d0bfb210fc24cb31909df6d46b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Id9rjfJB-g5qoMRzC1e7GQ.png"/></div></div></figure></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="3a2e" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">5.将修改后的提交(之前已经推送过)推送到远程存储库</h1><p id="a756" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">在一些情况下，我们需要覆盖远程Git记录。例如，我们可能需要编辑我们的提交消息(在前面加上一个吉拉票号或者重新措辞)，删除一个导致项目问题的不必要的提交，或者清除Git历史。</p><p id="de11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们可以提取所有最近的提交，并开始在本地修改。然而，为了推送至远程服务器，我们需要添加一个标志来通知服务器我们正在强制进行更改。否则，服务器将在更新不同于已记录的历史时回复错误。</p><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="238b" class="np mt iq mk b gy og oh l oi oj">$ git push</span><span id="f5b5" class="np mt iq mk b gy op oh l oi oj">To github.com:xmhafiz/GitExercise.git<br/>! [rejected] main -&gt; main (non-fast-forward)</span><span id="7a90" class="np mt iq mk b gy op oh l oi oj"><strong class="mk ir">error: failed to push some refs</strong> to 'github.com:xmhafiz/GitExercise.git'</span></pre><p id="be0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们需要运行带有<code class="fe mh mi mj mk b">--force-with-lease</code>标志的<code class="fe mh mi mj mk b">push</code>命令，如下所示(成功输出)。</p><pre class="kg kh ki kj gt oc mk od oe aw of bi"><span id="60cf" class="np mt iq mk b gy og oh l oi oj">$ git push --force-with-lease<br/>...<br/>...<br/>To github.com:xmhafiz/GitExercise.git</span><span id="4248" class="np mt iq mk b gy op oh l oi oj">+ 183f370...b33950e main -&gt; main (forced update)</span></pre></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="dd26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太棒了。现在您了解了如何正确地修改旧的提交。请小心地实现这些技术，并在实际项目中尝试之前做一些练习。</p><p id="8574" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">希望本文能帮助您提高开发技能。感谢阅读。非常欢迎反馈。祝你快乐！</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="684e" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">参考</h1><p id="34b3" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated"><a class="ae kv" href="https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History" rel="noopener ugc nofollow" target="_blank">https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History</a></p><p id="1dd5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://git-scm.com/docs/git-rebase" rel="noopener ugc nofollow" target="_blank">https://git-scm.com/docs/git-rebase</a></p><p id="9810" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://stackoverflow.com/q/927358/6132334" rel="noopener ugc nofollow" target="_blank">https://stackoverflow.com/q/927358/6132334</a></p></div></div>    
</body>
</html>