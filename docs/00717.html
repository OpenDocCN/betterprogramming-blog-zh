<html>
<head>
<title>How I Saved $360 a Year Writing My Own Blogging Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何通过写自己的博客平台一年省下360美元</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-i-saved-360-a-year-writing-my-own-blogging-platform-sorry-ghost-io-9720de0733e3?source=collection_archive---------6-----------------------#2019-07-04">https://betterprogramming.pub/how-i-saved-360-a-year-writing-my-own-blogging-platform-sorry-ghost-io-9720de0733e3?source=collection_archive---------6-----------------------#2019-07-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7348" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">抱歉幽灵</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/49c7477678000a0825994f533de23c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AuV_RKoU-Y8WnpUfzhtQew.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这是一台电脑。你还期望什么？</p></figure><p id="4680" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇文章中，我将向你展示我是如何用自己的CI/CD管道创建自己的博客平台的。听起来很疯狂？有点，但也很有趣。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="a840" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">语境</h1><p id="d79d" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">我有一个<a class="ae my" href="https://showpy.tech/" rel="noopener ugc nofollow" target="_blank">博客</a>(就是你现在正在看的那个！)直到几天前，它还被托管在<a class="ae my" href="https://ghost.org/" rel="noopener ugc nofollow" target="_blank"> ghost.io </a>上。现在它托管在AWS中我自己的EC2实例上，使用<a class="ae my" href="https://aws.amazon.com/cloudfront/" rel="noopener ugc nofollow" target="_blank"> CloudFront </a>作为CDN。有些人会说这就像向苍蝇开炮，但事实是我已经有了这个实例，因为我正在使用的另一个工具就在那里。它是一个简单的工具，可以用更简单的CLI在云中存储代码片段，因为我真的很喜欢使用控制台。因此，除了CloudFront发行版(但这是小菜一碟)，整个设置都已就绪。</p><p id="8b75" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我只缺少了一部分——博客引擎——但我是一名程序员，所以决定编写自己的简单博客平台来满足我的需求，老实说，这非常简单。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="5981" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">我为什么要这么做？</h1><p id="b79a" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">嗯，这没什么好奇怪的，我有一个几乎死气沉沉的博客。自2017年10月以来，我没有写过任何新东西，但我仍然每月支付29美元的订阅费。这种情况时有发生——我没有时间，除了满足我的自我和努力成为一个技术博客和“有影响力的人”之外，我还在做更有趣的事情。但是我喜欢拥有一个博客的想法——我非常喜欢它，我每年为这个域名支付大约50美元，我认为这很棒。</p><p id="f410" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我决定一个博客平台时，我真的很喜欢用markdown标记写文章的想法。我真的很喜欢这种格式和它周围的环境——例如，使用Pandoc和LaTeX，你可以非常容易地从markdown生成PDF或epub文件，看起来非常专业。考虑到这一点，我决定复制这个功能，并向您描述我的平台是如何工作的。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="02e6" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">我的工作流程现在是什么样子</h1><p id="f24e" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">我是一名程序员——这意味着我主要做两件事:人和文本。我坐在我的IDE(集成开发环境)中，使用控制台，或者只是阅读文档，处理大量的文本。我肯定不是唯一的一个，但我只通过终端使用git我不断地拒绝所有围绕它构建的UI(要么它构建在你的IDE中，要么它是一个单独的应用)。</p><p id="aef9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于育儿博客来说，这可能是一个惊喜，但是我在PyCharm IDE中以markdown文件的形式写我的帖子(目前的这篇),我对此感到非常舒服。</p><p id="b52d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在左边有一个<code class="fe mz na nb nc b">content</code>目录，如下所示:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="f8e7" class="nh mc it nc b gy ni nj l nk nl">├── 2019<br/>│   └── 07<br/>│       └── 04<br/>│           └── how-i-saved-360-dollars-a-years-sorry-ghost.md</span></pre><p id="df38" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我需要手动创建上述文件，并将其放在正确的目录结构下(当前日期)。这是一项工作，但需要30秒钟。现在我已经把我的内容组织好了，而且可能更重要的是，我把它放在了存储库中，这意味着我不能丢失它。所有内容都属于我，不需要手动导入/导出/什么的。</p><p id="662b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面呈现的文件正是我现在使用markdown标记编写的文件。</p><p id="2789" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我完成的时候会发生什么？</p><p id="4a8c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我需要更新帖子<code class="fe mz na nb nc b">database</code>——这是一个简单的<a class="ae my" href="https://en.wikipedia.org/wiki/JSON" rel="noopener ugc nofollow" target="_blank"> JSON </a>文件。帖子的元数据将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="4c27" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="no">注意:这部分相当专业，所以如果你不感兴趣，可以跳过。</em></p><p id="0633" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以我使用git创建一个commit，稍后将它推送到主分支，并等待<a class="ae my" href="https://en.wikipedia.org/wiki/Continuous_integration" rel="noopener ugc nofollow" target="_blank"> CI </a> / <a class="ae my" href="https://en.wikipedia.org/wiki/Continuous_delivery" rel="noopener ugc nofollow" target="_blank"> CD </a>来完成这项工作。对于我的CI/CD，我使用的是<a class="ae my" href="https://bitbucket.org/product/features/pipelines" rel="noopener ugc nofollow" target="_blank">位桶管道</a>。每次我做了更改，新的docker映像就会建立起来。然后将它推送到docker容器注册中心(AWS中的私有注册中心— ECR)。稍后，自动化管道运行<a class="ae my" href="https://www.ansible.com/" rel="noopener ugc nofollow" target="_blank"> ansible </a>脚本，这些脚本负责更新博客的<code class="fe mz na nb nc b">production</code>版本，并使CloudFront缓存中的一些路径无效。</p><p id="cbe4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以，是的，你可以说这对于一个博客来说太多了，但是我只花了几个小时就把它整理好了，而且它工作起来很有魅力。当然，我需要改进一些东西，比如:</p><ul class=""><li id="f64a" class="np nq it la b lb lc le lf lh nr ll ns lp nt lt nu nv nw nx bi translated">资源缓存(图像和其他文件)</li><li id="2eaf" class="np nq it la b lb ny le nz lh oa ll ob lp oc lt nu nv nw nx bi translated">部署不是零停机，但考虑到CDN，几乎不可能获得502</li><li id="ee2a" class="np nq it la b lb ny le nz lh oa ll ob lp oc lt nu nv nw nx bi translated">可能需要改变一些自定义资源的处理方式和位置。</li></ul><p id="e6f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就像这个迷因:“这不多，但这是诚实的工作。”</p><p id="bf3e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">基本上就是这样。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="2cf2" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">技术堆栈和代码概述</h1><p id="4ded" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">技术堆栈是围绕Python构建的:</p><ul class=""><li id="5816" class="np nq it la b lb lc le lf lh nr ll ns lp nt lt nu nv nw nx bi translated">sanic  — OMG。使用<code class="fe mz na nb nc b">sanic</code>来服务静态文件——是的，为什么不呢:)</li><li id="de68" class="np nq it la b lb ny le nz lh oa ll ob lp oc lt nu nv nw nx bi translated"><a class="ae my" href="https://github.com/pallets/jinja" rel="noopener ugc nofollow" target="_blank"> jinja2 </a> —模板引擎，下面会详细介绍。</li><li id="b9de" class="np nq it la b lb ny le nz lh oa ll ob lp oc lt nu nv nw nx bi translated"><a class="ae my" href="https://github.com/Python-Markdown/markdown" rel="noopener ugc nofollow" target="_blank"> markdown </a> —将markdown转换为HTML的工具。</li></ul><p id="602c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那么，当写入完成时，markdown文件会发生什么情况呢？</p><p id="a1d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe mz na nb nc b">app.py</code>中，有一个处理程序来处理帖子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="2325" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如你所看到的——它将使用<code class="fe mz na nb nc b">post.html</code>作为基础，<code class="fe mz na nb nc b">jinja2</code>将内容帖子注入模板:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="e40f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">没错，就是整个<code class="fe mz na nb nc b">post</code> HTML模板。帖子是哪里来的？让我们看看<code class="fe mz na nb nc b">content_cache</code>的对象:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="a2cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mz na nb nc b">ContentCache</code>是一个简单的Python类，它将markdown文件转换成HTML后缓存在内存中。这没什么大不了的——因为现在它可能只有几十KB。也许以后我会对此进行优化。</p><p id="1dba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，我应该修复<code class="fe mz na nb nc b">NotFound</code>错误并返回正确的<code class="fe mz na nb nc b">HTTP</code>状态——但这对博客的运行并不重要，所以决定现在跳过这一步。</p><p id="7d9f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是博客平台背后的魔力！</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="6361" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">抱歉幽灵</h1><p id="4b94" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">你真的做得很好，我很高兴使用你的服务。不是你，是我。因为我的懒惰(两年来我一篇帖子都没写)——我已经白花钱了，最后气疯了，决定为此做点什么。</p><p id="1313" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，我确实意识到，当你是一名软件开发人员时，你可以为自己做很多服务，并削减订阅费用。嗯，接下来是什么？也许是网飞？；)</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="bb53" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">想用还是玩？</h1><p id="ddac" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">我在Github上创建了一个公共库——这是一个<a class="ae my" href="https://github.com/opalczynski/simple-blog-platform" rel="noopener ugc nofollow" target="_blank">平台样板</a>——如果你愿意，你可以使用它。</p><p id="52d2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你熟悉Python，一点HTML/CSS，和模板渲染(<code class="fe mz na nb nc b">jinja2</code>)，你应该可以直接使用它。</p><p id="39eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读。</p></div></div>    
</body>
</html>