<html>
<head>
<title>Unleashing Your Daemons: Creating Services on Ubuntu</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">释放你的守护进程:在Ubuntu上创建服务</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/unleashing-your-daemons-creating-services-on-ubuntu-731cd933e02e?source=collection_archive---------2-----------------------#2020-05-25">https://betterprogramming.pub/unleashing-your-daemons-creating-services-on-ubuntu-731cd933e02e?source=collection_archive---------2-----------------------#2020-05-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0f89" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这不是黑魔法，但也够接近了</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b336b0dcaa1b34f6a0984b8b1a4cdc6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fW-vLfBNw5DJs7DI"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">切斯特·韦德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="161e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最近，我联系了几家公司，询问他们今年夏天是否在招聘新的实习生。我还没有完成计算机科学学位，但是我想感受一下大学以外的真实世界。作为一项挑战，其中一家公司要求我构建并部署一个小型RESTful API。</p><p id="4458" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">构建API非常简单——没有什么是一个雄心勃勃的计算机系学生不能处理的。一旦我完成了对最终产品的润色，我就通过SFPT把我的API的源代码上传到我希望部署它的服务器上。然后我SSH说服务器并运行API，它工作了！但是我一退出服务器，API就停止了。在公司审查我的API之前，我无法一天24小时保持与服务器的SSH会话。我需要API在服务器上自主运行。</p><p id="378b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我需要释放一个精灵。</p><p id="5677" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然释放一个守护进程听起来很奇特和令人兴奋，但我很抱歉地告诉你，它实际上恰恰相反。我们在这里要对抗的守护进程(或服务)只是后台进程，它们自己运行，不需要用户的交互。然而，如果我说当我的API作为后台进程运行时，我感觉自己就像一个恶魔猎手，这并不夸张。</p><p id="bb9d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">玩笑归玩笑，如果你知道自己在做什么，创建一个守护进程是一件非常简单的事情。让我们开门见山吧！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="7c5d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">创建服务</h1><p id="1522" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">所有服务都位于<code class="fe mw mx my mz b">/etc/systemd/system</code>中，因为它们依赖于<code class="fe mw mx my mz b">systemd</code>提供的库来正常运行。为了创建一个服务，我们必须在那个目录中创建一个<code class="fe mw mx my mz b">.service</code>文件，可以用这个命令来完成:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="2c47" class="ne ma iq mz b gy nf ng l nh ni">$ sudo nano /etc/systemd/system/mydaemon.service</span></pre><p id="0f84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mw mx my mz b">mydaemon</code>应为您的守护进程的名称。现在让我们用下面的内容填充<code class="fe mw mx my mz b">.service</code>文件:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="fe78" class="ne ma iq mz b gy nf ng l nh ni">[Unit]</span><span id="a4c6" class="ne ma iq mz b gy nj ng l nh ni">Description=My first daemon!</span><span id="10b7" class="ne ma iq mz b gy nj ng l nh ni">[Service]</span><span id="78e2" class="ne ma iq mz b gy nj ng l nh ni">User=&lt;yourUser&gt;</span><span id="d1d2" class="ne ma iq mz b gy nj ng l nh ni">#Code to execute<br/>#Can be the path to an executable or code itself</span><span id="9fb0" class="ne ma iq mz b gy nj ng l nh ni">WorkingDirectory=/home/ubuntu/mydaemon</span><span id="06a8" class="ne ma iq mz b gy nj ng l nh ni">ExecStart=/home/ubuntu/mydaemon/executable</span><span id="e000" class="ne ma iq mz b gy nj ng l nh ni">Type=simple</span><span id="05b1" class="ne ma iq mz b gy nj ng l nh ni">TimeoutStopSec=10</span><span id="9d27" class="ne ma iq mz b gy nj ng l nh ni">Restart=on-failure</span><span id="e472" class="ne ma iq mz b gy nj ng l nh ni">RestartSec=5</span><span id="7828" class="ne ma iq mz b gy nj ng l nh ni">[Install]</span><span id="d084" class="ne ma iq mz b gy nj ng l nh ni">WantedBy=multi-user.target</span></pre><p id="c1a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不要忘记将<code class="fe mw mx my mz b">&lt;yourUser&gt;</code>改为您服务器上的实际用户！注意<code class="fe mw mx my mz b">WorkingDirectory</code>和<code class="fe mw mx my mz b">ExecStart</code>是如何指向同一个文件夹的。您的服务必须保持这种方式才能正确运行。目前，该目录不存在。让我们创造它！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="bba9" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">为服务创建Bash脚本</h1><p id="6b0d" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">首先，让我们为可执行文件创建一个目录。该目录应为<code class="fe mw mx my mz b">WorkingDirectory</code>中指定的目录:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="0b60" class="ne ma iq mz b gy nf ng l nh ni">$ mkdir mydaemon</span></pre><p id="e58f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在进入目录，让我们创建我们的可执行文件！</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="d926" class="ne ma iq mz b gy nf ng l nh ni">$ cd mydaemon<br/>$ sudo nano executable</span></pre><p id="17ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可执行文件必须包含以下标题:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="1a35" class="ne ma iq mz b gy nf ng l nh ni">#!/bin/sh</span></pre><p id="d2a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">否则，它不会作为bash脚本运行。在这个文件中，编写启动服务的指令。在我的例子中，当我部署一个Java应用程序时，我的可执行文件如下所示:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="8981" class="ne ma iq mz b gy nf ng l nh ni">#!/bin/sh<br/>java -jar myAppi.jar</span></pre><p id="5ec3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，给可执行文件正确的权限是非常重要的。文件的权限规定了谁可以读取、写入和执行该文件。由于服务是由操作系统在后台运行的，所以我们必须将读取和执行权限授予“其他用户”这可以通过以下命令完成:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="df50" class="ne ma iq mz b gy nf ng l nh ni">$ sudo chmod 005 executable</span></pre><p id="30fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在唯一剩下的就是召唤我们的精灵了！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="33c0" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">正在启动服务</h1><p id="638e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">与召唤一个真正的恶魔不同，这可以使用以下命令轻松完成:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="c188" class="ne ma iq mz b gy nf ng l nh ni">$ sudo systemctl daemon-reload</span><span id="ba2d" class="ne ma iq mz b gy nj ng l nh ni">$ sudo systemctl enable <!-- -->mydaemon</span><span id="3154" class="ne ma iq mz b gy nj ng l nh ni">$ sudo systemctl start  <!-- -->mydaemon</span></pre><p id="fb78" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样，您的服务应该可以正常运行了！您可以通过以下方式检查您的服务状态:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="7ed8" class="ne ma iq mz b gy nf ng l nh ni">$ sudo systemctl status <!-- -->mydaemon</span></pre><p id="d9b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您的服务有任何问题，您可以尝试使用服务日志进行调试，可以通过以下方式访问:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="d06a" class="ne ma iq mz b gy nf ng l nh ni">$ sudo journalctl --unit=mydaemon</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="3a7f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">最后的想法</h1><p id="32df" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">服务是在服务器上部署应用程序的关键，我希望本教程能够让您释放守护进程并成功部署应用程序。</p><p id="677a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">召唤快乐！</p><p id="ffbf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>