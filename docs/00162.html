<html>
<head>
<title>RESTful API Design — Step By Step Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RESTful API设计—逐步指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/restful-api-design-step-by-step-guide-2f2c9f9fcdbf?source=collection_archive---------0-----------------------#2018-07-23">https://betterprogramming.pub/restful-api-design-step-by-step-guide-2f2c9f9fcdbf?source=collection_archive---------0-----------------------#2018-07-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8c4c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建更好的API的(某种程度上)权威指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0d3c1a225e266c2392c236afc5ee4136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SEYbDEKtqgCpEr4D2IVrmw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马里乌斯·马萨拉尔在<a class="ae kv" href="https://unsplash.com/search/photos/connectivity?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="06a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为软件开发人员，我们大多数人在日常生活中使用或构建REST APIs。API是系统之间的默认通信方式。Amazon是API如何有效用于通信的最好例子。</p><p id="c741" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将讨论如何更好地设计RESTful APIs以避免常见错误。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="ea89" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">“杰夫·贝索斯”(成功的关键)任务</h1><p id="596f" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">你们中的一些人可能已经知道了<a class="ae kv" href="https://en.wikipedia.org/wiki/Jeff_Bezos" rel="noopener ugc nofollow" target="_blank">杰夫·贝索斯对亚马逊开发者的</a>命令。如果你从来没有机会听说过它，以下几点是它的症结所在。</p><ol class=""><li id="b777" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">所有团队将从此通过服务接口公开他们的数据和功能。</li><li id="af8d" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">团队必须通过这些接口相互交流。</li><li id="b6b6" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">不允许其他形式的进程间通信——不允许直接链接，不允许直接读取另一个团队的数据存储，不允许共享内存模型，不允许任何后门。唯一允许的通信是通过网络上的服务接口调用。</li><li id="aac2" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">他们用什么技术并不重要。HTTP、Corba、Pubsub、自定义协议——都没关系。贝佐斯不在乎。</li><li id="17b7" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">所有的服务接口，无一例外，都必须从头开始被设计成可外部化的。也就是说；团队必须计划和设计能够向外部世界的开发人员公开接口。没有例外。</li><li id="b93f" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">任何不这样做的人都会被解雇。</li></ol><p id="70a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最终，这被证明是亚马逊成功的关键。亚马逊可以构建可扩展的系统，以后也可以像亚马逊网络服务一样提供这些服务。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="b6bc" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">设计RESTful APIs的原则</h1><p id="1955" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在让我们理解设计RESTful APIs时应该遵循的原则。</p><h2 id="9178" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">保持简单</h2><p id="9bd2" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们需要确保API的基本URL是简单的。例如，如果我们想为产品设计API，它们应该设计成这样:</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="c3a3" class="nk ma iq nx b gy ob oc l od oe">/products<br/>/products/12345</span></pre><p id="b83b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一个API是获取所有产品，第二个是获取特定产品。</p><h2 id="594c" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">使用名词而不是动词</h2><p id="d174" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">很多开发人员都会犯这个错误。他们通常忘记了我们有HTTP方法来更好地描述API，并最终在API URLs中使用动词。例如，获取所有产品的API应该是:</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="23b5" class="nk ma iq nx b gy ob oc l od oe">/products</span></pre><p id="476c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并且如下图所示<em class="of">不是</em></p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="2173" class="nk ma iq nx b gy ob oc l od oe">/getAllProducts</span></pre><p id="0caa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目前为止我看到的一些常见的URL模式。</p><h2 id="f0e0" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">使用正确的HTTP方法</h2><p id="3cd6" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">RESTful APIs有各种方法来指示我们要用这个API执行的操作类型。</p><ul class=""><li id="3f05" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr og nc nd ne bi translated"><strong class="ky ir"> GET </strong> —获取一个资源或资源集合。</li><li id="0c24" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr og nc nd ne bi translated"><strong class="ky ir"> POST </strong> —创建资源或资源集合。</li><li id="ece2" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr og nc nd ne bi translated"><strong class="ky ir">上传/修补</strong> —更新现有资源或资源集合。</li><li id="7be6" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr og nc nd ne bi translated"><strong class="ky ir">删除</strong> —删除现有资源或资源集合。</li></ul><p id="8fe0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要确保对给定的操作使用正确的HTTP方法。</p><h2 id="233a" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">使用复数</h2><p id="915c" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这个话题有点值得商榷。有些人喜欢用复数名称保存资源URL，而有些人喜欢用单数名称。比如说—</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="fcce" class="nk ma iq nx b gy ob oc l od oe">/products</span><span id="6549" class="nk ma iq nx b gy oh oc l od oe">/product</span></pre><p id="a034" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我喜欢用复数形式，因为这样可以避免混淆我们是在讨论获取单个资源还是一个集合。它还避免了添加额外的东西，如将所有附加到基本URL，如<code class="fe oi oj ok nx b">/product/all</code></p><p id="c117" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有些人可能不喜欢这样，但我唯一的建议是在整个项目中保持统一。</p><h2 id="e119" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">使用参数</h2><p id="177d" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">有时我们需要一个API，它应该讲述更多的故事，而不仅仅是id。这里我们应该利用查询参数来设计API。</p><ul class=""><li id="1776" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr og nc nd ne bi translated"><code class="fe oi oj ok nx b">/products?name=’ABC’</code>应该优先于<code class="fe oi oj ok nx b">/getProductsByName</code></li><li id="9735" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr og nc nd ne bi translated"><code class="fe oi oj ok nx b">/products?type=’xyz’</code>应优先于<code class="fe oi oj ok nx b">/getProductsByType</code></li></ul><p id="53af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过这种方式，你可以在设计中简单地避免长URL。</p><h2 id="143c" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">使用正确的HTTP代码</h2><p id="324d" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们有大量的HTTP代码。我们大多数人最终只用了两个——200和500！这当然不是好的做法。以下是一些常用的HTTP代码。</p><ul class=""><li id="dc43" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr og nc nd ne bi translated"><strong class="ky ir"> 200 OK </strong> —这是最常用的HTTP代码，用于显示所执行的操作是成功的。</li><li id="1403" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr og nc nd ne bi translated"><strong class="ky ir"> 201 CREATED </strong> —这可以在使用POST方法创建新资源时使用。</li><li id="eea5" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr og nc nd ne bi translated"><strong class="ky ir"> 202已接受</strong> —这可用于确认发送到服务器的请求。</li><li id="13cf" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr og nc nd ne bi translated"><strong class="ky ir"> 400错误请求</strong> —这可以在客户端输入验证失败时使用。</li><li id="c1e6" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr og nc nd ne bi translated"><strong class="ky ir"> 401未授权/ 403禁止</strong> —如果用户或系统未被授权执行某项操作，可使用此选项。</li><li id="2d2f" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr og nc nd ne bi translated"><strong class="ky ir"> 404未找到</strong> —如果您正在寻找某个资源，而该资源在系统中不可用，则可以使用该选项。</li><li id="7b18" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr og nc nd ne bi translated"><strong class="ky ir"> 500内部服务器错误</strong> —这不应该被显式抛出，但如果系统出现故障，这种情况可能会发生。</li><li id="8ecb" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr og nc nd ne bi translated"><strong class="ky ir"> 502错误网关</strong> —如果服务器从上游服务器接收到无效响应，可以使用此选项。</li></ul><h2 id="73cb" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">版本控制</h2><p id="9e05" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">API的版本控制非常重要。许多不同的公司以不同的方式使用版本。有些使用版本作为日期，有些使用版本作为查询参数。我通常喜欢把它放在资源的前面。例如:</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="9702" class="nk ma iq nx b gy ob oc l od oe">/v1/products<br/>/v2/products</span></pre><p id="cccd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我也想避免使用<code class="fe oi oj ok nx b">/v1.2/products</code>，因为它意味着API会频繁地变化。还有，点(。)可能不容易在URL中看到。所以保持简单。</p><p id="1dd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保持向后兼容性总是一种好的做法，这样，如果您更改了API版本，消费者就有足够的时间转移到下一个版本。</p><h2 id="1088" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">使用分页</h2><p id="6d03" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">当您公开一个可能返回大量数据的API时，必须使用分页，如果没有进行适当的负载平衡，使用者最终可能会关闭服务。我们需要时刻记住，API的设计应该是完全可靠的。</p><p id="f0ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里推荐使用<code class="fe oi oj ok nx b">limit </code>和<code class="fe oi oj ok nx b">offset </code>。比如<code class="fe oi oj ok nx b">/products?limit=25&amp;offset=50</code>。还建议保留默认限制和默认偏移。</p><h2 id="5b74" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">支持的格式</h2><p id="e02a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">选择API的响应方式也很重要。大多数现代应用程序应该返回JSON响应，除非您有一个仍然需要获得XML响应的遗留应用程序。</p><h2 id="c694" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">使用适当的错误信息</h2><p id="2481" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">保留应用程序发送的一组错误消息并使用正确的id进行响应总是一种好的做法。例如，如果您使用脸书图形API，在出现错误的情况下，它会返回如下消息:</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="9511" class="nk ma iq nx b gy ob oc l od oe">{<br/>  "error": {<br/>    "message": "(#803) Some of the aliases you requested do not exist: products",<br/>    "type": "OAuthException",<br/>    "code": 803,<br/>    "fbtrace_id": "FOXX2AhLh80"<br/>  }<br/>}</span></pre><p id="c22c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我也见过一些例子，人们返回一个带有错误信息的URL，它告诉你关于错误信息的更多信息以及如何处理它。</p><h2 id="cf65" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">OpenAPI规范的使用</h2><p id="9f64" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了让你公司的所有团队都遵守某些原则，使用<a class="ae kv" href="https://swagger.io/resources/open-api/" rel="noopener ugc nofollow" target="_blank"> OpenAPI规范</a>会很有用。OpenAPI允许你首先设计你的API，并以一种更简单的方式与消费者分享。</p><h2 id="499f" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">结论</h2><p id="c793" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">很明显，如果你想更好地交流，API是必由之路。但是如果它们设计得很糟糕，那么可能会增加混乱。所以把你最大的努力投入到设计好，剩下的只是实现。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="af09" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">感谢您的阅读</h1><p id="59bd" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如果你遇到了更好的API设计方法，请在评论区分享。欢迎所有反馈！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="0c7d" class="nk ma iq nx b gy ob oc l od oe">Hey, if you enjoyed this story, check out <a class="ae kv" href="https://deshpandetanmay.medium.com/membership" rel="noopener">Medium Membership</a>! Just $5/month!</span><span id="f0ce" class="nk ma iq nx b gy oh oc l od oe"><em class="of">Your membership fee directly supports me and other writers you read. You’ll also get full access to every story on Medium.</em></span></pre></div></div>    
</body>
</html>