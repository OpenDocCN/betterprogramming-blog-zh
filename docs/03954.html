<html>
<head>
<title>How to Anonymize Node.js Applications Using Tor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Tor匿名化Node.js应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-anonymize-node-js-applications-using-tor-bc233356b163?source=collection_archive---------0-----------------------#2020-03-16">https://betterprogramming.pub/how-to-anonymize-node-js-applications-using-tor-bc233356b163?source=collection_archive---------0-----------------------#2020-03-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ab1b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">屏蔽Node.js代码中的HTTP请求</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/99129847d5bca0797baca0135f244106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FXShbuYGxdbWhzXno8383w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@folkcarlos" rel="noopener ugc nofollow" target="_blank">卡洛斯</a>在<a class="ae ky" href="https://unsplash.com/photos/q0_WOuphEKM" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9f3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像每个开发人员一样，我发现自己编写了许多脚本、机器人和cron作业，它们经常攻击某些服务器。有时候，我需要这些脚本出现在随机的远程位置。有时我想测试我的新bot保护的行为，或者从国外查看我的网站或应用程序，或者访问从我所在的国家无法访问的网站(我以前住在土耳其)，或者只是掩盖我在网上的身份。为了无缝可靠地实现这一点，我需要一个值得信赖的匿名VPN或代理。</p><p id="eff0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我建立了自己的VPN，对于我的一些用例来说，这是一个很好的解决方案。但是改变VPN的位置很复杂，它不是匿名的，并且当我不积极使用它时，它很昂贵。经过一些思考和研究，我意识到Tor对我的大多数用例来说是完美的。可靠，匿名，免费！</p><p id="2f71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将解释如何建立自己的代码来运行Tor并免费使用它的优势。我们先来了解一下Tor是什么。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="98db" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Tor是什么？</h1><p id="26bd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Tor，或以前被称为“洋葱路由器”，是一种在互联网上实现免费匿名通信的服务。它通过免费的、世界范围的、志愿者操作的中继来引导互联网流量，以掩盖请求的来源。Tor项目旨在帮助人们保护自己免受进行流量分析或网络监控的公司、政府或个人的攻击。</p><p id="bd13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们还开发了<a class="ae ky" href="https://www.torproject.org/download/" rel="noopener ugc nofollow" target="_blank"> Tor浏览器</a>来代替你日常使用的常用浏览器。例如，如果你担心像脸书和谷歌这样的公司如何监控你的一举一动，向你展示相关的广告，你可能想看看tor浏览器。它像任何其他互联网浏览器一样工作，增加了一些功能和选项来增加匿名性。它使用Tor的网络来隐藏你是谁以及你在网上做什么。这就是为什么它也是最受欢迎的访问互联网隐藏部分的方式，通常被称为<a class="ae ky" href="https://en.wikipedia.org/wiki/Deep_web" rel="noopener ugc nofollow" target="_blank">深层网络</a>。根据<a class="ae ky" href="https://metrics.torproject.org/userstats-relay-country.html" rel="noopener ugc nofollow" target="_blank"> Tor Metrics </a>，每天大约有两百万人使用Tor浏览器。</p><p id="403e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于Tor特别有趣的是，建立一个本地Tor代理，并通过它来引导我们所有的流量是多么容易。也是完全免费的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fa95" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置Tor代理</h1><p id="fce1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最稳定的方法是自己运行Tor代理，并通过它重定向Node.js请求。建立自己的代理听起来很复杂，但很容易。我将解释一种简单的方法和一种不那么简单的方法。两者都相对简单，所以请多包涵。</p><p id="904d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，当你像安装代理一样安装软件时，根据你运行的操作系统的不同，过程会有所不同。在Mac服务器上安装和配置与在Linux服务器上不同，所以两者都需要重复的工作。这就是我所说的<em class="mz">不那么容易的方式</em>，稍后会解释。现在，我们来解释一下跨平台的方式。</p><h2 id="5480" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">休闲小站</h2><p id="0883" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如上所述，简单的方法是使用<a class="ae ky" href="https://www.docker.com/get-started" rel="noopener ugc nofollow" target="_blank"> Docker </a>跨平台安装和配置Tor。Docker是一个容器化的解决方案，可以让你在一个类似虚拟机的环境中运行你的软件，使其免受外部干扰。它还允许您在托管环境中运行您的软件，这样您就可以可靠而轻松地跨平台运行它。</p><p id="f80b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您还没有Docker，请在此为您的操作系统<a class="ae ky" href="https://docs.docker.com/v17.09/engine/installation/" rel="noopener ugc nofollow" target="_blank">安装正确的社区版。安装并启动之后，我们将在机器上运行Docker版本的Tor代理。幸运的是，有人花时间在Docker容器中设置了它，并对它进行了开源。我们只需要运行他们发布的图像。在您喜欢的shell/终端上运行以下命令:</a></p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="a0d6" class="na md it nn b gy nr ns l nt nu">docker run -it -p 9050:9050 -d dperson/torproxy</span></pre><p id="4432" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个命令从公共Docker Hub下载<code class="fe nv nw nx nn b">dperson/torproxy</code>映像，并在您的Docker设置上本地运行它。它还在端口<code class="fe nv nw nx nn b">9050</code>上公开了这个代理，因此您可以通过这个端口将您的脚本连接到代理。</p><h2 id="a6c8" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">没那么容易</h2><p id="b694" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您已经在上一步中设置了Tor，您可以跳过这一步。我将解释如何在不使用Docker的情况下实现它。</p><p id="ddbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在不使用Docker的情况下设置Tor，我们需要手动安装。</p><h2 id="0e93" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">对于Ubuntu/Debian</h2><p id="2d54" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要在Ubuntu/Debian上安装Tor，我们需要更新<code class="fe nv nw nx nn b">apt</code>的源码列表，然后用<code class="fe nv nw nx nn b">apt</code>安装Tor。根据您使用的操作系统版本的不同，会有细微的差别。Tor Project已经有了一个文档，其中包含了基于您的操作系统运行所需的步骤和确切代码。与其在这里重复这些信息，我建议你在这里看一下<a class="ae ky" href="https://2019.www.torproject.org/docs/debian.html.en" rel="noopener ugc nofollow" target="_blank">他们的文档。</a></p><h2 id="169f" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">为了麦克·OSX</h2><p id="630d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">与Linux发行版相比，这对于OSX来说更容易。Mac有两个流行的包管理器，Homebrew和Macports。如果你还没有安装它们中的一个。如果你不知道该选哪个，我可以推荐家酿啤酒，因为我对它很满意:</p><ul class=""><li id="37f0" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated"><a class="ae ky" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">自制</a></li><li id="b66c" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><a class="ae ky" href="https://www.macports.org/install.php" rel="noopener ugc nofollow" target="_blank"> Macports </a></li></ul><p id="6209" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据您选择安装的软件包管理器，运行:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="9d8c" class="na md it nn b gy nr ns l nt nu">brew install tor</span></pre><p id="6d1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="1d68" class="na md it nn b gy nr ns l nt nu">sudo port install tor</span></pre><h2 id="fe0a" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated">无停靠站运行Tor</h2><p id="e835" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">幸运的是，这部分非常简单。只需运行:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="2faf" class="na md it nn b gy nr ns l nt nu">tor</span></pre><p id="2961" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，在后台运行它:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="7dcc" class="na md it nn b gy nr ns l nt nu">tor &amp;</span></pre><p id="0621" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个命令启动Tor代理，并通过端口<code class="fe nv nw nx nn b">9050</code>公开它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="33b2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">测试我们的Tor连接</h1><p id="133f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们已经有了自己的Tor入口点，让我们测试一下它是否做了我们想要它做的事情。一个简单的方法是通过Tor向一个网站发出HTTP请求，看看他们认为我们的IP地址是什么。您可以使用任何HTTP客户端，例如<code class="fe nv nw nx nn b">curl</code>、<code class="fe nv nw nx nn b">httpie</code>或<code class="fe nv nw nx nn b">wget</code>，并向任何“我的IP地址解决方案是什么”发出请求下面是我调用的一个示例命令和结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/69a1210ace93edab3bd013046c17cbfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*ia5G095jNeTiSqlGEj56dA.png"/></div></figure><p id="53c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(德国柏林)</p><p id="4c78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们使用本地Tor Socks5代理来处理相同的请求:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/a2f2f3b55819872a6ca9fa8bfe230536.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vKq8NiFtWsi9KocNLG63wQ.png"/></div></div></figure><p id="ef1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(法国鲁贝)</p><p id="5bcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ifconfig.me(或任何我通过Tor访问的网站)现在认为我在法国，即使我在德国。</p><p id="5e72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也可以选择你想出现的国家。只需向Docker命令提供带有ISO国家代码的<code class="fe nv nw nx nn b">-l</code>选项，Tor就应该使用该国家的出口节点。示例:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="6855" class="na md it nn b gy nr ns l nt nu">docker run -it -p 9050:9050 -d dperson/torproxy -l "US"</span></pre><p id="e5dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，由于其复杂的性质，Tor对于可靠的网飞或类似的流媒体体验来说可能太慢了。不鼓励将它用于这些目的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ec42" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将Node.js脚本连接到Tor</h1><p id="8e93" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">下一步是配置我们的代码，这样从Node.js代码生成的所有请求都将通过这个代理。大多数HTTP客户端允许您指定要使用的代理或HTTP代理。您可以在脚本中使用的一个流行的Socks代理是<a class="ae ky" href="https://www.npmjs.com/package/socks-proxy-agent" rel="noopener ugc nofollow" target="_blank"> socks-proxy-agent </a>。下面是一个使用Node内置HTTP客户端<code class="fe nv nw nx nn b">https</code>的实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="794f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是另一个示例实现，这次使用流行的JavaScript HTTP客户端库，<a class="ae ky" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e9e7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最后的话</h1><p id="ef9c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">恭喜——你的脚本变得更加难以追踪和识别了。明智地使用这种能力！</p><p id="c12f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请告诉我您对本文的看法，以及您的哪些应用程序可以从这种方法中受益。</p><h1 id="be46" class="mc md it bd me mf oq mh mi mj or ml mm jz os ka mo kc ot kd mq kf ou kg ms mt bi translated">资源</h1><ul class=""><li id="e652" class="ny nz it lb b lc mu lf mv li ov lm ow lq ox lu od oe of og bi translated">Tor Proxy Docker Image(T1)</li><li id="2df3" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">Tor 安装手册(T3)</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="c464" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://ozantunca.org" rel="noopener ugc nofollow" target="_blank">奥赞·通卡(Ozan Tunca)</a></p></div></div>    
</body>
</html>