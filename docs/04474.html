<html>
<head>
<title>API Development in Python With Flask-Restful and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Flask-Restful和MongoDB在Python中开发API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/api-development-in-python-with-flask-resful-and-mongodb-71e56a70b3a6?source=collection_archive---------8-----------------------#2020-04-15">https://betterprogramming.pub/api-development-in-python-with-flask-resful-and-mongodb-71e56a70b3a6?source=collection_archive---------8-----------------------#2020-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="27e3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Flask-Restful更好地构建Flask API开发</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/81aee8a09af0b3347dfa47b02d830e2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hja4Az4mq6lAFFXgboGzdQ.png"/></div></div></figure><h1 id="b91b" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">背景</h1><p id="e44f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">本文面向中级Python开发人员，或者具有任何语言的面向对象编程经验的人。如果你已经用Ruby、Java或PHP开发了一个web应用程序，并想学习Python，这也会给你一个很好的开端。</p><p id="8090" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">如果你是一个有一些基本Python的初学者，我会推荐你看看我以前的帖子:<a class="ae mn" href="https://medium.com/better-programming/api-development-with-flask-for-the-absolute-beginner-a2163b2bd8ca" rel="noopener">初学者用Flask进行API开发</a>。我假设您的机器上已经安装了Python，并且您有一些使用数据库和命令行的经验。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="e37b" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">技术</h1><p id="e58d" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">这是我们将在本教程中讨论的技术的重点。</p><blockquote class="na nb nc"><p id="d4cd" class="lm ln nd lo b lp mi ju lr ls mj jx lu ne mk lx ly nf ml mb mc ng mm mf mg mh im bi translated"><a class="ae mn" href="https://github.com/flask-restful/flask-restful/" rel="noopener ugc nofollow" target="_blank"> <strong class="lo iu"> Flask-RESTful </strong> </a>是Flask的扩展，增加了对快速构建REST APIs的支持。它是一个轻量级的抽象，可以和你现有的ORM/库一起工作。Flask-RESTful鼓励用最少的设置实现最佳实践。如果你熟悉Flask，Flask-RESTful应该很容易上手。— <a class="ae mn" href="https://flask-restful.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">烧瓶-RESTful </a></p><p id="f72a" class="lm ln nd lo b lp mi ju lr ls mj jx lu ne mk lx ly nf ml mb mc ng mm mf mg mh im bi translated">MongoDB是一个通用的、基于文档的分布式数据库，为现代应用程序开发人员和云时代而构建。没有数据库能让你更有效率。— <a class="ae mn" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a></p><p id="4fba" class="lm ln nd lo b lp mi ju lr ls mj jx lu ne mk lx ly nf ml mb mc ng mm mf mg mh im bi translated">NoSQL数据库提供了一种存储和检索数据的机制，这种数据的建模方式不同于关系数据库中使用的表格关系。这种数据库自20世纪60年代末就已经存在，但“NoSQL”这个名字只是在21ˢᵗ世纪早期由Web 2.0公司的需求引发的。— <a class="ae mn" href="https://en.wikipedia.org/wiki/NoSQL" rel="noopener ugc nofollow" target="_blank">维基百科</a></p><p id="c698" class="lm ln nd lo b lp mi ju lr ls mj jx lu ne mk lx ly nf ml mb mc ng mm mf mg mh im bi translated">MongoEngine是一个对象文档映射器，用Python编写，用于MongoDB。要安装它，只需运行— <a class="ae mn" href="http://docs.mongoengine.org/index.html" rel="noopener ugc nofollow" target="_blank"> MongoEngine </a></p></blockquote></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="bf1c" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">设置</h1><p id="131c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在继续之前，请确保您的机器上安装了<a class="ae mn" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python和</a>，并且安装了<a class="ae mn" href="https://www.mongodb.com/download-center/community" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>。用大约15秒的谷歌搜索，你应该能够让他们安装在你的电脑上，因为在网上有很多资源可以做到这一点。</p><p id="1189" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我将使用<a class="ae mn" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank"> Visual Studio Code </a>作为我的开发编辑器，你可以使用任何你想要的IDE，尽管我推荐VS Code，因为它是免费的和跨平台的，有很多针对所有主流编程语言的扩展。</p><p id="2caf" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们还将为人类使用Pipenv: Python开发工作流。这将使我们更容易管理Python的依赖性，并为我们的项目创建一个独立的开发环境。</p><blockquote class="na nb nc"><p id="5916" class="lm ln nd lo b lp mi ju lr ls mj jx lu ne mk lx ly nf ml mb mc ng mm mf mg mh im bi translated"><a class="ae mn" href="https://pipenv-fork.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> <strong class="lo iu"> Pipenv </strong> </a>是一款工具，旨在将所有包装领域的精华(bundler、composer、npm、cargo、yarn等。)到Python世界。<em class="it"> Windows是我们这个世界的一等公民。</em></p></blockquote></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="ad5b" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">我们正在建造的东西</h1><p id="ad9a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在本教程的其余部分，我们将为AA汽车公司开发API服务来管理其车队。从您的控制台中，运行以下命令。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="2f84" class="nm kv it ni b gy nn no l np nq">mkdir aa-api<br/>cd aa-api<br/>touch app.py</span></pre><p id="db08" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">然后安装管道。之后，我们将安装烧瓶。<code class="fe nr ns nt ni b">pipenv install flask</code>这将创建一个虚拟环境并安装Flask。它将为我们生成两个文件，<code class="fe nr ns nt ni b">Pipfile</code>和<code class="fe nr ns nt ni b">Pipfile.lock</code>。如果你有一些Node.js的经验，这类似于一个<code class="fe nr ns nt ni b">Package.json</code>文件或Ruby Gemfile。</p><p id="b488" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">要激活Pipenv创建的虚拟环境，运行<code class="fe nr ns nt ni b">pipenv shell</code>:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="bfec" class="nm kv it ni b gy nn no l np nq">➜  aa-api pipenv shell <br/>Launching subshell in virtual environment…<br/> . /Users/peterayeni/.local/share/virtualenvs/aa-api-9L89IsJh/bin/activate<br/>➜  aa-api  . /Users/peterayeni/.local/share/virtualenvs/aa-api-9L89IsJh/bin/activate<br/>(aa-api) ➜  aa-api</span></pre><p id="0c2e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">要安装Flask-Restful，请运行:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="2e9a" class="nm kv it ni b gy nn no l np nq">pipenv install flask-restful</span></pre><p id="c283" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">要安装MongoEngine:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="4493" class="nm kv it ni b gy nn no l np nq">pipenv install flask-mongoengine</span></pre><p id="0380" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在根目录中，创建一个名为database的新目录以及两个名为db.py和model.py的文件:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="4716" class="nm kv it ni b gy nn no l np nq">mkdir database<br/>touch database/db.py<br/>touch database/model.py</span></pre><p id="49ca" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">您的目录现在应该是这样的:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="94a1" class="nm kv it ni b gy nn no l np nq">aa-api<br/>│   app.py<br/>|   Pipfile<br/>|   Pipfile.lock   <br/>└───database<br/>    │   db.py<br/>    └───models.py</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/4b362fc047bc6bd8c94ba6ff1bc71730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oJasYk0MylZg7TFuA3PWAg.png"/></div></div></figure><p id="e817" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">上面是我们的app.py，在这里我们初始化了我们的应用程序，并使用我们从<code class="fe nr ns nt ni b">database.db</code>导入的MongoEngine配置了一个MongoDB连接，我们接下来将创建它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/4c02bf4d78c061e7be6ec59d18272cef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5AC9BF7tf-PVwm-WvsTaZg.png"/></div></div></figure><p id="64e5" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">用MongoEngine实例化一个MongoDb数据库就是这么简单。接下来，我们将创建我们的数据模型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/c14635b8a495a2a0189036d68bce13b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ep7MkODcy6U1O75N1Jd5A.png"/></div></div></figure><p id="193a" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">MongoEngine使用Python类来建模我们的数据。<code class="fe nr ns nt ni b">db.StringField</code>用于设置文本数据类型，我们也可以提供为我们的数据类型设置某些属性的参数，比如<code class="fe nr ns nt ni b">required</code>和<code class="fe nr ns nt ni b">unique</code> MongoEngine，它们是很好的文档，您可以查看它们以了解更多信息。</p><h2 id="a04e" class="nm kv it bd kw nx ny dn la nz oa dp le lv ob oc lg lz od oe li md of og lk oh bi translated">端点</h2><p id="d563" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们将从创建一个端点开始，获取数据库中的所有总线，并添加一条新总线。让我们创建一个名为resources的新文件夹，并在其中创建两个文件<code class="fe nr ns nt ni b">bus.py</code>和<code class="fe nr ns nt ni b">routes.py</code>,此时我们的文件夹结构将是这样的。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="914f" class="nm kv it ni b gy nn no l np nq">aa-api<br/>│   app.py<br/>|   Pipfile<br/>|   Pipfile.lock   <br/>└───database<br/>    │   db.py<br/>    └───models.py<br/>└───resources<br/>    │   bus.py<br/>    └───routes.py</span></pre><p id="1d16" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">通过这种方式，我们可以按照特性来组织我们的API，并且当我们添加额外的资源(比如trip)时，很容易扩展我们的API并最好地管理我们的代码。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="49bf" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">获取所有总线并添加一条新总线</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/4c46fe6bf2d99632067630e0bd6ee85e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bBIQUnMR7X931DIW9oL4aw.png"/></div></div></figure><p id="8b8f" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在上面的代码中，我们从flask_restful导入数据库和资源。创建一个资源就像创建一个Python类一样简单，每个方法都是我们想要创建的资源的HTTP请求方法。代码的大部分是不言自明的。获取数据库中的所有总线并将其转换为JSON，然后我们将其存储在一个名为bus的变量中，并使用Flask的响应方法将其返回给用户；将它的“mimetype”设置为“application/json”，并将状态代码设置为200。</p><p id="aa87" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">post方法通过从请求体获取新的总线数据来创建新的总线，然后我们将它传递给<code class="fe nr ns nt ni b">Bus(**body)</code>，然后保存到数据库。<code class="fe nr ns nt ni b">**body</code>是一个扩展操作符，类似于JavasScript扩展操作符。然后我们返回新添加的总线的id。</p><p id="3075" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">是时候测试我们的API了，运行<code class="fe nr ns nt ni b">pipenv shell</code>来激活我们的虚拟环境，然后运行<code class="fe nr ns nt ni b">python app.py</code>:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="e23e" class="nm kv it ni b gy nn no l np nq">(aa-api) ➜  aa-api git:(resource) ✗ python app.py<br/> * Serving Flask app "app" (lazy loading)<br/> * Environment: production<br/>   WARNING: This is a development server. Do not use it in a production deployment.<br/>   Use a production WSGI server instead.<br/> * Debug mode: off<br/> * Running on <a class="ae mn" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000/</a> (Press CTRL+C to quit)</span></pre><p id="af9e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">测试你的API的最好方法是使用<a class="ae mn" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="b924" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">更新、删除和获取单个总线</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/820d368347a42dea4d45e6432def880b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0wb--8cyxG4YlIZ6U0GvoA.png"/></div></div></figure><p id="4d9a" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">从上面，你会看到我们使用了一个叫做<code class="fe nr ns nt ni b">BusApi</code>的新类。这有助于关注点的分离；您将会注意到，这些HTTP请求方法中的每一个都需要获取总线的ID来完成它们的任务；这让我们能够以巧妙的方式组织路线。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/423a133c64049deb0c59fa083bf05936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mRbwPQkDk2Url76sL7LNnQ.png"/></div></div></figure><p id="8e60" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">您可以看到，通过这种方式，我们能够为我们的端点创建一个清晰的路由。请在此找到完整的代码<a class="ae mn" href="https://github.com/peterayeniofficial/flask-bus-api" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="dd8a" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">尾注</h1><p id="9835" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">本文的要点是如何使用Flast-Restful和实现MongoDB引擎在Flask中最好地构建API代码，使使用MongoDB成为一种乐趣。我们的API还远远没有完成；还有很大的提升空间。比如错误处理、认证、文档和测试。我将在以后的文章中逐一介绍这些内容。</p><p id="d4b1" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">直到那时候:)快乐编码。</p></div></div>    
</body>
</html>