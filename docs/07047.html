<html>
<head>
<title>How to Avoid Locking Yourself Out of Linux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何避免将自己锁在Linux之外</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/avoid-locking-yourself-out-on-linux-6128a786ebfa?source=collection_archive---------11-----------------------#2020-12-01">https://betterprogramming.pub/avoid-locking-yourself-out-on-linux-6128a786ebfa?source=collection_archive---------11-----------------------#2020-12-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="be17" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">编写bash脚本来自动化用户帐户管理</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a3b573cdb12d2aaebe5e4b80be27c2f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*G2SJdR36QswpyCSQ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">迈克尔·泽兹奇在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><blockquote class="kz"><p id="a5d1" class="la lb it bd lc ld le lf lg lh li lj dk translated">“我将自己锁定在虚拟机之外，无法访问它！”</p></blockquote><p id="cb31" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf lj im bi translated">这是有可能发生的。每个开发人员一生中至少会遇到一次这种情况。</p><p id="cd9d" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">让我们找到一种方法，避免因为被锁定而不得不重新开始设置，或者清除整个虚拟机。</p><p id="1711" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">使用虚拟化时，通常需要手动管理用户和帐户，但这不是很有效。让我们编写一个bash脚本来处理新用户的身份验证。</p><p id="f3fe" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">我们首先使用hashbang <code class="fe ml mm mn mo b">!#</code>将脚本初始化为一个文件，可以被我们机器上的Bash访问。</p><p id="f6a6" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">这个hashbang将使用一个运行程序<code class="fe ml mm mn mo b">/bin/sh</code>或<code class="fe ml mm mn mo b">/bin/bash</code>的指令来设置程序加载器，然后将<code class="fe ml mm mn mo b">/path/to/script</code>作为第一个参数传递。</p><p id="7c09" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">让我们在自己的脚本中使用以下内容。</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="623b" class="mt mu it mo b gy mv mw l mx my">#!/<!-- -->env/bin/bash</span></pre><p id="8334" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">这将位于我们需要创建的文件<code class="fe ml mm mn mo b">filename.sh</code>的顶部。</p><p id="a444" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">接下来，我们将编写一个小bash语句来处理我们的身份验证——就像champ一样！</p><p id="fa81" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">它将只允许具有来自<code class="fe ml mm mn mo b">Sudo Group</code>的许可的<code class="fe ml mm mn mo b">Users</code>使用完全相同的访问级别来制作额外的<code class="fe ml mm mn mo b">Users </code>。这将赋予新用户<code class="fe ml mm mn mo b">Sudo</code>权限。</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="a289" class="mt mu it mo b gy mv mw l mx my"># CHECK SUDO USER GROUP ASSOCIATION <br/>if ! [ $(id -u) = 0 ]; then<br/>   echo "I am not root! You cannot give sudo power to a new user!"<br/>   exit 1<br/>else<br/> echo "You have granted Sudo powers to a New user"<br/> sudo adduser developer<br/> sudo usermod -aG sudo developer<br/> su - developer<br/>fi</span></pre><p id="802b" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">因此，我们现在允许当前用户添加一个名为<code class="fe ml mm mn mo b">Developer</code>的新用户。</p><p id="6ee0" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">只有当这个Bash脚本直接在机器上运行时，我们才会看到这些影响。</p><p id="3a0b" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated"><em class="mz">由于这个脚本是专门为拥有Sudo权限的用户编写的，除非你使用拥有root权限的</em> <code class="fe ml mm mn mo b"><em class="mz">sudo sh ./filename.sh</em></code> <em class="mz">，否则你将无法正确运行它。让我们用Sudo运行一下，试一试。</em></p><p id="cff3" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">将这个新用户添加到系统的引导加载程序后，系统会询问您几个问题来验证他们的权限:</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="666a" class="mt mu it mo b gy mv mw l mx my">Enter the new value, or press ENTER for the default</span><span id="000f" class="mt mu it mo b gy na mw l mx my">Full Name []: </span><span id="50bf" class="mt mu it mo b gy na mw l mx my">Room Number []: </span><span id="c060" class="mt mu it mo b gy na mw l mx my">Work Phone []:</span><span id="3a0f" class="mt mu it mo b gy na mw l mx my">Home Phone []:</span><span id="6106" class="mt mu it mo b gy na mw l mx my">Other []:</span></pre><p id="f654" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">这些问题可以通过命令行提示符/终端输入，供您参考。</p><p id="1dae" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">建议保存这些信息以供您自己记录，但也可以使用回车键继续跳过此步骤。</p><p id="80a5" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">填写完这些值后，您会看到一个选项，让您选择是否将这些更改导入到系统的引导程序中。</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="2e56" class="mt mu it mo b gy mv mw l mx my">Is the information correct? [Y/n] </span></pre><p id="b2d0" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">键入<code class="fe ml mm mn mo b">Y</code>并点击<code class="fe ml mm mn mo b">Enter</code>继续完成新用户帐户。</p><p id="aa55" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">正如您在bash脚本中看到的，我们在这个新用户帐户上调用了<code class="fe ml mm mn mo b">Usermod</code>。这是因为我们需要给新创建的帐户<code class="fe ml mm mn mo b">Sudo</code>权限。如果您不希望用户拥有<code class="fe ml mm mn mo b">Sudo</code>权限，您可以省略这个命令或者在脚本中修改这一行。</p><p id="559c" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">然后，脚本应该通过<code class="fe ml mm mn mo b"><em class="mz">su</em></code> <em class="mz">将新的用户帐户交给您的bash会话。</em></p><p id="8779" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">SU命令允许您将当前运行的用户切换到同一会话中的另一个用户。<em class="mz">注意:必须提供密码，以便快速切换到不同的用户。如果不输入密码，用户会话将返回到当前用户，并且不会切换。</em></p><p id="c557" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">也就是说，您已经成功运行了一个可以为您创建用户的脚本。它还可以防止您将自己锁在外面，因为在没有启用Sudo权限的情况下，您无法成功地更改自己的用户权限或改变其他用户的状态。</p><p id="181c" class="pw-post-body-paragraph ll lm it ln b lo mg ju lq lr mh jx lt lu mi lw lx ly mj ma mb mc mk me mf lj im bi translated">编码快乐！</p></div></div>    
</body>
</html>