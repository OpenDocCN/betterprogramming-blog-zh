<html>
<head>
<title>What Is Data Gravity And Is It Important With Serverless?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是数据重力，它对无服务器是否重要？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/what-is-data-gravity-and-is-it-important-with-serverless-d75f3f44f6d2?source=collection_archive---------7-----------------------#2022-07-20">https://betterprogramming.pub/what-is-data-gravity-and-is-it-important-with-serverless-d75f3f44f6d2?source=collection_archive---------7-----------------------#2022-07-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a30d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">当谈到供应商锁定时，人们很少谈到数据重力。去无服务器需要考虑吗？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e5ad1b25f7c510cdb25121de1e584487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SeBnBU7MjRYT84N2.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">美国宇航局在<a class="ae ky" href="https://unsplash.com/s/photos/gravity?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="41a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几年前当我开始使用无服务器时，你很少会不听到“<em class="lv">供应商锁定</em>”这样的话。</p><p id="1d2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于那些很幸运以前没有听过这句话的人来说，这意味着通过承诺使用特定的供应商，你将自己与他们捆绑在一起。意思是你不能和他们分开，即使你想分开(或者很难分开)。</p><p id="73ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然无服务器本身并没有错，但这真的重要吗？我们曾经调用供应商锁定<em class="lv">来做出决定</em>。您选择一个供应商，使用他们的特性集，然后构建您的软件。</p><p id="893a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但这让一些人感到不快，这没什么。然而，在选择云供应商来托管和构建您的软件时，您必须做出决定。有些人不遗余力地构建“独立于供应商”的解决方案，他们可以在周一从AWS获取代码，并在周二在Azure中运行。</p><p id="825d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">做这件事的人值得称赞。这增加了解决方案的复杂性，但他们增加了在服务提供商之间移动代码的能力，以防出现可怕的错误(无论是从灾难恢复的角度还是从价格上涨的角度)。</p><p id="9a13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">还是他们有？</em></p><p id="d400" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然代码可能会移动，但是您的所有数据呢？这将如何在供应商之间转移？你不能重新开始，你会失去所有的顾客。它需要和你的代码一起移动。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2b99" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">数据引力到底是什么？</h1><p id="6bb9" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">随着应用程序中存储量的增加，移动的能力变得越来越困难。这类似于<em class="lv">引力</em>，其中<a class="ae ky" href="https://coolcosmos.ipac.caltech.edu/ask/300-What-is-gravity-#:~:text=The%20more%20massive%20an%20object%20is%2C%20the%20stronger%20its%20gravitational%20pull%20is" rel="noopener ugc nofollow" target="_blank">体积越大，引力</a>越强。因此得名<strong class="lb iu">数据引力</strong>。</p><p id="df1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">据估计，<a class="ae ky" href="https://earthweb.com/how-much-data-is-created-every-day/" rel="noopener ugc nofollow" target="_blank">每天会产生250万兆兆兆字节的数据</a>。如今，数据就是一切。世界范围内的数据量之大令人震惊。您可能也会对应用程序中的数据量感到惊讶。</p><p id="9d8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在无服务器应用程序中，数据重力来自几个不同的方面:</p><p id="5304" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">数据库记录</strong>——也许是最明显的数据重力来源，无论是<a class="ae ky" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank"> DynamoDB </a>还是<a class="ae ky" href="https://aws.amazon.com/rds/aurora/" rel="noopener ugc nofollow" target="_blank"> Aurora </a>，这些记录都会随着应用程序中的交互而积累。当您的消费者使用您的API时，数据的重要性会随着记录的保存而增加。</p><p id="5771" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">文档存储</strong> —借助AWS，<a class="ae ky" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> S3 </a>是一项保存从分析数据、视频和图片到存档数据等一切内容的服务。它甚至允许你用它来托管你的网站。随着时间的推移，S3中的对象数量可以增长到Pb、EB或更高的规模，从而导致严重的数据重力。</p><p id="9094" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">日志</strong> —默认情况下，您的日志存储在AWS的<a class="ae ky" href="https://aws.amazon.com/cloudwatch/" rel="noopener ugc nofollow" target="_blank"> CloudWatch </a>中。跨Lambda函数、Step函数工作流和API网关的所有执行、错误和调试日志都整合在一个位置。对于无服务器应用，日志是成功监控和故障排除的关键。随着应用程序的运行，您的日志将会增长，从而产生另一个数据重力源。</p><p id="19d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">事件</strong>——根据<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/7-aws-serverless-design-principles-for-solutions-architects-2be22717713b">无服务器设计原则</a>，您应该构建您的应用程序来触发来自事件的事务。事件有很多来源，比如<a class="ae ky" href="https://aws.amazon.com/sns" rel="noopener ugc nofollow" target="_blank"> SNS </a>、<a class="ae ky" href="https://aws.amazon.com/sqs" rel="noopener ugc nofollow" target="_blank"> SQS </a>和<a class="ae ky" href="https://aws.amazon.com/eventbridge" rel="noopener ugc nofollow" target="_blank"> EventBridge </a>。在一个<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/3-ways-to-retry-failures-in-your-serverless-application-84b5102f620">容错应用</a>中，您应该存储事件，以便在恢复场景中重放它们。像EventBridge这样的服务有一个<a class="ae ky" href="https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-archive-event.html" rel="noopener ugc nofollow" target="_blank">事件存档</a>来做这件事。这产生了您必须考虑的另一个数据重力来源。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="528e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">最小化数据重力的影响范围</h1><p id="486c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如您所见，数据引力在无服务器应用程序中有相当大的影响。关键数据积累在如此多的地方，以至于你觉得不可能从应用程序的所有角落获取数据。</p><p id="72bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在实际打包和更换供应商的情况下最大限度地减少工作量，从<em class="lv">在尽可能少的位置整合数据开始</em>。为此，您可以将内容聚合到S3存储桶中，或者将附加数据存储到数据库中。</p><p id="9c7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于原木，你可以很容易的<a class="ae ky" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/S3ExportTasks.html" rel="noopener ugc nofollow" target="_blank">直接出口到S3 </a>。由于您通常不想永远保留日志，您可以通过在存储桶或单个项目上设置<a class="ae ky" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/how-to-set-lifecycle-configuration-intro.html" rel="noopener ugc nofollow" target="_blank">存储生命周期</a>来自动归档或删除它们。</p><p id="dcee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事情并不像整固那样直截了当。在整合EventBridge之外的某个位置的事件时，您需要亲自动手。备份事件的一个解决方案是配置一个通用规则来捕获所有事件，将它们传递给Lambda函数，并让该函数将事件的内容写入DynamoDB。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="dce1" class="nf me it nb b gy ng nh l ni nj">BackupEventBridgeEventsFunction: <br/>  Type: AWS::Serverless::Function <br/>  Properties: <br/>    CodeUri: functions/backup-eventbridge-events <br/>    Policies: <br/>      - AWSLambdaBasicExecutionRole <br/>      - Version: 2012-10-17 <br/>        Statement: <br/>          - Effect: Allow <br/>            Action: <br/>              - dynamodb:PutItem <br/>            Resource: !GetAtt EventBackupTable.Arn <br/>    Events: <br/>      EventFired: <br/>        Type: EventBridgeRule <br/>        Properties: <br/>          Pattern: <br/>            account: <br/>              - !Ref AWS::AccountId</span></pre><p id="55d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将匹配源自您的AWS帐户的所有事件，并将它们发送到<code class="fe nk nl nm nb b">BackupEventBridgeEvents</code>函数，然后该函数可以将内容以按时间顺序排序的方式写入Dynamo。</p><p id="460f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过将日志备份到S3，将事件备份到Dynamo，现在在迁移重要数据时，您只需要考虑两个位置。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4df8" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">值得吗？</h1><p id="4deb" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">因为您已经在实践无服务器，所以您已经被您的云供应商锁定了。在灾难发生时，你能够及时成功转换供应商的机会非常小。这就可以了！</p><p id="3b96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你“全押”在像AWS这样的供应商身上时，你得到的一个主要好处是所有的服务都可以很容易地相互集成。您最大限度地发挥了工具的潜力，因为您没有创建变通方法来避免被锁定。</p><p id="f1f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这导致<em class="lv">更快的构建时间，更多的创新，以及最终更低的云成本</em>。按照预期的方式使用服务，您将构建出最好的应用程序。</p><p id="28ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，我会说“不，不值得”去实施一个<em class="lv">拿起就跑</em>的策略。现在，如果您遇到真正的灾难，备份您的日志和事件可能会很有用。您需要重放系统中发生的事件，以便可以重建数据并达到您的RPO。</p><p id="6fcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但在我看来，因为不信任云供应商而实施替代措施是不值得花时间的。</p><p id="8f6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于独立于供应商的纯粹主义者来说，永远不会出现这样的场景:您真的没有工作可以转移到其他地方。如果您决定在EC2实例中托管您自己的数据库，您仍然需要将它转移到其他地方。<a class="ae ky" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-volumes.html" rel="noopener ugc nofollow" target="_blank"> EBS卷</a>是特定于AWS的供应商。你不能原封不动地拿起这个卷，然后就在Azure中开始使用它。您需要某种备份/转换/恢复流程来成功迁移数据。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="fb44" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="8553" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">数据引力是真实存在的。随着时间的推移，你积累的数据越多，就越难转移到其他地方。可以是您的云供应商，也可以是提供实用服务的第三方供应商。</p><blockquote class="nn"><p id="db56" class="no np it bd nq nr ns nt nu nv nw lu dk translated"><em class="nx">一件东西用的时间越长，就越难离开。</em></p></blockquote><p id="3986" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">但这是一个好问题。您的开发人员将与云供应商建立专业知识。转移到不同的提供商将迫使你的工程师重新学习事情如何运作的细微差别，这有其自身的成本。</p><p id="d642" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我发现最大的成功来自全力以赴。完全致力于你的解决方案。动摇和怀疑会给你的解决方案带来不稳定性。将你的整个应用构建成一个巨大的提供者模型会增加维护的复杂性和难度。</p><p id="2ab7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，数据重力是无服务器应用的一个问题吗？<em class="lv">不为那些做得对的人</em>。</p><p id="e728" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p></div></div>    
</body>
</html>