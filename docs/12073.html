<html>
<head>
<title>The 4 Clean Code Principles in Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django的4项廉洁守则原则</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/clean-code-principles-in-django-b0563a4e12f5?source=collection_archive---------0-----------------------#2022-05-10">https://betterprogramming.pub/clean-code-principles-in-django-b0563a4e12f5?source=collection_archive---------0-----------------------#2022-05-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cf5b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Django中清理(您的)代码</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4f344d29d14e1350fa409912ad8d8df0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BGPvvDjJXFdFyG3G"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@jeshoots?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">JESHOOTS.COM</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><blockquote class="kw kx ky"><p id="81cc" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><em class="iq">这篇文章是为了CSUI的软件工程项目课程2022的个人评论而写的。</em></p></blockquote></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="c7b6" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">介绍</h1><p id="9424" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">打扫卫生可能不是你最喜欢的消遣活动，当然也不是我的。不管是打扫你的房间还是清理你的代码，这可能都不是一个好时机。但是他们两个有一个共同点。这很重要。</p><h1 id="95d7" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">内容</h1><ol class=""><li id="1dc9" class="ni nj iq lc b ld mv lg mw mx nk mz nl nb nm lv nn no np nq bi translated"><a class="ae kv" href="https://medium.com/@rico098098/clean-code-principles-in-django-b0563a4e12f5#810d" rel="noopener">干净代码的一些原则</a></li><li id="91f3" class="ni nj iq lc b ld nr lg ns mx nt mz nu nb nv lv nn no np nq bi translated"><a class="ae kv" href="https://medium.com/@rico098098/clean-code-principles-in-django-b0563a4e12f5#7ed5" rel="noopener">姜戈之吻</a></li><li id="5032" class="ni nj iq lc b ld nr lg ns mx nt mz nu nb nv lv nn no np nq bi translated"><a class="ae kv" href="https://medium.com/@rico098098/clean-code-principles-in-django-b0563a4e12f5#f190" rel="noopener">干在姜戈</a></li><li id="2c22" class="ni nj iq lc b ld nr lg ns mx nt mz nu nb nv lv nn no np nq bi translated"><a class="ae kv" href="https://medium.com/@rico098098/clean-code-principles-in-django-b0563a4e12f5#c86c" rel="noopener">姜戈的YAGNI</a></li></ol><h1 id="810d" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">1.干净代码的一些原则</h1><p id="ab82" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">正如你可能已经知道的，干净的代码与计算机或编译器无关，它与人类有关。对于计算机来说，只要语法正确，逻辑正确，你怎么写代码一点都不重要。但人类不是计算机。你的同事和其他程序员不一定能读懂你的代码，尤其是如果你没有写出干净的代码。</p><p id="78cf" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">一些最著名的干净代码原则是:</p><ol class=""><li id="e468" class="ni nj iq lc b ld le lg lh mx nw mz nx nb ny lv nn no np nq bi translated">亲吻(保持简单和愚蠢)</li><li id="2d81" class="ni nj iq lc b ld nr lg ns mx nt mz nu nb nv lv nn no np nq bi translated">干(不重复)</li><li id="298a" class="ni nj iq lc b ld nr lg ns mx nt mz nu nb nv lv nn no np nq bi translated">YAGNI(你不会需要它)</li></ol><p id="16e5" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">在接下来的部分中，我将尝试在Django中展示这些原则的例子。</p><h1 id="7ed5" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">2.姜戈之吻</h1><p id="644b" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">KISS(保持简单(和)愚蠢)基本上是告诉你保持你的代码简短，简单，并且容易被其他人阅读。</p><h2 id="bea3" class="nz me iq bd mf oa ob dn mj oc od dp mn mx oe of mp mz og oh mr nb oi oj mt ok bi translated">使用Django表单、序列化器、权限和装饰器，而不是手工替代</h2><p id="678b" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">当学习Django时，你可能已经学习了Django格式、序列化器和许多其他东西，就像我很久以前做的那样。</p><p id="425b" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">但有时，我发现自己质疑使用这些东西的好处。你就不能为表单写几行HTML代码吗？或者在视图中编写更多的代码行，而不是制作序列化器或权限？</p><p id="4e83" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">是的，你可以做同样的事情。但是因为你能做到，并不意味着你应该去做。</p><p id="3767" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">首先，手工HTML表单是不安全的！通过使用Django表单，您的表单会更安全，因为它使用CSRF令牌作为跨站点请求伪造保护。您可以自己搜索，但是从clean code的角度来看，它也不适合手工HTML表单。请看这里的对比:</p><p id="0765" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">没有Django表单:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">app/views.py</p></figure><p id="132a" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">使用Django表单:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">app/forms.py</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">app/views2.py</p></figure><p id="3530" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">你可能会想，“等一下，Django格式的代码不是更长吗？”。是的，如果包括forms.py文件，时间会更长。但是如果只比较views.py文件，您会发现带有Django表单的文件比没有Django表单的文件更简单、更容易阅读。这是因为即使第一个代码片段中的代码(组合)较长，它也会被整齐地分开。这意味着你可以更容易地推断出应该做什么。</p><p id="cddb" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">这就是接吻原则的精髓。您需要使代码简单，易于他人阅读，即使您最终会编写更多的代码或不得不考虑更多。从这里学到的最重要的事情是为他人编写简单易读的代码。</p><h2 id="2216" class="nz me iq bd mf oa ob dn mj oc od dp mn mx oe of mp mz og oh mr nb oi oj mt ok bi translated">使用基于类的视图，而不是基于函数的视图</h2><p id="b0cf" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">必要时使用基于类的视图，而不是基于函数的视图。这是因为即使基于函数的视图比它的对应部分更灵活，基于类的视图在长的和冗余的函数/视图上更具可读性。</p><p id="a401" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">我不会解释太多，因为大多数人可能都知道基于类的视图，但是你可以在Django <a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/refactors-you-need-to-know-to-for-your-django-project-8a56b0dee34f">这里</a>看看我关于重构的另一个故事。其中有一节对Django REST框架中基于类的视图做了进一步的介绍。</p><h1 id="f190" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">3.在姜戈干</h1><p id="dda8" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">干还是不要重复自己是一个不言自明的道理。你不应该在你的代码中重复你自己。你可以在Django做一些事情来减少冗余:</p><h2 id="a65e" class="nz me iq bd mf oa ob dn mj oc od dp mn mx oe of mp mz og oh mr nb oi oj mt ok bi translated">使用装饰器来限制对视图的访问</h2><p id="54e0" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">如果你以前没有使用过装饰器，你可能以前在你的视图中写过这个:</p><pre class="kg kh ki kj gt on oo op oq aw or bi"><span id="54b8" class="nz me iq oo b gy os ot l ou ov">if request.user.is_authenticated:</span></pre><p id="449c" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">如果在一个文件中有多个视图，它可能看起来像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">app2/views.py</p></figure><p id="e010" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">那么，如果我告诉你有一个更好的方法，不需要一遍又一遍地复制粘贴和重复你自己，会怎么样呢？以下是装饰者的做法:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">app2/decorators.py</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">app2/views2.py</p></figure><p id="f8b6" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">哇！酷吧？您还可以看到，在装饰器中，您可以编写任何您想要的定制代码。所以这不仅仅是为了限制对视图的访问或者将你重定向到某个地方。你可以在用户进入视图之前保存一些东西到用户的会话中，比如referer URL路径，或者你能想到的其他东西。天空才是极限！</p><h2 id="55da" class="nz me iq bd mf oa ob dn mj oc od dp mn mx oe of mp mz og oh mr nb oi oj mt ok bi translated">将经常使用的代码放在单独的助手函数和单独的文件中</h2><p id="d4a0" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">这是另一个对我们所有人来说都很容易实现的方法！将经常使用的代码提取到一个单独的helper函数中，并放入<code class="fe ow ox oy oo b">utils.py</code>文件中。</p><p id="667f" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">不使用助手功能发送电子邮件的示例:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">app3/views.py</p></figure><p id="1128" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">使用助手功能发送电子邮件的示例:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">app3/utils.py</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">app3/views2.py</p></figure><p id="dfeb" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">老实说，差别非常明显，越复杂的函数越需要它。</p><h1 id="c86c" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">4.姜戈的YAGNI</h1><p id="b746" class="pw-post-body-paragraph kz la iq lc b ld mv jr lf lg mw ju li mx my ll lm mz na lp lq nb nc lt lu lv ij bi translated">YAGNI或者你不需要它这是一个告诉我们不要超越自己的原则。有时我，也许还有你们中的一些人会为“未来”写代码。也许我们以后会需要这个或那个，所以最好现在就写，对吗？没有。对于干净的代码来说，这确实是一个坏习惯，因为大多数情况下，<strong class="lc ir">你不需要那些代码</strong>。</p><p id="8917" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">例如，我将回到我们之前讨论过的装饰者。可能在得知我们可以做<code class="fe ow ox oy oo b">@login_required</code>装修工之后，我们想再做一个给<code class="fe ow ox oy oo b">qualified</code>的用户。</p><p id="2792" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">嗯，我们还没有真正实现这个<code class="fe ow ox oy oo b">qualified</code>的东西，但也许我们现在会为‘未来’写它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">app4/decorators.py</p></figure><p id="2ca6" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">嗯…..结束了。</p><p id="675d" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">两年后…</p><p id="7bc4" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">“这个‘合格的’装修工是什么东西？”</p><p id="3be5" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mx lk ll lm mz lo lp lq nb ls lt lu lv ij bi translated">是的，你可能已经忘了，也从来没用过。那是因为你可能一开始就不需要它。因此，从中得出的结论是，除非认为有必要，否则不应该添加功能或任何其他代码，除非您希望您的项目有一个臃肿而混乱的代码库。</p><h1 id="a683" class="md me iq bd mf mg nd mi mj mk ne mm mn jw nf jx mp jz ng ka mr kc nh kd mt mu bi translated">参考资料和资源</h1><div class="oz pa gp gr pb pc"><a href="https://docs.djangoproject.com/en/4.0/ref/csrf/" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd ir gy z fp ph fr fs pi fu fw ip bi translated">跨站点请求防伪| Django文档| Django</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">CSRF中间件和模板标签提供易于使用的保护，防止跨站点请求伪造。这种类型的…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">docs.djangoproject.com</p></div></div></div></a></div><div class="oz pa gp gr pb pc"><a href="https://docs.djangoproject.com/en/4.0/topics/email/" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd ir gy z fp ph fr fs pi fu fw ip bi translated">发送电子邮件| Django文档| Django</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">虽然Python通过模块提供了邮件发送接口，但是Django在它上面提供了几个轻量级的包装器…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">docs.djangoproject.com</p></div></div></div></a></div><div class="oz pa gp gr pb pc"><a href="https://docs.djangoproject.com/en/4.0/topics/http/decorators/" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd ir gy z fp ph fr fs pi fu fw ip bi translated">查看装饰者| Django文档| Django</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">Django提供了几个装饰器，可以应用于视图来支持各种HTTP特性。请参见装饰…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">docs.djangoproject.com</p></div></div></div></a></div><div class="oz pa gp gr pb pc"><a href="https://docs.djangoproject.com/en/4.0/topics/class-based-views/" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd ir gy z fp ph fr fs pi fu fw ip bi translated">基于类的视图| Django文档| Django</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">视图是一个接受请求并返回响应的可调用对象。这不仅仅是一个函数，Django…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">docs.djangoproject.com</p></div></div></div></a></div></div></div>    
</body>
</html>