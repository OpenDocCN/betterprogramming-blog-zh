<html>
<head>
<title>Efficiently Convert PDF to PNG or JPEG Images in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python中高效地将PDF转换为PNG或JPEG图像</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/efficiently-convert-pdf-to-png-or-jpeg-images-in-python-50c5ce224c20?source=collection_archive---------1-----------------------#2022-07-09">https://betterprogramming.pub/efficiently-convert-pdf-to-png-or-jpeg-images-in-python-50c5ce224c20?source=collection_archive---------1-----------------------#2022-07-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2e49" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">仅使用内存/RAM，您可以转换pdf。你不需要存储任何文件！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c97b1ba830de480d2a799d21d41c3f43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ifzMrJx0CHxwUD7t"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@altumcode?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">替代代码</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="244c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">摘要</h1><p id="87c5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这篇文章将教你一种将PDF文件转换成PNG图像文件的技术。本文旨在解决的问题是，在转换过程中，一个人不想在他的系统上存储任何数据。</p><p id="fa4f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">进行转换的系统不存储任何东西。这对于开发者来说非常重要，因为例如在驻留在服务器中的API中，需要有效地使用服务器硬件/存储资源。它不应该用于转储无用的数据。由于代码不在本机系统上存储任何东西，因此在转换完成时不使用任何存储。</p><p id="3cc3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在花了很多时间在互联网上，然后测试我的代码，我想出了一个解决方案。</p><h1 id="227d" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">代码及其解释。</h1><ol class=""><li id="ac38" class="mp mq iq lq b lr ls lu lv lx mr mb ms mf mt mj mu mv mw mx bi translated">将文件存储在python中的一个变量中。我的文件来自网络，因此我使用请求来访问上传的文件。</li></ol><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="1e71" class="nd kx iq mz b gy ne nf l ng nh">file = request.files["file"]</span></pre><p id="60d5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">2.从文件中提取文件名。warkzeug文档明确告诉调用<code class="fe ni nj nk mz b"> file.filename</code>上的安全函数来获得文件名的安全版本。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="1dd5" class="nd kx iq mz b gy ne nf l ng nh">file.filename = secure_filename(file.filename)</span></pre><p id="019b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">3.导入<code class="fe ni nj nk mz b">pdf2image</code>包，通过调用<code class="fe ni nj nk mz b">pdf2image</code>包提供的函数将pdf字节转换为RGB值字节。这是一个字节到字节的转换。到目前为止，我们没有得到实际的。png格式图像。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="c068" class="nd kx iq mz b gy ne nf l ng nh">from pdf2image import convert_from_bytes</span><span id="fe42" class="nd kx iq mz b gy nl nf l ng nh">pages = convert_from_bytes(file.read())</span></pre><p id="3c7a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">4.创建一个内存缓冲区对象，并将文件另存为。内存缓冲区中的png。</p><p id="8f82" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们需要定义一个可以存储字节的内存缓冲区。这就像一个存储数据的python变量，但这里的数据类型是“字节”。你不能仅仅通过定义一个变量来存储它。</p><p id="ec81" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">将字节存储在内存中的另一种方法是将字节写入一个文件，但是该文件将保存在您的计算机上。想象一下，如果这个API被调用100次，并且每次给出5 MB的文件，那么您最终会浪费500Mb的磁盘存储空间。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="fdc3" class="nd kx iq mz b gy ne nf l ng nh">for page in pages:</span><span id="85d5" class="nd kx iq mz b gy nl nf l ng nh">   in_mem_file = io.BytesIO()</span><span id="38ad" class="nd kx iq mz b gy nl nf l ng nh">   page.save(in_mem_file , format = "png")</span><span id="8924" class="nd kx iq mz b gy nl nf l ng nh">   in_mem_file.seek(0)</span><span id="8a03" class="nd kx iq mz b gy nl nf l ng nh">break</span></pre><p id="2c18" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><code class="fe ni nj nk mz b">page.save()</code>将页面中的字节转换成png格式的字节，并保存在in-mem变量中。<code class="fe ni nj nk mz b">.seek(0)</code>重新定位字节指针，再次指向数组的开头。</p><p id="58d3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当调用<code class="fe ni nj nk mz b">page.save</code>时，填充<code class="fe ni nj nk mz b">in_mem_file</code>的指针已经到达其长度的末端，因此我们将读取它；我们需要重新定位开始。如果我们不重新定位，将不会读取任何字节。由于单个指针既做写操作又做读操作，我们需要手动管理它。</p><p id="ba1a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在，您可以在网络上将png图像字节再次发送到其他地方，或者使用多几行代码将其存储在您的系统中。</p><p id="fa93" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">使用for循环是因为pages对象是可迭代的。这意味着如果您的pdf有多个页面，它们都存储在pages中。Pages就像一个列表，其中每个索引包含一个页面。</p><p id="9563" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当一页完成时，我使用break来停止转换。您可以删除break语句，但是要记住处理<code class="fe ni nj nk mz b">in_mem_file</code>并防止for循环覆盖它。</p><p id="2880" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">希望这篇教程对你有用。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="9387" class="nd kx iq mz b gy ne nf l ng nh">from pdf2image import convert_from_bytes</span><span id="5cd5" class="nd kx iq mz b gy nl nf l ng nh">file = request.files["file"]<br/>file.filename = secure_filename(file.filename)<br/>pages = convert_from_bytes(file.read())</span><span id="3ed7" class="nd kx iq mz b gy nl nf l ng nh">for page in pages:</span><span id="ca88" class="nd kx iq mz b gy nl nf l ng nh">  in_mem_file = io.BytesIO()</span><span id="c7c0" class="nd kx iq mz b gy nl nf l ng nh">  page.save(in_mem_file , format = "png")</span><span id="3b14" class="nd kx iq mz b gy nl nf l ng nh">  in_mem_file.seek(0)</span><span id="ca0c" class="nd kx iq mz b gy nl nf l ng nh">  break</span></pre></div></div>    
</body>
</html>