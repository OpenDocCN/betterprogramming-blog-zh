<html>
<head>
<title>Create Searchable Audio Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python创建可搜索的音频</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-searchable-audio-using-python-78b5afc5122?source=collection_archive---------2-----------------------#2022-05-03">https://betterprogramming.pub/create-searchable-audio-using-python-78b5afc5122?source=collection_archive---------2-----------------------#2022-05-03</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="d2c6" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">如何使用Python和NLTK转录音频并使其可搜索</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/682ddf02897b7ec49487520c0a400a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m8VMJjcTDeRe6-5T"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@kellysikkema?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯利·西克玛</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="478e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">音频内容已经成为流行的通信来源。一个不好的地方是，当你想找东西的时候，你不能只按键盘上的Control + F就开始搜索。假设您想要过滤最近的电话，以找到您谈论健康保险的电话。或者你喜欢听播客，想找一个演讲者谈论日本的。</p><p id="89ad" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本教程中，我将向您展示如何转录音频文件，使它们可以搜索。作为一个技术栈，我们将使用Python的库，如NLTK、语音识别等。</p><p id="5402" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们开始吧！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="2fa7" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">项目流程</h1><p id="42a7" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">首先，让我们来理解这个程序的思想:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj na"><img src="../Images/bf9cd51a55a1f70e77f7549f6947e40d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*a_oEmR9ppQJK48QDQbhIeQ.jpeg"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">程序的工作流程</p></figure><ul class=""><li id="1e84" class="nb nc iu lc b ld le lg lh lj nd ln ne lr nf lv ng nh ni nj bi translated">我们将在命令行提示符中输入一个关键字。</li><li id="0412" class="nb nc iu lc b ld nk lg nl lj nm ln nn lr no lv ng nh ni nj bi translated">该计划将试图识别和转录所有可用的音频文件。</li><li id="8522" class="nb nc iu lc b ld nk lg nl lj nm ln nn lr no lv ng nh ni nj bi translated">它会将每个音频的文本写入一个单独的文件。</li><li id="1d8e" class="nb nc iu lc b ld nk lg nl lj nm ln nn lr no lv ng nh ni nj bi translated">结果将显示包含该关键字的所有文件以及一些上下文。</li></ul></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="7aad" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">准备代码</h1><p id="af0c" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">我已经将这个项目所需的库导出到一个<a class="ae kz" href="https://github.com/kirshiyin89/py-searchable-audio/blob/master/requirements.txt" rel="noopener ugc nofollow" target="_blank"> requirements.txt </a>文件中。可以在本文最后链接的我的GitHub repo中找到。在终端中执行以下命令:</p><pre class="kk kl km kn gu np nq nr ns aw nt bi"><span id="d996" class="nu me iu nq b gz nv nw l nx ny">pip install -r requirements.txt</span></pre><p id="01f8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">接下来，创建一个新的Python文件。导入以下库:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">进口货</p></figure><p id="2799" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然后添加以下负责音频处理的代码:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">音频转录功能</p></figure><p id="39da" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">注意，我们使用<code class="fe ob oc od nq b">speech_recognition</code> Python的库来识别音频。它支持许多音频识别API。在我们的例子中，我们使用谷歌的<a class="ae kz" href="https://cloud.google.com/speech-to-text" rel="noopener ugc nofollow" target="_blank">语音识别</a>。每个音频限60秒。因此，我们将音频文件切割成更小的块。当您打算处理较大的音频文件时，这很有用。</p><p id="5129" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe ob oc od nq b">transcribe_audio(path)</code>功能处理音频识别。小音频块将被保存在一个名为<code class="fe ob oc od nq b">audio_folder</code>的单独目录中。</p><p id="f860" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，您可以调整<code class="fe ob oc od nq b">split_on_silence</code>值以满足您的需求。</p><p id="2a79" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe ob oc od nq b">audio_text</code>变量包含从音频文件中提取的文本。</p><p id="de00" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在将音频文件切割成块并提取文本后，我们通过调用<code class="fe ob oc od nq b">os.remove(chunk_filename)</code>进行清理。</p><p id="b0c4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">接下来，让我们创建另一个函数来打印关键字的上下文。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">find_keyword()函数</p></figure><p id="6fa7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了将文本分成有意义的单元，我们使用NLTK的<code class="fe ob oc od nq b">tokenizer</code>将其标记化。请注意，我们忽略了逗号、句号等。这可以在我们之前定义的行<code class="fe ob oc od nq b">tokenizer = RegexpTokenizer(r’\w+’) </code>中配置。</p><p id="b801" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们使用NLTK的<code class="fe ob oc od nq b"><a class="ae kz" href="https://www.nltk.org/howto/concordance.html" rel="noopener ugc nofollow" target="_blank">concordance</a></code>特性来显示带有一些上下文的关键字的出现。这样，你就可以决定结果是否符合你的预期。</p><p id="f767" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们为关键字搜索创建一个函数:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">函数的作用是</p></figure><p id="71dd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe ob oc od nq b">start_search() </code>函数以关键字为参数，检查给定路径下的所有<code class="fe ob oc od nq b">.wav</code>音频文件。如果相应的文本文件已经存在，我们开始扫描文件。否则，我们调用<code class="fe ob oc od nq b">transcribe_audio()</code>函数来处理音频并创建文本文件。这是很有用的，因为我们不想每次搜索新的关键字时都转录音频文件。</p><p id="24a4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，让我们创建将在程序启动时执行的<code class="fe ob oc od nq b">main</code>函数:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">主要功能</p></figure><p id="47fa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">编码部分到此为止！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="c01d" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">测试程序</h1><p id="4b41" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">让我们进入测试部分。我从免费播客网站<a class="ae kz" href="https://www.thepodcastexchange.ca/audio-samples" rel="noopener ugc nofollow" target="_blank">下载了一些音频样本。时长从30秒到2分钟不等。</a></p><p id="6d52" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通过执行以下命令启动程序:</p><pre class="kk kl km kn gu np nq nr ns aw nt bi"><span id="8b75" class="nu me iu nq b gz nv nw l nx ny">python3 audio-searcher.py</span></pre><p id="1f1f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您应该会看到键入关键字的提示:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oe"><img src="../Images/ac22b2f54231a507eb05d71b3b588984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t6krx_fuGGvtn0Pq09MYnQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">搜索“保时捷”后的结果</p></figure><p id="316e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我找“<em class="of">保时捷</em>这个词，程序找到2个匹配。如你所见，它显示了上下文和关键词，这很棒。</p><p id="4bad" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，<code class="fe ob oc od nq b">concordance</code>只检查单个单词的出现。如果您想要搜索短语，请考虑使用字符串列表:</p><pre class="kk kl km kn gu np nq nr ns aw nt bi"><span id="40ac" class="nu me iu nq b gz nv nw l nx ny">print(text.concordance(keyword.split(' ')))</span></pre><p id="3184" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如，假设您输入“<em class="of">我的汽车</em>”。NLTK将匹配整个短语的出现:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj og"><img src="../Images/b457af57c713ed9d87b58058c90db058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8JsL5LCbrq-RQEpEYtHWjQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">按顺序查找多个单词</p></figure><p id="0612" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">虽然语音识别可能不是最好的，但它应该足以给你结果。</p><p id="74c5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">顺便说一下，这个项目中的样本是英文的，但谷歌的语音识别支持许多其他语言。改变目标语言非常简单:</p><pre class="kk kl km kn gu np nq nr ns aw nt bi"><span id="bc4a" class="nu me iu nq b gz nv nw l nx ny">text = speech_recognizer.recognize_google(audio_file, <strong class="nq iv">language = "hu-HU"</strong>)</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="4b23" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">结论</h1><p id="9071" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在本教程中，您学习了如何将录音转换为可搜索的文本文件。因此，您可以搜索关键字来识别您正在寻找的音频文件。</p><p id="26d8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">该项目的完整代码可以在我的<a class="ae kz" href="https://github.com/kirshiyin89/py-searchable-audio/tree/master" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中找到。</p><p id="f04d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">作为未来的增强，您可以实现一个估计文本中关键字位置的特性。比如发生在哪一分钟，还是在开头，中间，还是结尾。</p><p id="7313" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我希望你已经得到了创建自己的项目的灵感。感谢您的阅读，祝您编码愉快！</p></div></div>    
</body>
</html>