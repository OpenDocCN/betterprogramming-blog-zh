<html>
<head>
<title>Playing With Uber’s Hexagonal Hierarchical Spatial Index, H3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">玩优步的六边形等级空间索引，H3</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/playing-with-ubers-hexagonal-hierarchical-spatial-index-h3-ed8d5cd7739d?source=collection_archive---------3-----------------------#2019-12-18">https://betterprogramming.pub/playing-with-ubers-hexagonal-hierarchical-spatial-index-h3-ed8d5cd7739d?source=collection_archive---------3-----------------------#2019-12-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e715" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">纽约出租车数据可视化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/116907173252c48e65d3d8f8576f4256.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wvRKBMUCvArJ5pg8.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://eng.uber.com/h3/" rel="noopener ugc nofollow" target="_blank">https://eng.uber.com/h3/</a></p></figure><p id="4f9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://eng.uber.com/h3/" rel="noopener ugc nofollow" target="_blank"> H3 </a>是由优步开发并开源的地理空间索引系统。它提供了将纬度/经度坐标转换为H3地理空间六边形图块的功能。</p><p id="97ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它完全是用C写的，但是也有其他语言可用的<a class="ae ky" href="https://uber.github.io/h3/#/documentation/community/bindings" rel="noopener ugc nofollow" target="_blank">绑定</a>，包括Python、<a class="ae ky" href="https://www.r-project.org/" rel="noopener ugc nofollow" target="_blank"> R </a>和Ruby。</p><p id="33a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名运输工程师，我们在分析中经常使用区域和分区。然而，手动绘制的地图分区具有局限性，例如，区域的中心不代表数据点的中心，相邻点的数量不相等，相邻点之间的距离不相等，以及一些其他不期望的边界效应。</p><p id="44a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用六边形进行空间分析有很多好处，更多用例可在此处阅读<a class="ae ky" href="https://uber.github.io/h3/#/documentation/overview/use-cases" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="9dff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用H3对纽约市出租车高级轿车委员会(TLC)公开的出租车数据做了一些初步分析。</p><p id="ff97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想感谢每一个分享他们与H3的经历和创作教程的人。他们不是很多，但可用的是非常有用的。</p><p id="0f2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我下载了2016年4月的出租车数据，因为那一年的出租车数据有出租车搭载的地理位置，而不是搭载位置id。</p><p id="59fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">TLC发布的新数据集(2016年后)只有可映射到出租车区域的上车位置id。如果你也想下载的话，这里有<a class="ae ky" href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page" rel="noopener ugc nofollow" target="_blank">网页</a>。</p><p id="f979" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于CSV文件很大(1.74 GB)，一些人在使用<a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a>库时可能会收到“内存错误”。因此，我试图通过去掉我们不需要的列并改变数据类型来减少一些。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="1342" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码应该运行三次左右。现在我们有了包含批量数据帧的<code class="fe lx ly lz ma b">df_list</code>。让我们把它们都读成一个。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="e2c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个数据框现在在我的机器上只使用了273.2+MB的内存。所以，挺好的！我还删除了原来的列表，为将来的任务释放一些内存。</p><p id="0a29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先简化列名，然后画出我们要查看的取货地点。我首先使用全部数据来做这件事，但是实际上你可以只使用5%的数据来发现异常值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="ef37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">剧情应该是这样的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/fe915a8f87d6ba0bd3e7bb4e9f086592.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*iQEVRSvxllXsH7bhcx2fyA.png"/></div></div></figure><p id="c649" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想主要集中在曼哈顿周围，所以我想出了我自己的纬度值，我想过滤这些数据。请随意更改这些内容。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="6f1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，现在剧情看起来好多了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/d7d50e8b3e2a1822c9ab44df6287028a.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*OpE00uYGsL_WsTMwRHPUCw.png"/></div></figure><p id="d7fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我想数一数每个六边形中有多少个数据点(出租车接送),然后以每个六边形的颜色随其值而变化的方式将它们可视化。它的计数越多，就越接近红色。</p><p id="c323" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里还有另一个函数，它帮助使用<a class="ae ky" href="https://python-visualization.github.io/folium/" rel="noopener ugc nofollow" target="_blank">follow</a>库构建choropleth图。这些助手功能取自<a class="ae ky" href="https://github.com/uber/h3-py-notebooks" rel="noopener ugc nofollow" target="_blank">H3-py-笔记本页面</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="4287" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好的，让我们用这些六边形做我们的第一张地图，看看它看起来像什么！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="8eb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你运行上面的代码，它将显示下面的地图。我希望你现在使用<a class="ae ky" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi md"><img src="../Images/96ac5e31d32bd08a1f67141c22357166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y7rsr_-UVrLH7YyAVvDtVQ.png"/></div></div></figure><p id="f99d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我试图找到这些六边形的最佳孔径大小。这是我在一本笔记本上看到的东西，我认为它非常有用。</p><p id="f025" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用图例绘制多个孔径大小，图例允许您打开/关闭它们。我意识到八或九号是这类分析的最佳选择。你可以看到下面的代码和情节。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi me"><img src="../Images/5395e995daedea7e642f53dc234eb702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HADYosyv9k_i0BKmOGNwXw.png"/></div></div></figure><p id="7a77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想看现场版，这里有链接。</p><ul class=""><li id="9b63" class="mf mg it lb b lc ld lf lg li mh lm mi lq mj lu mk ml mm mn bi translated"><a class="ae ky" href="https://ak4728.github.io/" rel="noopener ugc nofollow" target="_blank"> GitHub </a></li></ul><p id="11a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>