<html>
<head>
<title>4 Simple Kubernetes Terminal Customizations to Boost Your Productivity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">4个简单的Kubernetes终端定制来提高您的生产力</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/4-simple-kubernetes-terminal-customizations-to-boost-your-productivity-deda60a19924?source=collection_archive---------5-----------------------#2020-09-22">https://betterprogramming.pub/4-simple-kubernetes-terminal-customizations-to-boost-your-productivity-deda60a19924?source=collection_archive---------5-----------------------#2020-09-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3199" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这是我在生产中用于管理大规模Kubernetes集群的工具</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d2da3f79c917745e109a593e58fee1a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8OiwqVcU0qDOHNfo"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@wasdrew?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">安朵斯·瓦斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="a76c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://medium.com/better-programming/3-years-of-kubernetes-in-production-heres-what-we-learned-44e77e1749c8" rel="noopener">我管理大规模Kubernetes集群已经有三年多的时间了</a>，我想分享一下我对<code class="fe lv lw lx ly b">kubectl</code>终端设置的极简主义方法，事实证明这种方法日复一日都非常有效。</p><p id="cf24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个定制良好的命令行终端可以显著提高您的工作效率。这是面包和黄油——这是所有奇迹发生的地方。</p><p id="452d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是与流行的命令行定制和功能丰富的升级相比，我相信在安装任何新的二进制文件、包装器或修改时，简单的设置是节俭的。特别是在<code class="fe lv lw lx ly b">kubectl</code>中，本机工具设计得非常好，几乎没有需要解决的问题。</p><p id="b596" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是我给我的<code class="fe lv lw lx ly b">kubectl</code>终端添加的四个简单的东西。有了这个设置，<a class="ae ky" href="https://medium.com/better-programming/3-years-of-kubernetes-in-production-heres-what-we-learned-44e77e1749c8" rel="noopener">我每天管理超过400台机器的20多个大规模Kubernetes集群</a> <em class="lz"> </em>。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="84d8" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">1.使用“kubetail”跟踪多个Pod实例的日志</h1><p id="b001" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">kubectl</code>您会注意到的第一件事是跨多个实例跟踪日志的困难。这是最常见的用例之一，但是<code class="fe lv lw lx ly b">kubectl</code>没有。</p><p id="45d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您要在<code class="fe lv lw lx ly b">kubectl</code>上跟踪单个pod的日志，它看起来会像这样:</p><p id="8123" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">kubectl logs -f &lt;POD_NAME&gt; -n &lt;NAMESPACE&gt;</code></p><p id="850b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">kubetail</code>上，要跟踪多个pod的日志，您可以使用:</p><p id="ad22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">kubetail &lt;POD_NAME_REGEX&gt; -n &lt;NAMESPACE&gt;</code></p><p id="68d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将跟踪名称与regex模式匹配的所有pod的日志。由于日志记录是跨多个pod同时进行的，<code class="fe lv lw lx ly b">kubetail</code>使用不同的颜色来帮助区分和分析日志。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/b4c921054f0eba480c8f9c02ee88a571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*KBRwlYqdVxjmMtX2-di4EQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f01f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">kubetail</code>是一个简单的包装器，它位于<code class="fe lv lw lx ly b">kubectl</code>之上以实现这一点。安装很容易——你可以在这里找到说明<a class="ae ky" href="https://github.com/johanhaleby/kubetail" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="6124" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">2.动态更改默认命名空间</h1><p id="811a" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">最终，为每一个<code class="fe lv lw lx ly b">kubectl</code>操作一次又一次地提供名称空间标志变得既累又低效。为了解决这个问题，您需要一种动态设置和更改默认名称空间的方法。</p><p id="427d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我写了一个简单的别名函数<code class="fe lv lw lx ly b">ksn</code>，它为我实现了这个功能(<code class="fe lv lw lx ly b">ksn</code>暗示<em class="lz">设置名称空间</em>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者的Github要点</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/440e8a748501bb828c00c8076c13157d.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*1eDPFkIgWp8jby3-I0tlPg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/893e7cbb59526fdc7b43dde3a55ce455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*SQGXXVyOIYSgZ3mR5ziI1w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7593" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，我们会根据手头的任务处理一系列名称空间。因此，如果我正在解决一个Kafka问题——比方说，十个命令中有八个被发送到一个名称空间<code class="fe lv lw lx ly b">kafka</code>,那将成为我在此期间的默认名称空间。这可以为您节省大量时间，尤其是在处理需要发出大量<code class="fe lv lw lx ly b">kubectl</code>指令的复杂任务时。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="c9cb" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">3.在Shell提示符中显示“kube-context”和“namespace”</h1><p id="834b" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">发出<code class="fe lv lw lx ly b">kubectl</code>命令时，必须时刻注意电流<code class="fe lv lw lx ly b">kube-context</code>和<code class="fe lv lw lx ly b">namespace</code>。当您同时管理跨越20个不同的<code class="fe lv lw lx ly b">kube-contexts</code>和大约50个名称空间的集群时，这并不容易。在一个环境中，您很容易发出错误的命令，尤其是在跨不同上下文和集群进行多任务处理时。</p><p id="f943" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了解决这个问题，在终端提示符附近有一个显示器来随时告诉你活动的<code class="fe lv lw lx ly b">namespace</code>和<code class="fe lv lw lx ly b">kube-context</code>是非常有用的。</p><p id="015a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它看起来是这样的——在下面的例子中，我的<code class="fe lv lw lx ly b">kube-context</code>是<code class="fe lv lw lx ly b">dev2–1</code>，名称空间是<code class="fe lv lw lx ly b">test</code>。有了这些信息，我在集群中执行命令时只需浏览一下就可以了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/c3a10ddeb11acc6e8b6cad4a0f95a6cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GL8D-bB9IaFFj6SoOQYC4A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4fab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装和设置说明可在<a class="ae ky" href="https://github.com/superbrothers/zsh-kubectl-prompt" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="ae1a" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">4.基本的“kubectl”别名</h1><p id="47dc" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">不用说，别名是在终端中定制和加速工作的最快方法。这些是我常用的别名，几乎已经成为我的第二天性。</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="4d72" class="no mi it ly b gy np nq l nr ns">alias k='kubectl '<br/>alias kcc='kubectl config current-context'<br/>alias kdp='kubectl delete po'<br/>alias kgc='kubectl config get-contexts'<br/>alias kge='kubectl get events --sort-by='\''{.lastTimestamp}'\'<br/>alias kgp='kubectl get po'<br/>alias kl='kubectl logs '<br/>alias kpf='kubectl port-forward'<br/>alias ksc='kubectl config use-context'</span></pre></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="ebe9" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">少即是多——不要过度烹饪终端</h1><p id="4e8a" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">我们研究了针对<code class="fe lv lw lx ly b">kubectl</code>用户的四种基本终端定制:</p><ol class=""><li id="c97d" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated">使用<code class="fe lv lw lx ly b">kubetail</code>跟踪多个pod实例的日志。</li><li id="3a9d" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated">动态地改变默认的<code class="fe lv lw lx ly b">namespace</code>来显著地缩短<code class="fe lv lw lx ly b">kubectl</code>指令。</li><li id="9f63" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated">在提示符附近显示<code class="fe lv lw lx ly b">kube-context</code>和<code class="fe lv lw lx ly b">namespace</code> s，以避免意外错误。</li><li id="ebf4" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated">重要的<code class="fe lv lw lx ly b">kubectl</code>别名列表。</li></ol><p id="5d4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与这种极简设置形成对比的是，流行的终端升级(如<a class="ae ky" href="https://k9ss.io/" rel="noopener ugc nofollow" target="_blank"> K9s </a>)通常是复杂的，功能丰富多彩的，但反过来又很慢，令人分心，最重要的是，没有必要。你添加的功能越多，你花在理解和浏览屏幕上所有附加信息上的时间就越多。</p><p id="1796" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个优雅的终端设置，比任何东西都更能增强你的注意力。</p><p id="d38c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拥有一个简单的命令行终端设置允许您提高速度并熟练使用本机二进制文件和工具，这一点至关重要，尤其是当您使用大量基础架构时，登录和注销不同的VM shell配置文件。</p><p id="3005" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的终端设置应该丰富你作为一名工程师的经验，而不是让你失去它。</p></div></div>    
</body>
</html>