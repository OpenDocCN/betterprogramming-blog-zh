<html>
<head>
<title>How To Write Tests for Your Kubernetes Operator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为您的Kubernetes操作员编写测试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/write-tests-for-your-kubernetes-operator-d3d6a9530840?source=collection_archive---------2-----------------------#2022-08-01">https://betterprogramming.pub/write-tests-for-your-kubernetes-operator-d3d6a9530840?source=collection_archive---------2-----------------------#2022-08-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="45f5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Kubernetes运营商101</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7f59621e0c312f2b912d5941a3b52865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9HkmGKw8odtT6eWLrzfwpQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图一。<a class="ae kv" href="https://unsplash.com/photos/aYHzEnSEH-w" rel="noopener ugc nofollow" target="_blank">摄影</a>由盖瑞特·帕克在Unsplash上拍摄</p></figure><p id="5639" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我之前的文章中，我展示了如何在大约十分钟内<a class="ae kv" href="https://medium.com/better-programming/build-a-kubernetes-operator-in-10-minutes-11eec1492d30" rel="noopener">构建一个Kubernetes操作符。我还描述了操作符、定制资源定义和定制资源、控制器和管理器的功能。如果您想了解更多关于这些概念的知识，我强烈推荐您阅读这篇文章。</a></p><p id="135c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是现在是时候写一些测试来在生产中使用我们的操作符了！这本身就是一个问题，并没有看上去那么复杂。大多数人都不喜欢写测试，但却是必须的。它们有助于提高代码质量，检测错误，并节省时间和金钱。所以，我们来做一些测试吧！</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="38ea" class="lx ly iq lt b gy lz ma l mb mc">Table of Contents</span><span id="d598" class="lx ly iq lt b gy md ma l mb mc">The Different Types of Tests</span><span id="77ff" class="lx ly iq lt b gy md ma l mb mc"><a class="ae kv" href="#b600" rel="noopener ugc nofollow">Practical work</a><br/>1. Set Up Your Environment<br/>2. <a class="ae kv" href="#497e" rel="noopener ugc nofollow">Some Context on the Operator</a><br/>3. <a class="ae kv" href="#9b33" rel="noopener ugc nofollow">Unit Tests</a><br/>4. <a class="ae kv" href="#6cc4" rel="noopener ugc nofollow">Integration Tests</a></span><span id="03e6" class="lx ly iq lt b gy md ma l mb mc"><a class="ae kv" href="http://c3bb" rel="noopener ugc nofollow" target="_blank">To go further</a></span></pre><p id="b39b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">软件开发中有三种主要的测试类型:单元测试、集成测试和端到端测试。它甚至比理论上更复杂，但是它给出了我们将在本文中看到的一个概念。</p><ul class=""><li id="51cf" class="me mf iq ky b kz la lc ld lf mg lj mh ln mi lr mj mk ml mm bi translated">单元测试用于测试小段代码，例如方法或函数。</li><li id="05df" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr mj mk ml mm bi translated">集成测试用于测试应用程序不同部分的集成。例如，一个操作员在Kubernetes环境中使用API服务器和其他资源的功能。</li><li id="1488" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr mj mk ml mm bi translated">端到端测试旨在模拟用户的逐步体验。它们应该涵盖应用程序的主要功能。</li></ul><p id="b6f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在接下来的实际工作中，我们将看到如何在Go中编写单元测试，以及针对Kubernetes控制器的集成测试。很有趣，你会看到的！</p><h1 id="b600" class="ms ly iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">实际工作</h1><h2 id="65a6" class="lx ly iq bd mt nj nk dn mx nl nm dp nb lf nn no nd lj np nq nf ln nr ns nh nt bi translated">1.设置您的环境</h2><p id="b3db" class="pw-post-body-paragraph kw kx iq ky b kz nu jr lb lc nv ju le lf nw lh li lj nx ll lm ln ny lp lq lr ij bi translated">我选择使用<a class="ae kv" href="https://github.com/kubernetes-sigs/kubebuilder" rel="noopener ugc nofollow" target="_blank"> Kubebuilder </a>框架来构建Kubernetes操作符。它非常易于使用，文档也很容易阅读，是一款久经考验的产品。它是构建操作符的两个最流行的Go框架之一，另外两个是<a class="ae kv" href="https://github.com/operator-framework/operator-sdk" rel="noopener ugc nofollow" target="_blank"> OperatorSDK </a>。</p><p id="4b55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我假设你已经有了设计一个操作符的必要工具(go，docker，<code class="fe nz oa ob lt b">kubectl</code>，<code class="fe nz oa ob lt b">kubebuilder</code>和一个小型的本地Kubernetes集群)。但是如果不是这样，我强烈建议您按照<a class="ae kv" href="https://medium.com/better-programming/build-a-kubernetes-operator-in-10-minutes-11eec1492d30#9a3d" rel="noopener">下面的安装步骤</a>来做，这样您就可以在本教程中跟随我了。</p><p id="701c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了只关注测试部分，我准备了一个简单的Kubernetes操作符，它是用Kubebuilder设计的。这项实际工作将是编写测试，以验证运营商的代码符合我们的期望，并确保它不包含任何错误。我将要求你克隆这个项目并转移到<code class="fe nz oa ob lt b">operator-v2</code>分支，这样我们都从同一个基础开始。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="5626" class="lx ly iq lt b gy lz ma l mb mc">$ git clone <a class="ae kv" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:leovct/kubernetes-operator-tutorial.git<br/>$ cd kubernetes-operator-tutorial<br/>$ git checkout operator-v2<br/>$ git pull origin operator-v2</span></pre><p id="cdfb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您尝试运行测试，您将看到覆盖率等于0%。的确，我们还没有写任何测试！但这将会改变！</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="6781" class="lx ly iq lt b gy lz ma l mb mc">$ make test<br/>mkdir -p /Users/leovct/Documents/tutorial/bin<br/>GOBIN=/Users/leovct/Documents/tutorial/bin go install sigs.k8s.io/controller-tools/cmd/controller-gen@v0.8.0<br/>/Users/leovct/Documents/tutorial/bin/controller-gen rbac:roleName=manager-role crd webhook paths="./..." output:crd:artifacts:config=config/crd/bases<br/>/Users/leovct/Documents/tutorial/bin/controller-gen object:headerFile="hack/boilerplate.go.txt" paths="./..."<br/>go fmt ./...<br/>go vet ./...<br/>GOBIN=/Users/leovct/Documents/tutorial/bin go install sigs.k8s.io/controller-runtime/tools/setup-envtest@latest<br/>KUBEBUILDER_ASSETS="/Users/leovct/Library/Application Support/io.kubebuilder.envtest/k8s/1.23.5-darwin-amd64" go test ./... -coverprofile cover.out<br/>?       my.domain/tutorial      [no test files]<br/>?       my.domain/tutorial/api/v1       [no test files]<br/>?       my.domain/tutorial/color        [no test files]<br/>ok      my.domain/tutorial/controllers  6.220s  coverage: 0.0% of statements</span></pre><h2 id="497e" class="lx ly iq bd mt nj nk dn mx nl nm dp nb lf nn no nd lj np nq nf ln nr ns nh nt bi translated">2.运算符的一些上下文</h2><p id="4ed6" class="pw-post-body-paragraph kw kx iq ky b kz nu jr lb lc nv ju le lf nw lh li lj nx ll lm ln ny lp lq lr ij bi translated">您克隆的“Foo”操作符类似于我在我的“<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/build-a-kubernetes-operator-in-10-minutes-11eec1492d30">在10分钟内构建一个Kubernetes操作符</a>”文章中构建的操作符。除了展示如何使用操作符在Kubernetes中执行简单的任务之外，它没有其他真正的用途。</p><p id="4d07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接线员是如何工作的？</p><p id="9124" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为一个图表比三段文字更好地解释了想法，所以在这里。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/434e3e09a0a65243f28d28c42be419c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m91-Y-uF7H-hlpdlu6C3Kg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图二。操作员功能概述</p></figure><p id="a9d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，有Foo自定义资源定义或CRD(见<code class="fe nz oa ob lt b">api/v1/foo_types.go</code>)。它的规范中有一个<code class="fe nz oa ob lt b">name</code>字段，引用Foo正在寻找的朋友的名字。如果Foo找到一个朋友(一个和他的朋友同名的<code class="fe nz oa ob lt b">Pod</code>，它的<code class="fe nz oa ob lt b">happy</code>状态将被设置为真。自上一篇教程以来的一个小的增加，Foo的状态也包含一个<code class="fe nz oa ob lt b">color</code>字段，根据它的<code class="fe nz oa ob lt b">name</code>和它演化的<code class="fe nz oa ob lt b">namespace</code>来确定。</p><p id="8952" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其次是Foo控制器(见<code class="fe nz oa ob lt b">controllers/foo_controller.go</code>)。它获取触发协调请求的Foo资源，以获得Foo朋友的名字。然后，它列出了所有与Foo的朋友同名的pod。如果找到了至少一个朋友，它将Foo的<code class="fe nz oa ob lt b">happy</code>状态更新为<code class="fe nz oa ob lt b">true</code>，否则我们将其设置为<code class="fe nz oa ob lt b">false</code>。它还更新Foo的<code class="fe nz oa ob lt b">color</code>状态。</p><p id="99fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，控制器也会对Pod事件做出反应(参见<code class="fe nz oa ob lt b">mapPodsReqToFooReq</code>)。事实上，如果创建了一个新的pod，我们希望Foo资源能够相应地更新它的状态。每次发生<code class="fe nz oa ob lt b">Pod</code>事件(创建、更新或删除)时，都会触发该方法。只有当Pod的名称是集群中部署的Foo自定义资源之一的“朋友”时，它才会触发Foo控制器的协调循环。</p><p id="ef38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们知道了操作符是如何工作的，我们可以继续测试它了。</p><h2 id="9b33" class="lx ly iq bd mt nj nk dn mx nl nm dp nb lf nn no nd lj np nq nf ln nr ns nh nt bi translated">3.单元测试</h2><p id="1638" class="pw-post-body-paragraph kw kx iq ky b kz nu jr lb lc nv ju le lf nw lh li lj nx ll lm ln ny lp lq lr ij bi translated">在这个阶段，我们将测试像方法和函数这样的小段代码。当然，我们不会在这里测试控制器<code class="fe nz oa ob lt b">Reconcile</code>方法，因为它涉及到用本地Kubernetes API服务器、CRD、控制器、管理器等设置一个测试Kubernetes环境。我们将在4中看到这一点。集成测试部分。</p><p id="cc08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那我们要测试什么？如果你花时间阅读Foo控制器的代码，你会注意到我使用了<code class="fe nz oa ob lt b">color</code>包中的<code class="fe nz oa ob lt b">ConvertStrToColor</code>函数来更新Foo的<code class="fe nz oa ob lt b">color</code>状态。让我们来编写这个简单方法的单元测试吧！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="48d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的目标是确保函数返回给定输入参数的预期值。下面是我想编写的测试这个函数的三个测试:</p><ol class=""><li id="e2ae" class="me mf iq ky b kz la lc ld lf mg lj mh ln mi lr of mk ml mm bi translated">将空字符串转换成色轮的颜色。</li><li id="e55a" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr of mk ml mm bi translated">将一个短字符串转换成色轮的颜色。</li><li id="47bc" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr of mk ml mm bi translated">将一个很长的字符串(带有数字和破折号)转换成色轮的颜色。</li></ol><p id="61ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要在Go中编写单元测试，您需要创建一个描述名称、输入参数和预期结果的测试列表。然后运行一个循环，将函数的输出与预期结果进行比较。下面是我的<code class="fe nz oa ob lt b">test</code>函数，用来检查<code class="fe nz oa ob lt b">ConvertStrToColor</code>是否正常工作:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="64e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，如果您尝试第二次运行测试，您将会看到<code class="fe nz oa ob lt b">color</code>包的代码覆盖率等于100%！太棒了，我们成功了！该功能按预期工作。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="5aee" class="lx ly iq lt b gy lz ma l mb mc">$ make test<br/>/Users/leovct/Documents/tutorial/bin/controller-gen rbac:roleName=manager-role crd webhook paths="./..." output:crd:artifacts:config=config/crd/bases<br/>/Users/leovct/Documents/tutorial/bin/controller-gen object:headerFile="hack/boilerplate.go.txt" paths="./..."<br/>go fmt ./...<br/>go vet ./...<br/>KUBEBUILDER_ASSETS="/Users/leovct/Library/Application Support/io.kubebuilder.envtest/k8s/1.23.5-darwin-amd64" go test ./... -coverprofile cover.out<br/>?       my.domain/tutorial      [no test files]<br/>?       my.domain/tutorial/api/v1       [no test files]<br/>ok      my.domain/tutorial/color        0.306s  coverage: 100.0% of statements<br/>ok      my.domain/tutorial/controllers  6.626s  coverage: 0.0% of statements</span></pre><p id="58ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们言归正传。我们要测试一下运营商的对账循环是怎样的！相信我，这是文章最有趣的部分！</p><h2 id="6cc4" class="lx ly iq bd mt nj nk dn mx nl nm dp nb lf nn no nd lj np nq nf ln nr ns nh nt bi translated">4.集成测试</h2><p id="abbe" class="pw-post-body-paragraph kw kx iq ky b kz nu jr lb lc nv ju le lf nw lh li lj nx ll lm ln ny lp lq lr ij bi translated">Kubebuilder提供了一个测试样板(参见<code class="fe nz oa ob lt b">controllers/suite_test.go</code>)，它用本地Kubernetes API服务器建立了一个测试环境。我们唯一需要做的是首先实例化并运行控制器，然后用<a class="ae kv" href="https://onsi.github.io/ginkgo/" rel="noopener ugc nofollow" target="_blank">Ginkgo</a>(kube builder使用的框架)编写测试，以验证我们的操作符在Kubernetes环境中演化时表现良好。</p><p id="c995" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，这个测试环境非常简单，通常不代表生产集群的环境。这就是为什么在现有集群中运行操作员测试也有可能更接近真实的生产环境。你可以在这里了解更多关于那个<a class="ae kv" href="https://book.kubebuilder.io/reference/envtest.html" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="fe5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们需要实例化并启动<code class="fe nz oa ob lt b">Foo</code>控制器。为此，我们需要创建另一个客户端。为什么我们需要两个客户？因为当运行测试时，您想要断言API服务器的实时状态。如果您在测试中使用管理器中的客户机，那么您最终会断言缓存的内容。第一，这个比较慢。其次，这可能会引入缺陷。这就是为什么我们有两个客户端:k8sclient，我们将在测试中使用的客户端，和<code class="fe nz oa ob lt b">k8sManager.getClient()the manager's client</code>。</p><p id="d699" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是测试环境设置的修改后的源代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="c7f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然我们的测试环境已经设置好了，我们就可以编写集成测试了！让我们在<code class="fe nz oa ob lt b">controllers</code>文件夹下创建一个名为<code class="fe nz oa ob lt b">foo_controller_test.go</code>的新测试文件。在这个文件中，我们将使用银杏框架来定义我们的测试。这里有一个简单的测试例子，它创建了两个<code class="fe nz oa ob lt b">Foo</code>定制资源，并确保资源已经被创建。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="3eb7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了！现在让我们编写一个测试，创建一个与Foo自定义资源的朋友同名的pod。控制器应该更新自定义资源的状态，并将其设置为true。另一个自定义资源应该仍然将其状态设置为false。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="4dd7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们编写另一个测试，将第二个Foo自定义资源的friend的名称更新为之前创建的pod的名称。控制器应该更新自定义资源的状态，并将其设置为true。同样，另一个自定义资源应该仍然将其状态设置为false。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="0973" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们今天的最后一个测试是删除我们创建的pod，并检查控制器是否将所有定制资源的状态更新为false。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="755c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些是相当简单的测试，但是它们向你展示了可能性。你可以用银杏提供的各种工具做非常复杂的事情。如果您在本教程中有所关注，您应该已经看到了各种各样的说明，如<code class="fe nz oa ob lt b">Expect</code>、<code class="fe nz oa ob lt b">Eventually</code>或<code class="fe nz oa ob lt b">Consistently</code>，这些都是测试Kubernetes中运行的操作者和资源的行为的非常有用的方法。</p><p id="9273" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经编写了许多覆盖控制器范围的优秀测试。现在是时候运行它们了，看看操作员是否全部通过。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="eae2" class="lx ly iq lt b gy lz ma l mb mc">$ make test<br/>/Users/leovct/Documents/tutorial/bin/controller-gen rbac:roleName=manager-role crd webhook paths="./..." output:crd:artifacts:config=config/crd/bases<br/>/Users/leovct/Documents/tutorial/bin/controller-gen object:headerFile="hack/boilerplate.go.txt" paths="./..."<br/>go fmt ./...<br/>go vet ./...<br/>KUBEBUILDER_ASSETS="/Users/leovct/Library/Application Support/io.kubebuilder.envtest/k8s/1.23.5-darwin-amd64" go test ./... -coverprofile cover.out<br/>?    my.domain/tutorial [no test files]<br/>?    my.domain/tutorial/api/v1 [no test files]<br/>ok   my.domain/tutorial/color 0.077s coverage: 100.0% of statements<br/>ok   my.domain/tutorial/controllers 8.434s coverage: 82.4% of statements</span></pre><p id="399a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很好，我们没有错误！此外，我们的覆盖率从0%提高到了82%以上！最后的18%对应于我们无法测试的代码部分。例如，当控制器找不到触发协调循环的自定义资源时，或者当它无法列出集群中的pod时。这无关紧要，因为我们知道我们已经测试了所有操作符的作用域。</p><p id="9f45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你需要浏览代码，这里有GitHub库的链接。<code class="fe nz oa ob lt b">operator-v2</code>分支包含没有测试的操作符的源代码，而tests分支包含所有测试的源代码。</p><div class="og oh gp gr oi oj"><a href="https://github.com/leovct/kubernetes-operator-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">github-leovct/kubernetes-operator-教程:☸️在10分钟内构建一个kubernetes操作器</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">operator-v1分支参考我的中篇文章《10分钟构建一个Kubernetes操作器》。你需要一个…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">github.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox kp oj"/></div></div></a></div><h1 id="c3bb" class="ms ly iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">走得更远</h1><p id="8968" class="pw-post-body-paragraph kw kx iq ky b kz nu jr lb lc nv ju le lf nw lh li lj nx ll lm ln ny lp lq lr ij bi translated">我们已经看到了如何使用银杏框架为Kubernetes控制器编写单元测试和集成测试。这是开发Kubernetes操作符的关键步骤，因为它允许验证协调逻辑的正确运行。如果你想了解更多关于Kubernetes运营商的信息，我邀请你浏览<a class="ae kv" href="https://medium.com/@leovct/list/kubernetes-operators-101-dcfcc4cb52f6" rel="noopener">我写的关于这个主题的文章列表</a>。</p><p id="ad50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，这里有一个资源列表，您可以使用它来更深入地研究这个主题。</p><p id="3781" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">玩得开心！</p><div class="og oh gp gr oi oj"><a href="https://book.kubebuilder.io/cronjob-tutorial/writing-tests.html" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">编写测试Kubebuilder图书</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">我们声援黑人社区。种族主义是不可接受的。这与……的核心价值观相冲突</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">book.kubebuilder.io</p></div></div><div class="os l"><div class="oy l ou ov ow os ox kp oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://book.kubebuilder.io/reference/envtest.html" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">配置env test-kube builder书籍</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">controller-runtime/pkg/env test Go库通过设置和…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">book.kubebuilder.io</p></div></div><div class="os l"><div class="oz l ou ov ow os ox kp oj"/></div></div></a></div><ul class=""><li id="7617" class="me mf iq ky b kz la lc ld lf mg lj mh ln mi lr mj mk ml mm bi translated"><a class="ae kv" href="http://onsi.github.io/ginkgo" rel="noopener ugc nofollow" target="_blank">http://onsi.github.io/ginkgo</a></li></ul></div></div>    
</body>
</html>