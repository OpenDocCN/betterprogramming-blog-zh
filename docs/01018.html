<html>
<head>
<title>How To Use Puppeteer With Jest &amp; TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Jest &amp; TypeScript中使用木偶师</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-puppeteer-with-jest-typescript-530a139ffe40?source=collection_archive---------2-----------------------#2019-08-07">https://betterprogramming.pub/how-to-use-puppeteer-with-jest-typescript-530a139ffe40?source=collection_archive---------2-----------------------#2019-08-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="613b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">自动化和测试Chrome中的一切</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b5199e53e296189ec1262d6326817046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hUm32WTpY-gfXrfM"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多梅尼科·洛亚在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b3bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">端到端测试经常使用<a class="ae ky" href="https://www.seleniumhq.org/" rel="noopener ugc nofollow" target="_blank"> Selenium </a>，它可以用来自动化任务。</p><p id="7749" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，您可能不需要Selenium的重量和特性集。如果你正在寻找一个更加轻量级和易于使用的工具来自动化任务或运行端到端测试，那么<a class="ae ky" href="https://developers.google.com/web/tools/puppeteer/" rel="noopener ugc nofollow" target="_blank">puppeter</a>是一个不错的选择。</p><p id="7b1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本帖中，我们将使用:</p><ul class=""><li id="dade" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">木偶师</strong>:一个<a class="ae ky" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank">节点</a>库，用于控制和自动化基于<a class="ae ky" href="https://www.chromium.org/" rel="noopener ugc nofollow" target="_blank"> Chromium </a>的浏览器(例如Google Chrome)，可用于持续集成工具，例如<a class="ae ky" href="https://gitlab.com/" rel="noopener ugc nofollow" target="_blank"> GitLab </a>和<a class="ae ky" href="https://jenkins.io/" rel="noopener ugc nofollow" target="_blank"> Jenkins </a>。我写了一篇<a class="ae ky" href="https://medium.com/@ali.dev/how-to-setup-chrome-headless-on-gitlab-ci-with-puppeteer-docker-fbb562cbaee1" rel="noopener">以前的文章</a>关于用于端到端测试的木偶师。</li><li id="f309" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Jest </strong> </a>:一个壮观的测试运行器，用于编写和执行用JavaScript或<a class="ae ky" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>编写的测试。和Node.js以及流行的前端框架玩的很好，比如<a class="ae ky" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular </a>和<a class="ae ky" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>。我已经在<a class="ae ky" href="https://itnext.io/how-to-use-jest-in-angular-aka-make-unit-testing-great-again-e4be2d2e92d1" rel="noopener ugc nofollow" target="_blank">之前的文章</a>中写过关于Angular的笑话。</li><li id="5eae" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">TypeScript</strong>:JavaScript的一个超集，它增加了静态类型和其他漂亮的特性。像<a class="ae ky" href="https://www.jetbrains.com/idea/" rel="noopener ugc nofollow" target="_blank"> IntelliJ </a>和<a class="ae ky" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio Code </a>这样的流行ide对TypeScript有很大的支持，这改善了开发人员的体验。</li></ul><p id="56d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些库都是受欢迎的开源项目，由知名软件公司(谷歌、脸书和微软)维护，这意味着这些工具不会很快用完。</p><p id="4faa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章的最后，我们应该有一个可以可靠地运行测试或自动化任务的项目，它是在Chromium浏览器中用TypeScript编写的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/5e757118073842e2c29ab3d3a9658aac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pp__DLIWph0k9Cx9NPs71A.png"/></div></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="58b8" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">如何设置Jest、木偶师和打字稿</h1><ol class=""><li id="07dd" class="lv lw it lb b lc nj lf nk li nl lm nm lq nn lu no mb mc md bi translated">安装<code class="fe np nq nr ns b"><a class="ae ky" href="https://www.npmjs.com/package/typescript" rel="noopener ugc nofollow" target="_blank">TypeScript</a></code>。</li><li id="3a0a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu no mb mc md bi translated">创建一个<code class="fe np nq nr ns b"><a class="ae ky" href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html" rel="noopener ugc nofollow" target="_blank">tsconfig.json</a></code>文件(TypeScript可以为您完成这项工作)。</li><li id="a5b3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu no mb mc md bi translated">安装<code class="fe np nq nr ns b"><a class="ae ky" href="https://www.npmjs.com/package/jest" rel="noopener ugc nofollow" target="_blank">Jest</a></code>及其型号<code class="fe np nq nr ns b"><a class="ae ky" href="https://www.npmjs.com/package/@types/jest" rel="noopener ugc nofollow" target="_blank">@types/jest</a></code>。</li><li id="b718" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu no mb mc md bi translated">安装<code class="fe np nq nr ns b"><a class="ae ky" href="https://www.npmjs.com/package/puppeteer" rel="noopener ugc nofollow" target="_blank">Puppeteer</a></code>及其型号<code class="fe np nq nr ns b"><a class="ae ky" href="https://www.npmjs.com/package/@types/puppeteer" rel="noopener ugc nofollow" target="_blank">@types/puppeteer</a></code>。这将下载一个版本的铬。如果你已经有Chrome，不需要下载，可以用<code class="fe np nq nr ns b"><a class="ae ky" href="https://www.npmjs.com/package/puppeteer-core" rel="noopener ugc nofollow" target="_blank">puppeteer-core</a></code>。</li><li id="65d7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu no mb mc md bi translated">安装<code class="fe np nq nr ns b"><a class="ae ky" href="https://www.npmjs.com/package/jest-puppeteer" rel="noopener ugc nofollow" target="_blank">jest-puppeteer</a></code>预设。这使事情对你来说更容易，因为它大大减少了设置。</li><li id="b849" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu no mb mc md bi translated">安装<code class="fe np nq nr ns b"><a class="ae ky" href="https://www.npmjs.com/package/@types/jest-environment-puppeteer" rel="noopener ugc nofollow" target="_blank">@types/jest-environment-puppeteer</a></code>以在您的测试中拥有正确的类型脚本支持。</li><li id="81df" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu no mb mc md bi translated">创建一个<code class="fe np nq nr ns b"><a class="ae ky" href="https://jestjs.io/docs/en/configuration" rel="noopener ugc nofollow" target="_blank">jest.config.js</a></code>。它应该使用<code class="fe np nq nr ns b">jest-puppeteer</code>预置。</li><li id="404a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu no mb mc md bi translated">创建一个<code class="fe np nq nr ns b">jest-puppeteer.config.js</code>。你可以使用这个文件来设置自定义的Chrome选项(比如在非headless模式下运行)。</li><li id="7e30" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu no mb mc md bi translated">创建您的测试。API或端到端测试应该放在一个专用的测试目录中，并且在文件名中包含单词<code class="fe np nq nr ns b">spec</code>或<code class="fe np nq nr ns b">test</code>。如果没有找到您的测试，您可以在<code class="fe np nq nr ns b">jest.config.js</code>中定制<code class="fe np nq nr ns b"><a class="ae ky" href="https://jestjs.io/docs/en/configuration#testmatch-array-string" rel="noopener ugc nofollow" target="_blank">testMatch</a></code>。</li><li id="5f1d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu no mb mc md bi translated">运行测试:<code class="fe np nq nr ns b">jest --runInBand</code>。<code class="fe np nq nr ns b"><a class="ae ky" href="https://jestjs.io/docs/en/cli#runinband" rel="noopener ugc nofollow" target="_blank">runInBand</a></code>将禁用并行测试执行，这对于运行API或端到端测试是可行的。</li><li id="b089" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu no mb mc md bi translated">可选:如果您需要在所有测试开始之前或之后执行任务，您可以使用Jest <code class="fe np nq nr ns b"><a class="ae ky" href="https://jestjs.io/docs/en/configuration#globalsetup-string" rel="noopener ugc nofollow" target="_blank">globalSetup</a></code> / <code class="fe np nq nr ns b"><a class="ae ky" href="https://jestjs.io/docs/en/configuration#globalteardown-string" rel="noopener ugc nofollow" target="_blank">globalTeardown</a></code>。如果这样做，您需要自己调用<code class="fe np nq nr ns b">globalSetup</code> / <code class="fe np nq nr ns b">globalTeardown</code>，由<code class="fe np nq nr ns b">jest-puppeteer</code>完成(例如，当测试完成时关闭浏览器)。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="e69f" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">结论</h1><p id="4bd8" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">谢谢你能走到这一步。如您所见，连接Jest、Puppeteer和TypeScript需要几个步骤。一旦设置完成，你可以实现很多。</p><p id="1b10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>