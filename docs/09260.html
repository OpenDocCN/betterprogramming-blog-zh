<html>
<head>
<title>Hello Yarn 2, Goodbye Node_modules.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你好纱2，再见Node_modules。</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/hello-yarn-2-goodbye-node-modules-21d97afc1a75?source=collection_archive---------0-----------------------#2021-08-04">https://betterprogramming.pub/hello-yarn-2-goodbye-node-modules-21d97afc1a75?source=collection_archive---------0-----------------------#2021-08-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7256" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有什么新鲜事(也是JS历史上最不痛苦的告别)</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0aafa1485bdd075af8bc1cbca8386a43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ybkqwc-a0FUdigam"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">奥斯曼·拉纳在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="5d15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">三年多前的2017年，<a class="ae ky" href="https://engineering.fb.com/2017/09/07/web/announcing-yarn-1-0/" rel="noopener ugc nofollow" target="_blank"> Yarn 1.0在脸书工程博客</a>正式公布。到那时，仅仅在它第一次发布11个月后，已经有超过175，000个存储库开始使用新的包管理器。</p><p id="bb36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管Yarn的成功故事一直持续至今，但该工具也成为许多经典包处理弱点的受害者，如速度慢、复杂性增加和数据占用。</p><p id="8c71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Yarn 2带来了一些基本的变化，这些变化不仅解决了这些问题，还改善了您的整体工作流程。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/82d3ddbe1f4833fa05d124336ca5d797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NhZ8Ts1Xe0SlreW2Ljzo6g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">再也看不到任何这样的迷因将是关于Yarn 2最悲伤的部分。(<a class="ae ky" href="https://www.reddit.com/r/ProgrammerHumor/comments/6s0wov/heaviest_objects_in_the_universe/" rel="noopener ugc nofollow" target="_blank">来自Reddit </a>)</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="7b58" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">Yarn 2有什么新内容？</h1><p id="0ce3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">新版本已经于去年1月发布(也就是2020年)，然而，大多数大型项目和库花了很长时间来适应新的即插即用方式。</p><p id="b3fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然一些大公司仍在努力实现兼容性(截至撰写本文时:Angular、React Native和Flow)，但现在是在您的代码库中尝试它的好机会。</p><p id="52e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即插即用支持并不是Yarn 2带来的唯一重大变化(这个概念本身甚至不是那么新，可以追溯到2018年9月)，更新实际上提供了许多伟大的功能，使生活变得更加简单。</p><p id="ed9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Yarn的维护者在这些改进上倾注了整整一年的时间，你可以肯定地感觉到Yarn 2是一款经过深思熟虑的产品。</p><h1 id="6a18" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">实际可调试CLI输出</h1><p id="e1d7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">它从CLI输出开始，现在这个输出更加结构化了。虽然纱线控制台文本以前充其量是一个具有挑战性的视觉狂野西部，但格式和颜色现在有助于大大提高可读性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/0b88b71fcfa4d726db987e36a9e32ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9pD2aG7jyTayLyfTeRKoLg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Yarn的CLI输出不再是杂乱无章的文本墙。</p></figure><p id="623c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最重要的是，每一行都有自己的错误代码，因此调试起来容易多了。所以是时候给这个列表添加书签了。</p><h1 id="39a7" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">不仅仅是node_modules</h1><p id="6267" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">当然，将Yarn 2简化为一个可怕的文件夹的完全废弃不会公正地对待这个版本。但是，嘿——它不见了。这是一个重要的里程碑。</p><p id="9966" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">新版本大大减少了文件I/O的数量，从而在安装过程中节省了大量时间。</p><p id="d0ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Yarn现在在一个单独的<code class="fe ng nh ni nj b">pnp.js</code>文件中保存了一个地图，这个文件跟踪包的引用，一旦你运行你的代码，它将确保node知道正确的位置。</p><p id="6113" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不过，那些下载的软件包需要放到你磁盘上的某个地方<em class="nk"/>。这就是新的<code class="fe ng nh ni nj b">.yarn</code>文件夹的用途。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">当node_modules最终消失时。</p></figure><p id="6b4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从现在开始，这个位置就是您的那些依赖项被缓存的地方，但是——我建议在您自己的项目中测量它——占用的内存要少得多。</p><h1 id="ae83" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">纱线dlx</h1><p id="bc74" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在这之前，直接运行一个远程的非安装包是你必须利用npm的<code class="fe ng nh ni nj b">npx</code>来完成的事情。现在Yarn终于发布了自己的命令。</p><p id="282b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Yarn 2，您可以使用<code class="fe ng nh ni nj b">yarn dlx</code>在临时环境中执行一个包，而不必先安装它。</p><h1 id="0de8" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">补丁协议</h1><p id="ed17" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在本地修补依赖关系现在变得容易多了。您可以指示Yarn将一个包提取到一个临时文件夹中，然后在完成后生成一个包含diff的文件:</p><pre class="kj kk kl km gt nn nj no np aw nq bi"><span id="2117" class="nr me it nj b gy ns nt l nu nv">yarn patch node-fetch<br/>yarn patch-commit /private/var/patchfolder &gt; mypatch.patch</span></pre><p id="e71a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为补丁目录从来不会被直接使用，所以很少有空间会把事情弄糟。今后，您将仅参考您的补丁文件:</p><pre class="kj kk kl km gt nn nj no np aw nq bi"><span id="abdf" class="nr me it nj b gy ns nt l nu nv">{<br/>  "dependencies": {<br/>    "node-fetch": "patch:node-fetch@2.6.1#./mypatch.patch"<br/>  }<br/>}</span></pre><p id="81f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这甚至适用于间接(传递性)依赖，使其成为在官方补丁发布之前修补安全问题的一个很好的特性！</p><p id="ce55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多文档可以在<a class="ae ky" href="https://github.com/yarnpkg/berry/tree/master/packages/plugin-patch" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae ky" href="https://yarnpkg.com/features/protocols#patch" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="0e63" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">发布工作流</h1><p id="1cee" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果您在一个多工作空间设置中工作(例如像monorepo ),那么在您的树中发布并随后升级所有消耗的包可能会成为一项乏味的工作。</p><p id="872d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">理想情况下，您发布一个工作区的新版本，所有的依赖项都会随着新版本自动更新。</p><p id="8db5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这正是<a class="ae ky" href="https://github.com/yarnpkg/berry/tree/master/packages/plugin-version" rel="noopener ugc nofollow" target="_blank">版本插件</a>为你做的。它开启了新的<a class="ae ky" href="https://next.yarnpkg.com/features/release-workflow" rel="noopener ugc nofollow" target="_blank">发布工作流程</a>消除了必须弄清楚升级什么和在哪里升级的痛苦。</p><h1 id="4a7b" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">别等了。立即开始迁移。</h1><p id="a4a7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">根据您的包的复杂性，迁移到新版本的Yarn(又名modern或berry)可能需要一段时间，但这是值得的。</p><p id="9e78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你需要更多好的理由:确保你查看了这个列表。</p><p id="5fa1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你已经相信了:看一看迁移指南。</p><p id="5e57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这次更新对每个人都有好处:你。你的团队。还有你的硬盘。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="23f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nk">嗨，我是弗里德里希！我在工作中是一名经理和开发人员，在家里是一名业余爱好者——厨师、音乐家、数据和语言爱好者。你可以在</em> <a class="ae ky" href="https://bit.ly/3m0DXaT" rel="noopener ugc nofollow" target="_blank"> <em class="nk"> LinkedIn </em> </a> <em class="nk">上找到我。</em></p></div></div>    
</body>
</html>