<html>
<head>
<title>Synchronous State in React Using Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中的同步状态使用挂钩</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/synchronous-state-in-react-using-hooks-dc77f43d8521?source=collection_archive---------1-----------------------#2022-06-14">https://betterprogramming.pub/synchronous-state-in-react-using-hooks-dc77f43d8521?source=collection_archive---------1-----------------------#2022-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2d04" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将回调函数传递给React钩子的setter函数的方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3ce51b006b56f0049ce8c79491471a23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QKk0Oi-2UqsD3Ji501-4gQ.png"/></div></div></figure><h1 id="c0af" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">什么是使用状态挂钩？</h1><p id="9b7e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><code class="fe mf mg mh mi b">useState</code>钩子允许你在一个功能组件中创建一个状态，告诉React在它被改变时重新渲染。它不同于使用普通变量，因为它的值在重新呈现器之间保持不变，并且在更改时还会导致组件重新呈现。</p><h1 id="800e" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">怎么用？</h1><p id="055a" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">下面是使用钩子的方法:</p><pre class="kg kh ki kj gt mj mi mk ml aw mm bi"><span id="08d6" class="mn ks iq mi b gy mo mp l mq mr">import { useState } from 'react';</span><span id="e2c2" class="mn ks iq mi b gy ms mp l mq mr">const Monkey = () =&gt; {<br/>    const [bananas, setBananas] = useState(0);<br/>    ...<br/>}</span></pre><p id="1656" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">钩子有两部分:参数和它的返回值:</p><ul class=""><li id="eba0" class="my mz iq ll b lm mt lp mu ls na lw nb ma nc me nd ne nf ng bi translated">参数:提供的参数是状态的初始值。</li><li id="ae2b" class="my mz iq ll b lm nh lp ni ls nj lw nk ma nl me nd ne nf ng bi translated">返回值:它返回两件事:状态变量和用于改变该变量的值的函数。</li></ul><p id="17c6" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">要使用状态，我们只需使用括号内的变量。<code class="fe mf mg mh mi b">{}</code></p><pre class="kg kh ki kj gt mj mi mk ml aw mm bi"><span id="e98b" class="mn ks iq mi b gy mo mp l mq mr">&lt;div&gt;<br/>    &lt;p&gt;I have eaten {bananas} bananas&lt;/p&gt;<br/>&lt;/div&gt;</span></pre><h2 id="6bb3" class="mn ks iq bd kt nm nn dn kx no np dp lb ls nq nr ld lw ns nt lf ma nu nv lh nw bi translated">设置状态</h2><p id="3c0a" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">给定一个值作为参数和一个函数作为参数，有两种方法可以设置stage。</p><ol class=""><li id="f02c" class="my mz iq ll b lm mt lp mu ls na lw nb ma nc me nx ne nf ng bi translated"><strong class="ll ir">作为参数的值</strong></li></ol><pre class="kg kh ki kj gt mj mi mk ml aw mm bi"><span id="ae06" class="mn ks iq mi b gy mo mp l mq mr">const eatMore = () =&gt; {<br/>    setBananas(bananas + 1);<br/>};</span></pre><p id="f1de" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">2.<strong class="ll ir">用作自变量</strong></p><pre class="kg kh ki kj gt mj mi mk ml aw mm bi"><span id="0ee9" class="mn ks iq mi b gy mo mp l mq mr">const shitSome = () =&gt; {<br/>    setBananas((bananas) =&gt; bananas - 1);<br/>};</span></pre><h1 id="f336" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">设置状态是异步的</h1><p id="92f5" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">React异步设置该状态，这意味着状态不会立即改变，而是在几毫秒后改变。React异步设置其状态，因为否则会导致开销很大的操作。使其同步可能会导致浏览器无响应。</p><p id="736b" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">异步<code class="fe mf mg mh mi b">setState</code>调用被批量处理，以提供更好的用户体验和性能。</p><p id="3a18" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">出现的一个问题是，如果我们在调用setter函数后立即访问状态，我们得到的是现有的值，而不是更新后的值。</p><pre class="kg kh ki kj gt mj mi mk ml aw mm bi"><span id="6acc" class="mn ks iq mi b gy mo mp l mq mr">const eatMore = () =&gt; {<br/>   setBananas(bananas + 1);<br/>   console.log(bananas);<br/>}</span></pre><p id="7b84" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">下面您可以看到呈现的值与控制台中记录的值不同。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/14e530f181ec3b7b4bfeb6535173c9ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*Ou5hZUGdCs2QE34XVidkUw.gif"/></div></figure><h1 id="0a78" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">解决办法</h1><h2 id="d24a" class="mn ks iq bd kt nm nn dn kx no np dp lb ls nq nr ld lw ns nt lf ma nu nv lh nw bi translated">类别组件</h2><p id="2a47" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果您以前使用过类组件，那么您可能知道<code class="fe mf mg mh mi b">setState</code>函数。</p><p id="ae5b" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">它也不返回一个<code class="fe mf mg mh mi b">Promise</code>，所以使用async/await或任何类似的方法都不起作用。实际设置状态的时间可以变化。通常，它会在下一次渲染时发生，但有时为了提高性能，它可以进行批处理。</p><p id="6aa4" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated"><code class="fe mf mg mh mi b">setState</code>函数接受一个可选的回调参数，该参数可用于在状态改变后进行更新。</p><pre class="kg kh ki kj gt mj mi mk ml aw mm bi"><span id="ef9d" class="mn ks iq mi b gy mo mp l mq mr">eatMore = () =&gt; {<br/>   this.setState({ bananas: this.state.bananas + 1 }, () =&gt; {<br/>       console.log(this.state.bananas);<br/>  });<br/>}</span></pre><p id="4de2" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">在这里，我们可以看到它的工作原理:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/fceabb278889d8b4d2c11cd8ca6ad8d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*EEdtvSqv59PbcQ33a-fqig.gif"/></div></figure><h1 id="e618" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">用钩子解决这个问题</h1><p id="5b0c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们上面看到的解决方案对由<code class="fe mf mg mh mi b">useState</code>钩子返回的setter函数不起作用。</p><p id="ad1d" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">即使您尝试将回调函数传递给setter函数，React也会向您发出警告，并建议您使用<code class="fe mf mg mh mi b">useEffect</code>钩子，但这并不是所有用例的最佳解决方案。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/ad64c664930942d6f630e24f72f8f2c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*LglYWexsNyFuVh8CYbyFsA.gif"/></div></figure><h2 id="c64d" class="mn ks iq bd kt nm nn dn kx no np dp lb ls nq nr ld lw ns nt lf ma nu nv lh nw bi translated">使用函数参数</h2><p id="5ef4" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们知道setter函数也接受一个函数作为参数，它接受初始值并返回修改后的值。我们能做的就是在这个函数内部调用我们的函数，然后返回所需的值。</p><pre class="kg kh ki kj gt mj mi mk ml aw mm bi"><span id="2195" class="mn ks iq mi b gy mo mp l mq mr">const eatMore = () =&gt; {<br/>    setBananas(bananas =&gt; {<br/>        const modifiedValue = bananas + 1;<br/>        console.log(modifiedValue);<br/>        return modifiedValue;<br/>    });<br/>};</span></pre><p id="1c8f" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">下面你可以看到增量函数工作得很好，但是减量函数有问题</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/496b31453d71aa635472a43389084bff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*du8g_XIFB6vNp6Hp68P_pg.gif"/></div></figure><h1 id="f93a" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">使用自定义挂钩的解决方案</h1><p id="4b5c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">上面的解决方案很棒，但是我们可以抽象它以使代码看起来更干净，为了抽象解决方案，我们将使用自定义的React钩子。</p><p id="04b2" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">构建自己的钩子可以让您将组件逻辑提取到可重用的函数中。自定义钩子是一个JavaScript函数，它的名字以<code class="fe mf mg mh mi b">use</code>开头，可能会调用其他钩子。</p><p id="b9f5" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">这个钩子可以选择使用一个回调函数，这个函数通过<code class="fe mf mg mh mi b">prevValue</code>和<code class="fe mf mg mh mi b">newValue</code>被调用。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="5acf" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">要使用它，请尝试以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="1b2c" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">这里有一个优雅的解决方案:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/ae318b21d14990f29087462c622fd061.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*Wah1oS1sqGFYZYtbMcIgHQ.gif"/></div></figure><h1 id="bda6" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">最终代码</h1><h2 id="9593" class="mn ks iq bd kt nm nn dn kx no np dp lb ls nq nr ld lw ns nt lf ma nu nv lh nw bi translated"><code class="fe mf mg mh mi b">App.js</code></h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="6a55" class="mn ks iq bd kt nm nn dn kx no np dp lb ls nq nr ld lw ns nt lf ma nu nv lh nw bi translated">useStateWithCallback.js</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="b71a" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">参考链接</h1><div class="ob oc gp gr od oe"><a href="https://reactjs.org/docs/hooks-state.html" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">使用状态钩子-反应</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">钩子是React 16.8中的新增功能。它们允许您使用状态和其他React特性，而无需编写类。的…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">reactjs.org</p></div></div><div class="on l"><div class="oo l op oq or on os kp oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a href="https://reactjs.org/docs/hooks-custom.html" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">建立你自己的钩子-反应</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">钩子是React 16.8中的新增功能。它们让你不用写类就可以使用状态和其他React特性…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">reactjs.org</p></div></div><div class="on l"><div class="ot l op oq or on os kp oe"/></div></div></a></div></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><p id="ae6b" class="pw-post-body-paragraph lj lk iq ll b lm mt jr lo lp mu ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated"><em class="pb">非常感谢您的阅读。我希望这能对你有所帮助。如果您有任何问题或建议，请随时回复。</em></p></div></div>    
</body>
</html>