<html>
<head>
<title>Data Cleaning With Python and pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python和pandas清理数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/data-cleaning-with-python-pandas-an-introduction-1cfd5cde6884?source=collection_archive---------1-----------------------#2020-03-25">https://betterprogramming.pub/data-cleaning-with-python-pandas-an-introduction-1cfd5cde6884?source=collection_archive---------1-----------------------#2020-03-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cee3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">介绍</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9278b9fbcbd4a8bd0fb070064da5aed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UHOFTAUVqqW8KBXhwQxAcw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@markusspiske?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae ky" href="https://unsplash.com/s/photos/data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="4187" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能听说过数据科学家花费大约80%的时间清理数据。</p><p id="658b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">清理数据很重要，因为脏数据会导致脏分析和脏预测。</p><p id="6094" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些肮脏的数据可能会被用来做出预测，最终导致公司或个人损失大量资金，并可能导致一些人失业。</p><p id="0755" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过努力确保您正在处理的数据是干净的和高质量的，可以避免一场噩梦。</p><p id="9bbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，我们将用<a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a>来做这件事，这是一个用于数据操作和分析的Python库。</p><p id="5a76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你使用过Excel或者任何电子表格工具，这与使用熊猫数据框架很相似，除了你编写Python代码来进行计算和操作。</p><p id="3ba6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，你不需要成为一个Python专家来和熊猫一起工作！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b298" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在这篇文章中</h1><ul class=""><li id="e44d" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">项目设置-收集数据并创建熊猫数据框架。</li><li id="6d3e" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">用熊猫做数据分析。</li><li id="f68d" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">数据质量检查。</li><li id="ee06" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">缺少值。</li><li id="a9f1" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">熊猫<code class="fe nk nl nm nn b">apply()</code>。</li><li id="91e6" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><a class="ae ky" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"> NumPy </a> <code class="fe nk nl nm nn b">where()</code>。</li><li id="02e3" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">正常化。</li><li id="0510" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">自然语言处理的文本规范化。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8c2b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">数据是如何变脏的？</h1><ul class=""><li id="334a" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">缺失数据。</li><li id="f71f" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">数据不一致。</li><li id="0b81" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">重复数据。</li></ul><p id="500e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">举几个可能出错的例子。数据变得非常混乱的方式数不胜数。</p><p id="e4bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时，在最初输入数据时，验证检查不够充分。</p><p id="bbe9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果用户在表单域中以任意格式输入数据，但没有适当的准则或表单验证检查来强制符合特定格式，那么用户将按照他们认为合适的方式输入。</p><p id="b41a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可能有一个州(美国)的输入字段，您有一些数据是两个字符的缩写，<em class="no"> NY </em>然后其他的有<em class="no"> New York </em>，然后有潜在的拼写错误和打字错误…</p><p id="a513" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据也可能在传输或存储过程中遭到破坏。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7f1d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用Python和pandas清理数据</h1><p id="aea3" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">我们将使用<a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a>来检查和清理来自<a class="ae ky" href="https://www1.nyc.gov/site/buildings/index.page" rel="noopener ugc nofollow" target="_blank">纽约市建筑部(DOB) </a>的建筑违规数据集，该数据集可在纽约市开放数据上获得。</p><p id="5742" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是<a class="ae ky" href="https://data.cityofnewyork.us/Housing-Development/DOB-Violations/3h2n-5cm9" rel="noopener ugc nofollow" target="_blank">数据集</a>。</p><p id="18b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个演示中，我将使用数据的一个子集——从API中检索的10，000条记录。</p><p id="3455" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我有另一篇关于从API访问纽约开放数据和获取API密钥的文章。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="982f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置</h1><ul class=""><li id="d8cb" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">为这个项目创建一个虚拟环境<a class="ae ky" href="https://virtualenv.pypa.io/en/latest/" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="9520" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">安装<a class="ae ky" href="https://requests.readthedocs.io/en/master/" rel="noopener ugc nofollow" target="_blank"> Python-requests </a>和熊猫。</li><li id="62ff" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">从纽约市开放数据API中检索2019年10，000条违规数据记录。</li><li id="18ae" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">用我们将在后面的文章中用到的数据创建一个熊猫数据框架。</li></ul><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="ff16" class="nw md it nn b gy nx ny l nz oa">mkvirtualenv cleandata </span><span id="54a8" class="nw md it nn b gy ob ny l nz oa">pip install requests <br/>pip install pandas</span></pre><p id="fa7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">把这两个都和NumPy一起导入，NumPy和pandas一起安装，我们也将使用它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="65ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:将API键放在脚本之外是个好主意。使用环境变量或其他工具来管理敏感信息。</p><p id="2e5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我从API中抓取了数据，并用它创建了一个pandas <a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank"> DataFrame </a> <code class="fe nk nl nm nn b">df</code>，我们将在本文的剩余部分使用它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ac1e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">分析数据</h1><p id="9dc2" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">让我们看看我们在处理什么。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="c9c0" class="nw md it nn b gy nx ny l nz oa">In [1]: df.shape <br/>Out[1]: (10000, 18)</span></pre><p id="434c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个数据集中有10，000条记录。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e6f9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">看看前几行</h1><p id="56fd" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">我们可以通过调用DataFrame上的<code class="fe nk nl nm nn b">head()</code>来查看前几行。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="b377" class="nw md it nn b gy nx ny l nz oa">In [3]: df.head()                                                                                                                                                     <br/>Out[3]: <br/>       bin  block boro         ...         violation_number                                     violation_type violation_type_code<br/>0  3059563  02136    3         ...                    00339  JVCAT5-RESIDENTIAL ELEVATOR PERIODIC INSPECTIO...              JVCAT5<br/>1  3215627  07777    3         ...                    00951                    AEUHAZ1-FAIL TO CERTIFY CLASS 1             AEUHAZ1<br/>2  3137310  05631    3         ...                 NRF01042                                  LL2604S-SPRINKLER             LL2604S<br/>3  2003035  02504    2         ...                    00162                    AEUHAZ1-FAIL TO CERTIFY CLASS 1             AEUHAZ1<br/>4  1001389  00113    1         ...                    00284  ACC1-(OTHER BLDGS TYPES) - ELEVATOR AFFIRMATIO...                ACC1<br/><br/>[5 rows x 18 columns]</span></pre><p id="b899" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据集中有18列。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8657" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">列/功能名称</h1><p id="d2a1" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">让我们看看列名。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="f600" class="nw md it nn b gy nx ny l nz oa">In [4]: df.columns<br/>Out[4]: <br/>Index(['bin', 'block', 'boro', 'description', 'device_number',<br/>       'disposition_comments', 'disposition_date', 'ecb_number',<br/>       'house_number', 'isn_dob_bis_viol', 'issue_date', 'lot', 'number',<br/>       'street', 'violation_category', 'violation_number', 'violation_type',<br/>       'violation_type_code'],<br/>      dtype='object')</span></pre><p id="21d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm nn b">bin</code>栏代表<em class="no">建筑识别号</em>，是纽约市DOB用于建筑的唯一标识符。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b6be" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">缺少/空值</h1><p id="7725" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">调用<code class="fe nk nl nm nn b">isnull()</code>和<code class="fe nk nl nm nn b">sum()</code>来计算每一列中有多少空值。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="4d2c" class="nw md it nn b gy nx ny l nz oa">In [5]: df.isnull().sum()<br/>Out[5]: <br/>bin                        0<br/>block                      2<br/>boro                       0<br/>description             2446<br/>device_number           3772<br/>disposition_comments    7349<br/>disposition_date        7358<br/>ecb_number              8093<br/>house_number               0<br/>isn_dob_bis_viol           0<br/>issue_date                 0<br/>lot                        2<br/>number                     0<br/>street                     0<br/>violation_category         0<br/>violation_number           0<br/>violation_type             0<br/>violation_type_code        0<br/>dtype: int64</span></pre><p id="003a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在后面的文章中更多地讨论缺失值。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b4f7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">删除不相关的列</h1><p id="6843" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">我主要感兴趣的是查看每个建筑收到的违规类型，以及它们是已经关闭还是仍然开放，因此我将从一开始就删除一些列，这些列只是关于建筑位置和DOB的管理数据的更多信息。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="9498" class="nw md it nn b gy nx ny l nz oa">In [6]: columns_to_delete = ['block', 'boro','house_number','lot','street','violation_number', 'device_number', 'disposition_comments', 'isn_dob_bis_viol', 'disposition_date','ecb_number','description'] <br/>In [7]: df.drop(columns_to_delete, inplace=True, axis=1)</span></pre><p id="1260" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我列出了我想要删除的列，然后将其传递给<code class="fe nk nl nm nn b">df.drop()</code>。</p><p id="a6bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多pandas功能可以就地运行<em class="no"/>。</p><p id="973c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在pandas中，轴0代表行，轴1代表列，所以我用<code class="fe nk nl nm nn b">axis=1</code>表示，因为我要删除列。</p><p id="2381" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很好，现在让我们看看哪些列还在数据框中。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="cd8f" class="nw md it nn b gy nx ny l nz oa">In [8]: df.columns<br/>Out[8]: <br/>Index(['bin', 'issue_date', 'number', 'violation_category', 'violation_type',<br/>       'violation_type_code'],<br/>      dtype='object')</span></pre><p id="ce38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，我们已经检查了数据，并对其进行了一些删减，现在是时候查看每一列了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8221" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">描述统计学</h1><p id="e751" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">您可以调用<code class="fe nk nl nm nn b">describe()</code>来获得数据帧中每一列的摘要。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="10af" class="nw md it nn b gy nx ny l nz oa">In [9]: df.describe()                                                                       <br/>Out[9]: <br/>            bin           issue_date                number        violation_category violation_type violation_type_code<br/>count     10000                10000                 10000                     10000          10000               10000<br/>unique     8545                  327                  9996                         9             27                  27<br/>top     3397861  2019-11-08 00:00:00  V*030619AEUHAZ100139  V-DOB VIOLATION - ACTIVE     E-ELEVATOR                   E<br/>freq          8                 1554                     2                      7330           2214                2214<br/>first       NaN  2019-01-01 00:00:00                   NaN                       NaN            NaN                 NaN<br/>last        NaN  2019-12-31 00:00:00                   NaN                       NaN            NaN                 NaN</span></pre><p id="60b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于数字数据，您还可以获得平均值、中值、标准偏差和百分位数。</p><p id="7c8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm nn b">top</code>值是该列中最常见的值，例如，在这里，ID号为3397861的建筑物似乎在该数据集中拥有最多的条目。</p><p id="16cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.describe.html" rel="noopener ugc nofollow" target="_blank">文档</a>中阅读更多关于<code class="fe nk nl nm nn b">describe()</code>的信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="564d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">数据质量</h1><p id="4d65" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">接下来的几个部分将涵盖数据质量检查。</p><ul class=""><li id="e67b" class="mu mv it lb b lc ld lf lg li oe lm of lq og lu nb nc nd ne bi translated">数据类型</li><li id="dcd9" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">限制</li><li id="6548" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">同样</li><li id="3d29" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">准确(性)</li><li id="0fa7" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">数据一致性</li><li id="5a70" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">复制</li></ul><p id="c870" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在维基百科上阅读更多关于数据质量的信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="aa5e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">数据类型</h1><p id="41a1" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">每一列中的数据值都是您期望的正确数据类型，这一点很重要。</p><p id="11b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果数据应该是数字格式，但您在列中找到了字符串数据。</p><p id="82ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">稍后，当你进行数字计算时，你可能会得到令人惊讶的结果，当你认为你在把两个数字相加，但它们是字符串，所以它们被连接起来。</p><p id="daee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">属性<code class="fe nk nl nm nn b">dtypes</code>将显示数据帧中每一列的数据类型。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="72dd" class="nw md it nn b gy nx ny l nz oa">In [10]: df.dtypes<br/>Out[10]: <br/>bin                    object<br/>issue_date             object<br/>number                 object<br/>violation_category     object<br/>violation_type         object<br/>violation_type_code    object<br/>dtype: object</span></pre><p id="f202" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">pandas对象数据类型可以是混合类型，有字符串和数字数据，但pandas会将其视为字符串。</p><p id="1c0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个数据集，我主要关心的是<code class="fe nk nl nm nn b">issue_date</code>列。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="49a3" class="nw md it nn b gy nx ny l nz oa">In [11]: df['issue_date'].head()                                                             <br/>Out[11]: <br/>0    20190520<br/>1    20190516<br/>2    20190903<br/>3    20190904<br/>4    20190906<br/>Name: issue_date, dtype: object</span></pre><p id="c615" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">日期是YYYYMMDD格式的字符串。</p><p id="5093" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想把它转换成一个<a class="ae ky" href="https://docs.python.org/3.6/library/datetime.html" rel="noopener ugc nofollow" target="_blank"> Python datetime </a>，pandas用<code class="fe nk nl nm nn b">to_datetime()</code>方法有一个简单的方法——阅读<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_datetime.html" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="adea" class="nw md it nn b gy nx ny l nz oa">In [12]: df['issue_date'] = pd.to_datetime(df['issue_date'])  <br/>In [13]: df['issue_date'].head()                                                             <br/>Out[13]: <br/>0   2019-05-20<br/>1   2019-05-16<br/>2   2019-09-03<br/>3   2019-09-04<br/>4   2019-09-06<br/>Name: issue_date, dtype: datetime64[ns]</span></pre><p id="61a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas很聪明，通常不用你指定它就能计算出日期格式。</p><p id="ece0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我没有对其他列进行任何数值计算，所以我将它们保留为对象类型。</p><p id="5381" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我可以将<code class="fe nk nl nm nn b">bin</code>列转换成整数格式，但是我没有对它进行任何数值计算，并且在数据集的<a class="ae ky" href="https://dev.socrata.com/foundry/data.cityofnewyork.us/3h2n-5cm9" rel="noopener ugc nofollow" target="_blank"> API文档</a>中，它是一个文本字段。</p><p id="6c0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其余的大多是字母数字或字符串文本。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6176" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">数据约束</h1><p id="9a15" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">确保尊重数据上的任何约束。</p><p id="f9cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于给定的数据集，您可能需要遵循许多类型的约束，在清理数据集时，您会希望确保测试任何相关的约束。</p><ul class=""><li id="3855" class="mu mv it lb b lc ld lf lg li oe lm of lq og lu nb nc nd ne bi translated">日期范围，</li><li id="8c73" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">数字范围—列的最小值或最大值。</li><li id="2b34" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">非空约束-如果值不应为空，但为。</li><li id="c687" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">唯一约束-两个或更多列值在数据中必须是唯一的。</li><li id="ce42" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">外键约束。</li><li id="89e6" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">模式—如果数据应该是电子邮件地址或电话号码的格式，可以使用这些模式的正则表达式进行验证。</li><li id="3fcc" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">如果您正在处理经度和纬度等地理数据，并且知道数据点应该位于何处，则可以为可接受的纬度和经度坐标设置边界，如果数据点位于边界之外，则需要进一步检查。</li></ul><p id="3f8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">…以及更多。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c795" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><code class="fe nk nl nm nn b">issue_date</code>栏中的测试日期</h1><p id="358b" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">建筑违章数据应该都是2019年的日期。</p><p id="2e22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经将该列转换为Python datetime格式，因此我可以通过创建一个布尔掩码来测试日期范围是否正确——为该列中的每一项创建一个由<code class="fe nk nl nm nn b">True</code>或<code class="fe nk nl nm nn b">False</code>值组成的数组——然后确保返回<code class="fe nk nl nm nn b">True</code>的所有行加起来达到我期望的行数。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="a853" class="nw md it nn b gy nx ny l nz oa">In [14]: mask = (df['issue_date'] &gt; '2018-12-31') &amp; (df['issue_date'] &lt;= '2019-12-31') <br/>In [15]: df.loc[mask].shape Out[15]: (10000, 18)</span></pre><p id="a1cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">10000行都是2019年的，所以它通过了测试！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ca6c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">同样</h1><p id="6c9f" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">数据集中的值应该是正确的数据类型，并且它们在<em class="no">单位</em>中也应该是一致的。</p><p id="75b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一列中的一些样品以英里/小时为单位，而其他样品以公里/小时为单位，那么任何分析都将基于部分不正确的数据。</p><p id="56a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要确保数据被转换成相同的单位。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eb44" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">数据准确性</h1><p id="ea24" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">检查数据的准确性可以与我们谈到的约束紧密联系在一起。</p><p id="cf36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户可能以“000–000–0000”的格式输入美国电话号码，这是正确的格式，可以传递任何类型的正则表达式，但它可能不是真实的电话号码。</p><p id="6b46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果没有可靠的资源来比较数据，则很难检查数据的准确性。</p><p id="0849" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，您可以使用一些API来验证美国邮政地址。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8d97" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">一致性</h1><p id="afbe" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">跨数据源的数据应该是一致的。</p><p id="f8f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有关于零售产品的数据，并且在两个不同的表中价格不同，这可能是一个问题。</p><p id="5a13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应调查同一实体的冲突值。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cd57" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">复制</h1><p id="d24c" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">如果用户不小心提交了两次表单，或者您在没有意识到的情况下抓取了两次网站，或者在许多其他情况下，您可能会得到重复的数据。</p><h2 id="f964" class="nw md it bd me oh oi dn mi oj ok dp mm li ol om mo lm on oo mq lq op oq ms or bi translated">熊猫<code class="fe nk nl nm nn b">drop_duplicates()</code></h2><p id="a242" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">您可能拥有重复的整行，或者当一列应该是唯一的时，在该列中只有重复的值。</p><p id="2a5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">熊猫中的<code class="fe nk nl nm nn b">drop_duplicates()</code>功能在这两种情况下都可以使用。</p><p id="2467" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要么整行都是重复的，要么您可以使用<code class="fe nk nl nm nn b">subset</code>参数指定要检查重复的列，该参数采用列名列表。</p><p id="bc4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm nn b">keep</code>参数指定是否保留任何副本。默认是先有<em class="no">后有</em>，所以它会保留第一个副本并丢弃其余的副本。</p><p id="d8d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="no">最后一个</em>将删除除最后一次出现之外的所有重复项。<em class="no">假</em>会把<em class="no">全部</em>掉。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="713a" class="nw md it nn b gy nx ny l nz oa">df.drop_duplicates(inplace=True)</span></pre><p id="2d9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有就地运行它的选项。</p><p id="78db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/version/0.17/generated/pandas.DataFrame.drop_duplicates.html" rel="noopener ugc nofollow" target="_blank">文档</a>中阅读更多信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0bb0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">缺少值</h1><p id="5003" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">让我们再看一下数据集中空值的汇总，只是现在我们有了更少的列。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="6a45" class="nw md it nn b gy nx ny l nz oa">In [16]: df.isnull().sum()                                                         <br/>Out[16]: <br/>bin                    0<br/>issue_date             0<br/>number                 0<br/>violation_category     0<br/>violation_type         0<br/>violation_type_code    0<br/>dtype: int64</span></pre><p id="d88d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下没有丢失值。</p><p id="7ce5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">熊猫意识到一些东西缺少价值。</p><ul class=""><li id="3d1d" class="mu mv it lb b lc ld lf lg li oe lm of lq og lu nb nc nd ne bi translated">空单元格</li><li id="30aa" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">“那”</li><li id="a67a" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">如果数据的类型不适合列，例如，数字列中的字符串数据。</li></ul><h2 id="e7ec" class="nw md it bd me oh oi dn mi oj ok dp mm li ol om mo lm on oo mq lq op oq ms or bi translated">丢失的值怎么办？</h2><p id="febc" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">这可能是一个单独的职位，所以我只会总结。</p><p id="5393" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">首先，尝试找出数据丢失的原因</strong></p><p id="a357" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了建筑违规数据，似乎有理由认为违规应该总是有一个<code class="fe nk nl nm nn b">issue_date</code>，所以如果它丢失了，我会认为它可能有一个值，但它没有被正确记录，或者类似的事情。</p><p id="ed07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，像<code class="fe nk nl nm nn b">disposition_comments</code>(这是我之前删除的列之一，但我只是用它作为例子)这样的其他列可能没有输入注释，或者还没有输入，或者注释是可选的。所以它可能有一个空值。</p><p id="c409" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">阅读数据集的文档，尝试找出丢失数据的原因。</p><p id="a8c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">删除或替换</strong></p><p id="e8e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当数据集有缺失值或空值时，决定在项目环境中如何处理它们是很重要的。</p><p id="5400" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有两个基本选项。</p><ol class=""><li id="ad1c" class="mu mv it lb b lc ld lf lg li oe lm of lq og lu os nc nd ne bi translated">删除缺少值的行或列。</li><li id="b3c0" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu os nc nd ne bi translated">替换丢失的值。</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2934" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">删除</h1><p id="42ea" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">您可以使用<code class="fe nk nl nm nn b">dropna()</code>删除pandas中缺失/空值。</p><h2 id="2f5e" class="nw md it bd me oh oi dn mi oj ok dp mm li ol om mo lm on oo mq lq op oq ms or bi translated">列</h2><p id="0e0a" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">如果您想删除任何缺少值的列。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="e748" class="nw md it nn b gy nx ny l nz oa">df.dropna(inplace=True,axis=1)</span></pre><p id="078a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者删除有一定数量的缺失值的所有列。</p><p id="532a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以选择一个阈值并使用参数<code class="fe nk nl nm nn b">thresh</code> —该阈值是您希望该列具有的<em class="no">非</em> -null值的数量。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="0cfe" class="nw md it nn b gy nx ny l nz oa">df.dropna(thresh=int(df.shape[0] * .9), axis=1)</span></pre><p id="81ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将删除任何非 -NA值小于90%的列。</p><h2 id="a44c" class="nw md it bd me oh oi dn mi oj ok dp mm li ol om mo lm on oo mq lq op oq ms or bi translated">行</h2><p id="5f15" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">另一个选项是删除行。您可以选择删除任何在<em class="no">任意</em>列中缺少值的行。或者您可以删除列的子集中缺少值的行。</p><p id="0f5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我想分析每栋建筑的违规情况，我可以删除没有建筑标识号的行。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="4ce8" class="nw md it nn b gy nx ny l nz oa">df.dropna(subset=['bin'],inplace=True)</span></pre><p id="df90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm nn b">subset</code>参数允许您指定列的列表。<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.dropna.html" rel="noopener ugc nofollow" target="_blank">单据</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3f56" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">替换值</h1><h2 id="31e3" class="nw md it bd me oh oi dn mi oj ok dp mm li ol om mo lm on oo mq lq op oq ms or bi translated">熊猫<code class="fe nk nl nm nn b">fillna()</code></h2><p id="b1ae" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">调用数据帧上的<code class="fe nk nl nm nn b">fillna()</code>来填充缺失值。</p><p id="ac13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想用一个零来填充所有缺失的值。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="a95b" class="nw md it nn b gy nx ny l nz oa">df.fillna(0)</span></pre><p id="758a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者缺失值也可以通过传播同一列中它之前或之后的值来填充。<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.fillna.html#pandas.DataFrame.fillna" rel="noopener ugc nofollow" target="_blank">单据</a>。</p><p id="eada" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">反向传播价值观。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="f7c8" class="nw md it nn b gy nx ny l nz oa">df.fillna(method='bfill')</span></pre><p id="fb8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">向前传播价值观。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="2f1c" class="nw md it nn b gy nx ny l nz oa">df.fillna(method='ffill')</span></pre><p id="a6e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有许多方法可以确定用什么来替换丢失的数据。</p><ul class=""><li id="3d5f" class="mu mv it lb b lc ld lf lg li oe lm of lq og lu nb nc nd ne bi translated">中位数</li><li id="69fb" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">平均</li><li id="1463" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">定值</li><li id="a22b" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">回归预测正确值</li><li id="3edd" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">随机回归</li><li id="a24f" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">热卡插补-随机选取另一个在其他变量上具有相似值的行，并使用其值。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ed69" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用熊猫清理数据<code class="fe nk nl nm nn b">apply()</code></h1><p id="4c40" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">接下来，让我们清理一下<code class="fe nk nl nm nn b">violation_category</code>栏。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="313b" class="nw md it nn b gy nx ny l nz oa">In [9]: df['violation_category'].unique()<br/>Out[9]: <br/>array(['V*-DOB VIOLATION - Resolved',<br/>       'VW*-VIOLATION - WORK W/O PERMIT DISMISSED',<br/>       'V*-DOB VIOLATION - DISMISSED', 'V-DOB VIOLATION - ACTIVE',<br/>       'VP*-VIOLATION UNSERVED ECB- DISMISSED',<br/>       'VW-VIOLATION WORK WITHOUT PERMIT - ACTIVE',<br/>       'VPW*-VIOLATION UNSERVED ECB-WORK WITHOUT PERMIT-DISMISSED',<br/>       'VH-VIOLATION HAZARDOUS - ACTIVE',<br/>       'VH*-VIOLATION HAZARDOUS DISMISSED', nan,<br/>       'VP-VIOLATION UNSERVED ECB-ACTIVE', 'V%-UB VIOLATION',<br/>       'VPW-VIOLATION UNSERVED ECB-WORK WITHOUT PERMIT-ACTIVE'],<br/>      dtype=object)</span></pre><p id="0ba4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些分类来自这个网站上的<a class="ae ky" href="https://www1.nyc.gov/site/buildings/business/types-of-dob-violations.page" rel="noopener ugc nofollow" target="_blank">表格。</a></p><p id="a8ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些字符串中最能提供信息的部分是违规代码，它是字符串的第一部分，在'-'之前:<em class="no"> VW* </em>、<em class="no"> V* </em>、<em class="no"> V </em>等。</p><p id="cfa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你看链接表，代码后面的部分只是一串代码的意思。<em class="no"> VW </em>代码用于无许可证违章作业。</p><p id="4ba3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看看这两个违规类别。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="520a" class="nw md it nn b gy nx ny l nz oa">'V*-DOB VIOLATION - Resolved', <br/>'V*-DOB VIOLATION - DISMISSED'</span></pre><p id="ec82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个写着“已解决”，一个写着“驳回”，但他们的违规代码都是一样的，<em class="no"> V* </em>。</p><p id="e285" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个数据输入时缺乏验证的例子。</p><p id="3e85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据链接表，代码<em class="no"> V* </em>意味着违规被驳回，所以有人可能只是写了“已解决”,因为没有标准的数据输入方式。</p><p id="0f9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它看起来好像有比实际更多的违规类别，但这两个类别实际上代表的是已被驳回的同一DOB违规类别。</p><p id="df27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个非标准化格式的例子是，单词“without”在其中的几个中有不同的写法。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="4ff4" class="nw md it nn b gy nx ny l nz oa">'VW*-VIOLATION - WORK W/O PERMIT DISMISSED', <br/>'VW-VIOLATION WORK WITHOUT PERMIT - ACTIVE'</span></pre><p id="fac7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个代表不同的类别——<em class="no">VW *</em>和<em class="no"> VW </em>，但我只是把这种事情作为一个标志，以便更仔细地检查数据。</p><p id="88c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将通过用上面链接中的违规类别字符串数据创建一个代码字典<code class="fe nk nl nm nn b">dob_violation_codes</code>来清理这个问题，并从列中的每个条目中提取违规代码，并用我的字符串替换它。</p><p id="a025" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将使列中的值标准化。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="64ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这个要点里找到整本字典<a class="ae ky" href="https://gist.github.com/lvngd/594f77fafa7181ff0456aff239bcf11a" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="b9f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数通过提取违例代码子串并在字典中查找描述来替换<code class="fe nk nl nm nn b">df['violation_category']</code>中的值。</p><p id="9d07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果在字典中找不到代码，它就返回原来的值。</p><p id="7ea4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在调用<code class="fe nk nl nm nn b">df.apply()</code>并传递给它<code class="fe nk nl nm nn b">replace_value</code>函数。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="37e8" class="nw md it nn b gy nx ny l nz oa">In [10]: df['violation_category'] = df.apply(replace_value,axis=1)</span></pre><p id="45a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">列的缺省值是<code class="fe nk nl nm nn b">axis=0</code>，但是我们希望对每行都应用这个函数。</p><p id="dc7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在看看这一列中的唯一值。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="4930" class="nw md it nn b gy nx ny l nz oa">In [11]: df['violation_category'].unique()                                                                                                                    <br/>Out[11]: <br/>array(['V-DOB Violation', 'V*-DOB Violation Dismissed',<br/>       'VP-Violation Unserved ECB-Active',<br/>       'VP*-Violation Unserved ECB-Dismissed',<br/>       'VPW-Violation Pending - Work Without a Permit',<br/>       'VPW*-Violation Pending - Work Without a Permit Dismissed',<br/>       'V%-Precept issued for Unsafe Buildings Violation',<br/>       'VW-Violation - Work Without a Permit'], dtype=object)</span></pre><p id="19c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它看起来更整洁，并且我们对每个类别代码都有一个类别。</p><p id="3296" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这有意义——如果有任何问题，请告诉我！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="afd0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用NumPy清理文本数据<code class="fe nk nl nm nn b">where()</code></h1><p id="4943" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">接下来，我们来看看<code class="fe nk nl nm nn b">violation_type</code>栏。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="8114" class="nw md it nn b gy nx ny l nz oa">In [12]: df['violation_type'].head(10) <br/>Out[12]: <br/>0                                           E-ELEVATOR<br/>1                                       C-CONSTRUCTION<br/>2                                           E-ELEVATOR<br/>3                                           E-ELEVATOR<br/>4                    LL1081-LOCAL LAW 10/81 - ELEVATOR<br/>5                                           E-ELEVATOR<br/>6                     LL6291-LOCAL LAW 62/91 - BOILERS<br/>7    ACC1-(OTHER BLDGS TYPES) - ELEVATOR AFFIRMATIO...<br/>8                                           E-ELEVATOR<br/>9                                           E-ELEVATOR<br/>Name: violation_type, dtype: object</span></pre><p id="a3ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">调用<code class="fe nk nl nm nn b">violation_type</code>列上的<code class="fe nk nl nm nn b">unique()</code>来查看唯一值。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="3602" class="nw md it nn b gy nx ny l nz oa">In [13]: df['violation_type'].unique()<br/>Out[13]: <br/>array(['E-ELEVATOR', 'C-CONSTRUCTION',<br/>       'LL1081-LOCAL LAW 10/81 - ELEVATOR',<br/>       'LL6291-LOCAL LAW 62/91 - BOILERS',<br/>       'ACC1-(OTHER BLDGS TYPES) - ELEVATOR AFFIRMATION OF CORRECTION',<br/>       'LBLVIO-LOW PRESSURE BOILER', 'AEUHAZ1-FAIL TO CERTIFY CLASS 1',<br/>       'EVCAT1-ELEVATOR ANNUAL INSPECTION / TEST',<br/>       'FISPNRF-NO REPORT AND / OR LATE FILING (FACADE)',<br/>       'JVCAT5-RESIDENTIAL ELEVATOR PERIODIC INSPECTION/TEST',<br/>       'VCAT1-ELEVATOR ANNUAL INSPECTION / TEST',<br/>       'FISP-FACADE SAFETY PROGRAM', 'HBLVIO-HIGH PRESSURE BOILER',<br/>       'LL2604S-SPRINKLER', 'LANDMK-LANDMARK', 'UB-UNSAFE BUILDINGS',<br/>       'PA-PUBLIC ASSEMBLY', 'B-BOILER', 'LANDMRK-LANDMARK',<br/>       'EVCAT5-NON-RESIDENTIAL ELEVATOR PERIODIC INSPECTION/TEST',<br/>       'RWNRF-RETAINING WALL', 'LL1198-LOCAL LAW 11/98 - FACADE',<br/>       'ES-ELECTRIC SIGNS', 'LL1080-LOCAL LAW 10/80 - FACADE',<br/>       'P-PLUMBING', 'BENCH-FAILURE TO BENCHMARK',<br/>       'LL11/98-LOCAL LAW 11/98 - FACADE',<br/>       'L1198-LOCAL LAW 11/98 - FACADE', 'EARCX-FAILURE TO SUBMIT EER',<br/>       'JVIOS-PRIVATE RESIDENTIAL ELEVATOR', 'CMQ-MARQUEE',<br/>       'LL10/80-LOCAL LAW 10/80 - FACADE', 'LL5-LOCAL LAW 5/73',<br/>       'IMEGNCY-IMMEDIATE EMERGENCY', 'LL2604E-EMERGENCY POWER',<br/>       'Z-ZONING', 'EGNCY-EMERGENCY',<br/>       'HVIOS-NYCHA ELEV ANNUAL INSPECTION/TEST',<br/>       'ACH1-(NYCHA) - ELEVATOR AFFIRMATION OF CORRECTION',<br/>       'ACJ1-(PRIVATE RESIDENCE) - ELEVATOR AFFIRMATION OF CORRECTION',<br/>       'CS-SITE SAFETY', 'LL10/81-LOCAL LAW 10/81 - ELEVATOR',<br/>       'LL2604-PHOTOLUMINESCENT', 'A-SEU', 'CLOS-PADLOCK',<br/>       'LL16-LOCAL LAW 16/84 - ELEVATOR',<br/>       'HVCAT5-NYCHA ELEVATOR PERIODIC INSPECTION/TEST'], dtype=object)</span></pre><p id="e218" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前还不清楚其中的一些是什么，但其中许多都与电梯、锅炉、建筑违规、管道等类似的事情有关。</p><p id="e310" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我只是想从总体上看一下最常见的违规类型。</p><p id="0464" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看看每一个的价值计数。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="bdea" class="nw md it nn b gy nx ny l nz oa">In [27]: df['violation_type'].value_counts() <br/>Out[27]: <br/>E-ELEVATOR                                                       3202<br/>LL6291-LOCAL LAW 62/91 - BOILERS                                 2748<br/>LBLVIO-LOW PRESSURE BOILER                                        832<br/>C-CONSTRUCTION                                                    819<br/>AEUHAZ1-FAIL TO CERTIFY CLASS 1                                   559<br/>LL1081-LOCAL LAW 10/81 - ELEVATOR                                 374<br/>ACC1-(OTHER BLDGS TYPES) - ELEVATOR AFFIRMATION OF CORRECTION     305<br/>EVCAT1-ELEVATOR ANNUAL INSPECTION / TEST                          235<br/>BENCH-FAILURE TO BENCHMARK                                        120<br/>LANDMK-LANDMARK                                                   105<br/>UB-UNSAFE BUILDINGS                                                68<br/>P-PLUMBING                                                         56<br/>ES-ELECTRIC SIGNS                                                  51<br/>FISPNRF-NO REPORT AND / OR LATE FILING (FACADE)                    47<br/>EVCAT5-NON-RESIDENTIAL ELEVATOR PERIODIC INSPECTION/TEST           40<br/>Z-ZONING                                                           33<br/>EARCX-FAILURE TO SUBMIT EER                                        32<br/>JVIOS-PRIVATE RESIDENTIAL ELEVATOR                                 32<br/>B-BOILER                                                           31<br/>L1198-LOCAL LAW 11/98 - FACADE                                     31<br/>LL1198-LOCAL LAW 11/98 - FACADE                                    28<br/>VCAT1-ELEVATOR ANNUAL INSPECTION / TEST                            27<br/>IMEGNCY-IMMEDIATE EMERGENCY                                        24<br/>CMQ-MARQUEE                                                        23<br/>EGNCY-EMERGENCY                                                    22<br/>LL11/98-LOCAL LAW 11/98 - FACADE                                   20<br/>LANDMRK-LANDMARK                                                   18<br/>FISP-FACADE SAFETY PROGRAM                                         16<br/>LL1080-LOCAL LAW 10/80 - FACADE                                    14<br/>LL10/80-LOCAL LAW 10/80 - FACADE                                   11<br/>HBLVIO-HIGH PRESSURE BOILER                                        10<br/>PA-PUBLIC ASSEMBLY                                                  9<br/>ACH1-(NYCHA) - ELEVATOR AFFIRMATION OF CORRECTION                   9<br/>RWNRF-RETAINING WALL                                                9<br/>LL2604S-SPRINKLER                                                   6<br/>LL2604E-EMERGENCY POWER                                             5<br/>JVCAT5-RESIDENTIAL ELEVATOR PERIODIC INSPECTION/TEST                5<br/>LL5-LOCAL LAW 5/73                                                  4<br/>CS-SITE SAFETY                                                      4<br/>HVIOS-NYCHA ELEV ANNUAL INSPECTION/TEST                             3<br/>ACJ1-(PRIVATE RESIDENCE) - ELEVATOR AFFIRMATION OF CORRECTION       3<br/>LL10/81-LOCAL LAW 10/81 - ELEVATOR                                  2<br/>LL2604-PHOTOLUMINESCENT                                             2<br/>LL16-LOCAL LAW 16/84 - ELEVATOR                                     2<br/>CLOS-PADLOCK                                                        2<br/>A-SEU                                                               1<br/>HVCAT5-NYCHA ELEVATOR PERIODIC INSPECTION/TEST                      1<br/>Name: violation_type, dtype: int64</span></pre><p id="dda8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数违规行为都与电梯和锅炉有关。</p><p id="0528" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我主要感兴趣的是查看违规的一般类型，因此这里我将把任何与电梯相关的违规重新标记为“电梯”，将锅炉违规重新标记为“锅炉”，以使其更清晰。</p><p id="3929" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可以通过NumPy的<code class="fe nk nl nm nn b">where()</code>函数来完成。<a class="ae ky" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.where.html" rel="noopener ugc nofollow" target="_blank">单据</a>。</p><p id="f7b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">格式为<code class="fe nk nl nm nn b">np.where(condition[, x, y])</code>。</p><p id="84ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它采用一个布尔数组，然后如果数组中的一项是<code class="fe nk nl nm nn b">True</code>，则产生x，否则产生y。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="f836" class="nw md it nn b gy nx ny l nz oa">elevators = df['violation_type'].str.contains('ELEVATOR') <br/>boilers = df['violation_type'].str.contains('BOILER') </span><span id="dc21" class="nw md it nn b gy ob ny l nz oa">df['violation_type'] = np.where(elevators,'ELEVATOR', np.where(boilers, 'BOILER', df['violation_type'])</span></pre><p id="7881" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对列调用<code class="fe nk nl nm nn b">str.contains(substring)</code>会返回一个布尔掩码，表明该行是否包含<code class="fe nk nl nm nn b">substring</code>。</p><p id="88c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以嵌套<code class="fe nk nl nm nn b">np.where()</code>调用，因此，在本例中，我嵌套了对“BOILER”的搜索，然后如果既没有找到“ELEVATOR”也没有找到“BOILER”，就返回<code class="fe nk nl nm nn b">df['violation_type']</code>的内容。</p><p id="3fe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看看现在的价值计数。</p><pre class="kj kk kl km gt ns nn nt nu aw nv bi"><span id="e846" class="nw md it nn b gy nx ny l nz oa">In [8]: df['violation_type'].value_counts()                                                                                                                           <br/>Out[8]: <br/>ELEVATOR                                           4412<br/>AEUHAZ1-FAIL TO CERTIFY CLASS 1                    1856<br/>BOILER                                             1550<br/>BENCH-FAILURE TO BENCHMARK                          993<br/>C-CONSTRUCTION                                      394<br/>FISPNRF-NO REPORT AND / OR LATE FILING (FACADE)     179<br/>RWNRF-RETAINING WALL                                138<br/>LL2604S-SPRINKLER                                   107<br/>EARCX-FAILURE TO SUBMIT EER                         100<br/>FISP-FACADE SAFETY PROGRAM                           73<br/>P-PLUMBING                                           72<br/>IMEGNCY-IMMEDIATE EMERGENCY                          40<br/>LANDMK-LANDMARK                                      35<br/>UB-UNSAFE BUILDINGS                                  19<br/>HVIOS-NYCHA ELEV ANNUAL INSPECTION/TEST              14<br/>EGNCY-EMERGENCY                                      10<br/>Z-ZONING                                              4<br/>CLOS-PADLOCK                                          3<br/>CS-SITE SAFETY                                        1<br/>Name: violation_type, dtype: int64</span></pre><p id="31b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了进一步澄清这一点，我想研究其他违规类型，如“aeu HAZ 1-未能认证类1 '”—不清楚这是什么。</p><p id="802f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时你必须挖掘更多关于数据集的信息。</p><p id="e8c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将让读者查看其他列，看看如何用NumPy <code class="fe nk nl nm nn b">where()</code>或pandas <code class="fe nk nl nm nn b">apply()</code>函数清理它们。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d2ec" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">正常化</h1><p id="7283" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">您可能不经常需要对您的数据进行规范化，只有当您想要进行依赖于正态分布数据的统计分析时才需要这样做，如t检验、ANOVA、线性回归等。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fc39" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">文本规范化</h1><p id="d042" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">如果你在做<a class="ae ky" href="https://en.wikipedia.org/wiki/Natural_language_processing" rel="noopener ugc nofollow" target="_blank">自然语言处理</a>，作为预处理的一部分，你可能需要规范化你的文本，使其更加统一。</p><p id="77fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它可能涉及多种技术。</p><ul class=""><li id="d7db" class="mu mv it lb b lc ld lf lg li oe lm of lq og lu nb nc nd ne bi translated">标记化</li><li id="e1fc" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">删除空白</li><li id="eb66" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">删除标点符号</li><li id="2476" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">删除任何非字母数字字符</li><li id="300e" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">堵塞物</li><li id="b2d3" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">词汇化</li><li id="9d1f" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">删除停用词</li><li id="84b6" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">在英语中，你可以把英式英语转换成美式英语。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5dab" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">感谢阅读！</h1><p id="c44c" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">Pandas是一个非常有用的数据清理和操作工具，任何人都可以把它放在自己的数据工具箱里。</p><p id="2280" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一本对熊猫来说很有参考价值的书是<a class="ae ky" href="http://shop.oreilly.com/product/0636920023784.do" rel="noopener ugc nofollow" target="_blank"> Python for Data Analysis </a>。它是由韦斯·麦金尼写的，他是熊猫的主要作者之一。</p><p id="6f53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，如果您有任何问题或意见，请告诉我！把它们写在下面。</p></div></div>    
</body>
</html>