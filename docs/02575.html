<html>
<head>
<title>Creating Curved Lines in Google Maps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌地图中创建曲线</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/curved-lines-on-google-maps-2938bbb15f6a?source=collection_archive---------16-----------------------#2019-12-09">https://betterprogramming.pub/curved-lines-on-google-maps-2938bbb15f6a?source=collection_archive---------16-----------------------#2019-12-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="32a6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有时候你不想曲折，你想跳跃</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/778b8118cc8ff05d0a2bff124ee7aeb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*68Yr1yw0nQE8eLHylnPYfw.png"/></div></div></figure><p id="1830" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">难度:容易| <strong class="kw iu">中等</strong> |困难。</p><p id="fb33" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你不知道，<a class="ae lq" href="https://cloud.google.com/maps-platform/" rel="noopener ugc nofollow" target="_blank"> Google Maps </a>现在当你使用<a class="ae lq" href="https://developers.google.com/maps/documentation/directions/start" rel="noopener ugc nofollow" target="_blank">Google Directions API</a>绘制一条从地点A到地点b的路线时要花很多钱。</p><p id="6c13" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如今，一些公司像优步一样将真实路线转换成直线，或者像Deliveree一样转换成曲线。</p><p id="b766" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，我认为这篇文章将对你们所有人有所帮助:</p><ul class=""><li id="4cd3" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">想要创建一个新的样式来绘制路线。</li><li id="e62d" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">不想赔钱，把它装进谷歌地图的口袋。</li></ul></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="5c06" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">画一条曲线有什么解决方法？</h1><p id="8b00" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">如果要画一条直线连接A点和B点，需要知道A点坐标和B点坐标。</p><p id="1d36" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好的。用一条曲线，它结合了很多很多和直线结合的微小点。所以，主要的解决方法是找到曲线上每个点的坐标。</p><p id="870f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们给这些点命名，如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/bc0b6b13b3da0e1eb1a0875544de3d8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FVsLgwH_bowwP0k_Nplkyw.png"/></div></div></figure><p id="0495" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，创建一个初始路径:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/afecc7ba8567e42b593f102f1513eb86.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*USJX4XcAfWmlXhozLOgP0Q.png"/></div></figure><h2 id="57fc" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated">第一步。计算SE</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/7f6fc32a4ba7f9587d040b90089647bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*EzyHqerUTxOxFyZYaMiFig.png"/></div></figure><p id="5a60" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Google Maps支持我们用<code class="fe ny nz oa ob b">GMSGeometryDistance</code> <strong class="kw iu"> </strong>函数得到地图上两点之间的距离(单位是米)。</p><h2 id="de5c" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated">第二步。为角度定义一个合适的数字</h2><p id="05fe" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">我们必须为角度选择一个合适的数字。如果角度太大，O(中心点)可以离S或E非常远，曲线反而看起来像直线。</p><p id="79ba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我的建议是小于π/2。角度越小，曲线越能弯曲。</p><h2 id="f4ec" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated">第三步。计算生产订单</h2><p id="6d05" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">因为我们也必须知道半径，所以我们用公式来计算半径和MO。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/efcee30579f23a04cb0ec987e26ca545.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZfzBe8FnpYviKY1otHlZjg.png"/></div></div></figure><p id="2bdd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里有几行代码可以帮助你计算R和MO:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/02744eb9694bbb65b720f3e59bc89911.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*kfkGdtCjh1e31zkfrob5Jw.png"/></div></figure><h2 id="4077" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated"><strong class="ak">第四步。计算O的坐标</strong></h2><p id="3bed" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">谷歌地图支持我们:</p><p id="71d5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe ny nz oa ob b">GMSGeometryHeading</code></p><p id="baa1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">返回到<code class="fe ny nz oa ob b">to</code>的最短路径上<code class="fe ny nz oa ob b">from</code>处的初始航向(北顺时针度数)。</p><p id="80cc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">返回值在范围[0，360]内。</p><p id="1fc1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">并且:</p><p id="f686" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe ny nz oa ob b">GMSGeometryOffset</code></p><p id="3b49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">返回从地球上的<code class="fe ny nz oa ob b">from</code>开始，以<code class="fe ny nz oa ob b">heading</code>开头，沿着一个大圆弧以米为单位移动<code class="fe ny nz oa ob b">distance</code>时的目的地坐标。</p><p id="9fd7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">得到的经度在[-180，180]范围内。</p><p id="be3e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将结合<code class="fe ny nz oa ob b">GMSGeometryHeading</code> <strong class="kw iu"> </strong>和<strong class="kw iu"> </strong> <code class="fe ny nz oa ob b">GMSGeometryOffset</code> <strong class="kw iu"> </strong>来寻找M的坐标。</p><p id="4be1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从开始位置到结束位置的方向:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/ce23c42ac7d1cfec83954b1161cbb131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*KtARDGVz6G7hYWVHZdPo9w.png"/></div></figure><p id="94c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因为S、M和E在同一直线上，所以我们可以用以下公式求出M的坐标:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/e48a49454c3fc56174323c4b5ba0e79f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*vH7wdDZf7G-cbYMU0hd2Kg.png"/></div></figure><p id="bb6e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，求O的坐标。</p><p id="fa60" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">O有两个坐标，如下图所示，我们有蓝色的O和红色的O。为了简化，我们可以选择一个。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/de53f944164568395bcb0195a2279f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*HQp-5kedkZUddEEBQ0uC_Q.png"/></div></figure><p id="eb8b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对我来说，我想用基于南纬和东经的公式选择一个方向。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/7b633ec983d0bb9beca745cdc0b62ad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*j-WNQt1xIxXTvbxaNsFKUQ.png"/></div></figure><p id="1330" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们有了O的坐标:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/e9550a668e48d567c28130ded3b4eb58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*89is0Qe107GWrViHjnQKXQ.png"/></div></figure><h2 id="f1b2" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated"><strong class="ak">第五步。</strong> <em class="oj">用不同的角度找到曲线上的每个位置(a1，a2，…an) </em></h2><p id="1b86" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">这是画曲线的主要部分。你需要把角度拆分成<em class="ok"> n </em>更小的角度，然后结合R-radius和O的坐标，找到曲线上每个点的坐标。</p><p id="fae7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我的例子中，曲线需要有100个主点。</p><p id="8d71" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是我定义曲线上每个位置的代码。计算每个位置的坐标，并将它们添加到我们上面创建的初始路径中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/8e08bf4c10e9ba01d74dc18c3d0a3468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DYnTnPqhEG15FN9gip1jmw.png"/></div></div></figure><h2 id="a069" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated">第六步。将GMSMutablePath转换为GMSPolyline</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/eae99c5772459d3da7a1187b158feb69.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*oOE7k3NX0g5KN3UWxJ-oJw.png"/></div></figure><p id="a71b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我将<code class="fe ny nz oa ob b">GMSMutablePath</code>转换为<code class="fe ny nz oa ob b">GMSPolyline</code> <strong class="kw iu"> </strong>并添加到地图视图中，以及设置描边宽度和描边颜色。</p><p id="be99" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">是的，就这样。现在我们有了绘制曲线所需的所有代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/1e39fb6211e8eebc52aca72fba437a93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YzvvH1wXzM-nZrw3RJRvAw.png"/></div></div></figure><p id="4243" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，运行它，我试着画一条从伦敦到剑桥的曲线<strong class="kw iu"> </strong>并自定义，看看结果如何。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/0f7c89d0a8ea8a2b06e6ce5ac071bcf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rP3Xh7SVxmo37SGEaVuA4A.png"/></div></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="4a07" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated"><strong class="ak">总结</strong></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/a653d7e3e872fb4b1bac568bc4793175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wZkNspkcbuxAmnvzezxhag.png"/></div></div></figure><p id="8950" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里是我在GitHub 上的<a class="ae lq" href="https://github.com/ryanisnhp/CuvredLine" rel="noopener ugc nofollow" target="_blank">回购，大家可以看看！</a></p><p id="8e8d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">和平！</p></div></div>    
</body>
</html>