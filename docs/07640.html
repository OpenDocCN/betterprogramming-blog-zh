<html>
<head>
<title>Getting Started With Elasticsearch in Java Spring Boot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java Spring Boot elastic search入门</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-elasticsearch-in-java-spring-boot-d981c32b60b?source=collection_archive---------2-----------------------#2021-02-04">https://betterprogramming.pub/getting-started-with-elasticsearch-in-java-spring-boot-d981c32b60b?source=collection_archive---------2-----------------------#2021-02-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ddf4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用Elasticsearch连接Spring Boot</h2></div><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/b4268bac4ddb48eab440109945866518.png" data-original-src="https://miro.medium.com/v2/0*fyymAPzrwHiq6VDR"/></div></figure><p id="ecbe" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Java和Elasticsearch都是公司使用的通用技术栈中的流行元素。Java是一种编程语言，发布于1996年。Java归甲骨文所有，仍在积极开发中。</p><p id="9953" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">与Java相比，Elasticsearch是一项年轻的技术——它在2010年才发布(比Java年轻14岁)。它迅速流行起来，现在被许多公司用作搜索引擎。</p><p id="7e12" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">看到这两者如此受欢迎，许多人和公司希望将Java与Elasticsearch连接起来，以便开发自己的搜索引擎。在这篇文章中，我想教你如何连接Java Spring Boot 2和Elasticsearch。我们将学习如何创建一个调用Elasticsearch来产生结果的API。</p></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="4129" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">将Java与Elasticsearch连接起来</h1><p id="775c" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">我们必须做的第一件事是将我们的Spring Boot项目与Elasticsearch连接起来。最简单的方法是使用Elasticsearch提供的客户端库，我们可以将它添加到我们的包管理器中(如Maven或Gradle)。</p><p id="e3ca" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">对于本文，我们将使用Spring Data提供的<code class="fe mq mr ms mt b"><a class="ae mu" href="https://spring.io/projects/spring-data-elasticsearch" rel="noopener ugc nofollow" target="_blank">spring-data-elasticsearch</a></code>库，其中也包括Elasticsearch的<a class="ae mu" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/master/java-rest-high.html" rel="noopener ugc nofollow" target="_blank">高级客户端库</a>。</p><h2 id="20b7" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">开始我们的项目</h2><p id="d15d" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">让我们从使用<a class="ae mu" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank"> Spring Initialzr </a>创建我们的Spring Boot项目开始。我将配置我的项目，如下图所示，因为我们将使用一个高级客户端。然后我们可以使用Spring提供的一个方便的库，Spring Data Elasticsearch:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/fb786f67860e481587557e2e10b36e3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bwv2vJx7BsZfROJc.png"/></div></div></figure><h2 id="f8da" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">向Spring数据弹性搜索添加依赖性</h2><p id="e6bf" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">如果您遵循了上一节中我的Spring Initialzr配置，那么您的项目中应该已经有了Elasticsearch客户端依赖项。但如果没有，可以补充一下:</p><pre class="ki kj kk kl gt nm mt nn no aw np bi"><span id="830a" class="mv lu it mt b gy nq nr l ns nt">&lt;dependency&gt;<br/>  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>  &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;<br/>&lt;/dependency&gt;</span></pre><h2 id="3da6" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">创建Elasticsearch客户端的bean</h2><p id="74cc" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">有两种方法来初始化bean——您可以使用Spring Data Elasticsearch库中定义的bean，也可以创建自己的bean。</p><p id="3dca" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">更简单的选择是使用Spring Data Elasticsearch配置的bean。</p><p id="f9d0" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">例如，您可以将这些属性添加到您的<code class="fe mq mr ms mt b">application.properties</code>中:</p><pre class="ki kj kk kl gt nm mt nn no aw np bi"><span id="951d" class="mv lu it mt b gy nq nr l ns nt">spring.elasticsearch.rest.uris=localhost:9200<br/>spring.elasticsearch.rest.connection-timeout=1s<br/>spring.elasticsearch.rest.read-timeout=1m<br/>spring.elasticsearch.rest.password=<br/>spring.elasticsearch.rest.username=</span></pre><p id="3aa7" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">第二种方法是创建自己的bean。您可以通过创建<code class="fe mq mr ms mt b">RestHighLevelClient</code> bean来配置设置。如果bean存在，Spring Data将使用它作为它的配置。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="faa5" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">测试从我们的Spring Boot应用程序到Elasticsearch的连接</h2><p id="d072" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">现在您已经配置了bean，您的Spring Boot应用程序和Elasticsearch应该已经连接了。由于我们要测试连接，请确保您的Elasticsearch已启动并运行！</p><p id="8dc5" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了测试它，我们可以创建一个bean，它将在<code class="fe mq mr ms mt b">DemoApplication.java</code>中的Elasticsearch中创建一个索引。该类看起来像这样:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="b20a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">好的，在这段代码中，我们用<code class="fe mq mr ms mt b">RestHighLevelClient,</code>调用了Elasticsearch两次，我们将在本文稍后学习。第一个调用是删除已经存在的索引。我们用了一个<code class="fe mq mr ms mt b">try</code> / <code class="fe mq mr ms mt b">catch</code>来表示，因为如果索引不存在。然后elasticsearch将抛出一个错误，导致我们的应用程序启动失败。</p><p id="32de" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">第二个调用是创建一个索引。因为我只运行单节点的Elasticsearch，所以我将碎片配置为<code class="fe mq mr ms mt b">1</code>，副本配置为<code class="fe mq mr ms mt b">0</code>。</p><p id="65d3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果一切顺利，那么当你检查你的弹性搜索时，你应该看到指数。要检查它，只需转到<code class="fe mq mr ms mt b"><a class="ae mu" href="http://localhost:9200/_cat/indices?v" rel="noopener ugc nofollow" target="_blank">http://localhost:9200/_cat/indices?v</a></code>，您可以在您的弹性搜索中看到指数列表:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="c124" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">恭喜你。您只需将您的应用程序连接到Elasticsearch！！</p></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="4ab4" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">其他连接方式</h1><p id="7ed9" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">如果你想用Java连接到Elasticsearch，我推荐你使用<code class="fe mq mr ms mt b">spring-data-elasticsearch</code>库。但如果你不能使用这个库，还有一种方法可以将你的应用程序连接到Elasticsearch。</p><h2 id="03db" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">高级客户</h2><p id="2b28" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">从上一节我们知道，我们使用的<code class="fe mq mr ms mt b">spring-data-elasticsearch</code>库也包括Elasticsearch的高级客户端。如果你已经导入了<code class="fe mq mr ms mt b">spring-data-elasticsearch</code>，那么你已经可以使用Elasticsearch的高级客户端了。</p><p id="9438" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果你愿意，也可以不依赖Spring数据，直接使用高级客户端库。您只需要在依赖项管理器中添加这个依赖项:</p><pre class="ki kj kk kl gt nm mt nn no aw np bi"><span id="ee06" class="mv lu it mt b gy nq nr l ns nt">&lt;dependency&gt;<br/>    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;<br/>    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;<br/>    &lt;version&gt;8.0.0&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="9cf7" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们也将在我们的例子中使用这个客户端，因为高级客户端的功能比<code class="fe mq mr ms mt b">spring-data-elasticsearch.</code>更完整</p><p id="57d8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">有关更多信息，您可以阅读<a class="ae mu" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/master/java-rest-high-getting-started.html" rel="noopener ugc nofollow" target="_blank"> Elasticsearch文档</a>。</p><h2 id="dd78" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">低级客户</h2><p id="9896" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">使用这个库会比较困难，但是可以对它进行更多的定制。要使用它，您可以添加以下依赖项:</p><pre class="ki kj kk kl gt nm mt nn no aw np bi"><span id="37c1" class="mv lu it mt b gy nq nr l ns nt">&lt;dependency&gt;<br/>    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;<br/>    &lt;artifactId&gt;elasticsearch-rest-client&lt;/artifactId&gt;<br/>    &lt;version&gt;8.0.0&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="1ac3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">要了解更多信息，你可以阅读关于这方面的<a class="ae mu" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/master/java-rest-low.html" rel="noopener ugc nofollow" target="_blank"> Elasticsearch的文档</a>。</p><h2 id="f413" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">传输客户端</h2><p id="0f2b" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">Elasticsearch还提供了transport client，这将使您的应用程序标识为Elasticsearch的节点之一。我不推荐这种方法，因为它很快就会被弃用。</p><p id="07e0" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果你感兴趣，你可以在这里阅读关于运输客户端<a class="ae mu" href="https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/transport-client.html" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="cc60" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">休息呼叫</h2><p id="8601" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">连接到Elasticsearch的最后一种方法是进行REST调用。由于Elasticsearch使用REST API连接到它的客户端，所以基本上可以使用REST调用将您的应用程序连接到Elasticsearch。您可以使用OkHttp、Feign或您的web客户端将您的应用程序与Elasticsearch连接起来。</p><p id="4600" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我也不推荐这种方法，因为很麻烦。既然Elasticsearch已经提供了客户端库，不如用它们来代替。只有在没有其他连接方式的情况下，才使用此方法。</p></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="22e5" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">使用Spring数据弹性搜索</h1><p id="9fb2" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">首先，让我们学习如何在我们的Spring项目中使用<code class="fe mq mr ms mt b">spring-data-elasticsearch</code>。<code class="fe mq mr ms mt b">spring-data-elasticsearch</code>非常易于使用，是一个高水平的库，我们可以使用它来访问Elasticsearch。</p><h2 id="3fe5" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">创建实体并配置我们的索引</h2><p id="4d71" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">当你用Elasticsearch连接好你的应用程序后，是时候创建一个实体了！使用Spring数据，我们可以将元数据添加到我们的实体中，这些元数据将被我们创建的存储库bean读取。这样，代码将会更干净，开发起来也更快，因为我们不需要在我们的服务级别中创建任何映射逻辑。</p><p id="5bd3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">让我们创建一个名为<code class="fe mq mr ms mt b">Product</code>的实体:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="54bf" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">所以让我解释一下上面的代码块是怎么回事。首先，我不会解释<code class="fe mq mr ms mt b">@Data</code>、<code class="fe mq mr ms mt b">@AllArgsConstructor</code>、<code class="fe mq mr ms mt b">@NoArgsConstructor</code>和<code class="fe mq mr ms mt b">@Builder</code>。它们是来自<a class="ae mu" href="https://projectlombok.org/" rel="noopener ugc nofollow" target="_blank"> Lombok库</a>的注释，用于<code class="fe mq mr ms mt b">constructor</code>、<code class="fe mq mr ms mt b">getter</code>、<code class="fe mq mr ms mt b">setter</code>、<code class="fe mq mr ms mt b">builder</code>和其他东西。</p><p id="42ec" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在来说说实体中的第一个弹簧数据标注，<code class="fe mq mr ms mt b">@Document</code>。<code class="fe mq mr ms mt b">@Document</code>注释显示该类是一个包含Elasticsearch索引设置元数据的实体。为了使用Spring数据存储库(我们将在后面学习)，必须使用<code class="fe mq mr ms mt b">@Document</code>注释。</p><p id="a02a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在<code class="fe mq mr ms mt b">@Document</code>中唯一强制的注释是<code class="fe mq mr ms mt b">indexName</code>。从名称上看应该很清楚——我们应该用我们想要用于实体的索引名来填充它。在本文中，我们将使用与实体相同的名称，<code class="fe mq mr ms mt b">product</code>。</p><p id="45af" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe mq mr ms mt b">@Document</code>要讲的第二个参数是<code class="fe mq mr ms mt b">createIndex</code>参数。如果您将<code class="fe mq mr ms mt b">createIndex</code>设置为<code class="fe mq mr ms mt b">true</code>，当您启动应用程序时，如果索引尚不存在，您的应用程序将自动创建一个索引。</p><p id="bd3b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">创建步进时，<code class="fe mq mr ms mt b">shards</code>、<code class="fe mq mr ms mt b">replicas</code>和<code class="fe mq mr ms mt b">refreshInterval</code>参数决定步进设置。如果在创建索引后更改这些参数的值，则不会应用这些设置。因此，只有在第一次创建索引时，才会使用这些参数。</p><p id="b376" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果想在Elasticsearch中使用自定义ID，可以使用<code class="fe mq mr ms mt b">@Id</code>注释。如果使用<code class="fe mq mr ms mt b">@Id</code>注释，Spring Data会告诉Elasticsearch将ID存储在文档中，并存储文档源。</p><p id="3021" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe mq mr ms mt b">@Field</code>类型将决定字段的<a class="ae mu" href="https://www.google.com/search?q=elasticsearch+mapping&amp;oq=elasticsearch+mapping&amp;aqs=chrome..69i57.2238j0j1&amp;sourceid=chrome&amp;ie=UTF-8" rel="noopener ugc nofollow" target="_blank">字段映射</a>。与<code class="fe mq mr ms mt b">shards</code>、<code class="fe mq mr ms mt b">replicas</code>和<code class="fe mq mr ms mt b">refreshInterval</code>一样，<code class="fe mq mr ms mt b">@Field</code>类型只会在首次创建索引时影响Elasticsearch。如果在已经创建索引的情况下添加一个新字段或更改类型，它不会做任何事情。</p><p id="c113" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">既然我们已经配置了实体，那么让我们来试试通过Spring数据自动创建索引吧！当我们将<code class="fe mq mr ms mt b">createIndex</code>配置为<code class="fe mq mr ms mt b">true</code>时，Spring Data会检查该索引是否存在于Elasticsearch中。如果它不存在，Spring Data将使用我们在实体中创建的配置创建索引。</p><p id="c59f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">让我们开始我们的应用程序。运行后，让我们检查设置，看看它是否正确:</p><pre class="ki kj kk kl gt nm mt nn no aw np bi"><span id="1378" class="mv lu it mt b gy nq nr l ns nt">curl --request GET \<br/>  --url <a class="ae mu" href="http://localhost:9200/product/_settings" rel="noopener ugc nofollow" target="_blank">http://localhost:9200/product/_settings</a></span></pre><p id="b24b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">结果是:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="a10b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一切都按照我们的配置！将<code class="fe mq mr ms mt b">refresh_interval</code>设置为<code class="fe mq mr ms mt b">5s</code>，<code class="fe mq mr ms mt b">number_of_shards</code>为<code class="fe mq mr ms mt b">1</code>，<code class="fe mq mr ms mt b">number_of_replicas</code>为<code class="fe mq mr ms mt b">0</code>。</p><p id="c4e7" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在让我们检查映射:</p><pre class="ki kj kk kl gt nm mt nn no aw np bi"><span id="cebe" class="mv lu it mt b gy nq nr l ns nt">curl --request GET \<br/>  --url <a class="ae mu" href="http://localhost:9200/product/_mappings" rel="noopener ugc nofollow" target="_blank">http://localhost:9200/product/_mappings</a></span></pre><p id="a163" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">结果是:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="98e9" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">映射也和我们预期的一样。这和我们在实体类中配置的一样。</p><h2 id="2848" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">带有Spring数据仓库接口的基本CRUD</h2><p id="819b" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">创建完实体后，我们就拥有了在Spring Boot创建存储库接口所需的一切。让我们创建一个名为<code class="fe mq mr ms mt b">ProductRepository</code>的存储库。</p><p id="a15d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">当你创建一个接口时，确保扩展<code class="fe mq mr ms mt b">ElasticsearchRepository&lt;T, U&gt;</code>。在这种情况下，<code class="fe mq mr ms mt b">T</code>对象是您的实体，而<code class="fe mq mr ms mt b">U</code>对象类型是您想要用于数据ID的类型。在我们的例子中，我们将使用之前创建的<code class="fe mq mr ms mt b">Product</code>实体作为<code class="fe mq mr ms mt b">T</code>，使用<code class="fe mq mr ms mt b">String</code>作为<code class="fe mq mr ms mt b">U</code>。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="d035" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">既然您的存储库接口已经完成，您就不需要关心实现了，因为Spring已经在处理了。现在，您可以调用存储库扩展到的类中的每个函数。</p><p id="b9e6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">对于CRUD的示例，您可以查看下面的代码:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="7058" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在上面的代码块中，我们创建了一个名为<code class="fe mq mr ms mt b">SpringDataProductServiceImpl</code>的服务类，它自动绑定到我们之前创建的<code class="fe mq mr ms mt b">ProductRepository</code>。</p><p id="b78d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">其中有四个基本CRUD函数。第一个是<code class="fe mq mr ms mt b">createProduct</code>，顾名思义，会在<code class="fe mq mr ms mt b">product</code>索引中创建一个新产品。第二个是<code class="fe mq mr ms mt b">getProduct</code>，获取我们通过ID索引的产品。<code class="fe mq mr ms mt b">deleteProduct</code>功能可用于删除ID索引中的产品。<code class="fe mq mr ms mt b">insertBulk</code>功能允许您将多个产品插入到Elasticsearch中。</p><p id="d069" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一切都结束了！我不会在本文中写API测试，因为我想把重点放在我们的应用程序如何与Elasticsearch交互上。但是如果你想尝试这个API，我在文章末尾留了一个GitHub链接，这样你就可以克隆并尝试这个项目。</p><h2 id="ee0c" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">Spring数据中的自定义查询方法</h2><p id="53f1" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">在上一节中，我们只利用了已经在其他类中定义的基本方法。但是我们也可以创建自定义的查询方法来使用。</p><p id="c199" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Spring Data非常方便的一点是，您可以在存储库接口中创建一个方法，并且不需要编写任何实现代码。Spring数据库将读取存储库并自动为其创建实现。</p><p id="5ef2" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">让我们尝试通过<code class="fe mq mr ms mt b">name</code>字段搜索产品:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="08b8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">是的，这就是在Spring数据存储库接口中创建一个函数所需要做的全部工作。</p><p id="c1b1" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您还可以使用<code class="fe mq mr ms mt b">@Query</code>注释定义一个定制查询，并在参数中插入一个JSON查询。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="7ea1" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们创建的这两种方法做的是同样的事情——使用带<code class="fe mq mr ms mt b">name</code>参数的<code class="fe mq mr ms mt b">match</code>查询。如果你试一试，你会得到同样的结果。</p><h2 id="bf02" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">使用ElasticsearchRestTemplate</h2><p id="f2f7" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">如果您想进行更高级的查询，比如聚合、突出显示或建议，您可以使用Spring数据库提供的<code class="fe mq mr ms mt b">ElasticsearchsearchRestTemplate</code>。通过使用它，您可以创建自己的查询，让它变得尽可能复杂。</p><p id="6398" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">例如，让我们创建一个函数，像以前一样对<code class="fe mq mr ms mt b">name</code>字段进行<code class="fe mq mr ms mt b">match</code>查询:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="203d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">你应该注意到上面的代码比我们在<code class="fe mq mr ms mt b">ElasticserchRepository</code>中定义的更复杂。如果可以的话，建议使用Spring数据仓库。但是对于更高级的查询，比如聚合、突出显示或建议，您必须使用<code class="fe mq mr ms mt b">ElasticsearchRestTemplate</code>。</p><p id="79fa" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">例如，让我们编写一段代码来聚合一个术语:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="6c24" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">弹性搜索RestHighLevelClient</h1><p id="734e" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">如果你没有使用Spring或者你的Spring版本不支持<code class="fe mq mr ms mt b">spring-data-elasticsearch</code>，你可以使用Elasticsearch开发的Java库<code class="fe mq mr ms mt b"><a class="ae mu" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/master/java-rest-high.html" rel="noopener ugc nofollow" target="_blank">RestHighLevelClient</a></code>。</p><p id="7de7" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">是一个库，你可以用它来做一些基本的事情，比如CRUD或者管理你的Elasticsearch。尽管名字暗示它是高水平的，但与<code class="fe mq mr ms mt b">spring-data-elasticsearch</code>相比，它实际上是更低水平的。</p><p id="78dd" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这个库相对于Spring数据的优势在于，你也可以用它来管理你的弹性搜索。它提供了索引和弹性搜索配置，与Spring数据相比，您可以更灵活地使用这些配置。它还具有更完整的功能来与Elasticsearch进行交互。</p><p id="7fbe" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这个库相对于Spring数据的缺点是这个库更低级，这意味着你必须编写更多的代码。</p><h2 id="fa01" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">带有RestHighLevelClient的CRUD</h2><p id="fff4" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">让我们看看如何用这个库创建一个简单的函数，这样我们就可以将它与我们以前使用的方法进行比较:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="9bdb" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如您所见，现在它变得更加复杂，也更加难以实现。现在，您需要处理异常并将JSON结果转换成您的实体。建议使用Spring数据代替基本的CRUD操作，因为<code class="fe mq mr ms mt b">RestHighLevelClient</code>更复杂。</p><p id="26c5" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我已经在GitHub项目中包含了其他CRUD函数。有兴趣的可以去看看。链接在本文末尾。</p><h2 id="b5a3" class="mv lu it bd lv mw mx dn lz my mz dp md kz na nb mf ld nc nd mh lh ne nf mj ng bi translated">索引创建</h2><p id="f216" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">与Spring Data Elasticsearch相比，<code class="fe mq mr ms mt b">RestHighLevelClient</code>在这一部分拥有明显的优势。在上一节中，当我们创建索引及其映射和设置时，我们只使用了注释。这很容易做到，但你不能用它做太多。</p><p id="c2bd" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">使用<code class="fe mq mr ms mt b">RestHighLevelClient</code>，您可以创建索引管理方法或者基本上任何Elasticsearch REST API允许的方法。</p><p id="4170" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">例如，让我们用之前使用的设置和映射编写一些代码来创建<code class="fe mq mr ms mt b">product</code>索引:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="a6ba" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">让我们看看我们在代码中做了什么:</p><ol class=""><li id="c595" class="nw nx it ks b kt ku kw kx kz ny ld nz lh oa ll ob oc od oe bi translated">在确定索引名时，我们初始化了<code class="fe mq mr ms mt b">createIndexRequest</code>。</li><li id="1535" class="nw nx it ks b kt of kw og kz oh ld oi lh oj ll ob oc od oe bi translated">我们在调用<code class="fe mq mr ms mt b"><a class="ae mu" href="https://codecurated.com/blog/how-to-connect-java-with-elasticsearch/createIndexRequest.settings" rel="noopener ugc nofollow" target="_blank">createIndexRequest.settings</a></code>时的请求中添加了设置。在设置中，我们还配置了字段<code class="fe mq mr ms mt b"><a class="ae mu" href="https://codecurated.com/blog/how-to-connect-java-with-elasticsearch/index.requests.cache.enable" rel="noopener ugc nofollow" target="_blank">index.requests.cache.enable</a></code>，这在Spring数据库中是不可能的。</li><li id="2d34" class="nw nx it ks b kt of kw og kz oh ld oi lh oj ll ob oc od oe bi translated">我们制作了一个包含索引中字段的属性和映射的<code class="fe mq mr ms mt b">Map</code>。</li><li id="3279" class="nw nx it ks b kt of kw og kz oh ld oi lh oj ll ob oc od oe bi translated">我们用<code class="fe mq mr ms mt b"><a class="ae mu" href="https://codecurated.com/blog/how-to-connect-java-with-elasticsearch/restHighlevelClient.indices.create" rel="noopener ugc nofollow" target="_blank">restHighlevelClient.indices.create</a></code>调用了Elasticsearch。</li></ol><p id="2999" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如您所见，与Spring数据实体中的注释相比，使用<code class="fe mq mr ms mt b">RestHighLevelClient</code>，我们可以创建一个更加定制化的调用来为Elasticsearch创建索引。在<code class="fe mq mr ms mt b">RestHighLevelClient</code>中还有更多Spring数据库中没有的功能。你可以阅读<a class="ae mu" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html" rel="noopener ugc nofollow" target="_blank"> Elasticsearch的文档</a>来获得更多关于这个库的信息。</p></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="b047" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">结论</h1><p id="f68a" class="pw-post-body-paragraph kq kr it ks b kt ml ju kv kw mm jx ky kz mn lb lc ld mo lf lg lh mp lj lk ll im bi translated">在本文中，我们学习了两种连接到Elasticsearch的方法:使用Spring数据和通过Elasticsearch客户端。两者都是强大的库，但是如果对您的用例来说可能的话，您应该只使用Spring数据。带有Spring Data Elasticsearch的代码可读性更好，也更容易使用。</p><p id="93af" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果你想要一个更强大的库，基本上可以做任何Elasticsearch允许的事情，那么你也可以使用Elasticsearch高级客户端。如果您需要更强大的功能，您还可以使用低级客户端，这在本文中没有涉及。</p><p id="0e0a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我还要感谢您阅读这篇文章，我希望这篇文章能帮助您开始使用Java Spring Boot的Elasticsearch。如果你想了解更多关于库的信息，你可以查看Spring Data Elasticsearch文档和<a class="ae mu" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html" rel="noopener ugc nofollow" target="_blank"> Elasticsearch的高级客户文档</a>。</p><p id="b707" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">下面是本文使用的GitHub项目的GitHub链接:</p><div class="ok ol gp gr om on"><a href="https://github.com/brilianfird/elasticsearch-with-spring-boot" rel="noopener  ugc nofollow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd iu gy z fp os fr fs ot fu fw is bi translated">brilianfird/弹性搜索带弹簧靴</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">在GitHub上创建一个帐户，为brilianfird/elastic search-with-spring-boot的开发做出贡献。</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">github.com</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb ko on"/></div></div></a></div><p id="2e44" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">【codecurated.com】先前发表于<a class="ae mu" href="https://codecurated.com/blog/how-to-connect-java-with-elasticsearch/" rel="noopener ugc nofollow" target="_blank"><em class="pc"/></a><em class="pc">。</em></p></div></div>    
</body>
</html>