<html>
<head>
<title>Bundle Up a JavaScript Project Using Rollup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Rollup捆绑一个JavaScript项目</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/bundle-up-a-javascript-project-using-rollup-2f80205f5f5c?source=collection_archive---------5-----------------------#2021-02-26">https://betterprogramming.pub/bundle-up-a-javascript-project-using-rollup-2f80205f5f5c?source=collection_archive---------5-----------------------#2021-02-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1d14" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从头开始捆绑JavaScript项目的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8373c7c92c987ae5716f73d029902854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u_k2nR83IFCfc2KnctBfhA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b21f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae lu" href="https://rollupjs.org/guide/en/" rel="noopener ugc nofollow" target="_blank"> Rollup </a>是一个JavaScript的模块捆绑器，它将小段代码编译成更大更复杂的东西，比如一个库或应用程序。它在GitHub上有超过19，000颗星，从npm注册中心<a class="ae lu" href="https://medium.com/better-programming/the-step-by-step-guide-to-understanding-and-adopting-npm-7-914504f7090f" rel="noopener">每周下载超过300万次。</a></p><p id="ea41" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是市场上主要捆扎机的npm趋势:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/8c4dbe4d4e91fa255d8e5181c7863480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sy2Uz9xIpy07Gr7p4nTh0g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="85ef" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Rollup是第二受欢迎的捆扎机。传统的观点是对应用程序使用webpack，对库使用rollup。今天依然如此。然而，由于webpack和rollup实现了彼此的功能，这两个捆绑器之间的界限变得模糊了。</p><p id="147d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与webpack类似，Rollup也很复杂，有一个陡峭的学习曲线。让我们从一个简单的例子开始构建一个汇总项目。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2fb3" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">一个HTML项目</h1><p id="12a6" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">我们已经为响应式菜单创建了一个小的HTML项目。当该应用程序在移动设备上运行时，它会在各种情况下显示以下屏幕。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/30d3bcc64c1f9e317316c217ced009b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7fzx9hlqLKFrZE428Df_CA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="eabe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">左侧屏幕是起始页。由于内容比显示区域长，我们需要向下滚动来查看剩余的内容(中间的屏幕)。当点击右上角的汉堡菜单时，会显示一个垂直菜单(右侧屏幕)。</p><p id="df19" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当应用程序以最小宽度<code class="fe nb nc nd ne b">768px</code>出现在桌面上时，它会显示一个水平菜单:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/c603c757deacfaf5042938f9f8c17aff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eSIKJrHi_Xus4vMdE53EhQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="bf37" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">源代码位于这个<a class="ae lu" href="https://github.com/JenniferFuBook/html-example" rel="noopener ugc nofollow" target="_blank"> GitHub仓库</a>，下面是文件夹结构。</p><pre class="kj kk kl km gt ng ne nh ni aw nj bi"><span id="895e" class="nk me it ne b gy nl nm l nn no">$ ls -R<br/>images     index.html style.css</span><span id="e9f2" class="nk me it ne b gy np nm l nn no">./images:<br/>flower.jpg    hamburger.svg</span><span id="c1d6" class="nk me it ne b gy np nm l nn no">./src:<br/>index.js</span></pre><p id="3203" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个典型的HTML项目，带有一个包含一些图片、一个样式表和JavaScript代码的<code class="fe nb nc nd ne b">index.html</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="41e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第7行是到<code class="fe nb nc nd ne b">style.css</code>的链接。</p><p id="5517" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第8行包含JavaScript代码。</p><p id="d6f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">14号线是JPG之花。</p><p id="0010" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第17行是汉堡<a class="ae lu" href="https://medium.com/better-programming/create-react-app-and-svgs-70970ac715f2" rel="noopener"> SVG </a>，显示在窄屏幕上。</p><p id="05c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该项目可以通过<a class="ae lu" href="https://medium.com/better-programming/10-useful-plugins-for-visual-studio-code-6ab62c0b14ee" rel="noopener"> VSCode </a>的live服务器启动。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/5922ede6722bf44dbf613234ab49aeea.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*WfHr8pMJtdlLPnVzm6JEcw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8f8f" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">带活荷载的累计</h1><p id="375e" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">需要一个模块捆绑器来将小块JavaScript代码与样式表和图像一起编译成更大更复杂的东西，比如一个库或应用程序。我们使用Rollup来捆绑一个JavaScript项目。首先是让项目npm得到管理。</p><pre class="kj kk kl km gt ng ne nh ni aw nj bi"><span id="8b23" class="nk me it ne b gy nl nm l nn no">$ npm init -y<br/>Wrote to /Users/fuje/rollup-example/package.json:</span><span id="309e" class="nk me it ne b gy np nm l nn no">{<br/>  "name": "rollup-example",<br/>  "version": "1.0.0",<br/>  "description": "",<br/>  "main": "index.js",<br/>  "scripts": {<br/>    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"<br/>  },<br/>  "keywords": [],<br/>  "author": "",<br/>  "license": "ISC"<br/>}</span></pre><p id="5836" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在生成的<code class="fe nb nc nd ne b">package.json</code>中，添加一个脚本(第7行)来运行Rollup命令。另外，创建一个<code class="fe nb nc nd ne b"><a class="ae lu" href="https://medium.com/better-programming/package-jsons-dependencies-in-depth-a1f0637a3129" rel="noopener">devDependencies</a></code>部分(第13-17行)来下载用于开发的<code class="fe nb nc nd ne b">rollup</code>和插件包。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="f057" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在第7行，添加了<code class="fe nb nc nd ne b">start</code>脚本，根据监视模式下的配置启动汇总。</p><p id="1d26" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第14行是<code class="fe nb nc nd ne b">rollup</code>套餐。</p><p id="a429" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第15行是<code class="fe nb nc nd ne b"><a class="ae lu" href="https://github.com/thgh/rollup-plugin-livereload" rel="noopener ugc nofollow" target="_blank">rollup-plugin-livereload</a></code>插件，它实时重新加载汇总包。</p><p id="bd1c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第16行是<code class="fe nb nc nd ne b"><a class="ae lu" href="https://github.com/thgh/rollup-plugin-serve" rel="noopener ugc nofollow" target="_blank">rollup-plugin-serve</a></code>插件，它启动一个提供实时重载的开发服务器。</p><p id="b136" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于<code class="fe nb nc nd ne b">start</code>脚本基于汇总配置，因此项目需要<code class="fe nb nc nd ne b">rollup.config.js</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="d724" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第5行指定<code class="fe nb nc nd ne b">input</code>条目为<code class="fe nb nc nd ne b">src/index.js</code>。</p><p id="6aa2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第7-14行配置<code class="fe nb nc nd ne b">rollup-plugin-serve</code>。</p><p id="bfdf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第8行设置在浏览器模式下启动。</p><p id="e34f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第9行在控制台上启用详细输出。</p><p id="5129" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第10行指定文件夹、当前目录和用来提供文件的<code class="fe nb nc nd ne b">dist</code>。</p><p id="4796" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第11行将回退页面设置为<code class="fe nb nc nd ne b">index.html</code> ( <code class="fe nb nc nd ne b">200</code>)，而不是错误页面(<code class="fe nb nc nd ne b">404</code>)。</p><p id="368e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第12行和第13行将开发服务器设置为<code class="fe nb nc nd ne b">localhost:3000</code>。</p><p id="b863" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第15行配置<code class="fe nb nc nd ne b">rollup-plugin-livereload</code>监视文件夹。</p><p id="e4d2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第17-21行定义了输出对象的位置和格式。</p><p id="1066" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第18行指定输出文件为<code class="fe nb nc nd ne b">dist/bundle.js</code>。</p><p id="5417" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第19行指定输出格式为<code class="fe nb nc nd ne b">iife</code>。这是直接调用的函数表达式(IIFE)格式，在<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/what-are-cjs-amd-umd-esm-system-and-iife-3633a112db62">另一篇文章</a>中有解释。</p><p id="b442" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第20行配置了一个单独的sourcemap文件，<code class="fe nb nc nd ne b">dist/bundle.js.map,</code>将被创建。除了布尔值，还可以设置为<code class="fe nb nc nd ne b">inline</code>。</p><p id="7307" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另外，<code class="fe nb nc nd ne b">sourcemap</code>可以动态启用。</p><p id="9950" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe nb nc nd ne b">package.json</code>中，将脚本更改为:</p><pre class="kj kk kl km gt ng ne nh ni aw nj bi"><span id="0466" class="nk me it ne b gy nl nm l nn no">"start": "rollup -c -w --environment BUILD:development"</span></pre><p id="4b36" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那么可以动态设置输出:</p><pre class="kj kk kl km gt ng ne nh ni aw nj bi"><span id="7181" class="nk me it ne b gy nl nm l nn no">output: {<br/>  file: 'dist/bundle.js',<br/>  name: 'example',<br/>  format: 'iife',<br/>  sourcemap: process.env.BUILD === 'development',<br/>}</span></pre><p id="dbcc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">基于此汇总配置，将生成<code class="fe nb nc nd ne b">dist/bundle.js</code>。我们修改<code class="fe nb nc nd ne b">index.html</code>来包含它:</p><pre class="kj kk kl km gt ng ne nh ni aw nj bi"><span id="62f4" class="nk me it ne b gy nl nm l nn no">&lt;script src="dist/bundle.js"&gt;&lt;/script&gt;</span></pre><p id="5c8b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在项目的根，执行<code class="fe nb nc nd ne b">npm start</code>。汇总项目已经启动并正在运行。</p><p id="195e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是<code class="fe nb nc nd ne b">src/index.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="2ce1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是生成的<code class="fe nb nc nd ne b">dist/bundle.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="9a8a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第1行是活负载脚本。</p><p id="075b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第2-20行定义了生活。</p><p id="458e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第21行是到sourcemap的链接。如果<code class="fe nb nc nd ne b">output.sourcemap</code>设置为<code class="fe nb nc nd ne b">inline</code>，源地图将成为<code class="fe nb nc nd ne b">dist/bundle.js</code>的一部分。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="eecf" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">树摇晃</h1><p id="1e71" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">树抖动是一种代码优化技术。通过分析代码，Rollup只包含运行库或应用程序所需的源代码。</p><p id="dbe8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们在<code class="fe nb nc nd ne b">src/index.js</code>中添加一个函数<code class="fe nb nc nd ne b">printCount</code>(第17-21行):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="3ccd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这反映在生成的<code class="fe nb nc nd ne b">dist/bundle.js</code>中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="cbc7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们注释掉<code class="fe nb nc nd ne b">src/index.js</code>中<code class="fe nb nc nd ne b">printCount</code>(第16行)的用法，生成的<code class="fe nb nc nd ne b">dist/bundle.js</code>将不包括<code class="fe nb nc nd ne b">printCount</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="3a3e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">摇树是Rollup的招牌功能。它使Rollup能够创建更小、更快的包。它依赖于ES2015模块语法的静态结构，例如<code class="fe nb nc nd ne b"><a class="ae lu" href="https://medium.com/better-programming/a-handy-guide-to-export-and-import-modules-for-javascript-and-typescript-6cff8e47d554" rel="noopener">import</a></code> <a class="ae lu" href="https://medium.com/better-programming/a-handy-guide-to-export-and-import-modules-for-javascript-and-typescript-6cff8e47d554" rel="noopener">和</a> <code class="fe nb nc nd ne b"><a class="ae lu" href="https://medium.com/better-programming/a-handy-guide-to-export-and-import-modules-for-javascript-and-typescript-6cff8e47d554" rel="noopener">export</a></code>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="1349" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">CSS插件</h1><p id="e035" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">我们已经在<code class="fe nb nc nd ne b">index.html</code>中包含了一个样式表。这个包含可以被Rollup插件<code class="fe nb nc nd ne b"><a class="ae lu" href="https://github.com/egoist/rollup-plugin-postcss" rel="noopener ugc nofollow" target="_blank">rollup-plugin-postcss</a></code>所取代，它提供了Rollup和PostCSS之间的无缝集成。</p><p id="eeea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nb nc nd ne b">postcss</code>和<code class="fe nb nc nd ne b">rollup-plugin-postcss</code>包需要包含在<code class="fe nb nc nd ne b">package.json</code>中:</p><pre class="kj kk kl km gt ng ne nh ni aw nj bi"><span id="c485" class="nk me it ne b gy nl nm l nn no">"devDependencies": {<br/>  "postcss": "^8.2.4",<br/>  "rollup-plugin-postcss": "^4.0.0",<br/>  ...<br/>}</span></pre><p id="8df7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将<code class="fe nb nc nd ne b">rollup-plugin-postcss</code>配置添加到<code class="fe nb nc nd ne b">rollup.config.js</code>(第3行和第8行):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="a7b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从<code class="fe nb nc nd ne b">index.html</code>上拆下<code class="fe nb nc nd ne b">style.css</code>连杆。</p><pre class="kj kk kl km gt ng ne nh ni aw nj bi"><span id="d1ac" class="nk me it ne b gy nl nm l nn no">&lt;link rel="stylesheet" href="style.css" /&gt;</span></pre><p id="3547" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">而是将<code class="fe nb nc nd ne b">style.css</code>导入到<code class="fe nb nc nd ne b">src/index.js</code>(第1行):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="ea23" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后我们生成了下面的<code class="fe nb nc nd ne b">dist/bundle.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="eed6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第2-30行定义了一个将样式表注入HTML文件的函数。</p><p id="3af8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第32行捕获所有样式表内容。</p><p id="541c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第33行调用函数注入样式表。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ec2f" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">图像插件</h1><p id="e2f6" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">我们在<code class="fe nb nc nd ne b">index.html</code>中包含了两张图片。这个包含可以被Rollup插件<code class="fe nb nc nd ne b"><a class="ae lu" href="https://github.com/rollup/plugins/tree/master/packages/image" rel="noopener ugc nofollow" target="_blank">@rollup/plugin-image</a></code>所取代，它提供了在启动时拥有可用图像的便利。</p><p id="33b7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">包<code class="fe nb nc nd ne b">@rollup/plugin-image</code>需要包含在<code class="fe nb nc nd ne b">package.json</code>中:</p><pre class="kj kk kl km gt ng ne nh ni aw nj bi"><span id="00ab" class="nk me it ne b gy nl nm l nn no">"devDependencies": {<br/>  @rollup/plugin-image,<br/>  ...<br/>}</span></pre><p id="0df7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe nb nc nd ne b">rollup.config.js</code>中增加<code class="fe nb nc nd ne b">@rollup/plugin-image</code>配置(第4行和第10行):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="8114" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">调整图像的<code class="fe nb nc nd ne b">index.html</code>(10行和13行):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="d097" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将<code class="fe nb nc nd ne b">flower.jpg</code>和<code class="fe nb nc nd ne b">hamburger.svg</code>导入<code class="fe nb nc nd ne b">src/index.js</code>(第2行和第3行):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="1de9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后我们有了下面生成的<code class="fe nb nc nd ne b">dist/bundle.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="b4f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">35线是花JPG，用在41线。</p><p id="4b76" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第37行是hamburger SVG文件，在第43行使用。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6c79" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">更简洁的插件</h1><p id="efe8" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated"><code class="fe nb nc nd ne b"><a class="ae lu" href="https://github.com/TrySound/rollup-plugin-terser" rel="noopener ugc nofollow" target="_blank">rollup-plugin-terser</a></code>是一个缩小生成的包的插件。建议缩减生产代码。</p><p id="78d3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nb nc nd ne b"><a class="ae lu" href="https://github.com/saf33r/rollup-plugin-cleaner" rel="noopener ugc nofollow" target="_blank">rollup-plugin-cleaner</a></code>是一个在重建前清理目录的插件。清理目录是个好主意。</p><p id="feee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了使用这两个插件，下面的包需要成为<code class="fe nb nc nd ne b">devDependencies</code>的一部分:</p><pre class="kj kk kl km gt ng ne nh ni aw nj bi"><span id="3d2d" class="nk me it ne b gy nl nm l nn no">"devDependencies": {<br/>  rollup-plugin-cleaner,<br/>  <!-- -->rollup-plugin-terser<!-- -->,<br/>  ...<br/>}</span></pre><p id="900f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那么它们可以用在<code class="fe nb nc nd ne b">rollup.config.js</code>中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6d2b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="21e4" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">Rollup是第二流行的bundler，它特别擅长捆绑库。</p><p id="9db9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们已经引入了六个插件。最终代码在这个库的<a class="ae lu" href="https://github.com/JenniferFuBook/rollup-example" rel="noopener ugc nofollow" target="_blank">处被捕获。</a></p><p id="2759" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有<a class="ae lu" href="https://github.com/rollup/plugins" rel="noopener ugc nofollow" target="_blank">一长串插件</a>来扩展Rollup的功能。此外，你可以尝试创建自己的插件。</p><p id="4486" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">到目前为止，Rollup在我们的项目中运行良好。webpack和Rollup互为竞争对手。希望决斗能在未来给我们带来更多的功能和更高的效率。</p><p id="9221" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读。我希望这有所帮助。你可以在这里看到我的其他媒体出版物<a class="ae lu" href="https://medium.com/@jenniferfubook/jennifer-fus-web-development-publications-1a887e4454af" rel="noopener"/>。</p></div></div>    
</body>
</html>