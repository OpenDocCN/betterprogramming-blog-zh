<html>
<head>
<title>Scrape Any Website and Get Content With Keywords Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python抓取任何网站并获取包含关键词的内容</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/scrape-any-websites-and-get-content-with-keywords-using-python-b060b9fa41ce?source=collection_archive---------2-----------------------#2021-07-07">https://betterprogramming.pub/scrape-any-websites-and-get-content-with-keywords-using-python-b060b9fa41ce?source=collection_archive---------2-----------------------#2021-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="328b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在HTML和基于角度的网站上执行抓取</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0f13e082d786b07ad704e127be9c4661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gQf9WmRlxcnRobl-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@austindistel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Austin Distel </a>拍摄的照片</p></figure><h1 id="82f8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="7a75" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们经常看到一整页都是较小新闻内容的广告。此外，一些现代网站，如React/Angular，非常难刮。在这篇文章中，我们将走过如何刮任何网站。</p><h1 id="fff9" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">设置</h1><p id="bc74" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们将使用Python和一些额外的包来抓取。以下是我们需要的软件包:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="c0a5" class="ms la it mo b gy mt mu l mv mw">pip install newspaper3k<br/>pip install bs4<br/>pip install readability</span></pre><p id="aa70" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">正常处理需要上述软件包。然而，要抓取现代的React/Angular网站，我们需要使用Chrome web驱动程序手动解析。所以检查你的Chrome浏览器版本，从<a class="ae ky" href="https://chromedriver.chromium.org/downloads" rel="noopener ugc nofollow" target="_blank">这里</a>下载相应的驱动。</p><p id="9873" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">我们将使用下面列出的导入:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="8305" class="ms la it mo b gy mt mu l mv mw">from newspaper import Article<br/>import requests<br/>from bs4 import BeautifulSoup<br/>from readability.readability import Document as Paper<br/>from requests.packages.urllib3.exceptions import InsecureRequestWarning<br/>import re</span></pre><h1 id="da55" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">抓取正常网站</h1><p id="f41c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">作为第一次尝试，让我们看看如何刮一个正常的网站是没有反应。由于我不想让其他网站瘫痪，我将使用我的网站(shyambv.com)进行清理。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/6fb9e36ba6d8e303dd20adfe6b1b65a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P618XMmQM1YT0ylOgzte5Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">简单解析作者的网站图片。</p></figure><p id="096a" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">简单，对吗？在上面的例子中，我们已经在不太复杂的情况下抓取了网站。我们不需要详细讨论使用bs4进行解析。</p><p id="629a" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">此外，如果您想获得网站的基本关键字，请执行以下操作:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/17479cce6851fc0811ef965581aa45f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:458/format:webp/1*KGdKu6UPEuVoSilPsBv0HQ.png"/></div></figure><p id="f6ba" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">太好了！你可能认为这在任何有广告的地方都行得通？是的，大部分情况下。只是把文章上无数的广告都废了。它还会剔除屏幕底部不想要的广告。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/5f100a1ce8c64e42942c75ceea32c087.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3odrvAIlwA1QgO3yQg159w.png"/></div></div></figure><p id="ff39" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">现在我们可以从一篇没有广告的文章中获取所有的数据和关键词。时事通讯还支持多种语言。</p><p id="247a" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">但是，我们经常不会收到一篇优秀的解析文章，所以我们需要尝试不同的库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="03e3" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">上面的代码很棒！它会尝试访问网页。如果可以到达，它将尝试使用库newspaper3k并抓取数据。如果第一个库无法访问它，它将尝试使用另一个库并将其擦除。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/66ac5c8465496e92fbe166b5680f048b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tfzk_CB1oO6p9mHy3iGTEw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">抓取了一个网站——作者图片</p></figure><p id="e4c1" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">我们说完了吗？不要！这段代码只适用于用flask、HTML、PHP等构建的普通网站。用React/Angular搭建的网站就不行了。</p><h1 id="1739" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">抓取基于React的网站</h1><p id="f4fd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果我们试图通过一个基于React的网站，如<a class="ae ky" href="https://socialimageai.com/home" rel="noopener ugc nofollow" target="_blank"> Socialimageai，</a>网页可能看起来正常。然而，当你试图查看源代码时，它只会显示一大段JavaScript代码。代码没有任何文本，所以我们不能抓取它。</p><p id="bb0a" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">如果我们试图抓取React网站，我们将收到200错误，因此我们之前的所有代码都将无法工作。正如在设置部分提到的，我们需要一个Chrome驱动程序来解析React或Angular网站。</p><p id="500c" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">以下代码将开始连接到Chrome web驱动程序:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="edeb" class="ms la it mo b gy mt mu l mv mw">driver = webdriver.Chrome(executable_path=location_of_chrome_driver, options=chrome_options)</span><span id="46f2" class="ms la it mo b gy ni mu l mv mw">driver.delete_all_cookies()</span><span id="b4e5" class="ms la it mo b gy ni mu l mv mw">driver.wait = WebDriverWait(driver, random.choice(range(30,60,1)))</span><span id="0063" class="ms la it mo b gy ni mu l mv mw">driver.maximize_window()</span></pre><p id="6945" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">在服务器上，我们需要添加一个名为headless browser的参数。一旦我们连接到网站，我们需要导航到网站并获取HTML页面的主体(这就像在HTML页面上使用inspect)。以上解析是接收现代网站HTML代码的唯一方式。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="ca0c" class="ms la it mo b gy mt mu l mv mw">body_web_elelment = driver.wait.until(EC.presence_of_element_located((By.TAG_NAME, 'body')))</span><span id="d26b" class="ms la it mo b gy ni mu l mv mw">html = body_web_elelment.get_attribute('innerHTML')</span></pre><p id="e762" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">一旦我们收到HTML代码，我们就可以通过beautiful soup解析代码。我们可以专门解析网页中的任何链接或文本。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="bc7e" class="ms la it mo b gy mt mu l mv mw">soup = BeautifulSoup(html, 'html5lib')</span><span id="3bd0" class="ms la it mo b gy ni mu l mv mw">for script in soup(["script", "style"]):</span><span id="6ce4" class="ms la it mo b gy ni mu l mv mw">script.extract()</span><span id="1671" class="ms la it mo b gy ni mu l mv mw">text = soup.get_text()</span></pre><p id="6fa9" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">拍拍自己的背！我们现在能够抓取任何网站。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/dad6f1640571a5f1bb35341b614a752d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YX6OMHIfmCs7Aj_GP1Q_fQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Scraped React网站输出—图片由作者提供</p></figure><h1 id="fa6a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><ol class=""><li id="6040" class="nk nl it lt b lu lv lx ly ma nm me nn mi no mm np nq nr ns bi translated">我们可以抓取任何正常的基于HTML的网站。</li><li id="285b" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">使用Chrome web驱动程序在React/Angular网站上执行任何抓取操作。</li></ol><h1 id="6f09" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">获取代码</h1><p id="b13f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><em class="ny">通过我的</em> <a class="ae ky" href="https://codesprout.substack.com/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> <em class="ny">简讯</em> </strong> </a> <em class="ny">，加入100多名免费获得我的文章和其他更新的完整工作代码的用户。</em></p></div></div>    
</body>
</html>