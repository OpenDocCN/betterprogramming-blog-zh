<html>
<head>
<title>Secure Your Spring Boot App With Spring Security and GitHub Using Keycloak</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Spring Security和GitHub保护您的Spring Boot应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/secure-your-spring-boot-app-with-spring-security-and-github-using-keycloak-a6eb5bfeb4bf?source=collection_archive---------10-----------------------#2021-02-02">https://betterprogramming.pub/secure-your-spring-boot-app-with-spring-security-and-github-using-keycloak-a6eb5bfeb4bf?source=collection_archive---------10-----------------------#2021-02-02</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ede4" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">添加社交媒体身份提供商以安全地验证你的应用</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/40165e1b9ab603661c5d3ac904c025fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3J46u_4B0f74JcHb"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@altumcode?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> AltumCode </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="fde1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这篇文章是我之前关于如何用<a class="ae kz" href="https://www.keycloak.org/" rel="noopener ugc nofollow" target="_blank"> Keycloak </a>认证Spring Boot应用的<a class="ae kz" href="https://medium.com/better-programming/how-to-authenticate-your-spring-boot-application-with-keycloak-1e9ccb5f2478" rel="noopener">教程</a>的增强版。如果你不熟悉Keycloak的基本概念，我建议你浏览一下之前的教程。但是不要担心，你仍然可以跟上，因为我们现在将涉及不同的主题。</p><p id="9c64" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您将从本教程中学到什么:</p><ul class=""><li id="0a6e" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">如何将Spring Security与Keycloak集成</li><li id="5554" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">身份代理概念</li><li id="da73" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">如何使用第三方社交媒体身份提供商(例如GitHub)来验证您的应用</li></ul><p id="5543" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们开始吧！</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="e80a" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">将Spring Security添加到您的Spring Boot应用中</h1><p id="fddb" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">快速回顾一下之前的教程:</p><ul class=""><li id="da7e" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">我们开发了一个运行在<code class="fe no np nq nr b">localhost:8090</code>上的简单Spring Boot应用。</li><li id="8212" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">Keycloak服务器运行在<code class="fe no np nq nr b">localhost:9090</code>上，对想要登录Spring Boot应用的用户进行认证。</li><li id="b3ff" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">拥有<code class="fe no np nq nr b">visitor</code>角色的用户可以访问<code class="fe no np nq nr b">localhost:8090/visitor</code>页面，拥有<code class="fe no np nq nr b">admin</code>角色的用户可以访问<code class="fe no np nq nr b">localhost:8090/visitor</code>和<code class="fe no np nq nr b">localhost:8090/admin</code>。</li></ul><p id="b059" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们将使用我们之前项目中的简单Spring Boot应用程序。您可以在本文末尾链接的GitHub资源库中找到完整的源代码。</p><h2 id="085a" class="ns ms iu bd mt nt nu dn mx nv nw dp nb lj nx ny nd ln nz oa nf lr ob oc nh od bi translated">更新依赖关系</h2><p id="983b" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">修改<code class="fe no np nq nr b">build.gradle</code>文件并添加Spring安全性的依赖项。您的最终文件应该如下所示:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oe of l"/></div></figure></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="0b12" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">配置Spring安全性</h1><p id="02c0" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">在IDE中打开Spring Boot项目，并添加一个名为<code class="fe no np nq nr b">KeycloakConfig.java</code>的新Java类。下面将解释每种方法:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oe of l"/></div></figure><p id="d3d9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">注意，<code class="fe no np nq nr b">KeycloakConfiguration</code>注释定义了我们在Spring Security中集成Keycloak所需的所有注释。</p><p id="0669" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe no np nq nr b">KeycloakWebSecurityConfigurerAdapter</code>是创建<code class="fe no np nq nr b"><a class="ae kz" href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/config/annotation/web/WebSecurityConfigurer.html" rel="noopener ugc nofollow" target="_blank">WebSecurityConfigurer</a></code>实例的一个方便的基类。</p><p id="2278" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">默认情况下，角色以<code class="fe no np nq nr b">ROLE_</code>为前缀。由于我们不想要这种行为，我们定义了<code class="fe no np nq nr b">configureGlobal(AuthenticationManagerBuilder auth)</code>方法来防止默认前缀。这样，我们的角色名称将与Keycloak管理控制台中的名称相同。</p><p id="c6bf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe no np nq nr b">sessionAuthenticationStrategy()</code>方法定义了认证策略。</p><p id="3dd0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你如何决定使用哪种策略？有两种类型的策略:</p><ul class=""><li id="7274" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated"><code class="fe no np nq nr b">RegisterSessionAuthenticationStrategy</code>用于公共或机密应用。</li><li id="0eb0" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><code class="fe no np nq nr b">NullAuthenticatedSessionStrategy</code>用于仅承载应用(不允许从浏览器登录)。</li></ul><p id="1429" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们的应用是公开的，所以我们选择了<code class="fe no np nq nr b">RegisterSessionAuthenticationStrategy</code>。</p><p id="2797" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">默认情况下，Spring安全适配器会寻找一个<code class="fe no np nq nr b">keycloak.json</code>配置文件来读取Keycloak的配置。<code class="fe no np nq nr b">keycloakConfigResolver()</code>方法告诉Spring安全适配器寻找一个Spring Boot属性文件。这样，我们将能够使用我们自己的配置。</p><p id="c176" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，我们在<code class="fe no np nq nr b">configure(HttpSecurity http)</code>方法中定义了角色权限。现在，我们可以删除或注释掉在之前教程中配置的<code class="fe no np nq nr b">application.properties</code>文件中的约束。</p><p id="fc53" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最终的<code class="fe no np nq nr b">application.properties</code>应该是这样的:</p><pre class="kk kl km kn gu og nr oh oi aw oj bi"><span id="9f06" class="ns ms iu nr b gz ok ol l om on">server.port=8090<br/><br/>keycloak.realm=keycloak-demo<br/>keycloak.resource=keycloak-app<br/>keycloak.auth-server-url=http://localhost:9900/auth<br/>keycloak.ssl-required=external<br/>keycloak.public-client=true<br/>keycloak.use-resource-role-mappings=true</span></pre></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="71f2" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">测试应用程序</h1><p id="0e4c" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">我们期待与前一篇文章相同的行为。</p><p id="18b5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们通过尝试以<code class="fe no np nq nr b">user</code>的身份访问<code class="fe no np nq nr b">localhost:8090/visitor</code>来检查一下:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oo"><img src="../Images/df2222f96b93df9ce7a89e81df483c96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AbxNf9rkCSrmjDlboAY3dA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作为具有访问者角色的GitHub用户成功登录</p></figure><p id="a6d1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">太好了！现在，让我们尝试访问<code class="fe no np nq nr b">localhost:8090/admin</code>:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj op"><img src="../Images/959d1b0c002ec9a0bf0b84e852bd1417.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nndSvkFcpqX-1opnm94Btw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">试图访问管理页面的用户被拒绝访问</p></figure><p id="4dc6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">应用程序按预期运行。<code class="fe no np nq nr b">user</code>不允许查看<code class="fe no np nq nr b">admin</code>页面并收到403错误。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="c266" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">配置社交媒体身份提供者</h1><h2 id="698d" class="ns ms iu bd mt nt nu dn mx nv nw dp nb lj nx ny nd ln nz oa nf lr ob oc nh od bi translated">基本概念</h2><p id="a688" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">首先，让我们了解身份代理的关键概念。</p><p id="09f5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">身份提供者是一种用于对用户进行身份验证的服务。比如GitHub，谷歌，脸书。Keycloak本身也是一个身份提供者。</p><p id="e09a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">身份代理是一种中介服务，负责在多个服务提供者和不同的身份提供者之间建立可信连接。比如Keycloak可以作为身份代理，通过GitHub认证一个app。</p><p id="eee3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请看下图，了解完整的身份验证过程:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oq"><img src="../Images/cb6811087775708b4ceda45dab32c487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pQAvwcrDoSsQyvlc.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来源:<a class="ae kz" href="https://www.keycloak.org/docs/latest/server_admin/" rel="noopener ugc nofollow" target="_blank">密匙文件</a></p></figure><h2 id="1b37" class="ns ms iu bd mt nt nu dn mx nv nw dp nb lj nx ny nd ln nz oa nf lr ob oc nh od bi translated">身份代理的优势</h2><p id="6b2c" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">使用身份代理简化了登录过程。用户不需要注册和记住任何新的凭证。相反，他们可以简单地通过一个现有的帐户(如谷歌)进行认证。</p><h2 id="82c1" class="ns ms iu bd mt nt nu dn mx nv nw dp nb lj nx ny nd ln nz oa nf lr ob oc nh od bi translated">在Keycloak中添加身份提供者</h2><p id="43af" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">在这个演示中，我们将使用GitHub作为身份提供者。</p><ol class=""><li id="9a41" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv or mc md me bi translated">使用您的管理员凭据登录Keycloak管理控制台。</li><li id="d7f9" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv or mc md me bi translated">单击“身份提供者”菜单项。</li><li id="1ade" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv or mc md me bi translated">单击【添加身份提供者】<strong class="lc iv"> </strong>按钮。</li><li id="b221" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv or mc md me bi translated">从下拉列表中选择GitHub。</li></ol><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj os"><img src="../Images/adc4da07facd05d223cb624b3c79e20a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QkUjJO9XAYVZnblSLL_CQw.png"/></div></div></figure><p id="21b5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">5.记下“重定向URI”链接。</p><p id="e626" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们将很快填写其余的必填字段。</p><h2 id="e4f1" class="ns ms iu bd mt nt nu dn mx nv nw dp nb lj nx ny nd ln nz oa nf lr ob oc nh od bi translated">在GitHub中设置OAuth应用程序</h2><ol class=""><li id="3810" class="lw lx iu lc b ld nj lg nk lj ot ln ou lr ov lv or mc md me bi translated">假设你有一个GitHub账户，导航到设置-&gt;开发者菜单或者点击<a class="ae kz" href="https://github.com/settings/developers" rel="noopener ugc nofollow" target="_blank">下面的</a>页面。</li><li id="c271" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv or mc md me bi translated">选择“OAuth应用程序”菜单项。</li><li id="856c" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv or mc md me bi translated">从右上角选择“新建OAuth应用程序”。</li><li id="5e0f" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv or mc md me bi translated">您可以为您的应用程序指定任何名称。</li><li id="3113" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv or mc md me bi translated">提供一个链接到你的Spring Boot应用的URL。</li><li id="ee6c" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv or mc md me bi translated">将您从Keycloak复制的端点URL粘贴到“授权回调URL”<strong class="lc iv"/>字段<strong class="lc iv">。</strong>您的设置应该如下所示:</li></ol><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ow"><img src="../Images/3207fc8faedde9e05d723d1826360459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*171j-KdX7gaw4aqVRFDdkQ.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">GitHub OAth App注册</p></figure><p id="4ca2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">5.点击“注册应用程序”</p><p id="7b74" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">6.打开新创建的应用程序:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ox"><img src="../Images/7fca2328e308a0ef55c791692992b940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ihc0r5QU5A0HC68cM4YgqA.png"/></div></div></figure><p id="6bb2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">7.复制客户端ID <strong class="lc iv"> </strong>并粘贴到Keycloak管理控制台的“客户端ID”字段中。</p><p id="57d6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">8.生成新的客户端密码。</p><p id="c386" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">9.将其粘贴到Keycloak管理控制台的“客户端密码”<strong class="lc iv"> </strong>字段中。</p><p id="d4b7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您的身份提供者设置应如下所示:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oy"><img src="../Images/e768e64f570e29ca6b7ea755a91c3fc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q_nHbGZ_X93hpVkxRxz6Hg.png"/></div></div></figure><p id="7c28" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">10.保存设置。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="fe91" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">测试GitHub授权</h1><p id="eb03" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">当您尝试访问您的Spring Boot应用程序时，您应该会看到GitHub被列为“登录”选项:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oz"><img src="../Images/69bbd6395e8817d552414524be0190bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GF7JIeOL8B-uwGhvjQkV8w.png"/></div></div></figure><p id="55a4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">系统将提示您授权该应用程序:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pa"><img src="../Images/23782c62495958e6728823f0562431b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*1Ref5wjbJVZowd5kwdhH3A.png"/></div></figure><p id="758a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">成功授权后，您将被重定向到Keycloak。</p><p id="8587" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，您的GitHub用户没有被授予Spring Boot应用程序的任何角色，因此您将看不到任何页面。为了解决这个问题，让我们授予GitHub用户<code class="fe no np nq nr b">visitor</code>权限。</p><p id="2f3d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">单击“用户”菜单项。找到您的用户，然后单击“角色映射”选项卡。正如我们在上一教程中所做的，从客户端下拉列表中选择<code class="fe no np nq nr b">keycloak-app</code>客户端。将<code class="fe no np nq nr b">visitor</code>角色分配给GitHub用户:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pb"><img src="../Images/e221b2b5b22c203d8d865e9d00272b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KOvv1PUWLXvD63HaJelWIA.png"/></div></div></figure><p id="efdf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您想自动为新用户分配一个角色，该怎么办？这可以通过定义<a class="ae kz" href="https://wjw465150.gitbooks.io/keycloak-documentation/content/server_admin/topics/roles/user-role-mappings/default-roles.html" rel="noopener ugc nofollow" target="_blank">默认角色</a>来实现。</p><p id="9dc5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们再次尝试访问<code class="fe no np nq nr b">localhost:8090/visitor</code>路径。强制注销以结束当前用户的会话。或者，在匿名窗口中打开URL:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oo"><img src="../Images/df2222f96b93df9ce7a89e81df483c96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AbxNf9rkCSrmjDlboAY3dA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作为GitHub用户成功登录</p></figure><p id="4e79" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">厉害，果然管用！</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="1260" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">结论</h1><p id="02f1" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">我们已经介绍了身份代理的概念，并看到了Spring Security如何与Keycloak一起工作。我们还学习了如何在Keycloak中设置一个身份提供者，比如GitHub。</p><p id="38f7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个演示的完整代码链接在下面的参考资料部分。</p><p id="8e33" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我希望你喜欢这个教程，并学到了一些新的东西。感谢您的阅读和快乐编码！</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="afe2" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">参考</h1><ul class=""><li id="25bb" class="lw lx iu lc b ld nj lg nk lj ot ln ou lr ov lv mb mc md me bi translated"><a class="ae kz" href="https://www.keycloak.org/docs/latest/securing_apps/#_spring_boot_adapter" rel="noopener ugc nofollow" target="_blank">https://www . key cloak . org/docs/latest/securing _ apps/# _ spring _ boot _ adapter</a></li><li id="2daa" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><a class="ae kz" href="https://www.keycloak.org/docs/latest/server_admin/#social-identity-providers" rel="noopener ugc nofollow" target="_blank">https://www . key cloak . org/docs/latest/server _ admin/# social-identity-providers</a></li><li id="49d9" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><a class="ae kz" href="https://github.com/kirshiyin89/keycloak-springboot-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/kirshiyin89/keycloak-springboot-demo</a></li></ul></div></div>    
</body>
</html>