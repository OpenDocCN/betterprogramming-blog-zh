<html>
<head>
<title>How To Improve Code Quality With SonarQube</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用SonarQube提高代码质量</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-improve-code-quality-with-sonarqube-465744eb66db?source=collection_archive---------7-----------------------#2021-02-09">https://betterprogramming.pub/how-to-improve-code-quality-with-sonarqube-465744eb66db?source=collection_archive---------7-----------------------#2021-02-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6647" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在本地机器上安装和使用SonarQube的教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/13f12c8fec1ef685a89bb7ab5c751019.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mv2j_dcbE_KLo1L4owI5qg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://www.sonarqube.org/features/multi-languages/" rel="noopener ugc nofollow" target="_blank"> SonarQube </a>(作者涂改)。</p></figure><p id="9e39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">免责声明:我目前主要活跃在JavaScript和React领域，所以本文将使用该领域的术语。然而，我有非常广泛的背景，强烈推荐您继续阅读，即使您正在使用其他语言和框架。SonarQube支持</em> <a class="ae ky" href="https://www.sonarqube.org/features/multi-languages/" rel="noopener ugc nofollow" target="_blank"> <em class="lv">多种语言</em> </a> <em class="lv">。</em></p><p id="aaaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">包括你我在内的许多开发人员都写出了完美的代码——至少我们有时是这么认为的。我们中的一些人已经在我们的ide中使用了静态代码分析工具，比如ESLint，这表明在我们写代码的时候，我们的代码的某些部分可以被改进。你应该继续这样做。</p><p id="1d2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是今天，我将介绍一个提高代码质量的工具，它将这个过程带到了一个新的层次:<a class="ae ky" href="https://www.sonarqube.org/" rel="noopener ugc nofollow" target="_blank">sonar cube</a>。我们将:</p><ul class=""><li id="5046" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">解释一下SonarQube是什么？</li><li id="c314" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">在本地机器上安装SonarQube。</li><li id="bb1c" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">扫描您的项目文件。</li><li id="fc60" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">在SonarQube中分析你的项目。</li></ul><p id="d361" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将看看免费的开源社区版。顺便说一句，我和SonarQube没有任何关系。我只是相信这是一个不可思议的工具，并乐意分享我的相关知识。</p><p id="d045" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="3052" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">SonarQube是什么？</h1><blockquote class="nj"><p id="40f7" class="nk nl it bd nm nn no np nq nr ns lu dk translated">“SonarQube是SonarSource开发的一个开源平台，用于持续检查代码质量，通过静态分析代码来执行自动审查。”— <a class="ae ky" href="https://en.wikipedia.org/wiki/SonarQube" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></blockquote><p id="686b" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">换句话说，它不执行你的代码。它只是照原样看着它。但是请相信我，我说它做得非常好。有一个很好的理由，他们有一个非常令人印象深刻的<a class="ae ky" href="https://www.sonarsource.com/customers/" rel="noopener ugc nofollow" target="_blank">客户列表</a>，并且它是一个非常流行的(如果不是最流行的)静态代码分析工具。</p><p id="f9e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在扫描您的代码之后(我们将在后面看到)，它会生成一个报告。您可以在浏览器的SonarQube GUI中查看报告，所有报告的问题都是“交互式票证”，您可以将其分配给其他用户，为其编写评论，打开或关闭等。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/422a2f66f553dab13bd4940c27c34ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tEeGLHOmhEvZulNm4V29dw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">SonarQube GUI中报告的问题。</p></figure><p id="25b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当查看某个问题的详细视图时，它会立即显示相关代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/8da89f515fd658c0f2d15234941c522a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TFIc_YnD9fDbz48k_kJRYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们问题的详细观点。</p></figure><p id="c750" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SonarQube还提供了一个“为什么这是一个问题？”点击相关链接时的功能:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/5a1160ae94c64aa937f03432ed228c94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B6sur_2qZA2yZeDTzMGDzw.png"/></div></div></figure><p id="754b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能会认为，在编写代码时，ESLint等流行工具就能做到这一点。我不确定ESLint是否做了和T2完全一样的事情。我的直觉告诉我，SonarQube在更广泛的主题上提供了更高的质量，例如代码味道、错误和安全漏洞。</p><p id="3ecd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过使用sonar cube，您还将获得一份关于代码质量、安全性和总体<code class="fe ob oc od oe b">Quality Gate Status</code>的有机报告(这是一个布尔值，表明sonar cube是否认为您的应用程序可以交付生产)。如果您在管道中包含一个所谓的声纳扫描，那么您的报告将随着每个提交或拉取请求而更新。该报告支持版本控制，每个版本都反映了特定的提交(或合并，等等)。)在您的项目中。</p><p id="3108" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这不仅仅是一份报告。它是一个有机的“活的”数据集，持续监控你的项目并通知它的所有者(你？)关于其质量现状。它允许您在这个状态下与项目的其他成员协作。问题可以被分配和讨论，这极大地刺激了合作。</p><p id="070b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我看来，这是与ESLint等工具的最大区别:SonarQube可以用作协作工具，而ESLint是“每个开发人员独立完成的”</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="5879" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">安装SonarQube(社区版)</h1><p id="6a90" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">安装SonarQube服务器(一个Java应用程序)非常简单。您可以:</p><ul class=""><li id="b84e" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">下载一个ZIP文件并在本地运行。</li><li id="3731" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">或者在Docker容器中运行SonarQube。</li></ul><p id="68bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最简单的方法是运行Docker容器(关于下载ZIP文件并在本地运行的细节可以在文档中找到<a class="ae ky" href="https://docs.sonarqube.org/latest/setup/install-server/" rel="noopener ugc nofollow" target="_blank">)。</a></p><p id="db86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在执行这个命令之前，确保您已经在本地安装了<a class="ae ky" href="https://docs.docker.com/engine/install/" rel="noopener ugc nofollow" target="_blank">Docker</a>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="719b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，这确实会启动SonarQube，但是一旦终止容器，您将丢失所有数据。使用上面的命令玩一会儿，如果你选择继续使用SonarQube，我建议关闭这个容器并设置数据卷。这些目录位于您的本地机器上，如果您关闭或升级Docker容器，它们将被持久化。该文档提供了进行此操作的简单步骤。</p><p id="327b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是对于本文来说，用上面的命令启动SonarQube就足够了。</p><p id="699d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您让Docker完成了它的工作，您的安装就准备好了，您可以开始使用它。通过访问<code class="fe ob oc od oe b"><a class="ae ky" href="http://localhost:9000." rel="noopener ugc nofollow" target="_blank">http://localhost:9000</a></code> <a class="ae ky" href="http://localhost:9000." rel="noopener ugc nofollow" target="_blank">在浏览器中打开GUI。</a></p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="3826" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">创建新项目</h1><p id="5628" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">使用默认凭证(<code class="fe ob oc od oe b">admin</code> : <code class="fe ob oc od oe b">admin</code>)登录并创建一个新项目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/c08bb11799ab1405d9e6d1bda36834e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*6TTl2XaA44d1IdXIUfzCNA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">第一步:命名你的项目。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/c733c05e04bd2b4be93e18f205b7b421.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*ml7tJPX5e9mTerWD6-yDJw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">步骤2:为您的项目生成一个令牌。</p></figure><p id="56f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">跟踪项目密钥和令牌，因为我们稍后会用到它们。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="528c" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">第一次扫描您的项目</h1><p id="e670" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">现在我们可以用一个叫做<code class="fe ob oc od oe b">sonar-scanner</code>的CLI工具来扫描我们的代码。有许多方法可以做到这一点，您可以在文档中的<a class="ae ky" href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/" rel="noopener ugc nofollow" target="_blank">相关页面</a>找到更多详细信息。</p><p id="eace" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我选择下载可执行文件并将其位置添加到我的全局路径变量中。现在在我的机器上的任何地方都可以使用<code class="fe ob oc od oe b">sonar-scanner</code>命令:</p><pre class="kj kk kl km gt oo oe op oq aw or bi"><span id="0b9e" class="os ms it oe b gy ot ou l ov ow">PATH=$PATH:/opt/sonar-scanner-4.5.0.2216-linux/bin</span></pre><p id="d606" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在代码项目的根文件夹中，创建一个名为<code class="fe ob oc od oe b">sonar-project.properties</code>的文件，内容如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="2a71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一行包含我们在GUI中创建SonarQube项目时提供的项目密钥。</p><p id="97af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，扫描你的文件！在项目的根目录中，运行以下命令:</p><pre class="kj kk kl km gt oo oe op oq aw or bi"><span id="a134" class="os ms it oe b gy ot ou l ov ow">sonar-scanner -Dsonar.login=[PROJECT TOKEN]</span></pre><p id="1c46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有空格的<code class="fe ob oc od oe b">-Dsonar.login</code>不是拼写错误。令牌应该是我们在创建新项目时生成的令牌的值。</p><p id="e7bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">扫描仪将运行几秒钟，完成后，您可以在浏览器的GUI中分析报告。如果您的项目包含高质量的代码，概述可能如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/f4e357437532782ad9b5b66c379a6f0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TGvdsSeyzFwtXUGAkIzhlQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">质量关状态“通过”</p></figure><p id="b7fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的代码包含bug、漏洞、安全热点、代码气味或重复行，报告看起来会有所不同。GUI非常直观，所以我将跳过对所有细节的解释。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="6a37" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">附加注释</h1><p id="ad38" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">设置和使用SonarQube的其他一些想法:</p><ul class=""><li id="c3c4" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">测试覆盖:如果你的代码没有被测试覆盖，SonarQube会抱怨。这很可能(也很有希望)是您想要的，但是如果您不测试您的代码，它很快就会成为某些项目的烦恼。您可以通过在您的<code class="fe ob oc od oe b">sonar-project.properties</code>文件中或者在GUI中的<code class="fe ob oc od oe b">Project Settings</code> &gt; <code class="fe ob oc od oe b">General Settings</code> &gt; <code class="fe ob oc od oe b">Analysis Scope</code>下为设置<code class="fe ob oc od oe b">sonar.coverage.exclusions</code>设置一个glob值来禁止计算某些文件或目录的代码覆盖率。使用值<code class="fe ob oc od oe b">**/*.*</code>将其完全禁用。</li><li id="7631" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">SonarLint:如果你想在编写代码时和发布代码之前即时检测潜在的问题(类似于ESLint)，你可以使用一个叫做<a class="ae ky" href="https://www.sonarlint.org/" rel="noopener ugc nofollow" target="_blank"> SonarLint </a>的工具。您可以将SonarLint配置为在SonarQube中“与”您的项目“对话”,以便对齐嵌线。SonarLint和SonarQube配合得很好。SonarLint可用于多种ide，如Eclipse、IntelliJ和Visual Studio代码。</li><li id="5b5d" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">项目令牌:确保秘密令牌(比如SonarQube中的项目令牌)不是您的代码库的一部分。一般来说，不要在存储库中提交秘密值！</li><li id="6967" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">质量概况:SonarQube报告基于质量概况。这些是确定扫描代码时应该引发哪些问题的规则集。许多编程语言都有许多默认设置，SonarQube会巧妙地为您的项目找出默认使用的设置。在GUI中，您可以在“质量配置文件”下更改这些规则</li></ul></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="d29a" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">结论</h1><p id="1978" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">设置SonarQube并使用它非常容易。报告和GUI非常直观，您将很快理解它是如何工作的。我看不出<em class="lv">不</em>使用SonarQube的理由。</p><p id="bb69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">社区版是免费和开源的，安装起来很快，最终你会得到更高质量的代码。</p><p id="a13b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">团队合作更是如此。如果您是团队的一员，这个工具允许您在项目中协作维护代码质量。SonarQube可以很容易地集成到您的管道中，GitHub和GitLab等网站“原生地”支持它。</p><p id="662b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的宝贵时间！</p></div></div>    
</body>
</html>