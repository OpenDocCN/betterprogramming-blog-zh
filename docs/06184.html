<html>
<head>
<title>How to Create a DockerFile for a Spring Boot Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为Spring Boot应用程序创建docker文件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-a-dockerfile-for-a-spring-boot-application-46878997382f?source=collection_archive---------6-----------------------#2020-09-08">https://betterprogramming.pub/how-to-create-a-dockerfile-for-a-spring-boot-application-46878997382f?source=collection_archive---------6-----------------------#2020-09-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8d73" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建Spring Boot容器的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/16fcc1bbe9779d0167673b6726a65b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1dFDPjagChd-ry87"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马克西米利安·魏斯贝克尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="5eb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将创建一个Spring Dockerfile文件。我的目标是为您提供入门所需的所有信息。我们将讨论我在一个宠物项目中的发现。在这个项目中，我使用了<a class="ae ky" href="https://gradle.org/" rel="noopener ugc nofollow" target="_blank"> Gradle </a>和<a class="ae ky" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>来创建一个存储和检索图片的小应用程序。</p><p id="f70d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将检查创建Spring Dockerfile文件所需的每一行。我们将坚持从基础开始，所以如果你对这个主题不熟悉也不用担心。在本文结束时，您将准备好自己应用这些技术。对于任何一个开发人员来说，拥有一些Docker的专业知识是一个游戏规则的改变者。</p><p id="8f6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你没看错。即使有完美的测试驱动思维，你的工作也不会因为到处乱搞而结束。要成为一名真正的工匠，你需要将你的代码投入生产。它必须与其他服务配合良好，必须稳定，而且必须对您的最终用户有价值。在我们这个行业，他们希望你熟悉集装箱。仅此一点就应该激励你浏览这篇文章。</p><p id="aa6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不过别担心，不会太久的。我们将在五分钟内涵盖所有内容。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="46fd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建一个Spring应用程序</h1><p id="1e7a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">开始一个Spring项目很简单。外面有那么多向导。开始时，你需要做的就是去Spring initializr网站选择合适的依赖项。</p><p id="0dbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">初级程序员经常在这一点上过于兴奋。不要从一开始就添加不需要的依赖项。虽然包含奇特的库(例如Lombok)可能很有诱惑力，但你可能还不需要它们(<a class="ae ky" href="https://www.martinfowler.com/bliki/Yagni.html" rel="noopener ugc nofollow" target="_blank"> YAGNI </a>)。所以尽量只加基本的。您添加的每个依赖项也会增加应用程序的大小。</p><p id="ef93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您没有应用程序，请转到<a class="ae ky" href="https://spring.io/guides/gs/spring-boot/" rel="noopener ugc nofollow" target="_blank"> spring.io </a>创建一个。如果不想浪费太多时间开发，就创建一个hello world rest控制器。应该够了。基本上，我会推荐Gradle或Maven。应该没那么重要。在这个项目中，我和Gradle一起去。</p><p id="2f01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Gradle运行应用程序:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5dab" class="ne md it na b gy nf ng l nh ni">./gradlew bootRun</span></pre><p id="0759" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用Maven运行应用程序:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="38b3" class="ne md it na b gy nf ng l nh ni">./mvnw spring-boot:run</span></pre><p id="58cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要验证您的应用程序是否正常工作，请快速浏览一下。如果您正确地遵循了一个在线指南，那么运行一个基本的<code class="fe nj nk nl na b">curl</code>命令(GET request)应该会看到类似的结果:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5df2" class="ne md it na b gy nf ng l nh ni">$ <strong class="na iu">curl localhost:8080</strong><br/>Hey, I'm a hello world program (try this yourself)!</span></pre><p id="85b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样。应用程序正在运行！在下一节中，我们将确保它也适用于所有生产环境。您的代码可能是跨平台的，但是安装Docker应该足以运行程序。这样，代码就可以在任何地方运行。当然是在任何装有Docker的电脑或服务器上。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="070a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建Dockerfile文件</h1><p id="d851" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在上一节中，我们成功地构建了一个Spring应用程序。最近，我对一个Java 14应用程序做了同样的事情。第一条指令与此版本相关。你看，我们不必完全从零开始。我们将为Java 14使用一个小的——因此是alpine——open JDK映像:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d3ce" class="ne md it na b gy nf ng l nh ni">FROM openjdk:14-jdk-alpine</span></pre><p id="a130" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将确保我们的应用程序有一个用户组和一个用户。从技术上讲，您可以不使用下面两行代码继续，但是这样做并不明智(这只是一个最佳实践)。容器内的用户最终将获得运行应用程序所需的所有权限。</p><p id="6a8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nm">注意:关于Docker有太多需要学习的了。权限是我在与Jenkins一起工作时发现的一个重要问题。如果你对我有什么建议，请在评论中告诉我！</em></p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9b86" class="ne md it na b gy nf ng l nh ni">RUN addgroup -S spring &amp;&amp; adduser -S spring -G spring<br/>USER spring:spring</span></pre><p id="effe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一行必不可少。它将本地机器的构建文件夹(Gradle构建步骤的结果)中的<code class="fe nj nk nl na b">jar</code>文件复制到Docker文件夹中。为了便于使用，让我们将它复制到我们的spring用户文件夹中:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="42aa" class="ne md it na b gy nf ng l nh ni">COPY build/libs/*.jar home/spring/application.jar</span></pre><p id="56fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧，我们现在有一个<code class="fe nj nk nl na b">jar</code>文件可以使用了。再来两行就完事了。因为没有理由改变应用程序运行的端口(它运行在Docker中)，所以我把它留在8080。下一行只是为我们提供了这些信息。是的，没错。不要射我——我稍后会指定主机端口(在Docker <code class="fe nj nk nl na b">run</code>命令期间)！你可以把它看作文档。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="f825" class="ne md it na b gy nf ng l nh ni">EXPOSE 8080</span></pre><p id="4bec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一行是有魔力的一行。我们将使用众所周知的<code class="fe nj nk nl na b">java -jar</code>命令运行应用程序:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="0229" class="ne md it na b gy nf ng l nh ni">ENTRYPOINT ["java", "-jar", "/home/spring/application.jar"]</span></pre><p id="80a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已。如果您正确地构建并运行了这个Docker容器，您将看到与步骤1相同的结果。</p><p id="eb26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，你已经读到这里了，所以给你那些命令应该是公平的。我将为您包括它们:</p><ul class=""><li id="ca95" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated"><code class="fe nj nk nl na b">docker build -t app/hi:v0.1.0</code></li></ul><p id="5b9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">项目app <strong class="lb iu"> </strong>，应用程序名称hi，特性版本v0.1.0。我已经为版本化构建制定了一个命名约定，但是您可以随意使用您喜欢的任何版本化系统。如果你想推荐一个，那将非常感谢。</p><ul class=""><li id="c34d" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated"><code class="fe nj nk nl na b">docker run app/hi:v0.1.0 -p 8080:8080</code></li></ul><p id="82c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拥有这个Docker映像的每个人都可以运行您的应用程序。从现在开始，它可以在所有安装了Docker的机器上运行。是不是很牛逼？让我们把它提供给用户，我们会得到即时反馈！尽早获得反馈是非常有价值的！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2a8e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">奖励:MongoDB docker-撰写示例</h1><p id="e3a0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">用命令设置应用程序容器、数据库和大型应用程序的其他部分可能会成为一项单调乏味的工作。我不喜欢使用命令(如果你不记录它们，祝你好运记住它们)。有一个很棒的解决方案叫做<code class="fe nj nk nl na b">docker-compose</code>。在这个文件中，您可以描述端口、要使用的docker文件、重启策略等参数。</p><p id="75ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们分解一下这个MongoDB应用程序的<code class="fe nj nk nl na b">docker-compose</code>文件的例子。首先，它启动MongoDB数据库。然后，它启动处理存储和检索图像请求的应用程序。pet项目仍处于早期阶段，因此配置很可能会在未来发生变化。</p><p id="d1ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你对这个项目感兴趣，请随时提问。也欢迎建议！这可能是未来文章的主题，请继续关注。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="539e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="01b1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">嗯，就是这样。感谢您从头到尾的阅读！最后，我将总结一下我们在本文中所做的工作。</p><p id="ef71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们创建了一个小的Spring应用程序。有了这些优秀的指南，创建一个Spring应用程序应该很容易。总是从微小的应用程序开始。</p><p id="b7f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们学习了如何将这个应用程序包装到一个容器中，以便可以与我们的同事有效地共享。如今，Docker是你工具箱中的必备工具。在目前的就业市场上，对具有Docker和Kubernetes知识的开发人员的需求很高。</p><p id="4da1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们看到了一个稍微成熟一点的应用程序的样子。<code class="fe nj nk nl na b">Docker-compose</code>在搭建和维护集装箱的时候，会让你远离烦恼。在开发周期的早期就开始使用它。</p></div></div>    
</body>
</html>