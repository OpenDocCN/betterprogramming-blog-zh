<html>
<head>
<title>AWS Security Specialty — Key Management Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS安全专业—密钥管理服务</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/aws-security-specialty-kms-notes-5045c505a33b?source=collection_archive---------6-----------------------#2022-01-23">https://betterprogramming.pub/aws-security-specialty-kms-notes-5045c505a33b?source=collection_archive---------6-----------------------#2022-01-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="22a8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习某事的最好方法是写下来</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ede26f95271797c57212aed527ede9ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*48mJf6sFh7V7XUFc"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@moneyphotos?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> olieman.eth </a>拍摄的照片</p></figure><p id="2bd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我目前正在为<a class="ae ky" href="https://aws.amazon.com/certification/certified-security-specialty/" rel="noopener ugc nofollow" target="_blank"> AWS认证安全-专业</a>考试学习，围绕加密和密钥管理服务(KMS)的材料数量有点令人生畏。在通过了几次模拟考试，并把考试改了两次后，我决定写几篇关于我正在为自己和其他人努力的话题的文章，这可能会有所帮助。通过把这些都写下来，并且一丝不苟地核对每一个细节，我希望这些细节能够坚持下去。虽然我还在学习，所以如果有错误，给我留言。</p><p id="1720" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AWS在其<a class="ae ky" href="https://d0.awsstatic.com/whitepapers/aws-kms-best-practices.pdf" rel="noopener ugc nofollow" target="_blank">最佳实践白皮书</a>中，将KMS定义如下:</p><blockquote class="lv lw lx"><p id="ac8b" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">AWS密钥管理服务(AWS KMS)是一项托管服务，使您可以轻松创建和控制用于加密数据的加密密钥。AWS KMS使用硬件安全模块(HSM)来保护您的密钥的安全。您可以使用AWS KMS来保护AWS服务和应用程序中的数据。</p></blockquote><p id="750c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有在AWS中加密或解密数据的业务需求，KMS是您的最佳选择。它与包括EC2、S3、参数存储和Lambda在内的许多服务相集成，使得向AWS工作负载添加额外的安全层变得非常简单。值得注意的是，KMS是地区性的，而最近他们增加了使用多地区键的能力。</p><p id="817d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它更多地来自传统的数据中心环境，帮助我在考试中了解AWS服务如何映射到内部通常使用的解决方案。凭借其对对称和非对称密钥的管理，KMS类似于CyberArk PAM或HashiCorp Vault产品。我肯定有很多不同之处，但如果我迷失在一个问题中，而我根据CyberArk会如何做有一个很好的猜测，它很有可能是正确的。</p><h1 id="84a6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak"> CloudHSM </strong></h1><p id="1a70" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">正如描述中提到的，KMS使用了一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Hardware_security_module" rel="noopener ugc nofollow" target="_blank"> HSM </a>来保护存储在里面的密钥。然而，如果你想从上到下管理你的密钥<a class="ae ky" href="https://aws.amazon.com/cloudhsm/" rel="noopener ugc nofollow" target="_blank"> CloudHSM </a>就是你要去的地方。在这种情况下，HSM完全专用于您的帐户，密钥在CloudHSM中生成并存在，供KMS在KMS支持的所有托管服务中使用。</p><p id="1cae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果为了全面管理密钥管理生命周期，您的组织有特定的需求，那么可能有必要使用CloudHSM。重要的一点是，AWS对它没有管理(尽管它是通过CloudTrail 登录的<a class="ae ky" href="https://docs.aws.amazon.com/cloudhsm/latest/userguide/get-api-logs-using-cloudtrail.html" rel="noopener ugc nofollow" target="_blank">，它需要一个单独的SDK/CLI来与之交互，并且它是经过</a><a class="ae ky" href="https://en.wikipedia.org/wiki/FIPS_140-2" rel="noopener ugc nofollow" target="_blank">FIPS 3级</a>验证的。</p><h1 id="cbb4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">密钥很重要，让我们从限制访问开始</strong></h1><p id="f3fa" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">授予和限制对KMS键的访问权限有三种主要方法:键策略、IAM策略和授权。</p><p id="21df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/whitepapers/latest/kms-best-practices/key-policies.html" rel="noopener ugc nofollow" target="_blank">键策略</a>被附加到每个键上，每个键必须有且只有一个键策略。该策略概述了谁可以管理和使用密钥。关键政策是区域性的。</p><p id="62ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/kms/latest/developerguide/iam-policies.html" rel="noopener ugc nofollow" target="_blank"> IAM策略</a>是提供使用KMS密钥的可选方法。为了允许IAM策略授予对密钥的访问权限，密钥策略需要允许帐户使用IAM策略。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d558" class="ne md it na b gy nf ng l nh ni">“Principal”: {“AWS”: “arn:aws:iam::<em class="ly">111122223333</em>:root”},<br/>“Action”: “kms:*”,</span></pre><p id="ea04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/kms/latest/developerguide/grants.html" rel="noopener ugc nofollow" target="_blank">密钥授权</a>是一种向AWS主体提供对临时的、粒度的和编程的密钥的访问的方式。与在键或IAM策略中定义访问不同，为键创建授权将允许访问，主要由AWS资源使用。授权只能允许访问，不能拒绝。</p><h1 id="7a8e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">政策行动</strong></h1><p id="e422" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我遇到过几个处理KMS服务可用的特定权限和操作的场景。虽然这不是一个详尽的列表，也没有详细的解释，但它帮助我在回答政策问题时更加自信。</p><ul class=""><li id="0fb9" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated"><code class="fe ns nt nu na b">kms:Decrypt</code> —允许对KMS加密的密文进行解密。</li><li id="c276" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated"><code class="fe ns nt nu na b">kms:DescribeKey</code> —允许存储在KMS的客户管理或AWS管理的密钥的详细信息。</li><li id="0765" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated"><code class="fe ns nt nu na b">kms:Encrypt </code> —允许加密小于4KB的数据。如果您只生成一个数据密钥，则没有必要。</li><li id="ae3a" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated"><code class="fe ns nt nu na b">kms:GenerateDataKey</code> —生成唯一的对称数据密钥，该密钥提供明文版本的密文和加密版本。</li><li id="50db" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated"><code class="fe ns nt nu na b">kms:GenerateDataKeywithoutPlaintext</code> —类似于GenerateDataKey，但是它不提供密文的明文版本。</li></ul><p id="e798" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的是<strong class="lb iu">加密和解密功能只与KMS密钥</strong>相关。例如，因为<code class="fe ns nt nu na b">GenerateDataKeywithoutPlaintext</code>提供了一个加密的数据密钥，EBS只需要那个许可和<code class="fe ns nt nu na b">kms:Decrypt</code>就可以正确地加密存储卷。EBS卷中的数据加密独立于KMS，因此不需要特定的加密权限。</p><h1 id="68ce" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">政策条件</strong></h1><p id="019a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">基于我所看到的一切，<code class="fe ns nt nu na b">kms:ViaService</code>是唯一值得了解的政策条件。ViaService条件允许密钥管理员将密钥访问权限限制为仅需要它的AWS服务。例如，只有当请求来自特定地区(us-west-1)的特定服务(EC2)时，才允许访问密钥。</p><h2 id="d76b" class="ne md it bd me oa ob dn mi oc od dp mm li oe of mo lm og oh mq lq oi oj ms ok bi translated"><strong class="ak">按键、按键和更多按键</strong></h2><p id="fd82" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">通常，KMS管理对称和非对称密钥。创建密钥的方法有几种类型，如何管理它们决定了密钥的许多属性。这似乎是模拟考试中的一个热门话题，所以了解不同类型的键的细微差别以及它们是如何被管理的对很多问题都有好处。</p><p id="b52b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#kms_keys" rel="noopener ugc nofollow" target="_blank"> AWS自有密钥</a> —这些密钥归AWS服务所有，跨多个帐户使用，不能在KMS查看或编辑，并且具有客户无法设置的可变轮换计划。他们也是免费的。</p><p id="c98d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#key-mgmt" rel="noopener ugc nofollow" target="_blank"> AWS托管密钥</a> —定制密钥的最简单选项，这些密钥由AWS生成，对您的帐户是唯一的，存储在您的KMS实例中，由AWS每3年自动轮换一次。这些映射到资源，如S3或EBS，并链接到资源的生命周期。</p><p id="455e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#key-mgmt" rel="noopener ugc nofollow" target="_blank">客户管理的密钥</a> —一个简单的选项，允许对KMS密钥进行更多控制，客户可以管理许多方面，包括禁用、删除、轮换和密钥策略。轮换可以设置为每年轮换，也可以按需轮换。</p><p id="a0b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/kms/latest/developerguide/importing-keys.html" rel="noopener ugc nofollow" target="_blank">客户管理的密钥(导入)</a> —这允许更好地遵守密钥生成，并允许在AWS (Azure、on-prem等)之外使用密钥。).密钥必须手动旋转，并且可以删除，没有7到30天的时间限制。</p><p id="c2d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#keystore-concept" rel="noopener ugc nofollow" target="_blank">客户管理密钥(CloudHSM) </a> —位于KMS的自定义密钥库可以直接映射到CloudHSM实例。连接后，KMS可以生成对称密钥，并将它们存储在CloudHSM中的自定义密钥库中。</p><p id="136d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的是，KMS的一些租户适用于所有密钥:</p><ul class=""><li id="8004" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">KMS主密钥不会让KMS处于未加密状态。</li><li id="7049" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">您不能导出非对称密钥的私钥。</li></ul><h1 id="16e6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">关于对称和非对称密钥的注释</strong></h1><p id="c1ee" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我不打算讨论这两者之间的区别，因为这并不是真正的AWS重点，而且您可能从一般的安全知识中了解到这一点。大多数KMS课程都集中在对称密钥上。但是，有一些关于非对称密钥的<a class="ae ky" href="https://docs.aws.amazon.com/kms/latest/developerguide/symmetric-asymmetric.html" rel="noopener ugc nofollow" target="_blank">注意事项需要理解:</a></p><ul class=""><li id="6d09" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">你可以导出公钥，但是你必须调用KMS来使用私钥。</li><li id="aa37" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">与设置EC2实例时不同，您不能将非对称私钥导出到KMS之外。您需要CloudHSM来创建和导出一个非对称密钥对。</li><li id="6a40" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">对于非对称密钥，您不能将自己的密钥材料导入KMS。</li><li id="408b" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">您不能将加密上下文(下面讨论)与非对称密钥一起使用。</li></ul><h1 id="3f53" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">按键别名</strong></h1><p id="2536" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为键使用别名允许更用户友好的命名方案，并且还为应用程序提供了一个参考，其中被参考的键可以在不改变应用程序的情况下被改变。当引用带有导入密钥材料的客户管理密钥时，这很方便。</p><p id="976f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所述，具有导入的密钥材料的客户管理的密钥不能自动旋转，并且后备密钥材料不能简单地改变。它需要一把全新的钥匙。旋转密钥时，您可以选择通过更改密钥的源代码引用来更新应用程序，或者只需更改密钥别名以指向新密钥。</p><h1 id="1562" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak"> KMS键与数据键</strong></h1><p id="b613" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">到目前为止，这篇文章中的所有内容都集中在KMS群岛T2。如前所述，这些密钥只能用于加密或解密少量信息(4KB ),不能在KMS之外使用。对于大量需要加密数据的用例来说，这并没有什么帮助。</p><p id="49af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了加密和解密KMS以外的数据，包括大量数据，KMS可以生成使用KMS密钥保护的<a class="ae ky" href="https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#data-keys" rel="noopener ugc nofollow" target="_blank">数据密钥</a>。由于数据密钥由KMS密钥支持，它实质上允许通过数据密钥保护的数据由KMS密钥保护。这被称为E <a class="ae ky" href="https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#enveloping" rel="noopener ugc nofollow" target="_blank"> nvelope加密</a>，也允许通过Cloudtrail进行审计。</p><h1 id="9a9e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">加密上下文和附加认证数据</strong></h1><p id="5538" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于可能需要更精细地访问受KMS保护的数据的应用程序，管理员可以使用<a class="ae ky" href="https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#encrypt_context" rel="noopener ugc nofollow" target="_blank">加密上下文</a>。每个加密和解密调用都会传递一个非秘密的密钥对，在操作返回明文数据之前，需要验证所有的密钥对。这些密钥对被视为“附加认证数据”</p><p id="f049" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，假设您有一个管理客户SSN数据库的应用程序，您希望用KMS加密该数据库。应用程序可以访问加密和解密所有数据的KMS密钥。但是，如果您想确保系统进行的查询是有限的，该怎么办呢？您可以确保当数据被加密时，<code class="fe ns nt nu na b">userEmail: john@gmail.com</code>加密上下文也随之传递。如果系统想要查找客户的SSN，它们需要传递客户的电子邮件地址，作为额外的验证器，表明它正在请求正确的信息。如果能够获得密钥的人试图在没有电子邮件的情况下解密数据，将会失败。</p><p id="ba6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的是，传递的数据是非秘密的，并且记录在Cloudtrail中。对于上面的例子，不要使用SSN作为你的键对！</p><h1 id="c516" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">服务器端与客户端加密</strong></h1><p id="350d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在S3有很多关于如何保护数据的资料，理解服务器端加密和客户端加密之间的区别很重要。</p><p id="71aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">服务器端加密是AWS管理加密和解密的地方，利用AWS拥有的密钥(<a class="ae ky" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingServerSideEncryption.html" rel="noopener ugc nofollow" target="_blank"> SSE-S3 </a>)、KMS的AWS/客户管理的密钥(<a class="ae ky" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html" rel="noopener ugc nofollow" target="_blank"> SSE-KMS </a>)，或者利用亚马逊加密SDK ( <a class="ae ky" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/specifying-s3-c-encryption.html" rel="noopener ugc nofollow" target="_blank"> SSE-C </a>)保存在AWS外部的客户管理的密钥，当数据被写入桶时，它被自动加密。但是，任何能够访问bucket使用的键(以及bucket本身)的人都可以访问整个bucket中的数据。</p><p id="9b8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingClientSideEncryption.html" rel="noopener ugc nofollow" target="_blank">客户端加密</a>，使用AWS Encryption SDK或任何其他加密工具，可以更好地控制谁可以访问存储桶中的数据。客户端加密的密钥可以存储在KMS，或者应用程序所有者可以以另一种方式存储它们，完全不用AWS。S3看到的唯一数据是加密的有效载荷，AWS没有参与加密。</p><p id="2b1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一点很重要，需要理解:在AWS中加密数据的唯一方法是使用SDK并单独管理密钥，要么通过SSE-C，要么通过客户端加密。当数据需要满足最高级别的安全性或法规遵从性时，这可能是最佳答案，例如医疗保健数据。</p><h1 id="6874" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">把所有的放在一起</h1><p id="ca78" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在浏览了大量关于KMS的资料后，我列出了下面这些我还在继续研究的东西，这些东西激发了我写这篇文章的灵感。</p><ul class=""><li id="4911" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">了解KMS键可用的不同选项:<br/> —命名<br/> —元数据<br/> —管理(启用/禁用、删除、手动轮换等)<br/> —轮换计划</li><li id="2481" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">为什么你会在KMS使用进口钥匙？<br/> —在AWS之外的应用中使用<br/> —可用性/耐用性要求<br/> —合规性</li><li id="367b" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">KMS不直接加密/解密数据，除非数据小于4KB。</li><li id="31c2" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">必须通过创建新的备用密钥并更改正在使用的密钥或更新别名来手动旋转导入的密钥材料。<br/> —您不能简单地将新的密钥材料导入同一个KMS密钥。</li><li id="8bcb" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">KMS将保留旧密钥，并且将总是解密数据，即使该密钥不是主要加密密钥(例如，它已经被旋转)。不要删除旧的密钥，除非你知道不再需要它。</li><li id="ce77" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">如果您被要求在S3存储数据，而合规性要求规定AWS根本不能访问这些数据，那么您可能会考虑SSE-C或客户端加密。</li><li id="7788" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">S3中用KMS加密的对象提供了另一层防止公共共享的保护，因为请求用户除了访问桶之外还需要访问密钥，而匿名(公共)用户将不能访问。</li><li id="1e07" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">如果你需要提供<strong class="lb iu">临时</strong>、<strong class="lb iu">粒度</strong>或<strong class="lb iu">程序化</strong>访问密钥，你需要使用密钥授权。</li><li id="c84f" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated"><code class="fe ns nt nu na b">kms:ViaService</code>限制从特定的AWS服务访问KMS密钥。</li><li id="ee8e" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">直到最近，键都是特定于地区的。如果您处理的是特定于地区的密钥，则在地区之间移动的任何数据都需要在目标地区用KMS密钥重新加密。</li><li id="a356" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">客户管理的KMS密钥的密钥删除期为7至30天。导入的关键材料可以随时删除。</li><li id="0ed0" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">如果您需要FIPS 3级，您可以选择CloudHSM。KMS只有FIPS二级。</li><li id="d5f0" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">密钥授权只能允许访问，不能用于拒绝访问。</li><li id="4174" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">加密EBS卷(以及其他服务的基线)的最小值是<code class="fe ns nt nu na b">kms:Decrypt</code>和<code class="fe ns nt nu na b">kms:GenerateDataKeyWithoutPlaintext</code>。数据密钥的生成处理数据密钥的原始加密，因此<code class="fe ns nt nu na b">kms:Encrypt</code>是不必要的。</li></ul><h1 id="cdf4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="f6be" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">写完这篇文章后，阅读KMS章节变得简单多了。这也让我对我的KMS知识感到足够舒服，我实际上可以应用我所学到的东西，我不仅限于试图通过考试。希望它也能帮助其他人。</p></div></div>    
</body>
</html>