<html>
<head>
<title>How To Avoid Merge Conflicts In Xcode Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何避免Xcode项目中的合并冲突</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-avoid-merge-conflicts-in-xcode-projects-a0202be2ac73?source=collection_archive---------2-----------------------#2022-10-25">https://betterprogramming.pub/how-to-avoid-merge-conflicts-in-xcode-projects-a0202be2ac73?source=collection_archive---------2-----------------------#2022-10-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1656" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Xcode对于git项目格式来说可能不太舒服。xcodegen工具将其替换为简单的YAML文件。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6cb9e9f73bec2fcadcd9ccce6c89e0cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SrgDqvTUcS_Bcs9e"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@headwayio?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">车头时距</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">挡泥板</a>上拍摄</p></figure><p id="9003" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Xcode是一个非常强大的IDE，历史悠久，功能丰富。但即使在多年来开发者的抱怨和App Store的低评级之后，苹果仍未解决一些核心问题。其中之一是项目文件结构。我已经写了一篇关于Xcode问题的文章，你可以在这里查看<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/writing-ios-apps-without-xcode-89450d0de21a"/>。</p><p id="66bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使您使用AppCode或从另一个第三方工具导出您的项目，git(或其他存储库)也必须处理一般的<code class="fe lv lw lx ly b">xcodeproj</code>结构，特别是<code class="fe lv lw lx ly b">pbxproj</code>文件。</p><p id="3455" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Xcode没有使用JSON风格的树结构，而是使用自己的专有格式和自动生成的对象id，这造成了很多合并冲突。</p><p id="2717" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有两种方法可以解决这个问题:</p><ol class=""><li id="8565" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated">您可以创建一个工作区，并将您的项目拆分成许多小项目。</li><li id="7372" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">您可以使用<code class="fe lv lw lx ly b">xcodegen</code>生成一个项目，并将其从您的存储库中排除。</li></ol><p id="296d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将描述第二种方式。</p><h1 id="e28f" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">什么是<code class="fe lv lw lx ly b">xcodegen?</code></h1><p id="45c8" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">这是一个从<code class="fe lv lw lx ly b">yaml</code>描述生成Xcode项目的免费开源工具。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/0bf88940d0d0c28c6f9eea0c0c84a633.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*mjtv3txAKlkUPB7643Ekuw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://github.com/yonaskolb/XcodeGen" rel="noopener ugc nofollow" target="_blank">https://github.com/yonaskolb/XcodeGen</a>的Xcodegen标志</p></figure><p id="20fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">项目描述文件不必包含整个结构。<code class="fe lv lw lx ly b">xcodegen</code>按照YAML文件中定义的规则，自动从选定的文件夹中查找文件。</p><p id="4fd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">支持不同的目标、构建设置、定制模式、单元测试和许多其他特性。让我们回顾一下它是如何工作的。</p><h2 id="223f" class="nl mo it bd mp nm nn dn mt no np dp mx li nq nr mz lm ns nt nb lq nu nv nd nw bi translated">它是如何工作的</h2><p id="80c7" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">首先，你需要安装<code class="fe lv lw lx ly b">xcodegen</code>:</p><pre class="kj kk kl km gt nx ly ny nz aw oa bi"><span id="7f64" class="nl mo it ly b gy ob oc l od oe">brew install xcodegen</span></pre><p id="78a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其次，创建一个<code class="fe lv lw lx ly b">project.yaml</code>文件。您可以编写自己的配置，或者使用来自官方GitHub库的示例:</p><pre class="kj kk kl km gt nx ly ny nz aw oa bi"><span id="003e" class="nl mo it ly b gy ob oc l od oe"><a class="ae ky" href="https://github.com/yonaskolb/XcodeGen" rel="noopener ugc nofollow" target="_blank">https://github.com/yonaskolb/XcodeGen</a></span></pre><p id="057d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，运行:</p><pre class="kj kk kl km gt nx ly ny nz aw oa bi"><span id="de8c" class="nl mo it ly b gy ob oc l od oe">xcodegen generate</span></pre><p id="d0a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果成功，你会得到一个<code class="fe lv lw lx ly b">xcodeproj</code>文件夹，即使你以前没有它。现在可以用Xcode或者AppCode打开了。</p><h2 id="5eee" class="nl mo it bd mp nm nn dn mt no np dp mx li nq nr mz lm ns nt nb lq nu nv nd nw bi translated">配置</h2><p id="4388" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated"><code class="fe lv lw lx ly b">xcodegen</code>有非常丰富的配置文件。它有一个<code class="fe lv lw lx ly b">yaml</code>格式，默认名称是<code class="fe lv lw lx ly b">project.yaml</code>。第一行通常是项目的名称:</p><pre class="kj kk kl km gt nx ly ny nz aw oa bi"><span id="a057" class="nl mo it ly b gy ob oc l od oe">name: myproject</span></pre><p id="f09e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它定义了项目名和项目文件名。<code class="fe lv lw lx ly b">options</code>参数设置项目范围的选项:</p><pre class="kj kk kl km gt nx ly ny nz aw oa bi"><span id="2ff5" class="nl mo it ly b gy ob oc l od oe">options:<br/>  minimumXcodeGenVersion: 2.23<br/>  deploymentTarget:<br/>    iOS: "13.0"</span></pre><p id="a84c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的例子设置了一个最小的<code class="fe lv lw lx ly b">xcodegen</code>版本。您需要使用支持您使用的所有功能的最低版本。新版本可能会添加新选项。最低版本应该支持您使用的所有选项。<code class="fe lv lw lx ly b">deploymentTarget</code>设置最低平台版本。每个平台的版本号都不同。</p><p id="5c5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">packages</code>选项添加了对Swift Package Manager包的引用:</p><pre class="kj kk kl km gt nx ly ny nz aw oa bi"><span id="d369" class="nl mo it ly b gy ob oc l od oe">packages:<br/>  Yams:<br/>    url: https://github.com/jpsim/Yams<br/>    from: 2.0.0</span></pre><p id="2cb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在这里列出所有SPM依赖项，这样以后就可以只通过名称来引用它们。</p><p id="ee8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">配置文件可以包括其他文件:</p><pre class="kj kk kl km gt nx ly ny nz aw oa bi"><span id="2ea8" class="nl mo it ly b gy ob oc l od oe">include:<br/>  - config.yml</span></pre><p id="37af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有多个项目的一些基本配置，或者想要缩短您的主配置文件，可以使用这种方法。</p><p id="33e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最重要的配置项是<code class="fe lv lw lx ly b">targets</code>。它用特定于目标的选项设置了一个目标列表(应用程序、库、框架、单元测试等)。</p><pre class="kj kk kl km gt nx ly ny nz aw oa bi"><span id="f15f" class="nl mo it ly b gy ob oc l od oe">targets:<br/>  myapp:<br/>    type: application<br/>    platform: iOS<br/>    sources:<br/>      - path: project_root<br/>        excludes: <br/>          - "*.md"<br/>      - path: project_additional_files<br/>    dependencies:<br/>      - target: mylib<br/>      - framework: SomeFramework.framework<br/>      - sdk: libc++.tbd<br/>      - package: Yams<br/>    settings:<br/>      PRODUCT_NAME: My Project<br/>      SWIFT_VERSION: 5.7<br/>      ENABLE_BITCODE: YES<br/>  mylib:<br/>    type: framework<br/>    platform: iOS<br/>    sources:<br/>      - path: library_path</span></pre><p id="3827" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种配置非常简单。每个目标都有一个<code class="fe lv lw lx ly b">type</code>，表示它是一个库、框架、应用程序还是其他目标。<code class="fe lv lw lx ly b">platform</code>定义目标平台，例如<code class="fe lv lw lx ly b">iOS</code>。</p><p id="91cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">sources</code>有一个源文件的路径列表。它们相对于<code class="fe lv lw lx ly b">project.yaml</code>文件。您可以使用<code class="fe lv lw lx ly b">excludes</code>列表排除一些文件。</p><p id="dbee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">dependencies</code>设置项目依赖列表。它们可以是同一个项目的目标、作为文件夹分发的框架、静态库、SPM包等等。</p><p id="c7ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">settings</code>包含应用程序构建设置列表。例如，标题搜索路径、ld标志、位代码、swift版本等等。您可以在原始Xcode项目中看到密钥列表。</p><p id="b3e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在<code class="fe lv lw lx ly b">xcodegen</code>的官方GitHub库上找到完整的文档:</p><pre class="kj kk kl km gt nx ly ny nz aw oa bi"><span id="e292" class="nl mo it ly b gy ob oc l od oe"><a class="ae ky" href="https://github.com/yonaskolb/XcodeGen" rel="noopener ugc nofollow" target="_blank">https://github.com/yonaskolb/XcodeGen</a></span></pre><h2 id="b0f1" class="nl mo it bd mp nm nn dn mt no np dp mx li nq nr mz lm ns nt nb lq nu nv nd nw bi translated"><code class="fe lv lw lx ly b">.gitignore</code></h2><p id="7436" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">因为我们的主要目标是消除合并冲突，所以您需要从存储库中排除项目。如果您使用git——它是Xcode项目最流行的存储库——您需要将这一行添加到<code class="fe lv lw lx ly b">.gitignore</code>文件中:</p><pre class="kj kk kl km gt nx ly ny nz aw oa bi"><span id="9c2b" class="nl mo it ly b gy ob oc l od oe">my-project.xcodeproj/</span></pre><p id="2d5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你也使用<code class="fe lv lw lx ly b">CocoaPods</code>，你也可以删除<code class="fe lv lw lx ly b">Pods</code>文件夹和<code class="fe lv lw lx ly b">workspace</code>文件:</p><pre class="kj kk kl km gt nx ly ny nz aw oa bi"><span id="db0a" class="nl mo it ly b gy ob oc l od oe">my-project.xcworkspace/<br/>Pods/</span></pre><h2 id="c136" class="nl mo it bd mp nm nn dn mt no np dp mx li nq nr mz lm ns nt nb lq nu nv nd nw bi translated"><code class="fe lv lw lx ly b">xcodegen</code>同<code class="fe lv lw lx ly b">CocoaPods</code></h2><p id="ea87" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated"><code class="fe lv lw lx ly b">xcodegen</code>和<code class="fe lv lw lx ly b">CocoaPods</code>可以一起使用。您需要首先生成一个项目，然后安装pod:</p><pre class="kj kk kl km gt nx ly ny nz aw oa bi"><span id="dbae" class="nl mo it ly b gy ob oc l od oe">xcodegen generate<br/>pod install</span></pre><p id="a511" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以编写一个运行这些命令的简单脚本。如果使用其他自动生成的内容，也可以在此脚本中生成。</p><h2 id="c85b" class="nl mo it bd mp nm nn dn mt no np dp mx li nq nr mz lm ns nt nb lq nu nv nd nw bi translated">编辑生成的项目</h2><p id="0d32" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">可以编辑生成的项目进行实验，或者创建文件并添加到项目中。但是请记住，每次运行<code class="fe lv lw lx ly b">xcodegen generate</code>时，所有的更改都将被丢弃。这就是为什么您需要在将更改推送到存储库之前在<code class="fe lv lw lx ly b">project.yaml</code>中进行更改。</p><p id="12af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">唯一的例外是文件。当您使用Xcode创建一个新文件时，它会出现在文件系统中。从文件系统中读取文件，所以即使在重新生成之后，它们也会出现在你的项目中。</p><h1 id="ce48" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">结论</h1><p id="56fa" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated"><code class="fe lv lw lx ly b">xcodegen</code>是一个非常强大的工具，涵盖了Xcode的全部或几乎全部特性。它有助于避免合并冲突，并允许直接从文件树中生成项目，而无需手动将它们添加到项目中。</p><p id="e28e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我向所有至少有2-3名开发人员参与同一个项目的团队推荐这个工具。尤其是大项目。</p><p id="d25c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p></div></div>    
</body>
</html>