<html>
<head>
<title>Valtio — The Most Minimal Proxy State Possible in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">valtio——React中可能的最小代理状态</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/valtio-the-most-minimal-proxy-state-possible-in-react-764a67ba4833?source=collection_archive---------5-----------------------#2020-11-24">https://betterprogramming.pub/valtio-the-most-minimal-proxy-state-possible-in-react-764a67ba4833?source=collection_archive---------5-----------------------#2020-11-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8702" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">React的另一个州库？React的可变全局状态</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/da75f5cfae1dbf4fc4a9cbf755226828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c4oe11SUsgV643BhpuLNGQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/pmndrs/valtio" rel="noopener ugc nofollow" target="_blank">https://github.com/pmndrs/valtio</a>(图片来源:作者)</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="8a5f" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">这是谁创造的？</h1><p id="a929" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这是由<a class="mu mv ep" href="https://medium.com/u/70508c010e42?source=post_page-----764a67ba4833--------------------------------" rel="noopener" target="_blank">大石加藤</a>制作的。他是以下作品的创作者:</p><ul class=""><li id="f387" class="mw mx it ma b mb my me mz mh na ml nb mp nc mt nd ne nf ng bi translated"><a class="ae ky" href="https://github.com/pmndrs/zustand" rel="noopener ugc nofollow" target="_blank">https://github.com/pmndrs/zustand</a>(zustand简化通量/redux)</li><li id="3746" class="mw mx it ma b mb nh me ni mh nj ml nk mp nl mt nd ne nf ng bi translated"><a class="ae ky" href="https://github.com/pmndrs/jotai" rel="noopener ugc nofollow" target="_blank">https://github.com/pmndrs/jotai</a>(日台简化原子原理)</li></ul></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3a7e" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">为什么是这个图书馆？</h1><p id="a5b3" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">正如你所看到的，造物主已经创造了难以置信的项目来简化通量或原子状态，这三种类型中唯一缺少的部分就是代理。</p><p id="3e9b" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh nm mj mk ml nn mn mo mp no mr ms mt im bi translated">这个库将MobX的Immer/proxy状态简化到了它的核心:一个对象，你改变了它的任何部分，组件就会做出反应。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="d81f" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">什么是代理状态？</h1><p id="46f0" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">JavaScript代理可以观察嵌套对象的变化。这意味着没有传统的选择或区别。</p><p id="a889" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh nm mj mk ml nn mn mo mp no mr ms mt im bi translated"><em class="np">状态</em>是驱动应用程序的数据。通常有<em class="np">特定领域状态</em>比如待办事项列表，有<em class="np">视图状态</em>比如当前选中的元素。状态就像保存值的电子表格单元格。</p><p id="ba4c" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh nm mj mk ml nn mn mo mp no mr ms mt im bi translated">将状态存储在您喜欢的任何数据结构中:普通对象、数组、类、循环数据结构或引用。这对瓦提奥的运作无关紧要。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="55ff" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">如何开始</h1><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="1c02" class="nv lh it nr b gy nw nx l ny nz"># if you use npm<br/>npm install valtio<br/># if you use yarn<br/>yarn add valtio</span></pre><p id="98ef" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh nm mj mk ml nn mn mo mp no mr ms mt im bi translated">接下来你可以做的四件事是:</p><h2 id="2d45" class="nv lh it bd li oa ob dn lm oc od dp lq mh oe of ls ml og oh lu mp oi oj lw ok bi translated">1.创建您的代理状态</h2><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="5cc1" class="nv lh it nr b gy nw nx l ny nz">import { proxy } from 'valtio'<br/><br/>const state = proxy({ count: 0, userName: '' })</span></pre><h2 id="d422" class="nv lh it bd li oa ob dn lm oc od dp lq mh oe of ls ml og oh lu mp oi oj lw ok bi translated">2.改变状态</h2><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="16a6" class="nv lh it nr b gy nw nx l ny nz"><em class="np">// You can freely mutate it from anywhere you want ...<br/></em>state.nested = { ticks: 0 }</span><span id="4d6d" class="nv lh it nr b gy ol nx l ny nz">setInterval(() =&gt; state.nested.ticks++, 200)</span><span id="6564" class="nv lh it nr b gy ol nx l ny nz">setInterval(() =&gt; { state.count++ }, 1000)</span></pre><h2 id="46a9" class="nv lh it bd li oa ob dn lm oc od dp lq mh oe of ls ml og oh lu mp oi oj lw ok bi translated">3.通过<code class="fe om on oo nr b">useProxy</code>做出反应</h2><p id="a99a" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这将从代理制作值的副本或快照。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="2b54" class="nv lh it nr b gy nw nx l ny nz">import { useProxy } from 'valtio'<br/>function Counter() {<br/>  const snapshot = useProxy(state)<br/>  // Rule of thumb: read from snapshots, mutate the source<br/>  // The component renders when the snapshot-reads change<br/>  return (<br/>    &lt;div&gt;<br/>      {snapshot.count}<br/>      &lt;button onClick={() =&gt; ++state.count}&gt;+1&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre><h2 id="1c19" class="nv lh it bd li oa ob dn lm oc od dp lq mh oe of ls ml og oh lu mp oi oj lw ok bi translated">4.从任何地方订阅更改</h2><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="6be8" class="nv lh it nr b gy nw nx l ny nz">import { subscribe } from 'valtio'<br/><br/>// Suscribe to all state changes<br/>const unsubscribe = subscribe(state, () =&gt; console.log(`state has changed to ${state}`))</span><span id="ea97" class="nv lh it nr b gy ol nx l ny nz">// Unsubscribe by calling the result<br/>unsubscribe()</span><span id="0db5" class="nv lh it nr b gy ol nx l ny nz">// Subscribe to a portion of state<br/>subscribe(state.foo, () =&gt; console.log(`state.foo has changed to ${state.foo}`))</span></pre><p id="8315" class="pw-post-body-paragraph ly lz it ma b mb my ju md me mz jx mg mh nm mj mk ml nn mn mo mp no mr ms mt im bi translated">这里可以免费开始玩Valtio:<a class="ae ky" href="https://codesandbox.io/s/valtio-simple-counter-qqljs" rel="noopener ugc nofollow" target="_blank">Valtio-simple-counter-qqljs</a>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="6f61" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">Valtio和MobX的对比</h1><div class="kj kk kl km gt ab cb"><figure class="op kn oq or os ot ou paragraph-image"><a href="https://codesandbox.io/s/valtio-tic-tac-j0nut"><img src="../Images/d1010476ddcc0aa0c690da5fdab01c92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*vRsrqRNiRJ5jRxiFLsuSRw.png"/></a></figure><figure class="op kn ov or os ot ou paragraph-image"><a href="https://codesandbox.io/s/mobx-tic-tac-ugfny"><img src="../Images/96d6728eb772256fa7d6a8d76549660a.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*mUf7NAL4bwPhnN-6j8VCuw.png"/></a><p class="ku kv gj gh gi kw kx bd b be z dk ow di ox oy translated">【https://codesandbox.io/s/valtio-tic-tac-j0nut】(左)<a class="ae ky" href="https://codesandbox.io/s/mobx-tic-tac-ugfny" rel="noopener ugc nofollow" target="_blank">https://codesandbox.io/s/mobx-tic-tac-ugfny</a>(右)</p></figure></div></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="23d2" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">总结，或TLDR</h1><p id="b861" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Valtio简化了代理状态。想想类似MobX的东西，但是没有99%的API面可以使用，增加了开发体验质量！</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="1e9f" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">如果你想了解更多关于钩子的知识</h1><p id="3deb" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我在开始使用自定义钩子和Next的时候亲自看过<strong class="ma iu"/><a class="ae ky" href="https://amzn.to/2UFiZ5F" rel="noopener ugc nofollow" target="_blank"><strong class="ma iu">学习React钩子</strong></a><strong class="ma iu"/>。Js或Gatsby，它每天都帮助我理解React及其插件和库的生态系统:<a class="ae ky" href="https://amzn.to/2UFiZ5F" rel="noopener ugc nofollow" target="_blank">https://amzn.to/2UFiZ5F</a></p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="c127" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">资源</h1><ul class=""><li id="f0a8" class="mw mx it ma b mb mc me mf mh oz ml pa mp pb mt nd ne nf ng bi translated"><a class="ae ky" href="https://github.com/pmndrs/valtio" rel="noopener ugc nofollow" target="_blank">https://github.com/pmndrs/valtio</a></li><li id="d3f9" class="mw mx it ma b mb nh me ni mh nj ml nk mp nl mt nd ne nf ng bi translated"><a class="ae ky" href="https://codesandbox.io/s/valtio-simple-counter-qqljs" rel="noopener ugc nofollow" target="_blank">https://codesandbox.io/s/valtio-simple-counter-qqljs</a></li><li id="e12b" class="mw mx it ma b mb nh me ni mh nj ml nk mp nl mt nd ne nf ng bi translated"><a class="ae ky" href="https://twitter.com/dai_shi" rel="noopener ugc nofollow" target="_blank">https://twitter.com/dai_shi</a></li><li id="6a58" class="mw mx it ma b mb nh me ni mh nj ml nk mp nl mt nd ne nf ng bi translated"><a class="ae ky" href="https://amzn.to/2UFiZ5F" rel="noopener ugc nofollow" target="_blank">https://amzn.to/2UFiZ5F</a></li></ul></div></div>    
</body>
</html>