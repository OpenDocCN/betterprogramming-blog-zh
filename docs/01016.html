<html>
<head>
<title>Using the Command Pattern</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用命令模式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/utilizing-the-command-pattern-to-support-undo-redo-and-history-of-operations-b28fa9d58910?source=collection_archive---------0-----------------------#2019-08-07">https://betterprogramming.pub/utilizing-the-command-pattern-to-support-undo-redo-and-history-of-operations-b28fa9d58910?source=collection_archive---------0-----------------------#2019-08-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d60f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">支持操作的撤消、重做和历史记录</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/88b4369f100341b5bbcf9f5e92477849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQHWV5c1xsQJN1pL0FOizw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@tfrants" rel="noopener ugc nofollow" target="_blank">t rants</a>在<a class="ae ky" href="https://unsplash.com/search/photos/typing?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="59e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近有机会开发一个基于网络的图表应用程序，它需要实现<em class="lv">撤销</em>、<em class="lv">重做</em>和<em class="lv">操作历史</em>。</p><p id="6b8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在处理撤销和重做这样的操作时，有两种主要的软件开发模式是显而易见的选择:<a class="ae ky" href="http://www.parkeresmay.com/memento-and-command-pattern-for-undo/" rel="noopener ugc nofollow" target="_blank"> Memento和Command </a>模式。在这篇文章中，我将简化这两个功能的实现过程，对传统的命令模式做一些小小的修改。</p><p id="0c58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图概述了主要组件:</p><ul class=""><li id="1f95" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated"><code class="fe mf mg mh mi b">Action</code>接口，包括两个方法，执行和撤销。</li><li id="8aa7" class="lw lx it lb b lc mj lf mk li ml lm mm lq mn lu mb mc md me bi translated">两个修改过的链表，我喜欢称之为“队列栈”,因为它们像栈一样推送，像队列一样弹出</li><li id="943b" class="lw lx it lb b lc mj lf mk li ml lm mm lq mn lu mb mc md me bi translated"><code class="fe mf mg mh mi b">CommandManager</code>，它将处理核心功能，执行动作和撤销/重做。</li></ul><p id="b258" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，<code class="fe mf mg mh mi b">CommandManager</code>的<code class="fe mf mg mh mi b">execute</code>方法需要一系列动作，例如，在绘图程序中，我们定义了删除形状的动作，同时我们可以选择和删除多个形状。每一个执行的动作都会在<code class="fe mf mg mh mi b">QueueStackNormal</code>中注册——当执行撤销时，会弹出该动作，调用撤销方法并推送到<code class="fe mf mg mh mi b">QueueStackReverse</code>，反之则进行重做操作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/9e0ca3b29085099f586fec9f34a83fe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*e9CWYKgyPLQZVv2k5G0_NQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">体系结构</p></figure><p id="f3bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mf mg mh mi b">clear</code>方法用于清除所有注册的动作。为每个队列堆栈提供两个明确的方法将是有用的，这样在一些撤销操作之后(当<code class="fe mf mg mh mi b">QueueStackReverse</code>被填充时),用户在板上绘制另一个矩形。我们可能还想清空队列堆栈，这样单击重做就不会导致任何不必要的行为。</p><p id="7bb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设逻辑解释清楚了，我们就可以进行编码了。既然我们已经正式定义了组件和交互，这应该很容易。代码可以在<a class="ae ky" href="https://github.com/njofce/codingimpossible_command" rel="noopener ugc nofollow" target="_blank">这个链接</a>找到。</p><p id="618a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们定义了<code class="fe mf mg mh mi b">QueueStack</code>，它被实现为一个泛型类。这个数据结构在内部使用了一个<code class="fe mf mg mh mi b">LinkedList</code>。当向它添加一个项目时，它的行为类似于一个堆栈(项目被添加在开始处)，当弹出元素时，它的行为类似于一个队列(最后一个元素被移除并返回)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="a13d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们定义<code class="fe mf mg mh mi b">Action</code>接口。每个要实现它的类都应该为以下内容提供一个实现:</p><ul class=""><li id="2ade" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">方法<code class="fe mf mg mh mi b">execute</code>，当动作被记录并且需要执行所需的操作时，将调用该方法</li><li id="0d39" class="lw lx it lb b lc mj lf mk li ml lm mm lq mn lu mb mc md me bi translated"><code class="fe mf mg mh mi b">undo</code>，当该动作被撤销时将被调用</li><li id="5118" class="lw lx it lb b lc mj lf mk li ml lm mm lq mn lu mb mc md me bi translated">一个实用方法，<code class="fe mf mg mh mi b">getName</code>，将用于显示动作的历史。</li></ul><p id="56c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，通过将<code class="fe mf mg mh mi b">Action</code>定义为抽象类，可以进一步简化代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="c582" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们实现了<code class="fe mf mg mh mi b">CommandManager</code>，建模为单例，因为它通过各自的数据结构在内部管理动作和历史的状态。<strong class="lb iu">命令管理器</strong>允许执行一系列动作，执行撤销和重做以及检索操作历史。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="ca0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了测试工作流，我实现了一个简单的main方法，通过执行不同的操作与<code class="fe mf mg mh mi b">CommandManager</code>交互。输出如下所示:</p><h2 id="10d8" class="mr ms it bd mt mu mv dn mw mx my dp mz li na nb nc lm nd ne nf lq ng nh ni nj bi translated"><strong class="ak"> <em class="nk">输出</em> </strong></h2><p id="cb10" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated"><strong class="lb iu"><em class="lv">= = =动作= =</em>= =</strong></p><p id="0962" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">执行动作1 </em> </strong></p><p id="3d3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">执行动作2 </em> </strong></p><p id="3968" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">撤消动作1 </em> </strong></p><p id="80aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">撤销动作2 </em> </strong></p><p id="4598" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">执行动作1 </em> </strong></p><p id="3201" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">执行动作2 </em> </strong></p><p id="3901" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"><em class="lv">= = =历史= =</em>= =</strong></p><p id="8f43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">【动作1，动作2，动作1 —撤销，动作2 —撤销，动作1 —重做，动作2 —重做】</em> </strong></p><p id="d468" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这能对你有所帮助。期待听到大家的建议。</p></div><div class="ab cl nq nr hx ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="im in io ip iq"><h1 id="f022" class="nx ms it bd mt ny nz oa mw ob oc od mz jz oe ka nc kc of kd nf kf og kg ni oh bi translated"><strong class="ak">资源:</strong></h1><p id="8240" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated"><a class="ae ky" href="https://www.baeldung.com/java-command-pattern" rel="noopener ugc nofollow" target="_blank">https://www.baeldung.com/java-command-pattern</a></p><p id="70b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://stackoverflow.com/questions/32597736/why-should-i-use-the-command-design-pattern-while-i-can-easily-call-required-met" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/32597736/why-should-I-use-the-command-design-pattern-while-I-can-easy-call-required-met</a></p><p id="ef7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://sourcemaking.com/design_patterns/command" rel="noopener ugc nofollow" target="_blank">https://sourcemaking.com/design_patterns/command</a></p><p id="24f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="http://www.parkeresmay.com/memento-and-command-pattern-for-undo/" rel="noopener ugc nofollow" target="_blank">http://www . Parker esmay . com/memento-and-command-pattern-for-undo/</a></p></div></div>    
</body>
</html>