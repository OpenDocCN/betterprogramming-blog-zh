<html>
<head>
<title>Notes on Spring Boot 3 Upgrade</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Boot协议3升级说明</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/notes-on-spring-boot-3-upgrade-a15e16f84862?source=collection_archive---------1-----------------------#2022-09-01">https://betterprogramming.pub/notes-on-spring-boot-3-upgrade-a15e16f84862?source=collection_archive---------1-----------------------#2022-09-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ee27" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在本快速指南中了解即将到来的变化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4d5b55abe9e8c6543dfd1945435ffb2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ztyqm3POY1E2KpU5CO_gEg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片</p></figure><p id="30af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">随着Spring Boot 3.0 GA版本即将发布(2022年11月)，是时候开始准备和升级我们现有的Spring Boot微服务到最新的Spring Boot 3里程碑版本3.0.0-M4了。我正在分享我将一个微服务升级到Spring Boot 3的笔记。希望对你有帮助。</p><h1 id="a7aa" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">先决条件</h1><ul class=""><li id="6049" class="mm mn it la b lb mo le mp lh mq ll mr lp ms lt mt mu mv mw bi translated">Java 17。Spring Boot 3.0将基于Spring Framework 6.0，需要Java 17或更高版本。如果您的微服务是基于较旧的Java版本构建的，请确保在执行以下步骤之前先将其升级到Java 17。</li><li id="6010" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated">升级到最新的Spring Boot 2.7.x。如果您的微服务设置了dependabot工作流，那么在撰写本文时，您的微服务应该已经自动升级到最新的Spring Boot 2.7.x版本2.7.3。但是如果，不管出于什么原因，你的微服务仍然在旧版本的Spring Boot上，确保你在继续之前先升级到最新的2.7.x。同时，如果您的微服务还没有设置，请设置您的dependabot工作流。遵循我的故事<a class="ae nc" rel="noopener ugc nofollow" target="_blank" href="/8-practical-github-tips-to-help-streamline-development-bf394079d554?sk=6fb3d50ddb3f91c6623fff98b0324145">中的指导(技巧1–4)9个实用的GitHub技巧来帮助简化开发</a>。</li></ul><h1 id="ce1d" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">pom.xml中的更改</h1><p id="ae8c" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">您的项目<code class="fe ng nh ni nj b">pom.xml</code>将需要以下更改:</p><p id="cdec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将父版本从2.7.3更新到3.0.0-M4。在撰写本文时，这些是2.7.x和3.0.0-Mx的最新版本。根据您准备升级到Spring Boot 3的时间，这些版本可能会有所变化，因此请确保您确实升级到了最新版本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="b818" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于Spring Boot 3在maven central中还不可用，我们需要在我们的根pom中指定<code class="fe ng nh ni nj b">spring-milestones</code>存储库，这样maven就知道在构建期间将Spring Boot 3里程碑构件放在哪里。一旦Spring Boot 3正式上市并在maven central中可用，这一部分就可以删除。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="59ca" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">班级的变化</h1><h1 id="3941" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">用Jakarta EE 9 APIs替换Java EE 8</h1><p id="5db4" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">这可能是这次升级中最大的突破性变化。Spring Boot 3.0将是第一个使用Jakarta ee9 API(<code class="fe ng nh ni nj b">jakarta.*</code>)而不是EE 8 ( <code class="fe ng nh ni nj b">javax.*</code>)的Spring Boot版本。这意味着我们将不得不用<code class="fe ng nh ni nj b">javax.*</code>寻找EE 8进口，并用<code class="fe ng nh ni nj b">jakarta.*</code>替换它们。Spring Boot微服务中使用的典型EE 8包包括:</p><ul class=""><li id="14db" class="mm mn it la b lb lc le lf lh nm ll nn lp no lt mt mu mv mw bi translated"><code class="fe ng nh ni nj b">javax.persistence.*</code></li><li id="ec19" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated"><code class="fe ng nh ni nj b">javax.validation.*</code></li><li id="1ad1" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated"><code class="fe ng nh ni nj b">javax.servlet.*</code></li><li id="087a" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated"><code class="fe ng nh ni nj b">javax.annotation.*</code></li><li id="e158" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated"><code class="fe ng nh ni nj b">javax.transaction.*</code></li><li id="1896" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated">等等。</li></ul><p id="978f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要知道<code class="fe ng nh ni nj b">javax.sql.*</code>和<code class="fe ng nh ni nj b">javax.crypto.*</code>之类的包是来自Java 17 JDK，而不是来自EE 8，所以留着是安全的。</p><p id="5398" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有一个IntelliJ快捷方式可以在项目级别查找和替换包导入。你可以这样做:</p><ul class=""><li id="7282" class="mm mn it la b lb lc le lf lh nm ll nn lp no lt mt mu mv mw bi translated">在IntelliJ项目窗口中选择项目的根目录</li><li id="6eea" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated">点击<code class="fe ng nh ni nj b">ctrl + shift + R</code>或通过IntelliJ菜单:编辑→查找→在文件中替换。会弹出一个类似下面截图的窗口</li><li id="9a33" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated">将<code class="fe ng nh ni nj b">javax.persistence</code>替换为<code class="fe ng nh ni nj b">jakarta.persistence</code></li><li id="6646" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated">单击“全部替换”以替换所有出现的内容</li><li id="47b8" class="mm mn it la b lb mx le my lh mz ll na lp nb lt mt mu mv mw bi translated">对其他EE 8 <code class="fe ng nh ni nj b">javax</code>组件重复相同的步骤</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/42b4cedeccae7aac0df812ba88e4fae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_K8akSCBUmikkcKbBnQxng.png"/></div></div></figure><h1 id="47f7" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">移除或修复不推荐使用的代码</h1><p id="ae64" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">Spring Boot 3.0将删除所有不推荐使用的代码，因此建议您检查现有代码是否依赖于任何不推荐使用的方法。如果报告了弃用警告，值得考虑使用<code class="fe ng nh ni nj b">-Werror</code> Java编译器选项来使您的构建失败。</p><h1 id="0c3c" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">检查第三方依赖的Jakarta EE 9兼容版本</h1><p id="6776" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">如果您的微服务构建由于仍然使用EE 8版本的第三方依赖而失败，您需要检查该依赖是否有任何Jakarta EE 9兼容版本可用。如果是这样，请先升级第三方依赖关系，然后再继续。</p><p id="9e4f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于本页未列出的您遇到的任何其他问题，请参考Spring Boot团队的<a class="ae nc" href="https://spring.io/blog/2022/05/24/preparing-for-spring-boot-3-0" rel="noopener ugc nofollow" target="_blank">指南文档</a>。</p><p id="7805" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尽早计划Spring Boot 3升级。当Spring Boot 3在今年11月发布到maven central时，如果你安装了reliabot，reliabot会自动将你的应用升级到Spring Boot 3。你不希望到时候被迫去修改，尤其是当你有其他截止日期要满足的时候。立即采取主动行动！</p><p id="da5a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">编码快乐！</p><p id="6949" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">附注:在《Spring Boot 3》于2022年11月24日正式上市后添加此段落。请参考<a class="ae nc" href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Release-Notes" rel="noopener ugc nofollow" target="_blank"> Spring Boot 3发行说明</a>了解Spring Boot 3中引入的更改/修复。查看编译错误，有些错误并不容易查明，例如其他Spring库升级引入的编译错误，请在<a class="ae nc" href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Release-Notes" rel="noopener ugc nofollow" target="_blank">发行说明</a>页面上跟踪其他Spring库的链接，以准确跟踪发生了什么变化，并相应地应用建议的修复。比如<a class="ae nc" href="https://spring.io/blog/2022/02/21/spring-security-without-the-websecurityconfigureradapter" rel="noopener ugc nofollow" target="_blank">这个链接</a>就和弃泉安防的<code class="fe ng nh ni nj b">WebSecurityConfigureAdapter</code>有关。根据你的应用，如果你当前在你的应用中引用了<code class="fe ng nh ni nj b">WebSecurityConfigureAdapter</code>，你将需要根据链接上的指令进行重构。</p><h1 id="533a" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">参考</h1><p id="93c9" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated"><a class="ae nc" href="https://spring.io/blog/2022/05/24/preparing-for-spring-boot-3-0" rel="noopener ugc nofollow" target="_blank">为Spring Boot 3.0做准备</a></p><p id="a08b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae nc" href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Release-Notes" rel="noopener ugc nofollow" target="_blank">https://github . com/Spring-projects/Spring-Boot/wiki/Spring-Boot-3.0-Release-Notes</a></p></div></div>    
</body>
</html>