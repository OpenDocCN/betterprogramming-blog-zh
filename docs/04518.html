<html>
<head>
<title>Getting Started With Brownie (Part 3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">布朗尼入门(第3部分)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-brownie-part-3-ef6bfa9867d7?source=collection_archive---------2-----------------------#2020-04-19">https://betterprogramming.pub/getting-started-with-brownie-part-3-ef6bfa9867d7?source=collection_archive---------2-----------------------#2020-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="36b7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">基本布朗尼功能</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1febb87dd105e5f01ff0ad0454d27238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yx7msuiRyIOM1rGFdkogPw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">andréFran ois McKenzie在<a class="ae kv" href="https://unsplash.com/s/photos/ethereum?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="ee23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经<a class="ae kv" href="https://medium.com/@iamdefinitelyahuman/getting-started-with-brownie-part-1-9b2181f4cb99" rel="noopener">安装了Brownie </a>并且<a class="ae kv" href="https://medium.com/@iamdefinitelyahuman/getting-started-with-brownie-part-2-615a1eec167f" rel="noopener">创建了一个项目</a>，是时候熟悉一些核心功能了。</p><p id="f6ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果还没有，请从打开控制台开始:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="08c5" class="lx ly iq lt b gy lz ma l mb mc">brownie console</span></pre><p id="10fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://github.com/iamdefinitelyahuman/brownie" rel="noopener ugc nofollow" target="_blank"> Brownie </a>将启动<a class="ae kv" href="https://github.com/trufflesuite/ganache-cli" rel="noopener ugc nofollow" target="_blank"> Ganache </a>并创建一些对象来帮助你与你的项目互动。准备就绪后，您会看到一个命令提示符:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi md"><img src="../Images/e07430ea745012dbbe8e3334581aaf7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZTkKgk6Lh2PPwaPFnbNQwQ.png"/></div></div></figure><p id="aa98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于Python的新手来说，是时候升一级了！让我们来看看两个非常有用的内置函数:</p><ul class=""><li id="a837" class="me mf iq ky b kz la lc ld lf mg lj mh ln mi lr mj mk ml mm bi translated"><code class="fe mn mo mp lt b"><strong class="ky ir">dir</strong></code>显示名称空间内的对象列表或对象成员列表。如果使用Python对你来说就像是去外国旅游，那么就把<code class="fe mn mo mp lt b">dir</code>当成你的路线图吧。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/dca5aaab90b9a26b339be5d12fbd0b79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RXCN-7XVnxdiiVi95sUkIw.png"/></div></div></figure><ul class=""><li id="e5ea" class="me mf iq ky b kz la lc ld lf mg lj mh ln mi lr mj mk ml mm bi translated"><code class="fe mn mo mp lt b"><strong class="ky ir">help</strong></code>接受任何对象作为参数，并显示该对象的文档。继续我们之前的类比，如果<code class="fe mn mo mp lt b">dir</code>是你的路线图，那么<code class="fe mn mo mp lt b">help</code>就是你的指南。</li></ul><p id="515e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了这两个功能和足够的好奇心，您就可以很好地理解如何在不接触文档的情况下做任何事情。(但是请务必打开<a class="ae kv" href="https://eth-brownie.readthedocs.io/en/stable/index.html" rel="noopener ugc nofollow" target="_blank">布朗尼文档</a>。我花了很多心血。)</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="9c84" class="my ly iq bd mz na nb nc nd ne nf ng nh jw ni jx nj jz nk ka nl kc nm kd nn no bi translated">转移乙醚</h1><p id="2451" class="pw-post-body-paragraph kw kx iq ky b kz np jr lb lc nq ju le lf nr lh li lj ns ll lm ln nt lp lq lr ij bi translated">让我们从一个简单的交易开始。因为我们用的是Ganache，已经有几个解锁的账户可以用100以太来资助我们了。与这些帐户交互的对象可以在一个名为<code class="fe mn mo mp lt b">accounts</code>的容器中找到:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/e9219d1fff35834f0f4f0d5cd3787736.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T5r1pEgmHwkK_wS3N7ajcQ.png"/></div></div></figure><p id="3ad7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从简单地将一个乙醚从<code class="fe mn mo mp lt b">accounts[0]</code>转移到<code class="fe mn mo mp lt b">accounts[1]</code>开始。输入以下命令:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="a67d" class="lx ly iq lt b gy lz ma l mb mc">accounts[0].transfer(accounts[1], "1 ether")</span></pre><p id="e7ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以键入<code class="fe mn mo mp lt b">1e18</code>或者甚至<code class="fe mn mo mp lt b">1000000000000000000</code>来代替<code class="fe mn mo mp lt b">"1 ether"</code>，但是我发现这个字符串更容易阅读，Brownie会很乐意转换它。</p><p id="6687" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Ganache立即挖掘事务，并将结果输出到控制台:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/8bbdb973ea75050ce9ede42a890ac26b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*non2Xk5nymXQ0QOr4SJVDw.png"/></div></div></figure><p id="33d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看到最后一行了吗？<code class="fe mn mo mp lt b">&lt;Transaction ...&gt;</code>？这是一个代表你刚刚完成的交易的对象。因为它没有被赋给变量，所以被打印到控制台。但是不要担心，即使你没有分配它也不会全部丢失！事务也被添加到一个名为<code class="fe mn mo mp lt b">history</code>的容器中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/890fec1cf618b39409c277db47d3f9ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NDoNf-SzYQN0E52bOPsOUA.png"/></div></div></figure><p id="0658" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mn mo mp lt b">TransactionReceipt</code>对象包含许多用于检查事务的属性和方法。它是布朗尼最强大的组成部分之一，可能值得有自己的文章。我们很快会回来。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="8ead" class="my ly iq bd mz na nb nc nd ne nf ng nh jw ni jx nj jz nk ka nl kc nm kd nn no bi translated">使用合同</h1><p id="4c9c" class="pw-post-body-paragraph kw kx iq ky b kz np jr lb lc nq ju le lf nr lh li lj ns ll lm ln nt lp lq lr ij bi translated">token-mix模板包括一个可部署的契约，名为<code class="fe mn mo mp lt b">Token</code>。每个契约都有一个可用于部署的对象，如下所示:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="f8f1" class="lx ly iq lt b gy lz ma l mb mc">Token.deploy("TST", "Test Token", 18, 1e24, {'from': accounts[0]})</span></pre><p id="501b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在输入命令时，您会注意到Brownie提供了所需值的提示。多棒啊。</p><p id="669b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最终值被称为<strong class="ky ir">事务字典</strong>。您可以在这里指定信息，如发送者、气体价格和气体限制。Brownie尽可能使用合理的默认值——唯一的必填字段是<code class="fe mn mo mp lt b">from</code>。</p><p id="50a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">广播事务，看:一个新部署的契约诞生了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/819929ae97c02d7496fc05d798c71f1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zU_H_H_oNJva3h_LJBItiw.png"/></div></div></figure><p id="6b3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该调用返回一个<code class="fe mn mo mp lt b">Contract</code>对象，用于与部署进行交互。那是什么？你没有再分配一次？！没什么大不了的。用于部署的对象也是保存部署的容器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/92b6283ff4c51a2f8544003fead10320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*2C2GabYOhwMaeVdYp4KlMQ.png"/></div></figure><p id="7b0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将部署的<code class="fe mn mo mp lt b">Contract</code>对象赋给一个变量，然后让我们和好朋友<code class="fe mn mo mp lt b">dir</code>一起看看:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/6f906a3600d4e705a0a35c471bf3a48a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OY28Pppag3YFw2ab8eqWTA.png"/></div></div></figure><p id="ef5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所有标准的ERC20方法都可以作为对象中的可调用成员。首先检查总供应量和余额:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/0556357128c735ea3635b62ab90e0c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*hiIV6dpyZ32AXZRjQDXEuA.png"/></div></figure><p id="53a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如预期的那样，所有令牌最初都被分配给我们用来部署合同的地址。让我们试着发送一些令牌，这次一定要分配返回的<code class="fe mn mo mp lt b">TransactionReceipt</code>:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="7a04" class="lx ly iq lt b gy lz ma l mb mc">tx = contract.transfer(accounts[1], 1e18, {'from': accounts[0]})</span></pre></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="f4eb" class="my ly iq bd mz na nb nc nd ne nf ng nh jw ni jx nj jz nk ka nl kc nm kd nn no bi translated">使用事务</h1><p id="7042" class="pw-post-body-paragraph kw kx iq ky b kz np jr lb lc nq ju le lf nr lh li lj ns ll lm ln nt lp lq lr ij bi translated">现在是时候来看看这个交易了。我们将从快速调用<code class="fe mn mo mp lt b">dir(tx)</code>开始。您可以看到有多少信息可用:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/909a6db3c4668831afe1c54d35e39e86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V4dYnBGoDIBrv1kvskji7Q.png"/></div></div></figure><p id="398a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个很长的列表，大多数属性都是不言自明的。现在，调用<code class="fe mn mo mp lt b">tx.info()</code>来获得一个扩展的人类可读的事务描述。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/58276f4008f4dfe08895604dccdd516b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NZxdYzjbFXE80PjKIxxAWw.png"/></div></div></figure><p id="95c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当事情没有按计划进行时，这个物体真正发光。键入以下命令:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="c512" class="lx ly iq lt b gy lz ma l mb mc">tx = contract.transfer(accounts[3], 1e18, {'from': accounts[2]})</span></pre><p id="0b6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">哦不，我们的交易失败了！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/5caecf540f11a3cc711ee4ded80c3adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwmHryF3Oa14xwSM5A3ULg.png"/></div></div></figure><p id="1d1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能已经知道哪里出了问题，但我们还是会调查。从以下命令开始:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="e4d5" class="lx ly iq lt b gy lz ma l mb mc">tx.error()</span></pre><p id="aea9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Brownie在出现错误的地方输出一段源代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/4b634f6ffb946a6008d81d404ce9092b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pq7jmnHdgXm_8xKpeSx2dA.png"/></div></div></figure><p id="04a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好吧，我们没有通过<code class="fe mn mo mp lt b">SafeMath</code>下溢检查。很高兴知道，但我们可以使用一些上下文。接下来尝试此命令:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="bc62" class="lx ly iq lt b gy lz ma l mb mc">tx.traceback()</span></pre><p id="731d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这一次，我们看到了Python风格的回溯，突出显示了导致还原的每一帧:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/0aabb6e9b141e5f56d069b72a1e937ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zcTa5RLqKbx2bOc6PLe0sw.png"/></div></div></figure><p id="0ea8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瞧啊。下溢是因为<code class="fe mn mo mp lt b">msg.sender</code>余额不足。这个例子很简单，但是当你发现自己在构建下一个DeFi gem，并且在一次交易中在十几个合同之间跳跃时，这些回溯会让你感觉很禅。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="f263" class="my ly iq bd mz na nb nc nd ne nf ng nh jw ni jx nj jz nk ka nl kc nm kd nn no bi translated">接下来</h1><p id="4438" class="pw-post-body-paragraph kw kx iq ky b kz np jr lb lc nq ju le lf nr lh li lj ns ll lm ln nt lp lq lr ij bi translated">暂时就这样吧！不久我们将发布第四部分，在那里我们将讨论单元测试。</p></div></div>    
</body>
</html>