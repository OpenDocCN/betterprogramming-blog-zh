<html>
<head>
<title>The Handbook to GPG and Git</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GPG和Git手册</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-handbook-to-gpg-and-git-5990f8db4361?source=collection_archive---------6-----------------------#2020-12-22">https://betterprogramming.pub/a-handbook-to-gpg-and-git-5990f8db4361?source=collection_archive---------6-----------------------#2020-12-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cebc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在您的机器上设置更安全的开发流程的完整指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/046e69c07e4da8ae55b5c6ab5822361c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IJXLBjFyU69PEgKIMOgiyA.jpeg"/></div></div></figure><p id="a7c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Git充满了有用的命令、强大的功能和经常被忽略的特性。它隐藏的一个优点是它能够用一个密钥签署提交和标记。对于这项工作，Git求助于GPG，这是一个广泛采用的开源程序，专为这类任务而设计。</p><p id="5153" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">GPG背后的团队，或GNU隐私卫士，将其描述为一个“允许你加密和签名你的数据和通信”的程序该工具对于保护和加密验证通过消息应用程序、电子邮件和版本控制系统(如Git)发送的数据非常有用。幸运的是，Git开发团队已经为我们完成了繁重的工作，对GPG签名的本机支持已经融入到应用程序中。</p><h1 id="33f7" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">GPG签约的好处</h1><p id="6540" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">在深入“如何做”之前，我想先回答“为什么”。企业家、大企业以及所有介于两者之间的人可能看不到将GPG群岛纳入他们的开发流程的理由。但是，如果它不值得使用，为什么Git要费心包含对它的原生支持呢？我想提出一些支持将这种实践添加到日常开发中的论点。</p><h2 id="fdab" class="mn lr it bd ls mo mp dn lw mq mr dp ma ld ms mt mc lh mu mv me ll mw mx mg my bi translated">安全性</h2><p id="75f1" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">难道用户名和密码还不足以保证用户工作的安全吗？还是SSH键？简单的回答是否定的和否定的。不管是好是坏，这两种机制都允许或拒绝对Git存储库的访问。一旦授予访问权限，工程师必须通过额外的步骤来提供他们的身份，然后才能进行任何提交:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">熟悉的Git配置参数</p></figure><p id="4cfa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦我被授权使用我的密码或SSH密钥进行访问，游戏就结束了。想象一个场景，一个叫爱丽丝的工程师同事和我正在做一个项目。如果我发现我的变更影响了生产，让公司损失了几千美元，我可以拆掉<code class="fe nf ng nh ni b">develop</code>分公司，声明她的身份，重写历史，说是爱丽丝而不是我犯的错。简单的运行一下<code class="fe nf ng nh ni b">git log</code>就能告诉我所有我需要知道的关于她的身份。当然，如果我做了这样的事情，分支的<code class="fe nf ng nh ni b">HEAD</code>会在多个Git实例中发散，但这仍然证明了一点。不是所有的黑客都需要才华来制造麻烦。如果Alice签署了她的提交，在Git提供者没有将我的尝试标记为未经验证和不可信的情况下，我就无法模拟她的身份。</p><h2 id="026f" class="mn lr it bd ls mo mp dn lw mq mr dp ma ld ms mt mc lh mu mv me ll mw mx mg my bi translated">信心</h2><p id="9ea2" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">加密和数字签名都是为了激发信心。Git世界中的所有主要参与者都会奖励那些付出额外努力来证明自己是GPG的人。GitLab、GitHub和Bitbucket都会在每个作者与GPG签署的提交旁边显示一个徽章。GitHub进一步指出，当一个经过验证的作者签署他们的标签和发布。说说友好的拍拍背吧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/97e684be3e14e517d27c8f0244c521bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EFHqPJaLWSQb6_OJnDDUow.png"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">GitLab验证的提交、GitHub验证的提交和标记</p></figure><h2 id="c937" class="mn lr it bd ls mo mp dn lw mq mr dp ma ld ms mt mc lh mu mv me ll mw mx mg my bi translated">简单</h2><p id="8bbc" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">对于工程师来说，密码学往往是痛苦的代名词。你的钥匙过期了吗？是时候生成一个新的并把它放在所有正确的地方了。你忘记用这里的钥匙了吗？你刚刚打开了一个大洞。等等等等。在我看来，Git让它变得如此容易使用，我没有理由不使用它。我告诉Git使用什么样的GPG密钥，让它为我的每个提交签名，然后像往常一样继续使用Git。一切照旧再容易不过了。</p><h1 id="4311" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">创建密钥对</h1><p id="4bc6" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">GPG在配置密钥的创建方面提供了很大的灵活性。就个人而言，这些是我喜欢使用的选项:</p><ul class=""><li id="7958" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated"><strong class="kw iu">密钥类型:</strong> RSA和RSA，用于加密和解密的非对称密钥对。</li><li id="c3e2" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><strong class="kw iu">位长:</strong> 4096为最大熵值。</li><li id="5385" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><strong class="kw iu">失效日期:</strong>无。完全取决于您和您的用例，但我在这里只是为了在Git上证明我的身份，而不是为了保护国家支持的机密而轮换我的密钥。</li></ul><p id="6346" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个过程非常简单:</p><ol class=""><li id="832f" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp ny nq nr ns bi translated">打开一个终端。</li><li id="83d2" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp ny nq nr ns bi translated">键入<code class="fe nf ng nh ni b">gpg --full-generate-key </code>进入创建流程。</li><li id="1263" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp ny nq nr ns bi translated">选择所需的密钥类型。我呢，RSA和RSA选的是<code class="fe nf ng nh ni b">1</code>。</li><li id="fcbe" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp ny nq nr ns bi translated">输入位长。我用了<code class="fe nf ng nh ni b">4096</code>。</li><li id="db80" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp ny nq nr ns bi translated">指定有效期，用<code class="fe nf ng nh ni b">0</code>表示没有过期。那是我的选择。它会要求您确认您的选择。</li></ol><p id="07bc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于接下来的几个提示，我用我提供给Git的标识值排列我的答案。</p><ol class=""><li id="e46c" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp ny nq nr ns bi translated">对于真实姓名提示，请输入您的显示名称。当然，我的是<code class="fe nf ng nh ni b">Oliver Spryn</code>。</li><li id="4b5c" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp ny nq nr ns bi translated">电子邮件地址应该与您的提交电子邮件相匹配。在我的例子中，我使用了<code class="fe nf ng nh ni b">oliverspryn@example.com</code>，但是在现实世界中，我更喜欢使用GitLab和GitHub提供给我的屏蔽邮件。这个特性是许多主要Git提供商提供的一个很好的隐私附加层。</li><li id="0d5f" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp ny nq nr ns bi translated">对于注释，我留下了一个人类可读的描述来指出我计划在哪里使用这个键。在我的例子中，我使用了<code class="fe nf ng nh ni b">GitLab GPG Key</code>。</li></ol><p id="d327" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里有一个流动视频:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/b8588dbc6074af62fe9a40ae61a1d9ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9witgebSLBtGBMSFlqfTrg.gif"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">GPG密钥创建流程</p></figure><h1 id="4460" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">导出密钥对</h1><p id="a0c7" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">除非您的Git提供者能够验证提交，否则对提交进行签名没有多大用处。因此，我们需要导出公钥来与GitLab和GitHub共享。我还会导出私钥，以确保它在我的密码库中的安全，以防我得到一台新计算机或意外丢失我的本地副本。</p><p id="a079" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我们需要告诉GPG我们打算出口哪个密钥。首先列出当前系统上的所有键:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">使用长ID列出GPG钥匙串中的所有钥匙</p></figure><p id="959d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这应该会产生如下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/f310741147286b6b7b7349a09997c634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gwW3CSEFlITSvj2aNJhxEQ.jpeg"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">存储在GPG的RSA密钥对</p></figure><p id="bf88" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当然，如果你的电脑上有更多的键，你会看到它们都显示出来。我对一条特别的信息感兴趣，长键ID。它出现了两次，一次是简写版本，另一次是完整的ID。区别在于:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/f2394c75b0638353201e897f28569075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k5d11cE6-AYK4eV9pOLHLA.jpeg"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">短键只使用长键标识符的子集</p></figure><p id="3d55" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意我是如何引用单词<code class="fe nf ng nh ni b">sec</code>旁边的id的。图片底部是短语<code class="fe nf ng nh ni b">ssb</code>旁边的另一个ID。顶部的ID指的是秘密密钥(即“sec”)，底部的ID指的是秘密子密钥(即“ssb”)。出于这个目的，忽略<code class="fe nf ng nh ni b">ssb</code> ID。</p><p id="8841" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在下一步中，您可以通过它的短ID来引用想要的键，但是为了精确起见，我更喜欢显式地使用它的长ID。有了长密钥ID，就可以用它来导出公钥和私钥:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">从GPG导出RSA公钥和私钥</p></figure><p id="8ef4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">确保这两个文件的安全。非常安全。我喜欢把它们放在我的<a class="ae ob" href="https://go.oliverspryn.com/lastpass" rel="noopener ugc nofollow" target="_blank"> LastPass </a>或者我的<a class="ae ob" href="https://go.oliverspryn.com/protondrive" rel="noopener ugc nofollow" target="_blank"> ProtonDrive Vault </a>里。任何锁定和加密的文件存储应该做得很好。</p><h1 id="78dc" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">使用钥匙</h1><p id="c01f" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">就像告诉Git您的姓名和电子邮件一样，您也可以提供GPG密钥配置。同样，为了更精确，这里最好使用长键ID。我将在下面的命令中使用这个ID，并使用另一个配置选项告诉Git每次提交时都使用这个键，即使我在开发周期的提交过程中忽略了这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">配置Git使用本地GPG密钥并自动签署每个提交</p></figure><p id="b93e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，Git用GPG对你的所有提交进行签名，而不需要对你的工作流做任何修改。就像你一直做的那样。您可以像这样验证所有已签名的提交:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">正常的Git日志不报告提交签名</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/37a35de74f4331d7244afd075356f000.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IGh1P8QpI_igN5BC-26OsQ.png"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">Git显示用可信密钥签名的提交</p></figure><p id="90ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当然，只有当您是团队中唯一的人或者在分布式团队中工作并且每个人都拥有整个团队的公钥时，Git才会告诉您提交是否被正确签名。否则，您将看到Git报告由您的队友签名的提交的信任问题。在这种情况下，当我想确保有人正确地签署了commit时，我不会费心参考GitLab和GitHub。这种方式稍微容易一些，因为Git提供者负责保存所有的公钥，每个成员都必须使用网站来保持她或她的公钥是最新的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/2b5bb23bff9c849432fd72adfefc6bfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IYapLZKI4_gyVyCUG-XIsg.png"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">GitLab和GitHub，分别报告已验证的提交</p></figure><p id="ddc7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您不告诉Git自动签署您的提交，您将需要在每次提交时都这样做:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">手动签署Git提交</p></figure><p id="27e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我发现标记签名仍然是一个手动过程，尽管:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">手动签署Git标签</p></figure><p id="6902" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意上面两行的区别。签署提交使用大写<code class="fe nf ng nh ni b">-S</code>作为标志，标记操作使用小写<code class="fe nf ng nh ni b">-s</code>。这不是我遇到的第一个Git怪癖！</p><p id="ff3a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">总的来说，在日常工作流程中使用GPG的头痛问题已经基本消失了。事实上，这种简单程度使得任何反对使用它的论点都很难让人相信。</p><h1 id="a439" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">将密钥导出到GitLab和GitHub</h1><p id="4c54" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">私下里，我让GPG为我生成一个RSA密钥对。与任何非对称密钥一样，如果您打算与第三方共享任何信息，您需要与他们共享公钥。当然，既然我们在谈论推送到Git仓库，我们肯定会共享信息。谢天谢地，GitLab和GitHub让这个过程变得简单了。</p><p id="51fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在将公钥导入任何Git提供程序之前，请确保在您喜欢的文本编辑器中打开了之前导出的公钥。请确保您打开的是公钥，而不是私钥。</p><h2 id="fcea" class="mn lr it bd ls mo mp dn lw mq mr dp ma ld ms mt mc lh mu mv me ll mw mx mg my bi translated">GitLab</h2><p id="3364" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">这个过程是相同的，无论你使用GitLab.com或GitLab自托管。登录您的帐户，在右上角选择您的个人资料，然后进入设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/dab58650ff53c8206b8c7fb1a4624de8.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*LmTiQl3XlFuWgc1KgJSRYA.jpeg"/></div></figure><p id="9230" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从左侧的面板中，选择“GPG关键点”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/3ce2a36cb9b2409356465c2720722674.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*X59FXeGn8ZQ7g61Htxj4Kg.jpeg"/></div></figure><p id="0c3c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将公钥粘贴到文本框中，然后按添加密钥按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/9d4be30254577feacff3ea9cc296463e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UQPt1qBiTcaQO8DGKTxHWw.jpeg"/></div></div></figure><p id="8d66" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">观察GPG键列表中的键。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/9131716e20d0e42fcc2a91016300d430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4DKA2kGBoLkoySJt9MmOkQ.jpeg"/></div></div></figure><h2 id="75fb" class="mn lr it bd ls mo mp dn lw mq mr dp ma ld ms mt mc lh mu mv me ll mw mx mg my bi translated">开源代码库</h2><p id="552d" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">你会发现在GitHub上安装一个密钥和GitLab的过程很相似。登录您的帐户，在右上角选择您的个人资料，然后进入设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/b86d257504cb3ab249bc0a134bf981a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*WhrOQIcx6X2KKT-rifXSkw.jpeg"/></div></figure><p id="e68a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从左边的面板中，选择SSH和GPG密钥。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/6a2eb4531f4b1b8d0945db7a7d9c4bd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*l5b54F9i2Sbe7C2U-hxMQw.jpeg"/></div></figure><p id="7632" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">按下新GPG键按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/c14e00db78533ccadf76aa0d0005f719.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vGLI6vlKNKXXXiucQ5G-EA.jpeg"/></div></div></figure><p id="3d35" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将公钥粘贴到文本框中，然后按添加密钥按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/e4583bd3a307e48c0b0bcf6a4761f7c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dSIury1qJ2932FWxDz99lQ.jpeg"/></div></div></figure><p id="2a8f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">观察GPG键列表中的键。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/80efc08f1f926a2f50d44cb6b949f882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rVS5CduiGD4MjdQW6ml3LQ.jpeg"/></div></div></figure><h1 id="a5fe" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">密钥存储</h1><p id="f9ed" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">灾难是我们不希望发生的事情，但我们应该随时做好准备。把你的钥匙放在一个安全的地方有助于避免这类事件中最痛苦的部分。如前所述，我喜欢使用两个地方中的一个来保存这类信息:<a class="ae ob" href="https://go.oliverspryn.com/lastpass" rel="noopener ugc nofollow" target="_blank"> LastPass </a>或<a class="ae ob" href="https://go.oliverspryn.com/protondrive" rel="noopener ugc nofollow" target="_blank"> ProtonDrive </a>。不，这些公司没有赞助我推荐他们，但他们工作得足够好，值得一个主动推荐！</p><h2 id="5ff5" class="mn lr it bd ls mo mp dn lw mq mr dp ma ld ms mt mc lh mu mv me ll mw mx mg my bi translated">最后一遍</h2><p id="a900" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">甚至在他们的免费账户上，LastPass也允许你将二进制文件放入加密存储中。因为我管理几个GPG键，所以我<a class="ae ob" href="https://go.oliverspryn.com/lastpass-custom-item-types" rel="noopener ugc nofollow" target="_blank">为我想知道的关于我的键的所有信息创建了一个定制条目类型</a>。它看起来是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/7352386aa98929fd373bdbf9ffdd66e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i8epO_MAjGW1HsKokSYmWQ.jpeg"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">LastPass中的GPG密钥管理</p></figure><h2 id="46b3" class="mn lr it bd ls mo mp dn lw mq mr dp ma ld ms mt mc lh mu mv me ll mw mx mg my bi translated">质子驱动</h2><p id="a4b6" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">我也喜欢<a class="ae ob" href="https://go.oliverspryn.com/protondrive" rel="noopener ugc nofollow" target="_blank"> ProtonDrive </a>，因为它是完全加密的零访问文件存储服务。如果你愿意，一个更常见的选择是类似于<a class="ae ob" href="https://go.oliverspryn.com/onedrive-personal-vault" rel="noopener ugc nofollow" target="_blank"> OneDrive Personal Vault </a>的东西。这两个地方的想法是一样的。我把每把钥匙和一张包含密码的纸条放在加密的保险箱里，这样就可以随时使用，如果我需要的话。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/4cf6b096c451c5acbf842664255b53cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QenvPuvk-fBBDeVvFq0J8w.jpeg"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">我在ProtonDrive中出口的GPG钥匙</p></figure><h1 id="6475" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">导入密钥</h1><p id="eda8" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">您的开发机器上的数据丢失了吗？你买了一台新电脑吗？你需要在第二台电脑上工作吗？所有这些都是打开保险库并输入密钥的正当理由。一旦您将<code class="fe nf ng nh ni b">.asc</code>文件下载到您的新设置中，键入这些命令会将公钥和私钥添加到您的钥匙串中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">将公钥和私钥都导入GPG</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/9593778d94b9ff3e0ec62dec91687cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8P5rayfrr03fr_6YdJ4Mgw.jpeg"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">运行两个导入命令后的终端输出</p></figure><p id="c4cb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意我是如何在导入私钥之前导入公钥的。让我们仔细检查一下，看看这是否如预期的那样起作用:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">使用长ID列出GPG钥匙串中的所有钥匙</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/04651d75755fd5d29ac38736a933300b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GqKD_BdlMDABo1CHDnbbBQ.jpeg"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">新导入的密钥不可信</p></figure><p id="8aab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不幸的是，虽然密钥存在于钥匙串中，但是它没有得到系统的信任，因为这台机器首先不负责创建密钥。让我们来解决这个问题:</p><ol class=""><li id="0177" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp ny nq nr ns bi translated">在您的终端中，键入:<code class="fe nf ng nh ni b">gpg --edit-key key-id</code>，其中<code class="fe nf ng nh ni b">key-id</code>是您想要编辑的键的ID。</li><li id="7577" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp ny nq nr ns bi translated">您已经进入了GPG命令行编辑器。</li><li id="8c3d" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp ny nq nr ns bi translated">键入单词<code class="fe nf ng nh ni b">trust</code>。</li><li id="5d31" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp ny nq nr ns bi translated">因为这是您的密钥，所以您应该能够在您的系统中给予它最终的信任。因此，在信任级别提示符下，输入<code class="fe nf ng nh ni b">5</code>表示最终信任，并确认您的选择。这个级别与您最初创建密钥并在同一台机器上使用它时分配给密钥的信任值相同。</li><li id="8cd4" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp ny nq nr ns bi translated">键入<code class="fe nf ng nh ni b">quit</code>退出GPG提示符。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/29a573d0b9979b38d1b851230aa5c4de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BcdTTZ4QDQoZWkTbOKJJow.gif"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">在机器上授予密钥最终信任的流程</p></figure><p id="cd52" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">再次检查我们的工作表明我们在寻找什么。密钥对是可用的，并且对系统具有最终信任。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/b3bfb832e57235a9fec61205435e9110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8pP8exSHBIXoQQchmN4ogw.jpeg"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">钥匙现在有了最终的信任</p></figure><h1 id="7055" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">解决纷争</h1><p id="129e" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">作为我日常工作的一部分，我使用Macbook。在这个设置中，Git和GPG配合得很好。然而，我更喜欢在我的个人项目上使用Ubuntu，我注意到当我试图开箱即用在那个平台上使用GPG时，它不工作。如果您在Ubuntu或任何其他Linux发行版上签名提交时遇到问题，您可能需要安装GPG2。以下是我在Ubuntu上尝试签署提交时遇到的问题:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/28e8b1e541f7cf59f4c4d402e11ec9fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*5DPjapfXMqLzpBblPbzXcQ.png"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">GPG无法签署我的承诺</p></figure><p id="10d0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是我在Ubuntu和其他基于Debian的系统上纠正这个问题的方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">在基于Debian的Linux发行版上安装GPG2，比如Ubuntu</p></figure><p id="79b7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，我指示Git使用<code class="fe nf ng nh ni b">gpg2</code>而不是<code class="fe nf ng nh ni b">gpg</code>作为签名程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">指示Git使用GPG2作为签名程序</p></figure><p id="0d84" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在那里，我使用<code class="fe nf ng nh ni b">gpg2</code>来尝试签署一个简单的字符串，然后我遇到了另一个错误消息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">请求GPG2在“测试”一词上签名</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/a0e03cb31ec21390150687a931cfc662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GI8d5o6HGqCzAbHzkfJ2FA.png"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">对简单字符串进行签名也会失败</p></figure><p id="d1b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从那里，我打开我的<code class="fe nf ng nh ni b">~/.bashrc</code>、<code class="fe nf ng nh ni b">~/.bash_profile</code>或<code class="fe nf ng nh ni b">~/.zshrc</code>(取决于您的shell)，并将以下行添加到脚本中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">终端启动时应该运行的一行加法</p></figure><p id="3b16" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对文件进行必要的修改后，重启你的终端，或者<code class="fe nf ng nh ni b">source</code>使用正确的脚本，你的修改就会生效。重新运行上述签名命令会产生一个成功的结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">与上面相同的GPG2命令，也签署了单词“test”</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/5d22180c04e6823eeeb79865d0c00410.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VQ7HsudXqzuVCsPD6iFf_A.png"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">签名字符串现在可以正常工作了</p></figure><p id="8922" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个命令的结果显示GPG2已经准备好开始使用Git了。在GPG使用Git和与GPG交互的其他事情都是一样的。但是，不使用<code class="fe nf ng nh ni b">gpg</code>作为终端命令，而是使用<code class="fe nf ng nh ni b">gpg2</code>。</p><h1 id="3982" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">信用</h1><p id="be02" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">尽管我已经使用GPG和Git好几年了，我还是在研究撰写本文的信息时学到了不少东西。以下是我用来帮助我更好地理解这一过程的一些资源:</p><ul class=""><li id="045d" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated"><a class="ae ob" href="https://go.oliverspryn.com/gnupg" rel="noopener ugc nofollow" target="_blank"> GnuPG项目</a></li><li id="5092" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><a class="ae ob" href="https://go.oliverspryn.com/gpg-sec-and-ssb" rel="noopener ugc nofollow" target="_blank"> SEC和SSB </a></li><li id="6257" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><a class="ae ob" href="https://go.oliverspryn.com/signing-git-commits" rel="noopener ugc nofollow" target="_blank">签名Git提交</a></li><li id="9044" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><a class="ae ob" href="https://go.oliverspryn.com/spoofing-git-commits" rel="noopener ugc nofollow" target="_blank">欺骗Git提交</a></li><li id="201f" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><a class="ae ob" href="https://go.oliverspryn.com/git-and-gpg2" rel="noopener ugc nofollow" target="_blank"> Git和GPG2 </a></li><li id="b7d5" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><a class="ae ob" href="https://go.oliverspryn.com/gpg-failed-to-sign-data" rel="noopener ugc nofollow" target="_blank"> GPG未能签署数据</a></li></ul><h1 id="165a" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">喜欢你读的东西吗？</h1><p id="1607" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">媒体上还有成千上万篇类似的文章。我是这个网站的付费会员，我完全认为这项投资是值得的。<a class="ae ob" href="https://go.oliverspryn.com/medium-membership" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">点击这里加入</strong> </a>，你将以你的一部分会员身份支持我的工作。</p><p id="ba6d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本文最初发表于<a class="ae ob" href="https://go.oliverspryn.com/the-handbook-to-gpg-and-git" rel="noopener ugc nofollow" target="_blank">https://oliverspryn.com/</a>。<a class="ae ob" href="https://go.oliverspryn.com/medium-subscribe" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">加入我的邮件列表。</strong> </a></p></div></div>    
</body>
</html>