<html>
<head>
<title>Data Persistence — UserDefaults</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据持久性—用户默认值</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/data-persistence-userdefaults-b8503f93ff14?source=collection_archive---------3-----------------------#2019-07-19">https://betterprogramming.pub/data-persistence-userdefaults-b8503f93ff14?source=collection_archive---------3-----------------------#2019-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3a43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">UserDefaults是将数据从一个应用程序会话保存到另一个应用程序会话的最简单方法</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/21649201215e0d31ca0fd8ea2db99c90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*tjrXBVr3FdJLcgN57Wl7oA.gif"/></div><p class="kt ku gj gh gi kv kw bd b be z dk translated">使用用户默认值保存和加载变量</p></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="1cdc" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">介绍</h1><p id="a479" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">当我刚开始制作iOS应用时，我遇到了困难。我无法将数据从应用程序会话保存到应用程序会话。</p><p id="67e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的第一个应用程序是一个闲置的点击器——当你使用它时，它会有一些升级和任务。一切都很顺利，应用程序运行正常，没有太多问题。除了一个:每次我重启应用程序，我的变量从来没有保存。我非常困惑。我正常地设置变量——设置变量等于一个值。我不知道我做错了什么。</p><p id="47e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">显然，<em class="mh">在你的应用程序终止后，它会丢失给变量</em>的值。</p><p id="9518" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我需要我的应用程序有某种持久性。我走的第一条大道是<code class="fe mi mj mk ml b">UserDefaults</code>。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="e01e" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">什么是用户默认值？它有什么用处？</h1><p id="f4c3" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">UserDefaults是iOS中的一个持久层，主要用于保存少量数据——例如，当用户返回到你的应用程序时保存的用户设置。因为它用于较小量的数据，所以它对于那些正在寻找一种简单的方法在应用程序中一次保存几个变量的初学者来说是很好的。</p><p id="9d0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我开始写作是为了能够对编程中更高级的主题给出最基本的解释，所以我不会在这里深入细节。如果你想了解更多关于用户默认值的信息，请访问<a class="ae mm" href="https://developer.apple.com/documentation/foundation/userdefaults" rel="noopener ugc nofollow" target="_blank">苹果开发者文档</a>网页。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="c608" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">要求</h1><ul class=""><li id="df2a" class="mn mo iq jp b jq mc ju md jy mp kc mq kg mr kk ms mt mu mv bi translated">Xcode 10</li><li id="5376" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">Swift 4(及更高版本)</li></ul><p id="5e74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我假设您已经安装并设置了<a class="ae mm" href="https://developer.apple.com/xcode/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> Xcode </a>,并且准备好开始了——这是一个比仅仅展示如何在Xcode中打印变量稍微高级一点的教程。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="368b" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">入门指南</h1><p id="fac8" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">首先要打开Xcode并选择<code class="fe mi mj mk ml b">Single View App</code>选项。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/472c15f23f49a988a07b6dc1c8afd43a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8b71Hc6ApXPSerAGP25EIw.png"/></div></div><p class="kt ku gj gh gi kv kw bd b be z dk translated">选择单视图应用程序</p></figure><p id="32e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们将直奔<code class="fe mi mj mk ml b">ViewController.swift</code>。在<code class="fe mi mj mk ml b">class ViewController: UIViewController {</code>的正下方，我们首先创建一个名为<code class="fe mi mj mk ml b">defaults</code>的变量，这将是代码中调用的主要变量。您可以看到下面的实现:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/0130cd463502d31f9b1c23cdf4ec1b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GVM_3c9gC3jwXcbQDfMvEg.png"/></div></div><p class="kt ku gj gh gi kv kw bd b be z dk translated">让默认值= UserDefaults.standard</p></figure><p id="113f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经完成了第一部分，为了让这个应用更加真实，我将在<code class="fe mi mj mk ml b">Main.Storyboard</code>中添加一些UI。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="3494" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">界面</h1><p id="a056" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">我现在要做的是创建一个界面，让应用程序变得更加有用和实用，这样读者就可以从中获得更多。我将只向故事板添加四个UI元素:一个标签、一个文本字段和两个按钮。你可以把它们放在任何你喜欢的地方——你可以在下面看到我的配置。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/9d23222b0225dbbf615f46bab7649616.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AYQWg2_2hwZ6Vfd6_BjYlQ.png"/></div></div><p class="kt ku gj gh gi kv kw bd b be z dk translated">接口被添加到Main。故事板</p></figure><p id="c974" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们需要将接口与代码连接起来。为此，按住<code class="fe mi mj mk ml b">Command-Alt-Enter</code>进入助理编辑器，按住control键单击标签，将其拖至<code class="fe mi mj mk ml b">ViewController.swift </code>并释放。您已经创建了一个<code class="fe mi mj mk ml b">IBOutlet </code>——您可以随意命名，对文本字段也是如此。</p><p id="7431" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后按住control键并拖动到<code class="fe mi mj mk ml b">ViewController.swift</code>，当光标在<code class="fe mi mj mk ml b">ViewDidLoad</code>方法下时释放。我的结局是这样的:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/3e8db8110c11e392f12da78e2f76990c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w_qeFXtOiU9N9z2N13eGZA.png"/></div></div><p class="kt ku gj gh gi kv kw bd b be z dk translated">从用户界面到代码的连接</p></figure><p id="92ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你在制作IBActions或IBOutlets时需要更多帮助，请查看YouTube视频以获取更多信息。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="195b" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">代码</h1><p id="e8a3" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">我知道从技术上讲，我们已经在项目中添加了代码，但这只是热身。现在，我们将添加剩余的代码来实际保存和加载您的数据:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ng nh l"/></div></figure><ul class=""><li id="7bc7" class="mn mo iq jp b jq jr ju jv jy ni kc nj kg nk kk ms mt mu mv bi translated">第八行。这是我们首先添加的，我们只是将<code class="fe mi mj mk ml b">UserDefaults.standard</code>保存到变量<code class="fe mi mj mk ml b">defaults</code>中。</li><li id="02c6" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">第16行。这是我们刚刚得到的文本<code class="fe mi mj mk ml b">textField</code>并将其设置为变量<code class="fe mi mj mk ml b">text</code>。</li><li id="4aed" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">第18行。这就是你保存变量到<code class="fe mi mj mk ml b">UserDefaults</code>的方法。您调用<code class="fe mi mj mk ml b">defaults</code>并将一个变量设置为一个键，在本例中我称之为text。我总是发现最简单的方法是将键命名为你设置的变量，因为这样更容易跟踪你的键。</li><li id="b34b" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">第24行。在这个操作中，您获得了关键文本的值，并将其设置为名为text的变量，这样更容易理解。我想指出的是，如果你将一个int保存到<code class="fe mi mj mk ml b">UserDefaults</code>，你可以通过defaults.int(forKey: " <code class="fe mi mj mk ml b">exampleIntKeyName</code>)来检索它。</li><li id="362f" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">第26行。这里，我们通过从UserDefaults检索值并将其设置为<code class="fe mi mj mk ml b">textLabel.text</code>来获取上面创建的变量<code class="fe mi mj mk ml b">text</code>。</li></ul><p id="ab00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">实际上代码部分也是如此！开始玩<code class="fe mi mj mk ml b">UserDefaults</code>很容易。现在我们准备在模拟器或设备上测试它！在这个例子中，我将使用一个模拟器。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="4c34" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">运行应用程序</h1><p id="ed32" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">你现在要做的就是运行将应用程序部署到iPhone模拟器的方案(如果是第一次将应用程序运行到模拟器，可能需要几分钟)。</p><p id="7605" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">剩下的就是在文本字段中键入一条消息，然后单击save。然后通过按Command-Shift-H进入模拟器的主屏幕，并从屏幕底部向上滑动(或双击home键)进入多任务处理。现在只需滑动你的应用程序，基本上杀死应用程序。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/bc1a37380decedab9cebcc9bb887e07c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*CURR4iReewhCSyqv9VrFxg.png"/></div><p class="kt ku gj gh gi kv kw bd b be z dk translated">向文本字段添加消息，然后点击保存</p></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/9f827645b3116e75cc639f6c81681a7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*q3gItGnMWlBaiCHc9Bk2og.png"/></div><p class="kt ku gj gh gi kv kw bd b be z dk translated">进入多任务模式，然后向上滑动即可关闭应用程序</p></figure><p id="57d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再次打开应用程序，点击加载，你在文本字段中输入的信息应该会出现在标签的位置。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/e8b54a9e994d16804e4d46ff59004d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*bF2cktbF5dQWllpD7_IGIg.png"/></div><p class="kt ku gj gh gi kv kw bd b be z dk translated">您键入的邮件将替换标签中的单词Label</p></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="906a" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="0075" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">这就是你所要做的，保存一些变量，以便在你再次启动你的应用程序时能够重用它们。</p><p id="d7f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我想发表的一系列故事中的第一个，这些故事涉及在你的应用程序被杀死后保存数据。</p><h1 id="c8d5" class="le lf iq bd lg lh nm lj lk ll nn ln lo lp no lr ls lt np lv lw lx nq lz ma mb bi translated">项目文件</h1><p id="efe0" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">这是本教程的GitHub项目的链接。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><div class="km kn ko kp gt nr"><a href="https://github.com/ewalk40/UserDefaultsDemo" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">ewalk40/UserDefaultsDemo</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">UserDefaults演示应用。在GitHub上创建一个帐户，为ewalk40/UserDefaultsDemo开发做贡献。</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">github.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of kr nr"/></div></div></a></div></div></div>    
</body>
</html>