<html>
<head>
<title>Adopting Sign In With Apple</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">采用苹果登录</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/adopting-sign-in-with-apple-f75988ece191?source=collection_archive---------5-----------------------#2019-06-17">https://betterprogramming.pub/adopting-sign-in-with-apple-f75988ece191?source=collection_archive---------5-----------------------#2019-06-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1ce7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建登录按钮，验证数据并处理用户授权更改</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/602e6b224767ec3ff5c61434fe757f95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O2AYMGwEXIza5N6bQXBMgA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由micha Kubalczyk在<a class="ae kv" href="https://unsplash.com/search/photos/apple?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2fa7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着苹果公司最近在WWDC宣布与苹果公司签约，作为一名开发者，你可以给你的用户一个全新的选择来创建一个帐户并登录你的应用程序。让我们深入了解一下如何在你的应用中加入苹果登录功能。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8780" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">启用通过Apple登录到您的应用捆绑包ID</h1><p id="6726" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">登录您的开发者帐户。在你的应用标识符设置-&gt;功能下，勾选登录Apple。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/1d1d47fad6b5d059ee976143b54820b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZAGdaww-wM_4YOCrnwIgKw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">检查登录Apple</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="9f1e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">启用从Xcode登录Apple</h1><p id="5913" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">打开<a class="ae kv" href="https://developer.apple.com/documentation/xcode_release_notes/xcode_11_beta_release_notes" rel="noopener ugc nofollow" target="_blank"> Xcode 11 </a> beta或更新版本。在项目设置中，选择【目标-】签约&amp;功能，添加苹果签约。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/34740688787156a1e52736323eb8e2ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XPnCuc-uPbCGDnoHEM1aBg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">添加从Xcode登录Apple</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="d6ec" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">实施概述</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/7212cf67e8c92acc0d8d92594f847cd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*T4vU8JZxfnsSri4R-8X4yA.jpeg"/></div></figure><ol class=""><li id="a68d" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr ne nf ng nh bi translated">创建一个“使用Apple登录”按钮。</li><li id="c024" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ne nf ng nh bi translated">要求用户授权。</li><li id="b382" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ne nf ng nh bi translated">根据您存储的数据验证用户数据(本地或来自服务器)。</li><li id="8b40" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ne nf ng nh bi translated">处理用户授权变更。</li></ol></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="063e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">1.使用苹果按钮创建登录</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="cf34" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">2.要求用户授权</h1><ul class=""><li id="8472" class="mz na iq ky b kz mr lc ms lf np lj nq ln nr lr ns nf ng nh bi translated">在<code class="fe nt nu nv nw b">handleAuthorization</code>中，它通过<code class="fe nt nu nv nw b">user name</code>和<code class="fe nt nu nv nw b">email</code>信息请求来请求用户授权。</li><li id="8c98" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ns nf ng nh bi translated">创建<code class="fe nt nu nv nw b">AsAuthorizationController</code>时，需要同时提供<code class="fe nt nu nv nw b">delegate</code>和<code class="fe nt nu nv nw b">presentationContextProvider</code>。</li><li id="138b" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ns nf ng nh bi translated"><code class="fe nt nu nv nw b">delegate</code>提供授权请求状态——失败(错误)或成功。</li><li id="a94a" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ns nf ng nh bi translated"><code class="fe nt nu nv nw b">presentationContextProvider</code>请求一个窗口来显示授权UI。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="748d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">3.根据您存储的数据验证用户数据(本地或来自服务器)。</h1><p id="e52a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在第2步，您将得到一个用户<code class="fe nt nu nv nw b">credential</code>。</p><pre class="kg kh ki kj gt nx nw ny nz aw oa bi"><span id="626b" class="ob ma iq nw b gy oc od l oe of">if let credential = authorization.credential as? ASAuthorizationAppleIDCredential</span></pre><p id="2897" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">来自<code class="fe nt nu nv nw b">credential</code>的一些信息值得一提:</p><ul class=""><li id="114c" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr ns nf ng nh bi translated">用户邮箱:<code class="fe nt nu nv nw b">credential.email</code></li><li id="3ed1" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ns nf ng nh bi translated">用户名:<code class="fe nt nu nv nw b">credential.fullName</code></li><li id="eebd" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ns nf ng nh bi translated">用户标识符:<code class="fe nt nu nv nw b">credential.user</code></li><li id="607f" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ns nf ng nh bi translated">授权状态:<code class="fe nt nu nv nw b">credential.state</code></li><li id="c406" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ns nf ng nh bi translated">刷新令牌:<code class="fe nt nu nv nw b">let code = credential.authorizationCode, let codeStr = String(data: code, encoding: .utf8)</code></li><li id="f0c8" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ns nf ng nh bi translated">访问令牌:<code class="fe nt nu nv nw b">let idToken = credential.identityToken, let tokeStr = String(data: idToken, encoding: .utf8)</code></li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="f734" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">4.处理用户授权变更</h1><p id="1793" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">用户可以随时更改他们对应用程序的授权。我们的工作是尽早了解变化，并处理变化。</p><p id="038c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了处理变更，我们需要存储从步骤3接收到的<code class="fe nt nu nv nw b">user identifier</code> <br/>信息。</p><p id="dac1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，在<code class="fe nt nu nv nw b">AppDelegate</code>，我们只需通过<code class="fe nt nu nv nw b">user identifier</code>到<code class="fe nt nu nv nw b">ASAuthorizationAppleIDProvider</code>进行验证，您可能会收到以下状态:</p><ul class=""><li id="a5a8" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr ns nf ng nh bi translated"><code class="fe nt nu nv nw b">authorized</code></li><li id="1a48" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ns nf ng nh bi translated"><code class="fe nt nu nv nw b">revoked</code></li><li id="99ab" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ns nf ng nh bi translated"><code class="fe nt nu nv nw b">notFound</code></li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="594d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，用户可以随时从iOS设置页面移除某个应用的授权，因此我们需要定期检查。</p></div></div>    
</body>
</html>