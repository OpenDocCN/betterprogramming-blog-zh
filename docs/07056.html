<html>
<head>
<title>3 Libraries to Remove Unused CSS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">3个库来移除未使用的CSS</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/3-libraries-to-remove-unused-css-f09ffc9777da?source=collection_archive---------7-----------------------#2020-12-02">https://betterprogramming.pub/3-libraries-to-remove-unused-css-f09ffc9777da?source=collection_archive---------7-----------------------#2020-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="adc4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以及为什么你会使用一个库来完成这个任务</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a8a281998b8ae94c720b87880f980e4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V9ZVWsuy8LxSWx_p"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">潘卡杰·帕特尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="9c94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://stateofcss.com/" rel="noopener ugc nofollow" target="_blank">2020年CSS调查状态</a>有一个部分专门针对实用程序库。在那一节中，问题是关于StyleLint、PurgeCSS和PurifyCSS的用法。其中两个库用于移除未使用的CSS。作为PurgeCSS的作者和PurifyCSS的贡献者，我想花一点时间来解释那些库可以解决什么问题，并比较三个最流行的库来做这项工作。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b559" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么需要一个库来移除不用的CSS？</h1><p id="1076" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">像每个库一样，它们的使用依赖于用例，在有些情况下使用它们是没有意义的。本文中库最常见的用例是用CSS框架移除未使用的CSS。</p><h2 id="5a2a" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">CSS框架</h2><p id="f65c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我过去使用Bootstrap的经历并不愉快，主要是因为我想为小型网站使用CSS框架。它们最终总是变得臃肿——尤其是对于单个静态页面。Bootstrap提供了在网站上选择你将用来下载他们的CSS框架的精简版本的可能性。开发者体验很差。</p><p id="0a66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相比之下，TailwindCSS可以选择使用PurgeCSS来自动移除未使用的CSS。当使用TailwindCSS时，你很少问自己是否应该考虑另一个框架来精简你的网站。您很少需要更改设置来停用规则。</p><h2 id="9775" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">传统网站</h2><p id="23a4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">另一个用例是失去控制的遗留站点。虽然您可以要求开发人员来清理随着时间的推移积累的CSS混乱，但是您可以首先使用这个工具来采取主动。这些库会立刻给你的网站增加价值，并帮助你识别那些没有使用的CSS。</p><h2 id="8ee7" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">关键页面</h2><p id="dfa7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">一些公司有不同的团队负责网站的多个部分。一个团队可以负责主应用程序页面，另一个团队负责注册和支付页面，另一个团队负责设置和管理页面。</p><p id="826e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这些情况下，团队之间并不总是能看到代码。他们可能会选择一个通用的CSS框架，而不从其中删除任何CSS来利用缓存。但是关键页面还是应该有例外。</p><p id="8b2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只看一次并需要高加载性能的页面，如注册和支付页面，可以使用这些库从框架中删除未使用的CSS，并在最后的注册步骤中预加载完整版本。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d5cb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">概述和比较</h1><h2 id="5131" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">采购</h2><div class="nl nm gp gr nn no"><a href="https://github.com/FullHuman/purgecss" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">全人类/purgecss</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">当你在建立一个网站的时候，你可能会使用一个CSS框架，比如Bootstrap，Materializecss…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc ks no"/></div></div></a></div><p id="33d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PurgeCSS是这样工作的。首先，我们看我们网站的内容。除了我们的风格，它将是一切。对于一个简单的项目，它可能是HTML和JavaScript文件。我们想从这个内容中得到一个可以在CSS中使用的选择器列表。查看下图，我们可以看到选择器的位置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/910f7504e94d9ae8734acac938f15b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GkHcntanryu5GIsotdzBcA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">初始HTML和CSS文件</p></figure><p id="7c37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们有了名单，主要过程就开始了。我们使用PostCSS解析CSS文件。然后，我们遍历抽象语法树(AST)。我们看一下每个规则，并分析组成它的选择器。如果我们注意到一个选择器不在列表中，这意味着它没有被使用，我们删除了这个规则。</p><p id="19f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的CSS文件中，PurgeCSS遍历规则，从<code class="fe oe of og oh b">p</code>开始。它在列表中看到了<code class="fe oe of og oh b">p</code>，因此决定不删除它。对于<code class="fe oe of og oh b">text-transparent</code>，它在列表中看不到，规则被删除:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/3b76fd4b83a7f4662c708b4c57706f2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kHpLC2rHeQNgrggcrGW7tg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">感知选择器(左)/CSS输出(右)</p></figure><p id="cd7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PurgeCSS提供了创建提取器的可能性。提取器是一个获取文件内容并提取其中使用的CSS选择器列表的函数。它允许更精确地删除未使用的CSS。</p><p id="51a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以为每种文件类型指定要使用的提取器，从而获得最准确的结果。但是使用特定的提取器是可选的，您可以依赖默认的提取器。</p><h2 id="7467" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">纯化CSS</h2><div class="nl nm gp gr nn no"><a href="https://github.com/purifycss/purifycss" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">纯化css/纯化CSS</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">一个接受内容(HTML/JS/PHP/etc)和CSS的函数，只返回使用过的CSS。PurifyCSS不修改…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="oi l nz oa ob nx oc ks no"/></div></div></a></div><p id="ee52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PurifyCSS的工作方式与PurgeCSS类似。它分别分析文件、内容和CSS。它可以处理任何文件——不仅仅是HTML或JavaScript。</p><p id="ed97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是PurifyCSS的主要缺陷是缺乏模块化。与PurgeCSS相比，它本质上定义了一个不能更改的提取器。PurifyCSS的提取器提取每个单词，并基于一些用例。</p><p id="3b3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们以<code class="fe oe of og oh b">.hello-world</code>为例。PurifyCSS的提取器是为JavaScript设计的，可以将字符串连接起来形成一个类名。出于这个原因，它会将<code class="fe oe of og oh b">hello</code>和<code class="fe oe of og oh b">world</code>视为使用的类名，而不是<code class="fe oe of og oh b">hello-world</code>。</p><p id="8861" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为每个单词都被认为是一个选择器，所以很多选择器都可能被错误地使用。它也不能处理实用CSS框架经常使用的特殊字符。</p><h2 id="96d7" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">UnCSS</h2><div class="nl nm gp gr nn no"><a href="https://github.com/uncss/uncss" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">联合国会议服务/联合国会议服务</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">从CSS中移除不用的样式。通过在GitHub上创建一个帐户，为uncss/uncss开发做出贡献。</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="oj l nz oa ob nx oc ks no"/></div></div></a></div><p id="2948" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">UnCSS以不同的方式处理这个问题。它不是分析文件，而是试图运行你的网站并在你的CSS文件中寻找选择器。正如它的自述文件中所指出的，UnCSS首先用jsdom加载文件，然后执行JavaScript。这样，它可以与没有HTML的React单页面应用程序一起工作。</p><p id="443d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，PostCSS解析所有的样式表。UnCSS查看样式表中定义的选择器列表，并在网站上运行<code class="fe oe of og oh b">document.querySelector</code>。如果函数没有找到选择器，它将从CSS中移除。</p><p id="6393" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于其HTML模拟和JavaScript执行，UnCSS有效地从web应用程序中移除了未使用的选择器。</p><p id="c976" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，它的模拟在性能和实用性方面是有代价的。要从Pug模板文件中移除未使用的CSS，您需要将Pug转换为HTML，并在jsdom中模拟页面。在这一步之后，UnCSS可以在每个选择器上运行<code class="fe oe of og oh b">document.querySelector</code>。</p><p id="d320" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个过程的另一个问题是，在一些常见的用例中，元素最初不会出现。你可能需要点击网站上的一个按钮来让一个模态出现或者让另一个部分出现。</p><p id="7ef8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用UnCSS，您可以点击网站上的元素。但是它造成了维护负担。您可以将其视为创建一个小型Cypress/Selenium测试来检查您的应用程序并发现所有隐藏的部分。</p><p id="1812" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前，对于某些情况，UnCSS可能是删除未使用的CSS的最准确的工具。如果您不使用服务器端渲染，并且有一个简单的包含HTML和JavaScript的单页网站，它应该可以正常工作，并且在CSS大小方面优于PurgeCSS。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="61d3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">资源</h1><div class="nl nm gp gr nn no"><a href="https://medium.com/full-human/purgecss-2-0-c0e812e6c4f6" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">PurgeCSS 2.0</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">移除未使用的CSS</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">medium.com</p></div></div><div class="nx l"><div class="ok l nz oa ob nx oc ks no"/></div></div></a></div><div class="nl nm gp gr nn no"><a href="https://purgecss.com/comparison.html" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">比较|采购</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">PurgeCSS并不是唯一一个移除未使用CSS的工具。下面你会发现PurgeCSS和其他两个的比较…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">purgecss.com</p></div></div><div class="nx l"><div class="ol l nz oa ob nx oc ks no"/></div></div></a></div></div></div>    
</body>
</html>