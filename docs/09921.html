<html>
<head>
<title>How To Inspect an iOS App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何检查iOS应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-reverse-engineer-an-ios-app-313a95950aff?source=collection_archive---------2-----------------------#2021-11-01">https://betterprogramming.pub/how-to-reverse-engineer-an-ios-app-313a95950aff?source=collection_archive---------2-----------------------#2021-11-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9d6c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Xcode的调试器</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/11c89080be8d2e67fb96924fe6c36336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cMZKsXbteCAefJD0"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@bramnaus?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Bram Naus </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="8087" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将学习如何使用Xcode的调试器对iOS应用程序进行逆向工程。我们将通过探索苹果的地图应用程序是如何构建的来做到这一点。简而言之，在本教程结束时，您将会知道:</p><ul class=""><li id="afe6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">如何调试视图层次结构以捕获当前UI状态并获取布局信息。</li><li id="fc15" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如何调试内存图以获得对象层次结构，以及如何实现特定的API。</li></ul><p id="1f6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事不宜迟，我们开始吧。</p><h1 id="d85a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">我们开始吧</h1><p id="4ca5" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在我们开始调试应用程序之前，我们需要禁用计算机的<a class="ae ky" href="https://developer.apple.com/documentation/security/disabling_and_enabling_system_integrity_protection" rel="noopener ugc nofollow" target="_blank">系统完整性保护</a>。简而言之，这个设置默认为<em class="ng">启用</em>，防止我们在Xcode中调试任何iOS应用，除了我们自己的。</p><ol class=""><li id="30f7" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nh mb mc md bi translated">在恢复模式下重启Mac:在Mac开机后，立即按下Command(⌘) + R。当Apple标志出现在屏幕上时，松开这些键。</li><li id="96df" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nh mb mc md bi translated">然后，找到“实用程序”并打开终端。</li><li id="87d7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nh mb mc md bi translated">类型<code class="fe ni nj nk nl b">csrutil disable; reboot</code>。这将禁用系统完整性保护并重新启动计算机。</li></ol><p id="3e20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们准备开始用Xcode对一个样例应用程序Apple Maps进行逆向工程。</p><p id="0a64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:完成教程后，不要忘记再次以恢复模式重启Mac，并在终端中运行<code class="fe ni nj nk nl b">csrutil enable; reboot</code>。这将再次启用系统完整性保护并重新启动计算机。</p><p id="097f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，启动Xcode，创建一个新项目或打开您现有的项目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/3da2888d63f529378a8ca0759e9e5256.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3dvOLpTKwMsee0SziUsPIg.png"/></div></div></figure><p id="67d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Xcode Simulator或您的设备上，打开苹果地图应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/e0eeee0304f9abba700a9aecfc843fa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hvFbgXocirl67Uti8E-Cvg.png"/></div></div></figure><p id="4eb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，转到“调试”选项卡并选择<code class="fe ni nj nk nl b">Attach to Process by PID or Name</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/a5f6f248fe4f9720b24902f228875a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zF5YmAHrYMFA8VtOp6cvug.png"/></div></div></figure><p id="e499" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以搜索“地图”流程，然后按“附加”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/aa0cd53b78e7dbc44d741900e94c8f25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WvvAxmJzvtPG0F1GD3w5ww.png"/></div></div></figure><p id="1e92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一段时间后，进度将从“连接到地图…”变为“运行地图…”。这意味着调试器已成功连接到应用程序。现在让我们看看我们能做些什么。</p><h1 id="4dab" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">调试视图层次结构</h1><p id="cac6" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">打开地图并连接调试器后，点击<code class="fe ni nj nk nl b">Debug View Hierarchy</code>按钮显示用户界面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/88d77115842d0d429bb68ed300079c03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*rkXG3i6eJWJsgdJWQ9_KSw.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/67e5b9f0fe7e33e06a8ba16668a19c15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_LYdnLBGpTKi0grMUfXh5w.png"/></div></div></figure><p id="7363" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们很想知道底层是如何构建的，以及UI和行为是如何实现的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/7ffb0e70860ea53619ecb15ec9ffffc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/1*afcPnWdZRug5PzXir1lqsQ.gif"/></div></figure><p id="6829" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们揭示UI层次结构并展开一些视图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/86a6997c90d01a001c900c20757b25dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZquZjpZXW9oN-_AiWr0piA.png"/></div></div></figure><p id="b1ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们可以看到苹果使用<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-create-an-interactive-bottom-sheet-in-swift-5-adadaad79e72">容器和子视图控制器</a>将一个屏幕分成更小的、可重复使用的部分。</p><p id="5991" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们可以检测自动布局警告，就像我们自己的任何应用程序一样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/a9d36213b75ef380711fd33eebaed950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0DPyKDzCIVyBUBwcEgaC5w.png"/></div></div></figure><p id="1ea9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最重要的是，当您加入一个项目并需要在代码库中找到所需的类时，查看每个视图控制器或视图的名称非常有用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/0586225c473a0318731f73fcecfcd22b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2A9-dmxrQmyG4eXS2yZYjA.png"/></div></div></figure><p id="239a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们看看使用什么API来创建前面提到的底部表单行为。我们将通过检查内存图来做到这一点。</p><h1 id="a140" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">调试内存图</h1><p id="8bc0" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">首先，点击<code class="fe ni nj nk nl b">Debug Memory Graph</code>按钮:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/680fb09e4a484d4b7d4b31b652c181ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0yfw9fXsWfB21P6Lo9AUhg.png"/></div></div></figure><p id="490c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这让我们可以看到当前活着的物体:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/2376cee0757a966f481034367745e3e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i6FkjJpPqjOq4v-tXPW2TA.png"/></div></div></figure><p id="84d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从视图层次结构中，我们发现底部的工作表视图控制器叫做<code class="fe ni nj nk nl b">SearchViewController</code>。让我们在调试导航器中搜索它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/cf130c23bf5ad3588a687f524aa844b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BC8mQ1bqWQOQxjK14IxS-w.png"/></div></div></figure><p id="44e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击之后，我们可以看到右边的依赖关系图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/e5fb839e2937820a650c0b4d6d4cdb61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LbY5osm5TuFIRoEgWqmovg.png"/></div></div></figure><p id="b23a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这让我们知道有一个名为<code class="fe ni nj nk nl b">UIFormSheetPresentationController</code>的类负责底层表单的表示。通过点击它并显示一个<code class="fe ni nj nk nl b">Memory inspector</code>，我们可以看到详细的层次结构:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/7a13c967689a2db572b57743bc5ad9f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1loAU-osqtAmUkc2RdZHXw.png"/></div></div></figure><p id="b8c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，负责底部工作表的对象被称为<a class="ae ky" href="https://developer.apple.com/documentation/uikit/uisheetpresentationcontroller" rel="noopener ugc nofollow" target="_blank">UISheetPresentationController</a>。这是从iOS 15.0和Swift 5.5开始增加的API。通过检查文档，我们发现它使用了<code class="fe ni nj nk nl b">detents</code>数组来管理底部工作表的大小配置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/d4bd85566d8e99f2f10c84ae985d2f59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IoMfL6JJsdAajPawnodimA.png"/></div></div></figure><p id="f4d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还了解到，目前我们只有两种可能的缓和手段，<code class="fe ni nj nk nl b">.large()</code>和<code class="fe ni nj nk nl b">.medium()</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/199e3aa63409530de73412088d3efd51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XhYmReayMVsIoOzkWo0HOw.png"/></div></div></figure><p id="b6b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，Apple Maps允许在不同于<code class="fe ni nj nk nl b">.medium</code>和<code class="fe ni nj nk nl b">.large</code>的位置放置底部纸张。我们可以看到它可以停留在一个小得多的高度:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/29fc02a2bd933d59466c1b51634e6f0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCmOJYPCBuO-FDl47ob3Zg.png"/></div></div></figure><p id="5eca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这怎么可能呢？让我们找出答案。通过在调试导航器中搜索“Detent”关键字，我们找到了<code class="fe ni nj nk nl b">detents</code>数组:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/f7fab0eaa0647e381c2a83a7a92c7526.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DiZEJ13HmCumISOh-S944w.png"/></div></div></figure><p id="ffb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们按如下方式打印阵列的描述:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/625e5412a85500629dac88c3b3b6c4ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*tG1bW7KQtS-WukhiHpJP8Q.png"/></div></figure><p id="20ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到苹果使用了三种<code class="fe ni nj nk nl b">.custom</code>缓和手段:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/c39995582917ce0b66914c360c8d5a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bqiNkHJ6AQrNxsK3xfbk-g.png"/></div></div></figure><p id="6c52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这让我们知道<code class="fe ni nj nk nl b">UISheetPresentationController</code>的一部分是私有的，开发者还不能使用。然而，希望API将很快更新，以允许创建自定义制动器。</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><p id="1028" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经看到了如何使用视图层次结构获取UI信息，以及如何使用内存图扩展对象关系。此外，您可以在任何应用程序上使用<code class="fe ni nj nk nl b">Instruments</code>来监控网络请求、捕捉内存泄漏等等:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/b2db417082b3535baab726754aa31730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hP7oSMV5VOru0IieaxIy1g.png"/></div></div></figure><h1 id="78c2" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">包扎</h1><p id="cab7" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">想了解更多关于iOS 15中底部表单创建的信息吗？查看我关于<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-present-customizable-bottom-sheets-in-ios-15-e98e530208b2">UISheetPresentationController</a>的文章。感谢阅读！</p></div></div>    
</body>
</html>