<html>
<head>
<title>How to Schedule Notifications and Add Badges in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在SwiftUI中安排通知和添加徽章</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/scheduling-notifications-and-badges-in-swiftui-9edf8574b893?source=collection_archive---------7-----------------------#2020-05-07">https://betterprogramming.pub/scheduling-notifications-and-badges-in-swiftui-9edf8574b893?source=collection_archive---------7-----------------------#2020-05-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="08a4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用苹果新的通知API，并在你的应用程序图标中设置你的徽章</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b7f87c3f936f321eb5d79d9cd857f586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Hyz-QJvQagW8sfdytouYQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@mr_fresh?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">尤拉鲜</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="d55e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">阅读完本文后，您应该能够快速地将本地通知添加到您的应用程序中。让我们对标题中的每个术语多了解一点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b744" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">斯威夫特伊</h1><blockquote class="mu mv mw"><p id="d280" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">“SwiftUI是一种创新的、极其简单的方式，利用Swift的力量在所有苹果平台上构建用户界面。只需使用一套工具和API，就能为任何苹果设备构建用户界面。”— <a class="ae ky" href="https://developer.apple.com/xcode/swiftui/" rel="noopener ugc nofollow" target="_blank">苹果官方文档</a></p></blockquote><p id="18d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最棒的是，您可以将视图与UIKit、AppKit和WatchKit框架中的组件集成在一起。简而言之，SwiftUI使得构建用户界面变得简单明了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ba5a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">本地通知</h1><blockquote class="mu mv mw"><p id="f8d9" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">"使用本地通知来引起用户的注意。您可以显示提醒、播放声音或标记您的应用程序图标。例如，后台应用程序可以要求系统在特定任务完成时显示警告。总是使用本地通知来传达用户想要的重要信息。</p><p id="273c" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">通知的传递由系统根据您指定的时间或位置来处理。如果通知的发送发生在您的应用程序未运行或处于后台时，系统会为您与用户进行交互。如果您的应用程序在前台，系统会将通知发送到您的应用程序进行处理。“— <a class="ae ky" href="https://developer.apple.com/documentation/usernotifications/scheduling_a_notification_locally_from_your_app" rel="noopener ugc nofollow" target="_blank">苹果官方文档</a></p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5a7b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">徽章</h1><p id="36a8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">每个iOS应用程序都有一个<code class="fe ng nh ni nj b">UIApplication</code>实例，它提供控制来管理应用程序的图标。您可以在应用程序图标的右上角添加一个数字，设置一个备用图标(更改应用程序的图标)等。</p><p id="c933" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们开始前需要知道的全部内容。让我们深入了解一下通知。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9e12" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">通知</h1><p id="735d" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">要将通知推送到锁定屏幕，我们需要做两件事:</p><ol class=""><li id="f28c" class="nk nl it lb b lc ld lf lg li nm lm nn lq no lu np nq nr ns bi translated">请求用户允许发送通知。</li><li id="adbe" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated">触发通知。</li></ol><p id="e175" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将从使用<a class="ae ky" href="https://developer.apple.com/documentation/usernotifications" rel="noopener ugc nofollow" target="_blank">用户通知</a>框架开始。要请求用户许可以便将通知推送到锁定屏幕，您可以简单地写:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="51d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们被授权发送通知，让我们开始研究触发机制。</p><p id="8108" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将<strong class="lb iu"> </strong>创建内容:</p><pre class="kj kk kl km gt oa nj ob oc aw od bi"><span id="534a" class="oe md it nj b gy of og l oh oi">let content = UNMutableNotificationContent()<br/>content.title = "Daily Notification"<br/>content.body = "Daily Notification is Ready"<br/>content.sound = UNNotificationSound.default //you can play with it</span></pre><p id="6da9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是创建一个时间表。现在你可以每天、每周、每月或者每五分钟安排一次。所有这些参数都很容易操纵。例如:</p><h2 id="2dc8" class="oe md it bd me oj ok dn mi ol om dp mm li on oo mo lm op oq mq lq or os ms ot bi translated"><strong class="ak">当地时间每天下午2点推送通知</strong></h2><pre class="kj kk kl km gt oa nj ob oc aw od bi"><span id="07cd" class="oe md it nj b gy of og l oh oi">var dateComponents = DateComponents()<br/>dateComponents.hour = 11<br/>dateComponents.minute = 59<br/>let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents, repeats: true)</span></pre><h2 id="7e47" class="oe md it bd me oj ok dn mi ol om dp mm li on oo mo lm op oq mq lq or os ms ot bi translated"><strong class="ak">每10秒推送一条通知</strong></h2><pre class="kj kk kl km gt oa nj ob oc aw od bi"><span id="6b93" class="oe md it nj b gy of og l oh oi">let trigger = UNTimeIntervalNotificationTrigger(timeInterval: 5, repeats: false)</span></pre><p id="dc80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mx">注意:在</em> <code class="fe ng nh ni nj b"><em class="mx">timeInterval</em></code> <em class="mx">设置为至少60°之前，不能将重复次数设置为</em> <code class="fe ng nh ni nj b"><em class="mx">true</em></code> <em class="mx">。</em></p><p id="51e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经设置了一个时间表，我们需要设置一个请求来触发通知:</p><pre class="kj kk kl km gt oa nj ob oc aw od bi"><span id="e25f" class="oe md it nj b gy of og l oh oi">let request = UNNotificationRequest(identifier: UUID().uuidString, content: content, trigger: trigger)</span></pre><p id="8205" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，添加请求:</p><pre class="kj kk kl km gt oa nj ob oc aw od bi"><span id="4f08" class="oe md it nj b gy of og l oh oi">UNUserNotificationCenter.current().add(request)</span></pre><p id="b263" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的一件非常重要的事情是，如果你每次加载应用程序时都测试或执行这段代码，你将会有多个请求被添加到<code class="fe ng nh ni nj b">UNUserNotificationCenter</code>。因此，您将会一次又一次地收到多个通知。为避免这种情况，在添加请求之前删除所有已计划的待处理通知请求非常重要。为此:</p><pre class="kj kk kl km gt oa nj ob oc aw od bi"><span id="8784" class="oe md it nj b gy of og l oh oi">UNUserNotificationCenter.current().removeAllPendingNotificationRequests()</span></pre><p id="c63e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！你的应用程序有通知功能。即使你关闭应用程序，锁定手机，或者只是将应用程序移动到后台，你也会收到通知。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7c1e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">徽章号码</h1><p id="7401" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">一旦你有通知工作，显示一个徽章号码是小菜一碟。我将假设您的应用程序用户已经授权您发送通知。这样，你就可以在你的应用程序中的任何地方添加下面一行:</p><pre class="kj kk kl km gt oa nj ob oc aw od bi"><span id="af13" class="oe md it nj b gy of og l oh oi">UIApplication.shared.applicationIconBadgeNumber = badgeNumber //Integer</span></pre><p id="8181" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是干将的完整代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">计划通知。swift</p></figure><p id="7242" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就对了。现在，您已经安排了通知，并在应用程序图标上添加了徽章号码。</p><p id="54b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>