<html>
<head>
<title>How To Run macOS Inside a Virtual Machine on Linux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Linux上的虚拟机中运行macOS</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-run-macos-inside-a-virtual-machine-on-linux-4d6ce7cd493e?source=collection_archive---------2-----------------------#2021-04-22">https://betterprogramming.pub/how-to-run-macos-inside-a-virtual-machine-on-linux-4d6ce7cd493e?source=collection_archive---------2-----------------------#2021-04-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2a2d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过在Linux中安装macOS开始使用虚拟机</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3b048bdbd94b34561299e45d8e353418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T7K7fyCipmGeBwOK"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">莱纳斯·米米耶茨在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="a618" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虚拟机为您提供了运行和测试其他操作系统的机会，而无需额外的硬件。</p><p id="d488" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本指南将向您展示如何在Ubuntu Linux上安装macOS，以便您可以测试和运行您的macOS本地应用程序。如果您使用的是另一个Linux发行版，我在本文底部提供了一个关于如何安装QEMU/KVM的链接。</p><h1 id="4414" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">安装虚拟机管理器</h1><p id="427c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">本指南使用QEMU/KVM，这是一个轻量级模拟器，也是运行虚拟机的虚拟化器。您可以使用下面的命令安装它。此外，您将安装一些Python工具。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="4193" class="mx lw it mt b gy my mz l na nb">sudo apt-get install qemu-system qemu-utils python3 python3-pip</span></pre><h1 id="8d18" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">下载macOS基础映像和脚本</h1><p id="693a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了方便入门，本指南将使用GitHub上的macOS-Simple-KVM开源项目来简化虚拟机的管理。</p><p id="d1ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Cd到您的<strong class="lb iu">/下载</strong>文件夹，使其成为您当前的工作目录。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="080d" class="mx lw it mt b gy my mz l na nb">cd ~/Downloads</span></pre><p id="1adf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<strong class="lb iu"> wget </strong>实用程序下载macOS基本映像和其他所需的工具。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="6e72" class="mx lw it mt b gy my mz l na nb">wget https://github.com/foxlet/macOS-Simple-KVM/archive/refs/heads/master.zip</span></pre><p id="6b7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<strong class="lb iu"> unzip </strong>命令行实用程序提取下载的包，如下所示。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="4628" class="mx lw it mt b gy my mz l na nb">unzip master.zip</span></pre><p id="568e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">新解压的文件夹将命名为<strong class="lb iu"> macOS-Simple-KVM-master。</strong></p><h1 id="a583" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">为您的虚拟机创建文件夹</h1><p id="e8f4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了简化虚拟机的管理，您可以在主目录中创建一个文件夹，该文件夹将存放虚拟机的所有虚拟磁盘或其他相关内容。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="af6b" class="mx lw it mt b gy my mz l na nb">mkdir ~/KVM</span></pre><p id="3a3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您现在可以从您的<strong class="lb iu">下载</strong>文件夹中移动提取的文件夹，并将其重命名为macOS，以便使用更短的名称。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="7748" class="mx lw it mt b gy my mz l na nb">mv ~/Downloads/macOS-Simple-KVM-master/ ~/KVM/macOS</span></pre><h1 id="3088" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建虚拟磁盘</h1><p id="bb66" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在，您将在最近重命名的macOS文件夹中创建一个虚拟硬盘。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="c211" class="mx lw it mt b gy my mz l na nb">cd ~/KVM/macOS</span></pre><p id="99ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从将托管您的虚拟机的macOS文件夹中运行以下脚本。下面给出的命令下载macOS Catalina安装映像。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="db52" class="mx lw it mt b gy my mz l na nb">./jumpstart</span></pre><p id="4099" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了基础映像，现在可以创建虚拟磁盘映像，在其中安装macOS。</p><p id="8586" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<strong class="lb iu"> qemu-img </strong>实用程序创建将用于安装操作系统的虚拟硬盘。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="474c" class="mx lw it mt b gy my mz l na nb">qemu-img create -f qcow2 mac_os.qcow2 64G</span></pre><p id="f453" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的命令创建了一个名为<strong class="lb iu"> mac_os.qcow2 </strong>的虚拟磁盘，采用<strong class="lb iu"> qcow2 </strong>格式，估计大小为64GB。QEMU将创建一个比您指定的更大的映像，您可以在下面的输出中看到，它创建了一个大约68GB的磁盘。</p><p id="863d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注</strong>:你甚至可以创建一个小至34GB的图像；它不必是64GB。</p><h1 id="9530" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">配置虚拟机</h1><p id="296d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">macOS文件夹中的另一个重要文件是<strong class="lb iu"> basic.sh </strong>文件，用于配置虚拟机的运行时环境。</p><p id="bd8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<strong class="lb iu"> basic.sh </strong>文件的底部添加以下两行并保存。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="793f" class="mx lw it mt b gy my mz l na nb">-drive id=SystemDisk,if=none,file=mac_os.qcow2<br/>-device ide-hd,bus=sata.4,drive=SystemDisk</span></pre><p id="3948" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> basic.sh </strong>的最终内容应该如下图所示。上面提到的我添加的行用红色突出显示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/e9ddd4c591d0a5f37f1aad8b9be4d454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4diofQbfCC9t3HU7sgzQFw.png"/></div></div></figure><p id="2cf6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以更改的另一个配置是虚拟机将使用的RAM数量。以<strong class="lb iu"> -m </strong>开头的那一行以GB为单位指定RAM的大小。您可以在以<strong class="lb iu"> -smp </strong>开头的行中指定虚拟机使用的CPU核心数，即<strong class="lb iu">核心数=x </strong>。</p><h1 id="19f5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在Ubuntu上安装macOS</h1><p id="2ab6" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要开始安装，运行我们刚刚编辑过的<strong class="lb iu"> basic.sh </strong>脚本文件。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="8760" class="mx lw it mt b gy my mz l na nb">./basic.sh</span></pre><p id="4488" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行上面的命令后，您将看到macOS操作系统的初始安装屏幕。按下<strong class="lb iu">进入</strong>继续。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/6cf2f309ffe21bf0452dc849c8e79464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L08pB50iQX4u5Q9gE2Gp7w.png"/></div></div></figure><p id="a3d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:您的鼠标目前可能无法正常工作。您可以使用键盘上的箭头键来导航。</p><p id="a002" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用键盘按键<strong class="lb iu"> Ctrl + Alt + G </strong>从虚拟机窗口退出鼠标和键盘控制。</p><p id="3057" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保阅读许可条款，并通过选择<strong class="lb iu">同意</strong>按钮继续安装。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/6f677753cb1a338b1e06669de87182fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qiUrb3JRPIHOE3APLiCAMg.png"/></div></div></figure><p id="13b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在继续安装之前，请记住使用“磁盘工具”格式化虚拟磁盘。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/71498b920077b9d7c4f7548d2325ac36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T72aHnoUxydHf5a68cxFzQ.png"/></div></div></figure><p id="1d59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从左侧面板中选择相应的磁盘大小(即您使用qemu-img创建的大小),然后单击<strong class="lb iu">擦除</strong>按钮。在磁盘工具中将磁盘重命名为<strong class="lb iu"> MainDisk </strong>。使用Apple文件系统格式(APFS)来格式化磁盘，并使用如下所示的GUID分区图方案。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/e16b9f9be21fdb758db97ea4998174c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TpO4SSBHMa24eaUkXZhLvw.png"/></div></div></figure><p id="5cc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置好一切后，用左上角的红色按钮关闭“磁盘工具”窗口。然后，系统将引导您进入上一个屏幕。</p><p id="0b98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虚拟硬盘正确格式化后，您现在可以通过选择<strong class="lb iu">重新安装macOS </strong>选项继续安装macOS。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/7566f91d0a76bbcd74ff0980958fe2f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k4wUrfkQzvYuwYc57MQpmA.png"/></div></div></figure><p id="d5a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在选择安装你的macOS系统的安装盘。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/bec75d98c4d115c916eaac40a5aaa0ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-VuLc1I_w76_nQhK10SrQQ.png"/></div></div></figure><p id="cd07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在接下来的下一个屏幕上，您可以点击<strong class="lb iu">继续</strong>继续安装。</p><p id="cd1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装需要一些时间，你可以从下面的初始估计时间(大约一小时五分钟)中看到，所以喝杯咖啡放松一下吧。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/01706989b6c7bbc2a382c3b5d8f14288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LDCLm0wXjAzEQDuojbgdxA.png"/></div></div></figure><p id="8e8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>在安装过程中，您不需要进行任何其他选择。看到下面的屏幕后，您可以开始配置您的系统。</p><h1 id="7d19" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">配置您的新操作系统</h1><p id="e346" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果安装已经进行到这一步，是时候配置您的新操作系统了。从选择你居住的国家或地区开始。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/a6057037feaf1393fd4902d515789c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mIaAd9Thls_E-wnhw6AMwA.png"/></div></div></figure><p id="1412" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这之后，你将会看到更多的配置界面来设置你的语言、账户名、Siri等。根据您的需求配置操作系统。</p><p id="6fde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">操作系统配置的最后一页是选择你的主题，如下所示。选择你的主题并点击<strong class="lb iu">继续。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/b7027a4bca338a6542ce12d796a7a687.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hgq7FmxH5Y1QMwbg4Jic3w.png"/></div></div></figure><p id="b55c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的macOS桌面现在可以使用了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/f54bed370927b4ed819ddc4596da0ed8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QuA9ZIU51rJGbR4wfxGhlQ.png"/></div></div></figure><h1 id="4ee6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">启动和停止虚拟机</h1><p id="7b68" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果使用完虚拟机，您可以关闭或重新启动macOS系统。要停止虚拟机，在用于运行<strong class="lb iu"> basic.sh </strong>脚本的终端中按<strong class="lb iu"> Ctrl + C </strong>。</p><p id="292c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要再次启动虚拟机，只需启动托管虚拟硬盘的macOS文件夹中的<strong class="lb iu"> basic.sh </strong>脚本。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="46bd" class="mx lw it mt b gy my mz l na nb">./basic.sh</span></pre><p id="727d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您将看到以下启动屏幕。选择显示<strong class="lb iu">从主盘</strong>引导macOS的选项。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/4b5e1f731c290d43e02076db798d0253.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l-jVjV4a4ixoW1Md1Gvq2g.png"/></div></div></figure><h1 id="3dc8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">最后的想法</h1><p id="4158" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">虚拟机是软件工程的重要组成部分。使用QEMU/KVM，您可以轻松地从您的Linux机器上运行其他操作系统。</p><p id="1d93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以进一步配置您的虚拟机设置，包括屏幕分辨率等。通过查看包含虚拟硬盘的<strong class="lb iu"> macOS </strong>目录中的<strong class="lb iu"> /docs </strong>文件夹。</p><p id="018d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你使用的是Ubuntu Linux之外的其他Linux发行版，那就看看<a class="ae ky" href="https://github.com/foxlet/macOS-Simple-KVM" rel="noopener ugc nofollow" target="_blank">官方foxlet GitHub页面</a>关于如何安装QEMU/KVM的内容。</p></div></div>    
</body>
</html>