<html>
<head>
<title>Using Mitmproxy and Httpie to Improve API Development and Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Mitmproxy和Httpie改进API开发和测试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-mitmproxy-and-httpie-to-improve-api-development-and-testing-3c6c8b0b82c9?source=collection_archive---------18-----------------------#2022-07-07">https://betterprogramming.pub/using-mitmproxy-and-httpie-to-improve-api-development-and-testing-3c6c8b0b82c9?source=collection_archive---------18-----------------------#2022-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5ff6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在测试和开发API时，有两个工具帮助我提高了生产率</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/50ca3e81b2312e80a8027af4469bc49e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*STCeO8QzEwO3Lw9w"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@yassine_khalfalli?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">亚辛·哈尔法利</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="e67a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在开发API时，深入检查每个端点(或查询)是非常重要的。这是出于各种原因，包括安全性、效率、用户体验等等。</p><p id="5635" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近在为一个个人项目开发一个API <a class="ae ky" href="https://medium.com/xycloo/stex-our-blockchain-based-latex-editor-with-real-time-compiling-aa020b0fc32c?source=rss------cryptocurrency-5" rel="noopener">，发现自己不得不决定是使用Postman还是Burp Suite。这些都是测试您的终端和篡改它们接收的数据的优秀工具，因此您可以在边缘情况下确保出色的性能和安全性。</a></p><p id="7429" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，即使我已经有了使用这两种工具的经验，我还是决定去寻找更容易定制和更适合我的需求的替代工具，主要是:</p><ul class=""><li id="7eab" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">轻松制作请求</li><li id="de9d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">修改传出的请求并与之交互</li><li id="8030" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">评估和过滤轻量级测试的响应</li></ul><p id="73bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我也不想花时间自己编写易于使用的代理，这是我只在针对非常具体的用例时才做的事情，比如总是自动修改对域<code class="fe mj mk ml mm b">test.testing.com</code>的传出请求。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="67da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在搜索了各种GitHub repos之后，我决定使用httpie和mitmproxy(以及mitmdump)来帮助我开发用于<a class="ae ky" href="https://medium.com/xycloo/stex-our-blockchain-based-latex-editor-with-real-time-compiling-aa020b0fc32c?source=rss------cryptocurrency-5" rel="noopener"> sTeX </a>的API。</p><p id="f4ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">API的开发尚未完成，但我可以说我对这两个工具的结合感到满意，并希望与读者分享这种体验。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="0862" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated"><a class="ae ky" href="https://github.com/httpie/httpie" rel="noopener ugc nofollow" target="_blank"> HTTPie </a></h1><p id="abb5" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我敢打赌，你们大多数人都听说过和/或使用过cURL。cURL是client URL的缩写，也是一个跨协议传输数据的命令行工具。我喜欢cURL，并且在开发和安全研究中经常使用它，但是当我开始使用httpie时，我明白了为什么创建者认为这样的项目适合与cURL竞争。</p><p id="722f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">cURL被设计成具有更多的功能，但是这些功能在日常API测试中很少有用。另一方面，httpie是一个命令行工具，可以轻松地与HTTP或HTTPS上的任何东西进行交互，它被设计得尽可能简单，让事情变得像做馅饼一样容易。</p><p id="e971" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它的缺省值确保您在手动创建API请求时拥有最流畅的体验，例如，这个httpie命令:</p><pre class="kj kk kl km gt nr mm ns nt aw nu bi"><span id="b5da" class="nv mv it mm b gy nw nx l ny nz">http http://127.0.0.1 test=data</span></pre><p id="2f10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转换为以下HTTP请求:</p><pre class="kj kk kl km gt nr mm ns nt aw nu bi"><span id="aa91" class="nv mv it mm b gy nw nx l ny nz">POST / HTTP/1.1<br/>Accept: application/json, */*;q=0.5<br/>Accept-Encoding: gzip, deflate<br/>Connection: keep-alive<br/>Content-Length: 16<br/>Content-Type: application/json<br/>Host: 127.0.0.1</span><span id="af63" class="nv mv it mm b gy oa nx l ny nz">{<br/>    "test": "data"<br/>}</span></pre><p id="3597" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种语法非常适合大多数API，它确保用户在发送请求之前不必输入很长的命令。当然，或者至少在我看来，cURL仍然是CLI请求制作领域的王者，但是httpie的简单性和工作流程使它更适合大多数测试任务。</p><h1 id="e53b" class="mu mv it bd mw mx ob mz na nb oc nd ne jz od ka ng kc oe kd ni kf of kg nk nl bi translated"><a class="ae ky" href="https://github.com/mitmproxy/mitmproxy" rel="noopener ugc nofollow" target="_blank"> MITMProxy </a></h1><p id="809a" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">MITM听起来可能很熟悉，如果不是，让我提醒你:主在中间。这意味着mitmproxy实际上位于您的应用程序和它们发送数据的服务器之间。这种行为也被称为代理拦截器，并被所有现代(或非现代)API测试工具所使用。</p><p id="4d54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在API测试中使用这样的工具很简单:在发出请求后，您可以轻松地修改、调整和监控API收到的数据。</p><p id="fc4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我专门使用两种工具:</p><ul class=""><li id="9dc6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">mitmproxy</li><li id="1b2f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">mitmdump</li></ul><h2 id="325f" class="nv mv it bd mw og oh dn na oi oj dp ne li ok ol ng lm om on ni lq oo op nk oq bi translated">MITMProxy</h2><p id="4ec2" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">这个工具将所有东西都保存在内存中，当我想要监控我发出的httpie请求时，我会使用它(这些请求通常是一堆请求，是测试API不同区域的bash脚本的直接结果)。这是我在旅途中使用的工具，用于快速监控API如何响应不同的用户输入。例如，您可以根据漏洞有效负载的单词列表来测试API。感谢<a class="ae ky" href="https://docs.mitmproxy.org/stable/concepts-filters/" rel="noopener ugc nofollow" target="_blank"> mitmproxy的过滤器</a>所做的出色工作，我能够有效地监控这些请求。</p><h2 id="bcc4" class="nv mv it bd mw og oh dn na oi oj dp ne li ok ol ng lm om on ni lq oo op nk oq bi translated">MITMDump</h2><p id="cfd3" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">另一方面，mitmdump(行为类似于伟大的tcpdump)将所有流保存在文件中，这使得它更适合于结构化测试，并在以后使用API自己的响应来进行进一步的测试。它还支持向请求和响应添加自定义脚本，尽管这是我更喜欢用自己的脚本来完成的事情。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="4d9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这三个工具合在一起非常适合我。我用httpie发出请求，并使用mitmproxy(或mitmdump)代理来监控和分析请求和响应。</p><p id="7cb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像Postman这样的工具工作得很好，但有时提供了太多我们不需要的功能，缺乏一些定制选项，不是免费和/或开源的，或者我们只是想从GUI中解脱出来，切换到命令行。</p><p id="5a5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我个人从现在开始会更多的使用httpie，mitmproxy和mitmdump组合。可能的话，我还会创建一个简单的后端，以方便地分享结果，并能够像在邮差合作。</p><p id="5a54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>