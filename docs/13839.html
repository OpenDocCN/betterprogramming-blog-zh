<html>
<head>
<title>5 SQL Tips to Improve Your Queries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">改善查询的5个SQL技巧</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/5-sql-tips-to-improve-your-queries-58c0e93ff4ef?source=collection_archive---------0-----------------------#2022-10-03">https://betterprogramming.pub/5-sql-tips-to-improve-your-queries-58c0e93ff4ef?source=collection_archive---------0-----------------------#2022-10-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="df58" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">代码中的细微变化会带来很大的不同</h2></div><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/1d1578fa87352f5132227dc3f39d5acb.png" data-original-src="https://miro.medium.com/v2/0*EaQRpAo20ZX7ftL0"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图片由Freepik上的<a class="ae ku" href="https://www.freepik.com/author/freepik" rel="noopener ugc nofollow" target="_blank"> Freepik </a>提供。</p></figure><p id="9694" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">SQL通常是一种自学语言。它的简单性和快速的学习曲线使它成为进入数据科学的完美语言。</p><p id="2b8f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然而，这可能会带来一些你可能没有意识到的重要缺点。</p><p id="4541" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们都像任何初学者一样，开始编写相当糟糕的查询。这使得我们在掌握SQL的旅程开始时就养成了一些坏习惯，这些坏习惯可能会一直伴随我们到最后。</p><p id="a27a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您可能会想，我已经掌握了SQL，并且编写了非常酷的查询。即使我确实有一些小的坏习惯，为什么我应该停止做它们？这样做有几个原因:</p><ol class=""><li id="f9f4" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">作为一名专业人员，你的编码风格是你能给人的最好的第一印象。没有清晰结构的杂乱查询是缺乏改进动力的专业人员的明显标志。</li><li id="ce77" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">不遵循逻辑的查询更难共享和重用。在团队中工作时，这一点尤为重要。由于每个人都有自己的编码习惯，总有一天别人会不理解你的查询。总是试图标准化你的编码风格。</li><li id="027f" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">写得不好的查询更难扩展和改进。难以阅读和理解的查询在扩展时更容易失败。没有清晰数据源或结构的查询很难用新数据来改进和增强。</li><li id="4e81" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">你的坏习惯会蔓延开来，对你易受影响的队友产生不良影响，尤其是在你手下有低年级学生的时候。保持团队的风格和语法标准对于保持工作的有序性至关重要。</li></ol><p id="3a94" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">就像细微的改进可以提升您的查询一样，从长远来看，细微的坏习惯会降低代码的质量和清晰度。</p><p id="aac6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这就是为什么你应该停止做这五个常见的SQL坏习惯。</p><h1 id="8430" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">1.开始形成你的疑问</h1><p id="7326" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">缩进和空白对于给我们的查询提供结构是必要的。这是SQL的一个基本概念。我们来分解一下这个想法。</p><p id="bd81" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我将从一个完全极端的例子开始——为了说明这一点，编写这样的查询对我来说非常困难:(。</p><p id="e1ba" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">第一个查询不包含缩进或空格。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="1003" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">所以…只是让我知道，阅读上面的查询的体验如何？很有挑战性，是吧？我保证我曾经和一个完全的天才一起工作过，他编写了这样的SQL代码。</p><p id="571f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">很疯狂，对吧？所以现在，让我们添加一些缩进来增加趣味。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="2bae" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我很确定这个查询有缩进更容易阅读，对吗？我们快速一瞥就能明白。让我们添加一些额外的空白。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="e0fc" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在，它是完美的！我们可以理解查询中的不同层次，理解它并不需要太多的努力。</p><h1 id="679f" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">2.总是用大写字母写SQL语法</h1><p id="702a" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">有一种非书面的——甚至是书面的！SQL语法用大写字母书写的规律。</p><p id="36a9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们从一个基本的开始:对SQL关键字<a class="ae ku" href="https://www.w3schools.com/sql/sql_ref_keywords.asp" rel="noopener ugc nofollow" target="_blank">使用大写字母</a>，对表和列使用小写字母。我强烈建议也用大写字母写SQL函数<a class="ae ku" href="https://www.w3schools.com/sql/sql_ref_mysql.asp" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="6e82" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这意味着，任何不是表名或列名的内容都需要大写。这包括SQL关键字和SQL函数。</p><p id="0990" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们使用这个新逻辑重复前面的查询。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="e10c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">更好，对吧？现在，任何与数据字段世界相关的人都可以马上理解这个查询。</p><h1 id="c810" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">3.还在用SELECT * FROM？你应该现在就和它分手！</h1><p id="9333" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">另一个常见的坏习惯——老实说，我的罪恶快感——是使用神奇的<code class="fe ne nf ng nh b">*</code> SQL命令。我知道使用它是非常诱人的，而且每当我们进行快速查询来检查一些直觉时，它都非常有用。</p><p id="3d2e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然而，作为最佳实践，总是用一个能够改善响应时间的<code class="fe ne nf ng nh b">select </code>语句来检索必要的列。</p><p id="8ab5" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这意味着我们在编写查询的最终版本时都应该避免它，以避免错误。把所有的柱子都带在身边会让它们更容易失败。当我们失去对携带哪些列的控制时，很容易得到一些我们不想要的额外数据或得到一些重复的列，这可能会混淆我们的代码。</p><p id="118c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这就是为什么要避免这样做:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="9486" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">开始这样做更好:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="5d7d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">所以现在，我打赌你在想…当然，我仍然可以使用<code class="fe ne nf ng nh b">* EXCEPT()</code>来确保我留下了我不再需要的列。</p><p id="95c1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们可以做得更好。</p><p id="1079" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">也要避免使用<code class="fe ne nf ng nh b">EXCEPT</code>。它带来了与<code class="fe ne nf ng nh b">*</code>相同的问题，因为你不能确定哪些列被携带——你只需要确定你想留下的那些列。</p><h1 id="e443" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">4.停止使用过多的子查询。多使用CTE</h1><p id="56c7" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">您应该开始避免在每个时态表或CTE中使用多个子查询。让我们举一个例子来说明这个观点:</p><p id="2dfe" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在，假设我们有一个包含一家公司所有工资的表，这家公司在两个不同国家的四个城市经营。我们想比较整个公司、两个国家和所有四个城市的平均工资。我们如何做到这一点？</p><p id="8f11" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">首先，我们可以编写一个包含两个子查询的查询，计算所有三个平均工资。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="0272" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然而，这是完全错误的。我可能同意你的观点，这个例子是相当虚构的，但是，在同一个时态表中使用几个子查询总是有诱惑力的。</p><p id="c837" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这就是我们的<code class="fe ne nf ng nh b">WITH</code>命令和cte发挥关键作用的地方。当在时态表中分离子查询时，我们可以创建更直观的查询，并且可以重用。并在最终查询中选择所有期望的数据。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="3edc" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果你想进一步了解如何使用<code class="fe ne nf ng nh b">WITH</code>和时态表，你可以在我之前的故事中得到详细的解释:</p><div class="ni nj gp gr nk nl"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-structure-readable-and-reusable-sql-queries-623485ac4a36"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">如何构造可读和可重用的SQL查询</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">模块化的重要性</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">better编程. pub</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz ko nl"/></div></div></a></div><h1 id="a619" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">5.总是给你的每一列起一个有逻辑的名字</h1><p id="4dcb" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">当创建查询时，我们可以简单地继续使用数字来携带列。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="a643" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们不应该这样做，而应该根据我们对它们的期望来命名它们。这将使编辑查询变得容易，并在不丢失逻辑的情况下扩展我们的查询。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="8179" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">保持SQL查询的顺序和逻辑总是有益的。认识并自我纠正自己的SQL坏习惯可以帮助你成为一名更专业、更自信、更高效的SQL程序员。</p><h1 id="972a" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">结论</h1><p id="d6bd" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">SQL很棒。它是数据分析、数据科学和任何其他数据相关领域的基础之一，并且将一直存在。</p><p id="a989" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这就是为什么您应该在编码时注意保持良好的风格，并提高您的SQL技能。在本文中，我总结了编写SQL的最常见的最佳实践。</p><p id="37c5" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">希望这对提高你的SQL技能有所帮助！:)</p><p id="0dbe" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">数据总是有更好的主意——相信它。</p></div></div>    
</body>
</html>