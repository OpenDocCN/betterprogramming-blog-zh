<html>
<head>
<title>Increase Your Developer Confidence With a Great Django Test Suite</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用一个优秀的Django测试套件增强您的开发者信心</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/increase-your-developer-confidence-with-a-great-django-test-suite-e1d8e7df8c90?source=collection_archive---------10-----------------------#2020-10-05">https://betterprogramming.pub/increase-your-developer-confidence-with-a-great-django-test-suite-e1d8e7df8c90?source=collection_archive---------10-----------------------#2020-10-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4371" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何为您的Django应用程序编写测试，以促进您的团队并实际上是有用的</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/15047b2a84ce7afaff0b73e8bacc4130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*h56oW-ki0f_amBgm.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者的漫画。只是试管里的苏打水，但我不会拿那个烧杯冒险。</p></figure><p id="053c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你认为编写测试是一个蹩脚的复选框任务，那就大错特错了。如果做得正确，测试是应用程序最有价值的资产之一。</p><p id="158d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">特别是,<a class="ae lq" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>框架，为您的团队提供了基于Python标准库<code class="fe lr ls lt lu b">unittest</code>创建高效测试实践的机会。Django中正确的测试编写起来很快，运行起来也更快，并且可以为您提供一个无缝的持续集成解决方案，为您的开发应用把脉。</p><p id="f886" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过全面的测试，开发人员在推动变更时有了更高的信心。我在我自己的团队中亲眼看到，良好的测试可以提高开发速度，这是更好的开发人员体验的直接结果。</p><p id="e618" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我将分享我自己为Django应用程序构建有用测试的经验，从基础到最佳执行。如果您正在使用Django或在您的组织中使用它进行构建，您可能会喜欢阅读我在Victoria.dev 上的<a class="ae lq" href="https://victoria.dev/series/django/" rel="noopener ugc nofollow" target="_blank"> Django系列。</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6f6b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">测试什么</h1><p id="7f36" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">测试极其重要。测试不仅仅是让你知道一个功能是否工作，它还可以成为你的团队理解你的应用程序如何工作的基础。</p><p id="533e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里是主要目标:如果你撞了头，忘记了明天你的应用程序如何工作的一切，你应该能够通过阅读和运行你今天写的测试来重新获得你的大部分理解。</p><p id="c93b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当您决定测试什么时，询问以下问题可能会有所帮助:</p><ul class=""><li id="507a" class="na nb it kw b kx ky la lb ld nc lh nd ll ne lp nf ng nh ni bi translated">我们的客户应该能够做什么？</li><li id="985d" class="na nb it kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">我们的客户<em class="mz">不</em>应该能够做什么？</li><li id="b353" class="na nb it kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">这个方法、视图或逻辑流程应该实现什么？</li><li id="cd97" class="na nb it kw b kx nj la nk ld nl lh nm ll nn lp nf ng nh ni bi translated">这个特性应该何时、如何或在哪里执行？</li></ul><p id="fafa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对您的应用程序有意义的测试可以帮助建立开发人员的信心。有了这些明智的保护措施，开发人员可以更容易地进行改进，并有信心引入创新的解决方案来满足产品需求。其结果是，应用程序可以更快地组合在一起，功能也可以放心地经常发布。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi no"><img src="../Images/b82c51d3d2be0bf48d42b72e2625fb4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u2Y51WbiZ9CL8AI8xeeIGw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">由程序员作者和数学家创作的漫画——如果你不知道的话。</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="67b0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在哪里进行测试</h1><p id="f687" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">如果你只有几个测试，你可以像<a class="ae lq" href="https://docs.djangoproject.com/en/3.1/ref/django-admin/#startapp" rel="noopener ugc nofollow" target="_blank"> Django的默认应用模板</a>一样组织你的测试文件，把它们都放在一个名为<code class="fe lr ls lt lu b">tests.py</code>的文件中。这种简单的方法最适合小型应用程序。</p><p id="97b7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">随着应用程序的增长，您可能希望将测试分成不同的文件或测试模块。一种方法是使用一个目录来组织你的文件，比如<code class="fe lr ls lt lu b">projectroot/app/tests/</code>。该目录中每个测试文件的名称应该以<code class="fe lr ls lt lu b">test</code>开头(例如<code class="fe lr ls lt lu b">test_models.py</code>)。</p><p id="c261" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">除了恰当地命名，Django将使用基于<code class="fe lr ls lt lu b">unittest</code>模块的<a class="ae lq" href="https://docs.python.org/3/library/unittest.html#unittest-test-discovery" rel="noopener ugc nofollow" target="_blank">内置测试发现</a>来找到这些文件。应用程序中所有以<code class="fe lr ls lt lu b">test</code>开头的文件都将被收集到一个测试套件中。</p><p id="681c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这种方便的测试发现允许您将测试文件放在对您的应用程序有意义的任何地方。只要它们被正确命名，Django的测试工具就可以找到并运行它们。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2b25" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何记录测试</h1><p id="c0a0" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">使用<a class="ae lq" href="https://www.python.org/dev/peps/pep-0257/" rel="noopener ugc nofollow" target="_blank">文档字符串</a>解释测试旨在验证什么。例如:</p><pre class="kj kk kl km gt nt lu nu nv aw nw bi"><span id="cbe8" class="nx md it lu b gy ny nz l oa ob">def test_create_user(self):<br/>    """Creating a new user object should also create an associated profile object"""<br/>    <em class="mz"># ...</em></span></pre><p id="5772" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些docstrings帮助您快速理解测试应该做什么。除了导航代码库之外，这有助于在测试没有验证docstring所说的内容时变得明显。</p><p id="d203" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">测试运行时还会显示文档字符串，这对日志记录和调试很有帮助。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ed6f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">测试需要做什么</h1><p id="0cd9" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">Django测试可以使用在<code class="fe lr ls lt lu b"><a class="ae lq" href="https://docs.djangoproject.com/en/3.1/topics/testing/tools/#django.test.TestCase.setUpTestData" rel="noopener ugc nofollow" target="_blank">setUpTestData()</a></code> <a class="ae lq" href="https://docs.djangoproject.com/en/3.1/topics/testing/tools/#django.test.TestCase.setUpTestData" rel="noopener ugc nofollow" target="_blank">方法</a>中创建的数据快速设置。您可以使用各种方法来创建您的测试数据，比如利用外部文件或者甚至硬编码愚蠢的短语或者您的员工的名字。就个人而言，我更喜欢使用假数据生成库，比如<code class="fe lr ls lt lu b"><a class="ae lq" href="https://github.com/joke2k/faker/" rel="noopener ugc nofollow" target="_blank">faker</a></code>。</p><p id="7465" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">任意测试数据的正确设置可以帮助您确保您正在测试您的应用程序功能，而不是意外地测试测试数据。因为像<code class="fe lr ls lt lu b">faker</code>这样的生成器给你的输入增加了某种程度的不可预料性，所以它更能代表真实世界的使用。</p><p id="8b22" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是一个测试设置示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="8a66" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">测试通过或失败取决于断言方法的结果。可以使用<a class="ae lq" href="https://docs.python.org/3/library/unittest.html#assert-methods" rel="noopener ugc nofollow" target="_blank"> Python的</a> <code class="fe lr ls lt lu b"><a class="ae lq" href="https://docs.python.org/3/library/unittest.html#assert-methods" rel="noopener ugc nofollow" target="_blank">unittest</a></code> <a class="ae lq" href="https://docs.python.org/3/library/unittest.html#assert-methods" rel="noopener ugc nofollow" target="_blank">方法</a>和<a class="ae lq" href="https://docs.djangoproject.com/en/3.1/topics/testing/tools/#assertions" rel="noopener ugc nofollow" target="_blank"> Django的断言方法</a>。</p><p id="3964" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">关于编写测试的进一步指导，参见Django 中的<a class="ae lq" href="https://docs.djangoproject.com/en/3.1/topics/testing/" rel="noopener ugc nofollow" target="_blank">测试。</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8636" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">运行测试的最佳可能执行</h1><p id="e886" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">Django的测试套件是通过以下方式手动运行的:</p><pre class="kj kk kl km gt nt lu nu nv aw nw bi"><span id="9db0" class="nx md it lu b gy ny nz l oa ob">./manage.py test</span></pre><p id="fbe1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我很少这样运行我的Django测试。</p><p id="5b46" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最好的，或者最有效的测试实践是，你或者你的开发人员从来没有想过，“我需要首先运行测试。”Django几乎毫不费力的测试套件设置的美妙之处在于，它可以作为常规开发活动的一部分无缝运行。这可能是在预提交挂钩中，也可能是在持续集成或部署工作流中。</p><p id="0771" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我以前写过如何使用预提交挂钩来<a class="ae lq" href="https://victoria.dev/blog/technical-ergonomics-for-the-efficient-developer/" rel="noopener ugc nofollow" target="_blank">改善您的开发人员工效学</a>并节省您的团队一些脑力。Django的快速测试可以用这种方式运行，如果你能并行运行测试，它们会变得特别有效。</p><p id="215c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">作为CI/CD工作流的一部分运行的测试(例如，<a class="ae lq" href="https://victoria.dev/blog/django-project-best-practices-to-keep-your-developers-happy/#continuous-testing-with-github-actions" rel="noopener ugc nofollow" target="_blank">对带有GitHub操作</a>的pull请求)根本不需要您的开发人员定期努力去记住运行测试。我不知道我能说得多直白——这是一个显而易见的问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8d41" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">测试一个优秀的Django应用程序</h1><p id="3728" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">考试极其重要，却没有得到应有的重视。它们可以捕捉应用程序中的逻辑错误。他们可以帮助解释和验证你的产品的概念和功能实际上是如何运作的。最重要的是，测试可以提高开发人员的信心和开发速度。</p><p id="0424" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最好的测试是那些相关的，有助于解释和定义你的应用程序，并且不加思索地连续运行的测试。我希望我已经向您展示了Django中的测试是如何帮助您为您的团队实现这些目标的！</p><p id="873d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">更多关于Django和建立一个伟大的技术团队的信息，请访问<a class="ae lq" href="https://victoria.dev/" rel="noopener ugc nofollow" target="_blank"> victoria.dev </a>或<a class="ae lq" href="https://victoria.dev/index.xml" rel="noopener ugc nofollow" target="_blank">通过RSS </a>订阅。</p></div></div>    
</body>
</html>