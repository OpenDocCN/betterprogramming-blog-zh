<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://betterprogramming.pub/creating-a-custom-pipe-for-your-angular-app-64b419a93f2a?source=collection_archive---------6-----------------------#2019-07-23">https://betterprogramming.pub/creating-a-custom-pipe-for-your-angular-app-64b419a93f2a?source=collection_archive---------6-----------------------#2019-07-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="0e1c" class="ir is it bd iu iv iw dn ix iy iz dp ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">为Angular应用程序创建自定义管道</h2><h2 id="9aac" class="ir is it bd iu iv iw dn ix iy iz dp ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">利用弯管的力量</h2><p id="e4e5" class="pw-post-body-paragraph jo jp it jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki im bi translated">角形管对许多需求都非常有用。自从AngularJS的第一个版本发布以来，它们就一直可用，并且它们是格式化和操作数据表示的一种很好的方式。管道是简单的类型脚本类，实现一个特殊的角度接口，名为“PipeTransform”。它们很容易编码，可以用于许多其他用途。当<a class="ae kj" href="https://angular.io/api?type=pipe" rel="noopener ugc nofollow" target="_blank">有角度的内置管道</a>不够用的时候，你可以在几分钟内实现自己的自定义管道。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/a352f3e4c7b01d1b280a4ab8b0844e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PVzEV4fnMji3JF-MpPhduA.jpeg"/></div></div></figure><h2 id="3bb5" class="ir is it bd iu iv iw dn ix iy iz dp ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是角管，用来做什么？</h2><p id="c6a0" class="pw-post-body-paragraph jo jp it jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki im bi translated">基本上，一个有角的管道是一个我们可以用来接受输入并产生输出的物体。它反映了一个数学函数行为，因为你有一些东西进入路由，并以另一种形式退出，改变，包装或变异。角度管道必须与模板语法一起使用，因为应用它们的唯一方法是使用“|”(管道)符号。因此，任何时候我们想要使用插值{{ … }}格式化数据，我们都可以使用管道并应用带有“|”符号的管道。管道可以选择使用参数；在这种情况下，您传递带有冒号的参数，根据参数的数量可以是单个或多个。</p><p id="7380" class="pw-post-body-paragraph jo jp it jq b jr kw jt ju jv kx jx jy jb ky ka kb jf kz kd ke jj la kg kh ki im bi translated">定制管道可以看得更远，因为<em class="lb">你可以在其中实现几乎任何行为</em>。从Angular v.2开始，Google移除了<em class="lb">过滤器</em>管道，因为它在大多数情况下效率很低，但是从技术上来说，你仍然可以使用ngFor结构指令来实现管道过滤数组——只是使用时要自担风险。</p><h2 id="d780" class="ir is it bd iu iv iw dn ix iy iz dp ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">创建弯管</h2><p id="29d1" class="pw-post-body-paragraph jo jp it jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki im bi translated">有两种方法可以将管道类型脚本类添加到应用程序中:</p><ol class=""><li id="5125" class="lc ld it jq b jr kw jv kx jb le jf lf jj lg ki lh li lj lk bi translated"><strong class="jq ll">使用角度CLI。</strong>在项目根目录下运行:</li></ol><pre class="kl km kn ko gt lm ln lo lp aw lq bi"><span id="594d" class="ir is it ln b gy lr ls l lt lu">ng generate pipe pipes/MyCustomPipe</span><span id="42d3" class="ir is it ln b gy lv ls l lt lu">// or simply ng g pipe pipes/MyCustomPipe</span></pre><p id="3f38" class="pw-post-body-paragraph jo jp it jq b jr kw jt ju jv kx jx jy jb ky ka kb jf kz kd ke jj la kg kh ki im bi translated">该命令将在“pipes”文件夹中生成一个管道，其类名为MyCustomPipePipe(注意类名后面附加的“Pipe”一词，请始终避免在名称中使用终止“Pipe ”,因为Angular会为您这样做)。我更喜欢将管道存储在专用的文件夹中，对于服务和模型也是如此，以便保持项目结构的整洁。</p><p id="7bb1" class="pw-post-body-paragraph jo jp it jq b jr kw jt ju jv kx jx jy jb ky ka kb jf kz kd ke jj la kg kh ki im bi translated">2.<strong class="jq ll">手动</strong>，通过在你想要的任何地方创建一个类。请记住将管道添加到app.module.ts的声明数组中，因为CLI不会为您这样做。</p><p id="562a" class="pw-post-body-paragraph jo jp it jq b jr kw jt ju jv kx jx jy jb ky ka kb jf kz kd ke jj la kg kh ki im bi translated">无论如何，结果应该是这样的:</p><pre class="kl km kn ko gt lm ln lo lp aw lq bi"><span id="7ec6" class="ir is it ln b gy lr ls l lt lu">import { Pipe, PipeTransform } from ‘<a class="ae kj" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>’;</span><span id="5fd7" class="ir is it ln b gy lv ls l lt lu"><a class="ae kj" href="http://twitter.com/Pipe" rel="noopener ugc nofollow" target="_blank">@Pipe</a>({<br/> name: ‘myPipe’<br/>})<br/>export class MyPipe implements PipeTransform {</span><span id="77ba" class="ir is it ln b gy lv ls l lt lu">    transform(value: any, args?: any): any {<br/>        return null;<br/>    }</span><span id="af40" class="ir is it ln b gy lv ls l lt lu">}</span></pre><p id="f28d" class="pw-post-body-paragraph jo jp it jq b jr kw jt ju jv kx jx jy jb ky ka kb jf kz kd ke jj la kg kh ki im bi translated">如您所见，<em class="lb"> @Pipe </em>装饰器设置了管道的名称，这是在模板语法中用于激活该管道的名称。该类正在实现PipeTransform接口，该接口要求该类实现Transform()方法。该方法接受一个值(要处理的输入)和一些参数(用于设置管道行为的参数，如果有的话)。</p><p id="bd0a" class="pw-post-body-paragraph jo jp it jq b jr kw jt ju jv kx jx jy jb ky ka kb jf kz kd ke jj la kg kh ki im bi translated">管道参数是“任意”的，可以随意更改；如果管道在“用户”模型上工作，只需改变值类型。您甚至可以更改这些参数的名称，这使得Typescript非常灵活和适应性强。</p><p id="e062" class="pw-post-body-paragraph jo jp it jq b jr kw jt ju jv kx jx jy jb ky ka kb jf kz kd ke jj la kg kh ki im bi translated">那么，返回的值就是将传递给视图插值{{ … }}进行显示的内容。很好很容易。</p><pre class="kl km kn ko gt lm ln lo lp aw lq bi"><span id="7efc" class="ir is it ln b gy lr ls l lt lu">&lt;div&gt; {{ myData | myPipe }} &lt;/div&gt;</span></pre><h2 id="4028" class="ir is it bd iu iv iw dn ix iy iz dp ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">管道参数</h2><p id="f96e" class="pw-post-body-paragraph jo jp it jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki im bi translated">如果您的管道需要使用params，只需在视图中调用管道时传递一个或多个参数，如下所示:</p><pre class="kl km kn ko gt lm ln lo lp aw lq bi"><span id="2c3c" class="ir is it ln b gy lr ls l lt lu">&lt;div&gt; {{ myData | myPipe:firstArg:secondArg }} &lt;/div&gt;</span></pre><p id="4879" class="pw-post-body-paragraph jo jp it jq b jr kw jt ju jv kx jx jy jb ky ka kb jf kz kd ke jj la kg kh ki im bi translated">参数可以是数字、组件变量引用或普通字符串(显然，在本例中使用双引号)。为了在转换方法中使用参数，必须按位置访问args数组，所以用零索引访问第一个，用一个索引访问第二个，依此类推。</p><h2 id="0cba" class="ir is it bd iu iv iw dn ix iy iz dp ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">烟斗能产生标签吗？</h2><p id="76d2" class="pw-post-body-paragraph jo jp it jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki im bi translated">这可能是关于定制管道已知的唯一陷阱。一旦您的管道返回HTML标记，您就不能使用标准插值来显示它们。也就是说，插值是显示普通数据的一种有角度的方式——不是对象，也不是标签，而是<em class="lb">只是数据</em>。我经常使用管道来产生标签或将输入值包装在HTML标签之间，所以肯定有办法做到这一点。在这种情况下，您必须使用innerHTML属性绑定到父DOM元素，就像在jQuery中使用HTML()方法而不是text()方法一样:</p><pre class="kl km kn ko gt lm ln lo lp aw lq bi"><span id="2977" class="ir is it ln b gy lr ls l lt lu">&lt;div [innerHTML]="myData | myPipe"&gt;&lt;/div&gt;</span></pre><p id="c9e7" class="pw-post-body-paragraph jo jp it jq b jr kw jt ju jv kx jx jy jb ky ka kb jf kz kd ke jj la kg kh ki im bi translated">记住innerHTML想要显示数据，所以<strong class="jq ll">永远不要在值</strong>中使用花括号。通过管道显示标签是一种常见的实现，考虑这样的情况，如果用户被禁止，我们希望附加一个徽章:</p><pre class="kl km kn ko gt lm ln lo lp aw lq bi"><span id="bce4" class="ir is it ln b gy lr ls l lt lu">export class MyPipe implements PipeTransform {</span><span id="f00e" class="ir is it ln b gy lv ls l lt lu">   transform(username: string, user: User): any {<br/>       return <br/>          `${username} ` + <br/>          user.isBanned ? <br/>          `&lt;span class="badge badge-danger"&gt;BANNED&lt;/span&gt;` : <br/>          ``<br/>   }</span><span id="cfaa" class="ir is it ln b gy lv ls l lt lu">}</span></pre><h2 id="c47a" class="ir is it bd iu iv iw dn ix iy iz dp ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">负责任地编码管道，即使它们真的很容易编码</h2><p id="39ac" class="pw-post-body-paragraph jo jp it jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki im bi translated">即使管道看起来很容易编码，记住它们应该被<em class="lb">很好地</em>编码。当我们要将管道应用到模板语法时，我们不能确定管道是否真的能处理输入和我们传递给它的参数。由于视图中没有针对这类控件的编译器检查过程，因此很容易编写一个管道，该管道期望某个类型的输入或参数，然后接收另一个。</p><p id="4450" class="pw-post-body-paragraph jo jp it jq b jr kw jt ju jv kx jx jy jb ky ka kb jf kz kd ke jj la kg kh ki im bi translated">在将逻辑应用到输入之前，应该总是检查输入类型和参数类型，必要时抛出错误。</p><p id="66a5" class="pw-post-body-paragraph jo jp it jq b jr kw jt ju jv kx jx jy jb ky ka kb jf kz kd ke jj la kg kh ki im bi translated">我经历过许多设计糟糕的管道，因为它们太容易实现，只需要一堆代码行。但是如果你能花几分钟清理输入和参数，你肯定会写得更好。</p></div></div>    
</body>
</html>