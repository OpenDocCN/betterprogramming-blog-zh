<html>
<head>
<title>A Reusable and Simple HTTP Request Client With Swift 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift 5中一个可重用的简单HTTP请求客户端</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/make-simple-http-requests-on-swift-5-f2f07f57f172?source=collection_archive---------1-----------------------#2019-10-05">https://betterprogramming.pub/make-simple-http-requests-on-swift-5-f2f07f57f172?source=collection_archive---------1-----------------------#2019-10-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5b80" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">完全在Swift中创建自己的HTTP请求客户端，无需任何其他库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/faf9b9e9b5bb970313e445415052a3dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*awVL9ftfqyXO5q4YtaxJYA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安妮·斯普拉特在<a class="ae ky" href="https://unsplash.com/s/photos/coding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="1321" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将为我们的HTTP客户端创建一个<code class="fe lv lw lx ly b">struct</code>。</p><p id="701b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是等等，耶稣，用一个<code class="fe lv lw lx ly b">class</code>代替！嗯……对于这种方法，我们不需要所有那些只有类提供的特性，比如继承、身份、Objective-C互操作性。</p><p id="c49a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们想使它简单，也需要确保这个客户端不能被我们代码的另一部分改变。</p><p id="00cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个协议来管理所有的错误。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lz"><img src="../Images/bab6032a544f18f0d515b3201687bcdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F-NtZ1kwuHQaRjn5XbwtwQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">EasyRequest.swift</p></figure><p id="80d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么？正如我之前所说的，我们想让它变得简单，所以我的最终函数将只管理成功响应，所有的错误将通过一个委托来管理，然后您的<code class="fe lv lw lx ly b">View</code> / <code class="fe lv lw lx ly b">ViewController</code>将知道当错误发生时该做什么。(稍后我会再多解释一点，我保证。)</p><p id="a151" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们开始创建我们的客户端(姑且称之为<code class="fe lv lw lx ly b">EasyRequest</code>)并添加对<code class="fe lv lw lx ly b">Codable</code>模型的通用支持。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lz"><img src="../Images/25163b982f6be31dce8ac8ada1363f6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DM2i7MDVi6N4CGGRm73sQw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">EasyRequest.swift</p></figure><p id="241c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，我们将只创建一个函数，一个发出HTTP <code class="fe lv lw lx ly b">GET</code>请求的函数。如果您愿意，您可以使用这个示例并创建支持所有其他方法(<code class="fe lv lw lx ly b">POST</code>、<code class="fe lv lw lx ly b">PUT</code>、<code class="fe lv lw lx ly b">GET</code>)的函数，并添加诸如头和参数之类的东西。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ma"><img src="../Images/228f1de65f9d6af166e8b8bd6c1ae130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oveqd1z4MynPAbqv23woAw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">EasyRequest.swift</p></figure><p id="5129" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也许你熟悉那个函数里面的所有参数，除了一个，<code class="fe lv lw lx ly b">PATH</code>，这是什么？</p><p id="f96b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，我们想让它变得简单。因此，这个参数将帮助我们访问JSON响应中的嵌套对象。(我知道，没有人这么做，也许我疯了。)</p><p id="5a65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用<code class="fe lv lw lx ly b"><a class="ae ky" href="https://www.raywenderlich.com/3244963-urlsession-tutorial-getting-started" rel="noopener ugc nofollow" target="_blank">URLRequest</a></code> <a class="ae ky" href="https://www.raywenderlich.com/3244963-urlsession-tutorial-getting-started" rel="noopener ugc nofollow" target="_blank">、</a> <code class="fe lv lw lx ly b"><a class="ae ky" href="https://www.raywenderlich.com/3244963-urlsession-tutorial-getting-started" rel="noopener ugc nofollow" target="_blank">URLSessionDataTask</a></code> <a class="ae ky" href="https://www.raywenderlich.com/3244963-urlsession-tutorial-getting-started" rel="noopener ugc nofollow" target="_blank">和</a> <code class="fe lv lw lx ly b"><a class="ae ky" href="https://www.raywenderlich.com/3244963-urlsession-tutorial-getting-started" rel="noopener ugc nofollow" target="_blank">URLSession</a></code>来发出HTTP请求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/925e889bc47d220c547579775002dfa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RgSRbDMvyrSjmO1aBMbLqQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">EasyRequest.swift</p></figure><p id="4b64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们差不多完成了，现在我们需要解析JSON数据并返回期望的<code class="fe lv lw lx ly b">Codable</code>对象。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/c40be45f36a50901f7bdfcd3ff4154c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e3hGbYGxeQ9bjMFC70qj3Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">EasyRequest.swift</p></figure><p id="f652" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，让我们回到<code class="fe lv lw lx ly b">get</code>函数，添加一些额外的代码来使用<code class="fe lv lw lx ly b">parsedModel</code>函数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/a5cf7ab95acbed22ca89620e955745f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3QM1T9M2U2cQ__zYqarKg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">EasyRequest.swift</p></figure><p id="dd12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！现在你可以使用它了</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="34a1" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">错误</h1><p id="04a9" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">但是在此之前…还记得那个代表错误吗？那么，您需要扩展您的控制器/视图/演示器来管理这些错误。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/012e3b1321c925b052abd148cfab2eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U1WxD4ZUIr6YE57x55tILg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ViewController.swift</p></figure><p id="348b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了，你做到了！现在你有一个简单的方法来提出你的要求。</p><p id="d66a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以叫你的<code class="fe lv lw lx ly b">EasyRequest</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/f5486b68b1992712d79e008c5ed6bec9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4j6E2DYRqfAd1mAxP1b2BA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ViewController.swift</p></figure><p id="15ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里<a class="ae ky" href="https://github.com/nievesjesus/EasyRequest-Example" rel="noopener ugc nofollow" target="_blank">下载一个例子</a>。</p><p id="8d7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这些了…下次见。</p></div></div>    
</body>
</html>