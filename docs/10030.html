<html>
<head>
<title>How to Create a Looping Video Background in SwiftUI for iOS 15</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在iOS 15版SwiftUI中创建循环视频背景</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-a-looping-video-background-in-swiftui-3-0-b4844553880d?source=collection_archive---------5-----------------------#2021-11-16">https://betterprogramming.pub/how-to-create-a-looping-video-background-in-swiftui-3-0-b4844553880d?source=collection_archive---------5-----------------------#2021-11-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5457" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过UIViewRepresentable利用AVFoundation框架</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3b73ae01260c52df4119476af4fa1c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TKcSdTcyeaXZZQ94"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@jakobowens1?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">雅各布·欧文</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="0e03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在撰写本文时，还没有一种简单的方法可以将视频背景或视频播放器整合到SwiftUI中。幸运的是，在苹果提供的AVKit和AVFoundation的帮助下，我们仍然可以通过一点点麻烦来让它工作。</p><p id="dcd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成本文后，我们将实现以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/b748f14f65eff4f092a140259500573b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/1*OUZ5hXQBol2aBXHYzs3uJA.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安娜·施瓦茨在<a class="ae ky" href="http://pexels.com" rel="noopener ugc nofollow" target="_blank"> Pexels </a>上的视频</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="a400" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们深入教程！</p><p id="536b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先打开你当前的项目或创建一个新的项目。给你的项目取一个好听的名字，确保选择SwiftUI作为接口。此外，指定一个组织标识符，可以是您想要的任何东西，只要它以<code class="fe md me mf mg b">com.&lt;herecomesyourtext&gt;</code>开头。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/4522fd7bcdd931b0e6d9fe6414da00c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RvIduTDyZ7TeZZ3SgDUXpg.png"/></div></div></figure><p id="b96b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后创建新的或打开现有的Swift文件。在我们的例子中，我们将使用已经设置好的<code class="fe md me mf mg b">ContentView.swift</code>文件，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="def6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要导入<code class="fe md me mf mg b">AVKit</code>和<code class="fe md me mf mg b">AVFoundation</code>，因为我们将使用它们来设置和播放我们的视频。在<code class="fe md me mf mg b">import SwiftUI</code>标准下直接进口这些。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/636cc38eabf2047c4112b4ddafd985ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:378/format:webp/1*CP-wya1ZRqvL95dhqZ2R2w.png"/></div></figure><p id="225f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们有了这个装置。让我们创建类型为<code class="fe md me mf mg b">UIViewRepresentable</code>的<code class="fe md me mf mg b">PlayerView</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="1058" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将这段代码复制并粘贴到您的<code class="fe md me mf mg b">ContentView</code>结构之上。</p><p id="8202" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经配置了我们的<code class="fe md me mf mg b">PlayerView</code>，我们希望能够用我们的视频‘填充’这个视图，播放并循环播放它！</p><p id="7bae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的<code class="fe md me mf mg b">PlayerView</code>结构下创建类型<code class="fe md me mf mg b">UIView</code>的类<code class="fe md me mf mg b">LoopingPlayerUIView</code>。以下是完整的课程:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="303b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们找到并添加我们的视频和视频类型之前，让我们先将<code class="fe md me mf mg b">PlayerView</code>添加到<code class="fe md me mf mg b">ContentView</code>中！</p><p id="2145" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从<code class="fe md me mf mg b">ContentView</code>中移除<code class="fe md me mf mg b">Text(“Hello World”)</code>并添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="dc43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们添加了一个<code class="fe md me mf mg b">GeometryReader</code>,因为我们希望设备能够响应，并且能够填满整个屏幕。我们还为视频添加了覆盖和模糊，以便用户可以将视频与前景内容区分开来。</p><p id="6923" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，这里使用了修饰语<code class="fe md me mf mg b">.edgesIgnoreSafeArea(.all)</code>。如果我们不使用这个，在我们视频的所有边缘都会有一个安全区域。这可能是你想使用的效果，但对于本教程，我们希望我们的视频覆盖整个屏幕。不过，你可以随意摆弄<code class="fe md me mf mg b">PlayerView()</code>修改器。</p><p id="c53e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们只需要找到一个视频作为我们的背景。现在，我将使用<a class="ae ky" href="http://pexels.com" rel="noopener ugc nofollow" target="_blank">像素</a>并过滤纵向拍摄的视频。我发现了一个看起来很有趣的红酒杯视频——所以让我们在应用程序中使用它吧！</p><p id="fd16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下载视频并将其拖放到您的项目中。确保将视频添加到目标:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/e6860f26641a282cdcfd27f339a77902.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cXg3S8DG9JcygLWVSf9Y0w.png"/></div></div></figure><p id="f131" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记下视频名称和类型:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/b63e51298ed8d36276d53f365d05457c.png" data-original-src="https://miro.medium.com/v2/resize:fit:350/format:webp/1*mzqUCNJBYM1bDG3EHz-kDw.png"/></div></figure><p id="166f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到我们班，找到<code class="fe md me mf mg b">fileUrl</code>。将<code class="fe md me mf mg b">forResource</code>更改为您的视频名称，将<code class="fe md me mf mg b">withExtension</code>更改为您的视频扩展名。我们的情况是这样的:</p><pre class="kj kk kl km gt mn mg mo mp aw mq bi"><span id="f921" class="mr ms it mg b gy mt mu l mv mw"><strong class="mg iu">let</strong> fileUrl = Bundle.main.url(forResource: "demoVideo", withExtension: "mp4")!</span></pre><p id="50e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以预览我们的内容，它会播放我们的视频，并自动循环播放！</p><p id="5291" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果没有正确填充<code class="fe md me mf mg b">fileUrl</code>，预览可能会崩溃。如果发生这种情况，只需检查您的视频名称和扩展名是否填写正确。此外，检查扩展是否受Apple支持。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/b748f14f65eff4f092a140259500573b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/1*OUZ5hXQBol2aBXHYzs3uJA.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Tadaa！我们有一个循环视频背景！！</p></figure><p id="2703" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！我们做到了！最后，我们可以在一个<code class="fe md me mf mg b">ZStack</code>中添加播放器，并且能够在播放器前面显示内容，就像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="cc62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/9974ec871477d356533b8be32efa2eaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*phS7TeXoh2j5D_FPNGvrZA.png"/></div></figure><p id="e2ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜你！现在去用你新发现的知识创造一些令人敬畏的东西吧！</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="cc8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整的源代码和项目可以在这里找到:</p><div class="my mz gp gr na nb"><a href="https://github.com/infxmousrogue/VideoWallpaperApp" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">GitHub—infxmousrogue/video wallpaper app:swift ui 3.0的循环视频背景</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ks nb"/></div></div></a></div></div></div>    
</body>
</html>