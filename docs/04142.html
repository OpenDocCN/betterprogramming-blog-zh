<html>
<head>
<title>Job Scheduling in AWS Using DDB Streams</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于DDB流的AWS作业调度</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/job-scheduling-in-aws-using-ddb-streams-52252d4ba4fa?source=collection_archive---------12-----------------------#2020-03-25">https://betterprogramming.pub/job-scheduling-in-aws-using-ddb-streams-52252d4ba4fa?source=collection_archive---------12-----------------------#2020-03-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0bbb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">保持冷静，让AWS为您安排时间</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eac92293cf50a18f6bba4e1f68672d66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DCHDUXDO6B_wbUhv"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">柯蒂斯·麦克牛顿在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="59e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文是关于使用AWS服务来定期调度您的作业。需要这种类型的调度的一些用例包括及时向用户发送通知、检查任务的状态等。</p><p id="f5cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不同的AWS服务，如DynamoDB流、云观察事件和SQS，可以用来在AWS中实现作业调度。本文重点介绍如何使用<a class="ae ky" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/TTL.html" rel="noopener ugc nofollow" target="_blank"> DynamoDB TTL </a>和<a class="ae ky" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Streams.html" rel="noopener ugc nofollow" target="_blank">流</a>来调度作业。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="292c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">高级方法</strong></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/c29df7b3a897bf7da5ca9ac54b5e5c30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*Q-Gi1WofIiopDkIRNcPInA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用<a class="ae ky" href="https://www.draw.io/" rel="noopener ugc nofollow" target="_blank"> draw.io </a>制作的照片。</p></figure><ol class=""><li id="04a0" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu na nb nc nd bi translated">调度器将把要调度的项目放在DynamoDB中。该项将被存储，其TTL值等于它需要被执行的时间。</li><li id="1973" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">为DynamoDB启用DynamoDB流，以捕获所有数据修改事件并将其发送到executer lambda。</li><li id="ab5b" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">TTL过期后，DynamoDB将删除该项目，并使用DynamoDB流向executer lambda发送删除事件。</li><li id="f957" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">执行器可以对调度的项目执行动作。</li><li id="c76c" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">如果需要再次调度该项目，可以使用新的TTL值将其再次添加到DynamoDB中。</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a794" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用DynamoDB流和Executer Lambda处理错误</h1><p id="fdb0" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">DynamoDB流将重新发送记录，直到它们被lambda成功处理(即执行器lambda没有抛出异常)或者它们超过了事件源映射上配置的最大期限。在此之前，lambda不会执行流中的下一个事件。</p><p id="f333" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果出现由于错误而需要单独处理消息的情况，您可以使用<a class="ae ky" href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-dead-letter-queues.html" rel="noopener ugc nofollow" target="_blank">死信队列</a>(对于亚马逊SQS)来推送消息，并继续处理流中的剩余项目。</p><h2 id="8e11" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">该解决方案的优点</h2><ol class=""><li id="1390" class="mv mw it lb b lc nj lf nk li oa lm ob lq oc lu na nb nc nd bi translated">使用Dynamo TTL允许为调度间隔设置动态值。可以按项目配置调度间隔。</li><li id="2c8e" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">AWS自动调整流中碎片的数量，因此随着吞吐量的增加，碎片的数量也会相应增加。所以你只需要担心规模。</li></ol><h2 id="c1f3" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">这种解决方案的局限性</h2><ol class=""><li id="1b8a" class="mv mw it lb b lc nj lf nk li oa lm ob lq oc lu na nb nc nd bi translated">根据DynamoDB TTL的<a class="ae ky" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/howitworks-ttl.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>显示，TTL过期后，一个项目可能需要长达48小时才能实际删除。实际时间取决于工作量的性质和表的大小。DynamoDB流删除事件只有在项目被实际删除后才会被触发。因此，当调度间隔太慢时(如一分钟、五分钟等)，不推荐这种解决方案。)或者当事件调度间隔需要精确时。</li><li id="ba30" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">DynamoDB流将交付所有的数据修改事件(例如，插入、更新等。)到执行器lambda。执行器lambda必须过滤删除事件。</li><li id="d1ca" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">如果需要再次安排，将涉及再次插入项目的成本。插入中的任何失败都可能导致该物品的丢失。上述解决方案的概率可以通过配置重试来降低。</li><li id="9809" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">DynamoDB支持24小时的保持期。超过24小时的数据随时都可能被删除。因此，如果您的用例可能涉及这样的场景，那么DynamoDB Streams就不是正确的解决方案。</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3522" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="8b61" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">感谢阅读。我希望你喜欢这篇文章！</p></div></div>    
</body>
</html>