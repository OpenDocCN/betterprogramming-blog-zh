<html>
<head>
<title>Two Developer Tools for Documenting Android Codebases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于记录Android代码库的两个开发工具</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/two-developer-tools-for-documenting-android-codebases-3482bad3fb4c?source=collection_archive---------7-----------------------#2022-01-06">https://betterprogramming.pub/two-developer-tools-for-documenting-android-codebases-3482bad3fb4c?source=collection_archive---------7-----------------------#2022-01-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c29b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">记录一个Android项目很容易，是吗？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/95045c3f54369923b7ad1845e82ee47a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7woqLDOSjLLOFF4u"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="e3ac" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">为什么？</h1><p id="4d52" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">所以我维护我公司的代码库，这很有趣，但也很困难。这很难，因为在开始时，代码很小，你可以在短时间内学会它。后来，代码库变得如此庞大<em class="mk">(仍然是整体的，还不是模块化的)</em>并且跟踪所有这些代码并不容易。</p><p id="c08e" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">当然，我们开始模块化代码库，但这使得公司的新开发人员更难贡献和改进代码库，因为代码被分成模块，没有人知道这部分代码在哪里，当然除非模块化它的人。</p><p id="5932" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">由此，我一直认为记录一个项目是很重要的。为什么？因为它给我们之后的开发者留下了遗产。它邀请其他开发人员向它学习，当你试图参考你的旧代码时，它会有很大帮助。</p><blockquote class="mq"><p id="0f1c" class="mr ms iq bd mt mu mv mw mx my mz mj dk translated">“好的代码文档本身”</p></blockquote><p id="7326" class="pw-post-body-paragraph lo lp iq lq b lr na jr lt lu nb ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">开发人员在谈论文档时会引用这句话。但我仍然认为，即使有了深思熟虑的命名约定，也有很多事情不能单独放在命名中，比如上下文或推理为什么代码是这样的。所以不要羞于记录你的代码，相信我！它工作了。</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><h1 id="4afc" class="kw kx iq bd ky kz nm lb lc ld nn lf lg jw no jx li jz np ka lk kc nq kd lm ln bi translated">KDoc</h1><p id="854c" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果你紧跟潮流，你可能会使用Kotlin来开发Android应用程序。就像Java一样，也有一种记录Kotlin代码的语言，它叫做<a class="ae kv" href="https://kotlinlang.org/docs/kotlin-doc.html" rel="noopener ugc nofollow" target="_blank"> KDoc </a>。</p><p id="e9ca" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">下面是使用KDoc实现这一点的一个片段:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用KDoc的示例</p></figure><p id="7c8d" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">TL；DR，在注释中使用注释标签来解释你的部分代码。如果你已经熟悉<a class="ae kv" href="https://www.oracle.com/technical-resources/articles/java/javadoc-tool.html" rel="noopener ugc nofollow" target="_blank"> Javadoc </a>，编写KDoc是非常容易的……几乎没有什么不方便。</p><p id="c434" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">你可能想做的另一件事是通过创建一个markdown文件<em class="mk">(通常在你的模块的根目录下)</em>来记录包。看起来会像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用KDoc记录包</p></figure></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><h1 id="91d9" class="kw kx iq bd ky kz nm lb lc ld nn lf lg jw no jx li jz np ka lk kc nq kd lm ln bi translated">多卡</h1><p id="4377" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在用KDoc记录了所有代码之后，您可能就到此为止了，但是您还可以做更多的事情。那么什么是<a class="ae kv" href="https://kotlin.github.io/dokka/1.6.10/" rel="noopener ugc nofollow" target="_blank"> Dokka </a>？它基本上是一个文档引擎，可以将你的KDoc评论转换成可共享的格式，如网站或markdown文件。</p><p id="8f33" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">下面是Dokka的输出格式:</p><ul class=""><li id="5580" class="nt nu iq lq b lr ml lu mm lx nv mb nw mf nx mj ny nz oa ob bi translated">一个你可以在任何地方部署的静态网站</li><li id="b08f" class="nt nu iq lq b lr og lu oh lx oi mb oj mf ok mj ny nz oa ob bi translated"><code class="fe oc od oe of b">gfm</code>，Github风味降价</li><li id="f6cc" class="nt nu iq lq b lr og lu oh lx oi mb oj mf ok mj ny nz oa ob bi translated"><code class="fe oc od oe of b">jekyll</code>、杰基尔兼容降价</li><li id="775a" class="nt nu iq lq b lr og lu oh lx oi mb oj mf ok mj ny nz oa ob bi translated"><code class="fe oc od oe of b">javadoc</code>，看起来像Javadoc，把你的Kotlin代码转换成Java</li></ul><p id="7c28" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">Dokka有一个Gradle插件，你可以把它添加到你的Android项目中，更多信息请点击这里。</p><p id="482c" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">我已经尝试了所有的输出，但是我可以说<code class="fe oc od oe of b">html</code>是目前唯一值得使用的。最初，我很想使用<code class="fe oc od oe of b">gfm</code>，因为我的代码库文档使用<a class="ae kv" href="https://www.mkdocs.org/" rel="noopener ugc nofollow" target="_blank"> Mkdocs </a>将Markdown文件转换为静态网站并部署它。</p><p id="2361" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">比如初始配置、基础设施，以及代码文档之外的所有东西。通过在markdown中编写它，会更容易，因为这样我们就可以使用Dokka将格式化的KDoc作为Markdown嵌入到Mkdocs目录中。</p><p id="d3ea" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">之后，Mkdocs将把所有的markdown文件转换成一个网站，代码文档将具有相同的行为，看起来像文档的其余部分。</p><p id="1a0f" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">但是<code class="fe oc od oe of b">gfm</code>和<code class="fe oc od oe of b">jekyll</code>格式有bug我可以说不值得用。例如，下面是从Dokka生成的降价:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/703a750bcedee1d321c2606e0fc0c2d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qz0eEOgcYqGOIiLlRhXQiw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">模块文档</p></figure><p id="5eb0" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">你看到问题了吗？让我们来看看:</p><ul class=""><li id="06b3" class="nt nu iq lq b lr ml lu mm lx nv mb nw mf nx mj ny nz oa ob bi translated">该表没有名为Summary的第二列</li><li id="5043" class="nt nu iq lq b lr og lu oh lx oi mb oj mf ok mj ny nz oa ob bi translated">每个模块的链接指的是HTML文件，而不是MD文件</li></ul><p id="93d4" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">你可能会说，嗯，只有两个，对吧？对吗？？嗯，还有一个:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/85c31259758fef5f868ba7a2a49e71c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QcXv47vzfpLNdJy-e4XRDw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">演示模块文档</p></figure><p id="cdaf" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">同样的错误仍然出现在其他文件中，重新格式化所有文件是如此麻烦，需要大量的工作来自动化。</p><p id="f9d5" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">此外，还有一些Dokka特性在<code class="fe oc od oe of b">gfm</code>格式中不支持，比如:</p><ul class=""><li id="d2a3" class="nt nu iq lq b lr ml lu mm lx nv mb nw mf nx mj ny nz oa ob bi translated"><strong class="lq ir"> Source link </strong>，它可以将您的文档链接到存储库中的文件。仅支持<code class="fe oc od oe of b">html</code>格式。</li><li id="1711" class="nt nu iq lq b lr og lu oh lx oi mb oj mf ok mj ny nz oa ob bi translated"><strong class="lq ir">代码高亮</strong>，在<code class="fe oc od oe of b">gfm</code>格式中没有Kotlin高亮。但是它支持<code class="fe oc od oe of b">html</code>格式。</li></ul><p id="7e37" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">有一些开发者说<a class="ae kv" href="https://github.com/Kotlin/dokka/pull/1967" rel="noopener ugc nofollow" target="_blank">为更好的<code class="fe oc od oe of b">gfm</code>格式贡献了</a>，但是我猜他们现在主要关注的是<code class="fe oc od oe of b">html</code>格式。</p><p id="4e77" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">不要误解我，他们生成的HTML文件实际上很好，这就是为什么我用它作为我的代码库。最后，代码文档看起来像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/8aad68e13ea5cc01ba49abc472a5e4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nYZ4AnT0WFtqK_S_u_Ht9g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码库文档中的示例类</p></figure></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><h1 id="1c78" class="kw kx iq bd ky kz nm lb lc ld nn lf lg jw no jx li jz np ka lk kc nq kd lm ln bi translated">技巧</h1><p id="e283" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果你对使用Dokka感兴趣，我给你一些建议:</p><h2 id="10a9" class="oo kx iq bd ky op oq dn lc or os dp lg lx ot ou li mb ov ow lk mf ox oy lm oz bi translated"><code class="fe oc od oe of b">DokkaTaskPartial</code>和<code class="fe oc od oe of b">DokkaMultiModuleTask</code></h2><p id="75f4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果您的项目是多模块项目，在配置您的任务时，尝试使用<code class="fe oc od oe of b">DokkaTaskPartial</code>和<code class="fe oc od oe of b">DokkaMultiModuleTask</code>。像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Dokka任务的配置</p></figure><p id="2278" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">它帮助你不用<strong class="lq ir"> </strong>为每种输出格式定义配置，因为它自动为所有格式工作。</p><h2 id="fe8f" class="oo kx iq bd ky op oq dn lc or os dp lg lx ot ou li mb ov ow lk mf ox oy lm oz bi translated">覆盖版权和图标</h2><p id="4649" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当使用<code class="fe oc od oe of b">html</code>格式时，你可能会改变网站底部的版权和图标。首先，将<code class="fe oc od oe of b">dokka-base</code>插件添加到您的Android项目中，并在您的<code class="fe oc od oe of b">build.gradle.kts</code>模块中配置<code class="fe oc od oe of b">pluginConfiguration</code>，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">覆盖Dokka中的配置</p></figure><blockquote class="pa pb pc"><p id="1499" class="lo lp mk lq b lr ml jr lt lu mm ju lw pd mn lz ma pe mo md me pf mp mh mi mj ij bi translated">确保使用与Dokka自动生成的资产文件相同的名称命名<code class="fe oc od oe of b">customAssets</code>文件。</p></blockquote></div></div>    
</body>
</html>