<html>
<head>
<title>Swift: 5 Transforming Combine Operators You Should Know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift:你应该知道的5个转换组合运算符</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/5-transforming-combine-operators-you-should-know-4603fe112d74?source=collection_archive---------7-----------------------#2020-06-24">https://betterprogramming.pub/5-transforming-combine-operators-you-should-know-4603fe112d74?source=collection_archive---------7-----------------------#2020-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1115" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用清晰的例子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a0805e836123738a5d298935c739be59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5JT6c_hOxMpkluk5"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@rupixen?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">rupixen.com</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="deff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将探索五个伟大的<a class="ae ky" href="https://developer.apple.com/documentation/combine" rel="noopener ugc nofollow" target="_blank">组合</a>转换操作符，它们可以轻松地将数据转换成不同的格式。</p><p id="8abe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将通过在Xcode操场上创建示例函数并运行它们来观察结果。</p><p id="1d45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">源代码可以在文章的底部找到。</p><p id="3dd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c8cd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.地图</h1><p id="4d32" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe mz na nb nc b">.map</code>操作符允许我们在闭包中转换来自发布者的所有元素。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5361" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是这段代码的作用:</p><ul class=""><li id="2cd7" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">我们创建一个接受<code class="fe mz na nb nc b">Int</code>价值观的<code class="fe mz na nb nc b">PassthroughSubject</code>。</li><li id="8c8f" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">我们使用<code class="fe mz na nb nc b">.map</code>运算符将每个接收到的<code class="fe mz na nb nc b">Int</code>值转换为<code class="fe mz na nb nc b">String</code>。</li><li id="d284" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">然后我们订阅发布者并打印转换后的元素的值和类型。</li><li id="2281" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">我们向受试者发送随机数，以观察以下结果:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/8b52e8fdbbd9169ab3108682ecde1f14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UjbhhTFkT4GoW4TDFA3PWQ.png"/></div></div></figure><p id="0a62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也有一种简单的方法来使用对象的键路径获得对象的属性:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="3f53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如我们所见，使用<code class="fe mz na nb nc b">.map(\.country)</code>，我们访问了<code class="fe mz na nb nc b">CarBrand</code>的国家属性。然后我们简单地打印每个国家:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi gj"><img src="../Images/58764e331cf8382370d5c4fc13ed5fda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fpTLz8sfllIC2OGqO6Syyw.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8606" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.收集</h1><p id="4a59" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe mz na nb nc b">.collect</code>操作符使得收集<em class="nu"> </em>所有接收到的元素并发出包含所有元素的单个数组变得容易:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="8d5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们得到了我们想要的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/47bd16ad9cbc2516050fa1accace594c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FptSK3YbRa0tIrOfDIb6UQ.png"/></div></div></figure><p id="e56e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:发布者必须发出一个<code class="fe mz na nb nc b">.completed</code>事件来实现这一点，因为<code class="fe mz na nb nc b">.collect</code>是一个贪婪的操作符，它会一直等到所有的元素都被发出并且发布者完成。</p><p id="19ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果我们正在使用一个<code class="fe mz na nb nc b">PassthroughSubject</code>，我们将需要在发送所有元素之后发送一个<code class="fe mz na nb nc b">.finished</code>事件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eb75" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.平面地图</h1><p id="f5f4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe mz na nb nc b">.flatMap</code>操作符允许我们将一个给定的发布者转换成另一个发布者。看看我们如何将观察从一个<code class="fe mz na nb nc b">Network</code>改变到它的<code class="fe mz na nb nc b">isAvailable</code>主题:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="12d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果，当我们改变它的值时，我们打印出了<code class="fe mz na nb nc b">isAvailable</code>的值。首先，它打印初始值(我们使用的是<code class="fe mz na nb nc b">CurrentValueSubject</code>)。然后，一旦我们给它分配了一个新值，就会发生以下情况:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/e37c2af98a417b335e2fe8f551138c7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1G2fHaOJLv3uHYdYuJkM3w.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9e09" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.replaceNil</h1><p id="f3bb" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">顾名思义，<code class="fe mz na nb nc b">.replaceNil</code>操作符将每个收到的<code class="fe mz na nb nc b">nil</code>元素转换成我们指定的元素:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="620d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们也可以将几个运算符组合在一起以获得必要的结果。首先，我们用0替换每个<code class="fe mz na nb nc b">nil</code>值，然后我们强制展开值，最后，我们将所有值收集到一个数组中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/582dc63405ecb90cb5b6ea3f749c0597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o-knLVeWaQcVH8j5MSqxJw.png"/></div></div></figure><p id="d160" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意我们如何在<code class="fe mz na nb nc b">.map</code>操作符中使用强制展开。不喜欢强制解包怎么办？为此，我们有一个<code class="fe mz na nb nc b">.map</code> : <code class="fe mz na nb nc b">.compactMap</code>的共变。当我们使用它时，它只自动转发那些不为零的元素:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="82d8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">5.扫描</h1><p id="9ae7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe mz na nb nc b">.scan</code>操作符在一个闭包中公开当前发出的值以及最新的值。我们可以用它来累加值并打印总结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c008" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们执行以下操作:</p><ul class=""><li id="60a4" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">创建收益数组(下划线是分隔数字中千位部分的好方法)。</li><li id="ec86" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">创建一个这些收入的出版商。</li><li id="224e" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">使用<code class="fe mz na nb nc b">.scan</code>操作符，将当前发出的值($0)加到最新的值($1)，从零开始。</li></ul><p id="1d13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们计算总收益:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/55995c13be4e4bb0052473f7b00844fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*92NgcQV26fICmvlN0CR0tQ.png"/></div></div></figure><h1 id="6f99" class="mc md it bd me mf ny mh mi mj nz ml mm jz oa ka mo kc ob kd mq kf oc kg ms mt bi translated">资源</h1><p id="8f0a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Xcode游乐场的源代码可以在<a class="ae ky" href="https://gist.github.com/zafarivaev/75db5ff7b6550f22e671d2be1670980a" rel="noopener ugc nofollow" target="_blank">概要</a>中找到。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ed3d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">包扎</h1><p id="ba51" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">想了解更多关于联合收割机的信息吗？查看我的其他相关文章:</p><div class="od oe gp gr of og"><a href="https://medium.com/better-programming/how-to-create-your-own-combine-subscriber-in-swift-5-702b3f9c68c4" rel="noopener follow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">如何在Swift 5中创建自己的联合收割机订户</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">将逻辑封装在单独的类中</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">medium.com</p></div></div><div class="op l"><div class="oq l or os ot op ou ks og"/></div></div></a></div><div class="od oe gp gr of og"><a href="https://levelup.gitconnected.com/9-filtering-combine-operators-you-should-know-9c1ef2911352" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">你应该知道的9个过滤组合运算符</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">用清晰的例子</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="op l"><div class="ov l or os ot op ou ks og"/></div></div></a></div><div class="od oe gp gr of og"><a href="https://medium.com/better-programming/replace-delegation-with-combine-in-swift-5-e4c193655e7b" rel="noopener follow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">在Swift 5中将委托替换为组合</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">摆脱这种冗长的协议一致性</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">medium.com</p></div></div><div class="op l"><div class="ow l or os ot op ou ks og"/></div></div></a></div><p id="4988" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>