<html>
<head>
<title>Advanced Android Programming in Kotlin (Part 4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kotlin中的高级Android编程(第4部分)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/advanced-android-programing-in-kotlin-part-4-187b88fea048?source=collection_archive---------11-----------------------#2020-03-10">https://betterprogramming.pub/advanced-android-programing-in-kotlin-part-4-187b88fea048?source=collection_archive---------11-----------------------#2020-03-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="16b9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解在Kotlin代码中应该避免什么</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/49feaa131b88068a1a3104fe7661de1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*v4LXaVKgUORTM_BP565Q8g.jpeg"/></div></figure><p id="bf0b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">与Java不同，我们需要编写所有内容，Kotlin编译器可以理解代码，并在幕后编写样板代码。例如，它可以推断变量声明中的类型。这提高了生产率并节省了时间。</p><p id="bb00" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果你在网上搜索，你会发现Kotlin解决Java的许多棘手问题的许多方法，以及Kotlin的特性如何使开发更有趣。</p><h2 id="8881" class="lm ln it bd lo lp lq dn lr ls lt dp lu kz lv lw lx ld ly lz ma lh mb mc md me bi translated">从文章中摘录</h2><p id="fce6" class="pw-post-body-paragraph kq kr it ks b kt mf ju kv kw mg jx ky kz mh lb lc ld mi lf lg lh mj lj lk ll im bi translated">有了Kotlin很酷的特性和性感的语法，很容易在这个过程中迷失方向，并以一种他们不打算使用的方式更拼命地使用它们(这可能不是一个错误，但肯定不会是理想的代码)。从长远来看，这可能会给你的团队带来严重的问题。因此在本文中，您将学习如何以更好的方式使用Kotlin独有的特性。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="222e" class="mr ln it bd lo ms mt mu lr mv mw mx lu jz my ka lx kc mz kd ma kf na kg md nb bi translated">类型</h1><p id="6b07" class="pw-post-body-paragraph kq kr it ks b kt mf ju kv kw mg jx ky kz mh lb lc ld mi lf lg lh mj lj lk ll im bi translated">先从<code class="fe nc nd ne nf b">val</code>和<code class="fe nc nd ne nf b">var</code>这样的基础东西说起吧。如果您以前是Java开发人员，您可能会觉得使用<code class="fe nc nd ne nf b">val</code>和<code class="fe nc nd ne nf b">var</code>比一直提到数据类型更好。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/173c4e9a29d5314ce5fcf2404b9d5792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fExxh4-hM06h0SRwwtvxiw.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">在Kotlin中声明数组列表</p></figure><p id="99ef" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果能看到变量<code class="fe nc nd ne nf b">listOfTvShows</code>的类型不是更好吗？我们可以通过在Android Studio中启用提示来做到这一点。</p><p id="c772" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如下导航:设置&gt;编辑器&gt;通用&gt;外观—您需要选中“显示参数名称提示”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi np"><img src="../Images/5188e1342440e4e1ce8f58dd8fcf29ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EvP3tFzYQZpQrZnCdFJ2WQ.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">在Android Studio中启用提示选项</p></figure><p id="e088" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">之后，您将看到没有用数据类型声明的变量的提示。启用提示选项后，看一下<code class="fe nc nd ne nf b">listOfTvShows </code>变量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nq"><img src="../Images/0d287c8408d119d36ceaf2e2d0a73e7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fxm61lrPNH2WePKT6t1cjw.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">在Kotlin中声明数组列表(带提示)</p></figure><p id="362a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这在很多情况下都很有用。但是如果你的团队中有人在列表中添加了一个整数呢？看一看。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nr"><img src="../Images/af07a03acb715d70e75c459b956b3033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-AHYWMUSeCpwtpk1DoLNqg.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">在Kotlin中声明数组列表(带提示)</p></figure><p id="87fc" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在它不会显示任何错误，但是它会将列表的类型从<code class="fe nc nd ne nf b">String </code>更改为<code class="fe nc nd ne nf b">Any</code>，并且您对它没有任何控制。所以只对简单的声明使用不带数据类型的<code class="fe nc nd ne nf b">val</code>和<code class="fe nc nd ne nf b">var</code>，但是当遇到这种情况时，最好花点时间提及数据类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ns"><img src="../Images/626aca7d686e81a4ef312296b920efed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B008rUcXXnELowlO11yoxw.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">基于上下文声明带有和不带有数据类型的变量</p></figure><p id="50cf" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Kotlin还提供了带有lambdas的函数，您可以编写函数体并返回结果，而不用提及返回类型是什么。看一看。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nt"><img src="../Images/adb23a4743d843633b00103c51b2f5d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wf5_R0JCCpomkB58WcJMug.png"/></div></div></figure><p id="4733" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这很好，但是对于复杂的函数来说却不是这样；你必须检查上下文，选择合适的格式来使用。这些类型的Kotlin特性旨在简化您的开发，而不是从长远来看操纵我们。</p><p id="12ec" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">请记住，代码应该不言自明，所以我建议您花点时间明确指定类型。有时候这个工具不会给你提示——比如在公关审查中。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="a9cb" class="mr ln it bd lo ms mt mu lr mv mw mx lu jz my ka lx kc mz kd ma kf na kg md nb bi translated">“它很棒，但重命名‘它’会很棒</h1><p id="137b" class="pw-post-body-paragraph kq kr it ks b kt mf ju kv kw mg jx ky kz mh lb lc ld mi lf lg lh mj lj lk ll im bi translated">功能在科特林是一等公民；你可以用一个函数作为参数，用它作为一个高阶函数来携带一组代码，并在其他地方执行它们，你可以返回值，以及一百个其他的东西。</p><p id="0643" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了在这个处理函数的世界里给你一点帮助，创建者想通过提供参数<code class="fe nc nd ne nf b">it</code>来简化单参数lambda函数，这样你就不需要明确地提到它。看一看。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nu"><img src="../Images/82e5467520a544951440bd62b2f8e90d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7sls8FxkAxOT0bHLtxkrzA.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">以“it”为参数的Kotlin lambda函数</p></figure><p id="aec8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这是一个很好的功能，我推荐使用它。但是你应该记住它不会总是有帮助的。看看下面的代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nv"><img src="../Images/565f481a3534b1f4c20337be405fc0a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7XnfrDWyzruXX4kVNrXFg.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">嵌套“it”示例</p></figure><p id="40eb" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在这段代码中，<code class="fe nc nd ne nf b">let</code>、<code class="fe nc nd ne nf b">it</code>是一个<code class="fe nc nd ne nf b">ArrayList</code>，但是在<code class="fe nc nd ne nf b">for </code>循环中，它是一个<code class="fe nc nd ne nf b">String</code>。有点混乱，对吧？现在，让我们看看没有提示的相同代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/e860b9cfc0f5550459d611e815a5ed1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*Inwp57fPqp63p4I0iqFn4Q.png"/></div><p class="nl nm gj gh gi nn no bd b be z dk translated">没有提示的嵌套“it”示例</p></figure><p id="808d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">太疯狂了，对吧？没有可读性。当你对过多使用Kotlin感到绝望时，就会发生这种情况。</p><p id="9081" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">可维护性和可读性是代码的两个主要方面，所以要注意它们。为了即兴创作代码，我们必须用一个合适的名字重命名<code class="fe nc nd ne nf b">it</code>。看一看。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nx"><img src="../Images/066659a3f73b70808c4d52884aa93f57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DGSLGfuAwTxXXfSuyBb-MA.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">重命名参数后的Kotlin lambda函数</p></figure><p id="58fc" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">同样，您不需要在<code class="fe nc nd ne nf b">forEach</code>循环中重命名<code class="fe nc nd ne nf b">it</code>，但这是您的选择。不要被太多的清晰或杂乱所困扰。这种类型的编码将帮助你的团队成员更快地理解上下文。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="73e4" class="mr ln it bd lo ms mt mu lr mv mw mx lu jz my ka lx kc mz kd ma kf na kg md nb bi translated">范围函数</h1><p id="3189" class="pw-post-body-paragraph kq kr it ks b kt mf ju kv kw mg jx ky kz mh lb lc ld mi lf lg lh mj lj lk ll im bi translated">Kotlin中的作用域函数是另一个超级性感的特性——您可以使用它们让您的代码看起来像函数式编程。它们在类似于空检查的<code class="fe nc nd ne nf b">let</code>、<code class="fe nc nd ne nf b">viewholders</code>等情况下也很方便。我不打算讨论最有争议的话题——在哪里使用特定的范围函数；相反，我想谈谈如何不使用它们。</p><p id="20e2" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">让我们来看一段代码，在这段代码中，我们没有使用任何Kotlin特性。看一看。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="60f3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这很好——也许就像几年前我们在Java中做的那样，用所有重复的代码和东西。让我们用我们科特林的天性来活跃气氛。看一看。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="325d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">编写这种类型的代码背后总是有一个好的意图，比如确定事情的范围和最小化样板代码。但是嵌套scope函数不是Kotlin风格的准则之一。即使在我的企业级编码中，我也编写嵌套作用域，因为我希望编写Kotlin风格的代码。</p><p id="b9c1" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">然而，我们需要极度控制使用范围函数的冲动。看看这段重写的代码，它具有简单的Kotlin特性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="44b4" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这可能不是最简洁的代码，但在我看来，这是目前最好的不嵌套任何作用域函数的方法。用Kotlin写代码并不意味着你必须一直使用Kotlin的特性。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="2d9c" class="mr ln it bd lo ms mt mu lr mv mw mx lu jz my ka lx kc mz kd ma kf na kg md nb bi translated">扩展功能很棒，但是不要过度扩展</h1><p id="de04" class="pw-post-body-paragraph kq kr it ks b kt mf ju kv kw mg jx ky kz mh lb lc ld mi lf lg lh mj lj lk ll im bi translated">当我第一次在演示中听说Kotlin中的扩展函数时，它非常棒；就好像我在一个神奇的地方，在那里我可以在我正在做的任何东西上写我自己风格的代码。但是我错了——让我们看看为什么。</p><blockquote class="oa ob oc"><p id="7553" class="kq kr od ks b kt ku ju kv kw kx jx ky oe la lb lc of le lf lg og li lj lk ll im bi translated">Kotlin提供了用新功能扩展类的能力，而不必从类继承或使用设计模式。这些函数可以像原始类的方法一样以通常的方式调用。这种机制叫做<em class="it">扩展函数。”<br/>——</em>科特林的创造者</p></blockquote><p id="735a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">事实证明，扩展函数并不意味着使您的语法变得有趣(并不意味着这样做是错误的)，但主要目的是在一个类上实现额外的功能，从而在不创建新类的情况下实现特性。</p><p id="4615" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在编写更简洁的代码的意义上，很容易赶上扩展函数；我也做这个。有时候我在把远程模型转换成本地数据库模型的过程中，把所有的功能都做成了扩展功能，一时没有实现。</p><p id="7f59" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">不知何故，我在KotlinConf 2019上看到了Huyen Tue Dao的一个演讲，我在本文结尾提到了这个演讲。她向我展示了我对有效使用扩展的痴迷程度。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="65c3" class="mr ln it bd lo ms mt mu lr mv mw mx lu jz my ka lx kc mz kd ma kf na kg md nb bi translated">更新</h1><p id="2891" class="pw-post-body-paragraph kq kr it ks b kt mf ju kv kw mg jx ky kz mh lb lc ld mi lf lg lh mj lj lk ll im bi translated">要了解更多关于Kotlin的内容，请阅读Kotlin高级编程系列中的其他文章:</p><ul class=""><li id="934e" class="oh oi it ks b kt ku kw kx kz oj ld ok lh ol ll om on oo op bi translated"><a class="ae oq" href="https://medium.com/better-programming/advanced-android-programming-with-kotlin-5e40b1be22bb" rel="noopener">“用科特林</a>进行高级编程”</li><li id="3dd9" class="oh oi it ks b kt or kw os kz ot ld ou lh ov ll om on oo op bi translated"><a class="ae oq" href="https://medium.com/android-dev-hacks/advanced-android-programming-with-kotlin-part-2-aae2a15258b0" rel="noopener">“kot Lin高级编程—第二部分</a>”</li><li id="6560" class="oh oi it ks b kt or kw os kz ot ld ou lh ov ll om on oo op bi translated"><a class="ae oq" href="https://medium.com/better-programming/advanced-programming-in-kotlin-2e01fbc39134" rel="noopener">“使用Kotlin进行高级编程—第3部分</a>”</li><li id="e6e6" class="oh oi it ks b kt or kw os kz ot ld ou lh ov ll om on oo op bi translated"><a class="ae oq" href="https://medium.com/better-programming/advanced-programming-in-kotlin-part-5-b674ce9e692f" rel="noopener">“使用Kotlin进行高级编程—第5部分”</a></li></ul><p id="457e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">要了解更多关于Kotlin协同例程和Kotlin的其他高级特性，请阅读以下文章:</p><ul class=""><li id="e4c8" class="oh oi it ks b kt ku kw kx kz oj ld ok lh ol ll om on oo op bi translated"><a class="ae oq" href="https://medium.com/better-programming/kotlin-coroutines-from-basics-to-advanced-ad3eb1421006" rel="noopener">科特林协程，从基础到高级</a></li><li id="14d3" class="oh oi it ks b kt or kw os kz ot ld ou lh ov ll om on oo op bi translated"><a class="ae oq" href="https://medium.com/@sgkantamani/sealed-classes-in-kotlin-e48e072daca8" rel="noopener">科特林的密封班</a></li><li id="faa2" class="oh oi it ks b kt or kw os kz ot ld ou lh ov ll om on oo op bi translated"><a class="ae oq" href="https://medium.com/better-programming/asynchronous-data-loading-with-new-kotlin-flow-233f85ae1d8b" rel="noopener">新Kotlin流的异步数据加载</a></li></ul></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="4aba" class="mr ln it bd lo ms mt mu lr mv mw mx lu jz my ka lx kc mz kd ma kf na kg md nb bi translated">结论</h1><p id="7bbc" class="pw-post-body-paragraph kq kr it ks b kt mf ju kv kw mg jx ky kz mh lb lc ld mi lf lg lh mj lj lk ll im bi translated">在我们结束之前，我要感谢呼延屠刀。我从她在KotlinConfig 2019上的演讲中学到了我在这里提到的许多概念。<strong class="ks iu"> </strong>如果你有兴趣，看看吧:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow nz l"/></div></figure><p id="aec3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>