<html>
<head>
<title>Wi-Fi Trilateration Using Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js的Wi-Fi三边测量</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/wi-fi-trilateration-using-node-js-74996a3f3d1?source=collection_archive---------8-----------------------#2020-03-31">https://betterprogramming.pub/wi-fi-trilateration-using-node-js-74996a3f3d1?source=collection_archive---------8-----------------------#2020-03-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a90c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">它不同于三角测量</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7b2a0faca6a0f7a1571d936aa473950a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DMj6OdBPpz7psF22FIhpgQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">美国宇航局在<a class="ae ky" href="https://unsplash.com/s/photos/satellite?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的<a class="ae ky" href="https://unsplash.com/@nasa?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">照片</a></p></figure><p id="ecdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Wi-Fi <strong class="lb iu">三边测量</strong>(也称为多边测量)是一种技术，用于根据与可用Wi-Fi接入点位置的相对<strong class="lb iu">距离</strong> <em class="lv"> </em>来估计客户设备的位置。这与Wi-Fi <strong class="lb iu">三角测量</strong>形成对比，后者根据接入点天线接收到的信号的<strong class="lb iu">角度</strong> <em class="lv"> </em>来确定定位。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/29cdef410533408f391d78d517883adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tANPd0b9M7SZjpNI9y4O-Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://gisgeography.com/trilateration-triangulation-gps/" rel="noopener ugc nofollow" target="_blank"> GISGeography </a>的GPS三边测量图像</p></figure><p id="c0d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上图中，你可以看到三颗具有一定半径的GPS卫星。假设你的位置在这三颗卫星的范围内。根据这三个接入点的位置和半径，您的潜在位置可以使用三边测量法通过找到它们的交点来确定。</p><p id="06ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于Wi-Fi三边测量，您可以将这些卫星想象为无线接入点，并且您能够到达所有这些卫星。这意味着您的设备在所有这些接入点的覆盖范围内。这些接入点相交的空间就是您的设备所在的空间。</p><p id="7d5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想象一下这个场景。您正在尝试编写一个脚本，该脚本将获取用户的地理位置(纬度和经度)，并使用这些坐标来推荐附近的餐馆。要在浏览器中做到这一点，您可以使用<code class="fe lx ly lz ma b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Location" rel="noopener ugc nofollow" target="_blank">Location</a></code>对象。但是，您不能通过命令行访问浏览器的位置。</p><p id="c591" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如何在不使用浏览器的情况下，使用JavaScript获取用户的设备坐标？如果我们可以收集用户设备周围的各种无线接入点，我们可以使用Wi-Fi三边测量来获得设备坐标。</p><p id="8311" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们需要的。</p><p id="cf0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lx ly lz ma b"><strong class="lb iu">node-wifiscanner</strong></code> <strong class="lb iu"> </strong> —这个<a class="ae ky" href="https://www.npmjs.com/package/node-wifiscanner" rel="noopener ugc nofollow" target="_blank"> npm包</a>将用于收集您附近的无线接入点。你可以通过做<code class="fe lx ly lz ma b">npm install node-wifiscanner</code>来安装它。</p><p id="08b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lx ly lz ma b"><strong class="lb iu">node-fetch</strong></code> <strong class="lb iu"> </strong> —一旦我们获得了无线接入点，我们将使用fetch发出POST请求。由于在Node.js中没有实现fetch API，我们将需要运行<code class="fe lx ly lz ma b">npm install node-fetch</code>来下载<a class="ae ky" href="https://www.npmjs.com/package/node-fetch" rel="noopener ugc nofollow" target="_blank"> npm包</a>。一旦你完成了，我们就可以向<a class="ae ky" href="https://developers.google.com/maps/documentation/geolocation/intro" rel="noopener ugc nofollow" target="_blank">谷歌地理定位API </a>发出请求。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="332a" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">谷歌地理定位API</h1><p id="717e" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">一旦我们收集了Wi-Fi接入点，我们将使用谷歌地理定位API来查找我们的坐标。在POST请求的主体中，有一个名为<code class="fe lx ly lz ma b">wifiAccessPoints</code>的属性，它接受一个对象数组。这些对象只需要一个参数:<code class="fe lx ly lz ma b">macAddress</code>。这将是收集的无线接入点的MAC地址。</p><p id="08cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用地理定位API，你需要去谷歌云平台的<a class="ae ky" href="https://console.cloud.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">凭证部分</a>。在那里，单击Create Credentials按钮，然后选择API Key。</p><p id="eaf4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了依赖项，接下来是代码。创建一个<code class="fe lx ly lz ma b">trilateration.js</code>文件，并将下面的代码粘贴到其中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="5645" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">来自<code class="fe lx ly lz ma b">wifi-scanner</code>的响应可能如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="e48f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了获得MAC地址，我们需要获得键<code class="fe lx ly lz ma b">mac</code>的值。这种格式不同于地理定位API的格式。参见下面的介绍页面。</p><pre class="kj kk kl km gt nh ma ni nj aw nk bi"><span id="cc9f" class="nl mj it ma b gy nm nn l no np">{<br/>  "macAddress": "00:25:9c:cf:1c:ac", &lt;-- DIFFERENT KEY FORMAT<br/>  "signalStrength": -43,<br/>  "age": 0,<br/>  "channel": 11,<br/>  "signalToNoiseRatio": 0<br/>}</span></pre><p id="4043" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们发出请求之前，我们需要返回一个新的MAC地址对象集合，其中包含一个指向该地址的键<code class="fe lx ly lz ma b">macAddress</code>。</p><pre class="kj kk kl km gt nh ma ni nj aw nk bi"><span id="1491" class="nl mj it ma b gy nm nn l no np">var macs = data.map(x=&gt;{<br/>  var obj = {}<br/>  obj['macAddress'] = x.mac<br/>  return obj<br/>})</span></pre><p id="221e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们重新格式化了我们的mac地址，我们现在就可以向地理定位API发起请求了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="9521" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面是一个非常标准的Google API调用，它返回一个包含<code class="fe lx ly lz ma b">location</code>属性的对象。这个属性指向一个包含<code class="fe lx ly lz ma b">lat</code>和<code class="fe lx ly lz ma b">lng</code>的对象。这些对应于设备的纬度和经度(坐标)。该响应还包含一个<code class="fe lx ly lz ma b">accuracy</code>属性，该属性表示以米为单位的计算精度。</p><p id="2b7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:虽然150米不是很准确，但我已经在几个不同的地方尝试过这个脚本，每次请求都会返回与我当时所在的建筑相对应的坐标。您的结果可能会有所不同。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="ae70" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">摘要</h1><p id="c91e" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated"><strong class="lb iu">三边测量</strong>是一种定位技术，利用无线接入点和可达设备之间的距离。</p><p id="1e59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">三边测量不同于<strong class="lb iu">三角测量，</strong>利用无线接入点接收的信号的到达角(AoA)。</p><p id="5302" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您不能在命令行脚本中访问浏览器的位置。因此，我们需要找到设备周围无线接入点的MAC地址。这些地址可以使用包<code class="fe lx ly lz ma b">node-wifiscanner</code>找到。</p><p id="ab09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你有了MAC地址，把它们格式化，这样它们就可以被谷歌的地理定位API消化。</p><p id="b2d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lx ly lz ma b">node-fetch</code>向API发送POST请求，在请求体中使用格式化的MAC地址作为<code class="fe lx ly lz ma b">wifiAccessPoints</code>的值。</p><p id="b0ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过Wi-Fi三边测量，我们能够以足够的精度确定设备的地理位置。</p><p id="ff6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面所有的<a class="ae ky" href="https://github.com/macro6461/trilateration" rel="noopener ugc nofollow" target="_blank">代码</a>都可以在GitHub上找到。感谢阅读！</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><p id="8adf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://matt-croak.medium.com/membership" rel="noopener"> <em class="lv">在此处将您的免费媒体会员升级为付费会员</em> </a> <em class="lv">，每月只需5美元，您就可以收到各种出版物上数千名作家的无限量无广告故事。这是一个附属链接，你的会员资格的一部分帮助我为我创造的内容获得奖励。谢谢大家！</em></p><h1 id="1255" class="mi mj it bd mk ml nq mn mo mp nr mr ms jz ns ka mu kc nt kd mw kf nu kg my mz bi translated">参考</h1><div class="nv nw gp gr nx ny"><a href="https://github.com/macro6461/trilateration" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">macro 6461/三边测量</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">三边测量节点脚本。在GitHub上创建帐户，为macro 6461/三边测量开发做出贡献。</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://gisgeography.com/trilateration-triangulation-gps/" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">GPS接收器如何工作-三边测量与三角测量- GIS地理</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">你有没有想过你的GPS接收器是如何工作的？他们使用一种叫做三边测量的技术。尽管GPS……</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">gisgeography.com</p></div></div><div class="oh l"><div class="on l oj ok ol oh om ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Location" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">位置</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">位置接口表示它所链接的对象的位置(URL)。对它所做的更改反映在…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">developer.mozilla.org</p></div></div><div class="oh l"><div class="oo l oj ok ol oh om ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://www.npmjs.com/package/node-wifiscanner" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">节点-wifi扫描器</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">npm安装node-wifiscanner使用NodeJS扫描周围的WiFi接入点。在Mac上，它将使用airport命令…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">www.npmjs.com</p></div></div><div class="oh l"><div class="op l oj ok ol oh om ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://www.npmjs.com/package/node-fetch" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">节点提取</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">一个轻量级模块，将window.fetch带到Node.js(我们正在寻找v2维护者和合作者)而不是…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">www.npmjs.com</p></div></div><div class="oh l"><div class="oq l oj ok ol oh om ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://developers.google.com/maps/documentation/geolocation/intro" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">概述|地理定位API | Google开发者</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">开始之前:在您开始使用地理定位API之前，您需要一个带有计费帐户和…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">developers.google.com</p></div></div><div class="oh l"><div class="or l oj ok ol oh om ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://console.cloud.google.com/apis/credentials" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">谷歌云平台</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">Google云平台让您可以在同一基础设施上构建、部署和扩展应用程序、网站和服务…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">console.cloud.google.com</p></div></div><div class="oh l"><div class="os l oj ok ol oh om ks ny"/></div></div></a></div></div></div>    
</body>
</html>