<html>
<head>
<title>Build an Article Recommendation Engine With AI/ML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用AI/ML构建文章推荐引擎</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-an-article-recommendation-engine-with-ai-ml-c6e931e34d3b?source=collection_archive---------9-----------------------#2021-08-19">https://betterprogramming.pub/build-an-article-recommendation-engine-with-ai-ml-c6e931e34d3b?source=collection_archive---------9-----------------------#2021-08-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1c93" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">获得更好内容建议的Python应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b0411181a445d4865adbb3e97e1c8b1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-gsFtRSjNAsy-v6K"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·温克勒在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="a0ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">内容平台靠向用户推荐相关内容而繁荣。平台提供的相关项目越多，用户在网站上停留的时间就越长，这通常会转化为公司广告收入的增加。</p><p id="559d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你曾经访问过新闻网站、在线出版物或博客平台，你很可能接触过推荐引擎。每一个都基于你的阅读历史接受输入，然后推荐更多你可能喜欢的内容。</p><p id="2e5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一个简单的解决方案，一个平台可以实现一个基于标签的推荐引擎——你读了一篇“商业”文章，所以这里有另外五篇标签为“商业”的文章然而，构建推荐引擎的更好方法是使用<strong class="lb iu">相似性搜索和机器学习算法</strong>。</p><p id="e2a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将构建一个Python Flask应用程序，它使用<a class="ae ky" href="https://www.pinecone.io/" rel="noopener ugc nofollow" target="_blank">松果</a>——一个相似性搜索服务——来创建我们自己的文章推荐引擎。</p><h1 id="a904" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">演示应用概述</h1><p id="b5e1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">下面，你可以看到我们的演示应用程序如何工作的简短动画。页面上最初显示十篇文章。用户可以选择这十篇文章的任意组合来代表他们的阅读历史。当用户点击提交按钮时，阅读历史被用作查询文章数据库的输入，然后向用户显示另外十篇相关文章。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/d1e0e3bc5fab464f8b66e7c7a5b268c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*jWMKM_QD7TRXYOJK"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">演示应用程序—文章推荐引擎</p></figure><p id="dc60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，返回的相关文章异常准确！在本例中，有1024种可能的阅读历史组合可用作输入，每种组合都会产生有意义的结果。</p><p id="8ec4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，我们是怎么做到的呢？</p><p id="7ff5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在构建应用程序时，我们首先从Kaggle找到了新闻文章数据集。该数据集包含来自15个主要出版物的143，000篇新闻文章，但我们只使用了前20，000篇。(这个数据库的完整数据集包含超过200万篇文章！)</p><p id="3858" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们通过重命名几列并删除那些不必要的列来清理数据集。接下来，我们通过嵌入模型运行这些文章，以创建<a class="ae ky" href="https://www.pinecone.io/learn/vector-embeddings/" rel="noopener ugc nofollow" target="_blank">向量嵌入</a>——这是机器学习算法的元数据，用于确定各种输入之间的相似性。我们使用了<a class="ae ky" href="https://nlp.stanford.edu/projects/glove/" rel="noopener ugc nofollow" target="_blank">平均单词嵌入模型</a>。然后，我们将这些矢量嵌入插入到松果管理的矢量索引<a class="ae ky" href="https://www.pinecone.io/learn/vector-database/" rel="noopener ugc nofollow" target="_blank">中。</a></p><p id="c8c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将矢量嵌入添加到索引后，我们就可以开始查找相关内容了。当用户提交他们的阅读历史时，会向一个API端点发出请求，该端点使用Pinecone的SDK来查询矢量嵌入的索引。端点返回十篇相似的新闻文章，并在应用程序的UI中显示它们。就是这样！很简单，对吧？</p><p id="a6b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想自己尝试一下，你可以在GitHub 上找到这个应用的代码。<code class="fe mt mu mv mw b">README</code>包含如何在您自己的机器上本地运行应用程序的说明。</p><h1 id="51a6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">演示应用程序代码演练</h1><p id="00d0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们已经了解了应用程序的内部工作原理，但是我们实际上是如何构建它的呢？如前所述，这是一个利用松果SDK的Python Flask应用程序。HTML使用模板文件，前端的其余部分使用静态CSS和JS资产构建。为了简单起见，所有的后端代码都在<code class="fe mt mu mv mw b">app.py</code>文件中，我们在下面完整地复制了它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="fc85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们检查一下<code class="fe mt mu mv mw b">app.py</code>文件的重要部分，以便理解它。</p><p id="e622" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第1–14行，我们导入了应用程序的依赖项。我们的应用依赖于以下内容:</p><ul class=""><li id="7b99" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><code class="fe mt mu mv mw b">dotenv</code>用于从<code class="fe mt mu mv mw b">.env</code>文件中读取环境变量</li><li id="c44c" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe mt mu mv mw b">flask</code>用于网络应用程序设置</li><li id="f9a2" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe mt mu mv mw b">json</code>用于使用JSON</li><li id="13e2" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe mt mu mv mw b">os</code>也用于获取环境变量</li><li id="3f6a" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe mt mu mv mw b">pandas</code>用于处理数据集</li><li id="e5b3" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe mt mu mv mw b">pinecone</code>使用松果SDK</li><li id="3084" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe mt mu mv mw b">re</code>用于处理正则表达式(RegEx)</li><li id="f196" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe mt mu mv mw b">requests</code>请求API下载我们的数据集</li><li id="3961" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe mt mu mv mw b">statistics</code>获取一些方便的统计方法</li><li id="e8d5" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe mt mu mv mw b">sentence_transformers</code>对于我们的嵌入模型</li><li id="bb08" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe mt mu mv mw b">swifter</code>用于处理熊猫数据框</li></ul><p id="08a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第16行，我们提供了一些样板代码来告诉Flask我们的应用程序的名称。</p><p id="5c1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第18–20行，我们定义了一些将在应用程序中使用的常量。其中包括松果索引的名称、数据集的文件名以及从CSV文件中读取的行数。</p><p id="724c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第22–25行，我们的<code class="fe mt mu mv mw b">initialize_pinecone</code>方法从<code class="fe mt mu mv mw b">.env</code>文件中获取我们的API密匙，并用它来初始化松果。</p><p id="f826" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第27–29行，我们的<code class="fe mt mu mv mw b">delete_existing_pinecone_index</code>方法在松果实例中搜索与我们正在使用的名称相同的索引(“文章-推荐-服务”)。如果找到一个现有的索引，我们就删除它。</p><p id="b985" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第31–35行，我们的<code class="fe mt mu mv mw b">create_pinecone_index</code>方法使用我们选择的名称(“文章-推荐-服务”)、“余弦”接近度度量和一个碎片创建了一个新的索引。</p><p id="e968" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第37–40行，我们的<code class="fe mt mu mv mw b">create_model</code>方法使用<code class="fe mt mu mv mw b">sentence_transformers</code>库来处理平均单词嵌入模型。稍后我们将使用这个模型对矢量嵌入进行编码。</p><p id="f017" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第62–68行，我们的<code class="fe mt mu mv mw b">process_file</code>方法读取CSV文件，然后对其调用<code class="fe mt mu mv mw b">prepare_data</code>和<code class="fe mt mu mv mw b">upload_items</code>方法。接下来描述这两种方法。</p><p id="5a4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第42–56行，我们的<code class="fe mt mu mv mw b">prepare_data</code>方法通过重命名第一个“id”列并删除“date”列来调整数据集。然后，它获取每篇文章的前四行，并将它们与文章标题组合在一起，创建一个新字段作为要编码的数据。我们可以基于文章的全部内容创建矢量嵌入，但是为了加快编码过程，四行代码就足够了。</p><p id="3ff3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第58–60行，我们的<code class="fe mt mu mv mw b">upload_items</code>方法通过使用我们的模型对文章进行编码，为每篇文章创建一个矢量嵌入。向量嵌入然后被插入松果索引。</p><p id="d6ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第70–74行，我们的<code class="fe mt mu mv mw b">map_titles</code>和<code class="fe mt mu mv mw b">map_publications</code>方法创建了一些标题和出版物名称的字典，以便以后更容易通过它们的id找到文章。</p><p id="b6c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，当后端应用程序启动时，我们描述的每个方法都在第98–104行被调用。这项工作为我们基于用户输入实际查询松果索引的最后一步做准备。</p><p id="997c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第106–116行，我们为我们的应用程序定义了两条路径:一条到主页，一条到API端点。主页提供了<code class="fe mt mu mv mw b">index.html</code>模板文件以及JS和CSS资产，API端点提供了查询松果索引的搜索功能。</p><p id="7cc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，在第76–96行，我们的<code class="fe mt mu mv mw b">query_pinecone</code>方法获取用户的阅读历史输入，将其转换为矢量嵌入，然后查询松果索引来查找相似的文章。当点击<code class="fe mt mu mv mw b">/api/search</code>端点时调用该方法，这发生在用户提交新的搜索查询的任何时候。</p><p id="a1b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于视觉学习者来说，这里有一个图表概述了该应用程序的工作原理:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/74ba7f1f6cebf155eace4d125496a283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9S_7iYqcW3eTghUP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用架构和用户体验</p></figure><h1 id="4f8b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">示例场景</h1><p id="8b53" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">那么，把这些放在一起，用户体验是什么样的呢？我们来看三个场景:一个对体育感兴趣的用户，一个对科技感兴趣的用户，一个对政治感兴趣的用户。</p><p id="7e49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">体育用户选择关于两位著名网球运动员小威廉姆斯和安迪·穆雷的前两篇文章作为他们的阅读历史。在他们提交选择后，应用程序会回复关于温布尔登、美国公开赛、罗杰·费德勒和拉斐尔·纳达尔的文章。完全正确！</p><p id="3bde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">技术用户选择关于三星和苹果的文章。在他们提交选择后，应用程序会回复关于三星、苹果、谷歌、英特尔和iPhones的文章。再次伟大的推荐！</p><p id="edee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">politics用户选择了一篇关于选民欺诈的文章。在他们提交选择后，应用程序会回复关于选民ID、美国2020年大选、投票率和非法投票指控(以及为什么他们站不住脚)的文章。</p><p id="fb8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">三个三个！我们的推荐引擎被证明非常有用。</p><h1 id="e734" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="e735" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们现在已经创建了一个简单的Python应用程序来解决现实世界中的问题。如果内容网站可以向用户推荐相关内容，用户将会更喜欢这些内容，并在网站上花费更多时间，从而为公司带来更多收入。大家都赢了！</p><p id="313b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相似性搜索有助于为您的用户提供更好的建议。松果作为一种相似性搜索服务，让您可以轻松地向用户提供建议，以便您可以专注于自己最擅长的事情——建立一个充满值得阅读的内容的迷人平台。</p></div></div>    
</body>
</html>