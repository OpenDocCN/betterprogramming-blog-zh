<html>
<head>
<title>10 Essential Tips for Writing Secure REST API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写安全REST API的10个基本技巧</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/10-essential-tips-for-writing-secure-rest-api-e297990d48c5?source=collection_archive---------7-----------------------#2021-04-28">https://betterprogramming.pub/10-essential-tips-for-writing-secure-rest-api-e297990d48c5?source=collection_archive---------7-----------------------#2021-04-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b9bf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">REST APIs通过一组通用的无状态操作来访问和操作数据。让我们让它们变得健壮</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eb7c93fbb9c352811bb50009e19d6923.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1neBgvPeA4hoCNSt"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Nubelson Fernandes 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="0d21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用程序编程接口(API)无处不在。大多数现代web应用程序公开了客户端可以用来与应用程序交互的API。</p><p id="3427" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它们使软件能够与软件的其他部分——内部的或外部的——一致地通信，这是可伸缩性的一个关键因素，更不用说可重用性了。</p><p id="b14c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像任何技术一样，REST APIs也带来了自己独特的安全挑战。剩下的问题是如何减少这些漏洞。</p><p id="0d25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天我们将讨论以下主题:</p><ol class=""><li id="9c7d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">什么是REST API？</li><li id="5f0b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">REST API和应用程序安全性的重要性</li><li id="a7c7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">描述保护REST APIs的10大最佳实践</li></ol><p id="a24b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想<a class="ae ky" href="https://medium.com/dev-genius/securing-spring-boot-rest-api-with-spring-security-jwt-and-jpa-64ec45fb25e0" rel="noopener">使用Spring Security、JWT和JPA </a>来保护Spring boot Rest API，有很多方法可以做到。</p><h1 id="5a22" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">什么是RESTful API？</h1><ul class=""><li id="6f36" class="lv lw it lb b lc nb lf nc li nd lm ne lq nf lu ng mb mc md bi translated">应用程序编程接口(API)是各种软件组件之间的一组明确定义的通信方法。</li><li id="1689" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">REST APIs通过一组通用的无状态操作来访问和操作数据。</li><li id="0541" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">这些操作是HTTP协议不可或缺的一部分，代表了基本的创建、读取、更新和删除(CRUD)功能，尽管不是以清晰的一对一方式</li><li id="a12d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">它更像是一种设计和交流的方法，而不是单一的工具或编程库。</li><li id="0252" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">RESTful编程是无状态的，它提供了一个统一的接口，通常使用基于HTTP的URL和查询参数，这些参数对用户隐藏了后端基础设施。</li><li id="de87" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">响应通常以简单的基于JSON的键/值对的形式返回，但是API可以支持任何类型的内容，包括XML、测试文档甚至图像。然后，前端软件可以以适合用户的格式提供数据。</li><li id="fd9d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">一个好的API通过提供所有的构件使得开发一个计算机程序变得更加容易。</li><li id="d324" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">REST APIs是现代基于云的软件经济的粘合剂。它们可以提供简单明了的信息，甚至是来自大型数据集的信息。</li><li id="c907" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">例如，你的软件可以查询亚马逊的API来获取产品价格，或者从谷歌地图获取地理位置。</li><li id="9702" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">或者，它可以查询需要大量计算能力的复杂后端服务。你想要一个用描述性词语标记照片或识别某人面孔的服务吗？微软基于REST的API可以做到这一点。</li></ul><h1 id="b505" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">API和应用程序安全性的重要性</h1><ul class=""><li id="f5d4" class="lv lw it lb b lc nb lf nc li nd lm ne lq nf lu ng mb mc md bi translated">企业使用API来连接服务和传输数据，因此被黑客攻击的API会导致数据泄露。</li><li id="0896" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">破损、暴露或被黑的API是重大数据泄露的幕后黑手。他们将敏感的医疗、财务和个人数据公之于众。</li><li id="ac3e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">也就是说，并非所有数据都是相同的，也不应该以相同的方式保护。如何实现API安全性将取决于传输的数据类型。</li><li id="c9f7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">多种类型的数据可以通过不同的API进行传输。任何API安全性的实现都需要特定于您的API和正在传输的数据。</li><li id="1a41" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">API注入是黑客向易受攻击的软件程序中注入恶意代码的攻击。最常见的是SQL、NoSQL和命令注入。</li><li id="b8d9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">包含不可信数据的命令或查询被发送到解释器。解释器被骗去执行非预期的命令或在没有有效授权的情况下访问数据。</li><li id="9a0e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">尽量避免使用外部解释器。这是防止API注入的最简单的方法。</li><li id="5000" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">确保您的web应用程序仅使用其功能所需的权限运行。这样，黑客就无法利用web应用程序拥有的管理权限。</li><li id="a90e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">您需要确保您的应用程序端点(用于访问接口的URL)不容易受到通过接口或绕过接口的攻击。</li></ul><h1 id="7136" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">安全REST APIs的最佳实践</h1><p id="f5e7" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">坚如磐石的身份验证和授权机制是REST API安全性的开始，但不是结束。在开发过程中，还需要考虑其他安全最佳实践。</p><p id="bb43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过使用签名、加密、配额、节流、令牌、API网关等。，您的API安全性会大大提高。</p><h2 id="c58b" class="nk mk it bd ml nl nm dn mp nn no dp mt li np nq mv lm nr ns mx lq nt nu mz nv bi translated">1.永远用HTTPS</h2><p id="9fe5" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">总是使用TLS和一个已经建立的安全框架，并且有一个大的社区作为后盾。</p><p id="6203" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安全REST服务必须仅提供HTTPS端点。这保护了传输中的身份验证凭证，例如密码、API密钥或JSON Web令牌。它还允许客户端对服务进行身份验证，并保证传输数据的完整性。</p><p id="6d01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过始终使用SSL，身份验证凭证可以简化为随机生成的访问令牌。令牌在HTTP基本身份验证的用户名字段中传递。它使用起来相对简单，而且你可以免费获得很多安全特性。</p><h2 id="e248" class="nk mk it bd ml nl nm dn mp nn no dp mt li np nq mv lm nr ns mx lq nt nu mz nv bi translated">2.确保适当的访问控制</h2><p id="8a9c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">非公共REST服务必须在每个API端点执行访问控制。单一应用程序中的Web服务通过用户认证、授权逻辑和会话管理来实现这一点。</p><p id="f0fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这对于现代架构有几个缺点，现代架构遵循RESTful风格组成多个微服务。</p><p id="354b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以实现通用过滤器，其中所有的身份验证和授权都可以确保。在访问非公共API之前，您必须确保请求者有足够的权限/授权来访问此API。</p><h2 id="8447" class="nk mk it bd ml nl nm dn mp nn no dp mt li np nq mv lm nr ns mx lq nt nu mz nv bi translated">3.想想JWT和奥厄斯的结合</h2><p id="3a17" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">对于身份验证，您可以使用JSON Web令牌(JWT)，对于授权，您可以使用OAuth2。</p><p id="a0a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">REST APIs也使用JavaScript Object Notation (JSON ),这是一种文件格式，使得通过web浏览器和API传输数据更加容易。通过使用HTTP和JSON，REST APIs不需要存储或重新打包数据，这使得它们比SOAP APIs快得多。</p><p id="8ae3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然基本的auth对于大多数API来说已经足够好了，但是如果正确实现的话，它也是安全的——但是您可能也想考虑OAuth。</p><p id="2080" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">OAuth 2.0授权框架使第三方应用程序能够获得对HTTP服务的有限访问，或者通过协调资源所有者和HTTP服务之间的批准交互来代表资源所有者，或者通过允许第三方应用程序代表其获得访问。</p><h2 id="dc90" class="nk mk it bd ml nl nm dn mp nn no dp mt li np nq mv lm nr ns mx lq nt nu mz nv bi translated">4.输入参数验证</h2><p id="7522" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">在到达应用程序逻辑之前，在第一步就验证请求参数。验证基于参数的查询输入。进行严格的验证检查，如果验证失败，立即拒绝请求。</p><p id="46b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">攻击者可以更改URL参数、JSON请求数据和XML输入。Fuzzers可以通过细微的输入变化打击REST APIs，所以在这里要注意。</p><ul class=""><li id="1a35" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ng mb mc md bi translated">不要信任输入参数/对象。</li><li id="c1dc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">验证输入，如长度、范围、格式和类型。</li><li id="29a4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">通过在API参数中使用数字、布尔值、日期、时间或固定数据范围等强类型来实现隐式输入验证。</li><li id="841e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">用正则表达式约束字符串输入。</li><li id="2871" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">拒绝意外和/或非法内容。</li><li id="8de6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">利用您特定语言的验证和/或清理库或框架。</li><li id="11b6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">定义适当的请求大小限制，并拒绝超过限制的HTTP响应状态413请求实体太大的请求。</li><li id="9bee" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">考虑记录输入验证失败。假设有人每秒执行数百次失败的输入验证，那他一定不怀好意。</li></ul><h2 id="74ea" class="nk mk it bd ml nl nm dn mp nn no dp mt li np nq mv lm nr ns mx lq nt nu mz nv bi translated">5.将允许的HTTP方法列入白名单</h2><p id="79e7" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">通过将允许的HTTP方法(例如GET、POST和PUT)列入白名单来提供另一层防御。默认情况下，阻止那些您可能永远不希望有人通过公共API访问的内容(例如，删除)。</p><p id="bf21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类似地，针对特定操作对单个用户进行身份验证。例如，您可能允许外部用户进行单个查询，但不能导出所有数据。</p><ul class=""><li id="2bac" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ng mb mc md bi translated">应用允许的HTTP方法的允许列表，例如<code class="fe nw nx ny nz b">GET</code>、<code class="fe nw nx ny nz b">POST</code>、<code class="fe nw nx ny nz b">PUT</code>。</li><li id="7663" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">用HTTP响应代码<code class="fe nw nx ny nz b">405 Method not allowed</code>拒绝所有与允许列表不匹配的请求。</li><li id="c69a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ng mb mc md bi translated">确保调用方被授权在资源集合、操作和记录上使用传入的HTTP方法</li></ul><h2 id="2ab8" class="nk mk it bd ml nl nm dn mp nn no dp mt li np nq mv lm nr ns mx lq nt nu mz nv bi translated">6.如果可能，使用白名单中的IP</h2><p id="eb5b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">对于服务器到服务器的通信，您可以使用白名单中的IP。如果请求者IP属于您的白名单IP列表，那么您可以允许他们。</p><p id="13c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你的API消费者是移动应用，那么这个过程是不可能的，因为他们没有永久的IP地址。</p><h2 id="1a86" class="nk mk it bd ml nl nm dn mp nn no dp mt li np nq mv lm nr ns mx lq nt nu mz nv bi translated"><strong class="ak"> 7。使用配额和节流</strong></h2><p id="1519" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">对API的调用频率设置配额，并跟踪其历史使用情况。对某个API的调用越多，可能表明它正在被滥用。也可能是编程错误，比如无限循环地调用API。制定节流规则来保护您的API免受峰值和拒绝服务攻击。</p><h2 id="932d" class="nk mk it bd ml nl nm dn mp nn no dp mt li np nq mv lm nr ns mx lq nt nu mz nv bi translated">8.记录所有失败的请求并使用工具进行分析</h2><p id="e2fb" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">您可以记录所有失败的请求，并寻找识别持续攻击的模式。此外，发送带有适当HTTP状态代码的相关错误消息，以帮助开发人员连接到您的服务。</p><p id="a966" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过日志分析器定期分析失败的日志，对于严重的错误，如禁止访问，确保他们发送电子邮件或短信给管理员或相关人员。</p><h2 id="c7b9" class="nk mk it bd ml nl nm dn mp nn no dp mt li np nq mv lm nr ns mx lq nt nu mz nv bi translated"><strong class="ak"> 9。使用API网关</strong></h2><p id="24f4" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">API网关充当API流量的主要实施点。一个好的网关将允许你认证流量以及控制和分析你的API是如何被使用的。</p><h2 id="6aca" class="nk mk it bd ml nl nm dn mp nn no dp mt li np nq mv lm nr ns mx lq nt nu mz nv bi translated">10.保持简单</h2><p id="60ec" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">保护一个API/系统的安全程度。每次你让解决方案变得不必要的复杂，你也可能留下一个漏洞。</p><h1 id="7d5b" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated"><strong class="ak">结论</strong></h1><p id="6b3f" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">感谢阅读这篇文章。希望你喜欢这个。</p><p id="478d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果想通过docker学习使用spring cloud的微服务实现，<a class="ae ky" href="https://medium.com/dev-genius/microservice-implementation-using-spring-cloud-with-docker-netflix-stack-76a367a5cf05" rel="noopener">这篇文章可以帮助</a>。</p><h1 id="0979" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated"><strong class="ak">资源</strong></h1><p id="25be" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">1.<a class="ae ky" href="https://restfulapi.net/security-essentials/" rel="noopener ugc nofollow" target="_blank">https://restfulapi.net/security-essentials/</a><br/>2。<a class="ae ky" href="https://developer.okta.com/blog/2019/09/04/securing-rest-apis" rel="noopener ugc nofollow" target="_blank">https://developer . okta . com/blog/2019/09/04/securing-rest-API</a><br/>3 .<a class="ae ky" href="https://www.toptal.com/nodejs/secure-rest-api-in-nodejs" rel="noopener ugc nofollow" target="_blank">https://www.toptal.com/nodejs/secure-rest-api-in-nodejs</a><br/>4。<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/architecture/best-practices/api-design" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/architecture/best-practices/API-design</a><br/>5 .<a class="ae ky" href="https://www.neuralegion.com/blog/api-security/" rel="noopener ugc nofollow" target="_blank">https://www.neuralegion.com/blog/api-security/</a></p></div></div>    
</body>
</html>