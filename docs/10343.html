<html>
<head>
<title>Getting Started With AWS Amplify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Amplify入门</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-aws-amplify-d5ed64c831b9?source=collection_archive---------10-----------------------#2021-12-29">https://betterprogramming.pub/getting-started-with-aws-amplify-d5ed64c831b9?source=collection_archive---------10-----------------------#2021-12-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b6a9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解Amplify的工作原理，部署具有用户验证、存储和文件上传功能的图库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1e19db38f17a1ca18245caab43498637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8h5RGattiePceL9fQmJRgg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://docs.amplify.aws/start/" rel="noopener ugc nofollow" target="_blank">官方标志</a></p></figure><p id="e9b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Amplify允许网络和移动开发者在AWS上快速创建全栈应用。在本文中，您将了解Amplify如何工作，以及如何构建和部署具有用户验证、存储和文件上传功能的图片库。</p><p id="d213" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无服务器云基础设施是构建应用的下一步。但是如果你尝试过在AWS控制台中导航大量的服务，你就会知道使用云是说起来容易做起来难。今天的开发人员被AWS提供的大量服务淹没了。</p><p id="ec6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决办法？AWS Amplify通过提供一系列CLI工具、库、框架和云服务，帮助开发人员轻松构建和部署完整的移动和web应用。</p><h1 id="4fc4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">AWS Amplify是如何工作的？</h1><p id="5914" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">使用Amplify时，您的主要交互点是CLI工具，它提供了许多命令来帮助您设置和维护无服务器项目。Amplify CLI可以通过生成和部署CloudFormation代码来创建基础架构。它还包括使用以下语言的移动和web应用程序的代码生成器:JavaScript/TypeScript、Dart、Swift、Java和GraphQL。</p><p id="4f37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，您可以获得部署到云中的新AWS资源，配置了最佳实践，以及将您的前端与这些资源连接起来所需的样板代码。</p><p id="38d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Amplify也有自己的一套云服务，你可以用来设置和管理你的应用程序，包括基于亚马逊S3和亚马逊CloudFront的虚拟主机，Amplify控制台和Amplify Admin UI。Amplify控制台用于在您部署应用程序后深入了解应用程序的工作情况，而Amplify Admin UI是Amplify CLI的可视化替代工具，您可以在浏览器中创建后端。</p><p id="9b9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有大量的前端库和组件可以帮助您连接AWS服务，并简化Amplify与React或Vue等前端框架的集成。这包括一个用于与<a class="ae ky" href="https://aws.amazon.com/cognito" rel="noopener ugc nofollow" target="_blank"> Amazon Cognito </a>认证的库，AWS自己的身份管理服务，以及一个连接到<a class="ae ky" href="https://aws.amazon.com/appsync" rel="noopener ugc nofollow" target="_blank"> AppSync </a>的GraphQL客户端，一个托管的GraphQL API服务。</p><p id="cfb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过Amplify DataStore，Amplify甚至包括一个相对高级的库，可以减轻为您的应用程序设置离线功能和实时同步的痛苦。</p><h1 id="111e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">建立图像库</h1><p id="a56d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了更好地理解Amplify能做什么，让我们用它来构建一些东西！对于Amplify来说，图片库网络应用是一项简单的任务。本教程向您展示了如何使用Amplify auth、hosting和storage插件，以及如何使用Amplify CLI生成大部分代码。</p><h1 id="cee0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">1.先决条件</h1><p id="529a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">本教程需要以下内容:</p><ul class=""><li id="a0c4" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">AWS帐户</li><li id="e862" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">AWS CLI</li><li id="53d7" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">Node.js和NPM</li><li id="331f" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">放大CLI</li></ul><p id="b515" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果使用Cloud9 IDE跟进，只需手动安装和配置Amplify CLI其他一切都是开箱即用的。确保通过<code class="fe ng nh ni nj b">amplify configure</code>配置了Amplify CLI，以使用您的AWS凭证。AWS有关于安装和配置Amplify CLI 的详细<a class="ae ky" href="https://docs.amplify.aws/start/getting-started/installation/q/integration/js/" rel="noopener ugc nofollow" target="_blank">指南。</a></p><h1 id="99be" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2.初始化示例应用程序</h1><p id="c796" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，您需要为您的应用程序创建一个包含几个子目录的新目录。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="3523" class="no lw it nj b gy np nq l nr ns">$ mkdir image-gallery<br/>$ cd image-gallery<br/>$ mkdir src<br/>$ mkdir dist</span></pre><p id="c9db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ng nh ni nj b">src</code>目录用于存储JavaScript代码，而<code class="fe ng nh ni nj b">dist</code>目录被Amplify用来捆绑、缩小和上传JavaScript和HTML到云端。</p><p id="866a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在项目根目录下创建一个<code class="fe ng nh ni nj b">package.json</code>文件，内容如下:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="36c3" class="no lw it nj b gy np nq l nr ns">{<br/>  "name": "image-gallery",<br/>  "version": "0.1.0",<br/>  "scripts": {<br/>    "build": "esbuild src/app.js --bundle --minify --define:global=window --outfile=dist/app.js"<br/>  },<br/>  "dependencies": {<br/>    "aws-amplify": "latest"<br/>  },<br/>  "devDependencies": {<br/>    "esbuild": "^0.13.15"<br/>  }<br/>}</span></pre><p id="fe45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该使用ESBuild将Amplify SDK与您的应用程序代码捆绑在一起并进行精简，以便进行部署。<code class="fe ng nh ni nj b">amplify publish</code> CLI命令将自动调用构建脚本并搜索<code class="fe ng nh ni nj b">dist</code>目录中的文件以上传到Amplify的托管服务。</p><h1 id="f51e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3.初始化放大器</h1><p id="0f06" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">用下面的命令初始化项目中的Amplify。当询问时，选择默认值。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="be45" class="no lw it nj b gy np nq l nr ns">$ amplify init -y</span></pre><p id="71f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令将在云中设置基本的与Amplify相关的资源，包括两个IAM角色和一个用于部署相关数据的S3存储桶。它还将生成一个<code class="fe ng nh ni nj b">src/aws-exports.js</code>文件，其中包含您的前端连接到您稍后将部署的服务所需的所有凭证。该文件将在每次调用Amplify CLI时更新，因此您不应该手动更改它。</p><p id="c7a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，依次添加<code class="fe ng nh ni nj b">hosting</code>、<code class="fe ng nh ni nj b">auth</code>和<code class="fe ng nh ni nj b">storage</code>。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="91b6" class="no lw it nj b gy np nq l nr ns">$ amplify add hosting</span></pre><p id="69dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择下面列出的默认值。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="bdd2" class="no lw it nj b gy np nq l nr ns">? Select the plugin module to execute: Hosting with Amplify Console (Managed hosting with custom domains, Continuous deployment)</span><span id="d1b9" class="no lw it nj b gy nt nq l nr ns">? Choose a type: Manual deployment</span><span id="c06f" class="no lw it nj b gy nt nq l nr ns">$ amplify add auth</span></pre><p id="dd3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，CLI将询问您一些问题，并给出默认答案。这里，默认值也是可以的。它们如下:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="c5d7" class="no lw it nj b gy np nq l nr ns">Do you want to use the default authentication and security configuration? Default configuration</span><span id="0a81" class="no lw it nj b gy nt nq l nr ns">How do you want users to be able to sign in? Username</span><span id="12b4" class="no lw it nj b gy nt nq l nr ns">Do you want to configure advanced settings? No, I am done.</span><span id="a572" class="no lw it nj b gy nt nq l nr ns">$ amplify add storage</span></pre><p id="4236" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">存储类别需要一点定制。默认配置只允许经过身份验证的用户访问存储，但您也希望未经身份验证的用户查看图像。为此，您需要以下配置:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="a503" class="no lw it nj b gy np nq l nr ns">? Select from one of the below mentioned services: Content (Images, audio, video, etc.)</span><span id="3295" class="no lw it nj b gy nt nq l nr ns">✔ Provide a friendly name for your resource that will be used to label this category in the project: ...</span><span id="bfd1" class="no lw it nj b gy nt nq l nr ns">✔ Provide bucket name: ...</span><span id="e5e1" class="no lw it nj b gy nt nq l nr ns">✔ Who should have access: Auth and guest users</span><span id="9bf7" class="no lw it nj b gy nt nq l nr ns">✔ What kind of access do you want for Authenticated users? create/update, read, delete</span><span id="9865" class="no lw it nj b gy nt nq l nr ns">✔ What kind of access do you want for Guest users? read</span><span id="6aa4" class="no lw it nj b gy nt nq l nr ns">✔ Do you want to add a Lambda Trigger for your S3 Bucket? no</span></pre><p id="dbdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于存储器，选择<code class="fe ng nh ni nj b">Auth and guest users</code>以确保您有权访问。认证用户需要对<code class="fe ng nh ni nj b">create</code>、<code class="fe ng nh ni nj b">update</code>和<code class="fe ng nh ni nj b">read</code>文件的权限，访客用户需要对<code class="fe ng nh ni nj b">read</code>文件的权限。</p><h1 id="a56e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">4.编写源代码</h1><p id="c4d6" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在<code class="fe ng nh ni nj b">dist</code>目录下创建一个<code class="fe ng nh ni nj b">index.html</code>文件，内容如下:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="0f22" class="no lw it nj b gy np nq l nr ns">&lt;!DOCTYPE html&gt;</span><span id="3923" class="no lw it nj b gy nt nq l nr ns">&lt;meta charset="utf-8" /&gt;</span><span id="3bc5" class="no lw it nj b gy nt nq l nr ns">&lt;title&gt;Amplify Image Gallery&lt;/title&gt;</span><span id="358b" class="no lw it nj b gy nt nq l nr ns">&lt;link rel="stylesheet" href="//unpkg.com/bamboo.css@1.3.7/dist/dark.min.css" /&gt;</span><span id="4bc1" class="no lw it nj b gy nt nq l nr ns">&lt;style&gt;<br/>  button {<br/>    width: 100%;<br/>  }<br/>&lt;/style&gt;</span><span id="7a80" class="no lw it nj b gy nt nq l nr ns">&lt;h1&gt;Amplify Image Gallery&lt;/h1&gt;</span><span id="34f7" class="no lw it nj b gy nt nq l nr ns">&lt;div id="signin-status"&gt;Sign Up or Sign In.&lt;/div&gt;<br/>&lt;br&gt;</span><span id="c870" class="no lw it nj b gy nt nq l nr ns">&lt;h2&gt;Step 1: Sign Up&lt;/h2&gt;</span><span id="b99d" class="no lw it nj b gy nt nq l nr ns">Username &lt;input id="signup-username" /&gt;&lt;br&gt;</span><span id="3cb1" class="no lw it nj b gy nt nq l nr ns">Email &lt;input id="signup-email" /&gt;&lt;br&gt;</span><span id="2835" class="no lw it nj b gy nt nq l nr ns">Password &lt;input type="password" id="signup-password" /&gt;&lt;br&gt;</span><span id="12cf" class="no lw it nj b gy nt nq l nr ns">&lt;p&gt;<br/>  Passwords must be 8 characters long, contain one number and one special<br/>  character.<br/>&lt;/p&gt;</span><span id="a6c6" class="no lw it nj b gy nt nq l nr ns">&lt;button id="signup-button"&gt;Sign Up With Email&lt;/button&gt;&lt;br&gt;</span><span id="54cf" class="no lw it nj b gy nt nq l nr ns">&lt;h2&gt;Step 2: Confirm Sign Up&lt;/h2&gt;</span><span id="3b17" class="no lw it nj b gy nt nq l nr ns">Confirmation Code &lt;input id="signup-confirmation-code" /&gt;&lt;br&gt;&lt;br&gt;</span><span id="9119" class="no lw it nj b gy nt nq l nr ns">&lt;button id="confirm-signup-button"&gt;Confirm Sign Up&lt;/button&gt;</span><span id="3348" class="no lw it nj b gy nt nq l nr ns">&lt;br&gt;&lt;br&gt;</span><span id="8b8d" class="no lw it nj b gy nt nq l nr ns">&lt;h2&gt;Step 3: Sign In&lt;/h2&gt;</span><span id="7414" class="no lw it nj b gy nt nq l nr ns">Username &lt;input id="signin-username" /&gt;&lt;br&gt;</span><span id="3993" class="no lw it nj b gy nt nq l nr ns">Password &lt;input type="password" id="signin-password" /&gt;&lt;br&gt;&lt;br&gt;</span><span id="d6a2" class="no lw it nj b gy nt nq l nr ns">&lt;button id="signin-button"&gt;Sign In&lt;/button&gt;&lt;br&gt;&lt;br&gt;</span><span id="1053" class="no lw it nj b gy nt nq l nr ns">&lt;h2&gt;Step 4: Upload image&lt;/h2&gt;</span><span id="111d" class="no lw it nj b gy nt nq l nr ns">&lt;input type="file" id="upload-input" /&gt;</span><span id="0b81" class="no lw it nj b gy nt nq l nr ns">&lt;h2&gt;Images&lt;/h2&gt;</span><span id="727d" class="no lw it nj b gy nt nq l nr ns">&lt;div id="gallery"&gt;&lt;/div&gt;</span><span id="7b56" class="no lw it nj b gy nt nq l nr ns">&lt;script src="app.js"&gt;&lt;/script&gt;</span></pre><p id="342c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个HTML页面有几个注册过程的按钮。它们将在下面的JavaScript文件中与逻辑联系起来。</p><p id="3cb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ng nh ni nj b">src</code>目录下创建一个<code class="fe ng nh ni nj b">app.js</code>文件，内容如下:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="fd2e" class="no lw it nj b gy np nq l nr ns">import Amplify, { Auth, Storage } from 'aws-amplify'</span><span id="f38d" class="no lw it nj b gy nt nq l nr ns">import awsconfig from './aws-exports'</span><span id="dd65" class="no lw it nj b gy nt nq l nr ns">Amplify.configure(awsconfig)</span><span id="7721" class="no lw it nj b gy nt nq l nr ns">const getElement = document.getElementById.bind(document)</span><span id="2697" class="no lw it nj b gy nt nq l nr ns">const statusDiv = getElement('signin-status')</span><span id="6d19" class="no lw it nj b gy nt nq l nr ns">async function refreshGallery() {<br/>  const galleryDiv = getElement('gallery')</span><span id="19f5" class="no lw it nj b gy nt nq l nr ns">galleryDiv.innerHTML = ''</span><span id="6a6a" class="no lw it nj b gy nt nq l nr ns">const files = await Storage.list('')</span><span id="b33d" class="no lw it nj b gy nt nq l nr ns">for (let file of files) {<br/>    const image = document.createElement('img')</span><span id="4585" class="no lw it nj b gy nt nq l nr ns">image.src = await Storage.get(file.key)</span><span id="d8a9" class="no lw it nj b gy nt nq l nr ns">galleryDiv.appendChild(image)<br/>  }<br/>}</span><span id="ed24" class="no lw it nj b gy nt nq l nr ns">refreshGallery()</span><span id="dff9" class="no lw it nj b gy nt nq l nr ns">getElement('signup-button').addEventListener('click', async () =&gt; {<br/>  const username = getElement('signup-username').value<br/>  const email = getElement('signup-email').value<br/>  const password = getElement('signup-password').value</span><span id="b28a" class="no lw it nj b gy nt nq l nr ns">await Auth.signUp({ username, password, attributes: { email } })</span><span id="81ee" class="no lw it nj b gy nt nq l nr ns">statusDiv.innerText = `Check "${email}" inbox for a confirmation code.`<br/>})</span><span id="e03e" class="no lw it nj b gy nt nq l nr ns">getElement('confirm-signup-button').addEventListener('click', async () =&gt; {<br/>  const code = getElement('signup-confirmation-code').value<br/>  const username = getElement('signup-username').value</span><span id="27ea" class="no lw it nj b gy nt nq l nr ns">await Auth.confirmSignUp(username, code)</span><span id="fbc0" class="no lw it nj b gy nt nq l nr ns">statusDiv.innerText = 'Sinup confirmed. You can sign in now.'<br/>})</span><span id="f598" class="no lw it nj b gy nt nq l nr ns">getElement('signin-button').addEventListener('click', async () =&gt; {<br/>  const username = getElement('signin-username').value<br/>  const password = getElement('signin-password').value</span><span id="c661" class="no lw it nj b gy nt nq l nr ns">const result = await Auth.signIn(username, password)</span><span id="beb9" class="no lw it nj b gy nt nq l nr ns">statusDiv.innerText = 'Signed in as ' + result.username<br/>})</span><span id="723f" class="no lw it nj b gy nt nq l nr ns">getElement('upload-input').addEventListener('change', async (e) =&gt; {<br/>  const [file] = e.target.files</span><span id="9f61" class="no lw it nj b gy nt nq l nr ns">await Storage.put(file.name, file)</span><span id="cd45" class="no lw it nj b gy nt nq l nr ns">await refreshGallery()<br/>})</span></pre><p id="8a97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ng nh ni nj b">app.js</code>文件给HTML注入了生命。<code class="fe ng nh ni nj b">aws-exports.js</code>文件包含您的客户机与部署的基础设施交互所需的所有凭证。您将使用它来初始化Amplify SDK。</p><p id="d2a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ng nh ni nj b">refreshGallery</code>函数获取您上传到AWS Amplify存储器的所有文件名的列表，这实际上是一个S3桶。然后，它使用<code class="fe ng nh ni nj b">Storage.get</code>方法生成经过签名的URL，这些URL可以放入<code class="fe ng nh ni nj b">img</code> HTML元素来显示您的图像。</p><p id="d619" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，向所有按钮添加事件侦听器来管理身份验证流。Amplify SDK提供了一个具有各种方法的Auth对象来注册、登录和确认电子邮件代码。稍后需要登录才能使用上传功能。</p><p id="843f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要安装用于JavaScript和ESBuild的Amplify SDK，请运行以下命令:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="1c23" class="no lw it nj b gy np nq l nr ns">$ npm i</span></pre><p id="59ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装完库后，您可以使用Amplify CLI部署无服务器基础架构，并将更改发布到AWS云:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="8c79" class="no lw it nj b gy np nq l nr ns">$ amplify publish</span></pre><p id="6cfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令将部署无服务器基础设施和包，并上传您的前端代码。这可能需要几分钟才能完成，因为将调配许多资源。</p><h1 id="1045" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">5.使用应用程序</h1><p id="87da" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">部署完成后，Amplify会为您提供一个URL。该应用程序将类似于下面图1中的图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/2b0f393225d918264e9c732215967a9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*clrd7NqmDWoNQbz0.png"/></div></div></figure><p id="fa5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图1:图片库应用</p><p id="5367" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在浏览器中打开URL，然后按照说明进行操作:</p><ol class=""><li id="1129" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu nv my mz na bi translated">用你的邮箱注册</li><li id="50fc" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu nv my mz na bi translated">输入您从AWS Cognito收到的确认码并进行验证</li><li id="ad59" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu nv my mz na bi translated">签到</li><li id="b820" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu nv my mz na bi translated">上传图像</li></ol><p id="3b1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您使用CLI设置存储类别时，映像将被直接发送到由Amplify创建的S3存储桶。Amplify SDK随后用于生成签名的URL，这允许您通过HTTP访问图像。加载图像的完整代码在<code class="fe ng nh ni nj b">src/app.js</code>文件内的refreshGallery函数中:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="be91" class="no lw it nj b gy np nq l nr ns">async function refreshGallery() {<br/>  const galleryDiv = getElement('gallery')</span><span id="7dc8" class="no lw it nj b gy nt nq l nr ns">galleryDiv.innerHTML = ''</span><span id="a428" class="no lw it nj b gy nt nq l nr ns">const files = await Storage.list('')</span><span id="bafe" class="no lw it nj b gy nt nq l nr ns">for (let file of files) {<br/>    const image = document.createElement('img')<br/>    image.src = await Storage.get(file.key)<br/>    galleryDiv.appendChild(image)<br/>  }<br/>}</span></pre><h1 id="bc8f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">6.清除</h1><p id="6bd5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">部署和使用系统后，您只需使用一个Amplify CLI命令即可删除它:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="bff1" class="no lw it nj b gy np nq l nr ns">$ amplify delete</span></pre><p id="8ac0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令将删除所有本地文件，放大生成并销毁CloudFormation模板和云中部署的所有相关资源。</p><p id="2136" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">调用上述命令后，检查<a class="ae ky" href="https://s3.console.aws.amazon.com/s3/home" rel="noopener ugc nofollow" target="_blank"> S3控制台</a>中与项目相关的桶。为了防止Amplify中的数据丢失，进而防止云形成，它们不会被自动删除。</p><p id="193d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，Amplify创建的用于部署资源的IAM用户在调用delete命令后将会离开。你可以在你的<a class="ae ky" href="https://console.aws.amazon.com/iamv2/home?#/users" rel="noopener ugc nofollow" target="_blank"> IAM仪表盘</a>中找到它，你必须手动删除它。</p><h1 id="1ea8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">定价呢？</h1><p id="72cf" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果你曾经使用过Firebase或Heroku之类的服务，你可能会知道，简化开发人员与云的交互的解决方案可能会变得很昂贵，尤其是在以后扩大规模的时候。通常，这些解决方案是作为完全独立的服务构建的，专门用于一个目的:使云更易于使用。</p><p id="dbb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AWS和Amplify走的是不同的方向。它建立在你已经知道的AWS基础设施服务上，所以你必须支付与你在没有Amplify的情况下使用这些服务相同的费用。由于它使用的服务是无服务器的，它们都提供按需支付选项。如果你建立了一个没人想用的系统，你就不用为没用的资源买单了。</p><p id="0d5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你开发了一个基于Amplify的应用，看看<a class="ae ky" href="https://calculator.aws/#/" rel="noopener ugc nofollow" target="_blank">的AWS价格计算器</a>来估算一下你会花多少钱。无论有无Amplify，所有资源都遵循相同的定价模式。</p><h1 id="efcf" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">摘要</h1><p id="6f24" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">AWS Amplify是实现无服务器基础设施的一种令人兴奋的方法。它主要迎合前端和移动开发者，所以即使你手头没有足够的全栈或后端开发者，它的项目也可以维护。</p><p id="6fbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Amplify与Firebase等解决方案的不同之处在于，Amplify只是现有无服务器AWS服务之上的一个抽象层。除了管理应用程序的Amplify控制台和Amplify Admin UI，它没有引入特殊服务来运行应用程序。这也是为什么使用Amplify运行应用程序的成本与手动配置所有底层服务的成本相同。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="3d5e" class="no lw it nj b gy np nq l nr ns"><strong class="nj iu">Want to Connect With the Author?</strong></span><span id="a01a" class="no lw it nj b gy nt nq l nr ns">For our latest insights and updates, <a class="ae ky" href="https://www.linkedin.com/company/codersociety" rel="noopener ugc nofollow" target="_blank">follow us on LinkedIn</a></span></pre></div></div>    
</body>
</html>