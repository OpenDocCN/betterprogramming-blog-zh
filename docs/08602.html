<html>
<head>
<title>Build a Command Line Tool Using Swift Argument Parser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Swift参数解析器构建命令行工具</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-command-line-tool-using-swift-argument-parser-f7d9443b785?source=collection_archive---------5-----------------------#2021-05-19">https://betterprogramming.pub/build-a-command-line-tool-using-swift-argument-parser-f7d9443b785?source=collection_archive---------5-----------------------#2021-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e1eb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用SPM和参数解析器创建结构良好的CLI应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c8815cc01c3acca7d2c7cc3085431672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3Wi3al8oRxWou8nu"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@athulca?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿苏尔·西里亚克·阿杰</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="722d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Swift是一种非常全面的语言，并且每天都在被更多地使用。它主要用于iOS和macOS应用程序，但也用于脚本、命令行工具(CLI)，甚至用于<a class="ae ky" href="https://vapor.codes/" rel="noopener ugc nofollow" target="_blank">后端</a>和<a class="ae ky" href="https://github.com/pointfreeco?q=html&amp;type=&amp;language=&amp;sort=" rel="noopener ugc nofollow" target="_blank"> web开发</a>。</p><p id="f7f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将探索由苹果公司提供的一个库来创建一个CLI应用程序:Swift参数解析器。这个库封装了在终端中发布命令时解析用户输入的逻辑。该库通过使用属性包装器来实现这一点。Swift的类型系统使一切安全。</p><p id="e8cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">多亏了这个库，我们现在可以将注意力集中在工具的实际逻辑上，而不是浪费时间在如何解析这些输入上。</p><h1 id="d4fd" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建项目</h1><p id="ee28" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">让我们从创建一个新项目开始。我们可以使用Swift包管理器 (SPM)以编程和声明的方式创建项目。</p><p id="d252" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了Xcode 12.5，我们甚至不再需要<code class="fe ms mt mu mv b">xcodeproj</code>文件:Xcode现在可以通过直接读取<code class="fe ms mt mu mv b">Package.swift</code>文件来创建项目。</p><p id="e863" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建新项目，让我们按照以下步骤操作:</p><ol class=""><li id="5f65" class="mw mx it lb b lc ld lf lg li my lm mz lq na lu nb nc nd ne bi translated">打开一个终端。</li><li id="854a" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">新建一个文件夹:<code class="fe ms mt mu mv b">mkdir Calc</code>。</li><li id="9b06" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">移动到新文件夹:<code class="fe ms mt mu mv b">cd Calc</code>。</li><li id="0dee" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">运行软件包初始化:<code class="fe ms mt mu mv b">swift package init --name Calc --type executable</code>。</li><li id="7722" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">用Xcode: <code class="fe ms mt mu mv b">open Package.swift</code>打开<code class="fe ms mt mu mv b">Package.swift</code>文件。</li></ol><p id="71ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这几行代码创建了一个新的Xcode项目，这是一个适用于Mac的命令行应用程序。现在让我们打开Xcode中的<code class="fe ms mt mu mv b">Package.swift</code>文件，添加Swift参数解析器依赖项。</p><p id="4779" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果文件应该如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="35ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第6行添加了参数解析器库作为依赖项。这个包是直接从GitHub获取的。然后，我们通过在<code class="fe ms mt mu mv b">dependencies</code>字段(第15行和第16行)中指定主目标来连接依赖项。</p><p id="4cfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第16行的产品的<code class="fe ms mt mu mv b">name</code>是我们将用于在Swift文件中<code class="fe ms mt mu mv b">import</code>包裹的信息。对于这个项目，我选择称之为<code class="fe ms mt mu mv b">ArgumentParser</code>。</p><h1 id="4b01" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建主</h1><p id="facb" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果我们现在运行应用程序，我们可以看到<code class="fe ms mt mu mv b">main</code>只是打印“Hello，World！”到控制台。让我们通过使用参数解析器使它稍微有趣一点。</p><p id="3447" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们导入新的库并创建<code class="fe ms mt mu mv b">Command</code>名称空间。这个名称空间是实现<a class="ae ky" href="https://en.wikipedia.org/wiki/Command_pattern" rel="noopener ugc nofollow" target="_blank">命令模式</a>的基础。这个模式定义了我们工具的架构。</p><p id="a86b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在命令名称空间中，我们可以创建一个符合<code class="fe ms mt mu mv b"><a class="ae ky" href="https://github.com/apple/swift-argument-parser/blob/main/Sources/ArgumentParser/Parsable%20Types/ParsableCommand.swift" rel="noopener ugc nofollow" target="_blank">ParsableCommand</a></code>协议的<code class="fe ms mt mu mv b">Main</code>结构。这是参数解析器库的入口点，为我们提供了许多实用工具和自动化。</p><p id="83c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须实现的唯一需求是一个静态的<code class="fe ms mt mu mv b"><a class="ae ky" href="https://github.com/apple/swift-argument-parser/blob/main/Sources/ArgumentParser/Parsable%20Types/CommandConfiguration.swift" rel="noopener ugc nofollow" target="_blank">configuration</a></code> var，库用它来读取一些信息。</p><p id="7430" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们只需实例化<code class="fe ms mt mu mv b">Main</code>结构，并在其上调用<code class="fe ms mt mu mv b">main</code>函数。这是整个app的切入点。最终代码如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="621f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们现在运行这个程序，我们会得到一个非常有趣的输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/57a9b2a94c4a0ab1e7ad76311e1879aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zMZlVnevuI9KZGzUseBg1w.png"/></div></div></figure><p id="7aab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们可以看到有一个格式很好的帮助。我们没有编写它，但是参数解析器库为我们处理了这个问题。其次，已经有几个免费实现的命令:<code class="fe ms mt mu mv b">--version</code>和<code class="fe ms mt mu mv b">--help</code>。</p><p id="73c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ms mt mu mv b">--version</code>选项只返回我们在配置的<code class="fe ms mt mu mv b">version</code>属性中指定的内容。<code class="fe ms mt mu mv b">--help</code>选项打印出与我们在这里看到的相同的输出。</p><p id="246f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了测试我们的命令，我们需要知道如何通过Xcode向我们的应用程序传递一些参数。我们可以通过方案描述中的命令行参数面板来实现这一点。</p><ol class=""><li id="d8a4" class="mw mx it lb b lc ld lf lg li my lm mz lq na lu nb nc nd ne bi translated">点击Xcode的“播放”和“停止”按钮右侧的计算名称。</li><li id="38aa" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">选择“编辑方案...”。</li><li id="3924" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">选择运行。</li><li id="0a0e" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">选择“参数”选项卡。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/7451d348b4213fa4e8f80a03f3d10533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cSatN7YHwnrAdKr6_fRKng.png"/></div></div></figure><p id="3fd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们可以使用+和-按钮添加或删除任何参数。</p><p id="1f1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> Pro提示:</strong>我们可以在同一行传递多个参数。我们不局限于一次一个论点。</p><h1 id="5468" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">执行第一个命令</h1><p id="ab72" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们的第一个命令是<code class="fe ms mt mu mv b">Add</code>命令。它取两个数并求和。</p><p id="87d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以创建一个新的Swift文件，并将其命名为<code class="fe ms mt mu mv b">Add</code>。这个文件将扩展<code class="fe ms mt mu mv b">Command</code>名称空间，添加一个新的<code class="fe ms mt mu mv b">ParsableCommand</code>结构。</p><p id="48ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个结构必须实现<code class="fe ms mt mu mv b">run()</code>方法。这是ArgumentParser库在解析<code class="fe ms mt mu mv b">add</code>命令时调用的方法。</p><p id="5413" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像任何其他<code class="fe ms mt mu mv b">ParsableCommand</code>一样，<code class="fe ms mt mu mv b">Add</code>命令也必须进行配置。在标准配置之后，我们可以添加几个属性，<code class="fe ms mt mu mv b">factor1</code>和<code class="fe ms mt mu mv b">factor2</code>，用<code class="fe ms mt mu mv b">@Argument</code>属性包装器进行注释。属性包装定义了运行该命令所需的参数。</p><p id="ba43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="80d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令需要添加到<code class="fe ms mt mu mv b">Main</code>结构中。添加它的适当位置是将命令附加到<code class="fe ms mt mu mv b">subcommand</code>属性。如果我们忘记了它，我们的程序将不能运行这个新命令，因为它不知道它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">注意第13行有新的Add命令。</p></figure><p id="86eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们在没有参数的情况下运行应用程序，Help会告诉我们一个新的子命令已经创建并可供使用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/90f880636a37ec93b3160715586c658d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mTYCqKNJmEUqlc_bJkBBhA.png"/></div></div></figure><p id="7a8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们可以从“编辑方案...”中插入一些新的参数。屏幕。例如，我们可以尝试将5和10相加。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/78e332dfbe12f8b6a7a611c5ff1b6361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L4wnK53E2nulRuxPRsE0pA.png"/></div></div></figure><p id="3cb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们运行我们的CLI应用程序，我们将获得以下输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/501e59a056423d1e0d59523d65b38496.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*80CbeLkqsarkQVZH0-X-qA.png"/></div></div></figure><h1 id="60b3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="d492" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">本周，我们探讨了如何使用SPM并利用由<a class="ae ky" href="https://github.com/apple/swift-argument-parser" rel="noopener ugc nofollow" target="_blank"> Swift Argument Parser </a>库提供的一些自动化来创建CLI应用程序。</p><p id="2bc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们研究了如何使用<a class="ae ky" href="https://en.wikipedia.org/wiki/Command_pattern" rel="noopener ugc nofollow" target="_blank">命令模式</a>构建我们的应用程序，以及如何实现我们的第一个命令。</p><p id="aed6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参数解析器库提供的远不止这些。它提供了参数的自动验证，指定标志和选项的可能性，并让我们将常见的选项组合在一起。</p><p id="ced0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下周我们将探讨这些更高级的话题，敬请关注！</p></div></div>    
</body>
</html>