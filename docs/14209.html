<html>
<head>
<title>Creating a Modern TypeScript/JavaScript Library With tsup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用tsup创建一个现代的类型脚本/JavaScript库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/creating-a-modern-typescript-javascript-library-with-tsup-ae55cbcae58b?source=collection_archive---------1-----------------------#2022-11-17">https://betterprogramming.pub/creating-a-modern-typescript-javascript-library-with-tsup-ae55cbcae58b?source=collection_archive---------1-----------------------#2022-11-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8643" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">tsup由esbuild提供支持</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/515d84dd8dc2f116799b761f77b1a5cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*H5N7EG3IsN2GnZQR.jpg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">照片由<a class="ae ku" href="https://www.pexels.com/de-de/@rsantos1232?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">罗德里戈·桑多斯</a>从<a class="ae ku" href="https://www.pexels.com/de-de/foto/arbeitsplatz-mit-modernem-laptop-mit-programmcode-auf-dem-bildschirm-3888151/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">佩克斯</a>拍摄</p></figure><p id="c3f9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在是开发人员的大好时机，尤其是对于JavaScript。JavaScript生态系统既庞大又令人兴奋，开源项目也随着一个接一个的创新工具不断发展。我们有像<a class="ae ku" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> react </a>这样的库用于开发复杂的用户界面，有像<a class="ae ku" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> next </a>这样的框架用于构建服务器端渲染应用，有<a class="ae ku" href="https://gatsbyjs.com/" rel="noopener ugc nofollow" target="_blank"> gatsby </a>用于静态web应用，有<a class="ae ku" href="https://lerna.js.org/" rel="noopener ugc nofollow" target="_blank"> lerna </a>以及<a class="ae ku" href="https://turbo.build/repo" rel="noopener ugc nofollow" target="_blank">turborrepo</a>用于<a class="ae ku" href="https://en.wikipedia.org/wiki/Monorepo" rel="noopener ugc nofollow" target="_blank"> monorepos </a>等。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="7e3b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">提交bug修复请求或提出新想法通常是开发人员对令人兴奋的开源项目做出贡献的第一直觉。我们也可以选择开始我们自己的开源项目。如果你打算开始你自己的开源JavaScript库，那么这篇文章就是为你准备的。</p><p id="3bb7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">对于那些好奇但没有听说过<a class="ae ku" href="https://github.com/egoist/tsup" rel="noopener ugc nofollow" target="_blank"> tsup </a>的人来说，我们将浏览这个现代的、健壮的JavaScript工具(一个更新的捆绑工具，是流行的<a class="ae ku" href="https://rollupjs.org/guide/en/" rel="noopener ugc nofollow" target="_blank"> rollup </a>的替代工具)来自己创建一个JavaScript库，然后提交给npm registry让其他人<code class="fe ly lz ma mb b">npm install</code>进入他们自己的项目。我们的代码示例将关注于<a class="ae ku" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank">类型脚本</a>，它是JavaScript的超集。</p><p id="a33b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">tsup由<a class="ae ku" href="https://esbuild.github.io/api/#pure" rel="noopener ugc nofollow" target="_blank"> esbuild </a>提供支持，这是一个速度极快的现代JavaScript捆绑器，速度极快，不需要缓存。这是一个捆绑你的类型脚本库的工具，不需要任何配置。它可以捆绑node.js平台内部支持的任何文件，包括<code class="fe ly lz ma mb b">.js</code>、<code class="fe ly lz ma mb b">.json</code>、<code class="fe ly lz ma mb b">.mjs</code>、<code class="fe ly lz ma mb b">.ts</code>、<code class="fe ly lz ma mb b">.tsx</code>，在撰写本文时对<code class="fe ly lz ma mb b">.css</code>提供了实验性支持。</p><p id="95cb" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">首先，启动一个终端并创建一个新目录(可以随意命名)。之后，通过在终端中输入<code class="fe ly lz ma mb b">cd</code>在终端中输入目录。对于本文，我们称之为<code class="fe ly lz ma mb b">my-typescript-library</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="ccfa" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们将需要一个<code class="fe ly lz ma mb b">package.json</code>,因此请在终端中输入<code class="fe ly lz ma mb b">npm init -y</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="2a94" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这将立即用默认设置创建一个<code class="fe ly lz ma mb b">package.json</code>文件。</p><p id="c818" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">直接创建一个名为<code class="fe ly lz ma mb b">src</code>的，然后在该目录下创建一个名为<code class="fe ly lz ma mb b">index.ts</code>的新文件。这个文件是我们图书馆的入口点。</p><p id="cca1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">由于我们将使用<code class="fe ly lz ma mb b">tsup</code>，我们需要将其作为开发依赖项安装:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="1bd4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">由于我们在<code class="fe ly lz ma mb b">src/index.ts</code>创建的文件将是我们库的入口点，我们需要指示<code class="fe ly lz ma mb b">tsup</code>消费这些文件，并将它们输出到某个地方(我们将输出目录设置为<code class="fe ly lz ma mb b">./dist</code>)。</p><p id="54d5" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">继续修改<code class="fe ly lz ma mb b">package.json</code>并在<code class="fe ly lz ma mb b">scripts</code>属性下添加<code class="fe ly lz ma mb b">build</code>和<code class="fe ly lz ma mb b">start</code>行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="274f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在，当我们运行<code class="fe ly lz ma mb b">npm run build</code>时，tsup编译器将消耗<code class="fe ly lz ma mb b">src/index.ts</code>并将文件自动编译到<code class="fe ly lz ma mb b">./dist</code>目录:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/4b8d4fe267edfb249632ee72709452d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HIN790G4G_PrN8nB.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/9f36f08eebdf04590a8be0ab4c87f1b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/0*x98FLTLmxR2jnkVy.png"/></div></figure><p id="d4b4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">默认情况下，<code class="fe ly lz ma mb b">tsup</code>向<code class="fe ly lz ma mb b">./dist</code>发送输出文件，但是我们可以用一个配置文件来配置它，我们很快就会看到这个文件。</p><p id="516d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果我们在<code class="fe ly lz ma mb b">./dist/index.js</code>查看生成的文件，我们将会看到空的内容。那是因为我们还没有为我们的库编写任何代码。</p><p id="975c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们继续输入一些基本代码，以便我们可以更详细地分析输出:</p><blockquote class="mk ml mm"><p id="d2c0" class="kv kw mn kx b ky kz ju la lb lc jx ld mo lf lg lh mp lj lk ll mq ln lo lp lq im bi translated"><code class="fe ly lz ma mb b"><em class="it">src/index.ts</em></code></p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="2333" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">再次运行<code class="fe ly lz ma mb b">npm run build</code>，注意<code class="fe ly lz ma mb b">tsup</code>是如何将我们的代码传输到ES5的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mr"><img src="../Images/b07428df565921ff1c0b1ae7c741f027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QtoCVgqh8WbhA7Z-.png"/></div></div></figure><p id="258c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们用下面的代码创建一个名为<code class="fe ly lz ma mb b">client.js</code>的文件来测试我们的库:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="dddb" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在终端输入<code class="fe ly lz ma mb b">node client.js</code>运行文件。您应该看到这个:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ms"><img src="../Images/ff2a646c7f27188ba3ae5c5f88f62daa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZvpErj4bxdbWmhDO.png"/></div></div></figure><p id="dd8f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">太好了！我们的图书馆运转完美。</p><p id="0b95" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们可以用<code class="fe ly lz ma mb b">tsup</code>做更多的事情，这一切都始于一个配置文件，在运行时<code class="fe ly lz ma mb b">tsup</code>会自动使用这个文件。用以下内容创建一个<code class="fe ly lz ma mb b">tsup.config.ts</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="eb8b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">有了这个配置文件，我们可以指示<code class="fe ly lz ma mb b">tsup</code>编译器做不同的事情。</p><p id="35c3" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">例如，我们可以通过将<code class="fe ly lz ma mb b">dts</code>设置为<code class="fe ly lz ma mb b">true</code>来指示它生成TypeScript声明文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="cc9c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">对于这个设置，我们需要将<code class="fe ly lz ma mb b">typescript</code>安装到我们的项目中，否则我们会收到一个错误:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="6ac0" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当我们再次运行<code class="fe ly lz ma mb b">npm run build</code>时，它将生成一个附加文件，该文件包含声明类型:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mt"><img src="../Images/b1c5d5fef2ff081b7b76e5093e59cfae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_9q8lWriLx-ekzlX.png"/></div></div></figure><p id="3bee" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们还可以生成源映射，以帮助在调试中生成更准确的堆栈跟踪:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mc md l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mu"><img src="../Images/c6ffa603386dc285657a4605f02408df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_38S8n9AyQu4FCm9.png"/></div></div></figure><p id="2c22" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">客户端代码现在将能够通过在其IDE中获得TypeScript提示(如VS代码)而从我们的库中受益更多:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mv"><img src="../Images/7efb281bedeba81d2ea96520380b2043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fP4MhqGnc8toZyMC.png"/></div></div></figure><p id="5e9a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">库作者遇到的一个问题是能够支持不同的格式供客户使用。有几种常见的格式:</p><p id="927f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">| Format | Description | |—|—| —————————————| life |立即调用函数表达式(针对浏览器)| | cjs | CommonJS | | esm | ECMAScript模块|</p><p id="e9e1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们可以轻松地配置<code class="fe ly lz ma mb b">tsup</code>来生成所有这三种格式，只需对配置进行简单的一行更新:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mc md l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mw"><img src="../Images/de3c75ec2916f946ac8fa0053db4da89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eg3TwfnIYjqo-xUQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/a12aa92d29132b61ab5019c53b25f178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/0*cikt4U6eY6WBwyWr.png"/></div></figure><p id="ff66" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在我们的<code class="fe ly lz ma mb b">client.js</code>文件中，我们可以毫无问题地使用我们的库。然而，为了让用户导入与其项目使用的格式相对应的文件，我们需要编辑我们的<code class="fe ly lz ma mb b">package.json</code>以指向特定格式的正确文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi my"><img src="../Images/4c5e9bff9bf483edc68dad3d0d8b5bda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7pYjopdyrItWp1EI.png"/></div></div></figure><p id="4cc1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">要阅读更多关于<code class="fe ly lz ma mb b">exports</code>如何工作的内容，你可以<a class="ae ku" href="https://nodejs.org/dist/latest-v18.x/docs/api/packages.html#package-entry-points" rel="noopener ugc nofollow" target="_blank">点击这里</a>进入官方的nodejs文档，因为这超出了本文的范围。</p><p id="a2a1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们现在已经介绍了创建一个最小的现代JavaScript/TypeScript库的建议要求！接下来我们需要做的唯一一件事就是将我们的包发布到npm注册中心，这样用户就可以<code class="fe ly lz ma mb b">npm install</code>我们的包了。</p><p id="2501" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">为此，给<code class="fe ly lz ma mb b">package.json</code>添加一个<code class="fe ly lz ma mb b">publishConfig</code>键，并在其中设置<code class="fe ly lz ma mb b">access</code>为<code class="fe ly lz ma mb b">"public"</code>，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="2bea" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在终端中输入<code class="fe ly lz ma mb b">npm publish</code>，您应该会看到类似这样的内容(用您的包名替换<code class="fe ly lz ma mb b">my-typescript-library</code>):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mz"><img src="../Images/da0aaa548e15eca39f39a2ee650d349b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AOded10H2OpynIJ9.png"/></div></div></figure><p id="1f93" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">就是这样！</p><p id="3de0" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">要获得这篇文章的源代码，<a class="ae ku" href="https://github.com/jsmanifest/my-typescript-library" rel="noopener ugc nofollow" target="_blank">点击这里</a></p><h1 id="e30c" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">结论</h1><p id="258b" class="pw-post-body-paragraph kv kw it kx b ky ns ju la lb nt jx ld le nu lg lh li nv lk ll lm nw lo lp lq im bi translated">我希望你发现这是有价值的，并期待在未来更多！</p></div></div>    
</body>
</html>