<html>
<head>
<title>React, WebViews, and How to Communicate With JavaScript on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React，WebViews，以及如何在Android上与JavaScript通信</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/react-webviews-and-how-to-communicate-with-javascript-on-android-70543c35d37d?source=collection_archive---------4-----------------------#2020-05-20">https://betterprogramming.pub/react-webviews-and-how-to-communicate-with-javascript-on-android-70543c35d37d?source=collection_archive---------4-----------------------#2020-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="960b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何调用简化的JavaScript函数</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e78a2ca4b68faa3d5a6c296c06a6ca84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d74rVRHmYxQA20xVPhjawQ.png"/></div></div></figure></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="b925" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated">介绍</h1><p id="f1fe" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">WebView是一个用于在Android应用程序中呈现网页的组件。如果你想显示一些内容(例如，你的站点)并且想让它看起来像是应用程序的一部分，这是非常有用的。</p><p id="a7cb" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">在某些情况下，开发人员只需要显示一些信息，而不需要与Android应用程序进行任何交互。</p><p id="9522" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">但有时这还不够，开发人员应该在JavaScript和Kotlin之间实现一座沟通的桥梁:例如，当用户点击应用程序中的某个按钮时，您可能希望调用一个JavaScript函数。</p><p id="dfbe" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">在我的例子中，我需要使用WebView，因为有些JavaScript代码我不想在Kotlin上实现。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/d191e4f624cba0dc67ab655cc36ac72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zQ1y4OysocqQFWleGyxJgQ.png"/></div></div><p class="ms mt gj gh gi mu mv bd b be z dk translated"><a class="ae mw" href="https://developer.android.com/reference/android/webkit/WebView" rel="noopener ugc nofollow" target="_blank">信号源</a></p></figure><p id="746d" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">上面四样东西是用来通过WebView加载内容的。使用最广泛的当然是<code class="fe mx my mz na b">loadUrl</code>，因为通常内容是在服务器的某个地方提供的。</p></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="3eef" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated">互动的类型</h1><p id="d26f" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">实际上，JavaScript(通过WebView)和Android应用程序之间有两种类型的交互:</p><ul class=""><li id="db74" class="nb nc iq ls b lt mm lw mn lz nd md ne mh nf ml ng nh ni nj bi translated">从JavaScript调用Kotlin函数</li><li id="34ea" class="nb nc iq ls b lt nk lw nl lz nm md nn mh no ml ng nh ni nj bi translated">从Kotlin调用JavaScript函数</li></ul></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="b343" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated">用JavaScript调用Kotlin函数</h1><p id="6fa8" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">用JS调用Kotlin函数需要做的事情有:</p><ul class=""><li id="3d4e" class="nb nc iq ls b lt mm lw mn lz nd md ne mh nf ml ng nh ni nj bi translated">写一个特殊的接口</li><li id="894d" class="nb nc iq ls b lt nk lw nl lz nm md nn mh no ml ng nh ni nj bi translated">将其添加到WebView</li><li id="29b6" class="nb nc iq ls b lt nk lw nl lz nm md nn mh no ml ng nh ni nj bi translated">从JS调用一个接口函数</li></ul><p id="382b" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">首先，我们创建一个特殊的接口。姑且称之为<code class="fe mx my mz na b">AndroidJSInterface</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="ee38" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">如您所见，一个将从JavaScript调用的函数有一个特殊的注释<code class="fe mx my mz na b">@JavascriptInterface</code>，它向WebView表明这个函数可以从JS调用。</p><p id="b645" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">接下来要做的是将这个界面添加到WebView中。这里我们将其命名为<code class="fe mx my mz na b">Android</code>，不过你可以随意命名。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="40ee" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">现在我们需要从JS代码中调用这个函数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="8b9d" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated">从Kotlin调用JavaScript函数</h1><p id="727b" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">在大多数情况下，调用JavaScript也非常简单:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="a02c" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">所以这里我们调用一个名为<code class="fe mx my mz na b">callingFunction()</code>的函数。</p><h2 id="d086" class="nr kz iq bd la ns nt dn le nu nv dp li lz nw nx lk md ny nz lm mh oa ob lo oc bi translated"><strong class="ak">但是如果JavaScript被缩小了呢？</strong></h2><p id="6263" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">有各种各样的JavaScript minifiers:例如，React的生产版本使用minified JS。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/766932c643e45dd6209d01015c6744c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*vbC1mpAWH8eVaF76NsutLg.png"/></div><p class="ms mt gj gh gi mu mv bd b be z dk translated">缩小后的JS是什么样子</p></figure><p id="e030" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">问题是在缩小后，函数名被改变了，这就是为什么你不能直接调用它们。</p><p id="b9e2" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">我的第一个想法是以某种方式在config中注明跳过优化某些函数，以便保存它们的名称，但是没有办法做到这一点。</p><p id="6651" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">另一个想法是重新命名这个函数，以便保存它的名字，但是这太费时间了。</p><h2 id="c54f" class="nr kz iq bd la ns nt dn le nu nv dp li lz nw nx lk md ny nz lm mh oa ob lo oc bi translated"><strong class="ak">这里有一个解决方案</strong></h2><ol class=""><li id="6e16" class="nb nc iq ls b lt lu lw lx lz oe md of mh og ml oh nh ni nj bi translated">在JavaScript代码中添加一个特殊的事件监听器，并在调度事件时调用一个函数。</li><li id="f1eb" class="nb nc iq ls b lt nk lw nl lz nm md nn mh no ml oh nh ni nj bi translated">从Android调度事件。</li></ol><blockquote class="oi oj ok"><p id="0a2d" class="lq lr ol ls b lt mm jr lv lw mn ju ly om mo mb mc on mp mf mg oo mq mj mk ml ij bi translated">“<code class="fe mx my mz na b"><strong class="ls ir">Event</strong></code>接口表示发生在DOM中的事件。</p><p id="8d2a" class="lq lr ol ls b lt mm jr lv lw mn ju ly om mo mb mc on mp mf mg oo mq mj mk ml ij bi translated">事件可以由用户操作触发，例如单击鼠标按钮或敲击键盘，或者由API生成以表示异步任务的进度。它也可以通过编程来触发，比如调用元素的<code class="fe mx my mz na b"><a class="ae mw" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/click" rel="noopener ugc nofollow" target="_blank">HTMLElement.click()</a></code>方法，或者定义事件，然后使用<code class="fe mx my mz na b"><a class="ae mw" href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent" rel="noopener ugc nofollow" target="_blank">EventTarget.dispatchEvent()</a></code>将其发送到指定的目标。"</p><p id="4158" class="lq lr ol ls b lt mm jr lv lw mn ju ly om mo mb mc on mp mf mg oo mq mj mk ml ij bi translated">— <a class="ae mw" href="https://developer.mozilla.org/en-US/docs/Web/API/Event" rel="noopener ugc nofollow" target="_blank"> MDN网络文档</a></p></blockquote><p id="8e6b" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">这里我们调度一个名为<code class="fe mx my mz na b">event</code>的事件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="2b1d" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">这里我们添加了一个监听器，并在<code class="fe mx my mz na b">event</code>发生时做一些事情。</p><p id="2871" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">例如，我们可以调用我们想要调用的函数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="a054" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated">结论</h1><p id="626f" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">使用<code class="fe mx my mz na b">loadUrl</code>函数和作为参数传递的站点URL将站点加载到WebView中。</p><h2 id="d07e" class="nr kz iq bd la ns nt dn le nu nv dp li lz nw nx lk md ny nz lm mh oa ob lo oc bi translated"><strong class="ak">你可以从Kotlin调用一个JavaScript函数</strong></h2><ul class=""><li id="87b7" class="nb nc iq ls b lt lu lw lx lz oe md of mh og ml ng nh ni nj bi translated">直接通过它的名字使用<code class="fe mx my mz na b">javascript:functionName()</code>传递给<code class="fe mx my mz na b">loadUrl</code>函数</li><li id="5931" class="nb nc iq ls b lt nk lw nl lz nm md nn mh no ml ng nh ni nj bi translated">使用事件:调用<code class="fe mx my mz na b">evalutateJavascript</code>函数，将一个特殊的东西作为参数传递</li></ul><h2 id="2589" class="nr kz iq bd la ns nt dn le nu nv dp li lz nw nx lk md ny nz lm mh oa ob lo oc bi translated"><strong class="ak">你可以从JavaScript调用Kotlin函数</strong></h2><ul class=""><li id="1a94" class="nb nc iq ls b lt lu lw lx lz oe md of mh og ml ng nh ni nj bi translated">写一个用<code class="fe mx my mz na b">@JavascriptInterface</code>注释的特殊函数</li><li id="061b" class="nb nc iq ls b lt nk lw nl lz nm md nn mh no ml ng nh ni nj bi translated">调用<code class="fe mx my mz na b">addJavascriptInterface</code>，传递一个内部有特殊函数的对象作为参数，并以某种方式命名(比如“Android”)</li><li id="cd68" class="nb nc iq ls b lt nk lw nl lz nm md nn mh no ml ng nh ni nj bi translated">使用<code class="fe mx my mz na b">window.Android.functionName();</code>从JavaScript调用函数</li></ul><p id="35d7" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">编码愉快，伙计们。感谢您阅读文章。</p></div></div>    
</body>
</html>