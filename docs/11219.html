<html>
<head>
<title>Build a Home Automation With ESP-32 and Relay Modules — Control Lights, Fans, and Appliances From a Phone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ESP-32和继电器模块构建家庭自动化——通过手机控制灯、风扇和电器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-home-automation-with-esp-32-and-relay-modules-control-lights-fans-and-appliances-from-a-572a060e926f?source=collection_archive---------6-----------------------#2022-02-28">https://betterprogramming.pub/build-a-home-automation-with-esp-32-and-relay-modules-control-lights-fans-and-appliances-from-a-572a060e926f?source=collection_archive---------6-----------------------#2022-02-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="44cd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过一些编码，我以8美元的价格制作了我的家用电器</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/43c21518fd5729b6e8243746a0b64162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y3E9EuXaWohK-3YpFw3NEQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带ESP32和继电器模块的家庭自动化。图片:Self和<a class="ae ky" href="https://www.canva.com/" rel="noopener ugc nofollow" target="_blank"> Canva </a>。</p></figure><p id="3061" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我是一个懒惰的家伙。我不喜欢起床。所以我必须想办法在上床后把灯关掉。不，我床边没有开关。所以，不得不集思广益来解决这个问题。</p><p id="dfb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的一个想法是做一个加长开关，但我不喜欢电线挂在我的床顶上的天花板上。另外，如果有一天保护涂层从电线上脱落，我可不想被电死。</p><p id="bf9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">剩下的唯一选择就是建造一个遥控系统。然后，我想制作一个带有红外发射器和接收器的遥控器。但后来，我认为制作一个看起来也很好的遥控器会非常累。另外，我没有3D打印机来制作遥控器的外壳。</p><p id="ff19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那是我想把手机当遥控器用的时候。挑战是建立一个可以在我的手机上显示的界面，它将是交互式的，并将控制一个充当开关的继电器模块。</p><p id="7130" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想到了使用ESP32构建一个WiFi接入点来托管交互式网页作为界面。所以我立刻买了所有的部件。这里列出了所有需要的组件:</p><ul class=""><li id="7f0d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">ESP32</li><li id="d19f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">5V继电器模块</li><li id="85ee" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">试验板</li><li id="bac9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">跳线</li></ul><p id="d91a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样。</p><p id="c5b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我买的是ESP32开发板，但是你也可以买ESP Wroom 32板。然后，用跳线，我在试验板上做了连接。我连接了两个电器(本例中是两个灯泡)。</p><p id="e8ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是电路图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/b35f334e482788a54e9be823325106d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ihoYzYi4EhHmgljFUXbCcg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带ESP32和继电器模块的家庭自动化电路图。图片:自我。</p></figure><h1 id="e22c" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated"><strong class="ak">理论</strong></h1><p id="cf01" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">一个继电器模块共有6个引脚。VCC、GND、信号、常开(NO)、常闭(NC)和公共触点(CC)。在这里，我使用了一个2继电器模块，所以，VCC和GND引脚是相同的两个继电器。引脚In1和In2分别是第一和第二继电器的信号引脚。</p><p id="4de5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">In1和In2引脚分别与GPIO12和GPIO13引脚相连。ESP32电路板的引脚编号可在电路板上找到。</p><p id="3969" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">公共连接引脚必须与电源连接。对于我的家用电器，我在这里使用交流电源。交流电源的一条线直接与设备相连。另一条线进入公共连接引脚。</p><p id="2e47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，是否从NO或NC引出一条线来连接设备，取决于您是想将继电器用作“高电平有效”还是“低电平有效”。</p><h2 id="e52a" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated"><strong class="ak">低电平有效</strong></h2><p id="6087" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">“低电平有效”意味着当其逻辑电平为0时，信号将执行其功能。</p><h2 id="7ba0" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated"><strong class="ak">高电平有效</strong></h2><p id="53ba" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">“低电平有效”意味着当其逻辑电平为1时，信号将执行其功能。</p><p id="9eda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当信号引脚中的输入为低电平或0时，常开(NO)端口常开。这意味着，如果我们不向信号引脚发送正信号，如果与常开引脚连接，电器将保持打开，即继电器充当打开的开关。</p><p id="75ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是在同样的情况下，常闭销保持闭合。它就像一个关闭的开关。</p><p id="ba03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果我们在signal引脚中发送一个正信号或1，常闭引脚将充当一个打开的开关，常开引脚将充当一个关闭的开关。</p><h2 id="b686" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">使用低电平有效</h2><p id="6d65" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">现在，要使用低电平有效，我们必须将常开引脚与器件相连，因为当信号引脚上的输入为低电平时，它充当有源开关(打开的开关)。</p><p id="7976" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了保持开关闭合，我们必须保持信号引脚的输入为高电平(我们通过代码做到了这一点)。</p><h2 id="9116" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">WiFi接入点</h2><p id="a5c3" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们可以用ESP32创建一个WiFi接入点。然后，我们可以将手机连接到该接入点，就像我们将手机连接到任何WiFi一样。</p><p id="4fe5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以托管一个带有开关和这些开关的逻辑的网页，以控制来自ESP32的输出，该输出作为继电器模块的信号引脚的输入。我们将使用ESP32的GPIO12引脚的输出作为继电器模块的In1引脚(第一个继电器的信号引脚)的输入，使用ESP32的GPIO13引脚作为继电器模块的In2引脚(第二个继电器的信号引脚)的输入。</p><h1 id="0a52" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">密码</h1><p id="36e4" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我定义了一个SSID名称和一个密码来访问ESP32。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="bc49" class="nh ml it nu b gy ny nz l oa ob">const char* ssid = "My Home Appliances";<br/>const char* password = "ABCD2021";</span></pre><p id="f49c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在函数<em class="oc"> setup()，</em>内部，为了将ESP32设置为接入点，我们使用了softAP()方法。不要为开放的接入点传递密码参数(不安全)。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="4ca7" class="nh ml it nu b gy ny nz l oa ob">WiFi.softAP(ssid, password);</span></pre><p id="d476" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有其他可选参数可以传递给softAP()方法。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="bb7d" class="nh ml it nu b gy ny nz l oa ob">WiFi.softAP(const char* ssid, const char* password, int channel, int ssid_hidden, int max_connection)</span></pre><ul class=""><li id="33b4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">频道:Wi-Fi频道号(1–13)</li><li id="1d09" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">ssid_hidden: (0 =广播ssid，1 =隐藏SSID)</li><li id="5129" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">max_connection:同时连接的最大客户端数量(1–4)</li></ul><p id="2b2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要使用<em class="oc"> softAPIP() </em>方法获取接入点IP地址，并在串行监视器中打印出来。一旦我们的手机(或任何设备)连接到WiFi接入点，我们就可以通过从任何浏览器打开这个IP地址作为URL来访问网页。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="8570" class="nh ml it nu b gy ny nz l oa ob">IPAddress IP = WiFi.softAPIP();  <br/>Serial.print("Access Point IP address: ");  <br/>Serial.println(IP);</span></pre><p id="3890" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">串行监视器的输出如下所示:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="a459" class="nh ml it nu b gy ny nz l oa ob">Access Point IP address:<br/>194.168.0.4</span></pre><p id="c631" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要将端口80设置为webserver端口(以便可以通过web浏览器访问服务器)。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="e13c" class="nh ml it nu b gy ny nz l oa ob">WiFiServer server(80);</span></pre><p id="2aaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还需要将HTTP请求存储在一个变量中。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="f1a3" class="nh ml it nu b gy ny nz l oa ob">String header;</span></pre><p id="3425" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要创建开关变量，并将它们分配给GPIO引脚。下面是我如何创建开关变量。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="f784" class="nh ml it nu b gy ny nz l oa ob">const int switch1 = 12;<br/>const int switch2 = 13;<br/>const int switch3 = 14;<br/>const int switch4 = 27;</span></pre><p id="4321" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在setup()方法中将它们分配给GPIO引脚。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="35b4" class="nh ml it nu b gy ny nz l oa ob">pinMode(switch1, OUTPUT);  <br/>pinMode(switch2, OUTPUT);  <br/>pinMode(switch3, OUTPUT);  <br/>pinMode(switch4, OUTPUT);</span></pre><p id="dba0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还主要将所有开关的状态设置为“关”。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="0584" class="nh ml it nu b gy ny nz l oa ob">String switch1_state = "off";<br/>String switch2_state = "off";<br/>String switch3_state = "off";<br/>String switch4_state = "off";</span></pre><h2 id="d4ec" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">在setup()函数中</h2><p id="032a" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">请记住，我们使用的是低电平有效型继电器模块。因此，我们默认将输出设为高电平，这样开关默认关闭。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="a047" class="nh ml it nu b gy ny nz l oa ob">digitalWrite(switch1, HIGH);  <br/>digitalWrite(switch2, HIGH);  <br/>digitalWrite(switch3, HIGH);  <br/>digitalWrite(switch4, HIGH);</span></pre><h2 id="1dfa" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">loop()函数:</h2><p id="5115" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated"><code class="fe od oe of nu b">loop()</code>函数基本上是一个无限循环，会被反复执行。</p><p id="e653" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们需要继续监听新客户。客户端是连接到WiFi接入点的设备。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="1d29" class="nh ml it nu b gy ny nz l oa ob">WiFiClient client = server.available();</span></pre><p id="a7fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在客户端的浏览器上显示网页，我们需要使用<code class="fe od oe of nu b">client.println()</code>函数用HTML构建一个网页。看看下面的代码，看看我们是如何用HTML构建整个网页的。</p><p id="9e89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击按钮会把你带到不同的网址，比如<code class="fe od oe of nu b">/switch2/turn_on</code>。例如，如果基本IP地址是192.168.0.2，那么单击打开第二台设备的按钮会将您带到URL 192.168.0.2/switch2/turn_on。</p><p id="5fae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们使用if块来检查我们在哪个URL上，然后发送一个高电平或低电平信号，作为与该开关/按钮对应的GPIO引脚的输出。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="6978" class="nh ml it nu b gy ny nz l oa ob">// GPIO12            <br/>if (header.indexOf("GET /switch1/turn_on") &gt;= 0){<br/>              Serial.println("Switch 1 (GPIO 12) ON");<br/>              switch1_state = "on";<br/>              digitalWrite(switch1, LOW);<br/>}             <br/>else if (header.indexOf("GET /switch1/turn_off") &gt;= 0){  <br/>            Serial.println("Switch 1 (GPIO 12) OFF"); <br/>            switch1_state = "off";<br/>            digitalWrite(switch1, HIGH);<br/>}</span></pre><p id="d1d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，这里是该项目的代码。您需要将此代码闪存到您的ESP32板上，就这样，您就可以开始了。</p><p id="9744" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在网上观看任何教程，学习如何在你的ESP32中刷新代码。这很简单。稍后我会就此写一篇文章。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="852c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该代码适用于4台设备。但是我只用了2个继电器模块，因此，只能控制2个电器。但是它也可以扩展到更多的继电器模块和更多的设备。</p><h1 id="9eb0" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">使用</h1><p id="9206" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">然后我用‘我的家电’WiFi接入点连接了手机，用浏览器打开了串口显示器上打印的IP地址。就是这样。页面上有控制我的电器的按钮。</p><p id="b1cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样。就这么简单！</p></div><div class="ab cl oi oj hx ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="6dd9" class="nh ml it nu b gy ny nz l oa ob"><strong class="nu iu">Want to Connect?</strong></span><span id="ec5d" class="nh ml it nu b gy op nz l oa ob">You can follow me on <a class="ae ky" href="https://github.com/SamratDuttaOfficial" rel="noopener ugc nofollow" target="_blank">GitHub</a> and <a class="ae ky" href="https://www.linkedin.com/in/SamratDuttaOfficial" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</span></pre></div></div>    
</body>
</html>