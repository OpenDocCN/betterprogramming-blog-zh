<html>
<head>
<title>Observe UserDefaults Using Combine in Swift 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Swift 5中使用Combine观察用户默认值</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/observe-userdefaults-using-combine-in-swift-5-4177ae62360d?source=collection_archive---------7-----------------------#2020-08-10">https://betterprogramming.pub/observe-userdefaults-using-combine-in-swift-5-4177ae62360d?source=collection_archive---------7-----------------------#2020-08-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="77d9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用简单的扩展和内置的发布器</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b984f60532aad00a4af101140d19943a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VzWirmflMrun95vF"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@williamtm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">威廉·胡克</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="986e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将学习如何使用Combine publisher轻松观察<code class="fe lv lw lx ly b">UserDefaults</code>。</p><p id="1471" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事不宜迟，我们开始吧。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="b635" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">我们开始吧</h1><p id="d110" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">考虑这样一种情况，你想在<code class="fe lv lw lx ly b">UserDefaults</code>中保持一个游戏的音乐音量。你也想观察变化并做出相应的反应。所以我们的第一步是定义以下扩展:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a9ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，getter返回<code class="fe lv lw lx ly b">music_volume</code>键的<code class="fe lv lw lx ly b">Float</code>值，setter为该键设置新值。</p><p id="674e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们导入Combine并添加<code class="fe lv lw lx ly b">subscriptions</code>属性来存储我们未来的订阅:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="b3c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以在<code class="fe lv lw lx ly b">viewDidLoad()</code>方法中添加实际的订阅:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="b2b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">UserDefaults</code>键路径，我们观察<code class="fe lv lw lx ly b">musicVolume</code>属性。在<code class="fe lv lw lx ly b">handleEvents(receiveOutput:)</code>操作符中，我们简单地打印一条包含最新卷的消息。</p><p id="9043" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们测试订阅。将这两个预定的修改添加到<code class="fe lv lw lx ly b">musicVolume</code>属性中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="05b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们生成一个随机的<code class="fe lv lw lx ly b">Float</code>值，并延迟两次对其赋值。现在，如果我们构建并运行应用程序，我们将看到音乐音量打印三次:一次用于初始值，最后两次用于修改(经过一些延迟):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/4dcf2fb58b56edbe0e4b115bd6ac6960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d17ZqEwsmPDMgjPrNq1sPQ.png"/></div></div></figure><p id="c3e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经成功观测到了<code class="fe lv lw lx ly b">UserDefaults</code>。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="7587" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">包扎</h1><p id="b5e2" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">感谢阅读！我希望这能对你有所帮助。</p></div></div>    
</body>
</html>