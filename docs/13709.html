<html>
<head>
<title>Build a Command Line Tool With Rust to Play Guitar Chords</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Rust构建一个命令行工具来演奏吉他和弦</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-command-line-tool-with-rust-to-play-guitar-chords-d07df7b330b6?source=collection_archive---------3-----------------------#2022-09-19">https://betterprogramming.pub/build-a-command-line-tool-with-rust-to-play-guitar-chords-d07df7b330b6?source=collection_archive---------3-----------------------#2022-09-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9c1e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">打印吉他和弦的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/12816a68eaa1191a810731c4b23754a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TD_UaXc_YswlpidkvZuTow.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@darkrider?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">黑暗骑士</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="d3f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你弹吉他吗？弹一些不常用和弦的曲子是不是总要上网查吉他和弦？</p><p id="1b65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Command-line_interface" rel="noopener ugc nofollow" target="_blank">命令行工具(CLI) </a>怎么样，它接受一个和弦的名称，并输出一个关于如何演奏它的图表？</p><p id="7f8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天我就和大家分享一下如何用上面的思路在Rust中从头开始搭建一个命令行工具。</p><h1 id="ec26" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">最终目标</h1><p id="5829" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">最后，我们希望构建一个名为<code class="fe ms mt mu mv b">chord</code>的CLI。它接受一个字符串作为输入——和弦的名称。它会打印和弦图。像这样:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="14d5" class="na lw it mv b gy nb nc l nd ne">$ chord C</span><span id="a761" class="na lw it mv b gy nf nc l nd ne">x     ◯   ◯<br/>┌─┬─┬─┬─┬─┐<br/>│ │ │ │ ◯ │<br/>├─┼─┼─┼─┼─┤<br/>│ │ ◯ │ │ │<br/>├─┼─┼─┼─┼─┤<br/>│ ◯ │ │ │ │<br/>└─┴─┴─┴─┴─┘</span></pre><h1 id="f57a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">为什么生锈</h1><p id="2c46" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在我的上一篇文章<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/building-a-grpc-server-with-rust-be2c52f0860e">用Rust </a>构建gRPC服务器中，我已经分享了Rust为什么有趣以及为什么你应该学习Rust。我想在这篇文章中强调一点:</p><blockquote class="ng nh ni"><p id="8b55" class="kz la nj lb b lc ld ju le lf lg jx lh nk lj lk ll nl ln lo lp nm lr ls lt lu im bi translated">基于<a class="ae ky" href="https://insights.stackoverflow.com/survey/2021#most-loved-dreaded-and-wanted-language-love-dread" rel="noopener ugc nofollow" target="_blank">栈溢出调查</a>:“第六年，Rust是最受喜爱的语言。”</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/06597edf917525b6bb3860940e2edd51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QmQy_hHrzkNNY0Ccea6Qw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">铁锈是最受喜爱的语言。<a class="ae ky" href="https://insights.stackoverflow.com/survey/2021#most-loved-dreaded-and-wanted-language-love-dread" rel="noopener ugc nofollow" target="_blank">2021年Stackoverflow调查</a></p></figure><p id="e23b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Rust不仅非常适合构建后端服务，还非常容易构建CLI。让我们开始吧。</p><h1 id="edeb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">安装铁锈</h1><p id="824e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">用以下材料安装Rust:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="d30c" class="na lw it mv b gy nb nc l nd ne">$ curl --proto '=https' --tlsv1.2 -sSf &lt;https://sh.rustup.rs&gt; | sh</span></pre><p id="4f67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关安装的更多信息，请查看:<a class="ae ky" href="https://www.rust-lang.org/tools/install" rel="noopener ugc nofollow" target="_blank">https://www.rust-lang.org/tools/install</a>。</p><h1 id="0954" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建新的Rust项目</h1><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="ba86" class="na lw it mv b gy nb nc l nd ne"><strong class="mv iu">$ cargo new chord --bin</strong></span><span id="5353" class="na lw it mv b gy nf nc l nd ne">Created binary (application) `chord` package</span></pre><p id="2dfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们编译并运行程序，确保一切都设置正确:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="bde9" class="na lw it mv b gy nb nc l nd ne"><strong class="mv iu">$ cd chord<br/>$ cargo run</strong><br/><br/>Hello, world!</span></pre><p id="476c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们目前掌握的情况:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="b15c" class="na lw it mv b gy nb nc l nd ne">|-Cargo.toml<br/>|-Cargo.lock<br/>|-src<br/>|  |-main.rs</span></pre><h1 id="c069" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">打印指板</h1><p id="4461" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">一把吉他有6根弦，我们通常用<a class="ae ky" href="https://en.wikipedia.org/wiki/Fingerboard" rel="noopener ugc nofollow" target="_blank">指板</a>来代表手指的位置。</p><p id="0af6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是目前为止<code class="fe ms mt mu mv b">main.rs</code>的样子:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="4138" class="na lw it mv b gy nb nc l nd ne">fn main() {<br/>    println!("Hello, world!");<br/>}</span></pre><p id="82c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们更新它以打印一个空指板:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="d485" class="na lw it mv b gy nb nc l nd ne">const FRETBOARD: &amp;str = "◯ ◯ ◯ ◯ ◯ ◯<br/>┌─┬─┬─┬─┬─┐<br/>│ │ │ │ │ │<br/>├─┼─┼─┼─┼─┤<br/>│ │ │ │ │ │<br/>├─┼─┼─┼─┼─┤<br/>│ │ │ │ │ │<br/>└─┴─┴─┴─┴─┘";</span><span id="23c7" class="na lw it mv b gy nf nc l nd ne">fn main() {<br/>    println!("{}", FRETBOARD);<br/>}</span></pre><p id="b3f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行这个程序，这是我们目前所得到的:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="a9bc" class="na lw it mv b gy nb nc l nd ne"><strong class="mv iu">$ cargo run</strong></span><span id="1f47" class="na lw it mv b gy nf nc l nd ne">◯ ◯ ◯ ◯ ◯ ◯ <br/>┌─┬─┬─┬─┬─┐<br/>│ │ │ │ │ │<br/>├─┼─┼─┼─┼─┤<br/>│ │ │ │ │ │<br/>├─┼─┼─┼─┼─┤<br/>│ │ │ │ │ │<br/>└─┴─┴─┴─┴─┘</span></pre><h1 id="a79c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">拍手声</h1><p id="504d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了增加解析命令行参数的能力，我们将引入一个库<a class="ae ky" href="https://docs.rs/clap/latest/clap/" rel="noopener ugc nofollow" target="_blank">https://docs.rs/clap/latest/clap/</a>。</p><p id="6d42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要将clap作为依赖项添加到我们的项目中:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="ba3a" class="na lw it mv b gy nb nc l nd ne">$ cargo add clap --features derive</span></pre><p id="b5e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这只是将下面一行添加到<code class="fe ms mt mu mv b">cargo.toml</code>，这是为Rust定义所有依赖项的地方:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="4860" class="na lw it mv b gy nb nc l nd ne">clap = { version = "3.2.21", features = ["derive"] }</span></pre><p id="7541" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并将<code class="fe ms mt mu mv b">main.rs</code>更新为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="a535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了<a class="ae ky" href="https://doc.rust-lang.org/book/ch19-06-macros.html" rel="noopener ugc nofollow" target="_blank"> Rust macros </a>，clap有可能让注释<code class="fe ms mt mu mv b">Args</code>和免费获取参数解析变得极其简单。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="d02e" class="na lw it mv b gy nb nc l nd ne">/// A CLI to show you how to play a guitar chord<br/>#[derive(Parser, Debug)]<br/>#[clap(version, about)]<br/>struct Args {<br/>   /// Name of the chord<br/>   #[clap()]<br/>   name: String,<br/>}</span></pre><p id="7ce2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们试一试:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="294f" class="na lw it mv b gy nb nc l nd ne"><strong class="mv iu">$ cargo run -- --help</strong><br/><br/>chord 0.1.0<br/>A CLI to show you how to play a guitar chord</span><span id="5136" class="na lw it mv b gy nf nc l nd ne">USAGE:<br/>    chord &lt;NAME&gt;</span><span id="6d14" class="na lw it mv b gy nf nc l nd ne">ARGS:<br/>    &lt;NAME&gt;    Name of the chord</span><span id="04d9" class="na lw it mv b gy nf nc l nd ne">OPTIONS:<br/>    -h, --help       Print help information<br/>    -V, --version    Print version information</span><span id="634f" class="na lw it mv b gy nf nc l nd ne"><strong class="mv iu">$ cargo run -- C</strong></span><span id="72fa" class="na lw it mv b gy nf nc l nd ne">This is how you play 'C' chord: <br/>◯ ◯ ◯ ◯ ◯ ◯ <br/>┌─┬─┬─┬─┬─┐<br/>│ │ │ │ │ │<br/>├─┼─┼─┼─┼─┤<br/>│ │ │ │ │ │<br/>├─┼─┼─┼─┼─┤<br/>│ │ │ │ │ │<br/>└─┴─┴─┴─┴─┘</span></pre><p id="6ce8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">双破折号<code class="fe ms mt mu mv b">--</code>是一种非常常见的方式来表示<code class="fe ms mt mu mv b">cargo</code>选项的结束，而其余的则传递给CLI程序。不仅是<code class="fe ms mt mu mv b">cargo</code>，还有<a class="ae ky" href="https://unix.stackexchange.com/questions/11376/what-does-double-dash-mean" rel="noopener ugc nofollow" target="_blank">很多其他shell命令也是这样做的</a>。</p><p id="c8fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有一个隐藏的特性值得强调。请注意,“向您展示如何弹奏吉他和弦的CLI”和“和弦名称”都是我们源代码中的注释。它们也包含在帮助消息中。</p><p id="a570" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从源代码来看:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="ff81" class="na lw it mv b gy nb nc l nd ne"><strong class="mv iu">/// A CLI to show you how to play a guitar chord</strong><br/>#[derive(Parser, Debug)]<br/>#[clap(version, about)]<br/>struct Args {<br/><strong class="mv iu">    /// Name of the chord</strong><br/>    #[clap()]<br/>    name: String,<br/>}</span></pre><p id="b481" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从输出来看:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="23f6" class="na lw it mv b gy nb nc l nd ne">chord 0.1.0<br/><strong class="mv iu">A CLI to show you how to play a guitar chord</strong></span><span id="e28d" class="na lw it mv b gy nf nc l nd ne">USAGE:<br/>    chord &lt;NAME&gt;</span><span id="ceba" class="na lw it mv b gy nf nc l nd ne">ARGS:<br/>    &lt;NAME&gt;    <strong class="mv iu">Name of the chord</strong></span></pre><p id="938a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们需要了解的关于淋病的全部内容。接下来，让我们转到实际的CLI本身。</p><h1 id="fa45" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">CLI</h1><p id="a710" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">将主函数更新为以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="4332" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，如果输入的和弦名称未知，我们将打印“未知和弦”错误消息。否则，我们将手指放置在之前的空指板上。</p><p id="31bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">进行测试:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="6d5d" class="na lw it mv b gy nb nc l nd ne"><strong class="mv iu">$ cargo run -- C                    </strong></span><span id="d4b2" class="na lw it mv b gy nf nc l nd ne">This is how you play 'C' chord: <br/>x     ◯   ◯<br/>┌─┬─┬─┬─┬─┐<br/>│ │ │ │ ◯ │<br/>├─┼─┼─┼─┼─┤<br/>│ │ ◯ │ │ │<br/>├─┼─┼─┼─┼─┤<br/>│ ◯ │ │ │ │<br/>└─┴─┴─┴─┴─┘</span><span id="0735" class="na lw it mv b gy nf nc l nd ne"><strong class="mv iu">$ cargo run -- Asus4</strong><br/><br/>Unknown chord 'Asus4'</span></pre><p id="9e65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一切看起来都很棒！又快又简单。</p><h1 id="a418" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">装置</h1><p id="a07b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">到目前为止，我们一直在编译和运行CLI。不仅处理构建、运行、库依赖管理，它还处理安装。</p><p id="3296" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像这样安装<code class="fe ms mt mu mv b">chord</code> CLI:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="3375" class="na lw it mv b gy nb nc l nd ne">cargo install --path .</span></pre><p id="5c78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以直接使用这个CLI了:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="6ecd" class="na lw it mv b gy nb nc l nd ne"><strong class="mv iu">$ chord G</strong><br/>             <br/>This is how you play 'G' chord: <br/>    ◯ ◯ ◯  <br/>┌─┬─┬─┬─┬─┐<br/>│ │ │ │ │ │<br/>├─┼─┼─┼─┼─┤<br/>│ ◯ │ │ │ │<br/>├─┼─┼─┼─┼─┤<br/>◯ │ │ │ │ ◯<br/>└─┴─┴─┴─┴─┘</span></pre><p id="eb5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的朋友，这就是我们如何在Rust中构建CLI的。</p><h1 id="9d5b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结束了</h1><p id="d8b9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">你忘了怎么弹和弦了吗？现在我们有了更好的工具:)感谢阅读！像往常一样，Github中的源代码。</p><p id="211b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看<code class="fe ms mt mu mv b">blog-post-checkpoint</code>分支，获取本博客的代码参考:</p><p id="2443" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/yzhong52/ascii_chord/tree/blog-post-checkpoint" rel="noopener ugc nofollow" target="_blank">https://github . com/yzhong 52/ascii _ chord/tree/blog-post-check point</a></p><p id="312f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，查看<code class="fe ms mt mu mv b">master</code>分支，获取最新版本的CLI:</p><p id="104f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/yzhong52/ascii_chord" rel="noopener ugc nofollow" target="_blank">https://github.com/yzhong52/ascii_chord</a></p></div></div>    
</body>
</html>