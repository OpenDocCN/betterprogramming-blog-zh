<html>
<head>
<title>Pitfalls of Vue’s Reactivity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue反应性的缺陷</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/pitfalls-of-vues-reactivity-21a5f24ceb38?source=collection_archive---------7-----------------------#2019-10-31">https://betterprogramming.pub/pitfalls-of-vues-reactivity-21a5f24ceb38?source=collection_archive---------7-----------------------#2019-10-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bac4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Vue.js中的数据绑定、重载和反应</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/98264c481a25d85485bd8b149d5fe5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wwc5bx6uBmZIPEkU4hWq6Q.png"/></div></div></figure><p id="1d94" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我的Vue视图有时会拒绝自动重新渲染。在我的代码库中到处抨击之后，我决定适可而止，一头扎进Vue的反应系统。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="df90" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">Vue的反应性是什么？</h1><p id="2bdc" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">Vue将<em class="my">数据</em>绑定到<em class="my">视图</em>。</p><p id="22f7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您查看这段代码，会发现有一个包含<em class="my">数据的普通JavaScript对象。</em>在本例中，这是一个值为<code class="fe lq lr ls lt b">Hello Vue.js!</code>的<code class="fe lq lr ls lt b">message</code>属性</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="c04b" class="nd mc it lt b gy ne nf l ng nh">&lt;script src="https://unpkg.com/vue"&gt;&lt;/script&gt;<br/><br/>&lt;div id="app"&gt;<br/>  &lt;p&gt;{{ message }}&lt;/p&gt;<br/>&lt;/div&gt;<br/>&lt;script&gt;<br/>new Vue({<br/>  el: '#app',<br/>  data: {<br/>    message: 'Hello Vue.js!'<br/>  },<br/>})<br/>&lt;/script&gt;</span></pre><p id="8785" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="my">视图</em>是HTML输出。在第四行，我告诉Vue显示<code class="fe lq lr ls lt b">message</code>属性。当在浏览器中呈现时，它将显示“Hello Vue.js！”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/9cce4d9aaa7ed5e204933e6e35f67a3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y00pY6BvUjRRY1H6r-KvGw.png"/></div></div></figure><p id="0fd8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，当你改变<code class="fe lq lr ls lt b">message</code>属性时，反应部分开始发挥作用。Vue的反应系统将检测对<code class="fe lq lr ls lt b">message</code>的更改，并更新HTML以显示新值。回到以前的jQuery，您必须手动选择正确的HTML节点并更新其内容。</p><p id="7d72" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是和以前一样的代码，但是现在当点击<code class="fe lq lr ls lt b">#app</code>元素时，消息属性将把值改为“你点击了我！”。</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="d054" class="nd mc it lt b gy ne nf l ng nh">&lt;div @click="message = 'You clicked me!'" id="app"&gt;<br/>  &lt;p&gt;{{ message }}&lt;/p&gt;<br/>&lt;/div&gt;<br/>&lt;script&gt;<br/>new Vue({<br/>  el: '#app',<br/>  data: {<br/>    message: 'Hello Vue.js!'<br/>  },<br/>})<br/>&lt;/script&gt;</span></pre><p id="c0c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当点击<code class="fe lq lr ls lt b">#app</code>元素时，Vue确实会自动更新视图！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/cf6aa012362eb8aabd50c83b2cd588c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gmEFytoSik-ZoZMRmu8w2A.png"/></div></div></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="4fc1" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">引擎盖下的一瞥</h1><p id="eb66" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">当你设置<code class="fe lq lr ls lt b">data</code>对象时，Vue会自动为每个属性添加getters和setters。</p><p id="dfd2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以致电<code class="fe lq lr ls lt b">console.dir(this.$data)</code>亲自查看:</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="5e5c" class="nd mc it lt b gy ne nf l ng nh">&lt;script&gt;<br/>new Vue({<br/>  el: '#app',<br/>  data: {<br/>    message: 'Hello Vue.js!'<br/>  },<br/><br/>  mounted() {<br/>      console.dir(this.$data);<br/>  }<br/>})<br/>&lt;/script&gt;</span></pre><p id="791c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当打开控制台时，您可以看到Vue创建的<code class="fe lq lr ls lt b">get message</code>和<code class="fe lq lr ls lt b">set message</code>属性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/a274f3218d486af6890362385e28c2d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2BnMpdF_j5fY63JR8yhhw.png"/></div></div></figure><p id="c8db" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">每当设置了<code class="fe lq lr ls lt b">message</code>属性的值，就会自动调用<code class="fe lq lr ls lt b">set message</code>函数，这将触发视图的重新呈现。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="6bac" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">陷阱1:数组</h1><p id="1b46" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">到目前为止，一切都很好。如果我更改了<code class="fe lq lr ls lt b">message</code>属性，视图会被重新渲染。</p><p id="46cd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是假设我将代码改为如下:</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="814d" class="nd mc it lt b gy ne nf l ng nh">&lt;script src="https://unpkg.com/vue"&gt;&lt;/script&gt;<br/><br/>&lt;div @click="message[0] = 'You clicked me!'" id="app"&gt;<br/>  &lt;p&gt;{{ message[0] }}&lt;/p&gt;<br/>&lt;/div&gt;<br/>&lt;script&gt;<br/>new Vue({<br/>  el: '#app',<br/>  data: {<br/>    message: ['Hello Vue.js!']<br/>  },<br/>})<br/>&lt;/script&gt;</span></pre><p id="574f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一切都是一样的，除了我现在将消息存储在一个数组中。</p><p id="4d96" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当我加载页面并点击元素时，没有任何反应。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/9cce4d9aaa7ed5e204933e6e35f67a3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y00pY6BvUjRRY1H6r-KvGw.png"/></div></div></figure><p id="93c7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Vue将为<code class="fe lq lr ls lt b">message</code>属性创建一个<code class="fe lq lr ls lt b">getter</code>和<code class="fe lq lr ls lt b">setter</code>。但是我更新的是<code class="fe lq lr ls lt b">message</code>数组中的一个值，而不是数组本身。因此，不会自动触发重新渲染。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="aae8" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">陷阱2:添加对象属性</h1><p id="68b8" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">当页面被点击时，我想显示一个再见消息。</p><p id="5419" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我将欢迎信息存储在<code class="fe lq lr ls lt b">message.welcome</code>中。</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="cbe0" class="nd mc it lt b gy ne nf l ng nh">&lt;script src="https://unpkg.com/vue"&gt;&lt;/script&gt;<br/><br/>&lt;div @click="message.goodbye = 'You clicked me - Goodbye!'" id="app"&gt;<br/>  &lt;p&gt;{{ message.welcome }}&lt;/p&gt;<br/>  &lt;p v-if="message.goodbye"&gt;{{ message.goodbye }}&lt;/p&gt;<br/>&lt;/div&gt;<br/>&lt;script&gt;<br/>new Vue({<br/>  el: '#app',<br/>  data: {<br/>    message: {<br/>        welcome: 'Hello!'<br/>    }<br/>  },<br/>})<br/>&lt;/script&gt;</span></pre><p id="63b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当页面被点击时，我将添加<code class="fe lq lr ls lt b">message.goodbye</code>属性。当我点击页面时，应该会出现再见信息，对吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/8049d37d8dd3756a2385581d44374a96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nPjGHn_VNmfRH9NIj42iVQ.png"/></div></div></figure><p id="b340" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是什么也没发生。仅显示欢迎消息。</p><p id="f76f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是因为Vue将在其生命周期的开始添加<code class="fe lq lr ls lt b">getters</code>和<code class="fe lq lr ls lt b">setters</code>。如果在Vue实例化后添加属性，它不会知道。因此，设置<code class="fe lq lr ls lt b">message.goodbye</code>不会触发<code class="fe lq lr ls lt b">setter</code>，因此Vue不会重新渲染。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="8d03" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">解决方案1:强制更新</h1><p id="8154" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">一种解决方案是使用<code class="fe lq lr ls lt b">$forceUpdate()</code>。这将强制重新渲染当前组件，包括其子组件。</p><p id="f484" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我更新了数组示例代码，以便在组件被单击时调用<code class="fe lq lr ls lt b">$forceUpdate()</code>:</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="df09" class="nd mc it lt b gy ne nf l ng nh">&lt;script src="https://unpkg.com/vue"&gt;&lt;/script&gt;<br/><br/>&lt;div @click="() =&gt; { message[0] = 'You clicked me!'; $forceUpdate(); }" id="app"&gt;<br/>  &lt;p&gt;{{ message[0] }}&lt;/p&gt;<br/>&lt;/div&gt;<br/>&lt;script&gt;<br/>new Vue({<br/>  el: '#app',<br/>  data: {<br/>    message: ['Hello Vue.js!']<br/>  },<br/>})<br/>&lt;/script&gt;</span></pre></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="ac1e" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">解决方案2 : Vue集</h1><p id="a8a4" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated"><code class="fe lq lr ls lt b">Vue.set()</code>函数将<em class="my">给一个对象或数组添加一个反应属性。</em></p><p id="0df8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不幸的是，您不能从视图中调用<code class="fe lq lr ls lt b">Vue.set()</code>函数。所以我加一个<code class="fe lq lr ls lt b">handleClick()</code>方法。该方法将索引<code class="fe lq lr ls lt b">0</code>处的<code class="fe lq lr ls lt b">message</code>数组的值设置为<code class="fe lq lr ls lt b">"You clicked me!"</code>。</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="86b9" class="nd mc it lt b gy ne nf l ng nh">&lt;script src="https://unpkg.com/vue"&gt;&lt;/script&gt;<br/><br/>&lt;div @click="handleClick()" id="app"&gt;<br/>  &lt;p&gt;{{ message[0] }}&lt;/p&gt;<br/>&lt;/div&gt;<br/>&lt;script&gt;<br/>new Vue({<br/>  el: '#app',<br/>  data: {<br/>    message: ['Hello Vue.js!']<br/>  },<br/><br/>  methods: {<br/>      handleClick() {<br/>          Vue.set(this.message, 0, 'You clicked me!');<br/>      }<br/>  }<br/>})<br/>&lt;/script&gt;</span></pre><p id="011a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">类似地，我可以更新对象属性示例代码来使用<code class="fe lq lr ls lt b">Vue.set()</code>函数。</p><pre class="kj kk kl km gt mz lt na nb aw nc bi"><span id="4404" class="nd mc it lt b gy ne nf l ng nh">&lt;script src="https://unpkg.com/vue"&gt;&lt;/script&gt;<br/><br/>&lt;div @click="handleClick()" id="app"&gt;<br/>  &lt;p&gt;{{ message.welcome }}&lt;/p&gt;<br/>  &lt;p v-if="message.goodbye"&gt;{{ message.goodbye }}&lt;/p&gt;<br/>&lt;/div&gt;<br/>&lt;script&gt;<br/>new Vue({<br/>  el: '#app',<br/>  data: {<br/>    message: {<br/>        welcome: 'Hello!'<br/>    }<br/>  },<br/><br/>  methods: {<br/>      handleClick() {<br/>          Vue.set(this.message, 'goodbye', 'You clicked me - Goodbye!');<br/>      }<br/>  }<br/>})<br/>&lt;/script&gt;</span></pre><p id="6f7a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在浏览器中运行时，视图会自动重新呈现！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/6bbfaf4898a2d02b187ec0e7275064b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3WxeTKZcBXhsZNc3i9bnqw.png"/></div></div></figure><p id="9423" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以我的经验来看，如果你完全掌握了Vue的反应性系统，就省去了很多令人头疼的问题和调试时间。希望这篇文章能让这个系统更加清晰。</p></div></div>    
</body>
</html>