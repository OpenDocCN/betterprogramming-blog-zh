<html>
<head>
<title>Make a Sortable List With Draggable Items Using JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JavaScript制作一个可拖动项目的可排序列表</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-sortable-list-with-draggable-items-using-javascript-9ef38f96b258?source=collection_archive---------1-----------------------#2020-05-17">https://betterprogramming.pub/create-a-sortable-list-with-draggable-items-using-javascript-9ef38f96b258?source=collection_archive---------1-----------------------#2020-05-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9485" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不需要框架</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d89ebc09a44a8f6bf4171224e636cb8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zi_u8ghQVeT1ljrtBDNctQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Ralph Blvmberg 在<a class="ae ky" href="https://unsplash.com/s/photos/drag-racing?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="e6d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个关于栈溢出的问题引起了我的兴趣。它是关于创建一个可以确定项目顺序是否正确的列表。用户拖动项目来改变顺序，直到它是正确的。</p><p id="fb5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将介绍如何用普通的JavaScript、HTML和CSS来实现这一点。首先，让我们初始化整个代码中需要的变量。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="145f" class="ma mb it lw b gy mc md l me mf">var list = document.getElementById('list')<br/>var base, randomized, dragging, draggedOver;<br/>var isRight = 'Not In Order!';</span></pre><p id="dc2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以编写一个接受数组作为参数的函数。根据这个参数，我们将创建两个数组，<code class="fe mg mh mi lw b">base</code>将提供数字应该处于的基本顺序，<code class="fe mg mh mi lw b">randomized</code>将是无序的<code class="fe mg mh mi lw b">base</code>，它将呈现为一个列表。<code class="fe mg mh mi lw b">base</code>可以通过对传递的数组进行切片来创建，创建一个新的数组来防止<code class="fe mg mh mi lw b">base</code>值被绑定到<code class="fe mg mh mi lw b">randomized</code>。</p><p id="050f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以根据生成的0到1之间的随机数是大于还是小于0.5来排序所提供的数组，从而随机化<code class="fe mg mh mi lw b">randomized</code>的顺序。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="db4b" class="ma mb it lw b gy mc md l me mf">randomized = a.sort(() =&gt; Math.random() - 0.5)</span></pre><p id="983d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了<code class="fe mg mh mi lw b">base</code>和<code class="fe mg mh mi lw b">randomized</code>数组，我们可以检查随机化过程是否错误地返回了相同的顺序。如果它返回相同的顺序，那么我们使用递归再次调用随机化。我们这样做，直到订单不再相同。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="b448" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以开始使用一个函数来将项目实际呈现为一个列表。我们就叫它<code class="fe mg mh mi lw b">renderItems</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="d092" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个函数，它将最初呈现我们的列表，并在用户更改顺序时重新呈现。</p><p id="8680" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们更新订单指示器的<code class="fe mg mh mi lw b">innerText</code>以反映<code class="fe mg mh mi lw b">isRight</code>的值。默认情况下，它被设置为<code class="fe mg mh mi lw b">'Not In Order!'</code>，如果用户对列表进行了正确的排序，它将在以后被更新。<code class="fe mg mh mi lw b">list.innerText = ''</code>意在清除列表——否则，每次用户改变顺序时，它只会将新创建的列表项添加到现有列表中。</p><p id="80e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们遍历传递的数组<code class="fe mg mh mi lw b">randomized</code>，并为数组中的每一项创建一个<code class="fe mg mh mi lw b">li</code>标签。我们还将<code class="fe mg mh mi lw b">draggable</code>的值设置为true。这将允许我们使用鼠标拖动列表项。</p><p id="34c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们为事件<code class="fe mg mh mi lw b">drag</code>、<code class="fe mg mh mi lw b">drop</code>和<code class="fe mg mh mi lw b">dragover</code>添加事件监听器。这些事件允许我们利用<a class="ae ky" href="https://www.w3schools.com/html/html5_draganddrop.asp" rel="noopener ugc nofollow" target="_blank"> HTML5拖放API </a>。在事件监听器之后，我们将<code class="fe mg mh mi lw b">node</code>的<code class="fe mg mh mi lw b">innerText</code>设置为<code class="fe mg mh mi lw b">item</code>。最后，我们将<code class="fe mg mh mi lw b">node</code>添加到<code class="fe mg mh mi lw b">list</code>元素中。现在我们已经生成并呈现了我们的列表，让我们来分解我们将用来管理重新排序的函数。</p><p id="8f1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个功能是<code class="fe mg mh mi lw b">setDragging</code>。这个函数将设置<code class="fe mg mh mi lw b">dragging</code>的值，它将代表当前被拖动的元素。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a536" class="ma mb it lw b gy mc md l me mf">const setDragging = (e) =&gt;{<br/>  dragging = parseInt(e.target.innerText)<br/>}</span></pre><p id="6faa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们有<code class="fe mg mh mi lw b">setDraggedOver</code>，它将为<code class="fe mg mh mi lw b">draggedOver</code>设置值。<code class="fe mg mh mi lw b">draggedOver</code>代表用户希望用<code class="fe mg mh mi lw b">dragging</code>替换的列表项。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9803" class="ma mb it lw b gy mc md l me mf">function setDraggedOver(e) {<br/>  e.preventDefault();<br/>  draggedOver = parseInt(e.target.innerText)<br/>}</span></pre><p id="4328" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们有我们的<code class="fe mg mh mi lw b">compare</code>函数。这实现了两件事。首先，它用<code class="fe mg mh mi lw b">dragging</code>替换<code class="fe mg mh mi lw b">draggedOver</code>并重新排序<code class="fe mg mh mi lw b">randomized</code>。然后，它根据<code class="fe mg mh mi lw b">randomized</code>和<code class="fe mg mh mi lw b">base</code>的顺序是否相同来改变<code class="fe mg mh mi lw b">isRight</code>的值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="00f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以得到<code class="fe mg mh mi lw b">dragging</code>和<code class="fe mg mh mi lw b">draggedOver</code>的索引，我们可以用它们来移动条目。这是通过使用<code class="fe mg mh mi lw b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/splice" rel="noopener ugc nofollow" target="_blank">splice</a></code>完成的。<code class="fe mg mh mi lw b">splice</code>允许我们首先从随机列表中删除<code class="fe mg mh mi lw b">dragging</code>，这样我们就不会生成重复的列表项。然后，我们使用<code class="fe mg mh mi lw b">splice</code>将<code class="fe mg mh mi lw b">dragging </code>插入到列表中的索引<code class="fe mg mh mi lw b">draggedOver</code>处。我们想要插入新的数字而不替换现有的数字(如果您想要用<em class="ml">替换该索引处的</em> <strong class="lb iu"> </strong>数字，您需要将<code class="fe mg mh mi lw b">splice</code>中的第二个参数改为1而不是0)。</p><p id="835d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦重新排序完成并且分配了<code class="fe mg mh mi lw b">isRight</code>，我们就可以使用前面的<code class="fe mg mh mi lw b">renderItems</code>函数按照新的顺序重新呈现项目列表。下面是最终结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/1786fcfa39e40a05c133236194f936c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*9Bhctyy_tjZ0xc8To-yn1A.gif"/></div></figure><p id="9cc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在有了一个使用普通JavaScript、HTML和CSS的可拖动和可排序的列表！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="ff11" class="mu mb it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">奖金</h1><p id="5f6b" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">通过在我们的<code class="fe mg mh mi lw b">renderItems</code>函数的循环中添加以下内容，我们可以得到更多的创意并增加对颜色的支持。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0080" class="ma mb it lw b gy mc md l me mf">node.style.backgroundColor = item<br/>node.style.backgroundColor = node.style.backgroundColor.length &gt; 0  <br/>    ? item : 'lightblue'</span></pre><p id="1b81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码试图将列表中的当前项目分配给<code class="fe mg mh mi lw b">node</code>的背景颜色样式属性。如果提供的值是一个有效的颜色，它将为其分配该颜色，否则不会为其分配该颜色，并且<code class="fe mg mh mi lw b">node.style.backgroundColor</code>将保持为空字符串。如果是这种情况，我们只需指定一个默认的背景颜色。</p><p id="6866" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还需要在<code class="fe mg mh mi lw b">setDraggedOver</code>和<code class="fe mg mh mi lw b">setDragging</code>函数中添加以下代码，以验证<code class="fe mg mh mi lw b">innerText</code>是字符串还是整数:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ead4" class="ma mb it lw b gy mc md l me mf">Number.isNaN(parseInt(e.target.innerText)) ? e.target.innerText : parseInt(e.target.innerText)</span></pre><p id="8a5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了更新的字符串支持，我们现在可以处理这样的列表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/35b80349e408d7fa9a69d196bf30efe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/1*T4C9HKdYO1xx0eCOIzs7Kw.gif"/></div></figure><p id="9dfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个项目的完整代码可以在<a class="ae ky" href="https://codepen.io/macro6461/pen/RwWemgM" rel="noopener ugc nofollow" target="_blank">这个代码栏</a>中找到。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="9f23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击此处，将你的免费媒体会员升级为付费会员，每月只需5美元，你就可以获得数千位作家的无限量无广告故事。这是一个附属链接，你的会员资格的一部分帮助我为我创造的内容获得奖励。谢谢大家！</p><h1 id="1df0" class="mu mb it bd mv mw nr my mz na ns nc nd jz nt ka nf kc nu kd nh kf nv kg nj nk bi translated">参考</h1><div class="nw nx gp gr ny nz"><a href="https://stackoverflow.com/questions/61853416/how-to-sort-li-elements-and-put-the-results/61855351#61855351" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">如何对元素进行排序并将结果</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">感谢贡献一个堆栈溢出的答案！请务必回答问题。提供详细信息并分享…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">stackoverflow.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on ks nz"/></div></div></a></div><div class="nw nx gp gr ny nz"><a href="https://www.w3schools.com/html/html5_draganddrop.asp" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">HTML拖放API</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">在HTML中，任何元素都可以拖放。将W3Schools图像拖动到矩形中。拖放是一种非常…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">www.w3schools.com</p></div></div><div class="oi l"><div class="oo l ok ol om oi on ks nz"/></div></div></a></div><div class="nw nx gp gr ny nz"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/splice" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">Array.prototype.splice()</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">该方法通过移除或替换现有元素和/或在…中添加新元素来更改数组的内容</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">developer.mozilla.org</p></div></div><div class="oi l"><div class="op l ok ol om oi on ks nz"/></div></div></a></div><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq mk l"/></div></figure></div></div>    
</body>
</html>