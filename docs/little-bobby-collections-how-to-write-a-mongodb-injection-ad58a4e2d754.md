# 一个简单的 MongoDB 注入:小鲍比集合

> 原文：<https://betterprogramming.pub/little-bobby-collections-how-to-write-a-mongodb-injection-ad58a4e2d754>

## 数据库注入以及如何避免它们

![](img/51c5559c3579b0ef103b1c932ea4cfb8.png)

像 MySQL 和 PostgreSQL 这样的 SQL 数据库已经在 web 开发人员中流行多年了。你正在阅读的文本几乎肯定是由一个 web 应用程序从 SQL 数据库中检索出来的。这是有充分理由的:SQL 数据库很棒！

它们不太好的一点是，你可以在一些数据上附加代码，让它们做一些它们不应该做的事情。数据库注入仍然是最危险的——也是最常见的——安全漏洞。世界上许多最严重的数据泄露都是附加在普通数据上的小型秘密 SQL 命令。

# NoSQL

就在上个月，我第一次与 MongoDB 合作。Mongo 是一个 NoSQL 数据库，这意味着它使用不同于 MySQL 和 Postgres 等数据库的存储和查找数据的方法。它们之间的关键区别是 SQL 使用一个*模式*来结构化数据。Mongo 将数据存储为单个且通常不相连的 Javascript 对象。SQL 看起来像一个电子表格，而 NoSQL 更像一个装满揉成一团的纸片的桶。

自数据库出现以来，SQL 一直主导着市场，而 NoSQL 相对来说是个新来者。Mongo 最近几年在 Node.js 人群中特别流行。那么，这是否意味着我们也将开始看到 NoSQL 注射？他们会是什么样子？这部 XKCD 漫画是我最喜欢的 SQL 注入笑话。

![](img/918f9f32fb743ef02c11850fb3532941.png)

她的女儿叫救命我被困在驾照工厂了

Robinson 夫人的儿子名叫`Robert’); DROP TABLE Students; —` —这是一个 SQL 命令，将删除表`Students`。她知道她的儿子最终会被一所用 SQL 数据库跟踪学生的学校录取。

如果 Robinson 夫人计划让她的儿子进入一所使用 Mongo 数据库的学校，她会给他取什么名字？要回答这个问题，我们必须推测学校会如何组织他们的数据。

# 注射

Mongo 与表最接近的是集合。这些只是较大数据库桶中的较小桶。删除名为“学生”的集合的语法应该是`db.students.drop()`。我们的最终目标是让学校的记录保存应用程序告诉其数据库运行该命令。我们如何包装它来做到这一点？

这个应用程序可能会告诉它的数据库运行类似`db.students.insert({ name: “Robert”})`的东西来添加一个名为“Robert”的学生。为了混进我的命令，我可能会尝试将“Robert”替换为类似以下的内容:

```
Robert”}).then(db.students.drop())
```

我们就叫他小鲍比收藏。这个表达式有三个部分:

1.  首先我给程序它所期望的，在这个例子中:`Robert`
2.  接下来添加一些代码，告诉它结束表达式:`“}).then()`
3.  最后，我将我的有效负载`db.students.drop()`放在一个回调函数中，这样它在将‘Robert’添加到数据库中后会立即运行。在这里，我假设他们用名称 db 调用他们的数据库，并且他们有一个允许我访问的名为“students”的集合。如果我在这些事情上有任何错误，注射就不会起作用。

# 如何预防这种注射

幸运的是，大多数使用 Mongo 的开发人员将通过对象关系映射器或 ORM(如 Mongoose)与它交流。除非使用 eval()语句，否则使用预处理语句可以避免这样的注入。所以要小心那些评估！