<html>
<head>
<title>How I Deploy Microservice to Heroku With RabbitMQ</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用RabbitMQ将微服务部署到Heroku</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-i-deploy-microservice-to-heroku-with-rabbitmq-876499c797cc?source=collection_archive---------9-----------------------#2019-08-05">https://betterprogramming.pub/how-i-deploy-microservice-to-heroku-with-rabbitmq-876499c797cc?source=collection_archive---------9-----------------------#2019-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8e8d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">微服务部署的详细步骤</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2acdf981865024fe321a950380c227bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BRS7DacCnLvIkJRP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@emilep?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">émile Perron</a>拍摄</p></figure><p id="d841" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我写了一篇关于我如何使用RabbitMQ构建微服务的<a class="ae ky" href="https://medium.com/better-programming/a-step-by-step-guide-to-building-event-driven-microservices-with-rabbitmq-deeb85b3031c" rel="noopener">文章</a>。这是那篇文章的第二部分。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="85d3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">背景</h1><p id="7152" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在上一篇文章中，我构建了一个微服务项目，从互联网上搜集激励性的引语。现在，我正在探索如何免费部署这个项目。</p><p id="c1fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">经过一些研究，我发现有很多免费资源。我决定从Heroku开始，因为它似乎很适合我的项目。</p><ul class=""><li id="6a49" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">自由层</li><li id="82c3" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">免费CloudAmqp服务(RabbitMQ即服务)</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b80d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">亲自动手</h1><p id="9d6f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">本实践部分包括几个部分:</p><ul class=""><li id="dd13" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">在Heroku建立项目</li><li id="34b1" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">RabbitMQ在Heroku成立</li><li id="c836" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">将RabbitMQ集成到您的项目中</li><li id="b57a" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">我遇到的问题</li></ul><h2 id="0532" class="nn md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">在Heroku建立项目</h2><ol class=""><li id="f773" class="mz na it lb b lc mu lf mv li nz lm oa lq ob lu oc nf ng nh bi translated">在Mac上设置Heroku。</li></ol><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="fc05" class="nn md it oe b gy oi oj l ok ol">brew tap heroku/brew &amp;&amp; brew install heroku</span></pre><p id="83ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.在Heroku仪表板中创建一个应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/9b4fb34087afd38d5f852a20a8bc6d7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KJsUswukTy31H-VIbxFF5g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建应用仪表板页面</p></figure><p id="6050" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.登录Heroku。插入您的凭证，您应该可以登录。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="8cc3" class="nn md it oe b gy oi oj l ok ol">heroku login<br/>heroku: Press any key to open up the browser to login or q to exit:</span></pre><p id="7437" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.我已经准备好了我的节点项目。因此，我只需要将我现有的项目添加到Heroku Remote。以下是所需的步骤。</p><p id="ffc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您还没有将代码提交到git中，您可能需要执行以下命令。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="0c0e" class="nn md it oe b gy oi oj l ok ol">// Add all your existing file <br/>git add .</span><span id="6c98" class="nn md it oe b gy on oj l ok ol">// Commit all your changed file<br/>git commit -am "Added feature ???"</span><span id="24f6" class="nn md it oe b gy on oj l ok ol">// Push to Heroku Master<br/>git push heroku master</span></pre><p id="a6ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你已经提交了你所有的代码，你只需要把它推到Heroku源，主分支。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="9b1e" class="nn md it oe b gy oi oj l ok ol">// Push to Heroku Master<br/>git push heroku master</span></pre><p id="017a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只要你推送到Heroku master分支，Heroku会帮你搭建和运行节点项目。您将在仪表板上看到您的构建日志，它将显示构建是成功了<em class="oo">还是失败了<em class="oo"/>，随后显示它是否成功地<em class="oo">部署了</em>。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/6b0c20b95d5403af0918ee7719fac655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*niZQrwftRl939G9bfKeuMQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">最新活动的屏幕截图</p></figure><h2 id="d0b9" class="nn md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">RabbitMQ在Heroku成立</h2><p id="113e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在，让我们在Heroku上启动RabbitMQ服务。</p><ol class=""><li id="f77a" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu oc nf ng nh bi translated">去你的Heroku仪表板。</li><li id="6f73" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu oc nf ng nh bi translated">选择一个您部署的微服务。对我来说，我选择了我构建的TimerService。</li><li id="000f" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu oc nf ng nh bi translated">您将看到一个类似下面截图中的仪表板。我将提供几个截图来指导您如何设置RabbitMQ附加组件。我相信截图比我的文字更能说明如何做到这一点。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/21373674ef488af67bccf181443b1f36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TbeQs0HxT8T8eJJLrZU6PQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TimerService Heroku仪表板的屏幕截图</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/6c03e3564c4c35601815a8f8d2814354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZeZn3lnaAWCpl7A7OaTxWg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">选择查找更多加载项</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/1c5059f493f896003df845d7dabc3cf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lQyltf3xEbIsnBX2b6E7QQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您将看到一个加载项列表。寻找<em class="ot">消息和队列。你也会看到CloudAMQP。</em></p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/ce278efc7832dc9f205d182699f31857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FtsZOv1zCVpgGxmzXZfZFQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">点击安装AMQP</p></figure><p id="e4a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击安装后，您将看到RabbitMQ可用的不同类型的计划。选择要托管CloudAMQP的应用程序。最后，单击<em class="oo">供应插件，</em>显示为<em class="oo"> </em>，如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/2249c0d3a8adf6132b56583cb3a9b6b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_EeQYM9z5wGipgj699IJJg.png"/></div></div></figure><p id="d056" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你有一个工作的RabbitMQ服务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/15a574a4f8edf5b6158ff357b1ba37fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C2jsLItPnaw49Hg5VooCWw.png"/></div></div></figure><h2 id="4915" class="nn md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">将Heroku RabbitMQ与项目集成</h2><p id="5a08" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们有一个部署到Heroku的工作项目和一个工作RabbitMQ服务。我们缺少的是整合。我们必须将我们的项目配置为<em class="oo">发布</em>消息，而<em class="oo">监听来自已定义的RabbitMQ服务的</em>消息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="b48f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整合很容易。我们只需要更新<code class="fe ox oy oz oe b">process.env.CLOUDAMQP_URL</code>，如上面的要点所示。</p><p id="8b6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了获得RabbitMQ的URL，您只需在Heroku应用仪表板上点击CloudAMQP附加组件。下面是您点击CloudAMQP附加组件后将看到的屏幕截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/b76021c098eb5973e786a8b67d55a72f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h3ojrxTY0sgeXMJjArHN-A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">你会看到AMQP的网址</p></figure><p id="8228" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需复制AMQP网址并粘贴到<code class="fe ox oy oz oe b">.env </code>文件中。然后，将它重新部署到Heroku上的应用程序中，它就可以工作了。</p><p id="526b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我的RabbitMQ管理器在我的微服务连接到它时的截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/d6185ee09108b89f42546e13f6ff80a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nfk3YDLU0zqOjUsPfYYSSQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">微服务之间有两个连接和6345条消息</p></figure><h2 id="32ba" class="nn md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">我遇到的问题</h2><p id="ba97" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在整个部署学习过程中，我遇到了两个问题。</p><ul class=""><li id="3c21" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">您必须在<code class="fe ox oy oz oe b">package.json</code>中声明您的启动脚本。为了开始你的项目，你需要做<code class="fe ox oy oz oe b">node server.js</code>。然后你必须在你的<code class="fe ox oy oz oe b">package.json</code>脚本中声明它。这是因为Heroku将通过执行<code class="fe ox oy oz oe b">npm start</code>命令来启动您的项目。</li><li id="7f20" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">第二个问题是如果我有10个微服务，是不是每个节点app都要声明10个RabbitMQ插件？这不知何故违背了目的，对不对？事实证明不是的。我只是尝试在所有节点项目中使用相同的RabbitMQ服务——事实证明它是可以共享的。RabbitMQ服务只需要附加一个应用程序。然后，只要URL正确，就可以在所有微服务之间共享。</li></ul><p id="3b7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你遇到了和我一样的问题，我希望这能帮助你。如果你遇到其他问题，你可以谷歌一下或者寻求帮助。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="51ba" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="cf31" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">简而言之，在你知道如何使用它之后，我觉得它很容易部署到Heroku。当您不必管理服务器设置和工具安装时，这种感觉棒极了。</p><h2 id="b18b" class="nn md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">参考</h2><ul class=""><li id="8764" class="mz na it lb b lc mu lf mv li nz lm oa lq ob lu ne nf ng nh bi translated"><a class="ae ky" href="https://devcenter.heroku.com/articles/cloudamqp#use-with-node-js" rel="noopener ugc nofollow" target="_blank">云AMQP附加指南</a></li></ul><p id="b561" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读并享受发展。</p></div></div>    
</body>
</html>