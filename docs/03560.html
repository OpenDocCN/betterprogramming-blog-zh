<html>
<head>
<title>The Surprisingly Difficult Task of Printing Newlines in a Terminal</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在终端中打印换行符这一异常困难的任务</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-surprisingly-difficult-task-of-printing-newlines-in-a-terminal-43a2a5d30359?source=collection_archive---------25-----------------------#2020-02-17">https://betterprogramming.pub/the-surprisingly-difficult-task-of-printing-newlines-in-a-terminal-43a2a5d30359?source=collection_archive---------25-----------------------#2020-02-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f4aa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你的指南字符串插值怪癖混淆我们最好的</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/bff0baba76f05546c800813383fcdde0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*kVLO2j4V5KJiXVMZ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="ed13" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">令人惊讶的是，让计算机给出人类可读的输出并非易事。随着<a class="ae lq" href="https://en.wikipedia.org/wiki/Standard_streams" rel="noopener ugc nofollow" target="_blank">标准流</a>的引入，特别是标准输出，程序获得了一种使用纯文本流相互交流的方式；人性化和显示stdout是另一回事。</p><p id="4538" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">整个计算时代的技术都试图解决这个问题，从在视频计算机显示器中使用<a class="ae lq" href="https://en.wikipedia.org/wiki/Computer_terminal#Early_VDUs" rel="noopener ugc nofollow" target="_blank"> ASCII字符</a>到像<code class="fe lr ls lt lu b">echo</code>和<code class="fe lr ls lt lu b">printf</code>这样的现代shell命令。</p><p id="70ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些进步并非天衣无缝。将输出打印到终端的工作对于程序员来说充满了各种奇怪的操作，例如，扩展一个<a class="ae lq" href="https://en.wikipedia.org/wiki/Escape_sequence" rel="noopener ugc nofollow" target="_blank">转义序列</a>来打印新行这一看似简单的任务。</p><p id="cb80" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">占位符<code class="fe lr ls lt lu b">\n</code>的扩张可以通过多种方式完成，每种方式都有其独特的历史和复杂性。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b985" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用回声</h1><p id="3c1d" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">从它在<a class="ae lq" href="https://en.wikipedia.org/wiki/Multics" rel="noopener ugc nofollow" target="_blank"> Multics </a>中的出现到它在现代类似Unix的系统中的无处不在，<code class="fe lr ls lt lu b">echo</code>仍然是让你的终端说“Hello world！”的一个熟悉的工具</p><p id="d133" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不幸的是，跨操作系统的不一致实现使得它的使用很棘手。有些系统上的<code class="fe lr ls lt lu b">echo</code>会自动扩展转义序列，而其他系统上的<a class="ae lq" href="https://man.cat-v.org/unix_8th/1/echo" rel="noopener ugc nofollow" target="_blank">需要<code class="fe lr ls lt lu b">-e</code>选项来执行相同的操作:</a></p><pre class="kj kk kl km gt mz lu na nb aw nc bi"><span id="be12" class="nd md it lu b gy ne nf l ng nh">echo "the study of European nerves is \neurology"<br/># the study of European nerves is \neurology</span><span id="8731" class="nd md it lu b gy ni nf l ng nh">echo -e "the study of European nerves is \neurology"<br/># the study of European nerves is<br/># eurology</span></pre><p id="f01e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于实现中的这些不一致，<code class="fe lr ls lt lu b">echo</code>被认为是不可移植的。此外，通过使用命令替换的<a class="ae lq" href="https://en.wikipedia.org/wiki/Code_injection#Shell_injection" rel="noopener ugc nofollow" target="_blank">外壳注入攻击</a>，它与用户输入的结合使用相对容易被破坏。</p><p id="dec4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在现代系统中，保留它只是为了与许多仍在使用它的程序兼容。POSIX规范推荐在新程序中使用T7。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="39d9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用<code class="fe lr ls lt lu b">printf</code></h1><p id="9b83" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">自从第四版<a class="ae lq" href="https://en.wikipedia.org/wiki/Research_Unix#Versions" rel="noopener ugc nofollow" target="_blank">Unix</a>以来，可移植的<code class="fe lr ls lt lu b"><a class="ae lq" href="https://en.wikipedia.org/wiki/Printf_(Unix)" rel="noopener ugc nofollow" target="_blank">printf</a></code> <a class="ae lq" href="https://en.wikipedia.org/wiki/Printf_(Unix)" rel="noopener ugc nofollow" target="_blank">命令</a>实质上已经是更新更好的<code class="fe lr ls lt lu b">echo</code>。它允许你使用<a class="ae lq" href="https://en.wikipedia.org/wiki/Printf_format_string#Format_placeholder_specification" rel="noopener ugc nofollow" target="_blank">格式说明符</a>来人性化输入。</p><p id="9a25" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要解释反斜杠转义序列，请使用<code class="fe lr ls lt lu b">%b</code>。字符序列<code class="fe lr ls lt lu b">\n</code>确保输出以换行符结束:</p><pre class="kj kk kl km gt mz lu na nb aw nc bi"><span id="1fef" class="nd md it lu b gy ne nf l ng nh">printf "%b\n" "Many females in Oble are \noblewomen"<br/># Many females in Oble are<br/># oblewomen</span></pre><p id="2e47" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">尽管<code class="fe lr ls lt lu b">printf</code>有更多的选项，使其成为<code class="fe lr ls lt lu b">echo</code>的更强大的替代品，但这个实用程序并不是万无一失的，并且容易受到<a class="ae lq" href="https://en.wikipedia.org/wiki/Uncontrolled_format_string" rel="noopener ugc nofollow" target="_blank">不受控制的格式字符串</a>的攻击。</p><p id="9153" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于程序员来说，确保他们小心处理用户输入是很重要的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d7d5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在变量中放置新行</h1><p id="8168" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">为了提高编译器之间的可移植性，ANSI C标准于1983年建立。随着<a class="ae lq" href="https://www.gnu.org/software/bash/manual/html_node/ANSI_002dC-Quoting.html#ANSI_002dC-Quoting" rel="noopener ugc nofollow" target="_blank"> ANSI-C引用</a>使用<code class="fe lr ls lt lu b">$'...'</code>，根据标准在输出中替换<a class="ae lq" href="https://en.wikipedia.org/wiki/Escape_sequences_in_C#Table_of_escape_sequences" rel="noopener ugc nofollow" target="_blank">转义序列</a>。</p><p id="4ea0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这允许我们将带有换行符的字符串存储在带有换行符的变量中。您可以通过设置变量，然后使用<code class="fe lr ls lt lu b">$</code>用<code class="fe lr ls lt lu b">printf</code>调用它来做到这一点:</p><pre class="kj kk kl km gt mz lu na nb aw nc bi"><span id="ed8f" class="nd md it lu b gy ne nf l ng nh">puns=$'\number\narrow\nether\nice'</span><span id="6710" class="nd md it lu b gy ni nf l ng nh">printf "%b\n" "These words started with n but don't make $puns"<br/># These words started with n but don't make<br/># umber<br/># arrow<br/># ether<br/># ice</span></pre><p id="2995" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">扩展后的变量是单引号，按字面意思传递给<code class="fe lr ls lt lu b">printf</code>。一如既往，正确处理输入很重要。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1ac9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">奖励回合:外壳参数扩展</h1><p id="7d25" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">在我解释<a class="ae lq" href="https://victoria.dev/blog/bash-and-shell-expansions-lazy-list-making/" rel="noopener ugc nofollow" target="_blank"> Bash和括号</a>的文章中，我介绍了<a class="ae lq" href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html" rel="noopener ugc nofollow" target="_blank"> shell参数扩展</a>的魔力。</p><p id="e868" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们也可以用一个展开式<code class="fe lr ls lt lu b">${parameter@operator}</code>来解释转义序列。我们使用<code class="fe lr ls lt lu b">printf</code>的<code class="fe lr ls lt lu b">%s</code>说明符来打印字符串，并且<code class="fe lr ls lt lu b">E</code>操作符将适当地扩展变量中的转义序列:</p><pre class="kj kk kl km gt mz lu na nb aw nc bi"><span id="fda1" class="nd md it lu b gy ne nf l ng nh">printf "%s\n" ${puns@E}<br/># umber<br/># arrow<br/># ether<br/># ice</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="775c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">人性化输出的持续挑战</h1><p id="f6d2" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">字符串插值对于程序员来说仍然是一个棘手的问题。除了让语言和shells就某些占位符的含义达成一致之外，正确使用正确的转义序列还需要对细节的关注。</p><p id="6cb5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">糟糕的字符串插值会导致看起来很傻的输出，以及引入安全漏洞，例如来自<a class="ae lq" href="https://en.wikipedia.org/wiki/Code_injection" rel="noopener ugc nofollow" target="_blank">注入攻击</a>。</p><p id="76b8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在终端的下一次进化让我们可以用表情符号说话之前，我们最好在为人类打印输出时注意一下。</p></div></div>    
</body>
</html>