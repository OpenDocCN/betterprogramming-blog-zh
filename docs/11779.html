<html>
<head>
<title>Data Augmentation With AugLy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用AugLy进行数据扩充</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/data-augmentation-with-augly-d4e9fcd4d803?source=collection_archive---------8-----------------------#2022-04-15">https://betterprogramming.pub/data-augmentation-with-augly-d4e9fcd4d803?source=collection_archive---------8-----------------------#2022-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b3a8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用于机器学习的一体化增强包</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/52ea16ff2f43ed756967617f1e32757b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fiM5DJhTOUll0109E5a7KQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片取自<a class="ae ky" href="https://github.com/facebookresearch/AugLy" rel="noopener ugc nofollow" target="_blank"> AugLy的Github库</a></p></figure><p id="84e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在机器学习领域，数据扩充是提高最大似然模型性能的最有用的技术之一。</p><p id="0836" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据扩充用于通过对现有数据的轻微修改或转换来创建合成数据。这有助于:</p><ul class=""><li id="b8f7" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">增加训练和测试数据量。</li><li id="b0d5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">减少模型的过度拟合</li></ul><p id="d8cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">截至2021年6月17日，脸书正式开源其名为<a class="ae ky" href="https://github.com/facebookresearch/AugLy" rel="noopener ugc nofollow" target="_blank"> AugLy </a>的数据增强库。该库可用于提高机器学习模型的鲁棒性。</p><p id="57dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它目前支持以下模式:</p><ul class=""><li id="c711" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">声音的</li><li id="5e63" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">图像</li><li id="6e7d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">文本</li><li id="95dc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">录像</li></ul><p id="0b55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文只讨论了文本模态，但是您可以自己尝试其他模态。事不宜迟，让我们继续下一节，开始安装AugLy。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="78da" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">设置</h1><p id="6c8d" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">强烈建议将它安装在基于Linux的操作系统上，尤其是如果您打算在音频数据上使用它。在撰写本文时，对于Windows用户来说，安装过程并不那么简单。下面的安装步骤已经在Python版本3.7.7上运行的Windows 10操作系统上进行了测试。</p><h2 id="f9bf" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">奥格丽</h2><p id="e228" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在此之前，请确保您已经使用Python版本至少3.6或更高版本创建了一个新的虚拟环境。激活它并运行以下命令来安装AugLy:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="abb1" class="nn mr it oa b gy oe of l og oh">pip install augly<!-- -->[all]</span></pre><p id="ec3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，您可以只为单个主机安装依赖项。例如，运行以下命令仅安装音频子库:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="2bb0" class="nn mr it oa b gy oe of l og oh">pip install augly[audio]</span></pre><h2 id="5b7d" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">Python-magic</h2><p id="9a99" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">运行<code class="fe oi oj ok oa b">pip list</code>来检查<code class="fe oi oj ok oa b">python-magic</code>是否安装在您的环境中。如果没有安装，如果您使用的是Linux，请运行以下命令:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="1a1c" class="nn mr it oa b gy oe of l og oh">apt-get install python3-magic</span></pre><p id="1268" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，如果您使用的是Conda，您可以按如下方式安装它:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="5122" class="nn mr it oa b gy oe of l og oh">conda install -c conda-forge python-magic</span></pre><p id="dc5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于Windows用户，您需要安装DLL附带的额外的python-magic包，如下所示:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="9502" class="nn mr it oa b gy oe of l og oh">pip install python-magic-bin</span></pre><h2 id="65a8" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">Matplotlib修复(针对Windows用户)</h2><p id="7aa9" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Augly的早期版本(0.1.1)要求matplotlib==3.3.4作为其依赖项的一部分。如果您遇到以下问题:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="2f8b" class="nn mr it oa b gy oe of l og oh">module 'sip' has no attribute 'setapi'</span></pre><p id="43b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请将您的<code class="fe oi oj ok oa b">matplotlib</code>版本降级到3.2，如下所示:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="4d2e" class="nn mr it oa b gy oe of l og oh">pip install matplotlib==3.2</span></pre><p id="92f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以安全地忽略不兼容警告。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="4abb" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">履行</h1><p id="a570" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在工作目录中创建一个名为<code class="fe oi oj ok oa b">test_augmenter.py</code>的新Python文件。</p><h2 id="328a" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">导入</h2><p id="131a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在文件顶部添加以下<code class="fe oi oj ok oa b">import</code>声明:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="5660" class="nn mr it oa b gy oe of l og oh">import augly.text as textaugs</span></pre><p id="069c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，定义输入文本。您可以将其定义为单个字符串或字符串列表:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="345c" class="nn mr it oa b gy oe of l og oh">texts = ["Who are you and what are you doing here?", "Hello, world! Welcome to Speakr!"]</span></pre><p id="9544" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/facebookresearch/AugLy/tree/main/augly/text" rel="noopener ugc nofollow" target="_blank">执行增强</a>有两种方式:</p><ul class=""><li id="f78a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">基于类的</li><li id="3f7b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">基于功能的</li></ul><h1 id="edb4" class="mq mr it bd ms mt ol mv mw mx om mz na jz on ka nc kc oo kd ne kf op kg ng nh bi translated">基于类别的增强</h1><p id="3d31" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">让我们看一个在输入文本中插入标点符号的例子。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="5f50" class="nn mr it oa b gy oe of l og oh"># instantiate the augmenter<br/>transform = textaugs.InsertPunctuationChars(granularity="all", cadence=5.0, vary_chars=True)<br/># perform transformation on input text<br/>aug_texts = transform(texts)</span></pre><p id="9ca6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需实例化augmenter类，并将输入文本作为输入参数传递。</p><h1 id="b44c" class="mq mr it bd ms mt ol mv mw mx om mz na jz on ka nc kc oo kd ne kf op kg ng nh bi translated">基于功能的增强</h1><p id="6a6c" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">可以使用以下基于功能的增强来执行相同的过程:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="68c8" class="nn mr it oa b gy oe of l og oh"># perform transformation on the input text<br/>aug_texts = textaugs.insert_punctuation_chars(texts, granularity="all", cadence=5.0, vary_chars=True)</span></pre><p id="2dc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行Python文件时，您应该在控制台上获得以下输出(每次运行的结果都不同):</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="3b90" class="nn mr it oa b gy oe of l og oh">['Who a.re yo?u and, what: are ,you d:oing ?here?', "Hello', wor!ld! W-elcom.e to ...Speak.r!"]</span></pre><p id="c597" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在官方存储库中查看下面的代码以获得关于可用输入参数的更多信息。</p><h1 id="a767" class="mq mr it bd ms mt ol mv mw mx om mz na jz on ka nc kc oo kd ne kf op kg ng nh bi translated">可用的文本增强器</h1><p id="757e" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">AugLy支持以下<a class="ae ky" href="https://github.com/facebookresearch/AugLy/blob/main/augly/text/functional.py" rel="noopener ugc nofollow" target="_blank">文本扩充</a>:</p><ul class=""><li id="bfe2" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe oi oj ok oa b">insert_punctuation_chars</code>:在每个输入文本中插入标点符号。</li><li id="359f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe oi oj ok oa b">insert_zero_width_chars</code>:在每个输入文本中插入零宽度字符。</li><li id="8d06" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe oi oj ok oa b">replace_bidirectional</code>:反转每个输入文本中的每个单词(或单词的一部分)，并使用双向标记以其原始顺序呈现文本。它将每个单词分别颠倒，即使换行也能保持单词的顺序。</li><li id="65fd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe oi oj ok oa b">replace_fun_fonts</code>:根据粒度用有趣的字体替换单词或字符。</li><li id="db3e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe oi oj ok oa b">replace_similar_chars</code>:用相似字符替换每个文本中的字母。</li><li id="5a62" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe oi oj ok oa b">replace_similar_unicode_chars</code>:用相似的unicodes替换每个文本中的字母。</li><li id="5546" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe oi oj ok oa b">replace_upside_down</code>:根据粒度将文字上下翻转。</li><li id="fc81" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe oi oj ok oa b">simulate_typos</code>:使用拼写错误、键盘距离和交换来模拟每个文本中的错别字。</li><li id="bfde" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe oi oj ok oa b">split_words</code>:将文本中的单词拆分成子单词。</li></ul><p id="10b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在所有可用的增强器中，<code class="fe oi oj ok oa b">simulate_typos</code>是生成用于聊天机器人或文本分类的合成数据的最有用的函数之一。</p><p id="d136" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用下面的代码在这个增强器上运行一个简单的测试:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="f2e1" class="nn mr it oa b gy oe of l og oh">for i in range(5):<br/>    aug_texts = textaugs.simulate_typos(texts)<br/>    print(aug_texts)</span></pre><p id="07bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出应该如下所示:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="4284" class="nn mr it oa b gy oe of l og oh">['Who are you and whaaat arf ytou doing here?', 'Hello, worls! Welcome to Zpeakr!']<br/>['Who aer you andd waht are you doing here?', 'Hello, worls! Welcome to Speark!']<br/>['Who aee you adn waht are you doing here?', 'Hello, worls! Eelcome to Speakr!']<br/>['Who arf ytou anbd what are you doing here?', 'Hello, worls! Welcome ot Speakr!']<br/>['Who are you anbd what are yuo doing htere?', 'Hello, worls! Welcoem to Speakr!']</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="a9ff" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="9b40" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在您自己的用例中尝试一下，尤其是在其他模态上。您可以测试适用于其他设备的增强器。您可能需要为一些函数指定相当多的输入参数，否则每次运行都会得到相同的输出。</p></div></div>    
</body>
</html>