<html>
<head>
<title>A Quick Look at D3.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速浏览D3.js</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-quick-look-at-d3-js-ecc7657556f4?source=collection_archive---------5-----------------------#2021-07-05">https://betterprogramming.pub/a-quick-look-at-d3-js-ecc7657556f4?source=collection_archive---------5-----------------------#2021-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fc3b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用JavaScript的强大功能将您梦想的任何事情可视化</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1aec44cd077421bec7d27653cfc14095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K2IuuTf4SGrXXks2"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@lukechesser?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卢克·切瑟</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="bd51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">D3是数据驱动文档的缩写，是一个JavaScript库，它使得以多种方式显示数据成为可能，并有助于DOM的检查和操作。</p><p id="62a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然你可能认为它是，D3不是一个图表库。它提供了更大的灵活性，现有的图表库如<a class="ae kv" href="https://recharts.org/en-US/" rel="noopener ugc nofollow" target="_blank"> Recharts </a>、<a class="ae kv" href="https://c3js.org/" rel="noopener ugc nofollow" target="_blank"> C3js </a>和<a class="ae kv" href="https://rawgraphs.io/" rel="noopener ugc nofollow" target="_blank"> Raw graphs </a>都利用了这一点。D3很棒，因为当你试图过多地定制它时，你的图表库会崩溃，而D3会一直运行下去。</p><p id="ce59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，您将通过示例了解D3。总的流程可以归结为:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/471da9f6fab65b8c07f7419a0153d3c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I1PggUb26z9nyICj-4ojQA.png"/></div></div></figure><p id="b452" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是首先，让我们从在网页上画一些不同颜色的形状开始。这将让你习惯使用选择器和形状。</p><h1 id="23a7" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">画基本形状</h1><p id="ad8d" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">那么我们到底该如何使用D3绘图呢？我们首先创建一个包含空SVG(可缩放矢量图形)的HTML页面。如果你不知道SVG是什么，它是一个由基本形状组成的图像，这使得它非常具有可伸缩性。我们将使用D3绘制这些主要形状。</p><p id="e875" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，创建一个导入D3的HTML文档。在整篇文章中，我们将继续使用相同的HTML文档。我们将只编辑突出显示的脚本标记之间的代码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/ef87afc28c405135e8b89534c58982b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfjk4W3X38F4TY4725-k1A.png"/></div></div></figure><p id="56a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如你所见，在第4行我们导入了D3。如果你使用的是带有<a class="ae kv" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>的前端框架，你可以使用NPM。在第7行，我们定义了一个SVG元素，我们将在其中绘制我们的形状。</p><p id="fc08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们编写D3代码的第一行:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/8bf74022efe49ce8ecd1819812390d13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VFpiUVIrGGx76SVZAzK6WA.png"/></div></div></figure><p id="add4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第2行，我们从使用<code class="fe mt mu mv mw b">d3.select()</code>方法开始。这个选择器函数将使用您传递给它的CSS选择器来查找第一个元素。在我们的例子中，页面上只有一个<code class="fe mt mu mv mw b">&lt;svg&gt;</code>标签，所以它将返回唯一的现有SVG元素。</p><p id="75f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们稍后会用到的另一个选择函数是<code class="fe mt mu mv mw b">d3.selectAll()</code>。这个函数将返回所有匹配CSS选择器的元素，而不仅仅是第一个。</p><p id="4a50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第4行，我们使用了SVG元素，并在它后面添加了一个圆圈。您可以向SVG元素添加多种不同的形状。在第5行，我们应用了D3的方法链接。方法链允许我们一个接一个地调用多个函数，避免我们不得不在每一行都写<code class="fe mt mu mv mw b">svg.function(...)</code>。</p><p id="3879" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第5、6、7和8行，我们使用<code class="fe mt mu mv mw b">d3.attr</code>函数设置属性。这些属性是形象化我们的圈子所必需的。<code class="fe mt mu mv mw b">cx</code> <em class="ls"> </em>将是我们圆心的<em class="ls"> x </em>坐标，<code class="fe mt mu mv mw b">cy</code> <em class="ls"> </em>将是圆心的<em class="ls"> y </em>坐标，<code class="fe mt mu mv mw b">r</code>将是圆的半径，<em class="ls"> </em> <code class="fe mt mu mv mw b">fill</code> <em class="ls"> </em>将是填充圆的颜色。这些是固定属性。<a class="ae kv" href="https://www.freecodecamp.org/news/svg-rectangle-and-other-svg-shapes/" rel="noopener ugc nofollow" target="_blank">在freeCopeCamp上可以找到这些属性</a>在每个基本形状上的用法示例。</p><p id="e4ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，如果你查看你的浏览器，你会看到这样的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/b37957ddc25dc4dbb2cbc60fb5f9dd00.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*kR2wRHO0uu0_6mQR_ObzgA.png"/></div></div></figure><p id="6cc4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这可能看起来不多，但很棒。即使是最复杂的图形也只是一堆简单的形状。</p><p id="1d94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们给图像添加另一个正方形:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/020feef5a0bc7d0043a0f6c934a6ab10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TLxczjGYb_BvfaVw3L5Jzw.png"/></div></div></figure><p id="7c5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们添加一个<code class="fe mt mu mv mw b">rect</code>形状，并设置正确显示它所需的属性。运行代码会得到以下结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/8ad26287e9e29a9bc8917af675a7b6a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*R3YdQwzE29TlYzmbaxlJ8g.png"/></div></figure><p id="c9d0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您已经知道了添加形状的基本知识，让我们从加载一些数据并根据这些数据显示形状开始。</p><h1 id="5e72" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">加载数据</h1><p id="0eb6" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">有多个D3函数用于获取不同类型的数据。最有趣的开始是<code class="fe mt mu mv mw b">d3.json('...')</code>、<code class="fe mt mu mv mw b">d3.csv('...')</code>、<code class="fe mt mu mv mw b">d3.xml('...')</code>。</p><p id="19b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这三个工具都使用Fetch来“获取”数据。CSV不允许嵌套对象，而JSON和XML允许。</p><p id="b702" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在接下来的章节中，我们将使用来自我们虚构的社交网络(<code class="fe mt mu mv mw b">socialnetwork.json</code>)的以下数据文件和以下样式:</p><div class="kg kh ki kj gt ab cb"><figure class="na kk nb nc nd ne nf paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/1714991e8e0023b20f569d3165278b51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*zO6YbgiqSO5_ZqY6QSzFfw.png"/></div></figure><figure class="na kk ng nc nd ne nf paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/9009dbee20c275c4e192985634b2bb6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*czrlYwScnYNdwNkmnddDWQ.png"/></div></figure></div><p id="6a22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将从构建图书馆图表开始。水平方向显示我们的年份，垂直方向显示我们的评论数量。我们将分别使用<code class="fe mt mu mv mw b">d3.axisBottom()</code>和<code class="fe mt mu mv mw b">d3.axisLeft()</code>来实现这一点。在代码中，加载数据和绘制轴是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/828de3c2a10dbbbb4c1fbbc043f8804d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eXRT8HVwVk4myXXnZswnjg.png"/></div></div></figure><p id="94a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码太多了！别担心，我们会一行一行的来。</p><p id="0835" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第3行，我们从获取JSON开始，因为<code class="fe mt mu mv mw b">d3.json()</code>返回一个承诺，我们必须使用<code class="fe mt mu mv mw b">.then()</code>或<code class="fe mt mu mv mw b">await</code>来等待获取完成。第5行和第10行完成后，我们开始创建尺度函数。</p><h2 id="ff8b" class="ni lv iq bd lw nj nk dn ma nl nm dp me lf nn no mg lj np nq mi ln nr ns mk nt bi translated">比例函数</h2><p id="b3c9" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">缩放功能是将数据渲染到屏幕上的关键之一。假设我们从2015年到2020年，屏幕分辨率为500 x 500。如果我们在<em class="ls"> x </em>轴上显示年份，我们希望将2015–2020映射到0–500。</p><p id="85c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是尺度函数的由来。其中一个是<code class="fe mt mu mv mw b">.scaleLinear()</code>，它会将一个范围内的数字线性转换成另一个范围。对于<code class="fe mt mu mv mw b">scaleLinear()</code>函数，我们在第7行给出一个范围。我们通过了一个范围<code class="fe mt mu mv mw b">[100,800]</code>，因为我想在第100个像素开始绘制，并在第800个像素结束绘制(在<em class="ls"> x </em>轴上)。</p><p id="c127" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，我们传递一个域，这个域就是我们要映射的数据的范围。<code class="fe mt mu mv mw b">.domain()</code>需要一个具有最小值和最大值的数组。幸运的是，D3有函数<code class="fe mt mu mv mw b">d3.extent()</code>、<code class="fe mt mu mv mw b">d3.max()</code>和<code class="fe mt mu mv mw b">d3.min()</code>。在第8行，我们将最小值设置为<code class="fe mt mu mv mw b">minimum of years — 1</code>，将最大值设置为<code class="fe mt mu mv mw b">maximum of years + 1</code>。我们这样做是为了能够稍后在条形图中使我们的条形居中。</p><p id="5e20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第13行，我做了一些稍微不同的事情，因为我希望坐标轴从0开始，到注释的最大值结束。我不想显示评论范围50-150，但我想显示0-150之间的评论。</p><p id="1b84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mt mu mv mw b">d3.extent()</code>会返回<code class="fe mt mu mv mw b">[max, min]</code>而不需要你分别调用min和max。</p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="56a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后是画实际轴的时候了。在第15行，我们开始添加<em class="ls"> x </em>轴。我们给它一个类用于设计目的(见设计图片),然后我们转换我们的g元素，因为一个<em class="ls"> x </em>轴总是从左上角的原点开始绘制。所以我们把它翻译到底部。之后我们执行<code class="fe mt mu mv mw b">.call(d3.axisBottom(x).tickFormat(d3.format("d"))</code>。<code class="fe mt mu mv mw b">.axisBottom</code>将绘制我们的轴。(注意我们给它的是range函数，所以它知道在什么范围/域执行。)然后我们做一个额外的<code class="fe mt mu mv mw b">.tickFormat()</code>，它告诉D3如何显示标签。在我们的例子中，我们想要从2014到2021的简单数字，所以我们使用<code class="fe mt mu mv mw b">"d"</code>。</p><p id="0d4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，我们对y轴做基本相同的事情，除了变换不同，因为我们需要水平平移轴来显示标签。</p><p id="9b47" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/64ce1f1932bff9458108272327d72382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nLNCEOzEO-lFlyn92oqllg.png"/></div></div></figure><h1 id="8e05" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">选择元素并绑定数据</h1><p id="329e" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">接下来，我们要根据评论的数量为每一年画矩形。为此，我们将选择我们的SVG并绑定我们的数据。</p><p id="8aa1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这可以归结为这样写:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/aabab9fe7936e1acbb1ce8398f301c20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q9yetjsxnGLT6sf54QTnYQ.png"/></div></div></figure><p id="302c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们使用<code class="fe mt mu mv mw b">d3.select()</code>函数来获取我们的SVG。(注意，在前面的代码片段中，我们将其保存在一个名为<code class="fe mt mu mv mw b">svg</code>的变量中。)<em class="ls"/></p><p id="261f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，我们调用<code class="fe mt mu mv mw b">.data()</code>函数。数据函数本身有一个强制参数，即您要呈现的数据，还有一个可选参数，用于指定键。为了指定键，我们给它一个函数，该函数接受一个项和数组中的索引。在这个例子中，我返回了索引。</p><p id="b261" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而！正如我们将在接下来的部分中看到的，您可以在条目上使用一个字段来知道要更新/删除/插入哪些条目。如果我们的数据集中有一个<code class="fe mt mu mv mw b">id</code>属性，我们可以写类似于<code class="fe mt mu mv mw b">(item, index)=&gt; item.id</code>的东西。</p><p id="cd3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们知道了如何进行数据绑定，让我们添加一些矩形。</p><h1 id="7c47" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">创建、更新和删除元素</h1><p id="0188" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">当您更新数组中的数据时(例如，通过过滤)，D3将比较数组并决定做什么。</p><p id="7605" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我将只讨论两个最重要的函数:添加<code class="fe mt mu mv mw b">.enter()</code>和移除<code class="fe mt mu mv mw b">.exit()</code>。</p><p id="65ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了理解这种逻辑，请考虑下面的代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/c8b338987c1c8c2277ec47d9040bcf51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ieXUlNuciBFawmF7v_YuZQ.png"/></div></div></figure><p id="d069" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们第一次执行这段代码时，考虑我们使用这个数组作为数据<code class="fe mt mu mv mw b">[1,2,3]</code>。</p><p id="9d20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的选择器<code class="fe mt mu mv mw b">.barchartrectangle</code>将返回0个元素，所以D3知道数组中的项目是三个新的数据。因此，它将使用更改为<code class="fe mt mu mv mw b">.enter()</code>语句的功能。在这个语句中，我们为每个新的数据添加新的<code class="fe mt mu mv mw b">rect</code> s <em class="ls"> </em>，并给它们一个类<code class="fe mt mu mv mw b">barchartrectangle</code>。因为没有“删除”，所以<code class="fe mt mu mv mw b">.exit()</code>语句将被忽略。</p><p id="0480" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，如果我们将数组更新为[1，2]并再次运行这段代码，<code class="fe mt mu mv mw b">.barchartrectangle</code>选择器将返回三个现有元素。但是，D3注意到数组中只有两项。因此，它将使用链接到<code class="fe mt mu mv mw b">.exit()</code>语句的函数，在本例中是第三个元素<code class="fe mt mu mv mw b">.remove()</code>。</p><p id="3737" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">D3怎么知道要删除哪些元素？这取决于我们之前定义的数据键。在我们的例子中，这仍然是索引，所以它将删除已经添加的第三个元素。然而，如果我们的项目是实际的id <code class="fe mt mu mv mw b">(item, index)=&gt; item</code>，我们将数组更新为[1，3]，那么我们的第二个<code class="fe mt mu mv mw b">barchartrectangle</code>将被移除，而不是第三个。</p><p id="73f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在你已经知道了<code class="fe mt mu mv mw b">.enter()</code>和<code class="fe mt mu mv mw b">.exit()</code>语句是如何工作的，是时候呈现我们的条形图了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/578a0435eb350aa8f4638887d36d545a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bgZ-eUXg4HbbFoLXrPU6JQ.png"/></div></div></figure><p id="2958" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第4行，我们从使用<code class="fe mt mu mv mw b">.enter()</code>开始，这样D3将知道如何处理新数据。在第5行，我们添加了一个新的<code class="fe mt mu mv mw b">rect</code>，之后我们设置了所有必要的属性。正如您在第6行和第7行看到的，<code class="fe mt mu mv mw b">.attr()</code>函数不仅仅接受固定值；相反，它可以采用一个使用该项及其索引的函数。这样我们就可以根据我们的数据来绘制元素。</p><p id="b604" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第6行，我们首先通过调用我们的<em class="ls"> x </em>缩放函数来获得缩放后的<em class="ls"> x </em>位置，该函数是在我们的年份之前定义的。这将返回我们想要放置条形图的像素值。因为我们稍后将宽度设置为100，所以我们通过执行<code class="fe mt mu mv mw b">-50</code>来将条调整到值点的中心。对于<em class="ls"> y </em>坐标，我们可以简单的调用我们的缩放函数。对于第9行的高度，我们必须做<code class="fe mt mu mv mw b">800- y(item.comments)</code>。这是因为我们的标度函数是相反的。记住我们的范围是<code class="fe mt mu mv mw b">[800, 100</code>，所以低注释值将被映射到高像素值。这就是为什么我们要通过做<code class="fe mt mu mv mw b">800 — y(item.comments)</code>来反转它。</p><p id="0236" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们设置填充颜色为蓝色，只是为了美观。最后的结果是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/ca8ae8cd1efc8cbd09c486c8b1207b2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6B8r27xvXq_gB_k3iOBmpg.png"/></div></div></figure><p id="a61c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是我们——我们使用数据在屏幕上渲染了一些东西。D3就是这么回事！但是请记住，还有很多事情要做。查看<a class="ae kv" href="https://d3js.org/" rel="noopener ugc nofollow" target="_blank"> D3.js上的酷炫图表和数字——数据驱动文档(d3js.org)</a>。</p><p id="dc38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想更深入地了解D3或者获得更多很棒的例子，我推荐Elijah Meeks的书<a class="ae kv" href="https://www.manning.com/books/d3-js-in-action" rel="noopener ugc nofollow" target="_blank"> D3.js in Action </a>。</p><h1 id="2106" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">结论</h1><p id="6338" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">在本文中，您快速了解了如何使用D3库进行渲染。现在，您可以使用动态生成的数据在SVG中可视化形状。</p><p id="bd4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还有很多东西要学:地理测绘、HTML操作、网络可视化……这样的例子不胜枚举。但是3D的一大优点是几乎没有边界。所以去尝试一下吧！</p></div></div>    
</body>
</html>