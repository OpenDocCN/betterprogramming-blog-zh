# 使用 Jetpack Compose 构建单一活动应用程序

> 原文：<https://betterprogramming.pub/single-activity-apps-with-jetpack-compose-bba4938ad630>

## 创建独立的 Android 应用程序

![](img/93394b17baa4cf819aaecfbe4ffcb68c.png)

由[丹尼尔·罗梅罗](https://unsplash.com/@rmrdnl?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

当我在 2017 年开始开发 android 应用程序时，我记得为应用程序中的每个屏幕或功能构建活动，并在这些活动中烘焙所有的业务逻辑。代码看起来如此复杂和混乱，我会自豪地向我的朋友炫耀。我大约 15-16 岁的时候上 11 年级，我认为我很聪明，“没有人能做我做的事”，我对自己说。

然后我了解了片段，我最讨厌 android 开发。重点是什么？它们看起来就像活动，但却让一切变得更加困难。如果不经历迷宫般的错误(顺便说一下，这教会了我很多)，我就无法让片段事务工作或在多个片段之间传递一些数据。为了避免麻烦，我只在必要时使用片段，并在整个应用程序中继续使用活动。

在我追求不断提高技能和学习的过程中，我发现了干净的架构和坚实的原则，我试图将它们应用到我构建的每一个软件中，无论是手机还是其他。我构建的下一个应用程序有一个活动和大约 4 个片段。事实证明碎片并没有那么糟糕。在这一点上，我对片段有了更好的理解，并发誓永远使用它们。直到我拿起 jetpack compose。长话短说，我又讨厌碎片了。

如果您从未使用过 jetpack compose，您应该尝试一下。我不会深入讨论它的工作原理或基本原理。我使用的最好的资源是 mitch 的[编码](https://codingwithmitch.com/)和 Google 的[文档](https://developer.android.com/jetpack/compose)。在本文中，我将介绍使用 jetpack 库构建单活动应用程序的许多方法中的一种。

关键的想法是有一个单一的活动，作为你的应用程序的主要入口和出口。某些应用程序可能需要构建几个活动，例如一个`MainActivity`和一个`SettingsActivity`，但是基本思想是相同的。

在我们开始之前，了解组成大多数应用程序的主要组件是很重要的，在这种情况下，主要是一个或多个用户交互的屏幕，以及在这些屏幕之间导航的机制(如果有多个屏幕的话)。那么这是如何工作的呢？

# 创建应用程序的主要活动

一旦我们准备好了基本活动，我们现在需要设置导航控制器，它将允许我们在不同的屏幕之间导航。对于这个例子，我们假设我们的应用程序只有 3 个可能的屏幕，主页，搜索和图书馆。

下一步是创建一个顶层的 Singleton Screen 对象，为应用程序中所有可能的屏幕分配唯一的路径。对于我们的例子，这个对象——存储在一个顶级 Kotlin 文件中——看起来像这样:

# 添加 NavHost

回到`MainActivity`,我们现在添加一个`NavHost`,初始路线设置为`Screen.Home.route`,因为这是我们应用程序的默认屏幕。

下一步是将所有顶级目的地——在我们的例子中是 Home、Search 和 Library 目的地——放入 NavHost。为此，我们利用 Kotlin 的扩展函数，将每个屏幕表示为`NavGraphBuilder`的扩展。

> 我们利用 Kotlin 的扩展函数，将每个屏幕表示为 NavGraphBuilder 的扩展

为搜索和库屏幕编写完全相同的代码

回到`MainActivity`，我们现在把这些放在`NavHost`里，如下所示:

当然，应用程序不会这样工作。为了在屏幕间导航，你需要一个带有底部应用程序栏或其他导航方式的支架，例如一个调用`navController.navigate(route)`的按钮点击。上述函数允许您创建一个导航图，定义应用程序中不同屏幕之间的关系。

一个好的做法是将导航逻辑提取到一个单独的顶级 Kotlin 文件中，因为对于一个生产应用程序来说，导航图通常会变得非常复杂。另一个最佳实践是将我们的屏幕放在单独的模块中，但这是另一天的主题。

谢谢你过来。保持警惕！