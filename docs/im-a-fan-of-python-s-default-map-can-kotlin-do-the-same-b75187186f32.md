# 我是 Python 默认地图的粉丝。科特林也能做到吗？

> 原文：<https://betterprogramming.pub/im-a-fan-of-python-s-default-map-can-kotlin-do-the-same-b75187186f32>

## 见见科特林版本的 defaultDict

![](img/74540aeddc0a2ca47e1dd43a80000214.png)

一张世界地图

我们都知道什么是(散列)映射，如果你知道 Python 编程语言，你可能在某个时候遇到过`defaultdict`。我想知道 Kotlin 中是否有相同的构造，我将在本文中解释我的发现。

Python 的`defaultdict`文档包括几个例子可以在[这里](https://docs.python.org/2/library/collections.html#defaultdict-examples)找到。下面的代码片段演示了它的基本用法:

默认字典的名字来源于这样一个事实，即它包含了它还不知道的键的默认值。就像上面的例子，一个客户端试图从映射中取出一个随机值，结果得到一个值`0`,尽管从来没有任何东西写到映射中。

`defaultdict`也可以用于整数之外的其他类型，并确保在未知的键访问中不会出现`KeyError`。相反，它为未知键提供了一个默认值，这对于分组和计数算法非常有用，如下所示:

这个小工具非常有用，我经常用它来解决你在很多很多技术面试中遇到的算法问题，我在这里写了关于[的](https://medium.com/better-programming/i-share-my-top-4-tips-for-succeeding-in-your-next-technical-coding-interview-21408f142b1b)。

现在让我们考虑一下 Kotlin 编程语言，看看我们是否可以拥有与 Python 的`defaultdict`相同的行为。

# 一个简单的问题

假设我们要编写一个通用函数，该函数接受一个集合并返回一个映射，该映射包含原始集合中与其出现次数相关联的元素:

虽然在 Kotlin 中有一个自然的函数方法来实现这一点，但我们想先考虑一些迭代方法。先说下面这个。

# 方法 1:没有默认值的迭代解决方案

我们可以为这个算法使用一个`MutableMap`。当迭代所有的值时，我们查看地图，看它以前是否被见过。如果是，我们递增计数器；否则，我们将初始计数`1`放入映射中。让我们看看如何更好地利用显式缺省值。

# 方法 2:带有显式默认值的迭代解决方案

作为前一个解决方案的替代方案，我们可以利用`putIfAbsent`来确保元素被初始化为 0，这样我们就可以安全地递增下面一行中的计数器。在这种情况下，我们所做的是提供一个显式的默认值。另一个类似的工具是`getOrDefault`:

```
countMap[e] = countMap.getOrDefault(e, 0) + 1
```

通过`putIfAbsent`或`getOrDefault`提供明确的缺省值会带来简单易懂的解决方案，但我们可以做得更好。

# 隐式缺省迭代解法

类似于 Python 的`defaultdict`，Kotlin 附带了一个简洁的[扩展](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/with-default.html)叫做`MutableMap::withDefault`，看起来像这样:

这个扩展允许为在映射中没有关联值的键提供一个初始化器。让我们在解决方案中使用它:

它进一步简化了代码，因为我们不再需要处理迭代中的未知值。因为我们使用的是默认映射，所以我们可以安全地从中获取值，并在进行过程中递增计数器。

## 重要说明

使用`withDefault`扩展时需要注意一件重要的事情，这是它的文档的一部分:

> *[…]当原始映射不包含指定键的值，并且值是通过【Map.getValue】函数* *[…]* 获得的 ***时，使用该隐式默认值***

仅当您使用`Map::getValue`时，才会提供默认值，而使用索引操作符访问地图时，情况并非如此。

这样做的原因是`Map`接口的契约，它说:

> *返回与给定的【关键字】相对应的值，或者* `*null*` *如果这样的关键字在地图中不存在。*

既然默认地图想要履行这个契约，那么在不存在 key 的情况下除了`null`之外不能返回任何东西，这个问题之前已经在 [Kotlin 论坛](https://discuss.kotlinlang.org/t/map-withdefault-not-defaulting/7691)讨论过了。

# 让我们习惯性地

好的，我们看到 Kotlin 确实提供了在地图中提供默认值的方法，这很好。但是，像我们在上面的例子中那样写代码是习惯性的吗？嗯，看情况。使用 Kotlin 自带的分组和计数功能的函数式 API，大多数情况都可以用简单得多的方式解决。

尽管如此，了解备选方案还是有好处的，因为在某些情况下，您可能会选择使用迭代方法。如果你的目标是时间和空间上最优的解决方案，这一点尤其正确。让我为您提供我们代码的简化版本:

它仍然使用了一个显式的`for`循环，但是通过使用`apply`得到了简化，它允许我们在一条语句中初始化 map。你可以在这里阅读`apply`和所有其他范围函数。

在 Kotlin 中有几十种方法可以解决给定的问题，但是可能最短的(虽然不是最佳的)一种**是**一种功能方法:

# 结论

我们可以使用 Kotlin 以许多不同的方式解决简单的算法。与 Python 类似，您可以使用默认值提供者初始化地图，但需要注意常规索引操作访问不会像您预期的那样工作。

如文件所述，必须使用`getValue`功能。由于 Kotlin 附带了一个非常有用的标准库，所以您应该考虑尽可能多地使用它。这意味着，在大多数情况下，实现分组或计数等常见的事情不需要从头开始实现，而是利用标准库中现有的功能来完成。

另一方面，如果你的目标是最优的解决方案，例如，在一次编码面试中，了解功能方法的替代方案是很重要的，这使得评估时间和空间的复杂性变得很困难。知道如何使用默认映射是编写可理解的高性能代码的重要一步。