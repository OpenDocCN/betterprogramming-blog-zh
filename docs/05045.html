<html>
<head>
<title>Track Your Smartphone in 2D With JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript在2D追踪你的智能手机</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/track-your-smartphone-in-2d-with-javascript-1ba44603c0df?source=collection_archive---------5-----------------------#2020-06-03">https://betterprogramming.pub/track-your-smartphone-in-2d-with-javascript-1ba44603c0df?source=collection_archive---------5-----------------------#2020-06-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5542" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">想象一下你可以用这种新的互动媒介做什么</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c124adbf127ac3f2d8f761e32862770c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KAUa7K-zxsPWMeITYC8ghg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="78db" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">随着向网络的根本性转变，我们能够直接在浏览器上做非常酷的事情。在本教程中，我们将利用<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/Sensor_APIs" rel="noopener ugc nofollow" target="_blank">通用传感器API </a>将你的智能手机变成一个具有实时跟踪功能的指针。</p><p id="a212" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我们要做的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="961f" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">先决条件</h1><ul class=""><li id="0633" class="mw mx it la b lb my le mz lh na ll nb lp nc lt nd ne nf ng bi translated">截至发稿时，iOS上还不支持通用传感器API。此外，一些Android智能手机没有所需的传感器。但是，仍然可以使用Chrome DevTools中的模拟传感器来完成本教程:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/0b4f2e286fa8e71663bd3e27cf40f8a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*724dho5DtdfvvAyKHX4A0w.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/55334a95e3d96dcc8ab07999a55427fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*hcc7W9mNmPkiDKSujmohng.png"/></div></figure><ul class=""><li id="4f5d" class="mw mx it la b lb lc le lf lh nj ll nk lp nl lt nd ne nf ng bi translated">也可以通过USB从Android智能手机上查看Chrome的控制台输出，尽管这需要一些进一步的设置。</li><li id="df94" class="mw mx it la b lb nm le nn lh no ll np lp nq lt nd ne nf ng bi translated">通用传感器API需要安全上下文。因此，HTTPS需要<strong class="la iu"> <em class="nr"> </em> </strong>。你既可以用传感器模拟器在本地主机<em class="nr"> </em>上工作，也可以用智能手机在在线代码编辑器(比如<a class="ae lu" href="http://repl.it" rel="noopener ugc nofollow" target="_blank"> Repl.it </a>)上工作。</li></ul><p id="8a52" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nr">注意:教程的所有内容都可以在</em><a class="ae lu" href="https://repl.it/@thesanjeetc/PhoneTrackingDemo" rel="noopener ugc nofollow" target="_blank"><em class="nr">this</em></a><em class="nr">Repl中找到，在这里你可以浏览和编辑代码，也可以尝试演示。</em></p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="d180" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">跟踪您的智能手机</h1><p id="d516" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">让我们从一个通用的<code class="fe nv nw nx ny b">controller.html</code>文件和相应的<code class="fe nv nw nx ny b">controller.js</code> <em class="nr"> </em>脚本开始:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz lw l"/></div></figure><p id="6590" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通用传感器API <em class="nr"> </em>支持<a class="ae lu" href="https://mobiforge.com/design-development/the-generic-sensor-api" rel="noopener ugc nofollow" target="_blank">多传感器</a>。但是，对于我们的需求，我们将使用AbsoluteOrientationSensor。</p><p id="dbe7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">根据<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/AbsoluteOrientationSensor" rel="noopener ugc nofollow" target="_blank"> MDN web文档</a>,<code class="fe nv nw nx ny b">AbsoluteOrientationSensor</code><em class="nr"/>是一个传感器融合API，它“描述了设备相对于地球参考坐标系的物理方向”</p><p id="6dd5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过合并来自多个真实传感器的数据，可以实现新的虚拟传感器，这些传感器可以合并和过滤数据，以便更容易使用——这些传感器被称为融合传感器。在这种情况下，来自机载磁力计、加速计和陀螺仪的数据用于<code class="fe nv nw nx ny b">AbsoluteOrientationSensor</code>的<em class="nr">T4实施。</em></p><p id="1445" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是与这个虚拟传感器接口的代码。就是这样！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz lw l"/></div></figure><p id="8ca3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，用一个设定的频率初始化传感器对象——读取传感器的速率，并触发相应的<code class="fe nv nw nx ny b">handleSensor</code> <strong class="la iu"> </strong>回调。然后它开始读取过程。</p><p id="b777" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">刷新页面后，移动手机查看以下输出。你应该会看到一连串的四元数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/060361f11a22e4569b92d8a4bfadc4b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jTmq4wpHedMAA1u_wAKLzg.png"/></div></div></figure><p id="080b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是什么是四元数呢？</p><blockquote class="ob"><p id="2011" class="oc od it bd oe of og oh oi oj ok lt dk translated">"四元数是一个扩展复数的数系."— <a class="ae lu" href="https://en.wikipedia.org/wiki/Quaternion" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></blockquote><p id="7f1a" class="pw-post-body-paragraph ky kz it la b lb ol ju ld le om jx lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">代替欧拉角，它们可以用作描述物体在空间中的方位的另一种方法。四元数在游戏开发中被广泛使用，因为使用它们进行计算的成本较低。</p><p id="80a5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，为了简单起见，让我们把这些转换成更直观的欧拉角。遵循<a class="ae lu" href="https://en.wikipedia.org/wiki/Conversion_between_quaternions_and_Euler_angles#Quaternion_to_Euler_Angles_Conversion" rel="noopener ugc nofollow" target="_blank">转换公式</a>，下面是一个JavaScript实现。当我们在二维空间中跟踪时，音高被省略了:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz lw l"/></div></figure><p id="cf8c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">更新你的<code class="fe nv nw nx ny b">handleSensor</code>函数，现在使用上面的函数打印转换后的欧拉角:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz lw l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/7dd327129e5dfc7a06c4812f606d19f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6rIl_kgxQNDbaOi2g9HcqA.png"/></div></div></figure><p id="4d9d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您应该看到以弧度表示的角度输出，当您旋转手机时，它应该会直观地发生变化。以下是我们在2D追踪指针时使用的尺寸。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/24edfde0376d013818fabd5b564c2c1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-VjAKjL2H6m4aH7PPcux8w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="969c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们已经成功地与通用传感器API接口，以获得所需的传感器数据来实时跟踪您的智能手机的方向。我们现在需要将这些变化的角度转换成投射在屏幕上的运动<em class="nr"> </em>。</p><p id="f497" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但首先，我们需要一种校准方法，即设置一个测量所有距离的初始起始位置:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz lw l"/></div></figure><p id="e5ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当您单击控制器页面主体时，手机的当前方向被设置为测量所有角度和距离的起点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/4ff57e6e88cd47e82d6beb608a6a003a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vh0xWqkkvhGUz_veD2ZyYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="874b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了计算移动的相对距离，需要简单的三角学，利用从起点开始的角度变化。</p><p id="f064" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当取差值时，我们需要一种方法将<em class="nr"> </em>环绕起来以确保一个正确的值(即在180°和-180°点)。</p><p id="649f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz lw l"/></div></figure><p id="085b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nr">注:</em> <strong class="la iu"> <em class="nr"> </em> </strong> <em class="nr">最后计算的数字800决定了控制器离画布的虚拟距离。在现实世界中，这是没有意义的，而是可以用来改变运动的灵敏度。</em></p><p id="d8b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">更新您的<code class="fe nv nw nx ny b">handleSensor</code> <strong class="la iu"> </strong>函数，使用上面的函数打印出计算的距离:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz lw l"/></div></figure><p id="8c23" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！</p><p id="5c26" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您现在能够实时跟踪智能手机的移动，并将其转换为屏幕上移动的距离测量。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="e9b7" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">用智能手机指点</h1><p id="4f8e" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">通过一个简单的Node.js服务器、一些<a class="ae lu" href="https://socket.io/" rel="noopener ugc nofollow" target="_blank"> SocketIO </a>魔法和一个HTML canvas元素，上面的距离测量可以将你的智能手机变成一个支持多个控制器的数字指针。</p><p id="873d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nr">注意:由于本文关注的是传感器API的使用，SocketIO的解释被忽略了，尽管代码应该是不言自明的。更多信息，请看一下</em> <a class="ae lu" href="https://socket.io/docs/" rel="noopener ugc nofollow" target="_blank"> <em class="nr">文档</em> </a> <em class="nr">。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><h2 id="fd93" class="os mf it bd mg ot ou dn mk ov ow dp mo lh ox oy mq ll oz pa ms lp pb pc mu pd bi translated">服务器</h2><p id="b8c8" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">这个简单的服务器从公共的<strong class="la iu"> <em class="nr"> </em> </strong>目录为我们的HTML页面提供服务，并通过<a class="ae lu" href="https://socket.io/" rel="noopener ugc nofollow" target="_blank"> SocketIO </a>将控制器数据发送给所有连接的web客户端，以便在画布上呈现指针。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz lw l"/></div></figure><p id="b3e3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过存储连接的控制器<em class="nr"> </em>客户端的列表，可以添加对多个控制器的支持。</p><p id="0499" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，控制器阵列和相应的移动距离以恒定速率通过<code class="fe nv nw nx ny b">setInterval</code> <em class="nr">发送到所有连接的客户端。</em></p><h2 id="af80" class="os mf it bd mg ot ou dn mk ov ow dp mo lh ox oy mq ll oz pa ms lp pb pc mu pd bi translated">控制器</h2><p id="e8f2" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">控制器读取传感器数据，计算距离，并将它们发送到服务器进行广播——以上主要介绍了这一点，以及与我们的SocketIO服务器的额外通信。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz lw l"/></div></figure><h2 id="1c0d" class="os mf it bd mg ot ou dn mk ov ow dp mo lh ox oy mq ll oz pa ms lp pb pc mu pd bi translated">数字画布</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/2e1d000c27c4492bf5b74a30826cf9ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z27cbDMiAJpk8hkKASh4Xw.png"/></div></div></figure><p id="c70c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">画布页将从服务器接收的计算距离呈现为画布上的圆形指针。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz lw l"/></div></figure><p id="c9fb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">大部分是不言自明的，但是让我们看看<code class="fe nv nw nx ny b">draw</code> <strong class="la iu"> </strong>函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz lw l"/></div></figure><p id="8797" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于多个控制器，遍历<code class="fe nv nw nx ny b">controller</code> <em class="nr"> </em>数组，相应的距离偏移一定量，使指针能够从中心开始，而不是从画布坐标系开始的左上角开始。</p><p id="4809" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后使用Canvas API使用下一个可用的颜色将它们渲染为圆形。有关更多信息，请参见<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="0234" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，调用<code class="fe nv nw nx ny b">requestAnimationFrame</code> <strong class="la iu"> </strong>函数告诉浏览器在下一次重画之前再次执行上一次操作。这个循环继续让指针随着你的智能手机实时移动。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="d5fb" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">结论</h1><p id="fd8e" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">如果你有一个工作的智能手机指针，恭喜你！但是接下来呢？</p><p id="12ad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">也许是交流的工具？激光笔的更智能的替代品？或者像<a class="ae lu" href="https://paintr.sanjeet.co" rel="noopener ugc nofollow" target="_blank">painter</a>这样的东西——一个协作的数字画布，你的智能手机变成了你的画笔:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf lw l"/></div></figure><p id="638d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一种新的互动媒介，与我们口袋里随身携带的东西互动。这种设置的可能性是无限的。</p><p id="0ea8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">感谢阅读。下面让我知道你的想法。</strong></p></div></div>    
</body>
</html>