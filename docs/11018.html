<html>
<head>
<title>A Look at the SQL Speaking Python… Pandas!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一看SQL说话的Python…熊猫！</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-sql-speaking-python-pandas-869f6207c021?source=collection_archive---------9-----------------------#2022-02-10">https://betterprogramming.pub/the-sql-speaking-python-pandas-869f6207c021?source=collection_archive---------9-----------------------#2022-02-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="df08" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从SQL到熊猫——了解它们的对等物</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/764796e0789cf39c25e39f917cedba42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qCwazxzK7nkI_7Cg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@billow926?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">翻滚926 </a>上的<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">退溅</a></p></figure><p id="96a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Pandas是一个广泛用于数据操作和分析的库。说到数据，存储数据最常见的方式是在数据库中，我们将使用<em class="ls"> SQL </em>(结构化查询语言)来查询它。</p><p id="1bf9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以使用pandas在数据库中插入/检索和修改数据。Pandas也可以用于原始SQL查询。下面让我们看看SQL和它的熊猫等价物。</p><p id="dc5d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始之前，请确保Pandas已安装在您的机器上。</p><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="f3a8" class="ly lz iq lu b gy ma mb l mc md">pip install pandas</span></pre><p id="1a45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">贴吧里面，熊猫可以导入到你的代码里如下:</p><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="a4f1" class="ly lz iq lu b gy ma mb l mc md">import pandas as pd</span></pre><p id="ca02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在继续之前，我们将从表<code class="fe me mf mg lu b">table1</code> <em class="ls"> </em>中获取数据，并将其存储在名为<code class="fe me mf mg lu b">table</code>的数据帧中。</p><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="2cc0" class="ly lz iq lu b gy ma mb l mc md">-- SQL<br/>SELECT * FROM table1;</span><span id="b48c" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table = pd.read_sql('SELECT * FROM TABLE1', con=<em class="ls">engine</em>/connection_string)</span><span id="9ccf" class="ly lz iq lu b gy mh mb l mc md">The <em class="ls">engine </em>is an <a class="ae kv" href="https://docs.sqlalchemy.org/en/14/core/engines.html" rel="noopener ugc nofollow" target="_blank">SQLAlchemy</a> engine.</span></pre><p id="99de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>数据帧是一种二维数据结构，具有行和列形式的数据。可以认为它类似于excel电子表格。想了解更多关于DataFrame的信息，请参考上面的熊猫官方文档。</p><h1 id="4204" class="mi lz iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated"><strong class="ak"> 1。选择</strong></h1><ul class=""><li id="0d98" class="mz na iq ky b kz nb lc nc lf nd lj ne ln nf lr ng nh ni nj bi translated">从表中选择所有列:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="d332" class="ly lz iq lu b gy ma mb l mc md">--SQL <br/>SELECT * FROM table1;</span><span id="34f0" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table</span></pre><ul class=""><li id="006e" class="mz na iq ky b kz la lc ld lf nk lj nl ln nm lr ng nh ni nj bi translated">从表格中选择<code class="fe me mf mg lu b">coulmn1</code>、<code class="fe me mf mg lu b">column2</code>:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="9368" class="ly lz iq lu b gy ma mb l mc md">--SQL <br/>SELECT column1, column2 FROM table1;</span><span id="3a52" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table[[column1,column2]]</span></pre><ul class=""><li id="74db" class="mz na iq ky b kz la lc ld lf nk lj nl ln nm lr ng nh ni nj bi translated">从列中选择所有唯一记录</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="4092" class="ly lz iq lu b gy ma mb l mc md">--SQL <br/>SELECT DISTINCT(column1) FROM table1;</span><span id="2752" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table[column1].unique()</span></pre><ul class=""><li id="c599" class="mz na iq ky b kz la lc ld lf nk lj nl ln nm lr ng nh ni nj bi translated">从列中选择所有唯一记录的计数</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="542a" class="ly lz iq lu b gy ma mb l mc md">--SQL<br/>SELECT COUNT(DISTINCT(column1)) FROM table1;</span><span id="ae63" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table[column1].nunique()</span></pre></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="5665" class="mi lz iq bd mj mk nu mm mn mo nv mq mr jw nw jx mt jz nx ka mv kc ny kd mx my bi translated">2.<strong class="ak">用Where子句选择</strong></h1><ul class=""><li id="ccce" class="mz na iq ky b kz nb lc nc lf nd lj ne ln nf lr ng nh ni nj bi translated">选择列1 <strong class="ky ir">等于</strong>和<code class="fe me mf mg lu b">value</code>的记录:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="f681" class="ly lz iq lu b gy ma mb l mc md">--SQL <br/>SELECT * FROM table1 WHERE column1 = <em class="ls">value</em>;</span><span id="e002" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table.loc[table[column1]==<em class="ls">value</em>]</span></pre><ul class=""><li id="7a5f" class="mz na iq ky b kz la lc ld lf nk lj nl ln nm lr ng nh ni nj bi translated">选择<code class="fe me mf mg lu b">column1</code>大于<code class="fe me mf mg lu b">value1</code>且<code class="fe me mf mg lu b">column2</code>小于<code class="fe me mf mg lu b">value2</code>的记录:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="242c" class="ly lz iq lu b gy ma mb l mc md">--SQL <br/>SELECT * FROM table1 WHERE column1 = <em class="ls">value1</em> AND column2 = <em class="ls">value2</em>;</span><span id="b3dc" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table.loc[(table[column1] &gt; <em class="ls">value1</em>) &amp; (table[column2]&lt; <em class="ls">value2</em>)]</span></pre><ul class=""><li id="755e" class="mz na iq ky b kz la lc ld lf nk lj nl ln nm lr ng nh ni nj bi translated">选择其中column1包含<strong class="ky ir"> </strong>字符串“Hello”的记录:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="1d94" class="ly lz iq lu b gy ma mb l mc md">--SQL<br/>SELECT * FROM table1 WHERE column1 LIKE '%Hello%';</span><span id="3fe7" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table.loc[table[column1].str.contains('Hello')]</span></pre><ul class=""><li id="4fe8" class="mz na iq ky b kz la lc ld lf nk lj nl ln nm lr ng nh ni nj bi translated">选择非空的记录:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="1519" class="ly lz iq lu b gy ma mb l mc md">--SQL<br/>SELECT * FROM table1 WHERE column1 IS NOT NULL;</span><span id="de2c" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table.loc[table[column1].notnull()]</span></pre></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="18a3" class="mi lz iq bd mj mk nu mm mn mo nv mq mr jw nw jx mt jz nx ka mv kc ny kd mx my bi translated">3.<strong class="ak">用Group By子句选择</strong></h1><ul class=""><li id="b69c" class="mz na iq ky b kz nb lc nc lf nd lj ne ln nf lr ng nh ni nj bi translated">在<code class="fe me mf mg lu b">column1</code>上选择<code class="fe me mf mg lu b">column1</code>和<code class="fe me mf mg lu b">column2</code>分组的总和:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="4998" class="ly lz iq lu b gy ma mb l mc md">--SQL <br/>SELECT coulmn1, SUM(column2) FROM table1 GROUP BY column1;</span><span id="a8b3" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table.groupby(column1).sum()</span></pre><ul class=""><li id="1f8d" class="mz na iq ky b kz la lc ld lf nk lj nl ln nm lr ng nh ni nj bi translated">在<code class="fe me mf mg lu b">column1</code>上选择<code class="fe me mf mg lu b">column2</code>分组的第1列和最小值，其中第2列的最小值大于<code class="fe me mf mg lu b"><em class="ls">value</em></code>:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="a067" class="ly lz iq lu b gy ma mb l mc md">--SQL <br/>SELECT coulmn1, MIN(column2) as min FROM table1 GROUP BY column1 HAVING MIN(column2)&gt; <em class="ls">value</em>;</span><span id="434b" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table_group = table.groupby(column1).min()<br/>table_group[table_group[column2] &gt; <em class="ls">value</em>]</span></pre></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="740e" class="mi lz iq bd mj mk nu mm mn mo nv mq mr jw nw jx mt jz nx ka mv kc ny kd mx my bi translated">4.<strong class="ak"> SELECT with Order By子句(排序)</strong></h1><ul class=""><li id="0c98" class="mz na iq ky b kz nb lc nc lf nd lj ne ln nf lr ng nh ni nj bi translated">基于单个列按<strong class="ky ir">升序</strong>对结果进行排序:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="e83b" class="ly lz iq lu b gy ma mb l mc md">--SQL<br/>SELECT * FROM table1 ORDER BY column1 ASC;</span><span id="cd01" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table.sort_values(by=column1,ascending=True,inplace=True)</span></pre><ul class=""><li id="8ec0" class="mz na iq ky b kz la lc ld lf nk lj nl ln nm lr ng nh ni nj bi translated">基于单个列按降序对结果进行排序:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="4a7e" class="ly lz iq lu b gy ma mb l mc md">--SQL<br/>SELECT * FROM table1 ORDER BY column1 DESC;</span><span id="e36c" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table.sort_values(by=column1,ascending=False,inplace=True)</span></pre><ul class=""><li id="3e2d" class="mz na iq ky b kz la lc ld lf nk lj nl ln nm lr ng nh ni nj bi translated">基于多列对结果进行升序排序:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="670a" class="ly lz iq lu b gy ma mb l mc md">--SQL<br/>SELECT * FROM table1 ORDER BY column1, column2 ASC;</span><span id="f0e8" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table.sort_values(by=[column1,column2],ascending=True,inplace=True)</span></pre><ul class=""><li id="4d43" class="mz na iq ky b kz la lc ld lf nk lj nl ln nm lr ng nh ni nj bi translated">按升序对列1的结果进行排序，按降序对列2的结果进行排序:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="01a3" class="ly lz iq lu b gy ma mb l mc md">--SQL<br/>SELECT * FROM table1 ORDER BY column1 ASC, column2 DESC;</span><span id="7629" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table.sort_values(by=[column1,column2],ascending=[True,False],inplace=True)</span></pre></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="de94" class="mi lz iq bd mj mk nu mm mn mo nv mq mr jw nw jx mt jz nx ka mv kc ny kd mx my bi translated">5.<strong class="ak">加入</strong></h1><h2 id="9fec" class="ly lz iq bd mj nz oa dn mn ob oc dp mr lf od oe mt lj of og mv ln oh oi mx oj bi translated"><strong class="ak">内部连接:</strong></h2><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="1c59" class="ly lz iq lu b gy ma mb l mc md">--SQL <br/>SELECT * FROM table1 INNER JOIN table2 ON table1.column1 = table2.column1;</span><span id="ec12" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>join_table = table1.merge(table2, on=column1, how='inner')</span><span id="ab14" class="ly lz iq lu b gy mh mb l mc md"># We can also use the join method as given below.<br/>join_table = table1.join(table2.set_index(column1), on=column1, how=inner)</span></pre><h2 id="0025" class="ly lz iq bd mj nz oa dn mn ob oc dp mr lf od oe mt lj of og mv ln oh oi mx oj bi translated"><strong class="ak">多列的左连接:</strong></h2><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="c88f" class="ly lz iq lu b gy ma mb l mc md">--SQL <br/>SELECT * FROM table1 LEFT JOIN table2 ON table1.column1 = table2.column1 AND table1.column2=table2.column2;</span><span id="80e7" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>join_table = table1.merge(table2, how='left', left_on=[column1,column2], right_on=[column1,column2])</span></pre><h2 id="4cdd" class="ly lz iq bd mj nz oa dn mn ob oc dp mr lf od oe mt lj of og mv ln oh oi mx oj bi translated"><strong class="ak">右连接:</strong></h2><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="7c29" class="ly lz iq lu b gy ma mb l mc md">--SQL <br/>SELECT * FROM table1 RIGHT JOIN table2 ON table1.column1 = table2.column1;</span><span id="36fd" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>join_table = table1.merge(table2, on=column1, how='right')</span></pre></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="b44d" class="mi lz iq bd mj mk nu mm mn mo nv mq mr jw nw jx mt jz nx ka mv kc ny kd mx my bi translated">6.<strong class="ak">更新</strong></h1><ul class=""><li id="ac23" class="mz na iq ky b kz nb lc nc lf nd lj ne ln nf lr ng nh ni nj bi translated">根据条件更新列:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="dc7c" class="ly lz iq lu b gy ma mb l mc md">--SQL <br/>UPDATE table1 SET column2 = 1 WHERE column1 = 'YES';</span><span id="706b" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table.loc[table[column1]=='YES', column2] = 1</span></pre><ul class=""><li id="8829" class="mz na iq ky b kz la lc ld lf nk lj nl ln nm lr ng nh ni nj bi translated">基于多个标准更新列:</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="b8a1" class="ly lz iq lu b gy ma mb l mc md">--SQL<br/>UPDATE table1 SET column3 = 1 WHERE column1 = 'YES' AND column2 = 'ACTIVE';</span><span id="fe08" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table.loc[(table[column1] == 'YES') &amp; (table[column2] == 'ACTIVE'), column3] = 1</span></pre></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="3049" class="mi lz iq bd mj mk nu mm mn mo nv mq mr jw nw jx mt jz nx ka mv kc ny kd mx my bi translated">7.<strong class="ak">插入</strong></h1><ul class=""><li id="7fa8" class="mz na iq ky b kz nb lc nc lf nd lj ne ln nf lr ng nh ni nj bi translated">将数据帧中的数据插入到数据库表中。</li></ul><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="b7b1" class="ly lz iq lu b gy ma mb l mc md">--SQL<br/>INSERT INTO table1 VALUES (column1,column2,column3)</span><span id="969f" class="ly lz iq lu b gy mh mb l mc md">--Pandas<br/>table.to_sql(table1, con=<em class="ls">engine</em>/connection_string)</span></pre></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="ad05" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些只是熊猫的一小部分功能。请参考<a class="ae kv" href="https://pandas.pydata.org/docs/index.html" rel="noopener ugc nofollow" target="_blank"> <em class="ls"> Pandas文档</em> </a>了解完整的功能集。</p><p id="610a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我还会在接下来的故事中发布更多的熊猫特写。敬请关注。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="a73c" class="ly lz iq lu b gy ma mb l mc md"><strong class="lu ir">Want to Connect?</strong></span><span id="e78b" class="ly lz iq lu b gy mh mb l mc md">Reach me out on <a class="ae kv" href="https://www.linkedin.com/in/hari-hara-subramanyam-s-b2692636" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</span></pre><p id="a537" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读！！</p></div></div>    
</body>
</html>