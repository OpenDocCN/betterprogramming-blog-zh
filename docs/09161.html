<html>
<head>
<title>Don’t Use Built-In Python Methods To Query Data — Use JMESPath Instead</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不要使用内置的Python方法来查询数据，而是使用JMESPath</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/dont-use-built-in-python-methods-to-query-data-use-jmespath-instead-5c76c1e57ba6?source=collection_archive---------8-----------------------#2021-07-21">https://betterprogramming.pub/dont-use-built-in-python-methods-to-query-data-use-jmespath-instead-5c76c1e57ba6?source=collection_archive---------8-----------------------#2021-07-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="adc2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在JSON和字典中搜索有一个更好的选择</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dc3e0409c0b58f03d49847686de2d064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HCwV9PWG0i_iOUNJ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@edonugroho?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">江户努格罗霍</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="9088" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还记得我第一篇关于媒介的文章吗？你可能不知道，所以让我提醒你一下:</p><div class="lv lw gp gr lx ly"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-work-with-json-files-in-python-bedb5b37cbc9"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">如何在Python中使用JSON文件</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">使用Python读写JSON文件</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">better编程. pub</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="769d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自2020年3月以来发生了很多变化，我也改变了用Python阅读JSON的方法——或者更确切地说是查询它。</p><p id="a854" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们都知道内置的<code class="fe mn mo mp mq b">json</code>模块以及它是如何工作的(如果你不知道，请阅读上面链接的文章)。它完美而高效地工作。</p><p id="5115" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么这有什么问题呢？没什么。有没有更好的查询JSON数据和字典的方法？是的，有JMESPath。</p><p id="f9e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这不是替代。我们仍然需要<code class="fe mn mo mp mq b">json</code>模块(例如用于将JSON文件加载到字典中)。另外，<code class="fe mn mo mp mq b">json.loads()</code>不是一个用于查询的API，而是一种将JSON作为字典加载的方式。但是我们不使用通常的<code class="fe mn mo mp mq b">.get()</code>或<code class="fe mn mo mp mq b">[]</code>符号，而是使用一种更好、更有效的符号(不是指速度，因为Python中的内置方法总是更快)。</p><p id="8bb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么？让我用几个代码示例来解释一下。</p><p id="e240" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mr">注意:记住你需要使用</em> <code class="fe mn mo mp mq b"><em class="mr">pip install jmespath</em></code> <em class="mr">来安装这个模块。</em></p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="627d" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">简单查询</h1><p id="5b50" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">让我们从几件简单的事情开始，向我们展示JMESPath是如何工作的。首先，让我们看看它如何在给定一个键的情况下获取一个值。</p><p id="36de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要定义我们的数据:</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="51f3" class="oa na it mq b gy ob oc l od oe">data = {"name": "Tommaso", "surname": "De Ponti", "writesOnMedium": 1}</span></pre><p id="c1a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了让我的名字出现在JMESPath中，我要做以下事情:</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="c74f" class="oa na it mq b gy ob oc l od oe">print(jmespath.search('name', data))</span></pre><p id="b97a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前没有什么特别的，但是到本文结束时，您也将开始使用JMESPath。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="89a2" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">通过多个对象</h1><p id="357b" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">现在，让我们使用JMESPath查询多个对象，如下图所示:</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="7f65" class="oa na it mq b gy ob oc l od oe">data = {"person": {"tommaso": {"skills": {"python": ['web dev', 'security', 'automation', 'more']}}}}</span></pre><p id="e5e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果我想得到<code class="fe mn mo mp mq b">web dev</code>，我可以使用下面的:</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="5aea" class="oa na it mq b gy ob oc l od oe">print(jmespath.search('person.tommaso.skills.python[0]', data))</span></pre><p id="03be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开始明白我的意思了吗？那我们来说说切片吧。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="40e9" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">限幅</h1><p id="d332" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">让我们重复使用上面的数据:</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="6a28" class="oa na it mq b gy ob oc l od oe">data = {"person": {"tommaso": {"skills": {"python": ['web dev', 'security', 'automation', 'more']}}}}</span></pre><p id="4e91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我只想得到<code class="fe mn mo mp mq b">security</code>和<code class="fe mn mo mp mq b">automation</code>怎么办？我可以使用切片:</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="afbf" class="oa na it mq b gy ob oc l od oe">print(jmespath.search('person.tommaso.skills.python[1:3]', json_data))</span><span id="3fca" class="oa na it mq b gy of oc l od oe"><strong class="mq iu">Output : ['security', 'automation']</strong></span></pre><p id="ea87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，您可以应用<code class="fe mn mo mp mq b">::</code>符号。同样，使用上面的字典，我们可能想要颠倒列表的顺序:</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="5086" class="oa na it mq b gy ob oc l od oe">print(jmespath.search('person.tommaso.skills.python[::-1]', json_data))</span><span id="4b9a" class="oa na it mq b gy of oc l od oe"><strong class="mq iu">Output : ['more', 'automation', 'security', 'web dev']</strong></span></pre></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="3519" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">通配符投影</h1><p id="19da" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">这就是事情开始变得有趣的地方。假设您看到以下JSON:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="7a29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你想知道所有这些作品的浏览次数。你是如何进行的？在你开始考虑之前，这里有一个很好的解决方案:</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="b387" class="oa na it mq b gy ob oc l od oe">print(jmespath.search('pieces[*].viewsCount', json_data))</span><span id="f75a" class="oa na it mq b gy of oc l od oe"><strong class="mq iu">Output : [20000, 10000, 15000]</strong></span></pre><p id="8762" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用通配符(<code class="fe mn mo mp mq b">*</code>)可以轻松完成这项任务。</p><p id="7e50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，您不仅可以使用通配符进行投影，还可以使用切片对定义的对象进行投影:</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="2fb1" class="oa na it mq b gy ob oc l od oe">print(jmespath.search('pieces[1:3].viewsCount', json_data))</span><span id="97fc" class="oa na it mq b gy of oc l od oe"><strong class="mq iu">Output : [10000, 15000]</strong></span></pre></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="ea6d" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">过滤</h1><p id="6d19" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">过滤是另一个非常有用的技巧。使用相同的JSON数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="fb20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">比方说，我只想获得浏览量超过12000的文章。我可以简单地在我的JMESPath查询中添加一个条件:<code class="fe mn mo mp mq b">?viewsCount &gt;= `12000`</code>。下面一行完成了这项工作:</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="f1ea" class="oa na it mq b gy ob oc l od oe">print(jmespath.search("pieces[?viewsCount &gt;= `12000`].article", json_data))</span></pre><p id="7f0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mr">重要提示:请记住，数字必须在反斜线内(例如</em> <code class="fe mn mo mp mq b"><em class="mr">`12000`</em></code> <em class="mr">)。</em></p><p id="0546" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在输出的是<code class="fe mn mo mp mq b">[‘Work with JSON’, ‘Dictionaries instead of if-elifs’]</code>。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="291c" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">结论</h1><p id="6382" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">正如您所看到的，这个库对于查询字典和JSON数据变得非常有用和高效，允许我们简单地执行复杂的指令，比如条件。</p><p id="eb18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文探讨了JMESPath的能力，如果您想更深入地了解，我建议您看一下它的<a class="ae ky" href="https://jmespath.org/specification.html#spec" rel="noopener ugc nofollow" target="_blank">规范页面</a>。</p><p id="b7e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是您可能会喜欢的更多Python相关内容:</p><div class="lv lw gp gr lx ly"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-work-with-json-files-in-python-bedb5b37cbc9"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">如何在Python中使用JSON文件</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">使用Python读写JSON文件</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">better编程. pub</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><div class="lv lw gp gr lx ly"><a rel="noopener  ugc nofollow" target="_blank" href="/too-many-if-elif-conditions-in-python-use-dictionaries-instead-5486299af27e"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">Python中If-Elif条件太多？请改用字典</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">Python字典清理代码的一种非常规方式</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">better编程. pub</p></div></div><div class="mh l"><div class="oi l mj mk ml mh mm ks ly"/></div></div></a></div></div></div>    
</body>
</html>