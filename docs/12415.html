<html>
<head>
<title>Hey App Developer: Where Is My Logic?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">嘿应用开发者:我的逻辑在哪里？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/where-is-my-logic-afbeb84ae3c6?source=collection_archive---------0-----------------------#2022-06-04">https://betterprogramming.pub/where-is-my-logic-afbeb84ae3c6?source=collection_archive---------0-----------------------#2022-06-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8545" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">丰富的数据模型与贫乏的数据模型</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6dfb5a8ce386d54fedc012dd46821139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FXlZO8EcGHiZaCzak8E4cw.jpeg"/></div></div></figure><p id="a1c8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">“向我描述一下你的应用架构”。</p><p id="f939" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">“哦，这很容易。我用MVVM。”</p><p id="b4e0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我总是说，应用程序的创建在其边缘更简单，但在内部非常复杂。</p><p id="dc9b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我的意思是，我们不仅知道如何创建出色的UI，而且我们也一直在谈论它——swift UI/UI kit、MVVM、自动布局等等。有数以百万计的关于这些主题的教程和文章。</p><p id="1779" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，底层也相对简单——数据和网络层基于我们都使用和喜爱的众所周知的模式。</p><p id="fc9a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是我们如何处理我们的业务逻辑呢？如何处理呢？</p><h1 id="10e5" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">商业逻辑到底是什么？</h1><p id="b32a" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">首先，让我们尝试与移动应用程序中的业务逻辑的真正含义保持一致。</p><p id="fc6e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一般来说，大多数项目都是由三层构成的——数据、业务逻辑和UI。</p><p id="b523" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用MVVM设计模式是UI层的一部分，而不是业务逻辑。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/4cd6f4bc17c0b1bf2fd3f2e4d10a094c.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*ExuQF39k-_f1oKMHgmh2Nw.png"/></div></figure><p id="85fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">那么，什么是业务逻辑的一部分呢？基本上，任何与数据操作、验证和处理相关的东西。</p><p id="fcc8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如，如果我们需要创建一个特定的实体，验证其属性，并进行一些计算——这是业务逻辑的一部分。</p><p id="759d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">业务逻辑层需要服务于UI层，并且基于数据层，数据层包含数据库和网络服务(以及更多的服务)。</p><p id="c62f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要考虑的另一件事是应用程序状态，我们将在后面讨论。</p><h1 id="cca2" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">经理们来了</h1><p id="b787" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">此时，您可能会想到您的项目，并记得您将自己的逻辑塞进了一个名为“<code class="fe ml mm mn mo b">&lt;entity Name&gt;Manager</code>”/<code class="fe ml mm mn mo b">&lt;entity Name&gt;Logic</code>/<code class="fe ml mm mn mo b">&lt;entity Name&gt;Service</code>/<code class="fe ml mm mn mo b">&lt;entity Name&gt;Handler</code>的专用类中。</p><p id="322b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不要不好意思。我们都经历过(现在仍然是！).</p><p id="292a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们说服自己<code class="fe ml mm mn mo b">&lt;entity Name&gt;Service</code>比<code class="fe ml mm mn mo b">&lt;entity Name&gt;Manager</code>好，因为它是一个<code class="fe ml mm mn mo b">service</code>。(“不一样”)。</p><p id="45fd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">抱歉，伙计，但这完全是一回事(“我们年轻，需要钱”)。</p><p id="4649" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们这样做，并剥夺我们的实体可能有的任何逻辑。</p><p id="7478" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">别担心。这种(反)模式实际上有一个名字——它被称为“贫血数据模型”，这是移动开发人员中的一种典型设计模式。</p><p id="614d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以——把逻辑放在一个叫做“贫血数据模型”的“管理器”中，当逻辑是实体类的一部分时，就叫做“富数据模型”。</p><p id="1c34" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">很多iOS开发者更喜欢“贫血的数据模型”，我们深究一下就能明白为什么了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/a8ca74b84e1ed66d8154472667334d22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D95HNEk881oqAZl-f9wVrQ.png"/></div></div></figure><h1 id="19c8" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">贫血数据模型</h1><p id="950b" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">ADM设计模式显然有其优点。让我们列举其中的一些。</p><p id="3ac3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">关注点分离——当我们将逻辑从实体中提取到一个专用的类中时，我们执行了项目关注点的另一次分离。在某种程度上，任何这样的分离都会带来更多的灵活性和更小的副作用。</p><p id="b258" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">依赖关系更简单——如果实体彼此不“了解”,那么它们之间的耦合也更少。唯一协调它们的类是“服务”类。</p><p id="03bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这种方法使得处理依赖关系更加易于管理，并且可以帮助我们的项目更加模块化。</p><p id="d13e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">状态处理——现在我们有了一个存储逻辑的中心位置，它也可以动态地处理状态。</p><p id="2c2d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我们的实体内部有逻辑时，并不是说我们没有解决方案。只是有了服务类就简单多了。</p><h1 id="4d6a" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">贫血数据模型的问题</h1><p id="c74d" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">贫血数据模型看起来简单直观，但并不意味着它没有危害。</p><p id="0154" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这种方法有一个致命的缺点——“服务”可以以他们想要的方式操纵实体，这也意味着应用程序上的任何类都可以这样做。</p><p id="fb18" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">想想看——你的实体是完全可变和脆弱的。</p><p id="4184" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请看下面的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="9eed" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，这是一个遗憾。我们想要分离我们的逻辑并编写干净的代码，最终，我们在代码中制造了漏洞。</p><p id="c44a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">原因是拥有一个服务需要我们使我们的实体对于外部变化是可变的。</p><p id="18b6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">那么，有什么解决办法呢？</p><h1 id="78dc" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">扩展我们的规则</h1><p id="bbcc" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">关键是平衡。</p><p id="cf05" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">学校对此没有答案，但我们可以为如何分离我们的逻辑建立新的规则。</p><p id="1d4c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">数据操作——数据操作应该始终是实体职责的一部分。我们需要努力使我们的实体尽可能不可变，以防止外部变化。</p><p id="160c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">验证—验证逻辑可以位于名为“Policy”的单独类中。原因是通常情况下，验证不需要数据操作，并且可以在不同的实体之间共享。</p><p id="4910" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果共享逻辑是必不可少的，那么使用泛型和协议可能是一个好的解决方案。</p><p id="6d63" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">网络——现在，这是一个棘手的问题，取决于你如何管理数据传输。我们一致认为管理网络请求的单例是一个好主意。但是谁叫那是单身呢？嗯，如果一个实体需要执行一个网络请求来获取相关数据或更新它的更改，它可以调用网络层来执行这些操作。</p><p id="032d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是，如果我们有一些一次更新几个项目的逻辑，比如某种通用的同步机制，使用“同步管理器”可能是个好主意。</p><p id="605f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">状态——应用程序状态不是实体的一部分。一种解决方案是在一个中心位置管理状态——一种包含动作和Redux样式。</p><p id="5e1b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">即使Redux与RDM或ADM无关，它也是我们在项目中需要进行的另一项分离。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/5024cecfcca2bd96e4ea6641d27681fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RRDmyyleBnd8sL2eiS3ByQ.png"/></div></div></figure><h1 id="8fd4" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">结论</h1><p id="ffa3" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">遵循好的模式永远是最好的，但不要盲目追随。对于架构问题，我们没有现成的答案，因为分色取决于您的应用需求。</p><p id="1f6e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">放聪明点！</p></div></div>    
</body>
</html>