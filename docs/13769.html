<html>
<head>
<title>Build a Real-Time Crypto Ticker With Go and InfluxDB 2 Using Coinbase API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用比特币基地API构建一个带有Go和InfluxDB 2的实时加密跑马灯</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-real-time-crypto-ticker-with-go-and-influxdb-2-89e968c65b7e?source=collection_archive---------5-----------------------#2022-09-26">https://betterprogramming.pub/build-a-real-time-crypto-ticker-with-go-and-influxdb-2-89e968c65b7e?source=collection_archive---------5-----------------------#2022-09-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7150fd431b14146cad961be523db5fea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tldDhVg3CEOG8xVQ"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">杰里米·贝赞格在<a class="ae kc" href="https://unsplash.com/s/photos/crypto?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="f419" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将看到如何在Go中使用来自比特币基地Pro API和Influx DB 2的实时数据实现一个加密跑马灯来存储和绘制数据。这个故事的所有代码都可以在我的<a class="ae kc" href="https://github.com/bquenin/go-crypto-ticker-influxdb2" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中找到。</p><h1 id="8093" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">体系结构</h1><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/50cee56c2ce530305c70c5c3acb35bed.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*H-EisHISSGYDeXTtVdPQzw.png"/></div></figure><ul class=""><li id="17fc" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">crypto ticker使用WebSocket连接到比特币基地专业应用编程接口，并订阅给定货币对的加密货币价格信息，例如BTC-美元。</li><li id="3835" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">比特币基地服务器开始将价格数据流式传输到ticker，ticker将价格数据作为度量值插入InfluxDB。</li><li id="2d5e" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">最后，我们连接到<a class="ae kc" href="http://localhost:8086/signin" rel="noopener ugc nofollow" target="_blank"> http://localhost:8086/ </a>上的数据库UI</li></ul><h1 id="285e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">加密股票行情</h1><p id="d3aa" class="pw-post-body-paragraph kd ke iq kf b kg ms ki kj kk mt km kn ko mu kq kr ks mv ku kv kw mw ky kz la ij bi translated">跑马灯的作用非常简单:</p><ul class=""><li id="ea5d" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">连接到InfluxDB:</li></ul><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><ul class=""><li id="4e4a" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">使用WebSocket订阅比特币基地API。幸运的是，比特币基地的WebSocket API允许匿名访问，访问分笔成交点数据不需要创建API密钥:</li></ul><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><ul class=""><li id="d47c" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">每次收到一个tick时，将其写入InfluxDB:</li></ul><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><h1 id="adbd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">InfluxDB</h1><p id="446e" class="pw-post-body-paragraph kd ke iq kf b kg ms ki kj kk mt km kn ko mu kq kr ks mv ku kv kw mw ky kz la ij bi translated">InfluxDB是一个非常适合我们用例的时间序列数据库。因为我们正在构建一个实时的ticker，所以每当有交易时，我们就从比特币基地接收事件，每秒钟多次。这种时间分辨率非常精确，允许各种实时计算。</p><p id="434f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，大约一个小时后，我们的数据就过时了，所以我们相应地配置我们的存储桶保留。InfluxDB将简单地为我们丢弃过时的数据。</p><h2 id="1582" class="mz lc iq bd ld na nb dn lh nc nd dp ll ko ne nf lp ks ng nh lt kw ni nj lx nk bi translated">将InfluxDB作为容器运行</h2><p id="c8d1" class="pw-post-body-paragraph kd ke iq kf b kg ms ki kj kk mt km kn ko mu kq kr ks mv ku kv kw mw ky kz la ij bi translated">要配置InfluxDB容器，我们必须在<a class="ae kc" href="https://github.com/docker-library/docs/blob/master/influxdb/README.md#automated-setup" rel="noopener ugc nofollow" target="_blank">自动设置模式</a>下运行它。InfluxDB映像包含一些自动引导系统的功能。这是通过在运行容器时将<code class="fe nl nm nn no b">DOCKER_INFLUXDB_INIT_MODE</code>环境变量设置为值<code class="fe nl nm nn no b">setup</code>来实现的:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="mx my l"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">InfluxDB 2.0自动安装</p></figure><ul class=""><li id="9eef" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated"><code class="fe nl nm nn no b">DOCKER_INFLUXDB_INIT_USERNAME</code>:为系统初始超级用户设置的用户名(必选)。</li><li id="864d" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated"><code class="fe nl nm nn no b">DOCKER_INFLUXDB_INIT_PASSWORD</code>:为系统初始超级用户设置的密码(必填)。</li><li id="65cb" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated"><code class="fe nl nm nn no b">DOCKER_INFLUXDB_INIT_ORG</code>:为系统初始组织设置的名称(必选)。</li><li id="4ec3" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated"><code class="fe nl nm nn no b">DOCKER_INFLUXDB_INIT_BUCKET</code>:为系统初始桶设置的名称(必选)。</li><li id="42b1" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated"><code class="fe nl nm nn no b">DOCKER_INFLUXDB_INIT_RETENTION</code>:系统初始桶的持续时间应保留数据。我们的用例需要一个小时。</li><li id="c181" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated"><code class="fe nl nm nn no b">DOCKER_INFLUXDB_INIT_ADMIN_TOKEN</code>:与系统初始超级用户关联的认证令牌。如果未设置，令牌将由系统自动生成。</li></ul><p id="e51c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我使用<a class="ae kc" href="https://direnv.net/" rel="noopener ugc nofollow" target="_blank"> direnv </a>为Docker合成文件提供<a class="ae kc" href="https://docs.docker.com/compose/environment-variables/#substitute-environment-variables-in-compose-files" rel="noopener ugc nofollow" target="_blank">环境变量替换</a>。</p><p id="4d74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还向主机公开了InfluxDB端口，以便我们可以连接到UI。</p><p id="42f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们在<code class="fe nl nm nn no b">/docker-entrypoint-initdb.d</code>文件夹中提供了一个<a class="ae kc" href="https://github.com/docker-library/docs/blob/master/influxdb/README.md#initialization-files" rel="noopener ugc nofollow" target="_blank">初始化脚本</a>来导入一个预定义的仪表板。我们正在安装<code class="fe nl nm nn no b">./influxdb/init</code>文件夹:</p><pre class="ma mb mc md gt np no nq nr aw ns bi"><span id="7532" class="mz lc iq no b gy nt nu l nv nw">influxdb<br/>└── init<br/>    ├── init.sh<br/>    └── templates<br/>        └── tickers.yaml</span></pre><h1 id="aef2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">把一切都包起来</h1><p id="7369" class="pw-post-body-paragraph kd ke iq kf b kg ms ki kj kk mt km kn ko mu kq kr ks mv ku kv kw mw ky kz la ij bi translated">现在我们已经配置好了一切，我们可以使用以下命令启动堆栈:</p><pre class="ma mb mc md gt np no nq nr aw ns bi"><span id="97d5" class="mz lc iq no b gy nt nu l nv nw">make start</span></pre><p id="b593" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您现在可以连接到<a class="ae kc" href="http://localhost:8086/signin" rel="noopener ugc nofollow" target="_blank"> http://localhost:8086/ </a>上的用户界面，并查看仪表板:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/f9abedda24c100a397b4b5a522179eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ypvic62r6qKClI1lfA3oFg.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">使用InfluxDB UI的加密报价器</p></figure><p id="8cc1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Tada！现在，您已经有了自己的实时加密收报机并开始运行。您现在可以学习更多关于<a class="ae kc" href="https://docs.influxdata.com/flux/v0.x/get-started/" rel="noopener ugc nofollow" target="_blank"> Flux语言</a>的知识来构建您自己的指标！</p></div></div>    
</body>
</html>