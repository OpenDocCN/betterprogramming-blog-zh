<html>
<head>
<title>How to Build a Timer Using Swift and SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Swift和SwiftUI构建计时器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-build-a-timer-using-swift-and-swiftui-e72cd8eb3d3a?source=collection_archive---------1-----------------------#2020-05-05">https://betterprogramming.pub/how-to-build-a-timer-using-swift-and-swiftui-e72cd8eb3d3a?source=collection_archive---------1-----------------------#2020-05-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="05bb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">开始使用SwiftUI构建的好地方</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/adbf447f414dfb3f571deb1c5234fff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ibn5z-_MdWg-X_6B"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@sonjalangford?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Sonja Langford </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="17c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将使用Swift和SwiftUI制作一个计时器。这将带你一步一步地完成这个过程，从制作一个新的应用程序到运行完成的计时器。</p><p id="fdfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成的项目可以从GitLab 中克隆<a class="ae ky" href="https://gitlab.com/appsbymw/count-up-timer" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="32d3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第一步:启动一个新项目</h1><p id="9716" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在Xcode中启动一个新项目。该模板需要是一个单视图应用程序。语言需要设置为Swift，用户界面需要设置为SwiftUI。您可以将<code class="fe mz na nb nc b">Product Name</code>设置为您喜欢的任何值。我在叫我的倒计时器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/0eac114df24a6a120b7a284cd11fe4f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DoYVlH4G177NDW8VXGzbuA.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9dab" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第2步:添加变量</h1><p id="dff6" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们添加变量来保存需要在屏幕上显示的小时、分钟和秒。</p><p id="073c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mz na nb nc b">ContentView.swift</code>中，在以下要点中添加第6行到第8行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0623" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这三个变量(<code class="fe mz na nb nc b">hours</code>、<code class="fe mz na nb nc b">minutes</code>和<code class="fe mz na nb nc b">seconds</code>)是用<code class="fe mz na nb nc b">@State</code>属性包装器声明的，这样当值更新时文本也会更新。你可以在<a class="ae ky" href="https://developer.apple.com/documentation/swiftui/state" rel="noopener ugc nofollow" target="_blank">苹果网站</a>上阅读更多关于<code class="fe mz na nb nc b">@State</code>属性包装器的信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6a9e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">步骤3:设计用户界面</h1><p id="b675" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在，让我们实际设计UI。中间是计时器，然后是启动/暂停计时器和将计时器重置为零的按钮。</p><p id="7714" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要做的第一件事是在<code class="fe mz na nb nc b">body</code>中添加一个VStack。为此，您可以右键单击<code class="fe mz na nb nc b">Text("Hello, World!")</code>并选择嵌入VStack。您的代码现在应该看起来像下面的要点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h2 id="d659" class="ng md it bd me nh ni dn mi nj nk dp mm li nl nm mo lm nn no mq lq np nq ms nr bi translated">显示计时器值</h2><p id="e9ad" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">然后，我们需要输入变量。我们要把<code class="fe mz na nb nc b">Hello, World!</code>改成<code class="fe mz na nb nc b">\(hours):\(minutes):\(seconds)</code>。如果你打开画布并恢复它，那么你应该在设备中看到<em class="ns"> 0:0:0 </em>。</p><p id="d553" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能想知道为什么我在变量名周围使用了<code class="fe mz na nb nc b">\()</code>。斜杠和圆括号是用来告诉编译器圆括号里有代码。因此，程序将显示变量的内容，而不是变量的名称。</p><h2 id="cde6" class="ng md it bd me nh ni dn mi nj nk dp mm li nl nm mo lm nn no mq lq np nq ms nr bi translated">添加按钮</h2><p id="2d42" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在，让我们添加按钮，让他们做一些事情！</p><p id="6f3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将添加一个新的状态变量，它表示计时器是已经启动还是已经暂停。在声明<code class="fe mz na nb nc b">seconds</code>之后，添加<code class="fe mz na nb nc b">@State var timerIsPaused: Bool = true</code>。</p><p id="e21c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在<code class="fe mz na nb nc b">Text()</code>之后，我们需要添加一个if语句，该语句将显示计时器暂停和开始时的视图。下面的要点显示了带有if语句的视图应该是什么样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6f47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将把<code class="fe mz na nb nc b">Text</code>改为<code class="fe mz na nb nc b">Buttons</code>，并使用<code class="fe mz na nb nc b">SF Symbol</code>进行启动、暂停和复位。</p><p id="c8ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果<code class="fe mz na nb nc b">timerIsPaused</code>是<code class="fe mz na nb nc b">true</code>，那么我们要显示一个开始的播放图标和一个复位的后退图标。为此，我们需要使用<code class="fe mz na nb nc b">Image(systemName: String)</code>作为按钮标签。这两个按钮也需要在一个堆栈中，彼此相邻。现在，如果<code class="fe mz na nb nc b">timerIsPaused</code>是<code class="fe mz na nb nc b">false</code>，我们需要显示一个暂停图标来停止计时器。以下要点显示了if语句中的按钮:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c4c2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第四步:启动计时器</h1><p id="0397" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">是时候让计时器真正开始计时了。我们将使用Swift内置的<code class="fe mz na nb nc b"><a class="ae ky" href="https://developer.apple.com/documentation/foundation/timer" rel="noopener ugc nofollow" target="_blank">Timer</a></code>。我们需要制作一个每秒增加一秒的重复计时器。</p><p id="4d8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们先为状态添加一个变量。所以在<code class="fe mz na nb nc b">timerIsPaused</code>之后，加上<code class="fe mz na nb nc b">@State var timer: Timer? = nil</code>。这声明了一个变量来存储计时器，但实际上并没有将计时器存储到变量中，因为当计时器启动时，我们将调用一个新的计时器。</p><p id="68cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要编写一个启动计时器并将<code class="fe mz na nb nc b">timerIsPaused</code>更改为<code class="fe mz na nb nc b">false</code>的函数。该函数将被称为<code class="fe mz na nb nc b">startTimer()</code>。在函数中，添加行<code class="fe mz na nb nc b">timerIsPaused = false</code>。之后，需要添加一个计时器。以下要点表明:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e588" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我将解释第3行到第5行发生了什么。</p><h2 id="24e3" class="ng md it bd me nh ni dn mi nj nk dp mm li nl nm mo lm nn no mq lq np nq ms nr bi translated">制作一个新计时器</h2><p id="2e02" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这是一个新的计时器实际制作的地方。我用了一个定时计时器，这样每一秒都有东西被触发。</p><ul class=""><li id="fdc8" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated"><code class="fe mz na nb nc b">withTimeInterval</code>用于指定闭包内每个动作执行的频率，以秒为单位。我将它设置为1，这样<code class="fe mz na nb nc b">seconds</code>每秒递增一次。</li><li id="6ed4" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe mz na nb nc b">repeats</code>需要设置为<code class="fe mz na nb nc b">true</code>,这样闭包中的代码每秒运行一次。如果设置为<code class="fe mz na nb nc b">false</code>，那么闭包中的操作只运行一次。</li></ul><h2 id="5509" class="ng md it bd me nh ni dn mi nj nk dp mm li nl nm mo lm nn no mq lq np nq ms nr bi translated">检查添加时间</h2><p id="7ee1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这是检查何时增加秒、分和小时的所有代码。</p><p id="79eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我选择使用启动新计时器的闭包方法，这样就不必将函数包装在Objective-C调用者中。</p><p id="fb92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦编写了函数，确保在按钮中调用它。下面是开始按钮代码现在应该看起来的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e374" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第五步:停止计时</h1><p id="ebba" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">是时候用另一个函数来停止计时器了。该函数将被称为<code class="fe mz na nb nc b">stopTimer()</code>。在这个定时器中，我们需要将<code class="fe mz na nb nc b">timerIsPaused</code>设置为<code class="fe mz na nb nc b">false</code>，并杀死当前正在运行的定时器。为了杀死计时器，我们调用计时器上的<code class="fe mz na nb nc b">invalidate()</code>函数，这将不允许计时器再次启动。该函数如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="3a4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，确保在按下停止按钮时调用该函数。</p><p id="75ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是<code class="fe mz na nb nc b">ContentView.swift</code>此时应该的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7c0d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第六步:重置时钟</h1><p id="b958" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这是最简单的功能。它将把<code class="fe mz na nb nc b">hours</code>、<code class="fe mz na nb nc b">minutes</code>和<code class="fe mz na nb nc b">seconds</code>设置回零。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="9b7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当使用<code class="fe mz na nb nc b">self.restartTimer()</code>按下复位按钮时调用它。</p><p id="555b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">计时器结束了！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/6f729e1db51c4e48709937b953996d54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0cWX6ltc4vU6_2_CUvXFYw.gif"/></div></div></figure><p id="4f14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成的项目可以从<a class="ae ky" href="https://gitlab.com/appsbymw/count-up-timer" rel="noopener ugc nofollow" target="_blank"> GitLab </a>中克隆。</p><p id="5dd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>