<html>
<head>
<title>Create Fully-Functioning Serverless User Authentication With AWS Cognito and Amplify With Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Cognito创建全功能的无服务器用户身份验证，并使用Angular进行扩展</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-fully-functioning-user-authentication-with-aws-cognito-and-amplify-with-angular-complete-a3ce58df1b74?source=collection_archive---------1-----------------------#2019-11-17">https://betterprogramming.pub/create-a-fully-functioning-user-authentication-with-aws-cognito-and-amplify-with-angular-complete-a3ce58df1b74?source=collection_archive---------1-----------------------#2019-11-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6401" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">完全指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dea4377d15235a51f1e238ac60717738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Su3jdfrutSUZ49tt5B9PJQ.jpeg"/></div></div></figure><p id="2b53" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这篇文章中，我们将着眼于使用带有Angular <strong class="kw iu"> </strong> 8应用程序的<a class="ae lq" href="https://aws.amazon.com/amplify/" rel="noopener ugc nofollow" target="_blank"> AWS Amplify </a>库实现一个无服务器<strong class="kw iu"> </strong>解决方案。</p><p id="6e09" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将创建一个全功能的用户身份验证，包括用户注册、验证电子邮件、登录和注销。为了让所有这些事情发生，我们将使用由AWS提供的便捷服务<a class="ae lq" href="https://aws.amazon.com/cognito/" rel="noopener ugc nofollow" target="_blank"> AWS Cognito </a>。</p><p id="e0a3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，需要一个AWS帐户，如果你没有帐户，你可以在<a class="ae lq" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS </a>创建一个免费帐户。如果你已经有了一个帐户，你就可以开始了。</p><p id="4825" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">TL；速度三角形定位法(dead reckoning)</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="3a74" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">什么是放大？</h1><p id="ab69" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated"><a class="ae lq" href="https://aws-amplify.github.io/" rel="noopener ugc nofollow" target="_blank"> Amplify </a>是一个开源库，帮助您轻松构建一个灵活、可靠、可伸缩的无服务器后端，并将其与您的前端集成。这是11月份在<a class="ae lq" href="https://reinvent.awsevents.com/" rel="noopener ugc nofollow" target="_blank"> AWS re:Invent 2017 </a>上首次推出的。</p><blockquote class="mv"><p id="cd95" class="mw mx it bd my mz na nb nc nd ne lp dk translated">“一个自以为是的、基于类别的客户端框架，用于构建可扩展的移动和web应用程序”——<a class="ae lq" href="https://aws.amazon.com/getting-started/use-cases/mobile/" rel="noopener ugc nofollow" target="_blank">AWS</a></p></blockquote><p id="545d" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">Amplify框架包含三个关键特性:</p><ul class=""><li id="1294" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">库:自带一套与云服务相关的JavaScript、Android和iOS的综合库，如分析、认证、存储、通知、REST和<a class="ae lq" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank">graph QL</a>API、AR/VR。</li><li id="8deb" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">Amplify CLI:用于在AWS上配置和管理无服务器基础设施的命令行工具。</li><li id="1e12" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">UI组件:一组特定于框架的很酷的UI组件，包括React、React Native、Angular、<a class="ae lq" href="https://ionicframework.com/" rel="noopener ugc nofollow" target="_blank"> Ionic </a>和<a class="ae lq" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue </a>用于身份验证、照片拾取器等。使您的开发变得容易。</li></ul><p id="50ad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些UI组件带有非常方便的主题，但是在本教程中，我们将开发我们自己的UI组件。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="95f4" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">让我们开始吧</h1><p id="ebbb" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">首先，我们需要在本地机器上安装和配置AWS Amplify CLI。我们将使用<a class="ae lq" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>来安装CLI，这需要在您的机器上安装Node.js和npm</p><p id="96ae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">确保您的节点版本至少是8.x.x或更高版本，并且您的npm版本是5.x.x或更高版本。如果没有，您需要升级您的节点和npm，以至少满足最低要求。</p><p id="e195" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要在您的终端中安装Amplify CLI，只需运行以下命令，这将在您的本地计算机上全局安装CLI:</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="4834" class="od lz it nz b gy oe of l og oh">npm install -g @aws-amplify/cli</span></pre><p id="f58c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦安装了CLI，就需要通过创建IAM用户来创建和管理AWS资源，从而对其进行配置。为此，只需运行:</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="71ab" class="od lz it nz b gy oe of l og oh">amplify configure</span></pre><p id="8550" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个过程将带你通过几个步骤。</p><ul class=""><li id="982f" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">这将在您的浏览器中打开AWS控制台，您需要登录您的帐户，完成后，您需要在终端中按enter键继续该过程。</li><li id="36cd" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">接下来，它将要求您指定AWS区域:<em class="oi"> us-east-1 </em>(我选择us-east-1，North Virginia作为我的区域，这可能会因您所在的区域而异)。</li><li id="1fff" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">接下来，它将要求您指定新IAM用户的用户名:<code class="fe oj ok ol nz b">angular-amplify-demo</code>(您可以根据自己的喜好使用任何名称)</li><li id="7307" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">当您按下回车键时，它会将您重定向到IAM管理控制台。您可以单击下一步的<em class="oi">来完成创建用户，我们将保留默认设置和权限。您可以前往终端并点击<em class="oi">进入</em>继续。</em></li></ul><p id="4f78" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，它会问:</p><ul class=""><li id="b0a6" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated"><code class="fe oj ok ol nz b">accessKeyId</code>:您的访问密钥ID</li><li id="c9e1" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><code class="fe oj ok ol nz b">secretAccessKey</code>:你的_秘密_访问_密钥</li></ul><p id="33d4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(您可以从您的IAM用户那里获取这些密钥。)</p><p id="eda8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，它将要求一个配置文件名:(default)我将把它保留为默认值，但是您可以为此指定一个配置文件名。</p><p id="edcd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将在您的本地机器上创建/更新与上述<code class="fe oj ok ol nz b">accessKeyId</code>和<code class="fe oj ok ol nz b">secretAccessKey</code>相关联的AWS概要文件。至此，您已经成功设置了新用户。</p><p id="e9de" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">或者，你可以看一个关于配置过程的<a class="ae lq" href="https://www.youtube.com/watch?v=fWbM5DLh25U" rel="noopener ugc nofollow" target="_blank">视频教程</a>。</p><p id="ed26" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下一步…</p><p id="4f5a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">恭喜你！</p><p id="5e61" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">至此，您已经成功地在本地机器上安装并配置了AWS Amplify。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="229a" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated"><strong class="ak">创建角度项目</strong></h1><p id="a2b1" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">接下来，我们需要创建我们的角度项目。我将使用Angular CLI来生成一个新的Angular应用程序，为此，您需要在您的计算机上安装Angular CLI。</p><p id="7896" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果没有，只需运行以下命令来全局安装Angular CLI:</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="c7e9" class="od lz it nz b gy oe of l og oh">npm install -g @angular/cli</span></pre><p id="d63e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要创建和运行新的应用程序，只需运行:</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="af83" class="od lz it nz b gy oe of l og oh">ng new aws-amplify-cognito-authentication<br/>cd aws-amplify-cognito-authentication<br/>ng serve</span></pre><p id="6956" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将启动您的应用程序，您可以从浏览器导航到localhost:4200来打开应用程序。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="0f35" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated"><strong class="ak">安装放大库</strong></h1><p id="7a25" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">为了开始使用Amplify，我们需要安装<code class="fe oj ok ol nz b">aws-amplify</code>和<code class="fe oj ok ol nz b">aws-amplify-angular</code>库作为Angular应用程序的依赖项。</p><p id="415b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe oj ok ol nz b">aws-amplify-angular</code>包是一组角度组件和角度提供器，有助于将您的应用与AWS Amplify库集成。它支持Angular 5.0或以上。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="ec45" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">配置后端</h1><p id="343b" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">现在，我们需要为项目配置我们的后端，并启用Amazon Cognito用户池的身份验证。要初始化后端项目，只需运行:</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="fe24" class="od lz it nz b gy oe of l og oh">amplify init</span></pre><p id="1619" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将带您完成设置我们的后端所需的一系列问题。</p><ul class=""><li id="147c" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">选择你的默认编辑器:<a class="ae lq" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>。(您可以选择正在使用的代码编辑器。)</li><li id="bce0" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">选择您正在使用的应用类型:JavaScript。</li><li id="c25b" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">你用的是哪个JavaScript框架:Angular。</li><li id="46f5" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">源目录路径:<code class="fe oj ok ol nz b">src</code>。<strong class="kw iu"> </strong>(您需要指定您的项目的源目录路径，我将通过点击enter接受默认为<code class="fe oj ok ol nz b">src</code>是我们的源目录。)</li><li id="4e35" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">目的目录路径:<code class="fe oj ok ol nz b">dist/aws-amplify-cognito-authentication</code>。(默认情况下，Angular将创建一个同名的子文件夹，因此，确保将子文件夹指定为目标目录路径。)</li><li id="0bfa" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">构建命令:<code class="fe oj ok ol nz b">npm run-script build</code></li><li id="accc" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">开始命令:<code class="fe oj ok ol nz b">ng serve</code></li><li id="8bb5" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">是否要使用AWS配置文件？是的。</li><li id="c663" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">请选择您想要使用的配置文件:默认。<strong class="kw iu"> </strong>(如果您在放大器配置过程中为您的配置文件命名，请确保选择该名称作为您的配置文件。)</li></ul><p id="9d70" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这样，需要一些时间来初始化云中的项目，一旦完成，您将在您的终端上看到一个成功的消息和一堆其他信息。</p><p id="bb59" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们已经成功地配置了我们的后端。</p><p id="ee5a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，我们需要通过创建Amazon Cognito用户池来配置AWS Cognito，这是一个全功能的用户目录服务，可以帮助我们处理用户注册和身份验证。</p><p id="4470" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，只需运行以下命令:</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="88f2" class="od lz it nz b gy oe of l og oh">amplify auth add</span></pre><p id="c185" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样，这将带您了解设置我们的用户池所需的一系列问题。</p><ul class=""><li id="f11c" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">是否要使用默认身份验证和安全配置:是，使用默认配置。</li></ul><p id="b825" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是我将选择默认配置，以便它立即在本地配置Cognito。现在我们需要将我们的配置发布到云中，这样我们就可以开始使用这项服务了。</p><p id="7d39" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为此，只需运行:</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="58be" class="od lz it nz b gy oe of l og oh">amplify publish</span></pre><p id="062f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将在表格视图中显示您的配置摘要，您可以通过说“Yes”来确认。</p><p id="47f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个过程需要一些时间来创建我们的Cognito用户池和Congito身份池，一旦完成，它将在您的终端上显示一条成功消息。</p><p id="92d9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以访问AWS控制台，检查用户池是否已成功创建(确保您选择了正确的区域)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/3306dd39659b9a9b5c1cade678d45782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6NxqrF1fj1dMJaC9GJH2QA.png"/></div></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="4cd0" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated"><strong class="ak">接下来是什么？</strong></h1><p id="a647" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">既然我们已经设置好了后端，我们需要为身份验证过程配置前端应用程序。</p><p id="ec1e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，如果你已经注意到，一个名为<code class="fe oj ok ol nz b">aws-exports.js</code> <em class="oi"> </em>的新文件已经在你的Angular应用程序中创建，它保存了所有与AWS Cognito相关的配置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/a57c39d32419ca35c7edfd537032963c.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*b74IdzG-ZJ_5cyHB34O1PA.png"/></div></figure><p id="3568" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下一步，我们需要将这些配置导入到我们的应用程序中。在您的<code class="fe oj ok ol nz b">main.ts</code>文件中，您需要添加以下导入:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="3fc3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Angular 6+中，Angular团队决定在浏览器中删除对“全局”和“过程”变量的支持，因此，所有Angular 6+应用程序都不包括这方面的垫片。</p><p id="a77d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要添加支持，您需要在您的<code class="fe oj ok ol nz b">polyfills.ts</code>文件中添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="0bf0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们需要将应该包含在<code class="fe oj ok ol nz b">types</code>编译器选项中的<code class="fe oj ok ol nz b">“node”</code>包包含在您的<code class="fe oj ok ol nz b">src/tsconfig.app.json</code>文件中，以便使用<code class="fe oj ok ol nz b">aws-js-sdk</code>。</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="8a6b" class="od lz it nz b gy oe of l og oh">"compilerOptions": {<br/>    "types" : ["node"]<br/>}</span></pre><p id="dc24" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一切就绪，让我们在AWS Cognito池中注册我们的第一个用户。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="844f" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">签约雇用</h1><p id="1557" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">要将我们的用户对象发送到Cognito，您需要将<code class="fe oj ok ol nz b">aws-amplify</code>库导入到您的组件中。</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="16c7" class="od lz it nz b gy oe of l og oh">import { Auth } from 'aws-amplify';</span></pre><p id="b952" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要在用户池中创建新用户，请执行以下操作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="3324" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe oj ok ol nz b">Auth.signUp()</code>方法将用户对象作为参数，带有用户注册的必需字段，在我们的例子中是这样的:</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="0b70" class="od lz it nz b gy oe of l og oh"><em class="oi">const</em> user = {<br/>   username,<br/>   password,<br/>   attributes: {<br/>        email,<br/>        phone_number</span><span id="24e9" class="od lz it nz b gy oq of l og oh">        // other custom attributes<br/>      }<br/>}</span></pre><p id="943c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，当您通过<code class="fe oj ok ol nz b">username</code>时，您必须确保您已经在您的Cognito用户池中将用户名设置为登录方法。</p><p id="7965" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您选择了电子邮件作为您的登录方法，您需要发送用户电子邮件作为用户对象中的用户名属性。</p><p id="8809" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以通过访问Cognito用户池中<code class="fe oj ok ol nz b">General settings</code>下的<code class="fe oj ok ol nz b">Attributes</code>选项卡来检查您在Cognito用户池中将哪个属性设置为登录方法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/4130588a22989f492356f060b625a584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5iyEOdE4D1hVJScp0YCgLQ.png"/></div></div></figure><p id="151f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本例中，我将<code class="fe oj ok ol nz b">Email address or phone number</code>设置为我的登录选项。</p><p id="b229" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个<code class="fe oj ok ol nz b">Auth.signUp()</code>承诺返回一个数据对象，这是一种类型的<code class="fe oj ok ol nz b">CognitoUser</code>，如果您成功注册，您将获得一个发送到您的电子邮件的六位验证码，以验证您的电子邮件地址。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="b302" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated"><strong class="ak">验证电子邮件</strong></h1><p id="51b4" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">要验证您的电子邮件地址:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="4a34" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">承诺有两个参数:</p><ul class=""><li id="a4da" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated"><code class="fe oj ok ol nz b">userName</code>:我们选择的登录用户的用户名或邮箱地址。(在我们的例子中，它是电子邮件地址。)</li><li id="e713" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><code class="fe oj ok ol nz b">verifyCode</code>:发送到你邮箱的六位验证码。</li></ul></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="c199" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">签到</h1><p id="8b5e" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">要登录新创建的用户:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="e967" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe oj ok ol nz b">Auth.signIn(user)</code> promise接受一个包含用户名和密码的参数:</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="81a5" class="od lz it nz b gy oe of l og oh"><em class="oi">const</em> user = {<br/>      username,<br/>      password<br/>   }</span></pre><p id="6ca2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将返回包含<code class="fe oj ok ol nz b">challengeName</code>和<code class="fe oj ok ol nz b">challengeParam</code>属性的<code class="fe oj ok ol nz b">user</code>对象，您可以使用这些属性来检查用户是否启用了双因素身份验证等。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="bf96" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">签名登记离开</h1><p id="ae9a" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">要从当前会话中注销用户:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="6d7c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将通过撤销身份验证令牌来清除当前用户会话。</p><p id="e51a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您想让用户从所有设备上注销，您需要向您的注销方法传递一个附加配置，如下所示:</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="f8d9" class="od lz it nz b gy oe of l og oh">Auth.signOut({ global: true })<br/>    .then(data =&gt; console.log(data))<br/>    .catch(err =&gt; console.log(err));</span></pre><p id="f2cc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果用户从多个设备登录，这将确保用户从所有设备注销。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="47e7" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">结论</h1><p id="cf9e" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">恭喜您，您已经能够通过以下方式使用AWS Amplify和AWS Cognito with Angular成功创建全功能用户身份验证:</p><ul class=""><li id="9fb8" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">在我们的本地机器上安装AWS Amplify CLI，并使用我们的AWS帐户进行配置。</li><li id="6e9b" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">借助Amplify CLI和AWS Cognito云服务配置无服务器后端以进行用户身份验证。</li><li id="5e37" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">使用Angular CLI创建Angular 8项目。</li><li id="6424" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">使用aws-amplify库注册、确认密码、登录和注销用户。</li></ul><p id="3e5c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然这篇文章有点长，但我们仍然只涉及了aws-amplify库提供的非常基本的特性。</p><p id="3639" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以探索更多功能，如更改密码、忘记密码、验证电话号码等。参考官方<a class="ae lq" href="https://aws-amplify.github.io/docs/js/authentication" rel="noopener ugc nofollow" target="_blank"> Amplify文档</a>进行用户注册。</p><p id="49b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，这是完整的<a class="ae lq" href="https://github.com/azkarmoulana/aws-amplify-cognito-authentication" rel="noopener ugc nofollow" target="_blank"> GitHub项目</a>。</p><p id="97ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读！</p></div></div>    
</body>
</html>