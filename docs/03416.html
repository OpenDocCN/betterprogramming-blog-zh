<html>
<head>
<title>How to Send Push Notifications to the iOS Simulator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何向iOS模拟器发送推送通知</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-send-push-notifications-to-the-ios-simulator-2988092ba931?source=collection_archive---------0-----------------------#2020-02-09">https://betterprogramming.pub/how-to-send-push-notifications-to-the-ios-simulator-2988092ba931?source=collection_archive---------0-----------------------#2020-02-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a455" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">截至Xcode 11.4 beta，可以！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0218001d32dfb10ff5ed88e27ae2b068.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CCCcz9__CzvDWZlKonf77w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@jamie452?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">杰米街</a>在<a class="ae ky" href="https://unsplash.com/s/photos/notification?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="754e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">推送通知是开发者让用户参与到他们的应用中最受欢迎的方式之一。在iOS应用程序中，可以通过使用苹果推送通知服务(APNs)来合并推送通知。</p><p id="8a55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，这并不像听起来那么简单，因为设置它需要做很多事情。另外，更糟糕的是，我们必须使用真实的设备来测试推送通知是否有效，因为Xcode的iOS模拟器不支持推送通知。</p><p id="5c8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是我有好消息要告诉你。Xcode 11.4测试版已经发布，对我来说这个版本最好的部分是我们终于可以在iOS模拟器中测试推送通知了！</p><p id="805e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Xcode 11.4测试版的<a class="ae ky" href="https://developer.apple.com/documentation/xcode_release_notes/xcode_11_4_beta_release_notes" rel="noopener ugc nofollow" target="_blank">发行说明</a>包含一个部分，内容如下:</p><blockquote class="lv lw lx"><p id="2cfe" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">模拟器支持模拟远程推送通知，包括后台内容获取通知。在模拟器中，将APNs文件拖放到目标模拟器上。该文件必须是JSON文件，具有有效的Apple推送通知服务有效负载，包括“aps”密钥。它还必须包含一个顶级“模拟器目标包”，其字符串值与目标应用程序的包标识符相匹配。</p><p id="d63b" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><code class="fe mc md me mf b">simctl</code>还支持发送模拟推送通知。如果文件包含“模拟器目标包”，则包标识符不是必需的，否则您必须将其作为参数提供(8164566):</p><p id="aa1a" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><code class="fe mc md me mf b">$ xcrun simctl push &lt;device&gt; com.example.my-app ExamplePush.apns</code></p></blockquote><p id="fa38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在文章的后半部分深入探讨这意味着什么。但是现在，让我们感到高兴，因为必须使用真实设备来测试推送通知的麻烦终于消失了。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="3015" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">我们怎么做呢？</h1><p id="15e4" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">那么，现在，让我们看看如何使用Xcode 11.4 beta的这个新特性。为此，您显然需要Xcode 11.4 beta或更高版本。我目前有Xcode 11.4测试版。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/be2f870b83e810b2bdf2f7d3e07cc072.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hcKLF6np4rRpAFH64ORubQ.png"/></div></div></figure><p id="d32e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们创建一个新项目。我把它命名为<em class="ly"> TestPushNotifications </em>，我选择的用户界面是Storyboard。如果你愿意，你可以选择SwiftUI。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/928c1b9ac255684c508c072aefb5f784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YOlVCQIzhsZTBgX9aHCt5Q.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建新项目</p></figure><p id="be7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只是为了让应用看起来更好(虽然这不会有什么帮助……)，我添加了一个<code class="fe mc md me mf b">UILabel</code>，上面写着“你好，世界！”在<code class="fe mc md me mf b">Main.storyboard</code>的<code class="fe mc md me mf b">View Controller</code>。</p><p id="b918" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当我们在模拟器中运行该应用程序时，在这种情况下，它看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/5cabd64e511bfe48ae4de21dde800ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AI_FCd-fRtzUC-jA_cgyDw.png"/></div></div></figure><p id="f6a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是乐趣的开始！让我们转到<code class="fe mc md me mf b">AppDelegate.swift</code>文件，在<code class="fe mc md me mf b">import UIKit</code>下面添加下面一行来导入苹果的<code class="fe mc md me mf b">UserNotifications</code>框架。</p><pre class="kj kk kl km gt nn mf no np aw nq bi"><span id="9610" class="nr mo it mf b gy ns nt l nu nv">import UserNotifications</span></pre><p id="584d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在<code class="fe mc md me mf b">AppDelegate</code>类中，让我们创建一个函数<code class="fe mc md me mf b">registerForPushNotifications()</code>，请求用户允许应用程序发送推送通知。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<code class="fe mc md me mf b">AppDelegate</code>类中添加的registerForPushNotifications()函数</p></figure><p id="c5f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从<code class="fe mc md me mf b">AppDelegate</code>的<code class="fe mc md me mf b">application(_:didFinishLaunchingWithOptions:)</code>方法调用刚刚创建的函数。</p><p id="a373" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，在<code class="fe mc md me mf b">return true</code>语句上方添加<code class="fe mc md me mf b">registerForPushNotifications()</code>。您的<code class="fe mc md me mf b">AppDelegate.swift</code>文件看起来会像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AppDelegate.swift文件的最终版本</p></figure><p id="22ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们运行应用程序时，我们会收到一个对话框，要求允许应用程序发送推送通知。轻击<em class="ly">允许</em>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/513d075cc26bb3725d4b94fb549e330b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbKIWNHOiO0IhqdlJ-vSbg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要求用户允许应用程序发送推送通知的对话框</p></figure><p id="b0df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Xcode 11.4测试版的发行说明说:</p><blockquote class="lv lw lx"><p id="960f" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">"<code class="fe mc md me mf b">simctl</code>还支持发送模拟推送通知。如果文件包含“模拟器目标包”，则包标识符不是必需的，否则，您必须将其作为参数提供(8164566):</p><p id="bd0e" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><code class="fe mc md me mf b">$ xcrun simctl push &lt;device&gt; com.example.my-app ExamplePush.apns</code></p></blockquote><p id="e054" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们试试它说什么。为此，我们需要一个带有有效苹果推送通知服务有效负载的JSON文件。</p><p id="1623" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">苹果公司的文档名为“<a class="ae ky" href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/generating_a_remote_notification" rel="noopener ugc nofollow" target="_blank">生成远程通知</a>”，清楚地说明了我们如何创建这样一个文件。我正在我的桌面上创建一个名为<code class="fe mc md me mf b">notification.apns</code>的文件，并在其中添加以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="5888" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建文件后，我们可以打开终端并使用发行说明中给出的命令:</p><pre class="kj kk kl km gt nn mf no np aw nq bi"><span id="0409" class="nr mo it mf b gy ns nt l nu nv">$ xcrun simctl push &lt;device&gt; com.example.my-app ExamplePush.apns</span></pre><p id="1044" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，<code class="fe mc md me mf b">&lt;device&gt;</code>将被替换为设备标识符，<code class="fe mc md me mf b">com.example.my-app</code>将被替换为项目的包标识符，<code class="fe mc md me mf b">ExamplePush.apns</code>将被替换为我们的<code class="fe mc md me mf b">apns</code>文件的文件名。</p><p id="4cc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，如果您在<code class="fe mc md me mf b">apns</code>文件中使用<code class="fe mc md me mf b">“Simulator Target Bundle”</code>键添加包标识符，那么包标识符在命令中不是必需的。</p><p id="6cf6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以按照下面GIF中显示的步骤检索模拟器的设备标识符:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/8be6e9a280aefcf2459bc6e2f713c0e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HeWLhyBRoXt609ui8_Vxrg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">查找我们正在使用的模拟器的设备标识符(本例中是iPhone 11 Pro Max)</p></figure><p id="b973" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以按照下面GIF中显示的步骤检索项目的包标识符:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/4e12267b43e47abf46f744f87e5c69fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*DsbC2EnyFnZRPg-MPntPUA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">查找项目的包标识符</p></figure><p id="a9fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在执行命令之前，我们必须先将应用程序发送到后台。这就是推送通知可见的方式。</p><blockquote class="lv lw lx"><p id="be62" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">注意:如果你想让推送通知在前台也可见，你可以让<code class="fe mc md me mf b">AppDelegate</code>符合<code class="fe mc md me mf b">UNUserNotificationCenterDelegate</code>并实现它的<code class="fe mc md me mf b">userNotificationCenter(_:willPresent:withCompletionHandler:)</code>方法。并且确保在调用<code class="fe mc md me mf b">application(_:didFinishLaunchingWithOptions:)</code>方法中的<code class="fe mc md me mf b">registerForPushNotifications()</code>之前已经包含了下面一行:</p><p id="8499" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><code class="fe mc md me mf b">UNUserNotificationCenter.current().delegate = self</code></p><p id="218a" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">感谢<a class="ny nz ep" href="https://medium.com/u/3f4b70046055?source=post_page-----2988092ba931--------------------------------" rel="noopener" target="_blank"> Rajan Maheshwari </a>的<a class="ae ky" href="https://medium.com/@rajanmaheshwari1990/sagun-raj-lage-i-havent-tried-that-504a66af000f" rel="noopener">回应</a>。</p></blockquote><p id="6776" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们执行命令。在我的例子中，命令是:</p><pre class="kj kk kl km gt nn mf no np aw nq bi"><span id="123d" class="nr mo it mf b gy ns nt l nu nv">$ xcrun simctl push 25A9FF1A-000B-4F36-B44C-43AC7BCD0958 np.com.sagunrajlage.TestPushNotifications notification.apns</span></pre><p id="844b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦它被执行，这就是我们在模拟器中看到的—一个推送通知:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/b45a72b4ec72c4b2e1264529775f2320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vgDjroc9c8JCoO2GInZysw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模拟器中的推送通知</p></figure><p id="5466" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们如何在模拟器中运行命令来显示推送通知！</p><p id="c8b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是等等，如果你不太习惯使用终端，还有另一种方法。还记得发行说明上说的吗？</p><blockquote class="lv lw lx"><p id="7025" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“在模拟器中，将APNs文件拖放到目标模拟器上。该文件必须是JSON文件，具有有效的Apple推送通知服务有效负载，包括“aps”密钥。它还必须包含顶级“模拟器目标包”，其字符串值与目标应用程序的包标识符相匹配。</p></blockquote><p id="e53c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以简单地将我们的<code class="fe mc md me mf b">apns</code>文件拖放到模拟器中来获得推送通知。但是为此，我们必须在<code class="fe mc md me mf b">apns</code>文件中做一些修改。</p><p id="ee87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们之前创建的<code class="fe mc md me mf b">notification.apns</code>文件中，让我们再添加一个键<code class="fe mc md me mf b">"Simulator Target Bundle”</code>，它将保存我们的包标识符的值，在我的例子中是<code class="fe mc md me mf b">“np.com.sagunrajlage.TestPushNotifications”</code>。</p><p id="d64e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，该文件将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="250d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，将这个文件拖放到模拟器上，看看其中的神奇之处吧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/abdfa69f5195a657370c0e68b3c0436f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*qiaANWylUaZPZYBd5M-e7Q.gif"/></div></div></figure><p id="4d55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是在iOS模拟器中测试推送通知的另一种方式。</p><p id="d75a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是对即将到来的Xcode版本的一个很好的补充，因为它为我们省去了很多麻烦。保持下去，苹果！</p><p id="eba7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">向我的导师们大喊，Prakshapan Shrestha 、<a class="ae ky" href="https://www.linkedin.com/in/nutan-niraula/" rel="noopener ugc nofollow" target="_blank"> Nutan Niraula </a>和<a class="ae ky" href="https://www.linkedin.com/in/ashwin-shrestha-7545a2101/" rel="noopener ugc nofollow" target="_blank"> Ashwin Shrestha </a>，感谢他们激励、鼓励和支持我！</p><p id="810e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><p id="7842" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你觉得这篇文章有用，并且愿意支持我，请"<a class="ae ky" href="https://www.buymeacoffee.com/sagunraj" rel="noopener ugc nofollow" target="_blank">给我买杯咖啡</a>"</p><div class="oa ob gp gr oc od"><a href="https://www.buymeacoffee.com/sagunraj" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">Sagun Raj Lage正在撰写博客和书籍，并免费教授编程。</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">我是一名iOS开发人员，有从事各种领域相关项目的经验，如交通和…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">www.buymeacoffee.com</p></div></div><div class="om l"><div class="on l oo op oq om or ks od"/></div></div></a></div></div></div>    
</body>
</html>