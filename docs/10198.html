<html>
<head>
<title>3 Python Packages to Hide Passwords and Secrets From Your Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">3个Python包来隐藏代码中的密码和秘密</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/hiding-passwords-secrets-in-python-397ecd929050?source=collection_archive---------0-----------------------#2021-12-11">https://betterprogramming.pub/hiding-passwords-secrets-in-python-397ecd929050?source=collection_archive---------0-----------------------#2021-12-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bc3d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">保持密码和秘密与代码分离，使它们对每个人都隐藏起来。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3477de465d8ff071f23a59274ad39af8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0Q3M4DL-T5JTykp-"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@pechka?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马頔·佩丘林</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="44dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每当任何项目启动时，项目中都会使用各种机密和密码，例如令牌、AWS密钥、第三方API机密、数据库配置和密码。通常我们会将它们作为常量硬编码在代码中。</p><p id="e022" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将它们硬编码在代码中并不是一个好主意，因为这会降低应用程序的安全性，需要为QA和prod env更改这些值。此外，如果代码被上传到GitHub或任何VCS云上，那么秘密就会暴露给所有人。</p><p id="cb95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了使应用程序更加安全，并使这些秘密对每个人都隐藏起来，最好将这些秘密用作环境变量或配置文件。在Python中，有各种各样的包可以用来做这件事，比如:<code class="fe ls lt lu lv b"><a class="ae kv" href="https://pypi.org/project/python-decouple/" rel="noopener ugc nofollow" target="_blank">python-decouple</a></code>、<code class="fe ls lt lu lv b"><a class="ae kv" href="https://pypi.org/project/python-dotenv/" rel="noopener ugc nofollow" target="_blank">python-dotenv</a></code>、<code class="fe ls lt lu lv b"><a class="ae kv" href="https://pypi.org/project/jproperties/" rel="noopener ugc nofollow" target="_blank">jproperties</a></code>。</p><p id="a364" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们深入了解它们中的每一个，以了解流程和用法。</p><h1 id="a51b" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">Python-dotenv</h1><p id="d533" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">Python-dotenv从一个<code class="fe ls lt lu lv b">.env</code>文件中读取键值对，并可以将它们设置为环境变量。它有助于遵循<a class="ae kv" href="http://12factor.net/" rel="noopener ugc nofollow" target="_blank"> 12因素</a>原则的应用程序开发。</p><h2 id="34e0" class="mt lx iq bd ly mu mv dn mc mw mx dp mg lf my mz mi lj na nb mk ln nc nd mm ne bi translated"><strong class="ak">安装</strong></h2><pre class="kg kh ki kj gt nf lv ng nh aw ni bi"><span id="4ae5" class="mt lx iq lv b gy nj nk l nl nm">pip install python-dotenv</span></pre><h2 id="cecb" class="mt lx iq bd ly mu mv dn mc mw mx dp mg lf my mz mi lj na nb mk ln nc nd mm ne bi translated"><strong class="ak">用途</strong></h2><p id="7a2a" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">在项目中创建一个<code class="fe ls lt lu lv b">.env</code>文件，把所有的秘密和密码保存在里面。<code class="fe ls lt lu lv b">python-dotenv</code>支持的<code class="fe ls lt lu lv b">.env</code>文件的语法类似于Bash:</p><pre class="kg kh ki kj gt nf lv ng nh aw ni bi"><span id="859b" class="mt lx iq lv b gy nj nk l nl nm"># Comment goes here<br/>USERNAME=testusername<br/>ADMIN_USERNAME=admin@${USERNAME}<br/>PASSWORD=1234567sa</span></pre><p id="9e11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将<code class="fe ls lt lu lv b">.env</code>文件包含为:</p><pre class="kg kh ki kj gt nf lv ng nh aw ni bi"><span id="cd5f" class="mt lx iq lv b gy nj nk l nl nm">from dotenv import load_dotenv<br/><br/>load_dotenv()  # take environment variables from .env.<br/><br/># Code of your application, which uses environment variables (e.g. from `os.environ` or<br/># `os.getenv`) as if they came from the actual environment.<br/>username=os.getenv('USERNAME')</span></pre><p id="5e50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并且永远不要忘记在<code class="fe ls lt lu lv b">.gitignore.</code>中加上<code class="fe ls lt lu lv b">.env</code></p><p id="b038" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们想在代码中改变这些值，那么不要直接使用<code class="fe ls lt lu lv b">dotenv_values</code>，它给出了所有值的值。然后我们可以根据我们的需求来消费它</p><pre class="kg kh ki kj gt nf lv ng nh aw ni bi"><span id="ea85" class="mt lx iq lv b gy nj nk l nl nm">import os<br/>from dotenv import dotenv_values<br/><br/>config = {<br/>    **dotenv_values(".env.shared"),  # load shared development variables<br/>    **dotenv_values(".env.secret"),  # load sensitive variables<br/>    **os.environ,  # override loaded values with environment variables<br/>}</span></pre><p id="5470" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">实际上，<code class="fe ls lt lu lv b">python-dotenv</code>是使用<code class="fe ls lt lu lv b">.env</code>变量的最简单的方法，不用将它们声明为<code class="fe ls lt lu lv b">os</code>变量。</p><h1 id="7a45" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">python-解耦</h1><p id="fe97" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">顾名思义，它将秘密文件从代码中完全分离出来，类似于<code class="fe ls lt lu lv b">python-dotenv</code>，但有一些附加功能。<em class="nn">解耦</em>帮助您组织您的设置，以便您可以更改参数，而无需重新部署您的应用程序。</p><h2 id="f10a" class="mt lx iq bd ly mu mv dn mc mw mx dp mg lf my mz mi lj na nb mk ln nc nd mm ne bi translated"><strong class="ak">安装</strong></h2><pre class="kg kh ki kj gt nf lv ng nh aw ni bi"><span id="4e53" class="mt lx iq lv b gy nj nk l nl nm">pip install python-decouple</span></pre><h2 id="0471" class="mt lx iq bd ly mu mv dn mc mw mx dp mg lf my mz mi lj na nb mk ln nc nd mm ne bi translated"><strong class="ak">用法</strong></h2><p id="b244" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">它还可以从<code class="fe ls lt lu lv b">.env</code>或<code class="fe ls lt lu lv b">.ini</code>文件中获取秘密，但是它有一个优势，即可以转换值或输入默认值，如果我们直接使用<code class="fe ls lt lu lv b">os environment or with python-dotenv.</code>的话，这在现实中是没有的</p><pre class="kg kh ki kj gt nf lv ng nh aw ni bi"><span id="29e5" class="mt lx iq lv b gy nj nk l nl nm"># .env file<br/>USERNAME=testusername<br/>ADMIN_USERNAME=admin@${USERNAME}<br/>PASSWORD=1234567sa<br/>NO_USERS=10<br/>IS_DEV=False</span></pre><p id="04f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在主python脚本中，将其用作:</p><pre class="kg kh ki kj gt nf lv ng nh aw ni bi"><span id="513f" class="mt lx iq lv b gy nj nk l nl nm">from decouple import config</span><span id="390b" class="mt lx iq lv b gy no nk l nl nm">username = config('USERNAME')<br/>admin_username = config('ADMIN_USERNAME',default='admin')<br/>password = config('PASSWORD')<br/>no_users = config('NO_USERS',default=10,cast=int)<br/>is_dev = config('IS_DEV',default=False,cast=bool)</span></pre><p id="e2a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">默认情况下，解耦返回的所有值都是字符串，毕竟它们是从文本文件或<code class="fe ls lt lu lv b">envvars</code>中读取的。为了将它们转换成期望的类型，config函数接受一个cast参数，该参数接收任何可调用的，这将用于将字符串值转换成其他值。</p><p id="cc1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nn">解耦</em>总是按此顺序搜索<em class="nn">选项</em>:</p><ol class=""><li id="f082" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr nu nv nw nx bi translated">环境变量。</li><li id="d3e2" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">资源库:<code class="fe ls lt lu lv b">ini</code>或<code class="fe ls lt lu lv b">.env</code>文件。</li><li id="6d06" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">传递给配置的默认参数。</li></ol><p id="6b1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为什么不直接使用环境变量呢？</p><p id="fe46" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Env变量可以工作，但是因为<code class="fe ls lt lu lv b">os.environ</code>只返回字符串，所以很棘手。假设你有一个<em class="nn">env var</em>T11】。如果你跑步:</p><pre class="kg kh ki kj gt nf lv ng nh aw ni bi"><span id="e4c7" class="mt lx iq lv b gy nj nk l nl nm">if os.environ['IS_DEV']:<br/>    print True<br/>else:<br/>    print False</span></pre><p id="5d94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它将打印<code class="fe ls lt lu lv b">True</code>，因为<code class="fe ls lt lu lv b">os.environ[“IS_DEV”]</code>返回字符串<code class="fe ls lt lu lv b">False</code>。因为它是非空字符串，所以将被计算为<code class="fe ls lt lu lv b">True</code>。解耦提供了一个看起来不像变通办法的解决方案:</p><pre class="kg kh ki kj gt nf lv ng nh aw ni bi"><span id="6217" class="mt lx iq lv b gy nj nk l nl nm">config(“IS_DEV”, cast=bool)</span></pre><h1 id="8d16" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">j属性</h1><p id="3750" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated"><code class="fe ls lt lu lv b">jProperties</code>是一个用于Python的Java属性文件解析器和编写器。它旨在提供与<a class="ae kv" href="http://docs.oracle.com/javase/7/docs/api/java/util/Properties.html" rel="noopener ugc nofollow" target="_blank"> Java的属性类</a>相同的功能。</p><p id="228d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以使用这些java属性文件来保存秘密，并使用<code class="fe ls lt lu lv b">jproperties</code>将它们加载到python代码的开头。</p><h2 id="dddd" class="mt lx iq bd ly mu mv dn mc mw mx dp mg lf my mz mi lj na nb mk ln nc nd mm ne bi translated"><strong class="ak">安装</strong></h2><pre class="kg kh ki kj gt nf lv ng nh aw ni bi"><span id="773d" class="mt lx iq lv b gy nj nk l nl nm">pip install jproperties</span></pre><h2 id="22b6" class="mt lx iq bd ly mu mv dn mc mw mx dp mg lf my mz mi lj na nb mk ln nc nd mm ne bi translated"><strong class="ak">用法</strong></h2><p id="d3fe" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">首先，创建一个包含所有机密和密码的属性文件，如下所示:</p><pre class="kg kh ki kj gt nf lv ng nh aw ni bi"><span id="4785" class="mt lx iq lv b gy nj nk l nl nm"># test.properties file<br/>USERNAME=testusername<br/>ADMIN_USERNAME=admin@${USERNAME}<br/>PASSWORD=1234567sa<br/>NO_USERS=10<br/>IS_DEV=False</span></pre><p id="64a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，如果我们想在代码中使用它们，那么我们首先需要加载文件并获取秘密，如下所示:</p><pre class="kg kh ki kj gt nf lv ng nh aw ni bi"><span id="a770" class="mt lx iq lv b gy nj nk l nl nm">from jproperties import Properties</span><span id="d5a2" class="mt lx iq lv b gy no nk l nl nm">secrets = Properties() # create a property object</span><span id="acc2" class="mt lx iq lv b gy no nk l nl nm">with open("test.properties", "r") as f:<br/>    secrets.load(f, "utf-8") # load the test.properties file</span><span id="48be" class="mt lx iq lv b gy no nk l nl nm">username = secrets["USERNAME"].data<br/>password = secrets["PASSWORD"].data</span></pre><p id="df39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不仅变量值支持元数据信息。请访问<a class="ae kv" href="https://pypi.org/project/jproperties/" rel="noopener ugc nofollow" target="_blank">元数据支持</a>的官方文档。</p><p id="9c77" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不要按代码中的<code class="fe ls lt lu lv b">.env</code>、<code class="fe ls lt lu lv b">.ini</code>或<code class="fe ls lt lu lv b">.properties</code>。同时确保在<code class="fe ls lt lu lv b">.gitignore.</code>中标记它们</p></div><div class="ab cl od oe hu of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ij ik il im in"><p id="821b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你正在使用上面的任何一个包，那么在<code class="fe ls lt lu lv b">Readme.md</code>中记录好关于制作<code class="fe ls lt lu lv b">.env</code>文件或属性文件的细节，这样无论是谁使用你的代码都知道在运行代码之前创建了这些文件。</p><p id="8f41" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">继续学习，继续编码谢谢。</p><p id="e9b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来阅读<a class="ae kv" href="https://link.medium.com/byx9SAuammb" rel="noopener"> Python代码格式化程序黑色。</a></p></div></div>    
</body>
</html>