<html>
<head>
<title>Getting the Best Places in Town With the Google Maps API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用谷歌地图API获取城市中的最佳位置</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-the-best-places-in-town-with-the-google-maps-api-b23e2ab12510?source=collection_archive---------11-----------------------#2020-01-09">https://betterprogramming.pub/getting-the-best-places-in-town-with-the-google-maps-api-b23e2ab12510?source=collection_archive---------11-----------------------#2020-01-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="36e8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">搜索谷歌地图并按评分排序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0c09e41a3e5ec34734bf57a7dd7188ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IYovhDNYrrxT7Jdh"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@hjkp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">亨利·佩克斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://www.webtips.dev/getting-the-best-places-in-town-with-the-google-maps-api"><div class="gh gi kz"><img src="../Images/c19cb3069af1beba3c93258d9fcfe139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*-PVzecNs3s4ZbJsdsgIsGA.png"/></div></a></figure><p id="6b92" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你和我一样，你可能在生活中的某个时候问过自己这个问题，一个没有人知道答案的问题:我们应该在哪里/吃什么？因为我是一名开发人员，我觉得我已经受够了，让计算机给我一些建议。这时候，我们有了一个想法，让谷歌地图列出附近最好的餐馆/酒吧/任何其他东西，这样我们就可以更容易地选择。</p><p id="a3b4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">幸运的是，Google Maps API有能力通过其Places API的组合来做到这一点。所以今天，我想向你展示你如何做同样的事情。</p><p id="8377" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这一努力的第一步是接收一个API密钥。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="0c24" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">正在检索API密钥</h1><p id="8b0f" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">API键将用于调用不同的API。要获得API密钥，请前往您的<a class="ae ky" href="https://cloud.google.com/console/google/maps-apis/overview" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>仪表盘。选择一个项目或创建一个新项目(如果您还没有开始一个项目)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/4c929a379c6a82d9c0b3c9624164df7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*McqqRr-E-qdb_498AXe6nw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我这里叫做“谷歌地图应用编程接口”</p></figure><p id="ac43" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">转到菜单按钮，选择API &amp; Services下的Credentials选项卡。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/92aedd5f18350784c9b674c491508e22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*LRoanm4nRmcQcoC5P4NVGw.png"/></div></figure><p id="ac3b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">单击Create Credentials按钮，您新创建的API密匙将会弹出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/35aafd187e2cac4968aae441e1f1fd9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Y3r16d54yFEQ5gwKUMFyw.png"/></div></div></figure><p id="915d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在生产环境中使用API密钥之前对其进行限制是一个好主意，这样可以避免意外开支并防止配额被盗用。您可以在凭证选项卡下的APIs &amp; Services菜单中设置限制。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/e7456a9317825b89124e819a5d7e5094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y_5wDncWu3LPa0s6xvsn3g.png"/></div></div></figure><p id="52f9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">请注意，为了使用谷歌云服务，您可能需要将您的项目链接到一个计费帐户。对我们来说幸运的是，谷歌地图API仍然是免费的，每月最高200美元。这相当于每月约28，000个电话。要了解更多关于定价的信息，请访问Google Cloud上的<a class="ae ky" href="https://cloud.google.com/maps-platform/pricing/" rel="noopener ugc nofollow" target="_blank">定价&amp;计划</a>或<a class="ae ky" href="https://cloud.google.com/maps-platform/pricing/sheet/" rel="noopener ugc nofollow" target="_blank">定价表</a>部分。</p><p id="1153" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你更喜欢阅读Google关于如何获得API密匙的逐步指南，你可以参考他们自己的文档。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="0ed1" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">设置地点API</h1><p id="4bb7" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">为了获得地图上的地点信息，我们将使用Places API。为了能够使用它，您需要在您的云平台控制台中启用它。</p><p id="a3dd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">转到您刚刚创建的项目，单击导航菜单，并选择API &amp; Services下的库选项。您将看到以下页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/09a60989785f8a8045164a7b6310d1f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hGXp2qoVeafrfGDSI8wrgQ.png"/></div></div></figure><p id="5ee6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">搜索“位置API”并选择启用。就像谷歌地图API一样，Places API的附近搜索功能——我们将使用的<em class="nf">——每月最多可免费调用5000次。</em></p><p id="7c30" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">既然您已经做好了管理方面的准备，我们可以开始编码了。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="5b1e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">设置项目</h1><p id="454f" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">创建一个新文件夹，并添加以下<code class="fe ng nh ni nj b">index.html</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="fc9d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们不会有一个实际的谷歌地图，因为我们将在一个有序的列表中显示结果。您还想包含API库，并且不要忘记用您实际的API键替换<code class="fe ng nh ni nj b">YOUR_API_KEY</code>。我们还将利用Places API —您需要将其指定为查询字符串。这是<code class="fe ng nh ni nj b">&amp;libraries=places</code>应该做的。</p><p id="efe4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我还创建了一个<code class="fe ng nh ni nj b">places.js</code>，我们自己的实现将放在那里。您也可以将其添加到项目文件夹中。这就是我们所需要的。其他的都将放入<code class="fe ng nh ni nj b">places.js</code>文件中。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="1ac2" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">得到一些结果</h1><p id="1ab5" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">在开始获取结果之前，我们需要创建一些变量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="f77a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们将把所有内容存储在一个<code class="fe ng nh ni nj b">results</code>数组中，并且我们还获得了一个对<code class="fe ng nh ni nj b">places</code>元素的引用。但是这里有趣的部分是我们创造的<code class="fe ng nh ni nj b">request</code>和<code class="fe ng nh ni nj b">service</code>。该服务将负责请求位置。可以将任何DOM元素传入<code class="fe ng nh ni nj b">PlacesService</code>；它不一定是谷歌地图对象。如果您仍想在地图上显示结果，您需要将<code class="fe ng nh ni nj b">places</code>变量更改为以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="70ee" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">一旦我们有了<code class="fe ng nh ni nj b">service</code>，我们就可以用一个<code class="fe ng nh ni nj b">request</code>对象和一个<code class="fe ng nh ni nj b">callback</code>函数来调用<code class="fe ng nh ni nj b">nearbySearch</code>方法。我们需要在请求中指定的三个主要内容是:</p><ul class=""><li id="6d02" class="nm nn it lc b ld le lg lh lj no ln np lr nq lv nr ns nt nu bi translated">位置:坐标是根据纬度和经度值创建的。它接受一个<code class="fe ng nh ni nj b">google.maps.LatLng</code>对象。</li><li id="05df" class="nm nn it lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">半径:以米为单位表示圆的半径，圆的中间是水平位置。这里的最大值可以是50，000。</li><li id="d615" class="nm nn it lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">类型数组:我们要寻找的位置的类型。因为我们饿了，我们希望餐馆被退回。关于支持类型的完整列表，可以参考谷歌地图平台上的<a class="ae ky" href="https://developers.google.com/places/web-service/supported_types" rel="noopener ugc nofollow" target="_blank">文档</a>。</li></ul><p id="3692" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">坐标指向伦敦。要获得一个城市的坐标，只需前往<a class="ae ky" href="http://maps.google.com/" rel="noopener ugc nofollow" target="_blank">maps.google.com</a>并搜索该城市。纬度坐标将出现在地址栏中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/61fa404f9ea4d1ee4b764317636205c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DRtTv4gQbTL4om4jipyKFA.png"/></div></div></figure><p id="e7a6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们还有一个尚未定义的回调函数，所以我们现在就开始吧！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="8dab" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">回调期望的三样东西是一个存储服务返回的所有内容的<code class="fe ng nh ni nj b">response</code>对象，一个表示调用成功或失败的<code class="fe ng nh ni nj b">status</code>，以及一个可选的分页对象。</p><p id="2fb1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">默认情况下，对服务的每个查询返回20个结果。然而，它可以扩展到60分跨三页。这就是为什么我们必须使用分页。<code class="fe ng nh ni nj b">pagination.nextPage</code>函数将再次调用这个<code class="fe ng nh ni nj b">callback</code>函数。</p><p id="063f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您可能还注意到对分页函数的调用被包装在一个<code class="fe ng nh ni nj b">setTimeout</code>中。这是因为在下一页结果出现之前，您必须等待至少两秒钟。这也意味着，由于获取所有结果需要时间，理想情况下，您应该显示某种加载指示器，以向用户显示后台正在进行的操作。</p><p id="fd9c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，如果服务返回所有内容，<code class="fe ng nh ni nj b">pagination.hasNextPage</code>将不再存在，让我们跳转到else块，在那里我们最终显示结果。我将这里的代码外包给了不同的功能，这样我们就有了某种分离。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6e8b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">显示所有内容</h1><p id="751f" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated"><code class="fe ng nh ni nj b">displayResults</code>功能将非常简单。让我们看看我们有什么:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="c1a4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">首先，我们需要过滤结果列表。可能会有评级缺失的情况。那样的话，我们就不知道这个地方是否值得信任。简单地说…</p><pre class="kj kk kl km gt ob nj oc od aw oe bi"><span id="4fcb" class="of me it nj b gy og oh l oi oj">result =&gt; result.rating</span></pre><p id="c248" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">…我们告诉JavaScript只包含含有评级的结果。如果<code class="fe ng nh ni nj b">result.rating</code>未定义，它将从结果集中省略。</p><p id="4a79" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，我们需要根据评级对其进行排序，这样我们就可以从最顶端选择最佳选项。最后，我们可以在一个<code class="fe ng nh ni nj b">forEach</code>循环中显示他们的名字和评级。</p><p id="bc68" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">值得一提的是，从性能角度来看，这并不是在<code class="fe ng nh ni nj b">forEach</code>的每个循环中操作DOM的最佳方式。一种替代方法是在循环中创建字符串，并在循环结束后才将其添加到DOM中。</p><p id="aedd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，如果您返回浏览器并刷新页面，您应该会看到60个结果<em class="nf">(如果每个结果都有评级)</em>按评级排序，最高评级在最上面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/8096b0a8babab414af60267e8af804e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3fnVszcf5gABKM79T8dbBA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">看来是红玫瑰了</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2478" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">摘要</h1><p id="f07c" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">口袋里有了这个工具，你就再也不用挨饿了。剩下要做的就是创建一个漂亮的用户界面，这样您就可以根据选择的半径和选择的地点类型动态地选择城市。</p><p id="192d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">和往常一样，你可以在我的GitHub上的<a class="ae ky" href="https://github.com/flowforfrank/places" rel="noopener ugc nofollow" target="_blank"> places repo </a>找到整个项目。随时调整它，让我知道你在comments️.的建议现在该去吃点东西了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://medium.com/@ferencalmasi/membership"><div class="gh gi ol"><img src="../Images/e66c4cd6d9849ac0bd245f3fc39b65c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZ9xuLqLkbqUG65sgVB3gg.png"/></div></a></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://www.webtips.dev/"><div class="gh gi kz"><img src="../Images/b0d8e0a0c2689a59aa62a677429b83b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*_QOx8lB1bc1rVmMjWQ3Yfw.png"/></div></a></figure></div></div>    
</body>
</html>