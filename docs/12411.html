<html>
<head>
<title>Measuring Performance in Software Engineering</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">软件工程中的性能测量</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/performance-part-iii-measuring-performance-improvement-301985484855?source=collection_archive---------8-----------------------#2022-06-03">https://betterprogramming.pub/performance-part-iii-measuring-performance-improvement-301985484855?source=collection_archive---------8-----------------------#2022-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="50a0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">总是添加措施来防止系统降级</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/00f0364ef5c271e8f4b2fe872261f7fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uxl6-r0-IDwZX3UihBN48A.jpeg"/></div></div></figure><p id="1f5e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我以前的文章中，我描述了两种类型的性能优化:<a class="ae ln" href="https://medium.com/p/128269484932" rel="noopener">宏和微优化</a>和<a class="ae ln" href="https://medium.com/p/7d5346313807" rel="noopener">提高性能所需的6个步骤</a>。该过程中的一个基本步骤是防止将来发生性能下降。在本帖中，我们将深入探讨这一重要步骤。</p><p id="09e7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您是否经常看到性能显著提高，但几个月或几年后，性能却比优化前更差？</p><p id="a752" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个团队通过实现一个新的缓存系统来改进系统。该团队将平均延迟从40毫秒提高到20毫秒，并添加了出色的仪表盘。两年后，延迟为50毫秒。是什么阻止了这种情况的发生？团队知道业绩比两年前差吗？他们知道添加的修复吗？大概不会。该团队可能是一个全新的团队，或者更糟，可能没有该区域的所有者。</p><p id="4af2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一个普遍的问题。作为开发人员，我们必须确保我们添加的措施不会降低性能。在这篇文章中，你会学到我们可以采取的措施来防止这种情况。我将使用Ruby中的例子，但这同样适用于大多数语言。</p><h1 id="1d9d" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated"><strong class="ak">衡量业绩</strong></h1><p id="af60" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">开发者应该知道区域/软件有多快(延迟)以及它能支持多少流量(吞吐量)。这可能需要监控跟踪应用程序，如Datadog、Rollbar、Splunk或Sentry。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/6fe2685f4df2ddb7169757e624d866c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PVlOxwk187kq3XAk0a1kOA.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">图一。产品API延迟的数据狗仪表板示例。</p></figure><p id="5663" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上图显示了个人项目API延迟的数据狗仪表板，特别是<em class="mq"> p50 </em>和<em class="mq"> p95 </em>。记住<a class="ae ln" href="https://medium.com/@magalhini/stop-using-averages-use-percentiles-instead-621598e6b53f" rel="noopener">千万不要用平均值；使用百分点</a>。</p><h1 id="6469" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated"><strong class="ak">添加监视器和警报</strong></h1><p id="05a3" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">仪表板是必不可少的，但有了显示器，它变得更有价值。当性能超过阈值或出现异常时，警报会通知开发人员。它可以通过电子邮件或slack提醒开发人员，如下例所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/681720039d3d3d57b734e387d95434ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Sck_tjMOR8M5cabntirhA.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">图二。Datadog警报已发送至Slack示例。</p></figure><p id="d190" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">向所有仪表板添加基线</strong>，以便开发人员了解预期的延迟窗口。</p><h1 id="1426" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated"><strong class="ak">测试是关键</strong></h1><p id="3721" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">每个性能优化变化都应该有测试。为了说明这一点，我们来看一些最常见的性能变化示例，以及我们可以采取的防止性能下降的措施:</p><p id="2e55" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">性能变化:减少了热路径函数的对象分配。</p><p id="bf4d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">测试:</strong>添加对对象的功能分配进行计数的测试，并将其与阈值进行比较。许多库提供测试助手。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">断言分配数量低于阈值的函数<em class="mu"> memory_allocations </em>的示例。</p></figure><p id="6cbe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">性能变化:减少了数据库查询的执行次数。</p><p id="3a9b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">测试:</strong>添加断言预期查询数量或查询本身的测试(小心<a class="ae ln" href="https://www.techtarget.com/whatis/definition/flaky-test" rel="noopener ugc nofollow" target="_blank">古怪测试</a>！)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">断言数据库查询执行次数的函数示例。</p></figure><p id="7fb9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">性能变化:使用了更好的数据库查询(例如，添加了一个<a class="ae ln" href="https://dev.mysql.com/doc/refman/8.0/en/index-hints.html" rel="noopener ugc nofollow" target="_blank">数据库索引提示)</a>。</p><p id="3660" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">测试:</strong>添加断言所执行查询的测试。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">使用断言MySQL数据库提示的测试示例。</p></figure><p id="d49c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">性能变化:通过批处理查询减少了对缓存的调用次数</p><p id="b6cc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">测试:</strong>添加测试，证明在单个缓存调用中使用多个键调用缓存。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">执行fetch_multi cache调用而不是单次提取的函数示例。</p></figure><p id="459e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">性能变化:通过引入缓存减少了数据库查询的数量。</p><p id="e25f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">测试:添加测试以证明何时存在缓存命中和/或未命中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">使用缓存而不是关系数据库的函数示例</p></figure><p id="e2b0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">性能变化:不要通过将负载推给后台作业来阻塞主线程。</p><p id="ce7d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> Test: </strong>添加一个单元测试，检查预期的任务是否排队。</p><p id="9284" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">性能变化:减少前端<a class="ae ln" href="https://blog.logrocket.com/slimming-down-your-bundle-size/" rel="noopener ugc nofollow" target="_blank">捆绑尺寸</a>:</p><p id="d656" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">测试:</strong>添加测量包大小的工具，并添加当大小大于基线时失败的测试。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/2cd9e59ad6fd6bf3d6783d38f7209b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vhw0E89cRunkYU40gTXy9g.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">使用<a class="ae ln" href="https://github.com/siddharthkp/bundlesize" rel="noopener ugc nofollow" target="_blank"> Bundlesize </a>库在Github上检查包大小。</p></figure><p id="5c32" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">性能变化:(前端)通过加载更少的数据/UI和引用查询来减少页面负载:</p><p id="4987" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">测试:</strong>添加单元测试，检查加载的DOM中的数据和对象。</p><p id="75a4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">性能变化:通过添加更多缓存提高了吞吐量:</p><p id="e932" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">测试:</strong>定期进行压力测试，确保测试数量与设定的基线相符。</p><h1 id="4e3e" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">结论</h1><p id="2616" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">始终添加措施以防止系统降级。确保您拥有具有预期性能的仪表板和正确的工具，并考虑添加测试。</p><p id="769a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">实施这些策略将节省您的时间，并确保永远达到绩效目标或相应地调整基线。如果没有防止性能下降的工具和措施，性能改进是不完整的。</p><p id="e8b3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢亚历克斯·瓦特和T2审阅这篇文章。</p></div></div>    
</body>
</html>