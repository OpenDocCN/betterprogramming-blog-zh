<html>
<head>
<title>Managing Configuration-Dependent Variables in iOS Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">管理iOS项目中的配置相关变量</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/managing-configuration-dependent-variables-in-ios-projects-b68bfb0f9689?source=collection_archive---------7-----------------------#2019-08-30">https://betterprogramming.pub/managing-configuration-dependent-variables-in-ios-projects-b68bfb0f9689?source=collection_archive---------7-----------------------#2019-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5ffb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Xcode设置的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/382a0f9d3a799096d65b71056258dae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TMM7BJOflHvgiU-eqXkLIg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://pixabay.com/pl/photos/komputer-komputery-1245714/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><p id="be32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如今，几乎每个应用程序都必须连接到某种后端服务，通常，这些服务部署在多个环境中。</p><p id="5465" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个典型的例子是开发/试运行/生产环境。开发环境用于日常部署和开发人员测试他们的代码。</p><p id="0a10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">登台环境用于测试人员和客户测试的稳定版本。我们都知道生产环境是干什么用的。</p><p id="b757" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将一步一步地介绍我认为在iOS应用中处理多种环境的最直接的方法。</p><p id="d3cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是该设置的高级概述:</p><ul class=""><li id="c536" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">为每个环境添加项目级配置。</li><li id="7b6e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">修改<code class="fe mj mk ml mm b">Info.plist</code>文件以包含一个在运行时将解析为活动配置名称的字段。</li><li id="33a2" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">使用<code class="fe mj mk ml mm b">Info.plist</code>文件中的活动配置，在运行时从配置文件中读取属性</li></ul></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="f772" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">1.为每个环境添加项目级配置</h1><p id="a470" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">首先，您需要将所有环境添加为项目级配置。你可以通过点击Xcode中的<em class="nr">项目</em> - &gt; <em class="nr">信息</em>标签来做到这一点(见下面截图)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/cbaa318f021a130871dbb9e46bd299b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ytMmIX1MjonWaRrxuqeLNQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">项目级配置示例</p></figure><p id="312c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您现在可以通过选择<em class="nr">构建方案</em>-&gt;-<em class="nr">构建配置</em>设置中的配置来选择运行时应该使用的配置。</p><p id="5b3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的示例中，运行构建时选择了<em class="nr">调试</em>配置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/e5e74d704e5793154c642e6e8c8ac57b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-fiLcdWm3tE5696DmGneeQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">构建方案</p></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="729f" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">2.修改Info.plist文件</h1><p id="70a0" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">好的，到目前为止我们做得很好，但是我们仍然不能做任何有用的事情。</p><p id="9e39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们不知道这款应用目前运行在什么配置下。为此，我们将修改<code class="fe mj mk ml mm b">Info.plist</code>文件，以包含当前活动的配置名称。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/0a96350f39fea94ee800654152a33ea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iS9MjTXPzZ9wbIAEw4P3gg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">信息列表</p></figure><p id="fff0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mj mk ml mm b">$(Configuration)</code>变量是一个特殊的环境变量，Xcode在编译项目时会将其解析为当前的配置名称。</p><p id="62d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着如果项目是在<em class="nr">调试</em>配置中编译的，那么<em class="nr">配置</em>属性下的值将是<em class="nr">调试</em>。<code class="fe mj mk ml mm b">Info.plist</code>文件是存储这些信息的好地方，因为我们可以在运行时轻松地检索这些信息:</p><pre class="kj kk kl km gt nv mm nw nx aw ny bi"><span id="2fec" class="nz mv it mm b gy oa ob l oc od">let activeConfigurationName = Bundle.main.object(forInfoDictionaryKey: “Configuration”) as? String</span></pre><p id="db94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码将从<code class="fe mj mk ml mm b">Info.plist</code>文件中获取活动的配置名，这样我们就可以在运行时使用它。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="0971" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">3.使用当前配置名称从配置文件中读取属性</h1><p id="bb37" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我们现在可以在运行时访问当前的配置名，并且可以使用它从配置文件中读取变量。</p><p id="feb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先定义一个类似如下的<code class="fe mj mk ml mm b">Configuration.plist</code>文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/021d62b70434f1f113a078ab7072e93b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXQqpMM3dzSX8PIQM3ws2A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">配置. plist</p></figure><p id="06cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，配置名称必须与我们在步骤1中定义的项目配置相同。</p><p id="289d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以在运行时使用活动的配置名称来访问该文件的属性:</p><pre class="kj kk kl km gt nv mm nw nx aw ny bi"><span id="4011" class="nz mv it mm b gy oa ob l oc od">let activeConfigurationName = Bundle.main.object(forInfoDictionaryKey: “Configuration”) as! String</span><span id="773c" class="nz mv it mm b gy of ob l oc od">let configurationFilePath = Bundle.main.path(forResource: "Configuration", ofType: "plist")!</span><span id="204b" class="nz mv it mm b gy of ob l oc od">let configurationDictionary = NSDictionary(contentsOfFile: configurationFilePath)!</span><span id="3bf4" class="nz mv it mm b gy of ob l oc od">let activeConfigurationDictionary = configurationDictionary[activeConfigurationName] as! NSDictionary</span><span id="3d8e" class="nz mv it mm b gy of ob l oc od">let backendUrl = activeConfigurationDictionary["backendUrl"] as! String</span></pre><p id="cc18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，我们现在可以检索当前活动配置的<code class="fe mj mk ml mm b">backendUrl</code>!</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="7000" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">摘要</h1><p id="d761" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">在本指南中，我们定义了不同的配置/环境，并进行额外的设置，以便能够在运行时获取它们。</p><p id="8fdd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，这个过程并不简单，但也不是很难。这是博客上通常推荐的设置。它有效…</p><p id="3832" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，它也不是非常安全，因为我们主要使用字符串API来获取属性，并且我们必须进行大量的强制解包或防范nils。</p><p id="790e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当以这种方式获取属性时，很多事情都可能出错:</p><ul class=""><li id="a8dd" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">如果我们在配置文件名中输入错误，应用程序将会崩溃。</li><li id="4a05" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如果配置文件的格式不正确，应用程序将会崩溃。</li><li id="3331" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如果我们在属性名称中输入错误，应用程序将会崩溃。</li><li id="0a24" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如果我们将属性转换为错误的类型，应用程序将会崩溃。</li><li id="cfae" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如果我们尝试获取文件中未定义的属性，应用程序将会崩溃。</li></ul><p id="c36b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些都发生在运行时，编译器无法防止任何错误。一定有更好的方法，对吗？</p><p id="4931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一篇文章中，我将介绍一个我自己编写的工具，该工具将自动完成所有这些设置，并生成一个Swift包装类，您可以使用该类通过autocomplete以类型安全的方式访问属性。敬请期待！</p></div></div>    
</body>
</html>