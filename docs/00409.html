<html>
<head>
<title>How to Setup Chart.js for React and Dynamically Allocate Colors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为React设置Chart.js并动态分配颜色</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-setup-chart-js-for-react-and-how-to-dynamically-allocate-colors-ae5faf7a45d3?source=collection_archive---------1-----------------------#2019-05-15">https://betterprogramming.pub/how-to-setup-chart-js-for-react-and-how-to-dynamically-allocate-colors-ae5faf7a45d3?source=collection_archive---------1-----------------------#2019-05-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/720ff285a8e99c4c2b0fa51889980502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6cPUAbfwiDUY61wKkwEYow.png"/></div></div></figure><div class=""/><div class=""><h2 id="c102" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">为什么应该使用Chart.js作为图表库——以及在使用时如何充分利用它</h2></div><p id="2007" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在这篇文章中，我将介绍:</p><ol class=""><li id="f807" class="lp lq je kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">为什么使用<a class="ae ly" href="https://www.chartjs.org" rel="noopener ugc nofollow" target="_blank"> Chart.js </a>对比竞争对手</li><li id="e8dd" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo lu lv lw lx bi translated">如何设置和安装Chart.js</li><li id="587d" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo lu lv lw lx bi translated">如何为Chart.js准备数据</li><li id="d028" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo lu lv lw lx bi translated">如何为您的饼图动态分配颜色</li></ol><h1 id="28e5" class="me mf je bd mg mh mi mj mk ml mm mn mo kk mp kl mq kn mr ko ms kq mt kr mu mv bi translated"><strong class="ak">为什么要用Chart.js？</strong></h1><p id="6b8e" class="pw-post-body-paragraph kt ku je kv b kw mw kf ky kz mx ki lb lc my le lf lg mz li lj lk na lm ln lo im bi translated">说到图表库，你有很多选择。我选择了<a class="ae ly" href="https://www.chartjs.org/" rel="noopener ugc nofollow" target="_blank"> Chart.js </a>，因为它拥有我需要的所有特性，是最流行的图表库，更新频繁，并且对React有很好的支持。如果你不确定该如何选择，我强烈推荐<a class="ae ly" href="https://blog.sicara.com/compare-best-javascript-chart-libraries-2017-89fbe8cb112d" rel="noopener ugc nofollow" target="_blank">这篇博客文章</a>，它以出色的视觉效果综合了不同图表库的主要优缺点。</p><figure class="nc nd ne nf gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nb"><img src="../Images/dc70c2b304c6e682ecaf5b0bef78314a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H4sdWTf2T4qzIfGj73-5Yw.png"/></div></div><p class="ng nh gj gh gi ni nj bd b be z dk translated"><a class="ae ly" href="https://blog.sicara.com/compare-best-javascript-chart-libraries-2017-89fbe8cb112d" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><h1 id="7c2f" class="me mf je bd mg mh mi mj mk ml mm mn mo kk mp kl mq kn mr ko ms kq mt kr mu mv bi translated">如何在React中使用Chart.js</h1><p id="3c96" class="pw-post-body-paragraph kt ku je kv b kw mw kf ky kz mx ki lb lc my le lf lg mz li lj lk na lm ln lo im bi translated">如果你还没有建立Chart.js，我推荐你跟随这篇文章来完成这个过程。简而言之:</p><ul class=""><li id="8508" class="lp lq je kv b kw kx kz la lc lr lg ls lk lt lo nk lv lw lx bi translated">安装库</li></ul><pre class="nc nd ne nf gt nl nm nn no aw np bi"><span id="b392" class="nq mf je nm b gy nr ns l nt nu">npm install react-chartjs-2 chart.js --save</span><span id="77c2" class="nq mf je nm b gy nv ns l nt nu">// OR</span><span id="e376" class="nq mf je nm b gy nv ns l nt nu">yarn add react-chartjs-2 chart.js</span></pre><ul class=""><li id="ba4b" class="lp lq je kv b kw kx kz la lc lr lg ls lk lt lo nk lv lw lx bi translated">导入和使用您想要的任何图表:</li></ul><pre class="nc nd ne nf gt nl nm nn no aw np bi"><span id="ba2b" class="nq mf je nm b gy nr ns l nt nu">import {Bar} from 'react-chartjs-2';<br/><br/>&lt; Bar data={...} /&gt;</span></pre><h1 id="b93f" class="me mf je bd mg mh mi mj mk ml mm mn mo kk mp kl mq kn mr ko ms kq mt kr mu mv bi translated"><strong class="ak">如何准备你的资料</strong></h1><p id="60f4" class="pw-post-body-paragraph kt ku je kv b kw mw kf ky kz mx ki lb lc my le lf lg mz li lj lk na lm ln lo im bi translated">注意到<code class="fe nw nx ny nm b">data={...}</code>了吗？我们需要为Chart.js准备数据。</p><p id="b75d" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">根据文档，Chartjs希望您的数据如下所示:</p><pre class="nc nd ne nf gt nl nm nn no aw np bi"><span id="80ba" class="nq mf je nm b gy nr ns l nt nu">data = {<br/>  labels: ["January", "February", "March", "April", "May", "June", "July"],<br/>  datasets: [{<br/>    label: "My First dataset",<br/>    backgroundColor: 'rgb(255, 99, 132)',<br/>    borderColor: 'rgb(255, 99, 132)',<br/>    data: [0, 10, 5, 2, 20, 30, 45],<br/>  }]<br/>}</span></pre><ul class=""><li id="2aa2" class="lp lq je kv b kw kx kz la lc lr lg ls lk lt lo nk lv lw lx bi translated"><code class="fe nw nx ny nm b">labels</code>将成为你的X轴标签</li><li id="e389" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo nk lv lw lx bi translated"><code class="fe nw nx ny nm b">datasets</code>是一组物体；Chart.js可以同时显示多个数据集</li><li id="d169" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo nk lv lw lx bi translated"><code class="fe nw nx ny nm b">label</code>是每个数据集的标签</li><li id="a054" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo nk lv lw lx bi translated"><code class="fe nw nx ny nm b">borderColor</code>通常是单一颜色</li><li id="8e27" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo nk lv lw lx bi translated"><code class="fe nw nx ny nm b">backgroundColor</code>可以是单个数据集的单色条形图或折线图。然而，对于包含多个数据集的饼图或折线图，你需要一组颜色。稍后将详细介绍。</li><li id="499c" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo nk lv lw lx bi translated"><code class="fe nw nx ny nm b">data</code>必须是一维数组</li></ul><p id="fa67" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">如果您从REST API获得JSON响应，或者从GraphQL端点获得一个对象数组，那么您将需要操作您的数据以获得一个整数的1D数组。</p><p id="55af" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">虽然在vanilla JS中可能，但我建议安装<code class="fe nw nx ny nm b">lodash</code>以使您的代码在数据操作方面更简洁，使用:</p><pre class="nc nd ne nf gt nl nm nn no aw np bi"><span id="7458" class="nq mf je nm b gy nr ns l nt nu">npm install lodash --save<br/>// OR<br/>yarn add lodash</span></pre><p id="1fb4" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">然后，您可以导入任何您想在React组件文件顶部使用的<code class="fe nw nx ny nm b">lodash</code>函数，如下所示:</p><p id="d7be" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe nw nx ny nm b">import { groupBy, intersection } from lodash;</code></p><p id="9bd8" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">因此，您的最终代码可能如下所示:</p><figure class="nc nd ne nf gt iv"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="5e2b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">嘣！我们在渲染一张图表！它看起来像这样(但是标签在下面，标题在上面):</p><figure class="nc nd ne nf gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/205d8981f40fa27cb0fb4746016d969c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gimnxM0hltKC0lMd6y7r9g.png"/></div></div></figure><h2 id="d041" class="nq mf je bd mg od oe dn mk of og dp mo lc oh oi mq lg oj ok ms lk ol om mu on bi translated">但是如果我们想要建立一个饼图呢？我们不希望馅饼的每一片都使用相同的颜色。</h2></div><div class="ab cl oo op hx oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="im in io ip iq"><h1 id="4103" class="me mf je bd mg mh ov mj mk ml ow mn mo kk ox kl mq kn oy ko ms kq oz kr mu mv bi translated">如何为包含多个数据集的饼图或折线图动态分配颜色</h1><p id="b8bb" class="pw-post-body-paragraph kt ku je kv b kw mw kf ky kz mx ki lb lc my le lf lg mz li lj lk na lm ln lo im bi translated">以下是我为饼图分配颜色的要求:</p><ul class=""><li id="39f4" class="lp lq je kv b kw kx kz la lc lr lg ls lk lt lo nk lv lw lx bi translated">一次仅显示一个图表(用户将使用按钮来选择他们想要查看的图表)</li><li id="ae81" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo nk lv lw lx bi translated">分配给每个标签的颜色需要在不同的图表中保持一致。例如，“未知”在每个图表中需要是相同的颜色。</li><li id="de7f" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo nk lv lw lx bi translated">颜色可以跨图表重复使用，用于该图表的唯一标签，从而避免了使用大量唯一颜色的必要性。</li></ul><p id="6f91" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我用几种不同的数据结构解决了这个问题，我将在下面解释原因:</p><figure class="nc nd ne nf gt iv"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h2 id="5d33" class="nq mf je bd mg od oe dn mk of og dp mo lc oh oi mq lg oj ok ms lk ol om mu on bi translated">使用了什么类型的数据结构，为什么？</h2><ul class=""><li id="5820" class="lp lq je kv b kw mw kz mx lc pa lg pb lk pc lo nk lv lw lx bi translated"><code class="fe nw nx ny nm b">labelColors</code>和<code class="fe nw nx ny nm b">usedColors</code>都是字典，所以我们不用遍历列表就可以快速查找标签的颜色</li><li id="3791" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo nk lv lw lx bi translated"><code class="fe nw nx ny nm b">usedKeys</code>是一个数组，它是<code class="fe nw nx ny nm b">labelColors</code>和<code class="fe nw nx ny nm b">labels</code>的交集——它表示当前图表中已经使用的颜色列表</li><li id="b44c" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo nk lv lw lx bi translated"><code class="fe nw nx ny nm b">COLORS</code>是一个数组，因为颜色列表保持相同的顺序很重要，所以我们避免检查相同的颜色是否已经使用了多次。</li><li id="593c" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo nk lv lw lx bi translated"><code class="fe nw nx ny nm b">firstAvailColor</code>是一个整数，它代表<code class="fe nw nx ny nm b">COLORS</code>中的第一个索引，当我们遍历在<code class="fe nw nx ny nm b">labelColors</code>中还没有分配颜色的标签时，我们将在这里寻找一个新的颜色</li><li id="43a3" class="lp lq je kv b kw lz kz ma lc mb lg mc lk md lo nk lv lw lx bi translated"><code class="fe nw nx ny nm b">chartColors</code>是一个数组，因为它需要与<code class="fe nw nx ny nm b">labels</code>的顺序相同，对应于其中存储的每种颜色。这是我们准备发送到Chart.js</li></ul><p id="a17c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在，您将获得标签在各报告中一致的图表，并重新使用当前报告中未分配的颜色。</p><p id="974a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">例如，您的饼图可能看起来像这样(但是每种颜色都有一个图表标题和标签，我已经裁剪掉了):</p><figure class="nc nd ne nf gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pd"><img src="../Images/2b8df2dbff2f8f8ba8af6daca4714669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JmuNY41-eLNQaKhHul0tFQ.png"/></div></div></figure><figure class="nc nd ne nf gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pe"><img src="../Images/552dde8ba98349bb35614d7c8e623240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v8rHKthtYgdXO__0zIy0gw.png"/></div></div></figure></div><div class="ab cl oo op hx oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="im in io ip iq"><p id="1b93" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">今天到此为止！希望这对你有帮助。如果您有任何问题或反馈，请随时在下面发布。</p></div></div>    
</body>
</html>