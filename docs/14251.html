<html>
<head>
<title>The Swap File Trick</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">交换文件的把戏</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-swap-file-trick-39651253001c?source=collection_archive---------17-----------------------#2022-11-21">https://betterprogramming.pub/the-swap-file-trick-39651253001c?source=collection_archive---------17-----------------------#2022-11-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b94d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用一种变通方法在Ghost上建立和运行我的网站</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6acec556ac88af918325581f034f037e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9WvEqNMQPUxMRNwR"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">约纳坦·萨维德拉·佩拉斯在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="0de5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“嘿，看看我做了什么！”我得意洋洋地对一个朋友说，“它上线了。打开链接就行了！”。我为我的工作感到骄傲。经过几个晚上的疯狂工作，我终于完成了我的小项目，我准备向全世界展示它。</p><p id="bd09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“可我什么也没看见！”我的第一个用户回复，透露出一丝怀疑。"屏幕一片空白。"我吓坏了。我感到被背叛和脆弱。仅仅几个小时后，我那令人惊叹的个人网站就已经关闭了，我不知道为什么。这是我无法忍受的情况。</p><p id="215b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的<a class="ae kv" href="https://blog.lorisocchipinti.com" rel="noopener ugc nofollow" target="_blank">个人博客</a>由Ghost管理，这是一个开源的内容创建平台。我想要一个自托管的解决方案，所以我实例化了一个只有1GB内存的小型EC2实例(是的，它包含在AWS免费层中，是的，我是一个小气鬼),并在其上建立了我的博客。我发表了一些帖子，在埃菲尔铁塔下给自己拍了一张漂亮的照片，准备主宰博客世界。我一点也不知道我的小网站会在几个小时内关闭。</p><h1 id="ddfc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">捉鬼</h1><p id="2e31" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在盛怒之下，我重启了EC2实例，很快，我又可以向我的朋友们展示我的网站了。然而，这个问题被证明是一个特别棘手的问题:就像一个淘气的恶作剧鬼，有东西在我的(虚拟)家里捣乱，每隔几个小时就制造麻烦。但是谁是罪魁祸首呢？当然，流量高峰不在考虑范围之内:没有人知道这个网站，而且这个页面还没有被编入索引。根据AWS控制台，CPU使用率似乎相当稳定，我也有一个轻松的信用余额。此时最合理的结论是Ghost出于某种原因耗尽了内存。</p><p id="2e8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在很多博客帖子和用户群中四处搜索，我发现了一些有趣的东西。一些用户注意到Ghost可以在1GB内存上运行，但是，有时它会窒息而死。原因还不清楚(有人归咎于Node.js内存泄漏，图片我很惊讶)。就我而言，我不打算改变实例类型来改善它的规格，也不特别倾向于深入探讨这个问题。</p><p id="b2a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我立刻有了一种直觉。我冲进EC2控制台，我证实了我的预感:我只有1GB的内存，但我坐在8GB的SSD上。“嗯，”我想，“可能默认的<em class="mp">交换</em>分区太小了。让我们看看。”</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="9457" class="mv lt iq mr b be mw mx l my mz">$ free -m<br/>               total    used    free <br/>Mem:             941    870     71</span></pre><p id="b5e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">没错。对于精通技术的读者来说，没有在虚拟机中定义交换分区可能并不奇怪。收集了这些信息后，我就能做出决定了。</p><h1 id="2263" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">奇妙的东西以及在哪里可以找到它们</h1><p id="49fa" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">首先，我将使用<code class="fe na nb nc mr b">dd</code>命令创建一个交换文件(也被友好地称为<code class="fe na nb nc mr b">data destroyer</code>):</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="1af6" class="mv lt iq mr b be mw mx l my mz">sudo dd if=/dev/zero of=/swapfile bs=128M count=8</span></pre><p id="f3d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过选择八个大小为128MB的块，此时我将拥有1GB的额外内存供我使用。现在，让我们为交换文件设置适当的读写权限:</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="84d1" class="mv lt iq mr b be mw mx l my mz">$ sudo chmod 600 /swapfile</span></pre><p id="9dae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有必要告诉Linux也创建一个交换区:</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="9cc4" class="mv lt iq mr b be mw mx l my mz">$ sudo mkswap /swapfile</span></pre><p id="31f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我可以启用交换文件:</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="e14f" class="mv lt iq mr b be mw mx l my mz">$ sudo swapon /swapfile</span></pre><p id="8b1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行完这些命令后，我觉得我的虚拟机内存如此之大:</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="74c6" class="mv lt iq mr b be mw mx l my mz">$ free -m<br/>               total    used    free <br/>Mem:             941     411     530 <br/>Swap:           1023     491     532</span></pre><p id="243d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望我的实例记住我在启动时创建和使用交换文件的决定。为了指示它这样做，有必要在<code class="fe na nb nc mr b">/etc/fstab</code>文件中添加下面一行:</p><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="8124" class="mv lt iq mr b be mw mx l my mz"># /etc/fstab <br/>/swapfile swap swap defaults 0 0</span></pre><p id="3639" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有人可能会说，依赖交换文件是一种廉价的解决方法。对我来说，这更像是现实生活中的欺骗代码。</p><h1 id="a403" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">参考</h1><ul class=""><li id="d117" class="nd ne iq ky b kz mk lc ml lf nf lj ng ln nh lr ni nj nk nl bi translated"><a class="ae kv" href="https://askubuntu.com/questions/508870/what-is-a-swap-area" rel="noopener ugc nofollow" target="_blank">什么是“交换区”？关于askubuntu.com话题的一个极好的帖子</a></li><li id="1808" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated"><a class="ae kv" href="https://aws.amazon.com/premiumsupport/knowledge-center/ec2-memory-swap-file/" rel="noopener ugc nofollow" target="_blank">如何在EC2中分配内存作为交换空间</a></li></ul></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><pre class="kg kh ki kj gt mq mr ms bn mt mu bi"><span id="f54f" class="mv lt iq mr b be mw mx l ny mz"><strong class="mr ir">Want to Connect?</strong><br/><br/><a class="ae kv" href="https://blog.lorisocchipinti.com" rel="noopener ugc nofollow" target="_blank">Join my newsletter for more stories like this</a></span></pre></div></div>    
</body>
</html>