<html>
<head>
<title>How to Automate Golang Delivery With Buddy CI/CD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Buddy CI/CD自动交付Golang</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-automate-golang-delivery-with-buddy-ci-cd-b9dfb8fd60b6?source=collection_archive---------7-----------------------#2020-10-22">https://betterprogramming.pub/how-to-automate-golang-delivery-with-buddy-ci-cd-b9dfb8fd60b6?source=collection_archive---------7-----------------------#2020-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7de5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更快的CI/CD</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ca4a016394273511f2ffa20a2a334775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FzseURrgi4-IHOsj.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><p id="8022" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae lu" href="https://buddy.works/?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=gabrieltanner_rp&amp;utm_content=golang" rel="noopener ugc nofollow" target="_blank"> Buddy </a>是一个持续集成、交付和部署工具，它利用Git在设置管道以自动化您的存储库任务时提供舒适和可定制的体验。</p><p id="245c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">巴迪的<a class="ae lu" href="https://buddy.works/docs/pipelines/introduction?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=gabrieltanner_rp&amp;utm_content=golang" rel="noopener ugc nofollow" target="_blank">管道</a>由开发者定义的一组动作组成，这些动作以特定的顺序运行，在执行Git推送时可以手动或自动执行。这种可视化方法也使得初学者和DevOps专家能够在尽可能短的时间内轻松建立起功能齐全的管道。</p><p id="b64d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我们将为Golang应用程序建立一个连续的交付管道。管道将帮助我们实现两件事:</p><ol class=""><li id="128b" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">通过提供标准化的开发反馈循环，加快开发过程</li><li id="67d4" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">通过降低手动错误的风险，实现更安全的部署</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/5fd37511ca0d410de64d2577472a3768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KmRWCTVXEfdSNec9.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">成品管道</p></figure><p id="e06e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将通过构建一个管道来实现这一点，该管道首先测试应用程序，然后构建一个Docker容器映像(如果测试成功的话)。Docker图像随后将被拉出并在数字海洋水滴上运行。我们还将通过Slack和电子邮件向项目成员发送最新构建状态的通知。</p><p id="dabc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本指南中使用的操作:</p><ul class=""><li id="cfd3" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt mk mb mc md bi translated"><a class="ae lu" href="https://buddy.works/actions/go?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=gabrieltanner_rp&amp;utm_content=golang" rel="noopener ugc nofollow" target="_blank">出发</a></li><li id="1df1" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mk mb mc md bi translated"><a class="ae lu" href="https://buddy.works/actions/sftp?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=gabrieltanner_rp&amp;utm_content=golang" rel="noopener ugc nofollow" target="_blank"> SFTP </a></li><li id="a3ff" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mk mb mc md bi translated"><a class="ae lu" href="https://buddy.works/actions/ssh?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=gabrieltanner_rp&amp;utm_content=golang" rel="noopener ugc nofollow" target="_blank">宋承宪</a></li><li id="105e" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mk mb mc md bi translated"><a class="ae lu" href="https://buddy.works/actions/slack?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=gabrieltanner_rp&amp;utm_content=golang" rel="noopener ugc nofollow" target="_blank">松弛</a></li><li id="a0a0" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mk mb mc md bi translated"><a class="ae lu" href="https://buddy.works/actions/email?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=gabrieltanner_rp&amp;utm_content=golang" rel="noopener ugc nofollow" target="_blank">电子邮件</a></li></ul></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="7970" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">第一步。开始</h1><p id="c710" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">要遵循本教程，请确保您安装了以下工具:</p><ol class=""><li id="012c" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><a class="ae lu" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Golang </a> —这样您就可以在本地运行和测试应用程序。</li><li id="3d16" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><a class="ae lu" href="https://github.com/digitalocean/doctl" rel="noopener ugc nofollow" target="_blank"> DigitalOcean CLI </a> —以便您可以设置管道所需的所有数字海洋资源(也可以使用GUI完成)。</li><li id="2394" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><a class="ae lu" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">Docker</a>——安装在本地开发者机器上，用于封装和运行我们的应用程序。</li></ol><h2 id="8105" class="np mt it bd mu nq nr dn my ns nt dp nc lh nu nv ne ll nw nx ng lp ny nz ni oa bi translated">测试应用程序</h2><p id="ffa1" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">在本文中，我们将使用GitHub 上的一个<a class="ae lu" href="https://github.com/buddy-works/learning-go/tree/master/beginner-programs/HttpServer" rel="noopener ugc nofollow" target="_blank">现有项目，这样更容易理解本文。该应用程序是一个非常基本的HTTP服务器，使用标准的Golang库，带有两个GET端点，显示一些硬编码的文本。</a></p><p id="5b46" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您想使用自己的应用程序，这是可以的，但是请记住，操作中的一些命令和目录可能会发生变化。</p><p id="cb6b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们从从GitHub克隆应用程序并在本地运行它开始:</p><pre class="kj kk kl km gt of oe og oh aw oi bi"><span id="cacb" class="np mt it oe b gy oj ok l ol om">$ git clone https://github.com/buddy-works/learning-go.git <br/>$ cd learning-go/beginner-programs/HttpServer/</span></pre><p id="1eb9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在可以使用<code class="fe ob oc od oe b">go run</code>命令启动应用程序:</p><pre class="kj kk kl km gt of oe og oh aw oi bi"><span id="e784" class="np mt it oe b gy oj ok l ol om">$ git run main.go</span></pre><p id="d527" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在您可以在<code class="fe ob oc od oe b">localhost:8080</code>访问该应用程序。您应该看到一个基本的网页打印“Hello World！”</p><h2 id="2a7e" class="np mt it bd mu nq nr dn my ns nt dp nc lh nu nv ne ll nw nx ng lp ny nz ni oa bi translated">将申请归档</h2><p id="3e77" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">要将应用程序部署为容器，我们需要创建一个Docker文件，其中包含Docker映像的定义。</p><p id="9908" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我已经将Dockerfile包含在了<code class="fe ob oc od oe b">HttpServer</code>项目的根目录中。以下是内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="3869" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">文件中的每一行都相当于构建Docker映像过程中的一个步骤。为了更好地理解，我们来看一下:</p><ul class=""><li id="a4bb" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt mk mb mc md bi translated">第一行使用<code class="fe ob oc od oe b">FROM</code>关键字定义了容器启动的基础映像，后面是所需的映像和版本(在本例中是Golang官方映像的版本1.15.0)。</li><li id="0a23" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mk mb mc md bi translated">之后，我们使用<code class="fe ob oc od oe b">WORKDIR</code>关键字设置当前工作目录，并通过将<code class="fe ob oc od oe b">GO111MODULE</code>变量设置为<code class="fe ob oc od oe b">on</code>来启用Go模块。</li><li id="5da6" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mk mb mc md bi translated">关键字<code class="fe ob oc od oe b">COPY</code>让我们将文件从主机系统复制到容器中。这里我们用它将<code class="fe ob oc od oe b">go.mod</code>和<code class="fe ob oc od oe b">go.sum</code>文件复制到容器中，这样我们就可以使用<code class="fe ob oc od oe b">go mod download</code>命令安装所有需要的依赖项。</li><li id="0308" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mk mb mc md bi translated">安装完所有的依赖项后，我们可以继续将剩余的文件复制到容器中，并使用<code class="fe ob oc od oe b">go build</code>命令构建应用程序。这将给我们一个可执行文件，我们可以使用<code class="fe ob oc od oe b">CMD</code>关键字来执行。</li></ul><h2 id="4f45" class="np mt it bd mu nq nr dn my ns nt dp nc lh nu nv ne ll nw nx ng lp ny nz ni oa bi translated">启动Docker映像</h2><p id="f3e6" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">现在可以使用以下命令构建并运行Docker映像:</p><pre class="kj kk kl km gt of oe og oh aw oi bi"><span id="1edb" class="np mt it oe b gy oj ok l ol om">$ docker build -t httpserver . <br/>$ docker run -p 8080:8080 httpserver</span></pre><p id="4128" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ob oc od oe b">build</code>命令将通过执行我们在Docker文件中定义的步骤来创建Docker映像。<code class="fe ob oc od oe b">-t</code>标志用于给Docker图像一个特定的标签。一旦成功构建了映像，就可以使用run命令来启动容器。<code class="fe ob oc od oe b">-p</code>标志用于将容器的端口8080发布到主机的端口8080。在浏览器中打开<code class="fe ob oc od oe b">http://localhost:8080</code>，验证应用程序是否正常运行。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="9b9f" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">第二步。建立数字海洋资源</h1><p id="e631" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">在我们开始构建CI/CD管道之前，让我们从设置所需的数字海洋资源和安装必要的工具开始。为了创建资源，我们将使用DigitalOcean CLI，也称为<a class="ae lu" href="https://github.com/digitalocean/doctl/releases" rel="noopener ugc nofollow" target="_blank"> doctl </a>。</p><p id="dc7d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">启动一个终端，如果还没有的话，用<code class="fe ob oc od oe b">doctl auth init</code>命令向CLI验证自己。</p><p id="e0ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用下面的命令创建一个droplet来托管我们的应用程序。我们使用DigitaloOean Docker映像，因为我们将在教程的最后一步使用Docker部署应用程序。</p><pre class="kj kk kl km gt of oe og oh aw oi bi"><span id="52e9" class="np mt it oe b gy oj ok l ol om">$ doctl compute droplet create buddy-golang --region fra1 --image docker-18-04 --size s-1vcpu-2gb</span></pre><p id="6065" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过检查当前状态，等待液滴准备就绪:</p><pre class="kj kk kl km gt of oe og oh aw oi bi"><span id="a8f0" class="np mt it oe b gy oj ok l ol om">$ doctl compute droplet list buddy-golang</span></pre><p id="c504" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">随着droplet的创建，是时候在系统上安装Golang了。为此，您可以遵循来自DigitalOcean的<a class="ae lu" href="https://www.digitalocean.com/community/tutorials/how-to-install-go-on-ubuntu-18-04" rel="noopener ugc nofollow" target="_blank">安装指南</a>。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="483e" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">第三步。持续集成管道</h1><p id="96f0" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">既然我们已经设置好了所有的资源，现在是时候创建一个管道，每当我们对代码库进行更改时，它将自动测试、构建和部署我们的应用程序。</p><h2 id="2536" class="np mt it bd mu nq nr dn my ns nt dp nc lh nu nv ne ll nw nx ng lp ny nz ni oa bi translated">项目配置</h2><p id="5d27" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated"><a class="ae lu" href="https://buddy.works/?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=gabrieltanner_rp&amp;utm_content=golang" rel="noopener ugc nofollow" target="_blank">登录您的好友帐户</a>并创建一个新项目，在该项目中，您选择GitHub作为Git托管提供商，并选择learning-go作为存储库:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/24d8311460d6c568495fb010581c2e58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bdgkWghyZ0Sn7mZJ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Buddy中创建新项目</p></figure><h2 id="39a6" class="np mt it bd mu nq nr dn my ns nt dp nc lh nu nv ne ll nw nx ng lp ny nz ni oa bi translated">管道配置</h2><p id="aa17" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">向项目中添加一个新管道，并将触发器设置为<code class="fe ob oc od oe b">On push</code>，以便在有东西被推送到GitHub存储库时执行管道。第二步是选择Buddy将要部署的分支。说到名称，您可以随意称呼管道:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/7313d2222612dfadb7b6a051d8425c26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oH6Myvtm96OQmhYh.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Buddy中创建新管道</p></figure><p id="a4c0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在下一个屏幕上，您可以选择将添加到管道中的第一个操作。因为我们有一个用Go编写的应用程序，并且希望使用Golang工具测试和构建它，所以我们需要添加Go操作:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/95e8eb44ba6ec9328c04755daa615381.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EYemTKCfzN7owwCM.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将Golang操作添加到好友管道</p></figure><p id="a532" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在操作详细信息中添加以下命令:</p><pre class="kj kk kl km gt of oe og oh aw oi bi"><span id="d05c" class="np mt it oe b gy oj ok l ol om"># Download dependencies <br/>go mod download </span><span id="b700" class="np mt it oe b gy op ok l ol om"># Execute Golang test files <br/>go test ./... -v</span></pre><p id="2482" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是它的实际情况:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/f089bd14c48c4aa0ad295d2c0e630f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2M0oDEXGMa_5wZNj.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">配置Golang命令</p></figure><p id="f265" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们浏览一下这些命令:</p><ul class=""><li id="d0bd" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt mk mb mc md bi translated"><code class="fe ob oc od oe b">go mod download</code>命令用于安装应用程序所需的所有依赖项。</li><li id="44ca" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mk mb mc md bi translated"><code class="fe ob oc od oe b">go test ./... -v</code>命令运行目录中所有的Golang测试并打印结果。<code class="fe ob oc od oe b">-v</code>标志，也称为<em class="oq"> verbose </em>，用于打印更详细的测试结果，使它们在失败时更容易调试。</li></ul><p id="acbd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，你需要在<code class="fe ob oc od oe b">cache</code>窗口中选择动作的工作目录。如果您正在使用示例应用程序，这需要是<code class="fe ob oc od oe b">/src/github.com/TannerGabriel/learning-go/beginner-programs/HttpServer</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/f418cfdd124f7a6cb32d631fcc7275fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_J5kCXP-VviQgG5Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">戈朗行动工作指导</p></figure><p id="1a6c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们需要将动作使用的Golang版本从当前标准值更改为<code class="fe ob oc od oe b">1.15.0</code>，因为Golang模块在旧版本(版本1.11及以下)中不受支持:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/8622aa995904f701c026ed725037db33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OrEoUjsVHxnu16wb.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在动作细节中更改Golang版本</p></figure><h2 id="7d20" class="np mt it bd mu nq nr dn my ns nt dp nc lh nu nv ne ll nw nx ng lp ny nz ni oa bi translated">测试管道</h2><p id="df93" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">完成Golang操作的配置后，您可以通过手动单击屏幕右上角的“运行管道”按钮来测试管道。然后，您可以单击管道查看执行细节:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/38b7252ea03003bfbfbf3ab650b3c4d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zQBxqAEmLOtFs-dr.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">运行测试管道</p></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="aaed" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">第四步。连续输送管道</h1><p id="4635" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">既然测试已经成功运行，是时候在我们的DigitalOcean droplet上构建和部署应用程序了。因为我们希望使用Docker部署我们的应用程序，所以在我们的droplet上使用它之前，我们首先需要构建图像并将其推送到某种容器注册表中。</p><h2 id="5ced" class="np mt it bd mu nq nr dn my ns nt dp nc lh nu nv ne ll nw nx ng lp ny nz ni oa bi translated">构建应用程序</h2><p id="f2c5" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">在这一步中，我们将构建应用程序的Docker映像，并将其推送到容器注册中心。我们将使用Docker Hub作为注册表，因为它是最受欢迎的，可以免费用于公共图像(加上一个私人图像是免费的)。</p><p id="8aa1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意:请随意使用另一个公共注册表或您自己的私有注册表。如果你想知道如何从头开始创建自己的私有注册表，你可以遵循<a class="ae lu" href="https://gabrieltanner.org/blog/docker-registry" rel="noopener ugc nofollow" target="_blank">这个指南</a>。</p><p id="ee03" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先从动作花名册的Docker部分添加构建图像动作:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/936bf0d44071851633dec239c48c00a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*34E1wKTcl-aWIuuO.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">向管道添加构建映像操作</p></figure><p id="0b65" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们需要选择Dockerfile作为我们图像的基础，以及执行构建命令的上下文。在这里，我们选择项目的目录:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/67ef609a0060c8c417789423e10cded7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DxohLaHo48KU6dEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为Docker构建操作配置目录</p></figure><p id="6e68" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，您只需要选择一个注册表，并在选项窗口中提供将映像推送到您的帐户所需的凭据。您还可以设置图像的存储库和标签:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/b09adcd04a8b65a2fdcc342768d8c049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7BaoIWFXb2Ojl7kj.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为Docker图像选择注册表</p></figure><h2 id="d590" class="np mt it bd mu nq nr dn my ns nt dp nc lh nu nv ne ll nw nx ng lp ny nz ni oa bi translated">运行Docker映像</h2><p id="726e" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">下一步是在我们的数字海洋液滴上部署和运行图像。目前还没有官方的好友动作，所以我们将使用SSH动作:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/e2994f994a605d866a321c16b9a59bf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i-rCfvNDtwYFZO17.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将SSH操作添加到好友管道</p></figure><p id="1bbc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将动作添加到管道后，我们需要配置它以匹配我们的droplet设置:</p><ul class=""><li id="e94b" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt mk mb mc md bi translated">将认证模式设置为<code class="fe ob oc od oe b">Password</code>(如果使用SSH密钥，则选择<code class="fe ob oc od oe b">Private SSH key</code>或<code class="fe ob oc od oe b">Buddy workspace key</code>)</li><li id="2f12" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mk mb mc md bi translated">填写用于登录服务器的IP地址、用户名和密码</li></ul><p id="0b7c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，将以下命令添加到操作详细信息中:</p><pre class="kj kk kl km gt of oe og oh aw oi bi"><span id="6523" class="np mt it oe b gy oj ok l ol om"># Pull Docker image <br/>docker pull gabrieltanner/golang-http-server:latest </span><span id="ecec" class="np mt it oe b gy op ok l ol om"># Stop and remove the container if it already exists <br/>docker stop http-server || true &amp;&amp; docker rm http-server || true </span><span id="3894" class="np mt it oe b gy op ok l ol om"># Start the new container <br/>docker run -p 8080:8080 -d --name http-server gabrieltanner/golang-http-server</span></pre><p id="0d8b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们浏览一下这些命令:</p><ul class=""><li id="620e" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt mk mb mc md bi translated"><code class="fe ob oc od oe b">docker pull</code>命令用于从所选服务器上的容器注册表中提取我们的图像。</li><li id="7d5f" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mk mb mc md bi translated">第二个命令用于停止和删除现有的容器。需要这样做来将容器更新到新构建的映像版本。如果容器没有运行，这些命令将返回错误。这是预期的行为，所以我们需要使用<code class="fe ob oc od oe b">... || true</code>忽略它。</li><li id="cbfd" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt mk mb mc md bi translated"><code class="fe ob oc od oe b">docker run</code>命令启动容器，并使用<code class="fe ob oc od oe b">-p</code>标志向主机系统发布端口8080。</li></ul><p id="fa99" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正确配置的SSH操作如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/8289a42306c2efeb799ffdb826d65f2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sLn_3UxR-9pfMli-.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">SSH操作配置</p></figure><p id="404f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以使用<a class="ae lu" href="https://buddy.works/docs/pipelines/environment-variables?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=gabrieltanner_rp&amp;utm_content=golang" rel="noopener ugc nofollow" target="_blank">环境变量</a>来存储敏感数据，如登录和密码。</p><h2 id="1cfd" class="np mt it bd mu nq nr dn my ns nt dp nc lh nu nv ne ll nw nx ng lp ny nz ni oa bi translated">可选:等待批准</h2><p id="7306" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">在将新版本部署到生产服务器之前，您可以在流程中添加某种手动确认。这可以通过在您的管道中添加“等待批准”操作来实现:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/5e1fc60009497628785d266b4bd4a20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*efpXZgUxZKgIi-rm.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等待批准配置</p></figure><h2 id="9068" class="np mt it bd mu nq nr dn my ns nt dp nc lh nu nv ne ll nw nx ng lp ny nz ni oa bi translated">测试管道</h2><p id="53c5" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">一旦完成了对新添加的操作的配置，就应该重新运行管道来测试功能了。为此，您可以将一些更改推送到Git存储库，或者单击<code class="fe ob oc od oe b">Run pipeline</code>按钮来手动触发运行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/377e01a00ff49c9f251340bd36af503d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2I1Ab_hpGLsBw-pu.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">管道后期执行详细信息</p></figure><p id="fa5f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，您的Golang应用程序有了一个全功能的持续集成/部署管道。然而，在每次推送至所选分支时，您仍然可以添加一些有用的操作，以使您了解应用程序的当前构建状态。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="7361" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">第五步。(可选)发送成功或失败通知</h1><p id="a19f" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">在这一节中，我们将看看如何发送通知，让您和您的团队了解最新的构建状态。</p><p id="3133" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是发布本文时所有可用通知操作的列表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/5112d34d642716a56add238bcad03b34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gDvayofCwCaHLmx-.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通知操作</p></figure><p id="b2af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，我们将对失败的构建使用电子邮件操作，对成功的构建使用Slack操作，但是如果您不使用Slack，也可以使用不同的操作。</p><p id="07bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">成功构建的通知可以通过在管道底部添加另一个操作来发送，该操作只有在所有其他操作成功时才会执行。需要将故障通知操作添加到管道的<code class="fe ob oc od oe b">ACTIONS RUN ON FAILURE</code>部分。</p><p id="f48c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将操作添加到管道后，使用操作设置页面中的环境变量对其进行自定义。示例电子邮件配置可能如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/60cf636d5f8616b8ea6d875dd99bfcdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OiA0lEm3tM1K-qNl.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">电子邮件通知</p></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="a5c8" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">摘要</h1><p id="fa0f" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">你有它！您已经成功地为您的Golang应用程序设置了自己的CI/CD管道，每当您对Git存储库进行修改时，它会自动测试和部署您的应用程序，甚至向您和您的同事发送包含当前构建状态的通知。我建议你试试文章中显示的不同的<a class="ae lu" href="https://buddy.works/actions?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=gabrieltanner_rp&amp;utm_content=golang" rel="noopener ugc nofollow" target="_blank">好友动作</a>，并根据你的目的进一步定制设置。尽情享受吧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/756fbab19ad9b16bb884f550daebccf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wEhJiwMLRM_HgFjo.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">完整的Golang输送管道</p></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="b005" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读！如有疑问，欢迎留言评论。</p></div></div>    
</body>
</html>