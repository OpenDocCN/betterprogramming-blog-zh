<html>
<head>
<title>A Complete Pre-Commit Workflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">完整的提交前工作流</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-complete-pre-commit-workflow-cea6e34f0032?source=collection_archive---------11-----------------------#2019-08-21">https://betterprogramming.pub/a-complete-pre-commit-workflow-cea6e34f0032?source=collection_archive---------11-----------------------#2019-08-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f816" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Husky创建一个令人敬畏的git工作流</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/2a7695f8a4db3e37de6e43d44c349652.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*AxYei5T1-heT9sc3Hka3xA.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">使用Husky的Git挂钩实用指南</p></figure><h1 id="4ed2" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">这是怎么回事？</h1><p id="8da2" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我真的喜欢做出完美的提交，我尤其讨厌因为一个指导方针的错误而追加或创建一个新的提交。所以我需要一个工具，当我要犯错误的时候，它会对我吠叫。</p><p id="e33e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">互联网上到处都是解释<a class="ae mn" href="https://githooks.com/" rel="noopener ugc nofollow" target="_blank">什么是</a> <a class="ae mn" href="https://git-scm.com/book/uz/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank"> Git </a> <a class="ae mn" href="https://www.digitalocean.com/community/tutorials/how-to-use-git-hooks-to-automate-development-and-deployment-tasks" rel="noopener ugc nofollow" target="_blank">钩子</a> <a class="ae mn" href="https://hackernoon.com/automate-your-workflow-with-git-hooks-fef5d9b2a58c" rel="noopener ugc nofollow" target="_blank">是</a>的 <a class="ae mn" href="https://medium.com/the-andela-way/git-hooks-beautifully-automate-tasks-stages-bfb29f42fea1" rel="noopener">的教程，但是我仍然不得不花很多时间来为我的JavaScript应用程序构建一个良好的工作流，以便正确地使用它们。这是我今天在每个项目中使用的工具箱的概述。</a></p><p id="7917" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">第一个专注于工作流自动化的库是<a class="ae mn" href="https://github.com/typicode/husky" rel="noopener ugc nofollow" target="_blank">Husky</a>——因为一只对我吠叫的狗引起了我的注意。Husky是一个JavaScript库，它使Git挂钩变得更加容易。它提供了将它们直接集成到我们的JavaScript项目中的可能性，使我们不必在存储库初始化时处理启动指南或启动脚本。</p><p id="f061" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">用哈士奇真的很简单。我们只需要在<code class="fe mo mp mq mr b">package.json</code>文件中添加一个新的<code class="fe mo mp mq mr b">husky</code>键。这个新条目包含一个键/值对象，<code class="fe mo mp mq mr b">hooks</code>,它表示我们的Git挂钩，以及我们想要执行的脚本:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/e4575901d42043c048e90b887e213241.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JUYFGIOYiHTMvgPzLE72ig.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">这是一个非常简单的<code class="fe mo mp mq mr b">package.json</code>文件，带有husky钩子。为了简单起见，因为哈士奇版本可能会改变，它不包括<code class="fe mo mp mq mr b">devDependencies</code>。</p></figure></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="5456" class="ku kv it bd kw kx ne kz la lb nf ld le jz ng ka lg kc nh kd li kf ni kg lk ll bi translated">阐明我们的需求</h1><p id="4545" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">当我在React应用程序上工作时，我使用几个工具来保持一致的代码并简化团队工作:</p><ul class=""><li id="1afe" class="nj nk it lo b lp mi ls mj lv nl lz nm md nn mh no np nq nr bi translated">在JS、JSX、JSON、CSS和MD文件上，把我的代码格式化成开发者一致的东西。</li><li id="a0a4" class="nj nk it lo b lp ns ls nt lv nu lz nv md nw mh no np nq nr bi translated"><a class="ae mn" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> Eslint </a>，使用<a class="ae mn" href="https://github.com/airbnb/javascript/tree/master/packages/eslint-config-airbnb" rel="noopener ugc nofollow" target="_blank"> Airbnb配置</a>，在我的应用程序上提出一个健壮的林挺。然而，我用<code class="fe mo mp mq mr b"><a class="ae mn" href="https://github.com/prettier/eslint-config-prettier" rel="noopener ugc nofollow" target="_blank">eslint-config-prettier</a></code>优先考虑漂亮者的规则。</li><li id="6c7f" class="nj nk it lo b lp ns ls nt lv nu lz nv md nw mh no np nq nr bi translated">Jest ，用于我的应用程序单元测试。</li><li id="94ad" class="nj nk it lo b lp ns ls nt lv nu lz nv md nw mh no np nq nr bi translated">保持我的CSS模块干净。</li></ul><p id="fd95" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">不幸的是，对于每种类型的Git挂钩，Husky只支持一次执行一个命令。</p><p id="b44d" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我还必须检查每一个修改过的文件，以应用适当的工具，这是一项繁琐的工作。</p><p id="80ba" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">谢天谢地，已经有一个很棒的工具可以帮我做到这一点:<a class="ae mn" href="https://github.com/okonet/lint-staged" rel="noopener ugc nofollow" target="_blank"> lint-staged </a>。</p><p id="1a07" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">lint-staged非常棒，因为它只在修改过的文件上执行所需的脚本，这使得钩子运行得非常快。多亏了lint-staged，我们现在能够在增量提交阶段运行非常快速的工作流，因此大大减少了所有脚本的通常持续时间。</p><p id="e576" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">与Husky一样，lint-staged是我们的<code class="fe mo mp mq mr b">package.json</code>文件中的一个新的键/值对象，它表示要执行的脚本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/a2549ddc9c2a3918b00bccbf7a169912.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FsOI8QuZx28kau15BLGUkQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">和以前一样，我只包含了package.json文件中有趣的部分</p></figure><p id="e32c" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">现在，一切看起来都很简单。我只需要告诉Husky使用lint-staged，并告诉lint-staged我需要对我的文件做什么。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="4b7a" class="ku kv it bd kw kx ne kz la lb nf ld le jz ng ka lg kc nh kd li kf ni kg lk ll bi translated">最后的结果</h1><p id="d85b" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">综合起来，这就是我的<code class="fe mo mp mq mr b">package.json</code>文件的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">和以前一样，我只包含了package.json文件中有趣的部分</p></figure><p id="950d" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">当我提交时，我的钩子会做以下事情:</p><ul class=""><li id="a86f" class="nj nk it lo b lp mi ls mj lv nl lz nm md nn mh no np nq nr bi translated">对于我的<strong class="lo iu"> CSS </strong>文件，运行beautiful，然后运行Stylelint，然后将更新自动添加到Git暂存区。</li><li id="c4e7" class="nj nk it lo b lp ns ls nt lv nu lz nv md nw mh no np nq nr bi translated">对于我的<strong class="lo iu"> JS </strong>和<strong class="lo iu"> JSX </strong>文件，找到并执行与我的更改相关的测试，然后运行更漂亮的，接着是Eslint，最后自动将更新添加到Git staging区域。</li><li id="4817" class="nj nk it lo b lp ns ls nt lv nu lz nv md nw mh no np nq nr bi translated">对于我的<strong class="lo iu"> MD </strong>和<strong class="lo iu"> JSON </strong>文件，运行漂亮点，自动将更新添加到Git暂存区。</li></ul><p id="c8b9" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">现在我们在这里，不再扰乱我们的提交。💪</p><p id="abe6" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在提交之前，我们还可以做很多其他检查，我们还可以使用其他Git挂钩来改进版本控制系统工作流，我希望听到您的需求，我也希望看到您对我的工作流进行改进！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nz"><img src="../Images/22f47cf2a5518d35679e0d736207bc01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tohTAyB2gOTzOl8mmHm36Q.jpeg"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">提升到更健壮的开发工作流程。照片归功于我。</p></figure></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="cfd7" class="ku kv it bd kw kx ne kz la lb nf ld le jz ng ka lg kc nh kd li kf ni kg lk ll bi translated">奖金</h1><p id="96c9" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在写这篇文章的时候，我意识到我的样板应用程序是基于许多额外的脚本。这是我给自己的每个新项目添加的清单。注意这个例子应用于一个React应用程序，我使用<code class="fe mo mp mq mr b">yarn</code>作为包管理器。</p><p id="2434" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">因此，首先安装所需的软件包:</p><p id="575d" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><code class="fe mo mp mq mr b">yarn add --dev cross-env enzyme enzyme-adapter-react-16 eslint-config-airbnb eslint-config-prettier eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react eslint-plugin-react-hooks husky jest-enzyme lint-staged prettier stylelint stylelint-config-css-modules stylelint-config-prettier stylelint-config-recommended stylelint-order stylelint-prettier</code></p><p id="2e07" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">然后，添加配置文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="cff3" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们准备好了！</p></div></div>    
</body>
</html>