<html>
<head>
<title>iOS 14 UICollectionView — New Additions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 14 UICollectionView —新增内容</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/whats-new-in-ios-14s-uicollectionview-3c02b63f7a0f?source=collection_archive---------12-----------------------#2020-07-06">https://betterprogramming.pub/whats-new-in-ios-14s-uicollectionview-3c02b63f7a0f?source=collection_archive---------12-----------------------#2020-07-06</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="fe4b" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">对表视图列表的现成支持，一种新的单元格注册技术，以及DiffableDataSources中的增强功能</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/2fba7434688636778d10a8dd13ddd754.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jRbmEL5RFU6uwhCY"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@zhangkaiyv?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">张凯夫</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="3d29" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在WWDC 2020期间，收藏视图并没有完全进入SwiftUI，但这并没有阻止<code class="fe lw lx ly lz b">UICollectionView</code>接收一些强大的新更新。</p><p id="3e65" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">CompositionalLayouts</code>和<code class="fe lw lx ly lz b">DiffableDataSources</code>是在iOS 13 <code class="fe lw lx ly lz b">CollectionViews</code>中引入的，为我们的<code class="fe lw lx ly lz b">UICollectionView</code>带来了更多构建布局和数据源的灵活性。</p><p id="f073" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在iOS 14中，CollectionView APIs新增了三项功能，分别用于布局、数据源和单元格，这是构建集合视图的三大支柱:</p><ul class=""><li id="c2ce" class="ma mb iu lc b ld le lg lh lj mc ln md lr me lv mf mg mh mi bi translated"><code class="fe lw lx ly lz b">Lists</code>是<code class="fe lw lx ly lz b">CompositionalLayouts</code>的新成员，在<code class="fe lw lx ly lz b">CollectionViews</code>中带来了<code class="fe lw lx ly lz b">UITableView</code>般的外观。</li><li id="ba32" class="ma mb iu lc b ld mj lg mk lj ml ln mm lr mn lv mf mg mh mi bi translated"><code class="fe lw lx ly lz b">UICollectionView.CellRegistration</code>允许您使用新的配置API以完全不同的方式配置单元。此外，还有一个新的<code class="fe lw lx ly lz b">UICollectionViewListCell</code>具体类，默认为单元格提供类似列表的内容样式。</li><li id="066e" class="ma mb iu lc b ld mj lg mk lj ml ln mm lr mn lv mf mg mh mi bi translated">Diffable Data Source现在包括部分快照，允许在每个部分的基础上更新更多的数据。这在构建轮廓样式列表时很有用，这是iOS 14中引入的一种新的分层设计。</li></ul><p id="aaeb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在接下来的几节中，我们将讨论前两个新增内容。我们来看看如何用iOS 14的新方式在<code class="fe lw lx ly lz b">UICollectionView</code>中构造布局和单元格。</p></div><div class="ab cl mo mp hy mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="in io ip iq ir"><h1 id="7079" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">iOS 14单元配置和注册</h1><p id="fbef" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">iOS 14引入了全新的单元格配置API，用于配置我们的CollectionView和TableView单元格。</p><p id="f9e0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这意味着我们不需要像之前那样直接在<code class="fe lw lx ly lz b">UITableViewCell</code>和<code class="fe lw lx ly lz b">UICollectionViewCell</code>上设置属性。</p><p id="2420" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">新的配置API允许我们使用内容配置来设置单元格的内容和样式，或者根据不同的状态对其进行更新:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ns nt l"/></div></figure><p id="8758" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于<code class="fe lw lx ly lz b">UICollectionViews</code>，我们有了新的<code class="fe lw lx ly lz b">UICollectionViewListCell</code>。我们可以通过以下方式直接获取其默认配置:</p><pre class="kk kl km kn gu nu lz nv nw aw nx bi"><span id="9730" class="ny mw iu lz b gz nz oa l ob oc">var content = listCell.defaultContentConfiguration()</span></pre><p id="92a6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通过这样做，我们能够摆脱使用单元标识符和必须的<code class="fe lw lx ly lz b">if let</code>和<code class="fe lw lx ly lz b">guard let</code>语句来确保单元被注册。</p><p id="87b1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">更重要的是，我们不再直接访问单元格的label和image属性，这允许我们组合可以跨<code class="fe lw lx ly lz b">TableView</code>、<code class="fe lw lx ly lz b">CollectionView</code>和定制单元格使用的配置。</p><p id="b723" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">除了<code class="fe lw lx ly lz b">contentConfiguration</code>，还有一个<code class="fe lw lx ly lz b">backgroundConfiguration</code>，我们可以利用它来设置背景外观属性，还有一个<code class="fe lw lx ly lz b">leadingSwipeActionsConfiguration</code>和<code class="fe lw lx ly lz b">trailingSwipeActionsConfiguration</code>，可以轻松地将类似<code class="fe lw lx ly lz b">UITableView</code>的滑动行为直接嵌入到我们的<code class="fe lw lx ly lz b">UICollectionView</code>单元格实现中。</p><p id="c93c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们刚刚创建的新的<code class="fe lw lx ly lz b">UICollectionView.CellRegistration</code>结构在传递到<code class="fe lw lx ly lz b">dequeueConfiguredReusableCell</code>内部时会自动处理单元注册。您不再需要使用标识符注册单元格。</p></div><div class="ab cl mo mp hy mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="in io ip iq ir"><h1 id="6ca8" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">iOS 14集合视图的新列表布局</h1><p id="00ed" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">从我们在前一节讨论的<code class="fe lw lx ly lz b">UICollectionViewListCell</code>中得到启示，我们现在有了一个构建在复合布局之上的新列表布局。</p><p id="ae24" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">快速设置这个布局所需要的就是传入<code class="fe lw lx ly lz b">UICollectionViewListConfiguration</code>，除了下面的简单外观之外，它还可以设置为<code class="fe lw lx ly lz b">grouped</code>、<code class="fe lw lx ly lz b">insetGrouped</code>、<code class="fe lw lx ly lz b">sideBar</code>和<code class="fe lw lx ly lz b">sideBarPlain</code>:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ns nt l"/></div></figure><p id="7c65" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">UICollectionView</code>中新的<code class="fe lw lx ly lz b">Lists</code>支持的好处是它为自调整大小的单元格提供了开箱即用的支持。</p><p id="5c9e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们还可以通过在组合布局中传递<code class="fe lw lx ly lz b">NSCollectionSectionLayout.list</code>来创建基于每个部分的列表。</p><p id="bd72" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在<code class="fe lw lx ly lz b">UICollectionView</code>中为列表定制<code class="fe lw lx ly lz b">header</code>和<code class="fe lw lx ly lz b">footer</code>与我们在<code class="fe lw lx ly lz b">UITableView</code>中做的有点不同。</p><p id="89b2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您需要以如下方式调用列表配置中的<code class="fe lw lx ly lz b">headerMode</code>或<code class="fe lw lx ly lz b">footerMode</code>:</p><pre class="kk kl km kn gu nu lz nv nw aw nx bi"><span id="437e" class="ny mw iu lz b gz nz oa l ob oc">config.headerMode = .supplementary<br/>config.footerMode = .supplementary</span></pre><p id="2c62" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">随后，您需要通过调用Diffable数据源上的<code class="fe lw lx ly lz b">supplementaryViewProvider</code>来提供视图，其中您可以设置<code class="fe lw lx ly lz b">dequeueConfiguredReusableSupplementary</code>函数并传递头部配置。</p><p id="3ef9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在让我们结合上面的新特性(单元配置API、列表布局和注册)。</p><p id="4e1f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们已经在我们的<code class="fe lw lx ly lz b">UIViewController</code>中设置了一个简单的<code class="fe lw lx ly lz b">UICollectionView</code>，如下所示:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ns nt l"/></div></figure><p id="a151" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在模拟器中运行应用程序时，您会得到以下输出:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj od"><img src="../Images/8ea34f8f0032c65c6225eefd2e9471ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*04vnf9deKZj19HyLNR0ncw.png"/></div></div></figure></div><div class="ab cl mo mp hy mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="in io ip iq ir"><h1 id="e579" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">结论</h1><p id="2f11" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">总而言之:</p><ul class=""><li id="a4a0" class="ma mb iu lc b ld le lg lh lj mc ln md lr me lv mf mg mh mi bi translated">iOS 14引入了一种新的<code class="fe lw lx ly lz b">CellRegistration</code>技术，不需要使用蜂窝标识符进行注册。</li><li id="5d31" class="ma mb iu lc b ld mj lg mk lj ml ln mm lr mn lv mf mg mh mi bi translated">新的配置API封装了单元的内容和背景视图属性。<code class="fe lw lx ly lz b">UICollectionViewListCell</code>为我们提供了默认配置，可以根据状态进行设置和更新。</li><li id="96c3" class="ma mb iu lc b ld mj lg mk lj ml ln mm lr mn lv mf mg mh mi bi translated">像滑动动作和设置附件这样的定制现在可以在设置单元配置时直接完成，从而鼓励我们保持单一的真实来源。</li><li id="ad17" class="ma mb iu lc b ld mj lg mk lj ml ln mm lr mn lv mf mg mh mi bi translated"><code class="fe lw lx ly lz b">UICollectionView</code>的新列表与<code class="fe lw lx ly lz b">UITableView</code>相似，可以通过指定布局和配置(也可以基于每个部分)以及适当的页眉和页脚来轻松组合。</li></ul><p id="ea8e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们设法快速组合我们所学的东西，以声明的形式构建一个简单的<code class="fe lw lx ly lz b">UICollectionView</code>。是时候告别单元格项目标识符了。</p><p id="f2b6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在下一篇文章中，我们将了解iOS 14的不同数据源中的新特性。敬请关注，感谢阅读。</p></div></div>    
</body>
</html>