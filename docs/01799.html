<html>
<head>
<title>How to Handle Optionals in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Swift中处理期权</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-handle-optionals-in-swift-a5528ba28772?source=collection_archive---------17-----------------------#2019-10-14">https://betterprogramming.pub/how-to-handle-optionals-in-swift-a5528ba28772?source=collection_archive---------17-----------------------#2019-10-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="18e6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">修复了一个错误，当<em class="ki">展开一个可选值崩溃</em></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/eccca8a8a47cb5dd01119fb7e77ff130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uwnGkOoAry6IfJ8n"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@hannahjoshua?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">汉娜·约书亚</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ae78" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当我开始用Xcode开发iOS应用程序时，我经常遇到这个错误:</p><blockquote class="lw lx ly"><p id="c3b6" class="la lb lz lc b ld le ju lf lg lh jx li ma lk ll lm mb lo lp lq mc ls lt lu lv im bi translated"><strong class="lc iu">致命错误:展开可选值时意外发现零</strong></p></blockquote><p id="ab11" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这个致命的错误真的令人沮丧，阻碍了我学习Swift的进度。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="240f" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">什么是可选的，为什么它会导致我的应用程序崩溃？</h1><p id="6cad" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">简单地说，<code class="fe nh ni nj nk b">Optional</code>是在Swift中使用<code class="fe nh ni nj nk b">nil</code>值的一种方式。<code class="fe nh ni nj nk b">nil</code>什么都不是，不同于零(<code class="fe nh ni nj nk b">0</code>)或空字符串(<code class="fe nh ni nj nk b">""</code>)。这可以用下图来解释。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/948335c175335c3241cde7ee83ed2dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*YIC6Wg6l4pMCAkM19c2_rA.jpeg"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">null和nil是一样的</p></figure><p id="215e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">空辊仍然是一个值<code class="fe nh ni nj nk b">0</code>，但是辊原来所在的位置是空的或者没有值。<code class="fe nh ni nj nk b">Null</code>或<code class="fe nh ni nj nk b">nil</code>为空点。</p><p id="580b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为什么你希望你的应用程序中有一个<code class="fe nh ni nj nk b">nil</code>值？有时这是不可避免的，而其他时候你会故意想要一个空位。例如，一个社交媒体应用程序用户可能不选择在他们的个人资料上显示他们的生日，所以当他们的个人资料被加载时，<code class="fe nh ni nj nk b">Date</code>值可能是可选的。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="94ab" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">简单的例子</h1><p id="f8df" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">这很简单<code class="fe nh ni nj nk b">UIViewController</code>在中间有一个标签。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nm"><img src="../Images/a6c6972ba22d16818f11d7f7ad6ae72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXXMEg5hRv1W1c56uIROtQ.png"/></div></div></figure><p id="858e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">三秒钟后<code class="fe nh ni nj nk b">viewDidLoad</code>被调用，<code class="fe nh ni nj nk b">label</code>的文本被更新为变量<code class="fe nh ni nj nk b">nilOptionalValue</code>，应用程序崩溃并出现以下错误:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nn"><img src="../Images/f7fa1e9c4d964692a0271bd9fb94c269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mf5BzD_iVO466mWoQsCqHA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">致命错误:展开可选值时意外发现零</p></figure><p id="a414" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这里发生了什么事？</p><ul class=""><li id="79f3" class="no np it lc b ld le lg lh lj nq ln nr lr ns lv nt nu nv nw bi translated">变量<code class="fe nh ni nj nk b">nilOptionalValue</code>是用类型<code class="fe nh ni nj nk b">Optional&lt;String&gt;</code>创建的。它的值为<code class="fe nh ni nj nk b">nil</code>，什么都没有，等于零。</li><li id="3400" class="no np it lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated">当稍后在<code class="fe nh ni nj nk b">updateLabelStringToNil()</code>功能中使用时，通过使用<code class="fe nh ni nj nk b">nilOptionalValue<strong class="lc iu">!</strong></code>中的<code class="fe nh ni nj nk b">!</code>将其“展开”</li><li id="b616" class="no np it lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated">找不到值，应用程序崩溃。</li></ul><p id="a701" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe nh ni nj nk b">!</code>是对编译器的承诺。它说，<em class="lz">“这个值是可选的，但是我知道那里有一个值，我想使用它。”</em> <strong class="lc iu"> </strong>当你违背诺言，系统找不到一个价值，它不知道如何处理，它崩溃了。</p><p id="3602" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为什么叫解包？这是我开始时感到困惑的事情。这是因为<code class="fe nh ni nj nk b">Optional</code>是Swift中的一个通用类型，它包装了另一个像<code class="fe nh ni nj nk b">String</code>一样的值。</p><pre class="kk kl km kn gt oc nk od oe aw of bi"><span id="1999" class="og ml it nk b gy oh oi l oj ok">var labelString: Optional&lt;String&gt;</span><span id="d0f3" class="og ml it nk b gy ol oi l oj ok">// same thing as </span><span id="89b2" class="og ml it nk b gy ol oi l oj ok">var labelString: String?</span></pre><p id="349a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">每当你在像<code class="fe nh ni nj nk b">String</code>这样的类型后面使用<code class="fe nh ni nj nk b">?</code>时，你都是在用一个可选的。</p><p id="1525" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">那么变量名后面的<code class="fe nh ni nj nk b">!</code>呢？</p><pre class="kk kl km kn gt oc nk od oe aw of bi"><span id="be66" class="og ml it nk b gy oh oi l oj ok">var labelString: String! </span></pre><p id="bacf" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这被称为隐式展开。这是对编译器的承诺，变量<code class="fe nh ni nj nk b">labelString</code>没有值，但在你使用它之前会有。因此，你可以像对待任何其他的<code class="fe nh ni nj nk b"><strong class="lc iu">String</strong></code>一样对待它，而不需要以后打开它。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="0b02" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">好的，但是你如何解决这个致命的错误呢？</h1><p id="d266" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">有许多方法可以解决这个问题。下面列举几个。</p><h2 id="38e8" class="og ml it bd mm om on dn mq oo op dp mu lj oq or mw ln os ot my lr ou ov na ow bi translated">1.通过用非可选值初始化变量来避免<code class="fe nh ni nj nk b">Optional</code>值</h2><pre class="kk kl km kn gt oc nk od oe aw of bi"><span id="287c" class="og ml it nk b gy oh oi l oj ok">var labelString: String = "I am a non optional String"</span><span id="0a27" class="og ml it nk b gy ol oi l oj ok">// same as writing </span><span id="cfdc" class="og ml it nk b gy ol oi l oj ok">var labelString = "I am a non optional String"</span></pre><p id="46bb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这样，变量将总是有一个值。稍后，您可以使用预期的值来更新变量，例如，从异步网络请求返回的用户名。</p><p id="81ad" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您也可以用空值初始化它:</p><pre class="kk kl km kn gt oc nk od oe aw of bi"><span id="abbc" class="og ml it nk b gy oh oi l oj ok">// Empty string value<br/>var labelString = ""</span><span id="9529" class="og ml it nk b gy ol oi l oj ok">// empty string array value<br/>var labelStrings: [String] = []</span><span id="5273" class="og ml it nk b gy ol oi l oj ok">// empty Int value<br/>var numberOfLabels = 0</span></pre><p id="960b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然而，我不建议这样做，因为它可能会产生难以调试的意想不到的后果。例如，如果<code class="fe nh ni nj nk b">labelString</code>是一个空字符串，并且在标签中使用之前没有更新，标签就不会出现，因为它的文本是空的。这可能会导致很多混乱，浪费调试时间。</p><h2 id="0f40" class="og ml it bd mm om on dn mq oo op dp mu lj oq or mw ln os ot my lr ou ov na ow bi translated">2.将变量初始化为可选变量，检查它是否有值——如果它确实使用它</h2><pre class="kk kl km kn gt oc nk od oe aw of bi"><span id="54c8" class="og ml it nk b gy oh oi l oj ok">var labelString: String?</span><span id="6f21" class="og ml it nk b gy ol oi l oj ok">// same as</span><span id="de22" class="og ml it nk b gy ol oi l oj ok">var labelString: String? = nil</span></pre><p id="9818" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">上面的<code class="fe nh ni nj nk b">labelString</code>变量是一个<code class="fe nh ni nj nk b">Optional&lt;String&gt;</code>，你可以用一个<code class="fe nh ni nj nk b">if let</code>语句安全地解开<code class="fe nh ni nj nk b">labelString</code>。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ox"><img src="../Images/e65a730f472ebd9d6f9004680854293c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l4baAuLeU6YrgDUQDux-iw.png"/></div></div></figure><p id="483b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果<code class="fe nh ni nj nk b">labelString</code>为<code class="fe nh ni nj nk b">nil</code>，则无任何反应。</p><p id="27c2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">也可以用<code class="fe nh ni nj nk b">guard let</code>。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oy"><img src="../Images/6d8cff7f86737950457ec1dbb1c091e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZeBf-ny6NtDSg-LRDVpo2A.png"/></div></div></figure><h2 id="24f5" class="og ml it bd mm om on dn mq oo op dp mu lj oq or mw ln os ot my lr ou ov na ow bi translated"><strong class="ak"> 3。使用零聚结</strong></h2><p id="726a" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">零合并为可选项增加了一个后备值。<code class="fe nh ni nj nk b">??</code>是修复<code class="fe nh ni nj nk b">fatal error</code>崩溃的最简单和最安全的方法之一，但是，同样，代价是可能会增加以后花费在调试上的时间。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oz"><img src="../Images/2c74e0611646d44d68a49b626eefb6df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jg9BBqRbD_55Z2uzHHnIiw.png"/></div></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="44e6" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">结论</h1><p id="16a0" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated">还有许多其他方法来处理期权。希望这能给你足够的上下文来修复崩溃的错误并打开你的进程，但是你不应该就此打住。继续重构，查看下面的参考资料来加强你对Swift语言的理解。</p><h2 id="7b50" class="og ml it bd mm om on dn mq oo op dp mu lj oq or mw ln os ot my lr ou ov na ow bi translated">资源</h2><p id="7ba7" class="pw-post-body-paragraph la lb it lc b ld nc ju lf lg nd jx li lj ne ll lm ln nf lp lq lr ng lt lu lv im bi translated"><a class="ae kz" href="https://developer.apple.com/documentation/swift/optional" rel="noopener ugc nofollow" target="_blank">苹果可选文档</a></p><p id="5f0b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae kz" href="https://hackernoon.com/swift-optionals-explained-simply-e109a4297298" rel="noopener ugc nofollow" target="_blank">简单解释了Swift期权</a></p></div></div>    
</body>
</html>