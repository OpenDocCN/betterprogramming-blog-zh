<html>
<head>
<title>How to Create a Python Script to Automatically Monitor Prices Online</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建一个Python脚本来自动监控在线价格</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-a-python-script-to-automatically-monitor-prices-online-e7addd12548?source=collection_archive---------6-----------------------#2022-06-03">https://betterprogramming.pub/how-to-create-a-python-script-to-automatically-monitor-prices-online-e7addd12548?source=collection_archive---------6-----------------------#2022-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ba3d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个建立你自己的网页抓取器的指南，创建一个历史价格的数据库，和一个电子邮件通知系统——并设置它自动运行。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/1c896a8d9734e54ef7607a3b1d3ab07c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*nUu6-PUbRRhp3Juvxptk0g.jpeg"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">在<a class="ae kr" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kr" href="https://unsplash.com/@enginakyurt" rel="noopener ugc nofollow" target="_blank"> Engina Kyurt </a>拍摄的照片</p></figure><p id="3eff" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现代世界充满了定价算法，这些算法无时无刻不在改变着商品的价格。通过建立一个工具来监控这些价格，你可以领先一步，并对做出明智的大采购决策充满信心。此外，我们将在这里创建的片段也可以适用于所有其他类型的项目。让我们开始吧。</p><p id="b292" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">就我而言，我想关注一下来自covery的播客广告的<a class="ae kr" href="https://overcast.fm/ads" rel="noopener ugc nofollow" target="_blank">价格(一个为其他播客出售横幅广告以帮助增加受众的播客应用)。这是页面顶部的样子:</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lo"><img src="../Images/f2eb296de686af84e14b11e4704ce2fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e8Vb3PKDxBcaHHz9sresqA.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">阴的广告页</p></figure><p id="f8ed" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">重要的是，他们每天在格林威治时间午夜根据广告购买量和未售出量来更新价格。我不知道我是否会为我的播客购买广告，与科幻作家交谈和评论书籍(<a class="ae kr" href="https://podcasts.apple.com/us/podcast/hugonauts-the-best-sci-fi-books-of-all-time/id1590777335" rel="noopener ugc nofollow" target="_blank"> The Hugonauts </a>)，但如果我买了，我肯定想低价购买！</p><p id="a999" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">所以，让我们来看看好东西——代码。我们将首先查看构建程序所需的所有代码，然后在最后，如何自动运行所有代码。</p><h1 id="0c07" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">导入我们的库:</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="a7f5" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如果您没有这些库，请确保在继续之前安装它们。</p><h1 id="9222" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">抓取网站:</h1><p id="7bb7" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">一般来说，下面的代码块做三件事:</p><ol class=""><li id="c463" class="ms mt iq ku b kv kw ky kz lb mu lf mv lj mw ln mx my mz na bi translated">使用请求从我们的目标网站抓取HTML</li><li id="8c01" class="ms mt iq ku b kv nb ky nc lb nd lf ne lj nf ln mx my mz na bi translated">使用漂亮的Soup从表格中提取列标题和数据行</li><li id="4815" class="ms mt iq ku b kv nb ky nc lb nd lf ne lj nf ln mx my mz na bi translated">将标题和数据行合并到一个python字典中(并添加一个时间戳，表示我们抓取数据的时间)</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="78b4" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">上面的代码将是这个程序中最不可概括的部分，因为每个网站的HTML都是不同的(除非你也想收集阴暗的数据)。然而，所有使用的工具和方法都可以在任何网站上使用——如果你感兴趣的网站上也有表格，不需要太多的改动。</p><h1 id="f39b" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">将我们的数据保存到本地SQL数据库:</h1><p id="400a" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">我使用我在我的机器上设置的Microsoft SQL本地数据库，但是你可以使用任何其他数据库、SQLite，或者甚至继续附加到本地csv，并使用它作为各种数据库(<a class="ae kr" href="https://medium.com/@brentgaisford/how-to-use-python-and-the-reddit-api-to-build-a-local-database-of-reddit-posts-and-comments-ca9f3843bfc2" rel="noopener">参见这里的前一篇文章中使用的CSV方法</a>)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="5df2" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">sqlalchemy的引擎参数需要更新以匹配您的SQL server设置。Google您的特定SQL server类型和“sqlalchemy engine ”,为您的特定服务器找到好的示例。</p><h1 id="ca54" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">总结我们的数据，并将其组织到电子邮件的正文中，让我们自己看到当前价格和历史价格</h1><p id="9667" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">拥有所有这些定价数据固然很好，但如果我们不使用这些数据，它并不能真正帮助我们做出更好的决策。因此，我们还会每天自动给自己发送一封电子邮件，向我们展示三个潜在类别(艺术、小说和科学)中我们可能想要购买广告的三样东西:</p><ol class=""><li id="75f5" class="ms mt iq ku b kv kw ky kz lb mu lf mv lj mw ln mx my mz na bi translated">今天的价格，以及最近9天的价格</li><li id="0e25" class="ms mt iq ku b kv nb ky nc lb nd lf ne lj nf ln mx my mz na bi translated">空前的低价</li><li id="704e" class="ms mt iq ku b kv nb ky nc lb nd lf ne lj nf ln mx my mz na bi translated">平均价格</li></ol><p id="696e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">下面是实现这一点的代码。因为我们对三个不同的类别做同样的事情，我们将首先定义函数，然后对三个类别中的每一个使用它们来组装我们的电子邮件。我们正在使用<code class="fe ng nh ni nj b">email.MIME</code>库来构建我们的电子邮件正文。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="8162" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">以下是我们的电子邮件到达收件箱时的内容(仅显示三天的数据，因为在撰写本文时，脚本仅运行了三天):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi nk"><img src="../Images/420f301df163e626456475a9ed4c6453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ycUb5kiN4DTmn4p-LSkgsQ.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">我们构建的自动化电子邮件的正文</p></figure><h1 id="2555" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">使用SMTP连接到我们的电子邮件服务器并发送邮件</h1><p id="530b" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">请注意，谷歌从<code class="fe ng nh ni nj b">5/30/2022</code>开始禁止SMTP通过Gmail发送电子邮件。为了弥补这一点，我设置了一个Hotmail帐户作为“发件人”电子邮件，它非常适合这些目的。</p><p id="16d3" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如果您使用Hotmail或outlook电子邮件地址，在添加您的电子邮件用户名和密码后，下面的代码将立即为您工作。如果您想使用不同的电子邮件提供商，请查找您的电子邮件提供商的SMTP设置，以找到您在下面的第一行代码<code class="fe ng nh ni nj b">smtplib</code>中需要的url和端口。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="aadc" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">注意except分支末尾的input行(“Enter any key to quit”)。这将保持我们的程序窗口打开，并等待我们的回应，如果电子邮件发送失败，一旦你设置了你的自动化，所以你可以看到任何错误信息产生。</p><h1 id="0bd2" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">我们有工作代码了！让我们把它打包，这样我们的计算机就可以自己运行它了。</h1><p id="4ce0" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">我使用的是Windows，所以下面的步骤是特定于Windows的。Mac用户，你的流量会略有不同——在你得到你的。py文件，您将使用Crontab来设置您的任务调度。以下是我们在Windows上的三个步骤:</p><ol class=""><li id="01d1" class="ms mt iq ku b kv kw ky kz lb mu lf mv lj mw ln mx my mz na bi translated">将您的代码保存在一个<code class="fe ng nh ni nj b">.py</code>文件中</li><li id="e821" class="ms mt iq ku b kv nb ky nc lb nd lf ne lj nf ln mx my mz na bi translated">创建一个. bat文件，该文件指导您的计算机打开python环境并执行。py脚本</li><li id="2671" class="ms mt iq ku b kv nb ky nc lb nd lf ne lj nf ln mx my mz na bi translated">使用计算机的任务计划程序运行。bat文件在您选择的时间表上</li></ol><p id="1c04" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">好吧…</p><h2 id="0813" class="nl lu iq bd lv nm nn dn lz no np dp md lb nq nr mf lf ns nt mh lj nu nv mj nw bi translated">步骤1 —制作<code class="fe ng nh ni nj b">.py</code>文件。</h2><p id="b519" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">要制作<code class="fe ng nh ni nj b">.py</code>，只需将您的工作代码(例如，上面的所有代码块)粘贴到文本编辑器文件中。然后将文件另存为<code class="fe ng nh ni nj b">yourfilename.py</code>。</p><p id="8c44" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">记下您保存文件的位置。您可以测试您的。py文件，方法是导航到保存它的目录并运行下面的代码。</p><p id="02ab" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如果它能工作并执行你的脚本，那么到目前为止一切顺利！</p><pre class="kg kh ki kj gt nx nj ny nz aw oa bi"><span id="0bf5" class="nl lu iq nj b gy ob oc l od oe">python your_file_name.py</span></pre><h2 id="f976" class="nl lu iq bd lv nm nn dn lz no np dp md lb nq nr mf lf ns nt mh lj nu nv mj nw bi translated">步骤2——的。蝙蝠文件</h2><p id="eb0f" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">你会在网上看到很多文章告诉你跳过这一步，直接将任务调度器指向<code class="fe ng nh ni nj b">.py</code>文件和<code class="fe ng nh ni nj b">python.exe</code>。不要这样做！</p><p id="5088" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">对于绝大多数Python用户来说，您的代码不会运行，因为您的代码不是使用基本的Python安装编写的——它是在Conda(或Anaconda)之上编写的，或者您已经pip了一堆新的库，或者您正在运行一个虚拟环境来处理您的库——如果没有指令，您的计算机将无法正确处理所有这些。这就是我们的。bat文件是给。</p><p id="0731" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如果Windows任务计划程序没有运行您的。py文件，下面是你需要做的。打开文本编辑器，打开一个干净的新文件，放入以下代码:</p><pre class="kg kh ki kj gt nx nj ny nz aw oa bi"><span id="784e" class="nl lu iq nj b gy ob oc l od oe"><a class="ae kr" href="http://twitter.com/echo" rel="noopener ugc nofollow" target="_blank">@echo</a> off<br/>call C:\Users\brent\miniconda3\condabin\activate.bat<br/>cd “D:\Brents_Files\Documents\Python\Monitoring_Overcast_ad_pricing”<br/>python overcast_price_monitor.py</span></pre><p id="3e52" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">呼叫线路告诉您的计算机使用什么环境来打开文件。在我的例子中，我使用的是Conda，而不是虚拟环境，所以我指向。激活Conda的bat文件。</p><p id="33be" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><code class="fe ng nh ni nj b">cd</code>行应该指向您保存的目录。py文件，调用python的最后一行也需要用您选择的文件名进行更新。</p><p id="58f7" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">用. bat结尾保存这个文本文件，就差不多完成了！要测试您的文件，双击<code class="fe ng nh ni nj b">.bat</code>文件，它应该会一直运行下去！</p><p id="56be" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如果失败，您需要在继续下一步之前进行调试。注意，如果双击它在文本编辑器中打开它，这并不意味着你的文件不起作用——这只是意味着你已经告诉你的计算机在文本编辑器中打开<code class="fe ng nh ni nj b">.bat</code>文件，而不是运行它们。您可以从您的终端执行您的<code class="fe ng nh ni nj b">.bat</code>文件来测试它。</p><h1 id="0cb5" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">设置任务自动化来循环运行我们的脚本</h1><p id="f966" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">我在Windows上，所以我将使用任务计划程序。对于Mac用户，您将改用Crontab。</p><p id="16c7" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">单击开始按钮并搜索“任务计划程序”:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi of"><img src="../Images/6e03bdcbb331b8c412d6eb267fbda2a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ZnLDAK4sGUPmdYrT5pvkQ.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">如何打开Windows任务计划程序</p></figure><p id="f939" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在，在右边的窗格中，点击“创建任务…”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/84b90a5250405ba3fe98d1a395c27206.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*HqXnBnAG_7niLmXFcBbRsg.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Windows任务计划程序创建任务</p></figure><p id="56c4" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">给你的任务命名，为你自己写一个描述——最重要的是选中“以最高权限运行”框！完成这些步骤后，转到触发器选项卡。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/d0d0e4e1394caf95ff98fa11b5768c57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*InTSj4T6mcm791w09KIc3Q.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Windows任务计划程序屏幕截图和说明</p></figure><p id="30e3" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在“触发器”选项卡上，点击“新建”并设置您希望任务运行的时间和频率。</p><p id="87b0" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">没有触发器页面的截图，因为它是不言自明的。接下来，点击“操作”选项卡。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/546cf20fd68d7217065516a346414a97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*A_s1OWap3GZ4RoLXbJdxgA.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Windows任务计划程序操作选项卡说明</p></figure><p id="65fb" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在“操作”选项卡上，单击“新建”。在出现的弹出窗口中，输入。bat文件，或者点击浏览并导航到。蝙蝠文件和点击确定。</p><p id="fcd8" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">然后，在“起始位置(可选)”字段中，输入包含。bat文件驻留。我知道这看起来有些重复，但Windows似乎两者都需要。</p><p id="4707" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">就是这样！永远不要再为网上购物付太多钱。</p><p id="b971" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">祝你们编码愉快。</p></div></div>    
</body>
</html>