<html>
<head>
<title>How To Build an Electron App With ReactJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用ReactJS构建一个电子App</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-build-an-electron-app-with-reactjs-488fdd532bd4?source=collection_archive---------4-----------------------#2019-10-02">https://betterprogramming.pub/how-to-build-an-electron-app-with-reactjs-488fdd532bd4?source=collection_archive---------4-----------------------#2019-10-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bba4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">没有太多样板文件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4eb8348875430b4b358655aa78c8ea5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-VMHH1n3OSHa6lsaeM_3w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@les_photos_de_raph?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">raphal Biscaldi</a>在<a class="ae ky" href="https://unsplash.com/s/photos/atom-electrons?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="9190" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你是第一次接触<a class="ae ky" href="https://electronjs.org/" rel="noopener ugc nofollow" target="_blank">电子</a>并且更喜欢使用<a class="ae ky" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> ReactJS </a>，你可能会在GitHub上偶然发现这个<a class="ae ky" href="https://github.com/electron-react-boilerplate/electron-react-boilerplate" rel="noopener ugc nofollow" target="_blank">样板</a>。</p><p id="536f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个样板很棒。然而，它包含了太多我不需要的花哨东西。如果你和我一样，我只是想把我的React项目放到电子版上，看看它是如何工作的。</p><p id="8ed1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想做到这一点，这里有几个要点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="43f0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">是否将电子与React应用程序结合起来？</h1><p id="b558" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您决定在CRA内部合并electron，您的项目看起来就像一个普通的React应用程序，其中<code class="fe mz na nb nc b">electron-starter.js</code>是Electron的入口点。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="cdf5" class="nh md it nc b gy ni nj l nk nl">├── Procfile<br/>├── package.json<br/>├── public<br/>│   ├── favicon.ico<br/>│   └── index.html<br/>└── src<br/>    ├── App.css<br/>    ├── App.js<br/>    ├── App.test.js<br/>    ├── electron-starter.js<br/>    ├── electron-wait-react.js<br/>    ├── index.css<br/>    ├── index.js<br/>    └── logo.svg</span></pre><p id="27d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果这是你正在寻找的，这里有一个完整的教程，教你怎么做:Christian Sepulveda的《<a class="ae ky" href="https://www.freecodecamp.org/news/building-an-electron-application-with-create-react-app-97945861647c/" rel="noopener ugc nofollow" target="_blank">用create-react-app </a>构建电子应用程序》。</p><p id="a382" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您正在将NodeJS应用程序迁移到Electron，并且希望将后端(现在是主流程代码)分开，您可以尝试这种结构。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="6266" class="nh md it nc b gy ni nj l nk nl">├── Procfile<br/>├── app<br/>│   ├── config<br/>│   ├── events<br/>│   ├── libs<br/>│   ├── models<br/>│   └── views<br/>│       ├── js<br/>│       │   └── preload.js<br/>│       └── react<br/>│           ├── README.md<br/>│           ├── build<br/>│           ├── package.json<br/>│           ├── public<br/>│           └── src<br/>├── assets<br/>│   └── icon.png<br/>├── electron-wait-react.js<br/>├── main.js<br/>└── package.json</span></pre><p id="4b0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，<code class="fe mz na nb nc b">main.js</code>将是入口点，电子的构建文件夹不会与CRA的构建文件夹冲突。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="55a2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置开发和生产环境</h1><p id="416b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">由于您不希望每次进行更改时都重新启动您的电子应用程序，因此您可以使用React的webpack-dev-server的URL来指定电子应用程序。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="cea7" class="nh md it nc b gy ni nj l nk nl">const { app, BrowserWindow } = require('electron');</span><span id="dcf9" class="nh md it nc b gy nm nj l nk nl">const path = require('path');</span><span id="975e" class="nh md it nc b gy nm nj l nk nl">const url = require('url');</span><span id="9b93" class="nh md it nc b gy nm nj l nk nl">let mainWindow</span><span id="bb70" class="nh md it nc b gy nm nj l nk nl">function createWindow () {</span><span id="94d7" class="nh md it nc b gy nm nj l nk nl">// Create the browser window.</span><span id="3346" class="nh md it nc b gy nm nj l nk nl">mainWindow = new BrowserWindow({</span><span id="33e4" class="nh md it nc b gy nm nj l nk nl">  width: 1024,</span><span id="c9f3" class="nh md it nc b gy nm nj l nk nl">  height: 728</span><span id="5e7d" class="nh md it nc b gy nm nj l nk nl">});</span><span id="2092" class="nh md it nc b gy nm nj l nk nl">const startUrl = process.env.ELECTRON_START_URL || url.format({</span><span id="c02e" class="nh md it nc b gy nm nj l nk nl">pathname: path.join(__dirname, 'app/views/react/build/index.html'),</span><span id="e78d" class="nh md it nc b gy nm nj l nk nl">protocol: 'file:',</span><span id="d5d1" class="nh md it nc b gy nm nj l nk nl">slashes: true</span><span id="9617" class="nh md it nc b gy nm nj l nk nl">});</span><span id="b43d" class="nh md it nc b gy nm nj l nk nl">mainWindow.loadURL(startUrl);</span></pre><p id="7d1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果有一个<code class="fe mz na nb nc b">ELECTRON_START_URL</code>作为环境变量，它将使用该URL而不是React的内置版本。</p><p id="4e17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢上面提到的Christian的教程，你也可以使用<a class="ae ky" href="https://www.npmjs.com/package/foreman" rel="noopener ugc nofollow" target="_blank"> Foreman </a>来管理和记录电子和反应。</p><p id="371a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是<code class="fe mz na nb nc b">Procfile</code>派上用场的地方。在您的<code class="fe mz na nb nc b">Procfile</code>中，添加运行React应用程序和Electron应用程序的npm脚本:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="fc58" class="nh md it nc b gy ni nj l nk nl">react: npm run react-start<br/>electron: npm run electron-start</span></pre><p id="51ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而大部分的神奇都发生在<code class="fe mz na nb nc b">package.json</code>。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="29bf" class="nh md it nc b gy ni nj l nk nl">{</span><span id="0433" class="nh md it nc b gy nm nj l nk nl">"main": "main.js",</span><span id="2408" class="nh md it nc b gy nm nj l nk nl">"scripts": {</span><span id="4507" class="nh md it nc b gy nm nj l nk nl">"start": "nf start -p 3000",</span><span id="da76" class="nh md it nc b gy nm nj l nk nl">"electron-start": "node electron-wait-react",</span><span id="9d12" class="nh md it nc b gy nm nj l nk nl">"react-start": "cd ./app/views/react &amp;&amp; react-scripts start"</span><span id="72bc" class="nh md it nc b gy nm nj l nk nl">},</span><span id="b7ff" class="nh md it nc b gy nm nj l nk nl">"devDependencies": {</span><span id="c90a" class="nh md it nc b gy nm nj l nk nl">"electron": "^6.0.9",</span><span id="3af2" class="nh md it nc b gy nm nj l nk nl">"electron-builder": "^21.2.0",</span><span id="8db9" class="nh md it nc b gy nm nj l nk nl">"foreman": "^3.0.1"</span><span id="1122" class="nh md it nc b gy nm nj l nk nl">},</span><span id="1353" class="nh md it nc b gy nm nj l nk nl">"directories": {</span><span id="9b2e" class="nh md it nc b gy nm nj l nk nl">"buildResources": "assets",</span><span id="bf3f" class="nh md it nc b gy nm nj l nk nl">"output": "release"</span><span id="142b" class="nh md it nc b gy nm nj l nk nl">}</span><span id="22f8" class="nh md it nc b gy nm nj l nk nl">}</span></pre><p id="b397" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您运行<code class="fe mz na nb nc b">npm start</code>时，它会在端口3000执行<code class="fe mz na nb nc b">Procfile</code>中的两个命令。</p><p id="8261" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能想知道，<code class="fe mz na nb nc b">electron-wait-react.js</code>是做什么的？</p><p id="99d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与Christian的版本类似，我做了一个小调整，以记录来自电子应用程序的消息。</p><p id="b2e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在启动电子应用程序之前，它会等待React的webpack-dev-server启动。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="892a" class="nh md it nc b gy ni nj l nk nl">const net = require('net');</span><span id="7aa9" class="nh md it nc b gy nm nj l nk nl">const port = process.env.PORT ? (process.env.PORT - 100) : 3000;</span><span id="4e10" class="nh md it nc b gy nm nj l nk nl">process.env.ELECTRON_START_URL = `http://localhost:${port}`;</span><span id="4fde" class="nh md it nc b gy nm nj l nk nl">const client = new net.Socket();</span><span id="9eb9" class="nh md it nc b gy nm nj l nk nl">let startedElectron = false;</span><span id="7f13" class="nh md it nc b gy nm nj l nk nl">const tryConnection = () =&gt; client.connect({port: port}, () =&gt; {</span><span id="ac56" class="nh md it nc b gy nm nj l nk nl"> client.end();</span><span id="225e" class="nh md it nc b gy nm nj l nk nl"> if(!startedElectron) {</span><span id="5992" class="nh md it nc b gy nm nj l nk nl">  console.log('starting electron');</span><span id="fce1" class="nh md it nc b gy nm nj l nk nl">  startedElectron = true;</span><span id="c914" class="nh md it nc b gy nm nj l nk nl"> const { spawn } = require('child_process');</span><span id="8b99" class="nh md it nc b gy nm nj l nk nl"> const ls = spawn('npm run electron', [], { shell: true });</span><span id="9b3e" class="nh md it nc b gy nm nj l nk nl"> ls.stdout.on('data', (data) =&gt; {</span><span id="0bac" class="nh md it nc b gy nm nj l nk nl">  console.log(`${data}`);</span><span id="b0b5" class="nh md it nc b gy nm nj l nk nl"> });</span><span id="3df3" class="nh md it nc b gy nm nj l nk nl"> ls.stderr.on('data', (data) =&gt; {</span><span id="7772" class="nh md it nc b gy nm nj l nk nl">  console.error(`err: ${data}`);<br/> });</span><span id="c9be" class="nh md it nc b gy nm nj l nk nl"> ls.on('close', (code) =&gt; {</span><span id="5467" class="nh md it nc b gy nm nj l nk nl">  console.log(`child process exited with code ${code}`);</span><span id="08ad" class="nh md it nc b gy nm nj l nk nl"> });</span><span id="7865" class="nh md it nc b gy nm nj l nk nl">}});</span><span id="7d51" class="nh md it nc b gy nm nj l nk nl">tryConnection();</span><span id="1d18" class="nh md it nc b gy nm nj l nk nl">client.on('error', (error) =&gt; {</span><span id="25b3" class="nh md it nc b gy nm nj l nk nl"> setTimeout(tryConnection, 1000);</span><span id="3c11" class="nh md it nc b gy nm nj l nk nl">});</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c102" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在React中设置主页<code class="fe mz na nb nc b">package.json</code></h1><p id="2a87" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您构建应用程序时看到一个空白页面，那是因为React找不到它的js和CSS文件。在你的React app的<code class="fe mz na nb nc b">package.json</code>中，一定要添加:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="3898" class="nh md it nc b gy ni nj l nk nl">"homepage": "./"</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="34d9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用节点集成</h1><p id="4f19" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最后，您已经在电子中运行了React，但是如果您想在React中使用电子模块，该怎么办呢？</p><p id="1769" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建窗口后，您可以在<code class="fe mz na nb nc b">webPreferences</code>中添加<code class="fe mz na nb nc b">nodeIntegration</code>。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="3d27" class="nh md it nc b gy ni nj l nk nl">mainWindow = new BrowserWindow({</span><span id="fbec" class="nh md it nc b gy nm nj l nk nl">  width: 1024,</span><span id="6b2f" class="nh md it nc b gy nm nj l nk nl">  height: 728,</span><span id="5db9" class="nh md it nc b gy nm nj l nk nl">  webPreferences: {</span><span id="2f2b" class="nh md it nc b gy nm nj l nk nl">   nodeIntegration: true,</span><span id="cda4" class="nh md it nc b gy nm nj l nk nl">   preload: path.join(__dirname, 'app/views/js/preload.js')</span><span id="4ff4" class="nh md it nc b gy nm nj l nk nl">  }</span><span id="991d" class="nh md it nc b gy nm nj l nk nl">});</span></pre><p id="7051" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在React应用程序中，您可以这样要求:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="1641" class="nh md it nc b gy ni nj l nk nl">const { ipcRenderer } = window.require("electron");</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3fdf" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">其他潜在问题</h1><p id="f9d0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">React app禁止访问src以外的文件。我在网上找到的大多数解决方案都涉及到弹出React应用程序并在webpack中禁用该规则。</p><p id="d8a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是在我们的用例中，我们只需要在React中显示图像，所以我们将图像存储为base64格式来绕过这个问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d14a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="20c0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">感谢那些创建了电子教程和帖子的人。你的贡献让学习电子变得不那么令人畏惧。</p></div></div>    
</body>
</html>