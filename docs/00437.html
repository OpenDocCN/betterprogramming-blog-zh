<html>
<head>
<title>Managing Cookies in Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Django中管理Cookies</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/managing-cookies-in-django-34981d9bf0ae?source=collection_archive---------2-----------------------#2019-05-21">https://betterprogramming.pub/managing-cookies-in-django-34981d9bf0ae?source=collection_archive---------2-----------------------#2019-05-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c588" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过示例了解Django cookies</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4fdbb62b860e074225ef7caafdac2b41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1OY34DujBdc9i5FaAnEdCA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约翰·黄在<a class="ae ky" href="https://unsplash.com/s/photos/jar?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="709c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">HTTP是一种无状态协议，因此当请求发送到服务器时，它不知道您是第一次请求该页面，还是您是以前多次访问过该页面的同一用户。</p><p id="da9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种HTTP无状态对于电子商务网站开发人员来说是一个问题，因为请求之间的持久性可以用来推荐产品或在购物车中显示产品。为了满足这种需要，cookie应运而生。</p><p id="528d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">cookie是存储在用户浏览器中的一小段数据，由服务器发送。它们通常用于存储用户偏好。</p><p id="52ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，cookies是这样工作的:</p><ol class=""><li id="7215" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">浏览器向服务器发送请求。</li><li id="b3e7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">服务器将响应连同一个或多个cookies一起发送给浏览器。</li><li id="9e8a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">浏览器保存它从服务器收到的cookie。从现在开始，每次向服务器发出请求时，浏览器都会将这个cookie发送到服务器，直到cookie过期。</li><li id="fd0f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">当cookie过期时，它将从浏览器中删除。</li></ol></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="06df" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">使用Cookies</h1><p id="8630" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated"><a class="ae ky" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a> <code class="fe nn no np nq b">HttpResponse</code>对象有一个<code class="fe nn no np nq b">set_cookie()</code>方法。</p><p id="da61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">语法为:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="c6ce" class="nv mr it nq b gy nw nx l ny nz">set_cookie(<em class="oa">key</em>, <em class="oa">value=''</em>, <em class="oa">max_age=None</em>, <em class="oa">expires=None</em>, <em class="oa">path='/'</em>, <em class="oa">domain=None</em>, <em class="oa">secure=None</em>, <em class="oa">httponly=False</em>, <em class="oa">samesite=None</em>) :</span></pre><ol class=""><li id="9328" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe nn no np nq b">name</code>:曲奇的名字。</li><li id="8201" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nn no np nq b">value</code>:要存储在cookie中的值。您可以设置int或string，但它将返回string。</li><li id="9abe" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nn no np nq b">max_age</code>:应该是秒数，或者<code class="fe nn no np nq b">None</code>(默认)，如果cookie应该只持续客户端的浏览器会话。如果没有指定<code class="fe nn no np nq b">expires</code>，将被计算。</li><li id="037f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nn no np nq b">expires</code>:应该是格式为<code class="fe nn no np nq b">"Wdy, DD-Mon-YY HH:MM:SS GMT"</code>的字符串或者是UTC格式的<code class="fe nn no np nq b">datetime.datetime</code>对象。如果<code class="fe nn no np nq b">expires</code>是<code class="fe nn no np nq b">datetime</code>对象，则<code class="fe nn no np nq b">max_age</code>将被计算。</li></ol><p id="2850" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查<a class="ae ky" href="https://docs.djangoproject.com/en/2.2/ref/request-response/#django.http.HttpResponse.set_cookie" rel="noopener ugc nofollow" target="_blank"> Django文档</a>中的完整方法定义。</p><p id="33e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个Django <code class="fe nn no np nq b">request</code>对象都有一个<code class="fe nn no np nq b">COOKIES</code>属性，这是一个字典。我们可以使用<code class="fe nn no np nq b">COOKIES</code> <strong class="lb iu"> </strong>来读取一个cookie值，如下所示，即使你设置了一个整数值，它也返回一个字符串:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="c63c" class="nv mr it nq b gy nw nx l ny nz">request.COOKIES[‘cookie_name’]</span></pre><p id="8a7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们举个例子。</p><p id="a297" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的<code class="fe nn no np nq b">views.py</code>中创建一个视图，如下所示:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="b8c5" class="nv mr it nq b gy nw nx l ny nz">def test_cookie(request):   <br/>    if not request.COOKIES.get('team'):<br/>        response = HttpResponse("Visiting for the first time.")<br/>        response.set_cookie('team', 'barcelona')<br/>        return response<br/>    else:<br/>        return HttpResponse("Your favorite team is {}".format(request.COOKIES['team']))</span></pre><p id="5897" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在<code class="fe nn no np nq b">urls.py</code>中添加这个视图的URL。</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="aa42" class="nv mr it nq b gy nw nx l ny nz">urlpatterns = [<br/>    path('test_cookie/', views.test_cookie, name='test_cookie'),<br/>]</span></pre><p id="f6d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您第一次浏览<code class="fe nn no np nq b">http://127.0.0.1:8000/test_cookie/</code>时，它会发送cookie <code class="fe nn no np nq b">team</code>和响应，浏览器会存储它。这里，我们没有设置<code class="fe nn no np nq b">max_age</code>，所以当浏览器关闭时，浏览器将删除cookie。</p><p id="c4e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当用<code class="fe nn no np nq b">test_cookie</code>或任何其他请求在浏览器中设置cookie时，对<code class="fe nn no np nq b">http://127.0.0.1:8000/test_cookie/</code>(或<code class="fe nn no np nq b">http://127.0.0.1:8000/</code>的任何其他页面)的每个后续请求将把所有cookie发送到服务器。</p><p id="ed4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">HttpResponse</code>不包含任何cookies，除非您包含<code class="fe nn no np nq b">set_cookie()</code>。</p><p id="0c70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在Google Chrome中查看服务器发送的cookies，请按CTRL+Shift+J，这将打开开发者控制台。</p><h2 id="ecc9" class="nv mr it bd ms ob oc dn mw od oe dp na li of og nc lm oh oi ne lq oj ok ng ol bi translated">删除或更新cookie</h2><p id="c8b3" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">要获得cookie，只需调用<code class="fe nn no np nq b">response.delete_cookie(‘cookie_name’)</code>。<code class="fe nn no np nq b">HttpResponse</code>中没有cookie更新方法，使用<code class="fe nn no np nq b">set_cookie()</code>更新cookie值或到期时间。</p><h2 id="5715" class="nv mr it bd ms ob oc dn mw od oe dp na li of og nc lm oh oi ne lq oj ok ng ol bi translated">使用cookies时请记住这一点</h2><ol class=""><li id="0746" class="lv lw it lb b lc ni lf nj li om lm on lq oo lu ma mb mc md bi translated">永远不要使用cookies来存储密码等敏感数据。Cookies以纯文本形式存储数据，因此任何人都可以读取/修改它们。</li><li id="68cd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">大多数浏览器不允许cookie存储超过4KB的数据(即每个cookie存储4KB)。此外，大多数浏览器接受每个网站不超过30个cookies。实际上，每个网站的确切Cookie数量因浏览器而异，更多详情请访问<a class="ae ky" href="http://browsercookielimits.squawky.net/" rel="noopener ugc nofollow" target="_blank"> <em class="oa">浏览器Cookie限制</em> </a>。</li><li id="b82a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">回想一下，一旦在浏览器中设置了cookie，它就会随每个请求一起发送到服务器。假设我们添加了20个大小为4KB的cookies，总计80KB。这意味着，对于服务器的每个请求，浏览器都需要发送80KB的额外数据！</li><li id="cb94" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">用户可以随意删除cookies。用户甚至可以配置他们的浏览器完全不接受cookies。</li></ol></div></div>    
</body>
</html>