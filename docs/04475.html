<html>
<head>
<title>How to Use Analytics in Your React Native App With Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在带有Firebase的React原生应用中使用分析</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-do-analytics-in-your-react-native-app-with-firebase-152868772a6f?source=collection_archive---------9-----------------------#2020-04-15">https://betterprogramming.pub/how-to-do-analytics-in-your-react-native-app-with-firebase-152868772a6f?source=collection_archive---------9-----------------------#2020-04-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e0bd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">每个平台上更好的分析</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d1fc98be24cfe55128125188dfecfce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YYUuZwoSMJ7wE116A9G-8A.png"/></div></div></figure><p id="763e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您正在使用React Native构建两个移动应用程序(iOS和Android)。这些应用在他们的商店里获得批准。你如何知道你的客户是否喜欢你的作品，并认为它有用？除非你找到一种方法来获得洞察力，并了解你的应用程序是如何使用的。</p><p id="e2fc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，必须决定应该使用什么库。幸运的是，有一些很好的选择使集成变得很容易，比如:</p><ul class=""><li id="1960" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><a class="ae lw" href="https://aws-amplify.github.io/docs/js/analytics" rel="noopener ugc nofollow" target="_blank"> AWS Amplify的分析</a></li><li id="134e" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated">Firebase analytics :在本文中，我将重点介绍Firebase analytics，因为它是最受欢迎的分析工具之一，尤其是因为它可以轻松地与Google Analytics集成。不管你喜不喜欢，谷歌服务仍然(可以说)是最受欢迎的，原因有很多。</li></ul><p id="f5dd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在为React Native集成Firebase之前，您需要在<a class="ae lw" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank">控制台</a>中有一个Firebase项目。这个项目将持有iOS和Android应用程序的信息。在我的例子中，我将项目命名为<code class="fe mc md me mf b">tutorial-demo</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/c87e363b5b44e761ea9587f8fc1b9e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HM7fC4aqHIoz_FVI"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mh"><img src="../Images/f278a3783838ad43a7e0dcd9cc7e5bc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kR6JgjP46F-uc3Bs"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/5e498ed804d2a03ba30957b4bdc3c3b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UYjw5CWgNOLldQre"/></div></div></figure><p id="e73f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完成向导后，选择新创建的项目。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mj"><img src="../Images/649522e7cc7d78cc5103683946e288bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*853Ohu8OTbGo-qXd"/></div></div></figure><p id="165c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，我们需要为不同的平台添加不同的应用程序。对于iOS，选择iOS图标。输入原生项目的捆绑包ID(和App Store ID，如果您有)，给它一个昵称，然后按“注册应用程序”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/bac3d239dc1a91c95ef5ec5805075997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hO_iOaaS2NQYgSqa"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/b52e8a51de2b481559c473a06a40cb33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v4DGc9dSC6I-KHhb"/></div></div></figure><p id="e8dc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Firebase控制台提供了一个<code class="fe mc md me mf b">GoogleService-Info.plist</code>文件。这包含了一组iOS设备在Firebase项目中进行身份验证时使用的凭证。</p><p id="16ee" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下载第二步中呈现的<code class="fe mc md me mf b">GoogleService-Info.plist</code>，并将其添加到iOS原生项目中。如果你有多个目标，不要忘记选择正确的目标。另外，不要忘记选择“如果需要，拷贝项目”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mm"><img src="../Images/1de219a61c8175e4d4207e0358801166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8C-vQuRsI9VHob0q"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mn"><img src="../Images/860d8dae6945169d3d9eaa0d73fbe8de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IT0yGhkmwkDfjpYh"/></div></div></figure><p id="9b73" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">注</strong>:打开<code class="fe mc md me mf b">GoogleService-Info.plist</code>，设置“是”启用分析关键是<code class="fe mc md me mf b">IS_ANALYTICS_ENABLED</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mo"><img src="../Images/1a8bd414c4591dd04320ed321cbda9e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WzJTEvMuM-GTeXcc"/></div></div></figure><p id="c186" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第三步与我们无关，因为我们被Firebase包覆盖，它会为我们添加吊舱。第四步是我们稍后可以添加的内容。现在，让我们完成Firebase控制台配置。</p><p id="0d23" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Android方面的事情非常相似。进入项目主页，选择Android图标。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/43892fbd9fcb6d6c373343f4e5b11e06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8hZxbqDAzbAXzyw3"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/8ee24df4b32866534785842cf6d00a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Jx87IvvU8J40MC9F"/></div></div></figure><p id="3fa7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里，我们又有了一个配置文件—这次叫做<code class="fe mc md me mf b">google-services.json</code>。将其从Android项目文件夹添加到<code class="fe mc md me mf b">app</code>文件夹内的原生项目中。</p><p id="aedf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于React Native，有官方的<a class="ae lw" href="https://invertase.io/oss/react-native-firebase/" rel="noopener ugc nofollow" target="_blank"> Firebase包</a>。它包含所有的Firebase服务，我们将安装并使用它。<a class="ae lw" href="https://gist.github.com/5b47446012666496ccceef937f794856" rel="noopener ugc nofollow" target="_blank">安装核心和分析包</a>。</p><p id="aece" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">假设React本地版本&gt; = 0.60，那么该模块应该会自动链接到您的项目。如果没有，您需要手动将<code class="fe mc md me mf b">app</code>模块集成到您的项目中。</p><p id="9a04" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有关手动链接的更多信息，请参见针对<a class="ae lw" href="https://invertase.io/oss/react-native-firebase/v6/app/android" rel="noopener ugc nofollow" target="_blank"> Android </a>和<a class="ae lw" href="https://invertase.io/oss/react-native-firebase/v6/app/ios" rel="noopener ugc nofollow" target="_blank"> iOS </a>的以下步骤。为iOS应用安装pod:<code class="fe mc md me mf b">cd ios &amp;&amp; pod install &amp;&amp; cd</code></p><p id="0a82" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于iOS，我注意到在集成Firebase包之后，我需要做一些额外的步骤来使它工作:</p><ul class=""><li id="ba06" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">清除派生数据</li><li id="b451" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated">清理项目</li><li id="438c" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated">从模拟器/测试设备中删除现有应用程序</li></ul><p id="5dc5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于Android，以防构建或gradle同步失败——我曾经遇到过这种情况——<a class="ae lw" href="https://gist.github.com/940649832e0edb7fe07d5e55dc17e785" rel="noopener ugc nofollow" target="_blank">这是我修改的</a>。我认为这与自动链接由于某种原因失败有关。这是android/app/build.gradle 。</p><p id="8b09" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">仅仅通过集成分析包，就有一些事件被自动收集，如:<code class="fe mc md me mf b">first_open</code>、<code class="fe mc md me mf b">user_engagement</code>、<code class="fe mc md me mf b">app_clear_data</code>。此处提供了更多详细信息<a class="ae lw" href="https://support.google.com/firebase/answer/6317485" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="4f77" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个包的酷之处在于，它根据你的应用程序的性质(电子商务、游戏等)为不同的用例提供了预定义的方法。)还提供了定制您自己的事件日志记录的基本功能。长话短说，我们可以使用<code class="fe mc md me mf b">react-native-firebase</code>做的是:</p><p id="708e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在幕后，这些特定的事件(<code class="fe mc md me mf b">logAppOpen</code>、<code class="fe mc md me mf b">logLogin</code>、<code class="fe mc md me mf b">logSignUp</code>)正在使用<code class="fe mc md me mf b">logEvent</code>方法为您指定键和一些属性。</p><p id="a26c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">强烈建议不要向Firebase发送任何脆弱和秘密的数据(电子邮件、密码、姓名等)。)—从不散列。</p><p id="534d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这些只是其中的一部分。<a class="ae lw" href="https://invertase.io/oss/react-native-firebase/v6/analytics/reference/module#logViewItem" rel="noopener ugc nofollow" target="_blank">这里的</a>是所有支持的方法。</p><p id="407f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在来演示这些事件:<a class="ae lw" href="https://gist.github.com/2569f979bcde2f34f8b837a3b0b4b14c" rel="noopener ugc nofollow" target="_blank">让我们做一个老式的类</a>，它将用于集中分析代码。这种方法的一个优点是，我们可以通过更新一个文件来使用多个分析解决方案/包。(当然，它不需要是一个类，但我们在这里。)</p><p id="c3f0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">剩下的就是<a class="ae lw" href="https://gist.github.com/a40ddb5dce09773713bde422eefa82c1" rel="noopener ugc nofollow" target="_blank">在代码中使用我们的分析静态方法</a>。</p><p id="f2e5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这里，我们有多种选择，取决于我们需要什么。要么在安装后在每个组件中单独跟踪它们，要么利用我们项目中可能有的其他包的事件。一个例子可能是心爱的和经常使用的<code class="fe mc md me mf b">react-navigation</code>。</p><p id="7ab7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一个例子是<a class="ae lw" href="https://gist.github.com/404619fb72bc56905147d0cbe4a94ea4" rel="noopener ugc nofollow" target="_blank">追踪一个图片分享应用</a>:要么用户更倾向于使用相机，要么使用相机胶卷。</p><p id="2110" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一切都已安装、配置和实现。让我们看看我们是否能从Firebase控制台的应用程序中获得一些东西。什么都没有？嗯，在记录和在仪表板上看到事件之间有大约一个小时的延迟。好消息是我们可以做些事情来快速测试它——延迟大约一秒钟。叫做<code class="fe mc md me mf b">DebugView</code>。</p><p id="702b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于iOS项目，我们可以通过编辑方案来传递一个关于<code class="fe mc md me mf b">run</code>过程的参数。这个论点叫做<code class="fe mc md me mf b">-FIRDebugEnabled</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/fefc5b37f5d418081a30e7447f519203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*orIYd2DfAF89RTQg"/></div></div></figure><p id="2a7f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于发布版本，我们应该指定<code class="fe mc md me mf b">argument-FIRDebugDisabled</code>。</p><p id="615b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要在Android上启用调试模式，只需运行:<code class="fe mc md me mf b">adb shell setprop debug.firebase.analytics.app package_name</code>。这种行为会一直存在，直到您通过指定以下命令行参数来显式禁用调试模式:<code class="fe mc md me mf b">adb shell setprop debug.firebase.analytics.app .none</code>。现在再次运行应用程序，您应该会在Firebase控制台中看到一些操作:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/777391c7a46bee589e1d1f851d1dd57f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3qCcykbWkya3iHf4"/></div></div></figure><p id="d19a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">根据我的经验:如果出于某种神秘的原因，它在iOS上不能工作，我的诀窍是手动链接Xcode中的库，如下图所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/ded6b3b47271e55d0b4535d7488680d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V6yGkde4CTX048Gy"/></div></div></figure><p id="f2f7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">差不多就是这样。你可以从这里发布你的应用程序，收集有价值的信息。将它与来自谷歌分析的数据结合起来，你就有能力(以及支持它的数据)来决定下一步最好的行动。完整的代码，<a class="ae lw" href="https://github.com/calincrist/imageSharingApp." rel="noopener ugc nofollow" target="_blank">这里是GitHub链接</a>。</p></div></div>    
</body>
</html>