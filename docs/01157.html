<html>
<head>
<title>Log In With the Google OAuth Demo App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google OAuth演示应用程序登录</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/log-in-with-the-google-oauth-demo-app-9e7d0e801c29?source=collection_archive---------3-----------------------#2019-08-19">https://betterprogramming.pub/log-in-with-the-google-oauth-demo-app-9e7d0e801c29?source=collection_archive---------3-----------------------#2019-08-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a906" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Google OAuth 2.0的逐步实现</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/48fa8b27897d05ffed12c21654865e01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pcB17GuvSf9IaQeO5M5PAg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@mr_williams_photography" rel="noopener ugc nofollow" target="_blank">迈卡·威廉姆斯</a>上<a class="ae ky" href="https://unsplash.com/photos/lmFJOx7hPc4" rel="noopener ugc nofollow" target="_blank">下</a></p></figure><p id="6fa8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://oauth.net/" rel="noopener ugc nofollow" target="_blank"> OAuth </a>是一种授权开放标准，规定了互联网用户授权第三方访问其存储在其他网站上的资源的流程。</p><p id="5ae9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它被谷歌、脸书、推特等公司广泛使用。像谷歌这样的公司可以授权第三方应用程序或网站访问其用户的数据:姓名、电子邮件地址、个人资料图片、电子邮件等。</p><p id="c87b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户必须同意，但他们只会向谷歌提供他们的凭证，而不是第三方。</p><p id="d84f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的关键术语是<em class="lv">授权</em>，因为我经常看到它被误认为<em class="lv">认证</em>。</p><p id="d992" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为OAuth通常被用作“使用谷歌”(或脸书，或Twitter等)登录网站的一种方式。).但是在这样做的时候，用户实际上并没有对那个网站进行认证。</p><p id="37fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们授权它访问他们的谷歌信息，并且只将他们的凭证传递给谷歌，而不会传递给网站或应用程序。</p><p id="2209" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:在这个过程中，用户可能必须向Google认证(如果他们之前没有这样做的话)，但是认证本身与OAuth无关，这只是Google的正常认证过程。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="9834" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">角色</h1><p id="1544" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">OAuth实现中通常涉及三个角色:</p><ul class=""><li id="a0bf" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">资源所有者:授权访问其数据(或部分数据)的用户。</li><li id="5229" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">第三方应用程序:希望访问资源所有者数据的网站或应用程序。</li><li id="940b" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">资源服务器:保存资源所有者数据的服务器，这些数据通过API公开。</li></ul></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8709" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">分步示例</h1><p id="c551" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">OAuth的具体实现可能取决于想要访问数据的应用程序的类型。</p><p id="e878" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个特殊的例子中，它将是一个web应用程序，既有服务器端又有前端，请求它的用户授权访问他们在Google服务器上的数据。</p><p id="f270" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，对于移动应用程序、纯服务器应用程序或纯前端应用程序来说，这些步骤是非常相似的。</p><p id="0af6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您正在构建一个web应用程序，您希望为您的用户提供登录功能，但您不想让他们填写注册表单并管理他们的所有密码，因此，您使用Google的OAuth服务来访问他们的个人资料信息。</p><p id="b149" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要调用Google的API并获得有关其用户的信息，您需要一个访问令牌，然后将它包含在每个请求中，以便Google知道您已经被授权访问。</p><p id="1c5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的步骤以随意对话的形式描述了如何获得这样的访问令牌，这样我们就不会迷失在技术术语中。</p><ol class=""><li id="b7a0" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu no ng nh ni bi translated"><strong class="lb iu">你:“嘿，谷歌，我想给我的应用程序的访问者允许它访问他们的谷歌数据的选项。”<br/> </strong>你登录谷歌(你将需要一个谷歌账户)并设置OAuth，在这里你提供应用程序的名称，指定你想要从其用户那里访问的确切信息，以及其他一些事情。</li><li id="d9ba" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu no ng nh ni bi translated"><strong class="lb iu">谷歌:“好吧，但我需要他们的同意。”然后，谷歌会给你提供一个URL，你需要在那里重定向你的用户以获得同意。它还提供了一个客户端ID，您需要将这个ID附加到这个URL上，这样它就知道用户授权访问哪个应用程序以及可以访问的确切信息。它还提供了一个客户端密钥，您稍后会需要它。</strong></li><li id="899c" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu no ng nh ni bi translated"><strong class="lb iu">访问你的应用程序的用户:“我想登录谷歌。”</strong> <br/>当你的应用程序的用户选择这个选项时，你把他们重定向到谷歌在第二步提供的网址。</li><li id="1342" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu no ng nh ni bi translated"><strong class="lb iu">谷歌(对用户):“你要允许这个应用程序从你的谷歌账户访问这些数据吗？”</strong> <br/>如果还没有登录，Google会先显示登录表单。如果用户已经同意这一点，它将跳转到步骤6。</li><li id="8a23" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu no ng nh ni bi translated"><strong class="lb iu">用户:“是。”</strong> <br/> Google确认用户同意，并将客户端ID标记为“可以使用”，这样下次就不会再要求许可了。</li><li id="2573" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu no ng nh ni bi translated"><strong class="lb iu">谷歌:“知道了！现在回到应用程序。”</strong> <br/>谷歌将用户重定向回你的应用，到你在第一步提供的URL，并附加一个授权码。<br/>注意:此URL可以呈现一个HTML页面，但这意味着您在该页面中可能拥有的任何第三方脚本(分析、广告等)。)可以访问授权码，因为它是一个<code class="fe np nq nr ns b">query</code>参数。因此，建议首先由您的服务器处理这个问题，然后将用户重定向到一个不包含任何响应参数的HTML页面。</li><li id="68d0" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu no ng nh ni bi translated">你的应用程序:“好的，谷歌，用户同意了，我有授权码可以证明。现在可以给我我的访问令牌了吗？” <br/>然后，你的应用程序调用另一个Google URL，并提供第6步中的授权码，以及第2步中的客户端ID和客户端密码。</li><li id="2429" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu no ng nh ni bi translated">谷歌:“好的，在这里。”Google在响应中向您的应用程序提供访问令牌。</li><li id="bd15" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu no ng nh ni bi translated"><strong class="lb iu">你的app:“终于！谷歌，给我这个访问令牌的配置文件信息。”使用访问令牌，应用程序调用Google的API端点，该端点提供用户的姓名、电子邮件地址和个人资料图片。根据您在步骤1中的选择，您可以呼叫其他端点并获取用户的电子邮件、删除它们、发送电子邮件等。</strong></li><li id="8636" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu no ng nh ni bi translated"><strong class="lb iu">你的app:“嗨用户！谷歌给了我你的个人资料。”</strong> <br/>这个应用程序现在有了用户的姓名、电子邮件地址和个人资料图片。它可以在其数据库中创建一个记录，以保存它需要的关于该用户的任何信息，并在将来的访问中识别它们。</li></ol><p id="503a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我在这个特定的例子中使用了谷歌，但它也适用于其他服务提供商，如亚马逊、脸书或Twitter。</p><p id="5374" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们通常还提供各种编程语言的库来帮助您实现。</p><p id="247e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">各个服务提供商的步骤可能会有所不同，不同类型的应用程序有不同的流程。这可能有点混乱，但总体过程应该是相似的。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ef1b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">构建一个演示Web应用程序</h1><h2 id="7149" class="nt me it bd mf nu nv dn mj nw nx dp mn li ny nz mp lm oa ob mr lq oc od mt oe bi translated">获取OAuth客户端ID和客户端密码</h2><p id="95ea" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们首先需要的是客户ID和客户密码。</p><p id="3920" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通过进入<a class="ae ky" href="https://console.developers.google.com/projectselector2/apis/dashboard?organizationId=0&amp;supportedpurview=project" rel="noopener ugc nofollow" target="_blank"> Google API控制台</a>然后按照下面的步骤来获得它们。</p><p id="7820" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.创建新项目。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/73461980995b1c14fb157a9d4633cd08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*s5IzX0yGUjbo67h8r6wt5Q.png"/></div></figure><p id="dd6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.为项目选择一个名称。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/b86d9671c292b55b0124b7eb9f717186.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*4FjoIQAIo3c-FA0uxoFxTw.png"/></div></figure><p id="1ddc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.选择您刚刚创建的项目。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/c38cd8f1edcc398c375842d0d3424269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*VZg7H0OoYzcyC4gWQKMPDQ.png"/></div></figure><p id="c948" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.为您的应用程序命名。你也可以上传你的应用程序的标志，它将出现在谷歌的同意屏幕上。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/28caab0b3c1a7104dc19825599dab669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*Sso30sOzNMnC1dQ1nURzfQ.png"/></div></figure><p id="1991" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.创建OAuth客户端ID和密码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/7efbb89e2abb6ad7c44b2308473fa5da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*HaLYwFyShI4g6PSbgdvt6w.png"/></div></figure><p id="2d96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">6.填写高亮显示的详细信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/465117199b875b6bbce3c10853ee1152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*0GYxL4tAcPVsTbnmMM6eWw.png"/></div></figure><p id="98d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">7.您现在有了一个客户端ID和一个客户端密码。稍后您会需要它们(它们在您的API控制台中总是可用的)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/59dea0060727e610f73e690dcb85d2b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*0gwMqqdPsQhpayH4eQUaJA.png"/></div></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ff88" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">应用程序</h1><p id="ef7f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这是一个简单的演示应用程序。它由两个文件组成:一个HTML页面和一个<a class="ae ky" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>服务器文件。</p><p id="ff09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">HTML文件是一个简单的网页。它有一些JS逻辑来显示“使用Google登录”按钮或基于一些<code class="fe np nq nr ns b">query</code>参数的用户详细信息。</p><p id="2161" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe np nq nr ns b">getClientId()</code>从服务器获取客户端ID，因为它通常不存储在客户端。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="b83a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">服务器文件获取客户机ID和客户机秘密命令行参数(在启动服务器时必须提供)，并从<code class="fe np nq nr ns b">public</code>文件夹(上面的HTML文件)提供静态数据。</p><p id="6903" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它有一个用于HTML页面获取客户端ID的<code class="fe np nq nr ns b">/clientId</code>端点的处理程序。</p><p id="f92e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe np nq nr ns b">/oauth2callback</code>端点的处理程序是我们之前在获取客户端ID和密码时设置的。</p><p id="38a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是Google在用户同意后重定向用户的地方，并在代码查询参数中传递一个授权<code class="fe np nq nr ns b">code</code>。有了这些信息、客户机秘密和客户机ID，这个处理程序就调用<code class="fe np nq nr ns b"><a class="ae ky" href="https://www.googleapis.com/oauth2/v4/token" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/oauth2/v4/token</a></code>来获取访问令牌。</p><p id="731e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，它将令牌传递给<code class="fe np nq nr ns b">getUserInfo()</code>，后者获取用户详细信息，并将用户详细信息作为查询参数重定向到本地主机，HTML页面将呈现这些信息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="dcb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，这是一个演示应用程序。当你为现实世界构建一个时，仔细考虑一下架构。</p><p id="fcab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以从<a class="ae ky" href="https://github.com/ionelh/google-oauth-demo-app" rel="noopener ugc nofollow" target="_blank"> GitHub </a>克隆这个应用。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ec36" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">参考</h1><p id="0cfb" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><a class="ae ky" href="https://developers.google.com/identity/protocols/OAuth2WebServer" rel="noopener ugc nofollow" target="_blank">将OAuth 2.0用于网络服务器应用</a></p></div></div>    
</body>
</html>