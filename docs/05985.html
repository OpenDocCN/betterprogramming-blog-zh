<html>
<head>
<title>Android Scoped Storage Demystified</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android范围存储去神秘化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/android-scoped-storage-demystified-3024a062ba24?source=collection_archive---------2-----------------------#2020-08-24">https://betterprogramming.pub/android-scoped-storage-demystified-3024a062ba24?source=collection_archive---------2-----------------------#2020-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3404" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用作用域存储来防止应用程序不受限制地访问文件系统，并帮助减少文件混乱</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3041ce66299c33eb8d63247fd6a849af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zjv2jUWtpSz6WDxbAeEkMQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:<a class="ae ky" href="https://www.androidcentral.com/what-scoped-storage" rel="noopener ugc nofollow" target="_blank"> Android Central </a></p></figure><p id="1080" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我谈论Android最近在操作系统层面的改进，那都是关于保护应用程序和用户数据，并以更有组织的形式提供访问。改变的理由是好的，但这意味着开发人员要做更多的工作。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="311c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Android 11中，添加了一些主要的更改和限制来增强用户隐私，包括，如<a class="ae ky" href="https://developer.android.com/preview/behavior-changes-11" rel="noopener ugc nofollow" target="_blank">行为更改</a>预览中所列的，以下内容:</p><blockquote class="mc md me"><p id="cdfe" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated"><a class="ae ky" href="https://developer.android.com/preview/privacy/storage#scoped-storage" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">限定范围的存储实施</strong> </a> <strong class="lb iu"> : </strong>对外部存储目录的访问仅限于应用特定的目录和应用创建的特定类型的媒体。</p><p id="f7fa" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated"><a class="ae ky" href="https://developer.android.com/preview/privacy/permissions#auto-reset" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">权限自动重置</strong> </a> <strong class="lb iu"> : </strong>如果用户几个月没有与某个app交互，系统会自动重置该app的敏感权限。</p><p id="8437" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated"><a class="ae ky" href="https://developer.android.com/preview/privacy/location#background-location" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">后台位置访问</strong> </a> <strong class="lb iu"> : </strong>用户必须被引导至系统设置，以便向应用授予后台位置权限。</p><p id="3db0" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated"><a class="ae ky" href="https://developer.android.com/preview/privacy/package-visibility" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">包可见性</strong> </a> <strong class="lb iu"> : </strong>某app查询设备上已安装app列表时，对返回的列表进行过滤。</p></blockquote><p id="1c68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近，我深入研究了作用域存储的概念，以了解其意图，并相应地为我的Android应用程序做好准备。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ce6e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">存储结构(Android 10之前)</h1><p id="0009" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在进入实现部分之前，我们先来了解一下Android 10之前的数据组织方式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/b8c85fd9c12fa8322e6801c891b75077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gt_C0zwwrUkmNANJt36jPA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Android 10之前的存储结构(图片来源:作者)</p></figure><ul class=""><li id="d388" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu">私有存储</strong>:所有app在内部存储中都有自己的私有目录，即Android/data/{package name}，其他app看不到。</li><li id="f4db" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><strong class="lb iu">共享存储</strong>:除私有存储外，其余存储称为<em class="mf">共享存储</em>。这包括所有正在存储的媒体和非媒体文件，具有存储权限的应用程序可以轻松访问它们。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e45c" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">当前结构和访问的问题</h1><p id="b322" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">你觉得这种结构有什么问题吗，或者你希望谷歌改变什么？</p><p id="9222" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我来阐述一些问题:</p><ul class=""><li id="d1f2" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated">如果我是一个电子商务应用程序，我需要存储访问权限，只要求用户上传他们的个人资料图片，这意味着访问某个文件或文件系统。你可以举另一个例子:一个聊天应用程序，我想上传媒体或将一个媒体文件写入系统，这意味着访问单个媒体文件。那么，我为什么要求整个存储访问权限呢？</li><li id="a25b" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">您是否曾经担心过您的敏感数据，如您的医疗处方或银行文件，会被安装在您设备上的所有应用程序访问？</li><li id="a228" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">如果我正在卸载一个应用程序，并且需要从我使用该应用程序时起就与之相关的数据/文件，我有什么简单的方法来清除所有的混乱吗？</li></ul><p id="dbfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我敢肯定，这一定让你想到了你的应用和数据安全，隐私和组织。不要担心，谷歌最近与存储相关的Android更新来救你了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bdf3" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">作用域存储</h1><h2 id="9acb" class="nv mk it bd ml nw nx dn mp ny nz dp mt li oa ob mv lm oc od mx lq oe of mz og bi translated">想法</h2><p id="98ee" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">谷歌给出了做出这一改变的两个有效理由:安全性和减少遗留的“应用混乱”</p><p id="add4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://source.android.com/security/app-sandbox" rel="noopener ugc nofollow" target="_blank">应用沙箱</a>是Android设计的核心部分，将应用程序相互隔离。在Android Q中，Google从应用程序沙箱中吸取了相同的基本原理，引入了作用域存储。</p><blockquote class="mc md me"><p id="276b" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated">“这些变化原本计划应用于运行Android 10或更高版本的手机上的每一个应用程序，但由于开发者的强烈反对，谷歌改变了方针，只要求针对Android API级别29(即Android 10)的应用程序使用范围存储。但随着<a class="ae ky" href="https://www.androidcentral.com/android-11" rel="noopener ugc nofollow" target="_blank"> Android 11 </a>的推出，范围存储又回来了，谷歌这次不太可能改变主意。”—<a class="ae ky" href="https://www.androidcentral.com/what-scoped-storage" rel="noopener ugc nofollow" target="_blank">Android 11中的作用域存储是什么？</a></p></blockquote><ul class=""><li id="a9e5" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu">更好的归属</strong>:应用程序将被提供对存储块的访问，这些存储块具有应用程序的相关数据。</li></ul><p id="d14d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看看Android 10 &amp;以上的存储结构:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/12c3f8ec522e3d880a9865d69589f013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VhHFRKsYqYUoYV5Nljgosg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Android 10及以上版本上的存储结构(图片来源:作者)</p></figure><p id="87ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在私有存储和以前一样，但是共享存储进一步分为媒体和下载(非媒体文件)集合。</p><ul class=""><li id="6857" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu">减少文件混乱</strong>:系统会将存储绑定到所有者应用，以便系统更容易找到与应用对应的相关文件。卸载应用程序时这很有用，因为与应用程序相关的所有数据也会被卸载。</li><li id="b179" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><strong class="lb iu">防止滥用READ_EXTERNAL_STORAGE权限:</strong>现在，授予应用程序此权限将使其能够访问整个外部存储，我们可以在其中保存照片、私人文档、视频和其他潜在的敏感文件。正如<a class="ae ky" href="https://www.androidcentral.com/what-scoped-storage" rel="noopener ugc nofollow" target="_blank">中提到的，Android 11中的范围存储是什么？</a>“强制实施范围存储后，应用程序只能看到自己的数据文件夹以及某些媒体类型，如使用其他存储API的音乐文件。”</li></ul><p id="0498" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哇，现在这看起来很酷，不是吗？</p><p id="2fb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一个用户，我对我的文件和我授予访问权限的人有更多的控制权。此外，如果应用程序本身删除了不需要的文件，它将为我的设备腾出额外的空间。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c8ca" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">文件访问权限的更改</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/f677433788b8ebfc5f0724cbab7adbcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tKvVVA8jCbhGEJgL_lj0nA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作用域存储结构(图片来源:作者)</p></figure><ul class=""><li id="e1a9" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu">不受限制地访问其单独的应用程序存储:</strong> An <strong class="lb iu"> a </strong> pp将不受限制地访问内部和外部存储进行读写操作。使用Android 10，将文件写入SD卡上自己的app目录不需要提供存储权限。</li><li id="06ed" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><strong class="lb iu">无限制地访问媒体文件和下载收藏(已贡献):</strong>您可以无限制地将文件贡献到您自己的应用程序的媒体收藏和下载中。如果您想在媒体收藏中保存任何图像、视频或任何其他媒体文件，不需要获得许可(只要文件存储在有序收藏中)。)</li><li id="dcba" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">可以使用READ_STORAGE_PERMISSION权限访问其他应用程序提供的媒体收藏。从下一版本开始，将不再推荐使用WRITE_STORAGE_PERMISSION权限，如果使用，其作用与READ_STORAGE_PERMISSION相同。</li><li id="3b2f" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">其他应用程序贡献的非媒体文件将需要存储访问框架API来进行读取和写入操作。</li></ul><blockquote class="mc md me"><p id="e87a" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated">“注意:如果您的应用程序使用传统存储模型和以前针对的Android 10或更低版本，当启用<a class="ae ky" href="https://developer.android.com/training/data-storage#scoped-storage" rel="noopener ugc nofollow" target="_blank">范围存储</a>模型时，您可能会将数据存储在您的应用程序无法访问的目录中。在你瞄准Android 11之前，将数据迁移到一个与作用域存储兼容的目录。在大多数情况下，您可以将数据迁移到您的<a class="ae ky" href="https://developer.android.com/training/data-storage/app-specific" rel="noopener ugc nofollow" target="_blank">应用特定目录</a>。”—<a class="ae ky" href="https://developer.android.com/preview/privacy/storage" rel="noopener ugc nofollow" target="_blank">Android 11中的存储更新</a></p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/cad4b82e59892681aa9026e1a5208ff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1l08UueUTYhKvDkS.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><p id="cdfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">呜哇！！更具体的权限。我现在很开心，也更有安全感。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="27e0" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">选择退出针对Android 10及以上版本的应用</h1><p id="4692" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">来自<a class="ae ky" href="https://developer.android.com/preview/privacy/storage" rel="noopener ugc nofollow" target="_blank"> Android开发者网站</a>:</p><blockquote class="mc md me"><p id="8a89" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated">“为了给开发者额外的测试时间，针对Android 10 (API级别29)的应用仍然可以请求requestLegacyExternalStorage属性。此标志允许应用程序暂时退出与作用域存储相关的更改，例如授予对不同目录和不同类型媒体文件的访问权限。”</p></blockquote><p id="51c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">据<a class="ae ky" href="https://www.androidcentral.com/what-scoped-storage" rel="noopener ugc nofollow" target="_blank">Android 11中什么是作用域存储？</a>:</p><blockquote class="mc md me"><p id="46bf" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated">“任何面向Android 11或更高版本的应用程序都必须使用新的存储API，其中包括作用域存储。对Google Play开发者协议的修改称，从2020年8月1日开始，所有提交到Google Play的新应用必须针对Android 10或更高版本，所有对现有应用的更新必须截至2020年11月1日针对Android 10或更高版本。预计同样的行为，明年可能会要求应用程序针对Android 11。”</p></blockquote><p id="d12c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是时候了。学习、理解并执行它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9dec" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">存储操作</h1><p id="e547" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">让我简要介绍一些常见的存储操作以及如何操作:</p><ul class=""><li id="3866" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu">选择一个文件</strong>:使用<strong class="lb iu"> </strong> <code class="fe ok ol om on b"><a class="ae ky" href="https://developer.android.com/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT" rel="noopener ugc nofollow" target="_blank">ACTION_OPEN_DOCUMENT</a></code>打开系统的文件选择器应用程序，允许用户选择要打开的文件。若要仅显示应用程序支持的文件类型，请指定MIME类型。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><ul class=""><li id="8656" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu">选择一个文件夹:</strong>意图<code class="fe ok ol om on b"><a class="ae ky" href="https://developer.android.com/reference/android/content/Intent.html#ACTION_OPEN_DOCUMENT" rel="noopener ugc nofollow" target="_blank">ACTION_OPEN_DOCUMENT</a></code>可以替换为<code class="fe ok ol om on b"><a class="ae ky" href="https://developer.android.com/reference/android/content/Intent#ACTION_OPEN_DOCUMENT_TREE" rel="noopener ugc nofollow" target="_blank">ACTION_OPEN_DOCUMENT_TREE</a></code>。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="3686" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:在用户重新启动设备之前，此访问将一直有效。如果应用程序希望保持访问，在使用内容解析器访问URI时，内容解析器必须调用<code class="fe ok ol om on b"><a class="ae ky" href="https://developer.android.com/reference/android/content/ContentResolver#takePersistableUriPermission(android.net.Uri,%20int)" rel="noopener ugc nofollow" target="_blank">takePersistableUriPermission</a></code>方法。</p><p id="d0cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，如果你使用<code class="fe ok ol om on b">ACTION_OPEN_DOCUMENT_TREE</code>遍历目录中的大量文件，你的应用程序的性能可能会降低。</p><ul class=""><li id="455e" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu">创建文件:</strong>使用<strong class="lb iu"> </strong> <code class="fe ok ol om on b"><a class="ae ky" href="https://developer.android.com/reference/android/content/Intent#ACTION_CREATE_DOCUMENT" rel="noopener ugc nofollow" target="_blank">ACTION_CREATE_DOCUMENT</a></code>将文件保存在特定位置。</li></ul><blockquote class="mc md me"><p id="83b1" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated">"注意:<code class="fe ok ol om on b">ACTION_CREATE_DOCUMENT</code>不能覆盖现有文件。如果您的应用程序试图以相同的名称保存文件，系统会在文件名末尾的括号中附加一个数字。”— <a class="ae ky" href="https://developer.android.com/training/data-storage/shared/documents-files" rel="noopener ugc nofollow" target="_blank"> Android开发者文档</a></p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="df3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">等等，我无法获取元数据，即我的图像的位置。这种情况改变了吗？怎么才能拿到？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a441" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">媒体位置权限</h1><p id="9230" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">正如<a class="ae ky" href="https://developer.android.com/training/data-storage/shared/media" rel="noopener ugc nofollow" target="_blank"> Android开发者文档</a>所述:</p><blockquote class="mc md me"><p id="cfb7" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated">“如果你的应用程序面向Android 10 (API级别29)或更高版本，为了让你的应用程序从照片中检索未经编辑的Exif元数据，你需要在你的应用程序清单中声明<code class="fe ok ol om on b"><a class="ae ky" href="https://developer.android.com/reference/android/Manifest.permission#ACCESS_MEDIA_LOCATION" rel="noopener ugc nofollow" target="_blank">ACCESS_MEDIA_LOCATION</a></code>权限，然后在运行时请求此权限。”</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><blockquote class="mc md me"><p id="e691" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated"><strong class="lb iu"> " </strong>注意:由于您在运行时请求了<code class="fe ok ol om on b">ACCESS_MEDIA_LOCATION</code>权限，因此无法保证您的应用程序能够访问照片中未编辑的Exif元数据。您的应用程序需要明确的用户同意才能访问这些信息。”— <a class="ae ky" href="https://developer.android.com/training/data-storage/shared/media" rel="noopener ugc nofollow" target="_blank"> Android开发者文档</a></p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1256" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">备份应用程序的文件管理器类型</h1><p id="d745" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">对于需要访问所有内容的文件管理器类应用程序，我们也有一个解决方案。你需要遵循Android 11 中<a class="ae ky" href="https://developer.android.com/preview/privacy/storage" rel="noopener ugc nofollow" target="_blank">存储更新中列出的这些简单步骤:</a></p><blockquote class="mc md me"><p id="f8f8" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated">通过执行以下操作，应用程序可以向用户请求名为“所有文件访问”的特殊应用程序访问权限:</p><p id="7403" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated">1.在清单中声明<code class="fe ok ol om on b"><a class="ae ky" href="https://developer.android.com/reference/android/Manifest.permission#MANAGE_EXTERNAL_STORAGE" rel="noopener ugc nofollow" target="_blank">MANAGE_EXTERNAL_STORAGE</a></code>权限</p><p id="3dc9" class="kz la mf lb b lc ld ju le lf lg jx lh mg lj lk ll mh ln lo lp mi lr ls lt lu im bi translated">2.使用<code class="fe ok ol om on b"><a class="ae ky" href="https://developer.android.com/reference/android/provider/Settings#ACTION_MANAGE_ALL_FILES_ACCESS_PERMISSION" rel="noopener ugc nofollow" target="_blank">ACTION_MANAGE_ALL_FILES_ACCESS_PERMISSION</a></code>意图动作将用户引导至系统设置页面，在该页面中他们可以为您的应用启用以下选项:允许访问以管理所有文件。"</p></blockquote><p id="3fa1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">合法应用程序需要这些特殊权限。</p><p id="d6ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦用户授予广泛访问权限，用户将获得包含非媒体文件的MediaStore的未过滤视图。</p><p id="e687" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只有谷歌授权的应用程序才能完全访问存储空间。为此，将声明表提交到Google Play，并被列入批准列表。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b626" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated"><strong class="ak">使用自定义文件选择器的应用</strong></h1><p id="1440" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">如果我的应用程序使用显示精确数据目录的自定义文件选择器会怎样？你对此无能为力。从现在开始，你可能需要使用一个系统选择器。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9c2e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">实施过程中要记住的事项</h1><ol class=""><li id="7e69" class="nh ni it lb b lc nb lf nc li oq lm or lq os lu ot nn no np bi translated">不要使用静态路径。锁定文件路径访问。</li><li id="badd" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu ot nn no np bi translated">使用<a class="ae ky" href="https://developer.android.com/training/data-storage/shared/media" rel="noopener ugc nofollow" target="_blank">媒体商店</a>(推荐)。</li><li id="3f1d" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu ot nn no np bi translated">应该正确使用媒体存储。比如不要把你的音乐文件放在图片目录里。</li><li id="3e87" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu ot nn no np bi translated">非媒体文件应该在下载目录中(推荐)。</li><li id="f52a" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu ot nn no np bi translated">要通过其他应用程序访问非媒体文件，请将<a class="ae ky" href="https://developer.android.com/guide/topics/providers/document-provider" rel="noopener ugc nofollow" target="_blank">系统选择器</a>与SAF(存储访问框架)配合使用。需要运行时权限才能完全访问该应用程序。</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="46b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在这里查看Github示例实现:</p><div class="ou ov gp gr ow ox"><a href="https://github.com/niharika2810/ScopedStorageDemo" rel="noopener  ugc nofollow" target="_blank"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd iu gy z fp pc fr fs pd fu fw is bi translated">niharika2810/ScopedStorageDemo</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">一个示例项目解释了在文件和映像上执行不同操作的作用域存储。注意:您有…</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">github.com</p></div></div><div class="pg l"><div class="ph l pi pj pk pg pl ks ox"/></div></div></a></div><p id="feb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原发表<a class="ae ky" href="https://thedroidlady.com/2020-08-24-android-scoped-storage-demystified" rel="noopener ugc nofollow" target="_blank">此处</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3842" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">参考</h1><ul class=""><li id="2cdd" class="nh ni it lb b lc nb lf nc li oq lm or lq os lu nm nn no np bi translated"><a class="ae ky" href="https://www.androidcentral.com/what-scoped-storage" rel="noopener ugc nofollow" target="_blank">https://www.androidcentral.com/what-scoped-storage</a></li><li id="2de3" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><a class="ae ky" href="https://developer.android.com/preview/privacy/storage" rel="noopener ugc nofollow" target="_blank">https://developer.android.com/preview/privacy/storage</a></li><li id="f5e4" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><a class="ae ky" href="https://medium.com/androiddevelopers/android-11-storage-faq-78cefea52b7c" rel="noopener">https://medium . com/Android developers/Android-11-storage-FAQ-78 ce FEA 52 b 7 c</a></li><li id="2048" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><a class="ae ky" href="https://medium.com/androiddevelopers/scope-storage-myths-ca6a97d7ff37" rel="noopener">https://medium . com/Android developers/scope-storage-myths-ca 6a 97d 7 ff 37</a></li></ul><p id="4f4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上就是我对这篇文章的看法。我希望你学到了一些东西。如果你知道更多，请留下评论，这样我们可以一起学习。</p></div></div>    
</body>
</html>