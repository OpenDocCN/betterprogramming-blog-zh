<html>
<head>
<title>Using GraphQL With Spring Boot: Interfaces and Unions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Spring Boot使用GraphQL:接口和联合</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-graphql-with-spring-boot-interfaces-and-unions-a76f62d62867?source=collection_archive---------8-----------------------#2020-05-06">https://betterprogramming.pub/using-graphql-with-spring-boot-interfaces-and-unions-a76f62d62867?source=collection_archive---------8-----------------------#2020-05-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9f61" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">GraphQL的接口和联合提供了一种在查询中处理多种字段类型的好方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1568a7f63df2118d6bc517970d38967b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jw47fhdjatYGF_iILYVzGg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有Spring Boot的GraphQL插图</p></figure><h1 id="f046" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">首先</h1><p id="a288" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">我将从概念的解释开始，然后我们将与Spring Boot和科特林一起研究它的实现。</p><p id="5031" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">考虑下面的数据类和接口。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="2deb" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">现在我们要写一个GraphQL模式，它模拟相同的接口和类。我们将有一个获取<code class="fe mt mu mv mw b">Profile</code>的查询，它将根据客户端在单个查询中的需求给出一个<code class="fe mt mu mv mw b"> User</code>或<code class="fe mt mu mv mw b">Company</code>。</p><p id="98cd" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">在我们的GraphQL模式中，当使用接口时，我们将添加以下内容。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="cab5" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我们也可以用<code class="fe mt mu mv mw b">Union</code>代替<code class="fe mt mu mv mw b">Interface</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h2 id="fa23" class="mx kz it bd la my mz dn le na nb dp li lz nc nd lk md ne nf lm mh ng nh lo ni bi translated">我们应该使用哪一个？</h2><p id="69e5" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">它可以根据使用案例和您的最终目标而变化。以下几点可用于最终确定选项。</p><ul class=""><li id="28a2" class="nj nk it ls b lt mm lw mn lz nl md nm mh nn ml no np nq nr bi translated">将共享字段分组到接口中并不总是有利的——这取决于用例</li><li id="5f1d" class="nj nk it ls b lt ns lw nt lz nu md nv mh nw ml no np nq nr bi translated">当类型在使用方式上有基本的共性时，接口是很好的选择</li><li id="f373" class="nj nk it ls b lt ns lw nt lz nu md nv mh nw ml no np nq nr bi translated">联合有利于记录和迫使客户理解不同的类型应该如何处理</li></ul></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="61a6" class="ky kz it bd la lb oe ld le lf of lh li jz og ka lk kc oh kd lm kf oi kg lo lp bi translated">与Spring Boot一起实施</h1><h2 id="a6c3" class="mx kz it bd la my mz dn le na nb dp li lz nc nd lk md ne nf lm mh ng nh lo ni bi translated">1.设置</h2><p id="53ed" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">如果你知道如何用GraphQL建立一个Spring Boot项目，你可以跳到第三部分。此外，代码可以在<a class="ae oj" href="https://github.com/maniish-jaiin/graphql-interfaces-unions" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="4af7" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">否则，转到<a class="ae oj" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank">https://start.spring.io/</a>。</p><p id="fa30" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">选择一个<code class="fe mt mu mv mw b">Gradle</code>项目，将语言设置为<code class="fe mt mu mv mw b">Kotlin</code>。</p><p id="2346" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">对于最低限度的实现，您不必选择任何依赖项。</p><p id="2068" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">下载ZIP文件，并在您喜欢的IDE中打开它。</p><p id="6eb6" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">跳到<code class="fe mt mu mv mw b">build.gradle.kts</code>，并添加:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="f14b" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这些是您开始使用第一个端点所需的GraphQL库。</p><h2 id="4c2b" class="mx kz it bd la my mz dn le na nb dp li lz nc nd lk md ne nf lm mh ng nh lo ni bi translated">2.第一个端点</h2><p id="4946" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">在<code class="fe mt mu mv mw b">resources</code>目录中创建一个名为<code class="fe mt mu mv mw b">schema.graphqls</code>的文件。</p><p id="60b3" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">添加以下几行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="6130" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">然后创建一个<code class="fe mt mu mv mw b">resolver</code>类，当客户端触发查询时，该类实际上可以做一些事情。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="6314" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">就是这样。</p><p id="e5a7" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">使用<code class="fe mt mu mv mw b">./gradlew bootRun</code>运行服务器。</p><p id="ac0d" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">进入浏览器，打开<code class="fe mt mu mv mw b">http://localhost:8080/playground</code>。<a class="ae oj" href="https://www.apollographql.com/docs/apollo-server/testing/graphql-playground/" rel="noopener ugc nofollow" target="_blank"> Playground </a>是用作GraphQL APIs客户端的开发工具之一。</p><p id="6b14" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这将是您触发查询时的输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/980c72b4d801ce771b7a5e2a45246d7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bXp3vgDRYOG6LUYwW8KuCQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">操场上的质疑和回应</p></figure><p id="2b05" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">就是这样。</p><h2 id="da21" class="mx kz it bd la my mz dn le na nb dp li lz nc nd lk md ne nf lm mh ng nh lo ni bi translated">3.接口实现</h2><p id="da1b" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">让我们从改变模式开始。在您的<code class="fe mt mu mv mw b">schema.graphqls</code>文件中，添加以下代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="47ea" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">现在添加一些Kotlin类和接口来匹配模式实体。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="0afe" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">在这个映射之后，我们可以开始创建当<code class="fe mt mu mv mw b">getIVehicles</code>查询被触发时获取<code class="fe mt mu mv mw b">IVehicle</code>数据的服务。</p><p id="1c37" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">你需要创建<code class="fe mt mu mv mw b">Resolver</code>和<code class="fe mt mu mv mw b">Service</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="0863" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">就是这样。</p><p id="e521" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">您已经成功地创建了一个端点，它可以用同一个查询获取汽车和自行车数据。多酷啊。</p><p id="0582" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">您可以运行这个查询来获取数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/b6d923d3ce603d4e7da542bbd38a6fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jJPkbUCWON6sDxr3lUclKw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">操场上的问答</p></figure><p id="ec2a" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">等一下！我忘了一些东西。</p><p id="6042" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">在这真正起作用之前，你还需要做一件事。</p><p id="ccd6" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">您需要将这些接口类型添加到GraphQL的模式解析器字典中。</p><p id="c341" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">方法是添加以下代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="5d2d" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这是必须的，因为库中有一个问题，这些类型的自动发现不能工作，除非你明确地把它。</p><p id="d1bd" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">你可以在这里找到问题<a class="ae oj" href="https://github.com/graphql-java-kickstart/graphql-java-tools/issues/97#issuecomment-364860537" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="9352" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">就是这样。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="71e0" class="ky kz it bd la lb oe ld le lf of lh li jz og ka lk kc oh kd lm kf oi kg lo lp bi translated">结论</h1><p id="cf77" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">我没有在这里添加<code class="fe mt mu mv mw b">Union</code>的实现，因为它与接口的实现非常相似。不要担心:如果你感兴趣，你可以在这里找到实现<a class="ae oj" href="https://github.com/maniish-jaiin/graphql-interfaces-unions" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="6fe2" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我很高兴你坚持到了最后。这意味着您对实现GraphQL感兴趣。下面是另一篇<a class="ae oj" href="https://levelup.gitconnected.com/6-months-of-using-graphql-faa0fb68b4af" rel="noopener ugc nofollow" target="_blank">文章</a>，分享我使用GraphQL六个月的经验。</p></div></div>    
</body>
</html>