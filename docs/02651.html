<html>
<head>
<title>Setting Up Kubernetes for Local Development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立Kubernetes促进地方发展</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/setting-up-kubernetes-for-local-development-3a9557fbc4af?source=collection_archive---------6-----------------------#2019-12-15">https://betterprogramming.pub/setting-up-kubernetes-for-local-development-3a9557fbc4af?source=collection_archive---------6-----------------------#2019-12-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6a8d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将您的生产环境与本地环境相匹配</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c88cba37912289a904f942190fd5e064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AXpdlQHYUqs29mib0AfC8g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">伊利亚·巴甫洛夫在<a class="ae ky" href="https://unsplash.com/s/photos/computer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="165e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">公司已经在生产中迁移到Kubernetes，但是仍然有许多开发者将应用程序作为开发机器运行，或者使用像<a class="ae ky" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"> Docker Compose </a>这样的工具来运行和测试他们的应用程序。</p><p id="f1b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于大多数开发人员不需要完全了解Kubernetes，我们需要一种方法让他们在本地机器上通过运行一个命令来测试他们的应用程序。</p><p id="0039" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像<a class="ae ky" href="https://kubernetes.io/docs/tasks/tools/install-minikube/" rel="noopener ugc nofollow" target="_blank"> Minikube </a>和<a class="ae ky" href="https://draft.sh/" rel="noopener ugc nofollow" target="_blank"> Draft </a>这样的工具将帮助我们实现这一目标。在这篇文章中，我们将看到如何。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="23e9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">基本设置</strong></h1><p id="9cb4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要为开发人员设置开发环境，机器需要一个可工作的Kubernetes节点，并安装其他工具。开发人员设置要求:</p><ul class=""><li id="7f61" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">迷你库贝</li><li id="74a9" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">库贝特尔</li><li id="4405" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><a class="ae ky" href="https://helm.sh/" rel="noopener ugc nofollow" target="_blank">舵</a></li><li id="1fed" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">草稿，<a class="ae ky" href="https://skaffold.dev/" rel="noopener ugc nofollow" target="_blank">斯卡福德</a>或<a class="ae ky" href="https://garden.io/" rel="noopener ugc nofollow" target="_blank">花园. io </a></li><li id="1540" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">Docker(可选)</li></ul><p id="6fee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了自动化本地部署，我们可以使用许多可用的工具，如Draft、Skaffold或Garden.io。</p><p id="ded1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要找出这三者之间的区别，请阅读托马斯·普利卡斯的博客，他在博客中对这三者进行了比较。</p><p id="a930" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用这个sh文件来安装所有的工具，使您的本地开发环境对草稿友好。这个脚本会自动下载上面提到的所有工具。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4528" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">起草</h1><p id="8555" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://draft.sh/" rel="noopener ugc nofollow" target="_blank"> Draft </a>是微软开发的一个项目，帮助开发者构建一个可以部署到Kubernetes集群的应用。</p><p id="92d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Draft的目标是开发人员工作流程的“内部循环”,这意味着无需提交源代码控制，开发人员就可以将该特性部署到集群中。</p><h2 id="c9db" class="nn md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">面临的问题</h2><p id="fa67" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要将应用程序部署到集群，首先，Draft必须构建Docker映像，然后将它推送到Kubernetes集群可以访问的存储库。</p><p id="63aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，Draft使用运行在dev机器上的docker-daemon，所以集群不能访问docker映像。草案还提供了将构建的Docker映像推送到Docker存储库服务器的选项，但这在我们试图部署到生产环境时非常有用。</p><p id="054c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有些人还建议在你的本地Kubernetes集群上制作一个Docker注册服务器，并把镜像推送到那里，这也是一个不错的方法，但我认为这有点矫枉过正。</p><p id="da0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有一个简单的解决方案，那就是使用Kubernetes docker-daemon来构建docker映像。这可以通过运行以下命令来完成:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="26f7" class="nn md it oa b gy oe of l og oh">$ eval $(minikube docker-env)</span></pre><p id="f78e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令将Minikube docker-daemon暴露给终端。因此，如果您在终端中构建任何映像，它将由Minikube docker-daemon构建。</p><p id="8151" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当Kubernetes试图提取图像时，它会在本地找到它，并使用该图像。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9b54" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置步骤</h1><ul class=""><li id="f24f" class="mz na it lb b lc mu lf mv li oi lm oj lq ok lu ne nf ng nh bi translated">安装上面提到的工具。Mac用户可以使用<a class="ae ky" href="https://github.com/ashish932/localKubernetesSetup" rel="noopener ugc nofollow" target="_blank">这个脚本。</a></li><li id="695f" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">启动集群并初始化工具。</li></ul><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="cc85" class="nn md it oa b gy oe of l og oh">minikube start</span><span id="2b57" class="nn md it oa b gy ol of l og oh">helm init</span><span id="132c" class="nn md it oa b gy ol of l og oh">draft init</span></pre><ul class=""><li id="f332" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">第一次使用<code class="fe om on oo oa b">draft create</code>，会生成Docker文件和舵图。根据自己的需求定制。(仅一次)</li></ul><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="c700" class="nn md it oa b gy oe of l og oh">draft create</span></pre><ul class=""><li id="a821" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">使用<code class="fe om on oo oa b">draft up</code>将应用部署到Kubernetes集群。</li></ul><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="4e99" class="nn md it oa b gy oe of l og oh">draft up</span></pre><p id="6074" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的应用程序将被部署到入口中提供的主机名。将该路径添加到您的DNS文件，并将其定向到Minikube IP。</p><ul class=""><li id="1e97" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">查找Minikube正在哪个IP上运行。</li></ul><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="9668" class="nn md it oa b gy oe of l og oh">$ minikube ip</span></pre><ul class=""><li id="71fa" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">对于Mac和Linux用户，请更新/etc/host</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2e56" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">资源</h1><div class="op oq gp gr or os"><a href="https://codefresh.io/howtos/local-k8s-draft-skaffold-garden/" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">Kubernetes上的本地发展终极指南:Draft vs ska ffold vs garden . io-code fresh</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">在本系列的前几篇文章中，我们已经看到了专门为…设计的本地Kubernetes装置</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">codefresh.io</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg ks os"/></div></div></a></div><div class="op oq gp gr or os"><a href="https://github.com/ASHISH932/localKubernetesSetup" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">ashish 932/localkubernestsetup</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">github.com</p></div></div><div class="pb l"><div class="ph l pd pe pf pb pg ks os"/></div></div></a></div></div></div>    
</body>
</html>