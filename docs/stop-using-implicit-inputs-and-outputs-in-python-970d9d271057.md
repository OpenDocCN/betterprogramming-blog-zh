# 停止使用隐式输入和输出

> 原文：<https://betterprogramming.pub/stop-using-implicit-inputs-and-outputs-in-python-970d9d271057>

## 提高代码可测试性和可重用性的一个简单方法

![](img/9b17d838ee29cd1b238e865e03ffb3e5.png)

图片由 goodstudio 通过 Canva.com 提供

与 Python 开发者相处足够长的时间，你会听到所有关于 Tim Peter 的关于 Python 的*禅。*

通过在 Python REPL 中执行`import this`，你可以[方便地阅读](https://peps.python.org/pep-0020/)的*禅*，它展示了 Python 设计背后的 20 条指导原则中的 19 条。最近，我开始更欣赏一句格言:“明确的比含蓄的好。”

我见过的最常见的解释是，冗长的代码比简洁的代码更好，因为显而易见，冗长是可读性的关键……或者其他什么。

当然，使用更好的变量名和用命名的常量(或者在 Python 中是“常量”)替换[幻数](https://en.wikipedia.org/wiki/Magic_number_(programming))都是很棒的事情。但是你上一次在代码中找到隐式输入并使它们显式化是什么时候？

# 如何识别隐含的输入和输出

下列函数有多少输入和输出？

`find_big_numbers()`没有参数，总是返回`None`。如果你看不到函数体，不能访问[标准输出流](https://en.wikipedia.org/wiki/Standard_streams#Standard_output_(stdout))，你会相信这个函数做了什么吗？

然而，`find_big_numbers()`除了`None`还有两个输入和一个输出:

*   `numbers.txt`是隐式输入。没有它函数就不行，但是不读函数体是不可能知道文件是需要的。
*   第 6 行的幻数`100`是一个隐式输入。没有它你不能定义一个“大数”，但是不读函数体也没办法知道那个阈值。
*   数值可能会也可能不会打印到`stdout`，这取决于`numbers.txt`的内容。这是一个隐式输出，因为该函数不返回这些值。

隐性输出通常被称为副作用。

## 你自己试试

在下面的代码片段中确定`is_adult`函数的所有输入和输出:

# 为什么应该避免隐式输入和输出

一个很好的理由是他们倾向于违反最小惊喜原则。

当然，并不是所有的隐性投入和产出都是不好的。Python 文件对象使用类似于`.write()`的方法将数据写入文件，该方法有一个隐式输出:文件。没有办法消除。但这并不奇怪。写入文件是关键所在。

另一方面，前面代码片段中类似于`is_adult()`的函数做了很多令人惊讶的事情。不那么极端的例子比比皆是。

> **提示:**在 GitHub 上通读一些你最喜欢的库的代码，看看你是否能发现隐含的输入和输出，这是一个很好的练习。问问你自己:他们中有让你吃惊的吗？

避免隐式输入和输出也提高了代码的可测试性和可重用性。为了了解如何实现，让我们重构前面的`find_big_numbers()`函数。

# 如何移除隐式输入和输出

这里又是`find_big_numbers()`，所以你不必向上滚动:

前面，我们确定了两个隐式输入，即`numbers.txt`文件和数字`100`，以及一个隐式输出，即打印到`stdout`的值。让我们先处理输入。

您可以将文件名和阈值移动到函数的参数中:

这已经极大地提高了可测试性和可重用性。如果您想在不同的文件上尝试，请将路径作为参数传递。(另外，该文件现在可以放在计算机上的任何地方。)如果需要，您还可以更改“大数字”的阈值。

但是输出很难测试。

如果你想知道函数产生了正确的值，你需要截取`stdout`。有可能。但是为什么不返回所有值的列表呢:

现在`find_big_numbers()`有了一个显式的`return`语句，返回在文件中找到的大数字列表。

您可以测试`find_big_numbers()`,方法是使用已知内容的文件路径调用它，并将返回的列表与正确值列表进行比较:

`find_big_numbers()`现在也更加可重用了。您不限于将数字打印到`stdout`。你可以把那些大数字送到任何你想去的地方。

# 让我们回顾一下:

隐式输入是函数或程序使用的数据，它们不作为参数显式传递。您可以通过将隐式输入重构为参数来消除它们。

隐式输出是发送到函数或程序外部的数据，这些数据不会显式返回。您可以通过用合适的返回值替换显式输出来移除它们。

并不是所有的隐式输入和输出都可以避免，比如目的是从文件和数据库中读取或写入数据或者发送电子邮件的函数。尽管如此，尽可能多地消除隐式输入和输出可以提高代码的可测试性和可重用性。

所以这里有一个带回家的问题:我们是否从`find_big_numbers()`中移除了所有隐含的输入和输出？

*好奇 Python 的禅宗里第二十行怎么了？互联网上流传着各种各样的理论。* [*这一个*](https://stackoverflow.com/questions/4504487/the-zen-of-python-distils-the-guiding-principles-for-python-into-20-aphorisms-bu/24814971#24814971) *在我看来相当有可能。*

*本文最初发表在《好奇的代码》时事通讯上。* [*订阅此处*](https://davidamos.dev/curious-about-code-newsletter/) *抢先看每期。*