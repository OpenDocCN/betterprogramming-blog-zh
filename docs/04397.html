<html>
<head>
<title>How to Integrate Google Pay Into Your Existing Android App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Google Pay集成到您现有的Android应用程序中</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-integrate-google-pay-into-your-existing-android-app-d75b269cd623?source=collection_archive---------2-----------------------#2020-04-10">https://betterprogramming.pub/how-to-integrate-google-pay-into-your-existing-android-app-d75b269cd623?source=collection_archive---------2-----------------------#2020-04-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7143" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">开始通过GPay接受付款</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/62ccc73fc982f59793070aced999a4e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_-RkDVtFPZja6fRwvkvCpA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@mattykwong1?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Matthew Kwong </a>在<a class="ae ky" href="https://unsplash.com/s/photos/google-pay?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="4eef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将了解如何将最常用的支付网关之一<a class="ae ky" href="https://play.google.com/store/apps/details?id=com.google.android.apps.walletnfcrel&amp;hl=en_US" rel="noopener ugc nofollow" target="_blank"> GPay </a>集成到您现有的Android应用程序中。除了集成，本文还包括用户是否可以使用GPay支付以及执行过程。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0210" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么是GPay？</h1><p id="1570" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">作为人类，我们工作的倾向主要取决于我们工作的能力。</p><p id="e4b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，客户可以选择他们的卡并输入他们的详细信息，但为什么不通过使用他们手机中已经存在的支付详细信息来让客户更容易一些呢，比如GPay。</p><p id="f41f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在你的应用中实现这样的支付网关将增加用户实际支付的机会。</p><p id="d249" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几乎每个Android用户都以这样或那样的方式，出于某种原因依赖于谷歌，例如谷歌助手用于提醒，Keep用于记笔记，以及最近的谷歌支付。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="35ed" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">综合</h1><p id="28d1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这里，我们使用Google Pay API来集成GPay支付网关。为了整合这一点，在应用程序级<code class="fe mz na nb nc b">build.gradle</code>文件中的<code class="fe mz na nb nc b">dependencies</code>节点下添加下面一行。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="0a07" class="nh md it nc b gy ni nj l nk nl">implementation "com.google.android.gms:<strong class="nc iu">play-services-wallet</strong>:18.0.0"</span></pre><p id="2f5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要在清单文件中添加以下元数据来启用API。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="bae5" class="nh md it nc b gy ni nj l nk nl">&lt;meta-data<br/>    android:name="com.google.android.gms.wallet.api.enabled"<br/>    android:value="true" /&gt;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3a7e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">配置Google Pay API</h1><p id="f162" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们已经完成了集成部分，是时候配置API了。要使用API，我们必须实例化一个客户端对象，通过它我们可以调用Google Pay API。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="ad71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里出于开发目的，我使用了<code class="fe mz na nb nc b">ENVIRONMENT_TEST</code>，但是当您准备投入生产时，您可以通过将它改为<code class="fe mz na nb nc b"> ENVIRONMENT_PRODUCTION</code>来将环境改为生产环境。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a91e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建请求</h1><p id="bc58" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要创建请求，首先，我们需要创建一个JSON对象，包括我们支持的所有卡类型和支付认证。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="6161" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在文档中找到可用于配置请求<a class="ae ky" href="https://developers.google.com/pay/api/android/reference/request-objects#CardParameters" rel="noopener ugc nofollow" target="_blank">的卡参数的完整列表。</a></p><p id="c5a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于卡认证机制:在处理支付时，可以选择卡，以确定如何通过处理器或网关对交易进行认证。</p><p id="a687" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当使用主账号(PAN)认证时，卡账号和到期月份和年份被发送到支付处理器。这允许您的用户使用以前存储的卡。</p><p id="0986" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基于动态密码的身份验证与卡令牌化相结合，卡令牌化是一种用除了客户的发卡方之外任何人都无法理解的随机值来替换客户的卡信息的机制。</p><p id="293e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这与动态密码相结合，确保了发送到处理器的令牌对于每次交易都是不同的，从而显著提高了这些操作的安全性。<a class="ae ky" href="https://developers.google.com/pay/api/android/reference/request-objects#CardParameters" rel="noopener ugc nofollow" target="_blank"> API文件</a>。</p><p id="d049" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除此之外，我们还应该指定您正在连接的Google Pay的API版本。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="a357" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经有了创建请求所需的东西，是时候创建一个请求并验证他们是否可以通过Google Pay API进行支付了。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="7264" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，首先，我们创建一个<code class="fe mz na nb nc b">IsReadyToPayRequest</code>，我们用它来调用<code class="fe mz na nb nc b">isreadyToPay</code>函数，从而产生一个<code class="fe mz na nb nc b">task</code>对象。</p><p id="4892" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来在<code class="fe mz na nb nc b">task </code>对象上，我们必须添加<code class="fe mz na nb nc b">addOnCompleteListener</code>来检查Google Pay API是否可用。最后，当我们得到一个成功的响应时，我们可以启用Google Pay按钮。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b782" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">该付钱了</h1><p id="e8d9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">终于到了付钱的时候了。要创建一个事务，我们需要两组数据，比如<code class="fe mz na nb nc b">transactionInfo</code>和<code class="fe mz na nb nc b">merchantInfo</code>。</p><h2 id="e8fc" class="nh md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">交易信息</h2><p id="b5e3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在这里，我们可以定义他们必须支付的金额和货币等细节。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h2 id="2318" class="nh md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated"><code class="fe mz na nb nc b">MerchantInfo</code></h2><p id="1948" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在这里，我们可以定义商家的详细信息，如他们的姓名和商家ID。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="8cd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，是时候将我们之前创建的支付配置与<code class="fe mz na nb nc b">transactionInfo</code>和<code class="fe mz na nb nc b">merchantInfo</code>结合起来了。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="0a2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们通过传递<code class="fe mz na nb nc b">paymentDataRequestJson</code>创建了一个<code class="fe mz na nb nc b">paymentDataRequest</code>，然后使用<code class="fe mz na nb nc b">resolveTask</code>函数执行任务，该函数有三个参数，<code class="fe mz na nb nc b">Task&lt;TResult&gt;</code>、<code class="fe mz na nb nc b">Activity</code>和<code class="fe mz na nb nc b">Int</code>作为<code class="fe mz na nb nc b">request-id</code>。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="f0c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在用户将继续进行Google Pay交易，完成后，您将在<code class="fe mz na nb nc b">onActivityResult</code>中收到交易的响应。您可以处理所有成功和失败状态，如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="198b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>