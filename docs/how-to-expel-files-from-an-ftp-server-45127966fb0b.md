# 如何从 FTP 服务器中驱逐文件

> 原文：<https://betterprogramming.pub/how-to-expel-files-from-an-ftp-server-45127966fb0b>

## 它会像我们最喜欢的巫师咒语一样神奇

![](img/d2401b353283e000980b62bbcac5a89c.png)

由[路易丝·史密斯](https://unsplash.com/@louisesmithphotos?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄。

对于房间里所有的恐龙，我不会解释什么是文件传输协议(FTP)。但是对于不熟悉这个协议的人，我推荐先阅读[这篇文章](https://source.raysync.io/news/what-is-file-transfer-protocol)。

让我们面对现实:FTP 仍然被广泛使用，主要是因为它仍然是一种简单可靠的存储文件的方式。以下是一些使用案例:

*   存储图像并将它们的 URL 暴露给 API。
*   出于恢复目的存档文件。
*   在任何客户端上安装可执行文件(例如 Android APK 文件)。

在本文中，我们将重点关注上传部分。当然，我们中的大多数人会选择简单的方法，使用免费的 GUI，如 [Cyberduck](https://source.raysync.io/news/what-is-file-transfer-protocol) 。但在某些情况下，如果您需要定期上传相同的文件，这可能会变得繁琐和耗时。

让我向您展示如何通过一个命令行神奇地实现这一点。

# Shell 脚本的魔力

为了保持旧式技术，我们将构建一个 shell 脚本。它将负责:

*   连接到 FTP 服务器。
*   上传想要的文件到想要的路径。
*   在服务器内移动文件。

所以举起你的魔杖，让魔法发生吧！

## **1。连接到您的服务器**

要连接 FTP 服务器，您需要三个参数:

1.  FTP 主机地址
2.  用户名
3.  一个密码

让我们称这些参数为`FTP_HOST`、`FTP_USER`和`FTP_PWD`。

*注意:您可以在本地存储它们的值，但是我建议您在一个可信的持续集成平台下声明它们——尤其是当您与您的团队共享脚本时。*

让我们从创建一个 shell 脚本文件开始:

```
**$** touch upload_to_ftp.sh
```

然后添加这几行代码:

如果我们分解这几行代码，我们会得到如下结果:

1.  首先，我们将连接命令重定向到一个文本文件。
2.  我们用包含所需指令的文件执行`lftp`命令——当给定一个文件作为参数时,`-f`选项很重要。
3.  我们清理不再需要的临时文件。

试试吧！

```
**$** ./upload_to_ftp.sh
```

如果一切顺利，你应该会得到…什么都没有。提示将产生，意味着连接已成功建立并终止。否则，您将得到:

*   `lftp`未安装在您的机器上。

```
./upload_to_ftp.sh: line 8: lftp: command not found
```

*   主机地址错误。

```
open: FTP_HOST: nodename nor servname provided, or not known
```

## **2。上传文件到 FTP**

到目前为止，我们已经构建了脚本的框架。建立连接后，就该上传文件到你的 FTP 服务器了。

你需要两样东西:

1.  您要在 FTP 上上传文件的位置
2.  文件的路径

姑且称之为`FTP_DIR`和`FTP_FILE`。

*注意:这些位置可以是本地的，也可以是远程机器上的。这也意味着这些值必须是已知的和固定的。否则，您可以想象在执行脚本时提示他们。*

一旦你找到了这些路径，在调用`lftp`命令之前添加这一行:

```
echo "put -O $FTP_DIR $FTP_FILE" >> ftp.txt
```

尝试再次执行您的脚本。如果您在 FTP 服务器上的期望位置看到了您的文件，那么您就成功了！如果没有，请确保您的路径是正确的。

## 3.在 FTP 中移动文件

在某些情况下，您可能想要移动已经上传到 FTP 服务器上的一些文件(例如，出于存档目的)。

假设您在上传文件的同一层有一个`Archives`文件夹。然后你只需要指出目标文件夹和你想移动的文件。

```
echo "mmv -O $FTP_DIR/Archives $FTP_DIR/$FTP_FILE" >> ftp.txt
```

这个想法是在上传新文件之前，将当前上传的文件移动到`Archives`文件夹*中。所以一定要把这一行放在上传步骤之前。以下是完整的代码:*

*注意:* `*mmv*` *最近增加了一个* `*lftp*` *，如果你想移动几个匹配正则表达式的文件，它接受通配符(* `***` *)。但是，请确保您至少拥有 4.8.0 版本，否则将无法兼容。*

# 通过多文件上传进一步自动化

如果能一次上传几个文件不是更好吗？我们只需要文件名，并用上面的脚本为每个文件重复上传命令。

让我们看一个例子。我们有一套 Android 应用程序，我们想把它们分发到我们的 FTP 服务器上。我们的应用有三个版本:

*   awesome_app_free.apk
*   awesome_app_pro.apk
*   awesome_app_enterprise.apk

它们都位于同一条路径上。我们知道他们的文件名。

如果我们想一次上传所有这些文件，下面是脚本的样子:

# 结论

如果你还和我在一起，那么你就拥有了启动自动化管道的所有钥匙。它们将节省您的时间和精力，更不用说您将减少手动错误(错误的文件上传，错误的位置等)。).

保持安全，尽可能自动化！