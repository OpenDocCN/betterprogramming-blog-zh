<html>
<head>
<title>Everything You Want to Know About Android Jetpack’s Navigation Component</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你想知道的关于Android Jetpack导航组件的一切</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/everything-about-android-jetpacks-navigation-component-b550017c7354?source=collection_archive---------1-----------------------#2020-02-20">https://betterprogramming.pub/everything-about-android-jetpacks-navigation-component-b550017c7354?source=collection_archive---------1-----------------------#2020-02-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="61c0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">它是什么，我们如何使用它？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/34f05bd0300131fee535f526ba9133f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jv8LPum6s2MzLL3JDJVJEw.png"/></div></div></figure><p id="58f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Android中，我们通常使用<code class="fe lq lr ls lt b">Intent</code>来编写导航逻辑，以便在活动之间移动，使用<code class="fe lq lr ls lt b">fragment transactions</code>来在片段之间导航。谷歌的导航架构组件简化了Android应用程序中的导航。在这篇文章中，我们讨论了使用<code class="fe lq lr ls lt b">Navigation</code>组件的基本和高级方法。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="20c4" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">出了什么问题？</h1><p id="6878" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">当开发具有多个片段的应用程序时，我们倾向于进行大量的片段事务来在它们之间导航。编写这些片段事务和处理后台堆栈需要一定的努力。如果您没有以正确的方式实现它，另一个主要问题是可能发生的<code class="fe lq lr ls lt b">IllegalStateException</code> <strong class="kw iu"> </strong>。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="92c0" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">解决办法</h1><p id="474c" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">为了让导航更容易，谷歌引入了<code class="fe lq lr ls lt b">Navigation</code>组件。在导航组件的帮助下，编写片段之间的导航和处理案例(如后台堆栈、异常案例等)将变得很容易。让我们开始探索<code class="fe lq lr ls lt b">Navigation</code>组件。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="9464" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">导航组件是什么？</h1><p id="0d44" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">组件是一组简化Android导航的库、插件和工具。Android Jetpack的<code class="fe lq lr ls lt b">Navigation</code>组件帮助我们实现<em class="my">导航</em>，从简单的按钮点击到更复杂的模式，比如应用程序栏和导航抽屉。<code class="fe lq lr ls lt b">Navigation</code>组件还通过遵循一套既定原则来确保一致且可预测的用户体验。</p><p id="be24" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">Navigation</code>组件由三个关键部分组成。</p><h2 id="17ed" class="mz mc it bd md na nb dn mh nc nd dp ml ld ne nf mn lh ng nh mp ll ni nj mr nk bi translated">导航图</h2><p id="c83d" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">这是一种新的资源类型——在一个集中的位置包含所有导航相关信息的XML文件。这包括应用程序中所有单独的内容区域，称为目的地，以及用户在应用程序中可能选择的路径。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/a0eb8a0e27980739e09634fa8acc05e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K39Yeuk5yv_F-zbGDB0ktw.png"/></div></div></figure><p id="9929" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">导航编辑器中的<code class="fe lq lr ls lt b">Navgraph</code>可以如上图所示。上面的屏幕被称为目的地——它们只不过是片段。这些目的地之间的箭头称为动作，它们定义了用户可以选择的导航路径。</p><h2 id="bf12" class="mz mc it bd md na nb dn mh nc nd dp ml ld ne nf mn lh ng nh mp ll ni nj mr nk bi translated">NavHost </h2><p id="bf86" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">这是一个空容器，显示导航图中的目的地。<code class="fe lq lr ls lt b">Navigation</code>组件包含一个默认的<code class="fe lq lr ls lt b">NavHost</code>实现<code class="fe lq lr ls lt b">NavHostFragment</code> <strong class="kw iu">，</strong>，它显示了片段的目的地。</p><h2 id="f75a" class="mz mc it bd md na nb dn mh nc nd dp ml ld ne nf mn lh ng nh mp ll ni nj mr nk bi translated"><strong class="ak">导航控制器</strong></h2><p id="bc13" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">在<code class="fe lq lr ls lt b">NavHost</code>中管理应用导航的对象。当用户在你的应用中移动时，<code class="fe lq lr ls lt b">NavController</code>协调<code class="fe lq lr ls lt b">NavHost</code>中目的内容的交换。</p><p id="bc72" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="my">注意:导航图可以在Android Studio 3.3新推出的</em> <strong class="kw iu"> <em class="my">导航编辑器</em> </strong> <em class="my">中可视化。这个很棒的功能让我们可以在一个地方看到所有的导航</em></p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="5c73" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">利益</h1><p id="2b76" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated"><code class="fe lq lr ls lt b">Navigation</code>组件提供了许多其他优势，包括:</p><ul class=""><li id="ff5a" class="nm nn it kw b kx ky la lb ld no lh np ll nq lp nr ns nt nu bi translated">处理片段事务。</li><li id="df0a" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated">默认情况下正确处理<code class="fe lq lr ls lt b">Up</code>和<code class="fe lq lr ls lt b">Back</code>动作。</li><li id="764e" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated">为动画和过渡提供标准化的资源。</li><li id="b80f" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated">实现和处理深度链接。</li><li id="bd94" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated">包括导航UI模式，如导航抽屉和底部导航，只需最少的额外工作。</li><li id="c448" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated"><a class="ae oa" href="https://developer.android.com/guide/navigation/navigation-pass-data#Safe-args" rel="noopener ugc nofollow" target="_blank">安全参数</a> —一个Gradle插件，在目的地之间导航和传递数据时提供类型安全。</li><li id="1e3a" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated"><code class="fe lq lr ls lt b">ViewModel</code>支持——您可以将<code class="fe lq lr ls lt b">ViewModel</code>限定在导航图中，以便在图的目的地之间共享与UI相关的数据。</li></ul></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="d554" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">例子</h1><p id="29a8" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">让我们通过创建一个简单的例子来看看这个组件是如何工作的。我们将创建一个简单的带有两个片段的<code class="fe lq lr ls lt b">Activity</code>，并检查我们如何使用<code class="fe lq lr ls lt b">Navigation</code>组件在这些片段之间导航</p><h2 id="c0dc" class="mz mc it bd md na nb dn mh nc nd dp ml ld ne nf mn lh ng nh mp ll ni nj mr nk bi translated">第一步</h2><p id="64aa" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">创建一个支持androidx的新项目，或者重构您的代码库以支持androidx。AndroidX是一个开源项目，Android团队使用它在Jetpack中开发、测试、打包、版本化和发布库。点击<a class="ae oa" href="https://developer.android.com/jetpack/androidx" rel="noopener ugc nofollow" target="_blank"> Androidx概述</a>查看更多信息。</p><h2 id="4e39" class="mz mc it bd md na nb dn mh nc nd dp ml ld ne nf mn lh ng nh mp ll ni nj mr nk bi translated"><strong class="ak">第二步</strong></h2><p id="6704" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">在<code class="fe lq lr ls lt b">build.gradle</code>中添加依赖关系。</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="991c" class="mz mc it lt b gy of og l oh oi">dependencies {<br/>  def nav_version = "2.3.0-alpha02"<br/><br/>  // Java language implementation<br/>  implementation "androidx.navigation:navigation-fragment:$nav_version"<br/>  implementation "androidx.navigation:navigation-ui:$nav_version"<br/><br/>  // Kotlin<br/>  implementation "androidx.navigation:navigation-fragment-ktx:$nav_version"<br/>  implementation "androidx.navigation:navigation-ui-ktx:$nav_version"<br/><br/>  // Dynamic Feature Module Support<br/>  implementation "androidx.navigation:navigation-dynamic-features-fragment:$nav_version"<br/><br/>  // Testing Navigation<br/>  androidTestImplementation "androidx.navigation:navigation-testing:$nav_version"<br/>}</span></pre><p id="2a8a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些是不同需求的不同依赖项。根据您的需求选择。</p><h2 id="b110" class="mz mc it bd md na nb dn mh nc nd dp ml ld ne nf mn lh ng nh mp ll ni nj mr nk bi translated"><strong class="ak">第三步</strong></h2><p id="079c" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">创建导航图。</p><p id="679c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要将导航图添加到项目中:</p><ul class=""><li id="ea9e" class="nm nn it kw b kx ky la lb ld no lh np ll nq lp nr ns nt nu bi translated">在项目窗口中，右键单击res目录并选择New &gt; Android Resource File。将出现“新建资源文件”对话框。</li><li id="6e42" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated">在文件名字段中键入一个名称，如“nav_graph”。</li><li id="4118" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated">从资源类型下拉列表中选择导航，然后单击确定。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/fbc1c73fbf15a5eaa98c2f184af7a485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G4SCmE3i3lodeZjyr9JDuQ.png"/></div></div></figure><p id="e766" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当您添加第一个导航图时，Android Studio会在<code class="fe lq lr ls lt b">res</code>目录中创建一个<code class="fe lq lr ls lt b">navigation</code>资源目录。该目录包含导航图资源文件。创建的文件将如下所示:</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="75d2" class="mz mc it lt b gy of og l oh oi">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;<strong class="lt iu">navigation</strong> xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    android:id="@+id/nav_graph"&gt;</span><span id="811d" class="mz mc it lt b gy ok og l oh oi">&lt;/<strong class="lt iu">navigation</strong>&gt;</span></pre><p id="b71d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">&lt;navigation&gt;</code>元素是导航图的根元素。当您将目的地和连接动作添加到图表中时，您可以在这里看到相应的<code class="fe lq lr ls lt b">&lt;destination&gt;</code>和<code class="fe lq lr ls lt b">&lt;action&gt;</code>元素作为子元素。如果您有<a class="ae oa" href="https://developer.android.com/guide/navigation/navigation-nested-graphs" rel="noopener ugc nofollow" target="_blank">嵌套图</a>，它们会显示为子<code class="fe lq lr ls lt b">&lt;navigation&gt;</code>元素。</p><h2 id="aefb" class="mz mc it bd md na nb dn mh nc nd dp ml ld ne nf mn lh ng nh mp ll ni nj mr nk bi translated"><strong class="ak">第三步</strong></h2><p id="7127" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">向活动XML文件添加一个<code class="fe lq lr ls lt b">NavHost</code></p><p id="2495" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一个<code class="fe lq lr ls lt b">nav_host_fragment</code>的解剖:</p><ul class=""><li id="5b90" class="nm nn it kw b kx ky la lb ld no lh np ll nq lp nr ns nt nu bi translated">属性包含了你的<code class="fe lq lr ls lt b">NavHost</code>的类名。实施。</li><li id="c491" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated"><code class="fe lq lr ls lt b">app:navGraph</code>属性将<code class="fe lq lr ls lt b">NavHostFragment</code>与导航图相关联。导航图指定了此<code class="fe lq lr ls lt b">NavHostFragment</code>中用户可以导航到的所有目的地。</li><li id="26c0" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated">属性确保你的<code class="fe lq lr ls lt b">NavHostFragment</code>拦截系统返回按钮。注意只有一个<code class="fe lq lr ls lt b">NavHost</code> <strong class="kw iu"> </strong>可以默认。如果在同一布局中有多个主机(例如双窗格布局)，请确保只指定一个默认的<code class="fe lq lr ls lt b">NavHost</code>。</li></ul><h2 id="c995" class="mz mc it bd md na nb dn mh nc nd dp ml ld ne nf mn lh ng nh mp ll ni nj mr nk bi translated"><strong class="ak">第四步</strong></h2><p id="fe77" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">在<code class="fe lq lr ls lt b">nav_graph</code>中添加目的地和路径。</p><p id="3fbb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在添加目的地之前，创建两个片段及其XML:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/ab1a1364345c6fa52c9e628b40e71e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SnigVsRmFPEixgKmBQG-gQ.png"/></div></div></figure><p id="c5a6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在为<code class="fe lq lr ls lt b">FragmentOne</code>类创建XML文件。</p><p id="eb7c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样，创建第二个片段。现在让我们将目的地添加到<code class="fe lq lr ls lt b">nav_graph</code>中。</p><p id="ea46" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">目的地剖析:</p><ul class=""><li id="af5e" class="nm nn it kw b kx ky la lb ld no lh np ll nq lp nr ns nt nu bi translated"><code class="fe lq lr ls lt b">Type</code>字段指示目的地是作为源代码中的片段、活动还是其他自定义类来实现的。</li><li id="a40f" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated"><code class="fe lq lr ls lt b">Label</code>字段包含目标XML布局文件的名称。</li><li id="ffde" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated"><code class="fe lq lr ls lt b">ID</code>字段包含目的地的ID，用于在代码中引用目的地。</li><li id="77d0" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated"><code class="fe lq lr ls lt b">Class</code>下拉菜单显示与目的地相关的类的名称。您可以单击此下拉列表将关联的类更改为另一个目标类型。</li></ul><p id="201d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在导航编辑器中，视图如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/8d9975c98a28aa603fbf8345cab8711d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xLOsq0959OVjsJW7IxrhVw.png"/></div></div></figure><p id="469a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在将<code class="fe lq lr ls lt b">NavHost</code>添加到<code class="fe lq lr ls lt b">activity_main</code> XML文件中:</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="4bfd" class="mz mc it lt b gy of og l oh oi">&lt;androidx.constraintlayout.widget.ConstraintLayout<br/>    xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"<br/>    tools:context=".MainActivity"&gt;<br/><br/><br/><br/>    &lt;fragment<br/>        android:id="@+id/nav_host_fragment"<br/>        android:name="<strong class="lt iu">androidx.navigation.fragment.NavHostFragment</strong>"<br/>        android:layout_width="match_parent"<br/>        android:layout_height="match_parent"<br/>        app:defaultNavHost="true"<br/>        app:navGraph="@navigation/nav_graph" /&gt;<br/><br/>&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span></pre><p id="0873" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的<code class="fe lq lr ls lt b">MainActivity</code>会是这样的:</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="7b4b" class="mz mc it lt b gy of og l oh oi">package com.example.navigationsample</span><span id="2d9f" class="mz mc it lt b gy ok og l oh oi">import android.support.v7.app.AppCompatActivity<br/>import android.os.Bundle<br/>import androidx.navigation.findNavController</span><span id="15e0" class="mz mc it lt b gy ok og l oh oi">class MainActivity : AppCompatActivity() {</span><span id="9854" class="mz mc it lt b gy ok og l oh oi">    override fun <strong class="lt iu">onCreate</strong>(savedInstanceState: Bundle?) {<br/>        super.onCreate(savedInstanceState)<br/>        setContentView(R.layout.<em class="my">activity_main</em>)<br/>    }</span><span id="7a90" class="mz mc it lt b gy ok og l oh oi">    override fun <strong class="lt iu">onSupportNavigateUp</strong>() = <em class="my">findNavController</em>(R.id.<strong class="lt iu"><em class="my">nav_host_fragment</em>).navigateUp()</strong></span><span id="744c" class="mz mc it lt b gy ok og l oh oi">}</span></pre><p id="3caa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就这样——我们结束了。</p><p id="028f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">点击运行按钮，查看<code class="fe lq lr ls lt b">Navigation</code>组件的神奇之处:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/3a0394683f692f46e7645199e134d5d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:330/1*KReJ8jvbNQT3xW49bhwmhQ.gif"/></div><p class="on oo gj gh gi op oq bd b be z dk translated">带后栈的FragmentOne</p></figure><p id="8c7d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">神奇之处在于片段一中的一行代码，按钮上的点击操作——因此不需要片段事务。</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="060f" class="mz mc it lt b gy of og l oh oi">btn_next.setOnClickListener <strong class="lt iu">{<br/>   </strong>view.<strong class="lt iu"><em class="my">findNavController</em></strong>().navigate(R.id.<strong class="lt iu"><em class="my">action_fragment1_to_fragment2</em></strong>)<br/><strong class="lt iu">}</strong></span></pre><p id="039b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们需要找到<code class="fe lq lr ls lt b">NavController</code>并给它我们在XML中指定的动作ID。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="a673" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">其他需要知道的事情</h1><p id="4e50" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">随着每个导航动作，一个目的地被添加到后台堆栈。</p><p id="63cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在前面的实现中，当我们从片段一移动到片段二并点击返回时，按下片段二，我们回到片段一。</p><p id="502d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是假设在splash片段的情况下，这不是预期的行为。在这种情况下，我们需要向<code class="fe lq lr ls lt b">nav_graph</code>中的动作添加额外的属性，或者我们可以选择使用<code class="fe lq lr ls lt b">NavOptions</code>以编程方式添加这些属性。<code class="fe lq lr ls lt b">NavOptions</code>存储导航动作的特殊选项。</p><p id="776d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们检查XML的属性:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/cb9cf957b0befe9838e3fc64e82822d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LJdjyrkKDXujC2aP5FGug.png"/></div></div></figure><p id="a974" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于上述飞溅问题，我们需要使用两个不同的属性:</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="c0da" class="mz mc it lt b gy of og l oh oi"><strong class="lt iu">app:popUpTo</strong>="@id/fragmentOne"<br/><strong class="lt iu">app:popUpToInclusive</strong>="true"</span></pre><p id="b63d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将这些属性添加到<code class="fe lq lr ls lt b">nav_graph</code>、<strong class="kw iu">、</strong>后，修改如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="cc60" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">结果大概是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/98d2362d04542b5e991f3eedbb17fbbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:330/1*F3OiVMcsRpk0JHs3OlFsyg.gif"/></div><p class="on oo gj gh gi op oq bd b be z dk translated">不带后叠的FragmentOne</p></figure><h2 id="cc52" class="mz mc it bd md na nb dn mh nc nd dp ml ld ne nf mn lh ng nh mp ll ni nj mr nk bi translated">动作剖析</h2><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="d6b1" class="mz mc it lt b gy of og l oh oi">&lt;action <strong class="lt iu">android:id</strong>="@+id/next_action"<br/>            <strong class="lt iu">app:destination</strong>="@+id/flow_step_one"<br/>            <strong class="lt iu">app:enterAnim</strong>="@anim/slide_in_right"<br/>            <strong class="lt iu">app:exitAnim</strong>="@anim/slide_out_left"<br/>            <strong class="lt iu">app:popEnterAnim</strong>="@anim/slide_in_left"<br/>            <strong class="lt iu">app:popExitAnim</strong>="@anim/slide_out_right"<br/>            <strong class="lt iu">app:popUpTo</strong>="@id/fragmentOne"<br/>            <strong class="lt iu">app:popUpToInclusive</strong>="true"<!-- --> /&gt;</span></pre><ul class=""><li id="1e7c" class="nm nn it kw b kx ky la lb ld no lh np ll nq lp nr ns nt nu bi translated"><code class="fe lq lr ls lt b">id</code>字段包含由导航主机导航到哪里所使用的动作的ID</li><li id="cc8e" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated">有四种动画类型— <code class="fe lq lr ls lt b">app:enterAnim, app:exitAnim, app:popEnterAnim, app:popExitAnim</code>我们可以在片段初始添加和移除时指定，在从其他片段弹出时也可以指定</li><li id="2187" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated"><code class="fe lq lr ls lt b">app:popUpTo</code> <strong class="kw iu"> </strong>属性用于表示当前片段的弹出选项，直到它应该从当前动作弹出。这将从后台堆栈中弹出所有不匹配的目的地，直到找到该目的地。</li><li id="6b4b" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated"><code class="fe lq lr ls lt b">app:popUpToInclusive</code> <strong class="kw iu"> </strong>该选项用于指定弹出选项是否包含当前实例</li><li id="4e0f" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated"><code class="fe lq lr ls lt b">app:launchSingleTop</code>用于该导航动作是否应该作为单顶启动(即，在后台堆栈的顶部至多有一个给定目的地的副本)。这与<code class="fe lq lr ls lt b">android.content.Intent.FLAG_ACTIVITY_SINGLE_TOP</code>处理活动的方式类似。</li></ul><p id="befa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="my">注意:如果你在片段间频繁导航时不使用</em><code class="fe lq lr ls lt b"><em class="my">app:popUpToInclusive</em></code><strong class="kw iu"><em class="my"/></strong><em class="my">，你的后栈将包含一个特定目的地的两个或更多实例。</em></p><p id="c93e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了以编程方式实现Splash行为，我们可以使用<code class="fe lq lr ls lt b">NavOptions</code> builder。在按钮点击上，我们需要指定<code class="fe lq lr ls lt b">NavController</code>:</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="2e04" class="mz mc it lt b gy of og l oh oi">btn_next.setOnClickListener <strong class="lt iu">{<br/></strong>view.<strong class="lt iu"><em class="my">findNavController</em></strong>().navigate(R.id.<em class="my">action_fragment1_to_fragment2</em>,null, <strong class="lt iu">NavOptions.Builder</strong>()<br/>            .setPopUpTo(R.id.<em class="my">fragmentOne</em>, true)<br/>            .build())<br/><strong class="lt iu">}</strong></span></pre><p id="f871" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">了解更多关于NavOptions 的信息。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="cf28" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">如何在片段之间传递参数</h1><p id="1430" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">在片段之间导航以在它们之间共享数据是很常见的。最简单的方法是使用共享的<code class="fe lq lr ls lt b"><a class="ae oa" href="https://medium.com/better-programming/everything-to-understand-about-viewmodel-400e8e637a58" rel="noopener">ViewModel</a></code> <strong class="kw iu">。</strong>另一种方式就像发送参数，然后将它们读回目的地<strong class="kw iu">。</strong>由于我们正在使用<code class="fe lq lr ls lt b">Navigation</code>组件，现在让我们看看如何使用<code class="fe lq lr ls lt b">safe args</code> <strong class="kw iu"> </strong>插件在两个片段之间共享数据。</p><h1 id="65c0" class="mb mc it bd md me ou mg mh mi ov mk ml jz ow ka mn kc ox kd mp kf oy kg mr ms bi translated">安全参数</h1><p id="cb8a" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated"><strong class="kw iu"> </strong>安全参数<strong class="kw iu"> </strong>插件生成的代码允许我们进行<strong class="kw iu"> </strong>类型安全导航和参数传递。当在目的地之间传递值时，安全参数允许您删除这样的代码:TK</p><p id="b013" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，要将安全参数添加到您的项目中，请在您的顶级<code class="fe lq lr ls lt b">build.gradle</code>文件中包含以下<code class="fe lq lr ls lt b">classpath</code>:</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="19eb" class="mz mc it lt b gy of og l oh oi">buildscript {<br/>    repositories {<br/>        google()<br/>    }<br/>    dependencies {<br/>        def nav_version = "2.3.0-alpha01"<br/>        classpath "androidx.navigation:navigation-safe-args-gradle-plugin:$nav_version"<br/>    }<br/>}</span></pre><p id="7bb1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要生成适用于Java或混合Java和Kotlin模块的Java语言代码，请将这一行添加到您的应用程序或模块的 <code class="fe lq lr ls lt b">build.gradle</code>文件中:</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="57a1" class="mz mc it lt b gy of og l oh oi">apply plugin: "androidx.navigation.safeargs"</span></pre><p id="b565" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">或者，要生成适用于纯Kotlin模块的Kotlin代码，请添加以下代码行:</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="75a6" class="mz mc it lt b gy of og l oh oi">apply plugin: "androidx.navigation.safeargs.kotlin"</span></pre><p id="2d11" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">添加上面的代码行后，我们的应用程序级<code class="fe lq lr ls lt b">build.gradle</code>看起来会像这样:</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="2de0" class="mz mc it lt b gy of og l oh oi">apply plugin: 'com.android.application'<br/><br/>apply plugin: 'kotlin-android'<br/><br/>apply plugin: 'kotlin-android-extensions'<br/><strong class="lt iu"><br/>apply plugin: "androidx.navigation.safeargs.kotlin" // </strong>add this</span></pre><p id="673f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">启用安全参数后，插件会为我们定义的每个动作生成包含类和方法的代码。对于每个动作，Safe Args还为每个<em class="my">发起目的地生成一个类，即动作发起的目的地。生成的类名是起始目的类名和单词“方向”的组合。例如，如果目的地名为<code class="fe lq lr ls lt b">FragmentOne</code>，那么生成的类名为<code class="fe lq lr ls lt b">FragmentOneDirections</code>。</em></p><p id="1a29" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">生成的类包含在起始目的地定义的每个动作的静态方法。该方法将任何已定义的动作参数作为参数，并返回一个可以传递给<code class="fe lq lr ls lt b">navigate()</code>的<code class="fe lq lr ls lt b">NavDirections</code>对象。我们可以在生成的文件夹中找到生成的代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/3907a7b089fed0e2b803ef7431e0aad6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qDfX2rz0QisL59eMqkbJ9Q.png"/></div></div></figure><p id="fae6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">作为一个例子，假设我们有一个导航图，其中有一个连接始发目的地<code class="fe lq lr ls lt b">FragmentOne</code>和接收目的地<code class="fe lq lr ls lt b">FragmentTwo</code>的动作。</p><p id="f210" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Safe Args用返回一个<code class="fe lq lr ls lt b">NavDirections</code>对象的单个方法<code class="fe lq lr ls lt b">actionFragmentOneToFragmentTwo()</code>生成一个<code class="fe lq lr ls lt b">FragmentOneDirections</code>类。这个返回的<code class="fe lq lr ls lt b">NavDirections</code>对象可以直接传递给<code class="fe lq lr ls lt b">navigate()</code>，如下例所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="0386" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lq lr ls lt b">FragmentOne</code>中，它使用<code class="fe lq lr ls lt b">Directories</code>对象创建参数来传递它:</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="a680" class="mz mc it lt b gy of og l oh oi">btn_next.setOnClickListener <strong class="lt iu">{<br/>    </strong>val action = <strong class="lt iu">FragmentOneDirections.actionFragment1ToFragment2("Android")<br/></strong>    view.<em class="my">findNavController</em>().navigate(action)<br/><strong class="lt iu">}</strong></span></pre><p id="e11e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在片段二中，它接收到了<code class="fe lq lr ls lt b">args</code>:</p><pre class="kj kk kl km gt ob lt oc od aw oe bi"><span id="a4ed" class="mz mc it lt b gy of og l oh oi">override fun onActivityCreated(savedInstanceState: Bundle?) {<br/>    super.onActivityCreated(savedInstanceState)<br/>    val args: <strong class="lt iu">FragmentTwoArgs</strong> by <em class="my">navArgs</em>()<br/>    args.<em class="my">let </em><strong class="lt iu">{<br/>        </strong>Toast.makeText(<em class="my">activity</em>!!,<strong class="lt iu">it</strong>.<strong class="lt iu">name</strong>,Toast.<em class="my">LENGTH_SHORT</em>).show()<br/>    <strong class="lt iu">}<br/></strong>}</span></pre><p id="3a90" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以在build文件夹中找到生成的代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/5b8ea9199e72563c5873bd09050c0136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0rYBArg_h2bvrs2R0nZcLQ.png"/></div></div></figure><h2 id="9e79" class="mz mc it bd md na nb dn mh nc nd dp ml ld ne nf mn lh ng nh mp ll ni nj mr nk bi translated">支持的参数类型</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/459a7ce04ecc3e28a9d32c8479b977c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rJzX1ZkPRTbL4qxe8Dypng.png"/></div></div></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="2b96" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">结论</h1><p id="49b9" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">到目前为止，您应该对实现<code class="fe lq lr ls lt b">Navigation</code>组件有了基本的了解，所以请尝试消除片段事务的遗留问题。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="edcd" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">参考</h1><p id="c855" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated"><a class="ae oa" href="https://developer.android.com/guide/navigation/navigation-getting-started" rel="noopener ugc nofollow" target="_blank">导航组件</a></p><p id="a6e0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae oa" href="https://developer.android.com/guide/navigation/navigation-pass-data" rel="noopener ugc nofollow" target="_blank">在目的地之间传递数据</a></p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><p id="223a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请让我知道你的建议和意见。</p><p id="bd9e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在<a class="ae oa" href="https://medium.com/@pavan.careers5208" rel="noopener"> <strong class="kw iu">中</strong> </a>和<a class="ae oa" href="https://www.linkedin.com/in/satya-pavan-kumar-kantamani-61770a9b/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> LinkedIn </strong> </a>上找到我…</p><p id="0489" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读…</p></div></div>    
</body>
</html>