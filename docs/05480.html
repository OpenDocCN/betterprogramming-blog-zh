<html>
<head>
<title>How Facebook Broke Spotify: An iOS Developer’s Explanation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">脸书如何搞垮Spotify:一位iOS开发者的解释</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-facebook-broke-spotify-an-ios-developers-explanation-69b828b95804?source=collection_archive---------1-----------------------#2020-07-12">https://betterprogramming.pub/how-facebook-broke-spotify-an-ios-developers-explanation-69b828b95804?source=collection_archive---------1-----------------------#2020-07-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0b20" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对Spotify、Pinterest或Waze没有帮助的代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/af06d0d33df509c825fc521e68c40c82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kIpx1KRKva0vHh1v"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">亚历克斯·哈尼在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="d608" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这不仅仅适用于Spotify。本周，Pinterest、Waze和许多其他应用程序开始崩溃。</p><p id="af97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将研究原因，以及导致这种情况的代码类型。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d624" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">原因</h1><p id="f136" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">脸书<a class="ae ky" href="https://developers.facebook.com/status/issues/1739188102911114/" rel="noopener ugc nofollow" target="_blank">承认</a>7月10日星期五【FBSDKEventDeactivationManager updateDeactivatedEvents】中的代码变更<a class="ae ky" href="https://developers.facebook.com/support/bugs/329763701368293/" rel="noopener ugc nofollow" target="_blank">导致使用iOS SDK的崩溃数量激增</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/937dd3b779a397d2eddea8a7c99ac220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gnEjDePBZL7nK0lIw0xd1g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/facebook/facebook-ios-sdk/issues/1427" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/facebook-ios-sdk/issues/1427</a></p></figure><p id="01c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们很抱歉，所以这看起来像是结案了。当然，开发人员需要考虑为什么会发生这种情况，这样他们就可以选择是否在未来使用像脸书SDK这样的东西。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7426" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Spotify为什么要用脸书的SDK？</h1><p id="e669" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对大多数人来说，Spotify似乎做了一件蠢事，当然，它与脸书没有面向消费者的联系，但当你打开Spotify时，你会看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/d733c7bad6199570468e7ffa2dc5483d.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*HiNjkgkuDi-7WFpYnxO8QQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。</p></figure><p id="755a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你能看见它吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/c9fe7fae003899adff903dcfd3b5d1e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zbznfZa1_jzi3AhHZLTV6Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。</p></figure><p id="06e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用一个简单的按钮会导致应用程序停止运行吗？</p><p id="ff8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答案是肯定的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5f20" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">问题是</h1><p id="8b4c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">用户希望使用他们现有的脸书登录来访问服务。</p><p id="3126" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为他们<a class="ae ky" href="https://github.com/expo/expo/issues/3230" rel="noopener ugc nofollow" target="_blank">平台政策</a>的一部分，你必须使用developer SDK，你不能简单地使用OAUTH而没有收回脸书服务的风险。</p><p id="c266" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着如果你想使用那个讨厌的按钮，你需要将脸书软件开发工具包整合到你的应用程序中，这意味着当你启动应用程序时，他们会使用一些必需的方法，这意味着没有简单的方法来关闭软件开发工具包。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ac10" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">痛饮？</h1><p id="8720" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">方法swizzling在运行时改变选择器的实现。</p><p id="f3bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我之前实现了一些代码，这些代码支持更改将在应用程序中使用的本地化包。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/b57378a62ccce0c8d571704ad6671fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6xamgIrtCzAci6S7V-oGiA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/stevencurtis/102fa540db6835d987944ef18766cc2f" rel="noopener ugc nofollow" target="_blank">点击查看要点</a></p></figure><p id="cc8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着任何引用<code class="fe nd ne nf ng b">localizedString(forKey:value:table:)</code>的代码都将指向<code class="fe nd ne nf ng b">specialLocalizedStringForKey(<strong class="lb iu">_</strong>:value:table:))</code>,后者具有完全不同的实现。</p><p id="f1c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你痛饮，就没有回头路了。如果你使用的方法有问题，你的应用程序将无法运行</p><p id="6ada" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题？swizzled是危险的，如果你使用了一个swizzled方法而没有意识到它，功能可能已经改变，你不再得到你期望的功能。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8340" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">所以…</h1><p id="7a9b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">脸书正在重组<code class="fe nd ne nf ng b">UIButton</code>，和其他的<a class="ae ky" href="https://github.com/facebook/facebook-ios-sdk/search?q=swizzle&amp;unscoped_q=swizzle" rel="noopener ugc nofollow" target="_blank">重组</a>他们的SDK。</p><p id="9203" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在只需轻轻搅动<code class="fe nd ne nf ng b">UIButton</code>，他们就能以意想不到的方式改变你的应用程序的行为，也许不是恶意的，但如果脸书的某人碰巧在他们的代码中犯了一个错误，作为一名开发者，你没有办法关闭它。</p><p id="cd7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">换句话说，如果Spotify没有使用<code class="fe nd ne nf ng b"><a class="ae ky" href="https://github.com/facebook/facebook-ios-sdk/search?q=swizzle&amp;unscoped_q=swizzle" rel="noopener ugc nofollow" target="_blank">UIButton</a></code>并以某种方式破坏了它，看起来他们<a class="ae ky" href="https://github.com/facebook/facebook-ios-sdk/blob/91bfedba5e10184c7e8236148e6abe3a5cd1341c/FBSDKCoreKit/FBSDKCoreKit/FBSDKApplicationDelegate.m#L64" rel="noopener ugc nofollow" target="_blank">加载了由强制<code class="fe nd ne nf ng b">plist</code>控制的应用程序启动</a>，任何开发者都无法关闭任何破坏了应用程序代码的东西，这是一场灾难！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dd1c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">脸书现在控制了应用经济吗？</h1><p id="2903" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这不仅仅包括“用脸书登录”功能的实现，开发者也经常使用脸书分析来收集他们用户的数据。</p><p id="ae72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题的一部分是，如上所述，一旦你使用了SDK的一个功能，就没有办法“关闭”那些你不使用的功能，可能会使你的应用程序崩溃，用户会责怪他们正在使用的应用程序公司，而不是他们一无所知的不透明SDK。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0d88" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="874b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">有其他选择吗？当然有，但最终这是一个关于在你的应用中使用第三方框架的警告，即使它们是由非常大的公司创建的。</p><p id="4880" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每当你使用其他开发者的代码时，你都依赖于他们的质量控制和测试程序。你确定它们是符合标准的吗？你确定你正在按照预期的方式使用SDK和公共API吗？</p><p id="5f9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">警告是明确的，而且:这不是第一次发生在脸书iOS SDK用户身上。</p><p id="9e78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一朝被蛇咬，十年怕草绳。</p><p id="b11e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保持安全，小心编码。</p></div></div>    
</body>
</html>