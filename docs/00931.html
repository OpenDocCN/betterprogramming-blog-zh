<html>
<head>
<title>A Step-by-Step Guide to Building Event-Driven Microservices With RabbitMQ</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用RabbitMQ构建事件驱动的微服务的分步指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-step-by-step-guide-to-building-event-driven-microservices-with-rabbitmq-deeb85b3031c?source=collection_archive---------5-----------------------#2019-07-29">https://betterprogramming.pub/a-step-by-step-guide-to-building-event-driven-microservices-with-rabbitmq-deeb85b3031c?source=collection_archive---------5-----------------------#2019-07-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3f10" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将RabbitMQ教程合并到我们自己的项目中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/72cd7ca1188b1752b3d22e39d27ba088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SVWk3VJgIWDIfrJU"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@jackychiu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jacky Chiu </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="b8a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近，当我试图浏览<a class="ae ky" href="https://www.rabbitmq.com/getstarted.html" rel="noopener ugc nofollow" target="_blank"> RabbitMQ教程</a>时，我发现自己被一股无聊和困倦的浪潮所冲击。他们很难通过！</p><p id="e0b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我想我会用RabbitMQ创造一些有趣的东西，而不是仅仅按照教程去做。结果证明它非常有效，以至于我的肾上腺素开始分泌，让我在午夜前保持清醒。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bd6c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">项目背景</h1><p id="2d00" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我喜欢励志名言。因此，我想<em class="mz">每分钟都收集激励性的引语</em>。这让我创建了两个微服务。每个微服务相互独立运行，只执行各自的任务。这就是我们实现关注点分离的方法。</p><ul class=""><li id="1db6" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">TimerService <br/> -每分钟向RabbitMQ服务器发布一条消息</li><li id="3ac0" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">QuoteService <br/> -当它从TimerService接收到事件时，从互联网上抓取报价</li></ul><p id="d4a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经完成了解决方案设计。让我们把手弄脏，开始建造吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f3c8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">先决条件</h1><p id="f628" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在我们开始开发微服务之前，需要几个工具和框架:</p><ul class=""><li id="fc72" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Nodej </a> s</li><li id="9e4d" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><a class="ae ky" href="https://www.rabbitmq.com/download.html" rel="noopener ugc nofollow" target="_blank"> RabbitMQ </a></li><li id="2714" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">如何创建ExpressJS应用程序的知识。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8c21" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">逐步指南</h1><p id="630c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这是泰克龙的第一条开发规则:</p><blockquote class="no"><p id="ce66" class="np nq it bd nr ns nt nu nv nw nx lu dk translated">总是从最容易的部分开始。</p></blockquote><p id="e8aa" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">轻松的进入会让你完成第一个任务，获得面对即将到来的挑战的信心。</p><h2 id="a87a" class="od md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">步骤1: TimerService开发</h2><p id="4b68" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们从创建TimerService开始:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TimerService的代码。点击查看完整代码<a class="ae ky" href="https://github.com/tlcheah2/stoic-quote-timer-service" rel="noopener ugc nofollow" target="_blank"/></p></figure><p id="ce36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看我们在这里做了什么。我们:</p><ul class=""><li id="2d30" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">创建了一个到我们RabbitMQ服务器的连接。</li><li id="564c" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">创建了一个频道</li><li id="7e2b" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">创建了一个直接的、不持久的“报价”交换</li><li id="1675" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">在每个时间间隔(60秒)内将消息发布到交换</li></ul><p id="f647" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码实现了TimerService的目的。</p><h2 id="5682" class="od md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">步骤2: QuoteService开发</h2><p id="9252" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们继续我们的QuoteService开发。这个服务的主要功能是当它从RabbitMQ队列中接收到一条消息时，能够从互联网上抓取一条激励性的引用。</p><p id="75c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，创建一个消费者并监听TimerService发送的事件。让我们把它变得非常简单；当我们收到消息时，我们调用<code class="fe or os ot ou b">scrapQuoteOfTheDay()</code>函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="d199" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们继续从网上搜集这段引文:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="c240" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我从<a class="ae ky" href="http://wisdomquotes.com" rel="noopener ugc nofollow" target="_blank">wisdom quotes . com</a>获取我的报价，并将它们写入JSON文件。很直接，对吧？</p><p id="a685" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经有了业务逻辑，让我们制作一个HTML页面来显示已经废弃的报价。在做了一些研究之后，在ExpressJS中动态呈现HTML的最简单的方法是使用模板引擎<a class="ae ky" href="https://pugjs.org/api/getting-started.html" rel="noopener ugc nofollow" target="_blank"> Pug </a>。让我告诉你我是怎么做的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="2a9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是将基于<code class="fe or os ot ou b">index.pug</code>模板创建的UI。</p><p id="0939" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里获得QuoteService <a class="ae ky" href="https://github.com/tlcheah2/quote-service" rel="noopener ugc nofollow" target="_blank">的完整源代码。</a></p><h2 id="8ddb" class="od md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">步骤QuoteService的快速服务器设置</h2><p id="8e22" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了让QuoteService能够监听RabbitMQ队列，我们必须在服务器初始化期间进行一些设置。此外，还有基于我们在第二步中创建的<code class="fe or os ot ou b">index.pug</code>模板的报价HTML呈现。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="8b97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了启动web服务器之外，此配置还实现了以下目的:</p><ul class=""><li id="807d" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">呈现<code class="fe or os ot ou b">index.pug</code>模板(第17行)</li><li id="ab74" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">监听RabbitMQ队列(第23行)</li></ul><h2 id="bcd8" class="od md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">第四步:运行并测试它！！！</h2><p id="2251" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们运行我们的项目并在本地测试它。最终，您可以从Github获得我的完整源代码。</p><ul class=""><li id="6db0" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><a class="ae ky" href="https://github.com/tlcheah2/quote-service" rel="noopener ugc nofollow" target="_blank"> TimerService Github </a></li><li id="bb9a" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><a class="ae ky" href="https://github.com/tlcheah2/quote-service" rel="noopener ugc nofollow" target="_blank">报价服务Github </a></li></ul><ol class=""><li id="a9b0" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu ov ng nh ni bi translated">让我们启动QuoteService组件。进入报价服务文件夹，做<code class="fe or os ot ou b">npm run start</code></li><li id="681a" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu ov ng nh ni bi translated">通过转到TimerService文件夹并运行<code class="fe or os ot ou b">npm run start</code>来启动我们的TimerService组件</li><li id="7404" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu ov ng nh ni bi translated">如果你运行成功，下面是截图:</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/711f46715c9f1c7d783a7b1cdb48fb39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2VwEg9smuS_IHvu0CyCqg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TimerService向RabbitMQ交换发布两个事件</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/128cf1307d974db7f7633c9826befc85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CRPypyry5BtS4WkVNG3AfA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">QuoteService能够使用两个事件来监听RabbitMQ队列</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/5cf3ae476698a5da23d6f958dd834cd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HXxIy7WLYcZ5LGl-dyCPog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">QuoteTimer HTML页面呈现能够呈现从<a class="ae ky" href="http://wisdomquotes.com" rel="noopener ugc nofollow" target="_blank"> WisdomQuotes </a>中抓取的2个报价</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a13c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="9dc7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">RabbitMQ肯定非常容易学习，并且在他们自己的网站上有清晰的教程，然而，当你融入你的爱好或兴趣时，教程会更有趣。</p><p id="91e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我个人非常喜欢RabbitMQ，希望用它来为即将到来的项目构建事件驱动的微服务。</p><p id="1ada" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，在我开发这个的时候，有很多想法闪过我的脑海，比如:</p><ul class=""><li id="5690" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><a class="ae ky" href="https://medium.com/better-programming/how-i-deploy-microservice-to-heroku-with-rabbitmq-876499c797cc" rel="noopener">如何将这些微服务部署到Heroku </a>。</li><li id="ee64" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><a class="ae ky" href="https://medium.com/better-programming/how-i-developed-a-real-time-web-app-using-server-sent-events-488cc280c2e1" rel="noopener">如何实时更新HTML页面显示行情</a>。</li></ul><p id="0f9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读，并随时给予反馈。</p><h2 id="28d7" class="od md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">参考</h2><p id="2351" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">以下是我在构建这个项目时使用的参考资料:</p><ul class=""><li id="995c" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><a class="ae ky" href="https://www.freecodecamp.org/news/the-ultimate-guide-to-web-scraping-with-node-js-daa2027dcd3/" rel="noopener ugc nofollow" target="_blank">网页抓取终极指南</a></li><li id="e294" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><a class="ae ky" href="https://www.rabbitmq.com/getstarted.html" rel="noopener ugc nofollow" target="_blank"> RabbitMQ官方教程</a>。</li></ul></div></div>    
</body>
</html>