<html>
<head>
<title>Build a Classic iPod App With SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SwiftUI构建经典的iPod应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-classic-ipod-app-with-swiftui-f1ff3f19b97e?source=collection_archive---------17-----------------------#2020-01-29">https://betterprogramming.pub/build-a-classic-ipod-app-with-swiftui-f1ff3f19b97e?source=collection_archive---------17-----------------------#2020-01-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f7d6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">还记得你珍爱的iPod的日子吗？用SwiftUI把它带回来</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/493b67a9d05a742b8c812b10f21bcf46.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*mJI8QojqhtwS6d9Q7U3kNA.png"/></div></figure></div><div class="ab cl kq kr hx ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="im in io ip iq"><h1 id="248f" class="kx ky it bd kz la lb lc ld le lf lg lh jz li ka lj kc lk kd ll kf lm kg ln lo bi translated">介绍</h1><p id="b35f" class="pw-post-body-paragraph lp lq it lr b ls lt ju lu lv lw jx lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">自从SwiftUI发布以来，我们已经看到了许多很酷的应用和设计，我们可以用这个新框架来实现。我们看过一个<a class="ae ml" href="https://medium.com/better-programming/how-to-create-fun-animations-in-swiftui-1c08adcb93ce" rel="noopener">钱包App </a>，动画剧情，电影……</p><p id="a7e0" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">在本文中，我们将展示另一个例子来强调这个UI框架的能力，它肯定会在未来几年内改变iOS的开发。最终结果应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/051422b37fb92ea9441c0e45847e6ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/1*aZ4hwC7HxPqZoK9vAlt6Sg.gif"/></div></figure><p id="3eba" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">我们将对代码片段进行注释。你可以在我的报告中找到完整的实现:</p><div class="mr ms gp gr mt mu"><a href="https://github.com/fermoya/iPod" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd iu gy z fp mz fr fs na fu fw is bi translated">fermoya/iPod</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">github.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni ko mu"/></div></div></a></div></div><div class="ab cl kq kr hx ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="im in io ip iq"><h1 id="3e43" class="kx ky it bd kz la lb lc ld le lf lg lh jz li ka lj kc lk kd ll kf lm kg ln lo bi translated">各个击破</h1><p id="14ea" class="pw-post-body-paragraph lp lq it lr b ls lt ju lu lv lw jx lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">为了简单起见，我们不会关注大而复杂的视图。相反，我们将使用分而治之的策略，并尝试将屏幕简化为更小且可重复使用的视图:</p><ul class=""><li id="eb2e" class="nj nk it lr b ls mm lv mn ly nl mc nm mg nn mk no np nq nr bi translated">一个寻呼机，里面有你喜欢的所有歌曲。</li><li id="1581" class="nj nk it lr b ls nw lv nx ly ny mc nz mg oa mk no np nq nr bi translated"><code class="fe ns nt nu nv b">ControlPad</code>:浏览专辑和播放音乐的控制面板。</li></ul><p id="9bd2" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated"><code class="fe ns nt nu nv b">AlbumView</code>极其容易实现。我们将使用<a class="ae ml" href="https://github.com/fermoya/SwiftUIPager" rel="noopener ugc nofollow" target="_blank"> SwiftUIPager </a>，一个100%由SwiftUI组件构建的寻呼机。</p><p id="9df1" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">为了编码<code class="fe ns nt nu nv b">ControlPad</code>，我们需要首先构建一个类似甜甜圈的形状<code class="fe ns nt nu nv b">Ring</code>。我们还将创建一个视图修改器<code class="fe ns nt nu nv b">SpinnableViewModifier</code>，它将帮助我们跟踪<code class="fe ns nt nu nv b">ControlPad</code>上的旋转手势。这将允许我们对专辑中的歌曲进行分页。</p><h2 id="b0e7" class="ob ky it bd kz oc od dn ld oe of dp lh ly og oh lj mc oi oj ll mg ok ol ln om bi translated">实现AlbumView</h2><p id="e8b8" class="pw-post-body-paragraph lp lq it lr b ls lt ju lu lv lw jx lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">如上所述，我们将使用<a class="ae ml" href="https://github.com/fermoya/SwiftUIPager" rel="noopener ugc nofollow" target="_blank">快捷导航</a>来实现这张专辑。这个库提供了一个叫做<code class="fe ns nt nu nv b">Pager</code>的易用组件。我们只需要添加一些定制:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="bc52" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated"><code class="fe ns nt nu nv b">AlbumView</code>只不过是一个视图，它包装了一个定制<code class="fe ns nt nu nv b">Pager</code>并管理它的事件<code class="fe ns nt nu nv b">onPageChanged</code>。</p><p id="d8f5" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">为了帮助您向视图添加特定的视图修改器，创建一个<code class="fe ns nt nu nv b">Buildable</code>协议。<code class="fe ns nt nu nv b">Buildable</code>将允许我们轻松地改变我们的视图，并添加助手功能来定制它们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="c4ef" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">使用<code class="fe ns nt nu nv b">Buildable</code>，我们已经成功定义了一个视图修饰符<code class="fe ns nt nu nv b">onPageChanged</code>，来传递对<code class="fe ns nt nu nv b">Pager.onPageChanged</code>事件值的回调。</p><h2 id="5a1b" class="ob ky it bd kz oc od dn ld oe of dp lh ly og oh lj mc oi oj ll mg ok ol ln om bi translated">实施ControlPad</h2><p id="0fe9" class="pw-post-body-paragraph lp lq it lr b ls lt ju lu lv lw jx lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">这是这个项目最困难的部分。首先，让我们专注于创建一个形状，<code class="fe ns nt nu nv b">Ring</code>，并在其上添加特性。</p><p id="5f20" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">要实现<code class="fe ns nt nu nv b">Ring</code>，扩展<code class="fe ns nt nu nv b">Shape</code>协议并添加所需的存根:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="44c0" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">给定一个<code class="fe ns nt nu nv b">ratio</code>和一个<code class="fe ns nt nu nv b">rect</code>，我们已经创建了一条路径，并在上面画了两条弧线。<code class="fe ns nt nu nv b">ratio</code>设置两个圆弧之间的距离。</p><p id="6c99" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">我们现在可以将<code class="fe ns nt nu nv b">ControlPad</code>定义为一个<code class="fe ns nt nu nv b">Ring</code>，上面堆叠了四个按钮:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="c7d6" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">有些事件<code class="fe ns nt nu nv b">ControlPad</code>必须公开为按钮动作的回调:</p><ul class=""><li id="efd4" class="nj nk it lr b ls mm lv mn ly nl mc nm mg nn mk no np nq nr bi translated"><code class="fe ns nt nu nv b">onForwardTapped</code>按下前进按钮时。</li><li id="82a4" class="nj nk it lr b ls nw lv nx ly ny mc nz mg oa mk no np nq nr bi translated"><code class="fe ns nt nu nv b">onPlayPauseTapped</code>当用户点击播放/暂停按钮时。</li></ul><p id="d283" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">我们可以使用与<code class="fe ns nt nu nv b">AlbumView</code>中相同的策略并实现<code class="fe ns nt nu nv b">Buildable</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure></div><div class="ab cl kq kr hx ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="im in io ip iq"><h1 id="7199" class="kx ky it bd kz la lb lc ld le lf lg lh jz li ka lj kc lk kd ll kf lm kg ln lo bi translated">使环可纺</h1><p id="3135" class="pw-post-body-paragraph lp lq it lr b ls lt ju lu lv lw jx lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">此时，我们已经实现了按钮的回调，但是我们仍然缺少使iPod成为如此受欢迎的音频播放器的关键部分:浏览专辑的旋转手势。</p><p id="26fc" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">为了实现这个手势，我们将创建一个视图修改器，<code class="fe ns nt nu nv b">spinnable</code>，它将添加一个<code class="fe ns nt nu nv b">DragGesture</code>到<code class="fe ns nt nu nv b">Ring</code>，并将拖动位置转换为旋转。</p><p id="09da" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">先来刷新一些数学概念。<code class="fe ns nt nu nv b">DragGesture</code>给出基于坐标空间的位置，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/32f087a5460dbbf57267eae9cfda3a0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*0-sceAQApX4bQLvpA3SlXg.png"/></div></figure><p id="c5c3" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">为了得到旋转的角度，我们需要:</p><ul class=""><li id="51e2" class="nj nk it lr b ls mm lv mn ly nl mc nm mg nn mk no np nq nr bi translated">将原点移动到环中心，即将点转换到不同的坐标空间。</li><li id="b550" class="nj nk it lr b ls nw lv nx ly ny mc nz mg oa mk no np nq nr bi translated">将旋转角度计算为拖动位置的反正切。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/9a14a3809881121435a33b0f7000e76a.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*A14iIjaRuA5MDH_uNCdYVA.png"/></div></figure><p id="90d0" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">让我们扩展<code class="fe ns nt nu nv b">CGPoint</code>来帮助我们完成这些转换:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="7e67" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">现在，我们准备实施<code class="fe ns nt nu nv b">SpinnableViewModifier</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="db5f" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">我们使用<code class="fe ns nt nu nv b">DragGesture</code>获得一个定位点，然后用它来计算角度。<code class="fe ns nt nu nv b">Rotation</code>是一个结构，让我们根据方向(顺时针或逆时针)累加这个角度，并将这个值转换为<code class="fe ns nt nu nv b">laps</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="0ee6" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">准备好所有这些新组件后，回到<code class="fe ns nt nu nv b">ControlPad</code>并使<code class="fe ns nt nu nv b">Ring</code>可旋转:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure></div><div class="ab cl kq kr hx ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="im in io ip iq"><h1 id="5d4d" class="kx ky it bd kz la lb lc ld le lf lg lh jz li ka lj kc lk kd ll kf lm kg ln lo bi translated">将碎片拼在一起</h1><p id="8244" class="pw-post-body-paragraph lp lq it lr b ls lt ju lu lv lw jx lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我们已经非常接近拥有一个实用的iPod了。留给我们的唯一任务是连接<code class="fe ns nt nu nv b">AlbumView</code>和<code class="fe ns nt nu nv b">ControlPad</code>。一旦完成，我们就都准备好了！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="4bae" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">就这样，你完成了！点击运行并享受音乐:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/2003eb1c6492958977bcde8c0782178c.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/1*eP_cjz8d6huiZKFWvQjPUQ.gif"/></div></figure></div><div class="ab cl kq kr hx ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="im in io ip iq"><h1 id="5a53" class="kx ky it bd kz la lb lc ld le lf lg lh jz li ka lj kc lk kd ll kf lm kg ln lo bi translated">结论</h1><p id="96bb" class="pw-post-body-paragraph lp lq it lr b ls lt ju lu lv lw jx lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">太酷了，我们创造了自己的iPod！我们从识别设计的各个部分开始，我们将它分开，这样就更容易分离关注点，让每个视图各司其职，最后，我们将所有东西放在一起。</p><p id="3fe9" class="pw-post-body-paragraph lp lq it lr b ls mm ju lu lv mn jx lx ly mo ma mb mc mp me mf mg mq mi mj mk im bi translated">别忘了你可以在这里看到完整的代码:</p><div class="mr ms gp gr mt mu"><a href="https://github.com/fermoya/iPod" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd iu gy z fp mz fr fs na fu fw is bi translated">fermoya/iPod</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">github.com</p></div></div><div class="nd l"><div class="or l nf ng nh nd ni ko mu"/></div></div></a></div></div></div>    
</body>
</html>