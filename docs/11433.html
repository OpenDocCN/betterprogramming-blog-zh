<html>
<head>
<title>Learn Rust by Developing a Crypto Publisher CLI Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过开发Crypto Publisher CLI应用程序了解Rust</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/learn-rust-by-example-develop-crypto-publisher-cli-application-be5af17e03ae?source=collection_archive---------4-----------------------#2022-03-19">https://betterprogramming.pub/learn-rust-by-example-develop-crypto-publisher-cli-application-be5af17e03ae?source=collection_archive---------4-----------------------#2022-03-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fc9b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">简化命令行界面应用程序的构建</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b8ba6cbf592514cbb94ab56b05edeb32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nuOwZltYPkfTl1Rb"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@charlfolscher?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Charl Folscher </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ee4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我总是发现，当学习一门编程语言时，从头开始开发一个应用程序是很有帮助的，一步一步来。甚至在你完成了Rust编程语言的书之后，你可能会对从哪里开始感到不知所措。</p><p id="a58f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程假设您在开始开发一个简单的命令行界面(CLI)应用程序来显示加密价格(例如，以美元或BTC-美元表示的比特币价格)之前，至少已经浏览了这本书。</p><p id="5e61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在开始撰写文章之前，让我们先做一些内务处理，提供一个到GitHub资源库的链接，在那里可以找到所有源代码= &gt;<a class="ae ky" href="https://github.com/sungkim11/crypto-publisher" rel="noopener ugc nofollow" target="_blank">https://github.com/sungkim11/crypto-p</a>ublisher。此外，我想向您展示您将使用Rust开发什么应用程序，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/93a43a2f56f94109e08bb0efcee49545.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_hhwe_X0LSk9HoT-Kqt4HA.png"/></div></div></figure><h1 id="0869" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">先决条件</h1><h2 id="7940" class="mo lx it bd ly mp mq dn mc mr ms dp mg li mt mu mi lm mv mw mk lq mx my mm mz bi translated">比特币基地价格数据剩余API</h2><p id="cdf0" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我们将使用比特币基地REST API来获取比特币的美元或BTC美元价格(<a class="ae ky" href="https://developers.coinbase.com/api/v2#data-endpoints" rel="noopener ugc nofollow" target="_blank">https://developers.coinbase.com/api/v2#data-endpoints</a>)。</p><p id="4de8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要调用比特币基地REST API，只需将以下URL复制并粘贴到您的浏览器中:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="9437" class="mo lx it ng b gy nk nl l nm nn"><a class="ae ky" href="https://api.coinbase.com/v2/prices/:currency_pair/spot" rel="noopener ugc nofollow" target="_blank">https://api.coinbase.com/v2/prices/BTC-USD/spot</a></span></pre><p id="f4ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以JSON格式返回或下载包含以下内容的<code class="fe no np nq ng b">response.json</code>文件为例，该文件既提供现货价格，也提供<code class="fe no np nq ng b">base-currency</code>或<code class="fe no np nq ng b">BTC-USD</code>。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="2414" class="mo lx it ng b gy nk nl l nm nn">{<br/>     "data":{<br/>          "base":"BTC",<br/>          "currency":"USD",<br/>          "amount":"40731.94"<br/>     }<br/>}</span></pre><h2 id="2268" class="mo lx it bd ly mp mq dn mc mr ms dp mg li mt mu mi lm mv mw mk lq mx my mm mz bi translated">铁锈板条箱</h2><p id="f2d2" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">在我们开始开发应用程序之前，我们需要添加四个Rust板条箱:</p><ul class=""><li id="a4ab" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">Serde:它是一个有效和通用地序列化和反序列化Rust数据结构的框架。他们的crates.io网址是<a class="ae ky" href="https://crates.io/crates/serde" rel="noopener ugc nofollow" target="_blank">https://crates.io/crates/serde</a>。Serde用于将JSON数据映射到Rust数据结构或Struct。它用于将JSON反序列化或转换为struct，并将struct序列化或转换为JSON。</li><li id="4403" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq ng b">Reqwest</code>:是Rust的HTTP客户端。他们的crates.io网址是<a class="ae ky" href="https://crates.io/crates/reqwest" rel="noopener ugc nofollow" target="_blank">https://crates.io/crates/reqwest</a>。<code class="fe no np nq ng b">Reqwest</code>是用来向比特币基地发出HTTPS请求的REST API。</li><li id="12ff" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">Tokio:它是一个编写异步应用程序的平台。他们的crates.io网址是<a class="ae ky" href="https://crates.io/crates/tokio" rel="noopener ugc nofollow" target="_blank">https://crates.io/crates/tokio</a>。开发异步应用程序需要Tokio。</li><li id="ef72" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">Clap:它是Rust的命令行参数解析器。他们的crates.io网址是<a class="ae ky" href="https://crates.io/crates/clap" rel="noopener ugc nofollow" target="_blank">https://crates.io/crates/clap</a>。开发命令行界面应用需要Clap。</li></ul><p id="686a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，<code class="fe no np nq ng b">Cargo.toml</code>修改为包括如下四个板条箱:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="d2eb" class="mo lx it ng b gy nk nl l nm nn">[package]<br/>name = "rust-struct"<br/>version = "0.1.0"<br/>edition = "2021"</span><span id="bca4" class="mo lx it ng b gy of nl l nm nn"># See more keys and their definitions at <a class="ae ky" href="https://doc.rust-lang.org/cargo/reference/manifest.html" rel="noopener ugc nofollow" target="_blank">https://doc.rust-lang.org/cargo/reference/manifest.html</a></span><span id="166d" class="mo lx it ng b gy of nl l nm nn">[dependencies]<br/>serde = { version = "1.0.136", features = ["derive"] }<br/>reqwest = { version = "0.11", features = ["json"] }<br/>tokio = { version = "1.17.0", features = ["full"] }<br/>clap = { version = "3.1.2", features = ["derive"] }</span></pre><h1 id="813e" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">课程</h1><p id="ef76" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">在本文中，我们将开发一个简单的应用程序，然后在应用程序的基础上添加更多的功能:</p><ul class=""><li id="13d5" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">第1课:调用比特币基地REST API的简单异步应用程序</li><li id="bd6f" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">第2课:将对REST API的异步调用转移到不同的函数中</li><li id="df53" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">第3课:添加命令行界面</li><li id="27b3" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">第4课:添加时间、加密买价、加密卖价和更多CLI参数</li></ul><h2 id="be62" class="mo lx it bd ly mp mq dn mc mr ms dp mg li mt mu mi lm mv mw mk lq mx my mm mz bi translated">第1课:调用比特币基地REST API的简单异步应用程序</h2><p id="ff83" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我们将开发一个简单的异步应用程序，使用提供的URL调用比特币基地价格数据REST API，然后将JSON文件处理(即反序列化)为可编程对象(即结构)，这样我们就可以打印加密价格。</p><p id="0381" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能会问——为什么要开发异步应用程序？这是因为后续文章将增强该应用程序，使用rdkafka crate向Apache Kafka发布加密价格，因此该应用程序的名称是Crypto Publisher。</p><p id="73e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> JSON (response.json) </strong></p><p id="2a1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下JSON具有如下所示的层次结构或嵌套结构:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="52c7" class="mo lx it ng b gy nk nl l nm nn">{<br/>     "data":{<br/>          "base":"BTC",<br/>          "currency":"USD",<br/>          "amount":"40731.94"<br/>     }<br/>}</span></pre><p id="123d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">锈蚀结构</strong></p><p id="f96f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Rust Struct通过创建两个Struct来支持嵌套结构，其中数据类型<em class="og">“coin price”</em>用于复制JSON的嵌套结构。最后，它实现Serde的反序列化，将JSON数据映射到Rust Struct。从JSON文件创建struct的最简单的方法是转到quick type(<a class="ae ky" href="https://app.quicktype.io/" rel="noopener ugc nofollow" target="_blank">https://app.quicktype.io/</a>)，然后复制JSON作为源，并指定Rust作为目标。我修改了结构名以满足我的需要。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="bf01" class="mo lx it ng b gy nk nl l nm nn">#[derive(Serialize, Deserialize, Debug)]<br/>pub struct CoinbasePrice {<br/>    pub data: <strong class="ng iu">CoinPrice</strong><br/>}#[derive(Serialize, Deserialize, Debug)]<br/>pub struct <strong class="ng iu">CoinPrice</strong> {<br/>    pub base: String,<br/>    pub currency: String,<br/>    pub amount: String,<br/>}</span></pre><p id="7c6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> REST API请求</strong></p><p id="cc43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们定义了结构之后，我们将需要发出REST API请求。这是在async/之后完成的。使用Tokio运行时进行await构造，这在代码中反映为:</p><ul class=""><li id="4be1" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">REST API请求，它返回一个future，然后等待它完成(Client::new()。获取(&amp;spot_url)。发送()。等待？)</li><li id="2a59" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">解析对ConibasePrice结构的JSON响应，它返回一个future，然后等待它完成(json:: <coinbaseprice>()。等待？；)</coinbaseprice></li></ul><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="e3f0" class="mo lx it ng b gy nk nl l nm nn">let resp_spot_price = Client::new().get(&amp;spot_url).send().await?.json::&lt;CoinbasePrice&gt;().await?;</span></pre><p id="09fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">打印出加密价格</strong></p><p id="51d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们使用struct打印出加密价格，最后返回Ok。请注意，CoinbasePrice结构的结构如下:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="26f1" class="mo lx it ng b gy nk nl l nm nn">CoinbasePrice<br/>     data<br/>          base<br/>          currency<br/>          amount</span></pre><p id="3207" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于CoinbasePrice结构被赋给resp_spot_price，base = resp_spot_price.data.base。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="6291" class="mo lx it ng b gy nk nl l nm nn">println!("SPOT: {base}-{currency}: {amount}",<br/>     base=resp_spot_price.data.base,<br/>     currency=resp_spot_price.data.currency,<br/>     amount=resp_spot_price.data.amount);</span><span id="c517" class="mo lx it ng b gy of nl l nm nn">Ok(())</span></pre><p id="a4dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">完成代码</strong></p><p id="44df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，下面提供了完整的代码，其中有两个文件:</p><ul class=""><li id="279f" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">main.rs:它只是调用crypto_publisher_1.rs中的crypto_publisher函数，请注意由于fn crypto_publisher()返回一个结果类型，所以增加了unwrap()。</li><li id="76e6" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">加密发布者1.rs</li></ul><p id="0c97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">main.rs</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="cfda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">加密发布者1.rs</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h2 id="0618" class="mo lx it bd ly mp mq dn mc mr ms dp mg li mt mu mi lm mv mw mk lq mx my mm mz bi translated">第2课:将对REST API的异步调用转移到不同的函数中</h2><p id="d218" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">在本课中，我们将完成以下任务:</p><ul class=""><li id="cb29" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">将异步调用REST API转移到一个新的异步函数中，因为我们需要调用这个函数三次来获得现货价格、买价和卖价。</li><li id="bcca" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">将<code class="fe no np nq ng b">crypto_publisher</code>函数转换为一个函数，该函数调用新的异步函数。</li></ul><p id="e9e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">创建一个新的异步函数</strong></p><p id="9864" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建了一个新的异步函数，因此我们可以使用同一个函数获得三个价格:</p><ul class=""><li id="6354" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">现货价格</li><li id="7b21" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">购买价格</li><li id="b291" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">销售价格</li></ul><p id="ed57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，名为<code class="fe no np nq ng b">get_coin_price()</code>的新异步函数有三个输入参数:</p><ul class=""><li id="293c" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">类型(现货、购买和出售)</li><li id="2a7a" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">货币(如BTS)</li><li id="537e" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">汇率(例如，美元)</li></ul><p id="6c1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并返回一个带有字符串值的结果类型，用<code class="fe no np nq ng b">Ok(resp_price.data.amount)</code>表示。所有其他代码与上一课类似。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="829d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<code class="fe no np nq ng b">crypto_publisher</code>功能转换为同步功能</p><p id="70f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">fn crypto_publisher已经简化为只调用get_coin_price()，然后打印出解析后的返回值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="3e0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">完成代码</strong></p><p id="cad3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，下面提供了完整的代码，其中有两个文件:</p><ul class=""><li id="7a9c" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">main.rs:它只是调用<code class="fe no np nq ng b">crypto_publisher_2.rs.</code>中的<code class="fe no np nq ng b">crypto_publisher</code>函数</li><li id="206c" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq ng b">crypto_publisher_2.rs</code></li></ul><p id="91c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe no np nq ng b">main.rs</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="cfbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe no np nq ng b">crypto_publisher_2.rs</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h2 id="2cbc" class="mo lx it bd ly mp mq dn mc mr ms dp mg li mt mu mi lm mv mw mk lq mx my mm mz bi translated">第3课:添加命令行界面</h2><p id="bfea" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">在本课中，我们将完成以下任务:</p><ul class=""><li id="a972" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">使用Clap为命令行界面(“CLI”)创建struct，这是一个简单易用、高效且功能全面的命令行参数解析器。</li><li id="1dd9" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">添加CLI代码功能<code class="fe no np nq ng b">crypto_publisher()</code></li></ul><p id="e008" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">为命令行界面创建结构</strong></p><p id="dbea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Clap有一个构建器API，它利用struct上的属性来构建命令行界面。下面的结构添加了两个参数:</p><ul class=""><li id="78be" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">货币(如BTC)</li><li id="03e7" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">汇率(例如，美元)</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="b966" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">添加CLI代码函数crypto_publisher() </strong></p><p id="f12a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经将CLI代码添加到async fn crypto_publisher()中，以接受命令行界面值。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="cd82" class="mo lx it ng b gy nk nl l nm nn">let args = Cli::parse();<br/>let currency = &amp;args.currency;    <br/>let rates = &amp;args.rates;</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="943a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">完成代码</strong></p><p id="013c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，下面提供了完整的代码，其中有两个文件:</p><ul class=""><li id="3668" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated"><code class="fe no np nq ng b">main.rs</code>:它只是调用<code class="fe no np nq ng b">crypto_publisher_3.rs</code>中的<code class="fe no np nq ng b">crypto_publisher</code>函数。</li><li id="c562" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq ng b">crypto_publisher_3.rs</code></li></ul><p id="788e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe no np nq ng b">main.rs</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="0ece" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe no np nq ng b">crypto_publisher_3.rs</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h2 id="3edc" class="mo lx it bd ly mp mq dn mc mr ms dp mg li mt mu mi lm mv mw mk lq mx my mm mz bi translated">第4课:添加时间、加密买价、加密卖价和更多CLI参数</h2><p id="f10b" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">最后，我们通过将所有这些整合在一起来完成应用程序。我们增加了以下功能:</p><ul class=""><li id="7b8c" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">添加一个函数来获取时间</li><li id="6c48" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">添加加密买价和卖价以及买价和卖价之间的价差</li><li id="cbe9" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">再添加两个参数:重复频率(或者应用程序应该运行的次数)和时间间隔(或者时间间隔——例如:30秒)</li></ul><p id="988a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">添加获取时间的函数</strong></p><p id="e471" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">新函数<code class="fe no np nq ng b">get_coin_time()</code>与<code class="fe no np nq ng b">get_coin_price()</code>非常相似，只是它没有输入参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="314e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加加密买价和卖价以及买价和卖价之间的价差</p><p id="2b1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们增强了<code class="fe no np nq ng b">crypto_publisher()</code>来添加额外的函数调用，用于:</p><ul class=""><li id="d2cc" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">时间</li><li id="e3b2" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">购买价格</li><li id="0d90" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">销售价格</li></ul><p id="c222" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们将所有数据汇总，打印出现货价格、买价、卖价以及买价和卖价之间的价差。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="ee8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">增加两个参数:重复频率和重复间隔</strong></p><p id="d398" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Clap的构建器API，该API利用结构上的属性来添加两个命令行接口参数。</p><ul class=""><li id="c9b2" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">间隔(例如，10)</li><li id="42ed" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">频率(例如，30000或30秒)</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="972c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们添加一个循环来合并两个额外的CLI参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="f2fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">完成代码</strong></p><p id="b875" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，下面提供了完整的代码，其中有两个文件:</p><ul class=""><li id="5203" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated"><code class="fe no np nq ng b">main.rs</code>:它只是调用<code class="fe no np nq ng b">crypto_publisher_5.rs</code>中的<code class="fe no np nq ng b">crypto_publisher</code>函数。</li><li id="e9f8" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq ng b">crypto_publisher_5.rs</code></li></ul><p id="611c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">main.rs</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="8efe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe no np nq ng b">crypto_publisher_5.rs</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="3ffd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章对你有帮助！感谢阅读。</p></div></div>    
</body>
</html>