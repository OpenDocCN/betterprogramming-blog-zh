<html>
<head>
<title>Create a Web3 Chat Powered by Ethereum</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个由以太坊支持的Web3聊天</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-web3-chat-powered-by-ethereum-6886824fad7a?source=collection_archive---------7-----------------------#2022-05-02">https://betterprogramming.pub/create-a-web3-chat-powered-by-ethereum-6886824fad7a?source=collection_archive---------7-----------------------#2022-05-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bb28" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">谁能想到会这么容易？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9700e28ca88ae3d6c6bebbf2da6f24d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pj3Hx8Ene0wyPJhgQOz87A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@theshubhamdhage?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Shubham Dhage </a>在<a class="ae ky" href="https://unsplash.com/@theshubhamdhage?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="8713" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，您将学习如何将以太坊智能合约连接到React应用程序，并使用户能够与之交互。</p><p id="e681" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你是以太坊或智能合约开发的新手，我强烈推荐你阅读我以前的文章— <a class="ae ky" href="https://medium.com/web3-magazine/create-your-first-ethereum-smart-contract-with-remix-ide-667e46e81901" rel="noopener">用Remix Ide </a>创建你的第一个以太坊智能合约。</p><p id="a726" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，我们将重用我们在那里建立的智能契约。它还将为您提供开发、测试以及将智能合约部署到测试网络(Rinkeby)的完整基础知识。</p><h1 id="4428" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">先决条件</h1><ul class=""><li id="c147" class="mn mo it lb b lc mp lf mq li mr lm ms lq mt lu mu mv mw mx bi translated">要在浏览器中安装元掩码扩展</li><li id="314d" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">代码编辑器</li><li id="f0fd" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">以下主题的一些知识:以太坊，元掩码，反应，打字稿</li></ul></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><blockquote class="nk nl nm"><p id="2fe4" class="kz la nn lb b lc ld ju le lf lg jx lh no lj lk ll np ln lo lp nq lr ls lt lu im bi translated">在以太坊主网<strong class="lb iu">上工作需要真金白银！</strong></p><p id="7b05" class="kz la nn lb b lc ld ju le lf lg jx lh no lj lk ll np ln lo lp nq lr ls lt lu im bi translated">⚠️在本教程中，我假设你的元掩码设置为使用<strong class="lb iu"> Rinkeby </strong>。Rinkeby是一个t <strong class="lb iu"> est network </strong>它复制了Mainnet并允许我们免费部署和使用智能合约！</p></blockquote></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><h1 id="2843" class="lv lw it bd lx ly nr ma mb mc ns me mf jz nt ka mh kc nu kd mj kf nv kg ml mm bi translated">该项目</h1><p id="556b" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我们将为这种基于区块链的聊天构建一个界面，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/d04f102c71fb339ecebfe5422c2599e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*13jBr83qPXpy7Dlrce5STQ.png"/></div></figure><ul class=""><li id="3ee1" class="mn mo it lb b lc ld lf lg li oa lm ob lq oc lu mu mv mw mx bi translated">一个<strong class="lb iu">侧边栏，左边的</strong>，<strong class="lb iu">，</strong>包含一个按钮，用于连接(上面不可见)聊天或指示连接用户的地址。</li><li id="7ab3" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">一个<strong class="lb iu">聊天框，</strong>在右边，<strong class="lb iu"> </strong>在那里显示的消息和一个输入张贴消息到聊天。</li></ul><blockquote class="nk nl nm"><p id="26da" class="kz la nn lb b lc ld ju le lf lg jx lh no lj lk ll np ln lo lp nq lr ls lt lu im bi translated">ℹ️:在这篇文章中，我们不会关注如何让用户界面变得漂亮，我们的目标是关注如何以最简单的方式与智能合约交互！</p></blockquote><p id="3033" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我尽了最大努力让这个教程简单易懂，但是如果有什么地方不行，也不要气馁，你会在本文末尾找到一个GitHub repo的链接，里面有已经完成的项目！</p></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><h1 id="9334" class="lv lw it bd lx ly nr ma mb mc ns me mf jz nt ka mh kc nu kd mj kf nv kg ml mm bi translated">智能合同</h1><p id="e456" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我们将要连接到我们前端的智能合约是我们在上面提到的教程中创建的，有一点小小的不同，如下所示:</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="bfca" class="oi lw it oe b gy oj ok l ol om">// SPDX-License-Identifier: MIT<br/>pragma solidity 0.8.12;</span><span id="79f1" class="oi lw it oe b gy on ok l ol om">contract BlockchainChat {<br/>  <strong class="oe iu">event NewMessage(address indexed from, uint timestamp, string message);</strong></span><span id="12ad" class="oi lw it oe b gy on ok l ol om">  struct Message {<br/>    address sender;<br/>    string content;<br/>    uint timestamp;<br/>  }</span><span id="479b" class="oi lw it oe b gy on ok l ol om">  Message[] messages;</span><span id="5308" class="oi lw it oe b gy on ok l ol om">  function sendMessage(string calldata _content) public {<br/>    messages.push(Message(msg.sender, _content, block.timestamp));<br/>    <strong class="oe iu">emit NewMessage(msg.sender, block.timestamp, _content);</strong><br/>  }</span><span id="f240" class="oi lw it oe b gy on ok l ol om">  function getMessages() view public returns (Message[] memory) {<br/>    return messages;<br/>  }<br/>}</span></pre><p id="443b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oo op oq oe b">event</code>、<code class="fe oo op oq oe b">emit</code>那些是什么东西？</p><blockquote class="nk nl nm"><p id="a4e7" class="kz la nn lb b lc ld ju le lf lg jx lh no lj lk ll np ln lo lp nq lr ls lt lu im bi translated">ℹ️ <strong class="lb iu">事件</strong>用于通知外部用户区块链上发生了一些事情。</p></blockquote><p id="c54f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，“外部用户”是我们的前端应用程序，它将侦听发送到智能合约的新消息，因此我们可以立即在我们的UI中显示它们。</p><p id="febf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是变化，让我们在我们的应用程序上工作。</p></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><h1 id="6b44" class="lv lw it bd lx ly nr ma mb mc ns me mf jz nt ka mh kc nu kd mj kf nv kg ml mm bi translated">前端</h1><p id="f21b" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我准备了一个样板文件，这样你就可以马上开始编码了！</p><p id="d28c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们可以专注于重要的事情:将我们的前端连接到我们的区块链聊天智能合约。</p><p id="2ffa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个Github到starter项目的链接:</p><div class="or os gp gr ot ou"><a href="https://github.com/thmsgbrt/web3-chat-powered-by-ethereum-starter" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">GitHub-thmsgbrt/web 3-chat-powered-by-ether eum-Starter:我的教程如何…</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">这个项目是用Create React App引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">github.com</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi ks ou"/></div></div></a></div><p id="715a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你克隆了项目，用<code class="fe oo op oq oe b">npm install</code>安装了依赖项，用<code class="fe oo op oq oe b">npm start</code>启动了它，花几分钟检查几个文件，看看应用程序是如何构建的。这是非常基本的反应，所以我不打算解释它。</p><p id="ca36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是我们的行动计划:</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="3f37" class="oi lw it oe b gy oj ok l ol om">A- Enable users to connect to the chat via MetaMask</span><span id="275d" class="oi lw it oe b gy on ok l ol om">B- Instantiate the Smart Contract in our frontend</span><span id="6fc5" class="oi lw it oe b gy on ok l ol om">C- Fetch the messages from our Smart Contract and display them</span><span id="d820" class="oi lw it oe b gy on ok l ol om">D- Enable users to post a message to the chat</span><span id="a68c" class="oi lw it oe b gy on ok l ol om">E- Listen to new messages</span></pre><h1 id="df94" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">a-允许用户通过元掩码连接到聊天</h1><p id="fdc5" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">为此，我们首先需要确保浏览器上安装了MetaMask扩展。</p><p id="d5d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个允许我们这样做的钩子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。/src/useIsMetaMaskInstalled.ts</p></figure><p id="71f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很直白！解释:</p><blockquote class="nk nl nm"><p id="f35c" class="kz la nn lb b lc ld ju le lf lg jx lh no lj lk ll np ln lo lp nq lr ls lt lu im bi translated">ℹ️ MetaMask在<code class="fe oo op oq oe b">window.ethereum</code>注入一个全局API。该API允许网站请求用户的以太坊账户，从用户连接的区块链读取数据，并建议用户签署消息和交易。</p></blockquote><p id="15fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们已经准备好了钩子，那就向<code class="fe oo op oq oe b">Sidebar.tsx</code>前进，这样我们就可以利用它了:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。/src/components/Sidebar.tsx</p></figure><p id="f11b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好吧！现在，我们有了一种方法来检测是否安装了元掩码，如果没有，我们可以警告用户需要在浏览器上安装元掩码。</p><p id="c7c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们添加一个<code class="fe oo op oq oe b">onClick</code>处理程序到“与元掩码<strong class="lb iu">”</strong>按钮:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。/src/components/Sidebar.tsx</p></figure><p id="7143" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了，现在，当用户点击使用元掩码连接时，元掩码扩展将提示一个模态，并询问使用哪个帐户:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/64fd8efe55d82960644541eda2893600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TAm3QkOcm15e4jhzvil7Lg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MetaMask要求我们连接到我们的聊天</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/486dfa123c68da250ea937c99b898306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y4Fr16OGyPpd-sLHX75E7w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您现在已连接！</p></figure><p id="e232" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">🥳祝贺你！侧边栏现在显示你的以太坊地址！</p><h1 id="4ff0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">b–在我们的前端实例化智能合同</h1><p id="90a3" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">为了能够获取消息并使用户能够发送消息，我们需要有一种与我们的智能合约进行通信的方式。</p><p id="dd85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此我们将使用<code class="fe oo op oq oe b">ethers</code>库！</p><blockquote class="nk nl nm"><p id="24a6" class="kz la nn lb b lc ld ju le lf lg jx lh no lj lk ll np ln lo lp nq lr ls lt lu im bi translated">ℹ️ <code class="fe oo op oq oe b">ethers</code>是一个帮助我们的前端与我们的智能合约对话的库。<code class="fe oo op oq oe b">Ethers</code>通过一个提供者(在我们的例子中是元掩码)连接到以太坊节点，这允许我们做很多事情！在npmjs.com<a class="ae ky" href="https://www.npmjs.com/package/ethers" rel="noopener ugc nofollow" target="_blank">上阅读更多相关信息。</a></p></blockquote><p id="f1f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们在<code class="fe oo op oq oe b">ethers</code>的帮助下创建另一个挂钩，它将允许我们与智能合同进行交互:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。/src/useChatContract.ts</p></figure><p id="daff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来分解一下:</p><ul class=""><li id="fdea" class="mn mo it lb b lc ld lf lg li oa lm ob lq oc lu mu mv mw mx bi translated">我们首先检查MetaMask公开的<code class="fe oo op oq oe b">window.ethereum</code>是否存在，并从中获取一个Web3提供者，</li><li id="c42c" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">如果<code class="fe oo op oq oe b">account</code>被定义，这意味着用户点击了“用元掩码连接”按钮，<code class="fe oo op oq oe b">webThreeProvider.getSigner()</code>返回他们的地址。</li><li id="4ae9" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">最后，我们返回一个与<code class="fe oo op oq oe b">new ethers.Contract()</code>的合同实例</li></ul><h2 id="e59e" class="oi lw it bd lx pn po dn mb pp pq dp mf li pr ps mh lm pt pu mj lq pv pw ml px bi translated">实例化我们的智能合同</h2><p id="abbb" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">抬头看<code class="fe oo op oq oe b">App.tsx</code>，我们可以使用我们创建的钩子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。/src/App.tsx</p></figure><p id="22bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很好，但是如果你注意的话，这个应用不再渲染了。我们有一个错误，这里有两件事要做:</p><ul class=""><li id="f382" class="mn mo it lb b lc ld lf lg li oa lm ob lq oc lu mu mv mw mx bi translated">不是合同地址，</li><li id="efbe" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">而<code class="fe oo op oq oe b">./contract/BlockchainChat-artifact.json</code>是空的！</li></ul><h2 id="eb93" class="oi lw it bd lx pn po dn mb pp pq dp mf li pr ps mh lm pt pu mj lq pv pw ml px bi translated">合同地址</h2><p id="675a" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">这个地址告诉我们在区块链上哪里可以找到我们的区块链聊天智能合约。</p><p id="2bc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您已经遵循了我在本教程开始时提到的前一篇文章，那么您已经拥有了自己部署自己的契约的一切。</p><p id="5841" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">否则，您可以使用我为您部署到Rinkeby的这些地址之一:</p><ul class=""><li id="e87a" class="mn mo it lb b lc ld lf lg li oa lm ob lq oc lu mu mv mw mx bi translated"><code class="fe oo op oq oe b">0x56cD072f27f06a58175aEe579be55601E82D8fcD</code></li><li id="d961" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated"><code class="fe oo op oq oe b">0xD99f113cAd1fe2eeebe0E7383415B586704DB5a3</code></li><li id="08d8" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated"><code class="fe oo op oq oe b">0x23CAEEA0Bb03E6298C2eAaa76fBffa403c20984f</code></li></ul><p id="9c75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择其中任何一个，它们都是导致部署区块链聊天智能合同的地址。</p><h2 id="56a3" class="oi lw it bd lx pn po dn mb pp pq dp mf li pr ps mh lm pt pu mj lq pv pw ml px bi translated"><strong class="ak">合同的ABI </strong></h2><p id="051f" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我们的钩子期望一个来自<code class="fe oo op oq oe b">BlockchainChatArtifact</code>的<code class="fe oo op oq oe b">ABI</code>。这是两个新概念…</p><p id="8ce9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你编译一个智能契约时，你得到的是所谓的工件。</p><blockquote class="nk nl nm"><p id="6aff" class="kz la nn lb b lc ld ju le lf lg jx lh no lj lk ll np ln lo lp nq lr ls lt lu im bi translated">Remix中的ℹ️(一个创建、编译、测试和部署智能合约的IDE)，一旦你的智能合约被编译，你将在<code class="fe oo op oq oe b">contracts/artifacts</code>下找到工件。<br/> <a class="ae ky" href="https://medium.com/web3-magazine/create-your-first-ethereum-smart-contract-with-remix-ide-667e46e81901" rel="noopener">阅读我之前的文章</a>我已经在本文开始时发布，以了解更多信息并使用<strong class="lb iu"> Remix </strong>编译您自己的智能合同</p></blockquote><p id="785d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">这个工件</strong>包含了库的链接、字节码、部署的字节码、gas估计、方法标识符和ABI。它用于将库地址链接到文件。</p><p id="cbf6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">现在，什么是“ABI”:</strong></p><p id="0cb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ABI代表<em class="nn">应用二进制接口</em>。<code class="fe oo op oq oe b">ethers</code>需要我们的BlockchainChat智能合约的ABI，以便了解我们的智能合约可以做什么(方法、事件、错误等)。)并为我们的前端提供与之交互的方法。</p><p id="41b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您自己没有部署智能契约，您仍然可以通过复制下面的工件继续本文。</p><p id="3d6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://gist.github.com/thmsgbrt/1db36bc688d6984070badb14652ed65c" rel="noopener ugc nofollow" target="_blank">指向工件的要点链接</a></p><p id="694d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了，应用程序现在应该渲染没有错误！</p><h1 id="bc28" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">c–从我们的智能合约中获取消息并显示它们</h1><p id="5db1" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">好吧！既然我们已经在前端实例化了智能契约，我们终于可以获得消息了。打开<code class="fe oo op oq oe b">Chat.tsx</code>，增加以下<code class="fe oo op oq oe b">getMessages</code>功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="aae2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oo op oq oe b">Chat.tsx</code>通过它的props接收<code class="fe oo op oq oe b">chatContract</code>实例，我们可以用它来调用<code class="fe oo op oq oe b">chatContract.getMessages()</code>。收到消息后，我们填充我们的<code class="fe oo op oq oe b">messages</code>状态变量。</p><p id="72d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您聊天的智能合同发布了消息，它们应该在聊天框中可见。否则，让我们继续让我们的用户发送消息。以下是到目前为止您应该拥有的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/2e8efae023fea02384fdee882ecb6b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aBk_yiWCGJQgwEYKQbTiTg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用户已连接，没有消息显示(还没有！)</p></figure><h1 id="7a87" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">d–允许用户在聊天中发布消息</h1><p id="389d" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">在<code class="fe oo op oq oe b">Chat.tsx</code>中，增加以下<code class="fe oo op oq oe b">sendMessage</code>函数发布消息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="f6aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们继续，在<code class="fe oo op oq oe b">textarea</code>中键入一条消息并发送它！这应该会提示元掩码，要求验证交易，请继续:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/0b34e78a99512d030e4f9aca62ff3a35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwwvyxrsfN_7b5w7vKgvZw.png"/></div></div></figure><p id="ba5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户界面中的“发送消息”按钮有不同的状态。其内容根据交易状态而变化:</p><ul class=""><li id="e50a" class="mn mo it lb b lc ld lf lg li oa lm ob lq oc lu mu mv mw mx bi translated"><strong class="lb iu">“等待”</strong>表示该交易需要用户批准</li><li id="4d1d" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated"><strong class="lb iu">“发送”</strong>表示交易正在验证中。</li></ul><p id="196c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要查看您刚刚发布的消息，请重新加载页面。而且应该补充一下。</p><p id="e8bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太棒了。但是对于UX来说，必须重新加载页面来查看是否有新消息发布，这并不是非常友好的🤔。</p><p id="f3c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">救援事件！</p><h1 id="b0f8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">听新消息</h1><p id="9109" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">回到我们的智能合同。如您所见，当用户发布消息时，会发出一个事件:</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="09f4" class="oi lw it oe b gy oj ok l ol om">contract BlockchainChat {<br/>  <strong class="oe iu">event NewMessage(address indexed from, uint timestamp, string message);</strong></span><span id="452f" class="oi lw it oe b gy on ok l ol om">  // ...</span><span id="bad9" class="oi lw it oe b gy on ok l ol om">  function sendMessage(string calldata _content) public {<br/>    messages.push(Message(msg.sender, _content, block.timestamp));<br/>    <strong class="oe iu">emit NewMessage(msg.sender, block.timestamp, _content);</strong><br/>  }</span><span id="f553" class="oi lw it oe b gy on ok l ol om">  //...</span><span id="ce8f" class="oi lw it oe b gy on ok l ol om">}</span></pre><p id="0a91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过添加下面的<code class="fe oo op oq oe b">setupMessageListener</code>函数来监听这个事件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="b2e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">继续，发送一条新消息，这一次，您不必重新加载页面就可以看到您刚刚发布的消息。如果另一个用户发送消息，这显然是有效的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/dff9560589992fd6181edfa15ddca02e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rgAbWQcpBoyEiYCiQ9GPsw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的聊天有效！</p></figure><h1 id="cdc5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">这里是最终项目</h1><p id="0eaf" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">祝贺您完成本教程。我希望一切对你有用。正如我所承诺的，这是最终项目的链接:</p><div class="or os gp gr ot ou"><a href="https://github.com/thmsgbrt/web3-chat-powered-by-ethereum-finished-project" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">GitHub-thmsgbrt/web 3-chat-powered-by-ether eum-Finished-project:我的教程的完成项目…</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">这个项目是用Create React App引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">github.com</p></div></div><div class="pd l"><div class="py l pf pg ph pd pi ks ou"/></div></div></a></div><p id="2d8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>