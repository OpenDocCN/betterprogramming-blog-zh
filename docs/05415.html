<html>
<head>
<title>What’s New in iOS 14's UIMenu and ContextMenu</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 14的UIMenu和ContextMenu有什么新功能</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/whats-new-in-ios-14s-uimenu-and-contextmenu-433cd2037c37?source=collection_archive---------1-----------------------#2020-07-07">https://betterprogramming.pub/whats-new-in-ios-14s-uimenu-and-contextmenu-433cd2037c37?source=collection_archive---------1-----------------------#2020-07-07</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="1c6c" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">与UIControl、新的UIDeferredMenuElement和上下文菜单增强功能的现成集成</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/cd0db42e8093d23183cd272ccf4202a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XIRrt8P83UYKSlY7"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@yogipurnama?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Yogi Purnama </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="fba6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在iOS 13中引入，允许轻松创建菜单和子菜单，这在构建上下文菜单时非常方便。</p><p id="9c52" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">iOS 14通过分别通过<code class="fe lw lx ly lz b">menu</code>属性和初始化器引入对<code class="fe lw lx ly lz b">UIButton</code>和<code class="fe lw lx ly lz b">UIBarButtonItem</code>的开箱即用支持，为<code class="fe lw lx ly lz b">UIMenu</code>带来了更多定制。</p><p id="bd94" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在接下来的几节中，我们将看看如何在上述UI控件上设置菜单。我们还将看看新的<code class="fe lw lx ly lz b">UIDeferredMenuElement</code>，它可以让我们创建动态菜单项。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="ff9c" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">在UIButton上添加UIMenu</h1><p id="b06c" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">通过将<code class="fe lw lx ly lz b">UIMenu</code>分配给<code class="fe lw lx ly lz b">UIButton</code>上新的<code class="fe lw lx ly lz b">menu</code>属性，UIKit自动负责在长按下时显示该菜单。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="1e6b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">值得注意的是，将<code class="fe lw lx ly lz b">displayInline</code>设置为<code class="fe lw lx ly lz b">option</code>会在父菜单中显示子菜单。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ng"><img src="../Images/1d209c62ea010776d6ba030f9fd07dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/1*sOs-j5Apyncqj11S_OtrQg.gif"/></div></div></figure><p id="ec1a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了在点击按钮时立即显示菜单，我们需要将<code class="fe lw lx ly lz b">showsMenuAsPrimaryAction</code>属性设置为<code class="fe lw lx ly lz b">true</code>:</p><pre class="kk kl km kn gu nh lz ni nj aw nk bi"><span id="38ee" class="nl mi iu lz b gz nm nn l no np">button.showsMenuAsPrimaryAction = true</span></pre><p id="55f4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了确定菜单是否被触发，并可能执行一些其他操作，iOS 14为<code class="fe lw lx ly lz b">UIButton</code>引入了一个新的控制事件，即<code class="fe lw lx ly lz b">menuActionTriggered</code>。我们可以通过以下方式设置它来触发<code class="fe lw lx ly lz b">UIAction</code>处理程序:</p><pre class="kk kl km kn gu nh lz ni nj aw nk bi"><span id="9544" class="nl mi iu lz b gz nm nn l no np">button.addAction(UIAction(title: ""){ _ in print("Hello Menu")},for: .menuActionTriggered)</span></pre></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="0acd" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">在UIBarButtonItem上添加UIMenu</h1><p id="362a" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">除了提供<code class="fe lw lx ly lz b">menu</code>属性来创建和显示UI菜单，<code class="fe lw lx ly lz b">UIBarButtonItem</code>还引入了一个初始化器，其中您可以将<code class="fe lw lx ly lz b">UIMenu</code>组和主要操作作为可选参数传递。</p><p id="2970" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以下代码显示了如何用<code class="fe lw lx ly lz b">primaryAction</code>和<code class="fe lw lx ly lz b">menu</code>初始化器构建<code class="fe lw lx ly lz b">UIBarButtonItems</code>:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="6d34" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">UIButton</code>和<code class="fe lw lx ly lz b">UIBarButtonItem</code>菜单动作的重要区别在于，对于后者，没有<code class="fe lw lx ly lz b">showAsPrimaryAction</code>属性。所以，如果你想让<code class="fe lw lx ly lz b">UIBarButtonItem</code>在触地时立即显示菜单，就不要设置<code class="fe lw lx ly lz b">primaryAction</code>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ng"><img src="../Images/3a736521c143c63fd3d62fa6e0cf4b3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/1*q-HkrZSttF7hM17y00NHPA.gif"/></div></figure></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="2b04" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">iOS 14 UIDeferredMenuElement</h1><p id="9830" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated"><code class="fe lw lx ly lz b">UIDeferredMenuElement</code>是iOS 14中引入的一个强大的新组件，可以让你以异步方式添加菜单项。</p><p id="f276" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了做到这一点，您提供了一个标准的占位符菜单，一旦它被加载，就会被延迟的菜单元素所替换。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="933d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">延迟菜单提供了一种内置的缓存机制，可以确保同一实例的后续加载更快。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nq"><img src="../Images/dc83f72f10de4232db9ec5b8154ac9b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/1*k7YqjLIfL8z06VrjmSG-3A.gif"/></div></figure><p id="7dd2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">UIDeferredMenuElement</code>对于生成深度嵌套的菜单也很有用，在这种情况下，菜单项只有在需要时才会显示。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="01f8" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">iOS 14新的上下文菜单交互</h1><p id="4782" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">去年引入了上下文菜单交互，作为3D触摸菜单的替代品。iOS 14增加了两个新功能:</p><ul class=""><li id="09e9" class="nr ns iu lc b ld le lg lh lj nt ln nu lr nv lv nw nx ny nz bi translated"><code class="fe lw lx ly lz b">updateVisibleMenu</code> — <code class="fe lw lx ly lz b">UIMenu</code>元素不再是不可变的，从而允许您在显示它们的时候，就地替换它们的属性。这肯定有助于在上下文菜单中切换状态。</li><li id="d5a8" class="nr ns iu lc b ld oa lg ob lj oc ln od lr oe lv nw nx ny nz bi translated">通过调用<code class="fe lw lx ly lz b">UIContextMenuIteraction</code>实例上的<code class="fe lw lx ly lz b">menuAppearance</code>属性定制外观。这个新属性允许您将上下文菜单的外观设置为<code class="fe lw lx ly lz b">rich</code>或<code class="fe lw lx ly lz b">compact</code>，前者用于显示预览，后者是我们在前面章节中看到的默认外观。</li></ul></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="d96e" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">结束语</h1><p id="9812" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">改进后的<code class="fe lw lx ly lz b">UIMenu</code> s现在将在苹果自己的应用程序上支持大多数UI控件。例如，Safari应用程序工具栏上的选项按钮，现在显示上面的紧凑上下文菜单，而不是旧的UI动作表。</p><p id="9af6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">UIMenu</code> s也将有助于从后退按钮执行快速导航。</p><p id="0c7d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">苹果今年给UIKit带来的更新清楚地展示了这个框架将会继续存在。至少还有几年。</p><p id="98b9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这一次到此为止。感谢阅读。</p></div></div>    
</body>
</html>