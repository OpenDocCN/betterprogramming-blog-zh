<html>
<head>
<title>Automated Moderation Using OpenAI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenAI进行自动审核</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/automated-moderation-using-openai-e2276a06547a?source=collection_archive---------9-----------------------#2022-12-12">https://betterprogramming.pub/automated-moderation-using-openai-e2276a06547a?source=collection_archive---------9-----------------------#2022-12-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b11e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用人工智能工具最大化用户体验</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/95e8348f73e4861c6ee896cc0ead9565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*onFBG-hzMCtaNVRy"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@kilimanjarostudioz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乞力马扎罗山工作室</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="df9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要开始，你需要在<a class="ae kv" href="https://beta.openai.com/overview" rel="noopener ugc nofollow" target="_blank"> OpenAI </a>注册，<a class="ae kv" href="https://beta.openai.com/account/api-keys" rel="noopener ugc nofollow" target="_blank">生成一个密钥</a>。</p><p id="a9f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们将建立一个简单的Nuxt项目。只需使用跟随命令的<a class="ae kv" href="https://nuxt.com/docs/getting-started/installation#new-project" rel="noopener ugc nofollow" target="_blank">来搭建一个启动项目，并添加<code class="fe ls lt lu lv b">openai</code>包(nuxt文档更喜欢使用<code class="fe ls lt lu lv b">yarn</code>，但也可以随意跟随<code class="fe ls lt lu lv b">npm</code>或<code class="fe ls lt lu lv b">pnpm</code>步骤):</a></p><pre class="kg kh ki kj gt lw lv lx bn ly lz bi"><span id="83a1" class="ma mb iq lv b be mc md l me mf">npx nuxi init openai.moderation<br/>cd openai.moderation<br/>yarn install<br/>yarn add openai<br/>yarn dev -o</span></pre><p id="fab0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将导致starter项目运行在(通常是)<a class="ae kv" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>上。</p><p id="f12d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在您最喜欢的IDE中打开项目，让我们开始吧！</p><h1 id="fd2c" class="mg mb iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">配置密钥</h1><p id="b471" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf mz lh li lj na ll lm ln nb lp lq lr ij bi translated">在包含这一行的项目根目录下创建一个<code class="fe ls lt lu lv b">.env</code>文件(替换为您的个人密钥):</p><pre class="kg kh ki kj gt lw lv lx bn ly lz bi"><span id="b28d" class="ma mb iq lv b be mc md l me mf">OPENAI_API_KEY=ALWAYSKEEPSECRETSTOYOURSELF</span></pre><p id="6c64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，打开<code class="fe ls lt lu lv b">nuxt.config.ts</code>，确保它看起来像这样:</p><pre class="kg kh ki kj gt lw lv lx bn ly lz bi"><span id="9b4e" class="ma mb iq lv b be mc md l me mf">export default defineNuxtConfig({<br/>    runtimeConfig: {<br/>        OPENAI_API_KEY: process.env.OPENAI_API_KEY,<br/>    },<br/>})</span></pre><h1 id="e1b4" class="mg mb iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">设置API</h1><p id="c74e" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf mz lh li lj na ll lm ln nb lp lq lr ij bi translated">为了与OpenAI端点通信，我们需要一台自己的服务器。</p><p id="ffe9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Nuxt中，添加API端点就像在<code class="fe ls lt lu lv b">server/api</code>文件夹中添加文件一样简单。</p><p id="3729" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，首先创建文件夹结构，并将以下内容放在名为<code class="fe ls lt lu lv b">moderate.post.ts</code>的文件中:</p><pre class="kg kh ki kj gt lw lv lx bn ly lz bi"><span id="e686" class="ma mb iq lv b be mc md l me mf">export default defineEventHandler(event =&gt; {<br/>    const body = await readBody(event)<br/>    return body?.message<br/>})</span></pre><p id="88a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将返回我们发送到<code class="fe ls lt lu lv b">/api/moderate</code>端点的任何内容(Nuxt将为我们设置路由)。</p><h1 id="ced6" class="mg mb iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">输入组件</h1><p id="912a" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf mz lh li lj na ll lm ln nb lp lq lr ij bi translated">我们将创建一个小组件，它只接受文本输入，并在提交时到达我们设置的端点，以便我们可以验证响应。</p><p id="3baf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在项目根目录的<code class="fe ls lt lu lv b">components</code>文件夹中创建一个<code class="fe ls lt lu lv b">Moderate.vue</code>组件。</p><p id="ffb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从使用<a class="ae kv" href="https://vuejs.org/api/sfc-script-setup.html#script-setup" rel="noopener ugc nofollow" target="_blank">脚本设置符号</a>定义脚本开始:</p><pre class="kg kh ki kj gt lw lv lx bn ly lz bi"><span id="459a" class="ma mb iq lv b be mc md l me mf">&lt;script setup lang="ts"&gt;<br/>const input = ref("");<br/>const result = ref([]);<br/><br/>const onSubmit = async () =&gt; {<br/>  const response = await $fetch("/api/moderate", {<br/>    method: "post",<br/>    body: { message: input.value },<br/>  });<br/>  result.value.unshift(response);<br/>  input.value = "";<br/>};<br/>&lt;/script&gt;</span></pre><p id="e318" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们设置一个句柄来处理输入和结果，我们定义一个句柄来调用我们已经设置好的端点，将输入作为消息属性附加到主体上。(<a class="ae kv" href="https://vuejs.org/api/reactivity-core.html#ref" rel="noopener ugc nofollow" target="_blank"> The。值是指可变和无功参考值</a></p><p id="1100" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们将添加一个包含以下内容的模板:</p><ul class=""><li id="c0b5" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">包含输入的小表单；</li><li id="57f5" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">提交按钮将调用<code class="fe ls lt lu lv b">onSubmit</code>处理程序；</li><li id="4b55" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">显示端点输出的位置</li></ul><p id="a607" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以随心所欲的设计它，但是这并不是本教程的目的。直接把它粘贴到脚本标签下面:</p><pre class="kg kh ki kj gt lw lv lx bn ly lz bi"><span id="2cde" class="ma mb iq lv b be mc md l me mf">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;div class="input"&gt;<br/>      &lt;input type="text" v-model="input" /&gt;<br/>      &lt;button type="submit" @click="onSubmit"&gt;Validate moderation&lt;/button&gt;<br/>    &lt;/div&gt;<br/>    &lt;div class="output"&gt;<br/>      &lt;ul&gt;<br/>        &lt;li :key="i.id" v-for="i in result"&gt;<br/>          {{ i.results }}<br/>        &lt;/li&gt;<br/>      &lt;/ul&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="d445" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在保存这个文件，让我们将组件加载到<code class="fe ls lt lu lv b">app.vue</code>上，将它的内容替换为:</p><pre class="kg kh ki kj gt lw lv lx bn ly lz bi"><span id="ebe1" class="ma mb iq lv b be mc md l me mf">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;Moderate /&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="a898" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您应该看到组件正在本地主机上运行。一旦插入一些文本并点击提交，它应该由我们自己的端点返回，并作为列表项的一部分显示在组件中。</p><h1 id="7092" class="mg mb iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">添加智能</h1><p id="68da" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf mz lh li lj na ll lm ln nb lp lq lr ij bi translated">最后，我们将更新<code class="fe ls lt lu lv b">moderate.post.ts</code>文件以利用OpenAI的功能。<a class="ae kv" href="https://beta.openai.com/docs/guides/moderation" rel="noopener ugc nofollow" target="_blank"> moderation API </a>是更简单的API之一，所以它是一个很好的入门工具。</p><p id="ddc5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们不是立即返回<code class="fe ls lt lu lv b">body.message</code>，而是首先通过用键实例化OpenAI客户机来配置它。然后，我们将使用消息的内容查询端点。这意味着我们还需要将处理程序改为一个<code class="fe ls lt lu lv b">async</code>函数！</p><p id="6bde" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该文件应该如下所示:</p><pre class="kg kh ki kj gt lw lv lx bn ly lz bi"><span id="c376" class="ma mb iq lv b be mc md l me mf">import { Configuration, OpenAIApi } from 'openai';<br/><br/>// it's an async function now!<br/>export default defineEventHandler(async (event) =&gt; {<br/>    const body = await readBody(event)<br/>// setup the configuration<br/>    const configuration = new Configuration({<br/>        apiKey: process.env.OPENAI_API_KEY,<br/>    });<br/>// instantiate the openaiClient<br/>    const openaiClient = new OpenAIApi(configuration);<br/><br/>// Make the call to the moderation endpoint<br/>    const res = await openaiClient.createModeration({<br/>        input: body?.message,<br/>      });<br/><br/>// return the result<br/>    return res.data<br/>})</span></pre><p id="74f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样。因此，您现在有机会通过非常积极地对待输入字段来测试这一点。您应该会看到按不同类别和等级对您的输入进行的评估，如下例所示:</p><pre class="kg kh ki kj gt lw lv lx bn ly lz bi"><span id="9ceb" class="ma mb iq lv b be mc md l me mf">{<br/>  "id": "modr-XXXXX",<br/>  "model": "text-moderation-001",<br/>  "results": [<br/>    {<br/>      "categories": {<br/>        "hate": false,<br/>        "hate/threatening": false,<br/>        "self-harm": false,<br/>        "sexual": false,<br/>        "sexual/minors": false,<br/>        "violence": false,<br/>        "violence/graphic": false<br/>      },<br/>      "category_scores": {<br/>        "hate": 0.18805529177188873,<br/>        "hate/threatening": 0.0001250059431185946,<br/>        "self-harm": 0.0003706029092427343,<br/>        "sexual": 0.0008735615410842001,<br/>        "sexual/minors": 0.0007470346172340214,<br/>        "violence": 0.0041268812492489815,<br/>        "violence/graphic": 0.00023186142789199948<br/>      },<br/>      "flagged": false<br/>    }<br/>  ]<br/>}</span></pre><p id="e162" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您已经完成了这个示例，那么使用OpenAI的一个有趣方式就是使用<a class="ae kv" href="https://beta.openai.com/docs/guides/images" rel="noopener ugc nofollow" target="_blank">图像生成API </a>。</p><p id="6d76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了这个基础，你应该能够修改现有的代码或者在你喜欢的框架中进行你自己的集成。</p><p id="621f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在处理发布用户生成的内容时，使用这些工具会给你很大帮助。请记住，这只是一个示例，而不是真实的实现。此外，正如OpenAI建议的那样，在处理这类事情时，总是保持一些人的眼睛在手边。这个例子的一个有效用例是在发布之前先发制人地标记提交。</p><p id="1636" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用人工智能来减轻人类的负担而不完全消除他们，将是对当前能力的明智和良好的利用。人工智能，就像人类一样，仍然有缺陷，但我们可以利用它来帮助我们完成简单的任务。</p></div></div>    
</body>
</html>