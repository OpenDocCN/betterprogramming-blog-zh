<html>
<head>
<title>How To Fetch Browser Location With JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用JavaScript获取浏览器位置</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-fetch-browser-location-with-javascript-9f6d64a2fc26?source=collection_archive---------10-----------------------#2021-06-01">https://betterprogramming.pub/how-to-fetch-browser-location-with-javascript-9f6d64a2fc26?source=collection_archive---------10-----------------------#2021-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a343" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">具有反向地理编码以及具有或不具有本地化权限</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6610b1c5633130a9b6e31e875017716c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vGT8LFzcdbkJzFFdEW3uFw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://www.pexels.com/es-es/@pixabay?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">像素</a>在<a class="ae ky" href="https://www.pexels.com/es-es/foto/ipad-blanco-38271/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">像素</a>上拍摄的照片。</p></figure><p id="eccf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将解释如何用JavaScript获取当前位置(坐标和地址),并展示如果浏览器没有权限访问它，您可以做些什么。</p><p id="07da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了获得坐标，我们只能使用普通的JS。为了通过坐标获得地址(反向地理编码)，我将使用Mapbox的API。为此，我需要一个API访问令牌。你可以在Mapbox的网站上获得一个<a class="ae ky" href="https://docs.mapbox.com/help/getting-started/access-tokens/" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e134" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">定义页面</h1><p id="320e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，我们创建我们的<code class="fe mz na nb nc b">index.html</code>文件并导入我们将要使用的依赖项。这意味着我们的<code class="fe mz na nb nc b">location.js</code>文件和引导样式，因为我们将使用它们来给页面一个最小的外观。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">index.html</p></figure><ul class=""><li id="bf70" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">第14-15行:包含引导样式。</li><li id="410d" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">第17行:我们将我们的<code class="fe mz na nb nc b">location.js</code>文件与页面将使用的函数包含在一起。</li><li id="2915" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">第29-32行:这些行将显示最终结果。</li><li id="7371" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">第34-35行:我们调用函数来获取当前位置，并在前面的部分中显示在屏幕上。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1d8e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Location.js脚本</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">location.js -1</p></figure><p id="f031" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们定义了将要在函数中使用的常数。前两个常数用于定义所获得的位置有效的时间。<code class="fe mz na nb nc b">MAPBOX_API_TOKEN</code>常量将包含Mapbox的令牌，以访问其API并对获得的坐标进行逆地理编码，从而获得地址。最后两个常量是默认位置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">location.js -2</p></figure><p id="2ab4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们定义了一个方法，我们将把<code class="fe mz na nb nc b">timeout</code>和<code class="fe mz na nb nc b">promise</code>参数传递给它，它返回第一个完成的东西。也就是说，如果获取我们位置的<code class="fe mz na nb nc b">Promise</code>在<code class="fe mz na nb nc b">timeout</code>之前解决了，它就返回我们这个<code class="fe mz na nb nc b">promise</code>。否则，触发<code class="fe mz na nb nc b">reject</code>(第6行)。</p><h2 id="f656" class="nt md it bd me nu nv dn mi nw nx dp mm li ny nz mo lm oa ob mq lq oc od ms oe bi translated">为什么我们要这样做？</h2><p id="0573" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">浏览器需要权限才能访问我们的位置。如果我们拒绝它们，浏览器将抛出一个异常，并且<code class="fe mz na nb nc b">promise</code>将自动解决一个错误。</p><p id="5e42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，如果我们在操作系统级别拒绝位置许可，那么<code class="fe mz na nb nc b">promise</code>将永远不会被解析，并将永远等待下去。这就是为什么我们使用带有前缀时间的<code class="fe mz na nb nc b">timeout</code>。如果我们不能及时获得位置，<code class="fe mz na nb nc b">promise</code>将自动出错。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">location.js -3</p></figure><ul class=""><li id="a3b5" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">第2-4行:我们在将要写入位置的地方获取DOM元素。</li><li id="b765" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">第7行:我们试图得到我们的位置。</li><li id="4da2" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">第11-12行:如果<code class="fe mz na nb nc b">Promise</code>在给定的时间内成功解析，则获得的坐标显示在屏幕上。</li><li id="0ac2" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">第14行:我们获得相应的地址并写在屏幕上。</li><li id="bcff" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">第18-22行:如果因为我们拒绝了浏览器对我们位置的访问权限而发生错误，我们进入catch块并加载默认的预定义位置。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">location.js -4</p></figure><ul class=""><li id="5f12" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">第1-10行:<code class="fe mz na nb nc b">getPosition</code>方法调用一个浏览器方法，如果浏览器可以访问它，该方法返回位置。</li><li id="789f" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">第12-15行:<code class="fe mz na nb nc b">reverseGeocoding</code>方法使用经度、纬度和访问令牌参数调用<code class="fe mz na nb nc b">reverseExternalGeocoding</code>方法，并获取对应于这些坐标的地址。</li><li id="e2dc" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">第16行:我们写入在<code class="fe mz na nb nc b">elAddress</code>元素中获得的地址。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">location.js -5</p></figure><p id="24aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">reverseExternalGeocoding</code>方法使用经度、纬度和访问令牌参数对Mapbox API执行一个<code class="fe mz na nb nc b">Fetch</code>，并返回对应于这些坐标的JSON对象。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e5eb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">完整代码</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">location.js</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d8ce" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结果</h1><p id="8a7f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们必须在浏览器中打开与<code class="fe mz na nb nc b">location.js</code>脚本在同一个文件夹中的<code class="fe mz na nb nc b">index.html</code>文件，将显示以下屏幕。</p><p id="d3bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你点击“获取当前位置”按钮时，浏览器会询问是否允许访问该位置。该位置将通过我们的IP、GPS或当时可用的任何东西获得。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/1ef61bef889aee75e3013cc3c5a0bc31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*plA6XfY3-2Fk_BSus_BSqA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要求进入该地点</p></figure><h2 id="a1c8" class="nt md it bd me nu nv dn mi nw nx dp mm li ny nz mo lm oa ob mq lq oc od ms oe bi translated">允许访问该位置</h2><p id="5d87" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果我们授予浏览器权限，我们将在屏幕上显示与获得的坐标相对应的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/6ad1310f40171e5345cc1ec9f3272dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i3YCkjFl7g5zPID8FkjpaA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">结果</p></figure><h2 id="26d4" class="nt md it bd me nu nv dn mi nw nx dp mm li ny nz mo lm oa ob mq lq oc od ms oe bi translated">拒绝访问该位置</h2><p id="7031" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果我们拒绝访问我们的浏览器或在系统级别禁用该位置，我们将显示默认位置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/79d4ec525bc725fa598c898b91aef8c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rWEHfrf55Eo_M9A8xUgOCw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">结果</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="836e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="9b8e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文中，我们看到了如何获取执行脚本的web浏览器的当前位置的坐标，以及如何使用反向地理编码来获取与这些坐标对应的地址。</p><p id="3a89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望你觉得有用。</p></div></div>    
</body>
</html>