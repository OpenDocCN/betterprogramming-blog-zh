<html>
<head>
<title>5 Essential Terraform Tools To Use Everyday</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">日常使用的5种基本地形工具</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/5-essential-terraform-tools-to-use-everyday-e910a96e70d9?source=collection_archive---------2-----------------------#2022-02-16">https://betterprogramming.pub/5-essential-terraform-tools-to-use-everyday-e910a96e70d9?source=collection_archive---------2-----------------------#2022-02-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3189" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过Terraform提高效率并利用您的代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8d0d8d51a0659882f19510774a1054eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v42v-9babQQ4OJftLGmbzA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@christopher__burns?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯多佛·伯恩斯</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="58a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Terraform 现在是一个基本的基础设施即代码(IaC)工具，作为一名DevOps从业者，它将成为你工具箱中的必备工具。如许多开源项目，社区创建并共享许多工具，使其更加强大。</p><p id="4df7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时候一个项目周围有太多的工具和插件，你可能会感到失落。这就是为什么在这里，我将向你展示我日常使用的5种地形工具。</p><p id="97cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它们让您获得速度，并在使用Terraform时获得更多乐趣:</p><ul class=""><li id="6441" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">在项目中不同的Terraform版本之间切换。</li><li id="e938" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">检测错误并改进代码。</li><li id="f60f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">自动生成您的代码文档。</li><li id="780f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">检测代码中的潜在安全问题。</li><li id="807c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">评估变更的云成本。</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="7080" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">1.TFSwitch</h1><p id="feac" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Terraform是一个进化相当快的工具，会换版本。您需要从<a class="ae ky" href="https://www.terraform.io/downloads" rel="noopener ugc nofollow" target="_blank"> HashiCorp网站</a>下载并安装正确的版本。对于每个不同的版本，您需要相关的二进制文件。当您有几个不同版本的Terraform项目时，管理起来会很快变得非常困难。</p><p id="fdd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">TFSwitch 是一个命令行工具，解决了这个问题。它允许您选择想要使用的Terraform版本并自动安装。</p><h2 id="2925" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">在Mac上安装</h2><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="ab91" class="nn mr it oa b gy oe of l og oh">$ brew install warrensbox/tap/tfswitch</span></pre><h2 id="10e3" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">在Linux上安装</h2><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="4553" class="nn mr it oa b gy oe of l og oh">$ curl -L <a class="ae ky" href="https://raw.githubusercontent.com/warrensbox/terraform-switcher/release/install.sh" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/warrensbox/terraform-switcher/release/install.sh</a> | bash</span></pre><h2 id="d59c" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">快速入门</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/7fbd424eacdea47fe5109793a82fd507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*-PfBLFbSeoln3FPQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从<a class="ae ky" href="https://tfswitch.warrensbox.com/" rel="noopener ugc nofollow" target="_blank">https://tfswitch.warrensbox.com/</a>的“下拉菜单中选择要使用的地形版本”</p></figure><p id="3a71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">【1】</strong>:键入<code class="fe oj ok ol oa b">tfswitch</code>，在终端上按“Enter”</p><p id="5bfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> [2]: </strong>使用上下箭头选择您想要使用的Terraform版本。</p><p id="9bdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> [3]: </strong>按回车键选择地形版本。</p><p id="9292" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以在命令行上提供Terraform版本:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/cdadda9d298352037a2202ddaa775192.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*vR5Rz9P__1ou7hly.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自https://tfswitch.warrensbox.com/<a class="ae ky" href="https://tfswitch.warrensbox.com/" rel="noopener ugc nofollow" target="_blank">的“在命令行上提供平台”</a></p></figure><div class="om on gp gr oo op"><a href="https://tfswitch.warrensbox.com/" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">TFSwitch</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">tfswitch命令行工具允许您在不同版本的terraform之间切换。如果你没有特别的…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">tfswitch.warrensbox.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd ks op"/></div></div></a></div></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="08d8" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">2.TFLint</h1><p id="902b" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">运行代码时，语法错误有时不容易理解。Linters提供了加速调试和节省开发时间的重要信息。您还可以将它们集成到您的CI/CD管道中，以实现持续改进。</p><p id="3454" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Terraform基于HCL (HashiCorp语言)，这是一种描述基础设施状态的语言。TFLint 是一个支持Terraform及其语言的可插拔linter。除了林挺之外，它也是一个通过插件具有可扩展特性的框架。</p><p id="ce60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是使用TFLint可以为您的IaC项目做些什么:</p><ul class=""><li id="9110" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">找出主要云提供商可能的错误:AWS/Azure/GCP。</li><li id="46c6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">警告不恰当的语法和未使用的声明。</li><li id="e60e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">实施最佳实践和命名约定。</li></ul><div class="om on gp gr oo op"><a href="https://github.com/terraform-linters/tflint" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">GitHub-terra form-linters/TF lint:一个可插拔的Terraform Linter</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">一个可插入的Terraform Linter TFLint是一个框架，每个特性都由插件提供，主要特性如下…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">github.com</p></div></div><div class="oy l"><div class="pe l pa pb pc oy pd ks op"/></div></div></a></div><h2 id="ac68" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">在Mac上安装</h2><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="cc62" class="nn mr it oa b gy oe of l og oh">$ brew install tflint</span></pre><h2 id="e86a" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">在Linux上安装</h2><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="e2ee" class="nn mr it oa b gy oe of l og oh">$ curl -s https://raw.githubusercontent.com/terraform-linters/tflint/master/install_linux.sh | bash</span></pre><h2 id="9f0b" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">在Windows上安装</h2><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="3641" class="nn mr it oa b gy oe of l og oh">$ choco install tflint</span></pre><h2 id="83b0" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">快速入门</h2><p id="98c7" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">默认情况下，TFLint检查当前目录下的文件。您可以使用以下参数来更改行为:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="580c" class="nn mr it oa b gy oe of l og oh">$ tflint --help<br/>Usage:<br/>  tflint [OPTIONS] [FILE or DIR...]</span><span id="6266" class="nn mr it oa b gy pf of l og oh">Application Options:<br/>  -v, --version                                           Print TFLint version<br/>      --init                                              Install plugins<br/>      --langserver                                        Start language server<br/>  -f, --format=[default|json|checkstyle|junit|compact]    Output format<br/>                                                          (default: default)<br/>  -c, --config=FILE                                       Config file name<br/>                                                          (default: .tflint.hcl)<br/>      --ignore-module=SOURCE                              Ignore module sources<br/>      --enable-rule=RULE_NAME                             Enable rules from the<br/>                                                          command line<br/>      --disable-rule=RULE_NAME                            Disable rules from<br/>                                                          the command line<br/>      --only=RULE_NAME                                    Enable only this<br/>                                                          rule, disabling all<br/>                                                          other defaults. Can<br/>                                                          be specified multiple<br/>                                                          times<br/>      --enable-plugin=PLUGIN_NAME                         Enable plugins from<br/>                                                          the command line<br/>      --var-file=FILE                                     Terraform variable<br/>                                                          file name<br/>      --var='foo=bar'                                     Set a Terraform<br/>                                                          variable<br/>      --module                                            Inspect modules<br/>      --force                                             Return zero exit<br/>                                                          status even if issues<br/>                                                          found<br/>      --no-color                                          Disable colorized<br/>                                                          output<br/>      --loglevel=[trace|debug|info|warn|error]            Change the loglevel</span><span id="363d" class="nn mr it oa b gy pf of l og oh">Help Options:<br/>  -h, --help                                              Show this help message</span></pre><p id="21c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以根据以下优先级将配置文件传递给TFLint:</p><ul class=""><li id="7a1b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">当前目录(<code class="fe oj ok ol oa b">./.tflint.hcl</code>)</li><li id="2045" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">主目录(<code class="fe oj ok ol oa b">~/.tflint.hcl</code>)</li></ul><p id="fb48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe oj ok ol oa b">.tflint.hcl</code>中，您可以进行以下操作:</p><ul class=""><li id="5792" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">定义TFLint配置</li><li id="e73c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">声明要使用的插件</li><li id="3a63" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">启用/禁用特定的TFLint规则</li></ul><p id="6bae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个TFLint配置文件的示例:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="de62" class="nn mr it oa b gy oe of l og oh">config {<br/>  plugin_dir = "~/.tflint.d/plugins"<br/><br/>  module = true<br/>  force = false<br/>  disabled_by_default = false<br/><br/>  ignore_module = {<br/>    "terraform-aws-modules/vpc/aws"            = true<br/>    "terraform-aws-modules/security-group/aws" = true<br/>  }<br/><br/>  varfile = ["example1.tfvars", "example2.tfvars"]<br/>  variables = ["foo=bar", "bar=[\"baz\"]"]<br/>}</span><span id="b6ef" class="nn mr it oa b gy pf of l og oh">plugin "aws" {<br/>  enabled = true<br/>  version = "0.12.0"<br/>  source  = "github.com/terraform-linters/tflint-ruleset-aws"<br/>}</span><span id="8408" class="nn mr it oa b gy pf of l og oh">rule "aws_instance_invalid_type" {<br/>  enabled = false<br/>}</span></pre><p id="8a90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行TFLint很简单:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="e6d0" class="nn mr it oa b gy oe of l og oh">$ tflint</span></pre><p id="cda4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您没有得到预期的行为，您可以在调试模式下查看详细的日志:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="ddcb" class="nn mr it oa b gy oe of l og oh">$ TFLINT_LOG=debug tflint</span></pre><h2 id="98c5" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated"><strong class="ak">为云提供商使用插件</strong></h2><p id="b4cf" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">当您使用AWS、Azure或GCP提供商时，您可以使用相应的插件:</p><ul class=""><li id="7583" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://github.com/terraform-linters/tflint-ruleset-aws" rel="noopener ugc nofollow" target="_blank">亚马逊网络服务</a></li><li id="5929" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://github.com/terraform-linters/tflint-ruleset-azurerm" rel="noopener ugc nofollow" target="_blank">微软Azure </a></li><li id="10ff" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://github.com/terraform-linters/tflint-ruleset-google" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a></li></ul><p id="7ad8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码块表示使用AWS插件:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="6880" class="nn mr it oa b gy oe of l og oh">plugin "aws" {<br/>  enabled = true<br/>  version = "0.12.0"<br/>  source  = "github.com/terraform-linters/tflint-ruleset-aws"<br/>}</span></pre><p id="9ad1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下命令安装插件:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="39c7" class="nn mr it oa b gy oe of l og oh">$ tflint --init</span></pre><p id="51a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Terraform不验证特定于提供商的问题。下面是一个包含以下配置文件的示例:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="bd69" class="nn mr it oa b gy oe of l og oh">resource "aws_instance" "foo" {<br/>  ami           = "ami-0ff8a91507f77f867"<br/>  instance_type = "t1.2xlarge" # invalid type!<br/>}</span></pre><p id="1880" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oj ok ol oa b">t1.2xlarge</code>是无效的实例类型。运行<code class="fe oj ok ol oa b">terraform apply</code>时会出现错误。但是<code class="fe oj ok ol oa b">terraform validate</code>和<code class="fe oj ok ol oa b">terraform plan</code>命令没有显示任何错误。这是来自AWS提供者的特定问题，而不是来自Terraform语法。TFLint插件有助于在应用代码之前检测到此错误:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/9bec1b9c7129362242a5e469074c8661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6YjdpiK15k_-4iGW.gif"/></div></div></figure><h1 id="4aa1" class="mq mr it bd ms mt ph mv mw mx pi mz na jz pj ka nc kc pk kd ne kf pl kg ng nh bi translated">3.地形文档</h1><p id="878c" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">记录你的代码对于团队合作和可重用性是很重要的。<a class="ae ky" href="https://github.com/terraform-docs/terraform-docs" rel="noopener ugc nofollow" target="_blank"> Terraform-docs </a>是一个从Terraform模块以各种输出格式生成文档的快速工具。</p><div class="om on gp gr oo op"><a href="https://github.com/terraform-docs/terraform-docs" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">GitHub-terra form-docs/terra form-docs:从各种…</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">由Scalr-Terraform Automation &amp; Collaboration Software赞助，这是一个从Terraform生成文档的工具…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">github.com</p></div></div><div class="oy l"><div class="pm l pa pb pc oy pd ks op"/></div></div></a></div><h2 id="39f9" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">在Mac上安装</h2><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="7a14" class="nn mr it oa b gy oe of l og oh">$ brew install terraform-docs </span></pre><h2 id="1103" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">在Windows上安装</h2><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="1feb" class="nn mr it oa b gy oe of l og oh">$ choco install terraform-docs</span></pre><h2 id="4fee" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">在Linux上安装</h2><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="02fb" class="nn mr it oa b gy oe of l og oh">$ curl -Lo ./terraform-docs.tar.gz https://github.com/terraform-docs/terraform-docs/releases/download/v0.16.0/terraform-docs-v0.16.0-$(uname)-amd64.tar.gz<br/>$ tar -xzf terraform-docs.tar.gz<br/>$ chmod +x terraform-docs<br/>$ mv terraform-docs /usr/local/terraform-docs</span></pre><h2 id="3808" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">快速入门</h2><p id="1699" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">创建Terraform模块意味着使用输入、输出、资源以及最终的数据源。下面的Terraform片段从AMI (Amazon机器映像)创建了一个AWS EC2实例。尽管所有内容都在一个文件中，但它可以被视为一个模块:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="dded" class="nn mr it oa b gy oe of l og oh">terraform {<br/>  required_version = "&gt;= 1.0.0"<br/>  required_providers {<br/>    aws = {<br/>      source = "hashicorp/aws"<br/>    }<br/>  }<br/>}</span><span id="49a0" class="nn mr it oa b gy pf of l og oh">variable "aws_region" {<br/>  description = "The AWS region where to deploy the EC2 instance."<br/>  type        = string<br/>  default     = "us-east-1"<br/>}</span><span id="241b" class="nn mr it oa b gy pf of l og oh">variable "tags" {<br/>  description = "The tags to associate to the EC2 instance."<br/>  type        = map(string)<br/>  default     = {}<br/>}</span><span id="649e" class="nn mr it oa b gy pf of l og oh">provider "aws" {<br/>  region = var.aws_region<br/>}</span><span id="32e4" class="nn mr it oa b gy pf of l og oh">data "aws_ami" "ubuntu" {<br/>  most_recent = true</span><span id="e245" class="nn mr it oa b gy pf of l og oh">filter {<br/>    name   = "name"<br/>    values = ["ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-*"]<br/>  }</span><span id="5c6c" class="nn mr it oa b gy pf of l og oh">filter {<br/>    name   = "virtualization-type"<br/>    values = ["hvm"]<br/>  }</span><span id="2573" class="nn mr it oa b gy pf of l og oh">owners = ["099720109477"]<br/>}</span><span id="5c8f" class="nn mr it oa b gy pf of l og oh">resource "aws_instance" "default" {<br/>  ami           = data.aws_ami.ubuntu.id<br/>  instance_type = "t2.micro"</span><span id="f6b7" class="nn mr it oa b gy pf of l og oh">tags   = merge({<br/>    Name = "my-ec2-instance"<br/>  }, var.tags)<br/>}</span><span id="020c" class="nn mr it oa b gy pf of l og oh">output "arn" {<br/>  description = "EC2 instance ARN."<br/>  value       = aws_instance.default.arn<br/>}</span></pre><p id="a16c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的命令行将在markdown中生成Terraform文档，并将其存储在自述文件中:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="e63d" class="nn mr it oa b gy oe of l og oh">$ terraform-docs markdown table --output-file README.md .</span></pre><p id="597c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在自述文件中，我们可以找到模块使用的不同元素，并链接到每个元素的官方文档:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="a2b2" class="nn mr it oa b gy oe of l og oh">&lt;!-- BEGIN_TF_DOCS --&gt;<br/>## Requirements</span><span id="aae1" class="nn mr it oa b gy pf of l og oh">| Name | Version |<br/>|------|---------|<br/>| &lt;a name="requirement_terraform"&gt;&lt;/a&gt; [terraform](#requirement\_terraform) | &gt;= 1.0.0 |</span><span id="8093" class="nn mr it oa b gy pf of l og oh">## Providers</span><span id="b4f3" class="nn mr it oa b gy pf of l og oh">| Name | Version |<br/>|------|---------|<br/>| &lt;a name="provider_aws"&gt;&lt;/a&gt; [aws](#provider\_aws) | 3.74.0 |</span><span id="b11d" class="nn mr it oa b gy pf of l og oh">## Modules</span><span id="91f7" class="nn mr it oa b gy pf of l og oh">No modules.</span><span id="f3ad" class="nn mr it oa b gy pf of l og oh">## Resources</span><span id="05c8" class="nn mr it oa b gy pf of l og oh">| Name | Type |<br/>|------|------|<br/>| [aws_instance.default](<a class="ae ky" href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance" rel="noopener ugc nofollow" target="_blank">https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance</a>) | resource |<br/>| [aws_ami.ubuntu](<a class="ae ky" href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ami" rel="noopener ugc nofollow" target="_blank">https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ami</a>) | data source |</span><span id="d177" class="nn mr it oa b gy pf of l og oh">## Inputs</span><span id="4b1f" class="nn mr it oa b gy pf of l og oh">| Name | Description | Type | Default | Required |<br/>|------|-------------|------|---------|:--------:|<br/>| &lt;a name="input_aws_region"&gt;&lt;/a&gt; [aws\_region](#input\_aws\_region) | The AWS region where to deploy the EC2 instance. | `string` | `"us-east-1"` | no |<br/>| &lt;a name="input_tags"&gt;&lt;/a&gt; [tags](#input\_tags) | The tags to associate to the EC2 instance. | `map(string)` | `{}` | no |</span><span id="febe" class="nn mr it oa b gy pf of l og oh">## Outputs</span><span id="0323" class="nn mr it oa b gy pf of l og oh">| Name | Description |<br/>|------|-------------|<br/>| &lt;a name="output_arn"&gt;&lt;/a&gt; [arn](#output\_arn) | EC2 instance ARN. |<br/>&lt;!-- END_TF_DOCS --&gt;</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="c39c" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">4.切科夫</h1><p id="eac6" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Checkov 是一个静态代码分析工具，用于将基础设施扫描为包括Terraform在内的代码文件。它会查找可能导致安全性或合规性问题的错误配置。它有750个预定义的策略来检查常见的错误配置问题。</p><div class="om on gp gr oo op"><a href="https://www.checkov.io/" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">切科夫</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">Checkov扫描云基础设施配置，以便在部署之前发现错误配置。Checkov使用一个…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">www.checkov.io</p></div></div><div class="oy l"><div class="pn l pa pb pc oy pd ks op"/></div></div></a></div><h2 id="7568" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">装置</h2><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="76cf" class="nn mr it oa b gy oe of l og oh">$ pip install checkov</span></pre><h2 id="6f04" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">快速入门</h2><p id="5cf9" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们将采用terraform-docs上显示的零件代码。我们将生成地形图，并使用Checkov对其进行分析:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="3528" class="nn mr it oa b gy oe of l og oh">$ terraform init <br/>$ terraform plan -out tf.plan <br/>$ terraform show -json tf.plan  &gt; tf.json  <br/>$ checkov -f tf.json<br/><br/>       _               _<br/>   ___| |__   ___  ___| | _______   __<br/>  / __| '_ \ / _ \/ __| |/ / _ \ \ / /<br/> | (__| | | |  __/ (__|   &lt; (_) \ V /<br/>  \___|_| |_|\___|\___|_|\_\___/ \_/</span><span id="8cb2" class="nn mr it oa b gy pf of l og oh">By bridgecrew.io | version: 2.0.528<br/>Update available 2.0.528 -&gt; 2.0.829<br/>Run pip3 install -U checkov to update</span><span id="1d5c" class="nn mr it oa b gy pf of l og oh">cloudformation scan results:</span><span id="8b4c" class="nn mr it oa b gy pf of l og oh">Passed checks: 0, Failed checks: 0, Skipped checks: 0, Parsing errors: 1</span><span id="3473" class="nn mr it oa b gy pf of l og oh">Error parsing file tf.json<br/>terraform_plan scan results:</span><span id="5325" class="nn mr it oa b gy pf of l og oh">Passed checks: 2, Failed checks: 4, Skipped checks: 0</span><span id="3ac8" class="nn mr it oa b gy pf of l og oh">Check: CKV_AWS_88: "EC2 instance should not have public IP."<br/> PASSED for resource: aws_instance.default<br/> File: /tf.json:0-0<br/> Guide: <a class="ae ky" href="https://docs.bridgecrew.io/docs/public_12" rel="noopener ugc nofollow" target="_blank">https://docs.bridgecrew.io/docs/public_12</a></span><span id="c0c7" class="nn mr it oa b gy pf of l og oh">Check: CKV_AWS_46: "Ensure no hard-coded secrets exist in EC2 user data"<br/> PASSED for resource: aws_instance.default<br/> File: /tf.json:0-0<br/> Guide: <a class="ae ky" href="https://docs.bridgecrew.io/docs/bc_aws_secrets_1" rel="noopener ugc nofollow" target="_blank">https://docs.bridgecrew.io/docs/bc_aws_secrets_1</a></span><span id="4149" class="nn mr it oa b gy pf of l og oh">Check: CKV_AWS_79: "Ensure Instance Metadata Service Version 1 is not enabled"<br/> FAILED for resource: aws_instance.default<br/> File: /tf.json:0-0<br/> Guide: <a class="ae ky" href="https://docs.bridgecrew.io/docs/bc_aws_general_31" rel="noopener ugc nofollow" target="_blank">https://docs.bridgecrew.io/docs/bc_aws_general_31</a></span><span id="2613" class="nn mr it oa b gy pf of l og oh">Check: CKV_AWS_126: "Ensure that detailed monitoring is enabled for EC2 instances"<br/> FAILED for resource: aws_instance.default<br/> File: /tf.json:0-0<br/> Guide: <a class="ae ky" href="https://docs.bridgecrew.io/docs/ensure-that-detailed-monitoring-is-enabled-for-ec2-instances" rel="noopener ugc nofollow" target="_blank">https://docs.bridgecrew.io/docs/ensure-that-detailed-monitoring-is-enabled-for-ec2-instances</a></span><span id="c8bf" class="nn mr it oa b gy pf of l og oh">Check: CKV_AWS_135: "Ensure that EC2 is EBS optimized"<br/> FAILED for resource: aws_instance.default<br/> File: /tf.json:0-0<br/> Guide: <a class="ae ky" href="https://docs.bridgecrew.io/docs/ensure-that-ec2-is-ebs-optimized" rel="noopener ugc nofollow" target="_blank">https://docs.bridgecrew.io/docs/ensure-that-ec2-is-ebs-optimized</a></span><span id="0524" class="nn mr it oa b gy pf of l og oh">Check: CKV_AWS_8: "Ensure all data stored in the Launch configuration EBS is securely encrypted"<br/> FAILED for resource: aws_instance.default<br/> File: /tf.json:0-0<br/> Guide: <a class="ae ky" href="https://docs.bridgecrew.io/docs/general_13" rel="noopener ugc nofollow" target="_blank">https://docs.bridgecrew.io/docs/general_13</a></span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="b96a" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">5.Infracost:从代码中估计云成本</h1><p id="b345" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Terraform所做的更改可能会改变云提供商托管的资源的状态。根据这些情况，费用可能会有所不同。在编写IaC代码时，记住这一点很重要。</p><p id="e005" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Infracost显示了Terraform等基础设施即代码项目的云成本估算。它有助于快速查看成本明细，并提前比较不同的选项。</p><div class="om on gp gr oo op"><a href="https://github.com/infracost/infracost" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">GitHub — infracost/infracost:拉式请求中Terraform的云成本估计💰📉爱你的…</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">Infracost显示Terraform的云成本估计。它使德沃普斯、SRE和工程师们能够看到成本分解和…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">github.com</p></div></div><div class="oy l"><div class="po l pa pb pc oy pd ks op"/></div></div></a></div><h2 id="146e" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">在Mac上安装</h2><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="ad7a" class="nn mr it oa b gy oe of l og oh">$ brew install infracost</span></pre><h2 id="ea19" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">在Linux上安装</h2><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="8384" class="nn mr it oa b gy oe of l og oh">$ /usr/local/bin<br/>curl -fsSL <a class="ae ky" href="https://raw.githubusercontent.com/infracost/infracost/master/scripts/install.sh" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/infracost/infracost/master/scripts/install.sh</a> | sh</span></pre><h2 id="adc8" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">快速入门</h2><p id="1003" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">使用您的电子邮件地址注册infracost以接收API密钥:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="16f8" class="nn mr it oa b gy oe of l og oh">$ infracost register</span></pre><p id="855e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你的API密匙在<code class="fe oj ok ol oa b">$HOME/.config/infracost/credentials.yml</code>中</p><p id="9344" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用infracost获得完整的每月成本明细:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="0471" class="nn mr it oa b gy oe of l og oh">$ infracost breakdown --path .                                                                                                <br/>Detected Terraform directory at .<br/>  ✔ Checking for cached plan... not found<br/>  ✔ Running terraform plan<br/>  ✔ Running terraform show<br/>  ✔ Extracting only cost-related params from terraform<br/>  ✔ Retrieving cloud prices to calculate costs</span><span id="f85e" class="nn mr it oa b gy pf of l og oh">Project: .</span><span id="7373" class="nn mr it oa b gy pf of l og oh">Name                                                 Monthly Qty  Unit   Monthly Cost</span><span id="e262" class="nn mr it oa b gy pf of l og oh">aws_instance.default<br/> ├─ Instance usage (Linux/UNIX, on-demand, t2.micro)          730  hours         $8.47<br/> └─ root_block_device<br/>    └─ Storage (general purpose SSD, gp2)                       8  GB            $0.80</span><span id="9ad6" class="nn mr it oa b gy pf of l og oh">OVERALL TOTAL                                                                   $9.27<br/>──────────────────────────────────<br/>1 cloud resource was detected, rerun with --show-skipped to see details:<br/>∙ 1 was estimated, 1 includes usage-based costs, see <a class="ae ky" href="https://infracost.io/usage-file" rel="noopener ugc nofollow" target="_blank">https://infracost.io/usage-file</a></span></pre><p id="2e14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以发现由于代码更改而导致的每月费用的变化:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="981f" class="nn mr it oa b gy oe of l og oh">$ infracost diff --path .<br/>Detected Terraform directory at .<br/>  ✔ Checking for cached plan... change detected<br/>  ✔ Running terraform plan<br/>  ✔ Running terraform show<br/>  ✔ Extracting only cost-related params from terraform<br/>  ✔ Retrieving cloud prices to calculate costs</span><span id="0272" class="nn mr it oa b gy pf of l og oh">Project: .</span><span id="e843" class="nn mr it oa b gy pf of l og oh">~ aws_instance.default<br/>  +$21.90 ($9.27 → $31.17)</span><span id="65a7" class="nn mr it oa b gy pf of l og oh">~ Instance usage (Linux/UNIX, on-demand, t2.micro → t3.medium)<br/>      +$21.90 ($8.47 → $30.37)</span><span id="a865" class="nn mr it oa b gy pf of l og oh">Monthly cost change for .<br/>Amount:  +$21.90 ($9.27 → $31.17)<br/>Percent: +236%</span><span id="5d6d" class="nn mr it oa b gy pf of l og oh">──────────────────────────────────<br/>Key: ~ changed, + added, - removed</span><span id="003b" class="nn mr it oa b gy pf of l og oh">1 cloud resource was detected, rerun with --show-skipped to see details:<br/>∙ 1 was estimated, 1 includes usage-based costs, see <a class="ae ky" href="https://infracost.io/usage-file" rel="noopener ugc nofollow" target="_blank">https://infracost.io/usage-file</a></span><span id="c8d6" class="nn mr it oa b gy pf of l og oh">Add cost estimates to your pull requests: <a class="ae ky" href="https://infracost.io/cicd" rel="noopener ugc nofollow" target="_blank">https://infracost.io/cicd</a></span></pre><p id="6026" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以生成HTML报告:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="5c43" class="nn mr it oa b gy oe of l og oh">$ infracost breakdown --path . --format html &gt; report.html                                                                  <br/>Detected Terraform directory at .<br/>  ✔ Checking for cached plan... found<br/>  ✔ Extracting only cost-related params from terraform<br/>  ✔ Retrieving cloud prices to calculate costs</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/1ed66e7738c1dc94601522f7e78728d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XS05TyUHULfCvlPkmssxrw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Infracost HTML报告</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="bdba" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="8736" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们在本文中一起看到的5种地形工具将在几个方面为您带来好处:</p><ul class=""><li id="075f" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">使用TFLint更快地调试代码并预测错误</li><li id="2306" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">限制重复性任务:使用TFSwitch进行版本管理，使用Terraform-Docs实现文档自动化。</li><li id="5288" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">使用Checkov识别开发过程中的安全问题</li><li id="b839" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">通过Infracost了解基础架构变更的成本影响</li></ul><p id="024a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以将所有这些工具集成到您的CI/CD管道中！</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="8cf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢谢大家！🙏我希望这篇文章能帮助你找到下一个很棒的Terraform工具。想了解更多关于DevOps的知识？要查看更多像这样的文章，它在下面！⬇️</p><div class="om on gp gr oo op"><a href="https://getbetterdevops.io/" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">Getbetterdevops</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">Getbetterdevops是一个devops博客，帮助学习现代基础设施和云技术，如Kubernetes…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">getbetterdevops.io</p></div></div><div class="oy l"><div class="pq l pa pb pc oy pd ks op"/></div></div></a></div></div></div>    
</body>
</html>