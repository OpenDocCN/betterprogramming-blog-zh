<html>
<head>
<title>How to Integrate the Google Sheets API With Python Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Google Sheets API与Python Flask集成</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/integrating-google-sheets-api-with-python-flask-987d48b7674e?source=collection_archive---------3-----------------------#2020-06-09">https://betterprogramming.pub/integrating-google-sheets-api-with-python-flask-987d48b7674e?source=collection_archive---------3-----------------------#2020-06-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1bd0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建一个在Google Sheet上执行CRUD操作的API</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/879a8492b8b80a20940b91eab28cd65f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vzr_kiPpFbvTkuCg.png"/></div></div></figure><p id="5970" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本教程中，我将展示如何通过构建您自己的API来集成Google Sheets API和Python Flask，该API本质上在您的Google Sheets中执行CRUD(创建、读取、更新和删除)操作。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="b57e" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">初始设置</h1><h2 id="5265" class="mp ly it bd lz mq mr dn md ms mt dp mh ld mu mv mj lh mw mx ml ll my mz mn na bi translated">在谷歌云控制台上创建一个新项目</h2><p id="2833" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">登录<a class="ae ng" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">console.cloud.google.com</a>并创建一个新项目。您应该会被自动重定向到新项目的主仪表板。</p><p id="3f0b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，导航到<strong class="kw iu">API&amp;服务&gt;库:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/294531200ad354b6bb6e44bf877fc8a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5h7IkS_jal8TGnxl.png"/></div></div></figure><p id="8d2c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">向下滚动到<strong class="kw iu"> </strong> G Suite <strong class="kw iu"> </strong>部分，点击Google Drive API，然后启用它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/f873da9160627aa8d7482e0bab9e0575.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xROwPG4Xapn8K-n1.png"/></div></div></figure><p id="eb78" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您将被重定向到以下页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/b76f184d2a80f28a2d12a2c359d01d87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SjA2l8pGhpAnnTZp.png"/></div></div></figure><p id="2289" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">单击“创建凭据”，并在表格中填写以下详细信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/5617300f79065087635230551b871f28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fLaCXo4Mm10Tq1-0.png"/></div></div></figure><p id="ce12" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将“服务帐户名称”替换为您喜欢的名称。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/7a0976076223dced00a3ade77a91e1ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WGlopEBFuJASjfme.png"/></div></div></figure><p id="66bf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">点击“继续”后，包含您的凭证的JSON文件应该会自动下载。JSON文件的名称可能很复杂。为了以后设置我们的API时的简单性和一致性，将文件重命名为<code class="fe nl nm nn no b">credentials.json</code>。</p><p id="b881" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，对Google Sheets API做同样的事情，在G Suite部分搜索并启用它。然而，与Google Drive API不同，您不需要创建任何凭证。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/bfc7f8e6e8f5dd7ece67ec7d0bcc94a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZRPh8lEmuRD6Ajy4.png"/></div></div></figure><p id="282c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，在您最喜欢的文本编辑器中打开credentials.json，搜索<code class="fe nl nm nn no b">client_email</code> <strong class="kw iu"> </strong>键。复制相应的电子邮件地址值，并与该电子邮件共享google sheet文档，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/7481baf89a712602c79e6fbbc690b6ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mYFvcm6E5D_BVjUG.png"/></div></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="6f7e" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">Python项目设置</h1><p id="9703" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">与任何Python项目一样，首先创建您的虚拟环境。如果你不知道这意味着什么，我推荐使用<code class="fe nl nm nn no b">PyCharm</code>IDE——你可以在这里免费下载社区版<a class="ae ng" href="https://www.jetbrains.com/pycharm/download" rel="noopener ugc nofollow" target="_blank">。<code class="fe nl nm nn no b">PyCharm</code>创建新项目时，会自动创建虚拟环境。</a></p><p id="36cd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建一个新项目后，用一个<strong class="kw iu"> Python文件</strong>(您可以随意命名，但我将使用<a class="ae ng" href="http://app.py/" rel="noopener ugc nofollow" target="_blank"> app.py </a>)和credentials.json(下载的json文件，我们已将其重命名)初始化项目目录。</p><p id="fc9d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，导航到设置&gt;项目解释器并安装以下模块:</p><ul class=""><li id="b884" class="np nq it kw b kx ky la lb ld nr lh ns ll nt lp nu nv nw nx bi translated"><code class="fe nl nm nn no b">Flask</code></li><li id="3fe8" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated"><code class="fe nl nm nn no b">gspread</code></li><li id="ba03" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated"><code class="fe nl nm nn no b">oauth2client</code></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/c70b1a129c3887061a8a1bdecfa01858.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MMkuSOlx7rGpMIuk.png"/></div></div></figure><p id="c2b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">或者，如果您愿意，您可以选择<code class="fe nl nm nn no b">pip install</code>这些模块。</p><p id="a5c7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">模块安装好后，我们终于可以开始编码了！</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="e7a6" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">构建API</h1><p id="0f8f" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">首先，让我们导入所有已安装的模块:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="1f9a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，让我们通过添加以下代码行来授权自己从我们的API访问我们想要修改的google sheet(即，用您的Google Sheet的名称替换“Google Sheets Python Tutorial ”):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="fd31" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们正在阅读以建立我们的API路线。在这个例子中，我已经初始化了我的google工作表，使其标题行如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/1edad908d7381ecd869bc61ff3ba8eec.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/0*FifLJyTKu5CkY1cl.png"/></div></figure><p id="a8fd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">基本上，它是一个表格，显示代表每个用户在特定日期给出评论分数的电子邮件。很明显，你不需要遵循我的例子——这只是为了举例说明。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="3798" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">获取路线</h1><p id="4efd" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">如果我们想从工作表中获取所有的数据，那么我们只需调用<code class="fe nl nm nn no b">gsheet.get_all_records()</code>和一个`方法就可以实现如下:</p><pre class="kj kk kl km gt og no oh oi aw oj bi"><span id="0f38" class="mp ly it no b gy ok ol l om on"># An example GET Route to get all reviews<br/>@app.route('/all_reviews', methods=["GET"])<br/>def all_reviews():<br/>    return jsonify(gsheet.get_all_records())</span></pre></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="4d3b" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">邮寄路线</h1><p id="a13f" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">如果我们想要添加一个数据条目，那么我们可以调用接受两个参数的<code class="fe nl nm nn no b">insert_row</code>函数:一个表示您想要插入的行数据的列表和您想要插入数据的行号。</p><p id="4513" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="oo">注意:行号不是基于零索引的，这意味着标题行是索引</em> <code class="fe nl nm nn no b"><em class="oo">1</em></code> <em class="oo">，因此如果您想在标题行之后插入一行，则</em> <code class="fe nl nm nn no b"><em class="oo">row_number</em></code> <em class="oo">将是</em> <code class="fe nl nm nn no b"><em class="oo">2</em></code> <em class="oo">。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="02c4" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">删除路线</h1><p id="947c" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">如果我们想删除一个条目，那么我们可以调用<code class="fe nl nm nn no b">delete_row</code>函数，它接受一个参数——行号。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="36f2" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">修补路线</h1><p id="aea7" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">如果我们想要修改一个条目，我们可以调用<code class="fe nl nm nn no b">update_cell</code>函数，它接受三个参数:行号、列号和我们想要更新的数据。前两个参数的作用类似于2D平面中的坐标，指定我们要更新表格中的哪个单元格。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="f2e6" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">包扎</h1><p id="2741" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">为了让我们的API工作，我们需要它在运行时监听某个地方。为此，我们可以添加以下代码行:</p><pre class="kj kk kl km gt og no oh oi aw oj bi"><span id="bc29" class="mp ly it no b gy ok ol l om on">if __name__ == "__main__":<br/>    app.run(host='0.0.0.0', debug=False, port=os.environ.get('PORT', 80))</span></pre><p id="fa06" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就是这样！现在，您已经有了一个可以通过HTTP请求修改Google Sheets的完整的API。</p><p id="c063" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">显然，你可以用Google Sheets API做更多的事情，你可以在这里阅读<a class="ae ng" href="https://gspread.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"/>，但是我认为这是一个好的开始。</p><p id="8756" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读！</p></div></div>    
</body>
</html>