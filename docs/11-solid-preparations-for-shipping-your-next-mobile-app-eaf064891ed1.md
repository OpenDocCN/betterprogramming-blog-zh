# 想象一下，你正在向火星发送一个移动应用程序。你如何让它变得健壮？

> 原文：<https://betterprogramming.pub/11-solid-preparations-for-shipping-your-next-mobile-app-eaf064891ed1>

## 发布下一款应用的 11 项坚实准备

![](img/da4bb77c396a773ff2b922290c64124a.png)

美国宇航局在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄的照片

当你运送你的应用程序时，就像把它运送到火星一样(除了仍然有互联网连接)。我们再也无法控制它了。任何下载了它的人都会把它存在手机里。没办法找回来了。

当然，我们仍然可以发布下一个版本的变化，但不能保证每个人都会或能够升级它。

因此，当我们运送一个应用程序时，就像我们运送给火星上的人(有互联网)使用一样。有了这种心态，它将使我们更好地准备更坚实的应用程序发布。

下面是我们的应用程序在发送到“火星”之前需要做的一些准备

# 1.在我们的应用程序中设置一个关闭开关

应用程序与 web 有很大不同。我们没有办法强迫用户随时升级到我们的应用程序的新版本。

有些情况下，我们需要阻止所有用户使用我们应用程序的某个版本，例如:

*   旧应用程序不再与我们最新的后端服务兼容。
*   旧版 app 存在一些安全漏洞。
*   旧应用程序使用的是旧的操作系统版本，无法使用最新的操作系统功能。
*   有一些法律问题要求我们停止提供该应用程序。

当上述任何问题发生时，我们希望停止所有用户使用该版本，并让他们升级到最新版本的应用程序。怎么才能做到呢？

答案是关闭开关；在应用程序中设置。

当应用程序启动时，它会检查我们的服务器版本是否仍然兼容。如果没有，我们的应用程序应该不再进行。相反，它应该显示一个屏幕，要求用户将应用程序升级到最新版本。

# 2.“注意，注意”——给用户的信息

关闭开关很好。它可以获得用户的关注，以抓住他们的应用程序的升级。然而，有时这并不是我们想要向用户传达的信息:升级应用程序并不是答案。

有比死亡开关更好的东西。我们需要有能力向用户发送自定义消息。

臭名昭著的谷歌地图崩溃事件就是一个很好的例子，说明了我们为什么需要这样一条信息。在这次事件中，所有使用地图 WebView 的 iOS 和 Android 应用都崩溃了。这里是问题跟踪:【https://issuetracker.google.com/issues/154855417

当这个崩溃发生时，一个有用的消息要求用户清除他们的缓存。

许多没有这种能力通知用户的应用程序开发人员被抓住了！这里有一个例子:

> “清除缓存后，应用程序现在可以工作，但这对业务不利，我不能要求我的所有客户清除缓存并再次登录:(:(:(:("— [Source](https://issuetracker.google.com/issues/154855417#comment159)

那些已经准备好应用程序的人…至少感觉更好。

> “我们刚刚要求 437k 用户清除缓存和清除数据…用截屏。可怕的选择，但目前看不到任何其他选择。”——[来源](https://issuetracker.google.com/issues/154855417#comment185)

# 3.清除应用缓存和数据的用户设置菜单

“当一切都失败时，重置”是许多电子产品的答案。

应用程序也是如此。有时，可能会有一些奇怪的错误，用户似乎无法摆脱，但我们无法重现它们。解决这个问题最简单的方法是重置应用程序。

再次，一个很好的例子是臭名昭著的谷歌地图崩溃，谷歌提议开发者让他们的用户清除缓存— [来源](https://issuetracker.google.com/issues/154855417#comment162)。

当然，我们可以让用户卸载并重新安装应用程序，但这将冒着用户不再安装它的风险。另外，这样看起来不专业。

我们也可以指导用户进入他们的手机设置，清除应用程序的内容，但对于 Android 手机，不同的手机可能有不同的设置页面。

所以，最简单的方法就是在 app 内内置用户设置。用户只需点击一个按钮，应用程序就会自动清除其内容并重新开始。

这也是传递给我们的技术支持团队的一个方便一致的指令。当用户打进来时，他们可以指导用户如何做。

下面是 Android 和 iOS 如何实现这一点的参考:

*   Android:[https://developer . Android . com/reference/Android/app/activity manager . html # clearApplicationUserData()](https://developer.android.com/reference/android/app/ActivityManager.html#clearApplicationUserData())
*   iOS:[https://developer . apple . com/documentation/foundation/user defaults/1417339-removepersistentdomain](https://developer.apple.com/documentation/foundation/userdefaults/1417339-removepersistentdomain)

# 4.确保用户数据存储在服务器上

如果我们的应用程序确实允许用户存储一些对他们继续有效使用应用程序至关重要的数据——永远、永远、永远不要只将数据留在本地设备上。

设备上的所有数据都不能保证是永久的。例如:

*   该设备可能会被毁坏或丢失。
*   用户可以更换电话。
*   该应用程序可能会面临一个需要清除所有数据的错误。

在谷歌建议清除该应用的数据以修复一个 bug 问题后，以下是一名开发者的回应:

> “清理应用程序数据似乎可以解决这个问题，因为我们的应用程序是用于测量的，这意味着删除数据库中存储的所有测量数据，这是不可接受的。”— [来源](https://issuetracker.google.com/issues/154855417#comment173)

尽管存储在本地的所有数据都是私有的，但丢失的风险也是最高的。

如果我们不能总是将数据发送到服务器，通过偶尔的备份将数据存储在服务器中对用户来说仍然是有用和有益的。

# 5.本地存储提取数据以获得更好的离线体验

正如上面指出的，最好将我们的数据存储在服务器上。然而，如果我们走极端，将所有数据都存储在服务器上，我们将在互联网覆盖有限的地方削弱我们的应用程序。

火车上的用户可能会有间歇性的互联网接入问题，而到另一个国家旅行的用户，不得不暂时关闭他们的数据计划，将无法再使用我们的应用程序。

为了提供更好的用户体验，在设备上存储一些关键数据仍然很重要，当用户无法访问互联网时，这可能会非常方便。

数据可以被暂时或永久存储。它必须与服务器同步，以确保它们是一致的。一些处理这种场景的架构已经就位。以下是 Android 和 iOS 版:

*   安卓—【https://developer.android.com/training/sync-adapters 
*   iOS—【https://developer.apple.com/forums/thread/69716 

# 6.“信任，但要验证”我们的端点服务

已故总统罗纳德·里根的名言:“信任，但要核实。”

当我们开发应用程序时也是如此，特别是对于它从服务器获取的任何数据，因为服务器和客户端(应用程序)是两个不同的实体。

尽管这两个实体之间有合同，但不能保证服务器会一直履行合同。服务器不仅仅服务于应用程序的一个版本，它服务于已经发布的应用程序的所有版本。总有一种风险，在某个时候，服务器可能无法提供正确版本的应用程序。

因此，对于应用程序来说，总是检查数据读取是很重要的，例如，不要假设非空值总是真的。总是检查和优雅地处理它。

这就是我们所说的**优雅退出的偏执编程。**独立依赖的软件设计方法将使应用程序更能抵抗服务器的这种意外合同失败。

[](https://towardsdatascience.com/the-root-of-all-software-design-challenge-independent-or-dependent-31252051bf0e) [## 所有软件设计挑战的根源:独立还是依赖

### 独立依赖设计:许多软件设计方案的蓝图

towardsdatascience.com](https://towardsdatascience.com/the-root-of-all-software-design-challenge-independent-or-dependent-31252051bf0e) 

# 7.避免硬编码端点 URL —获取它

没有什么是永恒的——即使是我们拥有的东西——这包括我们的端点 URL。虽然很少发生，但一旦发生，我们所有的应用都会宕机。

对于服务器系统，当它停机时，我们有灾难恢复来恢复它们。对于应用程序，如果因为任何原因我们丢失了端点 URL，我们如何避免我们的应用程序宕机？

为了降低风险，我们应该获取所有的端点 URL(属于我们的)(而不是硬编码在应用程序中),除了获取这些端点的第一次获取。第一次提取应该来自不同的域。这是为了防止存储端点 URL 的服务器一起宕机。

在应用程序中，它可以有一个本地存储的默认端点 URL。如果初始网络获取关闭，或者存储端点的域关闭，它有一些默认的端点 URL 可以使用。

我们可能根本不需要使用它——但愿如此——但当它发生时，我们会感谢我们把它放在了适当的位置。

# 8.远程切换—无需新版本即可定制应用

在一个典型的应用程序中，我们向用户发布的就是所有的内容。如果我们想为用户提供新的功能，我们需要发布新版本的应用程序。

这样做有几个缺点，包括以下几点:

*   我们不能随心所欲地打开或关闭功能。这些变化都需要一个新版本的应用程序。
*   我们无法实验一个特性是好是坏。当它被发布，并被证明是坏的，我们将不得不发布另一个版本来删除它。
*   当我们向用户发布它时，我们必须向每个下载该应用程序的人发布该功能。
*   我们在应用程序中的功能发布取决于用户下载最新版本应用程序的速度。我们无法控制发布的时间。

为了克服这些限制，我们可以在应用程序中嵌入 remote toggle 来控制应用程序中可用的功能，这样用户就可以看到一些部分，而不是其他部分。

谷歌提供了一个名为 [Firebase Remote Config](https://firebase.google.com/docs/remote-config) 的出色功能，它允许我们做以下事情:

1.  能够远程打开/关闭某个功能，或发送到应用程序的任何值
2.  能够针对特定设置仅发送给特定百分比的用户
3.  能够创建一个单独的用户组，发送不同的值来配置他们的应用程序，而不是其他组。这被称为 A/B 测试，它允许我们更好地试验一些特性

多好啊！我们可以远程控制我们的应用程序！

# 9.能够在许多事情上不断获得反馈

如果无法获得关于我们的应用程序如何工作的反馈，那么拥有远程控制是没有用的。幸运的是， [Firebase 远程配置](https://firebase.google.com/docs/remote-config)确实给我们提供了一些反馈。

除了远程配置反馈，我们还需要许多类型的反馈来了解我们的应用程序的状态。以下是一些例子:

1.  分析——对于所有企业来说，分析对于了解用户如何与应用程序交互以及我们的功能使用情况(或未使用情况)最为重要。
2.  崩溃报告——当我们的应用程序崩溃时，我们希望能够尽快知道。AppStore 和 Playstore 确实有一些数据，但是有限。Firebase Crashlytics 是实现这一目的的绝佳工具。
3.  非崩溃(问题)报告—并非所有的错误都是崩溃。有些可能是互联网错误，不会导致崩溃。我们也需要报告这些信息。在这种情况下，也可以使用 Firebase Crashlytics。
4.  用户反馈——如果用户喜欢提供一些直接的反馈，我们可以在设置菜单中提供一个地方，用户可以在那里点击并联系我们。让用户更容易找到我们是最有帮助的。在反馈中，我们还可以自动嵌入应用程序的一些信息(例如，应用程序版本、操作系统版本等。)，以减少用户必须手动提供的内容
5.  用户评分——这已经由 AppStore 和 PlayStore 提供了。但是用户回商店给 app 评分的可能性比较小(生气的时候除外:P)。为了鼓励用户评级，我们可以创建一个算法来提示用户评级，而不会使其过于侵入。iOS 和 Android 现在都有应用内评分功能。以下是一些例子:

*   安卓—【https://developer.android.com/guide/playcore/in-app-review 
*   iOS—【https://developer.apple.com/app-store/ratings-and-reviews/ 

我们对应用程序的行为或使用了解得越多，我们就能更好地应对它。这就是敏捷开发，不是吗？

# 10.针对任何崩溃的全球保护

如果我在应用程序中遇到任何错误，我最讨厌的事情按以下顺序排列——从最差到最好:

1.  这个应用程序就这么凭空消失了。
2.  这个应用程序出现了一个神秘的错误信息。
3.  应用程序告诉我它遇到了错误，但没有告诉我下一步该怎么做。
4.  应用程序告诉我它遇到了错误，然后给出一些要采取的措施(例如，等待一段时间，清除应用程序数据，升级应用程序，通过反馈按钮提交)

显然，第四个是伟大的，因为它给了用户一些行动的权力。虽然我不喜欢，但我知道下一步该怎么做。我会觉得被赋予了力量。

当我们开发应用程序时，有些错误我们永远不知道它会如何或何时崩溃。因此，如果我们能有一个全球安全网，涵盖所有内容，并向用户提供感激的信息，这将减少应用程序被否决的机会。

这种先发制人是一种降低不良印象的成本有效的措施，即使当这种不利的事情发生时。

# 11.“职业保障质量保证”——发货前

在进行必要的检查以确保一切正常之前，火箭不会发射。一旦被释放，就没有回头路了。

同样对于应用程序，虽然我们不能防止所有的错误，但我们可以在公开之前防止一些最基本的问题。

自动化测试是伟大的，但是没有什么比得上让一个人亲自使用它，通过所有的基本流程来确保它们仍然工作。以下是一些例子:

*   启动应用程序并运行所有基本流程，例如认证流程、所有基本选项卡或菜单、业务创收流程
*   将应用从先前版本升级到下一版本。当数据库迁移发生时，它可能是一个核弹错误。
*   发送反馈和接收通知的能力等。，以确保应用发布后仍能与我们保持联系。

当遇到一些错误时，会震动整个公司。这被称为“职业限制错误”永远不要让那些虫子通过。为了避免这种情况发生，让我们每次在发布应用程序之前都忠实地执行“职业保障 QA”。

# 最后的话

对于我们的第一个应用程序来说，上面的一些项目可能看起来不需要，但是当需要出现时，我们会希望我们从一开始就把它们放在适当的位置。

如果我们在第一次开发我们的应用程序时考虑这些项目，这也将有助于我们从一开始就准备一个更坚实的应用程序开发框架。以下是一些例子:

*   塑造我们的应用程序的初始架构(例如，数据同步机制，让框架报告错误)。
*   形成适当的结构和支持(例如，远程配置、分析、崩溃报告)。
*   生成一些开发指南(例如，避免硬编码 URL，必要的健全性测试清单)。

如果处理得当，从长远来看，这将有利于应用程序的开发。然后我们可以有一个更愉快的旅程。也许我们的应用程序可以持续到人类登上火星的那一天——把它带过来:p。