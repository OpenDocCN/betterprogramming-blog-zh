<html>
<head>
<title>Automate JavaScript Code Linting and Formatting in 5 Simple Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过5个简单的步骤实现JavaScript代码林挺和格式化的自动化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/automate-javascript-code-linting-and-formatting-in-5-simple-steps-9e7a5751fe7f?source=collection_archive---------7-----------------------#2021-08-18">https://betterprogramming.pub/automate-javascript-code-linting-and-formatting-in-5-simple-steps-9e7a5751fe7f?source=collection_archive---------7-----------------------#2021-08-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="70c6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">永远不要再犯错误</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/7f63d4b3dd78199ded3fcbad58474eae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*4Rh0GpILBjkkk17cgiHTxw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><h1 id="5831" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">什么是Git挂钩？</h1><p id="1050" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">Git挂钩基本上是在重要操作发生之前触发的脚本，例如，在提交之前，在提交之后将代码推送到repo之前，等等。你可以在<a class="ae mi" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多关于Git钩子和不同种类钩子的知识。</p><p id="491d" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><a class="ae mi" href="https://medium.com/google-developer-experts/using-git-hooks-to-improve-your-development-workflow-8f5a1fb81ec7" rel="noopener">这篇文章</a>由<a class="mo mp ep" href="https://medium.com/u/f08187f6a023?source=post_page-----9e7a5751fe7f--------------------------------" rel="noopener" target="_blank">Enrique lópez-Maas</a>撰写，也是了解更多关于git钩子的好文章。</p><p id="1421" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">预提交挂钩是在提交之前运行的挂钩。</p><h1 id="5577" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">TL；速度三角形定位法(dead reckoning)</h1><ol class=""><li id="48e1" class="mq mr it lo b lp lq ls lt lv ms lz mt md mu mh mv mw mx my bi translated">安装摩卡和柴进行测试</li><li id="3699" class="mq mr it lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">为林挺安装Eslint</li><li id="1f2a" class="mq mr it lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">安装漂亮和漂亮-快速格式化</li><li id="12b4" class="mq mr it lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">安装Husky以设置预提交挂钩</li><li id="173e" class="mq mr it lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">测试提交前挂钩</li></ol><h1 id="2d79" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">当前项目设置</h1><p id="39ec" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我有两个文件，第一个文件叫做‘utils . js’。它有四个基本的算术函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">实用工具</p></figure><p id="70ed" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">如您所见，它的格式很奇怪，并且缺少分号。这是故意的。</p><p id="be47" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">第二档是<code class="fe ng nh ni nj b">index.js</code>。它只是从utils.js导入函数并导出它们。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">索引. js</p></figure><p id="8710" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">这也是故意以奇怪的方式格式化的。</p><p id="c9c8" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">该项目还有一个使用<code class="fe ng nh ni nj b">npm init</code>生成的基本package.json文件</p><h1 id="7ae1" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">步骤1:设置测试</h1><p id="4895" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们将使用摩卡和柴进行测试。我们将为我们的每个功能编写一个单独的测试用例。要深入了解摩卡和柴，参考<a class="ae mi" href="https://blog.logrocket.com/a-quick-and-complete-guide-to-mocha-testing-d0e0ea09f09d/" rel="noopener ugc nofollow" target="_blank">本文</a>。</p><p id="d600" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><a class="ae mi" href="https://medium.com/@madelinecorman/testing-javascript-with-mocha-chai-f41175e26d69" rel="noopener">这篇文章</a>由<a class="mo mp ep" href="https://medium.com/u/c95977d1fbd8?source=post_page-----9e7a5751fe7f--------------------------------" rel="noopener" target="_blank"> Madeline Corman </a>撰写，提供了更多关于使用mocha和chai进行测试的信息。</p><p id="5c3f" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">首先，让我们使用以下命令安装mocha和chai:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="b301" class="no kv it nj b gy np nq l nr ns">npm install --save-dev mocha</span></pre><p id="b91e" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">接下来，我们来装柴:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="bff5" class="no kv it nj b gy np nq l nr ns">npm install --save-dev chai</span></pre><p id="c92c" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">现在，我们将创建一个文件“tester.js”，并向其中添加一些测试。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">tester.js</p></figure><p id="f79d" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">我没有包括整个测试文件，还有几个乘法和除法的测试用例。</p><p id="d97c" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">在package.json中，在脚本下添加以下内容:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="5299" class="no kv it nj b gy np nq l nr ns">"test": "mocha --timeout 2000 tester.js"</span></pre><p id="1a63" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">如果package.json中没有“脚本”,请创建一个。它应该是这样的:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="6c53" class="no kv it nj b gy np nq l nr ns">"scripts": {<br/>  "test": "mocha --timeout 2000 tester.js"<br/>}</span></pre><p id="40c3" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">现在，您可以到终端运行以下命令:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="be85" class="no kv it nj b gy np nq l nr ns">npm test</span></pre><h1 id="2fc4" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">步骤2:设置Linter</h1><p id="27b3" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们将使用软件包<a class="ae mi" href="https://www.npmjs.com/package/eslint" rel="noopener ugc nofollow" target="_blank"> eslint </a>。首先，让我们安装软件包:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="0c1f" class="no kv it nj b gy np nq l nr ns">npm install eslint --save-dev</span></pre><p id="7230" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">现在，我们需要初始化我们的linter。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="6f66" class="no kv it nj b gy np nq l nr ns">./node_modules/.bin/eslint --init</span></pre><p id="86f7" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">你会得到一堆问题，根据你的项目回答它们。<br/>最后，我们将在“package.json”中的“scripts”内添加一个新命令。您可以将它添加到我们在上一节中添加的“test”命令下。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="7d45" class="no kv it nj b gy np nq l nr ns">"lint": "eslint --fix *.js"</span></pre><p id="50a5" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">这将在所有javascript文件上运行linter，并尽可能修复林挺错误。</p><p id="de4b" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">您还可以通过在文件顶部或某些行的上方添加注释来禁用某些es-lint检查。例如，我禁用了“tester.js”文件中的几项检查。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="2818" class="no kv it nj b gy np nq l nr ns">/* eslint-disable import/no-extraneous-dependencies */<br/>/* eslint-disable no-undef */</span></pre><h1 id="9b84" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">第三步:设置得更漂亮</h1><p id="e9c3" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们将不得不安装几个软件包<a class="ae mi" href="https://www.npmjs.com/package/prettier" rel="noopener ugc nofollow" target="_blank">漂亮的</a>和<a class="ae mi" href="https://www.npmjs.com/package/pretty-quick" rel="noopener ugc nofollow" target="_blank">漂亮快捷的</a>来格式化代码。</p><p id="0b0c" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">使用以下命令安装更漂亮的:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="2771" class="no kv it nj b gy np nq l nr ns">npm install prettier -save-dev</span></pre><p id="8fd4" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">使用以下命令快速安装:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="600e" class="no kv it nj b gy np nq l nr ns">npm install pretty-quick --save-dev</span></pre><p id="7130" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">现在，我们将向“package.json”中的“scripts”部分添加另一个命令:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="0559" class="no kv it nj b gy np nq l nr ns">"pretty-quick": "pretty-quick"</span></pre><p id="7f4b" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">不要立即运行该命令。让我们设置预提交挂钩并自动运行该命令。</p><h1 id="ddaa" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">步骤4:设置Husky</h1><p id="8bd2" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们将使用<a class="ae mi" href="https://www.npmjs.com/package/husky" rel="noopener ugc nofollow" target="_blank"> husky </a>来设置我们的预提交钩子。使用以下命令安装软件包:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="91e7" class="no kv it nj b gy np nq l nr ns">npm install husky@4 --save-dev</span></pre><p id="bca9" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">如果您安装了husky的V5，您可能需要做一些额外的工作来设置预提交挂钩。</p><p id="ea9d" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">安装后，在“package.json”中添加以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">package.json</p></figure><p id="4d52" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">基本上，我们告诉husky在提交文件之前运行上面的命令(pretty-quick、lint和测试)。</p><p id="145e" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><code class="fe ng nh ni nj b">--staged</code>仅对暂存文件运行格式化程序。</p><h1 id="164e" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">步骤5:测试提交前挂钩</h1><p id="e627" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在我们终于可以测试我们的预提交钩子了。</p><p id="6cd8" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">首先，使用以下命令添加文件:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="a8ad" class="no kv it nj b gy np nq l nr ns">git add .</span></pre><p id="a0d1" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">键入以下命令提交文件:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="5265" class="no kv it nj b gy np nq l nr ns">git commit -m "Test commit"</span></pre><p id="ae6c" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">您应该会看到husky运行beautiful、linter和测试脚本。下面是终端的截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi nt"><img src="../Images/ae79c44b51340aa11f2b4a70e3b7c101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*srFSOxXwGLOow10G.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者截图</p></figure><p id="498f" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">如果linter返回一个错误或者其中一个测试用例失败，提交将会失败，您的文件将会保留在临时区域中而不会被提交。</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><p id="9d67" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><em class="of">原载于</em><a class="ae mi" href="https://www.realpythonproject.com/automate-javascript-code-linting-and-formatting-in-5-simple-steps/" rel="noopener ugc nofollow" target="_blank"><em class="of">https://www.realpythonproject.com</em></a></p></div></div>    
</body>
</html>