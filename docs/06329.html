<html>
<head>
<title>Working With Emoji in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Swift中使用表情符号</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/working-with-emoji-in-swift-f76118e6b6d6?source=collection_archive---------2-----------------------#2020-09-22">https://betterprogramming.pub/working-with-emoji-in-swift-f76118e6b6d6?source=collection_archive---------2-----------------------#2020-09-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="054d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">表情符号不仅仅是简单的字符串</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/de512308047a2a2c8431fd3db949da5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ITyYFzjAq7_ZP-RoIApDqg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.instagram.com/gabypres2808/" rel="noopener ugc nofollow" target="_blank"> Gaby Prestes Nekrasova </a>在Instagram上拍摄。</p></figure><p id="8052" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">表情符号已经成为我们生活的一大部分。iPhones和iPads有一个特殊的表情键盘(除非关闭)。我们在网站、手机和桌面应用程序中看到它们，当我们写文本和填写表格时，我们会输入它们。</p><p id="3abf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们如何控制它们？我们如何防止用户在<code class="fe lv lw lx ly b">UITextField</code>中输入表情符号？我们如何解析来自服务器的JSON响应中的表情符号？大家都来讨论一下。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="72a5" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">一点理论</h1><p id="854e" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">表情符号是现代Unicode的一部分。电脑处理的是比特和字节，而不是微笑和其他小图片。文本中的字母、数字和特殊字符都用一个或多个字节进行编码。表情符号也是如此。它们只是象征。</p><p id="2b7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Unicode有三种标准变体。它们都在不断发展，新的符号不断出现，新的语言也不断出现。所以实际上不止有三个版本，但是对于我们开发人员来说，了解三个不同的标准很重要:</p><ol class=""><li id="0377" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">UTF-8 (Unicode转换格式8位):这种编码中的每个符号都表示为一个或多个字节。简单的拉丁字符、数字和其他一些符号只占用一个字节(八位)。如果第一位是0，我们知道它是一个一字节的符号。如果它是一个俄罗斯、中国或阿拉伯符号或表情符号，它将从第1位开始，并有多个字节。</li><li id="6764" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">UTF-16 (Unicode转换格式16位):所有符号都被编码成两个或四个字节。两个字节有65，536种组合，包括几乎所有已知的字符。表情符号通常需要两个字节，但它们可以有修饰词(肤色或头发)。在这种情况下，它使用额外的空间。</li><li id="406a" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">UTF-32 (Unicode转换格式32位):理解编码最简单，但最不节省内存。每个符号正好占用四个字节。</li></ol><p id="90e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自2010年6.0版本以来，表情符号就出现在Unicode中。所有现代的iPhones和MAC都支持更新的版本，所以通过在应用程序中添加表情符号，你可以确保用户会看到它们。</p><blockquote class="nr"><p id="47d3" class="ns nt it bd nu nv nw nx ny nz oa lu dk translated">"一个<code class="fe lv lw lx ly b">NSString</code>对象编码一个Unicode兼容的文本字符串，表示为一系列UTF 16代码单元."— <a class="ae ky" href="https://developer.apple.com/documentation/foundation/nsstring" rel="noopener ugc nofollow" target="_blank">苹果开发者</a></p></blockquote><p id="0038" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">如你所见，表情符号可以包含在Swift的任何字符串中。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="c00a" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">macOS中的表情符号</h1><p id="476b" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">由于我们主要在macOS中编写Swift代码，让我们看看如何将表情符号添加到我们的代码中。</p><p id="6c63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在任何具有文本编辑功能的app中，包括Xcode，你都可以点击<em class="og">编辑</em>菜单，然后是<em class="og">表情符号&amp;符号</em>。你会看到一个带有表情符号的面板。选择它们中的任何一个，它们都会出现在你的代码中。</p><p id="de77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一种方法是使用热键⌃⌘Space (ctrl + cmd + space)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/a664b6705d505cb7affa94075275c2f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*i7GRMKH_QpI7CMBPN7xmBQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">macOS中的表情符号</p></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="db90" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">检测字符串中的表情符号</h1><p id="c2d2" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在我们继续之前，让我们为我们的项目添加几个扩展。他们将允许我们检查<code class="fe lv lw lx ly b">String</code>是否有表情符号，是否只有表情符号，是否<code class="fe lv lw lx ly b">Character</code>是表情符号，等等。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="126c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你可以查看<code class="fe lv lw lx ly b">String</code>是否有表情符号:</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="1bf9" class="oo mh it ly b gy op oq l or os">"Alex 😊".containsEmoji // true</span><span id="e80e" class="oo mh it ly b gy ot oq l or os">"Alex 😊".containsOnlyEmoji // false</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="ffec" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">禁止UITextField中的表情符号</h1><p id="4999" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">通常，我们不应该允许用户输入表情符号。例如，如果我们想知道他们的法定姓名或其他数据。</p><p id="cd95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有两种方法可以做到这一点——更严格的方法和更宽松的方法。</p><p id="4892" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更严格(但更容易)的方法是选择支持<em class="og"> ASCII的</em>键盘类型。它将移除Unicode集合的前128个符号之外的所有符号。如果你还记得UTF-8的细节，它有单字节，双字节和四字节的字符。该选项将只允许一个字节的字符(从位0开始)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/d3a10609c94a7c9280e71e88e3a6dd72.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*CEqiLQSZKydzqqMwCDK6FA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更改键盘类型</p></figure><p id="064f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它对于输入用户名或密码很有用，但是名称和其他数据可能包含音调符号、非拉丁字符和其他字符。在这种情况下，我们使用第二种方法。它有几个步骤:</p><ol class=""><li id="cbb3" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">将键盘类型设置为<em class="og">默认</em>。</li><li id="6d98" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">设置代理。通常，是你的<code class="fe lv lw lx ly b">UIViewController</code>。</li><li id="e019" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">在委托中，重写方法<code class="fe lv lw lx ly b"><strong class="lb iu">func</strong> textField(<strong class="lb iu">_</strong> textField: UITextField, shouldChangeCharactersIn range: NSRange, replacementString string: String) -&gt; Bool</code>。</li><li id="2c69" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">获取更新的文本:</li></ol><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="9b19" class="oo mh it ly b gy op oq l or os"><strong class="ly iu">if</strong> <strong class="ly iu">let</strong> text = textField.text,<br/>    <strong class="ly iu">let</strong> textRange = Range(range, in: text) {<br/>    <strong class="ly iu">let</strong> updatedText = text.replacingCharacters(in: textRange, with: string)<br/>}</span></pre><p id="9a3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.检查<code class="fe lv lw lx ly b">updatedText</code>是否没有表情符号，如果有则返回<code class="fe lv lw lx ly b">false</code>。</p><p id="1171" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看起来是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="b2b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当用户试图在文本字符串中插入表情符号时，不会有任何效果。如果您想让用户更清楚，请添加一个带有消息的提醒。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="3053" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">解码API响应中的表情符号</h1><p id="7732" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如果您在Swift中使用过REST API，您可能会知道，有时您会得到一个没有表情符号的响应。在<code class="fe lv lw lx ly b">Strings</code>和JSON兼容类型之间的转换，比如<code class="fe lv lw lx ly b">Array</code>和<code class="fe lv lw lx ly b">Dictionary</code>，也可能会丢失表情符号。</p><p id="a16d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最安全的方法是从API中获取<code class="fe lv lw lx ly b">Data</code>,并将其转换为您需要的类型:</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="c35e" class="oo mh it ly b gy op oq l or os"><strong class="ly iu">let</strong> str = String(data: data, encoding: .utf8)</span></pre><p id="f68d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">JSON也一样。最好从数据中手动解码:</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="3701" class="oo mh it ly b gy op oq l or os"><strong class="ly iu">let</strong> json = <strong class="ly iu">try</strong>? JSONSerialization.jsonObject(with: data, options: .allowFragments)</span></pre><p id="3b85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看这个流行库<a class="ae ky" href="https://github.com/Alamofire/Alamofire" rel="noopener ugc nofollow" target="_blank"> Alamofire </a>的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="c08f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Alamofire会定期更新，所以它可能会在<code class="fe lv lw lx ly b">responseString</code>处理程序中返回表情符号。它可能已经完成了，但当我测试它时，我得到了没有任何表情符号的<code class="fe lv lw lx ly b">String</code>作为回报。如果你使用另一个库，这个技巧也很方便。请记住，您总是从任何web请求接收一个字节的缓冲区。Swift中最接近它的是一个<code class="fe lv lw lx ly b">Data</code>物体。所有其他类型都是从它转换而来的。如果你想完全控制，你应该总是选择<code class="fe lv lw lx ly b">Data</code>。</p><h2 id="2959" class="oo mh it bd mi ov ow dn mm ox oy dp mq li oz pa ms lm pb pc mu lq pd pe mw pf bi translated">关于MySQL和其他SQL数据库的说明</h2><p id="719d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">这不完全是关于Swift的，但由于我们正在谈论API中的表情符号，我也会提到这一点。如果你计划在SQL数据库(如MySQL)中使用表情符号，你应该做两件事:</p><ol class=""><li id="42d5" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">将整个数据库、表格或单独字段的字符集设置为<code class="fe lv lw lx ly b">utf8mb4</code>。简单的<code class="fe lv lw lx ly b">utf8</code>不会让你在字符串字段存储表情符号。</li><li id="39a2" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">在运行其他SQL请求之前运行<code class="fe lv lw lx ly b">SET NAMES utf8mb4</code>。</li></ol></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="fb43" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">表情符号变量</h1><p id="cfec" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">我会对苹果公司的幽默感给予一些肯定。你可以在函数或变量的名字中使用表情符号。</p><p id="1a95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，这是一个有效的Swift代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="0640" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">永远不要在产品代码中这样做——打字、搜索或共享都非常不舒服。但是它可能是有用的，例如，教孩子。看起来很好笑，对吧？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/0aa3dc4ddfe11eba88326aefd515145c.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/1*AAn9SWmyTdOd-pTiTxAsRA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有表情符号的源代码</p></figure><p id="a8f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更常见的做法是在<code class="fe lv lw lx ly b">Strings</code>中加入表情符号:</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="564d" class="oo mh it ly b gy op oq l or os"><strong class="ly iu">let</strong> errorText = "Sorry, something went wrong 😢"</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="6379" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="8c42" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">大多数情况下，应用程序应该允许用户输入表情符号。但是如果这不是你想要的行为，你总是可以增加限制的。如今，在用户界面中使用表情符号也变得越来越流行。</p><p id="c0c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同时，除非真的有必要，否则不要在源代码中使用表情符号。Swift允许这样做，但这不是一个好的做法。即使它是字符串常量的一部分，也最好放在一个单独的文件中。</p><p id="1ebb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下次见，编码快乐！</p></div></div>    
</body>
</html>