<html>
<head>
<title>How To Monitor Postgres in Your Heroku App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Heroku应用程序中监控Postgres</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-monitor-postgres-in-your-heroku-app-d25b88769694?source=collection_archive---------9-----------------------#2021-01-18">https://betterprogramming.pub/how-to-monitor-postgres-in-your-heroku-app-d25b88769694?source=collection_archive---------9-----------------------#2021-01-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7f56" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">活动连接、等待连接等等</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b9cd6656145084ed5cd3328883144071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PlFSdTOqLYC7oUyq"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@hishahadat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">沙哈达特·拉赫曼</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><h1 id="ea8e" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="f368" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在绝大多数应用中，数据库是事实的来源。该数据库存储重要的业务记录以及不可替代的用户数据。因此，开发人员必须了解他们的数据库，以便在潜在问题影响业务之前对其进行诊断和补救。如果他们不这样做，开发人员会在月底发现他们可能不理解的意外账单。</p><p id="2c86" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文中，您将学习如何使用<a class="ae ky" href="https://www.librato.com/" rel="noopener ugc nofollow" target="_blank"> Librato </a>建立一个<a class="ae ky" href="https://www.heroku.com/postgres" rel="noopener ugc nofollow" target="_blank"> Heroku Postgres </a>数据库，用于<a class="ae ky" href="https://devcenter.heroku.com/articles/monitoring-heroku-postgres" rel="noopener ugc nofollow" target="_blank">自动监控</a>。然后，我们将查看一系列不同的可用指标，以及如何充分利用每种指标的最佳实践。有了正确的指标，您就可以预测哪里需要提供额外的资源，哪里需要关注潜在的问题。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="aea8" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">用Heroku、Librato和Postgress创建我们的示例应用程序</h1><p id="cb8b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">本文假设您已经拥有一个Heroku帐户。如果你没有，<a class="ae ky" href="https://signup.heroku.com/" rel="noopener ugc nofollow" target="_blank">创建一个免费账户</a>就足够了，尽管除非你有一个<a class="ae ky" href="https://www.heroku.com/pricing" rel="noopener ugc nofollow" target="_blank">标准</a>账户计划，否则这些指标实际上是不可用的。</p><p id="e227" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一旦你有了一个帐户，登录我们的Heroku帐户并复制<a class="ae ky" href="https://github.com/heroku/node-js-getting-started.git" rel="noopener ugc nofollow" target="_blank"> NodeJS入门</a>模板。您可以使用web界面来完成所有这些工作，但是在本文中我们将使用CLI。然后，我们将<code class="fe ne nf ng nh b">cd</code>到存储库中，创建一个名为<code class="fe ne nf ng nh b">monitoring-heroku-postgres</code>的新Heroku应用程序。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="1c2e" class="nm la it nh b gy nn no l np nq">heroku login<br/>git clone https://github.com/heroku/node-js-getting-started.git<br/>cd node-js-getting-started<br/>heroku create -a monitoring-heroku-postgres</span></pre><p id="c563" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为启动项目设置<code class="fe ne nf ng nh b">get</code>遥控器。然后，将项目推送到我们创建的Heroku应用程序。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="77ce" class="nm la it nh b gy nn no l np nq">heroku git:remote -a monitoring-heroku-postgres<br/>git push heroku main</span></pre><p id="aac0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">部署应用程序后，我们将启动应用程序的单个实例。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="3be2" class="nm la it nh b gy nn no l np nq">heroku ps:scale web=1<br/>heroku open</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/6ebd1995863fcda1795dbce65ba4d55a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_G_V-sjDpzhaZ_T6.jpg"/></div></div></figure><p id="ff00" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">既然我们的应用程序已经设置并部署好了，我们将提供我们的数据库并将<code class="fe ne nf ng nh b">pg</code>安装到我们的项目中。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="e388" class="nm la it nh b gy nn no l np nq">heroku addons:create heroku-postgresql:standard-0<br/>npm install pg</span></pre><p id="9fe5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">打开<code class="fe ne nf ng nh b">index.js</code>并包含以下代码，将我们的应用程序连接到数据库:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="998a" class="nm la it nh b gy nn no l np nq">const { Pool } = require('pg');<br/>const pool = new Pool({<br/>  connectionString: process.env.DATABASE_URL,<br/>  ssl: {<br/>    rejectUnauthorized: false<br/>  }<br/>});</span></pre><p id="9c10" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将创建另一条名为<code class="fe ne nf ng nh b">/db</code>的路线。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="10cd" class="nm la it nh b gy nn no l np nq">.get('/db', async (req, res) =&gt; {<br/>    try {<br/>      const client = await pool.connect();<br/>      const result = await client.query('SELECT * FROM test_table');<br/>      const results = { 'results': (result) ? result.rows : null};<br/>      res.render('pages/db', results );<br/>      client.release();<br/>    } catch (err) {<br/>      console.error(err);<br/>      res.send("Error " + err);<br/>    }<br/>  })</span></pre><p id="4502" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们的应用程序现在连接到我们的数据库。提交更改并将它们推送到我们部署的应用程序中。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="7c52" class="nm la it nh b gy nn no l np nq">git add .<br/>git commit -m "Install PG dependency, connect database, and create db route"<br/>git push heroku main</span></pre><p id="0d31" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在我们的数据库是空的。为了将数据写入数据库，我们将使用<code class="fe ne nf ng nh b"><a class="ae ky" href="https://www.postgresql.org/docs/9.3/app-psql.html" rel="noopener ugc nofollow" target="_blank">psql</a></code>。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="d2e4" class="nm la it nh b gy nn no l np nq">heroku pg:psql<br/>create table test_table (id integer, name text);<br/>insert into test_table values (1, 'hello database');<br/>\q<br/>heroku open db</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/32b48aa8260256c344e57bf773abbf6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WCPzS-fpT2tBKjCK.jpg"/></div></div></figure><p id="4dd8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我们将Librato添加到我们的项目中进行自动化监控。Librato是一个用于收集、理解和处理实时指标的插件。它会自动创建交互式可视化效果，以便您可以快速了解数据库中发生的事情。您可以在资源选项卡下访问Librato仪表板。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/4766139875255fee89d37cdcc627959d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*T9isQqhh2hP5viu2.jpg"/></div></div></figure><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="96b7" class="nm la it nh b gy nn no l np nq">heroku addons:create librato</span></pre></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="cabc" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">衡量标准</h1><p id="3b3c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在，让我们看看我们的新指标，看看我们获得了哪些见解，以及我们如何使用这些新数据。我们将看看几个数据库指标和服务器指标。</p><h2 id="f8ca" class="nm la it bd lb nu nv dn lf nw nx dp lj ma ny nz ll me oa ob ln mi oc od lp oe bi translated">数据库指标</h2><p id="f0d1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu"> db_size </strong></p><p id="114d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ne nf ng nh b">db_size</code>告诉您数据库中包含的字节数。它包括磁盘上的所有表和索引数据，包括数据库膨胀。</p><p id="b67d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您的数据库将根据您的计划分配一定的大小。如果您的数据库增长超过了分配的大小，您将收到一封警告电子邮件，其中包含如何修复该问题的说明。您可能会收到一个强制日期，规定何时只允许您使用一个数据库连接。访问将被限制到<code class="fe ne nf ng nh b">read</code>、<code class="fe ne nf ng nh b">delete</code>和<code class="fe ne nf ng nh b">truncate </code>，直到数据库回到计划限制之下。</p><p id="9c02" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Heroku建议当您的数据库达到计划分配大小的80%时设置警告警报，当达到90%时设置严重警报。当您接近最大值时，您可以升级您的计划或删除数据以保持在计划限制内。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/b8c4a618367e7dc00adc475bb4f65acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*crJTtmoSdiqI0PeW.jpg"/></div></div></figure><p id="5019" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">活动连接</strong></p><p id="298c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ne nf ng nh b">active-connections</code>告诉您在数据库上建立的连接数。与<code class="fe ne nf ng nh b">db_size</code>非常相似，Heroku Postgres实施了连接限制。第3级及更高级别的计划有500个连接的硬性限制。达到此限制后，您将无法创建任何新的连接。您可以通过两种不同的方式为活动连接设置警报:</p><p id="2bb9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> 1。当前连接数突然大幅变化</strong></p><p id="453e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果基线连接数发生了很大的变化，这可能是查询和/或事务运行时间增加的迹象。在正常操作条件下进行评估时，警报阈值将取决于应用程序的连接数范围。一个很好的经验法则是，比你正常的每日最高量多+50/+100。</p><p id="09aa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> 2。连接数接近其硬最大值</strong></p><p id="9efd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于3级及更高级别的计划，最大连接数为500。与<code class="fe ne nf ng nh b">db_size</code>一样，建议设置80%和90%使用率的警报；所以400和450是开始的好数字。如果您发现您经常接近您的连接限制，那么考虑使用连接池的<a class="ae ky" href="https://devcenter.heroku.com/articles/postgres-connection-pooling" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/ee17cfc9bbfa624c980cc06bd9590dff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*o0NMw35VhugNlhQc.jpg"/></div></div></figure><p id="120c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">索引缓存命中率</strong></p><p id="431c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ne nf ng nh b">index-cache-hit-rate</code>告诉您共享缓冲区高速缓存提供的索引查找的比率；这些比率四舍五入到小数点后五位。Heroku建议值为0.99或更大。如果您的索引命中率通常低于0.99，那么值得调查哪些查询的开销最大。您还可以升级数据库计划以获得更多RAM。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/858576f6b451b769931392fd8dba7c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8DBjm_97EOScyvLz.jpg"/></div></div></figure><p id="8575" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">等待连接</strong></p><p id="7470" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ne nf ng nh b">waiting-connections</code>告诉您等待获取锁的连接数。许多等待中的连接可能是数据库并发处理不当的迹象。</p><p id="b0fa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们建议为任何连续等待五分钟的连接设置一个警报。<code class="fe ne nf ng nh b">pg-extras</code> CLI插件可以帮助识别阻止其他操作发生的查询。一旦识别出这些查询，就可以终止它们，以解决锁争用问题。了解哪些语句导致了阻塞，有助于识别应用程序代码，以便为减少锁定而进行优化。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/8d0f14ac8859962897d1d4d24233c6ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QVxXRofDNTEW72LO.jpg"/></div></div></figure><h2 id="a06c" class="nm la it bd lb nu nv dn lf nw nx dp lj ma ny nz ll me oa ob ln mi oc od lp oe bi translated">服务器指标</h2><p id="59b3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">平均负载</strong></p><p id="691f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ne nf ng nh b">load-avg</code>告诉您1、5和15分钟内的平均系统负载除以可用CPU的数量。1.0的<code class="fe ne nf ng nh b">load-avg</code>意味着平均来说，在100%的时间跨度内处理请求的CPU资源。</p><p id="6974" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">超过1.0的负载表示进程必须在给定的窗口中等待CPU时间。值越高，表示进程等待的时间越长。低于1.0的值表示您的CPU在给定的窗口内花费了空闲时间。如果这个值很高，那么这意味着您将获得不一致的查询执行时间和更长的等待时间。</p><p id="c798" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一旦该值超过1.0，您就会过度利用资源。因此，您会希望在负载达到超过1.0的值之前知道。同样，我们建议将警报设置为80% (8.0)和90% (9.0)。</p><p id="0da1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于cpu密集型查询，您可以使用<code class="fe ne nf ng nh b">pg:ps</code>命令检查当前活动。如果你的<code class="fe ne nf ng nh b">load-avg</code>值一直很高，那么升级到一个更大的计划可能是值得的。但是，在升级之前，调整开销较大的查询以减少数据库的处理工作量是很有用的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/7d8196bf010ea8a4f994fc33551946a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0OkC1XqQDrmhgtbb.jpg"/></div></div></figure><p id="0b94" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">读取iops </strong></p><p id="16e3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ne nf ng nh b">read-iops</code>告诉您向主数据库磁盘分区发出了多少读IO请求，以每秒IO操作数(IOPS)为单位。每个计划都有一个规定的IOPS (PIOPS)最大值。这是调配的磁盘卷每秒可以支持的最大总读取数+写入数。</p><p id="537a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您希望您的读取来自内存(缓存)而不是磁盘，以提高读取速度。由于进程需要等待I/O变得可用，因此超过调配的IOPS会导致长事务时间和高平均负载。</p><p id="c6fe" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您可以为90%的已配置IOPS设置警报，以识别需要大量I/O的活动或语句。在升级到更大的计划之前，您可以调整昂贵的查询，以减少直接从磁盘读取的数据量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/f1b153b0e179f8e62282b44a354d817e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iq_cLkkuxC7iaYOV.jpg"/></div></div></figure><p id="79b8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">用电量百分比</strong></p><p id="af4b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ne nf ng nh b">wal-percentage-used</code>告诉你剩余的空间来存储临时Postgres预写日志。如果WAL生成的速度超过了WAL存档的速度，您就有完全填满WAL卷的风险。这将关闭数据库，并可能导致数据丢失的风险。</p><p id="8e2e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您达到75%的利用率，那么Heroku将自动调节您的数据库连接限制。所有连接将在利用率达到95%时终止。与之前的指标不同，我们建议将WAL警报设置为60%。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/646b7b5a9d7eb60cdbc07d9c5226a50a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3oMOmVjwkl1dPffk.jpg"/></div></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="4531" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">结论</h1><p id="f2d4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们审查了大量不同的指标，这些指标提供了一系列不同的见解。数据库的运行状况取决于许多因素，其中包括:</p><ul class=""><li id="cbb4" class="oj ok it lt b lu mn lx mo ma ol me om mi on mm oo op oq or bi translated">大小</li><li id="02a5" class="oj ok it lt b lu os lx ot ma ou me ov mi ow mm oo op oq or bi translated">连接数</li><li id="9df9" class="oj ok it lt b lu os lx ot ma ou me ov mi ow mm oo op oq or bi translated">缓存利用率</li><li id="fc5c" class="oj ok it lt b lu os lx ot ma ou me ov mi ow mm oo op oq or bi translated">服务器负载</li><li id="bd7d" class="oj ok it lt b lu os lx ot ma ou me ov mi ow mm oo op oq or bi translated">读取频率</li><li id="5cc2" class="oj ok it lt b lu os lx ot ma ou me ov mi ow mm oo op oq or bi translated">WAL百分比</li></ul><p id="ebb7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一旦开发人员了解了这些指标，他们就能更好地做出关于配置和管理数据的明智决策。关于监控的更多信息，我建议您查看Heroku 的这篇文章。</p></div></div>    
</body>
</html>