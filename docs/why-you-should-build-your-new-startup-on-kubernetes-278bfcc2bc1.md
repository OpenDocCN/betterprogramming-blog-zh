# 为什么你应该在 Kubernetes 上创建你的新公司

> 原文：<https://betterprogramming.pub/why-you-should-build-your-new-startup-on-kubernetes-278bfcc2bc1>

![](img/c38125847305a7653287f96cc0f3a8d1.png)

马库斯·斯皮斯克在 [Unsplash](https://unsplash.com/s/photos/build?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

在 2019 年初的最后一轮面试中，我与一些初创公司进行了交谈。

我总是询问初创公司的部署管道，因为这有助于我了解公司处于技术复杂性的哪个阶段。一些企业可以在使用 SCP 部署的简单 PHP web 应用程序上走得很远。

其他人达到了极限，不得不用 Redis 或 Kafka 之类的基础设施组件将系统改造成几个服务，用于它们之间的通信。

当他们在我的简历上看到 Kubernetes 时，面试官经常会问这个问题。人们对尝试 Kubernetes 很感兴趣，但也担心它是否适合特定的用例。我们在我的上一家公司是如何使用它的？很难学吗？开发团队使用它的经验是什么？有时会有糟糕的实现的恐怖故事，担心转移到 Kubernetes 是一个错误。我经常听到一些非常合理的怀疑，以及保持部署简单的愿望和对赶时髦的犹豫。

所以我会跳到这里的笑点。如果我今天从零开始创业，我很可能会从 Kubernetes 开始。我现在已经在两家非常不同的公司使用过，这是我的(公认的主观)结论。

很简单，积极的一面远远超过了一些消极的一面，所以我认为这对许多创业公司来说是值得投资的。不是所有的创业公司都是*。不一定*你的*创业。但是他们中的很多人。*

让我们来看看原因。

# 什么是 Kubernetes？

简而言之，Kubernetes 是一个开源的容器编排系统，最初由 Google 开发。它已经回馈给社区，由第三方贡献了许多新的库和插件(称为*操作符*)。

Kubernetes 不是亚马逊网络服务(AWS)或谷歌云平台(GCP)那样的云平台。事实上，如果你愿意，你可以在自己的数据中心的硬件上运行和部署 Kubernetes 不过，我不建议初创公司这么做。

把它想象成一种我们可以用来描述工作系统的语言。一旦我们足够详细地描述了系统，Kubernetes 就可以使用它的计算资源(*节点*在 Kubernetes 的说法中——也称为计算机——来运行执行我们系统的容器。

对创业公司来说，最大的好处是这个“描述工作系统”的过程可以作为文档和定义基础设施的代码的集中位置。

# Kubernetes 为自己买单

我不想撒谎。EKS(亚马逊提供的托管 Kubernetes 解决方案)价格昂贵。除了 EC2 成本之外，这将花费您 0.20 美元的管理费用，即每年 1753.20 美元。不是免费的。

但是，考虑一下让一名工程师手动启动节点需要支付多少费用。这些纯粹的基础设施变化所浪费的时间仅仅是从开发产品中抽出的时间。如果你是一家试图实现下一个目标的初创公司，你应该乐于支付(合理的)开销，从你的团队中神奇地抹去一个容易出错且耗时的过程。

有了 Terraform 工具，您还可以创建一个 Kubernetes 集群，只需一行简单的修改就可以扩展。在我的上一个团队中，我们的集群从两个节点增长到四个节点，Git commit 将 2 更改为 4。这实际上只是一行字的改动。添加节点后，Kubernetes 自动将资源转移到新的节点上，并且不需要进一步的工作。然后你就可以着手解决真正的问题了。

# 部署很容易

传统的 Linux 生产系统通常是这样的。您有一些用 Java、Python 或 Ruby 编写的代码。应用程序代码通常是由不太了解服务器的人编写的——或者至少没有在服务器上实践过。

你有一台机器，比如说在 Amazon EC2 中，它是由你的运营团队中的某个人管理的，这个人对应用程序代码不是很了解。当应用程序团队完成一些工作时，他们希望能够部署这些更改。运营团队希望确保这些更改不会破坏任何东西。

您也不希望系统在部署期间离线。如果出现问题，您希望能够回滚到代码的前一个版本。如果您的部署过程(从上传资产到启动服务器)需要 30 分钟呢？你会让你的系统离线 30 分钟吗？

大概不会。您可能会想出一些系统来保持版本 n-1 运行，直到版本 n 启动，这时您将切换到指向新版本。

但是这看起来很复杂。要记住的东西很多，也有很多可能出错的地方。这些部署规则将被编写在一系列脚本中，这些脚本需要进行版本控制和维护，并且很可能包含 bug 本身。当我们在不同的团队中扩展公司时，他们都试图在一天内部署多次。开始觉得恐怖。运营团队成员开始对系统中的大量变动感到不知所措。随着部署过程变得越来越复杂，部署时间开始变得越来越长。

这个故事听起来耳熟吗？

Kubernetes 消除了大部分复杂性。要部署服务的新版本，我们可以简单地更新容器映像以指向新版本的代码。我们还可以定义一个健康检查，在声明新版本工作之前执行。如果没有通过，旧版本的代码会继续运行。

我们可以使用一个内部专用的 DNS 名称来定义一个服务，比如`order_service`，它会自动对正在运行的副本进行负载平衡。没有人必须维护运行实例的列表。

如果我们在部署后发现问题，一个简单的回滚命令会查找以前的容器映像并应用它。这通常只需要几秒钟，然后我们就可以运行我们软件的最后一个已知的稳定版本。

听起来不错吧？

# 您不需要一个独立的运营团队来完成所有工作

Kubernetes 本身就是一个复杂的野兽。但是任何有经验的开发人员都可以使用它。

这是因为 Kubernetes 部署是通过简单的声明性 YAML 文件来管理的，而不是使用一系列复杂的 bash 脚本、特殊的部署工具等等。

没错。使用 Kubernetes 只需要知道 Ruby 爱好者支持的简单 XML 替换。

仅使用 YAML，我们就可以定义一个具有自动伸缩、复制和服务解析的完整工作系统。然后使用 kubectl CLI 工具，我们可以要求集群运行我们的配置。我们从不直接告诉 Kubernetes 做任何事情。相反，它阅读我们的声明性 YAML，并解释需要做什么。

你认为你的开发者能想出如何写 YAML 吗？我知道。

我曾经开发过一些复杂的系统，这些系统要求管理部署的人员理解 a) Python，b) Bash，c)我们运行的操作系统版本的一些小的复杂性，d) JVM 标志(上帝帮助你)，e) SCP 命令(你能不看文档就写一个有效的 SCP 命令吗？)…等等。

还有一个组织开销。部署脚本和基础设施代码通常由运营团队管理。但是开发人员经常需要在部署代码中进行修改——例如，在启动时设置一个标志——并扩展系统。这造成了开发人员和运营人员之间的紧张关系，因为这两个群体相互产生需求，但往往受制于不同的目标。

所有这些复杂性和管理费用增加了你在创业中所做的一切的税收。如果你想快速开发新的特性，并且有能力轻松地从一个项目跳到另一个项目，那么你真的想尽可能地减少摩擦。Kubernetes 将许多痛苦抽象化，让您专注于产品。

# 你可能不需要 Kubernetes 的情况

当然，没有灵丹妙药，也有像 Kubernetes 这样的东西矫枉过正的情况。

## 简单的 WordPress 网站，CMSs 等。

如果你只是运行 WordPress，你不需要 Kubernetes。如果你运行的 CMS 除了偶尔升级库或安装插件之外，从来没有真正部署过，你就不需要 Kubernetes。它确实是为管理不断变化的大型系统而优化的。

## 嵌入式系统，任何需要访问真实操作系统的东西

显然，如果您正在编写需要与 Linux 内核接口的低级嵌入式系统或软件，Kubernetes 不适合您。这适用于任何集装箱化解决方案。

## 您的产品主要是一个数据库

Kubernetes 确实有一种称为“有状态集”的资源类型，用于运行数据库和管理状态的消息代理。从理论上讲，运行有状态集可以让您运行多个副本，并对它们进行放大和缩小，以及附加和增加存储。

但是这样做总让我有点紧张。通过应用程序服务，我想让开发人员轻松地调整设置和部署。对于数据库，我想要的正好相反。应该很难意外更改设置或将系统升级到新版本。我也不希望我的数据库在集群中争用 CPU 和内存。

如果我使用 AWS 并且可以访问 RDS，我特别倾向于不使用 Kubernetes 来访问数据库。RDS 或您选择的云提供商中的同类产品将更易于管理自动备份、扩展和监控。

# 结论

Kubernetes 非常适合任何需要随时间扩展和增长的项目。

如果你是一家初创公司，你几乎肯定属于这一类。你现在可能很小，但是你想要成长。这是你告诉投资者的，也是你雇佣这么多开发人员的原因。你的系统将会快速地改变和扩展，你希望以一种尽可能少的额外成本和摩擦来构建它。

仅仅因为这个原因，我认为任何电子商务、SaaS 或类似的公司在早期投资 Kubernetes 都是很有意义的。即使您只是在集群中部署一个简单的 web 应用程序，规划未来也意味着仔细构建您的基础设施，以使您的团队能够在一年或三年内快速前进。

感谢您的阅读，祝您好运！