<html>
<head>
<title>Develop a Simple Rock Band Game With HTML and JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用HTML和JavaScript开发一个简单的摇滚乐队游戏</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/develop-a-simple-rock-band-game-with-html-and-javascript-61270f708b6?source=collection_archive---------13-----------------------#2022-06-02">https://betterprogramming.pub/develop-a-simple-rock-band-game-with-html-and-javascript-61270f708b6?source=collection_archive---------13-----------------------#2022-06-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="eb42" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Gamepad API为所有级别构建音乐游戏</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2048f070f4d8aa5aeaffaf190b381d2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H33M9Vn1jnT53SZrPY_EDw.png"/></div></div></figure><p id="9de1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我们将学习如何使用标准HTML和普通JavaScript 开发一个简单版本的摇滚乐队或吉他英雄风格的游戏<strong class="kw iu">。这是我们作为<a class="ae lq" href="https://codelandconf.com/" rel="noopener ugc nofollow" target="_blank"> Codeland:Distributed </a>会议的一部分所做的“摇动游戏手柄API”研讨会的简短版本。</strong></p><p id="e656" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将是一个小游戏(只需要10分钟！)，但它有一个很酷的因素:它将与连接到计算机的摇滚乐队drumset配合使用。特别是，我们将为PlayStation 3使用Harmonix Drumset，但您可以使用不同的控制器。</p><p id="0291" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们从展示结果开始:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lr"><img src="../Images/e11d290755b0e78d0bc98a78262b752a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PRchjeFRgOdVXvEu.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">我们在研讨会期间开发的游戏截图</p></figure><p id="f459" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">尽管这篇文章会很短。因此，我们不会深入探究<a class="ae lq" href="https://w3c.github.io/gamepad/" rel="noopener ugc nofollow" target="_blank">游戏手柄API</a>——我们在研讨会期间做过的事情——并将它的使用限制在我们需要的基本部分。</p><p id="bb32" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">开始编码吧！</p><h1 id="c4ad" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">操作游戏控制器</h1><p id="5ca3" class="pw-post-body-paragraph ku kv it kw b kx mo ju kz la mp jx lc ld mq lf lg lh mr lj lk ll ms ln lo lp im bi translated">首先，我们需要读取连接/断开事件，并保存连接的游戏手柄的唯一标识符:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="b064" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们将开发包含游戏最关键部分的代码:检查游戏手柄中是否有变化的方法。为此，我们将创建一个新功能，游戏手柄连接后浏览器将调用该功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="f506" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，那个函数是空的，它是<a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" rel="noopener ugc nofollow" target="_blank">使用</a> <code class="fe mv mw mx my b"><a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" rel="noopener ugc nofollow" target="_blank">window.requestAnimationFrame</a></code>不断地调用自己。我们使用那个方法是因为它比<code class="fe mv mw mx my b">setTimeout</code>或<code class="fe mv mw mx my b">setInterval</code>更可靠，并且我们知道它将在屏幕刷新之前被调用(这很方便)。</p><p id="10fe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将有一个游戏手柄/鼓连接到计算机，但我们将遍历列表，而不是直接访问唯一标识符。我们这样做是为了保持一致性，以防连接多个游戏手柄(如果你开发多人游戏版本，这可能会很有帮助。)</p><p id="9a24" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当我们遍历游戏手柄列表时，我们将读取它们的按钮，稍后我们将需要访问这些按钮:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="6eba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们有了按钮列表，下一步是遍历该列表，检查是否有任何按钮被按下。</p><p id="e362" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以在同一个<code class="fe mv mw mx my b">readValues</code>函数中这样做，但是为了方便以后扩展，可以把它分开，所以我们将创建一个新函数来处理按钮被按下的事件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="1953" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们已经处于一个很好的位置，因为我们检测到每个按钮被按下的时间。至此，我们已经完成了一半(简单的)游戏引擎。我们仍然需要生成音符/按钮的随机序列，但在此之前我们需要处理一个问题。</p><p id="ada3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您一直在编写代码，那么您会注意到，当您按下一个按钮时，<code class="fe mv mw mx my b">buttonPressed</code>函数会被多次调用。发生这种情况是因为无论我们尝试多快，按钮按下的时间都超过了16毫秒，这使得按钮按下的时间超过了屏幕刷新的一个周期，最终导致<code class="fe mv mw mx my b">readValues</code>和<code class="fe mv mw mx my b">buttonPressed</code>被调用了不止一次。</p><p id="509b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了避免这种行为，我们将添加一个新的变量来保存按钮的状态，并且只在按钮的前一个状态是“未按下”时调用<code class="fe mv mw mx my b">buttonPressed</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="d475" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们正在处理所有与鼓组相关的代码。所以剩下的大部分逻辑将不会与游戏手柄管理有关，而是与游戏本身有关。</p><h1 id="a5c3" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">游戏逻辑编码</h1><p id="b230" class="pw-post-body-paragraph ku kv it kw b kx mo ju kz la mp jx lc ld mq lf lg lh mr lj lk ll ms ln lo lp im bi translated">首先，让我们生成一个随机按钮来按。我们用的是架子鼓，按键是0–3，会让我们的生活更轻松。</p><blockquote class="mz na nb"><p id="0d72" class="ku kv nc kw b kx ky ju kz la lb jx lc nd le lf lg ne li lj lk nf lm ln lo lp im bi translated"><em class="it">注意:您的鼓机或游戏手柄上的按钮可能会有不同的顺序。我们连接到浏览器的Harmonix有以下顺序:红色(按钮2)、黄色(3)、蓝色(0)和绿色(1)。我们将相应地开发，确保这与你的架子鼓/吉他/控制器一起工作。</em></p></blockquote><p id="0e6e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random" rel="noopener ugc nofollow" target="_blank">用</a> <code class="fe mv mw mx my b"><a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random" rel="noopener ugc nofollow" target="_blank">Math.random()</a></code>生成随机数很简单。我们需要确保我们在正确的时间调用它:</p><ul class=""><li id="e22f" class="ng nh it kw b kx ky la lb ld ni lh nj ll nk lp nl nm nn no bi translated">在游戏开始的时候。</li><li id="b576" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated">在处理了正确的按钮按下事件之后。</li></ul><p id="bda7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="4e5f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，什么是没有分数的游戏？让我们继续增加点数并记录正确弹奏的音符。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="bcf1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">至此，我们完成了整个游戏:</p><ul class=""><li id="ceb4" class="ng nh it kw b kx ky la lb ld ni lh nj ll nk lp nl nm nn no bi translated">使用游戏手柄API，我们读取鼓中的点击。</li><li id="e9d6" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated">我们生成一个目标按钮。</li><li id="c91d" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated">我们检测用户是否按下了目标按钮。</li><li id="b95c" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated">如果是，我们生成一个新的目标按钮。</li><li id="a58f" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated">我们跟踪点和条纹。</li></ul><p id="59f0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是少了一件大事！玩家看不到分数，也看不到该按哪个按钮。到目前为止，我们只做了JavaScript，所以玩家根本看不到任何东西！</p><p id="0d30" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">是时候让HTML和CSS来拯救我们了。</p><h1 id="5cea" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">创建界面</h1><p id="8317" class="pw-post-body-paragraph ku kv it kw b kx mo ju kz la mp jx lc ld mq lf lg lh mr lj lk ll ms ln lo lp im bi translated">让我们从向HTML添加所有关键部分开始:点、条纹和一组鼓。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="2adb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后我们设计鼓的样式:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="7dfd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">鼓现在看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/b4d7f4801fa80cc03b3174ed6ca34aed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*21jvV68zCyZ9NYqR.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">提起中间的鼓，以匹配真正的PS3鼓组</p></figure><p id="2554" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">至于点和条纹值，我们只是将它们放置在页面中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="90ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">完成游戏前的最后一部分是将JavaScript与HTML/CSS连接起来，这样屏幕就会显示游戏中的值。</p><p id="0b6e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于点和条纹，我们可以在<code class="fe mv mw mx my b">generateNewRandomActive()</code>函数中完成。请记住，它在游戏开始时被调用，每次按下正确的按钮时:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="6ac6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">至于哪个按钮是下一个要点击的，我们将通过JS向drumset添加一个类，并使用CSS样式化相应的按钮(为鼓设置半透明版本的背景):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="2e5f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这样，我们就完成了游戏:我们点击了正确的鼓，选择了一个新的随机鼓，我们看到了分数和连胜记录，等等。</p><h1 id="ff01" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">添加一些耀斑</h1><p id="d561" class="pw-post-body-paragraph ku kv it kw b kx mo ju kz la mp jx lc ld mq lf lg lh mr lj lk ll ms ln lo lp im bi translated">但是让我们现实一点。游戏可以，但是太简单了。它缺少一些<em class="nc">的潇洒</em>:</p><ul class=""><li id="2da3" class="ng nh it kw b kx ky la lb ld ni lh nj ll nk lp nl nm nn no bi translated">屏幕看起来大部分是白色的</li><li id="0c82" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated">字体是Times New Roman……没有多少摇滚乐</li></ul><p id="34ad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">纠正字体问题很简单。我们需要选择一种更合适的字体，比如谷歌字体:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="e901" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后是樱桃色上衣。为了去掉所有的白色，使它看起来更像游戏，我们将放一个实际的视频作为游戏背景。</p><p id="2a47" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为此，在Youtube或其他视频服务上浏览视频，点击“分享”按钮，然后选择“嵌入”复制<code class="fe mv mw mx my b">&lt;iframe&gt;</code>代码并粘贴到HTML的开头:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="28db" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">确保将视频<code class="fe mv mw mx my b">iframe</code>的大小调整到100%，并将<code class="fe mv mw mx my b">?autoplay=1&amp;controls=0</code>添加到视频中，这样控件将不会显示，视频将自动开始播放。</p><blockquote class="mz na nb"><p id="9d47" class="ku kv nc kw b kx ky ju kz la lb jx lc nd le lf lg ne li lj lk nf lm ln lo lp im bi translated">技巧:你可以添加一个播放列表，而不是使用视频。然后视频会一个接一个。</p></blockquote><p id="cd47" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">并使视频容器占据整个屏幕:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="e0f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后一次触摸，我们完成了，游戏看起来更好了:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/5448be4c8e3f113590b079c9d72dae42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4jLPWJSUvt8iyKK8.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">游戏截图使用帕拉摩尔的视频“无知”</p></figure><p id="2d07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于一个只有150行代码(16个HTML + 73个CSS + 61个JS)的游戏来说还不错，而且没有使用任何库，只有标准和普通的JavaScript。</p><p id="cd94" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你想探索代码，<a class="ae lq" href="https://codepen.io/alvaromontoro/full/abdMQzL" rel="noopener ugc nofollow" target="_blank">游戏在Codepen </a>上(你需要一个游戏手柄来玩这个版本):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw mu l"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">我们在研讨会期间开发的实际游戏</p></figure></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="91d4" class="lw lx it bd ly lz oe mb mc md of mf mg jz og ka mi kc oh kd mk kf oi kg mm mn bi translated">结论</h1><p id="d56d" class="pw-post-body-paragraph ku kv it kw b kx mo ju kz la mp jx lc ld mq lf lg lh mr lj lk ll ms ln lo lp im bi translated">这个游戏不像原来的摇滚乐队和吉他英雄游戏那么复杂，但是对于一个人10分钟开发出来的东西来说还是很有趣的。</p><p id="76e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它非常适合还不会玩真正游戏的孩子(我的孩子喜欢这个版本)，并且它有很多扩展和改进的空间:</p><ul class=""><li id="2170" class="ng nh it kw b kx ky la lb ld ni lh nj ll nk lp nl nm nn no bi translated">添加助推器/组合倍增器</li><li id="672a" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated">在连续10+，20+，30+后添加鼓励信息</li><li id="23c1" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated">将它与Youtube API集成，以检测歌曲/视频的结尾并显示统计数据</li><li id="3350" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated">将它与其他APIs插件结合起来，以检测音乐何时变大，从而加快节奏</li><li id="78b9" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated">添加一个带有注释和时间的JSON文件，这样注释会在合适的时间从顶部落下…</li></ul><p id="968d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">许多改进并不需要太多时间，使得游戏更像真实的游戏。</p><p id="520c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">享受编码！</p></div></div>    
</body>
</html>