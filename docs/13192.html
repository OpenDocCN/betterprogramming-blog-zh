<html>
<head>
<title>Streaming Flutter Events With Mosquitto MQTT Broker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Mosquitto MQTT代理的流媒体颤振事件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/streaming-flutter-events-with-mosquitto-mqtt-broker-28998a3b81c2?source=collection_archive---------2-----------------------#2022-08-05">https://betterprogramming.pub/streaming-flutter-events-with-mosquitto-mqtt-broker-28998a3b81c2?source=collection_archive---------2-----------------------#2022-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7347" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过counter app示例程序探索MQTT消息传递协议在Flutter中的强大功能</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b18feaf4ad6391b99951b09b2e1a7fd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BQcaaWJQ7V3tBpIQLVZdGw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">MQTT事件流设置的组件</p></figure><p id="b738" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">很长一段时间以来，我们一直在讨论各种网络协议提供的实时事件流能力及其实际使用案例。因此，我们在这里探索一种这样的协议的移动应用，这种协议是近年来随着物联网的出现和广泛采用而引起关注的，即MQTT，即消息队列遥测传输。📬</p><blockquote class="lr ls lt"><p id="5544" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated">这里讨论的系统形成了一个更大的现实世界问题的基础，即拥有一个轻量级的消息传递协议，该协议可以与跨平台框架一起伸缩，跨设备工作，并拥有可靠和安全的通信，MQTT提供了开箱即用的通信。</p></blockquote><h1 id="853d" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">先决条件</h1><p id="355d" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">本文基于一个假设，即我们知道Flutter和MQTT的基础知识。如果你没有，你可以看看这些“入门”指南:</p><ul class=""><li id="5b46" class="mv mw iq kx b ky kz lb lc le mx li my lm mz lq na nb nc nd bi translated">flutter—<a class="ae ne" href="https://docs.flutter.dev/get-started/test-drive" rel="noopener ugc nofollow" target="_blank">https://docs.flutter.dev/get-started/test-drive<br/></a><strong class="kx ir">注意</strong>:我们将增强上面讨论的同一个例子来演示使用MQTT的事件流</li><li id="8580" class="mv mw iq kx b ky nf lb ng le nh li ni lm nj lq na nb nc nd bi translated">MQTT—<a class="ae ne" href="https://mqtt.org/getting-started/" rel="noopener ugc nofollow" target="_blank">https://mqtt.org/getting-started/</a></li></ul><p id="86e3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将依靠Mosquitto MQTT Broker来促进Android模拟器上运行的Flutter应用程序和MQTT X桌面客户端之间的消息传递。</p><p id="fad3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要在您的系统上安装这两个程序，请浏览以下内容:</p><ul class=""><li id="f253" class="mv mw iq kx b ky kz lb lc le mx li my lm mz lq na nb nc nd bi translated">Mosquitto MQTT经纪人—<a class="ae ne" href="https://mosquitto.org/download/" rel="noopener ugc nofollow" target="_blank">https://mosquitto.org/download/</a></li><li id="dd56" class="mv mw iq kx b ky nf lb ng le nh li ni lm nj lq na nb nc nd bi translated">MQTT X桌面客户端— <a class="ae ne" href="https://mqttx.app/" rel="noopener ugc nofollow" target="_blank"> https://mqttx.app </a></li></ul><h1 id="96c0" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">我们的设置</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/ae9b1fd498f4a24841568b8409be119d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*vZgHfCy4DRhu70Q0eogT3w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用Mosquitto进行发布者/订阅者设置的域级系统设计</p></figure><p id="3531" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们的例子中，我们将使用MQTT发布者和接收者的简单本地设置，其中我们的移动应用程序是发布者，MQTT X桌面客户端是接收者。我已经将Mosquitto代理配置为在默认配置下在<code class="fe nl nm nn no b">port 1883</code>运行。</p><blockquote class="lr ls lt"><p id="e947" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated">注意:记住允许MQTT客户机在本地网络上匿名连接，因为访问管理部分超出了本文的范围。基于您的操作系统，可以通过代理安装文件夹下的<code class="fe nl nm nn no b"><em class="iq">mosquitto.conf</em></code>文件进行配置。</p></blockquote><p id="8d52" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">只需添加以下几行就可以了:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="1c27" class="nt lz iq no b gy nu nv l nw nx">listener 1883 0.0.0.0<br/>allow_anonymous true</span></pre><p id="9f92" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果代理已经在运行，我们需要重新启动它，这样上面的配置才能生效，这一次，通过在命令中提供<code class="fe nl nm nn no b">mosquitto.conf</code>文件的路径来运行代理。对我来说，这个命令看起来像下面这样(在macOS上):</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="66e2" class="nt lz iq no b gy nu nv l nw nx">mosquitto -c /usr/local/opt/mosquitto/etc/mosquitto/mosquitto.conf</span></pre><h1 id="f98f" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">颤动代码</h1><p id="9ba1" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">为了让我们的应用程序与本地MQTT代理连接，我们将使用pub <code class="fe nl nm nn no b">mqtt_client</code>，它可以在<a class="ae ne" href="https://pub.dev/" rel="noopener ugc nofollow" target="_blank"> pub.dev </a>上找到，安装说明在这里—<a class="ae ne" href="https://pub.dev/packages/mqtt_client" rel="noopener ugc nofollow" target="_blank">https://pub.dev/packages/mqtt_client</a>。</p><p id="facf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此外，让我们创建一个MQTTClientManager.dart类来帮助我们完成我们希望在移动客户端中运行的各种操作。它包含与代理通信所需的连接、断开、订阅、发布和其他帮助方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="b2ee" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们将修改<code class="fe nl nm nn no b">MyHomePage</code>类，它是Flutter创建新的Flutter项目的入门计数器应用程序示例的一部分。我们希望在MQTT X桌面客户端订阅的“测试/计数器”主题上发布增量计数器消息。在订阅和发布这些主题之前，我们需要调用<code class="fe nl nm nn no b">connect()</code>方法来与<code class="fe nl nm nn no b">port 1883</code>上的本地代理建立连接。</p><blockquote class="lr ls lt"><p id="d5dd" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated">注意:在Android模拟器的情况下，localhost在连接到代理时不会解析，因为它将在VM中运行。这将引发一个连接错误。因此，在连接到代理时，我们将使用主机地址<code class="fe nl nm nn no b">10.0.2.2</code>。</p></blockquote><p id="c87f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">修改<code class="fe nl nm nn no b">MyHomePage</code>类以包含以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="624f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们在这里的<code class="fe nl nm nn no b"> initState()</code>下添加了两个新的方法调用:</p><ul class=""><li id="f578" class="mv mw iq kx b ky kz lb lc le mx li my lm mz lq na nb nc nd bi translated"><code class="fe nl nm nn no b">setupMqttClient()</code>:帮助建立与代理的连接，订阅相同的发布主题</li><li id="21d3" class="mv mw iq kx b ky nf lb ng le nh li ni lm nj lq na nb nc nd bi translated"><code class="fe nl nm nn no b">setupUpdatesListener()</code>:帮助在通过订阅主题接收的消息上设置监听器流，并在控制台上打印它们</li></ul><h1 id="9e50" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">MQTT X桌面客户端安装</h1><p id="3817" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">设置MQTT X非常简单！安装后，运行应用程序并创建一个新的连接。在“一般”部分下有四个必需的详细信息，我们将需要与我们当地的Mosquitto经纪人成功建立联系，在“高级”和“最后遗嘱”部分下的其余详细信息可以保留其各自的默认值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/53dc6a261e15ddc67ea511b9e8af8ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ca81_4UmH6-J8TJcbnqxtQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">MQTT X桌面客户机上新连接的示例<em class="ob">概述</em>部分细节</p></figure><p id="341f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦创建了连接，您就可以在主屏幕上通过选择新创建的连接来检查它是否与代理成功连接。成功连接后，为测试主题添加新的订阅。让我们使用我们在Flutter应用程序中使用的相同主题来发布计数器事件，“测试/计数器”和“QoS: 1”。</p><h1 id="f428" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">结果—单击活动中的事件</h1><p id="401a" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">每当您按下模拟器上的increment按钮时，都会通过我们的MQTT设置发布一个事件，并在桌面客户端中作为流接收。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/76ddc99fcaae837404a22be134c4f0b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zY3laJZApmFvrSBmdaNuug.gif"/></div></div></figure><h1 id="78f3" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">结论和用例</h1><p id="3664" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">从性能监控到用户活动跟踪和基于行为的定位，来自移动应用的流媒体直播事件有着无尽的使用案例。我们可以扩大规模，将这些数据作为输入数据流直接输入云分析工具，并应用各种ML算法和分析工具来构建实时系统。</p><p id="7e2c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">也就是说，结合Flutter超酷的跨平台能力和MQTT超时尚的低延迟和低带宽消息协议，我们正在寻找一个可以跨移动、web、桌面以及最终嵌入式设备扩展的解决方案！</p><p id="fc00" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这种灵活性足以让我们说，“真棒”，对不对？🙃</p><h1 id="6d87" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">包扎</h1><p id="a7f1" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">感谢您通读，请务必让我知道MQTT如何帮助您扩展您的下一个Flutter项目！</p><p id="3bda" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在以下关于MQTT如何成为Flutter Web推送通知管理系统的文章中再见，以及如何通过临时的AWS物联网核心设置对移动数据流进行AWS分析。</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="d357" class="nt lz iq no b gy nu nv l nw nx"><strong class="no ir">Want to Connect?</strong></span><span id="de23" class="nt lz iq no b gy od nv l nw nx">You can reach out to me via <a class="ae ne" href="https://www.linkedin.com/in/ketanbhavsar20/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</span></pre></div></div>    
</body>
</html>