<html>
<head>
<title>The M1 MacBook Breaks Docker Development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">M1 MacBook打破了Docker开发</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/macbook-m1-breaks-docker-development-14566ab6fa2e?source=collection_archive---------0-----------------------#2020-11-22">https://betterprogramming.pub/macbook-m1-breaks-docker-development-14566ab6fa2e?source=collection_archive---------0-----------------------#2020-11-22</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="6b49" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">你应该知道的是，如何在苹果搭载M1处理器的新机器上使用Docker</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/b4872b8ce79405f0619ac81580b90a8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vobRfNzwq8Kv5ZpCRroMQw.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者照片。</p></figure></div><div class="ab cl kz la hy lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="in io ip iq ir"><h1 id="1451" class="lg lh iu bd li lj lk ll lm ln lo lp lq ka lr kb ls kd lt ke lu kg lv kh lw lx bi translated">苹果M1 MacBooks/Mini不支持Docker</h1><p id="028d" class="pw-post-body-paragraph ly lz iu ma b mb mc jv md me mf jy mg mh mi mj mk ml mm mn mo mp mq mr ms mt in bi translated">Docker基于Golang，需要虚拟化支持。让Go支持新架构不是问题，很快就会得到解决。</p><p id="fc86" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">最大的问题是虚拟化支持，这一直是windows上Docker的一个问题，Windows Home不支持虚拟化，并且不是所有用于PC的芯片都有所需的芯片组。</p><p id="583e" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">Docker已经<a class="ae mz" href="https://www.docker.com/blog/apple-silicon-m1-chips-and-docker/" rel="noopener ugc nofollow" target="_blank">写了一篇博文</a>解释了所有需要解决的问题:</p><ul class=""><li id="782a" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt nf ng nh ni bi translated">迁移到新的虚拟机管理程序框架(在Big Sur的公共版本中不存在)</li><li id="5f7f" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">多架构构建</li><li id="1499" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">M1土著支持的Golang</li><li id="249a" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">电子与M1本地支持Docker桌面(但它的工作基于后的信息)</li></ul></div><div class="ab cl kz la hy lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="in io ip iq ir"><h1 id="24a3" class="lg lh iu bd li lj lk ll lm ln lo lp lq ka lr kb ls kd lt ke lu kg lv kh lw lx bi translated">这个路线图的时间框架是什么？</h1><p id="d92c" class="pw-post-body-paragraph ly lz iu ma b mb mc jv md me mf jy mg mh mi mj mk ml mm mn mo mp mq mr ms mt in bi translated">看看博客中<a class="ae mz" href="https://github.com/docker/roadmap" rel="noopener ugc nofollow" target="_blank">路线图</a>的链接，你会很快发现没有。基于该项目的复杂性和对苹果的依赖性，我预计至少需要6-8个月才能解决这个问题。更快解决这个问题的唯一可能是苹果公司的直接介入，这在过去从未发生过。</p></div><div class="ab cl kz la hy lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="in io ip iq ir"><h1 id="81ec" class="lg lh iu bd li lj lk ll lm ln lo lp lq ka lr kb ls kd lt ke lu kg lv kh lw lx bi translated">M1 MacBook Air/Pro的中间解决方案</h1><p id="68c6" class="pw-post-body-paragraph ly lz iu ma b mb mc jv md me mf jy mg mh mi mj mk ml mm mn mo mp mq mr ms mt in bi translated">将您的Docker开发环境迁移到云中。以下是我个人对可能选项的想法。</p><h2 id="f1be" class="no lh iu bd li np nq dn lm nr ns dp lq mh nt nu ls ml nv nw lu mp nx ny lw nz bi translated">码头引擎</h2><p id="da6b" class="pw-post-body-paragraph ly lz iu ma b mb mc jv md me mf jy mg mh mi mj mk ml mm mn mo mp mq mr ms mt in bi translated">使用任何本地或云托管的Linux主机和<a class="ae mz" href="https://hub.docker.com/search?q=&amp;type=edition&amp;offering=community&amp;operating_system=linux" rel="noopener ugc nofollow" target="_blank">安装Docker </a>。</p><p id="5015" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">访问Docker引擎的方法:</p><ol class=""><li id="998d" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt oa ng nh ni bi translated"><code class="fe ob oc od oe b">ssh</code>到远程主机并在远程主机上运行所有命令。</li><li id="8f93" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt oa ng nh ni bi translated">从本地<code class="fe ob oc od oe b">operating_system</code>访问Docker API。</li></ol><p id="9400" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">我推荐选项2和<code class="fe ob oc od oe b"><a class="ae mz" href="https://www.docker.com/blog/how-to-deploy-on-remote-docker-hosts-with-docker-compose/" rel="noopener ugc nofollow" target="_blank">Docker Contexts</a></code>的用法:</p><ol class=""><li id="8224" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt oa ng nh ni bi translated">为远程系统创建一个上下文<br/> <code class="fe ob oc od oe b">docker context create remote ‐‐docker "host=ssh://user@remotemachine"</code></li><li id="3de4" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt oa ng nh ni bi translated">现在你可以用<code class="fe ob oc od oe b">docker context use remote</code>切换默认上下文，或者使用<code class="fe ob oc od oe b">--context</code>选项(例如<code class="fe ob oc od oe b">docker-compose ‐‐context remote up -d</code>)。</li></ol><p id="cecf" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">优点:</p><ul class=""><li id="e03b" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt nf ng nh ni bi translated">不依赖于M1架构的任何进展</li><li id="dcbc" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">文件系统访问速度提高了三倍</li><li id="15dc" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">任何硬件要求都是可能的</li></ul><p id="6457" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">缺点:</p><ul class=""><li id="8346" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt nf ng nh ni bi translated">中断任何依赖于将本地macOS文件系统挂载到Docker的工作流(参见修复挂载)。</li></ul><h2 id="3795" class="no lh iu bd li np nq dn lm nr ns dp lq mh nt nu ls ml nv nw lu mp nx ny lw nz bi translated">码头机器</h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj of"><img src="../Images/21a51efb319c7fd245ae6a502de99258.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*uOfYES7--lfg-PebRkkDDA.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片来自<a class="ae mz" href="https://docs.docker.com/machine/" rel="noopener ugc nofollow" target="_blank">码头工人</a>。</p></figure><p id="ee15" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated"><a class="ae mz" href="https://github.com/docker/machine" rel="noopener ugc nofollow" target="_blank"> Docker Machine </a>支持在任何本地计算机(英特尔架构)或<a class="ae mz" href="https://github.com/docker/docker.github.io/blob/master/machine/AVAILABLE_DRIVER_PLUGINS.md" rel="noopener ugc nofollow" target="_blank">云提供商</a>(数字海洋、AWS、KVM等)上创建Docker主机。).</p><p id="8491" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">优点:</p><ul class=""><li id="57c7" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt nf ng nh ni bi translated">不依赖于M1架构的任何进展。</li><li id="f2eb" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">文件系统访问速度提高了三倍。</li><li id="61e1" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">任何硬件要求都是可能的。</li></ul><p id="a3d0" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">缺点:</p><ul class=""><li id="d47b" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt nf ng nh ni bi translated">中断任何依赖于将本地macOS文件系统挂载到Docker的工作流(参见修复挂载)。</li><li id="324c" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">不再支持官方<code class="fe ob oc od oe b">Docker Machine</code>，也不会有<a class="ae mz" href="https://github.com/docker/machine/issues/4537" rel="noopener ugc nofollow" target="_blank">的进一步开发</a>。</li></ul><h2 id="ec4e" class="no lh iu bd li np nq dn lm nr ns dp lq mh nt nu ls ml nv nw lu mp nx ny lw nz bi translated">云容器开发(Blimp)</h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj og"><img src="../Images/8c85e08cef917f6ae98b046efd0fba9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mpiEWqJCyQQ6xZlEZCUqmg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片来自<a class="ae mz" href="https://blimpup.io/" rel="noopener ugc nofollow" target="_blank">飞艇</a>。</p></figure><p id="948c" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated"><a class="ae mz" href="https://blimpup.io" rel="noopener ugc nofollow" target="_blank"> Blimp </a>是Docker Compose的替代产品，支持在云中开发。</p><p id="6b77" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">优点:</p><ul class=""><li id="1520" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt nf ng nh ni bi translated">不依赖于M1架构的任何进展。</li><li id="e12b" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">文件系统访问速度提高了三倍。</li><li id="043e" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">任何硬件要求都是可能的。</li><li id="25b0" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">将本地卷装入容器是内置的同步功能。</li></ul><p id="f0da" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">缺点:</p><ul class=""><li id="a536" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt nf ng nh ni bi translated">对安装、卷驱动程序、DNS有一些限制。</li><li id="9963" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">不支持<code class="fe ob oc od oe b">host.docker.internal</code>。</li><li id="d4cd" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">锁定他们的命令行客户端和主机。</li></ul><h2 id="8f7c" class="no lh iu bd li np nq dn lm nr ns dp lq mh nt nu ls ml nv nw lu mp nx ny lw nz bi translated">基于云的开发环境</h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oh"><img src="../Images/c83cf9d0edb623e5c11fa5189d9b039e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y2iagovocBqCocH_e0Xqcw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图片来自GitHub。</p></figure><p id="a5d6" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">这是一个浏览器中的完整开发环境，包括VS代码、针对CI/CD的GitHub操作以及一个云托管的虚拟机，该虚拟机会在每次编辑器启动时自动启动和设置。</p><p id="1111" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">当<a class="ae mz" href="https://github.com/features/codespaces" rel="noopener ugc nofollow" target="_blank"> GitHub代码空间</a>公开时，它们将允许你在云中运行基于Docker的环境。</p><p id="5c64" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">优点:</p><ul class=""><li id="65a8" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt nf ng nh ni bi translated">任何带有浏览器的本地硬件或操作系统就足够了。</li><li id="2ea2" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">文件系统访问速度提高了三倍。</li><li id="f252" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">任何硬件要求在微软Azure上都有。</li></ul><p id="c645" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">缺点:</p><ul class=""><li id="d1a9" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt nf ng nh ni bi translated">需要持续的互联网接入。没有线下发展。</li><li id="c6f2" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">锁定微软主机。</li></ul></div><div class="ab cl kz la hy lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="in io ip iq ir"><h1 id="ffe8" class="lg lh iu bd li lj lk ll lm ln lo lp lq ka lr kb ls kd lt ke lu kg lv kh lw lx bi translated">修复安装本地macOS文件系统的问题</h1><p id="15a6" class="pw-post-body-paragraph ly lz iu ma b mb mc jv md me mf jy mg mh mi mj mk ml mm mn mo mp mq mr ms mt in bi translated"><a class="ae mz" href="https://code.visualstudio.com/docs/remote/remote-overview" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码远程开发</a>允许你使用Docker Compose<a class="ae mz" href="https://code.visualstudio.com/docs/remote/containers-advanced" rel="noopener ugc nofollow" target="_blank">设置复杂环境</a>并与容器连接。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oi"><img src="../Images/012bad865c82eccf733666ce41fa29d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UmrQDXMaAVb3FYND38pBSw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片来自<a class="ae mz" href="https://code.visualstudio.com/docs/remote/remote-overview" rel="noopener ugc nofollow" target="_blank"> VS代号</a>。</p></figure><p id="738c" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">VS代码将在macOS上运行，并提供原生的M1功能，但是终端和文件是在容器中直接编辑的。这允许您根据运行在另一台主机上的Docker引擎来使用现有的开发工作流。</p><p id="c148" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated"><code class="fe ob oc od oe b">.devcontainer/</code>配置增加了对端口转发的支持，这有助于建立一个类似于一切都在本地的环境。</p></div><div class="ab cl kz la hy lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="in io ip iq ir"><h1 id="219f" class="lg lh iu bd li lj lk ll lm ln lo lp lq ka lr kb ls kd lt ke lu kg lv kh lw lx bi translated">我个人的MacBook路线图</h1><p id="fd1a" class="pw-post-body-paragraph ly lz iu ma b mb mc jv md me mf jy mg mh mi mj mk ml mm mn mo mp mq mr ms mt in bi translated">我目前使用的是13英寸MacBook Pro 2016，英特尔3.3 GHz i7，并计划改用我在9月初订购的新MacBook Pro i7/32GB。当苹果公司展示采用M1芯片的新款MacBooks时，我立即取消了订单。</p><p id="c8f4" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">我当前基于web的应用程序和服务的开发环境基于:</p><ul class=""><li id="d368" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt nf ng nh ni bi translated">Mac版Docker桌面</li><li id="689b" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">brew(节点、纱线等。)</li><li id="0b21" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">VirtualBox (Windows浏览器测试)</li></ul><p id="be87" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">硬件:</p><ul class=""><li id="7c0a" class="na nb iu ma b mb mu me mv mh nc ml nd mp ne mt nf ng nh ni bi translated">2台三星显示器(1920x1200)</li><li id="2e8c" class="na nb iu ma b mb nj me nk mh nl ml nm mp nn mt nf ng nh ni bi translated">惠普坞站G5</li></ul><p id="c6d7" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">我目前设置的唯一问题是速度——我的一些较大的PHP应用程序消耗了大量内存和CPU。</p><p id="6b02" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">在研究了基准和帖子之后，我首先想到我唯一的问题是VirtualBox。买一个棒型电脑解决了这个问题，给了我一个不到90€的本地Windows硬件。</p><p id="e67d" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">但缺乏Docker支持表明，我将等待下一代内存更大的MacBook Pro以及Big Sur和Docker的更新版本。</p><p id="33f7" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">与此同时，我将测试在云中开发，这对于没有良好互联网接入的地方不是一个选项。</p><p id="f89a" class="pw-post-body-paragraph ly lz iu ma b mb mu jv md me mv jy mg mh mw mj mk ml mx mn mo mp my mr ms mt in bi translated">你和Docker/kubernetics有什么发展计划？</p></div></div>    
</body>
</html>