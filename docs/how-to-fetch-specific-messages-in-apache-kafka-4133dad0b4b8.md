# 如何在阿帕奇卡夫卡中获取特定信息

> 原文：<https://betterprogramming.pub/how-to-fetch-specific-messages-in-apache-kafka-4133dad0b4b8>

## 掌握 Kafka 控制台消费者和 kafkacat

![](img/d843e31c160f88f8976a586d17bb0ce2.png)

照片由[阿尔方斯·莫拉莱斯](https://unsplash.com/@alfonsmc10)在 [Unsplash](https://unsplash.com/photos/YLSwjSy7stw) 上拍摄。

一个人可以用 Kafka 执行的最基本的操作之一显然是消费来自特定主题的消息。有时我们只需要获取最后一批消息，但在其他一些情况下，我们可能需要使用两个偏移量或时间戳内的消息。

在本文中，我们将讨论如何使用 Kafka 控制台消费者和一个名为`kafkacat`的命令行工具来消费 Kafka 主题中产生的消息。具体来说，在以下几节中，我们将探讨如何消费:

*   所有的信息。
*   第 *N* 条消息。
*   下一个 *N 个*消息。
*   最后的第 N 条消息。
*   两个时间戳之间的消息。
*   两个偏移量之间的消息。

# **卡夫卡控制台消费者**

`kafka-console-consumer`是一个工具，用于消费指定主题的消息。它通常用于以下两个目的:

*   测试或调试消息的基本消费，而不必使用编程语言编写消费者。
*   根据您编写的相应消费者应用程序测试、调试和比较消费的消息。

命令行工具从 Kafka 主题中读取数据，并将其输出到标准输出。它有以下选项:

# **什么是卡夫卡？**

`[kafkacat](https://github.com/edenhill/kafkacat)` 是一个快速轻量的命令行工具，与`kafka-console-consumer`和`kafka-console-producer`相比，它提供了一套更全面的实用程序。它主要用于调试或测试 Kafka 设置。具体来说，它可以用于从 Kafka 主题生成或消费消息，并为集群、特定主题、分区或副本获取元数据。要安装`kafkacat`，您只需运行:

可以传递给`kafkacat`的选项如下所示:

现在我们已经介绍了 Kafka 控制台消费者和`kafkacat`，是时候看看它们的实际应用了。

# 如何使用所有的消息

为了使用控制台消费者来消费 Kafka 主题的所有消息，我们只需要传递`--from-beginning`选项，这样消费者就可以从最早的可用偏移量获取消息:

`kafkacat`的等效命令如下所示。注意`-o`选项(对应于偏移)需要设置为`beginning`:

# **如何消费前 N 条消息**

为了使用 Kafka 控制台消费者来消费第一个 *N* 消息，我们必须同时提供`--from-beginning`和`--max-messages`选项。假设我们需要使用前十条消息，下面的命令将会完成这个任务:

使用`kafkacat`可以得到相同的结果，如下所示。同样，我们需要提供偏移量。此外，我们需要通过`-c`选项传递计数:

# 如何消费接下来的 N 条消息

现在，为了使用控制台消费者来消费下一个 *N* 消息，我们需要提供`--max-messages`选项并省略`--from-beginning`以便消费者将从最新的偏移量开始消费。

`kafkacat` 中的等效命令如下所示。由于我们想要获取下一个 *N* 消息，我们应该省略偏移选项(即`-o`):

# 如何消耗最后 N 条消息

为了消费已经产生的最后的 *N* 条消息，我们需要指定一个分区和一个特定的偏移量，消费者将从这个偏移量开始获取消息。假设我们想从偏移量`12873`开始使用分区`1`中的最后一条消息，下面的方法应该可以做到。还要注意，对于这个场景，我们使用的是`kafka-simple-consumer-shell.sh`:

有了`kafkacat`，从指定的主题和分区获取最后的 *N* 条消息是否更容易，因为我们不需要显式地提供偏移量。我们只需要指定一个负的偏移量。在`kafkacat`中，负偏置`-o`表示从末端的相对偏置。此外，我们提供了`-e`标志，以便消费者在检索到最后一条消息时能够成功退出。

以下命令将从主题`testTopic`中带有`id=1`的分区获取最后十条消息:

# 如何在两个时间戳之间使用消息

当谈到时间戳和偏移量时，`kafkacat`是合适的，所以我将只讨论使用该工具执行某些操作。

为了使用两个时间戳之间的消息，我们必须提供开始和结束时间戳(以毫秒为单位)，如下所示:

*   `s@..`表示起始时间戳。
*   `e@..`表示结束时间戳(不含)。

# 如何在两个偏移量之间使用消息

最后，为了使用两个偏移量之间的消息，您只需要提供一个起始偏移量和表示结束偏移量和起始偏移量之差的计数。

假设我们想要使用偏移量`11`和`21`之间的消息，我们需要运行下面的`kafkacat`命令:

`-o 11`表示消费者应该从偏移量`11`开始获取消息，`-c 10`指定我们只需要消费从偏移量`11`开始的前十条消息。

# 结论

在本文中，我们讨论了如何使用来自特定 Kafka 主题的特定消息。我们介绍了 Kafka 控制台消费者以及`kafkacat`，一个非常强大的命令行工具。我们探索了所有可能需要消息消费的场景。我们展示了如何使用最新和最早的消息。此外，我们讨论了在两个时间戳或偏移量之间使用消息的可能方式。

总的来说，`kafkacat`是一个非常强大的工具，比 Kafka 自带的控制台消费者和生产者功能更丰富。它以更简单的方式提供了更全面的功能，我强烈建议人们使用这个工具。