<html>
<head>
<title>An iOS 14 Checklist for Developers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向开发者的iOS 14清单</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ios-14-checklist-for-developers-372bd6d2507e?source=collection_archive---------12-----------------------#2020-10-01">https://betterprogramming.pub/ios-14-checklist-for-developers-372bd6d2507e?source=collection_archive---------12-----------------------#2020-10-01</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="7e4b" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">让你的应用为iOS 14做好准备你需要知道什么</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/3267227565bc3c969762884007058207.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j3ojIza8nTDFfZLg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">丹尼尔·罗梅罗在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="0773" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">苹果在没有事先通知的情况下推出iOS 14让整个开发者社区大吃一惊。无论如何，又到了一年中为最新操作系统发布应用程序更新的时候了。</p><p id="bc0a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">首先，下面是你应该知道的iOS 14的重大变化:</p><ul class=""><li id="2a5b" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">主屏幕上的小部件和应用程序剪辑介绍。</li><li id="6ba7" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">用新的<a class="ae kz" href="https://developer.apple.com/documentation/apptrackingtransparency" rel="noopener ugc nofollow" target="_blank">AppTrackingTransparency</a>框架取代IDFA，用于选择性广告跟踪(在撰写本文时，苹果已将此推迟至2021年1月)。</li><li id="75e2" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">新的视觉要求轮廓、轨迹检测以及手和身体姿态估计。</li><li id="348b" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">ARKit为激光雷达扫描仪以及位置锚带来了新的深度API，以便在特定的地方放置AR体验。</li><li id="1eb4" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">苹果的PencilKit框架引入了跟踪在<code class="fe mk ml mm mn b">PKCanvas</code>上绘制的手势的速度和力度的能力。还有一个新的Scribble <code class="fe mk ml mm mn b">UITextField</code>，它使用设备上的机器学习来识别手写文本。</li></ul><p id="8aa5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，让我们来挖掘一些跨不同苹果框架的重大更新和API的变化，以便您为iOS 14上的应用发布做好准备。</p></div><div class="ab cl mo mp hy mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="in io ip iq ir"><h1 id="4b98" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">增强的纸板API</h1><p id="6b0c" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">苹果是数据隐私的领导者，通过最新的iOS更新，他们再次证明了这一点。</p><p id="3857" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">每次你的应用程序从剪贴板读取内容时，iOS 14都会引入一个浮动通知。现在，为了防止您的应用程序不必要地访问粘贴板，有一个增强的<code class="fe mk ml mm mn b">UIPasteboard</code> API，让您在实际读取其值之前确定<code class="fe mk ml mm mn b">UIPasteboard</code>中存在的内容类型。</p><p id="765c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe mk ml mm mn b">detectPatternsForPatterns:completionHandler</code>和<code class="fe mk ml mm mn b">detectPatterns(for:inItemSet:completionHandler:)</code>方法让你在不触发通知的情况下找到特定的模式。</p><p id="6e5e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">同时，您可以利用<code class="fe mk ml mm mn b"><a class="ae kz" href="https://developer.apple.com/documentation/uikit/uipasteboard/detectionpattern?changes=latest_major" rel="noopener ugc nofollow" target="_blank">UIPasteboard.DetectionPattern</a></code>结构来确定粘贴板是否包含一个<code class="fe mk ml mm mn b"><a class="ae kz" href="https://developer.apple.com/documentation/uikit/uipasteboard/detectionpattern/3618951-probableweburl?changes=latest_major" rel="noopener ugc nofollow" target="_blank">probableWebUrl</a></code>(可能与深层链接相关)或一个<code class="fe mk ml mm mn b"><a class="ae kz" href="https://developer.apple.com/documentation/uikit/uipasteboard/detectionpattern/3650233-number?changes=latest_major" rel="noopener ugc nofollow" target="_blank">number</a></code>。</p></div><div class="ab cl mo mp hy mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="in io ip iq ir"><h1 id="ee78" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">画中画模式</h1><p id="fcbc" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">虽然iPadOS早先确实支持图片模式中的图片，但iOS 14终于将其带到了iPhone中。</p><p id="4a0a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通过使用<code class="fe mk ml mm mn b">AVPictureInPictureController.isPictureInPictureSupported()</code>，您可以检查是否支持后台播放视频的功能:</p><pre class="kk kl km kn gu ns mn nt nu aw nv bi"><span id="2fa3" class="nw mw iu mn b gz nx ny l nz oa">AVPictureInPictureController(playerLayer: playerView.playerLayer)</span></pre><p id="f738" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你像我一样，在基于<code class="fe mk ml mm mn b">AVPlayer</code>的iOS 14应用中采用画中画模式，你可能会遇到奇怪的错误——当应用在后台时，画中画不会自动启动。谢天谢地，<a class="ae kz" href="https://stackoverflow.com/questions/63739978/avpictureinpicturecontroller-doesnt-automatically-start-picture-in-picture-when" rel="noopener ugc nofollow" target="_blank">这个堆栈溢出页</a>通过在<code class="fe mk ml mm mn b">AVPictureInPictureController</code>之前初始化<code class="fe mk ml mm mn b">AVAudioSession.sharedInstance().setActive(true)</code>提供了一个解决方案。</p></div><div class="ab cl mo mp hy mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="in io ip iq ir"><h1 id="4b2a" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">有限的照片图库访问权限</h1><p id="1d96" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">在iOS 13和之前的版本中，允许应用程序访问你的照片库实际上就是允许他们访问你所有的相册和媒体资产。这很容易为隐私泄露打开大门，因为开发者可以将库上传到他们的云服务器。</p><p id="a6fe" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在iOS 14中，苹果引入了有限的照片访问权限，允许用户只选择选定的照片或访问整个图库，从而保护隐私。这意味着iOS开发者有他们的工作要做。</p><p id="e5f6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，有了一个新的<code class="fe mk ml mm mn b">PHAccessLevel</code>枚举属性，允许您将其定义为<code class="fe mk ml mm mn b">readWrite</code>或<code class="fe mk ml mm mn b">addOnly</code>:</p><pre class="kk kl km kn gu ns mn nt nu aw nv bi"><span id="85f8" class="nw mw iu mn b gz nx ny l nz oa">let accessLevel: PHAccessLevel = .readWrite</span></pre><p id="7945" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要查询照片库的授权状态，只需在下面的函数中传递上面的枚举:</p><pre class="kk kl km kn gu ns mn nt nu aw nv bi"><span id="eb12" class="nw mw iu mn b gz nx ny l nz oa">let authorizationStatus = PHPhotoLibrary.authorizationStatus(for: accessLevel)</span></pre><p id="bbfb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">从iOS 14开始，上面的<code class="fe mk ml mm mn b">authorizationStatus</code>返回了一个新的<code class="fe mk ml mm mn b">limited</code> enum属性，这意味着开发者只能看到用户选择的照片。要请求有限的照片访问权限，请调用以下函数:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="6266" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面这段代码展示了图像选择选择器用户界面:</p><pre class="kk kl km kn gu ns mn nt nu aw nv bi"><span id="92ad" class="nw mw iu mn b gz nx ny l nz oa">PHPhotoLibrary.shared().presentLimitedLibraryPicker(from: self)</span></pre><p id="8f2a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">用户选择/取消选择的图像可通过符合并注册<code class="fe mk ml mm mn b">PHPhotoLibraryChangeObserver</code>协议在<code class="fe mk ml mm mn b">photoLibraryDidChange</code>功能中进行监控。</p><p id="eeb3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，为了防止每次自动访问照片提示，在你的<code class="fe mk ml mm mn b">Info.plist</code>文件中设置<code class="fe mk ml mm mn b">PHPhotoLibraryPreventAutomaticLimitedAccessAlert</code>键为<code class="fe mk ml mm mn b">true</code>。</p></div><div class="ab cl mo mp hy mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="in io ip iq ir"><h1 id="c6a7" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">SwiftUI带来了新的属性包装器、视图、修改器和应用生命周期</h1><p id="faed" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">苹果新的声明式用户界面框架SwiftUI 是2019年WWDC期间的热门话题，今年也不例外。在iOS 14的第二次迭代中，SwiftUI现在包括了大量新的UI组件，从<code class="fe mk ml mm mn b">VideoPlayer</code>到<code class="fe mk ml mm mn b">Maps</code>、<code class="fe mk ml mm mn b">Labels</code>、<code class="fe mk ml mm mn b">Links</code>、<code class="fe mk ml mm mn b">ColorPicker</code>和<code class="fe mk ml mm mn b">ProgressView</code>。</p><p id="9f98" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">更重要的是，iOS 14通过改为使用<code class="fe mk ml mm mn b">LazyHStack</code>和<code class="fe mk ml mm mn b">LazyVStack</code>视图，引入了对<code class="fe mk ml mm mn b">VStack</code>和<code class="fe mk ml mm mn b">HStack</code>的延迟加载的支持。这意味着您不必担心<code class="fe mk ml mm mn b">NavigationLinks</code>立即加载目的地视图。</p><p id="d997" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">还有一个新的<code class="fe mk ml mm mn b">Grid</code>组件在某种程度上帮助复制<code class="fe mk ml mm mn b">UICollectionView</code>和一个<code class="fe mk ml mm mn b">matchedGeometryEffect</code>修改器来创建惊人的过渡和动画。</p><p id="7010" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">除了通过使用全新的属性包装器和协议引入SwiftUI的<a class="ae kz" href="https://medium.com/better-programming/swiftuis-new-app-lifecycle-and-replacements-for-appdelegate-and-scenedelegate-in-ios-14-c9cf4a2367a9" rel="noopener">自己的应用生命周期</a>之外，iOS 14还引入了<code class="fe mk ml mm mn b"><a class="ae kz" href="https://medium.com/better-programming/introducing-ios-14-widgetkit-with-swiftui-a9cc473caa24" rel="noopener">WidgetKit</a></code>框架，让你完全使用SwiftUI来构建漂亮强大的小部件。</p></div><div class="ab cl mo mp hy mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="in io ip iq ir"><h1 id="cb89" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">更强大的集合视图</h1><p id="e621" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">虽然CollectionView在WWDC 2020期间没有在SwiftUI中首次亮相，但这并没有阻止它接收一些强大的新更新。</p><p id="4dcc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以下是您可以在使用iOS 14的应用中利用的主要变化:</p><ul class=""><li id="fdb1" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated"><code class="fe mk ml mm mn b">UICollectionViewCompositionalLayout.list</code>让你在<code class="fe mk ml mm mn b">UITableView</code>中创建类似<code class="fe mk ml mm mn b">UITableView</code>的外观，从而进一步增强定制合成布局的能力。我相信这强烈表明<code class="fe mk ml mm mn b">TableViews</code>在未来可能会过时。</li><li id="754f" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><code class="fe mk ml mm mn b">UICollectionView.CellRegistration</code>结构带来了一种配置<code class="fe mk ml mm mn b">UICollectionView</code>电池的新方法。所以您不需要再定义单元格标识符，因为新的结构在传递到<code class="fe mk ml mm mn b">dequeueConfiguredReusableCell</code>内部时会自动处理单元格注册。</li><li id="d8b3" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">iOS 13带来的<code class="fe mk ml mm mn b">DiffableDataSources</code>现在也带来了<code class="fe mk ml mm mn b">SectionSnapshots</code>来定制和更新每个部分的数据。</li></ul></div><div class="ab cl mo mp hy mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="in io ip iq ir"><h1 id="7120" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">使用CoreLocation提高隐私性</h1><p id="4bfc" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">虽然iOS 13带来了延期的“总是允许”和新的“允许一次”权限，但iOS 14通过允许用户授予访问大致位置的权限，进一步收紧了隐私。</p><p id="3901" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这意味着有一个类型为<code class="fe mk ml mm mn b">CLAccuracyAuthorization</code>的新属性，它有两个枚举用例— <code class="fe mk ml mm mn b">fullAccuracy</code>和<code class="fe mk ml mm mn b">reducedAccuracy</code>(返回一个近似值，而不是确切的位置)。</p><p id="b90e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，<code class="fe mk ml mm mn b">authorizationStatus()</code>函数现在已经过时，您应该使用<code class="fe mk ml mm mn b">locationManagerDidChangeAuthorization</code>来查询位置许可状态。</p></div><div class="ab cl mo mp hy mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="in io ip iq ir"><h1 id="039d" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">核心ML模型加密</h1><p id="2caf" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated"><a class="ae kz" href="https://developer.apple.com/documentation/coreml" rel="noopener ugc nofollow" target="_blank"> Core ML </a>是苹果的机器学习框架，让你初始化模型，运行推理，甚至进行设备上的训练。在iOS 14中，苹果通过引入模型部署提升了Core ML。这意味着你可以即时更新你的机器学习模型，而无需更新应用程序。</p><p id="1250" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Xcode中还有一个改进的核心ML模型查看器，可以显示底层。但是突出的是模型加密。机器学习模型不容易建立，有时包含敏感信息。早些时候，你可以很容易地提取嵌入在应用程序中的<code class="fe mk ml mm mn b">.mlmodelc</code>核心ML模型文件。</p><p id="39cb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，一旦在Xcode 12中加密模型，这就不再可能了。这样做，核心ML将自动解密并加载到你的应用程序的内存中。</p><p id="365e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了处理加密模型，iOS 14带来了一个新的核心ML模型异步初始化函数:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="de0c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">模型只有在成功解密后才会加载。值得注意的是，旧的<code class="fe mk ml mm mn b">init()</code>初始化核心ML模型的方式将在未来被弃用。</p></div><div class="ab cl mo mp hy mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="in io ip iq ir"><h1 id="455b" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">结论</h1><p id="cf4b" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">虽然这些更新是让您的应用程序跟上速度的最重要的更新，但还有其他重要的变化，例如在自然语言框架中包含句子嵌入，以及支持使用CreateML训练风格转移模型。</p><p id="ccc6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这总结了开发者需要知道的iOS 14的主要变化。感谢阅读。</p></div></div>    
</body>
</html>