<html>
<head>
<title>Build a Doctor Appointment Bot With Azure Bot Service, Language Understanding, and Twilio SMS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Azure Bot服务、语言理解和Twilio SMS构建一个医生预约机器人</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-doctor-appointment-bot-with-azure-bot-service-language-understanding-and-twilio-sms-5cc1311667bd?source=collection_archive---------19-----------------------#2022-03-08">https://betterprogramming.pub/build-a-doctor-appointment-bot-with-azure-bot-service-language-understanding-and-twilio-sms-5cc1311667bd?source=collection_archive---------19-----------------------#2022-03-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bc54" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一步一步的教程来建立一个预订系统</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2b74afa05c7b54f584478ec0bba97f2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uwmS91DS4839CCqKtJU0aQ.png"/></div></div></figure><p id="4064" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">远程医疗服务可以改善生活在偏远地区的人们获得医疗保健的机会。偏远地区的一个常见问题是不可靠的互联网服务。对于偏远地区的患者来说，在网络服务很差或根本不可用的情况下，通过网络应用程序进行预约是一个挑战。</p><p id="270c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">短信是联系偏远地区居民的一种可靠且低成本的替代方式。在本文中，您将学习如何构建一个允许用户通过短信预约的医生预约系统。</p><h1 id="1dec" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">系统概况</h1><p id="90b7" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">短信预订系统的架构如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/4db8468b690a4f124f59c5a7455bf965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*hHmCIR-N9AkA5-58.png"/></div></figure><p id="06e0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Twilio是Microsoft Azure Bot服务和最终用户之间的通信渠道。该系统的核心是一个建立在<a class="ae mo" href="https://dev.botframework.com/" rel="noopener ugc nofollow" target="_blank">微软机器人框架</a>上的<a class="ae mo" href="https://azure.microsoft.com/en-us/services/bot-services/" rel="noopener ugc nofollow" target="_blank"> Azure机器人</a>。当机器人收到消息时，它要求<a class="ae mo" href="https://www.luis.ai/" rel="noopener ugc nofollow" target="_blank">语言理解(路易斯)</a>来分析消息。LUIS用消息的意图来响应，机器人用它来做出有帮助的回答。</p><h1 id="2b91" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">先决条件</h1><p id="44d3" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">您将需要这些技术来跟进:</p><ul class=""><li id="f427" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">支持的操作系统。NET (Windows/macOS/Linux)</li><li id="349b" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae mo" href="https://dotnet.microsoft.com/en-us/download" rel="noopener ugc nofollow" target="_blank">。NET(核心)SDK</a>3.1版或更高版本</li><li id="f061" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae mo" href="https://github.com/PowerShell/PowerShell#get-powershell" rel="noopener ugc nofollow" target="_blank"> PowerShell Core </a>或Windows PowerShell(您可以使用任何Shell，但需要做一些小的修改)</li><li id="644b" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae mo" href="https://azure.microsoft.com/en-us/free/" rel="noopener ugc nofollow" target="_blank"> Azure订阅(获得免费订阅)</a></li><li id="3ad8" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae mo" href="https://www.twilio.com/try-twilio" rel="noopener ugc nofollow" target="_blank">一个免费的Twilio账户</a></li><li id="40f8" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae mo" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli" rel="noopener ugc nofollow" target="_blank"> Azure CLI 2.2.0或更高版本</a></li><li id="8d52" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">答。NET IDE(推荐:<a class="ae mo" href="https://visualstudio.microsoft.com/downloads/" rel="noopener ugc nofollow" target="_blank"> Visual Studio </a> 2019或更高版本，<a class="ae mo" href="https://code.visualstudio.com/Download" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>带<a class="ae mo" href="https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp" rel="noopener ugc nofollow" target="_blank"> C#插件</a>，或<a class="ae mo" href="https://www.jetbrains.com/rider/download/" rel="noopener ugc nofollow" target="_blank"> JetBrains Rider </a>)。</li></ul><h1 id="e11b" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">创建语言理解服务应用程序</h1><h2 id="cf1b" class="nd lr it bd ls ne nf dn lw ng nh dp ma ld ni nj mc lh nk nl me ll nm nn mg no bi translated">Azure配置</h2><p id="a06b" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">您需要创建一个资源组来存储您稍后将创建的Azure资源。</p><p id="566f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开PowerShell并使用Azure CLI登录Azure:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="96f3" class="nd lr it nq b gy nu nv l nw nx">az login</span></pre><p id="0e72" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行以下命令创建新的资源组:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="2576" class="nd lr it nq b gy nu nv l nw nx">az group create --name rg-bot --location [AZURE_LOCATION]</span></pre><p id="74ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将<code class="fe ny nz oa nq b">[AZURE_LOCATION]</code>替换为您首选的Azure位置的名称。</p><blockquote class="ob oc od"><p id="01d2" class="ku kv oe kw b kx ky ju kz la lb jx lc of le lf lg og li lj lk oh lm ln lo lp im bi translated">" E<!-- -->Azure中的每一个资源都存储在一个资源组中，Azure中的每一个资源和资源组都存储在一个特定的Azure区域或位置。选择不同地点的<a class="ae mo" href="https://azure.microsoft.com/en-us/global-infrastructure/geographies/#overview" rel="noopener ugc nofollow" target="_blank">有不同的原因</a>，但最常见的是你想选择离你和你的终端用户最近的地点。运行<code class="fe ny nz oa nq b">az account list-locations -o table</code>可以找到所有地区。找到您的首选位置，并在创建Azure资源时使用来自<code class="fe ny nz oa nq b">Name</code>列的值来指定位置。请记住，并非所有资源在所有Azure位置都可用。—微软文档</p></blockquote><p id="6a83" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要与特定类型的Azure资源交互，需要启用这些资源类型的资源提供者。默认情况下，大多数<a class="ae mo" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/azure-services-resource-providers" rel="noopener ugc nofollow" target="_blank">公共资源提供者是启用的</a>，但是您将使用语言理解(LUIS ),它是默认情况下未启用的认知服务资源提供者的一部分。</p><p id="3904" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以<a class="ae mo" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-providers-and-types#azure-portal" rel="noopener ugc nofollow" target="_blank">在Azure Portal </a>中注册认知服务资源提供者，或者使用如下所示的Azure CLI。</p><p id="e0fd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，使用以下命令检查认知服务资源提供者的状态:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="272e" class="nd lr it nq b gy nu nv l nw nx">az provider show --namespace Microsoft.CognitiveServices -o table</span></pre><p id="a1ef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果RegistrationState未注册，则运行以下命令进行注册:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="d6f5" class="nd lr it nq b gy nu nv l nw nx">az provider register --namespace Microsoft.CognitiveServices --wait</span></pre><p id="666b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此命令可能需要一分钟才能完成。</p><h1 id="b544" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">创建LUIS应用程序并训练模型</h1><p id="942e" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">语言理解(LUIS)是一个基于云的对话式人工智能服务，是Azure<a class="ae mo" href="https://azure.microsoft.com/en-us/services/cognitive-services/" rel="noopener ugc nofollow" target="_blank">认知服务</a>的一部分。它可以处理自然语言文本以预测整体含义并提取相关的详细信息。</p><p id="3207" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要学习如何使用LUIS，您需要了解几个核心概念:</p><ul class=""><li id="4ea8" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">意图:用户在<a class="ae mo" href="https://docs.microsoft.com/en-us/azure/cognitive-services/LUIS/concepts/utterances" rel="noopener ugc nofollow" target="_blank">话语</a>中表达的目的或目标。</li><li id="af59" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">实体:与用户意图相关的项目或元素。</li><li id="6ab8" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">话语:言语单位。用户的每一句话都是一个话语。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/ad59089e0a8b90c465fb82e9af9aaf46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*usrOjgcgrEVMX1xp.png"/></div></figure><p id="490e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">路易斯将充当机器人的大脑，帮助机器人理解传入的信息。</p><h2 id="fdd5" class="nd lr it bd ls ne nf dn lw ng nh dp ma ld ni nj mc lh nk nl me ll nm nn mg no bi translated">创建LUIS应用</h2><p id="9c89" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">使用您的Azure帐户登录到<a class="ae mo" href="https://www.luis.ai/" rel="noopener ugc nofollow" target="_blank"> LUIS门户网站</a>。</p><p id="b3c8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你是路易斯的新用户，你将被提示<strong class="kw iu">选择一个创作资源</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/9cce23bdaf323cd06205ad7b9905087e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*IzAAU_XSJxGOuZc5.png"/></div></figure><p id="3647" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您以前没有创建过创作资源，请点击<strong class="kw iu">创建一个新的创作资源</strong>。</p><p id="c733" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将出现另一个模式来创建新的创作资源。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/bf5a2c957f28687da88202c192b4a106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*CqdJhUbVNiKoiHb6.png"/></div></figure><ul class=""><li id="2303" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">在Azure资源组下拉列表中选择“rg-bot”</li><li id="cebf" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">在Azure资源名称字段中输入“appointment-booking”。</li><li id="f422" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">在位置下拉列表中选择您喜欢的地区</li><li id="535d" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">在定价层选择“F0”</li><li id="afed" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">单击完成</li></ul><p id="6c9e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您将被重定向回上一个选择创作资源模式。现在，您可以单击“完成”按钮，然后您将被重定向到仪表板页面。</p><p id="b195" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在仪表板页面上，单击创建新应用程序。将出现“创建新应用程序”模式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/b414aa6755e7dbf120c682ac096e41ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*mSBfKzbRyd44b0Wq.png"/></div></figure><p id="cd82" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在“名称”字段中输入“预约”,然后单击“完成”。</p><p id="c930" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建应用程序后，将显示一个教程模式。在模式外部单击，转到新创建的应用程序详细信息页面。</p><p id="8651" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你需要收集一些关键信息以备后用。</p><ul class=""><li id="ef84" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">单击管理选项卡，然后单击设置链接。</li><li id="5def" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">记下应用程序ID。</li><li id="fd3f" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">点击左边菜单上的Azure资源链接</li><li id="c75f" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">单击创作资源选项卡</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/bb3906250bd00dbc8861f402b8edbca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*WXXcsGWTOej5uSb-.png"/></div></figure><p id="fa7f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">记下主键(LUIS API键)和端点URL。</p><p id="e6f3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，预约LUIS应用程序创建成功。下一步是创建应用程序的核心:LUIS模型。</p><h2 id="84c3" class="nd lr it bd ls ne nf dn lw ng nh dp ma ld ni nj mc lh nk nl me ll nm nn mg no bi translated">导入模型</h2><p id="9c4e" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">有两种方法可以创建模型。您可以导航到应用程序的<strong class="kw iu">构建</strong>选项卡，然后<a class="ae mo" href="https://docs.microsoft.com/en-us/azure/cognitive-services/luis/how-to/entities#create-a-list-entity" rel="noopener ugc nofollow" target="_blank">手动创建实体</a>和<a class="ae mo" href="https://docs.microsoft.com/en-us/azure/cognitive-services/luis/how-to/intents" rel="noopener ugc nofollow" target="_blank">意图</a>。或者，您可以将预定义的模型文件导入应用程序。为了节省时间，可以下载这个<a class="ae mo" href="https://raw.githubusercontent.com/sunnyy02/AppointmentBot/master/AppointmentBot/AppointmentBookingBot.LUISModel.json" rel="noopener ugc nofollow" target="_blank"> LUIS model JSON文件</a>并导入。</p><ul class=""><li id="06d6" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">下载JSON模型文件后，通过MANAGE &gt; Versions导航到Versions页面。</li><li id="8aae" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">点击导入按钮</li><li id="c1d5" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">选择“导入为JSON”以打开导入弹出窗口</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/26bc1d4caad0b4aa39e46cf2423e8972.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*AHlVvRbR5OSP9DCZ.png"/></div></figure><ul class=""><li id="a081" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">点击选择文件按钮</li><li id="4661" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">选择您的JSON文件</li><li id="b286" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">点击完成按钮</li></ul><p id="7eca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">新模型将导入到应用程序中。</p><p id="cd29" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">导航到构建&gt;应用程序资产页面并选择“vAppointmentBookingBot”。LUISModel.json”。您可以在页面左上角的面包屑导航中找到它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/399f20c8dc92093b6d556e094401d4a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*WfNXD83swpKDy56r.png"/></div></figure><p id="6806" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，您将看到新创建的意图和实体。</p><h1 id="a7e9" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">培训、测试和发布LUIS模型</h1><p id="12b3" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">导入意图和实体后，顶部导航栏中的Train按钮被启用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/2010dd2d29ac72faf115d9cc82a9e448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*H2D9vG6kSISp-TKo.png"/></div></figure><p id="879b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">单击培训按钮开始培训过程。</p><p id="9e2e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">训练完成后，训练按钮将被禁用，测试按钮将被启用。</p><p id="75ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要测试新模型，请单击test按钮。右侧将出现一个测试弹出面板。您可以在测试面板中键入一个话语来进行测试。</p><p id="1b71" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在下面的截图中，“我想看凯西医生”的预约意向得分为0.973，满分为1分。在Inspect窗口中，它还正确地将医生实体标识为“kathy”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/a8d13fde4a9055be59fa415a00539721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*C7TEv04ANMIqDKeM.png"/></div></figure><p id="5dcc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于测试结果看起来相当不错，现在可以发布LUIS应用程序了。</p><ul class=""><li id="4cbe" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">单击导航栏上的发布按钮</li><li id="e770" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">选择生产插槽</li><li id="b867" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">单击完成</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/43b5ee47b4b3ded404dad778ce1db004.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/0*-129UyucWmNPnKzK.png"/></div></figure><p id="4a07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">发布完成后，会显示如上所示的成功消息通知。这意味着LUIS应用程序已经可以使用了！</p><h1 id="4f6f" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">建造机器人</h1><h2 id="ee37" class="nd lr it bd ls ne nf dn lw ng nh dp ma ld ni nj mc lh nk nl me ll nm nn mg no bi translated">使用bot框架模板创建Bot</h2><p id="adf4" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">在本教程中，您将使用Bot Framework v4 SDK模板来创建Bot项目。打开一个shell并使用。NET CLI与这些命令:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="db16" class="nd lr it nq b gy nu nv l nw nx">dotnet new -i Microsoft.Bot.Framework.CSharp.EchoBot<br/>dotnet new -i Microsoft.Bot.Framework.CSharp.CoreBot<br/>dotnet new -i Microsoft.Bot.Framework.CSharp.EmptyBot</span></pre><p id="35cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本教程中，您将只使用CoreBot模板，但是可以随意探索<code class="fe ny nz oa nq b">EchoBot</code>和<code class="fe ny nz oa nq b">EmptyBot</code>模板。</p><p id="32e8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，您可以使用新安装的模板来生成新的bot项目。运行以下命令创建bot项目:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="3810" class="nd lr it nq b gy nu nv l nw nx">dotnet new corebot -n AppointmentBot</span></pre><p id="f5fe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="oe">你也可以</em> <a class="ae mo" href="https://docs.microsoft.com/en-us/azure/bot-service/bot-service-quickstart-create-bot?view=azure-bot-service-4.0&amp;tabs=csharp%2Ccli" rel="noopener ugc nofollow" target="_blank"> <em class="oe">使用Visual Studio中的Bot框架模板或者VS代码</em> </a> <em class="oe">创建项目。</em></p><p id="cbd1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用前面的命令创建项目后，项目被创建到AppointmentBot/CoreBot文件夹中，并且根名称空间被设置为“CoreBot”。</p><p id="03e1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这与how不一致。NET模板通常是有效的，但是很容易纠正。下面的PowerShell脚本将内容移动到AppointmentBot文件夹中，重命名项目，并将所有名称空间更改为“AppointmentBot”。</p><p id="c4a6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用PowerShell运行以下脚本:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="7f71" class="nd lr it nq b gy nu nv l nw nx">$CorrectProjectName = "AppointmentBot"<br/>Push-Location "./$CorrectProjectName"<br/>Move-Item ./CoreBot/* ./<br/>Remove-Item ./CoreBot<br/>Move-Item ./CoreBot.csproj "./$CorrectProjectName.csproj"<br/>Get-ChildItem * -Recurse -File | ForEach-Object { (Get-Content $_) -replace 'CoreBot', $CorrectProjectName | Set-Content $_ }<br/>Pop-Location</span></pre><p id="f767" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用您喜欢的打开项目。网络编辑。项目结构将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/86ba92e34294d3c8b9b8c6eb08080b4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*Oe3rbx571KsmRVhG.png"/></div></figure><p id="5e18" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">生成的项目附带了一个机票预订机器人示例。删除下面列出的相关模型和对话文件:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="6b82" class="nd lr it nq b gy nu nv l nw nx">[projectRoot]\CognitiveModels\FlightBooking.cs</span><span id="dfc8" class="nd lr it nq b gy oj nv l nw nx">[projectRoot]\CognitiveModels\FlightBooking.json</span><span id="e910" class="nd lr it nq b gy oj nv l nw nx">[projectRoot]\CognitiveModels\FlightBookingEx.cs</span><span id="6b13" class="nd lr it nq b gy oj nv l nw nx">[projectRoot]\Dialogs\BookingDialog.cs</span><span id="d26d" class="nd lr it nq b gy oj nv l nw nx">[projectRoot]\Dialogs\MainDialog.cs</span><span id="d9ac" class="nd lr it nq b gy oj nv l nw nx">[projectRoot]\BookingDetails.cs</span><span id="d3f4" class="nd lr it nq b gy oj nv l nw nx">[projectRoot]\FlightBookingRecognizer.cs</span></pre><p id="cbf4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了节省时间，您可以运行下面的脚本来删除上述文件。通过执行以下操作，从项目根文件夹运行脚本:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="cadb" class="nd lr it nq b gy nu nv l nw nx">rm CognitiveModels/FlightBooking.cs<br/>rm CognitiveModels/FlightBooking.json<br/>rm CognitiveModels/FlightBookingEx.cs<br/>rm Dialogs/BookingDialog.cs<br/>rm Dialogs/MainDialog.cs<br/>rm BookingDetails.cs<br/>rm FlightBookingRecognizer.cs</span></pre><p id="5e0c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你还需要删除<code class="fe ny nz oa nq b">Startup.cs</code>文件中的第41到51行。这些是被删除文件的引用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="89d5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">清理之后，<code class="fe ny nz oa nq b">Startup</code>类将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div><p class="om on gj gh gi oo op bd b be z dk translated">清理后</p></figure><h1 id="a285" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">预约认知模型</h1><p id="b94f" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">现在项目已经清理完毕，您可以开始实现自己的逻辑了。接下来，您将创建模型，LUIS会将模型和分析数据返回给我们。</p><p id="0f49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，您将在<code class="fe ny nz oa nq b">CognitiveModels </code>文件夹下创建这些文件:</p><ul class=""><li id="7185" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated"><code class="fe ny nz oa nq b">DoctorBooking.cs</code>:这个文件将包含<code class="fe ny nz oa nq b">DoctorBooking</code>类，它代表路易斯返回的数据。</li><li id="e1b2" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><code class="fe ny nz oa nq b">DoctorBookingEx.cs</code>:这个文件将使用一个分部类来扩展<code class="fe ny nz oa nq b">DoctorBooking</code>，以简化对LUIS结果实体的访问</li></ul><p id="c38d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建<code class="fe ny nz oa nq b">CognitiveModels/Doctorbooking.cs</code>并添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="5aca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我使用<a class="ae mo" href="https://github.com/microsoft/botframework-cli" rel="noopener ugc nofollow" target="_blank"> Bot Framework CLI </a>生成了这个类，并为了您的方便提供了它，但是您也可以自己生成这个类。</p><blockquote class="ob oc od"><p id="2d24" class="ku kv oe kw b kx ky ju kz la lb jx lc of le lf lg og li lj lk oh lm ln lo lp im bi translated"><em class="it">如果你想自己生成</em> <code class="fe ny nz oa nq b"><em class="it">Doctorbooking.cs</em></code> <em class="it">，你需要先安装node.js和BF CLI。</em></p><p id="ad84" class="ku kv oe kw b kx ky ju kz la lb jx lc of le lf lg og li lj lk oh lm ln lo lp im bi translated">您可以使用以下命令安装BF CLI:<code class="fe ny nz oa nq b"><em class="it">​​​​npm i -g @microsoft/botframework-cli</em></code></p><p id="219a" class="ku kv oe kw b kx ky ju kz la lb jx lc of le lf lg og li lj lk oh lm ln lo lp im bi translated"><em class="it">将</em><a class="ae mo" href="https://raw.githubusercontent.com/sunnyy02/AppointmentBot/master/AppointmentBot/AppointmentBookingBot.LUISModel.json" rel="noopener ugc nofollow" target="_blank"><em class="it">LUIS model JSON文件</em> </a> <em class="it">下载到您的项目目录下，然后从项目根目录下运行以下命令:</em></p><p id="a14f" class="ku kv oe kw b kx ky ju kz la lb jx lc of le lf lg og li lj lk oh lm ln lo lp im bi translated"><code class="fe ny nz oa nq b"><em class="it">​​bf luis:generate:cs --in=AppointmentBookingBot.LUISModel.json --out=CognitiveModels/DoctorBooking.cs --className=AppointmentBot.CognitiveModels.DoctorBookin</em></code></p></blockquote><p id="24b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建<code class="fe ny nz oa nq b">CognitiveModels/DoctorBookingEx.cs</code>文件并添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="7050" class="nd lr it bd ls ne nf dn lw ng nh dp ma ld ni nj mc lh nk nl me ll nm nn mg no bi translated">将机器人连接到LUIS应用程序</h2><p id="c9bf" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">要将bot服务与LUIS应用程序集成，您需要将LUIS应用程序ID、API键和API端点URL添加到项目配置中。</p><p id="3157" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用下面的JSON替换<code class="fe ny nz oa nq b">appsettings.json</code>的内容:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="0c95" class="nd lr it nq b gy nu nv l nw nx">{<br/>  "MicrosoftAppType": "",<br/>  "MicrosoftAppId": "",<br/>  "MicrosoftAppPassword": "",<br/>  "MicrosoftAppTenantId": "",<br/>  "LuisAppId": "[YOUR_LUIS_APP_ID]",<br/>  "LuisApiKey": "&lt;SET_USING_USER_SECRETS&gt;",<br/>  "LuisApiEndpointUrl": "[LUIS_ENDPOINT_URL]"<br/>}</span></pre><p id="77c7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用您的LUIS应用ID替换<code class="fe ny nz oa nq b">[YOUR_LUIS_APP_ID]</code>,用您之前记下的LUIS端点URL替换<code class="fe ny nz oa nq b">[LUIS_ENDPOINT_URL]</code>。</p><p id="8a6c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意，您不应该在源代码中存储敏感信息，包括API密钥或令牌。这就是为什么您将使用<a class="ae mo" href="https://docs.microsoft.com/en-us/aspnet/core/security/app-secrets?view=aspnetcore-6.0&amp;tabs=windows" rel="noopener ugc nofollow" target="_blank">秘密管理器工具</a>来配置<code class="fe ny nz oa nq b">LuisApiKey</code>。</p><p id="110f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过在项目根目录下运行以下命令，为您的项目启用Secret Manager工具:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="304a" class="nd lr it nq b gy nu nv l nw nx">dotnet user-secrets init</span></pre><p id="d781" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行以下命令，使用秘密管理器配置<code class="fe ny nz oa nq b">LuisApiKey</code>:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="5ffc" class="nd lr it nq b gy nu nv l nw nx">dotnet user-secrets set "LuisApiKey" "[YOUR_LUIS_API_KEY]"</span></pre><p id="8fce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用您之前记下的LUIS App主键替换<code class="fe ny nz oa nq b">[YOUR_LUIS_API_KEY]</code>。</p><p id="bf90" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">bot应用程序将检索您刚刚配置的设置，以在下面的<code class="fe ny nz oa nq b">AppointmentBookingRecognizer</code>类中建立到您的LUIS应用程序的连接。新建一个文件<code class="fe ny nz oa nq b">AppointmentBookingRecognizer.cs</code>，添加以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="da72" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">识别器用于识别用户输入并返回<code class="fe ny nz oa nq b">DialogContext</code>中的意图和实体。在<code class="fe ny nz oa nq b">AppointmentBookingRecognizer</code>类中，建立了到LUIS API端点的连接。它还实现了<code class="fe ny nz oa nq b">RecognizeAsync</code>方法，对话框调用该方法从用户的话语中提取意图和实体。</p><h2 id="9aa2" class="nd lr it bd ls ne nf dn lw ng nh dp ma ld ni nj mc lh nk nl me ll nm nn mg no bi translated">使用对话控制对话流</h2><p id="c158" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">你需要使用<a class="ae mo" href="https://docs.microsoft.com/en-us/azure/bot-service/bot-builder-concept-dialog?view=azure-bot-service-4.0" rel="noopener ugc nofollow" target="_blank">对话框</a>来管理用户和机器人之间的对话。</p><blockquote class="ob oc od"><p id="485e" class="ku kv oe kw b kx ky ju kz la lb jx lc of le lf lg og li lj lk oh lm ln lo lp im bi translated">“对话框是SDK中的一个核心概念，它提供了管理与用户的长期对话的方法。一个对话可以由其他对话组成。—微软文档</p></blockquote><p id="4a7a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Bot框架提供了一组丰富的对话框，使创建对话流变得更加容易。在这个例子中，您将创建一个<code class="fe ny nz oa nq b">AppointmentBookingDialog</code>类来管理主对话。它由几个对话框组成，包括瀑布对话框和提示对话框。</p><p id="eaef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">瀑布对话框用于定义步骤的顺序。如下图所示，机器人通过线性过程与用户交互。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/b707381016fe702f196b7220fffb690d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*_94iJryTJlAUjBr3.png"/></div></figure><p id="763d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在项目根目录下创建一个新文件<code class="fe ny nz oa nq b">AppointmentDetails.cs</code>，并添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="787a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe ny nz oa nq b">AppointmentDetails</code>类是对话框的模型类。接下来，在Dialogs文件夹中创建<code class="fe ny nz oa nq b">AppointmentBookingDialog.cs</code>文件。<code class="fe ny nz oa nq b">AppointmentBookingDialog</code>类将实现上面的过程。</p><p id="2d17" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将以下代码添加到文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="d00f" class="nd lr it bd ls ne nf dn lw ng nh dp ma ld ni nj mc lh nk nl me ll nm nn mg no bi translated">主对话框</h2><p id="c9d3" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated"><code class="fe ny nz oa nq b">MainDialog</code>类管理主流程。在Dialogs文件夹中创建<code class="fe ny nz oa nq b">MainDialog.cs</code>文件(你可以从<a class="ae mo" href="https://github.com/sunnyy02/AppointmentBot/blob/master/AppointmentBot/Dialogs/MainDialog.cs" rel="noopener ugc nofollow" target="_blank">这里</a>下载代码)。</p><p id="b58f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个图表向您概述了<code class="fe ny nz oa nq b">MainDialog</code>类的作用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/aeb7f78f36eeb496ebdb72480f6e139e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*bggEZOBpWEVraYAM.png"/></div></figure><p id="0fce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">代码相当多，但是<code class="fe ny nz oa nq b">MainDialog</code>类的重要部分如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="ddba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">简而言之，当收到一个消息活动时，机器人运行<code class="fe ny nz oa nq b">MainDialog</code>。<code class="fe ny nz oa nq b">MainDialog</code>提示用户使用<code class="fe ny nz oa nq b">IntroStepAsync</code>方法，然后调用<code class="fe ny nz oa nq b">ActStepAsync</code>方法。</p><p id="1497" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe ny nz oa nq b">ActStepAsync</code>方法中，机器人调用LUIS应用程序来获取包含用户意图和实体的<code class="fe ny nz oa nq b">luisResult</code>对象。用户的意图和实体用于确定下一步，执行验证或调用其他对话框。</p><p id="6e86" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，机器人调用<code class="fe ny nz oa nq b">FinalStepAsync</code>方法来完成或取消该过程。</p><h2 id="72c9" class="nd lr it bd ls ne nf dn lw ng nh dp ma ld ni nj mc lh nk nl me ll nm nn mg no bi translated">Twilio适配器和控制器</h2><p id="b7b6" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">默认情况下，Azure Bot服务将连接到web聊天通道，该通道由默认的<code class="fe ny nz oa nq b">AdapterWithErrorHandler</code>适配器处理。默认适配器被注入到默认的<code class="fe ny nz oa nq b">BotController</code>类中，控制器公开一个端点<em class="oe"> /api/messages </em>。</p><p id="894a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了将bot连接到Twilio，您将创建一个新的从<a class="ae mo" href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.bot.builder.adapters.twilio.twilioadapter?view=botbuilder-dotnet-stable" rel="noopener ugc nofollow" target="_blank"> TwilioAdapter </a>类扩展而来的<code class="fe ny nz oa nq b">TwilioAdapterWithErrorHandler</code>类。运行以下命令来安装<a class="ae mo" href="https://www.nuget.org/packages/Microsoft.Bot.Builder.Adapters.Twilio/" rel="noopener ugc nofollow" target="_blank">微软。bot . builder . adapters . twilio</a>n获取包:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="3e28" class="nd lr it nq b gy nu nv l nw nx">dotnet add package Microsoft.Bot.Builder.Adapters.Twilio --version 4.15.0</span></pre><p id="4ac0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="oe">确保</em> <a class="ae mo" href="https://www.nuget.org/packages/Microsoft.Bot.Builder.Adapters.Twilio/" rel="noopener ugc nofollow" target="_blank"> <em class="oe">微软。bot . builder . adapters . twilio</em></a><em class="oe">NuGet包使用的版本与csproj文件中指定的其他Microsoft.Bot.Builder.*包相同。</em></p><p id="496f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">NuGet安装完成后，在项目根目录下创建<code class="fe ny nz oa nq b">TwilioAdapterWithErrorHandler.cs</code>文件，并添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="e098" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了处理来自Twilio的HTTP webhook请求，您需要添加一个<code class="fe ny nz oa nq b">TwilloController</code>。在Controllers文件夹中创建一个新文件<code class="fe ny nz oa nq b">TwilioController.cs</code>，并添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="448c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe ny nz oa nq b">TwilioController</code>的端点是<em class="oe"> /api/twilio </em>。添加新端点后，bot可以通过web通道和Twilio SMS通道处理消息。</p><p id="71d2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，您需要在<code class="fe ny nz oa nq b">Startup</code>类中注册对话框和LUIS识别器。在<code class="fe ny nz oa nq b">Startup.cs</code>文件中的<code class="fe ny nz oa nq b">ConfigureServices</code>方法的末尾插入以下几行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h1 id="1294" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">本地测试</h1><p id="462f" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">您需要安装<a class="ae mo" href="https://github.com/Microsoft/BotFramework-Emulator/blob/master/README.md#download" rel="noopener ugc nofollow" target="_blank">机器人框架模拟器</a>来本地测试机器人。要安装Bot框架模拟器，请执行以下操作:</p><ul class=""><li id="1225" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">导航到Bot框架模拟器项目的<a class="ae mo" href="https://github.com/Microsoft/BotFramework-Emulator/releases/latest" rel="noopener ugc nofollow" target="_blank"> GitHub发布页面</a></li><li id="28a4" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">单击操作系统的安装文件进行下载。</li><li id="5e71" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">下载完成后，单击该文件开始安装。遵循安装向导，并使用默认选项来完成安装。</li></ul><p id="0809" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，使用。NET CLI:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="7bd1" class="nd lr it nq b gy nu nv l nw nx">dotnet run</span></pre><p id="ae9a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，启动Bot模拟器，单击Open Bot按钮，并在您的本地环境中输入Bot的URL，默认情况下是<code class="fe ny nz oa nq b"><a class="ae mo" href="http://localhost:3978/api/messages." rel="noopener ugc nofollow" target="_blank"><em class="oe">http://localhost:3978/api/messages</em>.</a></code>，然后单击Connect按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/7d26ec95c9983651b8805d845c3041ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*sIaqlaFerO1x0Ieq.png"/></div></figure><p id="d6dc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将会打开一个聊天窗口。您可以键入消息并开始测试。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/5c183c6356679b9e61546729f75b6ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*irDg06NZ5AUuF-Fz.png"/></div></figure><p id="82f9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在您对测试结果感到满意之后，就可以将bot部署到Azure了。</p><h1 id="22ed" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">将机器人部署到Azure</h1><p id="3bb7" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">来部署。NET bot到Azure，需要使用Azure CLI创建以下资源:</p><ul class=""><li id="3e35" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">资源组:您之前已经创建了一个<code class="fe ny nz oa nq b">rg-bot</code>资源组。</li><li id="c278" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">A <a class="ae mo" href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview" rel="noopener ugc nofollow" target="_blank">托管身份</a>:虽然这个资源不会用于Twilio bot，但是bot框架部署模板需要它</li><li id="da26" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">一个<a class="ae mo" href="https://docs.microsoft.com/en-us/azure/app-service/overview-hosting-plans" rel="noopener ugc nofollow" target="_blank"> App服务计划</a>和一个<a class="ae mo" href="https://docs.microsoft.com/en-us/azure/app-service/overview" rel="noopener ugc nofollow" target="_blank"> App服务</a></li><li id="cdf6" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">一个<a class="ae mo" href="https://azure.microsoft.com/en-us/services/bot-services/" rel="noopener ugc nofollow" target="_blank">机器人服务</a></li></ul><p id="3ad6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要创建新的应用服务计划，请运行以下命令:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="24c9" class="nd lr it nq b gy nu nv l nw nx">az appservice plan create -g rg-bot -n asp-bot --location [AZURE_LOCATION] --sku F1</span></pre><p id="53a9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些参数的作用如下:</p><ul class=""><li id="8769" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated"><code class="fe ny nz oa nq b">-g</code>或<code class="fe ny nz oa nq b">— resource-group</code>:资源应该被放入的资源组，在本例中是您之前创建的“rg-bot”资源组。</li><li id="396d" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><code class="fe ny nz oa nq b">-n</code>或<code class="fe ny nz oa nq b">— name</code>:App服务计划的名称，即<code class="fe ny nz oa nq b">asp-bot</code>。“asp”是App服务计划的简称。</li><li id="8cf3" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><code class="fe ny nz oa nq b">-l</code>或<code class="fe ny nz oa nq b">— location</code>:资源应该驻留的Azure位置。将<code class="fe ny nz oa nq b">[AZURE_LOCATION]</code>替换为离您或您的用户最近的位置，就像您之前创建资源组时所做的那样。</li><li id="bc21" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><code class="fe ny nz oa nq b">— sku</code>:大小(CPU/RAM/等。)的应用服务计划，在这种情况下是F1(免费)。</li></ul><p id="b91a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以确保。要正确部署. NET项目，您需要生成一个部署文件。可以使用以下命令生成部署文件:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="8e58" class="nd lr it nq b gy nu nv l nw nx">az bot prepare-deploy — lang Csharp — code-dir “.” — proj-file-path “AppointmentBot.csproj”</span></pre><p id="85a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意<code class="fe ny nz oa nq b">--code-dir</code>和<code class="fe ny nz oa nq b">--proj-file-path</code>需要匹配来解析项目文件的路径。</p><p id="5634" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用以下命令创建受管身份:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="0c82" class="nd lr it nq b gy nu nv l nw nx">az identity create --resource-group "rg-bot" --name "identity-appointment-bot"</span></pre><p id="6ca0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该命令完成后，Azure中已经添加了一个新的<code class="fe ny nz oa nq b">identity-appointment-bot</code>托管身份，它将用于在下一步创建新的App服务和Bot服务。</p><p id="d89e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">应用服务和机器人服务可以使用现有的应用服务计划和Azure资源管理器(ARM)模板生成，该模板是“CoreBot”的一部分。NET模板。</p><p id="b3f7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您使用的是deployment templates/template-with-pre existing-rg . JSON ARM模板，但是它需要很多参数，这就是您应该使用参数文件的原因。在项目根目录下新建一个<code class="fe ny nz oa nq b">ParameterFiles</code>文件夹，并新建一个<code class="fe ny nz oa nq b">RegisterAppParams.json</code>文件，内容如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="b86f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有些参数已经用以前创建的资源的名称进行了配置，但是您仍然需要用您自己的特定设置更新一些参数:</p><ul class=""><li id="3456" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated"><code class="fe ny nz oa nq b"><strong class="kw iu">appId</strong></code>:响应<code class="fe ny nz oa nq b">create identity</code>命令时<code class="fe ny nz oa nq b">clientId</code>的值。你也可以这样查询<code class="fe ny nz oa nq b">clientId</code>:<code class="fe ny nz oa nq b">az identity show -g rg-bot -n identity-appointment-bot --query clientId</code></li><li id="3b2b" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><code class="fe ny nz oa nq b"><strong class="kw iu">tenantId</strong></code>:响应<code class="fe ny nz oa nq b">create identity</code>命令时<code class="fe ny nz oa nq b">tenantId</code>的值。你也可以这样查询<code class="fe ny nz oa nq b">tenantId</code>:<code class="fe ny nz oa nq b">az account show --query tenantId</code></li><li id="b54e" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><code class="fe ny nz oa nq b"><strong class="kw iu">appServicePlanLocation</strong></code>:您在创建应用服务计划时使用的Azure区域。</li><li id="9a64" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><code class="fe ny nz oa nq b"><strong class="kw iu">botId</strong></code>:你的Bot服务的名称。该名称必须是全局唯一的。用任何能使名字独一无二的东西代替<code class="fe ny nz oa nq b">[UNIQUE_SUFFIX]</code>，比如“名字-姓氏1234”。如果它不接受该名称，请更改它并重试。</li><li id="a09a" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><code class="fe ny nz oa nq b"><strong class="kw iu">newWebAppName</strong></code>:您的应用服务的名称。这个名字必须是全局唯一的，因为它将被用作<em class="oe">azurewebsites.net</em>的子域。用任何能使名字独一无二的东西代替<code class="fe ny nz oa nq b">[UNIQUE_SUFFIX]</code>，比如“名字-姓氏1234”。如果它不接受该名称，请更改它并重试。</li></ul><p id="f5da" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">参数文件更新后，运行以下命令生成App服务和Bot服务:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="1359" class="nd lr it nq b gy nu nv l nw nx">az deployment group create `<br/>  --resource-group "rg-bot" `<br/>  --template-file "./DeploymentTemplates/template-with-preexisting-rg.json" `<br/>  --parameters "@ParameterFiles/RegisterAppParams.json"</span></pre><p id="71cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Azure需要一分钟来部署这个基础设施。生成应用服务后，运行以下命令获取应用服务主机名:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="740f" class="nd lr it nq b gy nu nv l nw nx">az webapp show -g rg-bot -n appointment-bot-[UNIQUE_SUFFIX] --query 'hostNames[0]'</span></pre><p id="4cdd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用您在参数文件中使用的后缀替换<code class="fe ny nz oa nq b">[UNIQUE_SUFFIX]</code>。<strong class="kw iu">记下这个主机名</strong>，因为您稍后会用到它。</p><p id="2e31" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">既然已经提供了应用程序服务基础架构，您就可以部署您的本地。NET bot项目。运行以下命令，该命令将创建一个ZIP文件并将该ZIP文件部署到应用服务:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="9f87" class="nd lr it nq b gy nu nv l nw nx">az webapp up -g rg-bot -n appointment-bot-[UNIQUE_SUFFIX]</span></pre><p id="15c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">完成部署大约需要30秒。完成后，您将看到如下所示的成功响应:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h1 id="9a8c" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">为短信通信设置Twilio</h1><p id="f04c" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">您已经使用网络聊天在本地测试了机器人，但是本教程的目标是使用SMS进行通信。若要接收和发送短信，您需要一个Twilio电话号码。</p><ul class=""><li id="1205" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">去Twilio 买一个新的电话号码。如果您使用试用帐户，电话号码的费用将计入您的免费促销点数。<br/>确保<strong class="kw iu">记下您的新Twilio电话号码。你以后会需要它的！</strong></li><li id="92f0" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">如果您使用的是试用Twilio帐户，您只能向经过验证的来电显示发送短信。<a class="ae mo" href="https://support.twilio.com/hc/en-us/articles/223180048-Adding-a-Verified-Phone-Number-or-Caller-ID-with-Twilio" rel="noopener ugc nofollow" target="_blank">验证您的电话号码</a>或您想要发送短信的电话号码，如果该号码不在已验证的来电显示列表中。</li><li id="44cb" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">最后，您需要找到您的Twilio帐户SID和Auth Token。导航到您的<a class="ae mo" href="https://console.twilio.com/" rel="noopener ugc nofollow" target="_blank"> Twilio帐户页面</a>和<strong class="kw iu">记下您的Twilio帐户SID和位于页面左下方的认证令牌</strong>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/9bfb49d30f5d0a24e68744ab260e84bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*BBGnfpHSU7JFzEaa.png"/></div></figure><p id="db8a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当您的Twilio电话号码收到短信时，Twilio会将其转发到您的。托管在Azure应用服务上的NET bot。</p><p id="8d09" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要进行配置，请导航至电话号码&gt;管理&gt;有效号码，然后单击您的Twilio电话号码以访问配置页面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/6789c892bc9ffdc2e4dfec8b46d9ee46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*MEiIKk5tiwSS58Sd.png"/></div></figure><p id="91ec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Messaging部分，将CONFIGURE WITH OTHER HANDLERS下的下拉列表设置为“Webhook”，并在相邻的文本字段中输入“<em class="oe"> https:// </em>”，然后粘贴您之前记下的应用服务主机名，然后输入“<em class="oe"> /api/twilio </em>”。</p><p id="4eff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该网址应该看起来像<a class="ae mo" href="https://your-hostname.azurewebsites.net/api/twilio." rel="noopener ugc nofollow" target="_blank"><em class="oe">https://your-hostname.azurewebsites.net/api/twilio</em>。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/76926ce7bbd43377d580012cff9e9f3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*FefnP_TBBliMQXsD.png"/></div></figure><p id="e887" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">点击左下角的保存按钮。<strong class="kw iu">记下这个webhook URL </strong>，你很快会再次需要它。</p><p id="cda6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，您需要向您的应用服务添加一些配置。运行以下命令来配置应用程序设置:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="86f9" class="nd lr it nq b gy nu nv l nw nx">az webapp config appsettings set -g rg-bot -n appointment-bot-[UNIQUE_SUFFIX] --settings `<br/> LuisApiKey=[YOUR_LUIS_API_KEY] `<br/> TwilioNumber=[YOUR_TWILIO_PHONE_NUMBER] `<br/> TwilioAccountSid=[YOUR_TWILIO_ACCOUNT_SID] `<br/> TwilioAuthToken=[YOUR_TWILIO_AUTH_TOKEN] `<br/> TwilioValidationUrl=[YOUR_BOT_TWILIO_ENDPOINT]</span></pre><p id="fd76" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行该命令之前，请替换占位符。</p><ul class=""><li id="2f78" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">用您之前记下的LUIS主键替换<code class="fe ny nz oa nq b">[YOUR_LUIS_API_KEY]</code>。</li><li id="2a5e" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">将<code class="fe ny nz oa nq b">[YOUR_TWILIO_PHONE_NUMBER]</code>替换为您之前购买的Twilio电话号码。使用看起来像<code class="fe ny nz oa nq b">+11234567890</code>的<a class="ae mo" href="https://www.twilio.com/docs/glossary/what-e164" rel="noopener ugc nofollow" target="_blank"> E.164 </a>输入电话号码。</li><li id="6678" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">用您之前记下的Twilio帐户SID替换<code class="fe ny nz oa nq b">[YOUR_TWILIO_ACCOUNT_SID]</code>。</li><li id="3411" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">用你之前记下的webhook URL替换<code class="fe ny nz oa nq b">[YOUR_BOT_TWILIO_ENDPOINT]</code>。它应该看起来像https://your-hostname.azurewebsites.net/api/twilio的<a class="ae mo" href="https://your-hostname.azurewebsites.net/api/twilio" rel="noopener ugc nofollow" target="_blank">T22T24】。</a></li></ul><p id="3b11" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以重新启动应用程序服务，以确保bot加载了应用程序设置。运行以下命令重新启动应用程序服务:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="0758" class="nd lr it nq b gy nu nv l nw nx">az webapp restart -g rg-bot -n appointment-bot-[UNIQUE_SUFFIX]</span></pre><h1 id="380d" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">端到端测试</h1><p id="9a95" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">最后，您已经构建并组装了所有移动部件。来测试一下吧！</p><p id="70b2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">给你的Twilio手机号码发送一条短信，你应该会看到机器人的回复。在这里，你可以看到我发送了以下短信到我的Twilio手机号码，它的工作！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/49d27c477be5565405a3f766e552928a.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/0*05KVs00YnW1ey-8w.png"/></div></figure><h1 id="fa78" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">后续步骤</h1><p id="9623" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">还有一些重要的bot特性没有在本文中介绍。在开发生产级机器人时，您可能想进一步探索。</p><ul class=""><li id="42c5" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">身份验证:当bot需要代表用户访问资源时，您必须验证用户身份。用户身份验证可以由身份提供者处理，如带有OAuth 2.0的Azure AD。您的bot将使用Azure生成的令牌来访问这些资源。关于如何将Azure广告认证添加到机器人的细节可以在微软的文档中找到<a class="ae mo" href="https://docs.microsoft.com/en-us/azure/bot-service/bot-builder-authentication?view=azure-bot-service-4.0&amp;tabs=userassigned%2Caadv2%2Ccsharp" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="e2fa" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae mo" href="https://docs.microsoft.com/en-us/composer/introduction?tabs=v2x" rel="noopener ugc nofollow" target="_blank"> Bot Framework Composer </a>:它是一个开源的可视化设计器和创作工具，使用Azure Bot服务创建Bot。您可以使用它在UI中构建对话框，并向业务用户可视化流程。它还允许您在工具中训练LUIS模型，从而无需在不同环境之间切换。如果你的项目需要非技术人员参与bot开发，它绝对是一个值得考虑的好工具。</li></ul><h1 id="f392" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">结论</h1><p id="fdae" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">在本文中，您通过Twilio、Azure Bot Framework和LUIS逐步构建了一个短信预订系统。您可以通过添加更多的频道、扩展LUIS模型以支持现实生活场景，以及合并其他功能(如图像识别或多语言支持)来扩展这一功能。</p><p id="f3ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在<a class="ae mo" href="https://github.com/sunnyy02/AppointmentBot" rel="noopener ugc nofollow" target="_blank">这个GitHub repo </a>中找到完整的源代码。</p></div></div>    
</body>
</html>