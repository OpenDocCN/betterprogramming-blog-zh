<html>
<head>
<title>Building a REST API With Go, Gin Framework, and GORM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Go、Gin框架和GORM构建REST API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-a-rest-api-with-go-gin-framework-and-gorm-38cb2d6353da?source=collection_archive---------1-----------------------#2022-05-01">https://betterprogramming.pub/building-a-rest-api-with-go-gin-framework-and-gorm-38cb2d6353da?source=collection_archive---------1-----------------------#2022-05-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0fbc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">加强你的后端项目</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8326aedd9dd567e0703db747ff87a359.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*w-wqhQcUdt-OJoYK"/></div></div></figure><p id="8245" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我在寻找一个框架来启动一个后端项目，以学习和使用GORM，这是一个用于Go的ORM库。和Gin引起了我的注意，我发现该文档非常好，其中的示例有助于构建REST API。</p><p id="0854" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我写这篇文章是作为我学习过程的一部分，所以我将与你分享如何使用Gin HTTP Web框架和GORM作为ORM来构建一个REST API。</p><h1 id="2ec0" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated"><strong class="ak"> Gin框架</strong></h1><p id="9c77" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">根据其<a class="ae mk" href="https://gin-gonic.com/docs/" rel="noopener ugc nofollow" target="_blank">文档</a>:</p><blockquote class="ml mm mn"><p id="7e41" class="kr ks mo kt b ku kv jr kw kx ky ju kz mp lb lc ld mq lf lg lh mr lj lk ll lm ij bi translated">Gin是一个用Go (Golang)编写的web框架。它有一个类似martini的API，由于有了httprouter，它的性能提高了40倍。如果你需要性能和良好的生产力，你会喜欢杜松子酒。</p></blockquote><h2 id="5396" class="ms lo iq bd lp mt mu dn lt mv mw dp lx la mx my lz le mz na mb li nb nc md nd bi translated"><strong class="ak">先决条件</strong></h2><ul class=""><li id="beee" class="ne nf iq kt b ku mf kx mg la ng le nh li ni lm nj nk nl nm bi translated">安装完毕</li><li id="f7ea" class="ne nf iq kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">Gin框架</li><li id="0269" class="ne nf iq kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">戈尔姆</li></ul><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="a76b" class="ms lo iq nt b gy nx ny l nz oa">restApi/ <br/>     grocery/ <br/>          groceryService.go <br/>     model/ <br/>       groceryModel.go <br/>       database.go <br/>     main.go <br/>     go.mod <br/>     go.sum <br/>     database.db</span></pre><p id="a7a1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将在<code class="fe ob oc od nt b">grocery.go</code>开始定义我们的模型:</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="29c3" class="ms lo iq nt b gy nx ny l nz oa">package model </span><span id="18c8" class="ms lo iq nt b gy oe ny l nz oa">import ( <br/>"gorm.io/gorm" <br/>) </span><span id="3442" class="ms lo iq nt b gy oe ny l nz oa">type Grocery struct { </span><span id="22e6" class="ms lo iq nt b gy oe ny l nz oa">gorm.Model <br/>Name string `json:"name"` <br/>Quantity int `json:"quantity"` </span><span id="5017" class="ms lo iq nt b gy oe ny l nz oa">}</span></pre><p id="b23e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当您向数据库添加数据时，在模型的字段上声明<code class="fe ob oc od nt b">gorm.Model</code>会自动将这些字段添加到模型中:</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="5b5d" class="ms lo iq nt b gy nx ny l nz oa">type Model struct { <br/>ID uint `gorm:"primaryKey"` <br/>CreatedAt time.Time <br/>UpdatedAt time.Time <br/>DeletedAt gorm.DeletedAt `gorm:"index"` <br/>}</span></pre><p id="7dee" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ob oc od nt b">database.go</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="abb6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">数据库函数将连接数据库。我使用的是SQLite，但是GORM有MySQL、PostgreSQL和SQLServer的驱动程序。<code class="fe ob oc od nt b">db</code>变量将打开<code class="fe ob oc od nt b">database.db</code>文件，数据将存储在该文件中。</p><p id="0099" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ob oc od nt b">db.AutoMigrate(&amp;Grocery{})</code>将自动迁移我们的模式，并保持它最新。</p><p id="3f75" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ob oc od nt b">groceryService.go</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="56ba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ob oc od nt b">GetGroceries</code>是获取存储在数据库中的所有食品杂货的函数。我们声明了变量<code class="fe ob oc od nt b">groceries</code>，然后我们使用变量db来使用与* <code class="fe ob oc od nt b">gorm.DB</code>相关联的方法Find，并将食品杂货的地址作为参数传递。</p><p id="620e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后我们使用<code class="fe ob oc od nt b">c.JSON</code>以JSON的形式发送食品杂货中的状态和数据作为响应。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="b857" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ob oc od nt b">GetGrocery</code>根据id获取杂货店。它从URI获取id。我们使用的方法是，根据id获取杂货店。</p><p id="b51b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果数据库中不存在id，将发送一个未找到状态和一条错误消息作为响应。如果存在，那么杂货数据将作为响应发送。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="4505" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们用字段Name和Quantity创建一个结构<code class="fe ob oc od nt b">NewGrocery</code>，并添加<code class="fe ob oc od nt b">binding: required</code>。</p><p id="9023" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后在<code class="fe ob oc od nt b">PostGrocery</code>中，我们声明一个类型为<code class="fe ob oc od nt b">NewGrocery</code>的变量杂货店。如果post请求中有一个字段缺失或有打印错误，则会发送一个包含错误的错误请求状态作为响应。</p><p id="1528" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果一切正确，像这样:<code class="fe ob oc od nt b">{“name”: “Apple”, “quantity”: 5}</code>。将创建另一个变量<code class="fe ob oc od nt b">newGrocery</code>，类型为杂货。</p><p id="000c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它的数据将与杂货变量相同。然后我们调用方法Create，并传递<code class="fe ob oc od nt b">newGrocery</code>的地址。状态和数据将作为响应发送。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="61d8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe ob oc od nt b">UpdateGrocery</code>中，首先，我们检查URI中通过它的id是否存在，如果不存在，将发送一个错误和未找到状态。</p><p id="4350" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果它确实存在，将创建一个类型为<code class="fe ob oc od nt b">GroceryUpdate</code>的变量来检查字段，如果一切都正确，那么我们使用方法Updates，并发送杂货店更新的状态作为响应。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="a1c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe ob oc od nt b">DeleteGrocery</code>中，如果id在数据库中不存在，将发送错误和未找到状态。</p><p id="959b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果它确实存在，方法Delete将删除杂货店。状态，并将发送一条消息作为响应。</p><p id="5809" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ob oc od nt b">main.go</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="ea4b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在主函数中，我们调用了<code class="fe ob oc od nt b">model.Database()</code>来初始化数据库。</p><p id="5272" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，我们用以下命令启动路由器:</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="fcea" class="ms lo iq nt b gy nx ny l nz oa">router := gin.Default()</span></pre><p id="6476" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们可以使用各自的HTTP方法，将它们的URI和函数作为参数。使用GET、POST、PUT和DELETE方法的模式是相同的:</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="cfb7" class="ms lo iq nt b gy nx ny l nz oa">    //method.(URI, function)<br/>router.GET("/groceries", grocery.GetGroceries)</span></pre><p id="8282" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，我们使用方法Run并将端口作为参数传递。我们可以使用不带参数的Run，默认情况下它服务于:8080。</p><p id="4e41" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢您花时间阅读这篇文章。</p><p id="2da4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完整的代码是<a class="ae mk" href="https://github.com/carlosm27/apiwithgorm" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><h1 id="8e62" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">参考</h1><ul class=""><li id="a2c8" class="ne nf iq kt b ku mf kx mg la ng le nh li ni lm nj nk nl nm bi translated"><a class="ae mk" href="https://gin-gonic.com/docs/" rel="noopener ugc nofollow" target="_blank">杜松子酒</a></li><li id="2660" class="ne nf iq kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated"><a class="ae mk" href="https://gorm.io/docs/" rel="noopener ugc nofollow" target="_blank">戈尔姆</a></li></ul></div><div class="ab cl oh oi hu oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="ij ik il im in"><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="4ce3" class="ms lo iq nt b gy nx ny l nz oa"><strong class="nt ir">Want to Connect?</strong></span><span id="ca14" class="ms lo iq nt b gy oe ny l nz oa">You can contact me through <a class="ae mk" href="https://twitter.com/Carlos_marcv" rel="noopener ugc nofollow" target="_blank">Twitter</a>, <a class="ae mk" href="https://www.linkedin.com/in/carlos-marcano-a2135a134/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</span><span id="1859" class="ms lo iq nt b gy oe ny l nz oa"><em class="mo">Originally published at </em><a class="ae mk" href="https://carlosmv.hashnode.dev/building-a-rest-api-with-go-gin-framework-and-gorm" rel="noopener ugc nofollow" target="_blank"><em class="mo">https://carlosmv.hashnode.dev</em></a></span></pre></div></div>    
</body>
</html>