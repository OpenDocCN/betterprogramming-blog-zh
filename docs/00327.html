<html>
<head>
<title>Use Python to Convert Worksheets in an Excel File to Separate CSV Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python将Excel文件中的工作表转换为单独的CSV文件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-python-to-convert-worksheets-in-an-excel-file-to-separate-csv-files-7dd406b652d7?source=collection_archive---------1-----------------------#2019-04-16">https://betterprogramming.pub/using-python-to-convert-worksheets-in-an-excel-file-to-separate-csv-files-7dd406b652d7?source=collection_archive---------1-----------------------#2019-04-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dfb5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">ETL改进</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8479aede87e6ab1cc0e59cffbfb6ee1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pqDN6Bx294XTeZA7"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卡洛斯·穆扎在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="84ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与各种不同的客户打交道让我接触到以Excel <code class="fe lv lw lx ly b">.xlsx</code>格式提供数据文件的场景。对我个人来说，这种文件格式在以编程方式使用它做某些事情时不是很通用和兼容。</p><p id="8603" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有几个原因，但其中一个主要原因是Excel如何自动将一些值解析为特定的格式(例如数字、科学记数法和日期)，因为它试图变得“智能”。</p><p id="1d91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在某些情况下，这可能是有用的，但当涉及到编程时，这可能会导致错误并增加复杂性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lz"><img src="../Images/9b094acb67097e4c68f9aec6934cd90c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IvSV5dM82NnaLnKf"/></div></div></figure><p id="9185" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在开始处理Excel文件中包含的数据之前，我通常会将Excel文件转换为CSV文件。</p><p id="648f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是为了使数据格式保持一致，一般来说，CSV文件很容易集成到任何程序中(因为它只是一个文本文件，其中的数据由逗号<code class="fe lv lw lx ly b">,</code>分隔)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/a0df93d96ad193ba014246ef5efc011a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*vm8SMPjRp1I2KfweP71Zyg.png"/></div></figure><p id="9c36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最初，我只是将Excel工作簿中的每个工作表导出为<code class="fe lv lw lx ly b">CSV</code>，并保存为新文件。</p><p id="c856" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，随着我不断获得更多的Excel文件进行处理并成为ETL管道的一部分，我决定需要以编程的方式自动化它，这样我就不需要花费更多的时间将它们手动转换成CSV文件。</p><p id="44c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我相信你们中的一些人正在经历同样的事情，所以我决定分享下面这个简单的Python脚本，它将Excel工作表转换成CSV文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">exceltab_to_csv.py</p></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="11d5" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">属国</h1><p id="d70b" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">首先，你需要使用<code class="fe lv lw lx ly b">pip install xlrd</code>安装Excel库<code class="fe lv lw lx ly b">xlrd</code>。另外两个库<code class="fe lv lw lx ly b">csv</code>和<code class="fe lv lw lx ly b">sys</code>是Python标准库，所以不需要安装。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="a3db" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">游戏攻略</h1><p id="5355" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">库<code class="fe lv lw lx ly b">xlrd</code>允许我们与Excel文件交互。下面一行显示了如何将Excel文件读入内存的一行程序。</p><pre class="kj kk kl km gt nh ly ni nj aw nk bi"><span id="ce82" class="nl ml it ly b gy nm nn l no np">workbook = xlrd.open_workbook(excel_file)</span></pre><p id="c2ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，脚本遍历Excel文件的工作表，在一个<code class="fe lv lw lx ly b">for loop</code>中一个接一个。该循环包括以下步骤:</p><ul class=""><li id="fd52" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">获取工作表名称。</li></ul><pre class="kj kk kl km gt nh ly ni nj aw nk bi"><span id="9e4a" class="nl ml it ly b gy nm nn l no np">workbook.sheet_names()</span></pre><ul class=""><li id="67bc" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">从每个工作表中提取数据。</li></ul><pre class="kj kk kl km gt nh ly ni nj aw nk bi"><span id="3ced" class="nl ml it ly b gy nm nn l no np">worksheet = workbook.sheet_by_name(sheet_name)</span></pre><ul class=""><li id="c9d1" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">创建一个新的CSV文件，其名称为原始Excel工作表名称。整理了一点替换空格和破折号。</li></ul><pre class="kj kk kl km gt nh ly ni nj aw nk bi"><span id="331c" class="nl ml it ly b gy nm nn l no np">csv_file_full_path = csv_file_base_path + sheet_name.lower().replace(" - ", "_").replace(" ","_") + '.csv'</span><span id="31ec" class="nl ml it ly b gy nz nn l no np">csvfile = open(csv_file_full_path, 'wb')</span></pre><ul class=""><li id="0255" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">写入新的CSV文件，一次一行。</li></ul><pre class="kj kk kl km gt nh ly ni nj aw nk bi"><span id="994f" class="nl ml it ly b gy nm nn l no np">writetocsv = csv.writer(csvfile, quoting = csv.QUOTE_ALL)</span><span id="6659" class="nl ml it ly b gy nz nn l no np">for rownum in xrange(worksheet.nrows):<br/>            writetocsv.writerow(<br/>                list(x.encode('utf-8') if type(x) == type(u'') else x<br/>                    for x in worksheet.row_values(rownum)<br/>                )<br/>            )</span><span id="84c4" class="nl ml it ly b gy nz nn l no np">csvfile.close()</span></pre></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="4921" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">执行</h1><p id="268a" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">要运行这个Python脚本，请转到您的终端并执行以下操作。</p><pre class="kj kk kl km gt nh ly ni nj aw nk bi"><span id="c6fc" class="nl ml it ly b gy nm nn l no np">MacBook-Pro:~ bobthedude$ python exceltab_to_csv.py ./datafiles/client_data.xlsx ./datafiles/client_data_csv/</span></pre><p id="5413" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一计划的论据是:</p><ul class=""><li id="344a" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">第一个参数:要转换为. csv的Excel文件路径。</li><li id="3272" class="nq nr it lb b lc oa lf ob li oc lm od lq oe lu nv nw nx ny bi translated">第二个参数:要保存。csv文件在。</li></ul><p id="93fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！下次需要将Excel文件转换为. csv文件时，可以使用该脚本。</p><p id="430d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这有助于您的工作流程！</p></div></div>    
</body>
</html>