<html>
<head>
<title>Why and How You Should Sign All Your Git Commits</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么以及如何签署所有的Git提交</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/why-and-how-you-should-sign-all-your-git-commits-94435516edae?source=collection_archive---------3-----------------------#2022-05-01">https://betterprogramming.pub/why-and-how-you-should-sign-all-your-git-commits-94435516edae?source=collection_archive---------3-----------------------#2022-05-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="de41" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">保护您的存储库</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6479ddcbc5366bf15f1e5294d1119c27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P8Agtn_TSe3Lo_d0"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">卡斯帕·卡米尔·鲁宾在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="378d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你花了一些时间在公共在线知识库上，比如GitLab或GitHub，你可能会注意到贡献者提交的绿色“已验证”徽章。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/3cdfcba88deed4e13c1f48a311786b6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*odH5owh7s5Ha13vSpo3fWQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GitLab中提交旁边的已验证徽章</p></figure><p id="0836" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了美观之外，它们还有一个真正的用途。Git本身并不跟踪和验证用户的提交操作。这意味着您可以轻松地冒充其他人并以他们的名义提交。</p><p id="17d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我举个例子来说明这一点。</p><p id="943b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我在GitLab个人资料中创建了一个名为“Oops”的新存储库:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/94b9c8e58306d55290e6a4278132c1c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y95RdKhhqMrmxnUlkAhtPw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">新的远程存储库</p></figure><p id="f52e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我克隆了存储库，并将我的身份设置为与我的一个朋友相同的名称和电子邮件地址，他也有一个GitLab帐户。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/01b6ba9ed01a3666f72ae90e102efa34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*GMEG4TxfdTnb7bGnN9cung.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将我的身份设置给其他人</p></figure><p id="4ba8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，我可以只做一些更改，然后提交并将它们推送到中央存储库。如您所见，git没有进行额外的验证来确保我确实是我所声称的用户。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lv"><img src="../Images/c0bb36e6ae4be1cefe4adb91223a91b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ISRHDnbcze20-mRQ11m6fA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">添加提交和推送</p></figure><p id="915b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，我返回到我的存储库的web UI，这是我的提交。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lw"><img src="../Images/b19a296751563ef42c1ded35de7cdf33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZCnXXPwnT1FVf227I73x2g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GitLab上可见假冒提交作者</p></figure><p id="dae4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如你所见，GitLab(或任何其他相关的存储库)甚至还额外添加了其他账户的图片，使得提交看起来更加合法。</p><p id="42ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这导致了两个严重的问题:</p><ul class=""><li id="7708" class="lx ly iq ky b kz la lc ld lf lz lj ma ln mb lr mc md me mf bi translated">用户可以“匿名”提交，这使得跟踪谁真正提交了(有时是恶意的)变更变得几乎不可能。</li><li id="c513" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">它让用户对他们的工作有了可信的否认。他们可能会声称犯下这一罪行的不是他们，谁又能说是他们干的呢？</li></ul><p id="9c71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个严重的问题，尤其是当存储库有多人在处理它的时候。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="fa1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也就是说，我们如何签署我们的提交，这到底意味着什么？</p><p id="76cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果不了解公钥加密的数学知识，当您发出commit命令时，您会保存更改以及对具体更改内容的简短描述。然后，您可以计算每封邮件的散列值，并用您的密钥对它们进行加密。如果有人看到您的加密签名并用您的公钥解密，并且哈希匹配，那么有两种可能:</p><ul class=""><li id="af42" class="lx ly iq ky b kz la lc ld lf lz lj ma ln mb lr mc md me mf bi translated">提交是由他们声称的人发出的，</li><li id="b070" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">用户的私钥被盗。</li></ul><p id="5f4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">显然，我们仍然不能确定这不是第二种选择，但是仅仅从某人的计算机中窃取密钥并不是一件容易的事情，尤其是如果你想要一个特定的人的密钥。</p><p id="d17e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简而言之，如果它是用有效的签名签署的，我们可以确定它是由他们声称的那个人发出的。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="6a76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然我们已经确定了为什么您应该始终为每个人设置一个策略来签署他们的提交，那么让我们看看您如何能够做到这一点。</p><p id="2f15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用免费的GNU隐私卫士GPG，它经常被用来加密、解密和签署信息，并被认为是这类任务的行业标准。</p><p id="8233" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您需要的工具:</p><ul class=""><li id="ee79" class="lx ly iq ky b kz la lc ld lf lz lj ma ln mb lr mc md me mf bi translated">本地安装的Git客户端</li><li id="d7b5" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">一个你用起来得心应手的终端软件(bash，Windows终端)</li><li id="d514" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">远程存储库帐户(例如:GitLab、GihHub、…)</li><li id="a8b9" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">软件包管理器(用于Linux或Windows的apt/winget)</li></ul><p id="973d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">解决这个问题后，按照以下步骤设置您的GPG和git环境。</p><h2 id="ad1b" class="ms mt iq bd mu mv mw dn mx my mz dp na lf nb nc nd lj ne nf ng ln nh ni nj nk bi translated"><strong class="ak"> 1。在你的系统上安装GPG</strong></h2><p id="e568" class="pw-post-body-paragraph kw kx iq ky b kz nl jr lb lc nm ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">Linux : <code class="fe nq nr ns nt b">sudo apt install -y gnupg</code></p><blockquote class="nu nv nw"><p id="fb5b" class="kw kx nx ky b kz la jr lb lc ld ju le ny lg lh li nz lk ll lm oa lo lp lq lr ij bi translated">视窗:<code class="fe nq nr ns nt b">winget install GnuPG.Gpg4Win</code></p></blockquote><h2 id="3067" class="ms mt iq bd mu mv mw dn mx my mz dp na lf nb nc nd lj ne nf ng ln nh ni nj nk bi translated"><strong class="ak"> 2。生成密钥对</strong></h2><pre class="kg kh ki kj gt ob nt oc od aw oe bi"><span id="02bd" class="ms mt iq nt b gy of og l oh oi">gpg --full-generate-key</span></pre><p id="ce0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">GPG会问你几个关于密钥性质的问题。我不会介绍所有的步骤，但是我建议(在2022年)使用一个4096位的RSA密钥，没有有效期，有一个强密码。此外，确保您的真实姓名和电子邮件地址值与您在远程存储库中使用的完全匹配。</p><h2 id="5985" class="ms mt iq bd mu mv mw dn mx my mz dp na lf nb nc nd lj ne nf ng ln nh ni nj nk bi translated"><strong class="ak"> 3。获取您的密钥ID </strong></h2><pre class="kg kh ki kj gt ob nt oc od aw oe bi"><span id="7089" class="ms mt iq nt b gy of og l oh oi">gpg --list-secret-keys --keyid-format=long</span></pre><p id="45dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个命令应该产生类似如下的输出:(当然不会相同，因为您的密钥与我的不同):</p><pre class="kg kh ki kj gt ob nt oc od aw oe bi"><span id="23ae" class="ms mt iq nt b gy of og l oh oi">gpg: checking the trustdb<br/>gpg: marginals needed: 3  completes needed: 1  trust model: pgp<br/>gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u<br/>/home/richard/.gnupg/pubring.kbx<br/>------------------------------<br/>sec   rsa4096/9CA6B5740A261A53 2022-04-27 [SC]<br/>      F84FEAA74A29DE3A029275529C66B1749A561A22<br/>uid                 [ultimate] Richard Antal Nagy (gitlab.com/richard-nagy) &lt;nagy.richard.antal@gmail.com&gt;<br/>ssb   rsa4096/9238CFF755296971 2022-04-27 [E]</span></pre><p id="aba2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在记下您在以<code class="fe nq nr ns nt b">sec</code>开头的行中找到的密钥ID，不包括您生成的密钥类型。我的情况是:<code class="fe nq nr ns nt b">9CA6B5740A261A53</code></p><h2 id="9525" class="ms mt iq bd mu mv mw dn mx my mz dp na lf nb nc nd lj ne nf ng ln nh ni nj nk bi translated"><strong class="ak"> 4。导出公钥</strong></h2><pre class="kg kh ki kj gt ob nt oc od aw oe bi"><span id="9275" class="ms mt iq nt b gy of og l oh oi">gpg --armor --export KEY_ID</span></pre><p id="c686" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用您的密钥ID替换<code class="fe nq nr ns nt b">KEY_ID</code>部分，并复制包括破折号在内的输出。进入您的存储库配置文件，并在帐户设置中添加此GPG键。在GitLab中，可以通过以下链接访问:<a class="ae kv" href="https://gitlab.com/-/profile/gpg_keys" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/-/profile/gpg_keys</a></p><p id="f14d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您在密钥中添加了过期日期，那么在您的个人资料中设置该日期也很有用。</p><p id="0133" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您已经添加了您的公钥，任何人都可以公开验证您的签名。我的公钥在以下链接中:</p><p id="1532" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://gitlab.com/richard-nagy.gpg" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/richard-nagy.gpg</a></p><p id="3ffd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是预期的行为，因此得名:“公钥”。任何人都可以看到。</p><h2 id="344c" class="ms mt iq bd mu mv mw dn mx my mz dp na lf nb nc nd lj ne nf ng ln nh ni nj nk bi translated"><strong class="ak"> 5。设置git签名</strong></h2><p id="d6f9" class="pw-post-body-paragraph kw kx iq ky b kz nl jr lb lc nm ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">最后，我们需要告诉我们的本地git客户端我们想要签署所有的提交。发出以下命令，但记住再次替换<code class="fe nq nr ns nt b">KEY_ID</code>。</p><pre class="kg kh ki kj gt ob nt oc od aw oe bi"><span id="2d26" class="ms mt iq nt b gy of og l oh oi">git config --global user.signingkey KEY_ID<br/>git config --global commit.gpgsign true</span></pre><p id="9429" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您使用的是Windows系统，有时git找不到gpg实用程序。如果您在提交后得到一个错误，说没有找到私钥，那么您需要在PowerShell中显式设置可执行文件路径:</p><pre class="kg kh ki kj gt ob nt oc od aw oe bi"><span id="4da8" class="ms mt iq nt b gy of og l oh oi">git config --global gpg.program "C:\Program Files (x86)\GnuPG\bin\gpg.exe"</span></pre><p id="6414" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果没有使用默认安装目录，请确保替换该路径。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="f020" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">至此，你大功告成！我建议建立一个快速测试存储库，并尝试发布一个签名的commit来检查一切工作是否正常。</p><p id="100c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您在您的私钥中添加了一个密码短语，您可能会发现如此频繁地写入您的密钥是很乏味的。为了给自己一些时间缓冲，只需在<code class="fe nq nr ns nt b">~/.gnupg/gpg-agent.conf</code>中添加以下几行即可</p><pre class="kg kh ki kj gt ob nt oc od aw oe bi"><span id="cf02" class="ms mt iq nt b gy of og l oh oi">default-cache-ttl 86400<br/>max-cache-ttl 86400</span></pre><p id="002e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将设置一个1天的时间窗口(以秒为单位),让您的gpg记住您的密码。如果给定的文件不存在，就自己创建。</p><p id="78dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果超时似乎不起作用，您可以重新启动系统或只重新启动GPG服务:</p><pre class="kg kh ki kj gt ob nt oc od aw oe bi"><span id="cbbf" class="ms mt iq nt b gy of og l oh oi">gpgconf --kill gpg-agent</span></pre></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="c91c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您阅读文章，希望您觉得有用！</p><p id="8f4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你有，请考虑<a class="ae kv" href="https://www.buymeacoffee.com/dubniczky" rel="noopener ugc nofollow" target="_blank">请我喝咖啡</a>，☕干杯！</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="5acd" class="oj mt iq bd mu ok ol om mx on oo op na jw oq jx nd jz or ka ng kc os kd nj ot bi translated">问题和答案</h1><h2 id="d137" class="ms mt iq bd mu mv mw dn mx my mz dp na lf nb nc nd lj ne nf ng ln nh ni nj nk bi translated">当我想迁移到新系统时，我可以运送密钥吗？</h2><p id="5b0e" class="pw-post-body-paragraph kw kx iq ky b kz nl jr lb lc nm ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">可以，但请确保不要将私钥上传到任何在线网站或服务。使用加密的笔驱动器或安全的通信通道。</p><p id="0d19" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">导出:<code class="fe nq nr ns nt b">gpg --export-secret-keys KEY_ID &gt; private.gpg</code></p><p id="2bf2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">进口:<code class="fe nq nr ns nt b">gpg --import private.gpg</code></p><h2 id="e822" class="ms mt iq bd mu mv mw dn mx my mz dp na lf nb nc nd lj ne nf ng ln nh ni nj nk bi translated">我可以在我不信任的系统上安装它吗？</h2><p id="df2a" class="pw-post-body-paragraph kw kx iq ky b kz nl jr lb lc nm ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">不。不要让任何系统访问你不管理和不信任的私钥。</p><h2 id="8ffe" class="ms mt iq bd mu mv mw dn mx my mz dp na lf nb nc nd lj ne nf ng ln nh ni nj nk bi translated">为什么这是安全的？</h2><p id="d260" class="pw-post-body-paragraph kw kx iq ky b kz nl jr lb lc nm ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">RSA利用素数<a class="ae kv" href="https://en.wikipedia.org/wiki/Integer_factorization" rel="noopener ugc nofollow" target="_blank">整数分解问题</a>，这意味着如果使用非量子方法在合理的时间内数字足够大，则无法使用加密数据和公钥(即使我们知道原始消息)来计算私钥。这些数字相当大。在开发时，您通常使用32或64位整数，您的密钥将使用4096位。</p></div></div>    
</body>
</html>