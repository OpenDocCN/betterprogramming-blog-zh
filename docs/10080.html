<html>
<head>
<title>Ditch These 7 Habits From Your Python Codebases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从你的Python代码库中抛弃这7个习惯</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ditch-these-7-habits-from-your-python-codebases-e38abe904d7b?source=collection_archive---------4-----------------------#2021-11-24">https://betterprogramming.pub/ditch-these-7-habits-from-your-python-codebases-e38abe904d7b?source=collection_archive---------4-----------------------#2021-11-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e8ad" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用代码示例打破Python中的坏习惯</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/47bededd9ae44f7d97d1191c32197504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yP2cMXGnXNmkEM87"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@kellysikkema?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Kelly Sikkema </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="290d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我犯了所有这些坏习惯。我花了一些时间来摆脱他们。</p><p id="5f7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python以其简单性和多功能性而闻名。作为最常用的编程语言之一，有很多很棒的教程。不幸的是，简单易学的语法有时会误导开发人员，尤其是那些语言新手。编写<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-write-clean-code-in-python-5d67746133f2">干净的Python代码</a>可能会很棘手。</p><p id="9137" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将深入探讨一些人们在刚开始学习Python时可能会犯的常见错误和坏习惯。这包括我希望有人早点告诉我的事情。</p><p id="3301" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">别担心，我不想用一堆文字来烦你。相反，你会得到易于理解的代码片段。</p><h2 id="dbb7" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">TL；速度三角形定位法(dead reckoning)</h2><p id="8896" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><strong class="lb iu">停止:</strong></p><ol class=""><li id="9903" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">使用<code class="fe nc nd ne nf b">open</code>和<code class="fe nc nd ne nf b">close</code>代替<code class="fe nc nd ne nf b">with</code></li><li id="e2e3" class="mt mu it lb b lc ng lf nh li ni lm nj lq nk lu my mz na nb bi translated">使用空列表作为默认参数</li><li id="13fe" class="mt mu it lb b lc ng lf nh li ni lm nj lq nk lu my mz na nb bi translated">避免列表理解</li><li id="3c50" class="mt mu it lb b lc ng lf nh li ni lm nj lq nk lu my mz na nb bi translated">滥用列表理解</li><li id="7557" class="mt mu it lb b lc ng lf nh li ni lm nj lq nk lu my mz na nb bi translated">使用裸异常</li><li id="578c" class="mt mu it lb b lc ng lf nh li ni lm nj lq nk lu my mz na nb bi translated">用错了<code class="fe nc nd ne nf b">==</code>和<code class="fe nc nd ne nf b">is</code></li><li id="0fea" class="mt mu it lb b lc ng lf nh li ni lm nj lq nk lu my mz na nb bi translated">使用<code class="fe nc nd ne nf b">import *</code></li></ol></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="6ee3" class="ns lw it bd lx nt nu nv ma nw nx ny md jz nz ka mg kc oa kd mj kf ob kg mm oc bi translated">1.使用<code class="fe nc nd ne nf b">open</code>和<code class="fe nc nd ne nf b">close</code>代替<code class="fe nc nd ne nf b">with</code>语句</h1><p id="df6d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">处理文件流可能是我们开始学习Python时最常做的事情。大多数教程会以下面的例子告诉我们打开和关闭文件开始:</p><pre class="kj kk kl km gt od nf oe of aw og bi"><span id="7120" class="lv lw it nf b gy oh oi l oj ok">f = open("stocks.txt", "r")<br/>data = f.read()<br/>f.close() # NOTE: Always remember to close!</span></pre><p id="230c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们经常会被提醒在使用完文件后关闭它，因为:</p><ul class=""><li id="b276" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu ol mz na nb bi translated">它消耗了我们有限的系统资源</li><li id="e858" class="mt mu it lb b lc ng lf nh li ni lm nj lq nk lu ol mz na nb bi translated">它阻止我们移动或删除文件</li></ul><p id="843a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，这里的最佳实践是在处理文件操作时总是使用Python中的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/everything-you-need-to-know-about-context-managers-in-python-f83556fbdfb">上下文管理器</a>(<code class="fe nc nd ne nf b">with</code>语句)。这里有一个例子:</p><pre class="kj kk kl km gt od nf oe of aw og bi"><span id="b9fb" class="lv lw it nf b gy oh oi l oj ok"><br/>with open("stocks.txt", "r"):<br/>    data = f.read()</span></pre><p id="94be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里使用上下文管理器也有助于我们在异常期间关闭文件。</p><p id="3d1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，你可能会说我们也可以在这里使用<code class="fe nc nd ne nf b">try-finally</code>方法来代替。尽管如此，<code class="fe nc nd ne nf b">with</code>语句将我们的代码简化为两行。</p><h1 id="66b2" class="ns lw it bd lx nt om nv ma nw on ny md jz oo ka mg kc op kd mj kf oq kg mm oc bi translated">2.使用空列表或字典作为默认参数</h1><p id="0ee7" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">对于Python新手来说，这可能是最令人困惑的问题之一。</p><p id="3bf7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我必须承认，这一点在我多年前刚开始学习Python时让我措手不及。我记得当我第一次接触到使用函数时缺省参数的奇妙之处时，我像不关任何人的事一样盲目地使用它。这里有一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="4a95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当一个函数被定义时，默认参数(如上面例子中的<code class="fe nc nd ne nf b">storage</code>)只被创建(即求值)一次<strong class="lb iu"/>。</p><p id="fbc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于Python中的列表是可变的，所以每次调用<code class="fe nc nd ne nf b">add_book</code>函数时，列表都会被修改。这里，相同的列表被反复使用，而不是创建新的列表。</p><h2 id="4421" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">你应该做什么</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="2828" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样的概念也适用于其他可变对象，例如Python中的dictionary。</p><h1 id="7dfd" class="ns lw it bd lx nt om nv ma nw on ny md jz oo ka mg kc op kd mj kf oq kg mm oc bi translated">3.不使用列表理解</h1><p id="ff21" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">列表理解无疑是Python中最显著的特性之一。毫无疑问，它有助于提高代码的可读性，并且通常被认为更加优雅和“<a class="ae ky" href="https://www.computerhope.com/jargon/p/pythonic.htm" rel="noopener ugc nofollow" target="_blank">python化</a>”。</p><p id="6c7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">话虽如此，新的Python开发人员可能很难充分利用这一特性，或者至少在开始时习惯于使用它。这里有一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">学会使用列表理解</p></figure><p id="a766" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你是Python的新手，放松一下，花点时间学习list comprehensions。我保证，这对你会有很大的帮助。</p><p id="44f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样的逻辑也适用于在Python中使用字典理解。</p><h1 id="8f04" class="ns lw it bd lx nt om nv ma nw on ny md jz oo ka mg kc op kd mj kf oq kg mm oc bi translated">4.滥用列表理解</h1><p id="4e91" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们明白了。列表理解是“pythonic式的”。然而，我也看到了很多列表理解被以各种形式滥用的例子。</p><p id="b1ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更糟糕的是，一些列表理解被编写到代码甚至不再可读的程度，违背了使用列表理解的最初目的。</p><p id="289b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个你不应该做的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">不要做这些</p></figure><p id="3631" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然列表理解更紧凑，运行更快，但我们应该避免编写长而复杂的列表理解(尤其是在一行中)，以确保代码的可读性。不要陷入理解列表的困境。</p><h1 id="f1d1" class="ns lw it bd lx nt om nv ma nw on ny md jz oo ka mg kc op kd mj kf oq kg mm oc bi translated">5.使用裸除</h1><p id="da59" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我对此感到内疚。很内疚。作为初学者，我不喜欢一些代码库如何显式地捕捉异常。当时，我觉得它们过于冗长和多余。我想我只是太懒了。</p><p id="6464" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个例子，展示了一个光秃秃的例外是什么样子的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">避免这样做</p></figure><p id="573e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，我们不应该使用bare，除非它捕获所有异常，包括一些不想要的异常，例如本例中的<code class="fe nc nd ne nf b">KeyboardInterrupt</code>,我们想要退出应用程序。</p><p id="92b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最重要的是，它使调试成为一场噩梦，因为它会导致我们的应用程序失败，而我们却不知道原因。所以，<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/stop-using-exceptions-like-this-in-python-2bd8ba7d8841">停止像这样使用异常</a>。</p><h1 id="822d" class="ns lw it bd lx nt om nv ma nw on ny md jz oo ka mg kc op kd mj kf oq kg mm oc bi translated">6.用错了<code class="fe nc nd ne nf b">==</code>和<code class="fe nc nd ne nf b">is</code></h1><p id="fc93" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">但这真的重要吗？我在野生Python代码里见过太多了。如果你不知道，他们是不同的。</p><ul class=""><li id="0ade" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu ol mz na nb bi translated"><code class="fe nc nd ne nf b">is</code>操作员检查这两个项目是否引用相同的对象(即出现在相同的存储位置)。<strong class="lb iu">又名参考</strong>等同性。</li><li id="55ee" class="mt mu it lb b lc ng lf nh li ni lm nj lq nk lu ol mz na nb bi translated"><code class="fe nc nd ne nf b">==</code>运算符检查值<strong class="lb iu"> </strong>是否相等。</li></ul><p id="4d38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个简单的例子来说明我的意思:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">记住，<code class="fe nc nd ne nf b">listA</code>和<code class="fe nc nd ne nf b">listB</code>是不同的对象</p></figure><p id="059b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里总结了使用<code class="fe nc nd ne nf b">is</code>和<code class="fe nc nd ne nf b">==</code>运算符的注意事项:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用if baz和if not baz</p></figure><h1 id="24ce" class="ns lw it bd lx nt om nv ma nw on ny md jz oo ka mg kc op kd mj kf oq kg mm oc bi translated">7.使用导入星号(星号)</h1><p id="5459" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">许多人会认为这是一种权宜之计。但这只是简单的懒惰。</p><p id="8aba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过使用<code class="fe nc nd ne nf b">import *</code>，您冒着污染当前名称空间的风险，因为它从库中导入了所有的函数和类。</p><p id="2ca8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“污染命名空间”是什么意思？通俗地说，这基本上意味着你用<code class="fe nc nd ne nf b">import *</code>导入的任何函数(或类)都可能与你定义的函数冲突。</p><p id="f1f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本上，你冒着覆盖变量或函数的风险，最终很难区分哪个函数是哪个函数。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="647c" class="ns lw it bd lx nt nu nv ma nw nx ny md jz nz ka mg kc oa kd mj kf ob kg mm oc bi translated">结束语</h1><p id="6c38" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Python是一种相对容易入门的编程语言。它提供了许多机制和范例，极大地提高了我们作为开发人员的生产力。</p><p id="3883" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">话虽如此，人们很容易养成用Python写糟糕代码的习惯。回想起来，这篇文章也提醒我(希望你也是)远离这些糟糕的Python编码习惯。</p><h2 id="48cd" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">下一步做什么</h2><p id="e46d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这篇文章中有太多的禁忌。</p><p id="3924" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一些你可以做的事情——开始使用像<a class="ae ky" href="https://pypi.org/project/autopep8/" rel="noopener ugc nofollow" target="_blank"> autopep8 </a>、<a class="ae ky" href="https://pypi.org/project/flake8/" rel="noopener ugc nofollow" target="_blank"> flake8 </a>和<a class="ae ky" href="https://pypi.org/project/pylint/" rel="noopener ugc nofollow" target="_blank"> pylint、</a>甚至<a class="ae ky" href="https://mypy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> mypy </a>这样的工具来保持你的代码质量处于最高标准。他们会通过帮助你对照像<a class="ae ky" href="https://www.python.org/dev/peps/pep-0008/" rel="noopener ugc nofollow" target="_blank"> PEP8 </a>等标准来检查你的代码，让你成为一个更好的开发者。</p><p id="802b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章中的提示对您有所帮助，并祝您编码愉快！你用什么工具来检查你的代码质量？</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt od nf oe of aw og bi"><span id="b4cb" class="lv lw it nf b gy oh oi l oj ok"><strong class="nf iu">Want to Connect With the Author?</strong></span><span id="2891" class="lv lw it nf b gy ot oi l oj ok">This article was originally published at <a class="ae ky" href="https://jerrynsh.com/ditch-these-7-habits-from-your-python/" rel="noopener ugc nofollow" target="_blank">jerrynsh.com</a></span></pre></div></div>    
</body>
</html>