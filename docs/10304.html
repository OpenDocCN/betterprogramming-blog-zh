<html>
<head>
<title>Designing Sequence Diagrams for API Orchestration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为API编排设计序列图</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/designing-sequence-diagrams-for-api-orchestration-113ac45e16df?source=collection_archive---------1-----------------------#2021-12-24">https://betterprogramming.pub/designing-sequence-diagrams-for-api-orchestration-113ac45e16df?source=collection_archive---------1-----------------------#2021-12-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="00cf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">知道当用户按下按钮时会发生什么</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3c925ffbc8ecf7258914597d74e11252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hcmJelVhi8Oj-hc0f_pIwg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3b21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">序列图有助于可视化当一个动作发生时会发生什么——比如当用户在你的应用程序上按下一个按钮。技术和业务团队通常使用它们来设计解决方案、了解新系统集成的需求和/或记录现有流程。</p><p id="eab3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然序列图可以应用于各种场景，但是在本文中，我们将讨论如何为API编排设计序列图。您需要熟悉API或应用程序接口，它们基本上使不同的应用程序能够通过交换请求和响应来相互通信。我已经写了一篇独立的博客，介绍如何阅读API文档。API编排是将这些独立的调用链接在一起以解决问题的行为。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="833a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">从用例开始</h1><p id="d2d6" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">你想解决什么问题？这是你在设计序列图时应该问的第一个问题。API编排从用例开始，然后是可用的API——而不是反过来。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/511f7c389c135612eaf8e338c4df1a41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bUDuCuPX7cVeeGLQ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae lu" href="https://unsplash.com/@blakewisz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布雷克·维斯</a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="7020" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设我们正在我们的移动应用程序中实施客户忠诚度计划。这是一个大项目，所以让我们将解决方案设计的范围缩小到一个用例中:<em class="na">用积分购买优惠券</em>。</p><p id="1fb3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然这是大多数客户忠诚度计划的一个基本特征，但实际上要实现这一功能还需要做很多事情。至少，这需要协调以下对象</p><ul class=""><li id="3dbb" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated">顾客</li><li id="cb1f" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">点</li><li id="a636" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">优惠券</li></ul><p id="6de2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了做到这一点，我们需要知道客户是谁，他们有多少积分，以及购买优惠券需要多少金额。但是如果他们没有足够的积分或者优惠券数量有限并且已经售完了怎么办？</p><p id="637f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一个序列图将是完美的。</p><h1 id="89e5" class="mc md it bd me mf np mh mi mj nq ml mm jz nr ka mo kc ns kd mq kf nt kg ms mt bi translated">工具</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/63265e002ab428c12859f8e9f7fb3cde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AQe3-WORC-lBZDLq"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Jo Szczepanska 在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b58c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">序列图与工具无关。这意味着您可以自由使用您喜欢的任何工具，因为内容遵循标准格式。如果我们在办公室，我个人喜欢在白板上写下解决方案设计；如果我在家，我喜欢在把想法传到网上之前，在记事本上画出草图。</p><p id="4252" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里有一些你可以使用的免费在线协作工具</p><ul class=""><li id="9ad5" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated">弥洛松</li><li id="90fd" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">Draw.io</li><li id="42e1" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">Google Draw</li></ul><h1 id="55d6" class="mc md it bd me mf np mh mi mj nq ml mm jz nr ka mo kc ns kd mq kf nt kg ms mt bi translated">设计</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/f784e323c08f66b9ad2544b5c905ac31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_3IDORHXNFWuXq9H"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安妮·尼加德在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="b341" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建序列图的基本构件包括单词、箭头和系统对象。就是这样！当然，我们可以添加更多的维度，但现在让我们保持简单。</p><p id="ddd3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">回到我们的移动应用程序客户用积分购买优惠券的用例，让我们写下这个活动从开始到结束的典型流程。</p><pre class="kj kk kl km gt nv nw nx ny aw nz bi"><span id="bc08" class="oa md it nw b gy ob oc l od oe">1. Customer sign in to mobile app<br/>2. Home screen<br/>3. View coupon<br/>4. Buy coupon with points</span></pre><p id="1660" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然看起来很简单，但实际上幕后发生了很多事情，每一步都有自己的序列图。然而，出于本文的目的，让我们放大到步骤4)用积分购买优惠券。</p><p id="6d18" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们用序列图来探索这个用例。对于这个示例场景，我们将引用以下系统</p><ol class=""><li id="9a50" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt of nh ni nj bi translated">移动应用程序</li><li id="0ed9" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt of nh ni nj bi translated">中间件</li><li id="8ce4" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt of nh ni nj bi translated">客户忠诚度应用程序</li></ol><p id="375b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">移动应用是客户接触点，中间件是通常用于API编排的软件，客户忠诚度应用是我们正在集成的新平台。</p><p id="7694" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于客户忠诚度应用程序，我们有以下用于购买优惠券的API:</p><pre class="kj kk kl km gt nv nw nx ny aw nz bi"><span id="acc5" class="oa md it nw b gy ob oc l od oe">POST coupon/purchase (required: customer_id, coupon_id)</span></pre><p id="8f03" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe og oh oi nw b">Customer_id</code>和<code class="fe og oh oi nw b">coupon_id</code>是必需的，因为客户忠诚度应用程序需要知道谁在购买什么优惠券。</p><h1 id="c642" class="mc md it bd me mf np mh mi mj nq ml mm jz nr ka mo kc ns kd mq kf nt kg ms mt bi translated">如何阅读序列图</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/0e1a74da2eefdebffae6021925f3db64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PzyJ92SHPYhXVDVl6jc_fg.png"/></div></div></figure><p id="62ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">顾名思义，序列图遵循一个序列——或者相关事件相互遵循的特定顺序。</p><p id="390d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了阅读这个序列图，我们从左到右，从上到下开始。</p><p id="d715" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从顶部开始，我们有不同的系统。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/5453d0ce8c10972b314dcfc64069dbdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lybfx4DaGkmcWhSc0zQ5Jg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">系统</p></figure><p id="fcd3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">实线箭头表示从一个系统向另一个系统发出的请求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/083d011b5a576b8d9532c560299ea7cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*Iup4G4vYGqaIzCRhjsKOtg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">请求</p></figure><p id="638d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虚线箭头是从接收者到请求者的响应。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/be0953008cbd1ac7066293e78a28300a.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*65fdgrKChsajbJxQUXO4dw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">反应</p></figure><h2 id="1be8" class="oa md it bd me on oo dn mi op oq dp mm lh or os mo ll ot ou mq lp ov ow ms ox bi translated">把它放在一起</h2><pre class="kj kk kl km gt nv nw nx ny aw nz bi"><span id="9735" class="oa md it nw b gy ob oc l od oe">1. User clicks purchase coupon in Mobile<br/>2. Request sent to Middleware<br/>3. Middleware sends POST coupon/purchase to Customer Loyalty<br/>4. Customer Loyalty App returns success to Middleware<br/>5. Middleware returns success to Mobile</span></pre><p id="3051" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个令人高兴的案例，客户有足够的积分来购买仍在供应的优惠券，因此结果是他们的数字钱包中有一个新的优惠。但是，如果在购买过程中出现问题，如积分不足或优惠券库存不足，会发生什么情况呢？我们如何处理这些情况？</p><p id="5505" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">幸运的是<code class="fe og oh oi nw b">POST coupon/purchase</code>有内部验证，检查客户和优惠券是否存在，还有多少优惠券，以及客户是否有足够的积分购买它。如果这些验证中的任何一个失败，那么API将返回一个错误，发出请求的调用者或系统可以处理这个错误。</p><p id="5430" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是使用API的好处。</p><p id="784d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">大部分工作是在客户忠诚度应用程序中完成的，它被抽象成一个<em class="na">T2 API调用。打电话的人不在乎工作如何完成，只要能完成就行。接收方负责监听请求、处理请求并给出适当的响应。</em></p><h1 id="98fe" class="mc md it bd me mf np mh mi mj nq ml mm jz nr ka mo kc ns kd mq kf nt kg ms mt bi translated">交替流动</h1><p id="3896" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">让我们看看使用另一个流程的序列图中的错误处理会是什么样子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/d3ae8875236c4b8d8a0198910667cf03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FsI_Dxw5Dy9AoK_lr9ttiQ.png"/></div></div></figure><p id="49a0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们添加了两个额外的框来突出显示成功和错误的不同请求-响应场景。我们已经介绍了成功，所以让我们来看看错误响应。这用HTTP状态代码表示，后跟错误描述。</p><ul class=""><li id="6d5e" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated">404找不到客户</li><li id="99c5" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">404找不到优惠券</li><li id="d9a1" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">400分不够</li><li id="6697" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">400优惠券缺货</li></ul><p id="d604" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果响应成功，那么它将遵循成功路线。但是，如果响应有错误，那么它将遵循错误路线。在这两种情况下，移动应用程序都可以处理响应并向客户显示适当的消息。</p><p id="4576" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！</p><h1 id="15c2" class="mc md it bd me mf np mh mi mj nq ml mm jz nr ka mo kc ns kd mq kf nt kg ms mt bi translated">结论</h1><p id="12a1" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">序列图可以用来设计、分析和理解不同的工作流和系统集成。我们今天使用的例子是一个简单的用例，用来介绍这个概念。你可以用序列图做更多的事情，以及我们没有提到的更高级的构建模块，比如异步请求、递归、循环等等。</p><p id="5654" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于那些寻找实践活动的人来说，可以考虑在客户忠诚度应用程序中为<code class="fe og oh oi nw b">POST coupon/purchase</code>背后的业务逻辑创建一个序列图。</p><p id="3b0b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">快乐解决！</p></div></div>    
</body>
</html>