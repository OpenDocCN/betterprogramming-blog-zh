<html>
<head>
<title>Build a Simple Blockchain in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Node.js中构建一个简单的区块链</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-simple-blockchain-in-node-js-3d24c6de5f99?source=collection_archive---------5-----------------------#2019-12-30">https://betterprogramming.pub/build-a-simple-blockchain-in-node-js-3d24c6de5f99?source=collection_archive---------5-----------------------#2019-12-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="06a2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用这个简单的实现来理解通用区块链的概念</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b5e6a787dfc9212de5f1e6a40da88451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*StF_l7oFXwcnqM2t0ySqXQ.png"/></div></div></figure><p id="89e0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">区块链只是一个块链，是记录的集合，每个记录都与其他块相链接。块是存储在数据库中的数字信息。我们也可以说区块链本身就是一个数据库。</p><p id="c118" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">块可以存储以下信息:</p><ul class=""><li id="875a" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">交易记录。</li><li id="8b28" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">交易的参与者。</li><li id="39aa" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">一个索引或其他东西来区别于其他记录。</li></ul><p id="3a92" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我们将使用Node.js实现一个小型区块链。在我们的区块链中，块将包含以下内容:</p><ul class=""><li id="7b18" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">索引</li><li id="f04d" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">时间戳</li><li id="ce93" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">数据</li><li id="3ff7" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">以前的哈希</li><li id="5795" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">块散列</li></ul><p id="4e70" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">并且每个块将使用该块的散列与另一个块连接。块将受到密码术的保护。</p><p id="5dbb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们还将查看我们是否更改了任何数据块的信息，然后我们可以检测到发生了更改的数据块。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="b4a7" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated"><strong class="ak">让我们开始编码</strong></h1><p id="8538" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">创建一个名为<code class="fe ni nj nk nl b">blockchain</code>的目录，在这个文件夹中，创建一个名为<code class="fe ni nj nk nl b">package.json</code>的文件，并添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="9759" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，转到终端中的<code class="fe ni nj nk nl b">package.json</code>位置，运行<code class="fe ni nj nk nl b">npm install</code>，它将安装这个实现的依赖项:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/8656af78fb935c27a603f27b102592e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ozkC6N9Q7F3d_LYTeH6sow.png"/></div></div><p class="np nq gj gh gi nr ns bd b be z dk translated">快照:npm安装</p></figure><p id="c2c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，在同一个目录下创建另一个文件<code class="fe ni nj nk nl b">main.js</code>，并粘贴以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="5d8f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们来理解上面的代码(<code class="fe ni nj nk nl b">main.js</code>):</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="4bea" class="nx mm it nl b gy ny nz l oa ob">const crypto = require('crypto');</span></pre><p id="8e52" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面一行是将crypto模块导入到我们的应用程序中来加密数据。</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="3bd5" class="nx mm it nl b gy ny nz l oa ob">class Block { }</span></pre><p id="acf7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码将创建一个名为<code class="fe ni nj nk nl b">Block</code>的类。</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="fc8d" class="nx mm it nl b gy ny nz l oa ob">constructor(index, data, prevHash) {                                 this.index = index;                              <br/>this.timestamp = Math.floor(Date.now() / 1000);                              this.data = data;                              <br/>this.prevHash = prevHash;                              this.hash=this.getHash();                          <br/>}</span></pre><p id="08c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码决定了块包含的内容，这意味着我们的块将包含我们在构造函数中决定的内容。</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="ead8" class="nx mm it nl b gy ny nz l oa ob">getHash() {                              <br/>var encript=JSON.stringify(this.data) + this.prevHash + this.index + this.timestamp;                              <br/>var hash=crypto.createHmac('sha256', "secret")                              .update(encript)                              <br/>.digest('hex');                              <br/>// return sha(JSON.stringify(this.data) + this.prevHash + this.index + this.timestamp);                              <br/>return hash;                          <br/>}</span></pre><p id="6bc5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的函数将返回数据的散列，它将加密所有的数据。<br/>以上函数将使用SHA256算法进行加密。</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="3b12" class="nx mm it nl b gy ny nz l oa ob">class BlockChain { }</span></pre><p id="e6a4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上述代码将所有的区块链，实际的区块链。</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="f5b0" class="nx mm it nl b gy ny nz l oa ob">constructor() {                              <br/>this.chain = [];                          <br/>}</span></pre><p id="4474" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的构造函数将创建一个链，我们将在其中保存所有的块。</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="6a2a" class="nx mm it nl b gy ny nz l oa ob">addBlock(data) {                              <br/>let index = this.chain.length;                              <br/>let prevHash = this.chain.length !== 0 ? this.chain[this.chain.length - 1].hash : 0;                              let block = new Block(index, data, prevHash);                              this.chain.push(block);                          <br/>}</span></pre><p id="7a59" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码将创建一个新的块，并将其添加到链中。</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="fceb" class="nx mm it nl b gy ny nz l oa ob">chainIsValid(){                                  <br/>for(var i=0;i&lt;this.chain.length;i++){                                      if(this.chain[i].hash !== this.chain[i].getHash())                                          return false;                                      <br/>if(i &gt; 0 &amp;&amp; this.chain[i].prevHash !== this.chain[i-1].hash)                                          return false;                                  <br/>}                                  <br/>return true;                              <br/>}</span></pre><p id="4089" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码将检测块的有效性。</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="0fee" class="nx mm it nl b gy ny nz l oa ob">const BCoin = new BlockChain();</span></pre><p id="f5c7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的行将创建一个<code class="fe ni nj nk nl b">BlockChain</code>的对象。</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="0861" class="nx mm it nl b gy ny nz l oa ob">BChain.addBlock({sender: "Bruce wayne", reciver: "Tony stark", amount: 100});</span></pre><p id="8796" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码将使用给定的数据创建一个块。</p><p id="24d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在是时候使用下面的命令运行文件<code class="fe ni nj nk nl b">main.js</code> <strong class="kw iu"> </strong>了:</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="c52e" class="nx mm it nl b gy ny nz l oa ob">node main.js</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/8a77b79b5200125f628161cf425dc3c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J82bY8yrLHAQ9eEFAakjvg.png"/></div></div><p class="np nq gj gh gi nr ns bd b be z dk translated">输出:main.js</p></figure><p id="8d5d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的快照中，你可以看到这个区块链的有效性是真实的。<br/>表示上述块是正确的，数据是正确的，没有被改动。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/e676c2c058f1744bec22ce6e8c105ffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*Ig_wQxtvQhTHYm_PE37Bzg.png"/></div></figure><p id="5f26" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们做一些修改。我将更改块0，将名称“Bruce wayne”更改为“Joker”。</p><p id="6923" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为此，将以下代码添加到文件<code class="fe ni nj nk nl b">main.js</code>的最后一行。</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="4eea" class="nx mm it nl b gy ny nz l oa ob">BChain.chain[0].data.receiver = "Joker";</span><span id="d9af" class="nx mm it nl b gy oe nz l oa ob">console.log("******** Validity of this blockchain: ", BChain.chainIsValid());</span></pre><p id="8a9b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">并使用以下命令运行<strong class="kw iu"> </strong> <code class="fe ni nj nk nl b">main.js</code>文件:</p><pre class="kj kk kl km gt nt nl nu nv aw nw bi"><span id="5c22" class="nx mm it nl b gy ny nz l oa ob">node main.js</span></pre><p id="b516" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在你可以看到有效性:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/72e3d1933cf51bed16abfb650b831bfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*2tD0qPJyFiIU3WIjannMuw.png"/></div></figure><p id="1f17" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是假的，它表明有人改变了我们链中的数据，我们已经发现了这一点。</p><p id="a0ff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">恭喜你，现在你对基本区块链是如何工作的有了更好的了解。</p><p id="4a6a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:尽管这篇文章使用了一些基本的加密技术，但是本文中的概念并没有展示一个真正安全的区块链。</p><p id="9a18" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读。</p></div></div>    
</body>
</html>