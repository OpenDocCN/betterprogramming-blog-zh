<html>
<head>
<title>Success With Step Functions — Finding a Way To Build That Doesn’t Suck</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阶跃函数的成功——找到一种不糟糕的构建方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/success-with-step-functions-finding-a-way-to-build-that-doesnt-suck-6d8ed9b0154e?source=collection_archive---------9-----------------------#2022-09-21">https://betterprogramming.pub/success-with-step-functions-finding-a-way-to-build-that-doesnt-suck-6d8ed9b0154e?source=collection_archive---------9-----------------------#2022-09-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6caa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">任何使用过阶跃函数的人都会告诉你，DX还有待改进，但我们仍然可以让它工作</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9db4c913f725e47c046af7fb9025629c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R4U1EfRLZlp_6y7eCj7MYQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由Freepik上的<a class="ae ky" href="https://www.freepik.com/free-photo/workman-with-his-arms-crossed-white-background_1197358.htm#query=construction%20worker&amp;position=34&amp;from_view=search" rel="noopener ugc nofollow" target="_blank"> luis_molinero </a>提供</p></figure><p id="22cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我提倡在AWS中构建工作流时使用step函数。我真的觉得它是一个强大的服务，可以比Lambda更好地处理许多用例。</p><p id="d1e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几个月来，我一直认为我和无服务器社区的开发人员有共同的观点。直到我在推特上偶然发现了这个:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="ed8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不用说，我有点吃惊。</p><p id="ce6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那条推特上的评论表明，他不是唯一有这种想法的人。人们似乎越来越少谈论它，试图找到其他解决方案，或者干脆完全停止使用它。</p><p id="694e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个我根本不理解的趋势。我经常听到关于糟糕的开发者体验、成本太高以及更多关于糟糕的开发者体验的谈论，但是我认为人们正在解决这个问题。</p><p id="0857" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有。</p><p id="4b38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不否认一些“不太理想”的特性让开发者很难使用。然而，当我们等待一个更加集成的DX时，支持它的功能，如<a class="ae ky" href="https://aws.amazon.com/blogs/developer/handling-errors-retries-and-adding-alerting-to-step-function-state-machine-executions/" rel="noopener ugc nofollow" target="_blank">自动回退/重试</a>和<a class="ae ky" href="https://docs.aws.amazon.com/step-functions/latest/dg/supported-services-awssdk.html" rel="noopener ugc nofollow" target="_blank"> AWS SDK服务集成</a>，似乎非常值得。</p><p id="9d04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天我将讲述我是如何使用阶跃函数的，这样我们就能明白为什么我仍然试图更多地使用它们而较少地使用Lambda函数。</p><h1 id="6dc0" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">新状态机</h1><p id="8027" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">当我有一个需要新状态机的项目时，我从<a class="ae ky" href="https://docs.aws.amazon.com/step-functions/latest/dg/workflow-studio.html" rel="noopener ugc nofollow" target="_blank">工作流工作室</a>开始。Workflow Studio是AWS控制台中托管的用于Step功能的可视化构建器。很多开发者在这一步就已经开始抱怨了。</p><p id="e0bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管Workflow Studio的体验令人愉快，但事实上它并没有像Visual Studio代码那样集成到IDE中，这对许多人来说是一个不利因素。我不会否认这一点，但在我日常工作中为其他事情所做的所有变通办法中，我会很乐意登录控制台并在构建状态机时使用这个工具。</p><h2 id="202f" class="mu ly it bd lz mv mw dn md mx my dp mh li mz na mj lm nb nc ml lq nd ne mn nf bi translated">构建骨架</h2><p id="037a" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">构建器允许我在屏幕上拖放状态，这样我就可以直观地看到我的数据的工作流。我在过滤器中搜索我想要使用的SDK集成，比如DynamoDB GetItem调用，并将其移动到工作流中的适当位置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/407a896d7cac26cc3b295eaf6c6c211e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bdjuriGxcrypWXUy.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nh">在Workflow Studio中找到正确的SDK调用</em></p></figure><p id="d448" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我构建工作流时，我将确保为每个状态命名，以便将来适当地维护。如果我在美国保留默认名称，其他开发人员会发现不可能弄清楚工作流在做什么。</p><p id="56eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的框架构建阶段，我们只关注数据流。哪些部分将按什么顺序处理数据。换句话说，“这个发生，然后那个发生，然后这些事情同时发生。”这一阶段的重点是看到你的工作流程用图形表示。</p><p id="972f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看到它在你面前有助于加强你的概念设计，并暴露出你在最初的想法中可能存在的任何问题。</p><p id="2e35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你设计好了，并解决了最初的问题，是时候让它真正发挥作用了。</p><h2 id="8670" class="mu ly it bd lz mv mw dn md mx my dp mh li mz na mj lm nb nc ml lq nd ne mn nf bi translated">装上电线</h2><p id="9f8c" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">既然您已经知道了数据将如何移动，那么是时候考虑数据本身了。当您从一个州迁移到另一个州时，需要哪些数据？</p><h2 id="f641" class="mu ly it bd lz mv mw dn md mx my dp mh li mz na mj lm nb nc ml lq nd ne mn nf bi translated">SDK数据</h2><p id="4a30" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">当调用SDK集成时，您如何知道要包括哪些数据？这有时会让人有点困惑，而且肯定会降低用户体验。一旦您将所需的集成拖到设计器中，就要由您来阅读API文档以确定可用的字段。</p><p id="abf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Workflow Studio尽最大努力在默认情况下包含SDK集成所需的字段。但是调用通常不仅仅是必填字段。</p><p id="e6b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我过去对此有过疑问。我会阅读API调用的文档，尝试使用一个字段，然后当我保存时，我会得到一个错误。</p><p id="4fa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为step函数使用<a class="ae ky" href="https://sdk.amazonaws.com/java/api/latest/" rel="noopener ugc nofollow" target="_blank"> Java SDK </a>进行集成。</p><p id="3b41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大写和可用字段必须与它们在SDK中的定义相匹配。当我遇到问题时，那是因为我使用JavaScript SDK作为参考点，它在大小写上有微小的变化。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/5b8afe2aff3705a71c9289c016259c2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gzLt0sso_SlZG2dn.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="nh">Workflow Studio中的SDK集成提示</em></p></figure><p id="8144" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Workflow Studio描述了您选择的SDK集成和一个指向API文档的链接，作为启动点。由您决定将您所阅读的内容合并到您的状态机中。再说一次，这是一次不连贯的经历，但它会尽力帮助你。</p><h2 id="d2ff" class="mu ly it bd lz mv mw dn md mx my dp mh li mz na mj lm nb nc ml lq nd ne mn nf bi translated">状态数据</h2><p id="3261" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">在我关于<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/3-reasons-you-should-stay-away-from-aws-step-functions-43bdd97b75a">阶跃函数的陷阱</a>的文章中，我谈到了状态机可以从一个状态转移到另一个状态的最大数据量。这意味着在工作流运行时，您必须有意识地努力保持较小的状态数据量。</p><blockquote class="nj"><p id="993a" class="nk nl it bd nm nn no np nq nr ns lu dk translated">一般来说，在状态转换中只保留最少量的数据。</p></blockquote><p id="af48" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">每个SDK集成都将返回一个响应。您必须决定是丢弃该响应，保留全部还是保留一部分。可以熟悉一下<code class="fe ny nz oa ob b"><a class="ae ky" href="https://docs.aws.amazon.com/step-functions/latest/dg/input-output-inputpath-params.html#input-output-resultselector" rel="noopener ugc nofollow" target="_blank">ResultSelector</a></code>、<code class="fe ny nz oa ob b"><a class="ae ky" href="https://docs.aws.amazon.com/step-functions/latest/dg/input-output-resultpath.html" rel="noopener ugc nofollow" target="_blank">ResultPath</a></code>、<code class="fe ny nz oa ob b"><a class="ae ky" href="https://docs.aws.amazon.com/step-functions/latest/dg/input-output-outputpath.html" rel="noopener ugc nofollow" target="_blank">OutputPath</a></code>。</p><p id="0f47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些处理组件允许您有选择地从任务结果中选择片段，并将它们添加到数据对象中，以传递到下一个状态。如果丢失了部分原始状态机输入，也不用担心。如果您在下游状态需要它，您可以在任何时候通过<a class="ae ky" href="https://docs.aws.amazon.com/step-functions/latest/dg/input-output-contextobject.html" rel="noopener ugc nofollow" target="_blank">上下文变量</a>访问它。</p><p id="2de7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您的状态机有以下输入:</p><pre class="kj kk kl km gt oc ob od oe aw of bi"><span id="6f7d" class="mu ly it ob b gy og oh l oi oj">{ <br/>  "customerName": "Allen Helton", <br/>  "email": "allenheltondev@gmail.com", <br/>  "order": [ <br/>    { <br/>      "id": "k9231af824j", <br/>      "quantity": 1 <br/>    } <br/>  ] <br/>}</span></pre><p id="25f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在工作流结束时，如果我希望向用户发送一封确认订单的电子邮件，那么状态数据中当前的内容并不重要。我总是可以通过路径<code class="fe ny nz oa ob b">$$.Execution.Input.email</code>访问电子邮件地址。</p><blockquote class="nj"><p id="3a95" class="nk nl it bd nm nn no np nq nr ns lu dk translated">构建阶跃函数工作流时，管理状态数据是最重要的设计考虑因素之一。</p></blockquote><p id="3daa" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">通过管理状态数据，您不仅避免了由于溢出而导致的不必要的失败执行，而且还提高了工作流的可读性和可维护性。从工作流中删除不必要的数据将使开发人员在出现问题时更容易排除故障。</p><h2 id="8f53" class="mu ly it bd lz mv mw dn md mx my dp mh li mz na mj lm nb nc ml lq nd ne mn nf bi translated">测试一下</h2><p id="af69" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">与我们编写的所有代码一样，我们需要在将状态机部署到生产环境之前对其进行测试。直接在控制台中设计的好处是，您可以立即运行您的实际工作流程来解决问题。</p><p id="8f85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以点击Start Execution按钮，传入您期望的输入，并观察流程。使用标准工作流，您可以看到状态数据如何在状态之间形成，并轻松查看工作流的路径。</p><p id="c392" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您使用快速工作流，如果您想查看可视化数据，您必须再次使用不同的工具。与显示漂亮执行效果图的标准工作流相比，Express工作流仅在CloudWatch中记录日志。</p><p id="4cc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你像我一样，在第一次运行它的时候有很多问题，那没关系！</p><p id="f582" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，欢迎来到俱乐部。第二，如果您的问题是由管理状态数据引起的(正如我经常遇到的那样)，您可以使用<a class="ae ky" href="https://aws.amazon.com/about-aws/whats-new/2021/04/aws-step-functions-adds-new-data-flow-simulator-for-modelling-input-and-output-processing/" rel="noopener ugc nofollow" target="_blank">数据流模拟器</a>，它将向您展示在任何给定状态下，数据在转换的每个阶段看起来是什么样子。这使得调试和数据配对变得容易，从而获得我们前面提到的最小状态大小。</p><p id="17cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您对测试感到满意，就该为源代码控制准备工作流了。</p><h2 id="f56c" class="mu ly it bd lz mv mw dn md mx my dp mh li mz na mj lm nb nc ml lq nd ne mn nf bi translated">参数化工作流</h2><p id="4ec5" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">每次我和别人谈论step函数时，我都会听到某种形式的“我讨厌操纵状态机JSON。”老实说，这是出于合理的考虑——直接在JSON之外管理状态机可能是一项艰巨的任务，尤其是对于较大的工作流。</p><p id="422e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Workflow Studio允许您将定义导出为JSON或YAML，但是导出没有任何参数化的值。它直接硬编码对资源的引用，当您将基础结构用作代码(IaC)时，这并不理想。</p><p id="ff67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们总是将IaC作为最佳实践来推广，所以总是直接在AWS控制台中构建并不是一个选项。我们必须获取工作流定义，将其参数化以部署到任何AWS帐户、区域或分区中，并将其置于源代码控制中。</p><p id="51a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果手动操作，这部分可能需要相当长的时间。所以我写了一个脚本来做这件事。</p><p id="d0de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://gist.github.com/allenheltondev/06fbf25294c3543d8e56fcfa694efb70" rel="noopener ugc nofollow" target="_blank">这个要点</a>中，我有一个获取原始状态机定义文件并参数化所有适当的<code class="fe ny nz oa ob b">Resource</code>标签的脚本。对于可能包含在您的堆栈中的资源，还需要尽最大努力猜测SDK集成中包含的参数化值。</p><p id="6266" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它接受替换的值并创建一个状态机的<a class="ae ky" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-statemachine.html" rel="noopener ugc nofollow" target="_blank"> SAM定义</a>,该状态机具有IAM权限的最佳猜测。</p><p id="64b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该脚本输出SAM定义和更新后的图JSON，以便您尽可能少地修改后直接放入堆栈中。</p><p id="3b36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从这里开始，我们结束了！这是使用step函数创建新工作流定义的端到端过程。</p><h1 id="31cc" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">现有状态机</h1><p id="6066" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">我已经多次提到在设计工作流时要考虑可维护性。您的状态机的最初开发只是其生命的开始。在你的工作之上会有一些错误(不管我们承认与否)和改进。</p><blockquote class="nj"><p id="27ae" class="nk nl it bd nm nn no np nq nr ns lu dk translated">维护和增强将是你的状态机生命中的大部分。或者你的任何代码。</p></blockquote><p id="ac12" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">幸运的是，我们已经完成了大部分维护工作。</p><h2 id="1be0" class="mu ly it bd lz mv mw dn md mx my dp mh li mz na mj lm nb nc ml lq nd ne mn nf bi translated">从workflow studio开始</h2><p id="91a2" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">当增强现有的状态机时，从AWS控制台开始。这些过程的目的是让你尽可能远离状态机JSON。</p><p id="6f31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从AWS控制台中，选择现有的状态机。打开Workflow Studio，开始进行改进。</p><p id="50f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你改变时，记得向前支付。我们最初用直观的状态名构建了状态机。当我们在它的基础上构建时，继续包含有意义的州名。没有人想进入一个工作流程并试图弄清楚<code class="fe ny nz oa ob b">Pass (8)</code>做什么。</p><p id="6c25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这应该是不用说的，但我还是要说。不要在生产中直接编辑状态机！</p><p id="251b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为状态机已经被适当地连接起来，所以我跳过了框架步骤。当修改现有工作流时，我将适当的数据传递给SDK调用，并在添加新状态时调整输出<em class="ok">。因为我已经知道了进入状态的数据的形状，所以很容易获取和使用已经存在的数据。</em></p><p id="923a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像构建新的状态机时一样，您需要测试这些变化。修改现有状态机的好处包括使用来自实际执行的输入来运行测试。</p><p id="5621" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您转到控制台中的执行历史页面，您可以单击任何执行并获取输入。使用输入运行带有您的修改的测试。</p><p id="722f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ok">警告—如果您的状态机输入包含PII或其他敏感信息，请在使用之前运行的输入时保持谨慎。</em></p><h2 id="e9f6" class="mu ly it bd lz mv mw dn md mx my dp mh li mz na mj lm nb nc ml lq nd ne mn nf bi translated">导出并替换定义</h2><p id="1144" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">使用AWS控制台的导出功能来获取新的定义文件。像前面一样运行脚本，以参数化定义文件并创建SAM定义。</p><p id="f700" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以用新生成的组件替换存储库中的这两个部分。如果对原始脚本进行了任何手动更改，您将需要再次进行这些更改，或者更新脚本以反映您所做的更改。</p><p id="f01a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当您创建一个pull请求时，希望diff将只显示更新和新状态的JSON。这使得它成为一个更容易管理的任务。</p><h1 id="5921" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">其他考虑</h1><p id="c5a2" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">有一种观点认为阶跃函数在生产中使用太过昂贵。嗯，这取决于你如何使用它。我研究了λvs阶跃函数的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/lambda-vs-step-functions-the-battle-of-cost-and-performance-5f008045e2ab">成本和性能，结果令人惊讶。</a></p><p id="8ee7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">说到快递工作流程，成本可以忽略不计。通常成本更低，因为在使用直接SDK集成时，阶跃函数比Lambda执行得更快。</p><p id="d4d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在标准工作流程中，价格取决于状态转换。如果您有每月运行数百万次的大型工作流，是的，这将是昂贵的。但是考虑一下权衡。不用管理庞大的Lambda函数或容器图像来编排任务，您可以导航到step functions控制台来查看复杂操作中发生了什么。</p><p id="3f62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当谈到企业生产软件并在应用程序的整个生命周期中维护它时，总拥有成本(TCO)就开始起作用了。能够直接跳到问题上，而不是花几个小时去调试它们，这是非常宝贵的。</p><p id="f335" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，阶跃函数并不是灵丹妙药。他们不能解决你所有的问题。有时候Lambda函数更适合给定的场景。例如，如果在一个给定的任务中只有一两个动作需要执行，那么这可能是Lambda函数的一个更好的用例。</p><p id="4157" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当构建某个东西时，我的一般规则是，如果有三个或更多的SDK调用，就把它移到step函数中。从长远来看，它会带来更好、更可靠的产品。</p><h1 id="142a" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">摘要</h1><p id="d402" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">我同意step functions服务的开发者体验是不连贯的。但是，我们有变通方法和流程，使它成为一种在生产中使用的合理服务。</p><p id="ac58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和所有云服务一样，step功能会继续变好。他们将继续发布更好的特性和集成更好的工具。这项服务非常复杂，可以归结为一个令人印象深刻的抽象层次。随着服务团队更好地了解出现的问题以及社区提供一致的反馈，情况会有所改善。</p><blockquote class="nj"><p id="6e3b" class="nk nl it bd nm nn no np nq nr ns lu dk translated">不要混淆复杂和不熟悉。</p></blockquote><p id="f431" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">我看到许多关于将step函数与VTL挂钩的噩梦的评论。我同意，那不是一件容易的任务。但这是一个已经解决的问题。你可以<a class="ae ky" href="https://github.com/allenheltondev/serverless-idempotency-momento/blob/main/openapi.yaml#L243" rel="noopener ugc nofollow" target="_blank">在</a>上找到参考资料，这样你会更加适应。</p><p id="83fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些都需要练习。给它一个机会，你可以找到长期的成功。别光说不练。使用它。这就是我所做的；它很快成为我最喜欢的AWS服务。</p><p id="ab8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p></div></div>    
</body>
</html>