<html>
<head>
<title>Analyzing Pak’s ‘Merge’ Smart Contract</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分析巴基斯坦的“合并”智能合同</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/analyzing-paks-merge-smart-contract-7e437b66077c?source=collection_archive---------6-----------------------#2022-03-11">https://betterprogramming.pub/analyzing-paks-merge-smart-contract-7e437b66077c?source=collection_archive---------6-----------------------#2022-03-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1bf4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">解码智能合同— 03</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ec7cded00a9288483edb1439dc479955.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ejleYy9nTo_XD4JG0Zra3Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">封面图片。</p></figure><p id="c95c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://niftygateway.com/collections/pakmerge" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> The Merge </strong> </a>是一个由匿名艺术家<a class="ae lr" href="https://twitter.com/muratpak" rel="noopener ugc nofollow" target="_blank"> Pak </a>创作的成功的NFT项目。这个项目以9100万美元的价格售出，这是在世艺术家在公开拍卖中单幅作品的最高销售价格。</p><p id="fb2d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">合并是一个动态的链上NFT，具有一个称为“合并”的独特令牌机制。这个NFT系列的图像只是不同大小的圆圈，代表不同的质量。每个帐户在此集合中只能拥有一个NFT。如果你拥有一个NFT，又购买了另一个，两个NFT会合并成一个，它们的质量加在一起，这个圆的大小就会变大。</p><p id="dce4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我将解释合并机制的实现。如果你想了解更多，我创建了这个<a class="ae lr" href="https://sicongzhao.notion.site/Analyze-Merge-Contract-7aeac92fac9d4b3e89392f64deb2d98e" rel="noopener ugc nofollow" target="_blank">概念页面</a>，它解释了智能合约中的所有变量/函数。</p><h1 id="3651" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">去哪里找合同？</h1><p id="363a" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">合约地址为<code class="fe mp mq mr ms b">0xc3f8a0F5841aBFf777d3eefA5047e8D413a1C9AB</code>，您可以在<a class="ae lr" href="https://etherscan.io/address/0xc3f8a0f5841abff777d3eefa5047e8d413a1c9ab#code" rel="noopener ugc nofollow" target="_blank">以太扫描</a>中找到智能合约。在本文中，我们将研究第一个契约<a class="ae lr" href="https://gist.github.com/sicongzhao/b0cf206ce6d1f1632ace963c77dc9897" rel="noopener ugc nofollow" target="_blank"> Merge.sol </a>。</p><h1 id="a658" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">合并机制</h1><p id="f36f" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">两个令牌如何合并成一个？神奇的事情发生在<code class="fe mp mq mr ms b">_merge</code>函数中。当传输令牌时，契约检查接收方地址是否已经拥有令牌。如果是，就会触发<code class="fe mp mq mr ms b">_merge</code>功能，如下图所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="3d3c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">输入是两个令牌id。该函数首先使用函数<code class="fe mp mq mr ms b">decodeMass</code>检查两个标记的质量，然后通过用较小质量的增量更新映射<code class="fe mp mq mr ms b">_values</code>，将较小的标记合并到较大的标记中。要了解更多关于<code class="fe mp mq mr ms b">decodeMass</code>和<code class="fe mp mq mr ms b">_value</code>的信息，请参考本<a class="ae lr" href="https://sicongzhao.notion.site/Analyze-Merge-Contract-7aeac92fac9d4b3e89392f64deb2d98e" rel="noopener ugc nofollow" target="_blank">概念页</a>。它包含所有变量/函数的定义和解释。</p><p id="9848" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">另一方面，较小的令牌将被烧毁。通过删除<code class="fe mp mq mr ms b">_value</code>中较小的令牌，部分烧录发生在该函数中。在返回值<code class="fe mp mq mr ms b">tokenIdSmall</code>的帮助下，大部分燃烧发生在这个<code class="fe mp mq mr ms b">_merge</code>函数之外。不确定为什么这是构建代码的最佳方式，我认为在这个<a class="ae lr" href="https://sicongzhao.notion.site/Analyze-Merge-Contract-7aeac92fac9d4b3e89392f64deb2d98e" rel="noopener ugc nofollow" target="_blank">概念页面</a>中有改进和增加想法的空间。</p><p id="12dc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个契约使用映射<code class="fe mp mq mr ms b">_mergeCount</code>跟踪每个令牌被合并的次数。并且该映射在合并后得到更新。</p><p id="21ca" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，所有令牌中质量最大的令牌称为alpha令牌，其id和质量存储在变量<code class="fe mp mq mr ms b">_alphaId</code>和<code class="fe mp mq mr ms b">_alphaMass</code>中。该函数检查合并令牌的质量是否大于<code class="fe mp mq mr ms b">_alphaMass</code>，在这种情况下<code class="fe mp mq mr ms b">_alphaId</code>和<code class="fe mp mq mr ms b">_alphaMass</code>将被更新。</p><h1 id="35d0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">SVG生成的表面</h1><p id="b5ad" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">SVG生成代码在第二个契约<a class="ae lr" href="https://gist.github.com/sicongzhao/a8a7752c99bcef20ff645648d7bb5106" rel="noopener ugc nofollow" target="_blank"> MergeMetadata.sol </a>中。在不使所有细节复杂化的情况下，SVG中的一个圆用<code class="fe mp mq mr ms b">&lt;circle id=’c’ cx=’1000' cy=’1000' r=’_RADIUS_TAG’/&gt;</code>来表示。<code class="fe mp mq mr ms b">_RADIUS_TAG</code>基于每个令牌的质量动态生成。</p><h1 id="7514" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结束了</h1><p id="7166" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">你有它！我希望你觉得这个教程很有帮助，也很有趣。如果你想了解更多关于智能合约的信息，这个概念页面包含了对智能合约中所有变量/函数的全面解释。</p><p id="7f82" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您有任何问题或建议，请随时发表评论。我也乐于接受建议。如果你知道一个有趣的项目，想让我看看，告诉我！</p><pre class="kg kh ki kj gt mv ms mw mx aw my bi"><span id="9e7c" class="mz lt iq ms b gy na nb l nc nd"><strong class="ms ir">Want to Connect?</strong></span><span id="8796" class="mz lt iq ms b gy ne nb l nc nd">Please feel free to reach out (<a class="ae lr" href="https://www.linkedin.com/in/zhaosicong/" rel="noopener ugc nofollow" target="_blank">my LinkedIn</a>) if you have any questions, feedback, or even just a random chat.</span></pre><h2 id="aa9c" class="mz lt iq bd lu nf ng dn ly nh ni dp mc le nj nk me li nl nm mg lm nn no mi np bi translated">其他教程</h2><ul class=""><li id="7995" class="nq nr iq kx b ky mk lb ml le ns li nt lm nu lq nv nw nx ny bi translated"><a class="ae lr" rel="noopener ugc nofollow" target="_blank" href="/nft-beginner-tutorial-pepsi-nft-smart-contract-explained-962721b7361a">分析百事NFT智能合同</a></li><li id="5916" class="nq nr iq kx b ky nz lb oa le ob li oc lm od lq nv nw nx ny bi translated"><a class="ae lr" rel="noopener ugc nofollow" target="_blank" href="/analyzing-autonomous-art-nft-smart-contract-aa4547b31eb3">分析自主艺术NFT智能合约</a></li></ul></div></div>    
</body>
</html>