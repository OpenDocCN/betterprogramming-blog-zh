<html>
<head>
<title>Intro to Wireshark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Wireshark简介</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/intro-to-wireshark-2abe7fb24f53?source=collection_archive---------2-----------------------#2020-07-09">https://betterprogramming.pub/intro-to-wireshark-2abe7fb24f53?source=collection_archive---------2-----------------------#2020-07-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="31b7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Wireshark捕获网络流量</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c9f2906cdd9b0f557a1d808542442172.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gDEIYgXhWlZNQM6y"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@sir_moon?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">月球</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片。</p></figure><p id="faaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你是一个计算机网络或安全爱好者，你可能听说过<a class="ae ky" href="https://www.wireshark.org/" rel="noopener ugc nofollow" target="_blank"> Wireshark </a>。Wireshark是世界上最流行的网络协议分析器。它可以让您深入捕获的流量，并分析网络中正在发生的情况。您可以使用它来诊断网络问题和查找网络漏洞。</p><p id="ff00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将介绍使用Wireshark捕获流量的一些基础知识。因为我们将通过一些例子，请随意使用PCAP文件跟随！前往Wireshark wiki 找到一些样本捕获文件。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="373d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用PCAP文件</h1><p id="9405" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">打开Wireshark后，它将开始捕获多个网络接口上的流量。您可以双击某个接口来查看流量详情:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4cb207f9d104d0624eb101a833dcc1f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QucpD8fFvjy2MZOB"/></div></div></figure><p id="9f1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会看到Wireshark窗口中列出的数据包，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d1e050d9441c6c14f31ed62955692f66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7Ny-iR8V_kn6bQOZ"/></div></div></figure><p id="b130" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以先单击顶部工具栏上的红色方形按钮来保存捕获的数据包:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f3e19a7b3924df6b5447e67bfa7e7a85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AjiI23GdbKkX1O0W"/></div></div></figure><p id="f168" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将告诉Wireshark停止捕获数据包。然后，转到“文件&gt;保存”来保存PCAP文件。PCAP代表“数据包捕获”，是Wireshark捕获文件使用的文件扩展名。您可能还会看到扩展名“PCAPNG”，它代表“PCAP下一代”，是PCAP文件格式的新版本。</p><p id="a493" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">稍后当您想要重新访问流量捕获时，您可以进入“文件&gt;打开”来导入保存的PCAP文件。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="458d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">远程捕获</h1><p id="e665" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您想捕获并分析远程服务器上的流量，该怎么办？Wireshark通常用于分析本地网络上的流量，因此您需要使用tcpdump之类的工具。</p><p id="a204" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，使用具有root访问权限的帐户SSH到远程机器:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="22fa" class="ne md it na b gy nf ng l nh ni">ssh remoteuser@remotehost</span></pre><p id="d32d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，使用tcpdump捕获远程网络上的流量，并将其保存到PCAP文件中:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="776f" class="ne md it na b gy nf ng l nh ni">sudo tcpdump -i eth0 -w tcpdump.pcap</span></pre><p id="21c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，使用<code class="fe nj nk nl na b">scp</code>命令将捕获文件复制到您的计算机上:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="cbb2" class="ne md it na b gy nf ng l nh ni">scp remoteuser@remotehost:tcpdump.pcap /some/local/directory</span></pre><p id="a5ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以在计算机上使用Wireshark打开远程捕获文件。</p><p id="745d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以使用Wireshark的远程捕获工具sshdump。该命令在功能上等同于上面的命令:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="0b85" class="ne md it na b gy nf ng l nh ni">sshdump --extcap-interface=sshdump --capture</span><span id="384a" class="ne md it na b gy nm ng l nh ni">--remote-host remotehost --remote-username remoteuser</span><span id="d07b" class="ne md it na b gy nm ng l nh ni">--fifo=/some/local/directory/tcpdump.pcap</span></pre><p id="92aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以在Wireshark的GUI中直接使用sshdump。通过向下滚动启动屏幕上的接口列表并双击“SSH remote capture: sshdump”来访问sshdump:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/21bc3ffd9637206c2ad19c29df2370f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rkEViQxHV_Xq0tl1"/></div></div></figure><p id="1176" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在此对话框中，您可以指定远程服务器、端口、接口、用户名和密码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/10a656815f24b71650a9cb30384ae4ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cYA48N9Vt1Lsj7q3"/></div></div></figure><p id="dbf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以指定捕获过滤器和捕获命令。确保选中“在远程机器上使用sudo”选项！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/acbdd5cdd808f7717b94275509a68ac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ezXwkDLMvNsHTF4MIoadcA.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b679" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">捕获过滤器</h1><p id="f526" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可以使用Wireshark的捕获过滤器来减小捕获文件的大小。捕获过滤器使您能够在捕获过程中忽略您不感兴趣的数据包。在Wireshark的启动窗口中，您可以在接口列表上方看到捕获过滤器:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/5fd54853b7be21ef885227f5582310fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KLFFiAOWO2XVKnHD47cs0A.png"/></div></div></figure><p id="b37a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以根据IP地址、端口号和协议等标准过滤数据包。例如，您可以使用“主机”过滤器来关注进出目标主机的流量:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="093a" class="ne md it na b gy nf ng l nh ni">host 74.125.5.4 (Captures all traffic to and from host.)<br/>dst host 74.125.5.4 (Captures all traffic to host.)<br/>src host 74.125.5.4 (Captures all traffic from host.)</span></pre><p id="2136" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以根据源端口和目的端口进行过滤:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8092" class="ne md it na b gy nf ng l nh ni">port 80 (Captures all traffic to and from port.)<br/>dst port 80 (Captures all traffic to port.)<br/>src port 80 (Captures all traffic from port.)</span></pre><p id="f5db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您也可以使用过滤器来排除数据包:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9891" class="ne md it na b gy nf ng l nh ni">not port 80 (Captures all packets that do not use port.)</span></pre><p id="a237" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在维基上找到更多有用的捕获过滤器。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9cdc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">显示过滤器</h1><p id="4b9e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">另一方面，您可以使用显示过滤器来排除不想在Wireshark窗口中看到的数据包。显示过滤器不影响PCAP文件，但允许您在分析过程中仅查看某些数据包。您可以在数据包列表上方的Wireshark窗口中看到显示过滤器:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/98b56d1b0d5d8f3d8c6f9e0f38aaa1e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UAS_fJqowTCVJUvcGc_liw.png"/></div></div></figure><p id="c3b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，您可以让Wireshark显示或排除具有特定来源和目标IP的数据包:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ff60" class="ne md it na b gy nf ng l nh ni">ip.src==74.125.5.4 and ip.dst==192.168.0.1<br/>ip.src!=74.125.5.4</span></pre><p id="3840" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以基于协议进行过滤:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="f5c5" class="ne md it na b gy nf ng l nh ni">udp or icmp</span></pre><p id="6b05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者使用<code class="fe nj nk nl na b">contains</code>过滤器根据内容过滤数据包。此过滤器将在UDP头或有效负载的任何位置显示包含三字节序列0x81、0x60、0x03的数据包:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9710" class="ne md it na b gy nf ng l nh ni">&lt;host or protocol&gt; contains &lt;expression&gt;<br/>udp contains 81:60:03</span></pre><p id="b3a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您可以使用像<code class="fe nj nk nl na b">and</code>或<code class="fe nj nk nl na b">or</code>这样的布尔表达式来组合过滤器:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="36b7" class="ne md it na b gy nf ng l nh ni">tcp.port==80 or udp</span></pre><p id="ef0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在维基上找到更多有用的显示过滤器。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6d85" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="770f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">感谢阅读！本文只介绍了Wireshark的一小部分功能。这是一个多功能的工具，能够执行许多不同类型的分析。</p><p id="94f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有兴趣了解Wireshark的更多信息，请访问下面的文档:</p><div class="nr ns gp gr nt nu"><a href="https://wiki.wireshark.org/" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">Wireshark Wiki</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">这是Wireshark网络协议分析器的wiki站点。如果您是编辑组的成员，您可以编辑…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">wiki.wireshark.org</p></div></div><div class="od l"><div class="oe l of og oh od oi ks nu"/></div></div></a></div></div></div>    
</body>
</html>