<html>
<head>
<title>How to Supply Assets to the Aave Protocol Programmatically</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何以编程方式向Aave协议提供资产</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-supply-assets-to-the-aave-protocol-programmatically-acfb0875a2f0?source=collection_archive---------4-----------------------#2020-07-15">https://betterprogramming.pub/how-to-supply-assets-to-the-aave-protocol-programmatically-acfb0875a2f0?source=collection_archive---------4-----------------------#2020-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e0d2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对使用Aave协议感兴趣:JavaScript教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f286aa12bac1580ce8c496326e4010c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FlkKaoyx_Lb8zlyqMrvNmA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://aave.com/" rel="noopener ugc nofollow" target="_blank"> AAVE </a></p></figure><p id="f353" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">编者按:本文仅供娱乐和教育之用，并非理财建议。与本文相关或引用本文的任何投资行为完全是您自己的行为，如果您继续阅读本文，则意味着您同意这些条款。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="2b67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">先决条件:本演练假设您对JavaScript、Web3和以太坊智能合约有基本的了解。最后，您将能够编写一个DApp，使用户能够将资产存入Aave协议，在此过程中获得利息，并随后在任何时候赎回资产。</em></p><p id="1155" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在撰写本文时，DeFi协议锁定的价值超过20亿美元。这是不到一个月前，我写了关于如何向复合融资提供资产的文章时锁定金额的两倍。</p><p id="643b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第五大DeFi平台被称为<a class="ae ky" href="https://aave.com/" rel="noopener ugc nofollow" target="_blank"> Aave </a>。他们最近成为第一个提供快速贷款的DeFi平台，这种贷款必须在他们被取走的同一笔交易中偿还。</p><p id="d4f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们将介绍如何向Aave协议提供资产，以便用户可以存放他们的加密资产并从中赚取利息。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="1ad4" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">Aave是如何工作的？</h1><p id="00e5" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Aave目前在十七个市场运营:瑞士联邦理工学院、戴、、、、、英美烟草、KNC、LEND、LINK、MANA、MKR、REP、SNX、WBTC和ZRX。</p><p id="f64b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们以LINK为例。通过提供Aave协议的链接，您同意它可以借出该价值，从而获得利息。你可以随时提取你的股份。把它想象成一个储蓄账户。</p><p id="34f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦它在那里，你可以检查有多少链接在锅里，找出当前利率是多少，借用其他资产，等等。</p><h2 id="7961" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">让我们来谈谈技术</h2><p id="e8da" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">从技术角度来看，这个过程是什么样的？与复合融资相比，这一过程稍微复杂一些，但并不难以管理。</p><p id="f8d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Aave维护着名为<code class="fe nm nn no np b">LendingPool</code> s的合约，它是主要的切入点。从<code class="fe nm nn no np b">LendingPool</code>开始，可以使用<code class="fe nm nn no np b">deposit</code>功能提供资产。我们还可以检索协议数据，如用户的流动性、当前利率、总流动性等等。</p><p id="246b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Aave的协议中,<code class="fe nm nn no np b">LendingPool</code>合同是不可升级的。这意味着他们的地址将来可能会改变。为了防止像我们这样的第三方DApps落后，Aave提供了一个永远不会升级的<code class="fe nm nn no np b">LendingPoolAddressesProvider</code>合同。这是用来检索最新的<code class="fe nm nn no np b">LendingPool</code>。一旦我们有了最新的<code class="fe nm nn no np b">LendingPool</code>，我们就可以开始存款了。</p><p id="c44b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，我们不能从<code class="fe nm nn no np b">LendingPool</code>赎回资产。为此，我们需要了解另一组契约，称为<code class="fe nm nn no np b">aTokens</code>。这些是符合ERC-20协议的合同，是为了交换基础资产而发行的。比如存款LINK，我们根据当前汇率接收<code class="fe nm nn no np b">aLINK</code>。<code class="fe nm nn no np b">redeem</code>功能存在于<code class="fe nm nn no np b">aLINK</code> <em class="lv">，</em>不存在于<code class="fe nm nn no np b">LendingPool</code>。</p><p id="d7a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总而言之，这就是我们需要做的存放资产，然后赎回它:</p><ol class=""><li id="0e16" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">从<code class="fe nm nn no np b">LendingPoolAddressesProvider</code>获取最新的<code class="fe nm nn no np b">LendingPool</code>。</li><li id="0b6d" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">存入<code class="fe nm nn no np b">LendingPool</code>。</li><li id="12e8" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">从<code class="fe nm nn no np b">aToken</code>赎回。</li></ol><p id="d41c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总的来说，这使得将资产存入资产证券化比复合融资更复杂，因为你的DApp需要跟踪更多的合同和资产证券化。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f90b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">给我看看代码！</h1><p id="3b1f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><em class="lv">先决条件:本演练假设您对JavaScript、Web3和以太坊智能合约有基本的了解。</em></p><h2 id="a927" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">沉积</h2><p id="1b90" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在这里，我们将通过以下步骤，介绍如何将ETH存入和取出Aave贷款池:</p><ol class=""><li id="16ab" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">加载<code class="fe nm nn no np b">LendingPoolAddressesProvider</code>合同。</li><li id="4de0" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">检索<code class="fe nm nn no np b">LendingPool</code>地址。</li><li id="592f" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">加载<em class="lv"> </em> <code class="fe nm nn no np b">LendingPool</code> <em class="lv">。</em></li><li id="39b9" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><code class="fe nm nn no np b">LendingPool</code>存ETH到<em class="lv">。</em></li></ol><p id="5ea2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">步骤一。加载</strong> <code class="fe nm nn no np b"><strong class="lb iu">LendingPoolAddressesProvider</strong></code> <strong class="lb iu">。</strong></p><p id="09d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要的第一台ABI是用于合同的。供应商的地址可在<a class="ae ky" href="https://docs.aave.com/developers/deployed-contracts/deployed-contract-instances" rel="noopener ugc nofollow" target="_blank"> Aave文档</a>中找到，对于mainnet，它是<code class="fe nm nn no np b">0x24a42fD28C976A61Df5D00D0599C34c4f90748c8</code>。图1显示了如何加载提供者契约</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图一。加载提供程序</p></figure><p id="cc86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">步骤二。检索</strong><code class="fe nm nn no np b"><strong class="lb iu">LendingPool</strong></code>T22的地址。</p><p id="0dc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提供者契约有一个名为<code class="fe nm nn no np b">getLendingPool()</code>的函数，它返回相关<code class="fe nm nn no np b">LendingPool</code>契约的地址。图2显示了如何调用这个函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图二。获取贷款池地址</p></figure><p id="90c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第三步。加载</strong> <code class="fe nm nn no np b"><strong class="lb iu">LendingPool</strong></code> <strong class="lb iu">实例。</strong></p><p id="99be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nm nn no np b"><a class="ae ky" href="https://github.com/aave/aave-protocol/blob/master/abi/LendingPool.json" rel="noopener ugc nofollow" target="_blank">LendingPool</a></code>是我们需要存储的下一个ABI。图3显示了使用<code class="fe nm nn no np b">LendingPoolAddressesProvider</code>提供的地址加载<code class="fe nm nn no np b">LendingPool</code> <em class="lv"> </em>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3。加载贷款池</p></figure><p id="44e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">步骤四。存款ETH。</strong></p><p id="4e62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">存款时，我们需要告诉<code class="fe nm nn no np b"><em class="lv"> LendingPool</em></code>我们要将哪项资产以及金额发送出去。这是通过传入底层资产的<code class="fe nm nn no np b">reserve</code>地址来完成的，该地址在Aave文档中<a class="ae ky" href="https://docs.aave.com/developers/deployed-contracts/deployed-contract-instances" rel="noopener ugc nofollow" target="_blank">发布。</a></p><p id="44a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于ETH，保留地址为<code class="fe nm nn no np b">0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE</code>。图4显示了如何将ETH存放到<code class="fe nm nn no np b">LendingPool</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4。存放ETH</p></figure><p id="1aa7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nm nn no np b">supplyValue</code>是存放在WEI中的ETH的数量。</p><p id="d9fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图5显示了此时我们代码的完整状态。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5。全额存款代码</p></figure><p id="9ad7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧，ETH已经存到了Aave，现在正在赚取利息！</p><h2 id="8ff0" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">补偿的</h2><p id="2790" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为了赎回，我们需要知道正确的<code class="fe nm nn no np b">aToken</code>来调用，然后调用<code class="fe nm nn no np b">redeem()</code>函数来接收我们的ETH返回。我们按照以下步骤进行:</p><ol class=""><li id="b80e" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">从<code class="fe nm nn no np b">LendingPool</code>获取储备数据<em class="lv">。</em></li><li id="7cb5" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">使用储备数据加载<code class="fe nm nn no np b">aToken</code>。</li><li id="59ae" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">赎回ETH。</li></ol><p id="459f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第一步:获取储备数据。</strong></p><p id="d19a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">准备金数据为我们提供了有关存款资产的信息，如总流动性和当前利率。我们用它来检索<code class="fe nm nn no np b">aToken</code>T11的地址。图6显示了如何做到这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6。获取一个地址。</p></figure><p id="be8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第二步。载入</strong> <code class="fe nm nn no np b"><strong class="lb iu">aToken</strong></code> <strong class="lb iu">。</strong></p><p id="de35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nm nn no np b"><a class="ae ky" href="https://github.com/aave/aave-protocol/blob/master/abi/AToken.json" rel="noopener ugc nofollow" target="_blank">aToken</a></code>是我们需要存放在DApp的第三个也是最后一个ABI。图7显示了如何加载<code class="fe nm nn no np b">aToken</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图7:加载aToken</p></figure><p id="914f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第三步。赎回。</strong></p><p id="543d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，图8显示了如何赎回基础资产。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图8:赎回资产。</p></figure><p id="2161" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nm nn no np b">withdrawAmount</code>表示从协议中赎回的ETH的金额(单位为魏)。</p><p id="8127" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图9显示了完整的赎回代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图9。完全兑换代码</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2170" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="dba2" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">随着DeFi变得越来越容易使用并被如此多的人采用，学习如何与这些协议交互是任何开发人员工具箱中的一个有价值的工具。</p><h2 id="7a2e" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">进一步阅读</h2><p id="348a" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果你对区块链开发感兴趣，我会写一些教程、演练、提示以及如何开始和建立投资组合的技巧。查看以下资源:</p><div class="og oh gp gr oi oj"><a href="https://medium.com/blockcentric/blockchain-development-resources-b44b752f3248" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">Medium上最好的区块链开发资源</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">学习区块链、以太坊和DApp开发的资源列表</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox ks oj"/></div></div></a></div></div></div>    
</body>
</html>