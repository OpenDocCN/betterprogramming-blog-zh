<html>
<head>
<title>6 Important Things You Need to Run Kubernetes in Production</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在生产中运行Kubernetes需要的6件重要事情</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/6-important-things-you-need-to-run-kubernetes-in-production-d573d61258c5?source=collection_archive---------1-----------------------#2022-03-08">https://betterprogramming.pub/6-important-things-you-need-to-run-kubernetes-in-production-d573d61258c5?source=collection_archive---------1-----------------------#2022-03-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5f97" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让您的集群更上一层楼</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/641c36e62d57ea99d6e12ca3cb80e7fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gJ_PW5HX-RZy9SH-"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">托马斯·米洛特在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="f34c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kubernetes的采用率在<a class="ae kv" href="https://www.cncf.io/announcements/2022/02/10/cncf-sees-record-kubernetes-and-container-adoption-in-2021-cloud-native-survey/" rel="noopener ugc nofollow" target="_blank">创下历史新高</a>。几乎每个主要的IT组织都投资于容器策略，Kubernetes是目前使用最多、最流行的容器编排技术。</p><p id="5bc4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然Kubernetes有许多风格，但像AKS、EKS和GKE这样的管理解决方案是目前最受欢迎的。Kubernetes是一个非常复杂的平台，但只要您选择托管云解决方案，建立Kubernetes集群就相当容易。除非你有非常好的理由，否则我永远不会建议你自行管理Kubernetes集群。</p><p id="dea2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运营Kubernetes有很多好处，但如果没有丰富的Kubernetes知识，自己建立一个坚实的平台需要时间。根据最佳实践建立Kubernetes堆栈需要专业知识，并且对于建立一个经得起未来考验的稳定集群是必要的。仅仅运行托管集群和部署应用程序是不够的。</p><p id="a061" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行生产就绪的Kubernetes集群还需要一些额外的东西。一个好的Kubernetes设置让开发人员的生活变得更加轻松，并让他们有时间专注于交付商业价值。在本文中，我将分享在生产中运行Kubernetes堆栈所需的最重要的东西。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/79b657de560615c1f4920f255c9b6212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JzgvJ6zUDWHKyqHp.png"/></div></div></figure><h1 id="6959" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak"> 1。基础设施代码(IaC) </strong></h1><p id="03fb" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">首先，使用期望的状态配置(基础设施即代码— IaC)来管理您的云基础设施有很多好处，并且是一般的云基础设施最佳实践。</p><p id="49d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将它声明性地指定为代码<em class="mq">将使您能够在非生产环境中测试您的基础设施(变更)。它不鼓励或防止手动部署，使您的基础架构部署更加一致、可靠和可重复。</em></p><p id="0174" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">实施IaC的团队快速、大规模地交付更稳定的环境。像<a class="ae kv" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a>或<a class="ae kv" href="https://www.pulumi.com/" rel="noopener ugc nofollow" target="_blank"> Pulumi </a>这样的IaC工具非常适合在您选择的云中部署整个Kubernetes集群，以及网络、负载平衡器、DNS配置，当然还有集成的容器注册中心。</p><h1 id="a740" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak"> 2。监控和集中记录</strong></h1><p id="04bf" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Kubernetes是一个非常稳定的平台。它的自我修复能力将解决许多问题，如果你不知道去哪里找，你甚至不会注意到。然而，这并不意味着监控不重要。我见过团队在没有适当监控的情况下运行生产，突然一个证书过期，或者节点内存过量使用导致停机。</p><p id="0c17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过适当的监控，您可以轻松防止这些故障。<a class="ae kv" href="https://prometheus.io/" rel="noopener ugc nofollow" target="_blank"> Prometheus </a>和<a class="ae kv" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank"> Grafana </a>是Kubernetes最常用的监控解决方案，可用于监控<em class="mq">您的平台和应用</em>。应该为Kubernetes集群的关键问题设置警报(例如使用Alertmanager ),这样可以防止停机、故障甚至数据丢失。</p><p id="db6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了使用指标进行监控之外，运行集中式组件(如<a class="ae kv" href="https://www.fluentd.org/" rel="noopener ugc nofollow" target="_blank"> Fluentd </a>或<a class="ae kv" href="https://www.elastic.co/beats/filebeat" rel="noopener ugc nofollow" target="_blank"> Filebeat </a>来收集日志记录并将其发送到集中式日志记录平台(如<a class="ae kv" href="https://www.elastic.co/" rel="noopener ugc nofollow" target="_blank"> ElasticSearch </a>)也很重要，这样就可以在一个中心位置跟踪应用程序错误日志和日志事件。这些工具可以集中设置，因此无需开发人员的努力，所有应用程序都可以自动进行标准监控。</p><h1 id="e182" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak"> 3。带SSL证书管理的集中式入口控制器</strong></h1><p id="4933" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Kubernetes有一个入口的概念。一个简单的配置，描述流量应该如何从Kubernetes外部流向您的应用程序。中央入口控制器(例如Nginx)可以安装在集群中，以管理每个应用的所有传入流量。当入口控制器链接到公共云负载平衡器时，所有流量都会在节点间自动实现负载平衡，并发送到正确的pods IP地址。</p><p id="cd83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于其集中化，入口控制器具有许多优点。它还可以处理HTTPS和SSL。名为cert-manager的集成组件是Kubernetes中集中部署的应用程序，负责处理HTTPS证书。</p><p id="fd11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以使用Let's Encrypt、通配符证书甚至是公司内部信任证书的私有证书颁发机构来配置它。所有传入流量将使用HTTPS证书自动加密，并转发到正确的Kubernetes pods。开发人员不需要担心的另一件事。</p><h1 id="21b5" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak"> 4。基于角色的访问控制(RBAC) </strong></h1><p id="169a" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">不是每个人都应该成为Kubernetes管理员。当涉及到Kubernetes访问时，我们应该始终应用最小特权原则。基于角色的访问控制应该应用于整个Kubernetes栈(Kubernetes API、部署工具、仪表板等)。).</p><p id="f93f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们将Kubernetes与Keycloak、Azure AD或AWS Cognito等IAM解决方案集成时，我们可以使用OAuth2 / OIDC为平台工具和应用程序集中管理认证和授权。可以定义角色和组，使用户能够根据他们的团队或角色访问他们需要访问的资源。</p><h1 id="d90e" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak"> 5。GitOps部署</strong></h1><p id="b517" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">与Kubernetes合作的每个人都以这样或那样的方式使用<code class="fe mr ms mt mu b">kubectl</code>。但是使用<code class="fe mr ms mt mu b">kubectl apply</code>命令手动部署到Kubernetes并不是最佳实践，在生产中更是如此。</p><p id="7f90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kubernetes期望的状态配置应该存在于GIT中，我们需要一个部署平台来部署到Kubernetes。<a class="ae kv" href="https://argo-cd.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> ArgoCD </a>和<a class="ae kv" href="https://fluxcd.io/" rel="noopener ugc nofollow" target="_blank"> Flux </a>是Kubernetes部署的两个领先GitOps平台。两者都非常适合处理实时声明性状态管理，确保Git是Kubernetes状态的唯一真实来源。</p><p id="b0b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">即使一个流氓开发人员试图在生产中手动更改某些东西，GitOps平台也会立即将更改回滚到所需的更改。通过GitOps引导技术，我们可以管理环境、团队、项目、角色、策略、名称空间、集群、应用程序组和应用程序。仅使用Git。GitOps确保对所有Kubernetes环境的所有更改都是100%可跟踪的、易于自动化和可管理的。</p><h1 id="63dc" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak"> 6。秘密管理</strong></h1><p id="1c20" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Kubernetes secret manifests用于将秘密注入到容器中，作为环境变量或文件映射。最好是，不是每个人都应该能够访问所有的秘密，尤其是在生产中。对团队成员和应用程序的机密使用基于角色的访问控制是一种安全最佳实践。</p><p id="5375" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以使用CI / CD工具或者(更糟)通过本地开发环境将秘密注入到Kubernetes中，但是这可能导致配置状态漂移。这是不可追踪的，也不容易管理。同步机密的最佳方式是使用中央保险库，如Azure Key Vault、Hashicorp Vault、AWS Secrets Manager和中央机密操作员，如<a class="ae kv" href="https://external-secrets.io/" rel="noopener ugc nofollow" target="_blank">外部机密操作员</a>。</p><p id="8ac7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样，秘密引用可以存储在GIT中，指向外部secrets Vault中的一个条目。对于更注重安全的公司来说，也可以选择不让所有开发者知道Kubernetes使用RBAC的秘密。他们将能够引用机密，并在容器中使用它们，但永远无法直接访问它们。</p><h1 id="d571" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">结论</strong></h1><p id="0a4a" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">启动一个托管的Kubernetes集群很容易，但是如果您没有相关的专业知识，正确地设置它需要时间。拥有良好的基础设施作为代码解决方案、适当的监控、RBAC以及安全、可管理和可跟踪的部署机制是非常重要的。越早越好。使用标准化的开源工具根据最佳实践设置Kubernetes集群将帮助您节省时间、减少故障和麻烦，特别是从长远来看。当然，这些都是对你的Kubernetes栈最基本的要求，尤其是对企业级的公司。其他没有提到的重要考虑事项是ServiceMesh、安全扫描/合规性和端到端可追溯性，这些将在以后的文章中讨论。</p><p id="b62c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.pionative.com/kubernetes-quickstart" rel="noopener ugc nofollow" target="_blank">Pio native Kubernetes quick start包</a>将根据最新的开源标准/最佳实践为您提供所需的所有基础知识，并为您节省时间和金钱。如果你需要帮助，一些建议或者只是简单的聊天，我很乐意帮忙。欢迎在<a class="ae kv" href="https://www.linkedin.com/in/hijmen-fokker-b84bab63/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系我！</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="19ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mq">原载于</em><a class="ae kv" href="https://www.pionative.com/post/6-important-things-you-need-to-run-kubernetes-in-production" rel="noopener ugc nofollow" target="_blank"><em class="mq">https://www.pionative.com</em></a></p></div></div>    
</body>
</html>