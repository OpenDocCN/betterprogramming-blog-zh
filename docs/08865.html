<html>
<head>
<title>My Frustrations With the Context API in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我对React中的上下文API感到失望</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/my-frustrations-with-the-context-api-in-react-26189fcd5371?source=collection_archive---------4-----------------------#2021-06-21">https://betterprogramming.pub/my-frustrations-with-the-context-api-in-react-26189fcd5371?source=collection_archive---------4-----------------------#2021-06-21</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="66f9" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">以及为什么我的下一个项目会选择Redux</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/2be63d63a7ffaed5ee035e88b986d8c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*19i77Y8PejSEkGRytmU_Bw.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自<a class="ae kz" href="https://www.pexels.com/photo/man-showing-distress-3777572/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae kz" href="https://www.pexels.com/@olly?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">安德里亚·皮亚卡迪奥</a>拍摄的照片。</p></figure><p id="d5ce" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">React中的状态管理已经走过了漫长的道路。Redux 是长期的行业标准，但是在引入了<a class="ae kz" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">上下文API </a>之后，许多人认为Redux的时代已经结束了。</p><p id="3a95" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">嗯，我有幸与这两者一起工作，并在大型项目中使用它们。</p><p id="b666" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我可以理解上下文API带来的好处，但是我的下一个项目将使用Redux。</p><p id="605f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">某种程度上，这是一封写给Redux的情书。我们开始吧！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="a628" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">中间件支持</h1><p id="5cf7" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">中间件是我工作流程的重要组成部分。我使用它们来显示基于远程API调用响应的警报，而不会将结果返回给组件。其他一些使用案例包括:</p><ul class=""><li id="10ff" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">记录</li><li id="aa4e" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">崩溃报告</li><li id="009d" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">与异步API对话</li><li id="d02e" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">按指定路线发送</li></ul><p id="75e3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面是如何用Redux做到这一点:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">商店. ts</p></figure><p id="b1ba" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这些都是在大多数大型项目中很难忽略的特性。</p><p id="4743" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">用上下文API实现它们是可能的，但是Redux使它变得更加容易。不幸的是，我发现用上下文来实现它是不必要的复杂。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="f817" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">供应商地狱</h1><p id="1f4b" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">无论您使用的是上下文API还是Redux，为了更好地理解，建议保持每个reducer/上下文的大小较小。</p><p id="02a7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于Redux来说，这不是问题，因为我们可以使用<code class="fe nq nr ns nt b">combineReducer()</code>将多个reducers合并到一个单独的存储中，并用它包装我们的整个应用程序。</p><p id="4b7d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是在上下文API中，您必须用组件实际需要的上下文来包装组件。当您的应用程序变大时，它会创建一个<em class="nu">提供者地狱</em>。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="0601" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">是的，我知道有一些巧妙的技术可以避免这个问题，比如用所需的上下文创建一个特设，并用该特设包装组件。</p><p id="741c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是想象一下，在编码的时候，你必须记住多少不同的考虑。当其他人试图挖掘您的代码时，情况会变得更糟。</p><p id="a01d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">那么我们为什么要让自己的生活更艰难呢？</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="4242" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">熟悉的数据流</h1><p id="eba7" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">Redux已经被如此多的项目使用，以至于大多数初级开发人员在他们职业生涯的某个时候都有很大的机会遇到它。</p><p id="bb28" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一个典型的Redux数据流是这样的:组件-&gt;动作-&gt;中间件-&gt; Reducers -&gt;组件。</p><p id="30e0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">代码的工作流和结构是可预测的。我认为这是一个巨大的优势，因为在一个大型项目中，开发人员经常来来去去。</p><p id="c26e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当使用上下文时，你不知道你的上下文在哪里。每个开发人员都有自己的组织方式。这可能会给其他人带来一些不必要的开销，代价很高。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="aa87" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">表演</h1><p id="76d3" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">你预见到了。上下文具有已知的性能问题，因为每当上下文的任何部分被更新时，整个子树都会重新呈现。</p><p id="58df" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">假设我们用一个上下文包装了两个组件。这个上下文包含两个值:<code class="fe nq nr ns nt b">userDetails</code>和<code class="fe nq nr ns nt b">orderList</code>。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="b31f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe nq nr ns nt b">UserComponent</code>取决于<code class="fe nq nr ns nt b">userDetails</code>的值，而<code class="fe nq nr ns nt b">OrderComponent</code>取决于<code class="fe nq nr ns nt b">orderList</code>。</p><p id="6ed2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在如果<code class="fe nq nr ns nt b">userDetails</code>更新，那么两个组件都重新渲染(虽然和<code class="fe nq nr ns nt b">OrderComponent</code>没有关系)。</p><p id="cc23" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您看到大型应用程序如何滥用上下文并产生巨大的性能问题了吗？</p><p id="de0c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">是的，有一些解决方案，比如在更新之前拆分上下文或者记忆组件。但是有了<code class="fe nq nr ns nt b"><a class="ae kz" href="https://redux-toolkit.js.org/api/createSelector" rel="noopener ugc nofollow" target="_blank">selectors</a></code>的帮助，我们完全可以避免这个问题。为什么要重新发明轮子？</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="d209" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">清晰分离</h1><p id="24f0" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">Redux创建了一个清晰的关注点分离。您可以从组件中移除几乎100%的数据操作。</p><p id="91e5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">无论如何，大多数现代应用程序都依赖于某种远程数据。因此，通过使用选择器，您可以在数据进入组件之前对其进行预处理。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nv"><img src="../Images/0e8eef04e09b72e24c257268c5855add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eFg5VVaOjqCKx0EP4VWhUw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来源:<a class="ae kz" href="https://hackernoon.com/https-medium-com-heypb-react-redux-workflow-in-4-steps-beginner-friendly-guide-4aea9d56f5bd" rel="noopener ugc nofollow" target="_blank">黑客正午</a></p></figure><p id="967a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在每个人都知道数据来自哪里以及数据是如何被修改之前，开发一个大型应用程序是一个巨大的胜利。</p><p id="91d6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在上下文中，你没有特权这样做——或者至少实现起来有点棘手。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="a45f" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">排除故障</h1><p id="47e9" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在调试方面，Redux提供了一个很好的工具包，让调试变得轻而易举。</p><p id="c093" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">随着<a class="ae kz" href="https://redux-toolkit.js.org/api/configureStore" rel="noopener ugc nofollow" target="_blank"> redux-toolkit </a>的推出，这变得更加容易。你打开它，剩下的由Redux处理。</p><p id="7ed2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有了上下文，就很难想象会发生什么变化。然而，您可以通过保持您的上下文非常小且可预测来缓解这个问题。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="1141" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">插件支持</h1><p id="a792" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">Redux拥有丰富的插件支持，可以促进许多耗时且难以维护的辅助功能。</p><p id="9106" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你可以想到几乎任何事情，并且惊喜地发现别人已经为你实现了解决方案。一些最受欢迎的是:</p><ul class=""><li id="5d5f" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">redux-持久化</li><li id="c901" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">还原-thunk</li><li id="1033" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">还原形式</li><li id="8eed" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">重新选</li></ul><p id="3b11" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这些插件可以提高你的应用程序的质量。你确实需要学习一些额外的东西，但是从长远来看，它们可以减少很多麻烦。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="973d" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">大小</h1><p id="33d1" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">就大小而言，您可以认为Redux需要额外的资源来运行，从而增加了包的大小。</p><p id="d7a0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我同意这一点，但是当你拥有丰富的开发者经验和受人尊敬的社区的好处时，这真的那么重要吗？</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="c19c" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">最后的想法</h1><p id="40b1" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">不要误解我的意思:如果你能以正确的方式使用上下文，那么大多数问题都是可以解决的。有些人可能会认为这是一个更安全的选择，因为它是内置的。</p><p id="28fb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我同意这一点，但是库和包的存在是有原因的。对于较小的项目，上下文API就可以了。但是对于更大的，我认为用Redux是更安全的路线。</p><p id="1082" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请在评论中告诉我你的想法。祝您愉快！</p><p id="ce63" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">通过</strong> <a class="ae kz" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iv"> LinkedIn </strong> </a> <strong class="lc iv">或我的</strong> <a class="ae kz" href="https://www.mohammadfaisal.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iv">个人网站</strong> </a> <strong class="lc iv">与我取得联系。</strong></p><h2 id="0767" class="nw me iu bd mf nx ny dn mj nz oa dp mn lj ob oc mp ln od oe mr lr of og mt oh bi translated">资源</h2><ul class=""><li id="4fb5" class="na nb iu lc b ld mv lg mw lj oi ln oj lr ok lv nf ng nh ni bi translated">Redux工具包:<a class="ae kz" href="https://redux-toolkit.js.org/" rel="noopener ugc nofollow" target="_blank">https://redux-toolkit.js.org/</a></li></ul></div></div>    
</body>
</html>