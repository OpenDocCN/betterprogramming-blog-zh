<html>
<head>
<title>Reading and Writing a File in Rust</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Rust中读写文件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/reading-and-writing-a-file-in-rust-47d2bc7086ac?source=collection_archive---------3-----------------------#2022-08-30">https://betterprogramming.pub/reading-and-writing-a-file-in-rust-47d2bc7086ac?source=collection_archive---------3-----------------------#2022-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5a2f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">本文将回顾如何在Rust中创建、打开文件、读取其内容并写入其中。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3cc055fb32eee5627e0ec89c8c2a595b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N6YsrsA4yyWwhGuX"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/es/@homajob?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯科特·格雷厄姆</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="99c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名软件工程师或对技术感兴趣的人，读和写(也称为输入和输出的I/O)操作是一些你应该知道的基本概念。</p><p id="e09b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">阅读完本文后，您将能够创建、打开一个文件，阅读其内容，并向其中添加内容。所以让我们开始吧。</p><p id="ee32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是首先，让我们通过回顾角色在《铁锈》中是如何表现的来打下一些重要的基础。</p><h1 id="f530" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">字符串和字符串(又名字符串切片)</strong></h1><p id="ac79" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我知道这个标题(☝🏿)似乎有点混乱…在Rust中，我们有两种类型来表示字符串:</p><ul class=""><li id="a3e7" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated"><code class="fe nb nc nd ne b">str</code> : string slice，核心Rust编程语言的唯一字符串类型。这种类型是静态的，不可变的，我们通常看到它的借用形式:<code class="fe nb nc nd ne b">&amp;str</code>。</li><li id="e550" class="ms mt it lb b lc nf lf ng li nh lm ni lq nj lu mx my mz na bi translated"><code class="fe nb nc nd ne b">String</code>:由于有了标准库，Rust提供了第二种字符串类型。这种类型更加灵活，因为它可以被拥有并且是可变的。</li></ul><p id="39c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">两种字符串类型都是<a class="ae ky" href="https://en.wikipedia.org/wiki/UTF-8" rel="noopener ugc nofollow" target="_blank"> UTF-8 </a>编码的(更多关于那个<a class="ae ky" href="https://doc.rust-lang.org/book/ch08-02-strings.html" rel="noopener ugc nofollow" target="_blank">在这里</a>)；<code class="fe nb nc nd ne b">String</code>在你需要拥有或改变你的字符串时使用，而<code class="fe nb nc nd ne b">&amp;str</code>在你想要可视化一个字符串时使用。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><p id="dd13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Rust标准库允许我们执行不同的文件操作，这要归功于令人敬畏的struct <code class="fe nb nc nd ne b"><a class="ae ky" href="https://doc.rust-lang.org/std/fs/struct.File.html" rel="noopener ugc nofollow" target="_blank">File</a></code>和相关的方法。我们将在本文的其余部分利用它。</p><p id="7d88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在都准备好了，所以让我们直接开始吧！！</p><div class="nr ns gp gr nt nu"><a href="https://blog.devgenius.io/reading-and-writing-a-json-file-in-rust-2731da8d6ad0" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">在Rust中读写JSON文件</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">本文将向您介绍在RUST中解析和编写JSON文件。</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">blog.devgenius.io</p></div></div><div class="od l"><div class="oe l of og oh od oi ks nu"/></div></div></a></div><h2 id="75a2" class="oj lw it bd lx ok ol dn mb om on dp mf li oo op mh lm oq or mj lq os ot ml ou bi translated">你如何创建一个文件？</h2><p id="b5a3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了创建一个文件，我们将利用<code class="fe nb nc nd ne b">create</code>，struct <code class="fe nb nc nd ne b">File</code>的一个方法，如下例所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ov ow l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Rust中创建一个文件</p></figure><p id="4448" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nb nc nd ne b">create</code>方法返回一个<code class="fe nb nc nd ne b">Result</code>，因为我们可以成功地创建文件，或者我们可能有一个错误(整个磁盘，没有特权，等等)。，选择你的毒药💀).</p><p id="8228" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nb nc nd ne b">Result</code>是一个<strong class="lb iu">枚举</strong>也是Rust标准库提供的，允许我们管理错误(更多<a class="ae ky" href="https://web.mit.edu/rust-lang_v1.25/arch/amd64_ubuntu1404/share/doc/rust/html/book/second-edition/ch09-02-recoverable-errors-with-result.html" rel="noopener ugc nofollow" target="_blank">此处</a>)。</p><h2 id="d5dd" class="oj lw it bd lx ok ol dn mb om on dp mf li oo op mh lm oq or mj lq os ot ml ou bi translated">如何打开一个文件？</h2><p id="ab2f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了打开一个文件，我们将使用结构<code class="fe nb nc nd ne b">File</code>的<code class="fe nb nc nd ne b">open</code>方法，它也返回一个<code class="fe nb nc nd ne b">Result</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ov ow l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用Rust打开一个文件</p></figure><p id="8904" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里<code class="fe nb nc nd ne b">open</code>将尝试在我们的Rust项目的根级别找到文件。如果该文件不存在，将会创建它。</p><p id="2f48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我鼓励您使用现有和不存在的文件运行我们的最后一个示例，看看结果。</p><h2 id="ca28" class="oj lw it bd lx ok ol dn mb om on dp mf li oo op mh lm oq or mj lq os ot ml ou bi translated">你如何阅读文件的内容？</h2><p id="8041" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">读取文件内容的简单方法是打开它，并以<code class="fe nb nc nd ne b">String</code>的形式读取其内容(现在您明白为什么我们在第一部分介绍字符串类型了)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ov ow l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Rust中读取文件的内容</p></figure><p id="87c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们创建了一个名为<code class="fe nb nc nd ne b">contents</code>的可变<code class="fe nb nc nd ne b">String</code>变量，并通过使用方法<code class="fe nb nc nd ne b">read_to_string()</code>在第7行传递文件内容来更新它。我鼓励你检查方法<code class="fe nb nc nd ne b">read</code>，它允许你以字节向量的形式检索文件的内容(更多关于它的内容<a class="ae ky" href="https://doc.rust-lang.org/std/fs/fn.read.html" rel="noopener ugc nofollow" target="_blank">在这里</a>)。</p><p id="217f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我更喜欢使用struct <code class="fe nb nc nd ne b"><a class="ae ky" href="https://doc.rust-lang.org/std/io/struct.BufReader.html" rel="noopener ugc nofollow" target="_blank">BufReader&lt;R&gt;</a></code>来读取文件的内容，因为这样更有效也更好。<em class="ox">的诀窍</em>是<code class="fe nb nc nd ne b">Bufreader</code>在从文件中读取时提供一个缓冲组件(更多关于那个<a class="ae ky" href="https://doc.rust-lang.org/std/io/struct.BufReader.html" rel="noopener ugc nofollow" target="_blank">这里是</a>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ov ow l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Rust中读取文件内容的更好方法</p></figure><p id="8a27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所看到的，我们通过打开一个文件开始了我们的示例，正如我们前面所学的那样。然后在第6行，我们创建了<code class="fe nb nc nd ne b">reader</code>变量；我们刚刚打开的文件上的一个<code class="fe nb nc nd ne b">BufReader</code>。然后我们将使用这个<code class="fe nb nc nd ne b">reader</code>来提取文件的内容(第8行)。</p><h2 id="e025" class="oj lw it bd lx ok ol dn mb om on dp mf li oo op mh lm oq or mj lq os ot ml ou bi translated">如何向文件中添加一些内容？</h2><p id="ed4b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">添加内容并不是一项简单的任务，因为我们可能想要向新文件添加一些内容，过载现有文件的内容，或者向现有文件添加一些内容。</p><p id="cb1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几秒钟前看起来微不足道的事情现在变得更加复杂了…欢迎(回到)软件开发的美妙之处。</p><p id="0412" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我们先从前两种情况说起；以下示例说明如何向新创建的文件添加内容，或者打开现有文件并覆盖其内容。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ov ow l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Rust中向文件添加一些内容</p></figure><p id="3719" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，如果文件<code class="fe nb nc nd ne b">missy.txt</code>不存在，我们将在添加内容之前创建它。如果文件存在，我们的新内容将替换它的内容。</p><p id="4f83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，我们再次使用<code class="fe nb nc nd ne b">create</code>。<code class="fe nb nc nd ne b">create</code>允许我们创建文件并以只写模式打开现有文件。</p><p id="ecc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在现有文件上使用<code class="fe nb nc nd ne b">create</code>确实可行，但是如果我们想要更精确，我们应该使用结构<code class="fe nb nc nd ne b">OpenOptions</code>来确定如何访问文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ov ow l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Rust中更新文件内容</p></figure><p id="5b27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个例子中，我们打开一个现有的文件，并在开头添加一些内容。如果文件中有一些内容，我们的新内容将被添加到开头，只替换所需的数据量(这里要小心；我们在第9行将<code class="fe nb nc nd ne b">append</code>选项设置为<code class="fe nb nc nd ne b">false</code>。</p><p id="2b1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的最后一个例子中，我们将把一些内容添加到一个文件中，方法是把它附加到任何现有数据的末尾。在这里看到第9行的<code class="fe nb nc nd ne b">append</code>选项到<code class="fe nb nc nd ne b">true</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ov ow l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Rust中将一些内容添加到文件中</p></figure><p id="78a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与写入过程一样，Rust也有一个<code class="fe nb nc nd ne b"><a class="ae ky" href="https://doc.rust-lang.org/std/io/struct.BufWriter.html" rel="noopener ugc nofollow" target="_blank">BufWriter</a></code> <a class="ae ky" href="https://doc.rust-lang.org/std/io/struct.BufWriter.html" rel="noopener ugc nofollow" target="_blank">结构</a>，它提供了写入流的最佳方式。</p><h1 id="4c99" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">最后</h1><p id="01ba" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我希望我能为您在Rust中执行一些文件I/O操作打下坚实的基础。这只是开始。我鼓励你研究一下struct <code class="fe nb nc nd ne b">File</code>的文档，然后深入研究<code class="fe nb nc nd ne b"><a class="ae ky" href="https://doc.rust-lang.org/std/io/struct.BufReader.html" rel="noopener ugc nofollow" target="_blank">BufReader</a></code>和<code class="fe nb nc nd ne b"><a class="ae ky" href="https://doc.rust-lang.org/std/io/struct.BufWriter.html" rel="noopener ugc nofollow" target="_blank">BufWriter</a></code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/b221353c815e09e3648df8e760a31ae0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZxapxHtH5smn2swh_ArbNQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">像往常一样，米西向你问好</p></figure><h1 id="edc3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">资源</h1><ul class=""><li id="dc64" class="ms mt it lb b lc mn lf mo li oz lm pa lq pb lu mx my mz na bi translated">更多关于结构<code class="fe nb nc nd ne b">File</code> <a class="ae ky" href="https://doc.rust-lang.org/std/fs/struct.File.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</li><li id="8075" class="ms mt it lb b lc nf lf ng li nh lm ni lq nj lu mx my mz na bi translated">更多关于<code class="fe nb nc nd ne b">BufReaer</code> <a class="ae ky" href="https://doc.rust-lang.org/std/io/struct.BufReader.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</li><li id="5b5e" class="ms mt it lb b lc nf lf ng li nh lm ni lq nj lu mx my mz na bi translated">更多关于<code class="fe nb nc nd ne b">BufWriter</code> <a class="ae ky" href="https://doc.rust-lang.org/std/io/struct.BufWriter.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</li></ul><div class="nr ns gp gr nt nu"><a href="https://anismousse.medium.com/how-to-create-a-restful-web-service-in-rust-cae94aa0fc6f" rel="noopener follow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">如何在Rust中创建RESTful web服务</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">距离我上一篇文章已经快三个月了，我已经错过写关于Rust的文章了！！</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">anismousse.medium.com</p></div></div><div class="od l"><div class="pc l of og oh od oi ks nu"/></div></div></a></div></div></div>    
</body>
</html>