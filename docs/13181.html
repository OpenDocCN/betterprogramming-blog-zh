<html>
<head>
<title>Create a Custom WeekView in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在SwiftUI中创建自定义周视图</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/custom-weekview-in-swiftui-f89ed640f38d?source=collection_archive---------4-----------------------#2022-08-04">https://betterprogramming.pub/custom-weekview-in-swiftui-f89ed640f38d?source=collection_archive---------4-----------------------#2022-08-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c001" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建可滚动视图</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fea5ba484627cb7e35ccd4130e028e8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z5-W1dgVsQhothLW"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@jazminantoinette?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jazmin Quaynor </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="8d56" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一次尝试SwiftUI，我想我会做一些任务管理应用程序。我想制作一个类似于iOS设备上的日历应用程序的标题——最重要的是实现顶部可滚动的周视图。</p><p id="de97" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的预览是这篇文章的主要目标。显示一周几天的标题部分是我们仅使用SwiftUI想要实现的。首先要提到的是，这可以使用一个名为<a class="ae kv" href="https://github.com/richardtop/CalendarKit" rel="noopener ugc nofollow" target="_blank"> CalendarKit </a>的库轻松实现，它看起来与原生日历应用程序完全相同，但这不是我们的目标。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/d16823fe5ff5cf21a0feec6a105fc998.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*ravYS-n7zGIaN_1ueJCx_A.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们想要达到的顶部和滚动效果</p></figure><h1 id="55f7" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">创建模型</strong></h1><p id="41db" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">首先，我们必须创建一个新的结构<code class="fe mq mr ms mt b">WeekValue</code>,它保存一周的日期和一个作为标识符的id。</p><p id="857e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要这样做，因为当试图使用<code class="fe mq mr ms mt b">ForEach()</code>创建视图时，不能迭代<code class="fe mq mr ms mt b">Dates</code>的数组，因为它们不符合<code class="fe mq mr ms mt b">identifiable</code>协议，这意味着我们需要能够识别它们。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">周值</p></figure><h1 id="5880" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">创建一个ObservableObject来管理日期数据</strong></h1><p id="7be8" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">完成后，我们可以前进到下一部分，即创建一个<code class="fe mq mr ms mt b">ObservableObject</code>，它将管理所有数据，在本例中，这些数据是进入我们想要构建的视图的日期数组。</p><p id="800c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了实现这一点，我们创建了一些变量来帮助管理流量和生成刷卡的周数。</p><p id="1bed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我想到的方法是让3个视图循环，并在滑动时生成日期。我是从看到一个实现了循环轮播视图的<a class="ae kv" href="https://stackoverflow.com/questions/72343827/carousel-view-swiftui" rel="noopener ugc nofollow" target="_blank">帖子</a> <strong class="ky ir"> </strong>中得到这个想法的，我认为这可能会有用。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">周末商店</p></figure><p id="b7c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在上面使用的大多数函数和方法并没有像我希望的那样优化，但目前它还能工作，所以当有新想法出现时我会更新它。</p><p id="ea05" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本例中，初始函数用于生成起始周，并将它们添加到我们拥有的数组allWeeks中。</p><p id="84bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是如何工作的，我们有三个我们之前创建的<code class="fe mq mr ms mt b">WeekValue</code>结构的数组，保存我们需要的一周的日期，即当前、上一周和下一周，这样，我们就可以在滑动完成时更新每个中的日期数组。</p><h1 id="a299" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">创建自定义视图</strong></h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">CustomHeaderView</p></figure><p id="8703" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们有保存两个状态变量<code class="fe mq mr ms mt b">snappedItem</code>和<code class="fe mq mr ms mt b">draggingItem</code>的<code class="fe mq mr ms mt b">CustomWeekView</code>的主视图，当我们滑动它们时，它们用于定位和移动视图，为了阅读更多关于这方面的内容，我使用我之前提到的<a class="ae kv" href="https://stackoverflow.com/questions/72343827/carousel-view-swiftui" rel="noopener ugc nofollow" target="_blank">帖子</a>作为主要参考。</p><p id="2d4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个视图的工作方式是使用一个由我们在<code class="fe mq mr ms mt b">WeekStore</code>结构上生成的三个<code class="fe mq mr ms mt b">allWeeks</code>数组组成的循环，然后使用另一个循环根据日期生成文本，该日期正好是一周天数的七倍。</p><p id="391e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要生成其他周，我们所要做的就是滑动或<code class="fe mq mr ms mt b">DragGesture</code>在这种情况下，在手势本身的<code class="fe mq mr ms mt b">.onEnded</code>属性上，我们从<code class="fe mq mr ms mt b">WeekStore</code>调用一个名为<code class="fe mq mr ms mt b">update()</code>的函数，该函数管理将什么插入到日期数组中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/e09aee89ff4316d161f0ed8c45cdeb01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*q2vz6C8mQnPODS8pyTqY-w.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">演示</p></figure><p id="ef9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">动画本身看起来不是最好的，但经过一些调整，它肯定可以修复，甚至可以使用另一种方法来显示日期的视图。</p><p id="1fc9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我尝试的另一个方法是使用一个<code class="fe mq mr ms mt b">TabView</code>,当索引改变时它会更新，但是当索引更新时视图会刷新，动画也会加倍。我还试图通过创建一个足够大的Int值来创建视图，这样它就不会自己刷新，但这肯定不是优化的。</p><p id="65de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是这篇文章的全部内容，同样，我主要将它用于我创建的一个个人应用程序，以帮助我理解SwiftUI。大多数函数仍然可以重构，以创建更清晰的代码，我使用的大多数方法都可以优化，但现在，我将保持这种方式。我也希望这有所帮助，因为我没有找到很多关于这个话题的资源。</p><h1 id="a827" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">参考文献</strong></h1><p id="3683" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated"><a class="ae kv" href="https://stackoverflow.com/questions/72343827/carousel-view-swiftui" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/72343827/carousel-view-swift ui</a></p></div></div>    
</body>
</html>