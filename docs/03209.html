<html>
<head>
<title>A Guide to Continuous Delivery on iOS With Fastlane and Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用浪子和Firebase在iOS上持续交付的指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ios-continuous-delivery-guide-with-fastlane-firebase-beta-builds-distribution-platform-ddfe2f76e800?source=collection_archive---------10-----------------------#2020-01-28">https://betterprogramming.pub/ios-continuous-delivery-guide-with-fastlane-firebase-beta-builds-distribution-platform-ddfe2f76e800?source=collection_archive---------10-----------------------#2020-01-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0d60" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">配置一次，每次发布时节省30分钟</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8f7f1d04f9f9e3479c04685457b1c355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1NdqU5-OI8sZD6IqoRPXTA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@i_am_g?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Guillaume Jaillet </a>在<a class="ae ky" href="https://unsplash.com/s/photos/fast?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="c8ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将了解持续交付及其在iOS生态系统中的实现。</p><p id="111e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">连续交付(CD)是使用一些外部工具/软件自动化构建的过程，它减少了开发人员创建构建的手动工作，因此您可以立即可靠地共享构建。</p><p id="6e7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常情况下，持续集成(CI) <strong class="lb iu"> </strong>也是用CD实现的，但不强制两者同时实现。</p><p id="a635" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在CI <strong class="lb iu">、</strong><strong class="lb iu"/>中，开发者的代码被不断合并，始终保持最新的可部署代码。CD对于单独开发人员和大型团队一样有效，因为您必须共享/部署构建。</p><p id="7c6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在本文中，我们将重点关注使用<a class="ae ky" href="https://fastlane.tools/" rel="noopener ugc nofollow" target="_blank">浪子</a>和<a class="ae ky" href="https://firebase.google.com/products/app-distribution" rel="noopener ugc nofollow" target="_blank"> Firebase </a>来实现iOS平台的连续交付，以便与测试人员/客户共享测试版本。</p><p id="2a3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是一些我们每次共享构建时重复的典型任务。</p><ol class=""><li id="d948" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">在不同的环境中构建应用程序(试运行/生产)。</li><li id="0e22" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">根据指定的环境对构建进行签名。</li><li id="6d01" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">导出应用程序并手动配置构建设置。</li><li id="92ff" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">上传到发布平台(如<a class="ae ky" href="https://www.diawi.com/" rel="noopener ugc nofollow" target="_blank"> Diawi </a>、<a class="ae ky" href="https://developer.apple.com/testflight/" rel="noopener ugc nofollow" target="_blank"> TestFlight </a>、<a class="ae ky" href="https://firebase.google.com/products/crashlytics" rel="noopener ugc nofollow" target="_blank"> Crashlytics </a>)。</li><li id="79ad" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">与发行说明共享可安装的构建链接(在某些情况下)。</li></ol><p id="4d10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过连续交付，您可以自动执行上述所有步骤。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="159d" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak">大纲</strong></h1><p id="277c" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">这些是我们将在文章中实现的一些步骤。</p><ul class=""><li id="a8ec" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nn mb mc md bi translated">设置浪子——我们将在系统上安装浪子，然后用iOS项目配置浪子。浪子负责自动部署任务。</li><li id="e883" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated">配置浪子—我们将针对所需目标实施我们的配置(试运行或生产等。一个可能有两个以上的记录)。Fastfile 将告诉浪子关于编译的信息。</li><li id="a99e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated">导出构建——我们将使用Fastfile中指定的配置通过终端导出构建。</li><li id="ee48" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated">设置应用程序Firebase分发—我们将在Firebase控制台上配置应用程序，我们可以为应用程序添加测试人员或组，以便与测试人员或客户共享。</li><li id="0063" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated">自动化构建推至Firebase —我们将配置浪子文件，因此构建销毁过程变得自动化。</li><li id="8291" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated">享受咖啡:<strong class="lb iu"> </strong>是的，我们已经实现了流程自动化，节省了一些时间。</li></ul><p id="bc85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以查看我们在裁谈会流程中使用的工具。</p><ul class=""><li id="42f4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nn mb mc md bi translated"><a class="ae ky" href="https://fastlane.tools/" rel="noopener ugc nofollow" target="_blank">浪子</a></li><li id="118f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated"><a class="ae ky" href="https://firebase.google.com/products/app-distribution" rel="noopener ugc nofollow" target="_blank"> Firebase应用分发</a></li></ul><p id="519f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始游戏。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="639a" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak">建立浪子</strong></h1><p id="9bc9" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">首先，你必须在你的系统上安装浪子工具。</p><p id="3146" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装最新的Xcode命令行工具:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="3bdc" class="nt mr it np b gy nu nv l nw nx">xcode-select --install</span></pre><p id="73bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用以下工具安装浪子:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="1215" class="nt mr it np b gy nu nv l nw nx"><em class="ny"># Using RubyGems</em><br/>sudo gem install fastlane -NV</span><span id="39d9" class="nt mr it np b gy nz nv l nw nx"><em class="ny"># Alternatively using Homebrew</em><br/>brew install fastlane</span></pre><p id="371e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装后，您可以使用以下命令验证浪子工具的安装。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="60bc" class="nt mr it np b gy nu nv l nw nx">fastlane -v</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/fad4699390af5a41ce3436ddf3bf8469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E9Egl7W6NwmHkQsE0Ml2ug.png"/></div></div></figure><p id="336a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装工具后，您必须将终端目录更改为项目目录，然后使用以下命令初始化浪子工具:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="bf33" class="nt mr it np b gy nu nv l nw nx">fastlane init</span></pre><p id="064c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在该命令中，您必须选择使用浪子工具的目的。之后在终端上登录苹果账号。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/83bbf7739b63207cafd2045c6121fc46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qnJEa8x567ab-LqZadUOAw.png"/></div></div></figure><p id="3ce9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在浪子初始化之后，您将在您的项目目录中看到一个浪子命名的目录，包含我们将在其中配置元信息的Fastfile。</p><h2 id="65bf" class="nt mr it bd ms oc od dn mw oe of dp na li og oh nc lm oi oj ne lq ok ol ng om bi translated"><strong class="ak">配置浪子</strong></h2><p id="58e1" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们将不得不配置我们将使用浪子工具自动化的步骤。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/e0775a910bbf612f84770e311ac75337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vzRxru4zxDjOMmmbHj7E4w.png"/></div></div></figure><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="8a8f" class="nt mr it np b gy nu nv l nw nx">increment_build_number(xcodeproj: "TestProject.xcodeproj")<br/>build_app(workspace: "TestProject.xcworkspace", scheme: "TestProject-staging", export_method: "ad-hoc", silent: "true", output_directory: "./build_ipa")</span></pre><p id="e8fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将实现自动化beta测试的过程，并据此配置<code class="fe oo op oq np b">build_app</code>的参数。如果有多个目标，可以像<code class="fe oo op oq np b">production_adhoc</code>等设置多个车道。</p><ul class=""><li id="20d0" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nn mb mc md bi translated"><code class="fe oo op oq np b">scheme</code>:项目的目标名称。</li><li id="d4fa" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated"><code class="fe oo op oq np b">export method</code>:输出<code class="fe oo op oq np b">app-store</code>、<code class="fe oo op oq np b">ad-hoc</code>、<code class="fe oo op oq np b">development</code>等建筑作品的方法。</li><li id="fbfb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated"><code class="fe oo op oq np b">output_directory</code>:将放置导出的<code class="fe oo op oq np b">.ipa</code>的位置。</li><li id="a234" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated"><code class="fe oo op oq np b">silent</code>:建造时隐藏所有不必要的信息。</li><li id="6e6e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated">探索其他浪子参数。</li></ul><h2 id="dbe7" class="nt mr it bd ms oc od dn mw oe of dp na li og oh nc lm oi oj ne lq ok ol ng om bi translated"><strong class="ak">导出构建</strong></h2><p id="70a5" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">一旦您为部署配置了lane，您只需运行下面的构建导出命令:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="52fc" class="nt mr it np b gy nu nv l nw nx">fastlane staging_adhoc</span></pre><p id="e924" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用您的车道名称替换<code class="fe oo op oq np b">staging_ahoc</code>。</p><p id="444a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将在终端上显示消息。ipa文件被导出。</p><p id="4f4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你可以手动地通过不同的来源共享<code class="fe oo op oq np b">.ipa</code>文件，比如Diawi、TestFlight、Firebase应用分发。</p><p id="bd09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的下一步是自动化构建共享过程。浪子支持许多构建共享的发布平台，在本教程中我将使用Firebase。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e9b6" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">重火力点</h1><h2 id="f752" class="nt mr it bd ms oc od dn mw oe of dp na li og oh nc lm oi oj ne lq ok ol ng om bi translated"><strong class="ak">设置app Firebase分布</strong></h2><p id="e64f" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">假设您已经使用iOS项目从控制台配置了Firebase项目。</p><p id="d18c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过从iOS项目的根目录运行以下命令，将应用分发添加到您的浪子配置中:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="df68" class="nt mr it np b gy nu nv l nw nx">fastlane add_plugin firebase_app_distribution</span></pre><p id="ae68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装Firebase插件后，您必须配置浪子文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/09d818deb6ea4f152581acd2cdc5ccde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7yoDUo9ujpCMMNeoNkHd6A.png"/></div></div></figure><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="06fc" class="nt mr it np b gy nu nv l nw nx">increment_build_number(xcodeproj: “TestProject.xcodeproj”)<br/>build_app(workspace: “TestProject.xcworkspace”, scheme: “TestProject-staging”, export_method: “ad-hoc”, silent: “true”, output_directory: “./build_ipa”)<br/>firebase_app_distribution(<br/> app: “Your firebase App Id”,<br/> groups: “internal-tester, clients”,<br/> release_notes: “Lots of amazing new features to test out!”,<br/> firebase_cli_path: “/usr/local/bin/firebase” )</span></pre><ul class=""><li id="5b6d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nn mb mc md bi translated"><code class="fe oo op oq np b">app</code>:Firebase App的App ID，可以从Firebase控制台获取。</li><li id="9c76" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated"><code class="fe oo op oq np b">group</code>:你可以指定你想要共享构建的组，比如我已经创建了一组测试人员用于内部测试，另一组用于客户共享。</li><li id="de0d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated"><code class="fe oo op oq np b">release_notes</code>:在构建中实现的任何变更或更新，您都可以与测试人员分享。</li><li id="18ef" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nn mb mc md bi translated"><code class="fe oo op oq np b">firebase_cli_path</code> : <strong class="lb iu"> </strong> <code class="fe oo op oq np b">firebase_cli_path</code>如果我们没有显式更改Firebase工具的安装路径，也是一样的。</li></ul><h2 id="66cf" class="nt mr it bd ms oc od dn mw oe of dp na li og oh nc lm oi oj ne lq ok ol ng om bi translated"><strong class="ak">自动化构建推送至Firebase: </strong></h2><p id="3fb0" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">一旦我们更新了Fastfile，我们必须将Firebase登录到控制台。登录后，运行下面的命令。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="e7e1" class="nt mr it np b gy nu nv l nw nx">bundle exce fastlane staging_adhoc</span></pre><p id="e47f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用您的车道名称替换<code class="fe oo op oq np b">staging_adhoc</code>。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e283" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">咖啡时间</h1><p id="57f5" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">恭喜，我们已经实现了部署和分发流程的自动化。在Firebase上的构建成功发布后，你会在最后看到一个浪子摘要。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/d4d98b47a9ae81f429302a0cfd9b6aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t89ejgY8RV_Q6EWAb9pSUg.png"/></div></div></figure></div></div>    
</body>
</html>