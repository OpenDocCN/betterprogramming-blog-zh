<html>
<head>
<title>Build a Serverless Data Pipeline With Rust and AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Rust和AWS Lambda构建无服务器数据管道</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-serverless-data-pipeline-with-rust-and-aws-lambda-ec4e38a0ce9d?source=collection_archive---------6-----------------------#2022-09-21">https://betterprogramming.pub/build-a-serverless-data-pipeline-with-rust-and-aws-lambda-ec4e38a0ce9d?source=collection_archive---------6-----------------------#2022-09-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9b37" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我在一个周末的建设和学习中学到了什么</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6c24ec15374e6c78618b7e67db24655d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C7wyiP6whWemV983_Afpvw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@nate_dumlao?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">内森·杜姆劳</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片|图像高度被更改</p></figure><p id="63da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个编码故事都从一个用例开始。这与我在孩子的音乐学校遇到的一个朋友有关。</p><p id="08bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近音乐学校开始了新学期，所以像往常一样，我们在课堂上放下孩子后去了一家咖啡馆。</p><p id="d0f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的朋友很了解我:“魏对建筑材料充满热情，总是在等待的时候编码。”</p><p id="3e67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他告诉我，他对股市数据分析感兴趣，所以每个工作日，他都会去一个网站，将表格中的数据复制粘贴到Excel中。这对他来说需要一些时间，所以他问我是否可以让它自动化。</p><p id="12de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，我们现在有了我们的用例！</p><h1 id="cb32" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">功能性和非功能性需求</h1><p id="f63c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在一次咖啡馆深度潜水后，我很快捕捉到了一些功能性和非功能性的需求。</p><ol class=""><li id="cc68" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">应用程序应在周一至周五17:00(下午5:00)到目标网站获取数据。</li><li id="2f13" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">数据不需要转换；我们得到我们所看到的，并将其插入到数据存储中。</li><li id="b7de" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">数据可以加载到Excel或任何免费的BI工具，如PowerBI桌面免费版。</li></ol><p id="6882" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于非功能性需求—</p><ol class=""><li id="97a6" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">如果应用程序成功或失败，用户应该得到一个警告。</li><li id="cf41" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">没有为每次运行定义SLA。</li><li id="a10b" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">我们不应该在基础设施成本上花很多钱。</li></ol><p id="9afe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些要求非常简单。</p><p id="c4bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我需要详细说明这些功能性需求和非功能性需求收集阶段的重要性。在现实世界中，这将由业务分析以及与工程和业务伙伴的合作来驱动。</p><blockquote class="ng"><p id="0309" class="nh ni it bd nj nk nl nm nn no np lu dk translated">无论瀑布式还是敏捷式，BSA的作用都不应该被忽视或削弱。</p></blockquote><blockquote class="nq nr ns"><p id="0622" class="kz la nt lb b lc nu ju le lf nv jx lh nw nx lk ll ny nz lo lp oa ob ls lt lu im bi translated">我会做一些笔记，并在以后关于这个话题的写作中更多地双击它。</p></blockquote><h1 id="7afe" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">架构和应用程序设计</h1><p id="d9a5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">基于功能需求和非功能需求，</p><ol class=""><li id="ef05" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">这个应用程序每周只运行五次</li><li id="0cc9" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">数据收集量相当小</li><li id="af99" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">成本需要低；通常，我会利用Heroku的免费层；不幸的是，从今年11月开始，免费层将走到生命的尽头。</li></ol><p id="b189" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">凭借其开箱即用的内存安全性和性能，Rust与无服务器架构完美契合。</p><blockquote class="ng"><p id="95c2" class="nh ni it bd nj nk nl nm nn no np lu dk translated">无服务器+ Rust自然适合这种类型的用例。</p></blockquote><h2 id="99c4" class="oc lw it bd lx od oe dn mb of og dp mf li oh oi mh lm oj ok mj lq ol om ml on bi translated">什么是无服务器架构？</h2><p id="b418" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">无服务器架构是一种无需管理基础设施即可构建和运行应用程序和服务的方式。</p><p id="9fb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的应用程序仍然在服务器上运行，但是云提供商管理所有的服务器。</p><p id="87ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您不再需要调配、扩展和维护服务器来运行您的应用程序、数据库和存储系统。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/d8723e67478ce1862c3d14683ce93de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*oqwMlHoPUSZjVUN1JSs49g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者署名</p></figure><p id="5fa7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，我们使用AWS cloud lambda作为app运行时，使用AWS RDS Aurora无服务器数据库(托管)；根据您的需要，您还可以选择其他云管理的数据库服务，如Heroku或DigitalOcean。</p><blockquote class="nq nr ns"><p id="0a5b" class="kz la nt lb b lc ld ju le lf lg jx lh nw lj lk ll ny ln lo lp oa lr ls lt lu im bi translated">你可能需要记住三件事:</p><p id="14fd" class="kz la nt lb b lc ld ju le lf lg jx lh nw lj lk ll ny ln lo lp oa lr ls lt lu im bi translated">1.当您决定使用托管数据库时，您将会小心成本，并且您需要确保尽可能地优化代码/查询，并设置适当的预算警报。你不会想在突然收到一张大额账单的情况下结束。</p><p id="ef10" class="kz la nt lb b lc ld ju le lf lg jx lh nw lj lk ll ny ln lo lp oa lr ls lt lu im bi translated">2.在企业级实现中，你可能需要考虑更安全的方面，比如lambda和数据库应该位于不同的VPC等。</p><p id="af5f" class="kz la nt lb b lc ld ju le lf lg jx lh nw lj lk ll ny ln lo lp oa lr ls lt lu im bi translated">3.在实际生产中，我们还需要考虑控制表来监控作业的执行状态(成功或失败)。</p></blockquote><p id="6284" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于演示性质，我们将保持它的样本。</p><h1 id="51b6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">应用设计</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/1d942ff362b439ce0f3db9c07846ca41.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*z2X3d4h7mfvkVrT6RycnCw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用组件—按作者分类</p></figure><p id="1a3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基于关键的功能需求，我们可以如下构建我们的应用程序，反映我们的代码结构。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/3d8a030d76fa4caeb338b1cf25ef8202.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*exsLPfObWIlzR-y71uusTg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码结构—作者署名</p></figure><h1 id="2adf" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">让我们编码</h1><p id="107e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这个应用程序的核心组件是机器人；让我们为它构建结构。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">核心结构—作者署名</p></figure><h2 id="2336" class="oc lw it bd lx od ot dn mb of ou dp mf li ov oi mh lm ow ok mj lq ox om ml on bi translated">误差分量</h2><p id="9ceb" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">它是我们在项目中使用的所有不同libs包的翻译器，并且它是针对所需的应用程序集中和标准化的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AppError实现—作者署名</p></figure><h2 id="61db" class="oc lw it bd lx od ot dn mb of ou dp mf li ov oi mh lm ow ok mj lq ox om ml on bi translated">对于警报</h2><p id="f4cf" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在我以前的一篇文章中，我们使用Twilio API发送警报。</p><div class="oy oz gp gr pa pb"><a href="https://towardsdatascience.com/build-an-sms-alert-system-for-canada-covid-19-cases-over-the-weekend-with-rust-and-zero-cost-235bb59ec5d" rel="noopener follow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd iu gy z fp pg fr fs ph fu fw is bi translated">建立一个短信警报系统，为加拿大新冠肺炎案件在周末与铁锈和零成本</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">周末建设和学习</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">towardsdatascience.com。</p></div></div><div class="pk l"><div class="pl l pm pn po pk pp ks pb"/></div></div></a></div><p id="835b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看起来我们在设计中使用了带有策略模式的trait实现，这对于我们使用Slack webhook来实现是很容易的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">警报策略模式实现—作者署名</p></figure><h2 id="cdd8" class="oc lw it bd lx od ot dn mb of ou dp mf li ov oi mh lm ow ok mj lq ox om ml on bi translated">对于数据库实现</h2><p id="b8dd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们将使用模拟模式，如果用户将来想从不同的数据库引擎切换(通常不需要)，这种模式提供了灵活性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据库实施—作者署名</p></figure><h2 id="601f" class="oc lw it bd lx od ot dn mb of ou dp mf li ov oi mh lm ow ok mj lq ox om ml on bi translated">对于核心处理器实现</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">核心处理器—作者署名</p></figure><p id="81cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实现非常简单。</p><ol class=""><li id="0d3c" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated"><code class="fe pq pr ps pt b">New()</code>和<code class="fe pq pr ps pt b">Run()</code>函数是两个公共函数，可以从main调用。</li><li id="6ac6" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">对于<code class="fe pq pr ps pt b">Run()</code>函数将采取顺序方式执行:<code class="fe pq pr ps pt b">get_data_from_url()</code>、<code class="fe pq pr ps pt b">process_data()</code>、<code class="fe pq pr ps pt b">insert()</code>，这些都是私有函数。</li></ol><p id="f1ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们把它放在一起，从<code class="fe pq pr ps pt b">main()</code>开始触发。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="9048" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，你会问，“等一下，Lambda的实现在哪里？”。</p><p id="ac67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了方便我们的开发过程，我们首先使用main.rs作为开发属性。一旦成功运行，让我们用AWS的<code class="fe pq pr ps pt b">lambda_runtime</code>机箱构建Lambda函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="481e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了构建AWS的lambda二进制文件，我们可以在我们的<code class="fe pq pr ps pt b">Cargo.toml</code>文件中添加bin名称。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">货物的lambda二进制—作者署名</p></figure><p id="ec29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以按如下方式构建二进制文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><h1 id="ef07" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">奖金— CI/CD</h1><p id="e925" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们将通过GitHub Action构建CI/CD，以便于构建和部署。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">CI/CD —作者署名</p></figure><p id="0be0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们主要从用例初始化、应用程序架构、应用程序设计和逻辑代码遍历的角度了解了构建AWS lambda的Rust方法。</p><p id="9a95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢它。</p></div></div>    
</body>
</html>