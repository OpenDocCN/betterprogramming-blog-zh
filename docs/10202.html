<html>
<head>
<title>CRUD API With Flask and PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有Flask和PostgreSQL的CRUD API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/crud-api-with-flask-and-postgresql-15548d9ee48e?source=collection_archive---------0-----------------------#2021-12-13">https://betterprogramming.pub/crud-api-with-flask-and-postgresql-15548d9ee48e?source=collection_archive---------0-----------------------#2021-12-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e053" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何创建和测试Flask API</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b4f75fa2598d2b71018b43c262d6681e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_GZO1oEtSkFY405QQK02VA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@marvelous?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Marvin Meyer </a>在<a class="ae ky" href="https://unsplash.com/s/photos/internet-connection?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="525b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程将构建一个Flask CRUD应用程序，允许用户使用API创建、读取、更新和删除数据库条目。API将能够:</p><ul class=""><li id="5c35" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">添加新的宠物条目</li><li id="5956" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">查看数据库中的所有宠物</li><li id="1670" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">更新宠物的详细信息</li><li id="3dcd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">删除宠物</li></ul><h2 id="8ca6" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">先决条件</h2><p id="fbfb" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">您将使用以下工具和技术。</p><ul class=""><li id="0ca9" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">Python3</li><li id="f44f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">瓶</li><li id="4e9d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">烧瓶化学</li><li id="5117" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">一种数据库系统</li><li id="2687" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">邮递员</li></ul><h1 id="56b7" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">什么是API</h1><p id="1110" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">API(应用程序编程接口)是软件程序之间通信的中间件。API用于在应用程序中的客户端和数据库服务器之间进行通信。</p><h1 id="d493" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">超文本传输协议</h1><p id="310b" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们需要理解的另一个重要概念是HTTP协议，它将实现API。HTTP协议是互联网上数据通信的基础。它描述了数据分布的方式。下图显示了使用HTTP的标准通信。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/fb1cc7d3d8fae03437b80329b255ade8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qth_kLnnVyvRrBd3fHqlyA.jpeg"/></div></div></figure><h2 id="73d9" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">HTTP请求方法</h2><p id="1b0b" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">HTTP定义了一组指示要执行什么操作的方法。最常见的HTTP请求方法包括:</p><ul class=""><li id="9649" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe nt nu nv nw b">GET</code> : Get请求用于检索资源数据。</li><li id="4dbc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nt nu nv nw b">POST</code> : POST请求用于向服务器发送数据资源。</li><li id="e634" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nt nu nv nw b">PUT</code>:上传请求用于替换现有数据资源</li><li id="476a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nt nu nv nw b">DELETE</code>:删除请求用于删除数据资源</li><li id="3665" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nt nu nv nw b">PATCH</code>:补丁请求用于修改数据资源</li></ul><h2 id="a265" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">HTTP响应</h2><p id="c1b6" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">当客户端向服务器发送请求时，服务器返回一个HTTP响应，该响应由以下元素组成:</p><ul class=""><li id="d585" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe nt nu nv nw b">STATUS CODES</code></li><li id="301e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nt nu nv nw b">STATUS MESSAGE</code></li></ul><p id="e8d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑一个简单的对Google的GET请求:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="35b4" class="mj mk it nw b gy ob oc l od oe">import requests</span><span id="bc68" class="mj mk it nw b gy of oc l od oe">response_obj = requests.get('https://www.google.com/')</span><span id="79a7" class="mj mk it nw b gy of oc l od oe">print(response_obj)</span><span id="d5dd" class="mj mk it nw b gy of oc l od oe">print(response_obj.status_code)</span></pre><p id="af1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您运行上面的代码时，您将得到<code class="fe nt nu nv nw b">&lt;Response [200]&gt; </code>和一个状态代码<code class="fe nt nu nv nw b"> 200</code>，这是对成功请求的响应。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="7d53" class="mj mk it nw b gy ob oc l od oe">200<br/>&lt;Response [200]&gt;</span></pre><p id="6aab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">常见的HTTP状态代码包括:</p><ul class=""><li id="fff4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">200:好的</li><li id="ab89" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">201:已创建</li><li id="1c51" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">304:未修改</li><li id="2b73" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">400:错误请求</li><li id="f4cb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">401:未经授权</li><li id="4c6d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">404:未找到</li><li id="2d55" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">405:不允许的方法</li><li id="0633" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">500:内部服务器错误</li></ul><h1 id="b7d4" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">使用Postgresql的Flask CRUD应用程序</h1><p id="fe98" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">Flask是一个简单的python微框架，允许开发人员轻松创建应用程序，因为它不需要工具和库。</p><p id="dcf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个项目目录，</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="2c80" class="mj mk it nw b gy ob oc l od oe">mkdir flaskcrud</span></pre><p id="ad40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建并激活虚拟环境</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="b483" class="mj mk it nw b gy ob oc l od oe">cd flaskcrud<br/>python3 -m venv env<br/>source env/bin/activate</span></pre><p id="172d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<code class="fe nt nu nv nw b">env</code>是虚拟环境的名称。虚拟环境确保在一个地方管理项目依赖关系。用pip安装<code class="fe nt nu nv nw b">Flask</code>和<code class="fe nt nu nv nw b">Flask-Sqlalchemy</code></p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="923d" class="mj mk it nw b gy ob oc l od oe">pip install flask<br/>pip install -U Flask-SQLAlchemy</span></pre><blockquote class="og oh oi"><p id="17ee" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">Flask-SQLAlchemy是对<a class="ae ky" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Flask </a>的扩展，为您的应用程序增加了对<a class="ae ky" href="https://www.sqlalchemy.org/" rel="noopener ugc nofollow" target="_blank"> SQLAlchemy </a>的支持。它旨在通过提供有用的缺省值和额外的帮助器来简化SQLAlchemy与Flask的使用，从而更容易完成常见任务。</p></blockquote><p id="ddbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我们将使用<a class="ae ky" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>，对于数据库，让我们用pip安装psycopg2驱动程序库。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="ca31" class="mj mk it nw b gy ob oc l od oe">pip install psycopg2</span></pre><p id="56dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该已经在开发环境中安装了<a class="ae ky" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>。这本<a class="ae ky" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank">指南</a>告诉你如何在不同的操作系统上安装它。</p><p id="f78f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在项目目录下，创建一个文件<code class="fe nt nu nv nw b">app.py</code></p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="4fb6" class="mj mk it nw b gy ob oc l od oe">touch app.py</span></pre><p id="8b48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<code class="fe nt nu nv nw b"> app.py</code>，导入<code class="fe nt nu nv nw b">Flask</code>，创建一个flask应用实例。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="49e3" class="mj mk it nw b gy ob oc l od oe">from flask import Flask<br/>app = Flask(__name__)</span></pre><h1 id="370f" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">创建新的数据库</h1><p id="cd2f" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">PostgreSQL附带一个psql，这是一个交互式终端程序，允许您与PostgreSQL数据库服务器进行交互。连接到PostgreSQL数据库服务器。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="a23e" class="mj mk it nw b gy ob oc l od oe">sudo su postgres<br/>psql</span></pre><p id="9001" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令在您的操作系统中会有所不同，但原则是相同的。您将看到一个类似这样的<code class="fe nt nu nv nw b">psql</code>终端</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="79a6" class="mj mk it nw b gy ob oc l od oe">psql (9.5.14)<br/>Type "help" for help.</span><span id="25f6" class="mj mk it nw b gy of oc l od oe">postgres=#</span></pre><p id="6273" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建数据库:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="a6bb" class="mj mk it nw b gy ob oc l od oe">CREATE DATABASE pets;</span></pre><p id="44f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建角色</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="9662" class="mj mk it nw b gy ob oc l od oe">CREATE ROLE john WITH LOGIN PASSWORD ‘password’;</span></pre><p id="cbb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">向您在上面创建的用户授予数据库访问权限。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="c2b5" class="mj mk it nw b gy ob oc l od oe">GRANT ALL PRIVILEGES ON DATABASE pets TO john;</span></pre><h1 id="e071" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">数据库配置</h1><p id="a7e1" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">让我们配置数据库配置。通过传递<code class="fe nt nu nv nw b">DATABASE_URI</code>来加载数据库配置，然后通过将它传递给应用程序来创建<a class="ae ky" href="https://flask-sqlalchemy.palletsprojects.com/en/2.x/api/#flask_sqlalchemy.SQLAlchemy" rel="noopener ugc nofollow" target="_blank"> SQLAlchemy </a>对象。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="6965" class="mj mk it nw b gy ob oc l od oe">from flask_sqlalchemy import SQLAlchemy<br/>app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql+psycopg2://john:password@localhost/pets'<br/>db = SQLAlchemy(app)</span></pre><p id="efe2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nt nu nv nw b">app.py</code>到目前为止应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><h1 id="91a8" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">数据库模型</h1><p id="a3e1" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">模型代表应用程序中的对象。在这种情况下，对象指的是我们希望存储在应用程序中的宠物。创建一个类Pet并声明以下字段:</p><ul class=""><li id="0306" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe nt nu nv nw b">id</code></li><li id="8bce" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nt nu nv nw b">pet_name</code></li><li id="a756" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nt nu nv nw b">pet_type</code></li><li id="0ea6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nt nu nv nw b">pet_description</code></li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="a52a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nt nu nv nw b">db</code>实例提供了用于创建声明模型的基类<code class="fe nt nu nv nw b">Model</code>。<code class="fe nt nu nv nw b">__repr__</code>函数创建了模型对象的人类可读版本。</p><p id="f003" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建实际的数据库，用<code class="fe nt nu nv nw b">db.create_all()</code>命令初始化数据库。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="e607" class="mj mk it nw b gy ob oc l od oe">db.create_all()</span></pre><p id="183b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您也可以从终端创建数据库。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="458c" class="mj mk it nw b gy ob oc l od oe">python3.8<br/>from app import db<br/>db.create_all()</span></pre><h1 id="7b35" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">运行服务器。</h1><p id="c800" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在开发环境中运行应用程序。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="ff10" class="mj mk it nw b gy ob oc l od oe">export FLASK_APP=app<br/>export FLASK_en=development<br/>flask run</span></pre><p id="c22f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nt nu nv nw b">Flask_APP=app</code>，指定应用程序所在的文件夹。<code class="fe nt nu nv nw b">FLASK_ENV=development</code>允许服务器在我们每次修改时重启，这样我们就不用重启服务器了。然后flask run在<a class="ae ky" href="http://127.0.0.1:5000" rel="noopener ugc nofollow" target="_blank"> 127.0.0.1:5000 </a>启动一个开发服务器。你应该在<code class="fe nt nu nv nw b">flask run</code>之后看到这个</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="4a66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你访问<a class="ae ky" href="http://127.0.0.1:5000" rel="noopener ugc nofollow" target="_blank"> 127.0.0.1:5000 </a>，你应该得到<code class="fe nt nu nv nw b">Not Found</code>错误。这是因为我们没有创建任何端点</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/6017f133acff3fc03bc8c43344672186.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HMZs5NfbO26EMOX6wIdGTQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">未找到错误</p></figure><h1 id="d9e6" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">API端点</h1><p id="95e4" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">flask中一个简单的API端点如下所示。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="b2a2" class="mj mk it nw b gy ob oc l od oe">from flask import Flask,jsonify</span><span id="fd25" class="mj mk it nw b gy of oc l od oe">@app.route('/')</span><span id="9487" class="mj mk it nw b gy of oc l od oe">    def index():</span><span id="8c37" class="mj mk it nw b gy of oc l od oe">        return jsonify({"message":"Welcome to my site"})</span></pre><p id="d0c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用<code class="fe nt nu nv nw b"> <a class="ae ky" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route</code>装饰器来处理请求，并定义一个返回jsonified消息的函数索引。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/3edd15ecb0b32ddc12e3a2ecf6a9c9de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a34zVDcWiuw93hXh0BiA7Q.png"/></div></div></figure><h1 id="661a" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">CORS(跨产地资源共享)</h1><p id="b06e" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">您可能在开发应用程序时遇到过这种错误。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="42e3" class="mj mk it nw b gy ob oc l od oe">No 'Access-Control-Allow-Origin' header is present on the requested resource</span></pre><p id="ba8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CORS是一种安全措施，可以阻止来自不同域名或不同协议的资源的请求。它的作用是防止来自可能嵌入在请求中的javascript脚本的恶意攻击。只有当一个网页和另一个网页共享同一个域名时，CORS才会允许它们访问数据。</p><h2 id="0623" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">弗拉斯克-CORS</h2><p id="87c3" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">Flask附带了FLASK-CORS扩展，我们将在本教程中使用它来实现CORS。要安装扩展，请使用pip。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="8a11" class="mj mk it nw b gy ob oc l od oe">pip install -U flask-cors</span></pre><p id="1601" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过将它传递给应用程序实例，将其添加到应用程序中。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="6337" class="mj mk it nw b gy ob oc l od oe">from flask-cors import CORS<br/>CORS(app)</span></pre><p id="60bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在特定的路线上添加跨起点，只需在路线前添加<code class="fe nt nu nv nw b">@cross-origin()</code>装饰器，如下所示。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="0b86" class="mj mk it nw b gy ob oc l od oe">@cross-origin()<br/>@app.route('/pets')<br/>    def pets()<br/>        pass</span></pre><h2 id="98e5" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">终点后</h2><p id="3fd9" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">创建一条路线，用于将宠物条目添加到数据库中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="4efa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们指定了一个<code class="fe nt nu nv nw b">POST</code>方法。<code class="fe nt nu nv nw b">create_pet </code>方法将从请求体中获取<code class="fe nt nu nv nw b">pet_name</code>、<code class="fe nt nu nv nw b">pet_type</code>、<code class="fe nt nu nv nw b">pet_age</code>和<code class="fe nt nu nv nw b">pet_description</code>，然后将记录插入数据库。</p><p id="0397" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在为了测试API，我们将使用Postman。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/b5cdb4f59c5e61da97b8591564c57b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5yu0qDNPq3T7S8uEL9dRA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">终点后</p></figure><h2 id="27d5" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">获取端点</h2><p id="09a6" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们将使用GET方法返回所有的宠物条目。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="9846" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是使用Postman的GET API。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/66c05767784b7cafbecf4d16f767a225.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VTr4MsYGEMAudZhg83re6w.png"/></div></div></figure><h2 id="60ee" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">补丁端点</h2><p id="69eb" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们将使用<code class="fe nt nu nv nw b">PATCH</code>方法来更新宠物的详细信息。只能更新宠物的年龄和描述。我们使用<code class="fe nt nu nv nw b">query.get()</code>获得一个宠物的实例，然后在数据库中更新它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="1729" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是使用Postman的补丁API。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/0cae6c5cc2b95265d28da9569f6d4103.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1-f8wIgDk8XHhFvW1wrpiA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">删除API</p></figure><h2 id="869b" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">删除端点</h2><p id="e80a" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们将使用DELETE方法从数据库中删除一只宠物。首先，我们将宠物的id传递给URL。然后我们使用<code class="fe nt nu nv nw b">query.get()</code>获得一个宠物的实例，然后从数据库中删除它。<code class="fe nt nu nv nw b">query.get()</code>仅返回单个对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="47ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是使用Postman的删除API。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/0cae6c5cc2b95265d28da9569f6d4103.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1-f8wIgDk8XHhFvW1wrpiA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">删除API</p></figure><h1 id="2104" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">结论</h1><p id="b1ab" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">本教程介绍了如何用Flask构建CRUD API。如果您希望了解如何在flask应用程序中处理异常，可以跟随本教程学习:</p><div class="oq or gp gr os ot"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-handle-exceptions-in-flask-b1d9c151875b"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd iu gy z fp oy fr fs oz fu fw is bi translated">如何处理Flask中的异常</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">更好的警报处理有助于更好的编程</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">better编程. pub</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph ks ot"/></div></div></a></div></div></div>    
</body>
</html>