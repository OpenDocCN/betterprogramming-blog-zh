<html>
<head>
<title>Fixing Swift Actors and Delegate Error on Xcode 14</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">修复Xcode 14上的Swift Actors和Delegate错误</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/fixing-swift-actors-and-delegate-error-on-xcode-14-87f933c9bbcc?source=collection_archive---------9-----------------------#2022-09-14">https://betterprogramming.pub/fixing-swift-actors-and-delegate-error-on-xcode-14-87f933c9bbcc?source=collection_archive---------9-----------------------#2022-09-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7451" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如果您已经将Xcode更新到版本14，您可能会得到一个关于在项目中变更actor-isolated属性的错误。让我们修理它。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/20515d1096191f85ca75b95bbec5090a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KRdKbi0vkBJnkBw62usPgA.jpeg"/></div></div></figure><p id="5136" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我不会再跟你说什么从零开始的演员，是什么，怎么运作的。自从苹果推出Swift 5.5以来，有大量关于它们的酷文章。如果你仍然不使用演员，那么是时候看看了。我敢打赌，总有一天你会把你的一些职业变成演员。</p><p id="5b75" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这篇特别的文章是关于在用版本14更新Xcode之后，使用actors和delegates时的一个特定的潜在问题。这听起来有点琐碎，但我认为它可能是有用的。让我们开始吧。</p><h1 id="0f10" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">Xcode 14之前</h1><p id="5f18" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">假设我们有一个带委托的类<code class="fe mk ml mm mn b">SomeClass</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">具有委托的某个类</p></figure><p id="3b01" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">和<code class="fe mk ml mm mn b">SomeViewModel</code> —在那里我们将使用我们的<code class="fe mk ml mm mn b">SomeClass</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">带有SomeClass的SomeView模型</p></figure><p id="f8a5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如您所见，我们通过将delegate设置为self并使视图模型符合<code class="fe mk ml mm mn b">SomeClassDelegate.</code>进行了原始操作，因此，让我们打印出一些结果。</p><pre class="kg kh ki kj gt mu mn mv mw aw mx bi"><span id="95ba" class="my lo iq mn b gy mz na l nb nc"><strong class="mn ir">let someViewModel = SomeViewModel()<br/>someViewModel.start()</strong></span><span id="5ec6" class="my lo iq mn b gy nd na l nb nc">// Printed: some class did start</span></pre><p id="0e29" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好的。现在是时候用一个actor重构我们的类了。如何实现(也许你已经在你的项目中以类似的方式完成了):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="3d66" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">同样，让我们在视图模型中使用它。当然，因为我们和演员有协议，我们需要任务。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h1 id="3e0e" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">在...之后</h1><p id="bc7d" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">如果您仍在使用Xcode 13，您可能不会在这个实现中看到任何警告。但是如果您已经用版本14更新了Xcode，您很可能会得到这个错误:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/e113017f9aba653dd42f114d610ab67e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_ojZgc4WVi5AnaC-Jb1uw.jpeg"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">参与者隔离的属性“delegate”不能从非隔离的上下文中变异</p></figure><p id="9157" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">乍一看，这很令人困惑，尤其是当委托是一个actor的属性时，“await expression中没有发生异步操作”。此外，这可能是一个问题—如果我们等待从外部更改属性，为什么我们会看到这个关于隔离的消息？</p><p id="eb0b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">实际上，这些错误既有意义，又看起来有点怪异。正如我们所知，参与者的基本思想是隔离属性。这意味着你不能仅仅从外部更新属性。所以，很可能，这些错误教会我们如何正确使用actor，并且属性委托的更新应该只发生在actor <code class="fe mk ml mm mn b">SomeActor</code>内部。</p><p id="abf8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">合理的解决方案是添加一个额外的方法。此方法将为委托设置一个新值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">setDelegate方法</p></figure><p id="dcfb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看车型中的<code class="fe mk ml mm mn b">Task</code>内部更换为:</p><pre class="kg kh ki kj gt mu mn mv mw aw mx bi"><span id="d194" class="my lo iq mn b gy mz na l nb nc">// await someActor.delegate = self<br/><strong class="mn ir">await someActor.setDelegate(self)</strong></span></pre><p id="e513" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">预期结果:</p><pre class="kg kh ki kj gt mu mn mv mw aw mx bi"><span id="7506" class="my lo iq mn b gy mz na l nb nc"><strong class="mn ir">let someViewModel = SomeViewModel()<br/>someViewModel.start()</strong></span><span id="cf80" class="my lo iq mn b gy nd na l nb nc">// Printed: some actor did start</span></pre><h1 id="6144" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">包扎</h1><p id="2ee2" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">如果错误不是如此出乎意料，我不会写这篇文章。我看到Stackoverflow或Swift <a class="ae nf" href="https://forums.swift.org/t/used-to-work-xcode-14b4-now-doesnt-actor-isolated-property-lastloggedtimestamp-can-not-be-mutated-from-a-sendable-closure/59262" rel="noopener ugc nofollow" target="_blank">讨论</a>中已经出现了一些问题，我也提出了同样的问题。如果这个演员隔离属性错误只是为了教会我们如何正确使用演员，为什么不能只是一个警告呢？</p><p id="ed6b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢您的阅读。</p><pre class="kg kh ki kj gt mu mn mv mw aw mx bi"><span id="d43e" class="my lo iq mn b gy mz na l nb nc"><strong class="mn ir">Want to Connect?</strong></span><span id="e357" class="my lo iq mn b gy nd na l nb nc">Don't hesitate to follow me on <a class="ae nf" href="https://twitter.com/maxkalik" rel="noopener ugc nofollow" target="_blank">Twitter</a>.</span><span id="345c" class="my lo iq mn b gy nd na l nb nc">I appreciate any suggestions or comments regarding my research and articles.</span></pre></div></div>    
</body>
</html>