<html>
<head>
<title>The Story Behind Mapping in Solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">坚实度映射背后的故事</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-story-behind-mapping-in-solidity-e1c428aa8cbe?source=collection_archive---------11-----------------------#2022-04-08">https://betterprogramming.pub/the-story-behind-mapping-in-solidity-e1c428aa8cbe?source=collection_archive---------11-----------------------#2022-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3b2d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">看看Solidity的散列表方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5c377a56872d75d16a40959f908465a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tsrQDZXj8bQ6ArtQS1M1MA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@volkanolmez" rel="noopener ugc nofollow" target="_blank">沃尔坎·奥尔梅斯</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="b689" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">映射在Solidity编程语言中起着重要的作用。这些散列表可以有一个键和值。当我们使用它们时，有一些警告，特别是来自其他编程语言的警告。让我们在本文中探索它们。</p><h1 id="6aef" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">映射键和值</h1><p id="e46c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">映射本质上是哈希表，所以这意味着键被保存为哈希表。为了访问该值，key被散列并在映射表中找到。</p><h1 id="ba8c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">限制</h1><p id="9d3e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">映射可以是状态变量、函数中的存储引用类型或库函数的参数。映射不能返回，也不能在包含数组的结构或数组中使用。</p><p id="894e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">密钥类型可以是任何内置类型、字节、字符串或枚举值。不允许使用我们定义的类型。这是因为Solidity知道如何散列值。</p><p id="6ae0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值类型可以是任何类型——内置类型或我们定义的类型。它甚至可以是创建双哈希表的映射。</p><h1 id="8605" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">从映射读取和写入</h1><p id="b53b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">让我们回顾一下如何在映射中读写数据。假设我们想要建立一个幸运数字注册中心。每个有钱包地址的人都可以设置和读取他们的幸运数字。</p><p id="d2c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要建立幸运数字的映射。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="1451" class="mx lw it mt b gy my mz l na nb">mapping(address =&gt; uint256) private luckyNumbers;</span></pre><p id="e610" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们将访问级别设置为public，默认情况下getter函数是编译的。</p><h1 id="337d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">获取映射中的值</h1><p id="d116" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要从映射中获取值，我们需要知道键。后台的Solidity会对其进行哈希处理，从哈希表中找到。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="bf18" class="mx lw it mt b gy my mz l na nb">function getMyLuckyNumber() external view returns(uint256) {<br/>  require(luckyNumbers[msg.sender] != 0, "0 can't be lucky");</span><span id="1c9b" class="mx lw it mt b gy nc mz l na nb">  return luckyNumbers[msg.sender];<br/>}</span></pre><p id="5381" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果值不存在，我们得到默认值，在<code class="fe nd ne nf mt b">uint256</code>的情况下是零。</p><h1 id="8f48" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">设置映射中的值</h1><p id="264c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们需要一个定义类型的键和值，映射可以在设置值时保存它。请注意，如果已经设置了值，这也会更新该值。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="e3ab" class="mx lw it mt b gy my mz l na nb">function setMyLuckyNumber(uint256 number) external {<br/>  require(number &gt; 0, "Can't be set to zero");</span><span id="3a28" class="mx lw it mt b gy nc mz l na nb">  luckyNumbers[msg.sender] = number;<br/>}</span></pre><h1 id="53e8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="8877" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">映射类型实际上是Solidity编程语言中带有键和值的散列表。有一些限制，特别是我们可以定义为关键的东西。我们需要密钥来从映射中获取数据。记住我们在值中使用的类型的默认值，以防值没有被设置。当我们设置值时，我们也在覆盖旧的值。</p><h1 id="c97a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">链接</h1><ul class=""><li id="c2e3" class="ng nh it lb b lc mn lf mo li ni lm nj lq nk lu nl nm nn no bi translated"><a class="ae ky" href="https://gist.github.com/fassko/488573feba1cf976b5854faeb1fd2ba8" rel="noopener ugc nofollow" target="_blank">样本代码</a></li><li id="333e" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="https://docs.soliditylang.org/en/v0.8.13/types.html" rel="noopener ugc nofollow" target="_blank">官方文件</a></li><li id="5f13" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="https://solidity-by-example.org/mapping/" rel="noopener ugc nofollow" target="_blank">实例的可靠性——映射</a></li></ul></div></div>    
</body>
</html>