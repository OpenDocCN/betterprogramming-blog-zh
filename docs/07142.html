<html>
<head>
<title>Testing MVVM in Swift and Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在斯威夫特和科特林测试MVVM</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/testing-mvvm-in-swift-and-kotlin-ccb55e462760?source=collection_archive---------4-----------------------#2020-12-10">https://betterprogramming.pub/testing-mvvm-in-swift-and-kotlin-ccb55e462760?source=collection_archive---------4-----------------------#2020-12-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5b8f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">编写测试的最佳方法并不明显</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/750dfc762cfa0ee11390cad9122c277e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-OV6lMGaJzXCuAcL"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">杰森·库德里特在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="17bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在移动的早期，客户端测试主要围绕UI测试。苹果推出了一项名为UIAutomation的技术，最终在2016年随着Xcode 8的发布<a class="ae kv" href="https://stackoverflow.com/a/34079537" rel="noopener ugc nofollow" target="_blank">彻底抛弃了这项技术。Android </a><a class="ae kv" href="https://github.com/android/testing-samples" rel="noopener ugc nofollow" target="_blank">测试样本</a>库直到2014年才创建。</p><p id="6332" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为UI测试需要自上而下的方法，如果你大量地重新设计你的UI，测试将会中断。此外，UI测试本身并不处理从相关系统中产生的各种逻辑状态，例如网络故障响应。确认一个按钮在点击时改变颜色通常不如确认应用程序在收到服务器的500响应时正确响应有价值。UI测试还需要一个模拟器来运行，在笔记本电脑上启动通常需要几十秒，在网络上运行时甚至需要更长时间(比如像AWS <a class="ae kv" href="https://aws.amazon.com/device-farm/" rel="noopener ugc nofollow" target="_blank"> Device Farm </a>这样的服务)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/f9bb4fa9db86bd26150f0de6941f2eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/1*lycgnXrU-AeJwW5N6m79TQ.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我花了多少时间看这个屏幕？</p></figure><p id="ca76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然Android最终发布了<a class="ae kv" href="https://developer.android.com/training/testing/espresso" rel="noopener ugc nofollow" target="_blank"> Espresso </a>和Apple发布了<a class="ae kv" href="https://developer.apple.com/documentation/xctest?language=objc" rel="noopener ugc nofollow" target="_blank"> XCTest </a>，但是我们在<a class="ae kv" href="https://medium.com/perry-street-software-engineering/kotlin-in-xcode-swift-in-android-studio-26a4ace6fc72" rel="noopener">干净的MVVM架构</a>中的测试方法不重视UI测试，而是专注于ViewModel层的测试。</p><p id="fd0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一般来说，我们首先为存储库编写测试，然后为视图模型编写测试，如果有必要的话(因为视图模型层无法测试所有条件)，还有逻辑层。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/3b2212386ee21964b4266e6027e5c41e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mHJTRaLd_hqJO-KA2NMTSQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:作者</p></figure><p id="ac3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过将测试首先集中在ViewModel上，可以在不依赖模拟器的情况下非常快速地运行测试。在Android上，我们通过使用<a class="ae kv" href="https://developer.android.com/studio/test" rel="noopener ugc nofollow" target="_blank">本地单元测试</a>实现了这一点，这些测试运行在您机器的本地Java虚拟机上，没有Android框架依赖性。在iOS上，我们正在将视图模型、逻辑和存储库类迁移到<a class="ae kv" href="https://developer.apple.com/documentation/swift_packages" rel="noopener ugc nofollow" target="_blank"> Swift包</a>中。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="2fc7" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">胜利的依赖注入</h1><p id="a8a1" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">无论你是否进行BDD或TDD测试，你都要考虑在你的测试中使用<a class="ae kv" href="https://www.freecodecamp.org/news/a-quick-intro-to-dependency-injection-what-it-is-and-when-to-use-it-7578c84fa88f/" rel="noopener ugc nofollow" target="_blank">依赖注入</a>。如果你不这样做，那么在每个测试的开始，你将需要调用一个方法(可能被命名为类似于<code class="fe my mz na nb b">buildContext</code>的东西)来有效地构造所有必要的视图模型、逻辑和存储库类，从而作为一个轻量级的DI系统。</p><p id="4dba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是阿迪系统的一个基本用法:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="0834" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是我们如何在测试文件的开头设置测试:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="a680" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">模仿呢？</h1><p id="4bba" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">使用干净MVVM架构的一个主要好处是，如果你遵循了这个模式，你应该只需要模仿<a class="ae kv" href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html" rel="noopener ugc nofollow" target="_blank">外层干净组件</a>——所有的API，以及可选的本地存储类。</p><p id="95c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用<a class="ae kv" href="https://site.mockito.org/" rel="noopener ugc nofollow" target="_blank"> mockito </a>在Android上嘲讽很直接。下面是如何在<a class="ae kv" href="https://insert-koin.io/" rel="noopener ugc nofollow" target="_blank"> Koin </a>中定义一个模拟API，注入它，然后在测试开始时覆盖您的模拟:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="7deb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Swift是唯一缺少模仿库的现代语言之一。因此，您需要为每个API类定义具体的类，并公开一个可以直接分配的<code class="fe my mz na nb b">var</code>来控制响应。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="5589" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">更好的BDD结构</h1><p id="76d3" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">移动应用可以被认为是用户导航的一系列状态转换。例如，设想约会应用程序的匹配功能:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/51aae6ab5858b01a09c60f6b71200592.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*pe9PMLis8Prky9LVsexSiw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">通过匹配特征的示例流。作者照片。</p></figure><p id="51ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦您的应用程序达到给定的复杂程度，测试中可能会有一个重要的初始设置，以达到您试图评估的状态。为了清理我们的测试并减少冗余代码，我们可以编写BDD测试，利用代码嵌套来重用初始化和设置块。我们可以在Java中使用<a class="ae kv" href="https://junit.org/junit5/" rel="noopener ugc nofollow" target="_blank"> JUnit </a>和在Swift中使用<a class="ae kv" href="https://github.com/Quick/Quick" rel="noopener ugc nofollow" target="_blank"> Quick </a>来获得特定于领域的语言，这将帮助我们编写更短的BDD风格的测试。</p><p id="9240" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们想测试我们的指令卡是否显示在匹配堆栈的开头，那么在Quick中可能是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="0c67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是使用Junit在BDD中构建的相同测试:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="fcc1" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">接下来</h1><p id="de48" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">让我们来谈谈我们<a class="ae kv" href="https://itnext.io/testing-asynchronicity-in-swift-kotlin-4926936eae28" rel="noopener ugc nofollow" target="_blank">如何在Swift和Kotlin中测试异步性</a>。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="224b" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">本系列的更多内容</h1><ul class=""><li id="b41e" class="nf ng iq ky b kz mt lc mu lf nh lj ni ln nj lr nk nl nm nn bi translated"><a class="ae kv" href="https://medium.com/perry-street-software-engineering/kotlin-in-xcode-swift-in-android-studio-26a4ace6fc72" rel="noopener">在斯威夫特&amp;科特林</a>清洗MVVM</li><li id="2991" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><a class="ae kv" href="https://medium.com/p/721bbc6f8c07" rel="noopener">Swift中的视图模型&amp; Kotlin </a></li><li id="08d8" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><a class="ae kv" href="https://itnext.io/logic-classes-in-swift-kotlin-f7ac1f295839#4bdb-3e583789601" rel="noopener ugc nofollow" target="_blank">Swift中的逻辑类&amp; Kotlin </a></li><li id="b847" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><a class="ae kv" href="https://medium.com/perry-street-software-engineering/repositories-and-models-in-swift-kotlin-df9ae2c84cb7" rel="noopener">Swift中的存储库和域模型&amp; Kotlin </a></li><li id="0040" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><a class="ae kv" href="https://medium.com/perry-street-software-engineering/api-classes-in-swift-kotlin-a2cb90d3906d" rel="noopener">Swift中的API类&amp; Kotlin </a></li><li id="ba65" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><a class="ae kv" href="https://medium.com/p/f5416dec42ea" rel="noopener">Swift中的视图&amp; Kotlin </a></li><li id="df54" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">在Swift &amp; Kotlin测试MVVM←<em class="nt">你在这里</em></li><li id="e8aa" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><a class="ae kv" href="https://itnext.io/testing-asynchronicity-in-swift-kotlin-4926936eae28" rel="noopener ugc nofollow" target="_blank">测试Swift中的异步性&amp;科特林</a></li><li id="84d2" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><a class="ae kv" href="https://medium.com/p/7057230600aa" rel="noopener">清洁MVVM总结</a></li></ul><h1 id="fa0f" class="mb mc iq bd md me nu mg mh mi nv mk ml jw nw jx mn jz nx ka mp kc ny kd mr ms bi translated">你可能喜欢的其他系列</h1><p id="ed5f" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated"><a class="ae kv" href="https://itnext.io/a-visual-history-of-web-api-architecture-c36044df2ac7" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">清理API架构(2021) </strong> </a> <strong class="ky ir"> <br/> </strong>构建现代API端点时的类、执行模式、抽象。</p><p id="dbfd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://proandroiddev.com/android-activity-lifecycle-considered-harmful-98a5b00d287" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> Android活动生命周期被认为有害</strong></a><strong class="ky ir">(2021)<br/></strong>Android进程死亡，不可解释的NullPointerExceptions，以及你现在就需要的MVVM生命周期</p><h1 id="fea3" class="mb mc iq bd md me nu mg mh mi nv mk ml jw nw jx mn jz nx ka mp kc ny kd mr ms bi translated">关于作者</h1><p id="7fc0" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">埃里克·西尔弗伯格(Eric Silverberg)是佩里街软件公司(Perry Street Software)的首席执行官，发行LGBTQ+约会应用程序(LGBTQ+ dating apps)和SCRUFF，在全球拥有2000多万会员。</p></div></div>    
</body>
</html>