<html>
<head>
<title>Swift on AWS Lambda Performs Like Node and Python, Using Swift-Sprinter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Lambda上的Swift使用Swift-Sprinter，表现类似于Node和Python</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swift-on-aws-lambda-performs-like-node-and-python-using-swift-sprinter-d920521130f1?source=collection_archive---------6-----------------------#2020-03-01">https://betterprogramming.pub/swift-on-aws-lambda-performs-like-node-and-python-using-swift-sprinter-d920521130f1?source=collection_archive---------6-----------------------#2020-03-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e8c7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">针对Swift的AWS定制运行时基准测试</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cc99a77f6b56b583ece4644d770fcb76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z8IGhrS0aCJJb4aNn7gQUw.png"/></div></div></figure><p id="50df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">无服务器环境中的性能调优是保持后端响应和低成本的关键。</p><p id="0330" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本文将通过几个性能测试来理解使用框架<a class="ae lq" href="https://github.com/swift-sprinter/aws-lambda-swift-sprinter" rel="noopener ugc nofollow" target="_blank"> Swift-Sprinter </a>用Swift编写的AWS Lambda的行为，并将其与流行语言和不同的配置和选项进行比较。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="5a15" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">什么是λ？</h1><p id="bb2c" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">Lambda是AWS资源提供功能即服务(FAAS)计算能力。它充当更广泛服务类别的构建模块，众所周知的是<em class="mv">无服务器</em>。</p><p id="83bc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">与其他无服务器模块一样，它具有以下特性:</p><ul class=""><li id="9bcb" class="mw mx it kw b kx ky la lb ld my lh mz ll na lp nb nc nd ne bi translated">它是被管理的。</li><li id="ff50" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">这是自动缩放。</li><li id="4711" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">它是高度可用的。</li><li id="4dd2" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">它是按使用付费的。</li></ul><p id="f34b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">除了常见的无服务器功能，Lambda:</p><ul class=""><li id="e89b" class="mw mx it kw b kx ky la lb ld my lh mz ll na lp nb nc nd ne bi translated">包含运行所需的代码。</li><li id="34c2" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">是事件驱动的。</li><li id="bd42" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">支持在兼容的Linux上运行多种语言。</li><li id="3252" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">它运行的时间最长。</li></ul></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="19e3" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">AWS Lambda如何工作</h1><p id="c4c9" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">基于EC2 VM之上的<a class="ae lq" href="https://aws.amazon.com/blogs/aws/firecracker-lightweight-virtualization-for-serverless-computing/" rel="noopener ugc nofollow" target="_blank">鞭炮</a>的AWS Lambda架构，已经被构建为可自动伸缩的。</p><h2 id="c5cc" class="nk lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated"><strong class="ak">冷启动</strong></h2><p id="1efa" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">第一次调用Lambda时，通过复制、初始化和运行代码来准备一个新的worker实例。</p><p id="455f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个过程被称为<em class="mv">冷启动</em>，每次Lambda环境添加一个新的worker实例来扩展时都会发生。一旦worker启动，它就接收事件，处理它，然后对下一个处于等待状态的事件执行请求。</p><h2 id="5157" class="nk lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated"><strong class="ak">热启动</strong></h2><p id="e68e" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">一旦Lambda worker启动，下一次执行就是对即将到来的事件进行纯粹的处理，因为不再需要设置worker。</p><p id="a5ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最终，几分钟后，工作人员没有收到任何事件，而是倾向于缩小规模并释放未使用的计算资源。</p><h2 id="edb2" class="nk lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated"><strong class="ak">计算性能</strong></h2><p id="07a3" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">Lambda计算性能取决于所使用的语言/运行时、代码和所提供的内存量，这些也决定了底层CPU的能力。</p><p id="c4ec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">内存—函数在执行过程中可用的内存量。在128 MB和3,008 MB之间选择一个容量<a class="ae lq" href="https://docs.aws.amazon.com/lambda/latest/dg/limits.html" rel="noopener ugc nofollow" target="_blank">，增量为64 MB。</a></p><p id="4223" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Lambda根据配置的内存量线性分配CPU能力。在1，792 MB时，一个函数相当于一个完整的vCPU(每秒一个vCPU-秒信用)。</p><p id="20e5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了在相同的条件下进行性能评估，所有的Lambdas都设置了256 MB的内存。这种配置给出了vCPU的1/7的λ。</p><h2 id="1cb3" class="nk lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated"><strong class="ak">调配并发</strong></h2><p id="dbf8" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">为了减少冷启动的次数，可以利用一个名为<a class="ae lq" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html#configuration-concurrency-provisioned" rel="noopener ugc nofollow" target="_blank"> <em class="mv">的新功能，提供并发</em> </a>，使一些Lambdas始终保持温暖。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="f43a" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">如何评估绩效</h1><p id="301a" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">Lambda性能非常重要，因为这项服务是以“按使用付费”的方式出售的。保持较低的执行时间和内存使用量有助于减少AWS Lambda的持续<a class="ae lq" href="https://aws.amazon.com/lambda/pricing/" rel="noopener ugc nofollow" target="_blank">成本</a>。</p><p id="d7b2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">AWS Lambda上的语言性能定义如下:</p><ul class=""><li id="60e6" class="mw mx it kw b kx ky la lb ld my lh mz ll na lp nb nc nd ne bi translated">要执行的代码的大小。</li><li id="c3ea" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">使用的内存量。</li><li id="f904" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">执行速度。</li></ul><p id="e654" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一个简单的“Hello，World”的执行给出了该语言如何执行一个非常基本的任务的粗略想法，并且在评估该语言的AWS Lambda运行时时非常准确。</p><p id="3a5e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">繁重的计算任务可能会极大地改变“Hello，World”基准测试的结果，因为在这种情况下，测试将在处理计算复杂性方面利用语言效率，而不是AWS Lambda运行时。</p><p id="dd19" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了简单起见，本文将只考虑“Hello，World”基准测试，将验证其他工作负载效率的任务留给读者。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="5170" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">代码和尺寸</h1><p id="2c7a" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">为了与Swift的性能进行比较，Hello World示例已经用不同的语言实现。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/2a370fd69b28bf6d8f533f34c7ac157a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wc9aAkHVQgz0b9NCjNqBDA.png"/></div></div></figure><p id="9c59" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上表中是用于测试的配置。</p><h2 id="2587" class="nk lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated">Swift与其他语言</h2><p id="04bc" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">首先要注意的是，AWS为Ruby、Node.js、Python、Java、<a class="ae lq" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Go </a>和<a class="ae lq" href="https://dotnet.microsoft.com/download/dotnet-core/2.1" rel="noopener ugc nofollow" target="_blank">提供了运行时。网芯2.1 </a>。这给了这些语言一个优势，因为它们没有额外加载代码的自定义运行时的开销。</p><p id="bd4d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Hello World示例非常简单，随着代码添加更多的依赖项，代码大小可能会完全不同。</p><p id="2f4c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用于Node.js、Python、Go、Ruby、Java、C#和<a class="ae lq" href="https://www.rust-lang.org/" rel="noopener ugc nofollow" target="_blank"> Rust </a>的代码与文章<a class="ae lq" href="https://medium.com/the-theam-journey/benchmarking-aws-lambda-runtimes-in-2019-part-i-b1ee459a293d" rel="noopener"><em class="mv">Benchmarking AWS Lambda runtimes 2019</em></a>提供的代码相同，只是增加了Swift示例。</p><h2 id="587e" class="nk lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated">快速构建和运行时</h2><p id="0754" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">Swift中添加了许多版本的Hello World代码，以比较以下各项的性能:</p><ul class=""><li id="953b" class="mw mx it kw b kx ky la lb ld my lh mz ll na lp nb nc nd ne bi translated">带有<a class="ae lq" href="https://github.com/swift-server/async-http-client" rel="noopener ugc nofollow" target="_blank">异步客户端</a>和<a class="ae lq" href="https://curl.haxx.se/libcurl/" rel="noopener ugc nofollow" target="_blank"> libcurl </a>的Swift运行时。</li><li id="6fe8" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">异步客户端与<a class="ae lq" href="https://github.com/swift-server/async-http-client/pull/105" rel="noopener ugc nofollow" target="_blank">带连接池的异步客户端</a>。</li><li id="0fc7" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated"><a class="ae lq" href="https://github.com/swift-sprinter" rel="noopener ugc nofollow" target="_blank">Swift-Sprinter</a>vs<a class="ae lq" href="https://github.com/fabianfett/swift-lambda-runtime" rel="noopener ugc nofollow" target="_blank">Swift-Lambda-Runtime</a>。</li><li id="598b" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">用<a class="ae lq" href="https://github.com/swift-sprinter/aws-lambda-swift-sprinter" rel="noopener ugc nofollow" target="_blank">Ubuntu</a>vs<a class="ae lq" href="https://fabianfett.de/amazonlinux-swift" rel="noopener ugc nofollow" target="_blank">亚马逊Linux 2 </a>构建的Swift代码。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/51462e180b047034d850cd3e4ed6ff80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8DAUQ7TNVscZNPSAkL4R9A.png"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">benchmark-swift-NIO-hello —带NIO异步客户端的SwiftSprinter</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/5c647af0921a73aebcf0b9df32c5e38a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r5TGkX1kYGDrnJUfLQyI-w.png"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">benchmark-swift-curl-hello-swift sprinter with libCURL</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/299685aacab78eba50c5b99170cbb7ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ujXvUSp5aH9j2Q4tqRqQog.png"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">benchmark-al-ffett-hello —带NIO的LambdaSwiftRuntime</p></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="2887" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">工作量</h1><p id="18ec" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">工作负载已按照最后引用的文章进行了准备。</p><p id="3512" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">工具<a class="ae lq" href="https://artillery.io" rel="noopener ugc nofollow" target="_blank">火炮</a>已经被用来测试兰姆达斯。API网关已配置为将Lambdas发布为HTTPS端点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/dc03fd7aaaf6ee38a26b4e374abbb302.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAzfXNnHMY9TvAHV-0rcfw.png"/></div></div></figure><p id="f98e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">调用之后，所有的指标都存储在<a class="ae lq" href="https://aws.amazon.com/cloudwatch" rel="noopener ugc nofollow" target="_blank"> AWS CloudWatch </a>中。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="a56c" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">冷启动性能</h1><p id="b19f" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">使用<a class="ae lq" href="https://github.com/lumigo-io/lumigo-CLI" rel="noopener ugc nofollow" target="_blank"> lumigo-CLI </a>收集冷启动性能。</p><pre class="kj kk kl km gt od oe of og aw oh bi"><span id="3f17" class="nk lz it oe b gy oi oj l ok ol">lumigo-cli analyze-lambda-cold-starts</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/df44a0dd5a56377bc23a2a0a862525d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eCGtAMgbLwZvf8YbmAlW9w.png"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">冷启动性能</p></figure><ul class=""><li id="5541" class="mw mx it kw b kx ky la lb ld my lh mz ll na lp nb nc nd ne bi translated">Rust(~ 30毫秒)和Go(~ 75毫秒)的冷启动性能最好，其次是Ruby(124毫秒)、Python(~ 127毫秒)和Node.js (~128毫秒)。</li><li id="b215" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">第二组包含使用Amazon Linux 2(~ 190毫秒/~ 219毫秒)和C#构建的Swift。网芯(~224ms)。</li><li id="aeb9" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">最后一组包含用Ubuntu (~329ms/~338ms)和Java (~358ms)构建的Swift。</li><li id="d00a" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">用Amazon Linux 2和Ubuntu构建的Swift之间的区别是大约20 MB的包大小，它在冷启动时支付大约140 ms。</li></ul></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="7163" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">热启动性能</h1><p id="5ab1" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">为了展示热启动性能，我们在CloudWatch上使用了一个自定义仪表盘:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3a4be1c72a07c2bbe1332d4d925e4fef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Npvy5vfATd6iT9eTu5w6gA.png"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">Java/Go/Ruby</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/aef270e4be82cab453cba54ce9b7f1a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sHEj1DlytAP05cXOY1V9Qw.png"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">Python/Rust/C#</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/5d08a57439992231795d4da936a65e51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yNdYuXj1sU_bT2Ol_PIm7g.png"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">使用亚马逊Linux 2构建的Swift</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/97c15c36f9c080179d04678e31738649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o0cJwSluon54UGWVzAyj2Q.png"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">用Ubuntu构建的C#/NodeJS/Swift</p></figure><p id="8f92" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">平均而言，最佳性能由C#提供。Net (~0.26 ms)和Go (~0.44 ms)。</p><p id="aeb5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">性能在1毫秒左右，我们有node . js(~ 1.06毫秒)、Java (~1.16毫秒)、Rust (~1.17毫秒)、Swift with NIO和用Ubuntu构建的连接池(~ 1.19毫秒)、Python (~1.34)、Swift with NIO (~1.56毫秒)。</p><h2 id="0a5a" class="nk lz it bd ma nl nm dn me nn no dp mi ld np nq mk lh nr ns mm ll nt nu mo nv bi translated">快速构建比较</h2><ul class=""><li id="6ed4" class="mw mx it kw b kx mq la mr ld oo lh op ll oq lp nb nc nd ne bi translated">带<a class="ae lq" href="https://github.com/swift-server/async-http-client" rel="noopener ugc nofollow" target="_blank"> AsyncHTTPClient </a> NIO的Swift运行时比带libcurl的Swift性能更好，优势约为0.65毫秒。</li><li id="bb92" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated"><a class="ae lq" href="https://github.com/swift-server/async-http-client/pull/105" rel="noopener ugc nofollow" target="_blank">带连接池的AsyncHTTPClient NIO</a>是性能最好的，在没有连接池的相同版本上优势约为0.30 ms，整体性能约为1.19ms，与Node.js、Java和Python相当。</li><li id="c0cc" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated"><a class="ae lq" href="https://github.com/swift-sprinter" rel="noopener ugc nofollow" target="_blank"> Swift-Sprinter </a>比<a class="ae lq" href="https://github.com/fabianfett/swift-lambda-runtime" rel="noopener ugc nofollow" target="_blank"> Swift-Lambda-Runtime </a>表现稍好，相差约0.20毫秒</li><li id="be33" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">使用<a class="ae lq" href="https://github.com/swift-sprinter/aws-lambda-swift-sprinter" rel="noopener ugc nofollow" target="_blank"> Ubuntu </a>与<a class="ae lq" href="https://fabianfett.de/amazonlinux-swift" rel="noopener ugc nofollow" target="_blank"> Amazon Linux 2 </a>构建的Swift代码在热启动时的执行时间相似。</li></ul></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="2aaa" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">我为什么要在AWS Lambda上使用Swift？</h1><p id="08a5" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">Swift于2015年12月被苹果开源，已经从iOS和Mac上的移动开发发展到Ubuntu等Linux服务器平台。</p><p id="2aad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">任何来自iOS的人都知道，这种语言<a class="ae lq" href="https://swift.org/about/" rel="noopener ugc nofollow" target="_blank">安全、快速、富于表现力</a>。与Node.js和Python等脚本语言相比，Swift增强了安全性和性能，避免了因语言未定义行为和缺乏类型检查而产生的恶意副作用。</p><p id="1617" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">与Go或Rust等相对较新的语言相比，Swift增加了大量移动开发者和爱好者社区的优势。</p><p id="f665" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">苹果在<a class="ae lq" href="https://github.com/apple/swift-nio/" rel="noopener ugc nofollow" target="_blank"> Swift NIO </a>上的投资和<a class="ae lq" href="https://swift.org/package-manager/" rel="noopener ugc nofollow" target="_blank"> Swift包管理器</a>的可用性推动了许多<a class="ae lq" href="https://swift.org/server/" rel="noopener ugc nofollow" target="_blank">服务器端</a>项目和库的开发，包括<a class="ae lq" href="https://github.com/swift-server/async-http-client" rel="noopener ugc nofollow" target="_blank"> HTTP客户端</a>、<a class="ae lq" href="https://github.com/vapor/nio-postgres" rel="noopener ugc nofollow" target="_blank"> Postgres客户端</a>、<a class="ae lq" href="https://github.com/mordil/swift-redis-nio-client" rel="noopener ugc nofollow" target="_blank"> Redis客户端</a>、<a class="ae lq" href="https://github.com/swift-aws/aws-sdk-swift" rel="noopener ugc nofollow" target="_blank"> AWS SDK Swift </a>、<a class="ae lq" href="https://github.com/mongodb/mongo-swift-driver" rel="noopener ugc nofollow" target="_blank"> MongoDB Swift驱动程序</a>、<a class="ae lq" href="https://github.com/grpc/grpc-swift/tree/nio" rel="noopener ugc nofollow" target="_blank">gRPC Swift</a>……等等。</p><p id="c13b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://github.com/swift-sprinter/aws-lambda-swift-sprinter" rel="noopener ugc nofollow" target="_blank"> Swift-Sprinter </a>存储库为Swift提供了AWS Lambda定制运行时，并基于Ubuntu，以保证构建过程和定义良好的管道。该存储库包含使用和持续集成的示例。</p><p id="2e22" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于任何想尝试的人来说，库<a class="ae lq" href="https://github.com/fabianfett/swift-lambda-runtime" rel="noopener ugc nofollow" target="_blank"> Swift-Lambda-Runtime </a>提供了一个基于亚马逊Linux 2的Swift版本。</p><p id="2858" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Swift在无服务器框架如<a class="ae lq" href="https://github.com/swift-sprinter/aws-lambda-swift-sprinter-core" rel="noopener ugc nofollow" target="_blank"> AWS </a>、<a class="ae lq" href="https://github.com/apache/openwhisk-runtime-swift" rel="noopener ugc nofollow" target="_blank">open whish</a>和<a class="ae lq" href="https://github.com/SalehAlbuga/azure-functions-swift" rel="noopener ugc nofollow" target="_blank"> Azure </a>上的可用性，以及在虚拟机、Docker、Kubernetes和本地硬件上的传统API/web框架如<a class="ae lq" href="https://vapor.codes" rel="noopener ugc nofollow" target="_blank"> Vapor </a>、<a class="ae lq" href="https://github.com/IBM-Swift/Kitura" rel="noopener ugc nofollow" target="_blank"> Kitura </a>和<a class="ae lq" href="https://perfect.org" rel="noopener ugc nofollow" target="_blank"> Perfect </a>的可用性开启了全栈Swift开发之路。</p><p id="1a93" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本文并不涵盖特定云提供商的选择，因为这取决于不同的业务原因，而不是技术考虑。</p><p id="2a45" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在AWS Lambda上使用Swift比在容器上使用Swift的优势是有效的，当使用它构建的应用程序没有恒定的工作负载，并且需要可伸缩性，同时保持低成本时。无服务器和容器并不是灵丹妙药，需要根据每个用例进行评估。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="e4bb" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">考虑</h1><p id="30e6" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">AWS Lambda运行时的选择不仅仅取决于性能考虑。</p><p id="ae15" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">考虑解决方案的总拥有成本总是很重要的，不仅要考虑无服务器的裸成本，还要考虑可靠性、可维护性、弹性、可重用性、安全性、平台支持、第三方框架的可用性、开发人员社区成熟度、开发工具、许可证、开发技能的可用性以及关于特定用例的学习曲线。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="e5a6" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">参考</h1><div class="or os gp gr ot ou"><a href="https://dev.to/sosnowski/anatomy-of-aws-lambda-1i1e" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">自动气象站Lambda剖析</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">AWS Lambda是一项著名的服务，它普及了云计算中无服务器的理念。这不是第一次…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">开发到</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi ks ou"/></div></div></a></div><div class="or os gp gr ot ou"><a href="https://medium.com/the-theam-journey/benchmarking-aws-lambda-runtimes-in-2019-part-i-b1ee459a293d" rel="noopener follow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">2019年AWS Lambda运行时基准测试(第一部分)</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">你有没有想过如果你使用不同的运行时，你的AWS Lambda会不会更快？</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">medium.com</p></div></div><div class="pd l"><div class="pj l pf pg ph pd pi ks ou"/></div></div></a></div><div class="or os gp gr ot ou"><a href="https://read.acloud.guru/comparing-aws-lambda-performance-when-using-node-js-java-c-or-python-281bef2c740f" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">比较使用Node.js、Java、C#或Python时的AWS Lambda性能</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">当使用AWS Lambda支持的不同编程语言时，一个函数的执行有多大不同？</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">read.acloud.guru</p></div></div><div class="pd l"><div class="pk l pf pg ph pd pi ks ou"/></div></div></a></div><div class="or os gp gr ot ou"><a href="https://aws.amazon.com/blogs/compute/new-for-aws-lambda-predictable-start-up-times-with-provisioned-concurrency/" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">AWS Lambda的新功能-可预测的启动时间，提供并发| Amazon Web Services</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">自从五年前推出AWS Lambda以来，成千上万的客户，如iRobot、Fender和Expedia，已经…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">aws.amazon.com</p></div></div><div class="pd l"><div class="pl l pf pg ph pd pi ks ou"/></div></div></a></div></div></div>    
</body>
</html>