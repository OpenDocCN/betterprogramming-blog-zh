<html>
<head>
<title>How To Build a Spotify Jukebox Using a Facebook Messenger Bot in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Node.js中使用Facebook Messenger Bot构建Spotify点唱机</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-build-a-spotify-jukebox-using-a-facebook-messenger-bot-in-node-js-70c863337331?source=collection_archive---------9-----------------------#2019-06-04">https://betterprogramming.pub/how-to-build-a-spotify-jukebox-using-a-facebook-messenger-bot-in-node-js-70c863337331?source=collection_archive---------9-----------------------#2019-06-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="86d5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我是如何为社交活动打造一个派对点唱机的</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/aceb0cc2404e5e188394d1a3245d3203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*f6oHvv8JKu4Lh0hDdJn2Yg.png"/></div></figure><p id="c6c7" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">当我的朋友们觉得可以一起喝几杯时，我经常自愿把我的房子作为聚会场所。天知道为什么——我一定是真的喜欢做回收利用之类的事情。无论如何，不久前我疯狂地将朋友的歌曲请求输入Spotify，我有一个想法，要建立某种前端应用程序来自动化这个过程，让我不用整晚充当DJ。</p><p id="a39d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我开始思考哪些平台适合做这件事——用Angular编写的某种单页web应用程序？或者甚至是原生的iOS/Android应用程序。我担心对于那些只想把一首歌放入队列的人来说，一个应用程序会有多方便，所以我选择了一个几乎每个人都已经在手机上安装的平台——Facebook Messenger。</p><p id="2c05" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我创建的应用程序接受来自用户的消息，将查询输入Spotify的搜索引擎，然后将这些结果返回给用户，并带有接受或检索更多结果的按钮。</p><p id="729c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这篇文章将带你了解我是如何做到这一点的。附带的源代码可以在这里找到:</p><div class="lk ll gp gr lm ln"><a href="https://github.com/alexkitch/SpotifyJukebox" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab fo"><div class="lp ab lq cl cj lr"><h2 class="bd ir gy z fp ls fr fs lt fu fw ip bi translated">alexkitch/SpotifyJukebox</h2><div class="lu l"><h3 class="bd b gy z fp ls fr fs lt fu fw dk translated">使用Facebook Messenger bot通过Node.js创建Spotify“jukebox”的演示…</h3></div><div class="lv l"><p class="bd b dl z fp ls fr fs lt fu fw dk translated">github.com</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb kl ln"/></div></div></a></div><p id="fcb9" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我鼓励你克隆它，跟随文章并注意代码注释，但是我必须强调，由于几个部署方面的考虑，这个<em class="lj">不是</em>的成品——它是一个概念验证，供你构建。</p><p id="efd2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="lj">这不是</em> <strong class="kp ir"> <em class="lj"> </em> </strong> <em class="lj">一本JavaScript或Node教程——你最好具备使用npm、编写JavaScript代码和使用Node.js构建简单web服务器的基本知识。</em></p><p id="f9b1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">所以，事不宜迟…</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="c009" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">Node.js应用程序️</h1><p id="993c" class="pw-post-body-paragraph kn ko iq kp b kq nb jr ks kt nc ju kv kw nd ky kz la ne lc ld le nf lg lh li ij bi translated">该应用程序由三个JavaScript文件组成:</p><p id="396a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir"> index.js </strong>包含Express web服务器设置和路由配置。</p><p id="332a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir"> spotify.js </strong>导出一个spotify实用程序对象，可用于搜索曲目并将曲目添加到点唱机。这个应用程序的想法是在启动时创建一个自动点唱机播放列表，并将曲目添加到该播放列表中。当主持人点击播放列表上的播放时，Spotify会自动将任何新曲目添加到播放队列中。这本质上是Spotify不发布API来修改播放队列本身这一事实的一个变通办法。</p><p id="e77b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir"> messenger.js </strong>导出一个messenger实用程序对象，该对象封装了创建精美的列表模板、按钮、排序搜索结果以及在点击按钮时解读用户意图。</p><p id="1b14" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了让这个例子尽可能简单明了，我没有在源代码中包含单元测试。我建议在构建真实世界的部署应用程序时，总是编写单元测试。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="4fe3" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">Variables️环境部</h1><p id="0d44" class="pw-post-body-paragraph kn ko iq kp b kq nb jr ks kt nc ju kv kw nd ky kz la ne lc ld le nf lg lh li ij bi translated">这个应用程序附带了一组包含在<code class="fe ng nh ni nj b"><em class="lj">.</em>env </code>中的占位符环境变量，我将简要解释如何获得这些变量。</p><p id="16b8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果你使用GitHub这样的源代码控制库来管理你的项目，确保你的<code class="fe ng nh ni nj b">.env</code>文件是<em class="lj">而不是</em>提交的，因为这些变量是高度敏感的信息，应该保密。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="65d2" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">调试安全回调</h1><p id="e6b3" class="pw-post-body-paragraph kn ko iq kp b kq nb jr ks kt nc ju kv kw nd ky kz la ne lc ld le nf lg lh li ij bi translated">为了让Messenger能够在您调试和测试应用程序时向其发送消息，您需要有一个可以访问该应用程序的安全URL。</p><p id="571f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了实现这一点，我使用了一个名为<code class="fe ng nh ni nj b">ngrok</code> <em class="lj">的强大免费工具。</em>从<a class="ae nk" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank">https://ngrok.com/</a>下载并安装/解压该工具</p><p id="7c3c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">启动命令shell，用下面的命令启动<code class="fe ng nh ni nj b">ngrok</code>:</p><pre class="kg kh ki kj gt nl nj nm nn aw no bi"><span id="bb12" class="np mk iq nj b gy nq nr l ns nt">ngrok http 3000</span></pre><p id="408c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="lj">(如果你是Windows用户，你需要先浏览到你解压</em> <code class="fe ng nh ni nj b">ngrok </code> <em class="lj">可执行文件的地方。我将</em> <code class="fe ng nh ni nj b">ngrok </code> <em class="lj">解压到我的Windows目录中以避免这种情况)。</em></p><p id="e734" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">使用这个命令，您将创建一个到本地机器端口3000的HTTP隧道。我在这里相当随意地选择了端口3000——只要在<code class="fe ng nh ni nj b">index.js</code> <em class="lj"> </em>中更新端口号(或者更好的是，在<code class="fe ng nh ni nj b">.env</code> <em class="lj"> </em>文件中指定它)，您就可以自由使用您喜欢的任何端口。</p><p id="c9e2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果一切顺利，<code class="fe ng nh ni nj b">ngrok </code>将初始化并显示您的安全网址:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi nu"><img src="../Images/9561f8776332d98f2ed66860753dcdc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q5c1flixRw9FFGOUU8aOqg.png"/></div></div></figure><p id="d335" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">记下这个URL —您将在下面的部分中用到它。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="e42b" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">创建信使机器人</h1><p id="04cc" class="pw-post-body-paragraph kn ko iq kp b kq nb jr ks kt nc ju kv kw nd ky kz la ne lc ld le nf lg lh li ij bi translated">让这个应用程序工作的第一步是在脸书网站上创建一个机器人。这包括创建一个“应用”和一个支持“页面”——老实说，我觉得这个过程过于繁琐，但相对来说没有痛苦，也不会花太长时间。</p><p id="35da" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">登录https://developers.facebook.com/的脸书，前往脸书开发者门户网站。如果你之前没有注册成为脸书的开发者，你可能会被要求先提供一些初始细节——如果是这种情况，请遵循脸书的指导。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/8c02a594b2427826d5870a998c02ac55.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*n-_ZH8r9A9_E6vGCmLpHzA.png"/></div></figure><p id="e715" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">当您访问脸书开发者门户时，在页面左上角下拉“我的应用”菜单，选择<strong class="kp ir">添加新应用</strong>即可开始。</p><p id="f77a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">填写所需的详细信息，并在满意后点击<strong class="kp ir">创建应用ID </strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/5d0690f0ce0d66090e033e4437cc7a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:476/format:webp/1*Mdgjq7IxERqXomsGPIeSiQ.png"/></div></figure><p id="d002" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">当你的应用程序已经创建，你应该登陆到它的仪表板。</p><p id="efdb" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">要为应用程序添加Messenger功能，请单击左侧菜单上<strong class="kp ir">产品</strong>旁边的<strong class="kp ir"> + </strong>按钮。在接下来的页面中，选择标题为“Messenger”的卡上的<strong class="kp ir">设置</strong>。</p><p id="e3a5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">下面的Messenger设置页面上有几个部分。我们感兴趣的第一部分名为<strong class="kp ir">访问令牌</strong>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi ob"><img src="../Images/6524f3186378eeea8e6087b4e8a6bc41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j0TXyMnkb49GGz_yZ8laNg.png"/></div></div></figure><p id="ad6a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了能够在Messenger上找到你的机器人，你需要为它创建一个脸书“页面”——这将作为机器人的身份。点击<strong class="kp ir">创建新页面</strong>(页面下拉菜单下的小链接)开始这个过程。</p><p id="6805" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在接下来的向导页面中，您将被要求提供一些关于该机器人预期用途的基本信息，例如它是用于企业还是公众人物。为了写这篇文章，我选择了公众人物，但选择权真的在你。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/bcbdabe7c65eaa2c7c8ad730964c4612.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*wmo6foQl17PYyRzKJ9zLOg.png"/></div></figure><p id="dae5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">当您创建完页面后，我建议您选择一个合适的@Username，以便更容易被发现。如果你想给你的机器人一些个性，你可以选择添加一个显示图片和封面，但这完全是可选的。</p><p id="0a5b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">回到访问令牌设置区域，刷新页面。现在，您应该能够从下拉列表中选择您的新页面，并将其与您的bot相关联:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi od"><img src="../Images/ed69d231d59a035c37ba551492175597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bUyRsf-8ZeGwBZoeSh9PNQ.png"/></div></div></figure><p id="fb2c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">您可以看到，脸书希望获得此应用程序的权限，以链接到您的页面。点击<strong class="kp ir">编辑权限</strong>，完成向脸书授予权限的过程——这应该非常简单。完成后，页面访问令牌字段将被填充一个有效的令牌—将这个令牌复制到<code class="fe ng nh ni nj b">.env</code>中的<code class="fe ng nh ni nj b"><strong class="kp ir">MESSENGER_ACCESS_TOKEN</strong></code> <strong class="kp ir"> </strong>变量中。我们向Messenger api发出的每个请求都会发送这个令牌。</p><p id="7e9a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们感兴趣的下一部分叫做<strong class="kp ir">网页挂钩:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oe"><img src="../Images/b173600a3a941a9d4964f2ce7a941018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kNhBl5-kpP09cklp2F0mIQ.png"/></div></div></figure><p id="6fea" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">点击<strong class="kp ir">订阅事件</strong>配置Messenger如何联系您的Node.js应用程序:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi of"><img src="../Images/b393bf9ae372653a7e723dcc0dc5f5ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EbE7_LjAIp1u6aznDc_Dog.png"/></div></div></figure><p id="a7ce" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">首先勾选<strong class="kp ir">消息</strong>和<strong class="kp ir">messaging _ postback</strong>来订阅Messenger的消息通知——非常重要！😉</p><p id="31ce" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">回调URL </strong>定义了您的应用程序所在的安全主机名和您打算响应消息的端点。这应该设置为由<code class="fe ng nh ni nj b">ngrok</code>提供给你的URL，加上/webhook端点。</p><p id="8830" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">验证令牌</strong>是一个任意值，脸书用它来确认回调URL上的应用程序确实是您的。它可以是任何东西——在这个例子中，我选择使用一个随机的GUID。无论您选择什么，将这个值复制到<code class="fe ng nh ni nj b">.env</code>中的<code class="fe ng nh ni nj b"><strong class="kp ir">MESSENGER_VERIFY_TOKEN</strong></code>变量中。当您单击<strong class="kp ir">验证并保存</strong>时，Messenger将尝试将此验证令牌与“挑战”令牌一起发送到您指定的端点。端点只需要验证验证令牌，并在响应正文中返回一个状态200 (OK)和质询令牌。你可以在<em class="lj"> index.js </em>中的<strong class="kp ir"> Webhook </strong> GET路径中看到这段代码。</p><p id="1577" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">运行您的应用程序，确认服务器准备就绪，并在您刚刚完成配置的订阅页面上点击<strong class="kp ir">验证并保存</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/003aa466785d2c9376fea499fac9df7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*C7cmyJamtGciC1_hgsXqBQ.png"/></div></figure><p id="ce23" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果一切正常，对话框应该会关闭，一个绿色的勾号<strong class="kp ir"> Webhooks </strong>会出现在页面的左侧，同时控制台窗口中会显示一条消息:</p><pre class="kg kh ki kj gt nl nj nm nn aw no bi"><span id="52ae" class="np mk iq nj b gy nq nr l ns nt">Server available on port 3000<br/>Responded to Facebook verification request</span></pre><p id="3221" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果您对此有问题，请确保您的安全HTTP隧道正在运行，并且URL和端点是正确的。此外，确保您的防火墙配置正确，允许HTTP访问。</p><p id="932e" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">最后，Messenger设置页面的Webhooks部分现在应该提供为我们的webhook订阅页面事件的功能:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oh"><img src="../Images/e3a009add353868182acdc222f0d868e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CDi2ZwCQ0iZlfdM-xqMKSg.png"/></div></div></figure><p id="27ef" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">点击<strong class="kp ir">‘订阅’</strong>完成此过程。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="1cd8" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">Spotify</h1><p id="5c8e" class="pw-post-body-paragraph kn ko iq kp b kq nb jr ks kt nc ju kv kw nd ky kz la ne lc ld le nf lg lh li ij bi translated">为了将Spotify与应用程序挂钩，你需要在Spotify的开发者门户上创建一个“应用程序”。这将提供访问Spotify服务所需的凭证。</p><p id="1e03" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">前往<a class="ae nk" href="https://developer.spotify.com/" rel="noopener ugc nofollow" target="_blank">https://developer.spotify.com/</a>并前往<strong class="kp ir">仪表板</strong>部分。如果系统提示您登录，请使用您的Spotify凭据登录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/e78b71d5f7b143dabb27fd44c81b06b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*xU2LgSd987_WdmMAw55MCw.png"/></div></figure><p id="2566" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">按照仪表盘上的指导创建应用程序——在接受Spotify的条款和条件之前，您将被要求提供一些基本信息，如名称、描述和应用程序的预期用途。</p><p id="92da" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">完成此过程后，您将进入新应用的仪表盘。本页有一些重要信息需要注意:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/ca4edb8084b95c1facf42a886c64b4d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*SQsauenUYemhR0PLnu06Iw.png"/></div><p class="ok ol gj gh gi om on bd b be z dk translated">客户端ID和客户端机密(出于隐私原因，此处部分隐藏)</p></figure><p id="a88f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">客户端ID </strong>和<strong class="kp ir">客户端机密</strong>都将用于向Spotify进行认证，并获得访问/刷新令牌——这些令牌应分别作为<code class="fe ng nh ni nj b"><strong class="kp ir">SPOTIFY_CLIENT_ID</strong></code>和<code class="fe ng nh ni nj b"><strong class="kp ir">SPOTIFY_CLIENT_SECRET</strong></code> <strong class="kp ir"> </strong>存储在<code class="fe ng nh ni nj b"> .env</code>文件中。</p><p id="8d8f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">Spotify所需的最后一项设置是提供一个回调URL。当应用程序完成登录Spotify的过程时，一个授权码将被发送到这个端点，我们需要这个授权码来获取访问/刷新令牌。您可以通过点击页面右上角的<strong class="kp ir">编辑设置</strong>来指定该端点:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/53333d93f6a4ef17d74843412e8d872b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*fpmNrWaAla-B-dApLwPsGg.png"/></div></figure><p id="39a8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如您所见，我已经提供了来自<code class="fe ng nh ni nj b">ngrok </code>的安全URL，并将<code class="fe ng nh ni nj b"> /spotify</code>作为我的端点。另外，将此应用于<code class="fe ng nh ni nj b"><em class="lj">.</em>env</code> <em class="lj">中的<code class="fe ng nh ni nj b"><strong class="kp ir">SPOTIFY_CALLBACK</strong></code> <strong class="kp ir"> </strong>变量。不要忘记点击页面底部的<strong class="kp ir">保存</strong>,否则什么都不会改变——这让我不知如何是好……</em></p><p id="4bb6" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在<code class="fe ng nh ni nj b"><em class="lj">.</em>env</code>中设置的最后一个变量是<code class="fe ng nh ni nj b"><strong class="kp ir">SPOTIFY_USER_ID</strong></code>。这只是你的标准Spotify用户名。你可以通过访问Spotify网站并进入账户概述页面来找到它。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="3328" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">准备好了吗</h1><p id="0271" class="pw-post-body-paragraph kn ko iq kp b kq nb jr ks kt nc ju kv kw nd ky kz la ne lc ld le nf lg lh li ij bi translated">就是这样！希望您已经获得并保存了应用程序运行所需的所有信息。通过运行<code class="fe ng nh ni nj b"><strong class="kp ir">npm start</strong></code>启动它，您会注意到控制台上打印了一个URL:</p><pre class="kg kh ki kj gt nl nj nm nn aw no bi"><span id="31f1" class="np mk iq nj b gy nq nr l ns nt">Authorization required. Please visit https://accounts.spotify.com/authorize?client_id=f8ea6161a16844addfa&amp;response_type=code&amp;redirect_uri=https://41be75a4.ngrok.io/spotify&amp;scope=playlist-read-private%20playlist-modify%20playlist-modify-private&amp;state=default-state</span></pre><p id="815e" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">按照此网址将应用程序登录到您的Spotify帐户。授权完成后，控制台中将出现一条后续消息:</p><pre class="kg kh ki kj gt nl nj nm nn aw no bi"><span id="aee6" class="np mk iq nj b gy nq nr l ns nt">Spotify is ready!</span></pre><p id="dc4a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">您还会注意到，您的Spotify帐户现在有了一个新的播放列表，其名称与环境变量<code class="fe ng nh ni nj b"><strong class="kp ir">SPOTIFY_PLAYLIST_NAME</strong></code>相匹配。这是自动点唱机将添加其曲目的播放列表。</p><p id="a6dc" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">剩下要做的就是在Messenger上找到你的机器人(或者用你之前选择的用户名访问<a class="ae nk" href="http://m.me/SpotifyJukebox" rel="noopener ugc nofollow" target="_blank">http://m.me/</a>用户名)，然后玩一玩😊</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi op"><img src="../Images/b30f7c8107e7508dba4ee7b5f28cf916.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KcdBhSycGmFQm1F5xMZRBA.png"/></div></div></figure><p id="99e0" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了让你的Messenger机器人响应除你之外的其他人，你需要通过脸书的应用批准流程，你可以在你的应用的仪表板上找到链接。根据我自己的经验，这个过程只需要几个小时，而且似乎只需要一个审批团队向你的机器人发送一些消息，以确保它确实做了你所说的事情。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="7797" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">改进的余地</h1><p id="4d28" class="pw-post-body-paragraph kn ko iq kp b kq nb jr ks kt nc ju kv kw nd ky kz la ne lc ld le nf lg lh li ij bi translated">这个应用程序是这个想法如何工作的一个相当直接的例子，为了避免使本教程过于复杂，我故意把它保持得相当简单。当然，您可能会考虑实施一些改进:</p><p id="c9db" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">存储访问/刷新令牌</strong>，无需在每次应用启动时点击认证链接。</p><p id="8f3b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">开始播放</strong>如果曲目被添加到自动点唱机播放列表，但当前没有音乐播放。</p><p id="d2fb" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">版主，</strong>批准/拒绝歌曲请求，防止不守规矩的派对客人向你的点唱机发送垃圾音乐…</p><p id="ebcf" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">开/关命令</strong>，防止用户向点唱机添加更多曲目。</p><p id="11df" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">部署</strong> —如果你真的想定期运行这个应用程序，那么你肯定会考虑将它部署到一个虚拟主机提供商那里，并用更永久的东西来替换我们从ngrok获得的临时回调URL。我已经成功地将这个应用程序的一个版本部署到AWS ElasticBeanstalk上，我想它也可以被重构以与AWS Lambda一起工作。然而，这超出了本教程的范围。</p><p id="373f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">感谢阅读！我希望这篇教程对你有用，并能激发你去做一些很酷的东西。</p></div></div>    
</body>
</html>