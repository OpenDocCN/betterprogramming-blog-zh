# JavaScript 中闭包和词法范围的简要介绍

> 原文：<https://betterprogramming.pub/a-brief-introduction-to-closures-and-lexical-scoping-in-javascript-8a5866496232>

## “用 ECMAScript 语言编写而不理解闭包，就像编写 Java 而不理解类一样”——道格拉斯·克洛克福特，JSON 之父

![](img/cab8d808061a8e50c224cb8e20a305cc.png)

卡斯帕·卡米尔·鲁宾在 [Unsplash](https://unsplash.com/search/photos/javascript?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

在这篇文章中，我们将讨论 JavaScript 中的闭包和词法范围。理解闭包有助于更好地理解编程本身。如果你打算成为一名职业程序员，关于闭包及其应用的问题会在技术面试中被广泛问到，并且会对你很有帮助。

如果您是一名 JavaScript 开发人员，很可能您已经在使用闭包，只是不知道而已。有太多复杂的例子让你在学习闭包时感到困惑，所以我将使用我能找到的最简单的例子，到本文结束时，你应该对什么是闭包有了基本的理解。让我们开始吧。

# 词法范围

在讨论闭包之前，我们应该对作用域和词法作用域有一个基本的了解。JavaScript 具有带函数作用域的词法作用域，这意味着每个函数创建一个新的作用域。

> 什么是函数作用域？

基本上，在 JavaScript 中，有全局范围和局部范围。

> **全局作用域**:一个 Javascript 文档中只有一个全局作用域，即所有函数之外的区域，你如何识别全局作用域就是定义在全局作用域中的变量可以在代码中的任何地方被访问。
> 
> **局部作用域**:在函数内部声明的变量是函数的局部变量，并且被绑定到相应的局部作用域。这些变量不能在函数之外访问。

让我们看一个例子:

全球和本地范围

变量`iHaveGlobalScope` 是在全局范围内声明的，因此甚至可以从函数`localScope()`内访问，但是当我试图在函数外或局部范围外控制台记录变量`iHaveLocalScope`时，它在运行时抛出一个`Reference Error`。

局部作用域可以进一步分为函数作用域和块作用域。ES6 引入了块范围的概念，以及声明变量的新方法— `const`和`let`。

# **功能范围和块范围**

每当你在函数内部声明一个变量，这个变量就被绑定在函数内部，你不能在函数外部访问它。`var`是定义函数范围可访问性变量的关键字。

现在，你可能会问，如果即使你使用`let`或`const`它也会给出一个错误，为什么只有`var`与函数作用域相关联？事情是这样的，`let`和`const`是用来定义块范围的，而在 ES6 之前，JavaScript 没有块范围或者`let` 和`const`。

> 块范围是在`if`、`switch`条件或`for`和`while`循环内的区域。简单来说，只要看到{花括号}，就是块。

让我们看一个例子:

现在，您可能认为日志命令都不应该工作，但是正如您所看到的那样，var 的情况并非如此，在`if`、`switch`条件或`for`和`while`循环中用 var 定义的变量可以被全局访问，并且是全局作用域的一部分，因此最好将`let`和`const`与它们一起使用。

## **词法范围**

最后，我们达到了这篇文章的真正目的。好吧，我可以跳过关于作用域的冗长讨论，但就我个人而言，我认为如果不知道围绕它的关键组件，你就无法理解词法作用域。

再次强调，需要记住的一点是:Javascript 的词法作用域是函数作用域。

简而言之，这意味着子作用域可以访问父作用域中定义的变量。例如，如果我要定义一个函数，并在其中声明一个变量，在同一个函数中，定义另一个函数，那么由于词法范围，我应该能够在内部函数中使用该变量。让我们看一个例子:

从例子中可以看出，`outerFunction()`中声明的变量被`innerfunction()`访问，这就是词法作用域。

变量的范围由它们在代码中的位置定义。为了解析变量，JavaScript 从最内部的范围开始向外搜索，直到找到它要寻找的变量。在上面的例子中，Javascript 首先在`innerFunction()` 内搜索变量，如果没有找到，它就在`outerFunction()`外搜索

词法作用域更好，因为我们可以很容易地从代码中计算出变量的值，而在动态作用域中，变量的含义可以在运行时改变，这使得理解起来很复杂。

那么，我们已经成功地理解了什么是词法范围，现在让我们看看闭包实际上使用了词法范围。

# 关闭

根据 [Mozilla 开发网络(MDN)](https://developer.mozilla.org/en-US/docs/Web/JavaScript) :

> 闭包是一种特殊的对象，它结合了两件事:一个函数，以及创建该函数的环境。环境由创建闭包时范围内的所有局部变量组成。”

首先，让我们从一个简单的例子开始:

这里的要点认为是`outerFunction()`返回`innerFunction()`，所以*`newFunction()`*实际上是`innerFunction()`，但是我们没有返回`variable1`。尽管如此，它还是`newFunction()`的一部分，所以如果`outerFunction()`已经返回，即执行完毕，那么`variable1`的值从何而来。**

> **这种对直接作用域之外的变量的访问将导致闭包。**

**由于`variable1`是创建`innerFunction()`的词法环境的一部分，*`innerFunction()`*将可以访问它。****

***让我们看另一个例子:***

***仅供参考，这是一个广泛使用的闭包示例，您可能会在许多教程中找到它，这里我们定义了带参数 x 的函数`add()`，它返回另一个带参数 y 的函数，后者返回 x 和 y 的和。***

***现在我们创建新的函数`addFive()`和`addTen()`，通过在`add()` 函数内部传递参数，这些`addTen()`和`addFive()`实际上是闭包，虽然它们有相同的函数体定义，但是它们存储不同的词法环境。在`addFive()`词法环境中，x 是 5，而在`addTen()`词法环境中，x 是 10。***

**闭包是编程中非常重要的一部分，不仅在 JavaScript 中如此，在所有编程语言中都是如此。它们有如此多的实际应用，如对象数据隐私、事件处理程序和回调函数，以及其他函数式编程模式。**

**我希望现在你已经对 JavaScript 的作用域有了一个基本的了解，我们已经在这篇文章中简要介绍了词法作用域和闭包。在下一篇文章中，我们将详细讨论闭包及其实际应用，如数据隐私、`call()`、`bind()`、`apply()`、事件处理程序等。通过各种例子。**