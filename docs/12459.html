<html>
<head>
<title>AWS DynamoDB Global Secondary Indexes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS DynamoDB全局辅助索引</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/aws-dynamodb-global-secondary-indexes-3ee7f6d8da0?source=collection_archive---------6-----------------------#2022-06-07">https://betterprogramming.pub/aws-dynamodb-global-secondary-indexes-3ee7f6d8da0?source=collection_archive---------6-----------------------#2022-06-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="67b0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">轻松扩展您的访问模式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f64a3b5f84b71d0c9106265f16a01a88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gV7k0iXiFr617zjJ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@cookiethepom?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Cookie Pom</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="66a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们都非常熟悉关系数据库系统。我们知道如何与他们合作。最佳实践是什么，我们知道如何利用它们。但是当负载变大时，RDBMS就有问题了。对于高数据负载，查询可能需要很长时间才能完成。尤其是当查询使用<code class="fe lv lw lx ly b">join</code> s时。</p><p id="5318" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于这个原因，NoSQL数据库今天正在崛起。他们正在解决缩放问题。然而，就像IT世界中的一切一样，这不是一个理想的解决方案。这是一种权衡。NoSQL数据库通常比传统的关系数据库占用更多的空间，因为数据没有被规范化。学习曲线也可能是一个问题。</p><p id="f677" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们来自关系世界，学习DynamoDB会非常头疼。DynamoDB有一些特性需要解释。这就是为什么在本教程中我将向您解释什么是全局二级索引，为什么它是有用的，以及如何创建一个。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="3d06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在直接讨论索引之前，让我们简单地讨论一下DynamoDB的数据建模和单表设计。我将对DynamoDB和RDBMS进行广泛的比较，向您展示它们的不同之处。</p><p id="e41b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在对关系数据建模时，您需要遵循规范化的规则。你知道该怎么做。通常，您不关心如何查询您的数据。建模只是关于拥有一个最优的，而不是冗余的数据模型。如果您的应用程序需要来自几个表的数据？没问题，一个简单的<code class="fe lv lw lx ly b">JOIN</code>操作就可以了。您可以在表上调用的操作数量几乎是无限的。使用SQL，您拥有完全的灵活性。但是在DynamoDB的世界里，以上都不适用。说真的，你可以把那些知识扔进垃圾箱。</p><p id="6d5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你必须重塑你的思维来使用DynamoDB。首先，为了对数据建模，你必须从考虑应用程序的访问模式开始。我的意思是，在拥有表之前，您必须知道您将触发的确切查询！</p><p id="a755" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了理解这一点，让我们看一个例子。假设，我们在开发一个简单的笔记app:)。会有用户保存他们的笔记。便笺将包含日期、内容和类别。在RDBMS中，我们可能会以这样的关系结束:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/ebface47018d7d016cdf99301ab9846f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cIoT0FUDgClNfJI9eq0CSA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用户和注释关系</p></figure><p id="39c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如何在DynamoDB中保存相同的关系？如我所说，我们必须先知道访问模式。最初，我们将做三两个操作:</p><ul class=""><li id="3629" class="mh mi it lb b lc ld lf lg li mj lm mk lq ml lu mm mn mo mp bi translated">添加新注释</li><li id="ae1d" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">查找用户笔记</li><li id="7010" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">删除用户的注释</li></ul><p id="e10f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保存项目不是访问模式，所以我们只需要考虑两种情况。为了找到用户的笔记，我们可以使用用户电子邮件。这是一个很好的起点。然后，要删除一个笔记，我们必须确定确切的笔记。带有创建时间戳的用户电子邮件应该可以完成这项工作。因此，有了这样的标准，我们可以对表进行建模，将用户的电子邮件作为散列键，将日期时间戳作为排序键。这样，我们将满足我们的要求。</p><p id="7c5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至少有四种方法可以在DynamoDB中实现一对多关系。我们刚刚使用了一种模式:复合主键和查询API动作。在下面，您可以看到包含示例数据的表格:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/c704bd96d0eb5fa5807db00a9112d136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y65X1VTUGTzM0-eC3U9YWA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">注释表DynamoDB中一对多关系的示例</p></figure><p id="046d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有一个用户，它的所有注释都按项目集合分组。要创建与我相同的表，可以使用AWS CLI和以下查询:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="dd1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建、查询和删除注释，您可以使用以下功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="262e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了。在这个有点长的介绍之后，我们终于准备好谈论全球二级指数(简称GSI)。现在您知道DynamoDB中的数据建模完全是关于访问模式的。如果我们的访问模式发生变化或者出现新的访问模式，会发生什么？或者仅仅在建模的第一次迭代中，我们发现我们不能用一个组合键覆盖所有的访问模式？</p><p id="2277" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是很常见的情况。我们的例子很简单。在更复杂的表中，几乎可以肯定我们会遇到这样的问题。</p><p id="aa23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GSI扩展了新访问模式的DynamoDB表。它与主键具有相同的结构。您可以定义一个散列关键字，并可以选择添加一个排序关键字，但是您可以使用另一个项目的属性。在引擎盖下，迪纳摩复制你的项目，并保存在一个重塑的公式，让你以同样的速度查询它们。</p><p id="ada6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重要的是，GSI只能用于读操作。您不能使用GSI保存任何数据。每个DynamoDB表最多可以有20个全局二级索引。尽管如此，如果你有更多的访问模式，这不是一件大事。有一种索引重载的模式，但是这是一个很大的话题，我不会在本教程中讨论。</p><p id="963d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到我们的例子。让我们想象一下，在我们的应用程序中，用户可以用类别来标记笔记。然后，用户可以从特定类别中获取所有笔记。使用当前键，我们只能获取所有用户的笔记，然后按类别过滤它们。肯定不是理想的解决方案。要添加按类别搜索的功能，我们必须定义一个新的GSI。访问模式如下:</p><ul class=""><li id="1628" class="mh mi it lb b lc ld lf lg li mj lm mk lq ml lu mm mn mo mp bi translated">获取用户笔记的子集，分配到XYZ类别</li></ul><p id="2485" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GSI将类似于我们的主键。哈希键将是相同的；我们将有用户的电子邮件的字符串字段。范围键会有所不同。这一次，我们将把category属性设置为范围键。事实上，如果我们知道这些访问模式，在第一次迭代中，我们可以创建本地二级索引，而不是全局二级索引(我们只能在创建表的过程中创建LSI)。在下面，您可以看到具有以下索引的重新成形的表格:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/473418546b05d9404018b463f7607164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4MGMrMJU1hAE1rcwLvYPfA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">注释表— GSI视图</p></figure><p id="f2a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建GSI，您可以在AWS控制台中完成，也可以键入以下命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="ac85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更好的可读性，我把非字符串化的JSON放在下面。这是一样的，但是以更好的格式查看它是至关重要的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6198" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建GSI，您必须使用<code class="fe lv lw lx ly b">update-table</code> API。在更新表时，我们可以选择几个选项，其中之一就是创建索引。然后，您必须设置正在更新的表的名称和表的区域。<code class="fe lv lw lx ly b">attribute-definitions</code>选项设置索引的主键。最后，对于<code class="fe lv lw lx ly b">global-secondary-index-updates</code>，您必须向JSON提供索引公式。您可以在一次操作中创建、更新或删除多个索引。在我们的例子中，我们只创建一个索引。</p><p id="707f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提供的索引JSON必须包含一些参数。首先是索引名。下一个是一个<code class="fe lv lw lx ly b">IndexName</code>，它是索引的主键定义。一个有趣的是<code class="fe lv lw lx ly b">Projection</code>参数。为DynamoDB表创建索引时，可以决定在索引中保存哪些属性。你不必拯救所有人。在我们的例子中，拥有它们是很有用的，所以我使用了<code class="fe lv lw lx ly b">All</code>属性。</p><p id="8f30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，对于GSI，我们必须设置自己的<code class="fe lv lw lx ly b">ProvisionedThroughput</code>。索引可能比原始主键多或少地被占用，因此有一个设置不同值的选项。</p><p id="9a8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您可以测试新索引，查询数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="fb7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个查询和上一个查询的一个区别是提供了<code class="fe lv lw lx ly b">index-name</code>标志。</p><p id="ff1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是关于GSI的全部故事。我希望你已经发现这个解释简单而有用。使用DynamoDB时，GSI是开发人员手中最重要的资产之一。所以，花点时间好好学习它们，你会收获很大的成果。</p><p id="14d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">祝你有美好的一天，下次再见！</p></div></div>    
</body>
</html>