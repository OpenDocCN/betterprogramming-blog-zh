<html>
<head>
<title>Exploring and Building Android App Widgets With Glance APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Glance APIs探索和构建Android应用程序小部件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/exploring-and-building-android-app-widgets-with-glance-apis-4a5eb47c6d0?source=collection_archive---------14-----------------------#2022-02-09">https://betterprogramming.pub/exploring-and-building-android-app-widgets-with-glance-apis-4a5eb47c6d0?source=collection_archive---------14-----------------------#2022-02-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0d5d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建直观的Android小工具</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ab52b444a16a14818acd57dcb5c7c4c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BEBbSHQApPkRsqZY"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@abeso?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">塞巴斯蒂安·贝德纳雷克</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="e1ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">据<a class="ae ky" href="https://www.udacity.com/course/kotlin-bootcamp-for-programmers--ud9011" rel="noopener ugc nofollow" target="_blank"> Android developers </a>网站报道，app widgets是可以嵌入到其他应用程序中的微型应用程序(例如，主屏幕)。</p><p id="be43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一段时间以来，我一直在用新的Jetpack Compose工具包试验和构建一些应用程序。</p><p id="c3da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Jetpack Compose大大缩短了我的开发时间，这是一个巨大的胜利。为了让事情变得更好，引入了被称为Glance API的东西。</p><p id="c625" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于旧的Android View系统，我们使用XML构建应用程序小部件，而对于Glance，我们使用从Jetpack Compose获得的相同知识，用Kotlin代码构建Android应用程序小部件。多酷啊。让我向您展示如何使用Glance实现android应用程序小部件。</p><h1 id="9844" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">设置相关性</h1><p id="7380" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，在Android Studio中创建一个项目，并选择Jetpack Compose模板项目。然后接下来，在你的app级<code class="fe ms mt mu mv b">build.gradle</code>文件中添加glance依赖，如下；</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="f78a" class="na lw it mv b gy nb nc l nd ne">implementation "androidx.glance:glance-appwidget:1.0.0-alpha02"</span></pre><p id="ee6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，确保您同步了您的项目，并且一切就绪。glance依赖项让我们可以访问Glance自己的组件，比如列、行等。构建应用程序小部件时，确保您的导入来自<code class="fe ms mt mu mv b">androidx.glance</code>。</p><p id="753f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">扫视组件的行为几乎类似于Jetpack组件特定的组件。我们将使用静态数据构建一个示例天气应用程序小部件，看起来像下面模拟器截图中的那个。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/2c73b4f4b35c746f90c5bc7b56fc2a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*Noh0UntkyPDbMlq9tdlyWQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有应用程序小部件的Android模拟器。</p></figure><h1 id="b7cd" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用XML定义应用程序小部件提供商信息</h1><p id="f679" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可能认为这里的一切都将被Kotlin取代，但是，与旧的视图系统一样，您必须使用XML定义应用程序小部件提供者。</p><p id="8495" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的将和下面的一样简单。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="05cf" class="na lw it mv b gy nb nc l nd ne">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;appwidget-provider xmlns:android="http://schemas.android.com/apk/res/android"<br/>    android:minHeight="180dp"<br/>    android:minWidth="180dp"<br/>    android:description="@string/app_widget_description"<br/>    android:previewLayout="@drawable/example_appwidget_preview"<br/>    android:minResizeHeight="90dp"<br/>    android:minResizeWidth="90dp"<br/>    android:targetCellHeight="2"<br/>    android:targetCellWidth="2"<br/>    android:resizeMode="horizontal|vertical"<br/>    android:updatePeriodMillis="86400000"<br/>    android:widgetCategory="home_screen"<br/>    /&gt;</span></pre><p id="98e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的<code class="fe ms mt mu mv b">AppWidgetProviderInfo</code>信息是通过创建一个<code class="fe ms mt mu mv b">xml</code>资源并给它起你选择的名字(它应该在<code class="fe ms mt mu mv b">res/xml</code>目录中)获得的。我把这个命名为<code class="fe ms mt mu mv b">my_widget_provider.xml</code>。我们定义了几个属性，如<code class="fe ms mt mu mv b">minHeight</code>、<code class="fe ms mt mu mv b">minWidth</code>、<code class="fe ms mt mu mv b">previewLayout</code>等。Android 12带来了<code class="fe ms mt mu mv b">targetCellWidth</code>和<code class="fe ms mt mu mv b">targetCellHeight</code>这样的新属性。</p><h2 id="4516" class="na lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">创建扫视小部件</h2><p id="3d7f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们要做的下一件事是创建实际的小部件。这是通过从<code class="fe ms mt mu mv b">androidx.glance.appwidget</code>扩展<code class="fe ms mt mu mv b">GlanceWidget</code>抽象类来实现的，并覆盖最重要的方法<code class="fe ms mt mu mv b">Content</code>。</p><p id="e8af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">内容标有<code class="fe ms mt mu mv b">@Composable</code>注释，在这里我们定义了小部件的布局。我们将从一个简单的名为<code class="fe ms mt mu mv b">DayItem</code>的列开始</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="2ea0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意它与普通组件的不同之处。在这里，<code class="fe ms mt mu mv b">Modifier</code>被替换为<code class="fe ms mt mu mv b">GlanceModifier</code>。进口来自<code class="fe ms mt mu mv b">androidx.glance</code>。</p><p id="5498" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们通过扩展<code class="fe ms mt mu mv b">GlanceAppWidget</code>类来做实际工作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="f1a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我所说的，最重要的事情是我们扩展了<code class="fe ms mt mu mv b">GlanceAppWidget</code>类并覆盖了标有<code class="fe ms mt mu mv b">@Composable</code>的<code class="fe ms mt mu mv b">Content</code>方法。</p><p id="ec5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们要做的下一件事是扩展<code class="fe ms mt mu mv b">GlanceAppWidgetReceiver</code>并覆盖<code class="fe ms mt mu mv b">glanceAppWidget</code>的值，然后返回我们的<code class="fe ms mt mu mv b">GlanceNewWidget</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="8241" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们要做的下一件事是在AndroidManifest文件中注册我们的接收器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="ec77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保将接收器注册为应用程序标记的子标记。在<code class="fe ms mt mu mv b">meta-data</code>中，我们指定了我们的提供者XML文件。</p><p id="ac28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这对我们来说应该够了。运行您的应用程序，长按屏幕的空白区域并选择<code class="fe ms mt mu mv b">Widgets</code>，查找您的应用程序的名称并将小部件拖到屏幕上。你应该可以看到上面截图中的样子。</p><p id="f316" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，这不是某种魔法。这些组件被转换成<code class="fe ms mt mu mv b">RemoteViews</code>。</p><h1 id="5abb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用Glance调用操作</h1><p id="16c1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您的应用程序小部件的目的可能是当单击某个部分或按钮时，会发生一些事情，如开始一项活动、一项服务，或者可能只是将一些内容保存到数据库中。</p><p id="08e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Glance为我们提供了要执行的操作，我们可以创建自己的操作。默认情况下，有启动活动、服务、广播接收器和其他的动作。</p><p id="3074" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，现在，假设我们想要在点击<code class="fe ms mt mu mv b">32</code> <a class="ae ky" href="https://www.degreesymbol.net/" rel="noopener ugc nofollow" target="_blank"> </a>时启动一个新的活动<code class="fe ms mt mu mv b">NewActivity</code>，我们传递一个额外的被调用名称并在<code class="fe ms mt mu mv b">NewActivity</code>中接收它。</p><p id="2850" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们如何做到这一点？为此，我们将应用<code class="fe ms mt mu mv b">GlanceModifier.clickable</code>并向它传递一个动作。因此<code class="fe ms mt mu mv b">Text</code>变为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="70f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">方法<code class="fe ms mt mu mv b">actionStartActivity</code>采用一个i <code class="fe ms mt mu mv b">ntent</code>和一个<code class="fe ms mt mu mv b">parameters</code>参数。在参数中，我们将想要传递的数据传递给活动。在这种情况下，我们给它键<code class="fe ms mt mu mv b">ActionParameters.Key&lt;String&gt;("name")</code>和值<code class="fe ms mt mu mv b">Lionel Messi</code>。下面是我们将如何在<code class="fe ms mt mu mv b">NewActivity</code>收到它</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="b8c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您现在运行应用程序，创建一个小部件并点击文本，它将启动<code class="fe ms mt mu mv b">NewActivity</code>。你会看到文字<code class="fe ms mt mu mv b">Lionel Messi</code>。这就是使用动作将数据传递给活动的方式。</p><p id="b6ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前，这是使用composables而不是XML创建应用程序小部件的最简单方式。你可以做的事情很多，但我会把这些留给你去做一些研究。</p></div></div>    
</body>
</html>