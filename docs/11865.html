<html>
<head>
<title>Build Your Weather Tracking Flutter App Using GetX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GetX构建您的天气跟踪应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-your-weather-tracking-mobile-app-with-flutter-using-getx-3650d17c3d9e?source=collection_archive---------3-----------------------#2022-04-22">https://betterprogramming.pub/build-your-weather-tracking-mobile-app-with-flutter-using-getx-3650d17c3d9e?source=collection_archive---------3-----------------------#2022-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/047f8997434f4fbf3c5160c4440b5d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V_9YbY81qDz2-2pAxd8Y4A.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@baciutudor" rel="noopener ugc nofollow" target="_blank">都铎巴休</a>拍摄</p></figure><p id="f0b0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你对Flutter很感兴趣，但不知道如何或从哪里开始构建你的第一个应用程序？或者，也许，你对GetX感兴趣？今天是你的幸运日！您刚刚找到了您正在寻找的内容:)</p><p id="f574" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将探讨如何使用GetX状态管理来构建我们的跨平台Android和iOS移动应用程序。拿起你的咖啡或任何其他喜爱的饮料，让我们开始吧！</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="b90a" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">我们在建造什么？</h1><p id="20fd" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">一个简单的天气跟踪应用程序，带有一些附加信息:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/a52fd7c1fee935acf94b1f5532409a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*yuALf7rvSfcysO44OwsS5g.png"/></div></figure><p id="3055" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">你将学到什么:</strong></p><ol class=""><li id="d3f4" class="mq mr iq kf b kg kh kk kl ko ms ks mt kw mu la mv mw mx my bi translated">建立一个颤振项目</li><li id="7f67" class="mq mr iq kf b kg mz kk na ko nb ks nc kw nd la mv mw mx my bi translated">发出HTTP请求以从API中检索数据</li><li id="eb71" class="mq mr iq kf b kg mz kk na ko nb ks nc kw nd la mv mw mx my bi translated">执行异步任务</li><li id="1f0a" class="mq mr iq kf b kg mz kk na ko nb ks nc kw nd la mv mw mx my bi translated">定义一个可靠且可扩展的基础架构</li><li id="34e8" class="mq mr iq kf b kg mz kk na ko nb ks nc kw nd la mv mw mx my bi translated">使用<code class="fe ne nf ng nh b">Get</code>以被动方式管理数据</li></ol><h2 id="4686" class="ni lj iq bd lk nj nk dn lo nl nm dp ls ko nn no lw ks np nq ma kw nr ns me nt bi translated">先决条件</h2><p id="f01b" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">在本教程中，我将使用Android Studio IDE。如果您对Visual Studio代码感觉更舒服，它也能很好地工作。你挑吧！</p><p id="5c82" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们必须下载<strong class="kf ir"> Flutter SDK </strong>，可以在这里<a class="ae kc" href="https://docs.flutter.dev/get-started/install" rel="noopener ugc nofollow" target="_blank">找到</a>。你可以按照官方网页上的说明去做，它清晰明了。设置完成后，运行命令行<code class="fe ne nf ng nh b">flutter doctor</code>(如文档中所述)以确认一切顺利。</p><p id="db1c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您在设置时遇到问题，请务必参考他们的官方文档。你可以在那里找到几乎所有的解决方案。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="11b3" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">创建您的项目</strong></h1><p id="b227" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">从这里开始，IDE相关的指令将针对Android Studio。Visual Studio代码应该足够相似。</p><p id="d070" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要创建一个新的颤振项目，点击<code class="fe ne nf ng nh b"><strong class="kf ir">File &gt; New &gt; New Flutter Project</strong></code>。指定您的SDK位置并设置您的项目位置。确保检查了Android和iOS。您可以选择项目的名称:)</p><p id="035d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦创建了项目，您将进入带有大量默认代码的文本编辑器。它是著名的点击计数器颤振演示应用程序的代码基础。为了运行演示代码，您必须首先创建一个Android或iOS模拟器。至于iOS模拟器，你需要一台Mac来运行它。</p><p id="6f37" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要创建Android模拟器，请点击<code class="fe ne nf ng nh b">Tools &gt; AVD Manager &gt; Create Virtual Device &gt; Pixel 4 (for example) &gt; Choose an Android Image from Recommended &gt; Finish</code></p><p id="7daf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，您有了一个运行应用程序的设备。在顶部菜单中选择设备，并点击<strong class="kf ir">运行</strong>。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/4a3e33c444e96ebe931c8d2c73011c65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X7H1pvaDYubE1odLkV3mfQ.png"/></div></div></figure><p id="62f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">编译成功后，你应该在模拟器上运行Fluter演示点击<code class="fe ne nf ng nh b">Counter</code>应用程序，得到类似下图的显示。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/face913acdbe9b645e2c42cca7d84af8.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/0*QNu-it4ME-aUtYWq.png"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">点击计数器应用程序</p></figure><p id="3b97" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以花一些时间探索不同的存储库。此时，您将了解3个关键存储库:</p><ul class=""><li id="540c" class="mq mr iq kf b kg kh kk kl ko ms ks mt kw mu la nw mw mx my bi translated"><code class="fe ne nf ng nh b">android/</code>:包含所有原生Android相关的数据。如果有任何Android特定的设置要做，你将不得不更新这个库中的文件。即:在清单中添加权限、设置版本、更新Gradle或Kotlin版本等。</li><li id="c94e" class="mq mr iq kf b kg mz kk na ko nb ks nc kw nd la nw mw mx my bi translated"><code class="fe ne nf ng nh b">ios/</code>:包含所有与原生iOS代码相关的数据。任何特定于iOS的设置都在这里完成。即:设置目标操作系统、权限、登录配置等。</li><li id="6ff9" class="mq mr iq kf b kg mz kk na ko nb ks nc kw nd la nw mw mx my bi translated"><code class="fe ne nf ng nh b">lib/ </code>:这是我们的颤振相关代码将生活的地方。注意包含所有演示代码的初始<code class="fe ne nf ng nh b">main.dart</code>文件。</li></ul><p id="edf1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该编码了！</p><h1 id="8529" class="li lj iq bd lk ll nx ln lo lp ny lr ls lt nz lv lw lx oa lz ma mb ob md me mf bi translated">步骤0:导入GetX</h1><p id="0a23" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">还记得GetX吗？这是我们的国家管理包。它基本上帮助我们制作一个反应式用户界面，并组织我们的应用程序的代码，使其易于扩展，同时减少样板文件。为了建立一个这样的包，我们需要进入<code class="fe ne nf ng nh b">pubspec.yaml</code>文件。这就是我们对第三方包的依赖性的设置。打开文件，在<code class="fe ne nf ng nh b">dependencies:</code>下将<a class="ae kc" href="https://pub.dev/packages/get" rel="noopener ugc nofollow" target="_blank"> GetX包</a>添加到项目中。</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="1244" class="ni lj iq nh b gy og oh l oi oj">dependencies:<br/> flutter:<br/> sdk: flutter<br/> cupertino_icons: ^1.0.2<br/><strong class="nh ir"> get: ^4.6.1</strong></span></pre><p id="5a8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当您添加完这一行后，您将不得不在项目目录下的终端中使用命令行<code class="fe ne nf ng nh b">flutter pub get</code>，这将在<code class="fe ne nf ng nh b">pubspec.lock</code>中下载所有新的依赖项代码。</p><p id="0a40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Android Studio中，你可以在顶部看到一个快捷按钮<code class="fe ne nf ng nh b">Pub get</code>。</p><h1 id="7afd" class="li lj iq bd lk ll nx ln lo lp ny lr ls lt nz lv lw lx oa lz ma mb ob md me mf bi translated">步骤1:添加主页</h1><p id="e2b1" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">进入<code class="fe ne nf ng nh b">main.dart</code>文件，从删除全部内容开始。这个文件是我们用来运行我们的应用程序。启动一个Flutter应用程序的核心函数是<code class="fe ne nf ng nh b">runApp()</code>函数，它将创建我们的小部件树。</p><p id="73bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认情况下，Flutter使用<code class="fe ne nf ng nh b">MaterialApp</code>根窗口小部件，但是<code class="fe ne nf ng nh b">GetX</code>包要求将它改为<code class="fe ne nf ng nh b"><a class="ae kc" href="https://pub.dev/packages/get#counter-app-with-getx" rel="noopener ugc nofollow" target="_blank">GetMaterialApp</a></code>以利用包的特性。</p><p id="baf8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此时，您的文件应该如下所示:</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="567a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">提示:</strong>如果你写下<code class="fe ne nf ng nh b">stless</code>或<code class="fe ne nf ng nh b">stful</code>并按下<code class="fe ne nf ng nh b">return</code>键，Android Studio会自动为你分别创建<code class="fe ne nf ng nh b"><a class="ae kc" href="https://api.flutter.dev/flutter/widgets/StatelessWidget-class.html" rel="noopener ugc nofollow" target="_blank">StatelessWidget</a></code>和<code class="fe ne nf ng nh b"><a class="ae kc" href="https://api.flutter.dev/flutter/widgets/StatefulWidget-class.html" rel="noopener ugc nofollow" target="_blank">StatefulWidget</a></code>的样板代码。</p><p id="9266" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ne nf ng nh b">GetMaterialApp</code>发生了什么？</p><ul class=""><li id="b815" class="mq mr iq kf b kg kh kk kl ko ms ks mt kw mu la nw mw mx my bi translated">这将包含我们的应用程序的所有页面。每个页面小部件都将被包装在<code class="fe ne nf ng nh b">GetPage()</code>对象中。</li><li id="a446" class="mq mr iq kf b kg mz kk na ko nb ks nc kw nd la nw mw mx my bi translated"><code class="fe ne nf ng nh b">HomePage()</code>:根页面的用户界面(也叫:'/')。</li><li id="a052" class="mq mr iq kf b kg mz kk na ko nb ks nc kw nd la nw mw mx my bi translated"><code class="fe ne nf ng nh b">HomeBinding()</code> <strong class="kf ir"> : </strong>包含了主页正常工作所需的所有类(例如:控制器、存储库等。).我们稍后将讨论这些问题。</li></ul><p id="fef5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，让我们使用<code class="fe ne nf ng nh b">stless</code>快捷方式定义一个新的<code class="fe ne nf ng nh b">HomePage</code>小部件。新页面的主要小部件通常是一个<code class="fe ne nf ng nh b"><a class="ae kc" href="https://api.flutter.dev/flutter/material/Scaffold-class.html" rel="noopener ugc nofollow" target="_blank">Scaffold</a></code>。我们还将添加一些包含模拟数据的UI来展示一些东西。我们将使用<code class="fe ne nf ng nh b"><a class="ae kc" href="https://api.flutter.dev/flutter/widgets/Column-class.html" rel="noopener ugc nofollow" target="_blank">Column</a></code>来对齐我们的<code class="fe ne nf ng nh b"><a class="ae kc" href="https://docs.flutter.dev/development/ui/widgets/text" rel="noopener ugc nofollow" target="_blank">Text</a></code>小部件，这些小部件包含一些垂直的字符串和一些图标，以使它看起来更漂亮。</p><p id="9364" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更新<code class="fe ne nf ng nh b">HomePage</code> <strong class="kf ir"> </strong>小部件，如下所示:</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="7655" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并添加我们之前看到的<code class="fe ne nf ng nh b">home_binding.dart</code>。这个类必须扩展<code class="fe ne nf ng nh b">Bindings</code>，我们必须重写<code class="fe ne nf ng nh b">dependencies()</code>函数。简而言之，这就是我们在<code class="fe ne nf ng nh b">get</code>中注入依赖的方式。使用以下代码创建类:</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="cb58" class="ni lj iq nh b gy og oh l oi oj">import 'package:get/get.dart';</span><span id="7e80" class="ni lj iq nh b gy om oh l oi oj">class HomeBinding extends Bindings {<br/>  @override<br/>  void dependencies() {<br/>     // TODO: We will add the dependencies later.<br/>  }<br/>}</span></pre><p id="a357" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">⚠️确保将这两个新类导入到<code class="fe ne nf ng nh b">main.dart</code>中，然后运行应用程序，你的仿真器中应该会有这样的东西:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/28cf4eea0528da34afc1faff5b451ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*8-JdUSzcxWg-ErPTI2erjg.png"/></div></figure><p id="b12a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你仔细看，你会发现我们的<code class="fe ne nf ng nh b">Row</code>的项目是多次重复的。稍后，我们将把代码提取到一个单独的小部件中，以使其可重用并避免重复。</p><p id="9025" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可能还注意到了<code class="fe ne nf ng nh b">SafeArea</code>小部件。它的目的是定义用户界面的边界。通常，设备要求主页按钮底部和状态栏顶部都有间距。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi on"><img src="../Images/9841279b51fdebf6781d7ce9b881742f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/0*Qz7FbGTUWkAZWof-"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">安全区域小部件</p></figure><h1 id="211a" class="li lj iq bd lk ll nx ln lo lp ny lr ls lt nz lv lw lx oa lz ma mb ob md me mf bi translated">步骤2:添加控制器</h1><p id="cfde" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们有自己的用户界面，但我们想获取一些数据，使其动态。让我们在<code class="fe ne nf ng nh b">lib/</code> <strong class="kf ir"> </strong>文件夹中创建一个名为<code class="fe ne nf ng nh b">home_controller.dart</code>的新<code class="fe ne nf ng nh b">Controller</code> <strong class="kf ir"> </strong>类。<br/>控制器必须扩展<code class="fe ne nf ng nh b">GetxController</code>以利用Get库。</p><p id="1bff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您的控制器将如下所示:</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="9b5d" class="ni lj iq nh b gy og oh l oi oj">import 'package:get/get.dart';<br/><br/>class HomeController extends GetxController {<br/><br/>  getCurrentLocation() {<br/>    // <em class="oo">TODO add the logic to fetch current city<br/>  </em>}<br/><br/>  getTemperatureForCurrentLocation() {<br/>    // <em class="oo">TODO add the logic to fetch temperature for current city<br/>  </em>}<br/>}</span></pre><p id="8351" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此时，我们需要两个数据模型。该数据模型将保存城市信息，另一个数据模型将保存天气信息。</p><p id="a2ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们来了解一下如何获取当前城市信息。我们将使用端点<code class="fe ne nf ng nh b"><a class="ae kc" href="http://ip-api.com/json/" rel="noopener ugc nofollow" target="_blank">http://ip-api.com/json/</a></code>。这个请求根据用户的IP地址向我们提供数据。这不是很准确，因为它取决于互联网提供商的位置，但它允许我们忽略<code class="fe ne nf ng nh b">location</code>许可请求。使用加拿大IP地址的一个例子是:</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="bc5b" class="ni lj iq nh b gy og oh l oi oj">{<br/>  "status": "success",<br/>  "country": "Canada", // We need this<br/>  "countryCode": "CA",<br/>  "region": "QC",<br/>  "regionName": "Quebec", // We need this<br/>  "city": "Montreal",<br/>  "zip": "H3G",<br/>  "lat": 45.4995, // We need this<br/>  "lon": -73.5848, // We need this<br/>  "timezone": "America/Toronto",<br/>  "isp": "Le Groupe Videotron Ltee",<br/>  "org": "Videotron Ltee",<br/>  "as": "AS5769 Videotron Telecom Ltee",<br/>  "query": "24.48.0.1"<br/>}</span></pre><p id="e969" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们创建一个名为<code class="fe ne nf ng nh b">location_data.dart</code>的模型来保存位置信息。</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="b6c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">注意:</strong><code class="fe ne nf ng nh b">.fromJson</code>函数的目的是将我们从HTTP请求中获得的JSON数据转换成我们可以在应用程序中使用的dart对象。</p><p id="68fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的下一个任务是在我们的应用程序中发出http请求。为了做到这一点，我们需要另一个名为<code class="fe ne nf ng nh b"><a class="ae kc" href="https://pub.dev/packages/http" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">http</strong></a></code>的软件包的帮助，这个软件包是来自Flutter团队的官方版本。⚠️不要忘记，每次我们需要第三方库时，我们都需要将它添加到我们的<code class="fe ne nf ng nh b">pubspec.yaml</code>文件中，后面跟着一个<code class="fe ne nf ng nh b">flutter pub get</code>命令来检索包的代码。</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="34e9" class="ni lj iq nh b gy og oh l oi oj">dependencies:<br/>  flutter:<br/>    sdk: flutter<br/>  cupertino_icons: ^1.0.2<br/>  get: ^4.6.1<br/><strong class="nh ir">  http: ^0.13.4</strong></span></pre><p id="24d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们添加了这个包，我们就可以使用它的代码向一个端点发出HTTP请求，并检索JSON对象。</p><p id="4460" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们添加一个存储库来执行调用，并为我们的控制器准备数据。创建一个名为<code class="fe ne nf ng nh b">weather_repository.dart</code>的存储库，如下所示:</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="c4ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ne nf ng nh b">Note</code> : <strong class="kf ir"> </strong>该函数体被包装在<code class="fe ne nf ng nh b">async</code>内，返回一个<code class="fe ne nf ng nh b">Future&lt;LocationData?&gt;</code>类型。这意味着此操作将异步运行，并且需要一些时间来完成。它将来会返回一个可空的<code class="fe ne nf ng nh b">LocationData</code>对象。<code class="fe ne nf ng nh b">await</code>告诉函数在继续之前停止并等待获取端点的数据(耗时的操作是该特定行)。</p><p id="b61c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，还记得应该包含UI正常工作的所有要求的<code class="fe ne nf ng nh b">Binding</code>吗？我们<code class="fe ne nf ng nh b">HomePage</code>将需要<code class="fe ne nf ng nh b">WeatherRepository</code>和<code class="fe ne nf ng nh b">HomeController</code>。我们必须在依赖函数中实例化这两个对象。让我们更新<code class="fe ne nf ng nh b">Binding</code>如下:</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="8bfa" class="ni lj iq nh b gy og oh l oi oj">import 'package:get/get.dart';<br/>import 'package:my_weather_tracker/module/home_controller.dart';<br/>import 'package:my_weather_tracker/repository/weather_repository.dart';<br/><br/>class HomeBinding extends Bindings {<br/>  @override<br/>  void dependencies() {<br/>    Get.lazyPut(() =&gt; WeatherRepository());<br/>    Get.lazyPut(() =&gt; HomeController());<br/>  }<br/>}</span></pre><p id="7b8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ne nf ng nh b">Get.lazyPut(() =&gt; abc())</code>是一个函数，它将在需要时创建对象的实例。例如，当我们调用它们的方法时，如果对象还不存在，我们将创建一个。如果它已经创建，我们将使用现有的。</p><p id="19a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以将这个存储库导入到我们的控制器中，并在其中使用<code class="fe ne nf ng nh b">getCurrentLocation</code>函数。像这样更新您的控制器:</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="f549" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">注意:</strong><code class="fe ne nf ng nh b">Rxn</code>对象是一个可观察但可空的类型。在这种情况下，因为我们在发出请求之前不知道位置，所以它最初被设置为null。更多Rx类型<a class="ae kc" href="https://pub.dev/packages/get#breaking-changes-from-20" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="60e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们要做的就是用检索到的值更新我们的UI。我们必须在<code class="fe ne nf ng nh b">home_page.dart</code>文件中获得这个控制器的一个实例，并观察<code class="fe ne nf ng nh b">locationData</code>上的变化，以显示用户的当前城市。<br/>在<code class="fe ne nf ng nh b">HomePage()</code>构造函数下添加这一行:</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="722a" class="ni lj iq nh b gy og oh l oi oj">final HomeController _controller = Get.find();</span></pre><p id="3c85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">注意:</strong>变量名称上的前缀下划线使其成为私有的。</p><p id="49b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了让我们的UI对控制器的变化做出反应，我们需要用一个<code class="fe ne nf ng nh b">Obx</code>小部件包装<code class="fe ne nf ng nh b">SafeArea</code>小部件。每当一个可观察值改变时，这将通知并更新<code class="fe ne nf ng nh b">SafeArea</code>的内容。</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="0007" class="ni lj iq nh b gy og oh l oi oj">///...<br/>child: Obx(<br/>  () =&gt; SafeArea(<br/>    child: Column(<br/>///...</span></pre><p id="3136" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以在<code class="fe ne nf ng nh b">Text</code>中添加控制器的<code class="fe ne nf ng nh b">address</code>变量。由于<code class="fe ne nf ng nh b">address</code>引用了一个<code class="fe ne nf ng nh b">Rx</code>可观察对象，小部件树中更高层次的<code class="fe ne nf ng nh b">Obx</code>包装器将在其值改变时被触发，它将通知UI用新值重新创建小部件。</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="9b22" class="ni lj iq nh b gy og oh l oi oj">//...<br/>Expanded(<br/>  // We will fetch the user's current city<br/>  child: Text(<br/>    "Your location is ${_controller.address}",<br/>    style: const TextStyle(fontSize: 18),<br/>  ),<br/>),<br/>//...</span></pre><p id="d309" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">注意:</strong>如果您得到任何错误，尝试删除一些<code class="fe ne nf ng nh b">const</code>关键字，因为它们不再是常量。</p><p id="140e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">尝试运行您的应用程序，您现在应该可以看到这座城市了！</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/53016d03a0689eab176633a6a7dd4165.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*EeTCeC4b_e5XJb6RzD1UrQ.png"/></div></figure><h1 id="dea1" class="li lj iq bd lk ll nx ln lo lp ny lr ls lt nz lv lw lx oa lz ma mb ob md me mf bi translated">步骤3:添加附加数据</h1><p id="d6fd" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们需要知道此时的温度，为了获得该数据，我们将使用<a class="ae kc" href="https://openweathermap.org/api" rel="noopener ugc nofollow" target="_blank">开放天气图API </a>。确保创建一个帐户来获得免费的API密钥。您将需要它来发出HTTP请求。</p><p id="cb4b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是数据响应的一个片段，以及我们将从API调用中需要的属性:</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="6029" class="ni lj iq nh b gy og oh l oi oj">{<br/>  //...<br/>  "main": {<br/>    "temp": 280.58, // What we need, default unit is Kelvin.<br/>    "feels_like": 280.03,<br/>    "temp_min": 278.5,<br/>    "temp_max": 281.33,<br/>    "pressure": 1011,<br/>    "humidity": 84<br/>  },<br/>  //...<br/>}</span></pre><p id="2f4a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们创建一个<code class="fe ne nf ng nh b">WeatherData</code>类来包含天气相关的信息:</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="51fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，为了检索这些数据，我们将把这个新的<code class="fe ne nf ng nh b">getWeatherForLocation</code>函数添加到我们的<code class="fe ne nf ng nh b">WeatherRepository</code>中。API将请求一些额外的数据，如纬度、经度等。我们将在<code class="fe ne nf ng nh b">params</code>内通过。我们将把JSON响应解析成一个<code class="fe ne nf ng nh b">WeatherData</code>对象。</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="36c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们需要利用它来检索控制器中的温度。</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="9861" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们必须在UI小部件<code class="fe ne nf ng nh b">HomePage</code>中使用这个新的<code class="fe ne nf ng nh b">temperature</code>变量:</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="ddd6" class="ni lj iq nh b gy og oh l oi oj">///...<br/>Expanded(<br/>  // We will use the city data to fetch the weather<br/>  child: Text(<br/>    "The temperature is ${_controller.temperature}°C",<br/>    style: const TextStyle(fontSize: 18),<br/>  ),<br/>),<br/>///...</span></pre><p id="fb5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行应用程序和tada🎉</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/82a7c8e648ebcddf497112a1733ba88a.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*C9_uG2uq1irrN0yQCzoDFg.png"/></div></figure><h1 id="bd7e" class="li lj iq bd lk ll nx ln lo lp ny lr ls lt nz lv lw lx oa lz ma mb ob md me mf bi translated">额外步骤:添加信息文本并重构行部件</h1><p id="1fc3" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们将完成最后一行项目，这是一个基于天气的信息文本。当然，这取决于多种因素(湿度、压力、最高和最低温度等)。)但为了简单起见，我们只使用温度。我们将有以下4个场景:</p><ol class=""><li id="3956" class="mq mr iq kf b kg kh kk kl ko ms ks mt kw mu la mv mw mx my bi translated"><strong class="kf ir">温度≤ 0 </strong> →“务必穿厚衣服！外面冷死了！”</li><li id="7c56" class="mq mr iq kf b kg mz kk na ko nb ks nc kw nd la mv mw mx my bi translated"><strong class="kf ir">气温≤ 15 </strong> →“穿件外套，别感冒了！”</li><li id="7ef8" class="mq mr iq kf b kg mz kk na ko nb ks nc kw nd la mv mw mx my bi translated"><strong class="kf ir"> else </strong> →“享受天气，真好！”</li><li id="9622" class="mq mr iq kf b kg mz kk na ko nb ks nc kw nd la mv mw mx my bi translated"><strong class="kf ir">温度为零</strong> →“未知”</li></ol><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="ab4f" class="ni lj iq nh b gy og oh l oi oj">/// inside HomeController<br/>_getInfoText(int? temperature) {<br/>  if (temperature == null) {<br/>    infoText.value = "unknown";<br/>  } else if (temperature &lt;= 0) {<br/>    infoText.value =<br/>        "make sure to dress thick cloths! It's freezing out there!";<br/>  } else if (temperature &lt;= 15) {<br/>    infoText.value = "wear a jacket, don't catch a cold!";<br/>  } else {<br/>    infoText.value = "enjoy the weather, it's nice!";<br/>  }<br/>}</span></pre><p id="9f9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用如下所示的新变量更新<code class="fe ne nf ng nh b">HomeController</code>,并将其添加到小部件中。</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="8b9e" class="ni lj iq nh b gy og oh l oi oj">///...</span><span id="2e95" class="ni lj iq nh b gy om oh l oi oj">// A reactive String to display informative text. default is '...'.<br/>RxString infoText = '...'.obs;</span><span id="32d7" class="ni lj iq nh b gy om oh l oi oj">///...</span><span id="5f83" class="ni lj iq nh b gy om oh l oi oj">getTemperatureForCurrentLocation() async {<br/>  // Verify if location is not null first<br/>  if (locationData.value != null) {<br/>    // We assign the response from our API call to our Rx object.<br/>    weatherData.value =<br/>        await _repository.getWeatherForLocation(locationData.value!);<br/>    _getInfoText(weatherData.value?.temp); <strong class="nh ir">// make the call here</strong><br/>  }<br/>}</span></pre><p id="ecb6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一个任务是用一个新的可观察对象更新我们的UI，就这样！</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="bf47" class="ni lj iq nh b gy og oh l oi oj">///...<br/>Expanded(<br/>  // We will give advice on what to do<br/>  child: Text(<br/>    "You should ${_controller.infoText.value}",<br/>    style: TextStyle(fontSize: 18),<br/>  ),<br/>),<br/>///...</span></pre><p id="55f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们看看结果！</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/a52fd7c1fee935acf94b1f5532409a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*yuALf7rvSfcysO44OwsS5g.png"/></div></figure><p id="72af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里的最后一件事是重构我们的行部件。我们可以清楚地注意到他们每个人的模式。容器中的前导图标和尾随文本。我们将创建自己的<code class="fe ne nf ng nh b">RowItem</code>小部件，它将是之前列出的小部件的集合。</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="9315" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更好，可读性更强，对吗？永远记住尝试将相同的模式提取到不同的小部件中。您甚至可以通过创建一个包含名为<code class="fe ne nf ng nh b">RowItem</code>的<code class="fe ne nf ng nh b">StatelessWidget</code> <strong class="kf ir"> </strong>的新文件来使这些小部件全球化。这将允许您在应用程序中任何地方重用行自定义小部件。</p><p id="8fd6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那辆<code class="fe ne nf ng nh b">StatelessWidget</code> <code class="fe ne nf ng nh b">RowItem</code>会是这个样子:</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="c624" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">试着用这个新的<code class="fe ne nf ng nh b">RowItem</code>替换<code class="fe ne nf ng nh b">_rowItem</code>，你会发现它的工作原理完全一样；)</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="0048" class="ni lj iq nh b gy og oh l oi oj">///...<br/>RowItem(<br/>  icon: Icons.<em class="oo">thermostat_outlined</em>,<br/>  text: "The temperature is ${_controller.temperature}°C",<br/>),<br/>///...</span></pre><p id="6c2f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以在<a class="ae kc" href="https://github.com/ademgunay/my_weather_tracker" rel="noopener ugc nofollow" target="_blank"> my GitHub </a>上查看整个项目🚀</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="17f1" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">增强创意</h1><ul class=""><li id="c944" class="mq mr iq kf b kg mg kk mh ko op ks oq kw or la nw mw mx my bi translated">您可以在调用API时添加错误处理。更多信息<a class="ae kc" href="https://dart.dev/codelabs/async-await#example-async-and-await-with-try-catch" rel="noopener ugc nofollow" target="_blank">点击此处</a>。</li><li id="856a" class="mq mr iq kf b kg mz kk na ko nb ks nc kw nd la nw mw mx my bi translated">您可以在<code class="fe ne nf ng nh b">weather</code>内添加一张根据天空状态更新的图像</li></ul><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="c8ff" class="ni lj iq nh b gy og oh l oi oj">"weather": [<br/>    {<br/>      "id": 800,<br/>      "main": "Clear", <strong class="nh ir">// here</strong><br/>      "description": "clear sky",<br/>      "icon": "01d"<br/>    }<br/>  ],<br/>///..</span></pre><ul class=""><li id="f6e3" class="mq mr iq kf b kg kh kk kl ko ms ks mt kw mu la nw mw mx my bi translated">要有创意！</li></ul></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="734c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就这样了，伙计们。感谢阅读，我希望它能帮助你使你的扑动之旅更容易！请继续关注，将会有使用Get的页面导航的第2部分！下次见；)</p><pre class="mm mn mo mp gt oc nh od oe aw of bi"><span id="0086" class="ni lj iq nh b gy og oh l oi oj"><strong class="nh ir">Want to Connect?</strong></span><span id="2ec3" class="ni lj iq nh b gy om oh l oi oj">Caffeinate me to write: <a class="ae kc" href="https://www.buymeacoffee.com/gunayadem" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/gunayadem</a></span></pre></div></div>    
</body>
</html>