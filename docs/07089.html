<html>
<head>
<title>Using useContext and useReducer to Manage a Form’s State</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用useContext和useReducer管理表单的状态</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/react-hooks-and-forms-dedb8072763a?source=collection_archive---------0-----------------------#2020-12-06">https://betterprogramming.pub/react-hooks-and-forms-dedb8072763a?source=collection_archive---------0-----------------------#2020-12-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="63d1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在React中构建更好的表单</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/27b36b813d89c7699284c491a51e3ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7_jYTL0mcwS73kkI"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Efe Kurnaz 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="fc8b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">React的<code class="fe ls lt lu lv b"><a class="ae kv" href="https://reactjs.org/docs/hooks-reference.html#usestate" rel="noopener ugc nofollow" target="_blank">useState</a></code>和<code class="fe ls lt lu lv b"><a class="ae kv" href="https://reactjs.org/docs/hooks-reference.html#useeffect" rel="noopener ugc nofollow" target="_blank">useEffect</a></code>可能是使用和谈论最多的钩子，涵盖了你90%的用例，但是鲜为人知的<code class="fe ls lt lu lv b"><a class="ae kv" href="https://reactjs.org/docs/hooks-reference.html#usecontext" rel="noopener ugc nofollow" target="_blank">useContext</a></code>和<code class="fe ls lt lu lv b"><a class="ae kv" href="https://reactjs.org/docs/hooks-reference.html#usereducer" rel="noopener ugc nofollow" target="_blank">useReducer</a></code>在应用到正确的用例上时绝对令人惊叹。</p><p id="782c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">React根据组件构建UI的方法让您可以将HTML及其状态视为一个实体。然而，在大多数情况下，你的组件的状态可能是彼此不相关的单独的小片段(例如，显示一个加载器，打开一个模态，等等。)使用单独的状态改变处理程序(使用<code class="fe ls lt lu lv b">useState</code>，有几种情况下你的状态可能彼此紧密相关(例如一个复杂的用户信息对象)。在这种情况下，管理和更新它会变得非常麻烦。<code class="fe ls lt lu lv b">useReducer</code>挂钩非常适合这种情况。让我们构建一个简单的表单来更好地理解这一点。</p><p id="229a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的例子使用了<a class="ae kv" href="https://github.com/immerjs/use-immer#useimmerreducer" rel="noopener ugc nofollow" target="_blank"> Immer的减速器</a>，它是React的<code class="fe ls lt lu lv b">useReducer</code>顶部的一个小包装器。想了解更多可以看我之前的<a class="ae kv" href="https://link.medium.com/XfctSuUuzbb" rel="noopener">文章</a>。此外，为了便于理解，这个例子过于简化，但是如果需要，这种方法可以用于扩展。已经有这么多复杂的解决方案，如<a class="ae kv" href="https://formik.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> Formik </strong> </a>和<a class="ae kv" href="https://react-hook-form.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">React Hook Form</strong></a><strong class="ky ir"/>可供您考虑构建表单。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="80cb" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">构建表单</h1><p id="d885" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">我们将构建一个简单的表单来收集用户信息。它被分解成几个组件，每个组件可以根据需要而变得复杂。但是现在，事情很简单:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="eb1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">表单的初始状态如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="4660" class="nc me iq bd mf nd ne dn mj nf ng dp mn lf nh ni mp lj nj nk mr ln nl nm mt nn bi translated">使用上下文</h2><p id="a599" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">您可能已经注意到，我们没有向不同的表单组件传递任何状态属性。我们将使用React的<a class="ae kv" href="https://reactjs.org/docs/context.html#reactcreatecontext" rel="noopener ugc nofollow" target="_blank">上下文API </a>传递我们的状态。在这个小例子中，我们没有道具钻取的问题，但是当表单增长时，当您需要通过道具将状态传递给几个表单组件的子组件时，这个问题很容易出现。</p><p id="1d22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，让我们创建一个上下文来存储这个状态:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="3c11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该文件导出三样东西:</p><ul class=""><li id="5486" class="no np iq ky b kz la lc ld lf nq lj nr ln ns lr nt nu nv nw bi translated"><code class="fe ls lt lu lv b">FormContext</code> —用<code class="fe ls lt lu lv b">null</code> <em class="nx">初始化的上下文对象。</em>这将最终用于保持状态。</li><li id="ff9f" class="no np iq ky b kz ny lc nz lf oa lj ob ln oc lr nt nu nv nw bi translated"><code class="fe ls lt lu lv b">FormProvider</code> —这是一个React组件，每个上下文对象都带有它。该组件接受一个名为<code class="fe ls lt lu lv b">value</code>的属性，它存储任何给定值。此提供程序的任何子组件都可以访问存储值。</li><li id="b293" class="no np iq ky b kz ny lc nz lf oa lj ob ln oc lr nt nu nv nw bi translated"><code class="fe ls lt lu lv b">useFormContext</code> —一个定制的挂钩，用于获取存储在我们的上下文中的值。</li></ul><h2 id="57b7" class="nc me iq bd mf nd ne dn mj nf ng dp mn lf nh ni mp lj nj nk mr ln nl nm mt nn bi translated">使用减速器</h2><p id="4209" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">接下来，我们将创建一个包含修改状态的逻辑的Reducer:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="3f79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">useImmerReducer</code>钩子接受两个参数:缩减器本身和初始状态值。它返回状态和一个更新该状态的函数(这里，我们称之为<code class="fe ls lt lu lv b">dispatch</code>)。更简单地说，这个函数可以被认为是传统的<code class="fe ls lt lu lv b">setState</code>方法。</p><p id="a33d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个缩减器(<code class="fe ls lt lu lv b">FormReducer</code>)接受两个参数:</p><ul class=""><li id="7c98" class="no np iq ky b kz la lc ld lf nq lj nr ln ns lr nt nu nv nw bi translated"><code class="fe ls lt lu lv b">state</code> —每次调用缩减器时，它都会收到最新版本的状态。</li><li id="e7c0" class="no np iq ky b kz ny lc nz lf oa lj ob ln oc lr nt nu nv nw bi translated"><code class="fe ls lt lu lv b">action</code> —这可以是用于修改状态的任何信息。通常，它作为一个物体看起来是这样的:</li></ul><pre class="kg kh ki kj gt od lv oe of aw og bi"><span id="747c" class="nc me iq lv b gy oh oi l oj ok">{<br/>  <strong class="lv ir">key</strong>: 'aKeyFromStateObject',<br/>  <strong class="lv ir">payload</strong>: {}, // a new value for state[key]<br/>}</span></pre><h2 id="08c3" class="nc me iq bd mf nd ne dn mj nf ng dp mn lf nh ni mp lj nj nk mr ln nl nm mt nn bi translated">处理事件</h2><p id="a969" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">回到表单，大多数表单都有一个<code class="fe ls lt lu lv b">handleEvent</code>或<code class="fe ls lt lu lv b">handleChange</code>函数来处理各种输入/选择/复选框等。事件。我们的函数看起来像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="4ef8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这可以与如下输入集成:</p><pre class="kg kh ki kj gt od lv oe of aw og bi"><span id="6805" class="nc me iq lv b gy oh oi l oj ok">&lt;<strong class="lv ir">input</strong><br/>   <strong class="lv ir">value</strong>={state.name.value}<br/>   <strong class="lv ir">onChange</strong>={(e) =&gt; <strong class="lv ir">handleChange</strong>("name", e.target.value)}<br/>/&gt;</span></pre><h2 id="496f" class="nc me iq bd mf nd ne dn mj nf ng dp mn lf nh ni mp lj nj nk mr ln nl nm mt nn bi translated">使用提供商</h2><p id="5f6e" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">到目前为止，我们已经创建了初始状态，创建了缩减器，并将事件处理程序附加到我们的输入中。现在让我们使用<code class="fe ls lt lu lv b">FormProvider</code>组件向表单组件提供状态值:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="e9d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，我们将状态和<code class="fe ls lt lu lv b">handleChange</code>函数传递给<code class="fe ls lt lu lv b">FormProvider</code>的值属性。这些可以在任何子表单组件中访问。</p><h2 id="21d3" class="nc me iq bd mf nd ne dn mj nf ng dp mn lf nh ni mp lj nj nk mr ln nl nm mt nn bi translated">使用我们的自定义钩子获取存储在上下文中的值</h2><p id="5ed3" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">还记得我们创建的用于检索上下文值的<code class="fe ls lt lu lv b">useFormContext</code>定制钩子吗？让我们看看如何使用它:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="4321" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，我们使用自定义钩子来获取<code class="fe ls lt lu lv b">FormContext</code>值，即状态<strong class="ky ir"> </strong>和<code class="fe ls lt lu lv b">handleChange</code>方法。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="01ac" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">把这一切联系在一起</h1><p id="aa66" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">首先，所有这些可能感觉有点奇怪，但是使用这种上下文+ Reducer模式来维护/修改您的相关状态肯定要干净得多。我鼓励你仔细阅读下面的工作示例并进行尝试。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol nb l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">useReducer和useContext挂钩管理React中的表单状态</p></figure><p id="4454" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码可以在这个<a class="ae kv" href="https://codesandbox.io/s/react-hooks-and-forms-450uv" rel="noopener ugc nofollow" target="_blank"> CodeSandBox </a>和<a class="ae kv" href="https://github.com/rkrajat/react-hooks-and-form" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><p id="54b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。</p></div></div>    
</body>
</html>