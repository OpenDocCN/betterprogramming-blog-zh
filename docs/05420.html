<html>
<head>
<title>How to Build a Command-Line Tool With Swift ArgumentParser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Swift ArgumentParser构建命令行工具</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-build-a-command-line-tool-with-swift-argumentparser-a385a1d389d2?source=collection_archive---------6-----------------------#2020-07-07">https://betterprogramming.pub/how-to-build-a-command-line-tool-with-swift-argumentparser-a385a1d389d2?source=collection_archive---------6-----------------------#2020-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="badd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Swift包管理器和ArgumentParser库，然后轻松分发您全新的命令行工具</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/abcf128004afc660efa588fa3aedc34d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qOzD4bmG-SufLToa"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@truemaulik?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">毛里克·苏塔里亚</a>拍摄的照片。</p></figure><p id="c965" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在软件开发中，有时您需要完成一个简单的任务，您需要自动化一些任务，或者您可能需要一个工作流来处理一些操作。在这种情况下，简单的命令行工具非常有用，可以节省您大量的时间。</p><p id="12d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您开发iOS应用程序，您应该熟悉命令行工具，如CocoaPods、Carthage和浪子。想象一下，如果你手动完成所有这些操作。想象一下，您必须克隆一个存储库，并在每次代码更改时获取，手动构建框架，并将其添加到您的项目中。现在想象一下，如果一个简单的命令就可以做到这一点。我们如何构建这样一个工具？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="52a3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">简介</strong></h1><p id="0af7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，我们来学习一些基础知识。我们将使用Swift Package Manager (SPM)创建我们的命令行工具。然后，我们将使用Swift ArgumentParser使我们的代码更加优雅和类型安全。</p><p id="77a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Swift ArgumentParser 是一个新的开源库，它使得解析参数变得更加容易。</p><p id="bf49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是GitHub回购:</p><div class="mz na gp gr nb nc"><a href="https://github.com/apple/swift-argument-parser" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">苹果/swift-argument-parser</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">首先声明一个类型，该类型定义了需要从命令行收集的信息。装饰每个…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq ks nc"/></div></div></a></div><h2 id="425c" class="nr md it bd me ns nt dn mi nu nv dp mm li nw nx mo lm ny nz mq lq oa ob ms oc bi translated">我们开始吧</h2><p id="a086" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我将为演示创建一个简单的base64转换器。那么，我们开始吧。</p><ol class=""><li id="01a1" class="od oe it lb b lc ld lf lg li of lm og lq oh lu oi oj ok ol bi translated">创建一个文件夹并更改目录。</li><li id="11ac" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated">使用SPM创建项目。</li></ol><pre class="kj kk kl km gt or os ot ou aw ov bi"><span id="013d" class="nr md it os b gy ow ox l oy oz">$ mkdir base64Converter<br/>$ cd base64Converter/<br/>$ swift package init --type executable</span></pre><p id="a38c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是您应该看到的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/58444603a39de01bb63e5c96075af16a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B1hbLXMg4fhFgohDAMvorw.png"/></div></div></figure><p id="976d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，您可以使用下面的代码运行您的项目:</p><pre class="kj kk kl km gt or os ot ou aw ov bi"><span id="743b" class="nr md it os b gy ow ox l oy oz">swift run <br/>Prints: Hello, world!</span></pre><p id="34d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="pb">注意:如果你要写测试，把你所有的代码写成一个库。否则，您将无法测试您的代码。这是行不通的。我将在本文的后面向您展示如何做到这一点。</em></p><p id="b07c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到手头的话题。你可以点击<code class="fe pc pd pe os b">Package.swift</code>文件，它会为你打开Xcode。现在，我们可以添加ArgumentParser库。然后，Xcode会自动为您获取并解析库。您的<code class="fe pc pd pe os b">Package.swift</code>文件应该如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="1e50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，您可以开始实现<code class="fe pc pd pe os b">main.swift</code>文件，这是您的命令行工具的入口点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="3475" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在命令行中运行:</p><pre class="kj kk kl km gt or os ot ou aw ov bi"><span id="8cf6" class="nr md it os b gy ow ox l oy oz">swift run base64Converter “Say hi”</span></pre><p id="09f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看结果。它还没有转换，但是它打印了<code class="fe pc pd pe os b">“Say hi”</code>。你不需要每次都使用命令行。你可以在Xcode中点击播放按钮。它也能工作。</p><h2 id="086a" class="nr md it bd me ns nt dn mi nu nv dp mm li nw nx mo lm ny nz mq lq oa ob ms oc bi translated">让我们继续学习一些基础知识</h2><p id="604a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你大概看过<code class="fe pc pd pe os b">@Argument()</code>。这是我们从命令行获取值的方式。ArgumentParser用这些属性包装器为我们处理所有的困难工作:</p><ul class=""><li id="fe83" class="od oe it lb b lc ld lf lg li of lm og lq oh lu ph oj ok ol bi translated"><code class="fe pc pd pe os b">Argument</code></li><li id="38af" class="od oe it lb b lc om lf on li oo lm op lq oq lu ph oj ok ol bi translated"><code class="fe pc pd pe os b">Option</code></li><li id="b29f" class="od oe it lb b lc om lf on li oo lm op lq oq lu ph oj ok ol bi translated"><code class="fe pc pd pe os b">Flag</code></li></ul><p id="fe3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看<a class="ae ky" href="https://github.com/apple/swift-argument-parser/blob/master/Documentation/02%20Arguments%2C%20Options%2C%20and%20Flags.md" rel="noopener ugc nofollow" target="_blank">文档了解更多详情</a>。</p><p id="7022" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们希望使用命令行工具的方式:</p><pre class="kj kk kl km gt or os ot ou aw ov bi"><span id="f3d1" class="nr md it os b gy ow ox l oy oz">&gt; base64Converter "this is an example" --encode<br/>&gt; base64Converter dGhpcyBpcyBhbiBleGFtcGxl --decode</span></pre><p id="c0b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不同的组合可以达到相同的使用效果。因此，选择最适合您需求的选项。因为我们有两个操作，第一个是将string转换为base64，第二个是将base64转换为string。我们会选择<code class="fe pc pd pe os b">@Flag()</code>。但是它与通常的用法有些不同，因为它是一个自定义的枚举。是的，我们能做到！</p><pre class="kj kk kl km gt or os ot ou aw ov bi"><span id="4890" class="nr md it os b gy ow ox l oy oz"><strong class="os iu">enum</strong> CodingType: EnumerableFlag {<br/>  <strong class="os iu">case</strong> encode<br/>  <strong class="os iu">case</strong> decode<br/>}</span></pre><p id="1aff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="29fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样。我们现在有了命令行工具。这非常简单明了。它还是类型安全的，您不必手动进行解析。让我们为我们的命令行工具添加一些测试。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b915" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">试验</h1><p id="865a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在<code class="fe pc pd pe os b">Tests/base64ConverterTests</code>下创建一个名为<code class="fe pc pd pe os b">ConverterTests</code>的文件。添加下面的代码并运行测试(快捷键:Cmd + U):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="5b30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建将失败，您将看到以下错误:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="2c4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于某种原因，您不能测试您的Swift可执行文件，但是您可以为您的库编写测试。因此，如果你要写测试，你应该把你所有的逻辑写在一个库中，并把它作为一个依赖项。当然，您可以根据需要创建任意数量的库。</p><h2 id="83c6" class="nr md it bd me ns nt dn mi nu nv dp mm li nw nx mo lm ny nz mq lq oa ob ms oc bi translated">让我们修正我们的代码</h2><p id="8fce" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在<code class="fe pc pd pe os b">Sources</code>下创建另一个名为<code class="fe pc pd pe os b">Core</code>的文件夹，在<code class="fe pc pd pe os b">Core</code>下创建一个名为<code class="fe pc pd pe os b">Converter.swift</code>的文件。将<code class="fe pc pd pe os b">Converter struct</code>从<code class="fe pc pd pe os b">main.swift</code>复制到该文件中。确保您的文件结构如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/f8e7728bab5319d1b525cb5c059c40a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*2gEIyqewtWVBRpWdk4x1qQ.png"/></div></figure><p id="425f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后打开<code class="fe pc pd pe os b"> Package.swift</code>文件。添加一个名为<code class="fe pc pd pe os b">Core</code>的新目标，并将其作为依赖项添加到<code class="fe pc pd pe os b">base64Converter</code>目标中。之后，它应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="cf2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:如果你的代码没有编译，检查你的导入。移除未使用的代码。</p><ol class=""><li id="b41e" class="od oe it lb b lc ld lf lg li of lm og lq oh lu oi oj ok ol bi translated">在<code class="fe pc pd pe os b">main.swift</code>中，你要加上<code class="fe pc pd pe os b">import Core</code>。</li><li id="d800" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated">在<code class="fe pc pd pe os b">ConverterTests.swift</code>中增加<code class="fe pc pd pe os b">@testable import Core</code>。</li><li id="d114" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated">最后，<code class="fe pc pd pe os b">Converter</code>结构和方法必须是公共的。</li></ol><p id="4bb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您将能够运行您的测试。</p><h2 id="7381" class="nr md it bd me ns nt dn mi nu nv dp mm li nw nx mo lm ny nz mq lq oa ob ms oc bi translated">如何创建版本并安装</h2><p id="8251" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">运行这些命令后，您不需要再次编写<code class="fe pc pd pe os b">swift run</code>来运行您的命令。你可以简单地调用<code class="fe pc pd pe os b">base64Converter</code>:</p><pre class="kj kk kl km gt or os ot ou aw ov bi"><span id="e1d0" class="nr md it os b gy ow ox l oy oz">swift build --configuration release<br/>cp -f .build/release/base64Converter /usr/local/bin/base64Converter</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="747a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">奖金:如何分配</h1><p id="8e93" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">有一个神奇的开源发行工具叫做<a class="ae ky" href="https://github.com/yonaskolb/Mint" rel="noopener ugc nofollow" target="_blank"> Mint </a>。根据文档，它是:</p><blockquote class="pj"><p id="6a75" class="pk pl it bd pm pn po pp pq pr ps lu dk translated">"一个安装和运行Swift命令行工具包的包管理器."</p></blockquote><p id="cf08" class="pw-post-body-paragraph kz la it lb b lc pt ju le lf pu jx lh li pv lk ll lm pw lo lp lq px ls lt lu im bi translated">您还应该将此代码包含在您的<code class="fe pc pd pe os b">Package.swift</code>中:</p><pre class="kj kk kl km gt or os ot ou aw ov bi"><span id="ef8c" class="nr md it os b gy ow ox l oy oz">name: "base64Converter",<br/>products: [<br/> .executable(name: "base64Converter", targets: ["base64Converter"]),<br/>],<br/>...</span></pre><p id="672f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将代码推送到GitHub后，可以运行以下命令:</p><pre class="kj kk kl km gt or os ot ou aw ov bi"><span id="6534" class="nr md it os b gy ow ox l oy oz">brew install mint //if you already have Mint, skip this one</span><span id="79d9" class="nr md it os b gy py ox l oy oz">mint install ibrahimoktay/base64Converter  //<!-- -->github_name/repo_name</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8c32" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="de3d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">感谢您的阅读！如果您有任何问题或反馈，请联系我们。您可以通过下面的链接找到该项目:</p><div class="mz na gp gr nb nc"><a href="https://github.com/ibrahimoktay/base64Converter" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">Ibrahim oktay/base64转换器</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">将string转换为Base64和Base64转换为string的简单命令行工具</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.com</p></div></div><div class="nl l"><div class="pz l nn no np nl nq ks nc"/></div></div></a></div></div></div>    
</body>
</html>