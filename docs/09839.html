<html>
<head>
<title>Debugging on iOS 15 With Xcode 12</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Xcode 12在iOS 15上调试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/debugging-on-ios-15-with-xcode-12-8d3ca7487bd2?source=collection_archive---------10-----------------------#2021-10-19">https://betterprogramming.pub/debugging-on-ios-15-with-xcode-12-8d3ca7487bd2?source=collection_archive---------10-----------------------#2021-10-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d5a9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如果你的应用程序仍然需要Xcode 12.5来构建，它仍然必须在iOS 15上工作良好。本文展示了如何使用Xcode 12调试iOS 15上的应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7792a4b7d2e9fa8ccc17ab8130b15a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F23zfzYWLp5zBMZT"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@imkirk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">伊韦克·诺斯</a>拍摄的照片</p></figure><p id="35d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每年我们都会推出新的主要iOS版本来测试我们的应用。幸运的人可以立即升级到最新的Xcode 13，基于最新的iOS 15 SDK构建。其他一些更大的项目可能需要一段时间来升级，同时必须使用Xcode 12.5来构建。</p><p id="a5f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开箱即用，较旧的Xcode版本无法与较新的iOS版本兼容。如果您尝试在Xcode 12.5上使用iOS 15设备，该设备将被标记为不受支持，并且在运行时会出现错误:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d7aa" class="ma mb it lw b gy mc md l me mf">The run destination is not valid for running the scheme. Xcode doesn’t support iOS 15.</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/e879f23e6daf1d17c0d431133d0316d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/0*YZFDOgILjhIAEy8A.png"/></div></figure><p id="3984" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，通过一些技巧，我不仅可以在带有Xcode 12.5的iOS 15上运行，还可以使用断点进行调试等等。</p><blockquote class="mh mi mj"><p id="5d84" class="kz la mk lb b lc ld ju le lf lg jx lh ml lj lk ll mm ln lo lp mn lr ls lt lu im bi translated"><em class="it">如果你在找去年的帖子，就在这里:</em> <a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/debugging-on-ios-14-with-xcode-11-d332f12f49dd?source=friends_link&amp;sk=89454bc213ad54dd3fb773f5f19e3057"> <em class="it">用Xcode 11 </em> </a>在iOS 14上调试</p></blockquote></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="c53b" class="mv mb it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">安装Xcode 13后</h1><p id="2ed6" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">如果您的机器上同时安装了Xcode 13和Xcode 12，那么您很幸运。由于Xcode 13的变化，Xcode 12现在可以为更新的iOS版本获取设备支持文件。不再需要复制设备支持文件或类似的东西。</p><p id="fe47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论如何，你都有可能需要Xcode 13——用于其他项目或者只是玩玩——所以这是一个很好的选择。</p><p id="ba78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你有了Xcode 13，启动它，在提示时安装命令行工具，在你的iOS 15设备上运行任何项目至少一次。瞧，你现在可以像平常一样在Xcode 12.5中使用你的设备来运行、调试等等。</p><p id="a6ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要将Xcode 13与Xcode 12并行安装，我可以想到几个选项:</p><ul class=""><li id="152f" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">使用<code class="fe oa ob oc lw b"><a class="ae ky" href="https://github.com/xcpretty/xcode-install" rel="noopener ugc nofollow" target="_blank">xcode-install</a></code>命令行工具</li><li id="d570" class="nr ns it lb b lc od lf oe li of lm og lq oh lu nw nx ny nz bi translated">从<a class="ae ky" href="https://developer.apple.com/download/all/" rel="noopener ugc nofollow" target="_blank">下载</a>下载Xcode 13</li><li id="7a3c" class="nr ns it lb b lc od lf oe li of lm og lq oh lu nw nx ny nz bi translated">如果您从App Store安装Xcode，请升级它，并从<a class="ae ky" href="https://developer.apple.com/download/all/" rel="noopener ugc nofollow" target="_blank">下载</a>再次下载Xcode 12</li><li id="4469" class="nr ns it lb b lc od lf oe li of lm og lq oh lu nw nx ny nz bi translated">如果你从App Store安装你的Xcode，在升级App Store版本之前先解压或移动<code class="fe oa ob oc lw b">Xcode.app</code>(仅仅重命名无济于事)，App Store更新完成后再解压或移回<code class="fe oa ob oc lw b">/Applications</code>。</li></ul><h1 id="0789" class="mv mb it bd mw mx oi mz na nb oj nd ne jz ok ka ng kc ol kd ni kf om kg nk nl bi translated">如何防止Xcode 13意外重建</h1><p id="c755" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">由于您使用Xcode 12进行构建，但也安装了Xcode 13，因此您可能会意外地在Xcode 13上进行构建，并最终推出与最初预期完全不同的应用程序构建版本。为了避免意外地使用Xcode 13进行构建，您可以为这种情况添加一个条件编译错误:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e84d" class="ma mb it lw b gy mc md l me mf">#if compiler(&gt;=5.5)<br/>#error("This project should not be built on Xcode 13")<br/>#endif</span></pre><p id="c6e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码可以放在源代码中的任何地方。当使用低于5.5的任何版本的Swift编译器编译源代码时，跳过<code class="fe oa ob oc lw b">#error</code>指令，该版本对应于Xcode 12.5或更旧版本。这样，在Xcode 13上意外构建甚至在技术上也是不可能的。</p><h1 id="7240" class="mv mb it bd mw mx oi mz na nb oj nd ne jz ok ka ng kc ol kd ni kf om kg nk nl bi translated">没有安装Xcode 13</h1><p id="9314" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">如果由于某种原因无法在机器上安装Xcode 13，仍然有办法在装有iOS 15的设备上运行和调试。</p><p id="58ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Xcode中常见的运行操作由几个独立的步骤组成:</p><ul class=""><li id="6d62" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">为设备构建。</li><li id="f10a" class="nr ns it lb b lc od lf oe li of lm og lq oh lu nw nx ny nz bi translated">在设备上安装应用程序。</li><li id="e7c5" class="nr ns it lb b lc od lf oe li of lm og lq oh lu nw nx ny nz bi translated">启动应用程序。</li><li id="2e89" class="nr ns it lb b lc od lf oe li of lm og lq oh lu nw nx ny nz bi translated">附加调试器。</li></ul><p id="829f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些步骤依赖于Xcode能够与物理设备进行通信，并且iOS版本之间的通信接口会发生变化。因此，调试用旧版本Xcode构建的应用程序需要一些技巧。</p><h1 id="11c8" class="mv mb it bd mw mx oi mz na nb oj nd ne jz ok ka ng kc ol kd ni kf om kg nk nl bi translated">使用Xcode 12构建并安装iOS 15的调试版本</h1><p id="c83b" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">能够运行最新的iOS版本是我们以前每年都要解决的问题。谢天谢地，同样的解决方案每次都有效。Xcode应用程序捆绑包包含它知道如何使用的每个iOS版本的支持文件。</p><p id="e172" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在Xcode 12.5中增加对iOS 15的支持，我们需要将iOS 15的设备支持文件复制到Xcode 12中。</p><p id="b9c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，它们是从Xcode 13复制的(从同事的机器上或从流行的共享repo下载)。</p><p id="d5c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它已经被广泛讨论，所以这里有一篇我喜欢的关于这个主题的文章:<a class="ae ky" href="https://faizmokhtar.com/posts/how-to-fix-xcode-could-not-locate-device-support-files-error-without-updating-your-xcode/" rel="noopener ugc nofollow" target="_blank">如何修复Xcode:“找不到设备支持文件”错误</a>。</p><h1 id="cefe" class="mv mb it bd mw mx oi mz na nb oj nd ne jz ok ka ng kc ol kd ni kf om kg nk nl bi translated">启动应用程序</h1><p id="1da0" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">使用默认设置，调试应用程序版本将在安装后自动尝试在所选设备上启动。可悲的是，Xcode 12.5并不完全知道如何在iOS 15上启动应用程序——它会尝试，但应用程序会在启动屏幕上冻结(至少我是这么体验的)。</p><p id="ecbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过在启动期间禁用调试来解决冻结问题。别担心，我们可以在app成功启动后重新附加调试器。</p><p id="c6d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在启动期间禁用调试，请禁用“调试可执行文件”复选框:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/806f2e53646308e09b8aadc5b1c88cb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Sn7p3r7DHsSwjN4_.png"/></div></div></figure><p id="7273" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">禁用此复选框后，应用程序将正常启动，尽管没有调试器。该应用程序可以使用，日志如预期的那样显示在Xcode的控制台中。参见下面如何让断点工作。</p><h1 id="bb74" class="mv mb it bd mw mx oi mz na nb oj nd ne jz ok ka ng kc ol kd ni kf om kg nk nl bi translated">使用断点调试</h1><p id="ea3b" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">如果需要适当的调试，我推荐在侧面安装Xcode 13(更简单的选项)，见上图:<a class="ae ky" href="https://hybridcattt.com/blog/debugging-on-latest-ios-with-older-xcode#with-xcode-13-installed" rel="noopener ugc nofollow" target="_blank">安装Xcode 13</a>。如果这不可能，Xcode 12.5似乎可以调试运行在iOS 15上的应用程序，即使没有安装Xcode 13，尽管可能会有一些微妙的问题。如果这是你唯一的选择，继续阅读，学习如何让它工作。</p><p id="374d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦应用程序启动，我们需要手动将调试器连接到正在运行的进程。</p><p id="ee6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在测试应用程序的任何时候，我们都可以通过进入菜单选项<code class="fe oa ob oc lw b">Debug &gt; Attach to Process</code>并选择应用程序的进程来连接调试器。应用程序名称应出现在“可能的目标”下。可能需要几秒钟来连接。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/0605f4ccdf3c1b3537bd935e74542a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*09MXIHI4eDoWVTT9.png"/></div></div></figure><p id="6426" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦成功连接，它会在进程名旁边显示<code class="fe oa ob oc lw b">already being debugged</code>。</p><p id="52e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可悲的是，一旦附加了调试器，控制台输出就会从Xcode的控制台中消失。这是因为控制台被调试器接管，而调试器本身不会将应用程序的标准输出路由到控制台。尽管如此，仍然有一种方法可以访问日志:</p><h1 id="3cdf" class="mv mb it bd mw mx oi mz na nb oj nd ne jz ok ka ng kc ol kd ni kf om kg nk nl bi translated">记录</h1><p id="2850" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">如果我们还想在手动附加调试器后查看日志，我们可以在控制台应用程序中查看它们。为了让应用程序的日志显示在那里，我们需要使用相对较新的系统<code class="fe oa ob oc lw b">os</code>框架来记录它们:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="cb66" class="ma mb it lw b gy mc md l me mf">import os<br/>...<br/>func logError(_ msg: StaticString, _ params: Any...) {<br/>    os_log(msg, log: OSLog.default, type: .error, params)<br/>}<br/>...<br/>logError("Value: %{public}@", property)</span></pre><p id="0f66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe oa ob oc lw b">%{public}@</code>而不仅仅是<code class="fe oa ob oc lw b">%@</code>允许我们即使没有附加调试器也能看到变量。默认情况下，变量是私有的，以防止通过日志泄露敏感数据。<a class="ae ky" href="https://www.avanderlee.com/workflow/oslog-unified-logging/" rel="noopener ugc nofollow" target="_blank">阅读更多关于SwiftLee上统一日志记录的信息</a>。</p><p id="dac7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以检查设备日志，可以通过许多参数进行过滤，如应用程序名称、日志级别等:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/f38a906a58974ecc09d6dfdb455d0ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*enB4e0J90csF6Rxs.png"/></div></div></figure><p id="a00c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用日志级别<code class="fe oa ob oc lw b">.error</code>记录了我的应用程序的消息，因为它们在每条消息旁边都有一个明显的黄点，这样更容易过滤掉大多数系统消息。</p><p id="8d18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值得一提的是，用<code class="fe oa ob oc lw b">NSLog</code>记录的消息也会显示在控制台应用程序中。我不建议在Swift代码中使用<code class="fe oa ob oc lw b">NSLog</code>，因为<code class="fe oa ob oc lw b">os_log</code>是目前苹果平台上的首选登录方式。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="4a1f" class="mv mb it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">包扎</h1><p id="3f23" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">即使我们这些没有那么幸运能够马上升级到Xcode 13的人也可以在运行iOS 15的设备上运行和调试应用程序。</p><p id="2f7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过在侧面安装Xcode 13，我们可以在iOS 15上赋予Xcode 12.5完整的调试能力。我们还可以在iOS 15上构建、启动和测试应用程序，并使用系统控制台应用程序检查日志，而所有这些都只有Xcode 12.5。</p><p id="f81d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这些技巧也能帮助其他人:)</p><p id="9fd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。我希望你喜欢这篇文章。要获得关于新帖子的通知，<a class="ae ky" href="https://twitter.com/hybridcattt" rel="noopener ugc nofollow" target="_blank">在Twitter上关注我</a>。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="fe1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mk">最初发表于</em><a class="ae ky" href="http://hybridcattt.com/blog/debugging-on-latest-ios-with-older-xcode" rel="noopener ugc nofollow" target="_blank">T5【https://hybridcattt.com】</a><em class="mk">。本帖由作者在NC SA 4.0 </em>  <em class="mk">下</em> <a class="ae ky" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener ugc nofollow" target="_blank"> <em class="mk"> CC授权。</em></a></p></div></div>    
</body>
</html>