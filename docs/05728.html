<html>
<head>
<title>3 Simple Ways to Time Your Python Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Python代码计时的3种简单方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/top-3-ways-to-time-python-code-d46b37d418e0?source=collection_archive---------3-----------------------#2020-07-31">https://betterprogramming.pub/top-3-ways-to-time-python-code-d46b37d418e0?source=collection_archive---------3-----------------------#2020-07-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c41f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我的代码太慢了吗？太快了？速度刚刚好？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/08566883bfad1a3b59f026ed6e43c0a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lqftCC7Rp4l0IFVopiUoQg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://www.pexels.com/photo/person-using-macbook-pro-1181373/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae kv" href="https://www.pexels.com/@divinetechygirl?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Christina Morillo </a>拍摄。</p></figure><p id="6779" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有时，您将在一个项目中工作，其中代码的速度很重要，并且您想知道代码在时间上的执行情况。</p><p id="f595" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也许你注意到你的程序太慢了，你想找到性能瓶颈，或者你只是想测量你的代码运行所花费的时间。</p><p id="55b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">无论哪种方式，您都需要以某种方式为您的代码计时。</p><p id="a76f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有许多方法可以实现这一点，但我将分享我最简单/最容易使用的三个技巧。</p><p id="b33d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以让我们开始吧！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="e903" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">使用函数装饰器</h1><p id="ed4a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这是一个简单、强力的计时函数解决方案，在项目中非常有用(例如，您可能希望记录每个函数调用需要多长时间)。它没有<a class="ae kv" href="https://docs.python.org/3/library/timeit.html" rel="noopener ugc nofollow" target="_blank">的时间表</a>精确。我不建议将它用于更快的代码，但它对于计时“较慢”的函数很有好处:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="72eb" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">使用timeit</h1><p id="f5ec" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这是一个<a class="ae kv" href="https://docs.python.org/3/library/timeit.html" rel="noopener ugc nofollow" target="_blank">简单的内置工具</a>,非常适合计时小块代码。</p><p id="93ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从<a class="ae kv" href="https://docs.python.org/3/library/timeit.html" rel="noopener ugc nofollow" target="_blank">文档</a>中:</p><blockquote class="my mz na"><p id="6ac8" class="kw kx nb ky b kz la jr lb lc ld ju le nc lg lh li nd lk ll lm ne lo lp lq lr ij bi translated">“这个模块提供了一种简单的方法来计时Python代码的小片段。它既有一个<a class="ae kv" href="https://docs.python.org/3/library/timeit.html#timeit-command-line-interface" rel="noopener ugc nofollow" target="_blank">命令行界面</a>也有一个<a class="ae kv" href="https://docs.python.org/3/library/timeit.html#python-interface" rel="noopener ugc nofollow" target="_blank">可调用界面</a>。它避免了许多测量执行时间的常见陷阱。”</p></blockquote><p id="d903" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将为所有基本用例提供一些例子。</p><ul class=""><li id="deb4" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">计时不带参数的函数:</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><ul class=""><li id="7fd9" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">用参数计时函数:</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><ul class=""><li id="5c03" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">时间λ表达式:</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><ul class=""><li id="1bf0" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">计时代码片段:</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="b6bd" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">将cProfile与snakeviz一起使用</h1><p id="68c4" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这里有一个更详细的分析组合。我建议对复杂的代码使用这种方法，因为它对于发现潜在的性能瓶颈非常有用。</p><ul class=""><li id="d29d" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">cProfile是一个内置的C扩展，它提供了一组统计数据，描述了程序的各个部分执行的频率和时间。这组统计数据被称为<em class="nb">简档</em>。</li><li id="9058" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><a class="ae kv" href="https://github.com/jiffyclub/snakeviz/" rel="noopener ugc nofollow" target="_blank"> snakeviz </a>是一个第三方Python库，用于在浏览器中可视化这些统计数据，并以更加用户友好的方式解释它们。</li></ul><p id="cabf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想要特定代码段的精确计时，我仍然会推荐<a class="ae kv" href="https://docs.python.org/3/library/timeit.html" rel="noopener ugc nofollow" target="_blank"> timeit </a>，但是对于寻找潜在的瓶颈，在我看来这是最好的选择。</p><p id="8ea5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据<a class="ae kv" href="https://docs.python.org/3/library/profile.html#module-cProfile" rel="noopener ugc nofollow" target="_blank">文件</a>:</p><blockquote class="my mz na"><p id="0181" class="kw kx nb ky b kz la jr lb lc ld ju le nc lg lh li nd lk ll lm ne lo lp lq lr ij bi translated">“分析器模块旨在为给定的程序提供一个执行概要，而不是为了进行基准测试(为此，有<code class="fe nt nu nv nw b"><a class="ae kv" href="https://docs.python.org/3/library/timeit.html#module-timeit" rel="noopener ugc nofollow" target="_blank">timeit</a></code>来获得相当准确的结果)。这尤其适用于Python代码与C代码的基准测试:分析器为Python代码引入了开销，但没有为C级函数引入开销，因此C代码看起来比任何Python代码都要快。”</p></blockquote><p id="2894" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nb">注意:需要先</em> <a class="ae kv" href="https://github.com/jiffyclub/snakeviz/" rel="noopener ugc nofollow" target="_blank"> <em class="nb">安装snakeviz </em> </a> <em class="nb">！</em></p><p id="71ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行这个脚本。<a class="ae kv" href="https://docs.python.org/3/library/profile.html#module-cProfile" rel="noopener ugc nofollow" target="_blank"> cProfile </a>会将结果转储到名为<code class="fe nt nu nv nw b">results.prof</code>的文件中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="b013" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过运行以下命令，使用<a class="ae kv" href="https://github.com/jiffyclub/snakeviz/" rel="noopener ugc nofollow" target="_blank"> snakeviz </a>在浏览器中查看结果:</p><pre class="kg kh ki kj gt nx nw ny nz aw oa bi"><span id="1c09" class="ob ma iq nw b gy oc od l oe of">snakeviz results.prof</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/fd0b082744a6d5803f089cb0a2881904.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nmNcROfmyAAdkYm-mOGtNg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">函数调用堆栈(从顶部开始)</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/930898cb597d895c3752cac71cba4b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GAamkKLXERD6H-7I9i2jBA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">统计数据(更多信息见<a class="ae kv" href="https://jiffyclub.github.io/snakeviz/#interpreting-results" rel="noopener ugc nofollow" target="_blank">https://jiffyclub.github.io/snakeviz/#interpreting-results</a></p></figure><p id="92db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从第一张图片中，我们可以很容易地看到<code class="fe nt nu nv nw b">bottleneck()</code>函数执行时间最长，因此这可能表明存在潜在的性能瓶颈。而且还可以看到导致它运行这么久的底层<code class="fe nt nu nv nw b">sleep()</code> <em class="nb"> </em>函数<em class="nb"> </em>。</p><p id="1d77" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还获得了一些额外的统计数据，比如调用堆栈中每个函数的调用次数，这可能有助于检测也会影响性能的冗余调用。</p><p id="ce00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在GitHub 上找到更多关于如何解释结果<a class="ae kv" href="https://jiffyclub.github.io/snakeviz/#interpreting-results" rel="noopener ugc nofollow" target="_blank">的信息。</a></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0b89" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">荣誉奖</h1><ul class=""><li id="f022" class="nf ng iq ky b kz mr lc ms lf oi lj oj ln ok lr nk nl nm nn bi translated"><a class="ae kv" href="https://github.com/pyutils/line_profiler" rel="noopener ugc nofollow" target="_blank"> line_profiler </a></li><li id="8ea4" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><a class="ae kv" href="https://github.com/gak/pycallgraph" rel="noopener ugc nofollow" target="_blank"> pycallgraph </a></li><li id="5828" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><a class="ae kv" href="https://github.com/mgedmin/profilehooks" rel="noopener ugc nofollow" target="_blank">个人资料查看</a></li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="02be" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="f0e2" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这些是我认为应该涵盖几乎所有用例的前三项技术。我希望这能对你有所帮助。</p><p id="a27b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编码快乐！</p></div></div>    
</body>
</html>