<html>
<head>
<title>Using window.matchMedia in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中使用window.matchMedia</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-window-matchmedia-in-react-8116eada2588?source=collection_archive---------9-----------------------#2021-01-15">https://betterprogramming.pub/using-window-matchmedia-in-react-8116eada2588?source=collection_archive---------9-----------------------#2021-01-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e094" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">剧透:Safari让它乱七八糟</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/190ba89a48b071c1bbfb34b719cf3acd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1wfirAP3QRzydAd43ZEjBw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@sophiesollmann?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">索菲</a>在<a class="ae kv" href="https://unsplash.com/collections/1841908/motel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="d7ad" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">为什么要用window.matchMedia？</h1><p id="1717" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">通常，我们可以使用一个<code class="fe mk ml mm mn b">css @media</code>查询来改变内容如何显示给不同屏幕尺寸的用户。然而，有时仅仅使用CSS很难达到你想要的效果。也许:</p><ul class=""><li id="2de5" class="mo mp iq lq b lr mq lu mr lx ms mb mt mf mu mj mv mw mx my bi translated">布局是如此的不同，以至于你可能要重写整个组件</li><li id="2d3a" class="mo mp iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">您希望包含一些其他逻辑，比如不同的日志记录或其他内容</li><li id="6086" class="mo mp iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">你脑子都炸了，搞不清楚CSS。</li></ul><p id="ad33" class="pw-post-body-paragraph lo lp iq lq b lr mq jr lt lu mr ju lw lx ne lz ma mb nf md me mf ng mh mi mj ij bi translated">无论您的理由是什么，使用JavaScript检查屏幕大小都是一个有用的工具。</p><h1 id="de56" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">步骤0:设置</h1><p id="6efe" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">让我们来设定场景:</p><p id="c3d9" class="pw-post-body-paragraph lo lp iq lq b lr mq jr lt lu mr ju lw lx ne lz ma mb nf md me mf ng mh mi mj ij bi translated">您有一个React功能组件<code class="fe mk ml mm mn b">MyReponsiveComponent</code>。您希望为桌面用户显示一样东西，而为使用较窄设备的用户显示完全不同的东西。你有一个变量<code class="fe mk ml mm mn b">isNarrowScreen</code>，你用它在两者之间切换，但是现在，它总是被设置为<code class="fe mk ml mm mn b">false</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="d516" class="kw kx iq bd ky kz nq lb lc ld nr lf lg jw ns jx li jz nt ka lk kc nu kd lm ln bi translated">第一步:初始计算</h1><p id="16bb" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">使用<code class="fe mk ml mm mn b">matchMedia </code>最简单的方法是使用一次性的<code class="fe mk ml mm mn b">true </code>或<code class="fe mk ml mm mn b">false </code>查询。我们调用<code class="fe mk ml mm mn b">window.matchMedia</code>并传递我们可能用于CSS版本的同类<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries" rel="noopener ugc nofollow" target="_blank">媒体查询字符串</a>。</p><p id="0234" class="pw-post-body-paragraph lo lp iq lq b lr mq jr lt lu mr ju lw lx ne lz ma mb nf md me mf ng mh mi mj ij bi translated">这种情况下，不超过500px我就说是窄屏，所以我们的查询字符串是<code class="fe mk ml mm mn b">"(max-width: 500px)"</code>。注意括号——没有它们就不行！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="c818" class="kw kx iq bd ky kz nq lb lc ld nr lf lg jw ns jx li jz nt ka lk kc nu kd lm ln bi translated">第二步:全面响应</h1><p id="0b14" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">假设窗口的宽度保持不变，上面的方法工作得很好。然而，如果我们想响应用户调整窗口大小或旋转设备，我们需要更新<code class="fe mk ml mm mn b">isNarrowScreen</code>。</p><p id="4995" class="pw-post-body-paragraph lo lp iq lq b lr mq jr lt lu mr ju lw lx ne lz ma mb nf md me mf ng mh mi mj ij bi translated">我们可以通过给<code class="fe mk ml mm mn b">window.matchMedia</code>的结果添加一个事件监听器来做到这一点，这将让我们知道何时需要改变我们的布局方法。</p><p id="2829" class="pw-post-body-paragraph lo lp iq lq b lr mq jr lt lu mr ju lw lx ne lz ma mb nf md me mf ng mh mi mj ij bi translated">我们将使用<code class="fe mk ml mm mn b">useEffect</code>和<code class="fe mk ml mm mn b">useState</code>来完成此操作。</p><p id="cbab" class="pw-post-body-paragraph lo lp iq lq b lr mq jr lt lu mr ju lw lx ne lz ma mb nf md me mf ng mh mi mj ij bi translated">需要注意的事项:</p><ul class=""><li id="c986" class="mo mp iq lq b lr mq lu mr lx ms mb mt mf mu mj mv mw mx my bi translated">确保在<code class="fe mk ml mm mn b">useEffect</code>中返回一个<code class="fe mk ml mm mn b">cleanup </code>函数来移除事件监听器。</li><li id="a48e" class="mo mp iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">在文档中，您可能会注意到window.matchMedia 的<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList" rel="noopener ugc nofollow" target="_blank">结果有一个<code class="fe mk ml mm mn b">addListener</code>方法，但是建议我们尽可能使用<code class="fe mk ml mm mn b">addEventListener</code>。我们将暂时使用<code class="fe mk ml mm mn b">addEventListener</code>，并在下一步处理<em class="nv">不可能</em>的情况。</a></li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="4352" class="kw kx iq bd ky kz nq lb lc ld nr lf lg jw ns jx li jz nt ka lk kc nu kd lm ln bi translated">步骤3:在旧版本的Safari上修复它</h1><p id="266f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">所以，以前的版本似乎在Chrome上运行得很好，但是在iPhone上打开它，什么都没有。空白的一页，完全碎了。</p><p id="f1b6" class="pw-post-body-paragraph lo lp iq lq b lr mq jr lt lu mr ju lw lx ne lz ma mb nf md me mf ng mh mi mj ij bi translated">事实证明，尽管Safari支持我们的<code class="fe mk ml mm mn b">addEventListener </code>用法，但它支持它的时间并不长(在撰写本文时)。所以，让我们用废弃的<code class="fe mk ml mm mn b">addListener</code>做一些向后兼容。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="1f4a" class="kw kx iq bd ky kz nq lb lc ld nr lf lg jw ns jx li jz nt ka lk kc nu kd lm ln bi translated">第四步:提取</h1><p id="5c17" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">最后，我们将它设置为在所有这些边缘情况下都能正常工作。它很长，很难看，我们不想在我们的代码库中重复多次。因此，让我们将其提取为一个包装组件。</p><p id="631c" class="pw-post-body-paragraph lo lp iq lq b lr mq jr lt lu mr ju lw lx ne lz ma mb nf md me mf ng mh mi mj ij bi translated">我们将传递两个不同的版本作为道具，并根据之前的逻辑返回合适的版本。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="dc0a" class="kw kx iq bd ky kz nq lb lc ld nr lf lg jw ns jx li jz nt ka lk kc nu kd lm ln bi translated">全部完成！</h1><p id="3c3c" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们可以进一步概括——可能会传递任意数量的不同显示版本以及相应的显示大小列表——但是，这个版本对于我的目的来说已经足够好了，所以我将把它留在这里。</p></div></div>    
</body>
</html>