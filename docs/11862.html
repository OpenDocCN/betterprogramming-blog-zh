<html>
<head>
<title>Practicing Clean Architecture in C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用C#实践干净的架构</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/practicing-clean-architecture-in-c-62fe55aed83c?source=collection_archive---------0-----------------------#2022-04-22">https://betterprogramming.pub/practicing-clean-architecture-in-c-62fe55aed83c?source=collection_archive---------0-----------------------#2022-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cc5d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将我的知识付诸实践</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7b3ce5f53703b9d39490bd18b2ad8572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bTuGw-ynX74b_eSY"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@altumcode?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> AltumCode </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="6045" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我一直在看鲍勃大叔的<a class="ae kv" href="https://www.amazon.co.uk/Clean-Architecture-Craftsmans-Software-Structure/dp/0134494164" rel="noopener ugc nofollow" target="_blank">清洁建筑书。我想我应该通过使用干净的架构原则创建一个迷你项目来检查我是否正确理解了一切。我就是这样上来的。</a></p><h1 id="eda2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是干净的建筑？</h1><p id="af02" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">下图展示了清洁建筑是如何工作的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/d0f23f56a6137b4d55e84d607aac30c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qO9HNhWOpEDGk0kW.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">干净的架构图</p></figure><p id="80a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个想法是圆依赖于它们内部的圆，即依赖关系指向内部。中间是应该保持不变的业务规则——这些规则不应该依赖于圈子中更远的任何东西。</p><p id="421c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目标是能够非常容易地改变您可能改变主意的事情(例如，外部框架、数据库和UI格式),并且核心业务逻辑不必更新。这也有助于代码易于测试。</p><p id="2ec5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了实践clean architecture，我将使用C#构建一个应用程序，允许用户键入地址，然后用户将返回有关位置的更多详细信息，特别是地理坐标和完整地址。一个有点无意义的应用程序，但我们走吧！</p><p id="beb3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的项目将有一个三层架构——领域层、数据层和表示层。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/72779b8e619f2e00bd160222b40bb68e.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/0*ko3kjyGbTbjt7TJJ"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我的应用程序的图层(箭头跟随依赖项)</p></figure><p id="d55e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将遵循圆圈图中显示的干净的架构结构。</p><h1 id="d455" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">域层</strong></h1><p id="e930" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们从实体开始。</p><h2 id="0ea2" class="mr lt iq bd lu ms mt dn ly mu mv dp mc lf mw mx me lj my mz mg ln na nb mi nc bi translated">实体</h2><p id="3408" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">实体是应用程序的业务对象。它们有最通用的高层规则，不会在外部有什么变化的时候改变。实体层应该不受其他层中任何更改的影响。</p><p id="82ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的应用程序中，我希望只有一个实体，名为<code class="fe nd ne nf ng b">LocationEntity</code>。它将具有三个属性:<code class="fe nd ne nf ng b">FullAddress</code>、<code class="fe nd ne nf ng b">Latitude</code>和<code class="fe nd ne nf ng b">Longitude</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h2 id="33a5" class="mr lt iq bd lu ms mt dn ly mu mv dp mc lf mw mx me lj my mz mg ln na nb mi nc bi translated">用例</h2><p id="c296" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在应用程序的“用例”部分，有特定于应用程序的业务规则(与企业使用的其他应用程序无关)。</p><p id="8067" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对用例的任何更改都不应该影响实体层中的LocationEntity。此外，这一层不应受到对数据库、UI或所用框架的任何更改的影响。</p><p id="b708" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的应用程序中，我将有一个用例，它将获得位置细节，给定一个地址。</p><p id="e3d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将创建一个<code class="fe nd ne nf ng b">GetLocationInteractor</code>类。这将有一个名为<code class="fe nd ne nf ng b">Handle</code>的方法，它将调用<code class="fe nd ne nf ng b">IRepository</code>(稍后会详细介绍)的方法到<code class="fe nd ne nf ng b">GetLocation</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h2 id="a137" class="mr lt iq bd lu ms mt dn ly mu mv dp mc lf mw mx me lj my mz mg ln na nb mi nc bi translated">接口</h2><p id="12cd" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">接口层中有<code class="fe nd ne nf ng b">IRepository</code>接口。接口层的想法是将数据从用例或实体中使用的形式转换成存储库(或数据库)或表示中使用的格式。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="3f72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的代码中为<code class="fe nd ne nf ng b">IRepository</code>使用一个接口也使得通过编写单元测试来测试我的代码变得非常容易。在这里，我模拟来自存储库的结果，以检查我的用例是否正常工作。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="5d88" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">数据层</h1><p id="711e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">应用程序的数据层包含在域层中定义的数据接口的实现。在我的例子中，我需要实现的是IRepository。</p><p id="e804" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">LocationRepository</code>实现了<code class="fe nd ne nf ng b">IRepository</code>的<code class="fe nd ne nf ng b">GetLocation</code>方法，该方法调用另一个方法到在名为<code class="fe nd ne nf ng b">ILocationApi</code>的接口中定义的<code class="fe nd ne nf ng b">GetLocationData</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="0651" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">GoogleMapsApi</code>类使用nuget包<code class="fe nd ne nf ng b"><a class="ae kv" href="https://github.com/ericnewton76/gmaps-api-net" rel="noopener ugc nofollow" target="_blank">gmaps-api-net</a></code> <em class="nj"> </em>来获取用户使用Google Maps API输入的地址位置的数据。</p><p id="2c8f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码非常简单——你需要做的就是从<a class="ae kv" href="https://console.cloud.google.com/projectselector2/google/maps-apis/credentials" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>获得一个API密钥，然后使用下面的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="d3a3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">表示层</h1><p id="d90d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">表示层是最外层。因为这一层与其他层是分离的，所以任何类型的表示都是可能的。对于这个例子，我将使用一个很好的简单的控制台应用程序。</p><p id="41dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的程序中，我要求用户输入一个地址。当他们这样做时，控制台应用程序上会显示<code class="fe nd ne nf ng b">FullAddress</code>和<code class="fe nd ne nf ng b">Latitude</code>以及<code class="fe nd ne nf ng b">Longitude</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="d8bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个漂亮的应用程序:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/fa064c145a4871dfa917045498964a92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*acXGUpdvXwBXDDIu"/></div></div></figure><p id="cb3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是你想要的——一个用干净的建筑建造的项目！</p><h1 id="a770" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="5ec2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在读完《干净的建筑》这本书之后，将我的学习付诸实践是一件很棒的事情。</p><p id="e1f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">考虑如何分离不同的层是很有用的，这样核心业务逻辑就不会受到数据库或UI决策之类的干扰。</p><p id="f764" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尝试自己做点东西真的有助于把理论变成现实。我希望你喜欢读它！</p></div></div>    
</body>
</html>