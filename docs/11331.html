<html>
<head>
<title>Integrating Smart Contracts Using Hardhat With NextJS and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Hardhat与NextJS和TypeScript集成智能合约</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/integrating-smart-contracts-using-hardhat-with-nextjs-typescript-7206890b9cd8?source=collection_archive---------6-----------------------#2022-03-09">https://betterprogramming.pub/integrating-smart-contracts-using-hardhat-with-nextjs-typescript-7206890b9cd8?source=collection_archive---------6-----------------------#2022-03-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f99e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将智能合同融入您的前端</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/35446225bd4047a8193961f527080d8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Oze9FoDSDSbD0Taj"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@theshubhamdhage?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Shubham Dhage </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="453a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个系列的第5部分，如果你还没有查看以前的帖子，这里有<a class="ae kv" href="https://wk0.medium.com/create-a-typescript-nextjs-project-with-jest-cypress-adbbcf237747" rel="noopener">第一部分</a>、<a class="ae kv" href="https://wk0.medium.com/adding-tailwind-to-a-nextjs-typescript-project-d1eba5699c4d" rel="noopener">第二部分</a>、<a class="ae kv" href="https://wk0.medium.com/adding-web3-to-our-nextjs-typescript-project-861e9ed5feaf/" rel="noopener">第三部分</a>和<a class="ae kv" href="https://wk0.medium.com/converting-next-into-a-monorepo-with-yarn-workspaces-bf4007fdfa87" rel="noopener">第四部分</a>的链接。</p><p id="14a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，我们已经初始化了一个NextJS应用程序，添加了TailwindCSS，将Web3与Ethers.js集成，并转换为带有yarn工作区的monorepo。</p><p id="d620" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本帖中，我们将添加Hardhat作为额外的yarn工作空间，并开始将一两个智能合同集成到我们的前端。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="6868" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了在我们的dapp中使用智能合约，我们将使用<a class="ae kv" href="https://hardhat.org/" rel="noopener ugc nofollow" target="_blank"> Hardhat </a>，这是一个具有丰富插件生态系统的优秀框架。</p><p id="6042" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个伟大插件的作者，<a class="ae kv" href="https://github.com/wighawag/hardhat-deploy" rel="noopener ugc nofollow" target="_blank"> hardhat-deploy </a>，写了一个伟大的入门模板，我们将利用它。你可以在这里找到模板<a class="ae kv" href="https://github.com/wighawag/template-ethereum-contracts" rel="noopener ugc nofollow" target="_blank">。我们将使用一个我分叉的分支，你可以在这里找到</a><a class="ae kv" href="https://github.com/wk0/template-ethereum-contracts/tree/as-workspace" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="73c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我继续将这个项目设置为工作区，并修改了一些示例代码。我们一会儿会详细讨论这个问题。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="45cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们首先将工作区分支克隆到我们的项目中。当然有一种优雅的方式可以做到这一点，但要保持简单:</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="4397" class="me mf iq ma b gy mg mh l mi mj">git clone --branch as-workspace <a class="ae kv" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:wk0/template-ethereum-contracts.git</span></pre><p id="d043" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后你会看到<code class="fe mk ml mm ma b">template-ethereum-contracts/</code>文件夹。然后让我们做一个快速手动合并。</p><ul class=""><li id="8790" class="mn mo iq ky b kz la lc ld lf mp lj mq ln mr lr ms mt mu mv bi translated">将<code class="fe mk ml mm ma b">contracts-tests.yml</code>移动到<code class="fe mk ml mm ma b">.github/workflows</code>文件夹</li><li id="5f70" class="mn mo iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">将<code class="fe mk ml mm ma b">contracts</code>包移到我们的<code class="fe mk ml mm ma b">packages/</code>文件夹中</li><li id="465f" class="mn mo iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">从<code class="fe mk ml mm ma b">contracts</code>中删除<code class="fe mk ml mm ma b">node_modules</code>和任何锁定文件</li><li id="62b7" class="mn mo iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">将<code class="fe mk ml mm ma b">template-ethereum-contracts/package.json</code>脚本复制到我们的根目录<code class="fe mk ml mm ma b">package.json</code></li><li id="2be5" class="mn mo iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">用<code class="fe mk ml mm ma b">rm -r template-ethereum-contracts</code>移除文件夹(可能需要sudo)</li></ul><p id="a6fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后只需重新运行<code class="fe mk ml mm ma b">yarn</code>来解析新包的依赖关系。</p><p id="8f62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过运行<code class="fe mk ml mm ma b">yarn web</code>，然后运行<code class="fe mk ml mm ma b">yarn contracts</code>，再次检查一切是否正常</p><p id="26ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果遇到任何问题，只需删除每个包的内部<code class="fe mk ml mm ma b">node_modules</code>，然后删除根<code class="fe mk ml mm ma b">node_modules</code>和任何锁文件。您可能还想删除<code class="fe mk ml mm ma b">.next</code>文件夹。</p><p id="9166" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后运行<code class="fe mk ml mm ma b">yarn web:test:ci &amp;&amp; yarn contracts:test:ci</code>以确保两者都通过。如果是这样，那么我们的Github动作测试也应该通过。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="0b80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果事情看起来不错，运行<code class="fe mk ml mm ma b">yarn contracts:test</code>(注意:不是ci)。您应该会从<code class="fe mk ml mm ma b">EnvTest.test.ts</code>中看到一些失败的测试</p><p id="b07c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有一些合同开发流程需要的依赖项。让我们复制示例env并填充它们。</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="6fac" class="me mf iq ma b gy mg mh l mi mj">cp packages/contracts/.env.example packages/contracts/.env</span></pre><p id="d4f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后注册API密钥(别担心，它们都有免费层),用于:</p><ul class=""><li id="ea7d" class="mn mo iq ky b kz la lc ld lf mp lj mq ln mr lr ms mt mu mv bi translated"><a class="ae kv" href="https://coinmarketcap.com/api/" rel="noopener ugc nofollow" target="_blank"> Coinmarketcap </a></li><li id="b390" class="mn mo iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><a class="ae kv" href="https://tenderly.co/" rel="noopener ugc nofollow" target="_blank">温柔地</a></li><li id="9ac4" class="mn mo iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><a class="ae kv" href="https://etherscan.io/apis" rel="noopener ugc nofollow" target="_blank">以太扫描</a></li><li id="0a77" class="mn mo iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">炼金术——在科万星球上用以太坊制造一个用于开发，在主网上制造一个用于生产。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/227cfa894a5b5d8efe6429764b4db7fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7qh4sNgtM33VjNoiqKNfUg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">炼金术注册</p></figure><p id="0c57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于助记符，运行<code class="fe mk ml mm ma b">npx mnemonics</code>(您也可以使用它通过元掩码导入)。</p><p id="ad95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我建议生成一个新的助记符，即使出于安全原因你已经有了一个。你不会想在回购中不小心泄露出去的。<code class="fe mk ml mm ma b">.env</code>还支持不同链/网络的独立助记符。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="f55c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好了，现在我们有了一个相当不错的工作空间设置。让我们开始利用将项目的两个部分结合在一起的一些好处。</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="aaba" class="me mf iq ma b gy mg mh l mi mj">yarn add -W concurrently</span></pre><p id="0a9d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并发将允许我们并发地运行我们的纱线命令——这将非常有用。</p><p id="4666" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们在脚本中使用它来启动完整的dapp:</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="badb" class="me mf iq ma b gy mg mh l mi mj">"scripts": {<br/>    "dev": <!-- -->"concurrently --kill-others-on-fail \"yarn contracts\"  \"yarn web\"",<br/>    ...<br/>},</span></pre><p id="213a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">酷，现在它超级容易快速开发。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="2050" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种设置的一个优点是hardhat网络——我们可以在dapp前端进行切换，以获得一个低风险的实验环境。</p><p id="7089" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当您运行<code class="fe mk ml mm ma b">yarn dev</code>时，您会注意到hardhat已经生成了20个公共&amp;私有密钥对的列表。您可以通过打开元掩码，单击右上角的圆圈，然后导入帐户来访问这些内容。粘贴帐户#0的私钥。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/8200d91975bb218db821f9a3ca1ca792.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*MB7IMY4JHbJq0ULbsi9awg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">元掩码导入</p></figure><p id="769c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您点击帐户上的三个点，一旦选中，您可以在帐户详细信息中对其进行重命名。我称之为Deployer，因为这是我们在<code class="fe mk ml mm ma b">hardhat.config.ts</code>中给account 0起的名字</p><p id="4acb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样对账户#1，即受益人，重复上述步骤。</p><p id="094b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将这两个帐户添加到元掩码后，验证本地网络是否仍在您的终端上运行，然后单击元掩码中的以太坊网络下拉列表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/99d71c4f1f737101400a549cbadbdb2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*wlJGOK_GmPeNhlwuKazgeA.png"/></div></figure><p id="6051" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">单击此项，然后选择添加网络。</p><p id="1abf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样填写网络信息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/ccc408e12c8a9b72417bf83b9e64b8d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*JUQ5Uz_6Im2gxccTAxii-w.png"/></div></figure><p id="8407" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在你可以在元蒙版中选择安全帽。你应该看到你体内有大量的ETH，大约10，000左右。确保您的本地hardhat节点仍在运行，否则您将得到一个错误，并且无法添加网络。</p><p id="14e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">酷，现在让我们在我们的网络应用程序中利用它。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="9fec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们加入合同之前，要支持多个网络并没有太多的工作要做，但是我们至少可以通过添加几个信息行来更好地了解状态。</p><p id="7562" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的<code class="fe mk ml mm ma b">components/</code>文件夹中再创建两个组件，<code class="fe mk ml mm ma b">Web3Balance.tsx</code> &amp; <code class="fe mk ml mm ma b">Web3Network.tsx</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="899d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后更新我们的<code class="fe mk ml mm ma b">index.tsx</code>以利用新组件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="21b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很好——您现在应该能够通过元掩码切换网络了。您应该会看到类似这样的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/34156863fbdc0713f8d5ab6bb6f13011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*QTJA42lXYi3nrWALIPuszQ.gif"/></div></div></figure><p id="9aa9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想要更多关于合同模板的解释，请留下评论，我会写一篇补充文章。接下来，我们将在dapp中实际使用我们的合同。</p><p id="d59d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p><p id="1113" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击这里查看回购:<a class="ae kv" href="https://github.com/wk0/boilerplate-next/tree/with-contracts" rel="noopener ugc nofollow" target="_blank">https://github.com/wk0/boilerplate-next/tree/tailwind</a></p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="6ef5" class="me mf iq ma b gy mg mh l mi mj"><strong class="ma ir">Want to Connect?</strong></span><span id="57cf" class="me mf iq ma b gy ni mh l mi mj">Check out my website: <a class="ae kv" href="https://wk0.dev/" rel="noopener ugc nofollow" target="_blank">https://wk0.dev</a></span></pre></div></div>    
</body>
</html>