# 角材料:建立自己的通用 MatTable

> 原文：<https://betterprogramming.pub/angular-material-build-your-own-generic-mattable-a49ba68a375a>

## 利用装饰者的力量

![](img/62c2bf7fe423980e33204cae7a57945e.png)

Ethan Sexton 在 [Unsplash](https://unsplash.com/s/photos/car-museum?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片

在本指南中，我将简单地向您展示如何创建一个带有角度材质的通用表格。

首先，理解 Typescript 中的装饰器概念以及`MatTable`如何工作是很重要的。

最初，这个概念是我的同事兼朋友弗朗西斯科想出来的，我只是修改了他的想法，让它更容易扩展，有更多的选项。

最后，您将有一个模型来管理如何在表中显示数据，如下所示:

有时我们的应用程序包含几个我们必须管理的表，我们拥有的表越多，维护就越繁重。然而，时间是开发人员生活中的一个重要因素。

我不是创建一个库来维护，而是一步一步地解释如何创建自己的通用表，并用一些例子来扩展它。就像这样，你可以根据自己的需要扩展任何东西。

# 步骤 0:安装必要的 node_modules

**必填**:

*   `@angular/material` (ng 添加@角度/材料)
*   `reflect-metadata` (访问元数据属性)

**可选:**

*   `lodash` (一组便捷功能)
*   `cerializr` (在 JS prop 类中映射 JSON 属性的强大工具)

# 步骤 1:准备您的表组件

让我们从创建汽车模型开始:

为了模拟数据，我选择了 [Mockaroo](https://mockaroo.com/) ，创建了 JSON 文件，将它放在我的 assets 文件夹中，然后在我的 app.component.ts 中，我键入了以下内容:

现在，我们准备创建我们的表组件。使用 CLI 生成组件，然后您的代码应该如下所示:

最后，在`app.component.html`中调用您的表组件:

# 步骤 2:装饰栏

`cerialize` 使用`autoserializeAs`将 JSON 文件的属性自动绑定到 JS 对象实例。你只需要提供类型。参见[文档](https://github.com/weichx/cerialize/tree/mw/v2)。

是一个装饰器，它允许我们选择想要在表格中显示的对象的属性。稍后，我们将看到我们将能够添加允许我们管理属性行为的选项。

在创建我们的装饰器之前，有两个类会很有趣:

*   一个管理我们所有栏目的(`TableModel`)
*   一个管理特定列的所有选项(`ColumnModel`)

现在，我们有了构建室内装饰器的一切。

这里发生了什么？首先，我们创建一个名为`table`的符号(这只是为了调试——你可以随意调用它)。该符号将出现在对象的每个实例中，并允许我们通过引用访问该对象的`TableModel`实例。

我们检查`TableModel`的实例是否存在——否则，我们创建它。

然后，我们用从装饰器获得的选项构建我们的`ColumnModel`实例。

# 步骤 3:检索通用表中的列

正如我们在`AppComponent`中看到的，我创建了我的汽车对象的一个新实例。通过这样做，我触发了装饰器，所以我创建了我的`TableModel`，它包含了要在我的表中显示的所有列的信息。

在我的`TableComponent`中，我可以从数据列表中检索一个实例，并通过符号，得到`TableModel`的实例。剩下的工作就是创建我们的列，然后您将拥有一个基于模型的通用表。

也要注意适应 HTML。`column`现在是对象，不是字符串。`column.key`是可以使用的正确属性，因为它表示我们的装饰器中的`propertyKey`(或者您提供的自定义属性)。

# 更进一步

## 示例 1:管理我们的列的顺序

目前，列是按照模型中定义的属性顺序显示的。在某些情况下，改变这个顺序会很有趣。

现在，我们已经明确声明所有列的顺序都是 0——除了模型，它的顺序是 1。因此，该列应该在最后一个位置。剩下的工作就是创建一个小方法来对我们的`TableComponent`中的列进行排序。

就是这样。

## 示例 2:获取属性的类型

如果您想知道将在表中使用的属性类型，这个示例可能会很有趣。如果我们检测到一个日期，把它转换成一种格式会很有趣。或者，如果它是一个数字，默认情况下将它向右对齐会更好——这由您决定！

确保在您的`tsconfig.json`中启用这两个选项:

`experimentalDecorators`:真

`emitDecoratorMetadata`:真

## 示例 3:选择要排序的列

默认情况下，我们没有为表启用排序。没问题，我们只需要调整一下桌子。

让我们添加这个新选项:

现在我们知道可以对哪一列进行排序。最后，我们改编我们的`TableComponent` (TS *和* HTML):

检查`TableComponent` TS 文件。在`data`的设置器中，我们保持数据的原始顺序。这对我们的新方法`sortData`很有用。

不要忘记修改 HTML。我们可以创建一个简单的`ngIfElse`来为该列添加排序特性。

# 结论

现在，您已经具备了用角形材料创建自己的通用表格所需的一切。只要有创意，您将构建一个强大的表，以便在每个项目中重用。

> “我选择一个懒惰的人去做艰苦的工作。因为一个懒惰的人会找到一个简单的方法去做。”—比尔·盖茨

以下是该项目的 StackBlitz，如果你想玩的话: