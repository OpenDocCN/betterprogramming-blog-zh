<html>
<head>
<title>How to Scrape Tweets With snscrape</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用snscrape抓取推文</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-scrape-tweets-with-snscrape-90124ed006af?source=collection_archive---------0-----------------------#2020-12-03">https://betterprogramming.pub/how-to-scrape-tweets-with-snscrape-90124ed006af?source=collection_archive---------0-----------------------#2020-12-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5de7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Twitter API最近更新后抓取推文的快速指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/aba6651c8fd2032b72d75c32a33fa40d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zMclXvBcpFn5VAolfFMdiA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@mrthetrain?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">约书亚·赫内</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="c369" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">概观</h1><p id="5d71" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Twitter对其API进行了修改，使得各种tweet抓取库变得过时。一个是<a class="ae ky" href="https://github.com/Mottl/GetOldTweets3/issues/98" rel="noopener ugc nofollow" target="_blank"> GetOldTweets3 </a>，我之前写过。幸运的是<a class="ae ky" href="https://github.com/JustAnotherArchivist/snscrape" rel="noopener ugc nofollow" target="_blank"> snscrape </a>已经脱颖而出，作为一个库，它允许人们在没有<a class="ae ky" href="https://www.tweepy.org/" rel="noopener ugc nofollow" target="_blank"> Tweepy </a>限制的情况下抓取推文。</p><p id="f7ad" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">由于未记录的Python包装器和对其开发版本的误解，围绕这个库仍然有许多混乱，正如在各种GitHub问题线程中看到的那样。在本教程中，我展示了一些例子，希望它们能简化本库的使用，减少混乱。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="9853" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">设置snscrape</h1><h2 id="38cd" class="mz lh it bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw nk bi translated">下载snscrape前</h2><p id="ed4a" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Snscrape至少需要<a class="ae ky" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python 3.8或更高</a>。我不会介绍如何升级你的Python，因为网上有很多教程。</p><h2 id="6f34" class="mz lh it bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw nk bi translated">下载snscrape</h2><p id="9fa6" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">当你有了正确的Python版本，你现在可以安装snscrape了。</p><p id="d398" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">一个简单的pip安装就足够了</strong>，所以在您的终端中运行命令</p><p id="b447" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><code class="fe nl nm nn no b">pip install snscrape</code></p><h2 id="7281" class="mz lh it bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw nk bi translated">使用snscrape</h2><p id="0a46" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">下载snscrape后，您将能够以几种不同的方式使用它。最直接的方法是在命令提示符/终端中通过命令行界面(CLI)命令。如果您不习惯使用终端，可以使用Python来执行CLI命令。</p><p id="f75d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">否则，snscrape确实有一个官方的Python包装器。但是，它目前还没有文档，并且缺乏CLI命令的简单性。使用Python包装器的好处是，在抓取之后，您可以轻松地与数据和tweet对象进行交互。</p><p id="f7dc" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">不管你用什么方法，我都在下面介绍。在本教程中，您将通过文本搜索抓取用户的推文和历史推文。</p><p id="58dc" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">最后一点:我见过有人使用Tweepy和snscrape来访问推文中的数据。这是低效的，因为你要刮两次。除非您只能访问Tweepy id或URL，或者您需要粒度，否则您不应该使用Tweepy。snscrape的tweet对象已经有了很多可用的信息。下图显示了您可以使用snscrape访问的数据。图像中的属性应该准确地映射到它们在实际对象中的存储方式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/daaaf879163e3740948db2031ba28311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQSvTSDhAFkoEas3e4G5tw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">snscrape tweet对象中可用的属性(图片来源:作者)</p></figure><p id="e0ba" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">太好了，现在我们已经弄清楚了一切，让我们开始实际使用snscrape吧！</p><p id="16b1" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果你想提前检查我的代码或者有什么要跟着做的话，<a class="ae ky" href="https://github.com/MartinKBeck/TwitterScraper/tree/master/snscrape" rel="noopener ugc nofollow" target="_blank">我的资料可以在GitHub </a>上找到。将有Python脚本和Jupyter笔记本可用于带CLI命令的Python和Python wrapper。终端中没有可用于CLI命令的文件，因为您直接在终端中键入它们。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="1c0c" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">使用命令行界面</h1><p id="501a" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">无论您是直接在终端中运行命令，还是通过Python运行命令，都是一个两步过程，您将数据抓取到一个JSON文件中，然后将数据转换成Python中可用的数据。本节将介绍使用CLI命令进行抓取，然后使用Pandas读取JSON文件。</p><h2 id="acc9" class="mz lh it bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw nk bi translated">使用命令提示符、终端等。</h2><p id="0c5d" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated"><strong class="ma iu">抓取特定Twitter用户的推文:</strong></p><p id="7541" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在下面的例子中，我们从Twitter用户@jack那里收集了100条推文。代码在命令提示符/终端中输入。该代码使用了几个可选参数，如下所述。</p><ul class=""><li id="be3a" class="nq nr it ma b mb mu me mv mh ns ml nt mp nu mt nv nw nx ny bi translated"><code class="fe nl nm nn no b">--jsonl</code>以JSON格式输出数据，允许您访问tweet信息。否则，你只会收到推文的直接链接。</li><li id="2c30" class="nq nr it ma b mb nz me oa mh ob ml oc mp od mt nv nw nx ny bi translated"><code class="fe nl nm nn no b">--progress</code>允许我们从CLI获取更新，让我们了解抓取的进度。它每100条推文更新一次。在使用Python和CLI时似乎不起作用。</li><li id="a723" class="nq nr it ma b mb nz me oa mh ob ml oc mp od mt nv nw nx ny bi translated"><code class="fe nl nm nn no b">--max-results #</code>对抓取的推文数量设置上限。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="e4f7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">从文本搜索查询中抓取历史推文:</strong></p><p id="918e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在下面的例子中，我们收集了2020年6月1日至2020年7月31日之间的500条推文，文本查询为“它是大象”下面的代码有两个新参数。</p><ul class=""><li id="75fc" class="nq nr it ma b mb mu me mv mh ns ml nt mp nu mt nv nw nx ny bi translated"><code class="fe nl nm nn no b">--since</code>设置查询的日期下限</li><li id="4b8e" class="nq nr it ma b mb nz me oa mh ob ml oc mp od mt nv nw nx ny bi translated"><code class="fe nl nm nn no b">“until:”</code>设置查询的日期上限</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="c90a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这里需要注意的是，<code class="fe nl nm nn no b">--since</code>是可以使用的可选参数，但是<code class="fe nl nm nn no b">until:</code>是在<code class="fe nl nm nn no b">twitter-search</code>查询中使用的操作符。是的，这可能看起来很奇怪，但它给我的结果比将两个参数都放在查询中更一致，如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="c6b3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">你可以尝试这两种方法，看看哪一种能给你更好的结果。然而，我使用<code class="fe nl nm nn no b">--since</code>的第一个方法对我来说更一致，也是我现在使用的。查看下面的转换JSON部分，了解如何在抓取后与JSON文件进行交互。</p><h2 id="4227" class="mz lh it bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw nk bi translated">在Python中使用CLI</h2><p id="116a" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如果你不喜欢直接在终端中工作，Python的OS库允许我们用Python执行CLI命令。它本质上只是运行与上面完全相同的命令，但用的是Python。</p><p id="6d62" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我的带有Python <a class="ae ky" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>和Python脚本的CLI命令可在<a class="ae ky" href="https://github.com/MartinKBeck/TwitterScraper/tree/master/snscrape/cli-with-python" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><p id="18d5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">抓取特定twitter用户的推文:</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="90d4" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">从文本搜索查询中抓取历史推文:</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="89c6" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果您发现上面的代码由于“and”错误而无法运行，这可能是由于您的操作系统处理双/单引号的方式。上面的代码可以在我的Windows操作系统上运行。如果你发现上面的代码提供了错误，希望下面一个用户提出的解决方案能帮助你。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="0073" class="mz lh it bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw nk bi translated">将JSON文件转换为可用于Python</h2><p id="be75" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">太好了，我们的数据可以在JSON文件中获得，但是我们如何与它交互呢？下面的代码展示了我们如何使用<a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Pandas </a>库将JSON文件转换成数据帧，这样我们就可以用Python与它进行交互。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="b997" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">真的就这么简单。既然JSON数据被存储为Pandas数据框，那么您可以以任何方式与它进行交互。您可以将其导出为CSV文件或Excel文件，或者修改熊猫数据框中的数据。看你的了！</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="a6c7" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">使用Python包装器</h1><p id="c776" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Python包装器使得在抓取后直接与数据交互变得容易，而不是像上面CLI命令一节中看到的那样经历两步过程。正如他们的GitHub自述文件中提到的，Python包装器目前还没有文档记录。下面的例子来自合作努力和反复试验。</p><p id="8392" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">以下方法遵循由<a class="ae ky" href="https://github.com/HuifangYeo" rel="noopener ugc nofollow" target="_blank"> HuifangYeo </a>在GetOldTweets3问题线程中提出的解决方案。</p><p id="6132" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我的Python包装器Jupyter笔记本和Python脚本可以在<a class="ae ky" href="https://github.com/MartinKBeck/TwitterScraper/tree/master/snscrape/python-wrapper" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><p id="5942" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">抓取特定twitter用户的推文:</strong></p><p id="40b7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在下面的例子中，我们从Twitter用户@jack那里收集了100条推文。然后，我从tweet对象中拉出<code class="fe nl nm nn no b">DateTime</code>、<code class="fe nl nm nn no b">tweet id</code>、<code class="fe nl nm nn no b">text</code>和<code class="fe nl nm nn no b">username</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="acaa" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu">从文本搜索查询中抓取推文:</strong></p><p id="8f4e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在下面的例子中，我们收集了2020年6月1日至2020年7月31日之间的500条推文，文本查询为“它是大象”然后我从tweet对象中拉出<code class="fe nl nm nn no b">DateTime</code>、<code class="fe nl nm nn no b">tweet id</code>、<code class="fe nl nm nn no b">text</code>和<code class="fe nl nm nn no b">username</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="0406" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">参考</h1><p id="e9ab" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">包含本教程抓取文件的GitHub:<a class="ae ky" href="https://github.com/MartinKBeck/TwitterScraper/tree/master/snscrape/" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/martink beck/TwitterScraper/tree/master/sn scrape/</a></p><p id="dba2" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">关于如何使用snscrape的参考文章:<a class="ae ky" href="https://medium.com/@jcldinco/downloading-historical-tweets-using-tweet-ids-via-snscrape-and-tweepy-5f4ecbf19032" rel="noopener">https://medium . com/@ jcldinco/downloading-historical-tweets-using-tweet-ids-via-snscrape-and-tweepy-5 F4 ecbf 19032</a></p><p id="de76" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">snscreag GitHub:<a class="ae ky" href="https://github.com/JustAnotherArchivist/snscrape" rel="noopener ugc nofollow" target="_blank">https://github.com/JustAnotherArchivist/snscrape</a></p></div></div>    
</body>
</html>