<html>
<head>
<title>8 Super-useful SQL Snippets You’ll Want to Have on Hand</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">8个非常有用的SQL代码片段，你会想把它们放在手边</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/8-super-useful-sql-snippets-youll-want-to-have-on-hand-5b01fd7c87de?source=collection_archive---------3-----------------------#2021-12-30">https://betterprogramming.pub/8-super-useful-sql-snippets-youll-want-to-have-on-hand-5b01fd7c87de?source=collection_archive---------3-----------------------#2021-12-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="85c8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">节省您时间的基本SQL语句</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a6e0ce04308537d531165b8203073808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e7GAww1u-sApRKG-AcGGYg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/@lucasdc?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">卢卡斯·DC</a>从<a class="ae ky" href="https://www.pexels.com/photo/light-art-pattern-festival-10325707/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">派克斯</a>拍摄</p></figure><p id="3a63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一年即将结束，在2021年的最后一篇文章中，我留下了八个小技巧，可以在程序员的日常工作中节省你的时间。</p><p id="2887" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有些是基本的，有些可能有点复杂。但我认为它们很方便，所以不浪费更多时间，让我们开始吧。</p><h1 id="e088" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">1.按列名搜索重复的行</h1><p id="0f3e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">通过这个简单的查询，我们可以获得具有在<code class="fe ms mt mu mv b">column_name</code>字段中指定的相同值的行的列表。<br/>另外，我们可以看到它们被重复的次数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="d9f1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2.显示数据库模式的索引</h1><p id="7e78" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">虽然这是可以从数据库客户端看到的，但是我们也可以用SQL语句来实现。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="e480" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3.显示N个最昂贵的查询</h1><p id="4b9d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这句话看起来非常复杂，但实际上并不复杂，它向您展示了哪些句子花费了数据库引擎执行的最多时间。</p><p id="cabb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">知道哪些SQL语句需要检查以确定它们是否可以被优化是很方便的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="c8d0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">4.显示是否使用了索引</h1><p id="06a9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">通常，数据库中的索引数量会随着时间的推移而增加。</p><p id="d1da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你检查过多少次这些索引是否仍然有效？索引会消耗磁盘空间，这在大型表中可能很重要。所以查查哪些在用，看看方便不方便删除，总是很方便的。</p><p id="2860" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，您需要启用对索引的监控:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="9518" class="nc lw it mv b gy nd ne l nf ng">ALTER INDEX INDEX_NAME MONITORING USAGE;</span></pre><p id="0abd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想禁用监控，您只需执行以下语句:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="b885" class="nc lw it mv b gy nd ne l nf ng">ALTER INDEX INDEX_NAME <strong class="mv iu">NO</strong>MONITORING USAGE;</span></pre><p id="dd25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以通过查看<em class="nh"> v$object_usage </em>视图来使用监控数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><ul class=""><li id="4a80" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated"><code class="fe ms mt mu mv b">START_MONITORING</code>字段指示监控开始的时间。</li><li id="a47a" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><code class="fe ms mt mu mv b">MONITORING</code>字段指示指数是否被监控。</li><li id="7fda" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><code class="fe ms mt mu mv b">USED</code>字段用“是”字表示自监控激活后是否使用了索引。</li></ul><p id="795a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在删除任何您认为不使用的索引之前，建议让监视运行一段合理的时间，并考虑可能有使用该索引且不经常执行的批处理进程。</p><h1 id="2142" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">5.使用count (1)而不是count (*)</h1><p id="e81d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">尽可能使用<code class="fe ms mt mu mv b">count(1)</code>而不是<code class="fe ms mt mu mv b">count(*)</code>。<code class="fe ms mt mu mv b">count(*)</code>子句考虑表中的所有列来进行计算，而<code class="fe ms mt mu mv b">count(1)</code>子句只考虑第一列。</p><p id="c718" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，如果使用<code class="fe ms mt mu mv b">count (*)</code>或<code class="fe ms mt mu mv b">count (1)</code>，结果没有变化。</p><p id="3e35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe ms mt mu mv b">count(1)</code>使数据库引擎使用更少的资源，运行更快。对于小表，这种差异并不明显，但是如果使用大表，这种情况会对查询的性能产生明显的影响。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="2ade" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">*注意:这仅在以下情况下有效</p><h1 id="2fb1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">6.条件式</h1><p id="ac6c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可以使用“case when”类(相当于其他编程语言的if-then-else)在查询中编写条件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="f077" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">7.常用表表达式(CTE)</h1><p id="4e51" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这种类型的表达式允许您定义一个临时命名的结果集，该结果集在语句的执行范围内(如<code class="fe ms mt mu mv b">SELECT</code>、<code class="fe ms mt mu mv b">INSERT</code>、<code class="fe ms mt mu mv b">UPDATE</code>、<code class="fe ms mt mu mv b">DELETE</code>或<code class="fe ms mt mu mv b">MERGE</code>)临时存在于内存中。</p><p id="4c8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该子句也可以在<code class="fe ms mt mu mv b">CREATE VIEW</code>语句中作为定义它的SELECT语句的一部分使用。</p><p id="0161" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CTE主要允许您替换子查询和表变量。</p><p id="c5b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在子查询的情况下，CTE不会给你带来任何性能优势，但它会让你有一个更有序和更干净的代码，这有利于代码的可读性。</p><p id="12ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在表变量的情况下，CTE为您提供了更好的查询性能，因此它始终是一个更可取的选项。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="e160" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个小例子可能没有展示CTE的潜力，但是想象一下非常大和复杂的子查询以及代码看起来会是什么样子。</p><h1 id="8292" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">8.一遍又一遍(分区依据)</h1><p id="df5b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><code class="fe ms mt mu mv b">OVER</code>子句允许您在不使用<code class="fe ms mt mu mv b">GROUP BY</code>的情况下获得聚合信息，从而避免了许多复杂情况。例如，您可以检索一组行，并获得它们的聚合数据。</p><p id="0a53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ms mt mu mv b">OVER</code>子句将整个结果集暴露给聚合，但是您可以使用子句<code class="fe ms mt mu mv b">PARTITION BY</code>将结果集分成多个分区。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="35c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本例中，分区是由客户端进行的，单个客户端的每个“窗口”都将与其他“窗口”分开处理</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><h1 id="3d9c" class="lv lw it bd lx ly od ma mb mc oe me mf jz of ka mh kc og kd mj kf oh kg ml mm bi translated">结论</h1><p id="7e0d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们总结了一小组SQL片段，它们通常可以节省我的时间，或者对我的日常工作有所帮助。</p><p id="eb08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中一些可以在SQL server中应用，另一些可以在Oracle中应用，但是您通常可以在任何其他数据库引擎中找到等效的引擎。</p><p id="7ab3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这篇文章，考虑通过我的<a class="ae ky" href="https://kesk.medium.com/membership" rel="noopener">个人资料</a>订阅Medium。谢谢大家！</p></div></div>    
</body>
</html>