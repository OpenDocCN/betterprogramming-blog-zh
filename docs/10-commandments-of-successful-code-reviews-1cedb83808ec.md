# 成功的代码审查的 10 条戒律

> 原文：<https://betterprogramming.pub/10-commandments-of-successful-code-reviews-1cedb83808ec>

## 更高效的代码审查清单

![](img/301eff1310ee20d5e798d81db7d195f3.png)

照片由 [@charlesdeluvio](https://unsplash.com/@charlesdeluvio?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 在 [Unsplash](https://unsplash.com/s/photos/review?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄

代码审查是一个你应该经常做的过程。这些可以在四种不同的环境中完成:

*   作为团队领导/技术领导/scrum 大师，在代码投入生产之前对其进行审查
*   在开放源代码项目的环境中，人们应该检查在拉请求(PR)中打开的代码
*   在教室里。一名教师检查学生的代码作业
*   由一位工程师同事帮助改进审核者和被审核者

在我多年在这些不同的环境中回顾大量代码的过程中，我积累了一些我自己使用的准则。和我的团队一起，我们最近经历了使代码评审(CR)成功和高效的过程。

这里是我们一起整理的一些东西，我想我应该在这里分享一下。

# 代码质量

什么是代码质量？在我看来，它包括三个主要部分:风格、可读性和设计。

风格——整个代码库应该看起来像是由一个人写的，并遵循项目的风格指南。这也是最容易坚持的。

像 linters 和 formatters 这样的工具自动使这一部分变得如此简单，如果它们可以被使用，你应该这样做。例如，预提交挂钩是一个好主意。

比起有人指出他们的错误，人类更倾向于接受自动化过程告诉他们如何修复他们的代码(或者更好——为他们修复代码)。

也就是说，你不应该依赖他们来完成工作，即使他们不存在，你也应该养成遵循风格指南的习惯，因为不是所有的项目都有。(这就好像当你停车的时候，即使你的车里有一个后视摄像头，你仍然在使用你的后视镜。你不知道它什么时候会停止工作，或者你什么时候会开一辆没有它的车。)

可读性——这包括变量、函数、类和方法名、行内注释、文档字符串等。

这么想吧，你之后的下一个程序员应该能够在你写完代码六个月后维护和理解你的代码。糟糕的是你不会真的记得你在做什么。想想下一个人破译你的意图会有多烦人！

(众所周知，我们的观点是，你应该假设下一个试图理解你的代码的程序员是一个精神病杀手，睡眠不足，烦躁不安，试图在半夜修改你的代码。哦，他们知道你住在哪里！)

虽然有些人认为代码应该尽可能不言自明，注释应该很少，但我不同意这种观点，因为写注释会让你的思维过程变得明显。尤其是在没有使用“显而易见的方式”的情况下，那么为什么要选择这种特殊的其他方式呢？理由是什么？很明显你尝试了一些不起作用的东西，所以你必须想出一个变通办法。

如果下一个开发人员理解你的推理，并且在他们需要改变某些东西的时候不会停留在同样的事情上，那么维护起来会更容易。

也就是说,“自文档化代码”的方法仍然有效。变量和函数名应该“声明”它们在做什么或者它们提供什么功能。

设计——这是最难的，因为做同样的事情有不同的方法和途径，但这是展示他们有多专业的地方。只要不断学习，不断完善自己。

坦率地说，这是代码审查中最关键的部分，也是您应该将大部分精力放在上面的部分。

我想借用 Python 的禅(其他语言也有类似的文本)。我在这里根据上下文重新排序了它，但是您可以在 python 终端中`import this`自己看看它是什么样子。

我用“风格”的(S)、“可读性”的(R)和/或“设计”的(D)来标记每一行。

> 漂亮总比难看好。
> 
> 可读性很重要。
> 
> (R)显式比隐式好。
> (R)简单胜于复杂。
> (R)复杂比复杂好。
> (R)扁平比嵌套好。
> 稀疏胜于密集。
> 
> (R /D)错误不应该悄无声息地过去。
> (R/D)除非明确静音。
> (R/D)面对暧昧，拒绝猜测的诱惑。
> 
> (D)特例不足以特殊到违反规则。
> (D)虽然实用性战胜了纯度。
> (D)如果实现很难解释，那就是个坏主意。
> (D)如果实现容易解释，可能是个好主意。
> (D)应该有一种——最好只有一种——显而易见的方法来做这件事。

# 十条代码审查戒律

嗯，这不是明确的戒律，更像是需要注意和经历的事情。

# 0.提交前检查您的代码

首先，要认识到，作为代码的作者，您有责任确保所有的东西都经过了测试，您审查了您所做的更改，并且它们符合您的项目的风格指南、标准和约定。

使用以下要点确保您准备好接受审查。

# 1.功能

*   代码做了它需要做的事情了吗？所有要求都满足了吗？
*   这些变化是否会影响到任何现有的功能？怎么会？是否引入了任何不一致？
*   一切都在 UI 方面工作吗(任何用户界面，从 CSS 到 CLI 或 API 的任何东西)？有什么东西坏了吗？检查所有与你做过的事情有某种关联的场景。更好的是，对你能想到的一切进行彻底的测试。
    自动化测试很棒，你应该尽可能多的使用它们，但是测试有时是为了通过而编写的(这本身就是另一个问题)。用你自己的眼睛看一下。
*   追求“像素完美”和/或“逻辑完美”，所有常见和边缘情况都得到处理。

# 2.可读性

*   理解每段代码做什么容易吗？
*   流程对维护人员来说是否清晰(更好的是，对有“随叫随到”职责的人来说？)
*   代码是否格式化/标记？它遵循惯例吗？
*   骆驼案。烤肉串盒？CapitalizedCase？snake_case？
*   当代码不是自文档化的时候，是否在每一处都添加了注释？
*   如果一种方法被更频繁地使用(或者被我们使用，或者作为惯例)，但是我们选择了另一种方法，是否记录了原因？
*   变量的命名是否恰当？他们描述他们做什么了吗？(名为`var paul, john, george, ringo`的变量虽然有趣，但并不十分有用)
*   代码没有任何混淆吗？

# 3.设计

*   干(不要重复自己)和亲(保持简单愚蠢)的原则有没有遵循？
*   编程本质上是在另一种语言的基础上构建一种语言，其中每个函数都是一个可能在高级语言中使用的动词(雷蒙德·赫廷格的《大声喊出 Python 的[智力游戏》)。你遵循了这个原则吗？](https://www.youtube.com/watch?v=UANN2Eu6ZnM)
*   一个函数应该只做一件事(如果它的名字是`doThisAndThat()`，它可能是两个不同的函数)
*   有没有不明显的副作用？(如果一个方法通过-ref 改变了传递的参数，或者改变了 class 属性的状态，而又不清楚——这可能不是一个好主意，因为除非明确指出，否则很难理解)
*   关注点分离随之而来？
*   组织——所有的组件、类、方法等等都在一个合适且明显的位置。会不会是“我要找的地方”？
*   没有硬编码！使用常量、设置、状态和查找表。
*   你使用设计模式了吗？不要多此一举。很容易发现“策略”、“观察者”或“单例”模式(都只是例子)。所以当它们被使用时，很容易理解做了什么。不要试图创建你自己的版本，因为这可能会令人困惑。
*   标准库的使用？还是那句话，不要多此一举。不要使用自己的排序机制。包含电池的版本可能会成功。
*   是否存在不必要的复杂性？

# 4.可维护性

*   评论，评论，评论。
    有错别字或不清楚的评论吗？
*   我们在记录异常吗？有例外被禁止吗？为什么？
*   是否触发了不必要的通知？
*   是否监控用户行为(如果适用)？
*   代码可测试吗？
*   是否增加/修改了测试？
*   代码可配置吗？
*   提交消息是否清晰，并描述了每条消息中做了什么？
    不好的例子:
    *-修复
    -搞定*

    好的例子:
    *-给 staff 只增加了对象的 admin 视图的权限。*
*   提交是尽可能原子的吗？
*   提交消息/分支名称是否与问题相关联？通常，让分支名称或提交消息具有问题参考号意味着可能更容易理解进行更改的上下文。

# 5.性能和可扩展性

*   有没有针对时间和空间复杂度的优化？
*   代码至少可以扩展两个数量级吗？(如果你预计只有 10 个用户，确保它不会在 500 时中断。如果破 5 万，那可能还行。虽然预见几个数量级可能是不必要的开销，但是您不希望当您再遇到十个用户时就中断)
*   代码是否涵盖了任何失败场景？
*   是否使用了仪器？报告、指标、警报等。
*   对数据库/网络/文件的访问——尽可能少(显然，这不能为零，但是不要在 for 循环中访问数据库。使用批量插入或其他方式)
*   确保你尽可能少依赖机器本身。(机器出现故障，是一次性的。在云计算时代，一台服务器可以随时取代另一台服务器。把你的日志保存在网络服务器上不是一个好主意，因为当你最需要它们的时候，它们会消失并被服务器删除)

# 6.安全性

*   使用和实施的权限？
*   有没有容易被利用的实现错误？
*   新的依赖项—主动维护并筛选已知漏洞？你应该知道的任何安全相关的公开问题？
*   使用认证？
*   授权？
*   输入数据验证？
*   参数和用户提供的数据进行了转义，所以安全使用？
*   处理的 SQL 和代码注入？如果出于某种原因使用原始 SQL 查询或 DML，请确保用户提供的数据不会未经适当处理就原样应用。你不需要成为安全专家。只需使用最佳实践。

# 7.多方面的

*   所有测试都考虑到最终用户了吗？
    例如加载状态、错误、输入验证、数据量、空状态、边缘情况、特性开/关、意外错误处理等。
*   有必要设置任何特征标志吗？
*   我们在整合中破坏了什么吗？我们是否依赖某种部署方式或顺序(例如，数据库迁移)？还是服务可靠性？)
*   我们应该了解哪些部署后需求？它们有记录吗？可以自动化吗？
*   一旦部署完毕，我是否有信心在晚上睡觉？

# 结束语

就像生活中的几乎所有事情一样，熟能生巧。你的评论代码越多，你就能做得越好。

我作为编程教师的背景让我看到了解决相同问题的许多不同的方法，这让我很容易快速地检查代码，找到警告(甚至是 bug ),并跟踪应该做出的问题和更改。

从那以后，我成了一名团队领导和首席技术官(目前在 [Brew](https://www.getbrew.com/) )，这成了我的一个习惯，在一些代码成为我们仓库的一部分之前，不断地审查它们。

当您需要准备代码评审时，我希望这个清单能对您有所帮助，因为您是评审者或被评审者。