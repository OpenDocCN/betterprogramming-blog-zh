<html>
<head>
<title>Create and List Offline-Available Pages in PWAs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在PWAs中创建并列出脱机可用的页面</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-offline-available-pages-in-pwas-5136edea7de1?source=collection_archive---------30-----------------------#2020-01-28">https://betterprogramming.pub/create-offline-available-pages-in-pwas-5136edea7de1?source=collection_archive---------30-----------------------#2020-01-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3b2c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于如何使用服务工作者和缓存API查询缓存和列出离线页面的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4f5b86c11785bc8b59046bb3f21290d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ypp5i3QUOXftOxb-8nEjLw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://undraw.co/illustrations" rel="noopener ugc nofollow" target="_blank">展开的插图</a></p></figure><p id="f21d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我在浏览网页时很少遇到的一个功能，当然你也有。这可能有很多原因，包括应用程序结构、缺乏资源/时间，以及开发人员没有意识到这可以在web上完成。</p><p id="6abe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实现这样的功能需要服务人员和对缓存API的有效使用。由于这些需求，开发者开发这样的线下体验有很大的摩擦。</p><p id="fbc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，也很奇怪的是，这并不像我最初想的那样困难和耗时。</p><p id="4aca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示如何自己实现这一点，然而，由于一些复杂性，您必须相应地修改代码以适应您的项目。</p><p id="7995" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这不是一个复制粘贴教程，也不适合初学web开发的人。但是坚持住。读完这篇文章后，你应该知道你要做什么。</p><p id="1101" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这篇文章，我考虑到:</p><ul class=""><li id="d40a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">你熟悉的<a class="ae ky" href="https://www.w3schools.com/js/js_es6.asp" rel="noopener ugc nofollow" target="_blank"> JavaScript ES6 </a>，<a class="ae ky" href="https://developers.google.com/web/ilt/pwa/introduction-to-service-worker" rel="noopener ugc nofollow" target="_blank">服务人员</a>，<a class="ae ky" href="https://developers.google.com/web/tools/workbox" rel="noopener ugc nofollow" target="_blank">工具箱</a>，<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener ugc nofollow" target="_blank"> Fetch API </a>。</li><li id="f268" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://developers.google.com/web/fundamentals/primers/service-workers/registration" rel="noopener ugc nofollow" target="_blank">服务人员注册</a>假定已经就绪。</li><li id="2f8a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">您正在测试最新版本的Chrome。</li><li id="59e7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">尽管我建议您应该熟悉<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API" rel="noopener ugc nofollow" target="_blank">服务工作者API </a>和<a class="ae ky" href="https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle" rel="noopener ugc nofollow" target="_blank">服务工作者生命周期</a>，但是使用Workbox要方便得多，因为它是一个经过充分测试的库，为您的服务工作者增加了简单性。</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="1b0d" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">脱机可用的页面</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/4c351786c0622a4385c935dde12cf080.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*EuRCL2C6NU-U5B4Oz7pVXw.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/608f60e0db94a85539f1a60438c843b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/1*3OnrgsIZyH2eoZ8oQBfidw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在访问一些链接后，通过离线在<a class="ae ky" href="https://www.pwa.recipes/" rel="noopener ugc nofollow" target="_blank"> pwa.recipes </a>中亲自尝试。也尝试导航到不存在的路线。</p></figure><p id="a80d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我所知道的最先进的PWA功能之一，我仍然相信如果你有一个像样的应用程序结构，你最多可以在30分钟内实现它！</p><p id="a2cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管如此，最困难的部分是精心设计应用程序的结构，以允许你在它的基础上添加这个功能。稍后，将这些点连接起来会简单得多。</p><p id="f678" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在你的应用结构中，最好的是:</p><ol class=""><li id="db99" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nk mb mc md bi translated">每个页面都有自己的ID，与它的路径相匹配。(例如ID = '关于我'，Route = '/关于我'。)</li><li id="b05b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nk mb mc md bi translated">能够从ID和/或路径中提取页面标题(例如，“关于我”变成“关于我”)。</li><li id="bd3a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nk mb mc md bi translated">专门用于存储这些页面及其资源的缓存(例如，缓存名称= 'offline-stored-pages ')。</li></ol><p id="ceae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">酷！让我们开始吧…</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="a417" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak">更简单的例子</strong></h1><p id="39c4" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">假设我们有一个网站，列出了许多产品，每个产品都有一个独特的页面/路线。理想情况下，我们希望显示哪些产品页面已经被访问过，因此可以脱机使用，而隐藏那些没有被访问过的页面。</p><p id="9b44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了添加这个功能，首先我们必须确保我们已经在服务人员的JavaScript文件中注册了一个路由。</p><p id="1b94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们告诉Workbox在我们创建的缓存中缓存所有与产品页面URL匹配的资源。</p><p id="8995" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nq nr ns nt b">service-worker.js</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="3b9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在我们的应用程序的JavaScript文件中，我们将包含一个在缓存<code class="fe nq nr ns nt b">runtime-product-pages-resources</code>中进行检查的函数，这个函数是上面使用Workbox创建的。</p><p id="dd17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数将使用每个产品的URL(锚标记的<code class="fe nq nr ns nt b">href</code>)在该缓存中搜索每个产品路线的任何资源。</p><p id="b3cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nq nr ns nt b">app.js</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="5ef5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:根据你的应用程序结构，逻辑会有所不同。您可能需要检查缓存中是否有明确的HTML文件(以及任何其他依赖项)，以便将其标记为脱机可用，否则不可用。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="0609" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">更复杂的例子</h1><p id="155e" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">这是另一个更健壮但也更复杂的例子。这里，您不需要在Workbox中添加自定义的缓存名称(尽管您仍然需要注册一个路由来缓存任何资源):</p><p id="65a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nq nr ns nt b">app.js</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您的输入应该进入<code class="fe nq nr ns nt b">hideOfflineUnavailableProducts</code>功能</p></figure><p id="ff37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的输入应该在<code class="fe nq nr ns nt b">hideOfflineUnavailableProducts</code>函数中。<br/>我相信你更擅长命名函数！</p><p id="6267" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，监听窗口<code class="fe nq nr ns nt b">offline</code>和<code class="fe nq nr ns nt b">load</code>事件来调用上面声明的<code class="fe nq nr ns nt b">hideOfflineUnavailableProducts</code>函数:</p><p id="7495" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nq nr ns nt b">app.js</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="d2e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，根据以上两个例子(简单和复杂)的用例，我们可以为不可用的产品链接添加一些样式:</p><p id="08af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nq nr ns nt b">styles.css</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="1059" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="30b6" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">就是这样！</p><p id="fe70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，对您来说，这不像是一个简单而快速的实现。请在评论中让我知道。</p><p id="af5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将这一功能添加到您的网站或您负责的网站有多难？花费的时间是否超出预期，为什么？</p><p id="a786" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你已经尝试过了，你的反馈对我的下一篇文章会很有价值。</p><p id="2349" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">干杯！祝你今天开心！玩的开心！</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e4c2" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">进一步阅读</h1><ul class=""><li id="f954" class="lv lw it lb b lc nl lf nm li nw lm nx lq ny lu ma mb mc md bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Cache" rel="noopener ugc nofollow" target="_blank">缓存API文档</a> — MDN文档</li><li id="16bf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://developers.google.com/web/fundamentals/instant-and-offline/web-storage/cache-api" rel="noopener ugc nofollow" target="_blank">使用缓存API </a> —谷歌开发者</li><li id="0ccd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://medium.com/@charistheodoulou/7c00c478d39b?source=friends_link&amp;sk=414f61ce6a9b9d612be1d617217422ad" rel="noopener">使用服务工作者和缓存API的缓存处理</a> —中等</li><li id="3598" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://pwa.js.org/#Mark-offline-unavailable-pages" rel="noopener ugc nofollow" target="_blank"> PWA维基</a></li></ul></div></div>    
</body>
</html>