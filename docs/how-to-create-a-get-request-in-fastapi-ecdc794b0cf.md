# 如何在 FastAPI 中创建 GET 请求

> 原文：<https://betterprogramming.pub/how-to-create-a-get-request-in-fastapi-ecdc794b0cf>

## 构建 API 应该很有趣

![](img/d0b9e4a4a652ebc2dcdb020f86a8edb2.png)

[菠萝供应公司](https://unsplash.com/@pineapple?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄的照片。

如今市场上有如此多的新框架。在 Python 的版图中，我是 [FastAPI](https://fastapi.tiangolo.com/) 的忠实粉丝。如果你还不知道 FastAPI，你可能会想，“它对我有什么好处？”

让我简单回答一下。使用 FastAPI，您可以非常快速地构建一个不错的 API。

本文将向您展示用 GET 请求构建控制器是多么容易。此外，我还将向您展示测试有多容易。我们将涵盖单元和集成测试。

所以请喝一杯，几分钟后，您就可以开始使用 FastAPI 了。

# 创建我们的第一个 Get 请求

您需要做的第一件事是设置您的 Python 环境。对于本文，您需要一些库:FastAPI、uvicorn、pydantic 和 requests。你可以随意用任何你喜欢的工具来安装它们。

*注意:我更喜欢使用虚拟环境来安装 Python 中的库。它们不会弄乱你的系统，并且很容易与 Docker 这样的工具结合。*

在本文中，我们将创建一个 GET 请求来检索图书。在这里，您可以看到我们将要使用的简单数据类型:

```
class Book:
    **isbn**: int
    **title**: str
```

在发出第一个 GET 请求之前，最好提供一些虚拟数据。在实际的应用程序中，我们会提供一个数据库，但现在这不是必需的。这是一个实现细节。相反，您可以先提供一个图书列表:

```
books: list[Book] = [
    Book(isbn=1234, title="What is love?"),
    Book(isbn=4567, title="Baby don't hurt me"),
    Book(isbn=6789, title="Don't hurt me"),
]
```

我们的第一个 GET 请求是根据 ISBN 检索一本书。我们有一个预定的书单。如果清单里有这本书，你可以把它还回去。如果该书不在列表中，我们会产生一条“未找到”的错误消息。

在 FastAPI 中，该功能如下所示:

让我给出一些背景和解释。可以看到一个路径参数或者路径变量，`ISBN`，**，**被传递到方法上。

我还将遍历列表，寻找与 ISBN 匹配的书。如果我们能找到它，我们就归还它。否则，我们给出一个明确的错误信息。FastAPI 的好处在于 JSON 映射是自动发生的。

*注意:你可能认为列表不是快速搜索的最佳数据类型。一个很好的练习是使用 map 作为数据类型来实现这个函数。*

*随着应用程序的增长，您可能还想将上面的代码移动到图书服务中，并从存储库中检索图书。但是这将使事情变得更加复杂，所以我决定在本文中保持简单。*

# 如何编写单元测试

我们从代码示例开始，因为本文主要是关于 FastAPI 的。但是实际上，你应该从单元测试开始。到目前为止，我们已经看到了两条路径:一条快乐路径和一条例外路径。

*注意:我建议你朝着你的解决方案迭代工作，并尝试用测试驱动开发找到上面的解决方案。我将向您展示如何为上面的代码编写测试。*

下面我来描述一下我是怎么考上的。

首先，我没有从上面的列表中返回一本书，而是返回了一本虚拟的书。这很容易测试。

其次，我编写了一个不同的测试来检索第二本书。拥有两本虚拟的书不会有什么成效，所以我从预定义的列表中返回了这些书。

最后，我修改了一个测试，期待一本书不在列表中。这给了我们两个测试。

让我们从第一个测试开始。为了可读性，我选择在函数名中使用`given-when-then`。

这个测试很简单。如果我们在调用这个函数时指定了一个有效的 ISBN，那么我们期望得到正确的图书。

现在让我们进行第二项测试:

*注意:如果您不熟悉 unittest 库，这种编写测试的方式可能需要一段时间来适应。但这并不像你现在想的那么复杂。在你养成了写测试的习惯之后，你就会掌握它的窍门了。*

我们说，如果我们用一个无效的 ISBN 调用函数，我们会得到一个错误消息。最后，您澄清您需要一个带有正确错误信息的“404 未找到”。

*注意:这些单元测试是必要的，以确保如果将来发生变化，现有的功能将得到保证。所以总是试着写单元测试。*

# 如何编写集成测试

单元测试不足以涵盖一切。为了确保一切都很好地协同工作，您应该编写集成测试。

FastAPI 为我们提供了一个使用请求库的 TestClient 。这使得编写集成测试非常方便。在这种类型的测试中，我们可以检查给出的注释是否正确。

你可以用 Postman 或者用`curl`做一个手动测试来对比。用代码做这件事的好处是自动化。

*假设 Dave 明天来到办公室，决定对您的 API 进行重大修改。单元测试和集成测试的结合将防止您已经编写的功能受到影响。*

我喜欢这种测试。它们和 Swagger 提供的文档是记录如何使用 API 的最佳方式。

*注意:虽然您也可以用集成测试来测试异常路径，但这并不是一个好主意。单元测试非常快，并且更适合于确保一切按预期运行。你的计算机会在一瞬间处理成千上万的单元测试。*

如果你写成千上万的集成测试，你的测试套件会变得非常慢。在某种程度上，它会变得难以维护，并且会占用大量资源和时间。

*端到端测试也是如此，甚至比集成测试还要慢。马丁·福勒写了一篇关于这个东西的优秀文章，我们称之为* [*测试金字塔*](https://martinfowler.com/articles/practical-test-pyramid.html) *。去看看。*

# 结论

FastAPI 让创建 API 成为一种有趣的体验。因为代码易于测试，所以它允许您快速构建一个可靠的 API。

在本文中，我们处理了一个 GET 请求。它是每个 API 的基础。如果您熟悉 Flask 或其他 API 构建工具，您将很快熟悉 FastAPI。

感谢您阅读这篇文章。希望你试试 FastAPI。而且，你可以用它来专业地构建一个 API。