<html>
<head>
<title>Deploying Your Dockerized FastAPI Project to Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将您的Dockerized FastAPI项目部署到Heroku</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deploying-your-dockerized-fastapi-project-to-heroku-379e31cb1c5d?source=collection_archive---------13-----------------------#2022-06-07">https://betterprogramming.pub/deploying-your-dockerized-fastapi-project-to-heroku-379e31cb1c5d?source=collection_archive---------13-----------------------#2022-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="393d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">步入云应用开发的下一阶段</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/83aa39e8df2668795accfc9f7a4829ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ybqqoBFDvp2RzLH5HlBrQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">photo by this engineering:<a class="ae kv" href="https://www.pexels.com/photo/female-software-engineer-coding-on-computer-3861972/" rel="noopener ugc nofollow" target="_blank">https://www . pexels . com/photo/female-software-engineer-coding-on-computer-3861972/</a></p></figure><h1 id="b646" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">概观</h1><p id="3cf0" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">时候到了！您已经在本地测试了您的FastAPI项目，并且您已经准备好在云中运行它。当然，您可以使用任何云服务提供商，但是在本指南中，我们将逐步将您的容器化FastAPI项目部署到Heroku。我们开始吧！</p><h2 id="c36b" class="mk kx iq bd ky ml mm dn lc mn mo dp lg lx mp mq li mb mr ms lk mf mt mu lm mv bi translated">先决条件</h2><p id="236c" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在我们开始之前，您首先需要有一个Heroku帐户，安装Heroku CLI并在本地进行授权，并且您的FastAPI项目已经设置了docker文件。如果你还没有将你的项目归档，查看<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/dockerizing-your-fastapi-project-d8bb13ad6335">将你的FastAPI项目归档</a>的帖子，获得一个简单的指导来帮助你开始。</p><div class="mw mx gp gr my mz"><a rel="noopener  ugc nofollow" target="_blank" href="/dockerizing-your-fastapi-project-d8bb13ad6335"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ir gy z fp ne fr fs nf fu fw ip bi translated">将您的FastAPI项目归档</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">5分钟内集装箱化</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">better编程. pub</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn kp mz"/></div></div></a></div><h1 id="ee62" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">步伐</h1><h2 id="ba4b" class="mk kx iq bd ky ml mm dn lc mn mo dp lg lx mp mq li mb mr ms lk mf mt mu lm mv bi translated">创建项目</h2><p id="41d7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在Heroku中，创建一个新应用程序。它可以有任何地区和任何名称。我建议给它起一个描述性的名字，比如{appname}-{dynotype}-{stage}(比如bookapi-web-dev)。</p><h2 id="17eb" class="mk kx iq bd ky ml mm dn lc mn mo dp lg lx mp mq li mb mr ms lk mf mt mu lm mv bi translated">应用程序配置变量</h2><p id="3028" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在部署之前，您可能希望将env变量添加到应用程序配置中，以满足运行应用程序所需的任何需求。在Heroku dashboard中，导航到应用程序的设置页面来添加这些设置。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/6c7931225862b932f86c561d268e0307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-wxPHnqg3cue01vgTEnrrA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者的Heroku应用程序配置示例</p></figure><h2 id="ac1b" class="mk kx iq bd ky ml mm dn lc mn mo dp lg lx mp mq li mb mr ms lk mf mt mu lm mv bi translated">构建和部署</h2><p id="76f9" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这一步将分为两个部分。第一部分将包含不使用M1/M2芯片的Macbooks的更常见的步骤，第二部分将包含使用这些芯片的Macbooks的步骤。</p><p id="ae9f" class="pw-post-body-paragraph lo lp iq lq b lr np jr lt lu nq ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">对于非M1/M2 Macbook用户，您可以登录Heroku容器注册表，然后进行推送和发布。推送将在注册表中设置最新的，而发布则处理要使用的更改。</p><p id="27ad" class="pw-post-body-paragraph lo lp iq lq b lr np jr lt lu nq ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">为此，如果团队在同一个项目中发布了多个dyno类型，他们可以将Dockerfile命名为<code class="fe nu nv nw nx b">Dockerfile.web</code>或<code class="fe nu nv nw nx b">Dockerfile.worker</code>。或者，他们可以使用一个<code class="fe nu nv nw nx b">heroku.yml</code>文件来帮助解决这个问题。</p><p id="2220" class="pw-post-body-paragraph lo lp iq lq b lr np jr lt lu nq ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">在本例中，假设您的Dockerfile名为<code class="fe nu nv nw nx b">Dockerfile.web</code>。这些步骤的命令如下:</p><pre class="kg kh ki kj gt ny nx nz oa aw ob bi"><span id="9aaa" class="mk kx iq nx b gy oc od l oe of">heroku container:login<br/>heroku container:push -a appname<br/>heroku container:release web -a appname</span></pre><p id="ebf8" class="pw-post-body-paragraph lo lp iq lq b lr np jr lt lu nq ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">如果你是M1/M2 Macbook用户，我们将替换的步骤是上传或推送步骤。在这种情况下，我们中的许多人在创业时遇到了问题，以一个<code class="fe nu nv nw nx b">exec format error</code>告终。</p><p id="e18a" class="pw-post-body-paragraph lo lp iq lq b lr np jr lt lu nq ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">解决这个问题的方法是在构建期间指定平台，然后我们将使用Docker CLI使用push命令，而不是使用<code class="fe nu nv nw nx b">heroku container:push</code>命令。此设置的修改命令如下:</p><pre class="kg kh ki kj gt ny nx nz oa aw ob bi"><span id="6ee9" class="mk kx iq nx b gy oc od l oe of">heroku container:login<br/>docker build --platform linux/amd64 -t imagename -f Dockerfile.web .<br/>docker tag imagename registry.heroku.com/appname/web<br/>docker push registry.heroku.com/appname/web<br/>heroku container:release web -a appname</span></pre><h1 id="1402" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">测试</h1><p id="8b1e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在您的更改已经部署，您可以将此应用程序的dyno计数翻转为1，让它开始运行！通过在终端中运行以下命令，检查日志以确认应用程序没有崩溃:</p><pre class="kg kh ki kj gt ny nx nz oa aw ob bi"><span id="483a" class="mk kx iq nx b gy oc od l oe of">heroku logs -t -a appname</span></pre><p id="72b8" class="pw-post-body-paragraph lo lp iq lq b lr np jr lt lu nq ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">要从您的应用程序单独获得标准输出，请运行以下命令:</p><pre class="kg kh ki kj gt ny nx nz oa aw ob bi"><span id="26e1" class="mk kx iq nx b gy oc od l oe of">heroku logs -t -s app -a appname</span></pre><p id="912b" class="pw-post-body-paragraph lo lp iq lq b lr np jr lt lu nq ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">如果您看到一个成功的应用程序启动，并且没有崩溃语句，那么您就成功了！现在你可以开始全面测试你的新应用了。您可以在设置页面下检索应用程序的基本URL。</p><p id="34c7" class="pw-post-body-paragraph lo lp iq lq b lr np jr lt lu nq ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">单击该URL，并为您的网站添加任何其他路线信息。如果您严格地将这种设置用于一个headless API，那么尝试将您的基本URL放在一个REST客户端中，比如Postman。</p></div><div class="ab cl og oh hu oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="ij ik il im in"><p id="6a22" class="pw-post-body-paragraph lo lp iq lq b lr np jr lt lu nq ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">就是这样！这只是将Heroku用于注册和托管应用程序的一个简单例子。正如我在新书《使用FastAPI和AWS构建无服务器Python应用程序》中所讨论的，您可以使用许多相同的应用程序设置和构建步骤来部署到AWS(当然，这将需要一个AWS帐户和AWS CLI)</p><p id="8da3" class="pw-post-body-paragraph lo lp iq lq b lr np jr lt lu nq ju lw lx nr lz ma mb ns md me mf nt mh mi mj ij bi translated">感谢您的阅读，一如既往，祝您黑客生涯愉快！</p><pre class="kg kh ki kj gt ny nx nz oa aw ob bi"><span id="6608" class="mk kx iq nx b gy oc od l oe of"><strong class="nx ir">Want to Connect? </strong></span><span id="8057" class="mk kx iq nx b gy on od l oe of">If you want to learn about using AWS ECR and Fargate with a sample FastAPI project, go to <a class="ae kv" href="https://www.eidanrosado.com/" rel="noopener ugc nofollow" target="_blank">my website</a>.</span></pre></div></div>    
</body>
</html>