<html>
<head>
<title>Constructing D3 Charts in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中构建D3图表</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/construct-d3-charts-in-react-cfecc2848ae2?source=collection_archive---------7-----------------------#2021-02-12">https://betterprogramming.pub/construct-d3-charts-in-react-cfecc2848ae2?source=collection_archive---------7-----------------------#2021-02-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="573b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">实现和定制D3线图和条形图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/269161d86b2b41444a5edfffe4bcdff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*W-UiVhiN8hDGRnP68uOueg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图片来源:作者</p></figure><p id="fac1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在之前的一篇文章中，“<a class="ae lq" href="https://medium.com/better-programming/easier-d3-js-render-c3-charts-with-react-functional-components-372399497f98" rel="noopener">更简单的D3.js —使用React功能组件渲染C3图表</a>”，我们提到C3允许我们快速构建图表，而无需了解D3的所有复杂性。使用C3创建一个图表只是几行代码。</p><p id="32af" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在另一篇文章“用React功能组件呈现D3.js的5个步骤”中，我们提到D3提供了丰富的特性来构建图形表示。以图表为例——D3可以定制轴、形状、工具提示、文本、颜色和动画的每一个细节。</p><p id="446b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我们将深入研究D3的折线图和条形图，以获得D3的复杂性和功能的第一手经验。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="6ae5" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">C3图表</h1><p id="c104" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">在前面的例子中，我们展示了如何用几行代码实现C3折线图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="adb0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它出现在<a class="ae lq" href="https://medium.com/better-programming/10-fun-facts-about-create-react-app-eb7124aa3785" rel="noopener"> Create React App </a>环境中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/874d972f668de19092a356317852156c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*TEHzOi7XyaiV2tF4IgfP4g.png"/></div></figure><p id="feb0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要制作条形图，我们需要做的就是将第13行的类型改为<code class="fe mx my mz na b">bar</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="3397" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后C3折线图变成了C3条形图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/70ba9a32448aaf311084c2e053fb2bb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*qVwHptVTVXnZLhdS2qnzcw.png"/></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="81df" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">D3图表</h1><p id="e063" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">我们已经为<a class="ae lq" href="https://medium.com/better-programming/build-advanced-react-input-fields-using-styled-components-and-storybook-js-a231b9b2438#e765-bf98276875df" rel="noopener">高级react输入字段</a>和<a class="ae lq" href="https://medium.com/better-programming/build-react-tabs-using-recoil-styled-components-and-storybook-js-4ad534cef007" rel="noopener">选项卡</a>创建了<a class="ae lq" href="https://github.com/JenniferFuBook/react-components" rel="noopener ugc nofollow" target="_blank"> react组件库</a>。D3图表将被添加到此存储库中。</p><pre class="kj kk kl km gt nb na nc nd aw ne bi"><span id="9671" class="nf lz it na b gy ng nh l ni nj">git clone https://github.com/JenniferFuBook/react-components.git</span></pre><p id="19ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将<code class="fe mx my mz na b">d3</code>包安装到您的<a class="ae lq" href="https://medium.com/better-programming/package-jsons-dependencies-in-depth-a1f0637a3129" rel="noopener">依赖项</a>中，同时安装现有的<code class="fe mx my mz na b">recoil</code>包:</p><pre class="kj kk kl km gt nb na nc nd aw ne bi"><span id="552d" class="nf lz it na b gy ng nh l ni nj">"dependencies": {<br/>    "<a class="ae lq" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/jest-dom": "^5.11.6",<br/>    "<a class="ae lq" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/react": "^11.1.2",<br/>    "<a class="ae lq" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/user-event": "^12.2.2",<br/>    "d3": "^6.3.1",<br/>    "react": "^17.0.1",<br/>    "react-dom": "^17.0.1",<br/>    "react-scripts": "^4.0.1",<br/>    "recoil": "^0.1.2",<br/>    "styled-components": "^5.2.1",<br/>    "web-vitals": "^0.2.4"<br/>  }</span></pre><p id="94cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe mx my mz na b">src/components</code>中，<code class="fe mx my mz na b">Charts</code>文件夹被创建来保存与图表相关的文件。</p><p id="caaf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">图表有三种类型的设置:</p><ul class=""><li id="507c" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated"><a class="ae lq" href="https://medium.com/better-programming/create-react-app-and-svgs-70970ac715f2" rel="noopener"> SVG(可缩放矢量图形)</a>宽度、高度和边距的布局</li><li id="2f50" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">图表数据系列和类型</li><li id="b7c3" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">有关数据系列名称、x轴设置和y轴设置的图表派生信息</li></ul><p id="964d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://medium.com/better-programming/recoil-a-new-state-management-library-moving-beyond-redux-and-the-context-api-63794c11b3a5" rel="noopener">反冲</a>用于SVG布局状态管理。其他信息存储为props并传递给子组件。</p><p id="568d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们定义D3图表界面类似于C3图表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="63b8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第2行指定<code class="fe mx my mz na b">width</code>。</p><p id="7dc3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第3行指定<code class="fe mx my mz na b">height</code>。</p><p id="0a79" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">data.columns</code>是数据系列值，只是每个数组的第一项是系列名称(第6行和第7行)。</p><p id="9d95" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第9行指定了图表类型。</p><p id="8d4a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用第6行和第7行定义的两个数据系列，一部分一部分地实现图表。</p><pre class="kj kk kl km gt nb na nc nd aw ne bi"><span id="2e13" class="nf lz it na b gy ng nh l ni nj">1. <a class="ae lq" href="#590f" rel="noopener ugc nofollow">Chart State Management</a><br/>2. <a class="ae lq" href="#6faa" rel="noopener ugc nofollow">X-axis</a><br/>3. <a class="ae lq" href="#bff5" rel="noopener ugc nofollow">Y-axis</a><br/>4. <a class="ae lq" href="#7c2f" rel="noopener ugc nofollow">Line Chart</a><br/>5. <a class="ae lq" href="#74e3" rel="noopener ugc nofollow">Legend</a><br/>6. <a class="ae lq" href="#c0b2" rel="noopener ugc nofollow">Bar Chart</a><br/>7. <a class="ae lq" href="#753e" rel="noopener ugc nofollow">Animation</a><br/>8. <a class="ae lq" href="#fb5e" rel="noopener ugc nofollow">General Chart</a><br/>9. <a class="ae lq" href="#7cf5" rel="noopener ugc nofollow">Storybook</a></span></pre></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="590f" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">图表状态管理</h1><p id="694d" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">反冲利用原子来保持状态。SVG布局的原子在<code class="fe mx my mz na b">src/components/Charts/chartStates.js</code>中创建。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="b4d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第6-11行定义了一个margin对象。</p><p id="ae3a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第16-19行定义了<code class="fe mx my mz na b">widthAtom</code>，其默认值为<code class="fe mx my mz na b">margin.left</code>和<code class="fe mx my mz na b">margin.right</code>之和。</p><p id="a7d0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第24-27行定义了<code class="fe mx my mz na b">heightAtom</code>，其默认值为<code class="fe mx my mz na b">margin.top</code>和<code class="fe mx my mz na b">margin.bottom</code>之和。</p><p id="eeb3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第32-35行定义了<code class="fe mx my mz na b">marginAtom</code>，它的默认值被设置为默认的<code class="fe mx my mz na b">margin</code>对象。</p><p id="d91b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些原子可用于图表的所有代码。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="6faa" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">x轴</h1><p id="9ace" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">x轴是坐标系统的主轴或水平轴。对于所有其他坐标，沿x轴的点的值为零。在D3中，可以通过函数<code class="fe mx my mz na b">scaleLinear</code>方便地定义x轴。</p><p id="1c7f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">scaleLinear</code>构造连续缩放的函数，<code class="fe mx my mz na b">domain</code>默认为<code class="fe mx my mz na b">[0, 1]</code>，<code class="fe mx my mz na b">range</code>默认为<code class="fe mx my mz na b">[0, 1]</code>。很可能我们需要指定<code class="fe mx my mz na b">domain</code>和<code class="fe mx my mz na b">range</code>。</p><p id="5783" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">scaleLinear</code>通常与<code class="fe mx my mz na b">domain</code>连锁，设定秤的边界。对于<code class="fe mx my mz na b">[30, 200, 100, 400, 150, 250]</code>的数据序列，<code class="fe mx my mz na b">30</code>表示x值为0，<code class="fe mx my mz na b">200</code>表示x值为1，以此类推。因此，我们将<code class="fe mx my mz na b">domain</code>设为<code class="fe mx my mz na b">[0, 5]</code>。</p><p id="a6aa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">scaleLinear.domain</code>通常与<code class="fe mx my mz na b">range</code>链接，设置标尺的映射边界。比如SVG宽度是<code class="fe mx my mz na b">120px</code>，左右边距是<code class="fe mx my mz na b">10px</code>。图表的x位置将在<code class="fe mx my mz na b">[10, 110]</code>的范围内。</p><p id="4af2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们定义<code class="fe mx my mz na b">x = scaleLinear().domain([0, 5]).range([10, 110])</code>，下面的代码片段显示了函数<code class="fe mx my mz na b">x</code>是如何工作的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="3f6c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">范围值可以是非数字。以下是范围在<code class="fe mx my mz na b">red</code>和<code class="fe mx my mz na b">blue</code>之间的颜色示例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="d4ad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">domain</code>和<code class="fe mx my mz na b">range</code>可以有两个以上的值来定义特定的刻度。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="4270" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是<code class="fe mx my mz na b">src/components/Charts/XAxis.js</code>中定义的<code class="fe mx my mz na b">XAxis</code>组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="a0be" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">线7从反冲<code class="fe mx my mz na b">widthAtom</code>中得到<code class="fe mx my mz na b">width</code>。</p><p id="2af1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">线8从反冲的<code class="fe mx my mz na b">heightAtom</code>中得到<code class="fe mx my mz na b">height</code>。</p><p id="420f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">9号线从反冲<code class="fe mx my mz na b">marginAtom</code>得到<code class="fe mx my mz na b">left</code>、<code class="fe mx my mz na b">right</code>、<code class="fe mx my mz na b">bottom</code>。</p><p id="5171" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第10行创建一个<code class="fe mx my mz na b"><a class="ae lq" href="https://medium.com/better-programming/most-things-you-want-to-know-about-react-refs-29901ebf28c6" rel="noopener">ref</a></code>来引用第22行的<a class="ae lq" href="https://medium.com/better-programming/to-be-or-not-to-be-2c372198a01c#ba5c-4b7662162c8e-reply" rel="noopener">非受控组件</a>。</p><p id="ce66" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第12-20行使用<code class="fe mx my mz na b">useLayoutEffect</code>调用变异DOM的D3代码。</p><p id="b7cb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第13-15行为x轴创建了一个线性刻度。</p><p id="b54b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第16行使用<code class="fe mx my mz na b">axisBottom</code>，创建一个底部水平轴。可以创建多个底部水平轴，也有可能这些轴在顶部，使用<code class="fe mx my mz na b">axisTop</code>。</p><p id="07d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第17行将<code class="fe mx my mz na b">ticks</code>数字设置为数据系列计数，并将<code class="fe mx my mz na b">tickSizeOuter</code>设置为0。事实上，可以对显示刻度的位置、刻度标签格式和轴的结束位置进行大量定制。</p><p id="2248" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第19行实例化了不受控制的组件的x轴。</p><p id="8f7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第22行为x轴定义了一个SVG组。它将x轴定位在SVG的底部，不包括边距底部。</p><p id="710e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">XAxis.js</code>显示下面的x轴:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/0f73b04c994ac8ed95b6e55284842aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*WfTyeEQAzrGz_VgzXsauVA.png"/></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="bff5" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">y轴</h1><p id="168e" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">y轴是坐标系的第二轴或垂直轴。沿着它的点对于所有其他坐标的值为零。</p><p id="e2c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是<code class="fe mx my mz na b">src/components/Charts/YAxis.js</code>中定义的<code class="fe mx my mz na b">YAxis</code>组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="3390" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码与<code class="fe mx my mz na b">src/components/Charts/XAxis.js</code>非常相似。这两个区别是:</p><ul class=""><li id="d6df" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated"><code class="fe mx my mz na b">range</code>在第14行计算不同。</li><li id="1a32" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><code class="fe mx my mz na b">transform</code>在第21行使用不同的维度。</li></ul><p id="5340" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建了x轴和y轴后，我们看到以下坐标:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/03fedeb005b7aefc706043f048c08ab9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*hJutGBW338Z56XEg3HYHfw.png"/></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="7c2f" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">折线图</h1><p id="9606" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">折线图显示了y值相对于x值的变化情况。它们非常适合显示变化的时间序列以及一段时间内的趋势和发展。</p><p id="46f5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们已经使用<code class="fe mx my mz na b">scaleLinear</code>为x轴和y轴绘制了直线。线系列是连接每个点的路径。功能<code class="fe mx my mz na b">line</code>用于连接这些点。<code class="fe mx my mz na b">line</code>通常与<code class="fe mx my mz na b">scaleLinear</code>函数产生的<code class="fe mx my mz na b">x</code>和<code class="fe mx my mz na b">y</code>函数链接。</p><pre class="kj kk kl km gt nb na nc nd aw ne bi"><span id="5cdc" class="nf lz it na b gy ng nh l ni nj">const lineFn = line()<br/>      .x((_, i) =&gt; x(i))<br/>      .y((d) =&gt; y(d));</span></pre><p id="7bd4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于每个数据序列<code class="fe mx my mz na b">i</code>，一个路径被附加到SVG组。路径采用<code class="fe mx my mz na b">data.columns[i]</code>值，不包括系列名称。它配置一个非填充路径，具有特定的笔划设置，然后调用<code class="fe mx my mz na b">lineFn</code>函数来连接这些点。</p><pre class="kj kk kl km gt nb na nc nd aw ne bi"><span id="2bfe" class="nf lz it na b gy ng nh l ni nj">select(containerRef.current)<br/>  .append('path')<br/>  .datum(values)<br/>  .attr('fill', 'none')<br/>  .attr('stroke', () =&gt; 'blue')<br/>  .attr('stroke-width', 1.5)<br/>  .attr('stroke-linejoin', 'round')<br/>  .attr('stroke-linecap', 'round')<br/>  .attr('d', lineFn);</span></pre><p id="66fe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的代码中，<code class="fe mx my mz na b">blue</code>被用作线条颜色。但是对于不止一条路径，我们需要用不同的颜色来区分路径。<code class="fe mx my mz na b">scaleOrdinal</code>可用于设置颜色。<code class="fe mx my mz na b">scaleOrdinal</code>构造一个用于序数标度的函数，它以特定的顺序排列值，而不仅仅是命名它们。</p><p id="2b09" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">schemeSet1</code>是用RGB十六进制字符串表示的九种分类颜色的数组。如果我们定义<code class="fe mx my mz na b">color = scaleOrdinal().range(schemeSet1)</code>，下面的代码片段显示了函数<code class="fe mx my mz na b">color</code>是如何工作的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="a430" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第2-10行输出九种分类颜色。</p><p id="3718" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之后，这九种颜色被重复使用。<code class="fe mx my mz na b">color(0)</code>与<code class="fe mx my mz na b">color(9)</code>相同，<code class="fe mx my mz na b">color(1)</code>与<code class="fe mx my mz na b">color(10)</code>相同，以此类推。</p><p id="a3ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的<code class="fe mx my mz na b">scaleOrdinal</code>直接链到<code class="fe mx my mz na b">range</code>上。<code class="fe mx my mz na b">domain</code>，这是一个颜色名称数组。它也可以被拴在中间。以下示例将前两个颜色名称定义为<code class="fe mx my mz na b">data1</code>和<code class="fe mx my mz na b">data2</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="8447" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第2-10行输出九种分类颜色。</p><p id="0991" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之后，同样的颜色再次被使用。<code class="fe mx my mz na b">color('data1')</code>与<code class="fe mx my mz na b">color(7)</code>相同，<code class="fe mx my mz na b">color('data2')</code>与<code class="fe mx my mz na b">color(8)</code>相同，以此类推。</p><p id="49ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将<code class="fe mx my mz na b">color</code>定义为<code class="fe mx my mz na b">src/components/Charts/constants.js</code>中的常用函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="c6b2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第3行，我们删除了<code class="fe mx my mz na b">schemeSet1</code>中的前两种颜色。所以在我们的图表中，一共有七种分类颜色。这只是因为我们更喜欢两个数据系列的第三和第四种颜色。</p><p id="5398" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是<code class="fe mx my mz na b">src/components/Charts/LineChart.js</code>中定义的<code class="fe mx my mz na b">LineChart</code>组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="1865" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">线8从反冲<code class="fe mx my mz na b">widthAtom</code>中得到<code class="fe mx my mz na b">width</code>。</p><p id="062f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">9号线从反冲<code class="fe mx my mz na b">heightAtom</code>中得到<code class="fe mx my mz na b">height</code>。</p><p id="be93" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">10线从反冲<code class="fe mx my mz na b">marginAtom</code>得到<code class="fe mx my mz na b">left</code>、<code class="fe mx my mz na b">right</code>、<code class="fe mx my mz na b">top</code>、<code class="fe mx my mz na b">bottom</code>。</p><p id="b44e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第11行创建一个<code class="fe mx my mz na b">ref</code>来引用第40行的非受控组件。</p><p id="afbf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第13-38行使用<code class="fe mx my mz na b">useLayoutEffect</code>调用变异DOM的D3代码。</p><p id="e678" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第14行删除了第29行可能添加的路径。</p><p id="6c14" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第16-18行创建了x方向的线性刻度。</p><p id="f032" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第19-21行创建了y方向的线性刻度。</p><p id="01d2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第23-25行创建了一个线函数来连接每个数据系列的点。</p><p id="f3c8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第27-37行定制并绘制每个数据系列。</p><p id="17ef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">LineChart</code>组件呈现如下图像:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/fbd8dbd267722d35da5288a23457dae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*e-VW08nfwwU20hzeu9T6IA.png"/></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="74e3" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">神话；传奇</h1><p id="d384" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">我们画了一个线图。但是，如果没有图例，就无法判断哪条线与哪一个数据系列对齐。</p><p id="83de" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">C3图例显示彩色正方形和数据系列名称。我们将其简化以显示彩色数据系列名称。根据数据系列的编号，<code class="fe mx my mz na b">scaleLinear</code>用于定位系列名称，用<code class="fe mx my mz na b">text</code>标签显示。</p><p id="e8d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是<code class="fe mx my mz na b">src/components/Charts/Legend.js</code>中定义的<code class="fe mx my mz na b">Legend</code>组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="9acb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">线8从反冲的<code class="fe mx my mz na b">widthAtom</code>得到<code class="fe mx my mz na b">width</code>。</p><p id="0d9d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">9号线从反冲的<code class="fe mx my mz na b">heightAtom</code>得到<code class="fe mx my mz na b">height</code>。</p><p id="200b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">10号线从反冲的<code class="fe mx my mz na b">marginAtom</code>得到<code class="fe mx my mz na b">left</code>和<code class="fe mx my mz na b">right</code>。</p><p id="1ee1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第11行创建了一个<code class="fe mx my mz na b">ref</code>来引用第27行的非受控组件。</p><p id="fc9c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第13-25行使用<code class="fe mx my mz na b">useLayoutEffect</code>调用变异DOM的D3代码。</p><p id="4c09" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第14-16行创建了x方向的线性刻度。</p><p id="b22a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第18-24行是D3代码。<code class="fe mx my mz na b">keys</code>是系列名称的数组。该代码创建文本元素，并针对x位置(第22行)、颜色(第23行)和文本(第24行)对它们进行定制。</p><p id="18f3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第27行定义了图例组，它位于x轴下方的<code class="fe mx my mz na b">20px</code>。</p><p id="5f79" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是带图例的折线图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/5eca2bfec785c5557cfd8309af186ce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*VUxc74UpM4RKudc2VDFj8g.png"/></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="c0b2" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">条形图</h1><p id="24b1" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">条形图用于使用矩形条比较分类数据，矩形条的高度或长度与数值成比例。</p><p id="4526" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">条形图使用<code class="fe mx my mz na b">scaleLinear</code>计算y值，而其x值由<code class="fe mx my mz na b">scaleBand</code>计算，后者为序数或分类维度构造一个函数，其中<code class="fe mx my mz na b">domain</code>默认为<code class="fe mx my mz na b">[]</code>而<code class="fe mx my mz na b">range</code>默认为<code class="fe mx my mz na b">[0, 1]</code>。<code class="fe mx my mz na b">scaleBand</code>通常先与<code class="fe mx my mz na b">domain</code>连锁，再与<code class="fe mx my mz na b">range</code>连锁。</p><p id="fe1f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">scaleBand</code>不会产生连续的规模。相反，它的规模是离散的。它还具有生成带宽的功能。</p><p id="d1b2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们定义<code class="fe mx my mz na b">x = scaleBand().domain([0, 5]).range([10, 110])</code>，下面的代码片段显示了函数<code class="fe mx my mz na b">x</code>是如何工作的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="20b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的代码中，只有域数组<code class="fe mx my mz na b">[0, 5]</code>中的值返回值(第2行和第7行)。由于域数组中有两个值，范围<code class="fe mx my mz na b">[10, 110]</code>被分成两个带。每个带的宽度是<code class="fe mx my mz na b">50</code>(第9行)。考虑到起始范围是<code class="fe mx my mz na b">10</code>，第一个值变成<code class="fe mx my mz na b">10 </code>(第2行)，第二个值变成<code class="fe mx my mz na b">60</code>(第7行)。</p><p id="14d6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">range(stop)</code>是生成从0到<code class="fe mx my mz na b">stop — 1</code>的数字序列的函数。</p><p id="4d59" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们用<code class="fe mx my mz na b">range(6)</code>生成范围内的值，也就是<code class="fe mx my mz na b">[0, 1, 2, 3, 4, 5]</code>。通过用<code class="fe mx my mz na b">range</code>函数的返回值创建<code class="fe mx my mz na b">domain</code>，我们得到了<code class="fe mx my mz na b">domain</code>中每一项的x值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="e823" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是<code class="fe mx my mz na b">src/components/Charts/BarChart.js</code>中定义的<code class="fe mx my mz na b">BarChart</code>组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="ee9b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以上代码与<code class="fe mx my mz na b">src/components/Charts/LineChart.js</code>非常相似，除了以下不同之处:</p><ul class=""><li id="199b" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">第16-18行使用<code class="fe mx my mz na b">scaleBand</code>。</li><li id="d8d0" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated"><code class="fe mx my mz na b">barWidth</code>来源于带宽(第22行)。</li><li id="de2c" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">第24-35行定制并绘制每个数据系列。每个<code class="fe mx my mz na b">rect</code>(矩形)元素定位在x(第31行)和y(第32行)，具有适当的填充颜色(第30行)、宽度(第33行)和高度(第34行)。在SVG中，<code class="fe mx my mz na b">y(0)</code>大于<code class="fe mx my mz na b">y(d)</code>。</li></ul><p id="17b9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是一个带图例的条形图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/a08f718179378506f0fe2adef13c313d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*OG2itn03x0Ffs8e71ExXCA.png"/></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="753e" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">动画</h1><p id="0f1a" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">我们已经编写了相当多的代码来构建折线图和条形图。与C3图表相比，D3轴和图例是原始的，数据系列图最终错过了工具提示、选择、响应性等等。</p><p id="c2d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">值得花力气去构建D3图表吗？</p><p id="8ae7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">是的，确实如此。D3提供了丰富的特性来构建图形表示。它为许多高级功能打开了大门。有了上面的基础工作，只需要几行代码就可以添加动画了。</p><p id="3f9a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">transition</code>是一个类似选择的界面，用于动画显示DOM的变化。<code class="fe mx my mz na b">transition</code>不是即时应用更改，而是在给定的持续时间内将DOM的更改从其当前状态插入到所需的目标状态。</p><p id="158e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下代码将背景色转换为<code class="fe mx my mz na b">red</code>。</p><pre class="kj kk kl km gt nb na nc nd aw ne bi"><span id="414e" class="nf lz it na b gy ng nh l ni nj">select(element)<br/>  .transition()<br/>  .style(‘background-color’, ‘red’)</span></pre><p id="0510" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">transition</code>通常先与<code class="fe mx my mz na b">duration</code>连锁，再与<code class="fe mx my mz na b">ease</code>连锁。<code class="fe mx my mz na b">duration</code>以毫秒为单位将过渡持续时间设置为指定值。<code class="fe mx my mz na b">ease</code>指定过渡缓动功能，如<code class="fe mx my mz na b">easeLinear</code>，线性缓动。</p><pre class="kj kk kl km gt nb na nc nd aw ne bi"><span id="4d5c" class="nf lz it na b gy ng nh l ni nj">select(<!-- -->element<!-- -->)<br/>  .transition()<br/>  .duration(1000)<br/>  .ease(easeLinear)<br/>  .style('background-color', 'red');</span></pre><p id="914a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，转换可以延迟几毫秒。</p><pre class="kj kk kl km gt nb na nc nd aw ne bi"><span id="9006" class="nf lz it na b gy ng nh l ni nj">select(<!-- -->element<!-- -->)<br/>  .transition()<br/>  .duration(1000)<br/>  .ease(easeLinear)<br/>  .delay(2000)<br/>  .style('background-color', 'red');</span></pre><p id="ffb5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mx my mz na b">attrTween</code>为属性分配一个函数，该函数针对每个选定的元素进行评估。<code class="fe mx my mz na b">stroke-dasharray</code>属性控制用于形成路径笔画形状的虚线和间隙的模式。通过插入<code class="fe mx my mz na b">stroke-dasharray</code>属性，我们可以从长度0开始动画一个笔画，一直到全长。</p><pre class="kj kk kl km gt nb na nc nd aw ne bi"><span id="0a3e" class="nf lz it na b gy ng nh l ni nj">const reveal = (path) =&gt;<br/>  path<br/>    .transition()<br/>    .duration(5000)<br/>    .ease(easeLinear)<br/>    .attrTween('stroke-dasharray', function () {<br/>      const length = this.getTotalLength();<br/>      return interpolate(`0, ${length}`, `${length}, ${length}`);             <br/>  });</span></pre><p id="0259" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是<code class="fe mx my mz na b">src/components/Charts/LineChart.js</code>带动画代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="f88b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上述代码中有两处更改:</p><ul class=""><li id="62d3" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">第27-36行定义了动画功能，<code class="fe mx my mz na b">reveal</code>。</li><li id="6b42" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">48线呼叫<code class="fe mx my mz na b">reveal</code>。</li></ul><p id="98f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此视频剪辑显示了折线图的动画效果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny mw l"/></div></figure><p id="0444" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们设计的条形图动画有点不同。所有条形的高度从0开始，一直增长到全高。</p><p id="a771" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是<code class="fe mx my mz na b">src/components/Charts/BarChart.js</code>的动画代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="2979" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上述代码中有两处更改:</p><ul class=""><li id="030a" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">原始的<code class="fe mx my mz na b">rect</code>尺寸已被修改。第32行将y值设置为<code class="fe mx my mz na b">y(0)</code>而不是<code class="fe mx my mz na b">y(d)</code>。第34行将高度设置为<code class="fe mx my mz na b">0</code>，而不是<code class="fe mx my mz na b">y(0) — y(d)</code>。</li><li id="e8d4" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">第37-45行执行动画。<code class="fe mx my mz na b">rect</code>的目标y值为<code class="fe mx my mz na b">y(d)</code>(第42行)，目标高度为<code class="fe mx my mz na b">y(0) — y(d)</code>(第43行)。过渡的持续时间是<code class="fe mx my mz na b">1000ms</code>(第41行)，并且对于每个小节(第44行)它被额外的<code class="fe mx my mz na b">1000ms</code>延迟。</li></ul><p id="4744" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此视频剪辑展示了条形图的动画效果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny mw l"/></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="fb5e" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">总图</h1><p id="26cf" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">现在我们有了<code class="fe mx my mz na b">LineChart</code>和<code class="fe mx my mz na b">BarChart</code>组件，我们需要创建一个通用的<code class="fe mx my mz na b">Chart</code>组件来保存它们。该组件以<code class="fe mx my mz na b">width</code>、<code class="fe mx my mz na b">height</code>、<code class="fe mx my mz na b">margin</code>、<code class="fe mx my mz na b">data</code>为道具。根据图表类型，它会显示折线图或条形图，以及适当的x轴、y轴和图例。</p><p id="2bc8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是<code class="fe mx my mz na b">src/components/Charts/Chart.js</code>中定义的<code class="fe mx my mz na b">Chart</code>组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="a3ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第3-8行导入所有相关的代码。</p><p id="6559" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第15-21行将SVG布局设置为反冲状态。<code class="fe mx my mz na b">width</code>和<code class="fe mx my mz na b">height</code>为必填项，<code class="fe mx my mz na b">margin</code>为可选项。</p><p id="2919" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它计算最长的数据列<code class="fe mx my mz na b">longestColumn</code>(第25行)，为数据系列的名称构建<code class="fe mx my mz na b">keys</code>(第26行)，并保存最大的y值(第27行)。我们假设最小的y值是<code class="fe mx my mz na b">0</code>。</p><p id="9ea2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">条形图的刻度计数是<code class="fe mx my mz na b">longestColumn — 1</code>，而折线图的刻度计数是<code class="fe mx my mz na b">longestColumn — 2</code>(第30-33行)。</p><p id="ebff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第34行组成<code class="fe mx my mz na b">xDomain</code>，第35行组成<code class="fe mx my mz na b">yDomain</code>。</p><p id="c0c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第38-48行将整个图表组装成一个SVG元素。<code class="fe mx my mz na b">viewBox</code>是一个定义SVG维度的属性。有单独的属性<code class="fe mx my mz na b">width</code>和<code class="fe mx my mz na b">height</code>使图表维度固定。如果移除它们，图表将自动缩放。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="7cf5" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">故事书</h1><p id="6ad5" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">我们用<a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/an-in-depth-look-at-storybook-6-8c44cd6895ee">故事书</a>来展示折线图和条形图。这两个故事写在<code class="fe mx my mz na b">src/components/Charts/Charts.stories.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="0740" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第6-9行为<code class="fe mx my mz na b">Charts</code>设置了故事，并将它们放入<code class="fe mx my mz na b">RecoilRoot</code>中。</p><p id="c056" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第13-17行组成了折线图。</p><p id="7fbc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第29-42行组成了条形图。</p><p id="aa34" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">图表从索引文件的第4行导入。该文件为<code class="fe mx my mz na b">src/components/Charts/index.js</code>，为外部使用而创建:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="be28" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是故事书上的线图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi nz"><img src="../Images/5526b82ead9e4e54c1e7707ff80b5a71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ptT5JwYM3k_Xfjatf2t9w.png"/></div></div></figure><p id="7a5d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是故事书上的条形图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi nz"><img src="../Images/6e05cddd46ce8b48f8a0ba56ebc06865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q5Yfoq2v906erNEvwKsKXA.png"/></div></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="f1e0" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">结论</h1><p id="ed1a" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">D3代表数据驱动文档。代替完整的组件，它提供了数据驱动的助手函数，可以用来创建那些组件。构建一个D3库，比如React图表，可能需要更长的时间。但是一旦事情建立起来，它就为数据可视化打开了许多可能性。</p><p id="4378" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于图表，你有一个选择:C3或D3。</p><p id="9e43" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读。我希望这有所帮助。你可以在这里看到我的其他媒体出版物<a class="ae lq" href="https://medium.com/@jenniferfubook/jennifer-fus-web-development-publications-1a887e4454af" rel="noopener">。</a></p></div></div>    
</body>
</html>