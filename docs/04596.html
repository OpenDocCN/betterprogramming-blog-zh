<html>
<head>
<title>Decouple Your Styling and Tests With Data Attributes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用数据属性解耦您的样式和测试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/decouple-tests-with-data-attributes-c920606c5f27?source=collection_archive---------10-----------------------#2020-04-23">https://betterprogramming.pub/decouple-tests-with-data-attributes-c920606c5f27?source=collection_archive---------10-----------------------#2020-04-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fc1c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何从测试中分离组件的样式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e744ceeb9e450593ecac9d1e8c342566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x9fdKXeCXWWu22zW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@joaosilas?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乔·塞拉斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="1334" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我给大家介绍一下我前阵子在开发大型前端应用时遇到的一个问题。</p><p id="8e86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的团队中，我们用Angular创建了可爱的组件。之后，我们的设计师通常会设计组件的样式或者更新它们以获得更好的用户体验。</p><p id="f2a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，当我们在先前创建的功能上应用那些设计时，测试经常会失败。这导致了大量的时间损失，让开发人员和客户都感到沮丧。</p><p id="7109" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这非常令人沮丧，因为我们没有测试造型。</p><p id="9a7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，为什么我们的测试失败了呢？我们使用类选择器来识别代码中的元素。有时候，有些人会无意中使用一个选择器，这个选择器也被用来设计组件的样式。</p><p id="cf1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们后来改变样式时，测试当然会失败。之前那么好用的HTML突然坏掉了。</p><p id="d647" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这方面的一个例子是选择器<code class="fe lv lw lx ly b">.container .message</code>，它变成了选择器<code class="fe lv lw lx ly b">.container-fluid .message</code>，你可以在下面的要点中看到。</p><p id="a8cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但另一方面，也没有什么能阻止设计者向我们测试使用的CSS添加样式。因此，这是一个双向的问题。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可能的样式更改示例:容器-&gt;容器-流体。</p></figure><p id="6520" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我听到你想:“嗯，这不是测试驱动开发的最好例子，不是吗？”</p><p id="26c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，你可能是对的。但是不要让这分散你对我们这里的问题的注意力。从某种意义上说，我们的JavaScript选择器和样式是强耦合的。</p><p id="fe75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇博文中，我会给你一个解决上述问题的方法。这个解决方案最初是我的一个同事的想法，我对此做了一些研究，以充分利用它。</p><p id="8d41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你意识到你在测试代码中使用了<code class="fe lv lw lx ly b">id</code>或<code class="fe lv lw lx ly b">class</code>选择器来定位HTML，确保你会读到最后。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="3ad4" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">让我向您介绍数据属性</h1><p id="8424" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">解决方案都是关于数据属性的。你们中的一些人可能还没有听说过数据属性，所以我将给出一个快速的介绍来帮助你们了解。</p><p id="51e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任何属性名以<code class="fe lv lw lx ly b">data-</code>开头的属性都是数据属性。例如，我们可以给我们的段落赋予数据属性title。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">之前的例子，带有数据属性"<code class="fe lv lw lx ly b">data-message".</code></p></figure><p id="7245" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样做有以下优点。一方面，我们现在可以按照自己喜欢的方式使用CSS来设计组件的样式。另一方面，我们可以编写使用数据属性<code class="fe lv lw lx ly b">data-angular="message"</code>来验证段落内容的测试。</p><p id="1c6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将我们的测试与组件的样式完全分离开来！哇，太棒了，对吧？</p><p id="7216" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">备注</strong>:是的，我知道你也可以使用数据属性来设计网页的样式。如果您这样做，请记住，您还没有实现真正的解耦。我对此也有一个解决方案，所以请继续阅读。</p><h2 id="4797" class="nf mj it bd mk ng nh dn mo ni nj dp ms li nk nl mu lm nm nn mw lq no np my nq bi translated">一个典型的例子</h2><p id="f633" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我将给出一个例子，说明在像Angular这样的语言中，如何在JavaScript或类型脚本代码中使用数据属性。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="a152" class="nf mj it ly b gy nv nw l nx ny">this.element.querySelector('[data-angular="message"]');</span></pre><p id="8d7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很简单，对吧？因为我们使用的是数据属性，所以看我们应用程序浏览器的人看不到它！这是非常整洁的。</p><p id="8a17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，您不能创建一个特定的类前缀并在您的测试中使用它吗(例如<code class="fe lv lw lx ly b">my-prefix-message</code>)？我们当然可以这样做，而且维护起来也很容易。还是这太明显了？</p><p id="1a1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这让我想到，我们不能更进一步吗？在这两种解决方案(数据属性或类前缀)中，我们仍然有许多代码会留在生产中，但是我们根本不使用它们。运行时不能去掉吗？</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="a8ce" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">在生产中消除数据属性</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="d5fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们希望去掉每个仅用于测试目的的数据属性。这就是我之前使用data-angular的原因，如果你愿意，可以使用另一种命名方式。</p><p id="8256" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，您可以很好地将数据属性<code class="fe lv lw lx ly b">data-cy</code>用于Cypress测试。只要你在你的组织或项目中保持一致，你就会做得很好。</p><p id="6258" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以编写一条指令，从生产代码中移除该属性。这样，在生产中，您将根本看不到任何测试数据属性。</p><p id="da9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着在你完成测试后，产生的HTML会干净很多。我推荐使用这种方法。它很快而且影响有限。</p><p id="7285" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想在其他数据属性上做任何其他样式，那也很好。因为你是特定的(如<code class="fe lv lw lx ly b">data-angular</code>)，你不应该有冲突问题。你实现了真正的脱钩。太棒了。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="0e9f" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">结论</h1><p id="bdb0" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">上面的方法通过使用数据属性实现了测试代码与应用程序代码的分离。这对我个人有很大的好处，因为组件的样式有时是在功能创建之后完成的。</p><p id="30bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据属性驱动方法使用指令在运行时删除数据属性。这隐藏了那些原本会在您的产品代码中显示的开发细节。</p></div></div>    
</body>
</html>