<html>
<head>
<title>Building a Kotlin Mobile App With the Salesforce SDK: Editing and Creating Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Salesforce SDK构建Kotlin移动应用程序:编辑和创建数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-a-kotlin-mobile-app-with-the-salesforce-sdk-editing-and-creating-data-45916b0cc2bb?source=collection_archive---------17-----------------------#2022-03-07">https://betterprogramming.pub/building-a-kotlin-mobile-app-with-the-salesforce-sdk-editing-and-creating-data-45916b0cc2bb?source=collection_archive---------17-----------------------#2022-03-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ba20" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">因此，您可以连接您的应用程序和组织</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/575d7a36ab8221620f38cd78b8ccfc9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1nLiPuY5DAurQagz"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@alio2?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿里</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b80c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们三部分系列的第二部分，我们继续使用Salesforce Mobile SDK构建Android开发的基础。在<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/building-a-kotlin-mobile-app-with-the-salesforce-sdk-340f31e2dbf5?source=your_stories_page----------------------------------------">第一部分</a>中，我们介绍了项目设置和创建从Salesforce获取数据的布局，使用Kotlin作为我们选择的编程语言。</p><p id="b50d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们继续开发完整的移动同步策略之前，我们将首先构建我们的移动应用程序，以允许在我们的Salesforce org上编辑和创建数据。</p><h1 id="07f6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">编辑数据</h1><p id="9bcf" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">建立视图后，让我们看看如何编辑数据。理想情况下，我们希望保持相同的列表格式，但是如果用户点击一个名字，他们可以编辑它。这些更改应发送回Salesforce。</p><p id="501f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了实现这一点，我们需要做几件事。首先，我们需要覆盖默认的列表行为，使项目可编辑。然后，在记录编辑完成后，我们需要调用Salesforce API来更新数据。</p><p id="d463" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和以前一样，先从布局开始。在<code class="fe ms mt mu mv b">app/res/layout</code>中创建一个名为<code class="fe ms mt mu mv b">broker_item.xml</code>的文件，并将这些行粘贴到其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="706f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，在<code class="fe ms mt mu mv b">app/java/com.example.sfdc</code>中创建一个名为<code class="fe ms mt mu mv b">BrokerListAdapter.kt</code>的文件，并将它粘贴到:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="1659" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Android生态系统中，适配器定义了UI元素的功能。这里，我们创建了一个新的适配器，它覆盖了<code class="fe ms mt mu mv b">ArrayAdapter</code>的某些行为。我们添加了一个名为<code class="fe ms mt mu mv b">setClient</code>的函数，它重用了我们需要在<code class="fe ms mt mu mv b">MainActivity</code>中填充列表的同一个Salesforce API客户端。</p><p id="1241" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ms mt mu mv b">map</code>函数将代理的名称与他们的定制对象ID相关联——原因很快就会明了。</p><p id="600d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ms mt mu mv b">getView</code>是大部分活动发生的地方。最重要的一行是处理<code class="fe ms mt mu mv b">RestRequest.getRequestForUpdate</code>的那一行。客户端调用它来更新Salesforce数据；它需要自定义对象的名称、ID和要替换的值(在本例中是名称)。</p><p id="6706" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此事件在<code class="fe ms mt mu mv b">afterTextChanged</code>触发时发生；也就是说，在用户更新完代理的名称之后。在真实的生产环境中，您需要<a class="ae ky" href="https://developer.salesforce.com/docs/atlas.en-us.noversion.mobile_sdk.meta/mobile_sdk/android_using_rest_apis.htm#helpHead2" rel="noopener ugc nofollow" target="_blank">检查状态代码</a>以发现来自API的潜在错误，但是为了简洁起见，我们省略了任何类型的响应检查。</p><p id="9e1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ms mt mu mv b">MainActivity</code>中，我们需要利用这个适配器。首先，在类定义的顶部，将<code class="fe ms mt mu mv b">listAdapter</code>改为<code class="fe ms mt mu mv b">BrokerListAdapter</code>而不是<code class="fe ms mt mu mv b">ArrayAdapter</code>，就像这样:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="8274" class="nc lw it mv b gy nd ne l nf ng">class MainActivity : SalesforceActivity() {</span><span id="b408" class="nc lw it mv b gy nh ne l nf ng">   private var client: RestClient? = null<br/>   private var listAdapter: ArrayAdapter&lt;String&gt;? = null<br/>   private lateinit var listAdapter: BrokerListAdapter<br/>    ...</span></pre><p id="77c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ms mt mu mv b">lateinit</code>修饰符允许你在构造函数之外初始化一个非空类型。接下来，用这些函数替换两个<code class="fe ms mt mu mv b">onResume</code>函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="12fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们需要跟踪经纪人的真实姓名以及他们的记录Id。为此，我们可以简单地将它存储在<code class="fe ms mt mu mv b">BrokerListAdapter</code>维护的字典中。在<code class="fe ms mt mu mv b">sendRequest</code>中，用这个替换那里的<code class="fe ms mt mu mv b">for</code>回路:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="b730" class="nc lw it mv b gy nd ne l nf ng">for (i in 0..records.length() - 1) {<br/>   listAdapter.add(records.getJSONObject(i).getString("Name"))<br/>   listAdapter.map(records.getJSONObject(i).getString("Name"), records.getJSONObject(i).getString("Id"))<br/>}</span></pre><p id="1375" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">继续运行应用程序，您的列表项将可编辑。做个编辑，然后准备好，因为事情就要变得疯狂了。回到你的临时组织，点击Dreamforce应用程序中的<strong class="lb iu">经纪人</strong>选项卡。您的编辑应该反映在Salesforce平台上！</p><h1 id="74a3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">添加数据</h1><p id="aba5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们可以编辑记录，但是如果我们需要添加一个新的经纪人呢？这种格式非常类似于我们用来获取和编辑记录的逻辑。让我们快速浏览一下步骤。</p><p id="d238" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<code class="fe ms mt mu mv b">main.xml</code>，将这些线粘贴在<code class="fe ms mt mu mv b">ListView</code>之前:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="5061" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们添加了一个按钮，每当按下这个按钮时，就会调用一个名为<code class="fe ms mt mu mv b">onAddBrokerClick</code>的函数。在<code class="fe ms mt mu mv b">MainActivity</code>中，我们将定义该方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6d7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对，就是这样！我们定义的那些字段与定制对象直接相关。通过将<code class="fe ms mt mu mv b">Id</code>设置为null，我们告诉API这是一条新记录。如果您添加一个新行，编辑它，然后回到您的临时组织，您将看到新数据在线出现。</p><h1 id="d45e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">未完待续…</h1><p id="5310" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在我们上次完成的基础上，在这篇文章中，我们能够在我们的移动应用程序中编辑和添加经纪人数据，然后在Salesforce中看到它的反映。相当整洁！</p><p id="9e74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，这只是单向的数据更改-从应用程序到组织。如何将数据从org发送到应用程序？另外，如何处理手机特有的网络问题，比如连接问题，或者多人同时换场？</p><p id="cdef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在最后的帖子中解决这些非常现实的问题！</p></div></div>    
</body>
</html>