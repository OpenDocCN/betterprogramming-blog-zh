<html>
<head>
<title>How to set up face verification the easy way using HTML5 + JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用HTML5 + JavaScript以简单的方式设置人脸验证</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-set-up-face-verification-the-easy-way-using-html5-javascript-5301235e495f?source=collection_archive---------2-----------------------#2019-05-01">https://betterprogramming.pub/how-to-set-up-face-verification-the-easy-way-using-html5-javascript-5301235e495f?source=collection_archive---------2-----------------------#2019-05-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f20a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">上传、捕获、验证。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/ed0c756e13b3fed7e5124a1ba0644979.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*znCL8tk62ZTxF5pJqjHblg.png"/></div></figure><p id="74ab" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我用HTML5和JavaScript创建了一个非常简单的方法来匹配两张图片。你上传想要使用的验证图片，从你的相机/网络摄像头的视频流中拍摄快照，然后使用人脸匹配API来检索结果。简单。</p><p id="b9a8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><a class="ae lm" href="https://github.com/shango44/facesoft-html5-javascript-face-match" rel="noopener ugc nofollow" target="_blank">GitHub回购</a></p><h1 id="645b" class="ln lo it bd lp lq lr ls lt lu lv lw lx jz ly ka lz kc ma kd mb kf mc kg md me bi translated"><strong class="ak">你需要什么</strong></h1><ul class=""><li id="4568" class="mf mg it ks b kt mh kw mi kz mj ld mk lh ml ll mm mn mo mp bi translated">网络摄像机/照相机</li><li id="a9d5" class="mf mg it ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp bi translated">免费人脸识别API密钥</li><li id="39cd" class="mf mg it ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp bi translated">网络服务器</li></ul><h1 id="4604" class="ln lo it bd lp lq lr ls lt lu lv lw lx jz ly ka lz kc ma kd mb kf mc kg md me bi translated">在开始之前</h1><h2 id="861b" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">为此项目创建一个目录</h2><p id="3a56" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz nh lb lc ld ni lf lg lh nj lj lk ll im bi translated">这个目录将是我们存放所有文件的地方。</p><h2 id="d505" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">创建本地Web服务器</h2><p id="3048" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz nh lb lc ld ni lf lg lh nj lj lk ll im bi translated">为了完全控制图像，需要一个网络服务器。否则我们会得到一个污染画布的安全错误。有几种方法可以做到这一点，我在下面列出了如何用Python做到这一点。</p><h2 id="e436" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated"><strong class="ak">巨蟒</strong></h2><ul class=""><li id="357c" class="mf mg it ks b kt mh kw mi kz mj ld mk lh ml ll mm mn mo mp bi translated"><a class="ae lm" href="https://www.python.org/downloads/release/python-373/" rel="noopener ugc nofollow" target="_blank">安装Python </a></li><li id="6f65" class="mf mg it ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp bi translated">打开命令提示符</li><li id="82c5" class="mf mg it ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp bi translated">进入</li></ul><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="14a4" class="mv lo it nl b gy np nq l nr ns">cd C:/DIRECTORY_LOCATION &amp; py -m http.server 8000</span></pre><p id="0193" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">你应该可以通过<a class="ae lm" href="http://localhost:8000" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000 </a>访问这个目录。</p><h2 id="41d0" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">获取免费的API密钥</h2><p id="25fb" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz nh lb lc ld ni lf lg lh nj lj lk ll im bi translated">我们将使用Facesoft的人脸识别API。快速<a class="ae lm" href="https://facesoft.io/signup.html?utm_source=medium&amp;utm_medium=post&amp;utm_campaign=html-js-04-2019" rel="noopener ugc nofollow" target="_blank">在这里注册访问您的免费API密钥</a>，这样您就可以获得无限的API调用，每分钟最多两个请求。</p><p id="d3c6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">登录后，您的API密钥将出现在仪表板区域。</p><h1 id="673f" class="ln lo it bd lp lq lr ls lt lu lv lw lx jz ly ka lz kc ma kd mb kf mc kg md me bi translated">1.设置</h1><p id="bdd1" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz nh lb lc ld ni lf lg lh nj lj lk ll im bi translated">创建这三个文件:</p><ul class=""><li id="dbf5" class="mf mg it ks b kt ku kw kx kz nt ld nu lh nv ll mm mn mo mp bi translated">index.html</li><li id="e342" class="mf mg it ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp bi translated">style.css</li><li id="5288" class="mf mg it ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp bi translated">verify.js</li></ul><p id="46ee" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">接下来，右键单击并将下面的文件保存到该目录中。这些图像文件将是上传和验证图片的默认图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/74989ef1815c97d27097373f349bb0bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*xOVkIFoXIUpOa-w7O8T-sQ.png"/></div><p class="nx ny gj gh gi nz oa bd b be z dk translated">另存为“defaultupload.png”</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/18a93d12ab2f2f8c1c197f862f2784a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*P7JOOLuQaqwfCpZ1wEgsoA.png"/></div><p class="nx ny gj gh gi nz oa bd b be z dk translated">另存为“defaultphoto.png”</p></figure><h1 id="1419" class="ln lo it bd lp lq lr ls lt lu lv lw lx jz ly ka lz kc ma kd mb kf mc kg md me bi translated">2.HTML</h1><h2 id="59e2" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">布局</h2><p id="ae6f" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz nh lb lc ld ni lf lg lh nj lj lk ll im bi translated">将下面的布局代码复制并粘贴到“index.html”文件中。这给了我们借助bootstrap的框架和设计。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="2053" class="mv lo it nl b gy np nq l nr ns">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;</span><span id="4be4" class="mv lo it nl b gy ob nq l nr ns">&lt;head&gt;<br/>  &lt;!-- Required meta tags --&gt;<br/>  &lt;meta charset="utf-8"&gt;<br/>  &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"&gt;</span><span id="5594" class="mv lo it nl b gy ob nq l nr ns">&lt;!-- Bootstrap CSS --&gt;<br/>  &lt;link rel="stylesheet" href="<a class="ae lm" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="noopener ugc nofollow" target="_blank">https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css</a>" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"&gt;</span><span id="d55c" class="mv lo it nl b gy ob nq l nr ns">&lt;!-- Style CSS --&gt;<br/>  &lt;link rel="stylesheet" href="style.css"&gt;</span><span id="980b" class="mv lo it nl b gy ob nq l nr ns">&lt;title&gt;Face Verification&lt;/title&gt;<br/>&lt;/head&gt;</span><span id="1bed" class="mv lo it nl b gy ob nq l nr ns">&lt;body&gt;<br/>  &lt;!-- Page Content --&gt;<br/>  &lt;div class="container"&gt;<br/>    &lt;div class="row"&gt;<br/>      &lt;div class="col-lg-12 text-center"&gt;<br/>        &lt;h1 class="mt-5"&gt;Face Verification&lt;/h1&gt;<br/>        &lt;p class="lead"&gt;Quick and simple face verification using HTML5 and JavaScript&lt;/p&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>    &lt;!-- INSERT NEXT CODE HERE --&gt;</span><span id="bf8e" class="mv lo it nl b gy ob nq l nr ns">  &lt;/div&gt;</span><span id="ce1a" class="mv lo it nl b gy ob nq l nr ns">&lt;!-- Verify JS --&gt;<br/> &lt;script src="verify.js"&gt;&lt;/script&gt;</span><span id="cd1f" class="mv lo it nl b gy ob nq l nr ns">&lt;!-- jQuery first, then Popper.js, then Bootstrap JS --&gt;<br/>  &lt;script src="<a class="ae lm" href="https://code.jquery.com/jquery-3.3.1.slim.min.js" rel="noopener ugc nofollow" target="_blank">https://code.jquery.com/jquery-3.3.1.slim.min.js</a>" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"&gt;&lt;/script&gt;<br/>  &lt;script src="<a class="ae lm" href="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" rel="noopener ugc nofollow" target="_blank">https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js</a>" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"&gt;&lt;/script&gt;<br/>  &lt;script src="<a class="ae lm" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" rel="noopener ugc nofollow" target="_blank">https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js</a>" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"&gt;&lt;/script&gt;<br/>&lt;/body&gt;</span><span id="5117" class="mv lo it nl b gy ob nq l nr ns">&lt;/html&gt;</span></pre><h2 id="c3c8" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">图像、画布和按钮</h2><p id="2b16" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz nh lb lc ld ni lf lg lh nj lj lk ll im bi translated">我们现在创建一行，有三列用于验证照片、视频流和从视频流中拍摄的照片。将下面的代码添加到该行之后。</p><p id="dc20" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">检查前面代码中的“在此插入下一个代码”标记。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="729c" class="mv lo it nl b gy np nq l nr ns">&lt;div class="row justify-content-md-center"&gt;<br/>  &lt;div class="col-lg-4 text-center"&gt;<br/>    &lt;p&gt;&lt;strong&gt;Verification Photo&lt;/strong&gt;&lt;/p&gt;</span><span id="4736" class="mv lo it nl b gy ob nq l nr ns">      &lt;!-- Canvas For Uploaded Image --&gt;<br/>      &lt;canvas id="uploadCanvas" width="300"  height="300"&gt;&lt;/canvas&gt;</span><span id="e755" class="mv lo it nl b gy ob nq l nr ns">      &lt;!-- Default Canvas Image --&gt;<br/>      &lt;img src="defaultupload.png" id="uploadedPhoto" alt="upload"/&gt;</span><span id="cbdf" class="mv lo it nl b gy ob nq l nr ns">      &lt;!-- Upload Image Input &amp; Upload Photo Button --&gt;<br/>      &lt;input type="file" name="image-upload" accept="image/png, image/jpeg"&gt;</span><span id="5c7d" class="mv lo it nl b gy ob nq l nr ns">      &lt;button id="upload" type="button" class="btn btn-outline-primary btn-lg"&gt;Upload Photo&lt;/button&gt;<br/>  &lt;/div&gt;</span><span id="101e" class="mv lo it nl b gy ob nq l nr ns">  &lt;div class="col-lg-4 text-center"&gt;<br/>    &lt;p&gt;&lt;strong&gt;Video&lt;/strong&gt;&lt;/p&gt;</span><span id="36b7" class="mv lo it nl b gy ob nq l nr ns">    &lt;!-- Camera --&gt;<br/>    &lt;div class="camera-container"&gt;<br/>      &lt;video id="video" width="100%" height="300" autoplay="true"&gt;<br/>      &lt;/video&gt;<br/>    &lt;/div&gt;</span><span id="6571" class="mv lo it nl b gy ob nq l nr ns">    &lt;!-- Take Photo Button --&gt;<br/>    &lt;button id="capture" type="button" class="btn btn-outline-primary btn-lg"&gt;Take Photo&lt;/button&gt;<br/>  &lt;/div&gt;</span><span id="1a7e" class="mv lo it nl b gy ob nq l nr ns">  &lt;div class="col-lg-4 text-center"&gt;<br/>    &lt;p&gt;&lt;strong&gt;Photo Taken&lt;/strong&gt;&lt;/p&gt;<br/>  <br/>    &lt;!-- Canvas For Capture Taken --&gt;<br/>    &lt;canvas id="captureCanvas" width="300"  height="300"&gt;&lt;/canvas&gt;</span><span id="db80" class="mv lo it nl b gy ob nq l nr ns">    &lt;!-- Default Canvas Image --&gt;<br/>    &lt;img src="defaultphoto.png" id="capturedPhoto" alt="capture" /&gt;</span><span id="2361" class="mv lo it nl b gy ob nq l nr ns">    &lt;!-- Verify Photos Button --&gt;<br/>    &lt;button id="verify" type="button" class="btn btn-outline-success btn-lg"&gt;Verify Photo&lt;/button&gt;<br/>  &lt;/div&gt;<br/>&lt;/div&gt;<br/>&lt;!-- INSERT NEXT CODE HERE --&gt;</span></pre><h2 id="6efd" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">API响应和警告</h2><p id="6228" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz nh lb lc ld ni lf lg lh nj lj lk ll im bi translated">我们要添加的代码将显示比赛结果、分数百分比、错误和警告。在我们添加的最后一个代码的正下方，添加下面的代码。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="9479" class="mv lo it nl b gy np nq l nr ns">&lt;div class="row"&gt;<br/>  &lt;div class="col-lg-12 text-center"&gt;<br/>    &lt;!-- API Match Result &amp; API Percentage Score --&gt;<br/>    &lt;h2 id="match" class="mt-5"&gt;&lt;/h2&gt;<br/>    &lt;p id="score" class="lead"&gt;&lt;/p&gt;<br/>  &lt;/div&gt;<br/>  &lt;div class="col-lg-12 text-center"&gt;<br/>    &lt;!-- Error &amp; Warning Alerts --&gt;<br/>    &lt;div class="alert alert-danger" id="errorAlert"&gt;&lt;/div&gt;<br/>    &lt;div class="alert alert-warning" id="warningAlert"&gt;&lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><h1 id="fafa" class="ln lo it bd lp lq lr ls lt lu lv lw lx jz ly ka lz kc ma kd mb kf mc kg md me bi translated">3.CSS</h1><p id="e1c2" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz nh lb lc ld ni lf lg lh nj lj lk ll im bi translated">将下面的代码添加到style.css文件中。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="8020" class="mv lo it nl b gy np nq l nr ns">.camera-container {<br/>  max-width: 100%;<br/>  border: 1px solid black;<br/>}</span><span id="c71b" class="mv lo it nl b gy ob nq l nr ns">.verification-image {<br/>  width: 300px;<br/>  height: auto;<br/>  max-width: 100%;<br/>}</span><span id="6271" class="mv lo it nl b gy ob nq l nr ns">.btn {<br/>  margin-top: 10px;<br/>}</span><span id="578f" class="mv lo it nl b gy ob nq l nr ns">#captureCanvas, #uploadCanvas {<br/>  display: none;<br/>}</span><span id="91d4" class="mv lo it nl b gy ob nq l nr ns">input[name="image-upload"] {<br/>  display: none;<br/>}</span><span id="87ae" class="mv lo it nl b gy ob nq l nr ns">#errorAlert, #warningAlert {<br/>  display: none;<br/>}</span></pre><p id="b270" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们已经将图像上传输入设置为显示none，因为我们将使用upload按钮触发它。此外，画布的id已经设置为显示none，因此最初显示的是默认图像。</p><p id="e0a6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">你的屏幕应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oc"><img src="../Images/9dbf957d75d7f8f81d40ba57fdb8a78b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WMd0cgFylSAkWslnaGJDaQ.png"/></div></div></figure><h1 id="1ec7" class="ln lo it bd lp lq lr ls lt lu lv lw lx jz ly ka lz kc ma kd mb kf mc kg md me bi translated">4.JavaScript</h1><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="a8c8" class="mv lo it nl b gy np nq l nr ns">document.addEventListener("DOMContentLoaded", function() {</span><span id="f679" class="mv lo it nl b gy ob nq l nr ns">});</span></pre><p id="0548" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在verify.js文件中，我们希望从添加一个将在页面加载后运行的事件侦听器开始。我们输入的每个代码都应该在这个函数里面。</p><h2 id="24b4" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">变量</h2><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="d432" class="mv lo it nl b gy np nq l nr ns">var video = document.getElementById('video'), <br/>captureCanvas = document.getElementById('captureCanvas'), <br/>uploadCanvas = document.getElementById('uploadCanvas'), <br/>captureContext = captureCanvas.getContext('2d'),<br/>uploadContext = uploadCanvas.getContext('2d'),<br/>uploadedPhoto = document.getElementById('uploadedPhoto'),<br/>capturedPhoto = document.getElementById('capturedPhoto'),<br/>imageUploadInput = document.querySelector('[name="image-upload"]'),<br/>apiKey = 'INSERT_YOUR_FACESOFT_API_KEY',<br/>errorAlert = document.getElementById('errorAlert'), AlertwarningAlert = document.getElementById('warningAlert'),<br/>matchText = document.getElementById('match'),<br/>scoreText = document.getElementById('score');</span></pre><p id="cbb8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这些变量是:</p><ul class=""><li id="61a4" class="mf mg it ks b kt ku kw kx kz nt ld nu lh nv ll mm mn mo mp bi translated">视频元素、画布、照片和API响应的id</li><li id="22ab" class="mf mg it ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp bi translated">图像输入选择器</li><li id="8ae7" class="mf mg it ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp bi translated">画布上下文</li><li id="5099" class="mf mg it ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp bi translated">API密钥</li></ul><h2 id="1cfe" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">视频流</h2><p id="1be4" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz nh lb lc ld ni lf lg lh nj lj lk ll im bi translated">这里有一个非常简单的代码来访问您的网络摄像头/摄像机，并将其流式传输到视频元素。添加底层变量。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="b7cc" class="mv lo it nl b gy np nq l nr ns">// Stream Camera To Video Element</span><span id="4bf2" class="mv lo it nl b gy ob nq l nr ns">if(navigator.mediaDevices.getUserMedia){<br/>  navigator.mediaDevices.getUserMedia({ video: true })<br/>  .then(function(stream) {<br/>    video.srcObject = stream;<br/>  }).catch(function(error) {<br/>    console.log(error)<br/>  })<br/>}</span></pre><p id="aa98" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果你刷新你的页面，你会看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oc"><img src="../Images/484f94e6c00fd43d381e13da413186b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WS-mIdP88Vlmf0TMXuofoQ.png"/></div></div></figure><h2 id="5d72" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">功能1:将照片设置到画布上</h2><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="f1a8" class="mv lo it nl b gy np nq l nr ns">// Set Photo To Canvas Function</span><span id="2e61" class="mv lo it nl b gy ob nq l nr ns">function setImageToCanvas(image, id, canvas, context, width=image.width, height=image.height) {<br/>  var ratio = width / height;<br/>  var newWidth = canvas.width;<br/>  var newHeight = newWidth / ratio;</span><span id="4a53" class="mv lo it nl b gy ob nq l nr ns">  if (newHeight &gt; canvas.height) {<br/>    newHeight = canvas.height;<br/>    newWidth = newHeight * ratio;<br/>  }</span><span id="b453" class="mv lo it nl b gy ob nq l nr ns">  context.clearRect(0, 0, canvas.width, canvas.height);<br/>  context.drawImage(image, 0, 0, newWidth, newHeight);<br/>  id.setAttribute('src', canvas.toDataURL('image/png'));<br/>}</span></pre><p id="d75c" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在这个函数中，我们接收图像、ID、画布、上下文、宽度和高度。我们接受宽度和高度，因为要获得视频的尺寸，我们必须使用video . video width &amp; video . video height。</p><p id="d91a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们还获得了图像的纵横比，这样，当我们分配图像时，它正好适合画布。剩余的代码清除画布并将新图像绘制到画布中。</p><h2 id="0bba" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">函数2: V <strong class="ak">通过将照片发送到API来验证照片是否匹配</strong></h2><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="e92a" class="mv lo it nl b gy np nq l nr ns">// Facesoft Face Match API Function</span><span id="a1b4" class="mv lo it nl b gy ob nq l nr ns">function verifyImages(image1, image2, callback){<br/>  var params = {<br/>    image1: image1,<br/>    image2: image2,<br/>  }</span><span id="6421" class="mv lo it nl b gy ob nq l nr ns">  var xhr = new XMLHttpRequest();<br/>  xhr.open("POST", "https://api.facesoft.io/v1/face/match");<br/>  xhr.setRequestHeader("apikey", apiKey);<br/>  xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");</span><span id="4538" class="mv lo it nl b gy ob nq l nr ns">  xhr.onload = function(){<br/>    callback(xhr.response);<br/>  }</span><span id="5fb2" class="mv lo it nl b gy ob nq l nr ns">  xhr.send(JSON.stringify(params));<br/>}</span></pre><p id="10bb" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在这个函数中，我们向face match API端点发出XMLHttpRequest。我们已经在标题中添加了用于授权和内容类型的API密钥。对于主体，我们传递一个包含两个图像的对象。</p><p id="6c64" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在我们完成了函数。</p><h2 id="cc1b" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">上传照片按钮点击事件</h2><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="f4b0" class="mv lo it nl b gy np nq l nr ns">// On Upload Photo Button Click</span><span id="1f82" class="mv lo it nl b gy ob nq l nr ns">document.getElementById('upload').addEventListener('click', function(){<br/>  imageUploadInput.click();<br/>})</span></pre><p id="70af" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">upload按钮的click事件侦听器触发图像输入的单击。</p><h2 id="da05" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">图像上传输入更改事件</h2><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="5e72" class="mv lo it nl b gy np nq l nr ns">// On Uploaded Photo Change</span><span id="b96a" class="mv lo it nl b gy ob nq l nr ns">imageUploadInput.addEventListener('change', function(){<br/>  // Get File Extension<br/>  var ext = imageUploadInput.files[0]['name'].substring(imageUploadInput.files[0]['name'].lastIndexOf('.') + 1).toLowerCase();</span><span id="52e5" class="mv lo it nl b gy ob nq l nr ns">  // If File Exists &amp; Image</span><span id="db8b" class="mv lo it nl b gy ob nq l nr ns">  if (imageUploadInput.files &amp;&amp; imageUploadInput.files[0] &amp;&amp; (ext == "png" || ext == "jpeg" || ext == "jpg")) {</span><span id="2012" class="mv lo it nl b gy ob nq l nr ns">    // Set Photo To Canvas<br/>    var reader = new FileReader();<br/>    reader.onload = function (e) {<br/>      var img = new Image();<br/>      img.src = e.target.result;<br/>      img.onload = function() {<br/>      setImageToCanvas(img, uploadedPhoto, uploadCanvas, uploadContext);<br/>      }<br/>    }<br/>    reader.readAsDataURL(imageUploadInput.files[0]);<br/>  }<br/>})</span></pre><p id="e786" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在这个变更事件监听器中，我们检索文件扩展名并执行if语句来检查输入中是否有图像文件。然后，我们使用FileReader将图像加载到画布上。</p><h2 id="708b" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">拍照按钮点击事件</h2><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="31c6" class="mv lo it nl b gy np nq l nr ns">// On Take Photo Button Click</span><span id="1b2f" class="mv lo it nl b gy ob nq l nr ns">document.getElementById('capture').addEventListener('click', function(){<br/>  setImageToCanvas(video, capturedPhoto, captureCanvas, captureContext, video.videoWidth, video.videoHeight);<br/>})</span></pre><p id="c226" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这个事件侦听器现在执行set image to canvas，从视频中捕获一个静止帧，并将其分配到画布中。</p><h2 id="e100" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">验证照片按钮点击事件</h2><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="9177" class="mv lo it nl b gy np nq l nr ns">// On Verify Photo Button Click</span><span id="758c" class="mv lo it nl b gy ob nq l nr ns">document.getElementById('verify').addEventListener('click', function(){</span><span id="a360" class="mv lo it nl b gy ob nq l nr ns">  // Remove Results &amp; Alerts</span><span id="335f" class="mv lo it nl b gy ob nq l nr ns">  errorAlert.style.display = "none";<br/>  warningAlert.style.display = "none";<br/>  matchText.innerHTML = "";<br/>  scoreText.innerHTML = "";</span><span id="26db" class="mv lo it nl b gy ob nq l nr ns">  // Get Base64</span><span id="ccd3" class="mv lo it nl b gy ob nq l nr ns">  var image1 = captureCanvas.toDataURL().split(',')[1];<br/>  var image2 = uploadCanvas.toDataURL().split(',')[1]; </span><span id="66bc" class="mv lo it nl b gy ob nq l nr ns">  // Verify if images are of the same person</span><span id="2105" class="mv lo it nl b gy ob nq l nr ns">  verifyImages(image1, image2, function(response){</span><span id="4c86" class="mv lo it nl b gy ob nq l nr ns">    if(response){<br/>      var obj = JSON.parse(response);<br/>      <br/>      // If Warning Message<br/>     <br/>      if(obj.message){<br/>        errorAlert.style.display = "none";<br/>        warningAlert.style.display = "block";<br/>        warningAlert.innerHTML = obj.message;<br/>        matchText.innerHTML = "";<br/>        scoreText.innerHTML = "";<br/>      }</span><span id="9ad4" class="mv lo it nl b gy ob nq l nr ns">      // If Error</span><span id="aaac" class="mv lo it nl b gy ob nq l nr ns">      else if(obj.error){<br/>        errorAlert.style.display = "block";<br/>        errorAlert.innerHTML = obj.error;<br/>        warningAlert.style.display = "none";<br/>        matchText.innerHTML = "";<br/>        scoreText.innerHTML = "";<br/>      }</span><span id="1d32" class="mv lo it nl b gy ob nq l nr ns">      // If Valid</span><span id="b8d5" class="mv lo it nl b gy ob nq l nr ns">      else{<br/>        errorAlert.style.display = "none";<br/>        warningAlert.style.display = "none";<br/>        matchText.innerHTML = obj.match;<br/>        scoreText.innerHTML = (obj.score*100).toFixed(2)+"% Score";<br/>      }<br/>    }<br/>  })<br/>})</span></pre><p id="088e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在这种情况下，我们首先隐藏错误/警告警报，并从匹配结果和分数百分比中删除任何文本。</p><p id="4288" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">然后我们从画布中获取图像的base64，并使用split方法只获取没有“data:image/png；base64”，这样API就不会返回错误。</p><p id="0723" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">最后，我们调用verify images函数将数据发送给API，我们的响应将是一个包含结果、错误或消息的对象。</p><h2 id="5e0f" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">最终代码</h2><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="8372" class="mv lo it nl b gy np nq l nr ns">// Set Default Images For Uploaded &amp; Captured Photo</span><span id="da1a" class="mv lo it nl b gy ob nq l nr ns">setImageToCanvas(uploadedPhoto, uploadedPhoto, uploadCanvas, uploadContext);</span><span id="1f2c" class="mv lo it nl b gy ob nq l nr ns">setImageToCanvas(capturedPhoto, capturedPhoto, captureCanvas, captureContext);</span></pre><p id="8b0a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这将允许我们通过将默认图像分配到它们的画布来验证它们。</p><h1 id="11fa" class="ln lo it bd lp lq lr ls lt lu lv lw lx jz ly ka lz kc ma kd mb kf mc kg md me bi translated">5.岩石大战道恩·强森</h1><p id="4c75" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz nh lb lc ld ni lf lg lh nj lj lk ll im bi translated">如果你点击“验证”,我们将会看到API是否能区分年轻时的岩石和我们通常在电影中看到的道恩·强森…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oc"><img src="../Images/34d833b59def4c00a80459120fe7ac19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oTWZIr63jf_8JWBSZy-Ivg.png"/></div></div></figure><p id="746f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">API以96.53%的匹配分数正确地将两者识别为相同！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oc"><img src="../Images/16369ed5f7f570e4a135273e539d6cfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eQq-MFVOIc3yhKJe4Dt64g.png"/></div></div></figure><h1 id="c759" class="ln lo it bd lp lq lr ls lt lu lv lw lx jz ly ka lz kc ma kd mb kf mc kg md me bi translated">简而言之:上传、捕获、验证</h1><p id="940d" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz nh lb lc ld ni lf lg lh nj lj lk ll im bi translated">现在，您应该能够想到更好、更安全、更复杂的方法来实现面部匹配，如登录、2FA、授权、支付等。</p><h2 id="a593" class="mv lo it bd lp mw mx dn lt my mz dp lx kz na nb lz ld nc nd mb lh ne nf md ng bi translated">准确性和可靠性</h2><p id="756b" class="pw-post-body-paragraph kq kr it ks b kt mh ju kv kw mi jx ky kz nh lb lc ld ni lf lg lh nj lj lk ll im bi translated">世界上最好的人脸识别算法的结果出来了，我们正在使用的算法排名前十，击败了东芝、微软和VisionLabs。它还在wild image测试(困难角度下的检测)中获得了全球第二名。参见<a class="ae lm" href="https://www.nist.gov/programs-projects/frvt-11-verification" rel="noopener ugc nofollow" target="_blank"> NIST人脸识别厂商测试</a> — imperial-001。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oc"><img src="../Images/acda8e9d79c5d4cb3092caab6121e976.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qa78CnxUqkhoC5RSNNprcA.png"/></div></div><p class="nx ny gj gh gi nz oa bd b be z dk translated">验证照片呈45度角，照片拍摄于面部下方。</p></figure><p id="97b0" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">该API还能够检测、地标、大规模识别和名人检测。<a class="ae lm" href="https://facesoft.io/demos.html?utm_source=medium&amp;utm_medium=post&amp;utm_campaign=html-js-04-2019" rel="noopener ugc nofollow" target="_blank">你可以在这里测试所有的演示。</a></p><p id="4ccf" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">玩得开心！</p></div></div>    
</body>
</html>