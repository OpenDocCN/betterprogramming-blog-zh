# 你真的准备好 CI/CD 了吗？

> 原文：<https://betterprogramming.pub/are-you-really-ready-for-ci-cd-9a8bf6d01b8a>

## 连续部署在理论上听起来很棒，但是在你的客户面前获得一个新特性的背后还有更多

![](img/d57bb969d1e78917dbe1e91e0ae2b36f.png)

本杰明·戴维斯在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片。

我大学毕业后的第一份工作是在一家大型软件公司。我们每年都会发布旗舰产品的主要版本，大约每个月都会发布次要版本。我们遵循传统的软件发布周期。

我们的顾客已经习惯了。他们选择是否进行更新。他们控制着局面。这有点吓人，因为我们是供应商，而不是他们。

我们决定转向 CI/CD，彻底改变这个过程，并采用现代的软件开发方法。一旦产品特性完成并经过测试，就将其投入生产。

听起来不错吧？是的，但那只是冰山一角。为您的最终用户提供高质量的体验需要付出更多努力。

![](img/74bc0424963e71054309edc64f16ff87.png)

照片由 [NeONBRAND](https://unsplash.com/@neonbrand?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄。

# 设定期望值

当从传统的软件发布周期转移到 CI/CD 时，您可能会惊讶地发现来自内部人员的抵制与来自外部客户的抵制一样多。

人们不喜欢改变。这是人之常情。给一个人一个套路，他就会开心。转向持续部署就像告诉某人，“到目前为止你所做的一切都是错的。请全部重新学习。”

## **内部斗争**

在你的公司内部，你会受到来自组织各个方面的阻力。他们不得不修改客户合同。他们不明白没有一个完整的回归测试周期，一个东西怎么能投入生产。他们不相信开发人员不会破坏一切。

会有打嗝。你有大约 0%的机会在第一次尝试中顺利完成。没关系。设定流程正在改变的预期，并且你正在消除一些细节。

## **客户期望**

你现有的客户群已经习惯了你的某种行为方式，但是你现在要改变你的经营方式，让它变得“更好”你必须向你的客户证明这种新模式比你现在做的更好。

你必须让他们相信，改变他们的流程是值得的。这是您证明缺陷周转会成倍加快的机会。再也不用等到特定的日期才能看到修复。一旦做出改变，就在他们的手中。

![](img/cc404f57eb6fcdb2bfc775bec1528456.png)

[陈嘉里](https://unsplash.com/@gary_at_unsplash?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片。

# 放弃“释放”这个词

当您切换到 CI/CD 时，标准的发布模型就过时了。相反，你必须关注*小的增量变化*，因为每一次代码推送都是为了生产。

这种部署方法不再有“版本”了。你不会再发布一个一年都有变化的产品更新版本了。相反，您将每天交付微小的功能、错误修复、增强和特性。

节奏不需要设定。每当开发人员完成代码并且 QA 批准了它，就发布它。这可能意味着一周一次，也可能意味着一天五次。这个想法是，当它准备好了，它是可用的。

你需要弄清楚你的“发布说明”有多详细既然你没有推出新版本，你还需要它们吗？

一些公司有一个专门为开发团队服务的科技作家。对于每一次代码推送，技术作者都会给出一个简短、用户友好的描述，说明发生了什么变化。描述被推送到“更新内容”页面，按天细分。

做发行说明的方法有很多种，没有一种比其他的更好。做对你的公司最有利的事情。

![](img/93281ce08694b617ae0c294805093286.png)

[布雷特·乔丹](https://unsplash.com/@brett_jordan?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片。

# 强调自动化测试

CI/CD 的极快速度不允许对您的应用程序的每一次更改进行手动冒烟测试。跟上这些变化是不可能的。

为了给组织的内部和外部都注入信心，您必须建立一套自动化测试，只要有变化就运行。自动进行原本需要手动完成的烟雾测试。它们的完成速度要快得多。另外，它排除了人为错误的可能性。

在我的团队中，我们对每一个代码变更都运行两套自动化测试。首先，我们有一组测试代码的健壮的单元测试。他们测试我们代码库中每个函数的成功和失败路径。如果单元测试失败，构建也会失败——这意味着我们的更改不会被部署。

如果单元测试通过，我们就进入集成测试。我们已经构建了一组强大的 [Postman](https://getpostman.com) 集合，它们贯穿我们应用程序中的标准业务流程。这些测试了我们的应用程序支持的所有业务流，并且它们在不断发展。同样，如果这些测试中的任何一个失败了，我们的构建就失败了——什么也没有部署。

只有当所有的单元测试和集成测试都通过时，我们才知道我们没有破坏向后兼容性或者对应用程序的另一个组件产生负面影响。

自动化测试是“一次构建，永远测试”的投资。

只需一点点前期成本，就可以保证在应用程序中进行更改时，特定的业务流程将始终工作。当你一天进行五次生产推动时，拥有这种信心是绝对必要的。

![](img/cbd90cdf45e55fb0399b33c67887fb58.png)

由[奎诺·阿尔](https://unsplash.com/@quinoal?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片。

# 知道出问题时该怎么做

假设一个开发人员推动了一个导致系统中断的代码变更。自动化测试还没有更新到测试场景，所以它悄悄进入了生产环境。

您是否恢复更改？你会找到一个解决方法，然后推动另一个改变吗？

对于 CI/CD，尤其是微服务架构，您需要采取“永远向前，永不后退”的心态。尽最大努力解决代码更改带来的问题，使您的应用程序向前发展，而不是回到以前的提交状态。

事情会出错。他们总是这样，没关系。在转移到 CI/CD 之前有一个合适的策略将有助于抑制开发人员、支持人员和客户的焦虑。

当事情即将变得糟糕时，你能做的最好的事情之一就是建立主动监控。

您希望在您的客户发现问题之前就发现问题。

有许多方法可以进行主动监控，并且根据您的架构有很大的不同。不管你有什么架构，你都可以使用的一个有效方法是类似于[邮递员监视器](https://learning.postman.com/docs/designing-and-developing-your-api/monitoring-your-api/intro-monitors/)的东西。

监视器全天运行一系列测试，如果出现任何问题，就会向您发出警报。您可以让它们运行安全审计、业务流程或验证 API 契约。你需要的只是一个 API。

![](img/4452ff4a212d3b2351bad25ac50ccf25.png)

由 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的 [La-Rel Easter](https://unsplash.com/@lastnameeaster?utm_source=medium&utm_medium=referral) 拍摄的照片。

# 聪明地对待你如何分解工作

CI/CD 的口头禅是*小、* *增量变化。* 我们都知道并不是所有的新 app 功能都很小。也许你正在为你的应用程序实现一个搜索特性。

添加搜索需要进行一些更改:

*   设置弹性搜索。
*   填充弹性搜索指数。
*   创造了一种向索引中添加新数据的方法。
*   构建搜索端点。
*   提供了一种在 UI 中搜索的方法。

在传统的发布周期中，您将简单地构建所有这些组件并发布最终产品。但是 CI/CD 不是这样的。

上面的每一个要点都是对生产的单独推动。随着时间的推移，您将逐步构建这个特性，最后您要做的就是提供一种通过 UI 访问它的方法。

您可以并且应该首先构建您的后端功能，这样您就可以组装自动化测试并验证它是否按预期工作。在你知道它可以工作之后，*然后*你可以向你的用户展示新特性的存在。

对于您的客户，您刚刚发布了一个巨大的新功能。事实上，它已经存在了几天/几周/几个月——只是看不见而已。你已经构建了它，测试了它，自动化了它，回归测试了一切。然后你就可以交出钥匙了。

# 结论

和大多数事情一样，CI/CD 并不像听起来那么简单。如果你想构建安全、可靠的软件，你必须了解你要做的事情的来龙去脉。

预先设定事情正在发生变化的预期。不要只是撕掉创可贴。

进入*小的、渐进的变化*思维模式。自信地一天多次投入生产。

自动化一切。说真的，自动化一切。

制定应急计划。拥有一个在几分钟或几小时内，而不是几天或几周内解决、修复、测试和部署高优先级问题的流程。

对你如何建造要聪明。你的应用一天比一天好。保持你的改变小而集中。在开始编码之前，制定一个开发计划。

CI/CD 绝对值得。当你从“一切都不一样”的震惊中走出来后，你会想知道你是如何用其他方式进行开发的。问题的快速解决、眨眼之间开发的功能，以及系统运行状况的清晰视图。

祝你好运！