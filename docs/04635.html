<html>
<head>
<title>Design an Analytics or Event Tracking Manager in iOS Swift App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS Swift应用程序中设计一个分析或事件跟踪管理器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/design-an-analytics-or-event-tracking-manager-for-an-ios-app-75979e7144ee?source=collection_archive---------2-----------------------#2020-04-27">https://betterprogramming.pub/design-an-analytics-or-event-tracking-manager-for-an-ios-app-75979e7144ee?source=collection_archive---------2-----------------------#2020-04-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7d81" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">实施分析包装器，以支持多个SDK并跟踪应用中的事件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1d2cb8c53f8b21debf72e928cdad1843.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-iADds-1lCncd92GIIyhA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卢克·切瑟在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="15de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">“信息是21世纪的石油，分析是内燃机”</em> — <em class="lv"> Peter Sondergaard </em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="9146" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated"><strong class="ak">为什么需要数据分析？</strong></h1><ul class=""><li id="447e" class="mv mw it lb b lc mx lf my li mz lm na lq nb lu nc nd ne nf bi translated">衡量和跟踪你的工作。</li><li id="9403" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">了解你的访客，线索，前景。</li><li id="bf54" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">了解、跟踪和改进将你的第一个访客转化为有价值客户的机制。</li><li id="9eea" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">主要目标是提高认知度、参与度和忠诚度。</li></ul></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="12f1" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">特征</h1><p id="f829" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">作为一名开发人员，在设计灵活的分析引擎时，您可能需要考虑很多问题。其中包括:</p><ul class=""><li id="6234" class="mv mw it lb b lc ld lf lg li no lm np lq nq lu nc nd ne nf bi translated">支持多个分析SDK</li><li id="f6c4" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">灵活添加、更新和删除分析SDK</li><li id="f0c5" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">添加、更新和删除灵活的事件及其属性</li><li id="7de7" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">将事件分组以提高可读性</li><li id="7ec0" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">一个可测试和可模仿的模块</li><li id="bc56" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">灵活地在应用内的任何地方使用它来跟踪事件。</li></ul><p id="4d6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我确信还有很多地方需要补充，但这些是开发者在设计分析层时需要考虑的一些理想的东西，而不违反最佳实践。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="45c9" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">事件</h1><p id="92e5" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我们将从一个非常基本的<code class="fe nr ns nt nu b">EventProtocol</code>开始，它将理想地陈述我们需要在一个事件中发送哪些属性:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="ee10" class="nz me it nu b gy oa ob l oc od">protocol EventProtocol {                           <br/>  var name: String { get set }                           <br/>  var params: [String: Any] { get set }                       <br/>}</span></pre><p id="54f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们将创建实现我们的<code class="fe nr ns nt nu b">EventProtocol</code> <em class="lv">的<code class="fe nr ns nt nu b">Event</code>结构。</em>我们也将利用<code class="fe nr ns nt nu b">propertyWrapper</code>进行建筑活动。</p><p id="502f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个例子，我还在<code class="fe nr ns nt nu b">Event</code>扩展中添加了一些助手函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="40d3" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">模拟事件</h1><p id="14bb" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在这个例子中，我们将发送两种事件:屏幕访问和点击事件。</p><p id="abd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了方便起见，我们创建了两个<strong class="lb iu"> </strong>枚举，在其中我们将添加所有的<strong class="lb iu"> </strong>事件和参数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="3a13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，这是有趣的部分。当我们在开发一个巨大的应用程序时，我们必须从应用程序的不同部分发送事件。有许多方法可以对接所有这些事件，比如我们添加所有事件的单枚举、结构或类方法。但是当这个<strong class="lb iu"> </strong>枚举、结构或类增长到500多个事件时，它就失去了可读性。</p><p id="d734" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您的经理或主管向您询问任何功能的活动信息。很难找到它，把它全部列在一个枚举、结构或类中也会让你的代码看起来很松散。</p><p id="3663" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决方案是借助<code class="fe nr ns nt nu b">propertyWrapper</code> <strong class="lb iu">将我们的事件按特征分组。你可以看到我们创建事件是多么容易，我们的代码可读性更强，任何人都容易理解。</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="1e71" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">让我们实现记录器</h1><p id="c9c8" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我们将首先创建<code class="fe nr ns nt nu b">AnalyticsEventsLoggerProtocol</code>、<strong class="lb iu"> <em class="lv"> </em> </strong>，它将陈述任何分析引擎(SDK)的基本要求，例如:</p><ul class=""><li id="221c" class="mv mw it lb b lc ld lf lg li no lm np lq nq lu nc nd ne nf bi translated">初始化和设置</li><li id="4594" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">事件跟踪</li></ul><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="8c33" class="nz me it nu b gy oa ob l oc od">protocol AnalyticsEventsLoggerProtocol { <br/>  func setUserProperties(user: UserProfileModel) <br/>  func trackEvent(event: EventProtocol) <br/>}</span></pre><p id="131f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，对我们来说，初始化任何分析SDK都很简单。下面是Firebase SDK的一个示例:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="c335" class="nz me it nu b gy oa ob l oc od">// Firebase <br/>class FirebaseEventLogger: AnalyticsEventsLoggerProtocol { <br/>   func setUserProperties(user: UserProfileModel) { <br/>     // init SDK and set user properties <br/>   } </span><span id="b3c1" class="nz me it nu b gy og ob l oc od">   func trackEvent(event: EventProtocol) { <br/>     // add implementation of tracking events <br/>   } <br/>}</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="c55b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">让我们实现一个分析管理器</h1><p id="8a91" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">现在让我们来看看我们的老板<strong class="lb iu"> </strong>，他将把事件路由到analytics SDK的引擎并发送事件。</p><p id="a835" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将从创建<code class="fe nr ns nt nu b">AnalyticsManagerProtocol</code> <strong class="lb iu">、</strong>开始，在这里我们将陈述它发送事件和设置的基本要求:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="ddbb" class="nz me it nu b gy oa ob l oc od">protocol AnalyticsManagerProtocol { <br/>   func setUp()<br/>   func trackEvent(_ event: EventProtocol, params: [String: Any]) <br/>}</span></pre><p id="6e2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们将这个协议实现到<code class="fe nr ns nt nu b">AnalyticsManager</code> <strong class="lb iu"> </strong>类中。</p><p id="4a1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个单独的类，将持有所有分析引擎的数组引用，它将负责发送与<code class="fe nr ns nt nu b">trackEvent </code>协议方法的事件。您可以检查这个函数的实现，其中它调用它的logger <code class="fe nr ns nt nu b">trackEvent</code>方法来发送事件以跟踪用户操作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="1645" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">总结</h1><p id="7fda" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">现在，只需拨打一条线路，即可在我们应用的任何部分发送事件，并发送事件:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="d034" class="nz me it nu b gy oa ob l oc od">// Without Params<br/>AnalyticsManager.shared.trackEvent(FeatureOneEvents.screen)</span><span id="351a" class="nz me it nu b gy og ob l oc od">// With Params<br/>AnalyticsManager.shared.trackEvent(FeatureOneEvents.screen,<br/>                                  params:["source": "Tabs"])</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="14df" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">谢谢你</h1><p id="efd9" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我希望这篇文章能帮助你设计你自己的分析层。请在评论区分享您的反馈<strong class="lb iu"> </strong>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2746" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">参考文献/好读物</h1><ul class=""><li id="eddd" class="mv mw it lb b lc mx lf my li mz lm na lq nb lu nc nd ne nf bi translated">贵族法典</li><li id="a363" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">约翰·桑德尔</li><li id="d686" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated"><a class="ae ky" href="https://davedelong.com/blog/2017/12/07/misusing-enums/" rel="noopener ugc nofollow" target="_blank">戴维德龙</a></li><li id="cc07" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">伯努瓦·帕斯奎尔</li><li id="fdfd" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated"><a class="ae ky" href="https://matt.diephouse.com/2017/12/when-not-to-use-an-enum/" rel="noopener ugc nofollow" target="_blank">马特迪夫斯</a></li></ul></div></div>    
</body>
</html>