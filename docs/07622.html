<html>
<head>
<title>Integrating WidgetKit in Existing SwiftUI Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将WidgetKit集成到现有SwiftUI应用中</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/integrating-widgetkit-in-existing-swiftui-apps-ff285faa2896?source=collection_archive---------11-----------------------#2021-02-02">https://betterprogramming.pub/integrating-widgetkit-in-existing-swiftui-apps-ff285faa2896?source=collection_archive---------11-----------------------#2021-02-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="68ce" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">向您的iOS 14应用程序添加令人敬畏的小部件</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e15e95ce0e95bb256579bfaebf63d21b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dMj3IuwbxKaikSJs"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">米格尔·托马斯在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="405d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我知道我去派对迟到了😅。你可能听说过<code class="fe ls lt lu lv b">iOS 14</code>中的小部件及其使用案例。我已经开始开发一个个人使用的应用程序，使用<code class="fe ls lt lu lv b">SwiftUI</code>来跟踪我的锻炼进度。我已经开始把它作为学习，后来我增加了更多的功能，因为我每天都在使用这个应用程序。</p><p id="9e53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我每周检查我的锻炼总结，看看我花了多少时间，特别是身体的哪些部位。这是锻炼总结小部件的屏幕:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/de39aa009e129489aa95418a28a5e3c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*tD9C0a1ZVTkIY_xCxYOC1Q.png"/></div></figure><p id="5f72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">苹果在<code class="fe ls lt lu lv b">WWDC20</code>中引入了<code class="fe ls lt lu lv b">WidgetKit</code>，这引起了我的注意，所以我在我的应用程序的待办事项列表中添加了小部件支持。有很多文章从头开始支持SwiftUI应用程序，但很少有人支持使用核心数据支持和实时数据迁移现有应用程序。</p><p id="6512" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们开始吧，看看用Widget支持更新您现有的应用程序需要哪些步骤。我使用<code class="fe ls lt lu lv b">CoreData</code>作为我的本地存储。</p><ol class=""><li id="ab30" class="lx ly iq ky b kz la lc ld lf lz lj ma ln mb lr mc md me mf bi translated">添加应用程序组</li><li id="dac9" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">将CoreData迁移到共享位置</li><li id="f03e" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">从Widget中的共享容器访问CoreData</li></ol></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="bd67" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">添加<code class="fe ls lt lu lv b">App Group</code> s</h1><p id="e0d5" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">默认情况下，保存在<code class="fe ls lt lu lv b">CoreData</code>或<code class="fe ls lt lu lv b">UserDefaults</code>中的所有数据只能在<code class="fe ls lt lu lv b">host app</code>上访问，这意味着您的<code class="fe ls lt lu lv b">main app</code>。您的微件将无法访问您的主机应用程序保存的数据。</p><p id="ba9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您需要将数据保存在一个共享位置，以使数据可以被<code class="fe ls lt lu lv b">Main app</code>和<code class="fe ls lt lu lv b">app extension</code>(在我们的例子中是<code class="fe ls lt lu lv b">Widget</code>)访问。你需要在苹果开发者门户配置<code class="fe ls lt lu lv b">App Group</code>来创建一个共享容器。</p><p id="c693" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">按照以下步骤配置共享容器:</p><ol class=""><li id="0afb" class="lx ly iq ky b kz la lc ld lf lz lj ma ln mb lr mc md me mf bi translated">登录您的Apple开发者帐户</li><li id="105e" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">从侧面菜单中选择<code class="fe ls lt lu lv b">Certificates, Identifiers &amp; Profiles</code></li><li id="7f8d" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">从侧面菜单中选择<code class="fe ls lt lu lv b">Identifiers</code></li><li id="d18f" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">点击加号(<strong class="ky ir"> + </strong>)按钮，从列表中选择<code class="fe ls lt lu lv b">App Groups</code></li><li id="0dc5" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">提供您的组标识符和描述</li><li id="1578" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">点击<code class="fe ls lt lu lv b">Continue</code>然后点击<code class="fe ls lt lu lv b">Register</code></li></ol><p id="ba49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你的应用组Id现已准备就绪。下一步:将你的应用组ID链接到你的应用ID。</p><ol class=""><li id="91b7" class="lx ly iq ky b kz la lc ld lf lz lj ma ln mb lr mc md me mf bi translated">从可用应用id列表中选择您的<code class="fe ls lt lu lv b">App ID</code></li><li id="104f" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">在功能列表中选择<code class="fe ls lt lu lv b">App Groups</code></li><li id="4d00" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">勾选<code class="fe ls lt lu lv b">App Groups</code>并点击后，<code class="fe ls lt lu lv b">Configure</code>按钮将被激活。</li><li id="75de" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">从应用组列表中选择新创建的<code class="fe ls lt lu lv b">App Group ID</code>，点击<code class="fe ls lt lu lv b">Continue</code></li><li id="879d" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">点击<code class="fe ls lt lu lv b">Save</code></li><li id="beca" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">阅读警报中的消息，并点击<code class="fe ls lt lu lv b">Confirm</code>。基本上，在添加/删除应用Id的任何功能后，您需要创建一个新的临时配置文件。</li></ol><p id="d6fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回到Xcode，并添加新的应用程序群组功能。在两个目标上选择新创建的应用程序组ID—您的<code class="fe ls lt lu lv b">Main App</code>和<code class="fe ls lt lu lv b">Widget</code>。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="be13" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">将CoreData迁移到共享容器</h1><p id="a090" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">我已经创建了自定义逻辑来将我的本地<code class="fe ls lt lu lv b">CoreData</code>文件迁移到共享容器，如下所示。我在<code class="fe ls lt lu lv b">UserDefaults</code>中维护了一个bool来检查数据库是否已经被迁移到一个共享容器中，并且只有在它还没有被迁移时才继续。下面的代码应该是不言自明的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">核心数据迁移逻辑</p></figure></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="4b7e" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">从小部件中的共享容器访问CoreData</h1><p id="9fd0" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">您应该能够使用以下代码访问现有的核心数据文件和小部件中的现有数据:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">从小部件访问核心数据</p></figure><p id="b53e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:确保所有必需的文件都共享到您的小部件以及目标成员中。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="64a3" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">结论</h1><p id="3748" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">小部件是简略内容的正确选择。明智地将它与CoreData等其他强大的框架结合使用。</p><p id="72a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">谢谢👨🏻‍💻</p></div></div>    
</body>
</html>