<html>
<head>
<title>Subscriptions, Receipts, and StoreKit in iOS 14</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 14中的订阅、收据和商店工具包</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/subscriptions-receipts-and-storekit-in-ios-14-16194eb93963?source=collection_archive---------6-----------------------#2020-09-17">https://betterprogramming.pub/subscriptions-receipts-and-storekit-in-ios-14-16194eb93963?source=collection_archive---------6-----------------------#2020-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e356" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">应用内购买和订阅的黄金标准</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dfa4d7891ba6dcc142dd12cbff45e1a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BWYXB7LHuDCUF0tu"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安迪·马克里在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b9ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在所有获取应用开发报酬的方式中，目前最好的方式是订阅。在本文中，我希望了解WWDC2019演讲中概述的最佳实践，并将其与WWDC2020演讲中关于订阅架构的相同主题的演讲联系起来。当然，我将用一个代码示例来结束我的讨论。</p><p id="86a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但首先，介绍一下背景。十多年来，整个IT应用行业一直朝着订阅的方向发展。亚马逊是2006年首批拥有AWS的公司之一。微软和苹果在2011年推出了产品:Office 365和iCloud。甚至Adobe也在2013年加入了这个派对，他们的创意套件上线了。</p><p id="a39c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是黄金标准，因为这是一份稳定的收入——它有助于克服道路上的颠簸。当然，一些行业已经这样做了几十年，仅举两个例子，电信和出版。因此，一门完整的科学围绕着它成长起来。让我们仔细看看。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4453" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">吸引订户</h1><p id="8ca0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">订阅和其他应用内购买可以使用这三种经典途径中的一种或多种进行销售。</p><ul class=""><li id="783e" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">当他们第一次发布你的应用时，有了<strong class="lb iu">入职体验</strong></li><li id="d62b" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">使用<strong class="lb iu">免费增值模式</strong>，提供减少的功能，但可以选择更新为应用内订阅</li><li id="cb27" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">通过采用<strong class="lb iu">计量付费墙方法，</strong>让他们仅在一段时间内使用全部功能</li></ul><p id="701d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是等等——比这更好——甚至在下载你的应用程序之前，假设我们说的是订阅，你实际上可以开始在应用程序商店上推广它们。</p><h2 id="76c4" class="nn md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">订阅-优惠类型</h2><p id="033e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">有三种类型的订阅可以出售:介绍性优惠，促销优惠，以及iOS 14下的优惠代码。</p><p id="cb74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，如果有意义的话，你可以同时提供这三个。这个取自开发者网页的表格比较和对比了不同的类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/9ddf9fffade90a747c68c2300a4bbef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tkAsW7DDN_jTcUmzdVadUQ.png"/></div></div></figure><h2 id="3642" class="nn md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">保留订户</h2><p id="a715" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">赢得公众的心之后，你的下一个挑战是确保他们继续订阅——这个挑战实际上在订阅者中有自己的术语:<em class="oa">流失。你根本不想让你的用户流失。虽然我说这话听起来有些不祥，但你希望他们永远订阅。</em></p><p id="d281" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在WWDC2019关于这个主题的演示中，他们谈到了不少于六种让客户着迷的方法，他们展示了这个图标来说明他们的观点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/6860328c03a5ad7c7e96e82aeabb6957.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aBdp_V1ZT5c-yRLeMPZFYA.png"/></div></div></figure><p id="3cb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些都是什么意思？让我们试着快速浏览一遍。</p><p id="c351" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">赢回</strong></p><p id="f1e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是客户在订阅过期前取消订阅的地方。如果是这种情况，那么你可以/应该试着找出他们取消的原因。原因是什么，事实上，试着用一个提议把他们赢回来。</p><p id="e80e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">滞留</strong></p><p id="b9e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是客户将订阅的自动续订从<em class="oa">真</em>更改为<em class="oa">假的地方。在这种情况下，你需要努力找出问题所在，并再次尝试通过自动续订让他们改变主意。</em></p><p id="c8d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">保存优惠</strong></p><p id="d330" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是你有充分理由认为客户可能流失的地方。这是一个很好的平衡，但是你想留住客户，并向他们提供优惠，以防止他们离开。</p><p id="77a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">升级/降级</strong></p><p id="1774" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你想要更多的钱，让他们升级。向他们提供升级优惠。</p><p id="440a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">客户服务</strong></p><p id="97c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是客户抱怨服务质量下降的地方。这一损失可能会诱使他们退订。为了防止这一事件，给他们一个橄榄枝，以弥补他们的损失。</p><p id="de55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">忠诚</strong></p><p id="074b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，客户会一次又一次地续订，这是一种你想要奖励的行为。给他们一个忠诚的提议，鼓励他们继续回来。</p><p id="4bca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这在理论上看起来和听起来都很棒，但是我们如何将这些点连接起来呢？在WWDC2020演示文稿中，他们将这些优惠与您的订阅在其旅程中所处的位置联系起来，您可以通过收到他们的当前订阅状态来更仔细地了解这一旅程。</p><p id="c003" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过下载最近的收据，你就可以知道如何定制你需要的报价来留住那个订户。以下是从苹果文档中摘录的清单，列出了上述收据中所有错误的含义。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/e5cad3e206fe8fd7b045dd001f172901.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*utMabLRoYYq4o7FBFjjH1g.png"/></div></div></figure><p id="4eb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看我刚刚从我的演示应用程序下载的一张真正的收据——一张我分成两部分发布的收据，因为那里有很多。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/50ecd8ec48cc475089a4c88552ee17df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sr7BKyrlCeMtLp9r_Q5A_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">订阅详细信息</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/ddf5b15184db604b478f509ef9b8ac74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rSn2rkiaUtPTjSL1SE2mYg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">订阅详情续</p></figure><p id="95f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个JSON数组，数组中的每一项都是一个可以单独寻址的对象。让我们看看如何将它与我所说的规则匹配起来——将这些点连接起来。</p><p id="ec39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于<code class="fe oe of og oh b">pending_renewal_info</code>。当前设置为<code class="fe oe of og oh b">1</code>或<code class="fe oe of og oh b">true</code>。现在，如果在他们使用你的应用程序的某个时候，这变成了<code class="fe oe of og oh b">false</code>，那么这将是一个提供保留的好时机。</p><p id="4bed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">花些时间浏览一下收据，看看你是否能找出隐藏在里面的更多潜在的订阅机会。</p><p id="dac9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>因为我们在这里使用的是沙盒，购买和到期日期是相同的——在我们的例子中，每月订阅只持续五分钟(有利于测试)。</p><p id="7bbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这让我不得不结束这篇文章——当然，除了代码。首先是<code class="fe oe of og oh b">IAPManager</code>类的完整代码。第一部分是我们将在SwiftUI类中使用的可观察对象，而第二部分是<code class="fe oe of og oh b">IAPManager</code>模板方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="7212" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我结合上面的<code class="fe oe of og oh b">IAPManager.swift</code>文件创建的简单IAP订阅演示应用程序的SwiftUI类。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="0e00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我离开之前，不要忘记为了让这个工作，你必须使用iTunes Connect创建你的可购买产品；否则，它什么也找不到，你也看不到它的行动。</p><p id="2363" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">鉴于你现在也可以在本地测试应用内购买，我希望这能和本地验证一起工作；不幸的是，这一次我没有这样做，但请注意这里。</p><p id="582e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你运行这个程序时，最初什么也不会发生。点击“门票”选项卡，提示它查找可用的应用内购买项目，然后点击列表中应该会出现的您想要购买的项目之一。</p><p id="5760" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保持冷静，继续编码。</p></div></div>    
</body>
</html>