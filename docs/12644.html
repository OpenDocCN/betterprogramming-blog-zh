<html>
<head>
<title>10 JavaScript Promise Challenges Before You Start an Interview</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始面试前的10个JavaScript承诺挑战</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/10-javascript-promise-challenges-before-you-start-an-interview-c9af8d4144ec?source=collection_archive---------0-----------------------#2022-06-20">https://betterprogramming.pub/10-javascript-promise-challenges-before-you-start-an-interview-c9af8d4144ec?source=collection_archive---------0-----------------------#2022-06-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8fa6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用图表解释</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/063a29f7b14f93997d3685ab7dac19f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cZb0UsY8CFe6Jrm4Ghh64w.png"/></div></div></figure><p id="c028" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">承诺是JavaScript异步编程的关键特性。不管你是爱它还是恨它，你都得理解它。</p><p id="6673" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里我提供了10个关于承诺的代码挑战，从基础到高级。您应该猜猜这些代码片段的输出。</p><p id="22e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你准备好了吗？挑战者们！</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="8c8a" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">挑战1:承诺构建者</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="673c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码的输出是什么？</p><h2 id="edd7" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">分析</h2><p id="7664" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">第一个挑战非常简单。</p><p id="776a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们知道:</p><ul class=""><li id="570c" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nn no np nq bi translated">同步代码块总是从上到下顺序执行。</li><li id="4d42" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">当我们调用<code class="fe nw nx ny nz b">new Promise(callback)</code>时，回调函数会立即执行。</li></ul><h2 id="09f3" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">结果</h2><p id="8c04" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">所以这段代码是要依次输出<code class="fe nw nx ny nz b">start</code>、<code class="fe nw nx ny nz b">1</code>、<code class="fe nw nx ny nz b">end</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa mq l"/></div></figure><h1 id="2917" class="lx ly it bd lz ma ob mc md me oc mg mh jz od ka mj kc oe kd ml kf of kg mn mo bi translated">挑战2:。然后()</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="805c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码的输出是什么？</p><h2 id="1c8e" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">分析</h2><p id="63aa" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">在这个代码片段中，出现了一段异步代码。也就是<code class="fe nw nx ny nz b">.then()</code>中的回调函数。</p><p id="9c0e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">记住，JavaScript引擎总是先执行同步代码，然后执行异步代码。</p><p id="015d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">遇到这个问题，我们只需要区分同步代码和异步代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/980a79f837b041dfc455af8b4d590ae3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0mMDthvSXF7yHx5h1ZshLg.png"/></div></div></figure><h2 id="6877" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">结果</h2><p id="10b5" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">所以输出是<code class="fe nw nx ny nz b">start</code>、<code class="fe nw nx ny nz b">1</code>、<code class="fe nw nx ny nz b">end</code>和<code class="fe nw nx ny nz b">2</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa mq l"/></div></figure><h1 id="6dc4" class="lx ly it bd lz ma ob mc md me oc mg mh jz od ka mj kc oe kd ml kf of kg mn mo bi translated">挑战3:解决()</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="8fe1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码的输出是什么？</p><h2 id="1f39" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">分析</h2><p id="1920" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">这段代码和前面的代码几乎一样；唯一不同的是<code class="fe nw nx ny nz b">resolve(2)</code>后面有一个<code class="fe nw nx ny nz b">console.log(3)</code>。</p><p id="7e49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请记住，resolve方法不会中断函数的执行。其背后的代码仍将继续执行。</p><h2 id="467f" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">结果</h2><p id="4c27" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">所以输出结果是<code class="fe nw nx ny nz b">start</code>、<code class="fe nw nx ny nz b">1</code>、<code class="fe nw nx ny nz b">3</code>、<code class="fe nw nx ny nz b">end</code>和<code class="fe nw nx ny nz b">2</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa mq l"/></div></figure><p id="8a8c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因为我遇到过一些认为<code class="fe nw nx ny nz b">resolve</code>会中断函数执行的家伙，所以我在这里强调一下。</p><h1 id="9a10" class="lx ly it bd lz ma ob mc md me oc mg mh jz od ka mj kc oe kd ml kf of kg mn mo bi translated">挑战4:未调用resolve()</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="79e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码的输出是什么？</p><h2 id="0263" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">分析</h2><p id="83b3" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">在这段代码中，resolve方法从未被调用过，所以<code class="fe nw nx ny nz b">promise1</code>总是处于挂起状态。所以<code class="fe nw nx ny nz b">promise1.then(…)</code>从来没有执行过。<code class="fe nw nx ny nz b">2</code>不在控制台中打印出来。</p><h2 id="6319" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">结果</h2><p id="f06c" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">所以输出结果是<code class="fe nw nx ny nz b">start</code>、<code class="fe nw nx ny nz b">1</code>、<code class="fe nw nx ny nz b">end</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa mq l"/></div></figure><h1 id="4244" class="lx ly it bd lz ma ob mc md me oc mg mh jz od ka mj kc oe kd ml kf of kg mn mo bi translated">挑战5:让你困惑的问题</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="6196" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码的输出是什么？</p><h2 id="798d" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">分析</h2><p id="f15e" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">这段代码故意增加了一个函数来迷惑挑战者，那就是<code class="fe nw nx ny nz b">fn</code>。</p><p id="daf9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是请记住，无论函数调用有多少层，我们的基本原则都是一样的:</p><ul class=""><li id="d64a" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nn no np nq bi translated">首先执行同步代码，然后执行异步代码</li><li id="ff82" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">同步代码按照它被调用的顺序执行</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/5d959df017df587389a7ded039106341.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TVEM_IMgQ0gPQ5_ZaM7i2A.png"/></div></div></figure><h2 id="dd36" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">结果</h2><p id="685c" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">所以输出结果是<code class="fe nw nx ny nz b">start</code>、<code class="fe nw nx ny nz b">middle</code>、<code class="fe nw nx ny nz b">1</code>、<code class="fe nw nx ny nz b">end</code>和<code class="fe nw nx ny nz b">success</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa mq l"/></div></figure><h1 id="52f0" class="lx ly it bd lz ma ob mc md me oc mg mh jz od ka mj kc oe kd ml kf of kg mn mo bi translated">挑战6:有实现承诺的人</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="2692" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码的输出是什么？</p><h2 id="36be" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">分析</h2><p id="dbb8" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">这里<code class="fe nw nx ny nz b">Promise.resolve(1)</code>会返回一个状态为<code class="fe nw nx ny nz b">fulfilled</code>结果为<code class="fe nw nx ny nz b">1</code>的Promise对象。它是同步代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/3d88d17a54cfa16c977381cea8c374a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8aQBbwPRKz4iQ8ZF_VUvnQ.png"/></div></div></figure><p id="ddd7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以输出结果是<code class="fe nw nx ny nz b">start</code>、<code class="fe nw nx ny nz b">end</code>、<code class="fe nw nx ny nz b">1</code>和<code class="fe nw nx ny nz b">2</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa mq l"/></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="e898" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好的，你觉得这些挑战容易吗？</p><p id="9959" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其实这些只是开胃菜。承诺的难处在于，它是随着<code class="fe nw nx ny nz b">setTimeout</code>出现的。接下来，我们的挑战将更加艰难。</p><p id="3573" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你准备好了吗？挑战者们！</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="d63c" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">挑战7:超时与承诺</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="1a9b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码的输出是什么？</p><h2 id="a134" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">分析</h2><p id="7c1b" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">注意了！</p><p id="f1e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一个很难的问题。如果你能正确回答这个问题并解释原因，那么你对JavaScript异步编程的理解已经达到了中级水平。</p><p id="523d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在解释这个问题之前，我们先讨论一下相关的理论基础。</p><p id="6bfd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们之前说过同步代码是按照调用的顺序执行的，那么这些异步回调函数是按照什么顺序执行的呢？</p><p id="4c2f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有人可能会说，谁先完成，谁就先执行。嗯，这是真的，但是如果两个异步任务同时完成呢？</p><p id="1926" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">比如上面的代码中，<code class="fe nw nx ny nz b">setTimeout</code>的定时器是0秒，<code class="fe nw nx ny nz b">Promise.resolve()</code>也会在执行后立即返回一个兑现的承诺对象。</p><p id="0304" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">两个异步任务都是立即完成的，那么先执行谁的回调函数呢？</p><p id="d543" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有的学弟可能会说<code class="fe nw nx ny nz b">setTimeout</code>在前面，先打印<code class="fe nw nx ny nz b">setTimeout</code>，再打印<code class="fe nw nx ny nz b">resolve</code>。其实这种说法是错误的。</p><p id="8d62" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们知道很多事情是按照先入先出的顺序<strong class="kw iu">而不是</strong>执行的，比如流量。</p><h2 id="4c1c" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">优先</h2><p id="23a5" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">我们通常将车辆分为两类:</p><ul class=""><li id="1d6c" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nn no np nq bi translated">普通车辆</li><li id="ba72" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">执行紧急任务的车辆。例如消防车和救护车。</li></ul><p id="b7c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过拥挤的路口时，我们会让消防车和救护车先行通过。急救车辆比其他车辆有更多的<strong class="kw iu">优先权</strong>。关键词:<strong class="kw iu">优先级</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/3a1247e99f0f0b16d670ccc744dbe0cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*43i0XV59iTPfUFWwo8AAGA.png"/></div></div></figure><p id="f2ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在JavaScript EventLoop中，还有优先级的概念。</p><ul class=""><li id="208f" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nn no np nq bi translated">优先级较高的任务称为微任务。包括:<code class="fe nw nx ny nz b">Promise</code>、<code class="fe nw nx ny nz b">ObjectObserver</code>、<code class="fe nw nx ny nz b">MutationObserver</code>、<code class="fe nw nx ny nz b">process.nextTick</code>、<code class="fe nw nx ny nz b">async/await</code>。</li><li id="b45b" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">优先级较低的任务称为宏任务。包括:<code class="fe nw nx ny nz b">setTimeout</code>、<code class="fe nw nx ny nz b">setInterval</code>和<code class="fe nw nx ny nz b">XHR</code>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/fb740e28516da1a96aac2e68be385d20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMRcVbR_143zDOpom915ig.png"/></div></div></figure><p id="25c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然<code class="fe nw nx ny nz b">setTimeout</code>和<code class="fe nw nx ny nz b">Promise.resolve()</code>是同时完成的，甚至<code class="fe nw nx ny nz b">setTimeout</code>的代码还在前面，但是因为它的优先级低，属于它的回调函数执行的比较晚。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/2d51bff1d30e6171416d56436cd23f6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YHWb2J8ENZteAaNNcL2H7g.png"/></div></div></figure><h2 id="826c" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">结果</h2><p id="f16f" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">所以输出结果是<code class="fe nw nx ny nz b">start</code>、<code class="fe nw nx ny nz b">end</code>、<code class="fe nw nx ny nz b">resolve</code>和<code class="fe nw nx ny nz b">setTimeout</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa mq l"/></div></figure><h1 id="d9e9" class="lx ly it bd lz ma ob mc md me oc mg mh jz od ka mj kc oe kd ml kf of kg mn mo bi translated">挑战8:微任务混合宏任务</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="dadb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码的输出是什么？</p><h2 id="fbf5" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">分析</h2><p id="666a" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">如果您已经理解了前面的代码挑战，那么这个挑战很容易完成。</p><p id="1290" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们只需要做三步:</p><ol class=""><li id="c5b2" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp om no np nq bi translated">找到同步代码。</li><li id="e4ec" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">找到微任务代码</li><li id="9edb" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">找到宏任务代码</li></ol><p id="39c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，执行同步代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/23420ea9790edd61bf869b375f0dda52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W9XjtG52Na3sZbz7n9XRCw.png"/></div></div></figure><p id="861b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">输出<code class="fe nw nx ny nz b">1</code>、<code class="fe nw nx ny nz b">2</code>和<code class="fe nw nx ny nz b">4</code>。</p><p id="a38d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后执行微任务:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/fd0c4345d86e4f078cdcfc7b463218a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZVbY5J0J5Gq8C3vHFHvGQ.png"/></div></div></figure><p id="04b0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是这里有一个陷阱:由于当前的承诺仍然处于<strong class="kw iu"> pending </strong>状态，这里的代码目前不会被执行。</p><p id="3869" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后执行宏任务:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/079c8b122e7f809879fd692317bca37c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gY5rs_5o8L23ovi0JCStnA.png"/></div></div></figure><p id="8ee6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">并且<code class="fe nw nx ny nz b">promise</code>的状态变为<code class="fe nw nx ny nz b">fulfilled</code>。</p><p id="b9ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，通过事件循环，再次执行微任务:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/a2291effa373b2a881254bb74c4f6d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CXmdTAc4LwHIQVhH5LUznA.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa mq l"/></div></figure><h1 id="fe52" class="lx ly it bd lz ma ob mc md me oc mg mh jz od ka mj kc oe kd ml kf of kg mn mo bi translated">挑战9:区分微任务和宏任务的优先级</h1><p id="c772" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">在我们介绍微任务和宏任务之间的优先级之前，我们先来看看微任务和宏任务交替执行的情况。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="40a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码的输出是什么？</p><h2 id="3b97" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">分析</h2><p id="f3f5" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">有些朋友可能认为微任务和宏任务是这样执行的:</p><ol class=""><li id="4fd3" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp om no np nq bi translated">首先执行所有微任务</li><li id="25df" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">执行所有宏任务</li><li id="321b" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">再次执行所有微任务</li><li id="ab19" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">循环通过</li></ol><p id="300c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是上面的说法是<strong class="kw iu">错</strong>。</p><p id="1ed8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正确的理解是:</p><ol class=""><li id="9bf8" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp om no np nq bi translated">首先执行所有微任务</li><li id="183c" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">执行一个宏任务</li><li id="2c1b" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">再次执行所有(新添加的)微任务</li><li id="f9e2" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">执行下一个宏任务</li><li id="a548" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">循环通过</li></ol><p id="30eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/2f31548780bff8133624cbc4f6977b95.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*tJ4LUGY6hnKSJncfKU7sWQ.png"/></div></figure><p id="f1e4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">或者像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/78b33c1454b8ff0c6be5fdcd8550add7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*da7emQrbNEy_nUdvzL33Xw.png"/></div></div></figure><p id="627a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以在上面的代码中，<code class="fe nw nx ny nz b">Promise.then</code>的回调函数会在第二个<code class="fe nw nx ny nz b">setTimeout</code>的回调函数之前执行，因为是微任务，已经插队了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/dada72588f3921452c5bc88d3605c7ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o6b50DO-gdpUyBuNhTVQGA.png"/></div></div></figure><h2 id="908d" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">结果</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/b57d7b9a47eec1e309682482650d82a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RtX4fOQ71D-OLRpiJ3L1nQ.png"/></div></div></figure><h1 id="d744" class="lx ly it bd lz ma ob mc md me oc mg mh jz od ka mj kc oe kd ml kf of kg mn mo bi translated">挑战10:典型的面试问题</h1><p id="e0f8" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">这是我们最后的挑战。如果你能正确说出这段代码的输出，那么你对Promise的理解已经很强了。而且同类型的面试问题不会对你有任何困扰。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="c6b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码的输出是什么？</p><h2 id="0608" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">分析</h2><p id="c6f3" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">这个挑战是上一个挑战的升级版，但核心原理不变。</p><p id="dfeb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">记住我们之前学到的内容:</p><ol class=""><li id="fce8" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp om no np nq bi translated">同步代码</li><li id="8d7a" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">所有微任务</li><li id="e28b" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">第一个宏任务</li><li id="0a1a" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">所有新添加的微任务</li><li id="4228" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">下一个宏任务</li><li id="07db" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi">…</li></ol><p id="2733" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以:</p><ol class=""><li id="8720" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp om no np nq bi translated">执行所有同步代码:</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/f300c8611d1de712acaa4057cd0173cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2d3TM4Qf0PneCdTBGhwzWw.png"/></div></div></figure><p id="e784" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">2.执行所有微任务</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/45993d9a99f6d46c6b5982d82995f94a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZOK4FnMFdrVjxcoyOWg4qg.png"/></div></div></figure><p id="66a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">3.执行第一个宏任务</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/66e3516447a551584707fec1bcbda9f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HNNM36RkmNgIpw5Z6j4oIQ.png"/></div></div></figure><p id="705f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:在这一步中，宏任务向任务队列添加一个新的微任务。</p><p id="461d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">4.执行所有新添加的微任务</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/08ed3b9fe21342fcb380cd0210a6d489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MzBgl55v9of-zwpT1iOQ_w.png"/></div></div></figure><p id="5fcd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">5.执行下一个宏任务</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/ac99ab2fc723d3642a4f11531dbaed99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4DbC4rZPiRfMAapWtdzqkA.png"/></div></div></figure><h2 id="76a5" class="mr ly it bd lz ms mt dn md mu mv dp mh ld mw mx mj lh my mz ml ll na nb mn nc bi translated">结果</h2><p id="84b6" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">所以输出是这样的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa mq l"/></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="f3c2" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">结论</h1><p id="fc2a" class="pw-post-body-paragraph ku kv it kw b kx nd ju kz la ne jx lc ld nf lf lg lh ng lj lk ll nh ln lo lp im bi translated">对于所有类似的问题，你只需要记住三条规则:</p><ol class=""><li id="5cc4" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp om no np nq bi translated">JavaScript引擎总是先执行同步代码，然后执行异步代码。</li><li id="d934" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp om no np nq bi translated">微任务比宏任务具有更高的优先级。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/fb740e28516da1a96aac2e68be385d20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMRcVbR_143zDOpom915ig.png"/></div></div></figure><p id="5faf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">3.微任务可以在事件循环中插入行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/03a9b518bfae88b3add1c0798a81136a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*j_PEz-OV2lZRoQ5GXeJtmg.png"/></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><ul class=""><li id="5bfa" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nn no np nq bi translated"><a class="ae ov" href="https://medium.com/frontend-canteen/you-can-master-async-await-with-7-diagrams-ac96a97abe92" rel="noopener">你可以用7张图掌握异步/等待</a></li><li id="31c4" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated"><a class="ae ov" href="https://medium.com/frontend-canteen/10-code-challenges-to-master-promise-then-and-promise-catch-3da2bdea1d97" rel="noopener">掌握Promise.then和Promise.catch的10个代码挑战</a></li><li id="189b" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated"><a class="ae ov" rel="noopener ugc nofollow" target="_blank" href="/10-javascript-closure-challenges-explained-with-diagrams-c964110805e7">用图表解释10个JavaScript闭包挑战</a></li></ul><div class="ow ox gp gr oy"><div role="button" tabindex="0" class="ab bv gv cb fp oz pa bn pb ks ex"><div class="pc l"><div class="ab q"><div class="l di"><img alt="bytefish" class="l de bw pd pe fe" src="../Images/743f175620c9b16012604fb316b07c94.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*XYGoKrb1w5zdWZLOIEevZg.png"/><div class="fb bw l pd pe fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://bytefish.medium.com/?source=post_page-----c9af8d4144ec--------------------------------" rel="noopener follow" target="_top">字节鱼</a></p></div></div><div class="ph pi gw l"><h2 class="bd iu uo ni fp up fr fs uq fu fw is bi translated">代码挑战</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi ur au us ut uu rc uv an eh ei uw ux uy el em eo de bk ep" href="https://bytefish.medium.com/list/code-chanllenge-0b76b6b40281?source=post_page-----c9af8d4144ec--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="uz l fo"><span class="bd b dl z dk">6 stories</span></div></div></div><div class="pu dh pv fp ab pw fo di"><div class="di pm bv pn po"><div class="dh l"><img alt="" class="dh" src="../Images/ce8c30dad1da5ea7c909f23934f6d155.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*Y2xYjpFhfBZE1KU7KwQZCQ.png"/></div></div><div class="di pm bv pp pq pr"><div class="dh l"><img alt="" class="dh" src="../Images/8145bdfa6b9e6e337f7e29dedbc214da.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*MwzhMcgh0temRk4B5jbIyQ.png"/></div></div><div class="di bv ps pt pr"><div class="dh l"><img alt="" class="dh" src="../Images/8bc4ef15a3276489d08617dc5abf26bb.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*SuMJFAftgtgWgwQIOYSjZQ.png"/></div></div></div></div></div></div></div>    
</body>
</html>