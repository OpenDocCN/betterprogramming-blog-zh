<html>
<head>
<title>What is Change Detection in Angular?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是角度变化检测？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/change-detection-in-angular-6fb68ca19c95?source=collection_archive---------4-----------------------#2019-10-09">https://betterprogramming.pub/change-detection-in-angular-6fb68ca19c95?source=collection_archive---------4-----------------------#2019-10-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1d6d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">变化检测是Angular在应用程序或组件的状态发生变化时决定执行何种操作的策略</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/7df56b36a6cd36c338c25a257030cc7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*fOCwqmZ_9TFPEpNCxcnFYw.png"/></div></figure><p id="be24" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">组件状态的改变可以由用户交互触发，如点击按钮、改变输入值或HTTP请求等。</p><p id="d123" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">例如，如果我们有一个组件如下…</p><pre class="kg kh ki kj gt lj lk ll lm aw ln bi"><span id="12f1" class="lo lp iq lk b gy lq lr l ls lt">import { Component } from "@angular/core";</span><span id="dca3" class="lo lp iq lk b gy lu lr l ls lt">@Component({</span><span id="1a2b" class="lo lp iq lk b gy lu lr l ls lt">selector: "app-root",</span><span id="211d" class="lo lp iq lk b gy lu lr l ls lt">template: `Title: {{title}}</span><span id="3a0e" class="lo lp iq lk b gy lu lr l ls lt">&lt;button (click)="changeTitle()"&gt;Change title&lt;/button&gt;`,</span><span id="b5dd" class="lo lp iq lk b gy lu lr l ls lt">styleUrls: ["./app.component.css"]</span><span id="6a13" class="lo lp iq lk b gy lu lr l ls lt">})</span><span id="e76d" class="lo lp iq lk b gy lu lr l ls lt">export class AppComponent {</span><span id="204a" class="lo lp iq lk b gy lu lr l ls lt">title = "CodeSandbox";</span><span id="8779" class="lo lp iq lk b gy lu lr l ls lt">changeTitle(){</span><span id="fd94" class="lo lp iq lk b gy lu lr l ls lt">this.title = "I am the new title."</span><span id="50d2" class="lo lp iq lk b gy lu lr l ls lt">}</span><span id="9941" class="lo lp iq lk b gy lu lr l ls lt">}</span></pre><p id="9430" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">…我们可以看到，当用户通过单击Change Title <strong class="kp ir"> </strong>按钮与应用程序交互时，组件的Title属性被更改。</p><p id="9bd8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">Angular中的每个组件都配有一个变化检测器<strong class="kp ir"> </strong>，用于跟踪状态的变化。</p><p id="11b7" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">众所周知，Angular应用程序是一个组件树。因此，对于树中的每个组件，我们都有一个在应用程序启动时创建的相关变更检测器。</p><p id="5a58" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">所以我们最终得到了一个变化检测器树。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/e71e8d49cdfb8394bb9594a8f2b93e8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*mNoAmeD2y2Ur3Ve4zGNADA.png"/></div></figure><p id="fa2a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">当其中一个组件的状态发生变化时，无论它在树中的什么位置，都会触发整个树的变化检测过程。发生这种情况是因为Angular扫描从顶部组件节点开始的变化，一直到树的底部叶子。</p><p id="f9b2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">因此，随着应用程序规模的增加，这种检查可能会导致性能下降。但是我们有办法定制变化检测策略。</p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h1 id="701b" class="mc lp iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">优化变更检测策略</h1><p id="3747" class="pw-post-body-paragraph kn ko iq kp b kq mt jr ks kt mu ju kv kw mv ky kz la mw lc ld le mx lg lh li ij bi translated">一种优化的方法是告诉Angular，只有当组件的输入发生变化时，才在组件上运行变化检测。</p><p id="aadd" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，如果我们想让这个组件只在它的输入属性改变时才改变，我们只需要通过将它的<code class="fe my mz na lk b">changeDetection</code>属性设置为<code class="fe my mz na lk b">ChangeDetectionStrategy.OnPush</code>来改变变化检测策略。</p><p id="8459" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe my mz na lk b">changeDetection</code>属性的默认值是<code class="fe my mz na lk b">ChangeDetectionStrategy.Default</code>。</p><p id="d7bf" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在下面的组件中，我们将组件装饰器的<code class="fe my mz na lk b">changeDetection</code>属性改为<code class="fe my mz na lk b">ChangeDetectionStrategy.OnPush</code>。</p><pre class="kg kh ki kj gt lj lk ll lm aw ln bi"><span id="a79f" class="lo lp iq lk b gy lq lr l ls lt">import { <strong class="lk ir">Component</strong>, <strong class="lk ir">Input</strong>, <strong class="lk ir">ChangeDetectionStrategy </strong>} from "@angular/core";</span><span id="9b6b" class="lo lp iq lk b gy lu lr l ls lt">import { <strong class="lk ir">IAlert </strong>} from "./alert.model";</span><span id="3eca" class="lo lp iq lk b gy lu lr l ls lt">@<strong class="lk ir">Component</strong>({<br/><strong class="lk ir"><em class="nb">selector</em></strong><em class="nb">:</em> "app-alert",<br/><strong class="lk ir"><em class="nb">template</em></strong>: `&lt;div class="alert" [ngClass]="alert.type"&gt;{{ alert.message }}&lt;/div&gt;`,<br/><strong class="lk ir"><em class="nb">styles</em></strong>:[<br/>`.alert{<br/>position: relative;<br/>padding: .75rem 1.25rem;<br/>margin-bottom: 1rem;<br/>border: 1px solid transparent;<br/>border-radius: .25rem;<br/>},</span><span id="7c8b" class="lo lp iq lk b gy lu lr l ls lt">.success {<br/>color: #155724;<br/>background-color: #d4edda;<br/>border-color: #c3e6cb;<br/>},</span><span id="065b" class="lo lp iq lk b gy lu lr l ls lt">.error {<br/>color: #721c24;<br/>background-color: #f8d7da;<br/>border-color: #f5c6cb;<br/>}`],</span><span id="308e" class="lo lp iq lk b gy lu lr l ls lt"><strong class="lk ir"><em class="nb">changeDetection</em></strong>: ChangeDetectionStrategy.OnPush<br/>})</span><span id="c656" class="lo lp iq lk b gy lu lr l ls lt">export class <strong class="lk ir">AlertComponent </strong>{<br/>@Input() alert: IAlert;<br/>}</span><span id="a23c" class="lo lp iq lk b gy lu lr l ls lt">export interface IAlert {<br/>type: string;<br/>message: string;<br/>}</span></pre><p id="e0b6" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">将<code class="fe my mz na lk b">changeDetection</code>更改为<code class="fe my mz na lk b">ChangeDetectionStrategy.OnPush</code>时，仅当该组件的一个输入属性发生变化时，才会运行变化检测周期。更改树的其他组件不会触发该组件的更改检测器。</p><p id="f9c5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">注:</strong> Angular使用<code class="fe my mz na lk b">Zone.js library</code> <strong class="kp ir"> </strong>检测变化并运行变化检测循环。</p><p id="1134" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在以下最常见的情况下，区域会自动告诉Angular发生了变化:</p><p id="ac39" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">发生DOM事件(例如，点击、更改等。)</p><p id="911f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">HTTP请求被解析</p><p id="5c4c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">定时器被触发(例如，设置超时、设置间隔)</p></div></div>    
</body>
</html>