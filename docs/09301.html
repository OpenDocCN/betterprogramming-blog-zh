<html>
<head>
<title>Exploring the Jetpack CameraX Library In Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索Android中的Jetpack CameraX库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/exploring-the-jetpack-camerax-library-in-android-26e4911f92d2?source=collection_archive---------6-----------------------#2021-08-09">https://betterprogramming.pub/exploring-the-jetpack-camerax-library-in-android-26e4911f92d2?source=collection_archive---------6-----------------------#2021-08-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="13be" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">集成&gt;相机预览&gt;图像捕捉</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/14d8d94e33ff2c19f8ba09c8ecef8c56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z-TkVUi7oy9Lm31I"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">罗伯特·舒涅夫在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="3186" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CameraX是一个Jetpack支持库，使Android开发人员可以轻松实现相机功能。有了CameraX库，我们不再需要为修复不同Android版本的问题而烦恼，我们也不必担心手动的生命周期管理。</p><p id="4c98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你是一名Android开发者，你会知道这有多重要。即使对于经验丰富的开发人员来说，处理Android版本的摄像头问题也无疑是一场噩梦。</p><p id="535d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CameraX带有用例的概念，为开发人员提供了一种专注于他们真正想要的东西的方式，而不是管理整个相机设置。您应该知道三个主要的使用案例:</p><ul class=""><li id="4bf0" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://developer.android.com/training/camerax/preview" rel="noopener ugc nofollow" target="_blank">预览</a>:在显示器上显示图像。</li><li id="9b10" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://developer.android.com/training/camerax/take-photo" rel="noopener ugc nofollow" target="_blank">图像拍摄</a>:拍摄并保存高质量图像。</li><li id="3459" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://developer.android.com/training/camerax/analyze" rel="noopener ugc nofollow" target="_blank">图像分析</a>:无缝访问算法中使用的缓冲区，例如传递到MLKit。</li></ul><p id="b9da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将关注第一个和第二个用例。第一个和第二个用例的组合将服务于90%的Android开发任务。所以，是时候编码了。</p><h1 id="e6e5" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">综合</h1><p id="2e94" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">本质上，我们需要集成三个库:camera-camera2、camera-lifecycle和camera-view。在应用程序级<code class="fe ng nh ni nj b">build.gradle</code>文件的依赖关系节点下添加以下几行。看看下面的代码:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="02fb" class="no mk it nj b gy np nq l nr ns">// CameraX core library using camera2 implementation<br/>implementation "androidx.camera:camera-camera2:1.0.1"</span><span id="6eee" class="no mk it nj b gy nt nq l nr ns">// CameraX Lifecycle Library<br/>implementation "androidx.camera:camera-lifecycle:1.0.1"</span><span id="ee74" class="no mk it nj b gy nt nq l nr ns">// CameraX View class<br/>implementation "androidx.camera:camera-view:1.0.0-alpha27"</span></pre><ul class=""><li id="c7bb" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">摄像头-摄像头2 — </strong>访问核心摄像头功能。</li><li id="b288" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">摄像机生命周期— </strong>使摄像机及其操作具有生命周期意识。</li><li id="a26d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">摄像机视图— </strong>将摄像机视图集成到布局文件中。</li></ul><h1 id="40f4" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">布局中的摄像机视图</h1><p id="2b72" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">首先，我们需要通过<code class="fe ng nh ni nj b">PreviewView</code>将摄像机视图添加到我们的布局中。<code class="fe ng nh ni nj b">PreviewView</code>是一个定制视图，显示CameraX用例的摄像机提要。看一下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="3f1c" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">处理权限</h1><p id="10c8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">要在应用程序中显示预览，我们需要在清单文件中添加CAMERA权限。为此，请在清单文件中的应用程序标记内添加以下行。看看下面的代码:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="73cc" class="no mk it nj b gy np nq l nr ns">&lt;uses-permission android:name="android.permission.CAMERA" /&gt;</span></pre><p id="dd87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们需要在运行时处理权限。每当用户启动应用程序时，我们需要检查摄像机的访问。如果我们有权限，我们将启动摄像头显示；如果没有，我们应该提示用户启用相机权限。看看下面的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="2e87" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">相机预览</h1><p id="3a96" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">现在我们有了相机访问，我们需要做的就是从CameraX实现一个预览用例。首先，我们需要创建实例<code class="fe ng nh ni nj b">ProcessCameraProvider</code>来将视图与活动/片段生命周期绑定。看一下代码:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="b6bb" class="no mk it nj b gy np nq l nr ns">val cameraProviderFuture = ProcessCameraProvider.getInstance(this)</span></pre><p id="ac2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们需要给<code class="fe ng nh ni nj b">cameraProviderFuture</code>添加一个监听器。它有两个参数— <code class="fe ng nh ni nj b">Runnable</code>和<code class="fe ng nh ni nj b">Executor</code>。看一下代码:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="82d9" class="no mk it nj b gy np nq l nr ns">cameraProviderFuture.addListener(<br/>    Runnable {}, <br/>    ContextCompat.getMainExecutor(this)<br/>)</span></pre><p id="bd15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一部分你会看到<code class="fe ng nh ni nj b">Runnable</code>的用法，而<code class="fe ng nh ni nj b"><a class="ae ky" href="https://developer.android.com/reference/kotlin/androidx/core/content/ContextCompat" rel="noopener ugc nofollow" target="_blank">ContextCompat</a>.getMainExecutor()</code>作为第二个参数。这将返回一个在主线程上运行的<code class="fe ng nh ni nj b"><a class="ae ky" href="https://developer.android.com/reference/java/util/concurrent/Executor" rel="noopener ugc nofollow" target="_blank">Executor</a></code>。</p><p id="c395" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们进入<code class="fe ng nh ni nj b">Runnable</code>。首先需要加上<code class="fe ng nh ni nj b">ProcessCameraProvider</code>；它将相机的生命周期与<code class="fe ng nh ni nj b">LifecycleOwner</code>绑定在一起。然后，我们需要创建一个预览对象，在布局中将表面链接到取景器，并指定要使用的默认相机。</p><p id="2fe5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，在try/catch块中，我们需要从<code class="fe ng nh ni nj b">cameraProvider</code>中解除所有绑定，然后绑定我们创建的<code class="fe ng nh ni nj b">cameraSelector</code>和<code class="fe ng nh ni nj b">preview</code>对象。看一下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="f071" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已！我们已经完成了预览用例。现在，如果您运行应用程序并允许摄像头访问，您应该能够看到摄像头视图。</p><h1 id="bbbc" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">图像捕捉</h1><p id="522c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">下一步是捕捉图像并将其保存在存储器中。首先，为了捕获图像，我们需要在Android组件中声明<code class="fe ng nh ni nj b">ImageCapture</code>。看看下面的代码:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="8014" class="no mk it nj b gy np nq l nr ns">private var imageCapture: ImageCapture? = null</span></pre><p id="a37f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们需要在<code class="fe ng nh ni nj b">startCamera</code>函数内部初始化它，并将其作为第三个参数添加到<code class="fe ng nh ni nj b">cameraProvider</code>中。代码如下:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="58c5" class="no mk it nj b gy np nq l nr ns">imageCapture = ImageCapture.Builder()<br/>        .build()</span><span id="7727" class="no mk it nj b gy nt nq l nr ns">cameraProvider.bindToLifecycle(<br/>        this, cameraSelector, preview, imageCapture)</span></pre><p id="5ea9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了捕捉图像，接下来我们需要定义一个保存图像的位置。看一下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="8d75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们使用<code class="fe ng nh ni nj b">imageCapture</code>实例来获得可修改的图像捕获用例的稳定引用。然后生成一个空文件来保存捕获的图像。最后，我们使用<code class="fe ng nh ni nj b">takePicture</code>函数捕获图像并保存。看一下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="b298" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击捕获按钮时调用此函数。</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><p id="72e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们把它们放在一起时，请看下面的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="3189" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">结论</h1><p id="b0fa" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这里有一个GitHub示例。请随意使用<code class="fe ng nh ni nj b">feature/image_capture</code>分支中的代码。</p><div class="od oe gp gr of og"><a href="https://github.com/SG-K/CameraXSample" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">GitHub - SG-K/CameraXSample</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">在GitHub上创建一个帐户，为SG-K/CameraXSample的开发做出贡献。</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">github.com</p></div></div><div class="op l"><div class="oq l or os ot op ou ks og"/></div></div></a></div><p id="791d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近看到了<a class="ae ky" href="https://medium.com/u/d255c4fc9d76?source=post_page-----4c9f44d04e68--------------------------------" rel="noopener">萨提亚·帕万·坎塔马尼</a>发表的这篇关于在安卓系统中渲染PDF的优秀文章，强烈推荐:</p><div class="od oe gp gr of og"><a href="https://medium.com/android-dev-hacks/rendering-pdf-documents-in-android-using-pdfrenderer-f6d4f730b18" rel="noopener follow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">使用PdfRenderer在Android中呈现PDF文档</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">如何使用Android PdfRenderer</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">medium.com</p></div></div><div class="op l"><div class="ov l or os ot op ou ks og"/></div></div></a></div><p id="b9a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前就这些。希望你学到了有用的东西。</p><p id="0908" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p></div></div>    
</body>
</html>