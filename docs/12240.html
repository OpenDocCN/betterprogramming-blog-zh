<html>
<head>
<title>Spring Boot and OpenFeign — Communication Between Microservices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Boot和open feign——微服务之间的通信</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/spring-internal-micro-service-driven-communication-d75ab2c7363a?source=collection_archive---------1-----------------------#2022-05-21">https://betterprogramming.pub/spring-internal-micro-service-driven-communication-d75ab2c7363a?source=collection_archive---------1-----------------------#2022-05-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8235" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Spring内部微服务驱动的通信</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e82012dfd980a018ec2a1ede4932f135.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j7zQS3KZnvwcXavdyrIffg.png"/></div></div></figure><p id="4f38" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在解决方案架构阶段，特别是当我们谈论微服务时，我们需要某种内部数据交换。有很多工具可以做到这一点，比如Spring rest template和web client，但是我使用的是我认为其中最简单的一个:是的，OpenFeign！</p><h1 id="e003" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">正在安装OpenFeign</h1><p id="efd8" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">首先，我们添加OpenFeign依赖项(在<code class="fe mk ml mm mn b">pom.xml</code>文件中)，因此它将由Maven(我们的依赖项管理器)导入。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="2599" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正如你已经注意到的，我们正在使用一个属于Spring cloud项目的工具，因此，我们需要设置我们正在使用的Spring cloud版本。在properties标记中，我们将添加java和spring cloud版本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="01dd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请注意，我使用的是Spring boot版本<code class="fe mk ml mm mn b">2.6.1</code> <br/>另外，请注意，我将使用以前文章中的<a class="ae mq" href="https://github.com/xrio/spring-boot-movies-api" rel="noopener ugc nofollow" target="_blank">电影项目</a>。</p><p id="8b92" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在拥有了所有需要的依赖项之后，我们仍然需要声明我们的应用程序在某个包中使用了OpenFeign。</p><p id="7a38" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们用带有目标包的<code class="fe mk ml mm mn b">@EnableFeignClients</code>来装饰我们的主类，该目标包将拥有虚拟客户端。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h1 id="4628" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">OpenFeign客户端实现</h1><p id="793d" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">在实现中，我将向JSON占位符API(充当第二个微服务)发送一个简单的get请求，以使用OpenFeign获得帖子列表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/03b5770aaef17a3eb9e476748750c00f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fpEmQzLEZjx_D2BR.png"/></div></div></figure><h2 id="a41e" class="ms lo iq bd lp mt mu dn lt mv mw dp lx la mx my lz le mz na mb li nb nc md nd bi translated">定义我们的DTO</h2><p id="f257" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">为了利用Spring Boot提供的JSON/POJO自动转换，我们将使用一个DTO来操作接收/发送的数据(posts)。<br/>在<code class="fe mk ml mm mn b">controller &gt; dto</code>包中，我们创建了<code class="fe mk ml mm mn b">PostDTO.java</code>文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="fe42" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意，DTO的结构是由JSON占位符API的响应定义的。</p><p id="a6d4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我们创建我们的post客户端(feign client)，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="a187" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mk ml mm mn b">@FeignClient</code>将把这个接口声明为一个伪客户端，以便根据我们的需要来实现。</p><p id="1872" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这种情况下,<code class="fe mk ml mm mn b">name</code>属性基本上没有用，因为我们不是用名称来寻址API，而是使用它的URL。在集成命名注册中心时使用这个名称(未来的文章正在撰写中)。</p><p id="6f1b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就像魔术一样，这就是我们客户的全部！</p><p id="67f7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们需要调用我们的客户端，并将响应返回给我们的用户。我们将创建一个<code class="fe mk ml mm mn b">PostController</code>来完成这个任务:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="a8a7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，这就是调用这个<code class="fe mk ml mm mn b">PostController</code>方法的结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/bc24abf301d2f2dd3e19b2cb6bcd63ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bWndYWFXGsInK8qc.png"/></div></div></figure><p id="693e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢阅读。</p></div></div>    
</body>
</html>