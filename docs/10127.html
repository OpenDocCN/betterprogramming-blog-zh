<html>
<head>
<title>5 Crucial Developer Tweaks For New M1 Macs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新M1 MAC电脑的5个关键开发调整</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/5-crucial-developer-tweaks-for-new-m1-macs-a77c9990a985?source=collection_archive---------2-----------------------#2021-12-02">https://betterprogramming.pub/5-crucial-developer-tweaks-for-new-m1-macs-a77c9990a985?source=collection_archive---------2-----------------------#2021-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ba4c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">新的定制芯片，新的开发人员工作流程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b099cff500079fbc77651a88740ad5fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yt92Mjs_eapW671XKdskIw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Dmitry Chernyshov 在<a class="ae ky" href="https://unsplash.com/s/photos/mac?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="0d83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那些新的M1 MacBook专业版很闪亮，对吗？它们装载了大量新功能和效率改进。他们绕着上一代机器跑了一圈，并向<a class="ae ky" href="https://towardsdatascience.com/m1-macbook-pro-vs-intel-i9-macbook-pro-ultimate-data-science-comparison-dde8fc32b5df" rel="noopener" target="_blank">展示了一些令人印象深刻的性能数据</a>(感谢基准测试的<a class="lv lw ep" href="https://medium.com/u/689ba04bb8be?source=post_page-----a77c9990a985--------------------------------" rel="noopener" target="_blank">达里奥·拉德契奇</a>)。</p><p id="7413" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">房间里的大象呢？架构改变了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lx"><img src="../Images/0e5a6b98b96c6dc40ccf2b9be06f47cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lrqvEROodlEk6sAGMNJZow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://apple.com" rel="noopener ugc nofollow" target="_blank">来源</a>。</p></figure><p id="7891" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">M1芯片是基于ARM的，这意味着你将不再生活在x86-64的世界里。这对您将要运行的一些应用程序有影响。尤其是如果您正在编译、构建图像或使用尚未针对M1发布的应用程序。</p><p id="2888" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将了解一些重要的调整、应用程序的安装，以及将现有工作流集成到新平台的一般技巧。</p><h1 id="9b78" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">1.为了兼容性，使用Rosetta 2</h1><p id="d4f6" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ms lk ll lm mt lo lp lq mu ls lt lu im bi translated">这是你在新Mac上需要做的第一件事。Rosetta 2是一个兼容层，它将允许与M1不兼容的应用程序在一个特殊的层内运行，模仿旧的英特尔x86–64平台并动态翻译指令。</p><p id="c5d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你已经尝试安装一个非M1兼容的应用程序，那么macOS可能会提示你安装Rosetta。如果您还没有这样做，并且希望尽早解决这个问题，请运行以下命令:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="a8d9" class="na lz it mw b gy nb nc l nd ne">/usr/sbin/softwareupdate --install-rosetta --agree-to-license</span></pre><p id="4227" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于Rosetta 2的更多信息可以在苹果官方支持网站上获得<a class="ae ky" href="https://support.apple.com/en-us/HT211861" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="dac3" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">2.带拱门的开关自制平台</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/85c545f56cb21a11e6da7af080fbec7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*RULmp1_oJUW7VDO-1N6a5g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">来源</a>。</p></figure><p id="6b7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个人都知道并且(大部分)喜欢的经典Brew应用程序确实可以在M1 MAC上开箱即用，但你可能需要对某些软件包进行一些调整。为了在不同的架构下安装软件包，您需要使用<code class="fe ng nh ni mw b">arch</code>命令来切换它:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="ed97" class="na lz it mw b gy nb nc l nd ne">arch -x86_64 brew config</span></pre><p id="3166" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您运行下面的命令，您会注意到它说它运行在<code class="fe ng nh ni mw b">x86_64</code>架构下并使用Rosetta 2兼容层。当你安装Brew时，默认情况下它应该在<code class="fe ng nh ni mw b">arm64</code>下本地运行，但是如果你需要安装一个<code class="fe ng nh ni mw b">x86_64</code>版本的包，你需要利用<code class="fe ng nh ni mw b">arch</code>并为不同的平台设置Brew。</p><p id="bd88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你还没有在Mac上安装x86_64版本的Brew，你可以按照<a class="lv lw ep" href="https://medium.com/u/a262a804b78f?source=post_page-----a77c9990a985--------------------------------" rel="noopener" target="_blank"> Shinichi Okada </a>的指南:<a class="ae ky" href="https://medium.com/mkdir-awesome/how-to-install-x86-64-homebrew-packages-on-apple-m1-macbook-54ba295230f" rel="noopener"> <em class="nj">如何在苹果M1 MacBook上安装x86_64自制软件包</em> </a>。</p><p id="17dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦安装了Brew两个版本，只需发出以下命令，就可以正常地将Brew用于本机软件包:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="744e" class="na lz it mw b gy nb nc l nd ne">brew install &lt;pkg&gt;</span></pre><p id="9895" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe ng nh ni mw b">x86_64</code>包，您可以发布:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="277e" class="na lz it mw b gy nb nc l nd ne">arch -x86_64 brew install &lt;pkg&gt;</span></pre><p id="3bf9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以将上面的Brew命令别名为类似于<code class="fe ng nh ni mw b">ibrew</code>或<code class="fe ng nh ni mw b">xbrew</code>的东西，以使事情稍微简单一些。</p><h1 id="0791" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">3.使用Docker Builder构建x86_64映像</h1><p id="d207" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ms lk ll lm mt lo lp lq mu ls lt lu im bi translated">如果你和我一样，那么当切换到M1时，你完全忽略了Docker工作流程中的任何初始差异。在完成一个新项目并推出我闪亮的新形象后，我只注意到错误。</p><p id="7d3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">试图在x86_64主机上运行我在Mac上构建的映像只会导致彻底的灾难。</p><p id="ceb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查完图像本身后，问题就摆在我面前。我曾为<code class="fe ng nh ni mw b">arm64</code>建造过。因为我的M1机器是基于ARM的，它不再默认使用<code class="fe ng nh ni mw b">amd64</code>架构构建映像。简单地构建和推动的日子已经一去不复返了，现在你需要Docker BuildKit的一点额外帮助。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/e1a037a8234c90493a5693721600a3d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pfBvqNXaWJ2bszkG.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.docker.com/company/newsroom/media-resources" rel="noopener ugc nofollow" target="_blank">来源</a>。</p></figure><p id="0056" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使用<code class="fe ng nh ni mw b">BuildKit</code>,你需要确保你运行的是Docker的最新版本，然后你需要启动一个特殊的新“builder”实例:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="884c" class="na lz it mw b gy nb nc l nd ne">docker buildx create --name my_builder<br/>docker buildx use my_builder<br/>docker buildx inspect --bootstrap</span></pre><p id="089e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在您的机器上启动一个新的容器，使您能够构建多种不同的架构。</p><p id="5dfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们有一辆全新的<code class="fe ng nh ni mw b">Dockerfile</code>，我们想为老款<code class="fe ng nh ni mw b">amd64</code>打造它。我们需要做的就是告诉我们的构建器实例来处理构建它，以及我们想要什么样的架构:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="fecf" class="na lz it mw b gy nb nc l nd ne">docker buildx build --platform linux/amd64 -t &lt;tag&gt; --load .</span></pre><p id="da52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦图像构建完成，它将出现在你指定的标签下的普通图像列表中(这就是<code class="fe ng nh ni mw b">--load</code>所做的)。现在，您可以像任何其他本地构建的映像一样，将映像推送到注册表中。</p><p id="988f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢<a class="lv lw ep" href="https://medium.com/u/c08522ea46a9?source=post_page-----a77c9990a985--------------------------------" rel="noopener" target="_blank">乔恩·沃格尔</a>的精彩指导:<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-actually-deploy-docker-images-built-on-a-m1-macs-with-apple-silicon-a35e39318e97"> <em class="nj">如何在M1 MAC电脑上部署基于苹果芯片</em> </a> <em class="nj">的Docker映像。</em></p><h1 id="4d8b" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">4.使用更多M1就绪应用以获得更好的性能</h1><p id="51b9" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ms lk ll lm mt lo lp lq mu ls lt lu im bi translated">在紧要关头或者当你绝对需要做一些不支持M1的事情时，在Rosetta 2下运行应用程序是很好的。但是你会注意到一个相当不错的性能。没有什么比天生跑步更好的了。尤其是在像M1这样的巨型处理器上。</p><p id="bcc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">苹果公司有一些资源可以找到M1本地应用，但我目前为止找到的最好的地方是:<a class="ae ky" href="https://isapplesiliconready.com/" rel="noopener ugc nofollow" target="_blank">https://isapplesiliconready.com/</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/b5e14f8520f80b2ccf8bf5f333698e0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*99ItlQzKkpxAncJuVy4RYg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://isapplesiliconready.com/" rel="noopener ugc nofollow" target="_blank">来源</a>。</p></figure><p id="7571" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个网站会告诉你一个特定的应用程序是否有完全的M1支持，只有Rosetta 2或者干脆不工作。如果你想在你的Mac上安装尽可能多的原生应用，这一点尤其有用。</p><h1 id="fa1e" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">5.将虚拟机从x86_64迁移到ARM</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/1e8c750e52ad2283ee109b71cfc5ad3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9pB4L2UnjpW2GmLsIH0n6Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.parallels.com/about/brand-assets/" rel="noopener ugc nofollow" target="_blank">来源</a>。</p></figure><p id="472e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在你的新Mac上使用任何虚拟机，那么你将会有另一个惊喜。根据<a class="ae ky" href="https://kb.parallels.com/125343" rel="noopener ugc nofollow" target="_blank"> Parallels文档</a>:</p><blockquote class="nn no np"><p id="b15d" class="kz la nj lb b lc ld ju le lf lg jx lh nq lj lk ll nr ln lo lp ns lr ls lt lu im bi translated">“…在基于英特尔的Mac上创建的虚拟机不能在采用M1芯片的Mac上使用，反之亦然。”</p></blockquote><p id="2e9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着，如果您有一个现有的x86_64虚拟机库，它们将需要迁移到新的基于ARM的版本。这意味着在您的M1上重新旋转它们，并将磁盘内容移植过来。您可以在下面的<a class="ae ky" href="https://kb.parallels.com/125344" rel="noopener ugc nofollow" target="_blank">支持文档</a>中找到如何使用Parallels完成此操作的分步指南。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="11ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读！如果您喜欢这篇文章，请不要忘记查看:</p><div class="oa ob gp gr oc od"><a rel="noopener  ugc nofollow" target="_blank" href="/6-developer-tools-for-mac-that-arent-ides-b1419ffec2c1"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">6个非ide的Mac开发工具</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">处理各种软件工程任务的专用应用程序</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">better编程. pub</p></div></div><div class="om l"><div class="on l oo op oq om or ks od"/></div></div></a></div></div></div>    
</body>
</html>