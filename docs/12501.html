<html>
<head>
<title>How to Run E2E Tests in Our CI/CD Pipeline?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在我们的CI/CD管道中运行E2E测试？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-run-e2e-tests-on-gitlab-381f79e90f57?source=collection_archive---------9-----------------------#2022-06-09">https://betterprogramming.pub/how-to-run-e2e-tests-on-gitlab-381f79e90f57?source=collection_archive---------9-----------------------#2022-06-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f0bc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">随着时间的推移，它会为您带来巨大的价值！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2dfb63b6fb5264931602db4561c4a881.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fe2CCtQZ7PrF70Wv"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">潘卡杰·帕特尔在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6fb0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我经常面临的问题。事实是，如果有人听说过测试金字塔，那么您可能会放弃运行端到端测试的想法。</p><p id="13a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你必须记住，与单元测试相比，编写这些测试要花费更多的时间，但是好处可能也是值得的。这不是关于你是否应该选择一种测试而不是另一种的讨论，所以让我们开始吧。</p><p id="5611" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想象一下:你已经决定，你想花时间创建你的第一个E2E测试。</p><p id="dd98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，您必须考虑您要测试的是什么，并创建一个可靠的E2E测试的大致概念。</p><h2 id="8f71" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">例子</h2><p id="dfdf" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在这个例子中，我们有一个库，我们的客户把它放在他们网站的head部分，然后我们的脚本在运行时执行。</p><p id="7778" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着我们的产品是为在浏览器中运行而构建的。</p><p id="4bdf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们将设置一个测试来实现这一点。</p><p id="950b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们想准确地模拟我们的脚本在野外是如何被使用的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/4665ba7b22367a780b33eb77de2f1216.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jbI9L-lhPntO6jYRqOyFUw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">基本CI/CD概述</p></figure><p id="fe94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我们的想法是:</p><ol class=""><li id="d9ce" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated">在Gitlab上启动网络服务器</li><li id="9e79" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">创建一些“接近”的网站示例(基本HTML)来模拟真实世界的使用。在这些虚拟HTML页面中，我们包含了我们的构建脚本</li><li id="83f2" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">断言行为是预期的</li></ol><p id="45da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了让这个工作，我们需要一些片段一起玩。</p><h2 id="250c" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">构建步骤</h2><p id="50a6" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">这一步很大程度上取决于你的应用。很可能您已经有了一个构建过程。</p><p id="031a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个命令将我们所有的JavaScript模块构建成一个包</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="040d" class="ls lt iq ng b gy nk nl l nm nn">"build": "esbuild src/index.js --bundle --outfile=lib/out.js --minify"</span></pre><p id="0370" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们指示Gitlab做的第一件事，因为输出文件是我们想要执行测试的文件。</p><h2 id="7527" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">网络服务器</h2><p id="6c9c" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">对于这一步，我使用一个标准的Express服务器来处理静态文件。web服务器的模板可能如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="b4b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个简单的express服务器，为构建步骤生成的文件(这是我们分发给客户的同一个文件)和放置在public文件夹中的任何其他文件提供服务。</p><h1 id="35d8" class="nq lt iq bd lu nr ns nt lx nu nv nw ma jw nx jx md jz ny ka mg kc nz kd mj oa bi translated">小丑/木偶师</h1><p id="7e1f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">由于我们的输出JavaScript包对DOM做了一些工作，所以我们使用Puppeteer来编排一个无头Chromium浏览器，以模拟真实用户如何访问站点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">E2E测试的一个例子</p></figure><h1 id="34a7" class="nq lt iq bd lu nr ns nt lx nu nv nw ma jw nx jx md jz ny ka mg kc nz kd mj oa bi translated">最后的想法</h1><p id="df76" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在我的项目中，我看到了这样一个事实，这条管道很早就被引入了——它意味着全世界。我可以很容易地创建HTML页面，模拟我们的客户的页面，并对这些页面进行测试。</p><p id="eb91" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">值得注意的是，在CI/CD管道中，Puppeteer相当慢，所以在设计测试时必须小心，以避免反馈回路太慢。</p><p id="1a60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您还应该确保在E2E测试之前运行任何单元测试，以便在出现关键问题时更快地失败。</p><p id="e045" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保持测试！</p></div></div>    
</body>
</html>