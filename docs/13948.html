<html>
<head>
<title>Returning CSV Content From an API in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Node.js中的API返回CSV内容</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/returning-csv-content-from-an-api-in-node-js-3dafe19208e5?source=collection_archive---------3-----------------------#2022-10-18">https://betterprogramming.pub/returning-csv-content-from-an-api-in-node-js-3dafe19208e5?source=collection_archive---------3-----------------------#2022-10-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d5ea" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">传输内容的简要指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f73219f103be59ed76a164e3263fde41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*n-yHOEtl0KRHhq-x"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@silvawebdesigns?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">内森·达席尔瓦</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="b30c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一些系统和平台允许您从CSV ( <a class="ae ky" href="https://en.wikipedia.org/wiki/Comma-separated_values" rel="noopener ugc nofollow" target="_blank">逗号分隔值</a>)文件导入数据。这是因为CSV是最流行的人类可读格式之一，尤其是在数据科学方面。</p><p id="508c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常的情况是，将API或查询返回的数据转换成有效的CSV文件。这涉及样板代码或手工工作。幸运的是，你可以避免这一切。</p><p id="32e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为您可以直接使用Node.js生成CSV作为输出，允许用户下载一个CSV文件。这是一个自动化且更实用的解决方案。</p><p id="f419" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们学习如何构建一个API来返回Node.js中的CSV内容。</p><h1 id="4e64" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">先决条件</h1><p id="67b0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您不需要任何额外的库来将CSV内容返回到Express服务器。同时，您可以采用<code class="fe ms mt mu mv b">csv-generate</code> npm库来简化CSV的生成。</p><p id="117a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用以下命令安装<code class="fe ms mt mu mv b">csv-generate</code>:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="24e0" class="na lw it mv b gy nb nc l nd ne">npm instal csv-generate</span></pre><p id="c0a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这不是必需的；在这里，您将看到如何在Node.js中生成和返回CSV内容，而无需额外的依赖。</p><h1 id="8d6a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">构建在Node.js中返回CSV文件的API</h1><p id="a05f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><code class="fe ms mt mu mv b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type" rel="noopener ugc nofollow" target="_blank">Content-Type</a></code> HTTP头用于指定返回内容的<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Glossary/MIME_type" rel="noopener ugc nofollow" target="_blank">媒体类型</a>。如这里的<a class="ae ky" href="https://tools.ietf.org/html/rfc7111" rel="noopener ugc nofollow" target="_blank">所述</a>，返回CSV的HTTP请求的推荐媒体类型是<code class="fe ms mt mu mv b">text/csv</code>。</p><p id="39d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，您可以使用<code class="fe ms mt mu mv b">Content-Disposition</code> HTTP头来指定API返回的内容是应该下载并保存在本地的附件。</p><p id="2c39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以在Node.js中设置这两个HTTP头，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="c719" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<code class="fe ms mt mu mv b">&lt;YOUR_FILE_NAME&gt;</code>替换为API返回的CSV文件的名称。</p><p id="b3b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还要记住，CSV文件通常非常不同。您可能需要使用不同的分隔符、引号、转义字符、行分隔符、编码等来生成文件。注意<code class="fe ms mt mu mv b">csv-generate</code>允许您自定义CSV文件的输出格式。</p><p id="9029" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们看看在Node.js中返回CSV内容的API是什么样子的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="ded0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简单起见，用于生成CSV内容的数据是硬编码的。通过执行查询或调用API，您可以在现实场景中生成这些数据。</p><p id="a269" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，<code class="fe ms mt mu mv b">csvData</code>字符串变量用CSV头初始化。这不是强制性的，取决于您希望输出的内容是什么样子。此外，这里生成的CSV内容使用分隔符“，”分隔符，但任何其他有效的分隔符也可以。</p><p id="7196" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，<code class="fe ms mt mu mv b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join" rel="noopener ugc nofollow" target="_blank">join()</a></code> JavaScript函数会自动将<code class="fe ms mt mu mv b">null</code>和<code class="fe ms mt mu mv b">undefined</code>值转换为<code class="fe ms mt mu mv b">""</code>空字符串。这正是<code class="fe ms mt mu mv b">null</code>或缺失内容以CSV格式表示的方式。</p><p id="5907" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，调用<code class="fe ms mt mu mv b">/users/getCSV</code> API，您将获得以下内容:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="beac" class="na lw it mv b gy nb nc l nd ne">name,surname,age<br/>Patricia,Smith,<br/>John,,56<br/>Maria,Brown,37</span></pre><p id="6ddc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，API生成的输出是有效的CSV内容。在浏览器中调用时，会自动下载<code class="fe ms mt mu mv b">users.csv</code>文件。</p><p id="ed19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊！您刚刚学习了如何在Node.js中返回CSV内容。</p><h1 id="4cab" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="7b73" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">从API返回CSV内容比检索所需的数据然后将其转换成所需的输出要高效得多。您可以使用Node.js直接返回一个CSV文件。</p><p id="58cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！我希望这篇文章对你有所帮助。请随意留下任何问题、评论或建议。</p></div></div>    
</body>
</html>