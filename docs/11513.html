<html>
<head>
<title>How to Implement a Dark Mode Switch in Your Web Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在你的网络应用中实现黑暗模式切换</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/implementing-a-dark-mode-switch-62d1a2883416?source=collection_archive---------2-----------------------#2022-03-27">https://betterprogramming.pub/implementing-a-dark-mode-switch-62d1a2883416?source=collection_archive---------2-----------------------#2022-03-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4ac0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为您的web应用程序添加配色方案响应</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8e186564cd3070a6831284b91303a6db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*veWClFZeGjcnWvdT"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@caleb_woods?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯勒·伍兹</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3ed7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在过去的几年里，深色模式(又名a l <a class="ae ky" href="https://en.wikipedia.org/wiki/Light-on-dark_color_scheme" rel="noopener ugc nofollow" target="_blank">深色配色方案</a>)变得非常流行。可以说，它对眼睛和电池来说更容易,<a class="ae ky" href="https://www.popsci.com/night-dark-mode-design/" rel="noopener ugc nofollow" target="_blank">它受所有主要桌面和移动设备操作系统的支持。</a></p><p id="2f91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示如何让您的web应用程序在操作系统级别响应用户选择的配色方案，以及添加一个配色方案开关，通过将用户的选择保存在浏览器的本地存储中来记住它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="143a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">目录</h1><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="2246" class="mz md it mv b gy na nb l nc nd">· <a class="ae ky" href="#9f2f" rel="noopener ugc nofollow">prefers-color-scheme</a><br/>  ∘ <a class="ae ky" href="#565c" rel="noopener ugc nofollow">Pro-tip</a><br/>· <a class="ae ky" href="#dccc" rel="noopener ugc nofollow">Dark mode switch</a><br/>· <a class="ae ky" href="#bd0e" rel="noopener ugc nofollow">Remembering user’s choice</a><br/>· <a class="ae ky" href="#e61c" rel="noopener ugc nofollow">Further Reading</a></span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9f2f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">首选颜色方案</h1><p id="ddf4" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">正如我们使用<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries#Media_features" rel="noopener ugc nofollow" target="_blank"> CSS媒体查询</a>使我们的web应用程序对<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/width" rel="noopener ugc nofollow" target="_blank">屏幕分辨率</a>做出响应一样，我们也可以使用媒体查询来增加对<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme" rel="noopener ugc nofollow" target="_blank">用户偏好的配色方案</a>的响应。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="5852" class="mz md it mv b gy na nb l nc nd">body { <br/>  background: white; color: black;<br/>}</span><span id="a370" class="mz md it mv b gy nj nb l nc nd">@media (prefers-color-scheme: light) {<br/>  body { <br/>    background: white; color: black;<br/>  }<br/>}</span><span id="c1e5" class="mz md it mv b gy nj nb l nc nd">@media (prefers-color-scheme: dark) {<br/>  body {<br/>    background: black; color: white;<br/>  }<br/>}</span></pre><p id="34a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在下面的代码沙箱中看到它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="565c" class="mz md it bd me nm nn dn mi no np dp mm li nq nr mo lm ns nt mq lq nu nv ms nw bi translated">亲tip</h2><p id="2baf" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">出于测试的目的，你可以通过Chrome开发者工具强制设置值为<code class="fe nx ny nz mv b">light</code>或<code class="fe nx ny nz mv b">dark</code>。</p><p id="1f39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开DevTools (F12)，按shift+cmd/ctrl+P运行命令，键入prefers，然后选择一个选项:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/bccc9f09e2101bfc7efad6fdf9177394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5eJs27JNXUoE3NzEsMzF2w.png"/></div></div></figure><p id="c8d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你也可以通过点击右边的三个垂直点找到这些选项，然后点击更多工具&gt;渲染。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/4e9da131f9bae66ffbf59bc2047e2945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2gtFwZzo-LNNUUFUyXGBYQ.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dccc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">黑暗模式开关</h1><p id="13c4" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">为了允许用户切换黑暗模式，而不管他们的<a class="ae ky" href="https://web.dev/prefers-color-scheme/#activating-dark-mode-in-the-operating-system" rel="noopener ugc nofollow" target="_blank">操作系统偏好</a>，我们将需要使用一些Javascript。<br/>我们首先将<code class="fe nx ny nz mv b">data-color-scheme</code> <a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Howto/Use_data_attributes" rel="noopener ugc nofollow" target="_blank">数据属性</a>添加到<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/documentElement" rel="noopener ugc nofollow" target="_blank">根元素</a>中。当页面第一次加载时，该值将根据系统首选项进行设置。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="ccb0" class="mz md it mv b gy na nb l nc nd">const getPreferredColorScheme = () =&gt; {<br/>  const darkQuery = "(prefers-color-scheme: dark)";<br/>  const darkMQL = window.matchMedia ? window.matchMedia(darkQuery) : {};<br/>  if (darkMQL.media === darkQuery &amp;&amp; darkMQL.matches) {<br/>   return "dark";<br/>  }</span><span id="ddc0" class="mz md it mv b gy nj nb l nc nd">  return "default";<br/>};</span><span id="453b" class="mz md it mv b gy nj nb l nc nd">document.documentElement.setAttribute("data-color-scheme", getPreferredColorScheme());</span></pre><p id="9a30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将添加一组变量，这些变量将根据这个数据属性进行更改。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="8198" class="mz md it mv b gy na nb l nc nd">:root {<br/>  --color-text: #191924;<br/>  --color-background: #fff;<br/>}</span><span id="9734" class="mz md it mv b gy nj nb l nc nd">:root[data-color-scheme="dark"] {<br/>  --color-text: #fff;<br/>  --color-background: #0d202d;<br/>}</span><span id="53bd" class="mz md it mv b gy nj nb l nc nd">body {<br/>  color: var(--color-text);<br/>  background-color: var(--color-background);<br/>}</span></pre><p id="bd24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，对于开关，在HTML中添加一个按钮:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="9a86" class="mz md it mv b gy na nb l nc nd">&lt;button id="button"&gt;Toggle Dark Mode&lt;/button&gt;</span></pre><p id="dc3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和一个单击事件处理程序:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="3b64" class="mz md it mv b gy na nb l nc nd">document.getElementById("button").onclick = () =&gt; {<br/>  const colorScheme = document.documentElement.getAttribute("data-color-scheme");</span><span id="7775" class="mz md it mv b gy nj nb l nc nd">  document.documentElement.setAttribute("data-color-scheme", colorScheme === "default" ? "dark" : "default");<br/>};</span></pre><p id="0e0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在这里观看现场演示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="bd0e" class="mc md it bd me mf oc mh mi mj od ml mm jz oe ka mo kc of kd mq kf og kg ms mt bi translated">记住用户的选择</h1><p id="f84b" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">您会注意到，如果页面被重新加载，data-attribute的值会被重置。为了记住用户对配色方案的选择，我们将使用<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener ugc nofollow" target="_blank">本地存储</a>来保存数据属性值。</p><p id="c75c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当页面加载时，我们需要检查是否有我们可以使用的值:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="e3d0" class="mz md it mv b gy na nb l nc nd">const colorScheme = <strong class="mv iu">localStorage.getItem("color-scheme") || </strong>getPreferredColorScheme();</span><span id="ad71" class="mz md it mv b gy nj nb l nc nd">document.documentElement.setAttribute("data-color-scheme", colorScheme);</span></pre><p id="cc83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而且，我们需要在使用开关时保存新值:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="9c9b" class="mz md it mv b gy na nb l nc nd">document.getElementById("button").onclick = () =&gt; {<br/>  const colorScheme = document.documentElement.getAttribute("data-color-scheme");</span><span id="6dab" class="mz md it mv b gy nj nb l nc nd">  const newColorScheme = colorScheme === "default" ? "dark" : "default";</span><span id="8fc6" class="mz md it mv b gy nj nb l nc nd">  document.documentElement.setAttribute("data-color-scheme", newColorScheme);</span><span id="e0ee" class="mz md it mv b gy nj nb l nc nd">  <strong class="mv iu">localStorage.setItem("color-scheme", newColorScheme);</strong><br/>};</span></pre><p id="f52b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里查看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e61c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">进一步阅读</h1><p id="b38b" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">在实现黑暗模式时，你可以而且应该做的不仅仅是在黑暗背景上显示浅色文本。我建议看看这两篇文章:</p><div class="oh oi gp gr oj ok"><a href="https://medium.com/dev-channel/hello-darkness-my-old-friend-48a97ab4379a" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">你好，黑暗，我的老朋友</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">炒作过度还是必然？了解关于黑暗模式的一切，以及如何支持它以使您的用户受益！</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">medium.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy ks ok"/></div></div></a></div><div class="oh oi gp gr oj ok"><a href="https://medium.com/@mwichary/dark-theme-in-a-day-3518dde2955a" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">一天中的黑暗主题</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">使用一堆现代CSS来创建一个应用程序的夜间模式</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">medium.com</p></div></div><div class="ot l"><div class="oz l ov ow ox ot oy ks ok"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="dc97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。我希望你今天学到了新东西。保重，下次再见。</p></div></div>    
</body>
</html>