<html>
<head>
<title>Create a Simple Autocomplete With Elasticsearch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Elasticsearch创建简单的自动完成功能</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-simple-autocomplete-with-elasticsearch-852c47109deb?source=collection_archive---------2-----------------------#2020-09-30">https://betterprogramming.pub/create-a-simple-autocomplete-with-elasticsearch-852c47109deb?source=collection_archive---------2-----------------------#2020-09-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b653" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用文本字段数据类型和标准分析器通过Elasticsearch创建简单的自动完成功能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ef6e9e58808cc1ebd6ea7edae431687a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8gjVWWSC4rKXp1UP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Solen Feyissa 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="35ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自动完成是一种预测用户正在键入的单词的剩余部分的功能。这是一个需要实现的重要特性，它可以改善用户对产品的体验。</p><p id="6a58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您从未创建过自动完成功能，那么一开始创建它可能会令人望而生畏。但是借助<a class="ae ky" href="https://www.elastic.co/elasticsearch/" rel="noopener ugc nofollow" target="_blank"> Elasticsearch </a>中的功能，这其实是一件很简单的事情。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dd47" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">你应该知道的事情</h1><p id="8a24" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果你对Elasticsearch了解不多，建议你先看看我的其他文章。我们不要求这样，但是了解分析器和文本字段的工作方式肯定会帮助您理解本文。</p><p id="e1db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文章“<a class="ae ky" href="https://medium.com/swlh/basics-of-elasticsearch-for-developer-a23de84c4b6" rel="noopener">面向开发者的Elasticsearch基础知识</a>”<strong class="lb iu"/>将向您介绍Elasticsearch。文章“<a class="ae ky" href="https://medium.com/better-programming/elasticsearch-text-vs-keyword-2ccb99ec72ae" rel="noopener">Elasticsearch:Text vs . Keyword</a>”<strong class="lb iu"/>将教你Elasticsearch中文本和关键字的区别，也将解释elastic search的分析器是如何工作的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b61a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置</h1><h2 id="ce6d" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">创建索引</h2><p id="98da" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，让我们创建一个名为<code class="fe nl nm nn no b">autocomplete-example</code>的索引。我们将在本文的例子中使用这个索引。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><h2 id="0599" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">定义映射</h2><p id="eb5e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在索引文档之前，让我们首先定义一个映射。我们将只需要一个字段<code class="fe nl nm nn no b">simple_autocomplete</code>，字段数据类型为<code class="fe nl nm nn no b">text</code>，并将使用一个<code class="fe nl nm nn no b">standard</code>分析器。</p><p id="755f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为Elasticsearch默认使用<code class="fe nl nm nn no b">standard</code>分析器，所以我们不需要在映射中定义它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><h2 id="cc51" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">为文件编制索引</h2><p id="d41c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们给一份文件编个索引。对于本文中的示例，我们只需要一个包含文本“香港”的文档。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1619" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用匹配查询查询索引</h1><p id="a8a9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">先说我们平时用的查询，<code class="fe nl nm nn no b">match</code>查询。</p><p id="12bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在将索引文本存储到倒排索引之前,<code class="fe nl nm nn no b">standard</code>分析器会将索引文本小写，并将文本拆分为停用词上的标记。</p><p id="45d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，<code class="fe nl nm nn no b">match</code>查询将使用<code class="fe nl nm nn no b">index-time</code>分析器，因此它使用的分析器与索引中索引的分析器相同，即<code class="fe nl nm nn no b">standard</code>分析器。</p><p id="e493" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用Elasticsearch提供的API来看看我们的“香港”文本在倒排索引中的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="795c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们使用<code class="fe nl nm nn no b">match</code>查询对索引进行搜索查询时，只有当我们键入包含“Hong”或“Kong”的文本时，才会得到结果这是因为只有当分析的查询与倒排索引中的标记完全匹配时，Elasticsearch才会返回结果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="e680" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果用户输入“Ho”、“Kon”或“Hon Kon”，Elasticsearch不会有任何响应。</p><p id="8c61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于自动完成来说，这对于帮助用户不是很有用，对吗？至少，autocomplete需要显示一些内容，即使我们没有输入完整的单词。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="68e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了解决这个问题，我们可以使用Elasticsearch提供的<code class="fe nl nm nn no b">match_phrase_prefix</code>查询。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5bc8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用匹配短语前缀查询</h1><p id="2884" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe nl nm nn no b">match_phrase_prefix</code>查询将允许用户在不输入所有单词的情况下得到一个结果。通过使用通常的<code class="fe nl nm nn no b">match</code>查询，如果我们键入“Hon”或“Kon”，我们不会从Elasticsearch得到任何结果，但是使用<code class="fe nl nm nn no b">match_pharse_prefix</code>，我们可以得到一个结果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="4c13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种自动完成仍然有一个缺点:如果用户键入“Hon Kon”，它仍然不会返回任何结果。这是因为“Hon Kon”不是“香港”的前缀</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a194" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">事物的利与弊</h1><p id="ef88" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">带有<code class="fe nl nm nn no b">text</code>字段数据类型和<code class="fe nl nm nn no b">standard</code>分析器的自动完成非常简单，但是在使用这种类型的自动完成之前，您可以考虑它的利弊。</p><h2 id="f67d" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">赞成的意见</h2><ul class=""><li id="1014" class="nr ns it lb b lc mu lf mv li nt lm nu lq nv lu nw nx ny nz bi translated"><strong class="lb iu">无需设置:</strong>您甚至不必定义任何映射，因为默认情况下，如果您将一个文本文档索引到Elasticsearch，它将被映射到<code class="fe nl nm nn no b">text</code>和<code class="fe nl nm nn no b">keyword</code>字段数据类型。</li><li id="1403" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><strong class="lb iu">快速索引时间</strong>:因为这种类型的自动完成使用的是<code class="fe nl nm nn no b">standard</code>分析器，所以在将文本保存到倒排索引中时，它不会对文本进行太多处理，这意味着快速索引时间。</li><li id="8cf6" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">大多数时候足够了:大多数时候，你不需要复杂的自动完成功能。这种自动完成类型就足够了。</li></ul><h2 id="0cbc" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">骗局</h2><ul class=""><li id="a3e1" class="nr ns it lb b lc mu lf mv li nt lm nu lq nv lu nw nx ny nz bi translated"><strong class="lb iu">不能处理错别字</strong>:这种类型的自动完成不能处理错别字，所以如果用户输入一个错别字，它不会返回任何结果。</li><li id="0574" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><strong class="lb iu">查询不能从中间词</strong>开始:查询到这类自动完成的文本也不能从中间词开始。在前面的“香港”示例中，如果我们使用文本“ong Kong”进行查询，Elasticsearch不会返回任何结果。</li><li id="2924" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><strong class="lb iu">不能处理空格:</strong>如果我们在前面的例子中错误地输入了“HongKong ”,那么Elasticsearch就不会用这种类型的自动完成功能返回任何内容。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b39e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">何时使用</h1><p id="8e31" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当您只需要一个简单的自动完成时，我推荐只使用<code class="fe nl nm nn no b">standard</code>分析器的自动完成。如果要为其创建自动完成的索引已经在生产中，并且已经用文档编制了索引，也可以使用这种类型的自动完成。因为这个自动完成功能使用默认的分析器和默认的文本映射，所以它适用于大多数文本文档。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d750" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="a13c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">用<code class="fe nl nm nn no b">text</code>字段数据类型和<code class="fe nl nm nn no b">standard</code>分析器创建一个自动完成是我们可以用Elasticsearch构建的最简单和最容易的自动完成。它几乎不需要设置，通常可以为现有索引创建一个自动完成功能。</p><p id="aea5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使对于大多数用例来说已经足够了，但它仍然有很多弱点，因为它只能处理简单的查询。为了克服这一点，我们可以使用一个自定义的分析器或Elasticsearch中的Suggesters特性，这是我打算写的。请等一下！</p><p id="e438" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我想说谢谢你一直读到最后。希望这篇文章能对你的项目有所帮助。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3549" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><ol class=""><li id="c290" class="nr ns it lb b lc mu lf mv li nt lm nu lq nv lu of nx ny nz bi translated"><a class="ae ky" href="https://opster.com/elasticsearch-glossary/elasticsearch-auto-complete-guide/" rel="noopener ugc nofollow" target="_blank">https://op ster . com/elastic search-glossary/elastic search-auto-complete-guide/</a></li><li id="4ae9" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu of nx ny nz bi translated"><a class="ae ky" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html" rel="noopener ugc nofollow" target="_blank">https://www . elastic . co/guide/en/elastic search/reference/current/query-DSL-match-query-phrase-prefix . html</a></li><li id="9720" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu of nx ny nz bi translated"><a class="ae ky" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html" rel="noopener ugc nofollow" target="_blank">https://www . elastic . co/guide/en/elastic search/reference/current/query-DSL-match-query . html</a></li><li id="05e3" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu of nx ny nz bi translated"><a class="ae ky" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-standard-analyzer.html" rel="noopener ugc nofollow" target="_blank">https://www . elastic . co/guide/en/elastic search/reference/current/analysis-standard-analyzer . html</a></li><li id="8fec" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu of nx ny nz bi translated"><a class="ae ky" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-standard-analyzer.html" rel="noopener ugc nofollow" target="_blank">https://www . elastic . co/guide/en/elastic search/reference/current/analysis-standard-analyzer . html</a></li></ol></div></div>    
</body>
</html>