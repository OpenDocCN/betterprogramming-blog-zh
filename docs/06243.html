<html>
<head>
<title>Solidity: A Small Test of the Self-Destruct Operation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">坚固性:自毁操作的一个小测试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/solidity-what-happens-with-selfdestruct-f337fcaa58a7?source=collection_archive---------3-----------------------#2020-09-14">https://betterprogramming.pub/solidity-what-happens-with-selfdestruct-f337fcaa58a7?source=collection_archive---------3-----------------------#2020-09-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f0f6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">“自毁”在Solidity中如何工作，以及它如何影响刚刚自毁的智能合约的寿命</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/44625cc37e02ba3e9c4b5fb79f85fbdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UoyAmhflJpoAmaQnMaYzQA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@harrisonkugler?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">哈里森·库格勒</a>在<a class="ae kv" href="https://unsplash.com/s/photos/crypto?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="c0d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出于本文的目的，我阅读了一些好的资料，从“<a class="ae kv" href="https://arxiv.org/pdf/2005.07908.pdf" rel="noopener ugc nofollow" target="_blank">为什么智能合约会自毁？调查以太坊</a>上的自毁功能，”这是一个真正深入自毁机制的最新出版物。在区块链的一般不变性中，<code class="fe ls lt lu lv b">selfdestruct</code>命令很突出:<code class="fe ls lt lu lv b">selfdestruct</code>使智能合同不可操作。一个激励人心的例子说明了为什么不变的区块链需要如此强大的命令:</p><blockquote class="lw lx ly"><p id="b8f8" class="kw kx lz ky b kz la jr lb lc ld ju le ma lg lh li mb lk ll lm mc lo lp lq lr ij bi translated">“DAO攻击持续了几天，该组织当时甚至注意到他们的合同受到了攻击。然而，由于智能合约的不变性，他们无法停止攻击或转移以太网。如果契约包含自毁功能，道组织可以轻松地转移所有醚，并减少财务损失。”</p></blockquote><p id="f699" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想了解更多关于DAO攻击及其后果的信息，可以参考本文末尾的参考文献[2]和[3]。</p><p id="af5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于编译<code class="fe ls lt lu lv b">selfdestruct</code>方法时生成的操作码，以太坊社区有一个很好的感性故事:最初操作码被命名为<code class="fe ls lt lu lv b">SUICIDE</code>，但他们决定将其重命名为<code class="fe ls lt lu lv b">SELFDESTRUCT</code>，因为</p><blockquote class="lw lx ly"><p id="abce" class="kw kx lz ky b kz la jr lb lc ld ju le ma lg lh li mb lk ll lm mc lo lp lq lr ij bi translated">“自杀是一个沉重的话题<strong class="ky ir"> </strong>，我们应该尽一切可能不影响我们发展社区中那些患有抑郁症或最近因自杀而失去亲人的人。”— <a class="ae kv" href="https://eips.ethereum.org/EIPS/eip-6" rel="noopener ugc nofollow" target="_blank"> EIP6 </a></p></blockquote><p id="1df5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面你会发现一个小的玩具例子，它包含了最少的逻辑来做一些测试。使用<a class="ae kv" href="https://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank"> Remix </a>可以很容易地执行它，所以即使没有安装开发环境也可以尝试。</p><pre class="kg kh ki kj gt md lv me mf aw mg bi"><span id="9140" class="mh mi iq lv b gy mj mk l ml mm">pragma solidity &gt;0.6.0;</span><span id="6882" class="mh mi iq lv b gy mn mk l ml mm">contract Storage {<br/> address payable private owner;<br/> uint256 number;</span><span id="8780" class="mh mi iq lv b gy mn mk l ml mm"> constructor() {<br/>  owner = msg.sender;<br/> }</span><span id="53bc" class="mh mi iq lv b gy mn mk l ml mm"> function store(uint256 num) public {<br/>  number = num;<br/> }</span><span id="eebd" class="mh mi iq lv b gy mn mk l ml mm"> function retrieve() public view returns (uint256){<br/>  return number;<br/> }<br/> <br/> function close() public { <br/>  selfdestruct(owner); <br/> }<br/>}</span></pre><p id="3a9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是部署合同后发生的情况。在Remix中，智能合约的每个方法都可以在左侧窗格中轻松访问。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/c5cafbdb989fe07e514778ba6ff79751.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*v9hzrpP5BkGlquY6CSWnJQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">部署后智能合约的方法</p></figure><p id="eb13" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一个要测试的方法是<code class="fe ls lt lu lv b">store</code>，它只是将作为参数传递的整数值存储在智能契约的内部状态中。下一个要测试的方法是<code class="fe ls lt lu lv b">retrieve</code>，正如你们中最聪明的人可能已经知道的，它检索预先存储在内部状态中的值。在实际存储任何东西之前调用这个方法只会返回<code class="fe ls lt lu lv b">0</code>，因为默认情况下<a class="ae kv" href="https://solidity.readthedocs.io/en/v0.6.0/control-structures.html?highlight=default#scoping-and-declarations" rel="noopener ugc nofollow" target="_blank">变量被归零</a>。</p><p id="632c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">调用<code class="fe ls lt lu lv b">close</code>方法将只执行<code class="fe ls lt lu lv b">selfdestruct</code>,除了下图中报告的以外，没有任何进一步的通知，一个正确执行的事务:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/0c925621804fbdc760981092eeb88604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9aSTS-gg1IQH4L4WhZoMpw.png"/></div></div></figure><p id="e442" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从现在开始，与智能合约的每次交互都将成功，但仍不会执行任何操作。</p><p id="6053" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在某种程度上，这是不一致的:调用智能契约的客户端不知道智能契约已经被销毁的事实。例如，在这个特定的智能契约中，在<code class="fe ls lt lu lv b">selfdestruct</code>之前和之后调用<code class="fe ls lt lu lv b">retrieve</code>方法将不会返回错误，并且在内部变量包含<code class="fe ls lt lu lv b">0</code>的特定情况下，这两个调用是不可区分的(参见下图)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/031b01b00bc36c1fad164b1afb7ce496.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3T8Z65x9nu9p9fy6jz1MVw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在自毁之前(第一次调用)和之后(第二次调用)调用的检索方法</p></figure><p id="22b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总结是，<code class="fe ls lt lu lv b">selfdestruct</code>被设计为故障合约的<em class="lz">极值比率</em>。这是一个紧急按钮，智能合约的<a class="ae kv" href="https://en.wikipedia.org/wiki/Scram" rel="noopener ugc nofollow" target="_blank">急停</a>。不过，在调用它之前，请考虑添加额外的逻辑，例如，将控制权传递给另一个智能合约。</p><p id="7c03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为进一步的阅读，我强烈建议参考文献[1]，如下。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="4295" class="my mi iq bd mz na nb nc nd ne nf ng nh jw ni jx nj jz nk ka nl kc nm kd nn no bi translated">参考</h1><ol class=""><li id="3e2e" class="np nq iq ky b kz nr lc ns lf nt lj nu ln nv lr nw nx ny nz bi translated">迟佳·陈，，卢大伟和约翰·格伦迪。2016."<a class="ae kv" href="https://deepai.org/publication/why-do-smart-contracts-self-destruct-investigating-the-selfdestruct-function-on-ethereum" rel="noopener ugc nofollow" target="_blank">智能合约为什么会自毁？调查以太坊上的自毁功能</a>(2016年1月)，27页</li><li id="d6bc" class="np nq iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated"><a class="ae kv" href="https://en.wikipedia.org/wiki/The_DAO_(organization)" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/The _ DAO _(organization)</a></li><li id="8450" class="np nq iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated"><a class="ae kv" href="https://www.coindesk.com/understanding-dao-hack-journalists" rel="noopener ugc nofollow" target="_blank">https://www.coindesk.com/understanding-dao-hack-journalists</a></li></ol></div></div>    
</body>
</html>