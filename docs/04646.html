<html>
<head>
<title>How to Provide Static IPs to AWS Lambdas in a Fault-Tolerant Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何以容错方式向AWS Lambdas提供静态IPs</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-provide-static-ips-to-aws-lambdas-in-a-fault-tolerant-way-c42084a0dc81?source=collection_archive---------13-----------------------#2020-04-27">https://betterprogramming.pub/how-to-provide-static-ips-to-aws-lambdas-in-a-fault-tolerant-way-c42084a0dc81?source=collection_archive---------13-----------------------#2020-04-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="12c0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">或者如何在第三方防火墙上把你的Lambdas列入白名单</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cda3cf7552f428c71ce985e8e0c733a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZxCSo2atmrSHr-j3w-cn2w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">你好，我是尼克🎞 on <a class="ae kv" href="https://unsplash.com/s/photos/white?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="07cc" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">问题是</h1><p id="58f2" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">最近，在为我们的一个客户工作时，我们不得不应对以下挑战:我们如何为我们的Lambdas提供静态IP，以便它们可以被列入我们需要集成的第三方公司的防火墙的白名单中？</p><p id="c017" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">你可能知道，公共Lambdas有短暂的IP，这意味着它们会随时改变。这意味着当这些IP发生变化时，没有可靠的方法来以稳定的方式配置防火墙，而不会失去从Lambda通过防火墙的访问。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="c594" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">解决方案</h1><p id="1437" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">考虑到我们已经在一个默认的VPC中部署了一些东西，并且考虑到将这些东西迁移到一个新创建的定制VPC所需要的工作量，主要是因为生产数据库，我们选择以下列方式扩展现有的默认VPC(在黄色框中突出显示):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/e4b93450a8774358f6e57f48b260ee44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZOhRv_RLmuj6Ekipad6Zew.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">该图显示了如何使用NAT网关扩展默认VPC，以便为Lambdas提供稳定的IP</p></figure><p id="fdd4" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">注意:资源id和IP不反映实际部署中的任何实际值。</p><p id="35c2" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">正如您在上面突出显示的黄色框中看到的，这是一个容错解决方案，包括:</p><ul class=""><li id="ffdc" class="mx my iq lx b ly mr mb ms me mz mi na mm nb mq nc nd ne nf bi translated"><strong class="lx ir">两个/24专用子网</strong>(蓝色方框)，每个位于不同的可用性区域(AZ)，允许2⁸ - 5 = 251个IP地址(参见下面关于AWS保留IP地址的解释)</li><li id="0cdb" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><strong class="lx ir">两个/25公共子网</strong>(绿色方框)，每个子网位于不同的AZ上，与为新的私有子网选择的AZ相匹配。这些子网最多支持2⁷ - 5 = 123个IP地址，这为我们提供了一些灵活性，以防我们需要在每个子网上托管除NAT网关之外的任何东西。</li><li id="5b8c" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><strong class="lx ir">两个静态IP</strong>(图中未显示)</li><li id="4feb" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><strong class="lx ir">两个NAT网关</strong>，每个部署在一个新创建的公共子网上，每个都有自己的静态IP</li><li id="d7ce" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">第一个AZ 上的<strong class="lx ir">私有子网的一个路由表。它将负责将内部流量路由到VPC，并将外部流量通过同一AZ上新创建的公共子网上的NAT网关。</strong></li><li id="1e08" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">第二个AZ 上的<strong class="lx ir">私有子网的一个路由表。它将负责将内部流量路由到VPC，并将外部流量通过同一AZ上新创建的公共子网上的NAT网关。</strong></li><li id="af0a" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">一个路由表，用于托管NAT网关的两个新创建的公共子网。它将负责将内部流量路由到VPC，并将外部流量通过现有的默认互联网网关路由。</li></ul><h2 id="586a" class="nl le iq bd lf nm nn dn lj no np dp ln me nq nr lp mi ns nt lr mm nu nv lt nw bi translated">AWS保留的IP地址</h2><p id="939b" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">我们无法使用每个子网CIDR块中的前四个IP地址和最后一个IP地址，也无法将其分配给实例。例如，在CIDR地址块为10.0.0.0/24的子网中，保留了以下五个IP地址:</p><ul class=""><li id="67c9" class="mx my iq lx b ly mr mb ms me mz mi na mm nb mq nc nd ne nf bi translated"><strong class="lx ir"> 10.0.0.0: </strong>网络地址</li><li id="36e4" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><strong class="lx ir"> 10.0.0.1: </strong>由AWS为VPC路由器保留</li><li id="a937" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><strong class="lx ir"> 10.0.0.2: </strong>由AWS保留。DNS服务器的IP地址是VPC网络范围的基数加二。</li><li id="7191" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><strong class="lx ir"> 10.0.0.3: </strong>由AWS保留以备将来使用</li><li id="a73a" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><strong class="lx ir"> 10.0.0.255: </strong>网络广播地址。AWS不支持VPC中的广播，因此该地址被保留。</li></ul><p id="d98e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">参考:<a class="ae kv" href="https://docs.amazonaws.cn/en_us/vpc/latest/userguide/vpc-ug.pdf#getting-started-ipv4" rel="noopener ugc nofollow" target="_blank">https://docs . Amazon AWS . cn/en _ us/VPC/latest/user guide/VPC-ug . pdf #入门-ipv4 </a>(第70页)</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="dc19" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">履行</h1><h2 id="ccfa" class="nl le iq bd lf nm nn dn lj no np dp ln me nq nr lp mi ns nt lr mm nu nv lt nw bi translated">云形成模板</h2><p id="8adc" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">部署该解决方案的第一步是创建一个CloudFormation模板文件，用要部署的新资源定义堆栈:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">扩展默认VPC的CloudFormation模板</p></figure><p id="e82f" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这个CloudFormation模板的内容应该是不言自明的。如有任何疑问，请参考<a class="ae kv" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html" rel="noopener ugc nofollow" target="_blank">云信息文档</a>。如果这还不够，请在下面留言，我很乐意帮忙。</p><h2 id="c050" class="nl le iq bd lf nm nn dn lj no np dp ln me nq nr lp mi ns nt lr mm nu nv lt nw bi translated">JSON参数文件</h2><p id="dda3" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">如你所见，上面的CloudFormation模板有一个名为<code class="fe nz oa ob oc b">Parameters</code>的部分。这使得模板可以重用，以防(理想情况下)您的每个环境都有不同的VPC(例如，<code class="fe nz oa ob oc b">development</code>、<code class="fe nz oa ob oc b">staging</code>和<code class="fe nz oa ob oc b">production</code>)。</p><p id="d6b9" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">要配置每个部署，您需要创建一个JSON文件，其中包含您可能想要应用堆栈更改的每个环境的参数。参见下面一个假想的<code class="fe nz oa ob oc b">development</code>环境的例子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">JSON参数文件。</p></figure><p id="c04e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">注意，<code class="fe nz oa ob oc b">VPC</code>和<code class="fe nz oa ob oc b">InternetGateway</code>参数引用了现有的资源id(记住，我们是在扩展现有的默认VPC)。您可以从AWS Web控制台复制这些值。</p><h2 id="82c3" class="nl le iq bd lf nm nn dn lj no np dp ln me nq nr lp mi ns nt lr mm nu nv lt nw bi translated">JSON参数文件解析器</h2><p id="81a0" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated"><code class="fe nz oa ob oc b">aws cloudformation deploy</code>命令通过其<code class="fe nz oa ob oc b">--parameter-overrides</code>标志接受参数(见下文)。参数应该用空格分隔，就像下面的例子:<code class="fe nz oa ob oc b">ParameterKey1=ParameterValue1 ParameterKey2=ParameterValue2</code>。</p><p id="fe70" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">为了让我们的生活更轻松，可以使用下面的脚本。该脚本需要一个参数，即一个JSON文件的路径，如上图所示，它以空格分隔的格式解析并打印该文件，如前一段所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于将JSON params文件转换为aws cloudformation deploy命令接受的空格分隔格式的脚本</p></figure><p id="69c1" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我们也可以有一个简单的包含空格分隔的参数的<code class="fe nz oa ob oc b">.txt</code>文件，但是我个人认为JSON文件更容易维护，因为如果有很多参数，它更容易阅读。</p><h2 id="6f55" class="nl le iq bd lf nm nn dn lj no np dp ln me nq nr lp mi ns nt lr mm nu nv lt nw bi translated">部署堆栈</h2><p id="4171" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">最后，我们需要部署我们的堆栈。为此，我们可以使用类似于下面的脚本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于部署我们的AWS云形成堆栈的辅助shell脚本</p></figure><p id="d0bb" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">该脚本需要三个参数:</p><ul class=""><li id="22a7" class="mx my iq lx b ly mr mb ms me mz mi na mm nb mq nc nd ne nf bi translated">要部署的AWS CloudFormation堆栈名称</li><li id="b6bf" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">CloudFormation模板<code class="fe nz oa ob oc b">yml</code>文件的路径(查看上面的CloudFormation模板部分)</li><li id="c85c" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">JSON参数文件的路径，该文件包含云形成模板所期望的参数(查看上面的JSON参数文件部分)</li></ul><p id="e3f6" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">注意:正如您在第8行看到的，这个脚本依赖于我们在上面的JSON参数文件解析器小节中创建的JSON解析器脚本。</p><h2 id="8826" class="nl le iq bd lf nm nn dn lj no np dp ln me nq nr lp mi ns nt lr mm nu nv lt nw bi translated">把所有的放在一起</h2><p id="5d4d" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">一切就绪后，运行以下命令来部署您的堆栈:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">部署CloudFormation堆栈的脚本使用示例</p></figure><p id="109c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">其中:</p><ul class=""><li id="d858" class="mx my iq lx b ly mr mb ms me mz mi na mm nb mq nc nd ne nf bi translated"><code class="fe nz oa ob oc b">deploy-cfn-stack.sh</code>:上面部署堆栈部分描述的脚本</li><li id="2cd0" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><code class="fe nz oa ob oc b">stack-name</code>:您的CloudFormation堆栈将被部署的名称</li><li id="162d" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><code class="fe nz oa ob oc b">path-to-cfn-template-file</code>:CloudFormation模板<code class="fe nz oa ob oc b">yml</code>文件的路径，如上面cloud formation模板部分所述</li><li id="2d2f" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">【CloudFormation模板的JSON params文件的路径，如上面的JSON参数文件一节所述</li></ul></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="d2b7" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">测试您的部署</h1><p id="73b4" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">您可以通过以下步骤检查您的部署是否有效:</p><p id="c348" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">1.打开AWS Web控制台，找到您创建的CloudFormation堆栈。</p><p id="12de" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">2.验证是否创建了下图所示的资源以及其他资源:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/d9d9448ac9585d01488b354d6d073ff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ASZzS6LbqLl-g8pMBe7yaA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们部署的堆栈中的资源列表。</p></figure><p id="c431" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">3.在我们部署的堆栈创建的两个Lambda私有子网之一中创建一个新的EC2实例。</p><p id="a5cc" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">4.<code class="fe nz oa ob oc b">ssh</code>到新创建的实例中，并运行以下命令:</p><p id="1875" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated"><code class="fe nz oa ob oc b">curl 'https://api.ipify.org?format=json'</code></p><p id="ea2c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">结果应该是您在CloudFormation堆栈资源列表中看到的两个静态IP之一，如上面的截图所示。具体的IP取决于您在创建EC2实例时选择的子网。请记住，每个私有子网都有自己的路由表，它将流量路由到与私有子网位于同一AZ上的相应NAT网关。</p><p id="1593" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">或者，您也可以创建并部署一个简单的Lambda函数来响应GET请求。这个函数将对我们上面提到的同一个端点执行GET请求，并将响应返回给客户机，因此您可以验证它是否具有预期的IP地址。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="8520" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">λ配置</h1><p id="aa12" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">既然基础设施已经设置好了，是时候配置Lambda了，它将被部署在由我们的栈创建的Lambda私有子网上。</p><p id="f5e9" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我们碰巧使用的无服务器框架提供了配置你的函数的VPC细节的能力。</p><p id="d88b" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">如果您密切关注上面的CloudFormation template部分中描述的CloudFormation模板<code class="fe nz oa ob oc b">yml</code>文件，您会注意到，除了其他内容之外，它还输出(查看文件末尾的<code class="fe nz oa ob oc b">Outputs</code>部分)由部署创建的安全组和私有子网。</p><p id="1177" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">您可以很容易地在您的<code class="fe nz oa ob oc b">serverless.yml</code>文件中引用这些值，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在无服务器框架<code class="fe nz oa ob oc b">serverless.yml</code>文件上引用CloudFormation输出的示例配置</p></figure><p id="bb98" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">参考:<a class="ae kv" href="https://serverless.com/framework/docs/providers/aws/guide/functions/#vpc-configuration" rel="noopener ugc nofollow" target="_blank">https://server less . com/framework/docs/providers/AWS/guide/functions/# VPC-configuration</a></p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="91f5" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">打扫</h1><p id="f179" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">完成所有工作后，您可以通过在本地机器上运行以下命令来删除堆栈:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="cdab" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">此外，确保删除您在上一节中为测试部署而手动创建的任何资源。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="ad91" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">定价</h1><p id="1f6f" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">截至本文撰写之时:</p><ul class=""><li id="a5f6" class="mx my iq lx b ly mr mb ms me mz mi na mm nb mq nc nd ne nf bi translated">每个NAT网关每小时0.045</li><li id="4467" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">每0.045</li></ul><p id="64a1" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated"><strong class="lx ir">每月定价= 2 * 0.045 * 24 * 30 = 64.8美元+数据成本</strong></p><p id="e941" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">其中:</p><ul class=""><li id="1063" class="mx my iq lx b ly mr mb ms me mz mi na mm nb mq nc nd ne nf bi translated">两个NAT网关实例</li><li id="ec6e" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">每个NAT网关每小时0.045</li><li id="1d67" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">24小时</li><li id="af87" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">30天</li><li id="857b" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">数据成本:每消耗GB 0.045英镑</li></ul><p id="38d9" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">参考:<a class="ae kv" href="https://aws.amazon.com/vpc/pricing/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/vpc/pricing/</a></p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="8558" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">最终意见</h1><p id="e0b1" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">本文展示了如何使用NAT网关容错地扩展现有的默认VPC，使您能够为您的Lambdas提供静态IP，这些IP可以被列入第三方防火墙的白名单。</p><p id="ebd8" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">您应该记住的一点是，在专用子网上部署Lambdas会显著增加它们的冷启动时间。</p><p id="103a" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在我们的例子中，由于对这个第三方防火墙应用程序的请求是使用一个定制的队列系统异步处理的，这个限制对我们来说并不是一个障碍。</p><p id="b15d" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">虽然其他解决方案也有可能解决同样的问题，但是考虑到现有的堆栈，这种方法对我们来说更自然。</p><p id="3b7d" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">编码快乐！</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="afc7" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">资源</h1><ul class=""><li id="abec" class="mx my iq lx b ly lz mb mc me oe mi of mm og mq nc nd ne nf bi translated"><a class="ae kv" href="https://docs.amazonaws.cn/en_us/vpc/latest/userguide/vpc-ug.pdf" rel="noopener ugc nofollow" target="_blank">亚马逊虚拟私有云-用户指南</a></li><li id="7f7e" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><a class="ae kv" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html" rel="noopener ugc nofollow" target="_blank">云形成文件</a></li><li id="2a7b" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><a class="ae kv" href="https://www.ipify.org/" rel="noopener ugc nofollow" target="_blank"> ipify API -一个简单的公共IP地址API </a></li><li id="db34" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><a class="ae kv" href="https://serverless.com/framework/docs/providers/aws/guide/functions/#vpc-configuration" rel="noopener ugc nofollow" target="_blank">无服务器- AWS功能- VPC配置</a></li><li id="5e3f" class="mx my iq lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated"><a class="ae kv" href="https://www.freecodecamp.org/news/lambda-vpc-cold-starts-a-latency-killer-5408323278dd/" rel="noopener ugc nofollow" target="_blank">亚马逊VPC定价</a></li></ul></div></div>    
</body>
</html>