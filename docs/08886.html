<html>
<head>
<title>How To Use MySQL With Node.js and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将MySQL与Node.js和Docker结合使用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-mysql-with-node-js-and-docker-7dfc10860e7c?source=collection_archive---------1-----------------------#2021-06-23">https://betterprogramming.pub/how-to-use-mysql-with-node-js-and-docker-7dfc10860e7c?source=collection_archive---------1-----------------------#2021-06-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b0de" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何在Node.js项目中实现MySQL数据库</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d26809e774e7c06899490e5d38928012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DlRskvEjpKnD4smfW35cJA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供。</p></figure><p id="b4ff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本教程中，您将学习如何通过Docker在Node.js项目中使用MySQL数据库。您将构建一个简单的应用程序，允许您收集人们的电子邮件地址。</p><p id="27f4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本教程中使用的技术有:</p><ul class=""><li id="1702" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">节点. js</li><li id="30e8" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">码头工人</li><li id="1ccf" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">表达</li><li id="36ad" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">关系型数据库</li></ul></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="48ab" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">创建项目结构</h1><p id="86b9" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">第一步是创建项目结构。目前，您需要:</p><ul class=""><li id="2e29" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">包含所有文件的整体文件夹。</li><li id="d6fb" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">一个<code class="fe nj nk nl nm b">.env</code>文件。</li><li id="98ec" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">带有服务器/数据库配置的文件。</li></ul><p id="e33e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，您可以创建所有文件和文件夹，如下所示:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="a56c" class="nr mn iq nm b gy ns nt l nu nv">take nodejs-mysql<br/>touch index.js<br/>touch .env</span></pre><p id="3586" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，下一步是运行MySQL。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="bec1" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">用Docker运行MySQL</h1><p id="8e34" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">为了避免不一致和在你的机器上安装新的东西，你将使用MySQL的官方Docker镜像。</p><p id="e625" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在进一步操作之前，请在您的终端中运行以下命令:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="b54d" class="nr mn iq nm b gy ns nt l nu nv">docker run -p 3306:3306 --name nodejs-mysql -e MYSQL_ROOT_PASSWORD=pass -e MYSQL_DATABASE=emails_db -d mysql:5.7</span></pre><p id="db90" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该命令执行以下操作:</p><ol class=""><li id="1ce8" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq nw lx ly lz bi translated">它从DockerHub中提取图像<code class="fe nj nk nl nm b">mysql:5.7</code>，然后运行它。</li><li id="4f0e" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq nw lx ly lz bi translated">它在端口<code class="fe nj nk nl nm b">3306</code>上启动MySQL数据库。</li><li id="4376" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq nw lx ly lz bi translated">将数据库密码设置为<code class="fe nj nk nl nm b">pass</code>。</li><li id="3537" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq nw lx ly lz bi translated">最后，它创建了一个名为<code class="fe nj nk nl nm b">emails_db</code>的新数据库。</li></ol><p id="8966" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，您可以从终端和应用程序访问数据库。如果您想使用bash运行容器，并直接使用MySQL，请运行以下命令:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="b075" class="nr mn iq nm b gy ns nt l nu nv">docker container exec -it nodejs-mysql bash</span></pre><p id="d4a4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">之后，按如下方式启动MySQL监控器:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="3ccb" class="nr mn iq nm b gy ns nt l nu nv">mysql -u root -p</span></pre><p id="7e82" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">系统将提示您输入密码。输入您在上面第一个命令中提到的相同密码。在这个例子中，密码是<code class="fe nj nk nl nm b">pass</code>。</p><p id="6de4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，您可以运行MySQL命令并使用数据库。此外，您已经准备好在Node.js应用程序中使用MySQL。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="cb36" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">初始化项目并安装依赖项</h1><p id="2cce" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">下一步是初始化Node.js项目并安装所需的依赖项。您可以使用以下命令初始化项目:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="e23f" class="nr mn iq nm b gy ns nt l nu nv">npm init -y</span></pre><p id="8782" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该命令初始化您的项目，并用默认值自动完成<code class="fe nj nk nl nm b">package.json</code>文件。</p><p id="9034" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个项目需要的依赖项是<code class="fe nj nk nl nm b">mysql</code>、<code class="fe nj nk nl nm b">express</code>、<code class="fe nj nk nl nm b">express-validator</code>和<code class="fe nj nk nl nm b">dotenv</code>。使用以下命令安装它们:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="9bb0" class="nr mn iq nm b gy ns nt l nu nv">npm install mysql dotenv express express-validator</span></pre><p id="0edd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您将使用<code class="fe nj nk nl nm b">mysql</code>包来操作您的数据库。您还将使用<code class="fe nj nk nl nm b">express</code>包来创建两个端点:</p><ul class=""><li id="de19" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">读取数据。</li><li id="9f6f" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">向数据库添加数据。</li></ul><p id="9bfa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，您需要<code class="fe nj nk nl nm b">express-validator</code>包来净化用户输入。例如，您不希望有人添加SQL查询而不是电子邮件地址，因为这可能会产生问题。</p><p id="0bc1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您现在已经准备好构建应用程序了！</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="6706" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">构建应用程序</h1><p id="c659" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">第一步是打开<code class="fe nj nk nl nm b">index.js</code>文件并导入包。因此，在文件顶部添加以下导入:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="8c57" class="nr mn iq nm b gy ns nt l nu nv">const express = require('express');<br/>const mysql = require('mysql');<br/>const { body, validationResult } = require('express-validator');<br/>const app = express();<br/><br/>require('dotenv').config();</span></pre><p id="a137" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下一步是打开<code class="fe nj nk nl nm b">.env</code>文件并添加数据库细节，如用户名、密码和数据库名称:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="379d" class="nr mn iq nm b gy ns nt l nu nv">DB_USER=admin<br/>DB_PASSWORD=pass<br/>DB_NAME=emails_db</span></pre><p id="c79b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面的细节应该也适用于你。但是，请随意更改它们。</p><p id="8ddf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下一步是在应用程序中创建数据库连接。转到<code class="fe nj nk nl nm b">index.js</code>，添加以下代码:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="7c6e" class="nr mn iq nm b gy ns nt l nu nv">const database = mysql.createConnection({<br/>    user: process.env.DB_USER,<br/>    password: process.env.DB_PASSWORD,<br/>    database: process.env.DB_NAME<br/>});</span></pre><p id="5db8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，您可以使用数据库来创建表、添加、编辑和删除数据以及其他操作。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="ab29" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">初始化数据库</h1><p id="ea5a" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">您必须通过创建一个新表来初始化数据库。你需要一张桌子来存放人们的电子邮件。</p><p id="6b1c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，打开<code class="fe nj nk nl nm b">index.js</code>文件并添加以下路径:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="3b98" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，当您访问<code class="fe nj nk nl nm b">/init</code>路线时，应用程序会创建一个名为<code class="fe nj nk nl nm b">emails</code>的新表，如果它还不存在的话。该表包含以下字段:</p><ul class=""><li id="9b55" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">身份证</li><li id="c337" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">人的名字和姓氏</li><li id="e812" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">电子邮件地址</li></ul><p id="9830" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦创建了表格，您就可以从人们那里收集电子邮件地址。让我们看看你怎么做！</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="4c81" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">添加电子邮件</h1><p id="e374" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">该应用程序最重要的部分之一是允许人们订阅你的服务/时事通讯。您可以通过在<code class="fe nj nk nl nm b">index.js</code>中编写以下代码来实现:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="a25e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以看到这条路线做了很多事情，所以让我们一步一步来:</p><ol class=""><li id="a366" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq nw lx ly lz bi translated">首先，您允许人们向<code class="fe nj nk nl nm b">/subscribe</code>端点发出<code class="fe nj nk nl nm b">POST</code>请求。</li><li id="3d05" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq nw lx ly lz bi translated">其次，您通过使用来自<code class="fe nj nk nl nm b">express-validator</code>包的方法来净化来自人们的输入。它们确保字段不为空，并且它也对输入进行转义。</li><li id="230c" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq nw lx ly lz bi translated">最后，检查是否有错误。如果有错误，就返回这些错误。否则，你可以让这个人订阅时事通讯/服务。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/fd11269aa8ef9c333c87bcb97243243b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*U6W90xadn-k4toM6.png"/></div></div></figure><p id="b98e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上图显示了一个提交空数据的例子。您可以看到，根据请求的错误，您会得到一些错误。</p><p id="1069" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">另一方面，如果您使用有效的数据进行请求，那么订户将被添加到列表中。请参见下面的示例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/c446b8d416cd832e39b609f15f5be1b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Aone2EbiiQSHuGmi.png"/></div></div></figure><p id="89b9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，端点可以正常工作。人们可以订阅您的电子邮件/服务。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="68cc" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">获取所有电子邮件</h1><p id="23fc" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">最后，您需要一个路径来获取收集到的所有电子邮件地址的列表。因此，在<code class="fe nj nk nl nm b">index.js</code>中添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="7f38" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nj nk nl nm b">SELECT * FROM emails</code> SQL查询从表中选择所有记录。该查询为每个查询返回以下信息:</p><ul class=""><li id="f521" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">身份证</li><li id="3b9f" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">名字和姓氏</li><li id="0ab6" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">电子邮件地址</li></ul><p id="91fd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您访问URL <code class="fe nj nk nl nm b">http://localhost:9898/</code>，您将获得所有订户。下面，你可以看到一个例子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/0fde9879d1471270be204469615a5f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5I7232YcdVjDoQsG.png"/></div></div></figure><p id="8eec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过这条路线，您可以看到所有使用您的应用程序订阅的人。</p><p id="1432" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ob">注意:让每个人都能看到这个端点并不是一个好主意，因为这样会暴露个人信息。因此，一种改进是保护这个端点，只让您自己使用。</em></p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="3457" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">清理应用程序</h1><p id="72ab" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">在结束之前，您可以通过重新组织代码来改进应用程序。尽管对于像这样的小应用程序来说，这可能有点过了，但当它变得更大时，还是很有帮助的。</p><p id="3cb7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们从清理<code class="fe nj nk nl nm b">index.js</code>文件开始。打开它，用以下内容替换所有内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="101a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下一步是为数据库配置创建一个特殊的地方。在项目的根目录下，创建<code class="fe nj nk nl nm b">src</code>文件夹。您可以按如下方式操作:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="3dc8" class="nr mn iq nm b gy ns nt l nu nv">take src</span></pre><p id="f818" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该命令创建目录，然后打开它。在<code class="fe nj nk nl nm b">src</code>文件夹中，创建另一个名为<code class="fe nj nk nl nm b">db.js</code>的文件。打开它并添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="ace3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<code class="fe nj nk nl nm b">db.js</code>文件中，您配置数据库并创建一个连接。之后，您导出它，以便它可以在其他地方使用。</p><p id="e23b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，您需要创建控制器和路线。因此，从项目的根目录创建以下文件夹和文件:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="64de" class="nr mn iq nm b gy ns nt l nu nv">take src/controllers/controllers.js<br/>take src/routes/routes.js</span></pre><p id="a02e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，您已经准备好创建路线并编写控制器了。</p><h2 id="da8d" class="nr mn iq bd mo oc od dn ms oe of dp mw le og oh my li oi oj na lm ok ol nc om bi translated"><strong class="ak">创建路线</strong></h2><p id="710c" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">让我们从路线开始。打开<code class="fe nj nk nl nm b">routes.js</code>文件，添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="1dfd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这个文件中，导入<code class="fe nj nk nl nm b">express</code>以便创建路线。之后，导入控制器，这样就可以为每条路线传递特定的控制器。然后从<code class="fe nj nk nl nm b">express-validator</code>导入<code class="fe nj nk nl nm b">body</code>函数，创建一个快速路由器。</p><p id="9b3e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在接下来的几行中，您将定义路线并传递特定的控制器。最后，导出<code class="fe nj nk nl nm b">router</code>，这样就可以在其他地方使用它。</p><h2 id="9a63" class="nr mn iq bd mo oc od dn ms oe of dp mw le og oh my li oi oj na lm ok ol nc om bi translated"><strong class="ak">编写控制器</strong></h2><p id="2f30" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">最后一步是为控制器编写代码。实际上，您已经有了前面步骤的代码，但是您需要将它们存储为函数。</p><p id="7e68" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">获取之前在<code class="fe nj nk nl nm b">index.js</code>中的代码，并将其添加如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="bcb5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如您所见，代码是相同的，但现在它存储在不同的函数中。然后，在文件的末尾，导出这些函数，这样就可以在<code class="fe nj nk nl nm b">routes.js</code>文件中使用它们。</p><p id="29c2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您已经完成了重构！</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="222c" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">运行代码</h1><p id="d904" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">要运行应用程序，请进入应用程序的根目录并运行以下命令:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="e2fa" class="nr mn iq nm b gy ns nt l nu nv">node index.js</span></pre><p id="dcea" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">之后，您应该能够添加新的订户并查看现有的订户了！</p><p id="5085" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以在GitHub页面上找到完整的代码。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="093c" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">结论</h1><p id="a419" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">这仅仅是应用程序的开始，但是你可以添加许多改进。一些改进可能是:</p><ul class=""><li id="c5f8" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">为此应用程序添加前端部分。</li><li id="01fd" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">保护显示所有用户的路由。</li><li id="1a04" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">添加测试。</li><li id="1648" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">允许人们创建个人账户和收集电子邮件地址。</li></ul><p id="06c7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我知道在评论中，如果你想让我建立前端部分。如果有足够的兴趣，我会做的！</p><p id="3f8d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">&gt;<em class="ob">本</em> <a class="ae on" href="https://rli.to/4j3yL" rel="noopener ugc nofollow" target="_blank"> <em class="ob"> SQL训练营</em> </a> <em class="ob">将带你从一个完全的初学者成为SQL、数据库管理和数据库设计的专家。</em></p><p id="b924" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">&gt;<a class="ae on" href="https://rli.to/PhkSl" rel="noopener ugc nofollow" target="_blank"> <em class="ob">学习Node.js </em> </a> <em class="ob">，从零开始构建高级大型应用&amp;受聘为后端开发者</em></p></div></div>    
</body>
</html>