# 如何在 React 中创建模态

> 原文：<https://betterprogramming.pub/modals-in-reactjs-631d801e2723>

## 带 Redux 和挂钩

![](img/a4a3ad94232dd5b76c1f22fe4abd4564.png)

[姚](https://unsplash.com/@hojipago?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍照。

当我开始使用 React 时，我的第一个任务是创建一个模态对话框，在其中显示一些数据。我花了很多时间谷歌如何创建一个函数，我可以调用它来显示一些窗口。对我来说这是很自然的事。甚至 VanillaJs 也允许你只调用`alert`函数来显示一个简单的对话框。我不明白为什么反应不是这样。

但是你看，React 不是这样工作的。React 的一个主要概念是，如果你有一个状态并且它没有改变，你可以任意多次渲染页面，它看起来总是一样的。但是调用显示一些模态的函数违背了这个原则。模态的显示不是基于组件的状态，而是基于一些函数调用。

那么我们该怎么做呢？

首先，让我们有一个应该打开模态的组件。我们将有一个简单的按钮组件，点击按钮时，我们会希望一个确认框打开。它将记录到控制台“让我们做吧！”如果`confirm`被接受，并且如果`confirm`被取消，将不做任何事情。

很简单，对吧？但是现在让我们制作自己的`confirm`模态，去掉内置的`confirm`。我们要做的是给组件添加一个状态，添加一个名为`openConfirm`的标志，并基于此呈现我们自己的组件。然后，我们将提供一个应该在 confirm 上调用的方法，作为我们的模态组件的一个属性。

我们还必须创建带有一些自定义样式的`CustomConfirm`组件，并将道具正确链接到按钮:

瞧，完成了！这就是你如何用 React 方式创建简单的模态。

但是在我们开始庆祝之前，让我们考虑一个更复杂的情况。在多个项目中，我需要从应用程序的不同部分打开不同的模态，加载一些 rest API 数据。您可能知道，如果您想在 React 中从应用程序的不同部分更改组件的状态，您将使用像 [Flux](https://facebook.github.io/flux/) 或 [Redux](https://redux.js.org/) 这样的全局状态提供者。您可能不希望每个模态都有一个单独的减速器——特别是如果您有很多减速器的话。

这就是为什么我创建了一个公共模态组件来显示所有不同的模态，同时关心 Redux 的状态管理和打开/关闭模态。让我们来看看你如何做同样的事情。

由于这种方法将与 Redux 的商店紧密绑定，所以让我们从那里开始。首先，我们需要一些模态缩减器，它将包含关于我们的模态的数据并围绕它们进行操作。一般来说，我们需要两种动作类型:

*   具有给定数据的给定类型的打开模式。
*   关闭模态。

这在减速器中很容易实现:

这个缩减器只做两件事:如果调度了`OPEN_MODAL`动作，则设置给定的数据；如果调度了`CLOSE_MODAL`动作，则设置状态为`null`。为了更好地理解发送给`OPEN_MODAL`的数据，让我们看一下动作:

如您所见，我们做了一个异步操作并获得了一些数据(在本例中，`profile`)。然后，我们用我们想要显示的模态类型和我们想要传递到那里的任何数据来调度`OPEN_MODAL`动作。我们现在需要做的就是在一个组件中使用这些数据，这个组件将包装我们所有的模态窗口:

我们在这里做的是将我们的模态数据从一个全局状态连接到`Modal`组件。我们还提供了一个函数作为道具，允许调度`closeModal`动作。然后我们获取这些数据并呈现一个模态窗口。

```
<div className="modal">
...
</div>
```

这是我们的模态窗口，具有所有必要的样式。在里面，我们对`modal.type`进行了检查。基于此，我们显示正确的模态体(在我们的例子中，`ProfileModal`)。然后我们有一个关闭按钮，允许我们关闭窗口。当然，在真实的 app 中，你也可以添加一些花哨的标题和页脚。现在剩下要做的就是将`Modal`组件添加到我们的应用程序的根组件中，这样每次打开一些模态时，`Modal`组件就可以被渲染。在我的例子中，我只是把它放在`App.js`文件中:

正如你所看到的，我们在这里所做的只是创建一个按钮来调度`openProfile`动作，该动作获取一些 API 数据，然后打开一个模态。

就是这样！我们创建了通用的模态组件。我知道这种方法看起来太复杂，无法显示一个愚蠢的模态窗口。但是通过这样做，并且实际上遵循 React 的思维方式，您将会创建漂亮而干净的组件，这些组件易于重用并且易于测试。

你可以在 [GitHub](https://github.com/rochus222/medium-modal-service) 上查看整个工作 app。