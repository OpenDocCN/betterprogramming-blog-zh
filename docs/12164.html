<html>
<head>
<title>Ensure a Stable Production Environment With Chaos Mesh</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用混沌网确保稳定的生产环境</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ensure-a-stable-production-environment-with-chaos-mesh-54057773d582?source=collection_archive---------17-----------------------#2022-05-16">https://betterprogramming.pub/ensure-a-stable-production-environment-with-chaos-mesh-54057773d582?source=collection_archive---------17-----------------------#2022-05-16</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="1535" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">介绍混沌网格，一个强大的混沌工程工具</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/191824d0684ad0da11fc6b49da6092f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZJnQ6stKO9O16EqZ"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@dariusbashar?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">大流士巴沙尔</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="a5c1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如今，分布式计算系统中的故障变得难以预测。我们需要主动预防问题。<a class="ae kz" href="https://en.wikipedia.org/wiki/Chaos_engineering" rel="noopener ugc nofollow" target="_blank">混沌工程</a>方法正是为了这个目的。</p><p id="6d5a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇文章中，我将介绍<a class="ae kz" href="https://chaos-mesh.org/" rel="noopener ugc nofollow" target="_blank">混沌网格</a>，一个强大的混沌工程工具。如果你不熟悉混沌概念，请阅读下面的内容，否则你可以直接跳到混沌网格部分。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="c52a" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">混沌工程概念</h1><p id="cdf2" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">混沌工程是一个现代概念，在分布式环境中故意造成混乱但真实的情况。这个想法最初是由网飞的工程师在2011年设计的。这种测试验证了生产环境可以容忍意外故障。我们可以在生产受到影响之前主动处理最致命的弱点。它测试环境对基础架构、网络和应用程序故障的恢复能力。</p><p id="2210" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如，我们可以检查如果单点故障崩溃会发生什么。对系统的其他剩余部分会有什么影响？如果我们发现了问题，我们可以重新设计策略，并重复测试以确保实施了正确的解决方案。</p><p id="d26a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">典型的混沌测试案例:</p><ul class=""><li id="7e1a" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">模拟高CPU负载和流量的意外增加。</li><li id="8075" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">在服务中注入延迟。</li><li id="9d0f" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">导致网络中断。</li><li id="9ba5" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">分离舱故障。</li></ul><p id="8779" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">还有很多。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="d7f5" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">混沌网格概述</h1><p id="fceb" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">混沌网格是一个开源的云原生混沌工程工具。它提供了一个方便的网络界面，您可以在其中创建您的实验。或者，您可以直接从UI或从<code class="fe no np nq nr b">.yaml </code>文件中构造它们。</p><p id="10b4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面是一个<code class="fe no np nq nr b">.yaml</code>格式的pod-kill实验示例:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ns"><img src="../Images/108f431758fcc48199a62f53a1703ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*vwpqjwB8wwpHsTA_mhFUtg.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">pod杀死示例</p></figure><p id="b1d7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它支持Kubernetes以及物理节点的各种类型的实验。我建议阅读<a class="ae kz" href="https://chaos-mesh.org/docs/" rel="noopener ugc nofollow" target="_blank">文档</a>来熟悉所有的测试。</p><p id="2f62" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以选择运行一次性实验以及预定的实验。</p><h2 id="3138" class="nt me iu bd mf nu nv dn mj nw nx dp mn lj ny nz mp ln oa ob mr lr oc od mt oe bi translated">调试工具</h2><p id="8d50" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">您想查看您的实验的日志和调试信息吗？Chaos Mesh提供了一个名为<a class="ae kz" href="https://chaos-mesh.org/docs/chaosctl-tool/" rel="noopener ugc nofollow" target="_blank"> chaosctl </a>的命令行工具。注意，目前它支持IOChaos、NetworkChaos和StressChaos场景的调试。</p><h2 id="efaf" class="nt me iu bd mf nu nv dn mj nw nx dp mn lj ny nz mp ln oa ob mr lr oc od mt oe bi translated">与GitHub操作集成</h2><p id="d02b" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">确保您的项目顺利运行的最佳方式是将检查集成到您的CI/CD管道中。你可以将混沌网格连接到<a class="ae kz" href="https://docs.github.com/en/actions" rel="noopener ugc nofollow" target="_blank"> GitHub动作</a>。<a class="ae kz" href="https://chaos-mesh.org/docs/integrate-chaos-mesh-into-github-actions/" rel="noopener ugc nofollow" target="_blank">官方指南</a>包含了几个简单步骤的配置信息。</p><h2 id="c7c5" class="nt me iu bd mf nu nv dn mj nw nx dp mn lj ny nz mp ln oa ob mr lr oc od mt oe bi translated">Grafana支架</h2><p id="f7a9" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">您可以使用数据源插件将混沌网格集成到Grafana中。当您想要可视化关于正在运行的实验的信息时，这很有用。查看关于集成过程的<a class="ae kz" href="https://chaos-mesh.org/docs/use-grafana-data-source/" rel="noopener ugc nofollow" target="_blank">指南</a>。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="4863" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">混沌网格演示实验</h1><p id="c4cb" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">首先，让我们使用一个<code class="fe no np nq nr b">kind</code>环境在Linux上安装Chaos Mesh。</p><p id="effb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="of">如果不使用</em> <code class="fe no np nq nr b"><em class="of">kind</em></code> <em class="of">，请查看</em> <a class="ae kz" href="https://chaos-mesh.org/docs/quick-start/" rel="noopener ugc nofollow" target="_blank"> <em class="of">安装指南</em> </a> <em class="of">查看其他选项如</em><code class="fe no np nq nr b"><em class="of">minikube</em></code><em class="of"/><code class="fe no np nq nr b"><em class="of">k3s</em></code><em class="of">等。</em></p><p id="85ad" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在终端中运行以下命令:</p><pre class="kk kl km kn gu og nr oh oi aw oj bi"><span id="832b" class="nt me iu nr b gz ok ol l om on">curl -sSL https://mirrors.chaos-mesh.org/v2.1.5/install.sh | bash -s -- --local kind</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oo"><img src="../Images/d32d989fbcdec02b97b521bae8124832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jZzw1ZaeyC48ittF7fui7w.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">安装混沌网格</p></figure><p id="c757" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这需要几分钟。验证安装:</p><pre class="kk kl km kn gu og nr oh oi aw oj bi"><span id="5aa1" class="nt me iu nr b gz ok ol l om on">kubectl get po -n chaos-testing</span></pre><p id="b01c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您应该看到您的pod正在运行:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj op"><img src="../Images/61cc272b78a3dcbb907dabc16048bbb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CS1CiyU5-tyEmZEVH5v3Hg.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">安装后运行pod</p></figure><p id="497a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本教程中，我们将通过用户界面创建实验。要访问Chaos仪表板，您需要启用端口转发:</p><pre class="kk kl km kn gu og nr oh oi aw oj bi"><span id="201a" class="nt me iu nr b gz ok ol l om on">kubectl port-forward -n chaos-testing svc/chaos-dashboard 2333:2333</span></pre><p id="6226" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在你应该可以通过浏览器中的<code class="fe no np nq nr b"><a class="ae kz" href="http://localhost:2333/" rel="noopener ugc nofollow" target="_blank">http://localhost:2333</a></code>访问它了。</p><p id="cc9a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以下是仪表板的快速概览:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oq"><img src="../Images/ca00c92d7cac24805754318a30f61da8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xUGLnV-5Y6NHeC8eqDh00Q.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">混沌仪表板概述</p></figure><p id="e5f8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您已有实验，您可以查看<strong class="lc iv">实验</strong>菜单下的状态:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj or"><img src="../Images/fa91721056a1a57e1cb4b3daf5c56f6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PZ7Ol8orlvBwKuH1JRTLCA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">实验细节</p></figure><p id="5345" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这个演示中，我将创建一个pod-kill测试。如下图所示，通过用户界面导航和设置实验非常直观:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj os"><img src="../Images/c1374a1220303f85d0c45f55b2e374de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*CNFGZm4QJsYQ2mqpOt6sEw.gif"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">创造一个豆荚杀死实验</p></figure><p id="92bc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">就是这样！</p><p id="82b0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在执行这个命令来查看pod状态:</p><pre class="kk kl km kn gu og nr oh oi aw oj bi"><span id="7e21" class="nt me iu nr b gz ok ol l om on">kubectl get po -n chaos-testing</span></pre><p id="b77d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你应该注意到一些豆荚被重新创建了(见<strong class="lc iv">年龄</strong> <strong class="lc iv"> 35s </strong>):</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ot"><img src="../Images/4259977d24714e460aea7ce0253dc737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qvxUTHjrjgnUn-qYAaX-eg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">重新创建的pod状态</p></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="c883" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">结论</h1><p id="7298" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在这篇文章中，我介绍了混沌网格的主要特点。您学习了如何从混沌仪表板创建实验。你现在知道为什么混沌工程是一个好的实践。</p><p id="2496" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我希望你能从这篇文章中学到一些有益的东西。感谢您的阅读，下次再见！</p></div></div>    
</body>
</html>