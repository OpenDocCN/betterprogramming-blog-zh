<html>
<head>
<title>Recreate Apple’s Breathing Animation in SwiftUI (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在SwiftUI中重现苹果的呼吸动画(第1部分)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/recreating-apples-breathing-animation-in-swiftui-part-1-3848c5558fb6?source=collection_archive---------12-----------------------#2020-05-06">https://betterprogramming.pub/recreating-apples-breathing-animation-in-swiftui-part-1-3848c5558fb6?source=collection_archive---------12-----------------------#2020-05-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a663" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">学习SwiftUI的核心概念，同时重现他们著名的呼吸UI</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2641bccbc16f9759dd09821df653af6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tv8gvfSoRM37SJrZBFDd6g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:苹果</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kv"><img src="../Images/09398dae241a12995542d50eb40aa554.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/1*cPKsuA4P2AUm1pUurpHW1g.gif"/></div></figure><p id="e7ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能已经看过并玩过Apple watch上的呼吸应用。这一系列的效果和过渡带来了惊人的体验。</p><p id="edf4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今天，我们将使用SwiftUI的基本修饰符在不到100行代码中重新创建它！</p><p id="634b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将把用户界面分为以下几个部分:</p><ul class=""><li id="fc34" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">一个可重用的组件，创建花并处理所有的动画逻辑</li><li id="86d5" class="ls lt iq ky b kz mf lc mg lf mh lj mi ln mj lr lx ly lz ma bi translated">iOS <code class="fe mb mc md me b">ContentView</code>:操控<code class="fe mb mc md me b">FlowerView</code>状态的控制室。</li></ul><p id="de36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:确保你在测试时使用的是黑暗模式，因为这是动画看起来最令人惊叹的环境。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="c815" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">创建FlowerView</h1><p id="0e82" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">让我们首先创建一个新的SwiftUI Xcode项目和一个名为<code class="fe mb mc md me b">FlowerView</code>的视图，并添加所有必要的属性:</p><ul class=""><li id="0640" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><code class="fe mb mc md me b">isMinimized</code>:跟踪动画状态的布尔值</li><li id="51e4" class="ls lt iq ky b kz mf lc mg lf mh lj mi ln mj lr lx ly lz ma bi translated"><code class="fe mb mc md me b">numberOfPetals</code>:该变量是一个Double，用于动画添加/移除花瓣</li><li id="42ed" class="ls lt iq ky b kz mf lc mg lf mh lj mi ln mj lr lx ly lz ma bi translated"><code class="fe mb mc md me b">animationDuration</code></li><li id="5bfc" class="ls lt iq ky b kz mf lc mg lf mh lj mi ln mj lr lx ly lz ma bi translated"><code class="fe mb mc md me b">circleDiameter</code>:代表每个花瓣的大小</li><li id="df4a" class="ls lt iq ky b kz mf lc mg lf mh lj mi ln mj lr lx ly lz ma bi translated"><code class="fe mb mc md me b">absolutePetalAngle</code>:圆周除以花瓣数得出每个花瓣旋转的绝对角度</li></ul><p id="f7b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您还需要更新<code class="fe mb mc md me b">FlowerView_Previews</code>并用常量初始化您的绑定属性。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="4987" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">向前到身体！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/8cf83c97c399778580cefd7e3a6604ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bbSCQrSc6GDyMCtZfM5l1A.png"/></div></div></figure><p id="a72a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">花是通过添加多个围绕花的中心点旋转和相交的圆制成的。我们将通过在<code class="fe mb mc md me b">ForEach</code> <strong class="ky ir"> </strong>的帮助下添加一个圆形数组<strong class="ky ir"> </strong>来创建它，并将它嵌入到一个<code class="fe mb mc md me b">ZStack</code>中。</p><p id="69d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">神奇的部分是，我们将使用<code class="fe mb mc md me b">.rotationEffect()</code> <strong class="ky ir"> </strong>修改器，并围绕其主要锚点(即花的中心)旋转<strong class="ky ir"> </strong>圆。</p><p id="c472" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">锚点是视图中应该固定在旋转中心位置的部分。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">花卉景观的主体</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/e8e30bc08c4d5e683999f85280adee85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tq9BgJsqv6sg130CzhkqzQ.png"/></div></div></figure><p id="de8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们需要根据圆的半径来调整<code class="fe mb mc md me b">.offset()</code>和<code class="fe mb mc md me b">ZStack</code>，因为我们想要根据花的中心而不是初始圆的中心来确定视图的中心。</p><p id="f791" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们继续之前，您还需要添加<code class="fe mb mc md me b">.animation()</code>修饰符，以便在我们更改绑定属性时使我们的视图动画化。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="3ca4" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">更新内容视图</h1><p id="80f2" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">现在我们将在屏幕上工作，让我们操纵花的属性和切换动画状态。为了简单和美观，我们将为每个视图创建一个列表和部分:</p><ul class=""><li id="1ad9" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><code class="fe mb mc md me b">FlowerView</code></li><li id="ccba" class="ls lt iq ky b kz mf lc mg lf mh lj mi ln mj lr lx ly lz ma bi translated">用于改变的滑块<code class="fe mb mc md me b">numberOfPetals</code></li><li id="f48d" class="ls lt iq ky b kz mf lc mg lf mh lj mi ln mj lr lx ly lz ma bi translated">用于改变<code class="fe mb mc md me b">breathingDuration</code>的滑块</li><li id="f670" class="ls lt iq ky b kz mf lc mg lf mh lj mi ln mj lr lx ly lz ma bi translated">用于触发动画的按钮</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">内容视图</p></figure><p id="4318" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用于操作<code class="fe mb mc md me b">numberOfPetals</code>的第一个滑块检查<em class="ns"/><em class="ns"/><code class="fe mb mc md me b">onEditingChanged</code>属性，并检测用户何时完成拖动滑块。这允许我们<code class="fe mb mc md me b">.round()</code><strong class="ky ir"/><code class="fe mb mc md me b">numberOfPetals</code>，所以我们永远不会以2.5瓣或类似的东西结束。</p><p id="29aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于按钮，我的实现有点挑剔，由<code class="fe mb mc md me b">DispatchQueues.</code>组成，这背后的原因是在花完成收缩后立即切换<code class="fe mb mc md me b">isMinimized</code> <em class="ns"> </em>，使它重新展开。</p><p id="833e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请随意创建您自己的实现；省略<code class="fe mb mc md me b">DispatchQueue</code>完全没问题。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我讨厌的按钮实现</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/f9e2491412ef7314c449c4963f03583b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iF2YeVsXQVmtLGS-n6rWNA.jpeg"/></div></div></figure></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="fc76" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">呼吸动画</h1><p id="108c" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">我们一直在等待的！这部分有点复杂，但是不要担心——swift ui让它变得轻而易举。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/a3738b45efd6f115ba78143b79031719.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/1*gUkV7F9v42PZYDqiHvIodw.gif"/></div></figure><p id="06fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将动画分成三个部分:</p><ul class=""><li id="ac0e" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">花卉视图的旋转</li><li id="fcad" class="ls lt iq ky b kz mf lc mg lf mh lj mi ln mj lr lx ly lz ma bi translated">花卉景观的规模</li><li id="745d" class="ls lt iq ky b kz mf lc mg lf mh lj mi ln mj lr lx ly lz ma bi translated">每个花瓣的旋转</li></ul><p id="a000" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要实现前两个部分，相当容易。我们将使用<code class="fe mb mc md me b">.rotationEffect()</code>和<code class="fe mb mc md me b">.scaleEffect()</code>修饰符以及三元运算符来根据<code class="fe mb mc md me b">isMinimized</code>状态改变值。</p><p id="b89a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将此添加到来自<code class="fe mb mc md me b">FlowerView</code>的<code class="fe mb mc md me b">.animation()</code>修改器上方。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/fed8ce074b48e6792d7fc8a9fc2e9717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*w1z9P6qkZhNvW9O46nzjvw.gif"/></div></figure><p id="1c50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要创建所有花瓣都来到中心的效果，只需将锚点从每个花瓣的<code class="fe mb mc md me b">.rotationEffect()</code>更改为<code class="fe mb mc md me b">.center</code>即可。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="20d4" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">瞧啊。</h1><p id="0577" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">我们只写了不到100行代码，我们已经有了一些看起来与我们的目标极其相似的东西。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/a2af59ff3a603e50c550ab5eb4d7c393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/1*9oaGe5UMYdA4RI38oYIE2g.gif"/></div></figure></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="8e66" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">还有一件事…</h1><p id="e586" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">我们可以做一件事来进一步改进这个动画。如果你仔细看，每当我们添加或删除一个花瓣，它立即出现在屏幕上。让我们试着解决这个问题。</p><p id="0aa5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了快速解决这个问题，我们将总是展示一个额外的花瓣，准备动画其不透明度。根据花瓣的位置计算alpha值涉及到一点数学问题，但是不要担心，我已经为你想好了一切。</p><p id="d670" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们对<code class="fe mb mc md me b">FlowerView</code>进行这些更改。确保将<code class="fe mb mc md me b">ForEach</code>的范围从<code class="fe mb mc md me b">0&lt;Int(numberOfPetals)</code>修改为<code class="fe mb mc md me b">0…Int(numberOfPetals)</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="32dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们也给<code class="fe mb mc md me b">ContentView</code>添加一个专用的<code class="fe mb mc md me b">petalDuration</code> <em class="ns"> </em>属性，它只用于这个微妙的动画。为了确保正常工作，您需要在<code class="fe mb mc md me b">breathDuration </code>和<code class="fe mb mc md me b">petalDuration</code>之间动态切换。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/bc75d5ce1dcc5dcc0bf0cfeae8a4232c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*OcQnNCQEo-xXqHmaH2x73w.gif"/></div></figure></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="dd83" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">结论</h1><p id="481f" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">我做这个项目是为了展示开始使用SwiftUI和动画是多么简单。这种疯狂的力量来自函数式编程范式和数据绑定，它们完美地协调工作，使您的代码保持更新和流畅！</p><p id="2a6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想在这个项目上更进一步，你可以看看这个教程的第二部分，在那里我们探索了如何创建出血模糊效果，并讨论了视图转换。</p><p id="d976" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你只对源代码感兴趣，这里有<a class="ae nx" href="https://github.com/Pondorasti/WatchOSBreathingAnimation" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>。</p></div></div>    
</body>
</html>