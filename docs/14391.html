<html>
<head>
<title>Flow Blockchain and Cadence Language — Learn the Best Practices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">流区块链和Cadence语言—了解最佳实践</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/flow-blockchain-and-cadence-language-learn-best-practices-f4678b8c2bcb?source=collection_archive---------6-----------------------#2022-12-07">https://betterprogramming.pub/flow-blockchain-and-cadence-language-learn-best-practices-f4678b8c2bcb?source=collection_archive---------6-----------------------#2022-12-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9b15" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">看看最佳实践、模式和反模式</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/36617eb01298bdc0db61c6d2d6a12f90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cfROSEnt_mpTr590lHwwpg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://www.pexels.com/photo/red-and-brass-dart-pin-on-dartboard-226569/" rel="noopener ugc nofollow" target="_blank">来自像素的图像</a></p></figure><p id="7ea8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个系列文章中，<a class="ae kv" href="https://medium.com/better-programming/an-introduction-to-the-flow-blockchain-60ccc7a35598" rel="noopener">向您介绍了区块链流</a>，它的<a class="ae kv" href="https://medium.com/better-programming/smart-contracts-which-is-better-ethereum-or-flow-39f766c72e5d" rel="noopener">智能合同语言Cadence </a>，以及一些开发人员应该知道的最<a class="ae kv" href="https://medium.com/better-programming/an-overview-of-the-tools-for-developing-on-flow-cadence-24bfe3b34d83" rel="noopener">基本工具</a>，所有这些都与以太坊进行了比较和对比。</p><p id="e011" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将讨论使用Cadence语言和在Flow network上开发解决方案时应遵循的最佳实践和模式，以及应避免的模式。</p><h1 id="778f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">最佳实践</h1><h2 id="22da" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">使用流量测试网络和流量模拟器</h2><p id="89aa" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">开发任何区块链最重要的步骤之一是在模拟环境中测试您的项目。流动区块链也不例外。为此,<a class="ae kv" href="https://developers.flow.com/learn/concepts/accessing-testnet" rel="noopener ugc nofollow" target="_blank"> Flow testnet </a>和<a class="ae kv" href="https://developers.flow.com/tools/emulator" rel="noopener ugc nofollow" target="_blank"> Flow Emulator </a>是包含在您的开发流程中的关键组件。它们不仅让您了解您的dapp将如何执行，而且还将帮助您在部署到mainnet之前捕获任何关键的bug。</p><h2 id="acb2" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">使用标准合同</h2><p id="54ae" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">任何区块链最常见的两个用例是数字货币和通过NFTs提供数字所有权的证明。流开发人员应该始终导入正式的核心合同，以确保用户安全以及与网络其余部分的一致性，而不是试图从头开始重写必要的合同。</p><p id="a03e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目前您应该使用三种标准合同:</p><ul class=""><li id="de90" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated"><a class="ae kv" href="https://developers.flow.com/flow/core-contracts/fungible-token" rel="noopener ugc nofollow" target="_blank">可替换令牌</a> —用于创建新令牌</li><li id="959e" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><a class="ae kv" href="https://developers.flow.com/flow/core-contracts/non-fungible-token" rel="noopener ugc nofollow" target="_blank">不可替换令牌</a> —用于创建NFT</li><li id="f427" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><a class="ae kv" href="https://developers.flow.com/flow/core-contracts/nft-metadata" rel="noopener ugc nofollow" target="_blank">元数据视图</a> —用作NFTs的元数据模式</li></ul><p id="fd46" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些契约本质上是接口，迫使实现它们的人添加他们的变量和方法声明，使它们能够与流生态系统中的其他智能契约互操作。它们已经存在于testnet和mainnet网络上，所以在你的合同中实现它们时，一定要从上面链接的官方地址导入。</p><p id="15ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在流程文档中找到其他核心合同<a class="ae kv" href="https://developers.flow.com/flow/core-contracts" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="fce6" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">为您的智能合约、交易和脚本创建测试</h2><p id="6207" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><a class="ae kv" href="https://github.com/onflow/flow-js-testing" rel="noopener ugc nofollow" target="_blank">流JavaScript测试框架</a>对于测试合同的部署场景至关重要。然而，需要注意的是，您需要在后台运行<a class="ae kv" href="https://developers.flow.com/tools/flow-cli" rel="noopener ugc nofollow" target="_blank">流命令行界面</a>来获得完整的功能。有了这些，您可以测试创建新帐户、发送事务、运行查询、执行脚本等等。此外，它与流模拟器集成，以创建、运行和停止模拟器实例。</p><h2 id="6fb4" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">将您的合同添加到Flow NFT目录</h2><p id="5a71" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><a class="ae kv" href="https://www.flow-nft-catalog.com/" rel="noopener ugc nofollow" target="_blank">流NFT目录</a>作为存储NFT合同和元数据的数据库而存在。通过上传你的合同，你的NFTs可以和其他的Flow生态系统互操作，其他开发者可以很容易地在他们的市场或其他dapps中支持你的收藏。</p><p id="3ded" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以<a class="ae kv" href="https://www.flow-nft-catalog.com/v" rel="noopener ugc nofollow" target="_blank">将您的合同添加到目录</a>中，方法是完成一个简单的四步流程，该流程需要选择合同、获取附加信息、检查元数据，然后将流NFT添加到目录中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/23af6294c132cdb589b8e651bc943e53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*lHuOj8ECKLltsg6s16mNhw.png"/></div></figure><h2 id="9543" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">具体到类型</h2><p id="31dc" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">Cadence是一种<a class="ae kv" href="https://www.techopedia.com/definition/24434/strongly-typed" rel="noopener ugc nofollow" target="_blank">强</a>和<a class="ae kv" href="https://www.techopedia.com/definition/22321/statically-typed" rel="noopener ugc nofollow" target="_blank">静态</a>类型化语言，允许开发者指定哪些类型包含或返回变量、接口和函数。所以你在做申报的时候要尽量具体；仅在必要的情况下使用泛型类型。不这样做可能会导致笨拙的错误。</p><h2 id="b705" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">访问控制</h2><p id="0d89" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">只要有可能，您应该仔细考虑访问控制。幸运的是，在流区块链上，调用者无法在没有引用的情况下访问另一个用户的帐户存储中的对象。这被称为基于引用的安全性，这意味着默认情况下没有任何东西是真正公共的。</p><p id="9d1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，在编写Cadence代码时，在声明变量、结构、函数、资源等时必须小心。开发人员可以在声明中包含四个级别的访问控制:</p><ul class=""><li id="3c62" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated"><code class="fe nq nr ns nt b">pub/access(all) </code> —在所有范围内可访问/可见</li><li id="51a9" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><code class="fe nq nr ns nt b">access(account) </code> —只能在其定义的整个账户中访问(同一账户中的其他合同可以访问)</li><li id="c351" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><code class="fe nq nr ns nt b">access(contract)</code> —仅在定义的合同范围内可访问(不能在合同之外访问)</li><li id="db69" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated"><code class="fe nq nr ns nt b">priv/access(self)</code> —仅在当前和内部范围内可访问</li></ul><p id="5f47" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽可能避免使用pub/access(all)。查看<a class="ae kv" href="https://developers.flow.com/cadence/language/access-control" rel="noopener ugc nofollow" target="_blank">的流程文档，了解更多关于访问控制</a>的信息。</p><h2 id="a139" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">在协定中创建StoragePath和PublicPath常量</h2><p id="f857" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">契约资源的路径非常重要，必须在所有事务和脚本中保持一致。为了确保一致性，你应该为<code class="fe nq nr ns nt b">PublicPath</code>和<code class="fe nq nr ns nt b">StoragePath</code>创建常量。</p><pre class="kg kh ki kj gt nu nt nv bn nw nx bi"><span id="e364" class="ny lt iq nt b be nz oa l ob oc">pub contract BestPractices {<br/> pub let CollectionStoragePath: StoragePath<br/> pub let CollectionPublicPath: PublicPath</span></pre><pre class="od nu nt oe of aw og bi"><span id="9a39" class="mk lt iq nt b gy oh oi l oj oc"> init(){<br/>  self.CollectionStoragePath = /storage/bestPracticesCollection<br/>  self.CollectionPublicPath = /public/bestPracticesCollection<br/> }<br/>}</span></pre><p id="9b12" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当您创建一个使用这些路径之一的事务时，您只需要用导入的契约调用它各自的变量来引用所需的路径。</p><pre class="kg kh ki kj gt nu nt nv bn nw nx bi"><span id="7e2f" class="ny lt iq nt b be nz oa l ob oc">//This script checks if a user has the public Collection from BestPractices contract<br/>import BestPractices from 0x...</span></pre><pre class="od nu nt oe of aw og bi"><span id="7fbd" class="mk lt iq nt b gy oh oi l oj oc">pub fun main(addr: Address): Bool {<br/> return getAccount(addr).getLinkTarget(BestPractices.CollectionPublicPath) != nil<br/>}</span></pre><h2 id="f9ab" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">管理资源</h2><p id="631f" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">创建一个管理资源是一个很好的实践，该管理资源包含执行契约下的操作的特定函数，比如一个mint函数。这种约定确保只有拥有该资源或能力的帐户才能执行管理功能。</p><pre class="kg kh ki kj gt nu nt nv bn nw nx bi"><span id="4654" class="ny lt iq nt b be nz oa l ob oc">pub contract BestPractices {<br/> pub let CollectionStoragePath: StoragePath<br/> pub let CollectionPublicPath: PublicPath<br/> pub let AdminStoragePath: StoragePath</span></pre><pre class="od nu nt oe of aw og bi"><span id="b29c" class="mk lt iq nt b gy oh oi l oj oc"> pub resource AdminResource {<br/>  pub fun mintNFT(){<br/>   //your mint NFT code here! <br/>  }<br/> }</span><span id="7cc1" class="mk lt iq nt b gy ok oi l oj oc"> init(){<br/>  self.CollectionStoragePath = /storage/bestPracticesCollection<br/>  self.CollectionPublicPath = /public/bestPracticesCollection<br/>  self.AdminStoragePath = /storage/bestPracticesAdmin<br/>  <br/>  //Create the adminResource and store it inside Contract Deployer account<br/>  let adminResource &lt;- create AdminResource()<br/>  self.account.save(&lt;- adminResource, to: self.AdminStoragePath)<br/> }<br/>}</span></pre><h2 id="e623" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">创建自定义事件</h2><p id="8897" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">事件是可以在执行Cadence代码期间发出的值。例如，当在契约中定义重要的操作时，您可以发出事件来表示它们的完成或交付特定的值。因此，与智能合约交互的事务可以通过这些事件接收附加信息。</p><pre class="kg kh ki kj gt nu nt nv bn nw nx bi"><span id="16d2" class="ny lt iq nt b be nz oa l ob oc">pub contract BestPractices {<br/> pub let CollectionStoragePath: StoragePath<br/> pub let CollectionPublicPath: PublicPath<br/> pub let AdminStoragePath: StoragePath</span></pre><pre class="od nu nt oe of aw og bi"><span id="cb69" class="mk lt iq nt b gy oh oi l oj oc">//Create your own events<br/>pub event AdminCreated()</span><span id="0542" class="mk lt iq nt b gy ok oi l oj oc"> pub resource AdminResource {<br/>  pub fun mintNFT(){<br/>   //your mint NFT code here! <br/>  }<br/> }</span><span id="d850" class="mk lt iq nt b gy ok oi l oj oc"> init(){<br/>  self.CollectionStoragePath = /storage/bestPracticesCollection<br/>  self.CollectionPublicPath = /public/bestPracticesCollection<br/>  self.AdminStoragePath = /storage/bestPracticesAdmin<br/>  <br/>  //Create the adminResource and store it inside Contract Deployer account<br/>  let adminResource &lt;- create AdminResource()<br/>  self.account.save(&lt;- adminResource, to: self.AdminStoragePath)<br/> }<br/>}</span></pre><h1 id="b707" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Cadence/Flow区块链上的模式</h1><h2 id="971c" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">特定于类型约束中的类型</h2><p id="969a" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">Cadence语言最强大的特性之一无疑是<a class="ae kv" href="https://developers.flow.com/cadence/language/capability-based-access-control" rel="noopener ugc nofollow" target="_blank">功能</a>。通过能力，资源访问的范围扩大了。</p><p id="8b58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建功能时，重要的一点是指定您的资源的哪些特性应该对其他人可用。这可以在使用类型约束创建链接时完成。</p><p id="1803" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本例中，我们使用<a class="ae kv" href="https://github.com/onflow/flow-nft/blob/master/contracts/ExampleNFT.cdc" rel="noopener ugc nofollow" target="_blank"> ExampleNFT契约</a>来创建一个基本功能，其中任何想要接收ExampleNFT的帐户都必须有一个集合。</p><pre class="kg kh ki kj gt nu nt nv bn nw nx bi"><span id="3d9f" class="ny lt iq nt b be nz oa l ob oc">import NonFungibleToken from 0x...<br/>import ExampleNFT from 0x...</span></pre><pre class="od nu nt oe of aw og bi"><span id="0e0d" class="mk lt iq nt b gy oh oi l oj oc">transaction{<br/> prepare(acct: AuthAccount){<br/>  let collection &lt;- ExampleNFT.createEmptyCollection()<br/>    // Put the new collection in storage<br/>   acct.save(&lt;-collection, to: ExampleNFT.CollectionStoragePath)<br/>    // Create a public Capability for the collection<br/>    acct.link&lt;&amp;ExampleNFT.Collection{ExampleNFT.CollectionPublic}&gt;(ExampleNFT.CollectionPublicPath, target: ExampleNFT.CollectionStoragePath)<br/> }<br/>}</span></pre><p id="e491" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nt b">&amp;ExampleNFT</code>中的<code class="fe nq nr ns nt b">&amp;</code>符号表示我们正在使用一个<a class="ae kv" href="https://developers.flow.com/cadence/language/references" rel="noopener ugc nofollow" target="_blank">参考</a>。在引用符号之后，我们添加我们创建的功能将访问的类型。在这一点上，我们需要尽可能具体。</p><p id="db4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种模式增强了安全性，并限制了调用该功能的<code class="fe nq nr ns nt b">borrow</code>函数的用户可以使用的功能。</p><p id="692d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">省略<code class="fe nq nr ns nt b">{ExampleNFT.CollectionPublic}</code>类型将允许您访问<code class="fe nq nr ns nt b">ExampleNFT.Collection</code>引用中的所有函数，包括撤销函数，因此任何人都可以访问用户的集合并窃取他们的NFT。</p><h2 id="5617" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">使用借用功能</h2><p id="c2c0" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">要使用资源的特性，您可以调用<code class="fe nq nr ns nt b">Load</code>函数从帐户中删除资源，使用它的特性，并调用<code class="fe nq nr ns nt b">Save</code>函数再次保存它。然而，这种方法成本高且效率低。</p><p id="55b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为避免这种情况，请使用<code class="fe nq nr ns nt b">borrow</code>功能。它允许您使用对正在调用的资源的引用。这种方法使你的交易更有效率和成本效益。</p><h2 id="1db0" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">使用check和getLinkTarget函数</h2><p id="5177" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">在流量区块链上构建应用时，你会发现用户的账号起着至关重要的作用。与以太坊等其他区块链不同，Flow将资源、资产等更直接地存储在用户的账户中，而不是作为对公共数字账本上的地址的引用。</p><p id="cddb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种方法要求帐户有一个特定的存储位置，如可替换令牌的集合或保管库。然而，这也增加了复杂性。必须确保用户的帐户中有或没有收藏。</p><p id="537d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">向用户帐户添加集合和功能时，必须使用<code class="fe nq nr ns nt b">check()</code>函数(检查给定路径中是否存在功能)和<code class="fe nq nr ns nt b">getLinkTarget()</code>函数(返回给定功能的路径)。这些函数确保事务执行时没有问题。</p><h2 id="0616" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">利用恐慌</h2><p id="63cf" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">Panic是Cadence中的一个内置功能，允许您无条件终止程序。这可能发生在智能合约代码的执行过程中，并返回一条错误消息，这使得更容易理解什么时候事情没有按预期进行。</p><p id="ce2c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在声明变量时，可以将它们定义为可选的，这意味着如果它们不是指定的类型，它们的值为nil。</p><p id="4d84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在Cadence中，当查询返回可选变量的特定变量或函数的值时，可以使用两个问号后跟<code class="fe nq nr ns nt b">panic("treatment message")</code>函数。</p><pre class="kg kh ki kj gt nu nt nv bn nw nx bi"><span id="c578" class="ny lt iq nt b be nz oa l ob oc">let optionalAccount: AuthAccount? = //...<br/>let account = optionalAccount ?? panic("missing account")</span></pre><p id="d28a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个命令<code class="fe nq nr ns nt b">??panic("treatment message") </code>试图返回指定类型的值。如果返回值是错误的类型或nil，则执行中止，并且所选的处理消息显示在控制台上。</p><h1 id="87aa" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">反模式</h1><p id="c580" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">虽然Cadence旨在避免在其他区块链生态系统中发现的许多潜在错误和漏洞，但开发人员在构建时应该了解一些反模式。下面列出了一些需要考虑的重要因素。要获得完整的反模式列表，<a class="ae kv" href="https://developers.flow.com/cadence/anti-patterns" rel="noopener ugc nofollow" target="_blank">查看流程文档</a>。</p><h2 id="6289" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">使用借入函数时未指定类型</h2><p id="4d66" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">开发人员应该使用上面提到的借用功能来利用功能中可用的特性。然而，应该清楚的是，用户可以在他们的存储器中存储任何东西。因此，确保所借的是正确的类型是至关重要的。</p><p id="b114" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不指定类型是一种反模式，最终会导致事务和应用程序出错甚至崩溃。</p><pre class="kg kh ki kj gt nu nt nv bn nw nx bi"><span id="0c3d" class="ny lt iq nt b be nz oa l ob oc">//Bad Practice. Should be avoided<br/>let collection = getAccount(address).getCapability(ExampleNFT.CollectionPublicPath)<br/>                    .borrow&lt;&amp;ExampleNFT.Collection&gt;()?? panic("Could not borrow a reference to the nft collection")</span></pre><pre class="od nu nt oe of aw og bi"><span id="621c" class="mk lt iq nt b gy oh oi l oj oc">//Correct! <br/>let collection = getAccount(address).getCapability(ExampleNFT.CollectionPublicPath)<br/>                    .borrow&lt;&amp;ExampleNFT.Collection{NonFungibleToken.CollectionPublic}&gt;()<br/>                    ?? panic("Could not borrow a reference to the nft collection")</span></pre><h2 id="4607" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">使用AuthAccount作为函数参数</h2><p id="f264" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">对于准备阶段的交易，可以访问用户的<code class="fe nq nr ns nt b">AuthAccount</code>字段。该对象允许提供它的用户访问内存存储和帐户的所有其他私有区域。</p><p id="e87b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将此字段作为参数传递是不必要的，应该避免，因为需要此方法的情况非常少见。</p><pre class="kg kh ki kj gt nu nt nv bn nw nx bi"><span id="7eb2" class="ny lt iq nt b be nz oa l ob oc">//Bad Practice. Should be avoided</span></pre><pre class="od nu nt oe of aw og bi"><span id="d6bf" class="mk lt iq nt b gy oh oi l oj oc">transaction() {<br/> prepare(acct: AuthAccount){<br/>  //You take sensitive and important user data out of the scope of the transaction prepare phase<br/>  ExampleNFT.function(acct: acct)<br/> }<br/>}</span></pre><h2 id="9140" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">对字典和数组使用公共访问控制</h2><p id="a752" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">通过在带有<code class="fe nq nr ns nt b">pub/access(all)</code>作用域的契约中存储字典和数组变量，您的智能契约变得易受攻击，因为任何人都可以操纵和更改这些值。</p><h2 id="20a2" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">使用auth关键字创建功能和引用</h2><p id="c681" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">使用<code class="fe nq nr ns nt b">auth</code>关键字创建功能和引用会将值暴露给向下转换，这可能会提供对原本不打算使用的功能的访问。</p><pre class="kg kh ki kj gt nu nt nv bn nw nx bi"><span id="975f" class="ny lt iq nt b be nz oa l ob oc">//AVOID THIS!<br/>signer.link&lt;auth &amp;ExampleNFT.CollectionPublic{NonFungibleToken.Receiver}&gt;(<br/>    /public/exampleNFT,<br/>    target: /storage/exampleNFT<br/>)</span></pre><h1 id="3707" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="fff9" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">当使用Cadence在流区块链上开发时，了解设计模式、反模式和最佳实践会有所帮助。</p><p id="8376" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过遵循这些最佳实践，我们可以确保整个流程生态系统的一致安全级别，从而为用户提供最佳体验。为了更全面的理解，<a class="ae kv" href="https://developers.flow.com/cadence/design-patterns" rel="noopener ugc nofollow" target="_blank">通读流程文档</a>。</p><p id="f774" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">祝你今天过得愉快！</p></div></div>    
</body>
</html>