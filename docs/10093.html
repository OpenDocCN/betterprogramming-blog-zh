<html>
<head>
<title>Everything You Need to Know About Databases in Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于Flask中的数据库，您需要了解的一切</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/everything-you-need-to-know-about-databases-in-flask-3c7cf44ad6fe?source=collection_archive---------3-----------------------#2021-11-26">https://betterprogramming.pub/everything-you-need-to-know-about-databases-in-flask-3c7cf44ad6fe?source=collection_archive---------3-----------------------#2021-11-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fae9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过数据库为您的Flask应用程序添加功能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1ca3f231c14bf81399d39b8825f9c2b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jxyqXlAsH2ky6xPDfJVNsg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@writecodenow?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Boitumelo Phetla </a>在<a class="ae ky" href="https://unsplash.com/s/photos/database?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2be1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使应用程序中的数据有意义，它需要以某种方式相关联，考虑你最喜欢的社交媒体，作为一个用户，你有一个专用空间来发布照片和视频等内容，你甚至可以通过赞、直接消息等与其他用户互动。</p><h1 id="652e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">关系数据库</h1><p id="d364" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">关系数据库用于数据管理。关系数据库由表示实体的表组成。它们还表示实体之间的关系。比如一个艺人可以有不同的专辑，一个人可以有很多爱好等等。</p><h1 id="2072" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据库模式</h1><p id="1afd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">数据库模式描述了对象的表示方式。考虑下面描述两个表之间关系的图像</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/d24ed07c967bcf36ec01814aa7dfa478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3grAcLFmOiVkDU1ayzkQ5w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据库模式</p></figure><h1 id="749d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">烧瓶化学</h1><p id="ffc6" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">根据<a class="ae ky" href="https://flask-sqlalchemy.palletsprojects.com/en/2.x/" rel="noopener ugc nofollow" target="_blank">文档</a>:</p><blockquote class="mt mu mv"><p id="1967" class="kz la mw lb b lc ld ju le lf lg jx lh mx lj lk ll my ln lo lp mz lr ls lt lu im bi translated">Flask-SQLAlchemy是对<a class="ae ky" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Flask </a>的扩展，为您的应用程序增加了对<a class="ae ky" href="https://www.sqlalchemy.org/" rel="noopener ugc nofollow" target="_blank"> SQLAlchemy </a>的支持。它旨在通过提供有用的缺省值和额外的帮助器来简化SQLAlchemy与Flask的使用，从而更容易完成常见任务。</p></blockquote><h1 id="1b59" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用Flask-SQLAlchemy创建Flask应用程序</h1><p id="d1be" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为您的应用程序创建一个目录，并创建一个虚拟环境。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="7cbd" class="nf lw it nb b gy ng nh l ni nj">mkdir flaskdb<br/>python3.8 -m venv env</span></pre><p id="c4b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">激活虚拟环境并创建文件<code class="fe nk nl nm nb b"> app.py</code></p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="24e8" class="nf lw it nb b gy ng nh l ni nj">source env/bin/activate<br/>touch app.py</span></pre><p id="f484" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过pip安装Flask和flask_sqlachemy</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="a840" class="nf lw it nb b gy ng nh l ni nj">pip3 install Flask-SQLAlchemy<br/>pip3 install Flask</span></pre><p id="7198" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<code class="fe nk nl nm nb b">app.py</code>，导入<code class="fe nk nl nm nb b">Flask</code>和<code class="fe nk nl nm nb b">SQLAlchemy</code>。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="e5ff" class="nf lw it nb b gy ng nh l ni nj">from flask import Flask</span><span id="c677" class="nf lw it nb b gy nn nh l ni nj">from flask_sqlalchemy import SQLAlchemy</span></pre><p id="ffef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后创建Flask应用程序实例。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="700d" class="nf lw it nb b gy ng nh l ni nj">app = Flask(__name__)</span></pre><h2 id="5d9c" class="nf lw it bd lx no np dn mb nq nr dp mf li ns nt mh lm nu nv mj lq nw nx ml ny bi translated">数据库配置</h2><p id="ce01" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有几个数据库可以用，比如SQLite，MYSQl或者Postgres。在我们的例子中，我们将使用SQLite，因为它轻量级且易于使用。<br/>我们首先指定数据库文件的路径名，并使用<code class="fe nk nl nm nb b">SQLAchemy</code>类创建一个数据库实例。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="a3a7" class="nf lw it nb b gy ng nh l ni nj">app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///mydb.db'<br/>db = SQLAlchemy(app)</span></pre><h2 id="8ef1" class="nf lw it bd lx no np dn mb nq nr dp mf li ns nt mh lm nu nv mj lq nw nx ml ny bi translated">按指定路线发送</h2><p id="c276" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">让我们添加一个显示“Hello World”的简单路由。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="f5e8" class="nf lw it nb b gy ng nh l ni nj">@app.route('/home')</span><span id="3d71" class="nf lw it nb b gy nn nh l ni nj">def home():</span><span id="821f" class="nf lw it nb b gy nn nh l ni nj">    return "Hellow World."</span></pre><p id="0029" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您运行应用程序时，您应该会看到以下内容。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="40c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要抑制该警告，将<code class="fe nk nl nm nb b">SQLALCHEMY_TRACK_MODIFICATIONS</code>设置为假</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="3ebc" class="nf lw it nb b gy ng nh l ni nj">app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False</span></pre><p id="5f62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再次运行服务器并导航到<a class="ae ky" href="http://127.0.0.1:5000/home" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:5000/home，</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/cce65df811a9d62e7acdbed10267daa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Hre8jZHcUqao7Y5_odDuQ.png"/></div></div></figure><h1 id="1f2b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建模型</h1><p id="9051" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们在上面创建的db实例存储了基类(db。模型)用于所有模型。它还包含来自<code class="fe nk nl nm nb b">sqlalchemy</code>和<code class="fe nk nl nm nb b">sqlalchemy.orm</code>的所有函数和助手。</p><p id="ac83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基类(<code class="fe nk nl nm nb b">db.Models</code>)用于声明模型。我们将为我们的应用程序创建两个模型，即<code class="fe nk nl nm nb b">Book</code>和<code class="fe nk nl nm nb b">Author</code>模型。这两者之间的关系如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/3427b5c29096a268ff0635a98b878482.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p_ZFIAdLjBboufZsFJ1E7w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据库模式</p></figure><p id="adc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="8cad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面的代码中，在模型类名中，我们声明属性等于<code class="fe nk nl nm nb b">db.Column()</code>。<code class="fe nk nl nm nb b">db.Column()</code>采用以下属性</p><ul class=""><li id="2199" class="ob oc it lb b lc ld lf lg li od lm oe lq of lu og oh oi oj bi translated">数据类型</li><li id="24af" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated">主关键字</li><li id="99ed" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated">限制</li><li id="7661" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated">系统默认值</li></ul><p id="dff6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm nb b">__repr__</code>函数为我们的模型提供了人类可读的表示</p><h2 id="14e9" class="nf lw it bd lx no np dn mb nq nr dp mf li ns nt mh lm nu nv mj lq nw nx ml ny bi translated">模型之间的关系</h2><p id="afe4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们知道一个作者可以有很多本书；我们如何在数据库中声明关系？。幸运的是，SQLAlchemy提供了用于声明关系的<code class="fe nk nl nm nb b">db.relationship()</code>方法。<br/>为了声明<code class="fe nk nl nm nb b">Author</code>和<code class="fe nk nl nm nb b">Book</code>模型之间的一对多关系，在<code class="fe nk nl nm nb b">Author</code>模型中添加一个field books</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="8fd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们先注明与图书型号的关系，并添加一个<code class="fe nk nl nm nb b">backref</code>作者。一个<code class="fe nk nl nm nb b">backref</code>在Author类上声明了一个新属性，这样我们就可以使用<code class="fe nk nl nm nb b">author.books</code>来获取特定作者的书籍。惰性属性定义了如何从数据库<br/>中加载数据。到目前为止，我们在<code class="fe nk nl nm nb b">Author</code>和<code class="fe nk nl nm nb b">Book</code>之间有一对多的关系；我们还需要在关系的多端指定外键(即<code class="fe nk nl nm nb b">Book</code>模型)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="5794" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，您的<code class="fe nk nl nm nb b">app.py </code>文件应该如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="b28f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建数据库</h1><p id="42fa" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在模型类之后，用<code class="fe nk nl nm nb b">db.create_all()</code>命令初始化数据库。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="238d" class="nf lw it nb b gy ng nh l ni nj">db.create_all()</span></pre><p id="8f84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以通过交互式shell提示符来完成，首先发出命令。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="6cdc" class="nf lw it nb b gy ng nh l ni nj">python3</span></pre><p id="7df5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的终端应该是这样的:<code class="fe nk nl nm nb b"><br/>Python 3.8.9 (default, Apr 3 2021, 01:02:10) <br/>[GCC 5.4.0 20160609] on linux<br/>Type “help”, “copyright”, “credits” or “license” for more information.<br/>&gt;&gt;&gt;</code></p><p id="1503" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，导入<code class="fe nk nl nm nb b">db</code>并从声明的模型中创建表格。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="0c26" class="nf lw it nb b gy ng nh l ni nj">&gt;&gt;&gt; from app import db<br/>&gt;&gt;&gt; db.create_all()</span></pre><p id="bfc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">命令<code class="fe nk nl nm nb b">db.create_all()</code>在数据库中创建实际的表格。另外，文件<code class="fe nk nl nm nb b">mydb.db</code>应该出现在您的项目目录中。现在可以开始用图书和作者条目填充数据库了。</p><h1 id="41ad" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建数据库条目</h1><p id="b202" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要用终端创建一本书或作者实例，首先导入<code class="fe nk nl nm nb b">db</code>，以及模型类。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="c4bd" class="nf lw it nb b gy ng nh l ni nj">&gt;&gt;&gt; from app import app Book, Author</span></pre><p id="bbd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用<code class="fe nk nl nm nb b">id = 1</code>创建一个名为author1的作者对象，他的名字是John Doe，电子邮件地址是johndoe@gmail.com<a class="ae ky" href="http://johndoe@gmail.com" rel="noopener ugc nofollow" target="_blank"/>。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="abee" class="nf lw it nb b gy ng nh l ni nj">&gt;&gt;&gt; a1 = Author(id = 1, first_name = "john" , last_name = "doe", email = "johndo@gmail.com")</span><span id="e96f" class="nf lw it nb b gy nn nh l ni nj">&gt;&gt;&gt; db.session.add(a1)</span><span id="463c" class="nf lw it nb b gy nn nh l ni nj">&gt;&gt;&gt; db.commit()</span></pre><p id="ba15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用python点符号查询作者的详细信息。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="1888" class="nf lw it nb b gy ng nh l ni nj">&gt;&gt;&gt; a1<br/>&lt;Author 1&gt;<br/>&gt;&gt;&gt; a1<br/>&lt;Author 1&gt;<br/>&gt;&gt;&gt; a1.first_name<br/>'john'<br/>&gt;&gt;&gt;</span></pre><h1 id="08a1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建具有关系的数据库条目</h1><p id="b9b4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">假设我们上面创建的作者(John Doe)是书名为Alembic的书的作者。让我们在数据库中创建关系。<br/>用<code class="fe nk nl nm nb b">id = 1</code>创作一本<code class="fe nk nl nm nb b">object</code>叫做<code class="fe nk nl nm nb b">book1</code>的书，书名是Alembic，发行年份是1990年。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="7db8" class="nf lw it nb b gy ng nh l ni nj">&gt;&gt;&gt; b1 = Book(id = 1, title = "ALEMBIC", year = "1990", author_id = a1.id)</span><span id="e8f2" class="nf lw it nb b gy nn nh l ni nj">&gt;&gt;&gt; db.session.add(b1)</span><span id="bd2f" class="nf lw it nb b gy nn nh l ni nj">&gt;&gt;&gt; db.session.commit()</span></pre><p id="bf48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果您查询Author 1已经创建的书籍，您应该得到下面的查询对象。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="fcb5" class="nf lw it nb b gy ng nh l ni nj">&gt;&gt;&gt; a1 = Author(id =1)<br/>&gt;&gt;&gt; a1<br/>&gt;&gt;&gt; a1_books = a1.books<br/>&gt;&gt;&gt; a1_books<br/>&lt;sqlalchemy.orm.dynamic.AppenderBaseQuery object at 0x7f1eab5e7280&gt;</span></pre><p id="368f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，数据库已经在<code class="fe nk nl nm nb b">Author</code>和<code class="fe nk nl nm nb b">Book</code>模型之间创建了一个关系。</p><h1 id="ba16" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据库查询</h1><p id="b0d3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">SQLAlchemy模型类提供了<code class="fe nk nl nm nb b">query</code>属性，用于查询数据库表。</p><p id="f7a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Flask中有两种方法执行查询。</p><ul class=""><li id="fab9" class="ob oc it lb b lc ld lf lg li od lm oe lq of lu og oh oi oj bi translated"><code class="fe nk nl nm nb b">query.get()</code> — <code class="fe nk nl nm nb b">query.get()</code>只会从数据库中提取1个对象，否则会导致错误。</li><li id="ad73" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated"><code class="fe nk nl nm nb b">query.all()</code> — <code class="fe nk nl nm nb b">query.all()</code>将获取多个对象。</li></ul><p id="462a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个新文件<code class="fe nk nl nm nb b">query.py</code>，我们将在其中执行查询。导入顶部的<code class="fe nk nl nm nb b">db</code>、<code class="fe nk nl nm nb b">Author</code>和<code class="fe nk nl nm nb b">Book</code>型号。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="19df" class="nf lw it nb b gy ng nh l ni nj">#query.py</span><span id="4a3f" class="nf lw it nb b gy nn nh l ni nj">from app import db, Author, Book</span></pre><p id="fae4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您想从数据库中获取特定的信息；你会怎么做？。比如用<code class="fe nk nl nm nb b">id = 1</code>获取作者的姓氏。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="b2f7" class="nf lw it nb b gy ng nh l ni nj">author1 = Author.query.get(1)<br/><br/>print(author1.last_name)</span><span id="923c" class="nf lw it nb b gy nn nh l ni nj"># Result </span><span id="3d2b" class="nf lw it nb b gy nn nh l ni nj">'doe'<br/></span></pre><p id="354a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要获取数据库中的所有书籍:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">app.py</p></figure><p id="dc4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述查询的结果是:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="8433" class="nf lw it nb b gy ng nh l ni nj">The book ALEMBIC was published in 1990<br/>The book Comedy of Errors was published in 1591<br/>The book Titus Andronicus was published in 1593<br/>The book Two Gentlemen of Verona was published in 1591<br/>The book Romeo and JUliet was published in 1594<br/>The book Love's Labour's Lost was published in 1594</span></pre><h1 id="a269" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">查询相关对象</h1><p id="8ab2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">到目前为止，我们一次只对一个模型进行查询。我们知道一个作者可以有很多本书，因为这种关系是用<code class="fe nk nl nm nb b">db. relationship</code>方法在数据库中声明的。假设你想用<code class="fe nk nl nm nb b">id =2</code>获取某个作者的所有书籍。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">app.py</p></figure><p id="3582" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述查询的结果是:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="fa00" class="nf lw it nb b gy ng nh l ni nj">The tempest<br/>Comedy of Errors<br/>Titus Andronicus<br/>Two Gentlemen of Verona<br/>Love's Labour's Lost</span></pre><p id="5682" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们从关系的多面(<code class="fe nk nl nm nb b">Book</code>模型)开始，得到一本书的<code class="fe nk nl nm nb b">author_id</code>。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="9ed4" class="nf lw it nb b gy ng nh l ni nj"><br/>book2 = Book.query.get(2)</span><span id="aae8" class="nf lw it nb b gy nn nh l ni nj">book2_author_id = book2.author_id</span><span id="6442" class="nf lw it nb b gy nn nh l ni nj">print(book2_author_id)</span><span id="dfc8" class="nf lw it nb b gy nn nh l ni nj"># Result is 2</span></pre><p id="ffa3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为一本书只有一个作者，我们使用<code class="fe nk nl nm nb b">.get()</code>。</p><h2 id="3553" class="nf lw it bd lx no np dn mb nq nr dp mf li ns nt mh lm nu nv mj lq nw nx ml ny bi translated">过滤</h2><p id="51a5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">过滤允许您检索满足特定条件的条目。例如，要获取1594年出版的所有书籍，我们执行以下查询。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="66ea" class="nf lw it nb b gy ng nh l ni nj">books_in_1594 = Book.query.filter(Book.year == 1594).all()</span></pre><h2 id="0cb8" class="nf lw it bd lx no np dn mb nq nr dp mf li ns nt mh lm nu nv mj lq nw nx ml ny bi translated">高级过滤</h2><p id="3a14" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可能还需要以特定的顺序获取数据，例如，按日期、升序或降序获取数据。例如，根据发行年份过滤所有书籍的方法是:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="f5a7" class="nf lw it nb b gy ng nh l ni nj">books_by_year = Book.query.order_by(Book.year).all()</span></pre><h2 id="5229" class="nf lw it bd lx no np dn mb nq nr dp mf li ns nt mh lm nu nv mj lq nw nx ml ny bi translated">更新条目</h2><p id="45ba" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">更新数据库条目的详细信息是每天都会发生的事情。假设您想用<code class="fe nk nl nm nb b">id =1</code>更新作者的电子邮件详细信息；首先从数据库中获取作者<code class="fe nk nl nm nb b">object</code>，将<code class="fe nk nl nm nb b">email</code>赋值给一个新值，然后将更改提交给数据库。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="8078" class="nf lw it nb b gy ng nh l ni nj">&gt;&gt;&gt; author_id1  = Author.query.get(1)<br/>&gt;&gt;&gt; author_id1.email = "johndoe2022@gmailcom"<br/>&gt;&gt;&gt; db.session.commit()</span></pre><p id="87bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您进行查询，电子邮件地址将会发生变化。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="df5d" class="nf lw it nb b gy ng nh l ni nj">&gt;&gt;&gt; author_id1.email<br/>'johndoe2022@gmailcom'</span></pre><h2 id="d23e" class="nf lw it bd lx no np dn mb nq nr dp mf li ns nt mh lm nu nv mj lq nw nx ml ny bi translated">删除条目</h2><p id="1677" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">删除数据库中的条目对于任何应用程序都是至关重要的。如果我们想删除应用程序中的某些信息，我们可以使用<code class="fe nk nl nm nb b">db. session.delete</code>命令。</p><p id="5f21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，要删除一本带有<code class="fe nk nl nm nb b">id =6</code>的书，我们需要执行以下查询。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="0241" class="nf lw it nb b gy ng nh l ni nj">db.session.delete(Book.query.get(6))</span></pre><h1 id="c51c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="a0bc" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">简单回顾一下，本教程已经介绍了如何创建flask应用程序、初始化数据库、如何执行查询以及操作数据库中的记录。感谢阅读。</p><blockquote class="mt mu mv"><p id="db43" class="kz la mw lb b lc ld ju le lf lg jx lh mx lj lk ll my ln lo lp mz lr ls lt lu im bi translated">嘿，朋友，如果你想阅读更多的教程，可以考虑注册成为一名灵媒来支持我的工作。每月只需5美元，你就可以无限制地使用Medium。</p></blockquote></div></div>    
</body>
</html>