<html>
<head>
<title>How to Use Jetpack Preferences DataStore</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Jetpack首选项数据存储</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-jetpack-preferences-datastore-more-effectively-414e1126cff7?source=collection_archive---------3-----------------------#2022-06-20">https://betterprogramming.pub/using-jetpack-preferences-datastore-more-effectively-414e1126cff7?source=collection_archive---------3-----------------------#2022-06-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8efb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">SharedPreferences的替换在这里</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/864d3c7840d11642add6ba4ce9095bd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jB2Zcle-9dtcVkSbM0k84Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.pexels.com/photo/black-server-racks-on-a-room-325229/" rel="noopener ugc nofollow" target="_blank">Pexels.com</a></p></figure><h2 id="c3e6" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">什么是Jetpack数据存储？</strong></h2><blockquote class="lv lw lx"><p id="074b" class="ly lz ma mb b mc md ju me mf mg jx mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">根据Android开发文档，Jetpack DataStore是一种数据存储解决方案，允许您使用<a class="ae ky" href="https://developers.google.com/protocol-buffers" rel="noopener ugc nofollow" target="_blank">协议缓冲区</a>存储键值对或类型化对象。DataStore使用Kotlin协同例程和流来异步、一致和事务性地存储数据。</p></blockquote><p id="8613" class="pw-post-body-paragraph ly lz it mb b mc md ju me mf mg jx mh li mj mk ml lm mn mo mp lq mr ms mt mu im bi translated">DataStore是Jetpack家族的一个库，它提供了一种简单数据存储解决方案的新技术。它允许我们在键值对中存储数据，就像SharedPrefernces或在类型化对象中一样。它构建在协程和流程之上，异步存储数据。</p><h2 id="5511" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">SharedPreferences与DataStore</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/c63def8322cbee92b51b02a5a7e09221.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cO0mpU1DHJuoPvXV.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:<a class="ae ky" href="https://android-developers.googleblog.com/2020/09/prefer-storing-data-with-jetpack.html" rel="noopener ugc nofollow" target="_blank">安卓开发者博客</a></p></figure><p id="d1a7" class="pw-post-body-paragraph ly lz it mb b mc md ju me mf mg jx mh li mj mk ml lm mn mo mp lq mr ms mt mu im bi translated">在本文中，我们将了解首选项数据存储。</p><h2 id="7b7f" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是首选项数据存储？</h2><p id="8205" class="pw-post-body-paragraph ly lz it mb b mc mw ju me mf mx jx mh li my mk ml lm mz mo mp lq na ms mt mu im bi translated">它像SharedPreferences一样以键值对的形式存储数据。如果您过去已经使用过SharedPreferences，那么您会对Preferences数据存储有更好的了解。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="a199" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">整合</strong></h2><p id="333d" class="pw-post-body-paragraph ly lz it mb b mc mw ju me mf mx jx mh li my mk ml lm mz mo mp lq na ms mt mu im bi translated">要使用数据存储，您需要将库集成到应用程序级的<code class="fe ni nj nk nl b">build.gradle</code>文件中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="7b36" class="pw-post-body-paragraph ly lz it mb b mc md ju me mf mg jx mh li mj mk ml lm mn mo mp lq mr ms mt mu im bi translated">现在稳定了。你可以在你的项目中毫无压力地使用它😁。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="d7e4" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">是时候写一些代码了</h2><p id="6ca1" class="pw-post-body-paragraph ly lz it mb b mc mw ju me mf mx jx mh li my mk ml lm mz mo mp lq na ms mt mu im bi translated">我个人最喜欢Kotlin的特点是它的扩展功能。我们可以扩展任何我们想扩展的功能。对于首选项数据存储，我扩展了<code class="fe ni nj nk nl b">Context</code>类，从保存数据到检索数据。</p><p id="294a" class="pw-post-body-paragraph ly lz it mb b mc md ju me mf mg jx mh li mj mk ml lm mn mo mp lq mr ms mt mu im bi translated">对于<code class="fe ni nj nk nl b">DataStore</code>，我们需要创建一个helper utils文件，为此，您只需要使用代码片段。它包含所有类型值。每个项目的现成代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">DataStoreHelper.kt</p></figure><p id="6b82" class="pw-post-body-paragraph ly lz it mb b mc md ju me mf mg jx mh li mj mk ml lm mn mo mp lq mr ms mt mu im bi translated">一旦你完成了上面的步骤，现在你需要在<code class="fe ni nj nk nl b">ViewModel</code>类中调用这些函数。当向数据存储器写入任何数据时，它是<code class="fe ni nj nk nl b">suspend</code>函数，需要从<code class="fe ni nj nk nl b">coroutine</code>调用。</p><p id="599e" class="pw-post-body-paragraph ly lz it mb b mc md ju me mf mg jx mh li mj mk ml lm mn mo mp lq mr ms mt mu im bi translated">在理解数据存储的示例中，我们将存储<code class="fe ni nj nk nl b">String</code>类型的数据，并检索相同的数据类型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MainViewModel.kt</p></figure><p id="0421" class="pw-post-body-paragraph ly lz it mb b mc md ju me mf mg jx mh li mj mk ml lm mn mo mp lq mr ms mt mu im bi translated">为了将字符串数据保存到数据存储中，您只需要将<code class="fe ni nj nk nl b">saveNameUser(name:String)</code>函数调用到您的活动/片段中。</p><p id="16dc" class="pw-post-body-paragraph ly lz it mb b mc md ju me mf mg jx mh li mj mk ml lm mn mo mp lq mr ms mt mu im bi translated">为了检索数据，我们需要观察活动/片段中的<code class="fe ni nj nk nl b">getUserName</code> LiveData变量。一旦数据发生变化，UI就会通过使用LiveData立即更新。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="8535" class="pw-post-body-paragraph ly lz it mb b mc md ju me mf mg jx mh li mj mk ml lm mn mo mp lq mr ms mt mu im bi translated">现在，每当我们更新数据存储的值时，它每次都会观察，文本视图也会相应地更新。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="2ff8" class="no la it bd lb np nq nr le ns nt nu lh jz nv ka ll kc nw kd lp kf nx kg lt ny bi translated">结论</h1><p id="1e99" class="pw-post-body-paragraph ly lz it mb b mc mw ju me mf mx jx mh li my mk ml lm mz mo mp lq na ms mt mu im bi translated">仅此而已！希望你学到了一些东西。如有疑问，只管评论！我很乐意解决你的问题。我希望你从当前项目到所有新项目都使用<code class="fe ni nj nk nl b">DataStore</code>而不是<code class="fe ni nj nk nl b">SharedPrefernces</code>。</p><p id="3acf" class="pw-post-body-paragraph ly lz it mb b mc md ju me mf mg jx mh li mj mk ml lm mn mo mp lq mr ms mt mu im bi translated">谢谢，干杯！</p></div></div>    
</body>
</html>