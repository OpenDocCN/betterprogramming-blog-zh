<html>
<head>
<title>Golang: Automate Your Product Release Cycles Using Go-Feature-Flag</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Golang:使用Go-Feature-Flag实现产品发布周期的自动化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/automate-your-product-release-cycles-using-go-feature-flag-6ab73f869f?source=collection_archive---------8-----------------------#2021-05-26">https://betterprogramming.pub/automate-your-product-release-cycles-using-go-feature-flag-6ab73f869f?source=collection_archive---------8-----------------------#2021-05-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="892c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">仅使用基本配置进行渐进式推广、安排工作流程和实验</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c3ad97e5bcc6756ea4358dacac354c4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DQUV_fozqXbwxRXy"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@milkandbourbons?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迪安·布瑞尔利</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="b020" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您构建一个新功能时，在产品、工程和营销团队之间协调实际的发布时间表可能会很有挑战性。</p><p id="639b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然推出新的东西似乎很容易，但执行不好的首次展示可能会成为你最糟糕的噩梦。</p><p id="083e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示如何使用Go模块<code class="fe lv lw lx ly b"><a class="ae ky" href="https://github.com/thomaspoignant/go-feature-flag" rel="noopener ugc nofollow" target="_blank">go-feature-flag</a></code>来顺利推出您的新功能，并帮助您在推出阶段充满信心。如果你不熟悉特性标志或特性切换的概念，我鼓励你阅读Martin Fowler的这篇文章。</p><p id="b7d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">go-feature-flag</code> <strong class="lb iu"> </strong>是一个Go模块，轻松管理您的旗帜。可以参考<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/golang-feature-flags-a-simple-go-implementation-without-a-back-end-7c5c00078a58">我几个月前写的这篇文章</a>来了解它的工作原理。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="36a7" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">如何使用go-feature-flag</h1><p id="5ede" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">该库使用起来非常简单:</p><ol class=""><li id="0c68" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">安装模块:</li></ol><pre class="kj kk kl km gt nm ly nn no aw np bi"><span id="7c42" class="nq mh it ly b gy nr ns l nt nu">go get github.com/thomaspoignant/go-feature-flag</span></pre><p id="2d01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.用您的标志配置文件的位置初始化客户端:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="9079" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.根据标志值有条件地放置新要素:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="2ad7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以有更多的配置，但是我会让你检查文档<a class="ae ky" href="https://thomaspoignant.github.io/go-feature-flag/" rel="noopener ugc nofollow" target="_blank">来得到它。</a></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="ffc0" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">渐进式推广</h1><p id="22f1" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">当你发布一个对你的系统有很大影响的新特性时，你可能不想让所有用户都使用这个新特性。</p><p id="f29b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，您正在部署可能会消耗CPU的东西，并且您想要有时间来检查您的服务器是否正确地处理它。这通常是渐进式首次展示的一个很好的用例。</p><p id="23fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它会逐渐增加受您的功能标志影响的用户数量，以避免一次对所有用户进行大规模推广。在此期间，它允许您监控您的系统，并确信您的基础架构能够处理这种新的负载。</p><pre class="kj kk kl km gt nm ly nn no aw np bi"><span id="27af" class="nq mh it ly b gy nr ns l nt nu"><strong class="ly iu">progressive-flag</strong>:<br/>  true: true<br/>  false: false<br/>  default: false<br/>  <strong class="ly iu">rollout</strong>:<br/>    <strong class="ly iu">progressive</strong>:<br/>      <strong class="ly iu">percentage:</strong><br/>        initial: <strong class="ly iu">0</strong><br/>        end: <strong class="ly iu">100</strong><br/>      <strong class="ly iu">releaseRamp:</strong><br/>        start: 2021-03-20T00:00:00.10-05:00<br/>        end: 2021-03-21T00:00:00.10-05:00</span></pre><p id="0fbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在<code class="fe lv lw lx ly b"><a class="ae ky" href="https://github.com/thomaspoignant/go-feature-flag" rel="noopener ugc nofollow" target="_blank">go-feature-flag</a></code>中做到这一点，您将像上面的例子那样配置您的标志。使用初始百分比值和释放渐变设置渐进式卷展栏。随着时间的推移，越来越多的用户会受到该标志的影响，并将拥有新的功能。</p><p id="7b2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据这个特性的关键程度，您可以有一个长的或短的发布斜坡。如果出现问题，您可以随时编辑您的标志来停止卷展栏。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="c260" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">计划工作流</h1><p id="4b07" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">调度为用户引入了为未来时间点改变其标志的能力。虽然这听起来似乎很简单，但是它释放了用户通过预先安排增量步骤来创建复杂发布策略的潜力。</p><p id="ef0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，您可能希望明天打开一个特性进行内部测试，然后在四天后为您的“beta”用户群启用它。</p><pre class="kj kk kl km gt nm ly nn no aw np bi"><span id="e0c1" class="nq mh it ly b gy nr ns l nt nu"><strong class="ly iu">scheduled-flag</strong>:<br/>  true: true<br/>  false: false<br/>  default: false<br/>  percentage: 0<br/>  <strong class="ly iu">rollout</strong>:<br/>    <strong class="ly iu">scheduled</strong>:<br/>      steps:<br/>        - <strong class="ly iu">date: 2020-04-10T00:00:00.00+02:00</strong><br/>          rule: internal eq true<br/>          percentage: 100</span><span id="48d5" class="nq mh it ly b gy nx ns l nt nu">        - <strong class="ly iu">date: 2020-04-14T00:00:00.00+02:00</strong><br/>          rule: internal eq true and beta eq true</span><span id="4df5" class="nq mh it ly b gy nx ns l nt nu">        - <strong class="ly iu">date: 2020-04-18T00:00:00.00+02:00</strong><br/>          rule: ""</span></pre><p id="442c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本例中，您可以看到我们正在多次更新该标志，以便在将来执行操作。让我们详细描述一下在这种配置下会发生什么:</p><ol class=""><li id="8938" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">在<code class="fe lv lw lx ly b">2020–04–10</code>之前，不提供标志。</li><li id="6a9f" class="nd ne it lb b lc ny lf nz li oa lm ob lq oc lu ni nj nk nl bi translated">在第一次更新标志(<code class="fe lv lw lx ly b">2020–04–10</code>)，<em class="od">，</em>之后，我们有100%的内部用户收到了标志<code class="fe lv lw lx ly b">true</code>。</li><li id="e61b" class="nd ne it lb b lc ny lf nz li oa lm ob lq oc lu ni nj nk nl bi translated">四天后，我们将带有<code class="fe lv lw lx ly b">beta</code> <strong class="lb iu"> </strong>标志的用户添加为<code class="fe lv lw lx ly b">true</code>。</li><li id="2e39" class="nd ne it lb b lc ny lf nz li oa lm ob lq oc lu ni nj nk nl bi translated">最后，四天后，我们向所有用户开放该功能。</li></ol><p id="6bf8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所看到的，这真的很强大，因为您的发布管理现在已经准备好了，不需要做任何手动部署/操作，并且这个调度可以由非技术用户(也就是您的产品经理)来完成。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="09ae" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">实验展示</h1><p id="7e17" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">有时，您还希望进行试验，收集数据，然后决定是否要向所有用户推广该功能。</p><p id="0143" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要正确地做到这一点，您可以为您的用户子集配置带有开始日期和结束日期的标志。</p><pre class="kj kk kl km gt nm ly nn no aw np bi"><span id="5378" class="nq mh it ly b gy nr ns l nt nu"><strong class="ly iu">experimentation-flag</strong>:<br/>  <strong class="ly iu">percentage</strong>: 50<br/>  true: true<br/>  false: false<br/>  default: false<br/>  rule: userId sw "9"<br/>  <strong class="ly iu">rollout</strong>:<br/>    <strong class="ly iu">experimentation</strong>:<br/>      <strong class="ly iu">start</strong>: 2021-03-20T00:00:00.10-05:00<br/>      <strong class="ly iu">end</strong>: 2021-03-21T00:00:00.10-05:00</span></pre><p id="cc98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个例子中，50%拥有以<code class="fe lv lw lx ly b">9</code>开始的<code class="fe lv lw lx ly b">userId</code>的用户会受到实验的<code class="fe lv lw lx ly b">start</code>和<code class="fe lv lw lx ly b">end</code>日期之间的标记的影响。</p><p id="d85a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用该模块，您还可以收集您的变化的数据(更多信息参见<a class="ae ky" href="https://thomaspoignant.github.io/go-feature-flag/data_collection/" rel="noopener ugc nofollow" target="_blank">文档</a>)<em class="od"/>将它们与您正在测试的数据结合起来。</p><p id="e1cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以你可以看到你的实验结果，并决定你是否真的想要推出这面旗帜。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="751a" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="ecff" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">使用特性标志确实是一件很棒的事情，但是如果你使用一些高级的展示策略，它会变得更好。</p><p id="2228" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您开始使用它们，您会喜欢它，因为您将部署和发布解耦，并且您可以对您的用户可以做什么进行细粒度的控制。</p><div class="oe of gp gr og oh"><a href="https://github.com/thomaspoignant/go-feature-flag" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">托马斯辛酸/去功能标志</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">无需维护复杂系统的功能标志！去给github.com/thomaspoignant/go-feature-flag拿一个简单的…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">github.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ks oh"/></div></div></a></div></div></div>    
</body>
</html>