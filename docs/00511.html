<html>
<head>
<title>How To Make a Simple Countdown Timer with SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用SwiftUI制作一个简单的倒计时器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/make-a-simple-countdown-with-timer-and-swiftui-3ce355b54986?source=collection_archive---------3-----------------------#2019-06-04">https://betterprogramming.pub/make-a-simple-countdown-with-timer-and-swiftui-3ce355b54986?source=collection_archive---------3-----------------------#2019-06-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bc00" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用SwiftUI框架构建的分步说明</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/62747b63096b133fd62d74120ea44057.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ODMjjGZLrWZ9F_Z-cXbBhw.jpeg"/></div></div></figure><p id="f1c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">昨天，苹果发布了一个名为SwiftUI的新框架，允许我们以一种全新的、100%快捷的方式制作应用程序界面。我用它做了一些实验，在这篇文章中，我将向你展示如何制作一个倒计时器。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="e792" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">先决条件</h1><p id="b8c3" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">从SwiftUI开始，访问<a class="ae mu" href="https://developer.apple.com/download/" rel="noopener ugc nofollow" target="_blank">https://developer.apple.com/download/</a>并下载Xcode 11和macOS Catalina 10.15的最新版本。SwiftUI在Mojave上也能与Xcode一起工作，但预览版无法工作。还有，需要注意的是，SwiftUI框架仅在iOS 13、macOS 10.15、watchOS 6和iPadOS 13上可用。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="e76d" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">创建SwiftUI项目</h1><p id="3cdf" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">使用Xcode 11创建一个新的iOS项目，并确保选中SwiftUI框:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/de77ed4263f29a2671563f742a487a0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lX5MhuxM-aG8cWY5Pl4YjQ.png"/></div></div></figure><p id="2171" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在您已经创建了项目，请看一下ContentView.swift文件和body变量实现，这是您将在SwiftUI中实现视图的地方。它应该是这样的:</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="e010" class="nb ly it mx b gy nc nd l ne nf"><strong class="mx iu">var</strong> body: <strong class="mx iu">some</strong> View {</span><span id="abeb" class="nb ly it mx b gy ng nd l ne nf">    Text("Hello World")</span><span id="0084" class="nb ly it mx b gy ng nd l ne nf">}</span></pre></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="c17a" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">制作定时器逻辑</h1><p id="4418" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">为了能够每秒刷新我们的界面，我们将使用一个计时器并声明一个日期来创建我们的倒计时。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="5bc1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意这里的<em class="nj"> @State </em>会在每次日期更新时重新创建我们的界面，并准确地显示当计时器触发时我们要在程序块中做什么。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="41a6" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">在标签中添加倒计时逻辑</h1><p id="5668" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">随着我们的计时器每秒启动，我们可以根据当前日期更新界面。让我们创建一个返回倒计时字符串的函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="1a0c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后调用函数来代替“hello world”文本:</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="67b0" class="nb ly it mx b gy nc nd l ne nf"><strong class="mx iu">var</strong> body: <strong class="mx iu">some</strong> View {<br/>     Text(countDownString(from: <strong class="mx iu">referenceDate</strong>, until: <strong class="mx iu">date</strong>))<br/>}</span></pre><p id="ad3e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是等等，为什么不更新？这是因为定时器是懒惰的，所以在它被调用之前，定时器是不存在的，也不能被触发。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="5697" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">让计时器启动</h1><p id="6d5b" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">初始化计时器的一种方法是向文本元素添加onAppear闭包，这样当文本出现时，它将创建计时器，循环可以开始:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="7678" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我不知道这是否是最好的方法，但它工作得很好。当视图消失时，您可能希望使计时器无效，以避免内存泄漏。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="b08e" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">完整的代码</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure></div></div>    
</body>
</html>