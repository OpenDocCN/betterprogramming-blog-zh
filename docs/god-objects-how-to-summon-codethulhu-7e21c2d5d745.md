# 神物:如何召唤 Codethulhu

> 原文：<https://betterprogramming.pub/god-objects-how-to-summon-codethulhu-7e21c2d5d745>

## 所以，你选择用上帝对象和足够的复杂性来感染你的代码库，以产生数小时的工作保障。以下是如何做的

![](img/b1ad4753ac6c0f3462d317f496c4f7a1.png)

Yosh Ginsu 在 [Unsplash](https://unsplash.com/s/photos/vulcano?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

如果你关注我的写作，你会知道我通常会写很多关于软件质量最佳实践的文章。

回想起来，这种方法偏向于那些想要*提高*软件质量的人。我不小心忽略了那些想给一个系统注入更多 bug 的人。

所以，那些喜欢缺陷的人，让我和你们分享我的头号技巧，系统地创造一个滋生 bug 的温床:*上帝对象*。

**警告**:本文*可能*带有讽刺性质。请负责任地编码。

# 找到一个足够复杂的问题

太好了！你已经选择用复杂性的寄生增长来感染你的代码库，这将产生只有你能做的无数小时的重要工作(这就是所谓的“工作保障”)。

上帝对象是一种产生足够复杂性的好方法，只有非常熟悉它们的开发人员才能接触到它们，而不会引起质量保证的愤怒。

我正在谈论的这类对象已经以诸如 *Codethulhu* 这样的名字为人所知，它折磨着初级开发人员和质量保证分析师。

但首先，他们需要解决一个问题。我知道，我们的工作是增加复杂性和安全性，而不是解决业务问题。不过，听我说完。

如果你的代码不能解决一个独特而关键的问题，未来的开发者可能会绕过它，然后*完全抛弃它*。

所以，你需要找到一种类型的问题:

*   需要高度的技巧和批判性思维来解决。
*   如果不花时间去思考，就不容易理解。
*   与足够多的*其他*复杂系统和流程相互作用，承担一些*它们的*复杂性。
*   随着新功能的需求，在复杂性方面有足够的增长和扩展潜力。
*   没有现成的替代方案。

如果什么都没想到，你可以等待一个新的复杂的特性出现，或者你可以从代码库的现有层中取出一个大文件并扩展它。

要考虑的一些对象类型:

*   通信/web 服务层。
*   自定义用户界面控件。
*   数据访问层。
*   对象序列化/反序列化逻辑。
*   公共服务(业务逻辑)层。

然而，这些问题都不像业务问题那样独特，但是如果您的组织因为某种原因而不愿意为您提供一个大到足以扩展到 Codethulhu 规模的特性，那么所有这些问题都会在紧要关头发挥作用。

# 分娩代码图鲁

一旦你发现了你的机会，你就进入了这个过程中最困难的部分。在继续阅读之前，你可能需要做好准备。

为了让你的对象存活下来并进入代码库，它必须工作。这意味着，你需要*解决*或*主要是解决*业务首先给你(或你确定的)的任何问题。

这意味着你必须系好安全带开始工作。实际上，您可能需要非常努力地工作，因为大型特性更难，并且您将通过有意地创建一个大型类来实现您的特性，该类在单个文件中管理复杂性。

# 扩大感染

然而，巨大的上帝物品不会一夜之间就冒出来。我们正在谈论的这种恐怖需要时间和奉献来成长。你不*有*有意种植它们，但它确实有帮助。

记住:尽可能多的逻辑进入同一个类。

如果一个问题适用于你的对象，在对象中解决它。我说的是这样的事情:

*   序列化
*   反序列化
*   数据存取
*   确认
*   从语法上分析
*   格式化
*   记录
*   线程管理
*   状态管理
*   贮藏
*   Web 服务调用

所有这些事情都可以在你的上帝对象中处理。

记住这句口头禅:

你的问题很特别，不同于其他代码，因为它解决的问题很复杂。如果其他代码在您的对象中工作，它就不会那么特殊，所以您的代码需要内部特殊的定制逻辑。

当你在开发的时候，我建议只在你的代码中放置最少数量的注释。毕竟，代码应该是自文档化的，对吗？

一定要利用外部库和每一个新的语言特性——特别是如果你的同事还不熟悉或不使用这些特性的话。

嵌套的三元表达式和正则表达式是确保只有优秀的开发人员才能接触一行代码的可靠方法。

记住:在其他人注意到它并开始提出问题之前，你只有有限的一段时间来培养你的新生上帝对象，所以好好利用这段时间来达到临界的大小和复杂性。

# 捍卫处于萌芽状态的 Codethulhu

当你在创建一个大而复杂的类时遇到挑战，声称它通过在单个文件中解决业务问题来遵循单一责任原则(SRP)。

如果其他人告诉你这不是 SRP 所说的，声称开会迟到并突然跑开。如果人们继续挑战你，是时候改变态度了。

表现出被侮辱和被冒犯的样子，然后要求他们解释你正在解决的问题的全部复杂性。如果他们未能充分描述问题或其解决方案，指出这一点并终止对话。

如果他们真的做对了，寻找技术细节和他们没有提到的东西。比如验证、持久性、线程、模糊的边缘情况等等。

关于线程化的话题，如果您声称您的复杂性是以提高性能的方式构建的，那么您就可以大获全胜了(如果这是真的，那就加分了)。

当人们说他们需要对您的代码进行全面的代码审查时，这是一个陷阱。说你的时间表太紧，不允许这样做，代码评审只适合糟糕的开发人员。你的代码是好的，他们应该知道这一点，因为他们雇用了你，你继续解决关键问题。

如果人们继续给你关于代码的问题，给另一个开发人员一个机会，让他在没有帮助的情况下开发这个类，并且失败得很惨，这可能是一个很好的策略，只是为了让你突然介入并扭转局面。

最后，如果你的对象仍然引起其他开发人员的愤怒，你可以把它重新命名为以单词`Facade`、`Controller`或`Service`结尾的东西，因为人们似乎不介意这样的类随着时间变得越来越大。

# 见见混沌，也就是工作保障

迟早，你的上帝对象会在质量保证、你的开发伙伴和潜在的生产中释放混乱。

别担心，这很正常。

就像每月俱乐部的果冻一样，上帝物品是持续给予的礼物。

当然，来自这些物体的一些工作将会非常复杂并且潜在紧急，但是工作正以你的方式*进行，这是你想要的。*

你是唯一一个有能力处理 Codethulhu 中出现的复杂状态管理、线程和操作顺序问题的人，因此你与它的命运息息相关。

希望到这个时候，Codethulhu 对企业的持续运营至关重要，否则你和它可能会在下周流落街头。

如果 Codethulhu *已经*变得根深蒂固，祝贺你获得了自己奋斗的任期。

当然，你不会得到晋升，因为公司担心除了你之外，没有人能够维持这个庞然大物，但这是为工作安全感付出的小小代价。

只要留意任何一个激进的架构师或者任何一个在过去一个月里阅读或撰写过任何带有 *refactoring* 字样的文章的人。

# 小心那些能杀死科德图鲁的人

偶尔，一些穿着闪亮盔甲的骑士会出现并试图杀死你的怪物。一般来说，这没什么，因为 Codethulhu 吞噬了低级开发人员的理智。

然而，有时，合适的人会伴随着软件架构和模式的知识，对“改进”代码库的渴望，以及完成它的技能和意志力。

当这种情况发生时，非常糟糕，你应该开始寻找逃生出口。

通常，这个人会对开发组织大喊大叫，鼓吹将代码重构为通用模式、单一责任原则(SRP)、提取助手类、支持组合而不是继承，以及其他类似的废话。

他们的书桌或书架上可能会有书籍，例如:

*   [有效地使用遗留代码](https://www.amazon.com/Working-Effectively-Legacy-Michael-Feathers/dp/0131177052)，作者 Michael Feathers
*   [重构](https://www.amazon.com/Refactoring-Improving-Existing-Addison-Wesley-Signature/dp/0134757599)，作者马丁·福勒
*   [测试驱动开发](https://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530)，作者肯特·贝克
*   罗伯特·C·马丁的《干净的代码》
*   [软件设计 x 光片](https://www.amazon.com/Software-Design-X-Rays-Technical-Behavioral/dp/1680502727)，作者亚当·托恩希尔

观察他们成功地修改 Codethulhu 或者更糟，围绕它进行测试。如果这些事情发生了，可能是时候去寻找另一个需要新上帝对象的组织了。

# 这是个玩笑

所以，事实证明，这篇文章是讽刺性的。

尽管如此，由于我在职业生涯早期犯下的一些错误，其中一些还是切中要害。

我正在为一个 Windows 桌面应用程序开发一个复杂的非标准用户界面控件。我的职业生涯已经进行了六个月，但那时我已经做了 15 年左右的编码工作。

在一个季度的时间里，我制作了一个非常复杂的用户界面控件类，它可以管理(除了其他事情之外):

*   动画
*   选择
*   焦点
*   数据虚拟化
*   UI 虚拟化
*   事件传播
*   键盘导航

随着每个新版本的发布，我们会添加它需要做的事情，所以这个类会越来越大，直到它在一个文件中有将近 4000 行代码。

这些功能不可避免地开始相互冲突，在我们知道之前，我们手上有一个上帝的对象，它拥有我们的代码库，并导致混乱和不可预测的错误，很难复制和修复。

# 杀死科德图胡

大多数人不会有意进入上帝物体的场景，但如果你这样做了，一切都不会失去。

这里有一些高层次的想法可以帮助你摆脱困境:

*   单一责任原则是你的朋友。如果您在开发一个类或方法时记住这一点，您将在默认情况下避免这种反模式。
*   将逻辑提取到助手类有助于通过将非核心职责转移到其他对象来简化代码。
*   在对类进行任何修改之前，尽可能多地进行[固定测试](https://killalldefects.com/2019/08/30/snapshot-testing-in-javascript-net/)。您希望捕捉当前的行为，并明确知道它是否在变化。
*   不要害怕[与管理层](https://killalldefects.com/2019/10/01/communicating-technical-debt/)交流技术债务，并讨论你对当前代码库的担忧。他们可能会欣赏这种诚实和开放的态度，并希望了解减少风险代码的最新情况。

祝你好运，并希望 Codethulhu 永远不会困扰你的代码库。