<html>
<head>
<title>How To Run PostgreSQL in a Docker Container on macOS With Persistent Local Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在macOS上的Docker容器中使用持久化本地数据运行PostgreSQL</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-run-postgresql-in-a-docker-container-on-macos-with-persistent-local-data-440e7172821e?source=collection_archive---------5-----------------------#2021-04-08">https://betterprogramming.pub/how-to-run-postgresql-in-a-docker-container-on-macos-with-persistent-local-data-440e7172821e?source=collection_archive---------5-----------------------#2021-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="14ed" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">设置PostgreSQL并跨容器在本地主机上保存数据的分步指南</em></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/c8378b74faea2b023adcee658b2639f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MYAZ9Pk1cSYpsm3j"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@linusmimietz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Linus Mimietz </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="ffa5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我回来了。在漫长而疲惫的2020年之后，一年多没有写作，我回来了。</p><p id="5665" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我已经启动了一个新的软件创业公司,并且我正在着手开发一个我希望会成功的新产品。在这个过程中，我将学习新的东西，尝试不同的技术和不同的做事方式，并在此分享它们。</p><p id="9c17" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我有LAMP stack开发的背景，多年来一直依赖MySQL作为我的应用程序数据的基础。在过去的一年里，我探索了转向PostgreSQL(又名Postgres)的好处。作为其中的一部分，我得到了一些非常简单的指令，用持久数据在Docker容器中设置Postgres，这样在容器启动、停止、重启等过程中不会丢失任何东西。</p><p id="f8f5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们走吧！</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="d4c0" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated"><strong class="ak">下载并安装Docker </strong></h1><p id="8984" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">如果你的Mac上还没有安装Docker，<a class="ae kz" href="https://docs.docker.com/docker-for-mac/install/" rel="noopener ugc nofollow" target="_blank">从稳定渠道安装最新版本</a>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="af23" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated"><strong class="ak">创建您的PostgreSQL数据文件夹</strong></h1><p id="3b51" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">在Mac上创建一个本地目录来存储您的数据。我们会将Docker容器绑定到这个本地文件夹，这样，无论您何时关闭容器(或重启计算机)并再次启动它，您的数据都会持久保存。</p><p id="0c5a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="na">注意:我的个人偏好是将我的开发项目收集到一个名为</em> <code class="fe nb nc nd ne b"><em class="na">Develop</em></code> <em class="na">的文件夹中。你可以根据自己的喜好随意调整位置。</em></p><p id="54ed" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">打开终端(或使用Finder)并创建以下文件夹:</p><pre class="kk kl km kn gt nf ne ng nh aw ni bi"><span id="4c0d" class="nj me it ne b gy nk nl l nm nn">mkdir /Users/[your_username]/Develop</span><span id="38f6" class="nj me it ne b gy no nl l nm nn">mkdir /Users/[your_username]/Develop/postgres_data</span><span id="16ef" class="nj me it ne b gy no nl l nm nn">mkdir /Users/[your_username]/Develop/postgres_data/13.2</span></pre><p id="9d64" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="na">注意:您正在创建一个</em> <code class="fe nb nc nd ne b"><em class="na">/13.2</em></code> <em class="na">版本文件夹，因为这是我们将在本文中安装的版本。如果需要的话，你可以简单地添加一个</em> <code class="fe nb nc nd ne b"><em class="na">/12.0</em></code> <em class="na">文件夹，并让两个容器运行不同版本的PostgreSQL。在这种情况下，您只需将每个容器绑定到适当的本地文件夹。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6270" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">建立一个本地码头网络</h1><p id="775d" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">Docker内置了DNS。因此，我们将为Docker容器创建一个本地网络。如果您遵循了我关于为您的开发环境创建Docker容器的其他文章，那么只要所有的容器都被添加到同一个网络中，那么您的所有容器都将能够通过名称而不是IP地址相互通信。我的例子中的所有容器都是同一个网络的一部分。</p><p id="03d4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您可以随意命名您的网络。由于我们正在构建一个开发环境，我将把我的命名为<em class="na"> dev-network </em>。</p><p id="bcb4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">打开终端并输入以下命令:</p><pre class="kk kl km kn gt nf ne ng nh aw ni bi"><span id="30f8" class="nj me it ne b gy nk nl l nm nn">docker network create dev-network</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8632" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">创建PostgreSQL容器</h1><p id="79f9" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">现在，从DockerHub上的PostgreSQL 13.2官方存储库中创建一个映像和容器。在下面的命令中，记住用您的Mac用户名替换<code class="fe nb nc nd ne b">[your_username]</code>，并用您最喜欢的数据库根密码替换<code class="fe nb nc nd ne b">[your_password]</code>。</p><p id="d005" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="na">注意:以下是一条由于长度原因而换行的命令。确保复制并粘贴整个内容。</em></p><pre class="kk kl km kn gt nf ne ng nh aw ni bi"><span id="a421" class="nj me it ne b gy nk nl l nm nn">docker run --restart always --name postgres13.2 --net dev-network -v /Users/[your_username]/Develop/postgres_data/13.2:/var/lib/postgresql/data -p 5432:5432 -d -e POSTGRES_PASSWORD=[your_password] postgres:13.2</span></pre><p id="9849" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">以下是该命令中每个参数的含义:</p><ul class=""><li id="b9e0" class="np nq it lc b ld le lg lh lj nr ln ns lr nt lv nu nv nw nx bi translated"><code class="fe nb nc nd ne b">--restart always</code>会在Docker启动的任何时候重启这个容器，比如笔记本电脑重启，或者Docker关闭后又重新启动。如果您想每次都启动自己的容器，请不要使用这个参数。</li><li id="324b" class="np nq it lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated"><code class="fe nb nc nd ne b">--name postgres13.2</code>将名称“postgres13.2”分配给容器实例。这是它在Docker仪表板中的显示方式。如果您计划在Mac上的容器中运行多个版本，在名称中添加版本号会很方便。</li><li id="aab0" class="np nq it lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated"><code class="fe nb nc nd ne b">--network dev-network</code>会将此容器加入您创建的本地码头网络。</li><li id="bab3" class="np nq it lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated"><code class="fe nb nc nd ne b">-v /Users/[your_username]/Develop/postgres_data/13.2:<br/>/var/lib/postgresql/data</code>会将容器卷(<code class="fe nb nc nd ne b">/var/lib/postgresql</code>)中的数据文件夹绑定到您在上一步中在笔记本电脑上创建的本地文件夹，这样，如果容器出于任何原因关闭并重新启动，数据将会保留。</li><li id="64cb" class="np nq it lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated"><code class="fe nb nc nd ne b">-p 5432:5432</code>会将容器(5432)的Postgres端口绑定到Mac上的同一个端口。这使得在Postgres中将该容器视为“本地主机”变得更加容易。</li><li id="eaf6" class="np nq it lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated"><code class="fe nb nc nd ne b">-d</code>将在分离模式下运行该容器，以便它在后台运行。</li><li id="75d5" class="np nq it lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated"><code class="fe nb nc nd ne b">-e POSTGRES_PASSWORD=[your_password]</code>设置一个环境变量(在本例中，是容器内的PostgreSQL root密码)。</li><li id="9fa6" class="np nq it lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated"><code class="fe nb nc nd ne b">postgres:13.2</code>表示官方DockerHub Postgres版本标签13.2就是要安装的。如果你正在创建一个新的实例(例如<code class="fe nb nc nd ne b">:12.0</code>)，只需将<code class="fe nb nc nd ne b">:13.2</code>替换为不同的版本，并确保你已经在Mac上创建了一个匹配的数据文件夹，这样你就可以绑定到它。</li></ul><p id="029a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">除非您已经将Postgres Docker映像下载到您的笔记本电脑上，否则当您第一次运行上面的命令时，它会下载它。之后的后续运行会快很多。</p><p id="1d35" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您可以运行以下命令来查看您的Docker容器是否正在运行:</p><pre class="kk kl km kn gt nf ne ng nh aw ni bi"><span id="59f7" class="nj me it ne b gy nk nl l nm nn">docker ps</span></pre><p id="3238" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您也可以打开Docker仪表板。它也会出现在那里。</p><p id="9709" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">就是这样！您的新PostgreSQL 13.2实例现在正在运行。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ccee" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">还有呢！</h1><p id="fcbd" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">查看<a class="ae kz" href="https://medium.com/@crmcmullen" rel="noopener">我的其他文章</a>,找到更多在Mac上设置开发环境的有用指南！</p><p id="f25c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">此外，继续检查回来。我有一些关于PHP API开发的好主意，我将很快与大家分享。</p></div></div>    
</body>
</html>