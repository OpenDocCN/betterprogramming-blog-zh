<html>
<head>
<title>What is SwiftUI’s @EnvironmentObject?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI的@EnvironmentObject是什么？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/what-is-swiftuis-environmentobject-4eb4aee8fc38?source=collection_archive---------15-----------------------#2020-07-06">https://betterprogramming.pub/what-is-swiftuis-environmentobject-4eb4aee8fc38?source=collection_archive---------15-----------------------#2020-07-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c316" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何以及何时在您的SwiftUI项目中使用它</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/649fbfe3547923c32bd646b496934207.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N62Km6Tl43DJBQpVbkzQiQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@lysanderyuen?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">吕山德元</a>在<a class="ae ky" href="https://unsplash.com/s/photos/central?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="edd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能认为<code class="fe lv lw lx ly b">@EnvironmentObject</code>是共享数据，多个视图可以使用它来获取数据。如果您的数据将在应用程序的许多部分共享，则应使用此选项。</p><blockquote class="lz ma mb"><p id="ac02" class="kz la mc lb b lc ld ju le lf lg jx lh md lj lk ll me ln lo lp mf lr ls lt lu im bi translated">"由父视图或祖先视图提供的可观察对象的属性包装类型."— <em class="it">苹果文档</em></p></blockquote><p id="a25f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，您将了解SwiftUI中的<code class="fe lv lw lx ly b">@EnvironmentObject</code>是什么。您将了解到:</p><ul class=""><li id="48ae" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">如何使用<code class="fe lv lw lx ly b">@EnvironmentObject</code>。</li><li id="e0f5" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">何时使用<code class="fe lv lw lx ly b">@EnvironmentObject</code>。</li></ul></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="10ca" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">先决条件</h1><p id="52fb" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">要跟随本教程，您需要对Swift有一个基本的了解，并至少具备Xcode 11的一些基础知识。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="ced3" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">何时使用@EnvironmentObject</h1><p id="2e50" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">给定一个场景，视图A创建一个对象并将其放入环境中，任何视图都应该能够在需要时访问该对象。这样就省去了很多屏幕间传递的麻烦。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/719d4f8ae881977c66ea45d3d14d24dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ZHr7iJFVL26e3JtOfzuQw.png"/></div></div></figure><p id="9b56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果没有正确配置，就会有一个陷阱。当你在代码中声明<code class="fe lv lw lx ly b">@EnvironmentObject</code>时，SwiftUI会自动寻找该对象，如果找不到，你的应用会立即崩溃。</p><p id="927e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，当您使用<code class="fe lv lw lx ly b">@EnvironmentObject</code>时，您实际上是在说一个对象存在，并且您应该始终确保它确实存在。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="6234" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">如何使用@EnvironmentObject</h1><p id="c0ed" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">通过<code class="fe lv lw lx ly b">@EnvironmentObject</code>，SwiftUI允许您在应用程序中的所有视图之间进行共享。对我来说，这听起来很像是一个独生子，但事实并非如此。</p><p id="7674" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">@EnvironmentObject</code>更实际的应用是用户从视图A移动到视图B，然后到视图C，再到视图D，信息在屏幕间传递。视图A可以将数据传递给环境，而不是在屏幕之间传递，然后您可以在视图d中从环境中检索数据，这样您的代码看起来会更整洁。</p><p id="b5d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您正在构建一个应用程序，您想知道是否切换了黑暗模式。您首先创建一个<code class="fe lv lw lx ly b">ObservableObject</code>:</p><pre class="kj kk kl km gt nz ly oa ob aw oc bi"><span id="b7b1" class="od nc it ly b gy oe of l og oh">class DeviceSetting: ObservableObject {<br/>    @Published var isDarkMode = false<br/>}</span></pre><p id="8239" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，在<code class="fe lv lw lx ly b">SceneDelegate</code>中，初始化<code class="fe lv lw lx ly b">DeviceSetting</code>:</p><pre class="kj kk kl km gt nz ly oa ob aw oc bi"><span id="ea5c" class="od nc it ly b gy oe of l og oh">var deviceSetting = DeviceSetting()</span></pre><p id="128a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并按如下方式将其与您的<code class="fe lv lw lx ly b">ContentView</code>连接:</p><pre class="kj kk kl km gt nz ly oa ob aw oc bi"><span id="2b2a" class="od nc it ly b gy oe of l og oh">let contentView = ContentView().environmentObject(deviceSetting)</span></pre><p id="8242" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将要操作的第一个屏幕是<code class="fe lv lw lx ly b">ContentView</code>。这有点像你的主页。</p><p id="5a1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里你可以根据自己的需要切换黑暗模式。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/c5ea14bde5add159bc342f9d9fee4178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*z_PIYvTLFkgBrIV7EqwSPA.png"/></div></figure><p id="970b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一个屏幕是详细屏幕，您可以在其中设置黑暗模式的状态。</p><pre class="kj kk kl km gt nz ly oa ob aw oc bi"><span id="0650" class="od nc it ly b gy oe of l og oh">@EnvironmentObject var deviceSetting: DeviceSetting</span><span id="1a9f" class="od nc it ly b gy ol of l og oh">var body: some View {<br/>    HStack {<br/>        Text("Dark Mode is")<br/>        self.deviceSetting.isDarkMode ? Text("Enabled") : Text("Disabled")<br/>    }.navigationTitle("Setting Screen")<br/>}</span></pre><p id="262b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看看这是如何做到的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/979c050285ffd9a3eef4fd0ddcf1fec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/1*x7EKR8yvwCbXvDRxDqCvNw.gif"/></div></figure></div></div>    
</body>
</html>