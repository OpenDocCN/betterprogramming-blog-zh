<html>
<head>
<title>Developing Chrome Extensions With AWS Amplify Authentication</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Amplify认证开发Chrome扩展</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/developing-chrome-extensions-with-amplify-authentication-be9b9e496a06?source=collection_archive---------8-----------------------#2022-01-10">https://betterprogramming.pub/developing-chrome-extensions-with-amplify-authentication-be9b9e496a06?source=collection_archive---------8-----------------------#2022-01-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="50bc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建惊人的Chrome扩展</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/188317ff292673d45b3f7031b04d45fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pm8qMPPrpy4Jetk2W6LOnQ.png"/></div></div></figure><p id="a06e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Chrome扩展是允许用户定制他们的浏览体验的小程序。用户可以用它们以多种方式定制Chrome的功能和行为。例如，扩展可以覆盖与当前显示的网页相关的信息。</p><p id="b46e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建Chrome扩展时，可能需要个性化的行为。例如，根据用户的偏好显示信息。在这种情况下，你的Chrome扩展必须在你的服务器上管理用户特定的数据。现在该介绍AWS Amplify了。AWS Amplify提供了一套工具和功能，使前端web和移动开发人员能够快速轻松地在AWS上构建全栈应用，并随着您的用例变化灵活地利用全方位的AWS服务。</p><p id="3aac" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本文解释了如何结合以下技术创建Chrome扩展。</p><ul class=""><li id="ca61" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">反应</li><li id="2ef0" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">以打字打的文件</li><li id="278a" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">AWS放大器</li><li id="4ab8" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">AWS认知(认证)</li><li id="2be1" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">AWS AppSync (GraphQL)</li></ul><p id="dcd2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我在这里创建了一个样板git存储库，展示了一个工作示例。</p><div class="mb mc gp gr md me"><a href="https://gitlab.com/kmiyashita/chrome-extension-amplify-auth" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd ir gy z fp mj fr fs mk fu fw ip bi translated">肯·宫下/chrome-扩展-放大-授权</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">带有放大认证Chrome扩展的样板文件</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">gitlab.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms kp me"/></div></div></a></div><h1 id="e4ef" class="mt mu iq bd mv mw mx my mz na nb nc nd jw ne jx nf jz ng ka nh kc ni kd nj nk bi translated">先决条件</h1><p id="94d9" class="pw-post-body-paragraph kr ks iq kt b ku nl jr kw kx nm ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">下面的基础知识不在本文的讨论范围之内，您应该对它们比较熟悉。由于这些技术提供了全面的教程，我建议您先浏览一下。</p><h2 id="05cb" class="nq mu iq bd mv nr ns dn mz nt nu dp nd la nv nw nf le nx ny nh li nz oa nj ob bi translated"><a class="ae oc" href="https://developer.chrome.com/docs/extensions/mv3/getstarted/" rel="noopener ugc nofollow" target="_blank">镀铬扩展</a></h2><ul class=""><li id="25ce" class="ln lo iq kt b ku nl kx nm la od le oe li of lm ls lt lu lv bi translated">什么是(1)后台脚本(2)弹出脚本，以及(3)内容脚本。</li><li id="2b88" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">这些脚本是如何分段的，以及它们是如何相互通信的。</li></ul><h2 id="62db" class="nq mu iq bd mv nr ns dn mz nt nu dp nd la nv nw nf le nx ny nh li nz oa nj ob bi translated"><a class="ae oc" href="https://webpack.js.org/guides/getting-started/" rel="noopener ugc nofollow" target="_blank">网络包</a></h2><ul class=""><li id="96d4" class="ln lo iq kt b ku nl kx nm la od le oe li of lm ls lt lu lv bi translated">为什么捆绑是必要的。</li><li id="5bef" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">什么是(1)入口点，(2)包，和(3)加载器。</li></ul><h2 id="50d2" class="nq mu iq bd mv nr ns dn mz nt nu dp nd la nv nw nf le nx ny nh li nz oa nj ob bi translated"><a class="ae oc" href="https://docs.amplify.aws/start/q/integration/react/" rel="noopener ugc nofollow" target="_blank"> AWS放大器(带react) </a></h2><ul class=""><li id="f3dc" class="ln lo iq kt b ku nl kx nm la od le oe li of lm ls lt lu lv bi translated">如何用Amplify开发React应用程序？</li><li id="b234" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">如何整合Amazon Cognito作为主要的认证提供者？</li><li id="f0ce" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">如何将API和数据库连接到您的应用程序。</li></ul><h1 id="caaa" class="mt mu iq bd mv mw mx my mz na nb nc nd jw ne jx nf jz ng ka nh kc ni kd nj nk bi translated">有哪些挑战？</h1><p id="c80e" class="pw-post-body-paragraph kr ks iq kt b ku nl jr kw kx nm ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">如果你想用Amplify创建简单的Chrome扩展或独立的web应用程序，你可以在网上找到许多教程和工作示例。</p><p id="9975" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，如果您想结合上述技术，您会遇到以下挑战。读完这篇文章后，解决方案似乎显而易见。</p><p id="0512" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是我花了几周时间试图将它们结合起来，以获得一个稳定的代码库，我相信我的样板文件对初学者是有帮助的。</p><h2 id="d408" class="nq mu iq bd mv nr ns dn mz nt nu dp nd la nv nw nf le nx ny nh li nz oa nj ob bi translated">文件夹结构</h2><p id="edca" class="pw-post-body-paragraph kr ks iq kt b ku nl jr kw kx nm ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">多个小脚本(应用)协同工作，共享Amplify自动生成的代码。最适合他们的文件夹结构是什么？</p><h2 id="8c37" class="nq mu iq bd mv nr ns dn mz nt nu dp nd la nv nw nf le nx ny nh li nz oa nj ob bi translated">带有react的Chrome扩展的Webpack配置</h2><p id="a29d" class="pw-post-body-paragraph kr ks iq kt b ku nl jr kw kx nm ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">通常，在创建react应用程序时会用到<a class="ae oc" href="https://create-react-app.dev/" rel="noopener ugc nofollow" target="_blank"> <em class="og"> create-react-app </em> </a>。这是一个很好的工具，为您开发成熟的react应用程序提供了一个坚实的起点。</p><p id="1fa3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是你不能将<code class="fe oh oi oj ok b">create-react-app</code>的结果原样用于你的Chrome扩展。</p><p id="0540" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">尽管我们需要创建多个包(后台脚本、弹出脚本、内容脚本)，<code class="fe oh oi oj ok b">create-react-app</code>不支持这个用例。</p><h2 id="5ea5" class="nq mu iq bd mv nr ns dn mz nt nu dp nd la nv nw nf le nx ny nh li nz oa nj ob bi translated">管理AWS身份验证的安全令牌</h2><p id="a548" class="pw-post-body-paragraph kr ks iq kt b ku nl jr kw kx nm ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">默认情况下，AWS Amplify将安全令牌存储在浏览器的<code class="fe oh oi oj ok b">localStorage</code>中。但如果你想登录你的Chrome扩展的弹出窗口，让内容脚本访问个性化数据，这种默认行为是不方便的。您需要建立管理弹出脚本和内容脚本之间共享的安全令牌的方法。</p><h1 id="04cf" class="mt mu iq bd mv mw mx my mz na nb nc nd jw ne jx nf jz ng ka nh kc ni kd nj nk bi translated">Chrome扩展示例(样板文件)</h1><h2 id="1ba0" class="nq mu iq bd mv nr ns dn mz nt nu dp nd la nv nw nf le nx ny nh li nz oa nj ob bi translated">概观</h2><p id="e049" class="pw-post-body-paragraph kr ks iq kt b ku nl jr kw kx nm ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">样板文件是一个功能齐全(但很少)的应用程序，具有以下特性。</p><ul class=""><li id="1de7" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><strong class="kt ir">门户网站:</strong>这是一个简单的react应用程序，用于访问AWS上的个性化数据(待办事项)。</li><li id="00a0" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt ir">弹出脚本:</strong>允许用户登录AWS。安全令牌存储在Chrome存储器中。</li><li id="3733" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt ir">内容脚本:</strong>通过Chrome存储中的安全令牌，内容脚本可以访问AWS上的个性化数据。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8af480b9d37d938061477fb69222991a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6wNbAV5UCg8832ZtWk_bBQ.png"/></div></div></figure><h2 id="747f" class="nq mu iq bd mv nr ns dn mz nt nu dp nd la nv nw nf le nx ny nh li nz oa nj ob bi translated">设置</h2><p id="c15f" class="pw-post-body-paragraph kr ks iq kt b ku nl jr kw kx nm ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">克隆<a class="ae oc" href="https://gitlab.com/kmiyashita/chrome-extension-amplify-auth.git" rel="noopener ugc nofollow" target="_blank">样板文件</a>，并安装依赖项。</p><pre class="kg kh ki kj gt ol ok om on aw oo bi"><span id="a2f2" class="nq mu iq ok b gy op oq l or os">$ git clone <a class="ae oc" href="https://gitlab.com/kmiyashita/chrome-extension-amplify-auth.git" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/kmiyashita/chrome-extension-amplify-auth.git</a><br/>$ cd chrome-extension-amplify-auth<br/>$ yarn</span></pre><p id="13db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">移动到Amplify项目的子文件夹并初始化项目。</p><pre class="kg kh ki kj gt ol ok om on aw oo bi"><span id="563a" class="nq mu iq ok b gy op oq l or os">$ cd packages/amplify-shared<br/>$ amplify init<br/>? Choose your default editor: Visual Studio Code<br/>? Select the authentication method you want to use: AWS profile<br/>? Please choose the profile you want to use:  default</span></pre><p id="c461" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，使用amplify目录中的配置文件提供后端资源。</p><pre class="kg kh ki kj gt ol ok om on aw oo bi"><span id="ff60" class="nq mu iq ok b gy op oq l or os">$ amplify push</span></pre><h2 id="6290" class="nq mu iq bd mv nr ns dn mz nt nu dp nd la nv nw nf le nx ny nh li nz oa nj ob bi translated">运行Chrome扩展</h2><p id="3fb5" class="pw-post-body-paragraph kr ks iq kt b ku nl jr kw kx nm ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">构建Chrome扩展:</p><pre class="kg kh ki kj gt ol ok om on aw oo bi"><span id="cfea" class="nq mu iq ok b gy op oq l or os">$ yarn build</span></pre><p id="e9ea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">打开Chrome浏览器的扩展管理，加载<code class="fe oh oi oj ok b">chrome-extension-amplify-auth/packages/chrome-ext/dist</code>内置的扩展</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/48e6151db0a9f4d2536222c2d13e8b92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*FCBqFpsXG-jjGa25kDzz7A.png"/></div></figure><p id="5432" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当您打开任何网页时，您会注意到您的内容脚本在右下角显示了一个小的覆盖图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/a14bdb0f94cc6c598bfb9373131b0407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*H55IMzDNgpRK4qyXg1hXCA.png"/></div></figure><p id="9bd6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">点击Chrome扩展图标，可以打开一个弹出窗口。创建一个新的用户帐户，然后登录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/321f4d4ee6aca35c36c20a79656e9485.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*XJYgq44rAVzFfIoL44PiHA.png"/></div></figure><p id="f914" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，内容脚本的覆盖图会自动更新并显示待办事项。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/50757214d77008b61c4fc9f9c487085d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*OeuBiW2OH_R9g8YBWCnjxA.png"/></div></figure><h2 id="b831" class="nq mu iq bd mv nr ns dn mz nt nu dp nd la nv nw nf le nx ny nh li nz oa nj ob bi translated">运行门户网站</h2><p id="07a8" class="pw-post-body-paragraph kr ks iq kt b ku nl jr kw kx nm ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">运行门户网站的web服务器。</p><pre class="kg kh ki kj gt ol ok om on aw oo bi"><span id="36aa" class="nq mu iq ok b gy op oq l or os">$ yarn start-web</span></pre><p id="9d16" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在Chrome浏览器中打开<code class="fe oh oi oj ok b">http://localhost:8080</code>，观察待办事项。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/a690d53883d78b2bd0ccd6c7b7117c97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*opwsXeuUUbcaBjKfC33zMQ.png"/></div></div></figure><h1 id="c1b1" class="mt mu iq bd mv mw mx my mz na nb nc nd jw ne jx nf jz ng ka nh kc ni kd nj nk bi translated">文件夹结构</h1><p id="0a9b" class="pw-post-body-paragraph kr ks iq kt b ku nl jr kw kx nm ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">关于文件夹结构，我们有以下两个要求。</p><ul class=""><li id="868a" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">应该在Chrome扩展(内容脚本、弹出脚本)和门户网站的多个包之间共享Amplify代码。</li><li id="62b0" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">需要为Chrome扩展创建多个包(内容脚本、弹出脚本、背景脚本)。</li></ul><p id="2545" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了满足这些要求，我们采取以下方法。</p><ul class=""><li id="cca2" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">单回购结构。</li><li id="ec99" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">Amplify项目在monorepo结构中形成一个独立的包(<code class="fe oh oi oj ok b">amplify-shared</code>)。这个包由两个包共享:<code class="fe oh oi oj ok b">chrome-ext</code>和<code class="fe oh oi oj ok b">web-ui</code>。</li><li id="a712" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">包"<code class="fe oh oi oj ok b">chrome-ext</code>有三个子文件夹，分别用于背景脚本、内容脚本和弹出脚本。Webpack从这些子文件夹中创建包。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e2167b71ab116113fd03b7796f969a86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E31WYh6bxyv5SWz5thrh2A.png"/></div></div></figure><h1 id="e7cd" class="mt mu iq bd mv mw mx my mz na nb nc nd jw ne jx nf jz ng ka nh kc ni kd nj nk bi translated">Chrome扩展的Webpack配置</h1><p id="35fb" class="pw-post-body-paragraph kr ks iq kt b ku nl jr kw kx nm ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">Webpack是现代JavaScript应用程序的静态模块捆绑器。在大多数情况下，从版本4.0.0开始，webpack不需要配置文件来捆绑您的项目。但是为了以下目的，我们将引入最小配置文件<code class="fe oh oi oj ok b"><a class="ae oc" href="https://gitlab.com/kmiyashita/chrome-extension-amplify-auth/-/blob/main/packages/chrome-ext/webpack.config.js" rel="noopener ugc nofollow" target="_blank">webpack.config.js</a></code>。</p><ul class=""><li id="df86" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">创建多个包(后台脚本、弹出脚本、内容脚本)</li><li id="eaee" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">将类型脚本代码编译成JavaScript。</li><li id="9875" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">禁止使用<code class="fe oh oi oj ok b">eval</code>进行源映射，因为Chrome extension的CSP(内容安全策略)不允许。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1c6a01c2b5142b854d7e6f16b44ce240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dNy5wHAnGLIRh7NUoMwp2Q.png"/></div></div></figure><h1 id="8983" class="mt mu iq bd mv mw mx my mz na nb nc nd jw ne jx nf jz ng ka nh kc ni kd nj nk bi translated">证明</h1><p id="185f" class="pw-post-body-paragraph kr ks iq kt b ku nl jr kw kx nm ju kz la nn lc ld le no lg lh li np lk ll lm ij bi translated">当您使用AWS Amplify认证登录时，默认情况下，安全令牌存储在<a class="ae oc" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener ugc nofollow" target="_blank"> <em class="og"> localStorage </em> </a>中。登录后，Amplify函数使用存储的安全令牌访问数据。</p><p id="0c64" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不幸的是，在我们的场景中，这种机制并没有像预期的那样工作。弹出脚本在扩展的上下文中运行，而内容脚本在网页而不是扩展的上下文中运行。由于<em class="og"> localStorage </em>是按上下文分段的，因此内容脚本无法访问弹出脚本存储的安全令牌。</p><p id="f78a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是Amplify设计得很好，它允许我们定制安全令牌的存储位置。为了解决这个问题，我们使用<a class="ae oc" href="https://developer.chrome.com/docs/extensions/reference/storage/" rel="noopener ugc nofollow" target="_blank"><em class="og">chrome . storage . local</em></a>。它提供了与localStorage API相同的存储功能，但有以下主要区别:</p><ul class=""><li id="f1ba" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">扩展的内容脚本可以访问与弹出脚本共享的用户数据。</li><li id="dadb" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">它与批量读写操作是异步的，因此比阻塞和串行localStorage API更快。</li></ul><p id="b2f5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是为安全令牌实现自定义存储的<code class="fe oh oi oj ok b"><a class="ae oc" href="https://gitlab.com/kmiyashita/chrome-extension-amplify-auth/-/blob/main/packages/chrome-ext/src/common/SharedAuthStorage.ts" rel="noopener ugc nofollow" target="_blank">SharedAuthStorage.ts</a></code>。</p><p id="b08f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">在弹出的脚本中</strong></p><ul class=""><li id="07d5" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><code class="fe oh oi oj ok b">setItem()</code> <em class="og"> </em>被调用，安全令牌存储在<em class="og"> chrome.storage.local </em>中。</li></ul><p id="2c29" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">在内容脚本中</strong></p><ul class=""><li id="7eb5" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><em class="og"> </em>谓之<code class="fe oh oi oj ok b">Amplify.configure()</code>。它填充内存缓存，扫描<code class="fe oh oi oj ok b">chrome.storage.local</code>。</li><li id="950d" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">一旦内存缓存被填充，<em class="og"> </em> <code class="fe oh oi oj ok b">getItem()</code>可以同步返回值(安全令牌)。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oy oz l"/></div></figure><p id="ce1c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以如下配置Amplify使用该自定义存储<a class="ae oc" href="https://gitlab.com/kmiyashita/chrome-extension-amplify-auth/-/blob/main/packages/chrome-ext/src/content/Overlay.tsx#L8" rel="noopener ugc nofollow" target="_blank">。通过这种方式，您可以将自己的定制与Amplify CLI管理的各种AWS配置参数(<code class="fe oh oi oj ok b">awsExports</code>)结合起来。</a></p><pre class="kg kh ki kj gt ol ok om on aw oo bi"><span id="0f64" class="nq mu iq ok b gy op oq l or os">Amplify.configure({<br/>    ...awsExports,<br/>    Auth: {storage: SharedAuthStorage}<br/>});</span></pre></div><div class="ab cl pa pb hu pc" role="separator"><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf"/></div><div class="ij ik il im in"><p id="9006" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本文解释了如何在Chrome扩展中使用带认证的Amplify。希望样板文件对你的发展有所帮助。</p></div></div>    
</body>
</html>