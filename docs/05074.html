<html>
<head>
<title>The Downsides of BigInts in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中BigInts的缺点</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-downsides-of-bigints-in-javascript-6350fd807d?source=collection_archive---------0-----------------------#2020-06-05">https://betterprogramming.pub/the-downsides-of-bigints-in-javascript-6350fd807d?source=collection_archive---------0-----------------------#2020-06-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2b67" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用JavaScript新的BigInt原始类型的一些主要区别和缺点</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1cfcfb0ddb48e17892a8ebf033ae1301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_iw2r_einAlrZnQgmQhQ7Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约翰·莫塞斯·鲍恩在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="a19b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你熟悉新的<a class="ae ky" href="https://medium.com/better-programming/javascript-es2020-features-with-simple-examples-d301dbef2c37" rel="noopener"> ES2020 </a>特性<code class="fe lv lw lx ly b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt" rel="noopener ugc nofollow" target="_blank">BigInts</a></code>，那么你已经知道它们是JavaScript的一个新的整数原语类型。</p><p id="b2c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你从未听说过它们，<a class="lz ma ep" href="https://medium.com/u/1a6d3d2733d0?source=post_page-----6350fd807d--------------------------------" rel="noopener" target="_blank">法拉兹·凯尔希尼</a>为<a class="ae ky" href="https://www.smashingmagazine.com/2019/07/essential-guide-javascript-newest-data-type-bigint/" rel="noopener ugc nofollow" target="_blank"> Smashing Magazine </a>写了一本很棒的<code class="fe lv lw lx ly b">BigInts</code>指南，它会让你了解:</p><div class="mb mc gp gr md me"><a href="https://www.smashingmagazine.com/2019/07/essential-guide-javascript-newest-data-type-bigint/" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd iu gy z fp mj fr fs mk fu fw is bi translated">JavaScript最新数据类型的基本指南:BigInt - Smashing Magazine</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">在JavaScript中，数字类型不能安全地表示大于2⁵的整数值。这种限制迫使…</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">www.smashingmagazine.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms ks me"/></div></div></a></div><p id="058b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与常规的<code class="fe lv lw lx ly b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number" rel="noopener ugc nofollow" target="_blank">number</a></code>类型相比，<code class="fe lv lw lx ly b">BigInts</code>具有<a class="ae ky" href="https://en.wikipedia.org/wiki/Arbitrary-precision_arithmetic" rel="noopener ugc nofollow" target="_blank">任意</a>(无限制)精度，这意味着它们可以接受任意位数。作为整数，它们不会受到JavaScript的浮点舍入错误的影响，这些错误会在你的代码中引起奇怪的错误。</p><p id="0045" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，这种精度是以不接受十进制值为代价的。毕竟，<code class="fe lv lw lx ly b">BigInts</code>是整数，不是浮点。</p><p id="5ac9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有<code class="fe lv lw lx ly b">BigInts</code>不要和数字混在一起。试图在同一个JavaScript语句中一起使用它们会导致一个<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypeError" rel="noopener ugc nofollow" target="_blank">类型错误</a>。</p><p id="c1b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是在您开始在代码中使用它们之前，您应该知道<code class="fe lv lw lx ly b">BigInts</code>还有两个缺点。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="4823" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">1.表演</h1><p id="28ac" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">首先，<code class="fe lv lw lx ly b">BigInts</code>比使用number原语类型要慢——在某些情况下要慢得多。</p><blockquote class="nx ny nz"><p id="d9e1" class="kz la oa lb b lc ld ju le lf lg jx lh ob lj lk ll oc ln lo lp od lr ls lt lu im bi translated">“与基元数的<a class="ae ky" href="https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html" rel="noopener ugc nofollow" target="_blank">浮点算术</a>相比，涉及BigInt的算术运算要慢一些。</p><p id="1443" class="kz la oa lb b lc ld ju le lf lg jx lh ob lj lk ll oc ln lo lp od lr ls lt lu im bi translated">浮点运算是用硬件实现的，因此速度更快。任意精度算法完全在软件中实现，因此速度较慢。”— <a class="ae ky" href="https://www.tektutorialshub.com/typescript/typescript-bigint-vs-number/" rel="noopener ugc nofollow" target="_blank"> TekTutorialsHub </a></p></blockquote><p id="f4fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我使用<a class="ae ky" href="https://jsperf.com/" rel="noopener ugc nofollow" target="_blank"> jsPerf </a>测试<code class="fe lv lw lx ly b">BigInt</code>微性能时，我发现两个质数相乘所需的时间有显著差异:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/64343550936b2e67ed1e9b865f1c950c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2PsLNNVFnQeBl4XjkGoTig.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://jsperf.com/bigints-vs-number-arithmetic-in-javascript" rel="noopener ugc nofollow" target="_blank"> jsPerf </a>查看这些测试用例。</p></figure><p id="1dee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">BigInt</code>乘法比<code class="fe lv lw lx ly b">number</code>乘法慢99%。</p><p id="c965" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，每秒1200万次计算仍然快得离谱，但是您应该记住性能影响。</p><p id="f352" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">换句话说，如果你必须用它们做很多复杂的数学运算，不要只是把你所有的数字都换成<code class="fe lv lw lx ly b">BigInts</code>。</p><p id="3d85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只有当您打算超过JavaScript的最大“安全”整数(<code class="fe lv lw lx ly b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER" rel="noopener ugc nofollow" target="_blank">MAX_SAFE_INTEGER</a></code>)时，才需要<code class="fe lv lw lx ly b">BigInts</code>，该值为9007199254740991(或2⁵ -1)。</p><p id="d474" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果您正在处理万亿(12位或更少)的数值，并且算术性能是一个问题，那么使用数字—而不是<code class="fe lv lw lx ly b">BigInts</code>。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="93c7" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">2.不适合密码学</h1><p id="93d8" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">所以你想在你的应用中加入加密安全？抱歉，但是<code class="fe lv lw lx ly b">BigInts</code>将不会是一个安全的选择，尽管它们有任意的精度。</p><blockquote class="of"><p id="c6c9" class="og oh it bd oi oj ok ol om on oo lu dk translated"><code class="fe lv lw lx ly b">BigInt</code> s上支持的操作不是恒定时间。<code class="fe lv lw lx ly b">BigInt</code>因此<a class="ae ky" href="https://www.chosenplaintext.ca/articles/beginners-guide-constant-time-cryptography.html" rel="noopener ugc nofollow" target="_blank">不适合用于密码术</a>。”— <a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt#cryptography" rel="noopener ugc nofollow" target="_blank"> MDN网络文档</a></p></blockquote><p id="51d2" class="pw-post-body-paragraph kz la it lb b lc op ju le lf oq jx lh li or lk ll lm os lo lp lq ot ls lt lu im bi translated">换句话说，<code class="fe lv lw lx ly b">BigInts</code>不是<a class="ae ky" href="https://medium.com/topic/blockchain" rel="noopener">区块链</a>或<a class="ae ky" href="https://medium.com/topic/cryptocurrency" rel="noopener">加密货币</a>项目的合适选择。</p><p id="8ce7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">BigInts</code>不适合密码学的原因是对它们的运算不是<a class="ae ky" href="http://inst.eecs.berkeley.edu/~cs10/labs/cur/programming/algorithms/timing/constant-time.html?topic=berkeley_bjc%2Fareas%2Falgorithm-complexity.topic" rel="noopener ugc nofollow" target="_blank">常数时间</a>，在<a class="ae ky" href="https://www.interviewcake.com/article/javascript/big-o-notation-time-and-space-complexity" rel="noopener ugc nofollow" target="_blank"> Big-O符号</a>中也称为<a class="ae ky" href="https://en.wikipedia.org/wiki/Time_complexity#Constant_time" rel="noopener ugc nofollow" target="_blank"> <em class="oa"> O(1) </em> </a>。</p><p id="8331" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们暂时解开这个谜团。这个想法是，你可能试图比较一个私人的，秘密的密钥与一个密码尝试。</p><p id="9bf6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果密钥是“2343434”，尝试是“343434”，那么JavaScript将比较每个中的第一个数字，并立即返回<code class="fe lv lw lx ly b">false</code>。与尝试输入“2343435”相比，该比较返回所需的时间要少得多，2343435是一个具有更多匹配数字的值。</p><p id="d960" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了破解密钥，攻击者可以跟踪比较时间，并了解到“2343435”比“343434”更接近密钥</p><p id="0f19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到Big-O符号，用<code class="fe lv lw lx ly b">BigInts</code>比较等式是<em class="oa">O(n)</em>——取决于正确匹配字符的长度(n)。</p><p id="811a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想要用JavaScript实现密码安全的开发者应该去看看<a class="ae ky" href="https://www.w3.org/TR/WebCryptoAPI/" rel="noopener ugc nofollow" target="_blank"> WebCryptoAPI </a>、<a class="ae ky" href="http://bitwiseshiftleft.github.io/sjcl/" rel="noopener ugc nofollow" target="_blank"> SJCL </a>、<a class="ae ky" href="https://github.com/tonyg/js-nacl" rel="noopener ugc nofollow" target="_blank"> js-nacl </a>、<a class="ae ky" href="https://github.com/JoshKaufman/ursa" rel="noopener ugc nofollow" target="_blank"> ursa </a>或者<a class="ae ky" href="https://github.com/openpgpjs/openpgpjs" rel="noopener ugc nofollow" target="_blank"> openpgpjs </a>。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="fb99" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">结论</h1><p id="8972" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">是JavaScript的一个很酷、有趣的新特性。但是它们有一些显著的缺点，可能会让你三思。</p><p id="2f78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你不能在你的JavaScript代码中混合使用<code class="fe lv lw lx ly b">BigInts</code>和数字而不产生类型错误，所以你可能想要使用<a class="ae ky" href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-2.html" rel="noopener ugc nofollow" target="_blank">类型脚本和</a> <code class="fe lv lw lx ly b"><a class="ae ky" href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-2.html" rel="noopener ugc nofollow" target="_blank">BigInts</a></code>。</p><p id="6c96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单独使用JavaScript，你需要知道如何检查一个<a class="ae ky" href="https://medium.com/javascript-in-plain-english/how-to-check-for-a-number-in-javascript-8d9024708153" rel="noopener">数字</a>是否真的是一个<code class="fe lv lw lx ly b"><a class="ae ky" href="https://levelup.gitconnected.com/how-to-check-if-a-number-is-a-bigint-in-javascript-6d658be6e89c" rel="noopener ugc nofollow" target="_blank">BigInt</a></code>，正如我在之前的文章中解释的<a class="ae ky" href="https://medium.com/p/6d658be6e89c" rel="noopener">。</a></p><p id="27aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">BigInts</code>的其他缺点与性能和加密安全有关。</p><p id="7bc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为<code class="fe lv lw lx ly b">BigInt</code>运算是在软件而不是硬件中执行的，<code class="fe lv lw lx ly b">BigInt</code>性能比使用数字的计算要慢得多。</p><p id="b0a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，<code class="fe lv lw lx ly b">BigInts</code>不适合加密，尽管你可以很容易地使<code class="fe lv lw lx ly b">BigInt</code>有几千位长，因为<code class="fe lv lw lx ly b">BigInt</code>值之间的比较不是在常数时间内进行的。</p><p id="550f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些缺点使得<code class="fe lv lw lx ly b">BigInts</code>不适合区块链的项目。</p><p id="b43f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望这有助于您理解JavaScript数字和<code class="fe lv lw lx ly b">BigInt</code>原始类型之间的区别。编码快乐！</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><p id="8b7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">德里克·奥斯汀博士是《职业编程:如何在6个月内成为一名成功的6位数程序员 》一书的作者，该书现已在亚马逊上架。</p></div></div>    
</body>
</html>