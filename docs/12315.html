<html>
<head>
<title>How To Visualize Time-Series Data in JavaScript With Chart.js and InfluxDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Chart.js和InfluxDB在JavaScript中可视化时间序列数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-visualize-time-series-data-in-javascript-with-chart-js-and-influxdb-7e0a9496d77e?source=collection_archive---------2-----------------------#2022-05-27">https://betterprogramming.pub/how-to-visualize-time-series-data-in-javascript-with-chart-js-and-influxdb-7e0a9496d77e?source=collection_archive---------2-----------------------#2022-05-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="767e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在本文中，您将学习如何从InfluxDB导入数据，并使用Chart.js将其可视化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cb4d47be37951d1db3c58632a8d2993c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c9Md7eTk9ZYppsrpav7AJA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯·利维拉尼在<a class="ae ky" href="https://unsplash.com/s/photos/data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3687" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列数据是指在特定时间段内重复收集的数据，如一秒钟、一分钟甚至一天。例如，比特币等加密货币的价格就是时间序列数据的一个很好的例子。它每分钟都在波动，如果你试图每60秒保存一次价格，你就会遇到可伸缩性问题。您的数据库将会不断增长，超过某一点后，使用将会变得低效。</p><p id="17e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要处理时序数据，您需要一个名为时序数据库(TSDB)的数据库。临时数据库针对存储时间序列数据进行了优化，使其更易于使用。<a class="ae ky" href="https://www.influxdata.com/" rel="noopener ugc nofollow" target="_blank"> InfluxDB </a>提供了一个开源的TSDB来高效地处理时间序列数据。</p><p id="7bba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，您将学习如何结合使用<a class="ae ky" href="https://www.chartjs.org/" rel="noopener ugc nofollow" target="_blank"> Chart.js </a>和<a class="ae ky" href="https://docs.influxdata.com/influxdb/cloud/api-guide/client-libraries/nodejs/" rel="noopener ugc nofollow" target="_blank"> InfluxDB'a JavaScript客户端</a>进行可视化。</p><blockquote class="lv lw lx"><p id="8247" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">如果你想克隆这个项目并在你自己的编辑器中跟随，这里有到<a class="ae ky" href="https://github.com/rahulbanerjee26/InfluxDB_Charts_js" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>的链接。</p></blockquote><h1 id="2450" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是InfluxDB？</h1><p id="6480" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://www.influxdata.com/" rel="noopener ugc nofollow" target="_blank"> InfluxDB </a>为开发者提供存储时序数据并高效查询的解决方案。它支持包括C++、Python、Rust和Java在内的主要语言。此外，它有自己的查询语言，称为<a class="ae ky" href="https://docs.influxdata.com/influxdb/cloud/query-data/get-started/" rel="noopener ugc nofollow" target="_blank"> Flux </a>，类似于SQL，但特定于InfluxDB。</p><p id="9279" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">InfluxDB可用于执行以下操作:</p><ul class=""><li id="0edb" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">存储web服务、机器学习模型或API的日志</li><li id="6007" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">金融预测和股票分析</li><li id="f5aa" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">处理从物联网设备接收的数据或来自车辆的传感器数据</li></ul><p id="78ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您正在处理任何带有时间戳的数据，InfluxDB可能是一个不错的解决方案。</p><h1 id="bccd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是Chart.js？</h1><p id="84ce" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Chart.js是一个开源的JavaScript库，可以让你轻松地为你的网站创建图表。它带有内置图表，但您可以自定义它们，并创建自己独特的视觉效果。</p><p id="92ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们设置一下<code class="fe nn no np nq b">Chart.js</code>。</p><h1 id="89df" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置Chart.js</h1><p id="a191" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本教程中，您将使用普通的JavaScript。然而，如果您正在使用JavaScript框架，请查看<code class="fe nn no np nq b">Chart.js</code>的<a class="ae ky" href="https://www.chartjs.org/docs/latest/" rel="noopener ugc nofollow" target="_blank">入门</a>页面了解更多信息。</p><p id="5b90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要开始设置<code class="fe nn no np nq b">Chart.js</code>，用一些标准代码创建一个HTML文件，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="692e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您需要添加一个脚本标记来加载Chart.js:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="8bec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nn no np nq b">title</code>标签正上方的<code class="fe nn no np nq b">head</code>标签内添加脚本标签。</p><p id="f704" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nn no np nq b">body</code>标签内部，需要添加一个<code class="fe nn no np nq b">canvas</code>元素。此元素将包含图表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><blockquote class="lv lw lx"><p id="7ccf" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">保存<code class="fe nn no np nq b">ID</code>，因为在本教程稍后创建图表时会用到它。</p></blockquote><p id="46f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于JavaScript部分，您可以创建一个<code class="fe nn no np nq b">script</code>标签并将其指向一个单独的文件，或者您可以直接在其中编写您的JavaScript代码。确保在canvas元素之后有您的script标记(不管您在哪里编写JavaScript)。在本教程中，您将在一个单独的文件中编写JavaScript，因此需要在canvas元素下添加以下脚本标记:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h1 id="7461" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建折线图</h1><p id="0e22" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在你已经设置了<code class="fe nn no np nq b">Chart.js</code>，让我们创建一个<a class="ae ky" href="https://www.chartjs.org/docs/latest/charts/line.html" rel="noopener ugc nofollow" target="_blank">折线图</a>，这是一种在一条线上绘制数据点的方法。</p><p id="fbe2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用以下数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="bd72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据包含2021年3月7日至3月18日苹果(AAPL)和Spotify(现货)股票的高价格。</p><p id="4350" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了创建一个数据集，<code class="fe nn no np nq b">Chart.js</code>将使用上面的数据绘制一个折线图。下面是创建数据集的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="7640" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">labels</code>中的值(即日期)和<code class="fe nn no np nq b">datasets</code>数组中的对象是您试图绘制的线。你可以随意调整线条的颜色。</p><p id="db22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您需要为您的图表创建一个配置对象。config对象将告诉<code class="fe nn no np nq b">Chart.js</code>你想要什么类型的图表以及你想要绘制的数据集。它还可以让你定制你的图表。下面是配置对象:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="8157" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，将<code class="fe nn no np nq b">type</code>指定为<code class="fe nn no np nq b">'line'</code>，并将<code class="fe nn no np nq b">options</code>的值留空。与<code class="fe nn no np nq b">options</code>相关联的对象允许您定制您的图形并覆盖一些默认的图表配置。</p><p id="3f26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nn no np nq b">options</code>中，你会注意到<code class="fe nn no np nq b">responsive</code>被设置为假。然而，默认情况下，它将被设置为<code class="fe nn no np nq b">true</code>。当设置为<code class="fe nn no np nq b">true</code>时，如果您改变画布的大小，图形将不会放大或缩小。如果你想了解更多关于定制的信息，你可以访问Chart.js的网站。</p><p id="fca2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您已经创建了config对象，您最终可以使用以下代码创建折线图:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="7cdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要引用之前在HTML文件中创建的canvas元素的ID。使用浏览器打开HTML文件，您应该会看到下图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/e12a4218005d6278da423d4674085014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8wHDUW_6-SvGYtIP.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例折线图</p></figure><h1 id="1365" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建条形图</h1><p id="abfd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可以使用在上一节中创建的相同dataset对象来创建一个条形图，该条形图以竖条的形式显示数据值。</p><p id="f91b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，在包含条形图的HTML主体中创建一个新的<code class="fe nn no np nq b">canvas</code>元素。确保它位于包含<code class="fe nn no np nq b">Chart.js</code> JavaScript代码的脚本标签之上:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="98cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，创建一个<code class="fe nn no np nq b">config</code>对象和<code class="fe nn no np nq b">Chart</code>的实例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="aee3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为您正在创建条形图，所以<code class="fe nn no np nq b">type</code>的值需要设置为<code class="fe nn no np nq b">'bar'</code>。使用浏览器打开HTML文件，您应该会看到下面的条形图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/5c2a34807867e10d486b0983c5c9ad5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bHlX_lsa8oia8U8p.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">条形图样本</p></figure><h1 id="67cc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建散点图</h1><p id="faa7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">一个<a class="ae ky" href="https://www.chartjs.org/docs/latest/charts/scatter.html" rel="noopener ugc nofollow" target="_blank">散点图</a>是基于一个折线图，但是x轴变成了线性。对于前两个图表，您将x轴标签作为一个列表传递，将y值作为一个单独的列表传递。但是，对于散点图，您的数据必须是一个对象列表，其中每个对象代表一个x-y坐标。</p><p id="b89d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，像前面一样为散点图创建一个画布元素:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="68b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后创建您的数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="6a2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">points_1</code>和<code class="fe nn no np nq b">points_2</code>是两个独立的列表，包含代表x-y坐标的对象集合。接下来，您需要使用数据来创建数据集:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="470e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，创建一个<code class="fe nn no np nq b">config</code>对象和一个<code class="fe nn no np nq b">Chart</code>实例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="1c19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在浏览器中打开您的HTML文件，您应该会看到如下所示的图形:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/731cc9bf46d807bf281a2d480416fa7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QaVFFEFteCyfcnT-.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">散点图示例</p></figure><h1 id="00e3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置InfluxDB</h1><p id="3930" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在你开始设置InfluxDB之前，你需要<a class="ae ky" href="https://docs.influxdata.com/influxdb/v2.1/install/" rel="noopener ugc nofollow" target="_blank">下载</a>你的操作系统的软件包。或者，如果您有<a class="ae ky" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>，您可以使用下面的命令下载并运行InfluxDB的Docker:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="6ed3" class="ny md it nq b gy nz oa l ob oc">docker run --name influxdb -p 8086:8086 influxdb:2.1.0</span></pre><p id="1b9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在Mac上，你可以使用<a class="ae ky" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">自制软件</a>进行安装:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="158e" class="ny md it nq b gy nz oa l ob oc">brew install influxdb</span></pre><p id="19b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装InfluxDB后，使用以下命令设置InfluxDB的实例:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="e96d" class="ny md it nq b gy nz oa l ob oc">influxd</span></pre><p id="634a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到<code class="fe nn no np nq b"><a class="ae ky" href="http://localhost:8086/" rel="noopener ugc nofollow" target="_blank">http://localhost:8086/</a></code>，您应该会看到开始屏幕:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/a6e7d935e6a89324475ce295e1055df5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zTxC-6rLBmtJNT9U.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">InfluxDB欢迎屏幕</p></figure><p id="af29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击入门&gt;快速入门，您应该会看到以下新用户屏幕:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/09b735c82f2452ee92e49027778e4f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*50RUcnqHPefUDtSo.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">InfluxDB设置初始用户页面</p></figure><p id="2b1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以为您的组织和存储桶选择任何您想要的名称，只需做好记录，因为您将在本教程的后面需要这些名称。创建帐户后，您将被带回到您的仪表板。单击Load your data，您应该会看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/efac7d5225e476fc44b8e9e5b7c89170.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NPPyrnTKvwUFxDYy.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">InfluxDB加载数据页面</p></figure><p id="80ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择<code class="fe nn no np nq b">JavaScript/Node.js</code>选项，您将被重定向到Node.js页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/271489a2c7f82c3ac71550afdb1ed3f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fIvFC8Y7uEE2XIDy.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用NodeJS页面加载数据</p></figure><p id="3880" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击生成令牌&gt;所有访问令牌。</p><p id="e089" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按照本教程，您可以使用一个全访问令牌，但是出于安全原因，您可能希望限制访问。获得令牌ID后，将其复制到安全的地方，因为在连接InfluxDB时会用到它。</p><p id="e1da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您已经准备好开始编码了。用标准样板文件创建新的HTML文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><blockquote class="lv lw lx"><p id="95cf" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">不要忘记包含加载<code class="fe nn no np nq b">Chart.js</code>的脚本，因为您将使用它来可视化时间序列数据。</p></blockquote><p id="9ddc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使本教程易于理解，您将在HTML主体的脚本标记中编写所有的JavaScript。理想情况下，你可以使用像<a class="ae ky" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> webpack </a>这样的工具，或者创建一个服务器来呈现你的前端。</p><p id="0515" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将以下内容添加到您的<code class="fe nn no np nq b">script</code>标签中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="269e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保您有一个InfluxDB实例在<code class="fe nn no np nq b"><a class="ae ky" href="http://localhost:8086/" rel="noopener ugc nofollow" target="_blank">http://localhost:8086/</a></code>上运行。然后，在浏览器中打开您的HTML文件，您应该看到客户机对象在控制台中被打印出来。</p><h1 id="97c7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将数据导入InfluxDB</h1><p id="9e4e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们将处理更多的股票数据。在这一部分，我们将使用APPL股票和MSFT股票。你可以从<a class="ae ky" href="https://github.com/rahulbanerjee26/InfluxDB_Charts_js" rel="noopener ugc nofollow" target="_blank">这里</a>下载AAPL股票数据和MSFT股票数据。</p><p id="ada9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据写入<a class="ae ky" href="https://docs.influxdata.com/influxdb/v2.1/reference/syntax/line-protocol/" rel="noopener ugc nofollow" target="_blank">线路协议</a>。这是一个样本数据点:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="8395" class="ny md it nq b gy nz oa l ob oc">AAPL_2021-01-04,stock=AAPL Open=133.52000427246094,High=133.61000061035156,Low=126.76000213623047 1609718400</span></pre><p id="c3a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它遵循以下格式:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="7329" class="ny md it nq b gy nz oa l ob oc">myMeasurement,tag1=value1 fieldKey="fieldValue" Unix Timestamp</span></pre><ul class=""><li id="6a33" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><code class="fe nn no np nq b">AAPL_2021–01–04 </code>用于唯一标识数据点。</li><li id="239e" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe nn no np nq b">stock=AAPL</code>将数据点分组为APPL股票。对于MSFT股票，价值将是MSFT</li><li id="7ca7" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe nn no np nq b">Open=133.52000427246094</code>、<code class="fe nn no np nq b">High=133.61000061035156</code>、<code class="fe nn no np nq b">Low=126.76000213623047</code>是我们将要存储的字段值。它包括2021年1月4日APPL股票的开盘价、最高价和最低价</li><li id="0188" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe nn no np nq b">1609718400</code>2021–01–04是否在UNIX时间戳中转换</li></ul><p id="6111" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到<code class="fe nn no np nq b">localhost:8086</code>，点击左栏中的数据。点击桶&gt;创建一个桶。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/44a3a0cdb051e8ab5e355e7f97593cc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*clkA4luDTZ8RmaQ9.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">InfluxDB创建存储桶页</p></figure><p id="879c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将存储桶命名为“Stocks ”,保留默认选项。创建存储桶后，您需要添加数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/e887ba5e7691fd2ae3645fb875b7dc9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1tVXUDhFAo-GylAC.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">InfluxDB加载数据页面</p></figure><p id="d404" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击“线路协议”虽然我们的数据存储在CSV文件中，但它是以line协议格式编写的。</p><p id="f843" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会看到一个上传数据的选项。默认情况下，精度设置为纳秒，将其更改为秒。如果你不这样做，你的数据的时间戳会被弄乱。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/c742e54955904d03f95a9deb75815092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sW8n2H8FykvjJ8pj.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用线路协议添加数据页面</p></figure><p id="c2d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上传APPL股票数据和MSFT股票数据。</p><p id="d8b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上传数据后，选择您的存储桶，您将被重定向到以下页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/41b3676dc7570f8cfe55b7d535836d03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ldLyyVJk_0uqU1XS.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">InfluxDB数据浏览器页面</p></figure><p id="a353" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击脚本编辑器。你可以在编辑器中使用Flux来查询你的数据。</p><p id="46dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个示例查询，它返回2021年1月的所有数据:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="90be" class="ny md it nq b gy nz oa l ob oc">from(bucket:"Stocks")<br/>    |&gt; range(start: 2021-01-01, stop: 2021-01-31)</span></pre><p id="285e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在数据资源管理器下，您可以选择查看数据的方式。选择“表格”。您应该会看到如下所示的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/03292cb0d36b5fc43d87dc3516198dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BmcBaETFOIvi2m59.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">InfluxDB数据浏览器页面</p></figure><p id="4fdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们尝试检索2021年1月APPL股票的开盘价和最高价:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="2627" class="ny md it nq b gy nz oa l ob oc">from(bucket:"Stocks")<br/>    |&gt; range(start: 2021-01-01, stop: 2021-01-31)<br/>    |&gt; filter(fn: (r) =&gt; r._field == "Open" or r._field == "High")<br/>    |&gt; filter(fn: (r) =&gt; r.stock == "AAPL")</span></pre><h1 id="5990" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用InfluxDB和Chart.js</h1><p id="4146" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们创建一个简单的折线图，代表APPL股票在不同日期的高价值。</p><p id="caca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在<a class="ae ky" href="https://github.com/rahulbanerjee26/InfluxDB_Charts_js" rel="noopener ugc nofollow" target="_blank">本报告</a>中找到本节所写的HTML和JavaScript</p><p id="b8a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到您为此部分创建的HTML文件。在您的主体中，在脚本标记(导入InfluxDB客户端并使用您的令牌创建客户端实例的脚本标记)上方添加一个canvas元素。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="de6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nn no np nq b">script</code>标签内，添加以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="8799" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将让我们使用flux在InfluxDB中查询我们的bucket。</p><p id="8c2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要执行查询，您需要两件事情。flux查询本身和一个observer对象。观察者对象允许您执行以下操作</p><ul class=""><li id="3717" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">如果flux查询返回多行，那么observer对象允许您对返回的每一行执行操作</li><li id="3658" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">它允许您处理错误</li><li id="849f" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">它允许您在成功返回所有行后执行操作。</li></ul><p id="2584" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个观察者对象示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="4fcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的<code class="fe nn no np nq b">Chart.js</code>代码将进入完整的函数。</p><p id="d68b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，创建一个变量来存储flux查询，并创建两个变量来存储数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="300c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">Query</code>将返回作为数据库中存储的所有日期的参数传入的<code class="fe nn no np nq b">stock</code>的高值。</p><p id="289f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，创建观察者对象，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="2d29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">暂时将完整的函数留空。在下一个函数中，我们从对象中读取数据，并将其存储在之前创建的变量中。不要忘记在存储之前将Unix时间戳转换成可读的日期时间格式。</p><p id="ed4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所述，完整的函数将包含创建折线图的代码。</p><p id="9937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是完整的函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="7bf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这与我们在本教程前面部分创建的折线图非常相似。下面是从InfluxDB查询日期并创建折线图的完整代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="e708" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一行执行查询。在浏览器中打开您的HTML文件，您应该会看到下图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/d5040272b6a2bc3f8a556b98cd633a3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eTomkBUms2sRBlDr.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">线形图</p></figure><h1 id="ec28" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建一个条形图来比较APPL和MSFT的开盘价</h1><p id="f5be" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们创建一个条形图来比较AAPL和MSFT在2021年1月的开盘价。</p><p id="cc9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在继续之前，不要忘记创建<code class="fe nn no np nq b">canvas</code>元素:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="3497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用以下代码创建一个变量来存储我们的flux查询和一些其他变量，我们将需要这些变量来存储条形图的数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="f69c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">dates_open</code>将存储2021年1月的日期，<code class="fe nn no np nq b">aapl_open</code>和<code class="fe nn no np nq b">msft_open</code>将分别存储APPL和MSFT的未结值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="2186" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上是我们的观察者对象的下一个函数。我们有一个检查来避免存储重复的日期，并根据股票类型将数据存储在<code class="fe nn no np nq b">aapl_open</code>或<code class="fe nn no np nq b">msft_open</code>数组中。</p><p id="1313" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与上一节一样，您可以在<code class="fe nn no np nq b">observer</code>对象的完整函数中包含绘制条形图的代码。下面是完整的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="aa3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会看到下图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/f6a4b48dd27633908df4bd4014724622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FIR3RX5Pe0_m3Dlx.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">条形图</p></figure><h1 id="2e35" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建一个气泡图来显示高价格的变化</h1><p id="5106" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">一个b <a class="ae ky" href="https://www.chartjs.org/docs/latest/charts/bubble.html" rel="noopener ugc nofollow" target="_blank"> ubble图</a>类似于散点图。散点图可以绘制x和y坐标。另一方面，气泡图可以用不同的半径大小绘制x和y坐标。这里有一个来自<code class="fe nn no np nq b">Chart.js</code>的气泡图示例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/bef67125a58bdfd3a19c71eaaedb902b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*H2qfRe105mN59x_K.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">泡泡图</p></figure><p id="dde1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">气泡图的数据必须是对象数组的形式。该对象必须包含一个<code class="fe nn no np nq b">x</code>、<code class="fe nn no np nq b">y</code>和<code class="fe nn no np nq b">r</code>值。</p><p id="4cb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">r</code>值将决定绘图的大小。</p><p id="e6d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，我们将绘制以下内容:</p><ul class=""><li id="1c17" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><code class="fe nn no np nq b">x</code>是一个整数，代表一月中的某一天</li><li id="4a85" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe nn no np nq b">y</code>将是股票在<code class="fe nn no np nq b">x</code>日的最高价格</li><li id="48c9" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe nn no np nq b">r</code>将高开之间的相对百分比差值，即<code class="fe nn no np nq b">(High-Open)/Open*100</code></li></ul><p id="b563" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是返回上述数据的flux查询:</p><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="22ad" class="ny md it nq b gy nz oa l ob oc">from(bucket: "Stocks") <br/>    |&gt; range(start: 2021-01-03, stop:2021-01-31)<br/>    |&gt; filter(fn: (r) =&gt; r._field == "High" or r._field == "Open")<br/>    |&gt; pivot(rowKey: ["_time"], columnKey: ["_field"], valueColumn: "_value") <br/>    |&gt; map(fn: (r) =&gt; ({ r with "percentage": 100.0*(r.High- r.Open)/r.Open }))</span></pre><p id="5721" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过<a class="ae ky" href="https://docs.influxdata.com/influxdb/cloud/query-data/common-queries/multiple-fields-in-calculations/" rel="noopener ugc nofollow" target="_blank">这里的</a>了解更多关于上述查询中使用的各种flux命令的信息。</p><p id="e81e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们的下一个函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="39ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们根据该行是APPL股票还是MSFT股票来增加变量<code class="fe nn no np nq b">appl_count</code>和<code class="fe nn no np nq b">msft_count</code>。该计数是气泡图的<code class="fe nn no np nq b">x</code>值。存储百分比时，我们将其乘以<code class="fe nn no np nq b">2</code>，因为百分比值非常小。气泡图将<code class="fe nn no np nq b">r</code>值视为以像素为单位的半径。</p><p id="d4f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，为了使气泡更大，我们将百分比放大<code class="fe nn no np nq b">2</code>。因为我们对每个数据点进行缩放，所以不会影响气泡的相对大小。</p><p id="d5aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码的其余部分与前面几节非常相似，主要区别在于config对象中图表的类型。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="206b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该图表应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/6cc7598d4f6e01fceb85225979d056b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cW7HV2urwg4iOGXB.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">泡泡图</p></figure><h1 id="cfbb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="f59f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本教程中，您使用了<a class="ae ky" href="https://www.chartjs.org/" rel="noopener ugc nofollow" target="_blank"> Chart.js </a>和<a class="ae ky" href="https://www.influxdata.com/" rel="noopener ugc nofollow" target="_blank"> InfluxDB的</a> JavaScript客户端来可视化股票数据。您使用Flux从InfluxDB查询数据。您能够绘制各种图表，如折线图、条形图、散点图和气泡图。您还获得了使用InfluxDB的JavaScript客户端库的经验。</p><p id="17a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你感兴趣，你也可以看看<a class="ae ky" href="https://www.realpythonproject.com/getting-started-with-python-and-influxdb/" rel="noopener ugc nofollow" target="_blank">如何使用Python </a>的InfluxDB。</p></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt nu nq nv nw aw nx bi"><span id="fcfd" class="ny md it nq b gy nz oa l ob oc"><strong class="nq iu">Want to connect?</strong></span><span id="3899" class="ny md it nq b gy ok oa l ob oc">LinkedIn: <a class="ae ky" href="https://www.linkedin.com/in/rahulbanerjee2699/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/rahulbanerjee2699/</a></span><span id="b558" class="ny md it nq b gy ok oa l ob oc">The article was originally posted on <a class="ae ky" href="https://www.realpythonproject.com/how-to-visualize-time-series-data-in-javascript-with-chart-js-and-influxdb/" rel="noopener ugc nofollow" target="_blank">realpythonproject.com</a></span></pre></div></div>    
</body>
</html>