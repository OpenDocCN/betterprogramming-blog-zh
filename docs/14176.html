<html>
<head>
<title>How to Upload or Download Files With Spring Boot and Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Spring Boot和科特林上传或下载文件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-upload-download-files-with-spring-boot-and-kotlin-da95bb9d1842?source=collection_archive---------6-----------------------#2022-11-14">https://betterprogramming.pub/how-to-upload-download-files-with-spring-boot-and-kotlin-da95bb9d1842?source=collection_archive---------6-----------------------#2022-11-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7f5e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这篇文章旨在描述科特林和Spring Boot如何合作创建一个能够使用Spring Web <code class="fe ki kj kk kl b">MultipartFile</code>接口上传/下载文件的服务。</h2></div><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/54558fb0322a9f441d27dde58a0f7520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jeoHiV-IZK4MVDi6rYRQcA.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">图片由Karolina Grabowska(Pexels.com)提供</p></figure><h1 id="b949" class="lc ld it bd le lf lg lh li lj lk ll lm jz ln ka lo kc lp kd lq kf lr kg ls lt bi translated">环境</h1><p id="58e4" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">本分步指南是根据以下要求编写的:</p><ul class=""><li id="f0df" class="mq mr it lw b lx ms ma mt md mu mh mv ml mw mp mx my mz na bi translated">操作系统:macOS Catalina 10.15.7</li><li id="fd23" class="mq mr it lw b lx nb ma nc md nd mh ne ml nf mp mx my mz na bi translated">Java版本:OpenJDK版本“11.0.16”</li><li id="6f22" class="mq mr it lw b lx nb ma nc md nd mh ne ml nf mp mx my mz na bi translated">IntelliJ IDEA: 2022.2.2(社区版)</li><li id="c6bb" class="mq mr it lw b lx nb ma nc md nd mh ne ml nf mp mx my mz na bi translated">科特林:1.7.10</li></ul><p id="cb03" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated"><a class="ae nj" href="https://spring.io/projects/spring-boot" rel="noopener ugc nofollow" target="_blank"/><strong class="lw iu"/>是一个用于创建微服务的开源框架。它是由Pivotal团队开发的，用于构建独立的和生产就绪的Spring应用程序。它已经成为在基于JVM的技术中开发REST APIs的标准方法。Spring Boot通过删除大量样板代码来帮助开发人员，并支持各种组件的自动配置。</p><p id="e1bc" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated"><a class="ae nj" href="https://kotlinlang.org/" rel="noopener ugc nofollow" target="_blank"> Kotlin </a>是由<a class="ae nj" href="https://www.jetbrains.com/" rel="noopener ugc nofollow" target="_blank"> JetBrains </a>创建的一种通用、免费、开源、静态类型的“实用”编程语言。Kotlin结合了面向对象和函数式编程特性，它被设计成完全与Java互操作，并且Kotlin标准库的JVM版本依赖于Java类库。</p><h1 id="4d48" class="lc ld it bd le lf lg lh li lj lk ll lm jz ln ka lo kc lp kd lq kf lr kg ls lt bi translated">目标</h1><p id="ef5a" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">本教程旨在提供一个创建REST服务的快速实践参考，以方便上传/下载文件。</p><p id="7f49" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated">我们基于科特林的Spring Boot服务将提供以下API端点:</p><ul class=""><li id="0a14" class="mq mr it lw b lx ms ma mt md mu mh mv ml mw mp mx my mz na bi translated">将文件上传到服务器内的文件夹。</li><li id="1274" class="mq mr it lw b lx nb ma nc md nd mh ne ml nf mp mx my mz na bi translated">通过链接从服务器下载文件。</li></ul><h1 id="5afd" class="lc ld it bd le lf lg lh li lj lk ll lm jz ln ka lo kc lp kd lq kf lr kg ls lt bi translated">步骤1:创建项目</h1><p id="b086" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">创建spring boot项目最简单的方法是从<a class="ae nj" href="https://start/spring.io" rel="noopener ugc nofollow" target="_blank">https://start/spring . io</a>配置并下载它</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nk"><img src="../Images/a2c146c2109dae92dd59f9cf4d768397.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z9I5W1SPn-kWTuE0giqCUA.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">使用start.spring.io创建spring boot项目(图片由作者提供)</p></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nl"><img src="../Images/f4f25d5100eedd7a0465bac0c3ad87c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jZYqN33cOIc4jFzhYAuyUQ.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">将项目导入IDE(图片由作者提供)</p></figure><p id="628a" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated">一旦项目被导入到您的IDE中，我们就可以更新<code class="fe ki kj kk kl b">pom.xml</code>文件。也就是说，我们需要添加以下依赖项来为我们的项目提供web功能。</p><pre class="kn ko kp kq gt nm kl nn no aw np bi"><span id="03bd" class="nq ld it kl b gy nr ns l nt nu">&lt;dependency&gt;<br/>   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>   &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br/>&lt;/dependency&gt;</span></pre><p id="0371" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated">此外，我们还包含了另一个依赖项，以简化应用程序中日志功能的配置和使用。</p><pre class="kn ko kp kq gt nm kl nn no aw np bi"><span id="2036" class="nq ld it kl b gy nr ns l nt nu"><em class="nv">&lt;!-- To use Kotlin logger. The level is configured in applications.properties --&gt;<br/></em>&lt;dependency&gt;<br/>   &lt;groupId&gt;io.github.microutils&lt;/groupId&gt;<br/>   &lt;artifactId&gt;kotlin-logging-jvm&lt;/artifactId&gt;<br/>   &lt;version&gt;3.0.0&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><h1 id="118f" class="lc ld it bd le lf lg lh li lj lk ll lm jz ln ka lo kc lp kd lq kf lr kg ls lt bi translated">步骤2:服务开发</h1><h2 id="3259" class="nq ld it bd le nw nx dn li ny nz dp lm md oa ob lo mh oc od lq ml oe of ls og bi translated">项目结构</h2><p id="29dc" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">由于我们正在开发一个旨在可伸缩和可维护的服务，我们决定将源代码组织到不同的层中。如下所示，显示层(<code class="fe ki kj kk kl b">controller</code>、<code class="fe ki kj kk kl b">service</code>和<code class="fe ki kj kk kl b">data</code>文件夹)以及每个文件夹中包含的源代码文件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oh"><img src="../Images/f438453148d27aea589c97578215bc62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jSNShRLga3PPZzVIRDgXAw.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">项目结构(图片由作者提供)</p></figure><h2 id="f5ab" class="nq ld it bd le nw nx dn li ny nz dp lm md oa ob lo mh oc od lq ml oe of ls og bi translated">数据层</h2><p id="a24a" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">这一层包含所有用于存储相关可交换信息的类。对于这个特定的项目，我们创建了<a class="ae nj" href="https://kotlinlang.org/docs/data-classes.html" rel="noopener ugc nofollow" target="_blank">数据类</a> <code class="fe ki kj kk kl b">Response</code>，它封装了在调用任何API操作后发送给用户的消息。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">响应数据类</p></figure><h2 id="23e1" class="nq ld it bd le nw nx dn li ny nz dp lm md oa ob lo mh oc od lq ml oe of ls og bi translated">服务层</h2><p id="97dc" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">服务层将负责我们应用程序的业务逻辑。它由两个文件组成。</p><ul class=""><li id="f8d7" class="mq mr it lw b lx ms ma mt md mu mh mv ml mw mp mx my mz na bi translated"><code class="fe ki kj kk kl b">UploadFileService</code>:定义所需方法的界面。</li><li id="ac5d" class="mq mr it lw b lx nb ma nc md nd mh ne ml nf mp mx my mz na bi translated"><code class="fe ki kj kk kl b">UploadFileServiceImpl</code>:实现接口中定义的方法的类。按照Spring的建议，服务的实现必须用<code class="fe ki kj kk kl b">@Service</code>注释。</li></ul><p id="23df" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated">下面显示了服务接口和实现的源代码。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">上传文件服务接口定义</p></figure><blockquote class="ok ol om"><p id="0b40" class="lu lv nv lw b lx ms ju lz ma mt jx mc on ng mf mg oo nh mj mk op ni mn mo mp im bi translated"><em class="it">注意:为了学习和简单起见，我们决定在这个示例项目中使用</em> <code class="fe ki kj kk kl b"><a class="ae nj" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/run-catching.html" rel="noopener ugc nofollow" target="_blank"><em class="it">runCatching</em></a></code> <em class="it">作为处理异常的函数方法。然而，在决定将这段代码用于您的项目之前，我建议检查runCatching限制和用例。</em></p></blockquote><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">上传文件服务实现</p></figure><h2 id="b1f1" class="nq ld it bd le nw nx dn li ny nz dp lm md oa ob lo mh oc od lq ml oe of ls og bi translated">控制器层</h2><p id="13e4" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">一旦定义了应用程序的业务逻辑，我们需要通过REST端点向用户公开我们的API。控制器层允许我们以简单的方式提供这样的端点。我们的项目定义了两个操作:</p><pre class="kn ko kp kq gt nm kl nn no aw np bi"><span id="4487" class="nq ld it kl b gy nr ns l nt nu">| Operation     | Url                | Method | <br/>| ------------- | ------------------ |--------|<br/>| upload file   | /api/upload-file   | POST   |<br/>| download file | /api/download      | GET    |</span></pre><p id="8ae3" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated">下面描述了<code class="fe ki kj kk kl b">UploadFileController.kt</code>文件的源代码。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">上传文件控制器实现</p></figure><h2 id="3b20" class="nq ld it bd le nw nx dn li ny nz dp lm md oa ob lo mh oc od lq ml oe of ls og bi translated">应用程序入口点</h2><p id="6dd6" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">定义了REST端点之后，我们只需要更新应用的入口点，文件<code class="fe ki kj kk kl b">UploadFilesServiceApplication.kt</code> <em class="nv">。</em></p><p id="8e46" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated">因为我们需要在服务第一次启动时执行一些动作，所以我们创建了这个类来实现<code class="fe ki kj kk kl b">CommandLineRunner</code>接口。结果，我们被迫实现run方法，由此调用服务中的方法<code class="fe ki kj kk kl b">init</code>。这将创建存储上传文件的文件夹。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">入口点应用程序</p></figure><h2 id="4621" class="nq ld it bd le nw nx dn li ny nz dp lm md oa ob lo mh oc od lq ml oe of ls og bi translated">微服务配置</h2><p id="14d6" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">最后，我们需要通过编辑<code class="fe ki kj kk kl b">application.properties</code> <em class="nv"> </em>文件来定义一些属性。如下所示，我们将使用该文件来定义属性，如服务器将运行的端口、日志记录级别以及一些与上传相关的参数(最大文件大小、最大请求大小和启用的多部分支持)</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">应用程序.属性</p></figure><p id="2a62" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated">所以唯一缺少的任务是运行服务。为了做到这一点，只需到您的终端并从您的项目文件夹运行以下。</p><pre class="kn ko kp kq gt nm kl nn no aw np bi"><span id="8728" class="nq ld it kl b gy nr ns l nt nu">&gt; mvn spring-boot:run</span></pre><h1 id="efd0" class="lc ld it bd le lf lg lh li lj lk ll lm jz ln ka lo kc lp kd lq kf lr kg ls lt bi translated">步骤3:使用Postman测试服务</h1><p id="4868" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">一旦服务启动并运行，我们将使用<a class="ae nj" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>来验证我们的spring boot服务器是否按预期工作。</p><p id="4ada" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated">首先，我们将上传一个文件，如下图所示。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oq"><img src="../Images/8e1c9da74625df8b5e5e82745110a4fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dF9BHaaNVLGmu6y2S4c2mQ.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">上传后-文件端点</p></figure><p id="4838" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated">成功上传文件后，我们将使用下面显示的url调用HTTP GET方法来下载它。如果一切正常，Postman应该会显示文件的内容(如果是txt文件),或者它会通过点击<em class="nv">保存到文件</em>按钮为您提供下载文件的选项。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi or"><img src="../Images/08fec7b431654e308344526472941094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l437l5tvco_6ycPdV0eSXw.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">下载现有文件</p></figure><p id="8010" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated">最后，我们测试当请求的文件不可下载时服务器如何响应。因此，如下所示，用户会收到一个417错误和一条JSON消息，指出请求的文件不存在。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi os"><img src="../Images/173119bb2cec838a71abdcb6a752e6ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uY3vCYba4z759AHhZuOO4Q.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">尝试下载不存在的文件时的响应</p></figure><h1 id="bd80" class="lc ld it bd le lf lg lh li lj lk ll lm jz ln ka lo kc lp kd lq kf lr kg ls lt bi translated">结论</h1><p id="2bb6" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">仅此而已，这篇文章旨在成为关于如何使用科特林和Spring Boot管理文件上传/下载的入门教程。关于这个主题还有很多功能和高级特性(比如数据库文件存储，或者如何处理多个并发上传)。如果你想看这篇文章的第二部分解释任何特定的主题，请留下评论。</p><p id="7cc9" class="pw-post-body-paragraph lu lv it lw b lx ms ju lz ma mt jx mc md ng mf mg mh nh mj mk ml ni mn mo mp im bi translated">如果您有任何意见或建议，或者如果您发现有什么不对的地方，我将非常感谢您的反馈。否则，我希望这篇教程能帮助你开始使用Kotlin和SpringBoot处理文件。</p><h1 id="10ed" class="lc ld it bd le lf lg lh li lj lk ll lm jz ln ka lo kc lp kd lq kf lr kg ls lt bi translated">参考</h1><ul class=""><li id="f865" class="mq mr it lw b lx ly ma mb md ot mh ou ml ov mp mx my mz na bi translated"><a class="ae nj" href="https://maven.apache.org/" rel="noopener ugc nofollow" target="_blank">https://maven.apache.org/</a></li><li id="0b29" class="mq mr it lw b lx nb ma nc md nd mh ne ml nf mp mx my mz na bi translated"><a class="ae nj" href="https://www.w3.org/Protocols/rfc1341/7_2_Multipart.html" rel="noopener ugc nofollow" target="_blank">https://www.w3.org/Protocols/rfc1341/7_2_Multipart.html</a></li><li id="0aa4" class="mq mr it lw b lx nb ma nc md nd mh ne ml nf mp mx my mz na bi translated"><a class="ae nj" href="https://spring.io/guides/tutorials/spring-boot-kotlin/" rel="noopener ugc nofollow" target="_blank">https://spring.io/guides/tutorials/spring-boot-kotlin/</a></li><li id="a22d" class="mq mr it lw b lx nb ma nc md nd mh ne ml nf mp mx my mz na bi translated"><a class="ae nj" href="https://www.jetbrains.com/idea/guide/tutorials/working-with-maven/creating-a-project/" rel="noopener ugc nofollow" target="_blank">https://www . jetbrains . com/idea/guide/tutorials/working-with-maven/creating-a-project/</a></li><li id="c810" class="mq mr it lw b lx nb ma nc md nd mh ne ml nf mp mx my mz na bi translated"><a class="ae nj" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/run-catching.html" rel="noopener ugc nofollow" target="_blank">https://kot linlang . org/API/latest/JVM/stdlib/kot Lin/run-catching . html</a></li><li id="d66f" class="mq mr it lw b lx nb ma nc md nd mh ne ml nf mp mx my mz na bi translated"><a class="ae nj" href="https://www.bezkoder.com/spring-boot-upload-multiple-files/" rel="noopener ugc nofollow" target="_blank">https://www.bezkoder.com/spring-boot-upload-multiple-files/</a></li><li id="00e1" class="mq mr it lw b lx nb ma nc md nd mh ne ml nf mp mx my mz na bi translated"><a class="ae nj" href="https://elizarov.medium.com/kotlin-and-exceptions-8062f589d07" rel="noopener">https://Eliza ROV . medium . com/kot Lin-and-exceptions-8062 f 589d 07</a></li></ul></div></div>    
</body>
</html>