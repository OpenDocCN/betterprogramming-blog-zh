<html>
<head>
<title>How to Create Interactive Candlestick Charts With Real-Time Bitcoin Data in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用JavaScript创建带有实时比特币数据的交互式蜡烛图</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-interactive-candlestick-charts-with-real-time-bitcoin-data-in-javascript-fb20166b4fe0?source=collection_archive---------2-----------------------#2021-08-09">https://betterprogramming.pub/how-to-create-interactive-candlestick-charts-with-real-time-bitcoin-data-in-javascript-fb20166b4fe0?source=collection_archive---------2-----------------------#2021-08-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="43ef" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用币安API传输实时加密货币价格</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2a6149793e082f2339aca7bf63fc7944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s8EgntSlYEbaJ1d9lJTADQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有实时比特币数据的交互式蜡烛图，图片由作者提供。</p></figure><p id="0daf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">随着今年早些时候<a class="ae lu" href="https://www.cnbc.com/2021/01/22/gamestop-soars-nearly-70percent-trading-briefly-halted-amid-epic-short-squeeze.html" rel="noopener ugc nofollow" target="_blank"> GameStop做空</a>和<a class="ae lu" href="https://www.cnbc.com/2021/03/13/bitcoin-surpasses-60000-in-record-high-as-rally-accelerates-.html" rel="noopener ugc nofollow" target="_blank">比特币的价格记录</a>，蜡烛图充斥着新闻，我意识到我不知道如何阅读它们。所以几周前，我终于读完了它们，并了解到它们实际上很容易理解。</p><p id="1a18" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每当我了解一个新主题时，我最喜欢做的事情之一就是为它创建我自己的定制工具。自己编程是深入理解任何主题的最好方法之一。因此，<a class="ae lu" href="https://levelup.gitconnected.com/creating-candlestick-charts-in-javascript-116ea2d6f7dd" rel="noopener ugc nofollow" target="_blank">我创建了一个简单的JavaScript类来在HTML画布上绘制蜡烛图</a>。</p><p id="10cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，我的第一个解决方案只能绘制静态图表，没有交互性，因此无法使用它来显示实时价格数据。为了补救这种情况，我做了更多的工作，添加了缩放和技术指标，并通过<a class="ae lu" href="https://binance-docs.github.io/apidocs/spot/en/#introduction" rel="noopener ugc nofollow" target="_blank">币安API </a>将其连接到实时WebSocket烛台流。</p><h1 id="ae71" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">更新烛台图表类</h1><p id="dc18" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在显示任何实时数据之前，我必须在我的烛台图表类中添加对它的支持。</p><p id="57f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以前，它只支持静态烛台值，没有办法动态更新它们。因此，我添加了一个新的<code class="fe ms mt mu mv b">updateCandlestick( candlestickID , open , close , high, low )</code>函数来更新给定烛台的值。</p><p id="76de" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下一步是实现放大和缩小图表的能力。如果你真的想高效地使用蜡烛图，这是一个非常重要的特性。</p><p id="5a27" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能会放大观察，但当你必须决定是买还是卖一项资产时，你可能会缩小观察价格在更长时期内的发展。幸运的是，通过改变绘制的烛台的起始索引，添加缩放变得非常容易。例如，从索引0开始绘制所有烛台，如果您只想绘制最后100个烛台，则从<code class="fe ms mt mu mv b">candlesticks.length-100</code>开始。</p><p id="7057" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我在烛台图表类中添加了对技术指标的支持。我想以这样一种方式实现它们，一旦我对它们有了更多的了解，我就可以添加更多的。我对结果很满意，虽然我到目前为止只实现了移动平均线，也许还有更复杂的情况，我的系统不能很好地工作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="fcb6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每种技术指标都必须实现一个回调函数的接口，当蜡烛图改变时，这些函数会自动调用。</p><p id="cd1a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，当添加一个新的烛台时，我们需要计算新数据点的移动平均值。因此，烛台图表类为其所有技术指标调用<code class="fe ms mt mu mv b">onAddCandlestick( candlestickChart , candlestickID )</code>,在该函数的MovingAverage实现中，我们可以计算最后n个样本的平均值，并添加一个新的数据点。</p><p id="4d7d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，如果我了解到一个新的技术指标，我想添加到类中，我需要做的就是实现这个接口，它应该是一个即插即用的解决方案。</p><h1 id="781b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">流式实时数据</h1><p id="f3ee" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">随着适当的实时支持添加到我的烛台图表，终于是时候流一些实际的烛台数据。我正在使用<a class="ae lu" href="https://binance-docs.github.io/apidocs/spot/en/#websocket-market-streams" rel="noopener ugc nofollow" target="_blank">币安WebSocket市场流</a>直接从他们的交易所获取实时市场数据。然而，我们还需要在页面加载时获取最近的价格历史，这样我们就不会从零开始。</p><p id="4c1a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">幸运的是，我们也可以为此使用币安API。API为您正在寻找的任何类型的数据提供了市场数据端点。在我们的例子中，我们感兴趣的是<a class="ae lu" href="https://binance-docs.github.io/apidocs/spot/en/#kline-candlestick-data" rel="noopener ugc nofollow" target="_blank">烛台/克莱恩端点</a>。</p><p id="c521" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们在这里使用的两个API都是公共的，这意味着您不需要API密钥来使用它们(尽管每个IP都有限制)。顺便提一下，我是币安API的忠实粉丝。它被很好地记录和完成。看起来仅仅通过API就可以控制你的整个账户，我希望更多的公司关注他们的API。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="221e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们看看CandlestickStream类。相关功能有start()和<code class="fe ms mt mu mv b">onMessage()</code>。当我们开始这个流时，我们首先调用静态烛台API来为我们的符号和间隔获取最近的500个烛台。当我们得到它们时，我们用这些值初始化烛台图表，并启动WebSocket连接。</p><p id="22f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们将每2秒钟收到一条实时消息，更新我们的烛台。在onMessage()回调函数中，我们查看收到的烛台的时间戳值。如果图表中最后一根蜡烛线有相同的时间戳，我们就更新它。如果没有，这意味着一个新的烛台已经开始，所以我们也添加一个新的烛台到我们的图表。现在我们有一个完全工作的实时比特币烛台流，你可以坐下来，满怀希望地看着你的投资飞向月球。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/5dd6858701d875db087c638d6ec6b286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*LiwwUnNvi54Kw3UMAmf8WA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">放大和缩小实时蜡烛图，图片由作者提供。</p></figure><h1 id="112b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用</h1><p id="5105" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">使用<code class="fe ms mt mu mv b">CandlestickStream</code>类非常简单。我们需要做的就是创建一个类的新实例，告诉它我们想要哪个符号和区间，然后开始流:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="b852" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">例子</h1><p id="66d4" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">我在我的网站上添加了一个例子，用5分钟的烛台显示比特币的欧元价格:<a class="ae lu" href="https://pingpoli.de/bitcoin-chart/" rel="noopener ugc nofollow" target="_blank">实时比特币烛台</a>。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="e6ee" class="lv lw it bd lx ly ng ma mb mc nh me mf jz ni ka mh kc nj kd mj kf nk kg ml mm bi translated">结论</h1><p id="63cc" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">我非常喜欢创建自己的自定义数据可视化，而不仅仅是使用第三方解决方案。</p><p id="c62a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于我最近回到了加密领域，我想实现一个烛台图表类，并将其连接到实时市场流。</p><p id="7e1c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这样，我可以完全控制可视化，并根据自己的喜好进行定制。如果您是一名程序员，并且对加密货币感兴趣，我强烈建议您也创建自己的定制解决方案。从你自己的程序里看着价格上涨，是双倍的满足感。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="f1ab" class="lv lw it bd lx ly ng ma mb mc nh me mf jz ni ka mh kc nj kd mj kf nk kg ml mm bi translated">资源</h1><ul class=""><li id="806a" class="nl nm it la b lb mn le mo lh nn ll no lp np lt nq nr ns nt bi translated"><a class="ae lu" href="https://gist.github.com/pingpoli/bff235522221a9e865af9ee311ec11fb" rel="noopener ugc nofollow" target="_blank">pingpolicandlestickchart . js</a></li><li id="5b86" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nq nr ns nt bi translated"><a class="ae lu" href="https://gist.github.com/pingpoli/8c57e539e61b950aca8d4f58ec187154" rel="noopener ugc nofollow" target="_blank"> CandlestickStream.js </a></li><li id="52f3" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nq nr ns nt bi translated"><a class="ae lu" href="https://gist.github.com/pingpoli/b39bbb8481832bf4c0522dd8d57dd839" rel="noopener ugc nofollow" target="_blank"> pingpoliWebSocket.js </a>(我的WebSocket包装器)</li><li id="9c3a" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nq nr ns nt bi translated"><a class="ae lu" href="https://binance-docs.github.io/apidocs/spot/en/#introduction" rel="noopener ugc nofollow" target="_blank">币安API </a></li></ul></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><p id="219c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你喜欢这样的内容吗？<a class="ae lu" href="https://pingpoli.medium.com/membership" rel="noopener">加入Medium </a>可以无限制访问所有故事，支持我和其他作者。如果你通过此链接注册，你的一部分会员费将归我所有。</p></div></div>    
</body>
</html>