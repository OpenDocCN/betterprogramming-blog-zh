<html>
<head>
<title>How I Built My Own Insomnia Plugin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何构建自己的失眠插件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-i-built-my-own-insomnia-plugin-56ebb9dba5f?source=collection_archive---------13-----------------------#2022-06-09">https://betterprogramming.pub/how-i-built-my-own-insomnia-plugin-56ebb9dba5f?source=collection_archive---------13-----------------------#2022-06-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="33ac" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">只需几行代码！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c6993432a777252f876ca69a5c08ea4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wzP8X2M2AgXzAuSs"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我的失眠插件(请求-桌面-通知)</p></figure><p id="f1e9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae lu" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">失眠症</a>是一个开源的API客户端，帮助你测试和调试GraphQL、gRPC和REST API端点。尽管失眠很强大，但有时你想进一步扩展它的功能，你可以用<a class="ae lu" href="https://docs.insomnia.rest/insomnia/introduction-to-plugins" rel="noopener ugc nofollow" target="_blank">插件</a>来实现。</p><p id="1430" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<a class="ae lu" href="https://insomnia.rest/plugins" rel="noopener ugc nofollow" target="_blank">失眠插件中心</a>上有许多很棒的插件，都是由开源社区贡献的。更令人兴奋的是，如果你想投稿，你可以建立自己的插件！</p><p id="349f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇文章中，我们将探索我构建的一个插件，然后向你展示如何构建你自己的失眠插件。</p><h1 id="2d54" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">插件演示</h1><p id="49af" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">我的插件是一个简单的添加，允许你启动一个文件夹中的所有请求，然后在所有请求完成后显示一个桌面通知。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/0a5d3033d6038b633e6a9724b95ad9ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/0*JorzLprjgQcnPryz"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上下文菜单项允许你在失眠应用程序中“发送所有请求”</p></figure><p id="b3a3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你像我一样是一个习惯性的多任务处理者，你可能会在工作的时候同时快速切换几个应用程序。你的IDE，你的终端，你的浏览器，失眠可能是少数。</p><p id="70e8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您的文件夹中有大量请求，并且不想等待它们全部完成，您可以在等待的同时转移到其他地方，然后在作业完成时得到通知。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/4ee1673cbb7baebbf33b8d831f9aebf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-QUTNGN6QkWddSVz"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">发送完所有请求后，会出现桌面通知</p></figure><p id="8d14" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以<a class="ae lu" href="https://www.npmjs.com/package/insomnia-plugin-requests-desktop-notification" rel="noopener ugc nofollow" target="_blank">在npm上找到我的插件包</a>或者<a class="ae lu" href="https://github.com/thawkin3/insomnia-plugin-requests-desktop-notification" rel="noopener ugc nofollow" target="_blank">在这里查看GitHub repo</a>。</p><h1 id="c088" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">插件安装</h1><p id="9ca2" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">可以通过你的失眠桌面app中的设置页面安装失眠插件。只需点击应用右上角的齿轮图标，然后选择“插件”标签。在文本输入中搜索任何插件名称，然后单击“安装插件”按钮将插件添加到您的应用程序中。</p><p id="7f36" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以我的插件为例，名字是<code class="fe mu mv mw mx b">insomnia-plugin-requests-desktop-notification</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c6993432a777252f876ca69a5c08ea4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wzP8X2M2AgXzAuSs"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安装请求-桌面-通知插件</p></figure><h1 id="5794" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">插件使用</h1><p id="8f44" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">一旦你安装了插件，你就可以开始使用它了——不需要重启你的失眠应用。插件有几种变体。有些为各种钩子添加了行为，比如<a class="ae lu" href="https://docs.insomnia.rest/insomnia/hooks-and-actions" rel="noopener ugc nofollow" target="_blank">请求钩子或者响应钩子</a>。其他<a class="ae lu" href="https://docs.insomnia.rest/insomnia/hooks-and-actions#folder-actions" rel="noopener ugc nofollow" target="_blank">向应用程序中的下拉菜单</a>添加新项目。你甚至可以通过插件安装一个<a class="ae lu" href="https://docs.insomnia.rest/insomnia/custom-themes" rel="noopener ugc nofollow" target="_blank">自定义主题</a>。</p><p id="4fbb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我的插件在请求文件夹的下拉菜单中增加了一个新项目。要查看它的运行，你可以导航到你的失眠应用程序的“调试”区域。然后，创建一个新文件夹，并向其中添加一些请求(或者使用一个现有的文件夹，如果您已经有一个的话)。</p><p id="624c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，单击文件夹名称右侧的下拉触发器按钮，打开下拉菜单。在默认菜单项中，你还会看到我的插件添加的自定义菜单项:“发送所有请求。”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/14a81a2564931fa372ceeadbed15f8e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/0*2picN2e-5Z9KuGIi"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上下文菜单项允许你在失眠应用程序中“发送所有请求”</p></figure><p id="ed84" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">选择该菜单项以发送您文件夹中的所有请求。一旦所有的请求都完成了，一个桌面通知将会出现在你的机器上。哒哒！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/88703949a237197c5fca515afc92e7d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XxWXtc5hsd87Gr1a"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">发送完所有请求后，会出现桌面通知</p></figure><h1 id="138c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">如何建立一个失眠插件</h1><p id="be93" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">那么，我是如何建造这个的呢？嗯，其实挺简单的！该插件是一个小的JavaScript应用程序，由一个<code class="fe mu mv mw mx b">main.js</code>文件和一个<code class="fe mu mv mw mx b">package.json</code>文件组成。对于桌面通知功能，我使用了<code class="fe mu mv mw mx b"><a class="ae lu" href="https://www.npmjs.com/package/node-notifier" rel="noopener ugc nofollow" target="_blank">node-notifier</a></code> npm包。</p><p id="2365" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当<a class="ae lu" href="https://docs.insomnia.rest/insomnia/introduction-to-plugins#create-a-plugin" rel="noopener ugc nofollow" target="_blank">创建一个新的失眠症插件</a>时，你可以通过导航到失眠症应用程序的设置屏幕，点击“插件”标签，然后点击“生成新插件”按钮来引导你的插件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6849250cd1a5367b96acb001370dfb9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5P9Q3BzJZ_iVrzEm"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用“生成新插件”按钮来引导你的插件</p></figure><p id="8727" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将为你的插件创建一个新的目录，并把它放在一个文件夹中，在这个文件夹中，失眠保存了它所有的插件。它还会自动为您创建<code class="fe mu mv mw mx b">main.js</code>和<code class="fe mu mv mw mx b">package.json</code>文件。</p><p id="dbda" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从那里，我在我的<code class="fe mu mv mw mx b">main.js</code>文件中编写了下面的代码。看它有多短！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="a0bf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们一起来看一下这段代码。首先，它需要我们所依赖的两个依赖关系:<code class="fe mu mv mw mx b">path</code>和<code class="fe mu mv mw mx b">node-notifier</code>。<code class="fe mu mv mw mx b">path</code>是一个内置模块，但是我需要在我的终端上运行<code class="fe mu mv mw mx b">yarn add node-notifier</code>来安装<code class="fe mu mv mw mx b">node-notifier</code>。</p><ul class=""><li id="8aaf" class="na nb it la b lb lc le lf lh nc ll nd lp ne lt nf ng nh ni bi translated">代码的主要部分向<code class="fe mu mv mw mx b">requestGroupActions</code>数组添加了一个新条目。这就是在我们的请求文件夹的下拉菜单中创建新菜单项的原因。</li><li id="5ee9" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt nf ng nh ni bi translated"><code class="fe mu mv mw mx b">label</code>是菜单项的文本。</li><li id="4eef" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt nf ng nh ni bi translated"><code class="fe mu mv mw mx b">action</code>是当有人选择菜单项时我们想要运行的代码。</li></ul><p id="e6ca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe mu mv mw mx b">action</code>功能中，我们执行以下操作:</p><ol class=""><li id="55d1" class="na nb it la b lb lc le lf lh nc ll nd lp ne lt no ng nh ni bi translated">收集文件夹中的所有请求。</li><li id="4cc1" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt no ng nh ni bi translated">送他们。</li><li id="20ab" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt no ng nh ni bi translated">完成所有请求后，调用<code class="fe mu mv mw mx b">notifier.notify</code>。<code class="fe mu mv mw mx b">title</code>、<code class="fe mu mv mw mx b">message</code>、<code class="fe mu mv mw mx b">icon</code>和<code class="fe mu mv mw mx b">sound</code>属性都配置了我们的桌面通知。</li></ol><p id="4d59" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！这个插件真的就这么简单。</p><p id="fc96" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦我写了这段代码，我就可以导航到我的失眠应用程序的设置页面，然后是“插件”标签，然后点击“重新加载插件”按钮来重新加载最新的更改。之后，菜单项出现在我的请求文件夹的下拉菜单中。</p><h1 id="bb3f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">发布到国家预防机制</h1><p id="2483" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">写完我的插件后，我在本地一切都很好。但是我也想与更广泛的社区分享这个插件。为了做到这一点，我需要将它发布到npm。为此，我将最新的代码推送到我的GitHub repo，用<code class="fe mu mv mw mx b">npm login</code>登录我的npm帐户，然后用<code class="fe mu mv mw mx b">npm publish</code>发布我的包。</p><p id="97e5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">发布包的初始版本后，我可以对代码进行一些更新，用<code class="fe mu mv mw mx b">npm version &lt;major|minor|patch&gt;</code>生成新的包版本，用<code class="fe mu mv mw mx b">git push --tags</code>将标签推送到GitHub，用<code class="fe mu mv mw mx b">git push</code>将代码推送到GitHub，然后用<code class="fe mu mv mw mx b">npm publish</code>将新的包版本发布到npm。</p><p id="9fe2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦我的包在npm注册中心发布，它会在接下来的24小时内自动添加到失眠插件中心。</p><h1 id="857e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="7a8e" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">现在你知道了——我是如何构建自己的失眠插件的，你也可以。</p><p id="1aa0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">总而言之，失眠对于构建、测试和调试API非常有用。插件让你扩展失眠的功能。</p><p id="f749" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">构建自己的定制插件很容易。您只需几行代码就可以添加新功能！</p></div></div>    
</body>
</html>