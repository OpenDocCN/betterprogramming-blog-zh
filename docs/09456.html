<html>
<head>
<title>Automating Transactional Emails Using SendGrid API and AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SendGrid API和AWS Lambda自动化事务性电子邮件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/automating-transactional-emails-using-sendgrid-api-and-aws-lambda-58aaf781e09f?source=collection_archive---------0-----------------------#2021-08-27">https://betterprogramming.pub/automating-transactional-emails-using-sendgrid-api-and-aws-lambda-58aaf781e09f?source=collection_archive---------0-----------------------#2021-08-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9f78" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">争取回更多的时间</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0c8182ae61eb249e506c8d2738b808e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PVadwJk8-MiUhUH9VVu6sA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><p id="3820" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最近，我被要求使用SendGrid API自动处理事务性电子邮件，因为我们有一个无服务器后端，所以我选择创建一个AWS Lambda，负责拍摄内部使用SendGrid API的确认电子邮件。我决定这样做。这是最简单的一篇文章，如果你打算自动发送电子邮件来生成收据等。</p><h1 id="1c21" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">访问发送网格仪表板</h1><p id="cd0d" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">一旦您使用SendGrid API凭证登录并访问<a class="ae mr" href="https://app.sendgrid.com/" rel="noopener ugc nofollow" target="_blank">仪表板</a>，您需要访问电子邮件API选项卡<strong class="la iu"> </strong>，在该选项卡下您需要单击“动态模板”。动态模板是可以用来拖放或使用HTML和手柄实际编码来创建电子邮件UI部分的模板。是一个简单的模板语言，你可以结合HTML模板来填充动态数据。继续选择任何适合你需求的模板，收集<code class="fe ms mt mu mv b">template_id</code>供你参考，以便在我们的Lambda代码中使用这个id。</p><h1 id="02eb" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">创建消息对象</h1><p id="8a2f" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">消息对象是SendGrid API在您调用它时所期望的输入对象。让我们从创建一个非常基本的<code class="fe ms mt mu mv b">msg</code>对象开始，比如:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="c999" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ms mt mu mv b">to</code>:有两个密钥——电子邮件和姓名。email保存收件人的电子邮件id，name保存收件人的姓名。</p><p id="2e53" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ms mt mu mv b">from</code>:有两把钥匙——邮箱和名字。email保存发件人的电子邮件id，name保存发件人的姓名。</p><p id="eb07" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ms mt mu mv b">bcc</code>:邮件对象数组。所有你想包含在密件抄送中的电子邮件id都可以放在这里。</p><p id="1929" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ms mt mu mv b">templateId</code>:您为SendGrid仪表板上的UI部件最终确定的模板的模板id。</p><p id="4ce2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ms mt mu mv b">dynamic_template_data</code>:假设我正在构建一个预订确认模板，其中我想要几个变量作为我的动态数据值。例如像入住、退房、姓名、预订确认等值。将会是动态的。为了处理这样的动态数据点，我们将在HTML模板中使用handlebars。要创建一个变量，你需要在HTML模板中使用三个花括号语法。</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="d003" class="nc lv it mv b gy nd ne l nf ng">&lt;p&gt;<br/>Here is your confirmation number : {{{confirmation_number}}}<br/>&lt;/p&gt;</span><span id="2369" class="nc lv it mv b gy nh ne l nf ng">&lt;p&gt;<br/>Your check in date is : {{{check_in}}}<br/>&lt;/p&gt;</span></pre><p id="e796" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了提供confirmation_number和其他变量，您需要创建一个JSON对象，其中包含模板中需要的所有变量值。你可以在这里探索更多关于车把<a class="ae mr" href="https://docs.sendgrid.com/ui/sending-email/adding-dynamic-content-with-handlebars-in-marketing-campaigns" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="5f3c" class="nc lv it mv b gy nd ne l nf ng">{<br/>   "confirmation_number": "123",<br/>   "check_in": "2021-10-01"<br/>}</span></pre><p id="fedb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后这个JSON就被输入到<code class="fe ms mt mu mv b">dynamic_template_data</code>中。</p><h1 id="459b" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">点击SendGrid API</h1><p id="bd06" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">SendGrid API提供了许多可以用于不同用例的方法。为了发送电子邮件，我们将使用一个简单的语法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="cdfc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里，<code class="fe ms mt mu mv b">callback()</code>指的是AWS Lambda调用的回调，返回响应。</p><h1 id="9978" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">将代码包装在Lambda函数中</h1><p id="aac2" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我是这样将代码包装在Lambda函数中的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="d881" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一个示例事件对象JSON看起来像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="0da2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以使用无服务器-离线来模拟运行这个lambda函数。如果事件对象配置正确，您应该会得到一个状态代码200，并且您应该会在提到的地址收到一封电子邮件。</p><p id="2228" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你计划使用一个无服务器的框架，这就是你的<code class="fe ms mt mu mv b">serverless.yaml</code>文件的样子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="274e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，当发送电子邮件时，您可以选择使用异步方式调用lambda，因为这个操作可以异步处理。</p><h1 id="4025" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">结论</h1><p id="8c24" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">使用上述方法，您可以创建任何类型的交易电子邮件，并使用手柄保持您的数据动态。通过访问<a class="ae mr" href="https://sendgrid.com/solutions/email-api/dynamic-email-templates/" rel="noopener ugc nofollow" target="_blank"> SendGrid的模板</a>，探索你想要的用户界面。</p><p id="0335" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对我来说，让它与更复杂的动态数据变量一起工作是一个相当漫长的旅程。</p><p id="337c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读。订阅我的<a class="ae mr" href="https://parulmalhotra.substack.com/?r=2cisn&amp;utm_campaign=pub&amp;utm_medium=web&amp;utm_source=copy" rel="noopener ugc nofollow" target="_blank">时事通讯</a>获取更多关于我所学和所做的事情的更新。</p></div></div>    
</body>
</html>