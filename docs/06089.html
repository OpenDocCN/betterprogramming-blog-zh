<html>
<head>
<title>Format Your Kotlin Code With Ktlint</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Ktlint格式化Kotlin代码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/format-your-kotlin-code-with-ktlint-6fd1321504d0?source=collection_archive---------13-----------------------#2020-09-01">https://betterprogramming.pub/format-your-kotlin-code-with-ktlint-6fd1321504d0?source=collection_archive---------13-----------------------#2020-09-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0266" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将关于代码风格的讨论自动化，关注真正重要的事情:将产品交付给用户</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/801cb8251bfaf89cce4f2611974671e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dtmiSMIe0Cbnsi83Yeqq5A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Mahmudul Hasan Shaon 在<a class="ae ky" href="https://unsplash.com/s/photos/text-style?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ecce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当审查合并请求时，我总是发现很难提出代码风格的问题。</p><p id="d560" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码风格是主观的。我对干净代码的样子有自己的看法，这个看法可能与我团队中其他人的看法大相径庭。</p><p id="580c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码风格也有不同的层次。一方面，我们有直接影响代码可维护性的最佳实践:</p><ul class=""><li id="a728" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">小方法</li><li id="e428" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">描述性方法名称</li></ul><p id="a52e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，我们遇到的问题不一定会使代码更难维护，但通常会使代码库更一致、更易读:</p><ul class=""><li id="1af6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">一致缩进</li><li id="9f05" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">换行</li><li id="e8d3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">避免代码墙</li></ul><p id="bc65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我发现对第一组中不遵循最佳实践的代码进行评论很容易，但我发现由于第二组中的问题，将合并请求发送回作者会更难。</p><p id="182d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果代码可以工作并且测试通过，那么因为作者使用了制表符而不是空格而推迟这个特性值得吗？ </p><p id="dfa3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是自动化的用武之地。虽然不可能自动化所有事情，但是有一些工具可以自动检测代码风格违规，并在编码过程或构建管道中标记它们。</p><p id="2d52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一些工具甚至可以自动修复一些代码风格违规。</p><p id="cd15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我看来，实现这种检查的第一步是将团队聚集在一起，并就一组代码风格的规则达成一致——这些规则可能局限于特定语言的最佳实践，或者还包括您的项目的特定规则。一旦确定了规则，将该工具集成到您的开发/构建过程中，以标记违反这些规则的代码。通过这种方式，开发人员可以在早期获得关于违反样式规则的代码的反馈，甚至可以在提交代码供审查之前修复它们。</p><p id="2647" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不同的语言有不同的工具来实现这个目的。当我在做一个Kotlin项目时，我使用Ktlint。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="fd4c" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">什么是Ktlint？</h1><p id="4da4" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">Ktlint 是一个工具，它根据一组代码风格规则扫描您的代码库，以找到违规之处。它自称为:</p><blockquote class="no np nq"><p id="c888" class="kz la mj lb b lc ld ju le lf lg jx lh nr lj lk ll ns ln lo lp nt lr ls lt lu im bi translated">内置格式化器的防自行车脱落Kotlin棉绒</p></blockquote><p id="3768" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">术语“骑车族”指的是当一个团队面临一个大的或复杂的决策时，他们会在琐碎和不重要的决策上花费太多时间。<a class="ae ky" href="https://en.wiktionary.org/wiki/bikeshedding" rel="noopener ugc nofollow" target="_blank">在最初的比喻中</a>它指的是一个负责批准核电站计划的委员会，结果却把大部分时间花在不重要的决定上，比如员工自行车棚的材料。</p><p id="67c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Ktlint试图通过为你做一些不重要的决定——关于遵循什么样的风格规则——来避免掉自行车。</p><p id="e9fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它附带了一套基于官方Kotlin风格指南的风格规则。但这并不意味着你不能配置它。您可以随意禁用一些规则或创建新规则，但在大多数情况下，标准规则就足够了。</p><p id="23ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用它来检查您的代码是否符合所有规则，或者作为格式化程序来自动修复不符合规则的代码。格式化程序无法修复某些问题，但是根据我的经验，它可以正确地修复最常见的问题。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="3ce7" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">整合Ktlint和Gradle</h1><p id="de21" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我喜欢Ktlint的一点是它能够使用maven或gradle将其集成到您的构建管道中。您可以在<a class="ae ky" href="https://github.com/pinterest/ktlint#installation" rel="noopener ugc nofollow" target="_blank"> Ktlint自述文件</a>中找到安装说明。就我个人而言，我使用它与gradle和我更喜欢设置它没有插件。</p><p id="2634" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装非常简单——下面显示的<code class="fe nu nv nw nx b">build.gradle</code>文件包含了设置它的所有部分。两个主要步骤是1。将Ktlint添加为依赖项，并将2。添加新的gradle任务来针对您的代码库运行Ktlint。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="d829" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还将检查任务链接到依赖于<code class="fe nu nv nw nx b">ktlint</code>任务。这意味着如果您的代码没有遵循您为项目配置的样式指南，那么<code class="fe nu nv nw nx b">gradle check</code>命令将运行代码样式的验证并失败。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="fe19" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">运行Ktlint</h1><p id="3d1f" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">既然已经设置了gradle文件，运行Ktlint就很简单了。您可以运行<code class="fe nu nv nw nx b">gradle check</code>来运行所有检查，或者运行我们刚刚创建的定制任务之一:</p><pre class="kj kk kl km gt oa nx ob oc aw od bi"><span id="dc0b" class="oe ms it nx b gy of og l oh oi">// To check your code follows style rules<br/>gradle ktlint</span><span id="ef48" class="oe ms it nx b gy oj og l oh oi">// To attempt to fix code that does not follow style rules<br/>gradle ktlintFormat</span></pre><p id="b151" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以将这些任务作为CI/CD管道的一部分运行，并要求它们在合并新功能之前通过。通过这种方式，您可以确保您的代码始终符合您的团队同意的风格指南。</p><p id="617d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以看看我的<a class="ae ky" href="https://gitlab.com/hectorjsmith/kotlin-template" rel="noopener ugc nofollow" target="_blank"> Kotlin项目模板</a>，看看我是如何为我的Kotlin项目设置Ktlint和Gitlab CI/CD的。</p><p id="ecc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。您可以通过下面的链接来了解更多关于Ktlint以及我是如何使用它的。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="3d33" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">资源</h1><ul class=""><li id="cdee" class="lv lw it lb b lc nj lf nk li ok lm ol lq om lu ma mb mc md bi translated">Ktlint 主页 — <a class="ae ky" href="https://ktlint.github.io/" rel="noopener ugc nofollow" target="_blank"> https://ktlint.github.io/ </a></li><li id="a9f0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">Ktlint GitHub repository — <a class="ae ky" href="https://github.com/pinterest/ktlint" rel="noopener ugc nofollow" target="_blank"> https://github.com/pinterest/ktlint </a></li><li id="1a32" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">Ktlint Installation Instructions — <a class="ae ky" href="https://github.com/pinterest/ktlint#installation" rel="noopener ugc nofollow" target="_blank">https://github.com/pinterest/ktlint#installation </a></li><li id="8028" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">My Kotlin Template Project — <a class="ae ky" href="https://gitlab.com/hectorjsmith/kotlin-template" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/hectorjsmith/kotlin-template </a></li></ul></div></div>    
</body>
</html>