<html>
<head>
<title>Airbnb’s Airflow Versus Spotify’s Luigi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Airbnb的Airflow对Spotify的Luigi</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/airbnbs-airflow-versus-spotify-s-luigi-bd4c7c2c0791?source=collection_archive---------0-----------------------#2019-11-14">https://betterprogramming.pub/airbnbs-airflow-versus-spotify-s-luigi-bd4c7c2c0791?source=collection_archive---------0-----------------------#2019-11-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c3c7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从A点到B点获取数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e8139e9ab51aaa07c1c6233eabb88351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZIhydO1xhGJMZrQ--niH1A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@realaxer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">田宽</a>在<a class="ae ky" href="https://unsplash.com/s/photos/pipes?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4a30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们最近写了关于<a class="ae ky" href="https://medium.com/better-programming/what-are-etls-and-why-are-important-b65b301607d1" rel="noopener">ETL以及为什么它们很重要</a>。我们想提供一个什么是ETL工具的概要。您可以将这些ETL工具称为工作流工具，帮助管理从A点到b点的数据移动。</p><p id="0adf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中两个流行的工作流工具是Spotify的Luigi和Airbnb的Airflow。这两个工作流引擎都是为了帮助设计和执行用于数据分析的计算量大的工作流而开发的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a123" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">什么是DAG？</strong></h1><p id="524f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在，在将Airflow与Luigi进行比较之前，我们必须理解两个库共有的一个重要概念。本质上，两者都构建了所谓的有向无环图(DAG)。DAG是以特定顺序运行的任务的集合，这些任务依赖于之前的任务。</p><p id="00f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果我们有三个名为<code class="fe mz na nb nc b">Foo</code>、<code class="fe mz na nb nc b">Bar</code>和<code class="fe mz na nb nc b">FooBar</code>的任务，可能会出现这样的情况:<code class="fe mz na nb nc b">Foo</code>先运行，<code class="fe mz na nb nc b">Bar</code>和<code class="fe mz na nb nc b">FooBar</code>依赖于<code class="fe mz na nb nc b">Foo</code>完成。</p><p id="0473" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建一个如下图所示的基本图形。如你所见，有一条清晰的路径。现在想象一下，有成百上千的任务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/2b3938eec1b0485675b391aebc2ef608.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MFBG90U4-aYysYIax618dA.png"/></div></div></figure><p id="e0ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大型数据组织拥有大量依赖于依赖项的Dag。拥有对DAG的明确访问权限使公司能够跟踪哪里出错，并且不允许坏数据进入他们的数据生态系统，因为如果出现故障，它通常会迫使下游的任务等待，直到它们的依赖关系完成。</p><p id="f9ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是像Airflow和Luigi这样的工具派上用场的地方。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ef2e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是路易吉？</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/24988dea144c7f3457aab905d134692b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZXJ1TMnbD4NvAGXe2of3Q.png"/></div></div></figure><p id="eedd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Luigi是一个执行框架，允许你用Python写数据管道。</p><p id="f71e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该工作流引擎支持任务依赖性，并包括一个中央调度程序，该程序为帮助者提供了一个详细的库，以在MySQL、AWS和Hadoop中构建数据管道。不仅很容易依赖于repos中定义的任务，代码重用也很方便；您可以轻松地派生执行路径，并将一个任务的输出用作第二个任务的输入。</p><p id="b3e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个框架由Spotify编写，并于2012年开源。许多受欢迎的公司，如Stripe、Foursquare和Asana，都使用Luigi工作流引擎。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="34a3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是气流？</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/164563d1300e3ea46373e949d81163b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XktBI6ftst25eVw8F6bSqg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/astronomer/airflow-guides/blob/master/guides/airflow-ui.md" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="47f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个工作流调度器支持Python中的任务定义和依赖关系。</p><p id="8571" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它是由Airbnb在2014年编写的，用于在许多工作节点上执行、调度和分配任务。Airflow于2016年开源，不仅支持日历调度，还配备了一个漂亮的网络仪表盘，允许用户查看当前和过去的任务状态。</p><p id="cef7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该工作流引擎支持关系数据库，旨在存储和保持其状态。由于它的web仪表板可视化特性，Airflow也可以用作传统ETL的起点。</p><p id="b2d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其母公司Airbnb的气流推动的一些流程包括:数据仓库、实验、增长分析和电子邮件定位。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a875" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">两种开源工作流引擎的比较</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/3f05d1f4294a183f4f850a5e5077c4e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hURwKOAd15U2xEkZeXVrfQ.png"/></div></div></figure><p id="8b63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个WMS都很棒。但各有利弊。本节将向您简要比较气流和Luigi。</p><h2 id="3a37" class="nh md it bd me ni nj dn mi nk nl dp mm li nm nn mo lm no np mq lq nq nr ms ns bi translated">路易吉和气流的共性</h2><p id="dcd6" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在讨论这两种工具的优缺点之前，我们先来讨论一下它们的共同点:</p><p id="bb10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">●可视化工具</p><p id="bf10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">●任务代表一个工作单元</p><p id="9426" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">●数据结构标准</p><p id="e40d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">●有向图的一个节点</p><p id="8a8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">●指定同步/异步任务、条件路径和并行命令的选项</p><p id="a8a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，这两个工作流引擎都是用Python编写的。这使得在大多数公司中实现这些库变得非常容易，因为Python相当普遍。</p><h2 id="5da1" class="nh md it bd me ni nj dn mi nk nl dp mm li nm nn mo lm no np mq lq nq nr ms ns bi translated">路易吉的利与弊</h2><p id="de61" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><strong class="lb iu">优点:</strong></p><p id="1d43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">● <strong class="lb iu">自定义日历调度:</strong>虽然大多数ETL系统都有要求每小时运行一次的任务，但是Luigi并没有日历调度的概念。因此，用户可以根据自己的方便来运行任务。中央调度器包含一个任务历史特性，它还将任务完成情况记录到一个关系数据库中，而关系数据库又将任务完成情况显示在主仪表板上。</p><p id="3565" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">● <strong class="lb iu">令人印象深刻的股票库:</strong>Luigi最好的部分之一是它的股票任务和目标数据系统库——基于SQL和基于NOSQL。每个库都包含了许多作为助手方法内置的功能。这些助手类支持Hadoop、Hive查询、缩放、红移、PostgreSQL、Google BigQuery等等。</p><p id="70ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">● <strong class="lb iu">目标文件和数据集:</strong> Luigi将文件和数据集直接作为任务的输入或输出，这使得恢复ETL系统的历史状态变得更加容易——即使状态数据库丢失。</p><p id="87a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">缺点:</strong></p><p id="f655" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">● <strong class="lb iu">任务创建和测试:</strong>在创建和测试任务时，Luigi API相当困难。在创建过程中，任务状态与任务实际要产生的数据紧密相关。因此，工程师倾向于简单地将任务推向生产阶段，因为这是非常反直觉的。</p><p id="0f33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">● <strong class="lb iu">不太具有可伸缩性:</strong>由于Luigi和crons是紧密耦合的，Luigi中的工作进程数量受到分配给该作业的cron工作进程数量的限制。更糟糕的是，工人只能运行上传到中央调度程序的任务。因此，如果您希望在大规模管道中并行化任务，您必须将它们分成不同的子管道。</p><p id="ea9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">● <strong class="lb iu">难以使用:</strong>如果你需要查看任务日志并失败，没有简单的方法。每一次，您都必须查看cron worker的日志，然后找到任务日志——这本身是非常消耗任务的。此外，任务的DAG不能在执行前查看。因此，您不知道在部署期间关联任务时运行的是什么代码。</p><h2 id="380d" class="nh md it bd me ni nj dn mi nk nl dp mm li nm nn mo lm no np mq lq nq nr ms ns bi translated">气流的利与弊</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/1c9d42f20b44ea7e0960f44d026b816f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k_TvmQO4wIaP1GfRN0ig9Q.png"/></div></div></figure><p id="3466" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">优点:</strong></p><ol class=""><li id="59b0" class="nu nv it lb b lc ld lf lg li nw lm nx lq ny lu nz oa ob oc bi translated"><strong class="lb iu">易于使用的用户界面:</strong>借助Airflow，您可以轻松查看任务日志、层次结构、状态和代码运行。该用户界面还允许您轻松地更改任务状态、重新运行历史任务以及强制任务运行。</li><li id="13ec" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated"><strong class="lb iu">独立调度器:</strong> Airflow自带调度器，可以让你把任务从crons中分离出来，轻松独立伸缩。此外，Airflow同时支持多个Dag。这些Dag处理两类任务:传感器和操作员。</li><li id="7bdb" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated"><strong class="lb iu">活跃的开源社区:</strong>凭借其强大的社区，Airflow积极地获得了诸如寻呼任务、Slack集成和SLA等特性。聊天室本身非常活跃，所以新手可以在几个小时内得到他们的问题的答案。</li></ol><p id="5180" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">缺点:</strong></p><ol class=""><li id="7d53" class="nu nv it lb b lc ld lf lg li nw lm nx lq ny lu nz oa ob oc bi translated"><strong class="lb iu">任务优化:</strong>对于任何一个中型公司来说，流水线中有多个任务，Airflow有时不清楚如何将这些任务组织到海量的流水线中。</li><li id="bead" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated"><strong class="lb iu">不直接处理任务:</strong>除了特殊的传感器操作员，气流不直接处理作为任务输入的数据集或文件。在Airflow中，状态数据库只存储任务的状态，并记录数据集，因此如果数据库丢失，就很难恢复ETL的历史状态。此外，这使得处理正确出现但不产生和输出的任务变得更加困难。</li><li id="9a26" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated"><strong class="lb iu">灵活性较低:</strong>借助气流，员工无法独立开始任务或灵活选择任务——根据自定义计划。由于任务只能由中央调度程序选取，因此Airflow使用中央调度程序启动工人。</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="26af" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">哪个工作流引擎比较好？</h1><p id="151c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果你问我，我会推荐Luigi上空的气流。为什么？不仅用气流测试管道更容易，而且有独立的任务状态。</p><p id="b73a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">说到调度，Luigi在cron作业中运行任务，而Airflow有自己的LocalScheduler，允许用户独立扩展任务。此外，Airflow支持多个DAG，而Luigi不允许用户在管道执行之前查看DAG的任务。</p><p id="9326" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个重点是用户界面。虽然Luigi提供了一个最小的UI，但Airflow附带了一个详细的、易于使用的界面，允许您简单地查看和运行任务命令。</p><p id="cf12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，Airflow的细节——社区贡献——包括服务级别协议、触发规则、图表和XComs，而Luigi没有这些。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="69e6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最后的话</h1><p id="8f1c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">由于它们的核心设计和功能，这两个开源工作流系统都得到了广泛的欢迎。</p><p id="af14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在社区方面，Airflow赢得了比赛，但如果您计划使用Hadoop或Google BigQuery，请看看Luigi。</p><p id="08fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管Luigi更容易上手，但Airflow提供了更具表现力的可视化和支持。最终，由您的团队来确定您的技术需求是什么。</p></div></div>    
</body>
</html>