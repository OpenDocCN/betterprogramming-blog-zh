<html>
<head>
<title>Create a Smart Contract Development Workflow Using Hardhat Tasks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Hardhat任务创建智能合同开发工作流</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-smart-contract-developmentworkflow-using-hardhat-tasks-e5d80d819cea?source=collection_archive---------2-----------------------#2022-07-22">https://betterprogramming.pub/create-a-smart-contract-developmentworkflow-using-hardhat-tasks-e5d80d819cea?source=collection_archive---------2-----------------------#2022-07-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="da56" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何自动化智能合约部署脚本</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8259e813d3d522e7603d20fe00c75987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FZlCCltoKM4HP5cCGFpqiQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/es/@rgaleriacom?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Ricardo Gomez Angel </a>在<a class="ae kv" href="https://unsplash.com/s/photos/hardhat?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="4b82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了测试和部署之外，智能合约开发还可能涉及其他任务。也许您想在部署后立即与契约进行交互，或者更新文件中已部署契约地址的列表。</p><p id="65cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通常，您为每个任务编写脚本并单独运行它们，这很好，但是当您每次都必须运行多个脚本时，这就变得很乏味了。</p><p id="5292" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安全帽任务是将自动化添加到智能合同开发工作流的一种方式。它提供了一种更加结构化的方式来创建脚本。它还允许将多个脚本合并成一个。Hardhat任务还使解析参数变得更容易，因为它提供了参数类型验证。</p><p id="a3e1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，您将使用hardhat任务创建一个工作流。您将创建一个NFT智能合同并将其部署到Goerli测试网，在Etherscan上验证地址，并空投一些令牌。</p><h1 id="738f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">设置安全帽项目</h1><p id="a69c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">本教程将使用节点js版本16。如果你还没有NodeJS，我推荐<a class="ae kv" href="https://github.com/nvm-sh/nvm" rel="noopener ugc nofollow" target="_blank">安装节点版本管理器</a> (nvm)。拥有nvm后，运行以下命令:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="bf22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装完节点后，创建项目目录。移动到该目录并运行<code class="fe mr ms mt mu b">npx hardhat</code>来生成hardhat样板文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="a64a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Hardhat将提示您选择要使用的项目类型。在这种情况下，使用TypeScript。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/7e843025b73a0efae78c12fd9662d90a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RZnmImcvMkk-NKeFn_dX9w.png"/></div></div></figure><p id="c41b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦选择了项目的类型，回答所有的提示，回答“y”来安装项目的依赖项，然后等待hardhat生成样板文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/ffda2e7e4edd3219c009ba478aeb5e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v_suogglQ5G8BttbUHcqvg.png"/></div></div></figure><p id="e3e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成后，项目目录将如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/49f9223113f00a4a9e923a997a64386e.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*dex2zNUR7P_g-HkKFFWaLw.png"/></div></figure><h1 id="685f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">环境变量和安全帽配置</h1><p id="9a1d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">将您的contract deployer私钥、Etherscan API密钥和Alchemy密钥添加到<code class="fe mr ms mt mu b">.env.example</code>文件中。在本教程中，您将使用Goerli以太坊测试网络。</p><p id="7f4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加密钥后，将<code class="fe mr ms mt mu b">.env.example</code>重命名为<code class="fe mr ms mt mu b">.env</code>。</p><p id="d276" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您需要eth进行合同部署，您可以获得一些。对于Etherscan API密匙，可以在这里注册<a class="ae kv" href="https://etherscan.io/myapikey" rel="noopener ugc nofollow" target="_blank">。要获得你的炼金术钥匙，你可以在这里注册</a><a class="ae kv" href="https://auth.alchemyapi.io/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="9a32" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您的env文件现在应该如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="ffb4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看一看<code class="fe mr ms mt mu b">hardhat.config.ts</code>。这是一个文件，您可以在其中设置要使用的网络和私钥。配置文件从<code class="fe mr ms mt mu b">.env</code>文件中读取必要的环境变量。</p><p id="56a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您需要在<code class="fe mr ms mt mu b">config</code>变量的<code class="fe mr ms mt mu b">networks</code>属性中设置Goerli网络配置。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h1 id="e58d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">. eslintrc.js(可选)</h1><p id="f9f8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">将这些添加到<code class="fe mr ms mt mu b">.eslintrc.js</code>文件中，以删除VSCode中的警告。这一步是可选的，因为项目在没有这些配置的情况下仍然可以运行。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h1 id="53b1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">智能合同</h1><p id="e829" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在本教程中，您将使用Open Zeppelin的标准ERC721创建一个NFT合约。要做到这一点，你必须安装开放齐柏林飞艇。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="dac8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个名为<code class="fe mr ms mt mu b">NFT.sol</code>的新文件。我们的合同将继承Open Zeppelin的ERC721合同，以获得标准的ERC721功能。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h1 id="6487" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务</h1><p id="c730" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在您已经准备好了智能合约，您将创建的第一个任务是部署任务。创建一个名为tasks的目录，创建一个名为<code class="fe mr ms mt mu b">compile.ts</code>、<code class="fe mr ms mt mu b">deploy.ts</code>和<code class="fe mr ms mt mu b">index.ts</code>的文件。</p><h1 id="ce17" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">部署任务</h1><p id="ff1b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在<code class="fe mr ms mt mu b">deploy.ts</code>中，创建要在目录<code class="fe mr ms mt mu b">./tasks/deploy.ts</code>中编译的部署任务，并将我们的合同部署到测试网络。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="7de2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe mr ms mt mu b">./tasks.index.ts</code>中添加出口</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="de44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后将tasks目录添加到您的<code class="fe mr ms mt mu b">tsconfig.json</code>文件中，使TypeScript包含tasks文件夹。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h1 id="15c6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">验证任务</h1><p id="eb35" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在创建验证任务，该任务将验证Etherscan上部署的契约。创建文件<code class="fe mr ms mt mu b">./tasks/verify-etherscan.ts</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="ccb2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该任务需要一个可以插入<code class="fe mr ms mt mu b">contractAddress</code>的字符串参数。不要忘记在<code class="fe mr ms mt mu b">./tasks/index.ts</code>中添加出口。</p><p id="f8c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后使用以下代码在<code class="fe mr ms mt mu b">./tasks/index.ts</code>中添加导出:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h1 id="0437" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">空投任务</h1><p id="8fd9" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在，对于最后一项任务，您将空投代币到几个钱包地址。使用以下代码创建文件<code class="fe mr ms mt mu b">./tasks/airdrop.ts</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="1d1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe mr ms mt mu b">./tasks/index.ts</code>中添加出口</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h1 id="2bd5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">组合任务</h1><p id="e2b8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在，对于最后一个任务，您将把您创建的所有任务合并成一个任务。让我们使用下面的代码创建<code class="fe mr ms mt mu b">./tasks/deploy-verify-airdrop.ts</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="6b07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，不要忘记在<code class="fe mr ms mt mu b">./tasks/index.ts</code>中添加出口</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h1 id="59d7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">运行任务</h1><p id="c18d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在您已经创建了任务，您可以通过运行<code class="fe mr ms mt mu b">npx hardhat</code>来查看所有可用的任务。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/39baaf70b4c429ad110bdbdade1cd706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*9eUQioQXng78qZXG739xVw.png"/></div></figure><p id="399c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们通过运行以下命令来运行<code class="fe mr ms mt mu b">deploy-verify-airdrop</code>任务</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="c87e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在这里使用我生成的一个钱包地址作为空投地址，你可以把它改成你喜欢的任何钱包地址。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/3056544d537cb60f7acb8cfbf5887d5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rOPs33RNbcI1fugk01UtGg.png"/></div></div></figure><p id="8c47" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从日志的输出中，您可以看到已部署的NFT合同地址、在Etherscan上看到的已部署合同的链接，以及到给定地址的成功空投。</p><h1 id="5b4e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">摘要</h1><p id="c87f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">恭喜您，您已经成功部署了智能合约，在Etherscan上验证了部署，并通过一个命令与它进行了交互。您编写的脚本保持小型和模块化。此外，可以使用<code class="fe mr ms mt mu b">npx hardhat</code>模块轻松查看您创建的任务列表。</p><p id="0af6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Hardhat任务是最有用的工具之一，任何智能合约开发人员和您都应该利用它，因为它通过保持代码库更有组织性来提高您的生产力。</p></div></div>    
</body>
</html>