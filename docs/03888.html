<html>
<head>
<title>The Anatomy of a Kubernetes Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes星团的剖析</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/anatomy-of-kubernetes-cluster-24d88f77cf27?source=collection_archive---------23-----------------------#2020-03-10">https://betterprogramming.pub/anatomy-of-kubernetes-cluster-24d88f77cf27?source=collection_archive---------23-----------------------#2020-03-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a9d5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对星团内部的观察</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f57bd6a0b5cb7948f80da1fcc0c663c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yqzunvcAYcl5cKQlsd3asg.png"/></div></div></figure><p id="b98f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">典型的Kubernetes集群将包含:</p><ol class=""><li id="8a8c" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">一个或多个主节点。</li><li id="ac16" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">一个或多个节点。</li></ol><p id="87ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样，这些只是普通的计算机。有时它们可能是大型物理服务器，有时它们甚至可能是<a class="ae me" href="https://www.raspberrypi.org/" rel="noopener ugc nofollow" target="_blank">Raspberry pi</a>。但是在谷歌的Kubernetes引擎和<a class="ae me" href="https://www.elastic.co/elastic-cloud-kubernetes" rel="noopener ugc nofollow" target="_blank">弹性Kubernetes </a>服务的情况下，它们是虚拟机。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="56ef" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">主网点</h1><p id="bbc3" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">Masters运行几个组件，为我们提供了一个叫做<em class="nj">的控制平面</em>。他们做出关于集群的决策，例如在哪里安排特定的工作负载等。</p><p id="7221" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">主设备负责集群的状态。它持续关注一切，以确保一切正常运行。</p><p id="adbf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">节点运行提供运行时环境的组件(它们基本上是容器运行时的工作者)。这些节点为群集提供资源，如CPU、RAM等。</p><p id="28e0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当您在Kubernetes上部署容器时，主节点将选择一个节点来运行它。</p><p id="92f5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是Kubernetes主节点的示意图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/0d57c80a5c5a2094f53579e97fbfe181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j4Kd1IqK9KgOkiECIPleeQ.png"/></div></div></figure><h2 id="f6db" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated"><strong class="ak"> API服务器</strong></h2><p id="c5ea" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">API服务器是控制平面的前端；它公开了所有主函数的API。<br/>每次你和主控交流或者别的什么东西和主控(GCP的云壳)互动，都会通过这个API服务器。</p><h2 id="19ac" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated"><strong class="ak"> Etcd </strong></h2><p id="11f7" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">Etcd是<strong class="kw iu"> </strong> Kubernetes自己的数据库。它存储所有Kubernetes的配置和状态。我称之为数据库，但Etcd只是一个键值存储。</p><h2 id="a05c" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated"><strong class="ak">调度器</strong></h2><p id="6f28" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">调度程序负责调度工作负载。这意味着当您想要部署一个容器时，调度程序将选择一个节点来运行该容器。<br/>它选择的节点会受到很多因素的影响，例如每个可用节点上的当前负载、容器的要求以及其他一些可定制的约束。</p><h2 id="0a9e" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated"><strong class="ak">云控制器管理器</strong></h2><p id="0b28" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">云控制器管理器允许Kubernetes使用云平台。请记住，Kubernetes本身是一个开源项目，由大公司而不仅仅是谷歌做出贡献，所以它本身并不包含仅适用于GCP的功能。<br/>这位经理负责管理网络和负载平衡等事务，因为它们转化为特定云平台的产品和服务。</p><h2 id="b9e1" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated"><strong class="ak"> Kube控制管理器</strong></h2><p id="5943" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">Kube控制管理器的工作是管理集群中的一些控制器。控制器本身负责节点和其他一些对象。<br/>现在，可能需要消化很多信息，但是当您启动集群时，您将主要使用API服务器。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="6781" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">工作节点</h1><p id="689f" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">现在我们来看看Kubernetes的节点(Worker)。他们比大师直白多了。</p><p id="a3a5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是工作节点的示意图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/e6644ede222877cc6ccac2f5be714014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*kc1yVO3bPmlT_9k0p8QaTw.png"/></div></figure><h2 id="51af" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated">库伯莱</h2><p id="dc4d" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">Kubelet是Kubernetes的代理商。它与控制平面通信，并在被告知时接受部署容器等指令。</p><h2 id="191f" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated"><strong class="ak"> Kube-proxy </strong></h2><p id="bd51" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">Kube代理负责进出节点的网络连接。</p><h2 id="8cbd" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated"><strong class="ak">容器运行时</strong></h2><p id="fda3" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">该节点将Docker作为容器运行时来运行，以允许它运行容器。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="8152" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">创建Kubernetes集群</h1><p id="4f31" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">创建Kubernetes集群有两种方法。</p><ol class=""><li id="2b98" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">艰难的方式。</li><li id="9ee8" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">简单的方法。</li></ol><h2 id="d30a" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated"><strong class="ak">敬酒不吃吃罚酒</strong></h2><p id="ab31" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">在硬方法中，您启动虚拟机并配置工作节点和主节点。</p><p id="2b66" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们需要安装Kubernetes软件，提供网络覆盖，并设置证书，以便内部的组件可以相互通信。</p><h2 id="3d67" class="nl mn it bd mo nm nn dn ms no np dp mw ld nq nr my lh ns nt na ll nu nv nc nw bi translated"><strong class="ak">简单的方法</strong></h2><p id="860b" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">简单来说，我们可以使用几乎所有云提供商提供的预定义服务，例如谷歌云平台的GKE。</p><p id="d61c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">GKE自动调配和管理所有底层云资源。它会为您创建主节点和工作节点，您甚至不需要接触主控制平面。完全是为你管理的。</p><p id="d1a4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以将GKE的建筑与我们下面的建筑进行比较。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/49791ccffce909fc671d56b170813abe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qMYxfTWf3MuSgmRnG6hiXg.png"/></div></div></figure></div></div>    
</body>
</html>