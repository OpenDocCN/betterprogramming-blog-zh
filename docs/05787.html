<html>
<head>
<title>Hidden Gems: Event-Driven Change Notifications in Relational Databases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">隐藏的宝石:关系数据库中事件驱动的变更通知</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/hidden-gems-event-driven-change-notifications-in-relational-databases-a87a7bdb02ad?source=collection_archive---------15-----------------------#2020-08-05">https://betterprogramming.pub/hidden-gems-event-driven-change-notifications-in-relational-databases-a87a7bdb02ad?source=collection_archive---------15-----------------------#2020-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1e69" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">开发人员应该知道的一个强大的非标准特性</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c0ba117883067e57ebe3dc127dc00589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9sBJcLaPrXdfs1BYcA_9-Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">看啊！一颗500克拉的钻石躺在沙滩上！(图片来自<a class="ae kv" href="https://unsplash.com/@justchris87" rel="noopener ugc nofollow" target="_blank">克里斯·科</a>)。</p></figure><h1 id="403a" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="9351" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果我们可以在数据直接从数据库更改时接收事件驱动的更改通知(EDCN ),而不必轮询更新，这不是很好吗？</p><p id="e86a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">事实上，这个特性在一些关系数据库中是可用的，但是<em class="mp">不是全部，</em>因为它是非标准功能，不是任何SQL规范的一部分。</p><p id="6447" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在本文涉及的三个例子中，这个功能是通过一个接口的实现来表达的，然后这个接口直接注册到JDBC驱动程序中。这打开了无数潜在用例的大门，这些用例可以在不需要投票的情况下表达，也不需要开发人员编写基础结构代码来处理数据变化和通知相关方。相反，我们可以直接与驱动程序交互，监听变化，当变化发生时，以事件驱动的方式执行我们的任何工作流。这可能有所帮助的几个例子包括:</p><ul class=""><li id="17c9" class="mq mr iq lq b lr mk lu ml lx ms mb mt mf mu mj mv mw mx my bi translated">缓存(当我们讨论PostgreSQL的时候会有更多关于它的内容，也可以参见<a class="ae kv" href="https://docs.oracle.com/database/121/ADFNS/adfns_cqn.htm#ADFNS1015" rel="noopener ugc nofollow" target="_blank">CQN</a>的优秀候选者)</li><li id="3cff" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated"><a class="ae kv" href="https://hackernoon.com/poison-records-acra-eli5-d78250ef94f" rel="noopener ugc nofollow" target="_blank">蜜罐</a>用于数据库表——参见<a class="ae kv" href="https://hackernoon.com/poison-records-acra-eli5-d78250ef94f" rel="noopener ugc nofollow" target="_blank">毒物记录</a></li><li id="98a9" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">调试问题</li><li id="9ddb" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">记录更改</li><li id="11f5" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">分析和报告</li></ul><p id="e8df" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当然，依赖这种功能会有一些后果。最明显的暗示是，它是一个将应用程序直接绑定到数据库的非标准特性。</p><p id="8b1d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我在LinkedIn<a class="ae kv" href="https://www.linkedin.com/posts/thomasfuller_code-postgres-database-activity-6689162224210075648-N4Ah" rel="noopener ugc nofollow" target="_blank">上与</a><a class="ae kv" href="https://www.linkedin.com/in/duergner/" rel="noopener ugc nofollow" target="_blank"> Michael Dürgner </a>讨论了一个与PostgreSQL相关的示例实现，并且<a class="ae kv" href="https://www.linkedin.com/feed/update/urn:li:activity:6689162224210075648/?commentUrn=urn%3Ali%3Acomment%3A%28activity%3A6689162224210075648%2C6692526639311527936%29" rel="noopener ugc nofollow" target="_blank">他评论说</a>:</p><blockquote class="ne nf ng"><p id="22da" class="lo lp mp lq b lr mk jr lt lu ml ju lw nh mm lz ma ni mn md me nj mo mh mi mj ij bi translated">“虽然这绝对是一个很好的方法，但它的一个大缺点是你将应用程序逻辑移到了RDBMS中。这并不是说你不应该这样做，而是要确保你的员工对你使用的RDBMS有深刻的理解，因为一般的软件不太可能解决问题。这种方法的另一个巨大挑战是连续交付，因为您的RDBMS需要与您的交付渠道深度集成。”</p></blockquote><p id="1b66" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我同意Michael的观点，将业务逻辑排除在数据库之外是一种很好的做法。</p><p id="ea76" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当开发人员需要在可能属于应用程序本身的数据库层中添加逻辑时，依赖于对象关系映射(ORM)工具(如<a class="ae kv" href="https://docs.oracle.com/javaee/6/tutorial/doc/bnbpz.html" rel="noopener ugc nofollow" target="_blank"> Java Persistence API </a> (JPA)直接从一个或多个对象模型生成数据库模式的项目会立即失去可移植性和简洁性。如果开发人员不小心，他们最终将不得不使用与生产中相同的数据库进行测试，这很容易导致痛苦和遗憾。</p><p id="982e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我向任何考虑通过JDBC驱动程序使用EDCNs的工程师提出以下问题:如果不包含您正在构建的依赖于此功能的任何东西，应用程序还能按预期运行吗？如果答案是“是”，那么你正在做的事情很可能是好的；相反，如果答案是“否”，那么这是反对使用氯化萘的一次罢工，可能需要考虑替代品。</p><p id="9b5a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，这个特性本身并不能替代精心设计的<a class="ae kv" href="https://en.wikipedia.org/wiki/Message-oriented_middleware" rel="noopener ugc nofollow" target="_blank">面向消息的中间件</a> (MOM)，后者通常提供现成的解决方案来保证交付、消息持久性、<a class="ae kv" href="https://doc.akka.io/docs/akka/current/general/message-delivery-reliability.html?language=scala" rel="noopener ugc nofollow" target="_blank">至少一次/恰好一次交付</a>、通过队列和主题的交付、流控制策略(另请参见:<a class="ae kv" href="https://medium.com/@jayphelps/backpressure-explained-the-flow-of-data-through-software-2350b3e77ce7" rel="noopener">背压</a>)，并解决容错和可伸缩性问题。这些要求的存在可能是一个强有力的指标，表明需要重新考虑依赖EDCNs的方法。</p><p id="fee1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面我们来探究一下存在于<a class="ae kv" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>、<a class="ae kv" href="https://docs.oracle.com/en/database/oracle/oracle-database/index.html" rel="noopener ugc nofollow" target="_blank"> Oracle </a>和<a class="ae kv" href="http://www.h2database.com/" rel="noopener ugc nofollow" target="_blank"> H2 </a>数据库中的这种功能；我们还包括一些关于MySQL 和它的分支<a class="ae kv" href="https://mariadb.org/" rel="noopener ugc nofollow" target="_blank"> MariaDB </a>的一般性评论。</p><p id="c572" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在本文中，我们依赖于Java 13.0.2和Groovy。3.0.4和包含GitHub上各种脚本的链接，这些链接包含关于如何设置所需的依赖项和运行示例所需的任何其他先决条件的额外注释。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="bc00" class="kw kx iq bd ky kz nr lb lc ld ns lf lg jw nt jx li jz nu ka lk kc nv kd lm ln bi translated">一种数据库系统</h1><p id="07b4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">PostgreSQL (Postgres)数据库是我们要研究的第一个例子。</p><p id="ec0e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Postgres API包括<a class="ae kv" href="https://impossibl.github.io/pgjdbc-ng/apidocs/0.7/com/impossibl/postgres/api/jdbc/PGNotificationListener.html" rel="noopener ugc nofollow" target="_blank"> PGNotificationListener </a>接口，必须实现该接口，然后向数据库连接注册。注意，这里有两个可用的实现:Postgres[默认] JDBC驱动程序T13和不可能的JDBC驱动程序T15实现。我们不想使用Postgres驱动程序，因为该实现将轮询数据库的更改。相反，我们将依赖Impossibl实现，它提供真正的事件驱动通知。</p><p id="3c22" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我有机会与<a class="ae kv" href="https://www.linkedin.com/in/erikbrandsberg/" rel="noopener ugc nofollow" target="_blank">Heimdall Data</a>的首席技术官Erik brands Berg<a class="ae kv" href="https://www.linkedin.com/in/erikbrandsberg/" rel="noopener ugc nofollow" target="_blank">就此进行了交谈，Erik表示:</a></p><blockquote class="ne nf ng"><p id="1ce4" class="lo lp mp lq b lr mk jr lt lu ml ju lw nh mm lz ma ni mn md me nj mo mh mi mj ij bi translated">“与其他数据库相比，PG notify界面是PG中隐藏的瑰宝之一。我们可以使用它来提供代理之间的缓存失效消息，而不是使用Redis上的独特发布/订阅接口。”</p></blockquote><p id="e2b1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Heimdall Data为使用<a class="ae kv" href="https://aws.amazon.com/rds/" rel="noopener ugc nofollow" target="_blank">亚马逊关系数据库服务</a>(亚马逊RDS)和其他数据库的应用程序提供了一个复杂的缓存解决方案，这是一个真实的使用案例，展示了该功能的重要性。</p><p id="03de" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在下面的例子中，<a class="ae kv" href="https://www.postgresql.org/docs/9.6/plpgsql-trigger.html" rel="noopener ugc nofollow" target="_blank">触发器</a>和<a class="ae kv" href="https://www.postgresql.org/docs/9.6/sql-createfunction.html" rel="noopener ugc nofollow" target="_blank">函数</a>脚本必须在Postgres内部执行，这是运行Groovy脚本的先决条件。<em class="mp"> notify_change </em>函数将向任何注册的<a class="ae kv" href="https://en.wikipedia.org/wiki/Event_(computing)" rel="noopener ugc nofollow" target="_blank">侦听器</a>发送事件，这些侦听器正在侦听<em class="mp">example channel</em><a class="ae kv" href="https://en.wikipedia.org/wiki/Channel_(programming)" rel="noopener ugc nofollow" target="_blank">channel</a>——请特别注意下面的警告，因为通道名称区分大小写。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="84ef" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">接下来是使用PostgreSQL数据库的<a class="ae kv" href="https://impossibl.github.io/pgjdbc-ng/apidocs/0.7/com/impossibl/postgres/api/jdbc/PGNotificationListener.html" rel="noopener ugc nofollow" target="_blank">com . impossibl . postgres . API . JDBC . PGNotificationListener</a>的<a class="ae kv" href="https://github.com/thospfuller/GroovyExamples/blob/master/event-driven-jdbc/PGNotificationListenerInPostGreSQLDatabaseExample.groovy" rel="noopener ugc nofollow" target="_blank">工作示例</a>实现。<em class="mp"> PGNotificationListener </em>接口要求开发者只实现一个方法:</p><p id="33c4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><code class="fe ny nz oa ob b">void notification(int processId, String channelName, String payload)</code></p><p id="f63a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们可以在下面的第18行看到这一点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="8bb9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们可以看到一个正在执行的脚本示例，以及出现在下图中的<a class="ae kv" href="http://www.groovy-lang.org/groovyconsole.html" rel="noopener ugc nofollow" target="_blank"> GroovyConsole </a>中的解释和输出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/ceaf14ac6e7e0140d0db87a4feb14506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NN27_TQWtFXi7wsdDfRkHQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">对在Groovy控制台中运行的PostgreSQL示例的解释。</p></figure><p id="2638" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们将讨论的下一个例子包括事件驱动的变更通知功能，因为它适用于<a class="ae kv" href="https://en.wikipedia.org/wiki/Oracle_Database" rel="noopener ugc nofollow" target="_blank"> Oracle数据库</a>。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="f92a" class="kw kx iq bd ky kz nr lb lc ld ns lf lg jw nt jx li jz nu ka lk kc nv kd lm ln bi translated">神谕</h1><p id="19b0" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们将在本文中讨论的下一个例子将集中在Oracle数据库上。下面，我们将详细介绍通过JDBC驱动程序配置事件驱动的变更通知所需的步骤，以及运行该示例所需的前提条件。</p><p id="f8c6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面两个要点是这个例子的先决条件。值得注意的是，Docker运行在另一台机器上，在这种情况下，它使用的是Ubuntu操作系统。参见<a class="ae kv" href="https://github.com/thospfuller/GroovyExamples/blob/master/event-driven-jdbc/DatabaseChangeListenerInOracleDatabaseExample.groovy" rel="noopener ugc nofollow" target="_blank">databasechangelistenerinoracledatabaseexample . groovy</a>脚本中关于在Docker本地运行Oracle的警告，了解完整的细节。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="2202" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在SQL*Plus中，我们现在可以运行以下配置脚本。请记住，一旦创建了示例表(参见第8行),就可以启动下一节中的Groovy脚本，对目标表的任何插入、更新或删除操作都会导致事件被发送到Groovy脚本，然后打印到控制台输出。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="fbc7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这里我们有一个完整的<a class="ae kv" href="https://github.com/thospfuller/GroovyExamples/blob/master/event-driven-jdbc/DatabaseChangeListenerInOracleDatabaseExample.groovy" rel="noopener ugc nofollow" target="_blank">databasechangelistenerinoracledatabaseexample . groovy</a>脚本的例子。请注意，开发人员必须实现一种方法:</p><p id="f742" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><code class="fe ny nz oa ob b">void onDatabaseChangeNotification(DatabaseChangeEvent databaseChangeEvent)</code></p><p id="069b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们可以在下面的第55行看到这个实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="3175" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下图更深入地介绍了每个步骤的作用，并附有一些解释输出的注释。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/848667c9c5c0f788487b2de77a28afed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aVKnlqYK86QWcBhGu9YIZQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">对与Oracle数据库相关的示例脚本所做工作的更深入的解释，包括解释输出的注释。</p></figure><p id="4cf6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，下图演示了当我们在一行中执行五次插入，然后提交更改时，只发出一个事件，包括这五次插入。只有当提交成功返回时，才会发出事件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/7639ac76b0dfba3e838af8fc4e15cae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R51zZm2ZI6mnGS8MIh3QEg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在SQL*Plus中执行了五次插入，然后是一次提交，我们可以看到该事件包括这五次插入操作。</p></figure><p id="3544" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们将在本文中讨论的最后一个例子包括<a class="ae kv" href="https://www.h2database.com/html/main.html" rel="noopener ugc nofollow" target="_blank"> H2数据库</a>。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="78e6" class="kw kx iq bd ky kz nr lb lc ld ns lf lg jw nt jx li jz nu ka lk kc nv kd lm ln bi translated">H2数据库</h1><p id="7ef5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">H2数据库是一个完全用Java编写的开源、轻量级、非常强大的关系数据库。它支持一长串特性，并且<a class="ae kv" href="https://mvnrepository.com/artifact/com.h2database/h2" rel="noopener ugc nofollow" target="_blank">作为一个2.2mb的jar文件</a>发布。在测试Java应用程序时经常使用H2，它作为嵌入式数据库工作得很好，并且可以与<a class="ae kv" href="https://docs.oracle.com/javaee/6/tutorial/doc/bnbpz.html" rel="noopener ugc nofollow" target="_blank">对象关系映射工具一起使用，例如Java持久性API (JPA) </a>。H2也被嵌入到JBoss Wildfly应用服务器中，并且已经作为嵌入式数据库在JBoss中使用了很长时间。</p><p id="d500" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">H2通过<a class="ae kv" href="http://www.h2database.com/javadoc/org/h2/api/DatabaseEventListener.html" rel="noopener ugc nofollow" target="_blank">org . H2 . API . databaseeventlistener</a>接口传递事件通知。与前面介绍的Postgres和Oracle监听器规范相比，DatabaseEventListener接口提供的功能有限。实现接口所需的方法有:</p><p id="9f4d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><code class="fe ny nz oa ob b">void closingDatabase ()<br/>void exceptionThrown(SQLException sqlException, String sql)<br/>void init (String url)<br/>void opened ()<br/>void setProgress (String state, String name, int x, int max)</code></p><p id="c7aa" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">使用h2数据库<a class="ae kv" href="https://github.com/thospfuller/GroovyExamples/blob/master/event-driven-jdbc/H2EventListenerExample.groovy" rel="noopener ugc nofollow" target="_blank">的<a class="ae kv" href="http://www.h2database.com/javadoc/org/h2/api/DatabaseEventListener.html" rel="noopener ugc nofollow" target="_blank">org . H2 . API . databaseeventlistener</a>的一个工作示例实现可以在GitHub </a>上找到，也包含在下面的要点中，后面是一张带有指针的图片，解释了这是如何工作的。</p><p id="925c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这个例子中，H2运行在嵌入式模式下——也就是说，H2完全运行在运行Groovy脚本的同一个虚拟机的内存中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="13a4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在下图中，我们可以看到这个脚本的执行示例，以及GroovyConsole中的输出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/9d1469691d9ca3dbfb377fe9339cb8b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Luu1c3V2x-q7AGwWrDJ3LA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一个在Groovy控制台中运行的H2 DatabaseEventListener的例子，包括输出。</p></figure><p id="da3f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">有点令人失望的是，H2 DatabaseEventListener没有提供与PostgreSQL接口类似的功能。因此，我在GitHub的H2数据库上提交了一个新的特性请求，如果时间允许的话，我会尝试自己实现它。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="7532" class="kw kx iq bd ky kz nr lb lc ld ns lf lg jw nt jx li jz nu ka lk kc nv kd lm ln bi translated">MySQL/MariaDB</h1><p id="595d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">MySQL或MariaDB数据库似乎都不支持通过JDBC驱动程序的事件驱动的变更通知，因此如果需要此功能，工程师将不得不考虑替代解决方案。</p><p id="fe4f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们将不讨论触发器和用户定义的函数(UDF ),因为它们与MySQL和MariaDB调用web服务端点有关，这是一种替代方法。对这个主题的简短研究表明，触发器和UDF可以用来实现这一点；但是，在采用这种方法时，必须考虑它们潜在的重大安全和性能影响。</p><p id="66ae" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果您在MySQL和/或MariaDB中使用了触发器和UDF或其他解决方案来完成这一任务，请在评论中详细说明您需要做什么、您采用的方法以及效果如何。最后，如果MySQL和MariaDB中有更好的解决方案，请进一步解释。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="b68c" class="kw kx iq bd ky kz nr lb lc ld ns lf lg jw nt jx li jz nu ka lk kc nv kd lm ln bi translated">结论</h1><p id="cadd" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在您参与的项目中，您在关系数据库中使用过事件驱动的变更通知吗？如果是这样，我鼓励你在评论中讨论以下任何一个问题:</p><ul class=""><li id="baf9" class="mq mr iq lq b lr mk lu ml lx ms mb mt mf mu mj mv mw mx my bi translated">它有什么用？</li><li id="3de3" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">使用了什么数据库？</li><li id="bf22" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">该解决方案是用什么语言编写的？</li><li id="2876" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">你能用微软的SQL服务器或者这里没有提到的其他数据库来做这件事吗？</li><li id="aa04" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">遇到问题了吗，如何解决的？</li><li id="41c5" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">该选项是否经过研究并确定为<em class="mp">而非</em>解决当前问题的合适方案？</li><li id="ea85" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">您是否被迫使用替代方案，如果是，实现看起来像什么，为什么？</li><li id="0255" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">你可能有的任何其他想法，包括我可能遗漏在这里的任何问题。</li></ul><p id="f3f9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">虽然EDCNs在受支持的关系数据库中提供了强大的功能，但是我们希望，除了提供一些工作示例之外，还应该清楚依赖这一特性是有代价的，并且在使用它之前必须给予适当的考虑。</p><p id="5689" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">编码快乐！</p></div></div>    
</body>
</html>