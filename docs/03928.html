<html>
<head>
<title>How to Create a GitHub Action to Upload Posts From Hugo to Medium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建一个GitHub动作将帖子从Hugo上传到Medium</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-a-github-action-to-upload-posts-from-hugo-to-medium-6a2a5ba9818e?source=collection_archive---------16-----------------------#2020-03-12">https://betterprogramming.pub/how-to-create-a-github-action-to-upload-posts-from-hugo-to-medium-6a2a5ba9818e?source=collection_archive---------16-----------------------#2020-03-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fe1c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将你的最新文章直接上传到Medium，同时上传到你的Hugo博客</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/92e646325b3d4aac89d9ab376d2531a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GlrrheZhoKXNlK1Wu1Yyng.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用CodeSnap制作的照片。</p></figure></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="e0ef" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">动机</h1><p id="69e2" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">每次我在我的个人网站上添加博客(这种情况非常罕见)，我都必须进入我的介质配置文件并手动导入。一旦我了解了<a class="ae mt" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>，我的第一个想法就是自动化这个过程。此外，这个项目是为了更好地理解GitHub的行为。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="9e98" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">描述</h1><p id="312c" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">每当我用一个特殊的提交消息将我的代码推送到GitHub repo时，我们的操作就接受新的post，使用Medium API，并在我的Medium帐户上创建一个新的草稿。</p><p id="3019" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">下面是一个提交消息的示例:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8c62" class="ne lg it na b gy nf ng l nh ni">added: blog PUBLISH post.md</span></pre><p id="a839" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">好了，让我们开始吧。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="82b9" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">发展</h1><p id="f2ec" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">首先，让我澄清一些事情。由于这是我的第一次GitHub操作，我不知道这一切是如何集成的。我花了很长时间才开始明白，所以我对新手的建议是创建两个库:一个用于您的操作，另一个用于测试该操作。</p><p id="21c3" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated"><a class="ae mt" href="https://help.github.com/en/actions/building-actions/creating-a-docker-container-action" rel="noopener ugc nofollow" target="_blank">官方安装指南</a>很好，但对我来说还是有点混乱，因为Docker容器的例子非常简单，只包含了一个<code class="fe nj nk nl na b">Hello World</code>类型。</p><p id="8b59" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">在我们开始之前，请阅读如何在GitHub中设置环境变量，并从<a class="ae mt" href="https://medium.com/me/applications" rel="noopener">介质应用</a>和<a class="ae mt" href="https://medium.com/me/settings" rel="noopener">介质设置</a>中生成您的<code class="fe nj nk nl na b">APP_ID</code>、<code class="fe nj nk nl na b">APP_SECRET</code>和<code class="fe nj nk nl na b">ACCESS_TOKEN</code>。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="d21d" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">创建action.yml</h1><p id="9ad3" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">首先，让我们看看代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="9532" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">所以这很简单:</p><ul class=""><li id="f575" class="no np it lz b ma mu md mv mg nq mk nr mo ns ms nt nu nv nw bi translated"><code class="fe nj nk nl na b">name</code>:我们行动的名称。</li><li id="53ef" class="no np it lz b ma nx md ny mg nz mk oa mo ob ms nt nu nv nw bi translated"><code class="fe nj nk nl na b">description</code>:我们行动的正常描述。</li><li id="7e39" class="no np it lz b ma nx md ny mg nz mk oa mo ob ms nt nu nv nw bi translated">这是它开始的地方。基本上，它使用我们的Dockerfile并生成它。</li><li id="fa8e" class="no np it lz b ma nx md ny mg nz mk oa mo ob ms nt nu nv nw bi translated">这只是一个将在市场上使用的普通品牌。</li></ul></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="da2a" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">创建Dockerfile文件</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="d1e8" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">好，我们的docker文件将使用Python Alpine图像。然后，它将安装所需的模块。之后，我们将安装媒体库，稍后将使用它来提供媒体和我们的项目之间的接口。</p><p id="b602" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">然后它将复制我们的<code class="fe nj nk nl na b">entrypoint.sh</code>和<code class="fe nj nk nl na b">post.py</code>，最后入口点定义将首先运行的脚本。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="22f3" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">创建入口点. sh</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="a0e8" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">这也很简单。基本上，它会找到我们最新的GitHub提交消息，并将其发送给我们的<code class="fe nj nk nl na b">post.py</code>脚本。我们可以通过使用Python很容易地做到这一点(因为我们以后会需要Python)，但是出于某种原因，我想使用bash来遍历一个JSON文件。老实说，这很好。对于那些好奇的人来说，请看一下它的文档。</p><p id="e2c6" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated"><code class="fe nj nk nl na b">$GITHUB_EVENT_PATH</code>存储JSON文件的路径，该文件存储关于我们的repo(提交、所有者等)的信息。).</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="0921" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">创建post.py</h1><p id="0d80" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">所以让我们来看看发布到Medium的代码。正如我们在开始时提到的，我们将使用环境变量。<code class="fe nj nk nl na b">BLOG_DIR</code>是你发布博客的目录。</p><p id="26dc" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">例如，<code class="fe nj nk nl na b">content\blog</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="cb9f" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">代码接受所有的环境变量，也接受从<code class="fe nj nk nl na b">entrypoint.sh</code>传来的提交消息。</p><p id="aa25" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">它检查提交消息是否包含<code class="fe nj nk nl na b">PUBLISH</code>。如果是，那么我们继续从博客目录的所有文件中进行匹配。一旦找到提交消息中给出的博客名称，它就获取文件并将其发送给我们的函数，该函数将处理媒体部分。</p><p id="612d" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">中间部分很简单。摘自Medium的官方文档。它从环境变量中获取<code class="fe nj nk nl na b">APP_ID</code>和<code class="fe nj nk nl na b">APP_SECRET</code>来创建我们的客户端。然后从环境中取<code class="fe nj nk nl na b">ACCESS_TOKEN</code>。接下来，我们获取用户详细信息，并使用<code class="fe nj nk nl na b">user id</code>来创建帖子。</p><p id="d944" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">我们帖子的标题是现在的文件名。我们以降价的格式发送代码，因为我们的Hugo博客是降价的。就是这样！我们的帖子被上传到我们的媒体档案。</p><p id="4ce7" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">但是等一下！那些<code class="fe nj nk nl na b">join split strips</code>呢？好了，我上面说的都是事情应该怎么发展。老实说，我的GitHub动作日志一度显示类似于<code class="fe nj nk nl na b">Post.MD == Post.MD =&gt; False</code>的内容。经过30分钟的测试和修改，我发现两个字符串的长度不同，因为有空格。所以这就是为什么我们要剥掉它们。</p><p id="0026" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">除此之外，<code class="fe nj nk nl na b">join</code>只是将字符串列表转换成一个字符串，<code class="fe nj nk nl na b">split</code>是获取提交消息<code class="fe nj nk nl na b">PUBLISH</code>中标签之后的内容。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="5d32" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">Sample main.yml</h1><p id="cb08" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">让我们看一个在我们个人项目中设置的示例<code class="fe nj nk nl na b">main.yml</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="9efa" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">我们使用checkout操作，因为我们将需要docker文件中的回购内容。然后我会从主分支调用我的行动。</p><p id="02ec" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">把这个粘贴到<code class="fe nj nk nl na b">.github/workflows/</code>就大功告成了。</p><p id="a207" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">你可以在<a class="ae mt" href="https://github.com/pr4k/hugo-to-medium" rel="noopener ugc nofollow" target="_blank"> @pr4k/Hugo-To-Medium </a>找到完整的源代码。感谢阅读。</p></div></div>    
</body>
</html>