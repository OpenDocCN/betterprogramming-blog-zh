<html>
<head>
<title>Code a Snake Game With Button Controls Using SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SwiftUI编写一个带有按钮控件的贪吃蛇游戏</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/code-a-snake-game-with-button-controls-using-swiftui-ee1096f220e0?source=collection_archive---------9-----------------------#2022-09-30">https://betterprogramming.pub/code-a-snake-game-with-button-controls-using-swiftui-ee1096f220e0?source=collection_archive---------9-----------------------#2022-09-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c487" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">看看如何建立另一个经典游戏</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2bcfe7a2ab0ef46f11c5ab24242811e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YpPpFP8cANhi_2zsgnjmfQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">SwiftUI中的蛇游戏</p></figure><p id="808b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">前几周，我发表了一篇<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/build-a-tetris-game-using-swiftui-c8c9b1722259"> <em class="lv">文章</em> </a>，讲述了我构建俄罗斯方块游戏《挑战》的旅程。你可以在这里读到它。俄罗斯方块之前的另一个类似但不同的游戏；另一个更简单的经典实现是贪吃蛇游戏。和我一起在这篇短文中使用pure SwiftUI构建您的贪吃蛇游戏副本。</p><h1 id="4603" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">游戏</h1><p id="b208" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">最直接的说法是，贪吃蛇游戏只不过是一个正方形。你必须浏览屏幕来“吃掉”随机出现在屏幕上的单个方块。当你吃这些单个的时候，蛇会吸收它们，变得稍微长一点。</p><p id="3f38" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">面临的挑战是，当蛇变长时，它不能撞到身体两侧或自身；随着蛇变得越来越长，游戏变得越来越难，并且这种实现的情况也变得越来越快。</p><h1 id="a1bf" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">组件</h1><p id="6746" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">首先，我需要一个循环，因为蛇在不断移动，所以像这样的计时器是显而易见的选择。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="9345" class="my lx it mu b gy mz na l nb nc">var timer = Timer.publish(every: 0.5, on: .main, in: .common).autoconnect()</span></pre><p id="aba5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">除此之外，我需要一个代表蛇的每个部分的视图。需要记住其位置的视图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="31d5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在游戏的主循环中，我需要在蛇前进的过程中绘制蛇的一部分；只有当你设法吃掉一条蛇的时候，这条蛇本身才会变大。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5cd3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意，定义该数组第一个条目的代码与snake body结构相同。但是我不能使用这个结构，因为在编译器想要初始化这里的<code class="fe nf ng nh mu b"><a class="ae lu" href="http://twitter.com/State" rel="noopener ugc nofollow" target="_blank">@State</a></code>变量之前，这个结构还没有被初始化。</p><p id="2f10" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在同一个循环中，我画了一个不同颜色的方块，代表蛇成长必须吃的食物，有一个我需要注意的重要警告；食物的位置必须存储在一个<code class="fe nf ng nh mu b"><a class="ae lu" href="http://twitter.com/State" rel="noopener ugc nofollow" target="_blank">@State</a></code>变量中，我可以将这个变量与蛇头匹配。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d955" class="my lx it mu b gy mz na l nb nc">ZStack {<br/>  ForEach((snakeStart..&lt;snakeParts.count), id: \.self) {<br/>    snakeParts[$0]<br/>  }<br/>}.id(snakeCount)</span></pre><p id="d663" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我需要一组控件，通过它们我可以向蛇发出信号，告诉它们需要改变方向，这里唯一稍微有点不寻常的代码是一个最小时间为零的<code class="fe nf ng nh mu b">longPressGesture</code>—也就是触摸。类似这样的代码。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="aaf7" class="my lx it mu b gy mz na l nb nc">Text("Up")<br/>  .font(Fonts.avenirNextCondensedBold(size: 24))<br/>  .onLongPressGesture(minimumDuration: 0) {<br/>    snakeDirection = .up<br/>  }.padding()</span></pre><p id="c678" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我没有提到，但是你可以在这里看到。我还用我的四个方向创建了一个枚举，使事情更具可读性。</p><h1 id="03b7" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">玩游戏</h1><p id="09f3" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">现在，随着计时器开始计时，我需要通过创建一个新的线段来移动蛇的头部，其方向与之前命令的方向相同。我用这段代码做的一个任务。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="7939" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">随后，我向数组中添加了一个片段，假设他没有吃掉方块中的食物，将切片向上移动一个。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="6ca9" class="my lx it mu b gy mz na l nb nc">let newPart = SnakeBody(snakeHead: snakeHead)<br/>snakeParts.append(newPart<br/>  .eraseToAnyView())<br/>snakeStart += 1</span></pre><p id="1bfb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nf ng nh mu b">eraseToAnyView</code>是我在这篇<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/16-useful-extensions-for-swiftui-88aae6ff8909">论文</a>中谈到的标准扩展之一。bon——现在，当你设法消耗一些蛇食时，我需要做两件事——我需要创建和放置更多的食物，我想让它变得更复杂一点，所以我将计时器缩短了几纳秒。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5f40" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，我为<code class="fe nf ng nh mu b">rndX</code>和<code class="fe nf ng nh mu b">rndY</code>值准备的这些奇怪的神奇公式就是这样，因为我需要确保每一口食物都放在一个X/Y位置，这样我就可以与我移动的蛇头相匹配。</p><p id="612c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有这一切让我结束了——我想我让它听起来比实际上要简单一点——我不能否认，最终我花了几个小时才把它弄好。</p><p id="870f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在这里找到完整的代码<a class="ae lu" href="https://gist.github.com/19310c888105e3a53316f4354d1d1812.git" rel="noopener ugc nofollow" target="_blank"><em class="lv"/></a>——如果你想尝试创建自己的贪吃蛇游戏版本。</p><h1 id="dbea" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">将来的</h1><p id="f20d" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">当然，它还没有完全完成——我留给你们做最后的挑战。</p><ul class=""><li id="d205" class="ni nj it la b lb lc le lf lh nk ll nl lp nm lt nn no np nq bi translated">目前，蛇可以从屏幕上消失；一些边界检查需要添加到代码中，这是一个游戏结束的条件。</li><li id="dcf8" class="ni nj it la b lb nr le ns lh nt ll nu lp nv lt nn no np nq bi translated">同样的，蛇可以撞上自己而没有后果，这是你需要添加的第二个游戏结束条件。</li><li id="096d" class="ni nj it la b lb nr le ns lh nt ll nu lp nv lt nn no np nq bi translated">最后，当游戏结束时，某种分数和/或消息将是好的，这样玩家可以看到他们是否变得更好。</li></ul><h1 id="384d" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">病菌</h1><p id="fa82" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">现在，虽然这个小应用程序在iPhone 14和12.9' iPad Pro模拟器上运行得很好，但在我的iPhone 8上却不能正常运行。它失败是因为寻找蛇捕获食物的if语句太精确；读者们，对你们来说，最后一个挑战是添加一个稍微宽容一点的函数，看看坐标是否足够匹配！</p></div></div>    
</body>
</html>