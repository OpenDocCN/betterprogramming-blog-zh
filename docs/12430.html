<html>
<head>
<title>How I Created the Focus App Using React and Rust</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用React和Rust创建Focus应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-i-created-the-focus-app-using-react-and-rust-fd8fd072d1a7?source=collection_archive---------2-----------------------#2022-06-06">https://betterprogramming.pub/how-i-created-the-focus-app-using-react-and-rust-fd8fd072d1a7?source=collection_archive---------2-----------------------#2022-06-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e1cb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在本文中，我将描述我创建一个小型桌面应用程序的步骤，以帮助我专注于日常任务。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/58b71d9d5c3bcadcebe6c01f74818e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tfQndSvV0H2iXmmKmS6eXw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">焦点弹出窗口的预览</p></figure><h1 id="899b" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">焦点问题</h1><p id="75f0" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我的目标之一是创建一个终极的时间管理工具来解决我所有的效率问题，但是现在让我们从一个小问题开始。当我在做一个任务时，我经常会被其他应该完成的任务打断(一个新任务被分配给我，我记得我应该做的一些事情，…)，大多数时候，新任务不是那么紧急，可以等到我完成当前的任务。但这让我分心，有时我发现自己优先考虑它而不是当前的任务，只是为了不忘记它。然后恢复原来的任务变得很困难，因为我失去了注意力。为了解决这个问题，我需要一种方法来快速记录弹出的中断任务，并在完成当前任务之前忘记它们。</p><h1 id="95df" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">应用程序的想法</h1><ul class=""><li id="4ae3" class="mj mk iq lp b lq lr lt lu lw ml ma mm me mn mi mo mp mq mr bi translated">我正在做一些事情…一个打断我的想法/任务出现了。</li><li id="db37" class="mj mk iq lp b lq ms lt mt lw mu ma mv me mw mi mo mp mq mr bi translated">我点击了键盘上的自定义快捷键，然后一个文本输入出现在屏幕中央。</li><li id="97e6" class="mj mk iq lp b lq ms lt mt lw mu ma mv me mw mi mo mp mq mr bi translated">我键入打断想法/任务的快速描述，按enter键，文本输入消失。</li><li id="91d3" class="mj mk iq lp b lq ms lt mt lw mu ma mv me mw mi mo mp mq mr bi translated">我正常继续工作。…</li><li id="c5d6" class="mj mk iq lp b lq ms lt mt lw mu ma mv me mw mi mo mp mq mr bi translated">当我完成时，我打开一个预定义的文件，发现我输入的所有想法/任务都写在里面。</li></ul><h1 id="98cf" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">设置项目</h1><p id="299e" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我在这里试图构建的是一个桌面应用程序，但是我想使用web技术(至少对于UI来说)。最流行的工具是<a class="ae mx" href="https://www.electronjs.org" rel="noopener ugc nofollow" target="_blank">电子</a>，但我最近开始学习Rust和<a class="ae mx" href="https://tauri.studio/" rel="noopener ugc nofollow" target="_blank"> Tauri </a>似乎是一个很好的尝试工具。因此，我将使用它与反应的前端和造型的顺风。</p><p id="e50a" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">我按照Tauri的先决条件页面上的说明在我的系统上安装Rust和Node，然后我运行T0来创建这个项目。我将项目命名为<code class="fe nd ne nf ng b">focus</code>，并为UI选择了<code class="fe nd ne nf ng b">create-vite</code> receipe，并同意安装<code class="fe nd ne nf ng b">@tauri-apps/api</code>。然后选择了<code class="fe nd ne nf ng b">create-vite</code>的<code class="fe nd ne nf ng b">react-ts</code>模板:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/847fd608844890501007c16e3094c154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*VzvWB4AK9p3pbc_r.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建项目</p></figure><p id="9770" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">Tauri创建了项目并安装了依赖项。让我们来看看文件的结构:</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="a45a" class="nm kw iq ng b gy nn no l np nq">src/<br/>  main.tsx  &lt;- entry point of JS/TS<br/>  ... other UI files here<br/>src-tauri/<br/>  icons/           &lt;- icons of different sizes<br/>  src/<br/>    main.rs        &lt;- entry point for the application<br/>  target/          &lt;- the compiled and bundles files<br/>  Cargo.toml       &lt;- like package.json for Rust<br/>  Cargo.lock       &lt;- like yarn.lock<br/>  tauri.conf.json  &lt;- config file for Tauri<br/>index.html         &lt;- entry point of the UI<br/>package.json<br/>yarn.lock<br/>tsconfig.json<br/>vite.config.ts     &lt;- config file for Vite</span></pre><p id="8c1a" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">现在运行<code class="fe nd ne nf ng b">yarn tauri dev</code>应该会启动应用程序。这将需要一些时间，因为Rust第一次编译代码，接下来的执行会很快。</p><p id="8777" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">设置的最后一步是给项目添加顺风，我是按照官方文件<a class="ae mx" href="https://tailwindcss.com/docs/guides/vite" rel="noopener ugc nofollow" target="_blank">做的</a></p><h1 id="58a6" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">创建用户界面</h1><p id="3e2a" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">对于UI，我需要的只是一个文本输入，我将在其中键入任务，然后按Enter保存它。所以我将<code class="fe nd ne nf ng b">App</code>组件代码改为如下:</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="b28c" class="nm kw iq ng b gy nn no l np nq">function App() {<br/>  return &lt;input<br/>    type="text"<br/>    className="w-[800px] h-[80px] bg-[#222] text-2xl text-white px-6"<br/>  /&gt;<br/>}</span></pre><p id="e918" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">请注意，我使用Tailwind的<a class="ae mx" href="https://tailwindcss.com/docs/adding-custom-styles#using-arbitrary-values" rel="noopener ugc nofollow" target="_blank">任意值</a>语法来获得深灰色<code class="fe nd ne nf ng b">800px/80px</code>输入。</p><p id="e7d7" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">当我在这个输入中键入一些文本，然后点击<code class="fe nd ne nf ng b">Enter</code>，我希望这些文本被附加到某个文件中。让我们从保存一个状态中的文本并在按下<code class="fe nd ne nf ng b">Enter</code>时记录它开始:</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="cf5a" class="nm kw iq ng b gy nn no l np nq">function App() {<br/>  const [content, setContent] = React.useState('')<br/>  return (<br/>    &lt;input<br/>      type="text"<br/>      value={content}<br/>      onChange={e =&gt; setContent(e.target.value)}<br/>      onKeyDown={e =&gt; e.key === 'Enter' &amp;&amp; console.log(content)}<br/>      className="w-[800px] h-[80px] bg-[#222] text-2xl text-white px-6"<br/>    /&gt;<br/>  )<br/>}</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/910062e2386e32faa04a64dc1de9562f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*lWNCXYaYV4HXOHyC.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在控制台上显示输入值</p></figure><h1 id="6fb8" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">从前端调用Rust函数</h1><p id="c9ca" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">下一步是编写一个Rust函数，它将接收输入内容并将其附加到一个文件中。在阅读了从前端文档页面调用Rust的<a class="ae mx" href="https://tauri.studio/v1/guides/features/command/" rel="noopener ugc nofollow" target="_blank">后，我将<code class="fe nd ne nf ng b">src-tauri/src/main.rs</code>改为如下:</a></p><p id="d5dd" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">警告:我是Rust新手，所以我可能在这段代码中做错了很多事情</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="301b" class="nm kw iq ng b gy nn no l np nq">#![cfg_attr(<br/>  all(not(debug_assertions), target_os = "windows"),<br/>  windows_subsystem = "windows"<br/>)]</span><span id="5a68" class="nm kw iq ng b gy nr no l np nq">use std::fs::OpenOptions;<br/>use std::io::prelude::*;</span><span id="4ec0" class="nm kw iq ng b gy nr no l np nq">#[tauri::command]<br/>fn add_task(content: String) {<br/>  let mut file = OpenOptions::new()<br/>    .create(true)<br/>    .append(true)<br/>    .open("../tasks.txt")<br/>    .expect("Error while opening the tasks file");<br/>  writeln!(file, "{}", content).expect("Error while writing in the tasks file");<br/>}</span><span id="92b9" class="nm kw iq ng b gy nr no l np nq">fn main() {<br/>  tauri::Builder::default()<br/>    .invoke_handler(tauri::generate_handler![add_task])<br/>    .run(tauri::generate_context!())<br/>    .expect("error while running tauri application");<br/>}</span></pre><p id="3f28" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">然后我修改了<code class="fe nd ne nf ng b">App</code>组件，以便在按下<code class="fe nd ne nf ng b">Enter</code>时调用该函数:</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="74d7" class="nm kw iq ng b gy nn no l np nq">function App() {<br/>  const [content, setContent] = React.useState('')<br/>  const handleKeyDown = async (e: React.KeyboardEvent) =&gt; {<br/>    if (e.key === 'Enter') {<br/>      await invoke('add_task', { content })<br/>    }<br/>  }<br/>  return (<br/>    &lt;input<br/>      type="text"<br/>      value={content}<br/>      onChange={e =&gt; setContent(e.target.value)}<br/>      onKeyDown={handleKeyDown}<br/>      className="w-[800px] h-[80px] bg-[#222] text-2xl text-white px-6"<br/>    /&gt;<br/>  )<br/>}</span></pre><p id="e43b" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">现在，当输入一些文本并点击<code class="fe nd ne nf ng b">Enter</code>时，输入的文本被添加到<code class="fe nd ne nf ng b">tasks.txt</code>文件中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/c4871c83c8b0e160b6fd2031bd92e4df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*tW42gEQFEUx8-u0b.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将键入的文本添加到文件中</p></figure><h1 id="2bfd" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">自定义任务文件路径</h1><p id="9109" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">注意，这个文件是在项目的根目录下创建的，而Rust代码中的路径是<code class="fe nd ne nf ng b">../tasks.txt</code>，这是因为app是在<code class="fe nd ne nf ng b">src-tauri</code>目录下执行的，所以任何相对路径都是相对于那个目录的。最好使用绝对路径，让用户自己定义。我能想到的定义它的最简单的方法是通过一个环境变量，让我们称它为<code class="fe nd ne nf ng b">FOCUS_TASKS_PATH</code>。</p><p id="7108" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">所以我将这个变量添加到我的<code class="fe nd ne nf ng b">.zshrc</code>中，然后更新Rust代码:</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="e7ae" class="nm kw iq ng b gy nn no l np nq">// ...<br/>use std::env;</span><span id="b7ff" class="nm kw iq ng b gy nr no l np nq">#[tauri::command]<br/>fn add_task(content: String) {<br/>  let path = env::var("FOCUS_TASKS_PATH") // read the env var<br/>    .expect("The 'FOCUS_TASKS_PATH' env variable was not found!"); <br/>  let mut file = OpenOptions::new()<br/>    .create(true)<br/>    .append(true)<br/>    .open(path)                           // &lt;- use it here<br/>    .expect("Error while opening the tasks file");<br/>  writeln!(file, "{}", content).expect("Error while writing in the tasks file")<br/>}</span></pre><h1 id="68f7" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">自定义窗口</h1><p id="d815" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">最初的想法是有一个弹出窗口，类似于macOS上的Spotlight，但我们现在有一个浏览器窗口！幸运的是，Tauri允许我们使用<code class="fe nd ne nf ng b">src-tauri/tauri.conf.json</code>文件来调整窗口。初始窗口配置为:</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="22f4" class="nm kw iq ng b gy nn no l np nq">{<br/>  "fullscreen": false,<br/>  "height": 600,<br/>  "resizable": true,<br/>  "title": "Focus",<br/>  "width": 800<br/>}</span></pre><p id="da6c" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">我把它换成了</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="07eb" class="nm kw iq ng b gy nn no l np nq">{<br/>  "fullscreen": false,<br/>  "width": 800,         // the width of the input<br/>  "height": 80,         // the height of the input<br/>  "title": "Focus",<br/>  "resizable": false,<br/>  "center": true,         // position it in the center of the screen<br/>  "decorations": false    // remove the title bar<br/>}</span></pre><p id="ce5d" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">结果看起来不错:)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/af5ca37d7f9e43ed52afbe4f33c27a77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*i_kylmVy9_heAGyb.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">弹出窗口的预览</p></figure><h1 id="85ff" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">添加任务后关闭应用程序</h1><p id="2fb7" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">现在我希望当我点击<code class="fe nd ne nf ng b">Enter</code>时弹出窗口消失，所以让我们在我们的<code class="fe nd ne nf ng b">App</code>组件中添加一个<code class="fe nd ne nf ng b">process.exit()</code>(这也可以添加到<code class="fe nd ne nf ng b">add_task</code> Rust函数中)。</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="72ad" class="nm kw iq ng b gy nn no l np nq">import { process } from '<a class="ae mx" href="http://twitter.com/tauri" rel="noopener ugc nofollow" target="_blank">@tauri</a>-apps/api'</span><span id="491f" class="nm kw iq ng b gy nr no l np nq">function App() {<br/>  const [content, setContent] = React.useState('')<br/>  const handleKeyDown = async (e: React.KeyboardEvent) =&gt; {<br/>    if (e.key === 'Enter') {<br/>      await invoke('add_task', { content })<br/>      process.exit()<br/>    }<br/>  }<br/>  //...<br/>}</span></pre><p id="ce80" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">现在当按下<code class="fe nd ne nf ng b">Enter</code>时弹出窗口关闭:)</p><h1 id="30c9" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">编译、安装和使用应用程序</h1><p id="d9df" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我想我们现在已经准备好了应用程序的alpha版本，让我们来构建它</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="47bb" class="nm kw iq ng b gy nn no l np nq">yarn tauri build</span></pre><p id="2e6e" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">首先，命令失败，并显示以下消息</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="60ce" class="nm kw iq ng b gy nn no l np nq">Error You must change the bundle identifier in `tauri.conf.json &gt; tauri &gt; bundle &gt; identifier`. The default value `com.tauri.dev` is not allowed as it must be unique across applications.</span></pre><p id="2160" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">将标识符设置为<code class="fe nd ne nf ng b">dev.webneat.focus</code>解决了这个问题。</p><p id="e798" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">编译花了一段时间，然后我生成了以下文件(我用的是Ubuntu):</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="d7f9" class="nm kw iq ng b gy nn no l np nq">src-tauri/target/release/bundle/<br/>  deb/focus_0.1.0_amd64.deb<br/>  appimage/focus_0.1.0_amd64.AppImage</span></pre><p id="f53b" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">由于AppImage更容易使用(不需要安装)，我只是将它移到我的<code class="fe nd ne nf ng b">bin</code>目录中，并将其命名为<code class="fe nd ne nf ng b">focus</code>:</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="55e7" class="nm kw iq ng b gy nn no l np nq">sudo mv src-tauri/target/release/bundle/appimage/focus_0.1.0_amd64.AppImage /usr/bin/focus</span></pre><p id="024a" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">现在，在终端上运行命令focus将打开弹出:D</p><p id="b4cf" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">在Ubuntu上，我可以在键盘设置上设置一个新的自定义快捷键。现在，当我点击任何地方的快捷方式时，弹出窗口就会出现，我输入我想输入的内容，然后点击<code class="fe nd ne nf ng b">Enter</code>，然后继续我正在做的事情。</p><p id="c700" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">看看我在这个项目上工作的下一部分，在那里我通过把它添加到系统托盘来使应用程序打开得更快。</p><p id="2b4c" class="pw-post-body-paragraph ln lo iq lp b lq my jr ls lt mz ju lv lw na ly lz ma nb mc md me nc mg mh mi ij bi translated">点击此处查看仓库:</p><div class="ns nt gp gr nu nv"><a href="https://github.com/webNeat/focus" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd ir gy z fp oa fr fs ob fu fw ip bi translated">GitHub - webNeat/focus</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">github.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj kp nv"/></div></div></a></div></div></div>    
</body>
</html>