<html>
<head>
<title>NumPy in Swift?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">斯威夫特的NumPy？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/numpy-in-swift-fef63282443?source=collection_archive---------12-----------------------#2020-11-12">https://betterprogramming.pub/numpy-in-swift-fef63282443?source=collection_archive---------12-----------------------#2020-11-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9f27" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Swift Accelerate和simd简介</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/30fe90a694598f08f66b7666c0df2e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IWKTDXElpzLDMMnFLdn4Zw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯·利维拉尼在<a class="ae ky" href="https://unsplash.com/s/photos/data-science?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="21fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当使用像Python这样的语言进行任何种类的数值计算或ML时，对于这个问题有许多简单的答案<em class="lv">我应该使用哪个库？</em>许多人会说<em class="lv"> NumPy，</em>而<em class="lv"> </em>其他人可能会说<em class="lv"> PyTorch </em>是因为它的GPU能力——但是对于Python有很多显而易见的答案。</p><p id="6ff5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们转到Swift。你马上想到什么库是和Swift配对的好选择？如果你不得不停顿下来，什么也想不出来，那么你就处于我第一次被提出这个问题时的状态。</p><p id="6a3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅仅使用数组和列表并不是一个好的解决方案，因为虽然数组是高效的结构，但是您需要构建各种各样的方法来进行乘法、加法、数值计算以及几乎所有其他的事情。因此，很明显，这不是一个完美的解决方案——我们应该使用什么呢？</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f20e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">输入加速和SIMD</h1><p id="ace2" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果你从未听说过这些库，你可能不会孤单，所以让我们从这两个库是什么开始。</p><p id="8943" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://developer.apple.com/documentation/accelerate" rel="noopener ugc nofollow" target="_blank"> Accelerate </a>库被苹果描述为进行“大规模数学计算和图像计算，针对高性能和低能耗进行了优化”——太棒了！我将记下Accelerate中的几个关键库以及一些密切相关的库(包括simd)。</p><h2 id="354c" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated"><strong class="ak">内加速</strong></h2><ul class=""><li id="1eb7" class="nm nn it lb b lc mv lf mw li no lm np lq nq lu nr ns nt nu bi translated"><a class="ae ky" href="https://developer.apple.com/documentation/accelerate/bnns" rel="noopener ugc nofollow" target="_blank"> BNNS </a>用于神经网络的构建和训练</li><li id="36b7" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><a class="ae ky" href="https://developer.apple.com/documentation/accelerate/vimage" rel="noopener ugc nofollow" target="_blank"> vImage </a>包括许多图像处理功能，用于插值、转换和操作</li><li id="5a20" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">vDSP 用于数字信号处理</li><li id="ab73" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><a class="ae ky" href="https://developer.apple.com/documentation/accelerate/veclib/vforce" rel="noopener ugc nofollow" target="_blank"> vForce </a>用于对矢量执行功能</li><li id="e5a5" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><a class="ae ky" href="https://developer.apple.com/documentation/accelerate/sparse_solvers" rel="noopener ugc nofollow" target="_blank">稀疏解算器</a>对稀疏(和密集)矩阵执行线性代数运算</li></ul><p id="c65a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那是一吨！许多人不知道Swift可以执行这些领域内的任务，但苹果已经为所有这些领域创建了第一方库。</p><h2 id="c52f" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated"><strong class="ak">外部加速</strong></h2><p id="9db7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">有几个相关的库，但是我主要关注的是<a class="ae ky" href="https://developer.apple.com/documentation/accelerate/simd" rel="noopener ugc nofollow" target="_blank"> simd </a>。苹果将simd库定义为“一个对小向量和矩阵进行计算的模块。”</p><p id="701f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你认为这听起来非常类似于小向量和矩阵的NumPy，那你就完全正确了。当我不得不在Swift中编写一些算法和数据处理代码时，我最终使用的库是simd，它完全符合我的所有需求。</p><p id="7154" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">simd也不仅仅是iOS或Swift特有的东西— <em class="lv"> simd </em>代表<em class="lv">单指令、多数据。</em>这是一种有效的硬件优化，允许我们一次执行多个操作。这使我们能够在数组或其他数据类型上获得比普通计算更大的性能提升。</p><p id="a408" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看几个将simd用于向量和矩阵数学的例子。</p><h2 id="cbd9" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">SIMD向量示例</h2><p id="145c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">让我们看一个制作向量并对其执行一些基本操作的基本例子。</p><p id="54a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个基本3D矢量的实例:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="ea2f" class="na me it ob b gy of og l oh oi">let vector = SIMD3&lt;Double&gt;(0, 0, 0)</span></pre><p id="8232" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们正在制作一个3D向量，这就是为什么我们在<code class="fe oj ok ol ob b">SIMD3</code>中写了<code class="fe oj ok ol ob b">3</code>，并且类型是double(因此有了<code class="fe oj ok ol ob b">&lt;Double&gt;</code>)。</p><p id="9107" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以进行基本的标量运算和基本的向量乘法，如下所示:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="a4c1" class="na me it ob b gy of og l oh oi">let xz = SIMD3&lt;Double&gt;(1, 0, 1)<br/>let scaled = unit * 5<br/>let xy = SIMD3&lt;Double&gt;(1, 1, 0)<br/>let newVector = scaled * xy</span></pre><p id="481a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，我们可以用常数标量乘向量，也可以用向量乘向量。</p><p id="a5df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以利用库从向量中提取信息。例如，要获得向量的大小，您可以编写以下内容:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="b619" class="na me it ob b gy of og l oh oi">let vector = SIMD3&lt;Double&gt;(5, 6.5, 9.7)<br/>let mag = simd_length(vector)</span></pre><p id="b7b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，<code class="fe oj ok ol ob b">mag</code>是矢量的大小。</p><p id="1452" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可能有一些函数可以满足你对向量的大部分需求——例如，取绝对值、最高位的函数，以及许多其他内置的函数。</p><h2 id="0906" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">simd矩阵示例</h2><p id="3e53" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">与所有向量示例类似，您也可以在simd中用矩阵完成基本上所有您想要的事情。</p><p id="c156" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们先演练初始化一个矩阵。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="50b6" class="na me it ob b gy of og l oh oi">let matrix = simd_double3x3(5)</span></pre><p id="245f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的例子创建了一个<code class="fe oj ok ol ob b">3x3</code>矩阵，所有值都被初始化为<code class="fe oj ok ol ob b">5</code>。有几种不同的方法来实例化一个矩阵，包括传入一个标量，什么都不传入(所有的零都放在矩阵中)，或者传入每一列的向量。</p><p id="47f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始执行一些不同的矩阵运算。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="95fe" class="na me it ob b gy of og l oh oi">let matrix = simd_double3x3(5)<br/>let vector = SIMD3&lt;Double&gt;(1, 2, 3)<br/>let result = vector * matrix</span></pre><p id="ea95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们将向量(一个<code class="fe oj ok ol ob b">1x3</code>矩阵)乘以矩阵(<code class="fe oj ok ol ob b">3x3</code>)。</p><p id="7ea7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以获得矩阵的逆矩阵，如下所示:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="0c04" class="na me it ob b gy of og l oh oi">let matrix = simd_double3x3(1)<br/>let inverse = matrix.inverse</span></pre><p id="2249" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以使用内置函数获得矩阵的转置:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="b1f9" class="na me it ob b gy of og l oh oi">let matrix = simd_double3x3(5)<br/>let transpose = simd_transpose(matrix)</span></pre><p id="a89f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，我认为simd中缺少的一个主要东西是矩阵旋转的内置函数，但苹果公司提供了一个很好的起点。</p><h2 id="28df" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">simd四元数</h2><p id="ff7b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我知道你们大多数人可能没有用过四元数(我知道我直到最近才用过！)，但是除了矩阵和向量库之外，simd还提供了一个真正全面的四元数库。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="2c74" class="na me it ob b gy of og l oh oi">let quat = simd_quatd(ix: 1, iy: 1, iz: 1, r: 0.5)</span></pre><p id="0e21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的例子中，我们制作了一个简单的double类型的四元数(为了使它成为浮点数，我们将使用<code class="fe oj ok ol ob b">simd_quatf</code>)。我们可以用这个四元数来实例化一个矩阵，如下所示:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="6bc8" class="na me it ob b gy of og l oh oi">let matrix = simd_double3x3(quat)</span></pre><p id="d25a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于各种各样的物理和计算机图形应用程序来说，还有许多其他的功能<a class="ae ky" href="https://developer.apple.com/documentation/accelerate/working_with_quaternions" rel="noopener ugc nofollow" target="_blank">在这里</a>。</p><p id="b365" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这些例子和这些库的介绍有助于改进您的Swift代码。编码快乐！</p></div></div>    
</body>
</html>