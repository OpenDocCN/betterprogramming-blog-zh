# 如何清洁你的插座

> 原文：<https://betterprogramming.pub/how-i-cleaned-my-sockets-108503649bb3>

## 使用路由和控制器清理和简化您在 [socket.io](https://socket.io/) 中的套接字

![](img/56b7abfaffa5fe1a1bcb9761e9cafa0c.png)

物理网络套接字

对于那些认为这将是清洁物理插座以插入东西的人来说，我很抱歉地告诉你们事实并非如此。相反，我将告诉你我如何清理我用 [socket.io](https://socket.io/) 编写的套接字，这是一个非常流行的库，用于开发客户机和服务器之间的实时套接字连接。在我们冒险探究我做了什么之前，让我们看看路由通常是如何用 [express](https://expressjs.com/) 编写的，这是另一个用于编写强大 http 服务器的流行框架。

# 路线和控制器

如果您是一名 web 开发人员，您可能非常喜欢 MVC 架构，以及我们如何掌握它在 web 应用程序开发中的使用。对于那些不熟悉的人来说， **MVC** 代表模型-视图-控制器，而**架构**在本文中指的是我们的应用程序的结构。

*   **模型** —应用程序的一部分，处理应用程序特定数据的管理(长期和短期)。
*   **视图** —用户与之交互的应用程序的一部分，可以看到，允许用户导航并与我们的服务交互。
*   **控制器**—**视图**作为中间人与**模型通信的应用程序部分，**调解用户和我们的数据库之间的交互。

正如你所看到的，这个系统描述了三个不同的类别，我们可以将我们的代码分类。但是，我们可以进一步分解控制器，对每个组件进行更细粒度的定义。

**控制器故障**

*   **控制器**——控制器的一部分，实际处理我们的应用程序的逻辑。
*   **路线**——控制器的一部分，将我们的逻辑映射到用户试图与之交互的路线。

当仅仅作为想法呈现时，这其中的许多是高度抽象的，所以让我们看一下我的应用程序的一部分来演示这种分解:

我们的控制器

这里，我们设置了路由器，将我们的**路由**映射到我们的**控制器**。

我们的路线

在前面的两段代码中，我们有两个控制器，用于处理来自服务器的 50 条消息和一条消息的检索。

如您所见，这种粒度级别允许我们创建更加模块化的应用程序，并真正将组件的功能隔离到它们应该做的事情上。然而，我的代码库的其他部分没有利用这种类型的约定，而这种约定正是我一直缺少的。

# 套接字和套接字处理程序

在深入研究我的代码之前，先回顾一下， **socket.io** 是一个提供网络套接字的库，这些套接字允许我们在客户机和服务器之间建立实时连接。现在让我们以我最初的 socket 实现为例，尝试找出可以改进的地方。

我最初的套接字实现

除了代码中的大分组和所有控制台日志之外，您还能在这部分代码中发现什么问题？如果我们遵循我们之前定义的控制器分解范例——我们应该是**,因为作为程序员我们努力保持一致性——我们不会在这段代码中明确地将套接字作为**路由**和**控制器**来处理。**

**让我们孤立地看一下其中一个插座:**

**断开功能**

**我们有这个名为 *socket* 的 socket 对象，我们告诉它在发生 *disconnect* 事件时*，我们希望它执行我们指定的代码。这几乎**完全**像我们的 express 控制器是如何定义和工作的。***

**我们为 socket 对象提供了一个*端点*，它将被*映射* 到一个函数，当客户端试图与之交互时，该函数将会起作用。考虑到所有这些，我们如何在保持简单性的同时，真正地分解我们的套接字以提高可读性呢？**

****让我们为我们应该如何做创造一些步骤**:**

1.  **创建另一个文件来存放我们的“控件/控制器”**
2.  **将**路线**和**控制器**分解成各自的部件。**
3.  **…利润…**
4.  **当我们绘制路线时，巧妙地传递每个控制器将需要的任何依赖关系。**

**这些步骤看起来像什么？好吧，让我们看看！**

**如你所见，我们现在得到了两个新文件，这两个文件由它们所关注的内容分开。这不仅使我们具有更好的可读性，而且现在处理路线的函数只允许访问它们已经通过我们定义路线的地方传递的数据，这使我们能够对我们的应用程序进行更全面的控制，并更好地理解每个单独的组件应该做什么。**

# **包扎**

**虽然我们生活在一个总是试图尽可能向前推进的世界，但有时我们最好后退一步，评估我们过去的步骤，以学习和改进我们未来的步骤。我最初对这些套接字的实现非常草率，但是如果我没有回头来看它们，我就永远不会有机会改进我的代码，并发现一种新的方式来思考我为未来的实现编写套接字的方式。**

# **资源**

*   **[这一块的所有代码都可以在这里找到](https://github.com/C3NZ/xenochat)**