<html>
<head>
<title>Theming React With CSS variables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">主题与CSS变量反应</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/theming-react-with-css-variables-bb9efd5f1918?source=collection_archive---------1-----------------------#2019-07-01">https://betterprogramming.pub/theming-react-with-css-variables-bb9efd5f1918?source=collection_archive---------1-----------------------#2019-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d25d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用CSS自定义属性和钩子来主题化React应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/58a9ee5d1da5d61ea2d312dcc910eeef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PU20rbKCMm3C2BLEM24dgg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约翰·施诺布里奇在<a class="ae ky" href="https://unsplash.com/search/photos/computer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="e99d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能认为你需要使用像JS中的CSS这样的库，或者像<a class="ae ky" href="https://postcss.org/" rel="noopener ugc nofollow" target="_blank"> PostCSS </a>或<a class="ae ky" href="https://sass-lang.com/" rel="noopener ugc nofollow" target="_blank"> SASS </a>这样的后处理器来为你的应用程序设置主题。感谢CSS变量，你没有！</p><p id="1152" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CSS变量在除IE 11之外的所有主流浏览器中都受<a class="ae ky" href="https://caniuse.com/css-variables" rel="noopener ugc nofollow" target="_blank">支持</a>。如果你需要支持IE 11，你不应该在没有退路的情况下使用它们。在这种情况下，我建议使用<a class="ae ky" href="https://github.com/postcss/postcss-custom-properties" rel="noopener ugc nofollow" target="_blank"> PostCSS自定义属性</a>，或者JS库中的CSS，如<a class="ae ky" href="https://www.styled-components.com/" rel="noopener ugc nofollow" target="_blank"> styled-components </a>或<a class="ae ky" href="http://emotion.sh" rel="noopener ugc nofollow" target="_blank"> emotion </a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1e71" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">入门指南</h1><p id="0e24" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">一如既往，先从<code class="fe mz na nb nc b">create-react-app</code>说起。我们可以如下引导我们的新应用程序:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="af2f" class="nh md it nc b gy ni nj l nk nl">npx create-react-app css-theming</span></pre><p id="d6bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个演示，我们不需要安装任何其他依赖项。<code class="fe mz na nb nc b">React</code>、<code class="fe mz na nb nc b">react-dom</code>、<code class="fe mz na nb nc b">react-scripts</code>就够了。</p><p id="3e15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您最喜欢的编辑器中打开新应用程序。</p><p id="945f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从在<code class="fe mz na nb nc b">App.css</code>中声明一些CSS变量开始。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="5b1c" class="nh md it nc b gy ni nj l nk nl">:root {<br/>  --color-surface: white;<br/>  --color-solid: black;<br/>  --color-primary: teal;<br/>}</span></pre><p id="1e0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们为我们的应用程序创建一些基本样式。注意我们是如何使用语法<code class="fe mz na nb nc b">var(--variable-name)</code>消费变量的。如果您习惯于使用<a class="ae ky" href="https://github.com/postcss/postcss-custom-properties" rel="noopener ugc nofollow" target="_blank"> PostCSS自定义属性</a>，您应该对此很熟悉。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="0cd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们修改我们的<code class="fe mz na nb nc b">App.js</code>来包含我们的按钮。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="79ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们准备使用JavaScript来修改我们的自定义属性。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="99a1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用JavaScript修改自定义属性</h1><p id="bad2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">修改自定义属性的语法非常简单。</p><h2 id="e044" class="nh md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">获取变量值</h2><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="b02c" class="nh md it nc b gy ni nj l nk nl">window<br/>  .getComputedStyle(document.documentElement)<br/>  .getPropertyValue("--color-surface");</span></pre><h2 id="2bf4" class="nh md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">设置变量值</h2><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="fc38" class="nh md it nc b gy ni nj l nk nl">document<br/>  .documentElement.style.setProperty("--color-surface", "black");</span></pre><p id="d971" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们知道了如何使用JavaScript操作CSS变量，让我们在应用程序中尝试一下吧！</p><p id="563a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先创建两个包含主题属性名称和值的JavaScript对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="6df0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们使用<code class="fe mz na nb nc b">useState</code>修改应用程序的渲染功能来切换其主题。我们跟踪当前的主题，并在<code class="fe mz na nb nc b">onClick</code>处理程序中更新它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="f393" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们创建一个函数来更新我们的CSS变量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="d34d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个函数中，我们使用JavaScript来更新我们的CSS自定义属性，以匹配相应的主题对象的值。</p><p id="3d07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们在按钮的<code class="fe mz na nb nc b">onClick</code>处理程序中添加了对<code class="fe mz na nb nc b">applyTheme</code>函数的调用。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="d639" class="nh md it nc b gy ni nj l nk nl">const onClick = () =&gt; {<br/>  const nextTheme = currentTheme === "light" ? "dark" : "light";<br/>  setTheme(nextTheme);<br/>  applyTheme(nextTheme);<br/>};</span></pre><p id="3ad9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们已经创建了一个可以使用JavaScript配置的主题。让我们看看它的实际效果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/1cf078998d60e02d9c209cd7f2e0409b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yhuPpiB2UlfbxfihsliQbA.gif"/></div></div></figure><p id="ebf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我可能不会因为这个设计获得任何奖项，但至少它像预期的那样工作。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="16cf" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">添加测试</h1><p id="f09a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">作为开发人员，我们的工作还没有完成，直到我们添加了足够的测试覆盖率。让我们开始用<code class="fe mz na nb nc b"><a class="ae ky" href="https://github.com/testing-library/react-testing-library" rel="noopener ugc nofollow" target="_blank">testing-library</a></code>编写一些基本的测试。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="ea65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们测试当应用程序启动时，它默认为light主题，并在文档中显示文本“light theme”。</p><p id="c32a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们点击按钮来切换主题，并测试以确保我们的应用程序中的文本更新。</p><p id="42ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然这些测试很好，并且提供了一些价值，但是它们不能确保我们的CSS变量已经改变。</p><p id="da29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了测试这一点，让我们模拟一个我们用来设置CSS变量的方法。</p><p id="a791" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用函数<code class="fe mz na nb nc b">document.documentElement.style.setProperty</code>并用一个<code class="fe mz na nb nc b">jest.fn()</code>模拟代替它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="ac60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们测试以确保它被调用了三次。我们还进行了测试，以确保它是用我们的第一个CSS变量调用的。现在我们知道，当用户点击我们的<em class="oa">切换主题</em>按钮时，我们的应用程序将正确设置自定义属性。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2cf2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="215c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们能够在几分钟内设置好主题，无需添加任何额外的依赖项，也无需更改我们的构建设置。</p><p id="021d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在整个CSS中使用这些变量，我们的React组件不需要知道它们。</p><p id="12a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们能够设置一些测试，让我们对应用程序的功能充满信心。</p><p id="00ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查<a class="ae ky" href="https://codesandbox.io/s/css-theming-pn0to" rel="noopener ugc nofollow" target="_blank">代码沙箱</a>上的代码，查看它的运行情况。</p><div class="ob oc gp gr od oe"><a href="https://codesandbox.io/s/css-theming-pn0to" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">CSS-主题化-代码沙盒</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">这个项目是用[Create React App](https://github . com/Facebook/Create-React-App)引导的。</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">codesandbox.io</p></div></div><div class="on l"><div class="oo l op oq or on os ks oe"/></div></div></a></div><p id="f2ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>