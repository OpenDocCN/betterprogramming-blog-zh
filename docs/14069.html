<html>
<head>
<title>How To Seamlessly Support Web3 Connectivity Options in React.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何无缝支持React.js中的Web3连接选项</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-seamlessly-support-web3-connectivity-options-in-react-js-fd461cc44550?source=collection_archive---------9-----------------------#2022-11-01">https://betterprogramming.pub/how-to-seamlessly-support-web3-connectivity-options-in-react-js-fd461cc44550?source=collection_archive---------9-----------------------#2022-11-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b1fe" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">dApps的钱包互操作性</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/765c75bfd1aa67aa77a13c5ee284db75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2WRMkw3coWHJQ7FJaJrI3w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">提供无缝选择来吸引用户并连接任何web3钱包。图片由Freepik上的<a class="ae kv" href="https://www.freepik.com/free-vector/padlock-polygonal-wireframe-mesh-looks-dark-blue-background-cyber-security-safe-privacy-other-concept-vector-illustration_24058557.htm" rel="noopener ugc nofollow" target="_blank"> WangXiNa </a>提供。</p></figure><p id="3f55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于分散式应用程序(即dApps)的用户界面(UI)创建者来说，一个持续的挑战是连接用户的钱包以读取所有权状态并与其底层的智能合约进行交易。在分散安全的世界中，用户的钱包是用户选择的关键，它一直是一个持续的UI和安全挑战。钱包连接要求是采用web3技术的一个明显障碍。</p><p id="b614" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">支撑核心问题的是dApp需要用户连接钱包。此外，如果UI在不需要钱包连接的只读模式下可以提供信息和直观，那么强烈建议默认支持这种模式。这个小故事描述了<a class="ae kv" href="https://immutablesoft.org/" rel="noopener ugc nofollow" target="_blank"> ImmutableSoft </a>将更多钱包选择整合到他们的dApp中的过程。</p><p id="2445" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank"> MetaMask </a>通过服务器API检测并请求钱包连接，启动了与web3连接的钱包体验。现在<a class="ae kv" href="https://walletconnect.com/" rel="noopener ugc nofollow" target="_blank"> WalletConnect </a>技术在新钱包中开始流行，越来越多的用户提出要求。WalletConnect与MetaMask的核心区别在于wallet如何连接到底层区块链以及如何建立这种连接。</p><p id="190f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">MetaMask是一款集区块链网络提供商和钱包于一体的浏览器插件。该插件持有你的钱包的密钥，并通过配置的区块链网络提供商(默认Infura节点)使用它们。</p><p id="231a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">私有钱包密钥保存在浏览器插件和服务器UI (ReactJS等)中。)可以直接请求连接到这个钱包。WalletConnect根本不是一个插件，而是一个网络管道。如果web3 dApp需要钱包连接，则必须生成一次性管道(即伪装成QR码的URI链接)并显示在UI上。</p><p id="bc99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该QR码(即，一次性URI)是对安装在用户移动电话上的钱包应用程序的连接请求，并由该钱包应用程序扫描。</p><p id="d594" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">WalletConnect还可以连接到Ledger设备等桌面钱包。用户请求与您的钱包应用程序(LedgerLive等)建立本地网络连接。)而不是二维码。WalletConnect将钱包密钥从可能更易受攻击的网络浏览器(插件)中取出，并直接交给钱包应用程序，从而允许任何数量的安全创新和用户选择。</p><p id="c3b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着MetaMask和WalletConnect成为web3钱包集成的领导者，本文将探讨在需要连接到用户的web3钱包时，如何轻松直观地支持这两种技术。我们还探讨了如何确保您的dApp在只读模式下正常工作，同时鼓励用户在进行某些操作之前连接他们的钱包，例如在交易之前。</p><p id="3d2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通常一个dApp在第一次打开时会显示连接选项，比如两个按钮，“用MetaMask打开”和“用WalletConnect打开”。然而，这让那些不熟悉web3或不愿意分享钱包的人感到困惑或疏远。这篇文章提出了建立连接优先级的解决方案，并默认了什么是可用的以及何时提供连接选项。每个dApp都有不同的需求，第一步是确定这些需求——也许两个按钮是最好的选择，但通常不是这样。</p><p id="2e4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不变的生态系统用户界面被设计成一个应用商店——一个由创造者授权的数字产品的市场。我们相信向每个访问者展示市场产品，包括搜索引擎爬虫，是很重要的。为了支持这个无钱包的用例，我们引入了Infura作为第三方提供商。还支持公共端点和其他提供者，如Alchemy。</p><p id="260f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">服务器配置的无钱包提供者在没有任何连接的钱包的情况下加载dApp市场产品。总之，我们需要支持三(3)种不同的连接选项，即只读提供者(Infura)、元掩码和WalletConnect技术。</p><p id="dad6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在重要的是优先考虑dApp选择的连接技术。因为我们的目标是无缝的钱包连接集成，并且MetaMask支持它，所以我们选择首先尝试检测插件。通过优先使用元掩码，我们当前的用户群没有中断。如果没有安装/检测到(或者用户不允许连接)，JavaScript将使用Infura加载dApp marketplace，同时显示一个突出的按钮来连接用户的钱包(在通常显示钱包余额的地方)。</p><p id="cc23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，具有元掩码插件的明智用户可以通过拒绝元掩码连接请求来进入这种状态。这可以允许在具有保持未连接的元掩码插件的浏览器中使用WalletConnect而不是元掩码进行dApp会话。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/aaf4a8148f96076f2328b28f6ee5346d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G7Y_NS_8pXmnu9HXhdnSkw.png"/></div></div></figure><p id="03c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当按下右上角的“连接钱包”时，会出现一个弹出窗口，提供安装MetaMask插件或使用WalletConnect的选项。如果选择WalletConnect，dApp将显示一个QR码(或直接应用程序连接到LedgerLive等。).二维码旨在由包含用户钱包的移动设备扫描。这个二维码是一个URI，它在你的钱包和dApp之间建立了一个临时的网络管道。</p><p id="29d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出于安全考虑，要知道dApp的所有区块链通信(从加载市场到交易)都是通过这个管道进行的，而不是通过web浏览器。成功连接后，marketplace智能合约和数据将通过WalletConnect重新加载，看起来应该与使用Infura加载的初始版本相同，但用户现在可以使用连接的wallet签署交易。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/0d418af3337e9a20ef48ef410fc83ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hvuq5SjQUukY21jW8X0SIg.png"/></div></div></figure><p id="09e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了安全起见，WalletConnect连接是暂时的(它不会持续)，因此不需要由dApp保存额外的状态来允许用户选择用户体验的连续性。每个浏览器会话都必须建立一个新的WalletConnect连接，这是所期望的。但是，由于MetaMask具有WalletConnect所不具备的面向服务器的连接功能，因此在为dApp页面提供服务时，通过检查这一点来无缝区分用户选择可能是一个重要的设计选择。</p><p id="1b4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们回顾一下配置web3连接所需的JavaScript代码，以便更好地理解如何直观地尝试这些选项，而无需用户进行不必要的交互。在第一次dApp页面加载时，MetaMask或Infura(谢谢，Consensys！)是第一和第二优先。首先，开始我们的<code class="fe lu lv lw lx b">getWeb3()</code>实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="bd0d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们完成了<code class="fe lu lv lw lx b">getWalletConnect()</code>的实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="0ef3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于加载了Infura的dApp，提供了与WalletConnect连接的突出选项，但不会自动选择，即，在没有用户请求/点击的情况下，不会显示WalletConnect的QR码。这种行为符合WalletConnect风格的意图，即配置一种一次性的、非持久的方式将dApp连接到用户的钱包。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ma"><img src="../Images/17ffaa3fe708e5b7810fe7ce70f2b211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ErlZFZNXDsW9HpFWcNxOCA.png"/></div></div></figure><p id="4af8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种带有WalletConnect回退的元掩码自动检测允许用户轻松完成连接过程，或者完全避免临时应用商店下载程序检查其安装的有效性。那些没有web3钱包的人不再被锁在dApp之外，而是出现在其中，并体验何时连接钱包的清晰界限。</p><p id="b376" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为MetaMask ( <code class="fe lu lv lw lx b">getWeb3()</code>)和WalletConnect ( <code class="fe lu lv lw lx b">getWalletConnect()</code>)创建的web3实例之间的互操作逻辑如下，参数<code class="fe lu lv lw lx b">type </code>用于区分要实例化的实例。实例化后，<code class="fe lu lv lw lx b">web3</code>变量对于MetaMask或WalletConnect是不同的，但是两者都有相同的公共接口，dApp使用相同的服务器端API加载和处理智能合约和数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="fabd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用上面概述的基于二叉树的优先级方案来选择用户的钱包，避免了UI仅在连接钱包之后才显示dApp的需要。安装了Metamask的用户可能会希望使用它，而没有安装的用户可能会希望使用WalletConnect或者完全不熟悉钱包。</p><p id="f39b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请帮助我们让新用户更容易理解web3。如果你喜欢这篇文章，请关注我，在未来会有更多精彩的阅读。并且不要忘记posito pressionibus(利用假设)！</p></div></div>    
</body>
</html>