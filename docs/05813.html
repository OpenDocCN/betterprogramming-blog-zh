<html>
<head>
<title>Android Serverless Notifications via Firebase Cloud Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Firebase云功能的Android无服务器通知</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/android-serverless-notifications-via-firebase-cloud-functions-b64a4b73602?source=collection_archive---------9-----------------------#2020-08-07">https://betterprogramming.pub/android-serverless-notifications-via-firebase-cloud-functions-b64a4b73602?source=collection_archive---------9-----------------------#2020-08-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ec4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于Android上的推送通知，你只需要知道</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/55e30510883f78f0abf0f658a0b97a9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KlkMPtUnkvDkyMsS"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@codestorm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">萨法尔·萨法罗夫</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="63a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，您将了解<a class="ae ky" href="https://firebase.google.com/docs/functions" rel="noopener ugc nofollow" target="_blank"> Firebase云函数</a>，通过云函数发送推送通知，以及在Android客户端接收通知。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3226" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Firebase云函数</h1><p id="ab74" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Firebase的云功能是一个框架，允许您通过HTTP请求或Firebase事件触发器运行后端代码。这些函数可以用JavaScript或TypeScript编写。对于本文，我选择了JavaScript。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3210" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建云函数</h1><p id="c956" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">从<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">官网</a>安装Node.js和npm。这对于用JavaScript编写云函数是必不可少的。安装完成后，在Firebase CLI的shell中运行以下命令。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d67b" class="ne md it na b gy nf ng l nh ni">npm install -g firebase-tools</span></pre><p id="47df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Firebase CLI安装完成后，登录到您的Firebase帐户，并通过运行以下命令在shell中选择project。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="115c" class="ne md it na b gy nf ng l nh ni">firebase login</span></pre><p id="574a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，初始化Firebase云函数，询问语言时选择JavaScript。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="11da" class="ne md it na b gy nf ng l nh ni">firebase init functions</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/5d06dc5396a1b9d71ba6ac5904663433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XfXS_rIky74JSbtiWBUJug.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按Y键安装与npm的依赖关系</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="370c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用JavaScript编写函数</h1><p id="e55e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">一旦设置完成，您将在项目的<code class="fe nk nl nm na b">functions</code>目录中找到JavaScript索引文件。将以下代码复制到索引文件中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用于发送推送通知的功能</p></figure><p id="6c8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行以下代码在Google Cloud上部署功能。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7959" class="ne md it na b gy nf ng l nh ni">firebase deploy --only functions</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2f1b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">发送推送通知</h1><p id="d7cf" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了验证该功能是否成功部署，我们将通过HTTP请求向Android客户端发送推送通知。可以找到HTTP URL，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/08d61978a3b79ab4b7fb20a7ec96e5a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eKg8dgW3JgXfFOeu5JM7QA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">部署功能</p></figure><p id="293b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该请求有三个参数:通知标题、通知消息和设备ID (Firebase令牌)。Android客户端的设备ID可以通过以下方式获取:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="93ad" class="ne md it na b gy nf ng l nh ni">// Kotlin<br/>FirebaseInstanceId.getInstance().<em class="nq">instanceId</em></span></pre><p id="c615" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">HTTP请求的类型是POST，并具有作为请求体的参数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/060fa9684e3b54699ff7788de54b2dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6PHaOSFAUYeXYJkuaHifRQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Http请求参数</p></figure><p id="596e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦请求成功发送，在一秒钟内，您将在Android客户端上收到通知。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/5bd7c971707382174f37df0f18a41b2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KtqovUKnMU8QCzbf_yZzPA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">系统托盘中的Android通知</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="23f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>