<html>
<head>
<title>Improve Your Code Formatting Using Dart’s Trailing Commas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Dart的尾随逗号改进您的代码格式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/dart-formatting-and-trailing-commas-c3a8e0fbaa1b?source=collection_archive---------2-----------------------#2022-07-30">https://betterprogramming.pub/dart-formatting-and-trailing-commas-c3a8e0fbaa1b?source=collection_archive---------2-----------------------#2022-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="25b1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">看看Dart出色的格式化功能</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3d40a287c22b3de672e9cdef6d55778a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jmIapsBD_UazeseooRv_JA.png"/></div></div></figure><p id="c70f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">尾部逗号可能听起来像是Dart语言的一个次要方面，但它们对代码的格式有重大影响。本文解释了确定性格式，结尾逗号如何影响它，为什么应该使用它们，以及如何添加<a class="ae ln" href="https://pub.dev/packages/dart_code_metrics" rel="noopener ugc nofollow" target="_blank"> dart_code_metrics </a>包来加强它们以获得更好的格式。</p><h1 id="5c57" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">确定性格式</h1><p id="5cdd" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">代码格式化器或代码美化器是一个格式化你的代码的工具。Dart有一个工具叫<a class="ae ln" href="https://dart.dev/tools/dart-format" rel="noopener ugc nofollow" target="_blank"> dart格式</a>。格式化程序将原始代码(有时是配置)作为输入和输出格式化代码。</p><p id="b619" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">给定一些原始的语义相同的代码，<em class="ml">确定性的</em>格式化程序总是输出相同的文本。换句话说，如果您复制、粘贴一段代码，并在第二个副本中放置额外的空白，则应用确定性格式化程序将始终产生完全相同的文本。无论您如何用空格格式化原始代码，格式化程序总是会产生可预测的代码结果。</p><h1 id="593e" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">为什么确定性格式很重要？</h1><p id="8023" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">这似乎是一个迂腐的观点，但是不同的格式是合并冲突最常见的原因之一。它还会产生许多不必要的git更改。</p><p id="4103" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果两个人的代码格式不同，不可避免地会导致提交中额外的空格差异。这经常会导致合并冲突，但是这是绝对可以避免的。</p><p id="0a8d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果一个团队决定根据一组规则来格式化所有的代码，他们就排除了不同的格式化会导致合并冲突的可能性。确定性格式化减少了git差异，从而降低了合并冲突的风险。</p><p id="3bf1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">确定性格式对于可读性也很重要。大多数语言都推荐一种格式样式。语言通常规定花括号是从当前行开始还是从下一行开始。这些诱因常常赋予语言以美学的味道。</p><p id="3142" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这意味着人们习惯了格式化程序的风格，无格式的代码通常可读性较差。虽然一个好的格式化程序允许团队级别的一些自主配置，但格式化程序需要加强语言的美学味道，并阻止人们超越团队的决策。</p><p id="f0ff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，团队可能会在评审时结束代码风格的争论。您的团队可能想要调整语言的一些格式选项，但是至少，团队应该对格式做出一致的决定。</p><p id="437c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当代码评审发生时，你不希望有一场关于格式化代码的最佳方式的临时辩论。这种争论应该提前发生，构建过程应该执行这些规则。用颤振团队的话说，</p><blockquote class="mm mn mo"><p id="aa9f" class="kr ks ml kt b ku kv jr kw kx ky ju kz mp lb lc ld mq lf lg lh mr lj lk ll lm ij bi translated"><em class="iq">虽然你的代码可能遵循任何偏好的风格——根据我们的经验——但开发团队可能会发现这样做更有成效:</em></p><p id="69ef" class="kr ks ml kt b ku kv jr kw kx ky ju kz mp lb lc ld mq lf lg lh mr lj lk ll lm ij bi translated"><em class="iq">——拥有单一、共享的风格，以及</em></p><p id="9fd8" class="kr ks ml kt b ku kv jr kw kx ky ju kz mp lb lc ld mq lf lg lh mr lj lk ll lm ij bi translated"><em class="iq"> -通过自动格式化强制使用这种样式。</em></p><p id="71fc" class="kr ks ml kt b ku kv jr kw kx ky ju kz mp lb lc ld mq lf lg lh mr lj lk ll lm ij bi translated"><em class="iq">另一种选择通常是在代码评审期间令人厌倦的格式辩论，在这种情况下，时间可能更好地花在代码行为上，而不是代码风格上</em></p></blockquote><p id="6d64" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://docs.flutter.dev/development/tools/formatting" rel="noopener ugc nofollow" target="_blank">https://docs.flutter.dev/development/tools/formatting</a></p><h1 id="74a0" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">省道格式</h1><p id="e939" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">Dart格式化程序主要是确定性的。它允许你做一些事情，这意味着它不是100%确定的。</p><p id="d9b2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如，它允许您在一段代码中添加一个换行符或不添加换行符。这可能是一件好事，这样您就可以将两段不同的代码分开。</p><p id="7e1f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是，在大多数情况下，它会使您的代码看起来与其他人的代码一致，并保持dart的美感。</p><p id="c198" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以对代码库中的所有代码运行Dart格式化程序。点击阅读省道格式器<a class="ae ln" href="https://dart.dev/tools/dart-format" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="dcc7" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">打开自动格式化</h1><p id="483a" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated"><a class="ae ln" href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwjuy6Wpyp_5AhX_SmwGHcLXCmoQFnoECA4QAQ&amp;url=https%3A%2F%2Fcode.visualstudio.com%2F&amp;usg=AOvVaw15O90sm1ios8AUpw56hCml" rel="noopener ugc nofollow" target="_blank"> Visual Studio Code </a>和<a class="ae ln" href="https://developer.android.com/studio" rel="noopener ugc nofollow" target="_blank"> Android Studio </a>都具有在保存时自动格式化当前文档的功能。您需要打开它，这样格式化就不是一个事后的想法或额外的任务。<a class="ae ln" href="https://docs.flutter.dev/development/tools/formatting" rel="noopener ugc nofollow" target="_blank"> Flutter代码格式化文档</a>解释了如何在两种ide上打开它。在项目早期打开自动格式。</p><p id="e0fb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果开始一个项目时没有强制设置格式，将会有许多不同的格式样式。这将导致合并冲突和混乱。如果您发现自己处于代码未格式化的情况，我的建议是硬着头皮，将dart格式应用于整个代码库，并开始清理。从长远来看，你会发现这样更好。</p><p id="a1af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">dart格式化程序确实有一个怪癖，这就是关于结尾逗号的讨论的由来…</p><h1 id="ae3f" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">尾随逗号</h1><p id="31be" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">尾随逗号充当代码格式化程序的指令。如果您添加尾随逗号，格式化程序将对您的代码进行不同的格式化。在这里阅读关于这个<a class="ae ln" href="https://docs.flutter.dev/development/tools/formatting#using-trailing-commas" rel="noopener ugc nofollow" target="_blank">的Flutter文档。</a></p><p id="ac1d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一个没有尾随逗号的示例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/83664faffcffed51236a477ac637c924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qM_-tJjycmDeKypa.png"/></div></div></figure><p id="c573" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此示例结尾有逗号:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/5149de2326b6cb22f0acb3c068a3e7d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*h4uEGHa1GcSBY2bf.png"/></div></div></figure><p id="0bb7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Flutter团队建议您始终使用尾随逗号，区别是显而易见的。我发现结尾的逗号版本更容易阅读。但是，更重要的是，它垂直格式化参数等等，而不是将它们换行到指定的水平宽度。</p><p id="12a2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">看看这个非常简单的例子。第二段代码中只有两个额外的逗号。您可以将这些代码块复制并粘贴到您的IDE中，看看格式有多大的不同。尾部逗号用水平空格替换垂直空格。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h1 id="aa41" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">用代码规则强制尾部逗号</h1><p id="0c2f" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated"><a class="ae ln" href="https://pub.dev/packages/dart_code_metrics" rel="noopener ugc nofollow" target="_blank"> Dart Code Metrics </a>包是为你的项目增加额外代码分析的优秀工具。您将它添加到您的<code class="fe mw mx my mz b">dev_depedencies</code>中，并在<code class="fe mw mx my mz b">analysis_options.yaml</code>中进行配置。</p><p id="fb1b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有一个规则叫做首选尾随逗号。你需要打开这个。点击阅读更多安装文档<a class="ae ln" href="https://pub.dev/packages/dart_code_metrics/install" rel="noopener ugc nofollow" target="_blank">。这是一个我经常使用的示例配置部分，但是你不必像我在这里做的那样打开所有的错误。</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="a3cc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您不添加结尾逗号，这会导致错误，但它也为您提供了自动添加它的快速解决方案。当有大量嵌套，并且不清楚代码中的问题在哪里时，这是非常方便的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/5f4e433ff7d5bb585923466e52e83078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*u4I8vNHFOVIGvfw5.png"/></div></div></figure><h1 id="c8a0" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">在错误的格式上中断构建</h1><p id="e0b1" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">如果团队中的某个人在pull请求中提交代码，并且该代码包含格式错误的代码，则构建应该会失败。否则，未格式化的代码很容易被分割。我觉得奇怪的是，dart分析器在遇到错误的格式时不会失败。对于build命令也是如此。但是，运行这个命令可能会使构建在遇到错误代码时失败。您可以将它添加到您的构建管道YAML中。</p><pre class="kg kh ki kj gt nb mz nc nd aw ne bi"><span id="fbce" class="nf lp iq mz b gy ng nh l ni nj">flutter format [LIB FOLDER] — set-exit-if-changed</span></pre><p id="49bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本质上，这将运行格式化程序，并在发现需要格式化的内容时以失败代码退出。</p><h1 id="b9d7" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">总结</h1><p id="039a" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">团队可以通过确定性格式化避免很多麻烦，dart有一个优秀的格式化程序。如果代码没有格式化，您还可以自动格式化所有dart文档并中断管道构建。当所有这些事情一起工作时，你的团队将会有更少的关于格式的争论，经历更少的git差异，以及合并冲突。在代码中添加结尾逗号也将改善整体格式。试着在项目的早期设置这些，但是在项目中做这些改变永远不会太晚。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="36c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ml">原载于</em><a class="ae ln" href="https://www.christianfindlay.com/blog/dart-formatting-and-trailing-commas" rel="noopener ugc nofollow" target="_blank"><em class="ml">https://www.christianfindlay.com</em></a><em class="ml">。</em></p></div></div>    
</body>
</html>