<html>
<head>
<title>How to Develop Global State For Your React App With Hooks, Without Context</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在没有上下文的情况下，用钩子开发React应用程序的全局状态</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-develop-global-state-for-your-react-app-with-hooks-without-context-709769ed8505?source=collection_archive---------7-----------------------#2020-02-18">https://betterprogramming.pub/how-to-develop-global-state-for-your-react-app-with-hooks-without-context-709769ed8505?source=collection_archive---------7-----------------------#2020-02-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="67e7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">支持并发模式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/75bd0a2bb2ae13d5dd1062afecefd166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MTe3j-CZRg3RHSCHS9CMIA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@panosskier?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Panos Deligiannidis </a>在<a class="ae ky" href="https://unsplash.com/s/photos/drama?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><h1 id="5008" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="1484" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">用React钩子开发很有趣！</p><p id="6c18" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我已经开发了几个库。第一个是全球国家图书馆。它被天真地称为“react-hooks-global-state”，结果太长了，读不下去。</p><p id="1762" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该库的初始版本于2018年10月发布。从那以后，我学到了很多，现在我已经发布了1.0.0版的库:</p><div class="ms mt gp gr mu mv"><a href="https://github.com/dai-shi/react-hooks-global-state" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">戴式/反应钩式-全局-状态</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">这是一个用React钩子提供全局状态的库。它有…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">github.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj ks mv"/></div></div></a></div><p id="3826" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这篇文章一步一步地展示了代码的简化版本。希望它能帮助你理解这个库的目标，因为真正的代码在TypeScript中有点复杂。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="455d" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">步骤1:全局变量</h1><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="9db1" class="ob la it nx b gy oc od l oe of">let globalState = {<br/>  count: 0,<br/>  text: 'hello',<br/>};</span></pre><p id="b421" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们有一个像上面这样的全局变量。我们假设这种结构贯穿始终。我们创建一个React钩子来读取这个全局变量:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="7c79" class="ob la it nx b gy oc od l oe of">const useGlobalState = () =&gt; {<br/>  return globalState;<br/>};</span></pre><p id="5ffb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这实际上不是一个React钩子，因为它不依赖于任何React原语钩子。这不是我们通常想要的，因为它不会在全局变量改变时重新呈现。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="bf6c" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">步骤2:更新时重新渲染</h1><p id="8cad" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们需要使用React <code class="fe og oh oi nx b">useState</code>钩子使其具有反应性:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="e70f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这允许从外部更新反应状态。如果更新全局变量，需要通知侦听器。让我们创建一个更新函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="5e47" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这样，我们可以改变<code class="fe og oh oi nx b">useGlobalState</code>来返回一个类似<code class="fe og oh oi nx b">useState</code>的元组:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="b5b6" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">步骤3:容器</h1><p id="5ea7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">通常，全局变量在文件范围内。让我们把它放在一个函数作用域中，缩小一点作用域，使它更加可重用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="8819" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这篇文章中我们不会详细讨论TypeScript，但是这个表单允许我们通过推断<code class="fe og oh oi nx b">initialState</code>的类型来注释<code class="fe og oh oi nx b">useGlobalState</code>的类型。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="20f4" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">步骤4:限定范围的访问</h1><p id="d092" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">尽管我们可以创建多个容器，但我们通常会将几个项目放在一个全局状态中。</p><p id="b1f9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">典型的全局状态库具有仅限定状态的一部分的功能。例如，React-Redux使用一个选择器接口从全局状态获取一个派生值。</p><p id="bc10" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这里我们采用一种更简单的方法，即使用一个全局状态的字符串键。在我们的例子中，就像<code class="fe og oh oi nx b">count</code>和<code class="fe og oh oi nx b">text</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="c4e1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了简单起见，我们在这段代码中省略了<code class="fe og oh oi nx b">useCallback</code>的使用，但是对于一个库来说，通常推荐使用它。</p><h1 id="138c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤5:功能更新</h1><p id="d234" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">反应<code class="fe og oh oi nx b">useState</code>允许<a class="ae ky" href="https://reactjs.org/docs/hooks-reference.html#functional-updates" rel="noopener ugc nofollow" target="_blank">功能更新</a>。让我们实现这个特性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="ee7e" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">第六步:减肥药</h1><p id="9d5f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">熟悉Redux的人可能更喜欢reducer接口。React Hook <code class="fe og oh oi nx b">useReducer</code>也有基本相同的接口。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="4890" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">步骤6:并发模式</h1><p id="e6f4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了从并发模式中获益，我们需要使用反应状态而不是外部变量。当前的解决方案是将一个反应状态链接到我们的全局状态。</p><p id="89d3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">实现起来很复杂，但是本质上，我们创建一个钩子来创建一个状态，然后链接它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="dd5f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">需要<code class="fe og oh oi nx b">patchedReducer</code>来允许<code class="fe og oh oi nx b">setGlobalState</code>更新全局状态。<code class="fe og oh oi nx b">useGlobalStateProvider</code>钩子应该在一个稳定的组件中使用，比如一个应用程序根组件。</p><p id="ba14" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请注意，这不是一个众所周知的技术，可能有一些限制。例如，实际上并不建议在render中调用侦听器。</p><p id="d610" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了以适当的方式支持并发模式，我们需要核心支持。目前<code class="fe og oh oi nx b">useMutableSource</code>挂钩在<a class="ae ky" href="https://github.com/reactjs/rfcs/pull/147" rel="noopener ugc nofollow" target="_blank">本RFC </a>中提出。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="a644" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">结束语</h1><p id="58f9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这就是<a class="ae ky" href="https://github.com/dai-shi/react-hooks-global-state" rel="noopener ugc nofollow" target="_blank">react-hooks-global-state</a>的实现方式。库中的真实代码在TypeScript中稍微复杂一点，包含用于从外部读取全局状态的<code class="fe og oh oi nx b">getGlobalState</code>，并且对Redux中间件和DevTools的支持有限。</p><p id="d5ff" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我围绕全局状态和反应上下文开发了一些其他库，如下所示:</p><ul class=""><li id="6cc4" class="ol om it lt b lu mn lx mo ma on me oo mi op mm oq or os ot bi translated"><a class="ae ky" href="https://github.com/dai-shi/reactive-react-redux" rel="noopener ugc nofollow" target="_blank">https://github.com/dai-shi/reactive-react-redux</a></li><li id="c541" class="ol om it lt b lu ou lx ov ma ow me ox mi oy mm oq or os ot bi translated"><a class="ae ky" href="https://github.com/dai-shi/react-tracked" rel="noopener ugc nofollow" target="_blank">https://github.com/dai-shi/react-tracked</a></li><li id="c066" class="ol om it lt b lu ou lx ov ma ow me ox mi oy mm oq or os ot bi translated"><a class="ae ky" href="https://github.com/dai-shi/use-context-selector" rel="noopener ugc nofollow" target="_blank">https://github.com/dai-shi/use-context-selector</a></li></ul></div></div>    
</body>
</html>