<html>
<head>
<title>A Quick Guide to Amazon SNS Subscription Filter Policies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">亚马逊社交网络订阅过滤政策快速指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-quick-guide-to-amazon-sns-subscription-filter-policies-7c91865a9065?source=collection_archive---------2-----------------------#2021-12-08">https://betterprogramming.pub/a-quick-guide-to-amazon-sns-subscription-filter-policies-7c91865a9065?source=collection_archive---------2-----------------------#2021-12-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bee3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">知道如何过滤您希望从AWS SNS收到的消息</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e90d653e032bd1f3a34656a06147737e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f3dhxjKtM9nX3zlGJIh_SA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">社交网站过滤—按作者分类的模式</p></figure><p id="77a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Amazon SNS(简单通知服务)是一种发布-订阅服务，它协调向一个或多个接收者发送推送消息。它允许你发送消息给各种用户，包括Kinesis数据消防软管，SQS，Lambda函数，HTTPS端点，等等。</p><p id="fa7c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">默认情况下，订阅者会收到发布到SNS的所有消息。但是您可以根据自己的标准决定只接收特定的消息。</p><p id="3769" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，我们将使用SNS订阅过滤策略，它允许根据消息的属性过滤消息！</p><p id="ec24" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，本“教程”的先决条件是已经创建了一个SNS主题，您可以在其中推送您的事件。</p><h1 id="61d8" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">1.添加消息属性</h1><p id="2602" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">如果你想过滤你的用户从SNS上得到的信息，你必须把你的信息和属性一起推送到SNS上。基于这些属性，您将能够创建过滤策略。</p><h2 id="0cd5" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">A.将消息发布到社交网络—使用事件生成器</h2><p id="95be" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">如果你只是想测试或调试你推送到SNS的东西，亚马逊创建了一个SNS事件生成接口。使用AWS控制台，转到您的SNS主题并点击<code class="fe nd ne nf ng b"><strong class="la iu">Publish message</strong></code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/5e3b06d13a739a1d7ed84dd0e5286991.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tdn8AdQHVGHuRJEhO6Wd5A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="d97f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从那里可以发送消息，还可以添加<code class="fe nd ne nf ng b"><strong class="la iu">attributes</strong></code>。这是测试您的主题和您想要创建的过滤器策略的一种便捷方式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/df9be9361179cac767e1b26f15c65bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1hvJngKdO2XdUSZyIi8iaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><h2 id="29da" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">B.将消息发布到社交网络——从您的代码</h2><p id="2082" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在大多数情况下，你可能会把你的消息从你的代码推送到SNS。同样，要使用过滤策略，只需将属性和消息一起发送。</p><p id="fc6d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是一个使用boto3 (AWS SDK)的python示例。要给你的信息添加属性，你只需要包含一个<code class="fe nd ne nf ng b">MessageAttributes</code>字典。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="6462" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">其他示例可在<a class="ae nl" href="https://docs.aws.amazon.com/code-samples/latest/catalog/python-sns-sns_basics.py.html" rel="noopener ugc nofollow" target="_blank"> AWS文档</a>中找到。</p><h1 id="c912" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">2.定义过滤器</h1><p id="5d70" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">既然您的消息已经有了属性，那么设置过滤策略就非常简单了。</p><p id="bdc3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">再次导航到所需的产品升级和技术支持服务主题。从你的话题出发，你可以创建<code class="fe nd ne nf ng b">Subscriptions</code>，这样SNS就可以将消息推送到一个或多个目的地。您可以创建新的订阅，或编辑现有的订阅。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/7b7ca18a6ba9ff96350fba5cc165e571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ze3L9l9BOwDF_sgy7E3Lew.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="2a74" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建订阅时，可以通过选择协议来选择目的地。它包括λ，SQS，Kinesis消防软管，HTTP，电子邮件，等等。</p><p id="5031" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">向下滚动，你会找到<code class="fe nd ne nf ng b">Subscription filter policy</code>部分。在这里，您将定义要使用的过滤器，采用JSON格式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/c691d29eca26dd132a22128544550637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fLmXGxMxsHHKQTGYADg8Xw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><h2 id="c921" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">过滤策略:从简单到高级</h2><p id="d51f" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">默认情况下，没有任何过滤器的订阅会将每条消息推送到其目的地。过滤策略将只包括符合条件的邮件。它的开始非常简单:</p><p id="027b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">例1: </strong>包含属性<code class="fe nd ne nf ng b">website</code>等于<code class="fe nd ne nf ng b">medium</code>的每条消息</p><pre class="kj kk kl km gt no ng np nq aw nr bi"><span id="8e32" class="mr lv it ng b gy ns nt l nu nv">{<br/> "website": ["medium"]<br/>}</span></pre><p id="fa80" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">例2: </strong>包含属性<code class="fe nd ne nf ng b">website</code>等于<code class="fe nd ne nf ng b">medium</code>或<code class="fe nd ne nf ng b">quora</code>或<code class="fe nd ne nf ng b">stackoverflow</code>的每条消息</p><pre class="kj kk kl km gt no ng np nq aw nr bi"><span id="0f78" class="mr lv it ng b gy ns nt l nu nv">{<br/> "website": [<br/>    "medium",<br/>    "quora",<br/>    "<em class="nw">stackoverflow"<br/>  </em>]<br/>}</span></pre><p id="9e58" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">例3: </strong>包含属性<code class="fe nd ne nf ng b">website</code>等于<code class="fe nd ne nf ng b">medium</code>且<code class="fe nd ne nf ng b">language</code>等于<code class="fe nd ne nf ng b">french</code>的每条消息</p><pre class="kj kk kl km gt no ng np nq aw nr bi"><span id="3b8f" class="mr lv it ng b gy ns nt l nu nv">{<br/> "website": ["medium"],<br/> "language": ["french"]<br/>}</span></pre><p id="b3b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">示例4: </strong>包括属性<code class="fe nd ne nf ng b">website</code>不等于<code class="fe nd ne nf ng b">wikipedia</code>的每条消息</p><pre class="kj kk kl km gt no ng np nq aw nr bi"><span id="4165" class="mr lv it ng b gy ns nt l nu nv">{<br/> "website": [{"anything-but": "wikipedia"}]<br/>}</span></pre><p id="24d2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">例5: </strong>包含以<code class="fe nd ne nf ng b">+33</code>开头的属性phone的每条消息</p><pre class="kj kk kl km gt no ng np nq aw nr bi"><span id="de51" class="mr lv it ng b gy ns nt l nu nv">{<br/> "phone": [{ "prefix": "+33" }]<br/>}</span></pre><p id="b85d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">示例6: </strong>包括每条具有属性价格<code class="fe nd ne nf ng b">&gt; 100</code>的消息</p><pre class="kj kk kl km gt no ng np nq aw nr bi"><span id="ae10" class="mr lv it ng b gy ns nt l nu nv">{<br/> "price": [{ "numeric": [ "&gt;=", 100 ] }]<br/>}</span></pre><p id="105b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以结合这些策略来创建许多复杂的过滤器。最后，你可以在AWS网站上找到一些文档和例子。</p><h1 id="ef5e" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">结论</h1><p id="0324" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">SNS过滤策略是AWS提供的一个非常有趣的功能。在构建事件驱动的架构时，这当然是需要考虑的事情。这也是简化数据管道、优化成本或优化架构的好方法。</p></div></div>    
</body>
</html>