<html>
<head>
<title>How To Use Protocols to Mock API Calls in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Swift中使用协议模拟API调用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-protocols-to-mock-api-calls-in-swift-c69f7567f77a?source=collection_archive---------9-----------------------#2019-08-28">https://betterprogramming.pub/how-to-use-protocols-to-mock-api-calls-in-swift-c69f7567f77a?source=collection_archive---------9-----------------------#2019-08-28</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="50fe" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">通过模仿提高您的开发、测试和预览速度</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/154c37411e3aa5f8bf52cf9a896638e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BkIrMR-u0jsj6Lgd"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">José Alejandro Cuffia 在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="21db" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">介绍</h1><p id="9a89" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">模仿背后的基本概念很简单:不使用软件组件(本例中是API)，可以用模拟响应的假组件来代替它。</p><p id="2493" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">现在，您可能会想，这种方法的利弊是什么，为什么我们要用一个假的API替换一个真的API呢？下面你可以找到主要原因，并简单解释一下:</p><ul class=""><li id="8334" class="mt mu iu lu b lv mo ly mp mb mv mf mw mj mx mn my mz na nb bi translated"><strong class="lu iv">更快的开发过程:</strong>你的团队本周必须开发一个新的应用，但是开发API的后端团队要到下个月才开始。您已经知道了方法和响应应该如何工作，使用这种方法，您可以开始开发、使用模拟实现和测试您的应用程序。当真正的API准备好了，你只需要修改一行代码。</li><li id="4b74" class="mt mu iu lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated"><strong class="lu iv">集成测试</strong>:通常我们会测试代码的业务逻辑。不需要验证API响应。(警告:<strong class="lu iv"> </strong>这并不总是对的。也许在某些情况下，您还想测试API响应，所以在继续之前，考虑一下这个实现是否适合您的情况。)</li><li id="84da" class="mt mu iu lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated"><strong class="lu iv">测试和预览:</strong>你想向客户展示你的应用程序的预览，但是一些API部分仍然缺失，测试数据库上只有几个数据点可以显示。</li></ul></div><div class="ab cl nh ni hy nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="in io ip iq ir"><h1 id="67de" class="la lb iu bd lc ld no lf lg lh np lj lk ka nq kb lm kd nr ke lo kg ns kh lq lr bi translated">履行</h1><p id="c300" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">让我们创建一个新项目，它使用协议<strong class="lu iv"> </strong>为我们的<code class="fe nt nu nv nw b">RealAPI</code>类和<code class="fe nt nu nv nw b">MockAPI</code>类创建一个抽象层。</p><p id="f9b1" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">首先，新建一个Xcode项目。可以从单视图app开始。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nx"><img src="../Images/581f05daf52ac05177a69f3a1172fc33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T13M0gHX9XNWtO5HKN62qQ.png"/></div></div></figure><p id="a1eb" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">现在创建一个新文件，命名为<code class="fe nt nu nv nw b">RequestProtocol</code>。这里我们应该添加我们的API方法。下面你可以找到一个例子:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div></figure><p id="2bc3" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">添加两个实现<code class="fe nt nu nv nw b">RequestProtocol</code>的类(<code class="fe nt nu nv nw b">RealAPI</code>和<code class="fe nt nu nv nw b">MockAPI</code>)。遵循Xcode的建议，添加所有可用的方法。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div></figure><p id="24cd" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">现在将您的真实网络请求放入您的<code class="fe nt nu nv nw b">RealAPI</code>类，并在<code class="fe nt nu nv nw b">MockAPI</code>上虚拟返回值，如下所示:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div></figure></div><div class="ab cl nh ni hy nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="in io ip iq ir"><h1 id="25e7" class="la lb iu bd lc ld no lf lg lh np lj lk ka nq kb lm kd nr ke lo kg ns kh lq lr bi translated">是时候测试一下了</h1><p id="e639" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">为了测试我们的代码是否工作正常，我们将在我们的<code class="fe nt nu nv nw b">ViewController</code>类上添加一个对<code class="fe nt nu nv nw b">isAlive</code> <strong class="lu iv"> <em class="oa"> </em> </strong>方法的调用，并运行项目。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div></figure><p id="2c6f" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">如果您打印变量值，您将看到该方法总是如我们所期望的那样返回true(当然，我们硬编码了它)。</p><p id="0ccf" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">最后，为了使用您真正的API，您唯一需要做的就是更改<code class="fe nt nu nv nw b">apiManager</code> <strong class="lu iv"> <em class="oa"> </em> </strong>变量初始化，以便使用<code class="fe nt nu nv nw b">RealAPI</code>类而不是<code class="fe nt nu nv nw b">MockAPI</code>。</p></div><div class="ab cl nh ni hy nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="in io ip iq ir"><figure class="kk kl km kn gu ko gi gj paragraph-image"><a href="https://www.buymeacoffee.com/nicolidomenico"><div class="gi gj ob"><img src="../Images/2a5f4681ef2bdba5652dc9b023b668a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-JJemrcn63kKj3lPBwZ5w.png"/></div></a></figure><p id="46dd" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">你可以在<a class="ae kz" href="https://github.com/domeniconicoli/MockAPI" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到完整代码。</p><h1 id="f226" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">结论</h1><p id="1bae" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">关于如何使用协议创建一个假API的教程到此结束。如果你有任何问题或建议，请在下面留下评论。</p></div></div>    
</body>
</html>