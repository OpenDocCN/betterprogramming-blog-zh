<html>
<head>
<title>MongoDB vs. DocumentDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MongoDB与DocumentDB</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/mongodb-vs-documentdb-which-is-right-for-you-e8015941fa76?source=collection_archive---------8-----------------------#2019-10-30">https://betterprogramming.pub/mongodb-vs-documentdb-which-is-right-for-you-e8015941fa76?source=collection_archive---------8-----------------------#2019-10-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="824a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">哪个适合你？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d7919604c498fee94cf43e7e0619a06d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfyfMRdKPMufVE5Mq-i5Og.jpeg"/></div></div></figure><p id="3601" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你是否在试图决定是应该使用<a class="ae lq" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>还是<a class="ae lq" href="https://aws.amazon.com/documentdb/" rel="noopener ugc nofollow" target="_blank"> DocumentDB </a>？随着最近围绕MongoDB许可的<a class="ae lq" href="https://techcrunch.com/2019/01/09/aws-gives-open-source-the-middle-finger/" rel="noopener ugc nofollow" target="_blank">争议</a>,选择哪个选项适合你的公司或项目可能会令人困惑。</p><p id="ee6e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Amazon认为核心MongoDB代码在保持高可用性的同时很难扩展。亚马逊写了他们的实现，兼容Apache 2.0开源MongoDB 3.6 API。MongoDB公司最近也改变了他们的许可证，使得未来的模仿更加困难。为此，他们创建了一个全新的许可证，名为<a class="ae lq" href="https://www.mongodb.com/licensing/server-side-public-license" rel="noopener ugc nofollow" target="_blank">服务器端公共许可证</a>。</p><p id="33fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">考虑到这种分割，您应该让MongoDB服务提供商(如<a class="ae lq" href="https://www.mongodb.com/cloud/atlas" rel="noopener ugc nofollow" target="_blank"> MongoDB Atlas </a>)托管您的关键任务数据库，运行并扩展您的实例，还是使用DocumentDB？由于公司之间的分歧和没有明确答案的事实，这成为一个困难的决定。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="2b0b" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">DocumentDB是什么？</h1><p id="5297" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated"><a class="ae lq" href="https://press.aboutamazon.com/news-releases/news-release-details/aws-announces-amazon-documentdb-mongodb-compatibility" rel="noopener ugc nofollow" target="_blank">2019年1月推出</a>亚马逊DocumentDB(兼容MongoDB)是MongoDB 3.6 API的快速、可扩展、高可用的实现。这是一个完全托管的文档数据库，支持MongoDB工作负载。从本质上讲，DocumentDB是3.6版本的克隆版，为扩展而重新实现。它不共享或使用任何MongoDB源代码，这意味着它是一个独特的实现，是亚马逊专有的。</p><p id="2c78" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">代码是闭源的。Amazon认为他们需要创建自己的实现来提高大型数据集的性能，为任务关键型工作负载提供高吞吐量。为此，他们分离了存储和计算。这允许通过添加低延迟读取副本将读取容量扩展到每秒数百万次请求。</p><p id="5e76" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">亚马逊的实现是对越来越多努力大规模运行MongoDB的客户的回应。亚马逊认为，所有现有的解决方案，包括MongoDB Atlas，都没有解决客户面临的问题。例如，DocumentDB支持自动数据扩展，使您可以毫不费力地从10GB扩展到64TB。在DocumentDB之前，这种数据伸缩是很困难的。</p><p id="10dc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">亚马逊的解决方案还提供了自动容错。根据DocumentDB的<a class="ae lq" href="https://aws.amazon.com/documentdb/faqs/" rel="noopener ugc nofollow" target="_blank"> FAQ页面</a>，DocumentDB会自动将你的存储卷分成10GB的段，分布在许多磁盘上。您的存储卷的每个10GB区块以六种方式复制，跨越三个可用性区域。Amazon DocumentDB旨在无缝处理最多两个数据副本的丢失，而不会影响写入可用性，它还可以处理最多三个副本的丢失，而不会影响读取可用性。它还具有自我修复存储容量。数据块和磁盘被连续扫描以发现错误并自动修复。</p><p id="8592" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于这项服务是由亚马逊托管的，因此你可以享受大部分合规服务。DocumentDB符合许多标准，包括PCI DSS、ISO 9001、27001、27017、27017、SOC 1、SOC 2、SOC 3，并且符合HIPAA标准。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="63a6" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">听起来很棒！有什么条件？</h1><p id="b253" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">为了与3.6 API兼容，DocumentDB模拟MongoDB客户机所期望的请求和响应。理论上，任何兼容3.4+的驱动都可以。也就是说，这种说法有相当多的警告没有出现在亚马逊的营销材料中。既有API支持方面的差距，也有关键的功能差异需要考虑。</p><p id="23fe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">根据<a class="ae lq" href="https://www.mongodb.com/atlas-vs-amazon-documentdb/compatibility" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>的说法，亚马逊未能通过<strong class="kw iu"> 61% </strong>的正确性测试。需要考虑的一些最大差距:</p><ol class=""><li id="4482" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">聚合管道阶段和查询语言操作符受到严重阻碍。截至本文撰写之时，仅支持50%。例如，不支持<code class="fe ne nf ng nh b">mapReduce</code>。对于较大的数据集，这更有可能成为一个问题。点击查看聚合支持<a class="ae lq" href="https://docs.aws.amazon.com/documentdb/latest/developerguide/mongo-apis.html#mongo-apis-dababase-aggregation" rel="noopener ugc nofollow" target="_blank">的完整列表。</a></li><li id="a71b" class="mv mw it kw b kx ni la nj ld nk lh nl ll nm lp na nb nc nd bi translated">某些数据类型和索引是有限的。不支持Decimal128数据类型和不区分大小写的索引。</li><li id="c795" class="mv mw it kw b kx ni la nj ld nk lh nl ll nm lp na nb nc nd bi translated">没有<a class="ae lq" href="https://docs.mongodb.com/v3.6/changeStreams/" rel="noopener ugc nofollow" target="_blank">更改流</a>支持。大型应用程序可能会从这个特性中受益。鉴于他们的实现，还不清楚这个特性是否会进入DocumentDB。在使用DocumentDB之前，一定要检查您的代码中是否有任何使用变更流的内容。例如，以下Java代码将会失败:</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="552e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在做出决定之前，请确保您了解兼容性问题的完整列表<a class="ae lq" href="https://docs.aws.amazon.com/documentdb/latest/developerguide/mongo-apis.html" rel="noopener ugc nofollow" target="_blank">这里</a>。Amazon已经声明他们将继续支持3.6 API的大部分，但是他们没有给出任何何时停止支持的指示。你可能要等很长时间才能看到关键特性。</p><p id="576c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">选择DocumentDB的最大缺点是停留在3.6版本上。由于亚马逊和MongoDB的意见分歧，以及新的授权方案，DocumentDB未来会怎么样还不清楚。MongoDB不支持亚马逊的实现，打算打一仗。Amazon还没有宣布任何支持最新版本的计划，所以MongoDB现在是一个重要的未来版本(4.0+)，发布了一些DocumentDB中没有提供的新功能。</p><p id="170f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">目前还不知道亚马逊是否会创建一个新的偏离MongoDB主线的API。如果发生这种情况，用户将被锁定到只有亚马逊支持的MongoDB的尴尬分叉版本。另一个选择是永远停留在DocumentDB 3.6上，这将导致用户错过很棒的MongoDB新特性。选择DocumentDB可能会导致意外的供应商锁定，并且很难过渡回MongoDB。亚马逊还没有解决这个问题，所以只有时间会告诉我们会发生什么。</p><p id="2688" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">MongoDB 4.0版中发布的一个优秀特性的例子是多语句ACID事务。DocumentDB不太可能支持这一点，尤其是对于分离存储和计算的分布式实现。例如，此Java代码将在DocumentDB:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="1330" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这可能是MongoDB将在未来几年发布的许多优秀特性中的第一个。DocumentDB用户将无法访问这些功能，也不知道他们是否会发布自己的类似功能。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="d50e" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">那么我为什么要用AWS DocumentDB呢？</h1><p id="01a7" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">最终，这一切都归结于规模。如果您需要或有可能以每秒数十万次的读写扩展数TB，DocumentDB可能是一个不错的选择。这句来自他们<a class="ae lq" href="https://press.aboutamazon.com/news-releases/news-release-details/aws-announces-amazon-documentdb-mongodb-compatibility" rel="noopener ugc nofollow" target="_blank">新闻稿</a>的话说明了一切:</p><blockquote class="np nq nr"><p id="3c37" class="ku kv ns kw b kx ky ju kz la lb jx lc nt le lf lg nu li lj lk nv lm ln lo lp im bi translated">“再加上高级查询处理、连接池以及优化的恢复和重建等优化，Amazon DocumentDB的吞吐量是当前可用的MongoDB解决方案的两倍。”</p></blockquote><p id="fcc4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">选择DocumentDB的另一个原因是将一切都保存在AWS中。将您的大部分或全部服务放在AWS上可能是有益和方便的。DocumentDB是亚马逊唯一托管的MongoDB兼容服务。另一种方法是在EC2/EBS上自己管理数据库，这很难做到。如今，管理自己的数据库实例通常不是很好的时间利用——除非您有一个专门的团队和一个特定的用例。</p><p id="dc58" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">亚马逊涉足云服务业务已经有很长时间了。他们无疑是业内最好的，因此您可以信赖他们来保护和扩展您的数据。其他供应商没有相同的记录或经验。如果您需要这些保证，请选择DocumentDB。否则，坚持使用MongoDB。</p></div></div>    
</body>
</html>