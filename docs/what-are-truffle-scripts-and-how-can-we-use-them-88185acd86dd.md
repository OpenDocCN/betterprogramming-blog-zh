# 什么是松露脚本，我们如何使用它们？

> 原文：<https://betterprogramming.pub/what-are-truffle-scripts-and-how-can-we-use-them-88185acd86dd>

## 一个强大的工具，可用于播种您当地的区块链环境

![](img/fb1534e03bad34ccc98946bf2eb2c898.png)

马库斯·斯皮斯克在 [Unsplash](/s/photos/scripts?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片。

在测试环境中，模仿现实生活中的用法是至关重要的。想象一下，我们正在创建一个 DApp，期望迎合成千上万的用户。在我们当地的区块链上很难模仿这样的使用量。

Truffle 脚本使我们能够创建这样的定制操作，可以在我们的本地测试环境中从命令行调用这些操作。

# 它们是什么？

Truffle 脚本是 JavaScript 文件，我们可以创建它来执行一组自动化任务。我们可以在里面做任何我们想做的事情，只要我们遵循块菌执行所需的基本结构。图 1 显示了这一点:

图 1: Truffle 脚本结构

要运行这个脚本，我们只需在根目录中调用`truffle exec truffle-script.js`(假设脚本也在那里)。

# 浏览一个真实的例子

假设我们已经为分散式 ERC20 令牌交换创建了智能合约，用户可以用 ETH 交换 ERC20 令牌，反之亦然。在我们的本地测试环境中，如果没有用户，我们无法为前端生成价格图表和数据，因此在部署之前我们不知道它是否有效。为了模拟真实的使用，我们需要在测试环境中用虚拟数据播种契约。我们可以用块菌脚本做到这一点。

图 2 向我们展示了我们已经创建的`Exchange`契约的函数定义。为了简单起见，实现是隐藏的:

图 2:交换函数定义

我们需要一种简单的方法来用虚拟数据填充我们的交换，这样我们就可以确保我们的接口正常工作。为此，我们创建一个种子脚本。

在我们的根文件夹中，我们创建了一个名为`scripts`的新目录。然后我们创建一个名为`seed-exchange.js`的新文件，将图 1 中的代码复制到其中。在继续之前，让我们测试一下这个脚本是否有效。我们在脚本中控制台登录，如图 3 所示，并在终端中从项目根目录运行`truffle exec scripts/seed-exchange.js`:

图 3:登录到控制台

我们应该看到`“IT WORKS”`出现在输出中。

## 存放、制作和填写订单

下一步是模仿用户的行为，如果他们决定在我们的交易所交易。使用图 2 中的函数定义，我们将使用本地测试环境提供的帐户( [Ganache](https://www.trufflesuite.com/ganache) )来存放资金，然后生成并完成订单。

松露在幕后为脚本工作表演了一点“魔法”。对于我们的交换，我们需要将契约实例加载到内存中，这意味着我们需要编译后的契约 ABI。我们可以使用关键字`artifacts`获得这些信息:

图 4:向我们的交易所存放乙醚

让我们在图 4 中分解我们脚本的当前状态:

*   第 2 行:使用`artifacts`关键字检索编译后的`Exchange`合同。
*   第 5 行:一个帮助器函数，我们可以用它将 ETH 的单位转换成 Wei 的单位。
*   第 11 行:块菌脚本的入口点。
*   第 14 行:检索我们可用的帐户。
*   第 17 行:创建我们的`Exchange`契约的本地实例，这样我们就可以向它提交事务。
*   第 25 行:从`user1`到`Exchange`存放 2 ETH。

通过运行`truffle exec scripts/seed-exchange.js`，我们可以看到我们的脚本按预期运行，并且`user1`已经存放了 2 个 ETH。

# 后续步骤

假设我们有一个开始模拟现实生活使用的脚本，看看您是否可以扩展它来模拟订单创建、订单执行和取款。使用来自`accounts`和循环的多个用户来播种多个订单。从第 28 行开始编码，这里有`//…`注释。

祝你好运！

# 进一步阅读

如果你对区块链开发感兴趣，我会写一些教程、演练、提示以及如何开始和建立投资组合的技巧。查看以下资源:

[](https://medium.com/blockcentric/blockchain-development-resources-b44b752f3248) [## 区块链开发资源马上跟进

### 学习区块链、以太坊和 DApp 开发的资源列表

medium.com](https://medium.com/blockcentric/blockchain-development-resources-b44b752f3248)