<html>
<head>
<title>Create an Apple Health API With Shortcuts and Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用快捷方式和Firebase创建一个苹果健康API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-an-apple-health-api-with-shortcuts-and-firebase-a76d178319b7?source=collection_archive---------8-----------------------#2020-04-01">https://betterprogramming.pub/create-an-apple-health-api-with-shortcuts-and-firebase-a76d178319b7?source=collection_archive---------8-----------------------#2020-04-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bc8d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何为自己创建个人Apple Health API</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/633ea0c2a5584f50110dcf827a43475c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rMEyMjgu9d3s79_JG7E1aw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/@miphotography?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">米莎·莫里涅</a>从<a class="ae ky" href="https://www.pexels.com/photo/blue-colors-food-fruit-437805/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">佩克斯</a>拍摄</p></figure><p id="7184" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我看到了克雷格·卡莱尔的一篇鼓舞人心的文章。他创建了一个仪表板来记录他的生活。他可以跟踪自己的心率、卡路里、咖啡杯数、开源贡献等。在大日历视图中一天一天地显示。这是一个非常酷的项目。我强烈建议你看一看。</p><p id="7104" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想为自己拥有一个类似的仪表板，所以我决定一步一步地构建它，因为它需要大量的工作来涵盖不同的功能。我也决定与你分享我的旅程，这样我们可以一起努力。</p><p id="37cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我想跟踪我每天的步数、卡路里等。我有一部iPhone和Mi Band 4来提供这些数据。Apple Health收集了所有的东西，但是没有办法在iOS设备之外访问它。所以我们需要一种方法来提取这些数据。</p><p id="ad83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">健康应用中有一个<code class="fe lx ly lz ma b">Export All Health Data</code>选项。此选项以XML格式导出您的所有健康数据。对于一次性使用来说是个不错的选择。但是，如果您希望每天或每小时都将数据与仪表板同步，这并不是最佳选择。我们需要更好的选择。</p><p id="fdd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">苹果在2018年随iOS 12发布了快捷方式应用。Shortcuts应用程序允许您在iOS设备上创建宏和自动化任务。天空是无限的。你真的可以为之疯狂。</p><p id="f364" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想出了一个使用快捷方式和Firebase的解决方案。我们可以创建一个Firebase HTTP函数将健康数据写入Firestore，然后我们可以创建一个快捷方式将健康数据导出并发送到这个Firebase函数。这样，我们可以随时将数据与仪表板同步。</p><p id="0cc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将介绍创建这个API的每个步骤。开始了。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="a520" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">要导出的数据结构</h1><p id="b928" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">Firestore中的数据会像这样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/62967c48f4655c6c76a50a6912e22ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e6OkVGgc-Hfp9vSK7tfpqg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Firestore预览</p></figure><p id="ad8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是首先，我们需要一个数据结构来导出数据。快捷方式将以以下JSON格式导出数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="296a" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">重火力点</h1><p id="78f5" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">Firebase的免费层对于我们的需求来说已经足够了。首先，我们需要创建一个Firebase项目，并在<a class="ae ky" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>中进行一些配置。</p><p id="64c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你已经有了Firebase的经验，你可以直接从我的GitHub库获得代码。您可以在参考资料部分找到链接。</p><p id="0850" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">访问Firebase控制台，点击“添加项目”按照说明完成。项目创建完成后，点击齿轮图标打开“项目设置”进入“项目设置”后，选择“谷歌云平台(GCP)资源位置”我选择了“eur3(欧洲-西方)”，因为我位于德国柏林。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/e6420296d6ee2f2e414bc10e29ccc866.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8XmkJmOuhald9OlhKfzXQw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">选择Firebase资源位置</p></figure><p id="4a36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择资源位置后，单击左侧控制台菜单上的“数据库”打开Firestore。一旦您进入Firestore登录页面，您将看到以下警告:</p><pre class="kj kk kl km gt nj ma nk nl aw nm bi"><span id="52e1" class="nn mj it ma b gy no np l nq nr">This project is set up to use Cloud Firestore in Datastore mode. This mode can only be accessed from Google Cloud Platform</span></pre><p id="f4b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击“转到云平台”按钮。一旦你进入“云平台”页面，你会看到一个蓝色的“切换到本机模式”按钮。单击该按钮，并按照说明完成操作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/e3b0c541b65bbe6d8d1bf343d47ce881.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*smypd8bWPn81BUF2YEYYKw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">切换到Firestore本地模式</p></figure><p id="2910" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经完成了Firebase控制台的设置。在深入研究代码之前，我们需要创建项目样板文件。</p><p id="9d8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用Firebase CLI来创建项目样板文件。我将使用<a class="ae ky" href="https://github.com/npm/npx" rel="noopener ugc nofollow" target="_blank"> npx </a>来跳过任何安装步骤。请随意查看<a class="ae ky" href="https://firebase.google.com/docs/cli" rel="noopener ugc nofollow" target="_blank">Firebase CLI文档</a>上的安装选项。</p><p id="e1e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要在终端中登录我们的Firebase帐户，以便使用CLI。运行以下命令，然后按照说明完成。</p><pre class="kj kk kl km gt nj ma nk nl aw nm bi"><span id="74aa" class="nn mj it ma b gy no np l nq nr">npx firebase-tools login</span></pre><p id="328a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">登录后，执行以下命令来创建项目样板文件:</p><pre class="kj kk kl km gt nj ma nk nl aw nm bi"><span id="53e7" class="nn mj it ma b gy no np l nq nr">mkdir apple-health-api<br/>cd apple-health-api<br/>npx firebase-tools init</span></pre><p id="047b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行<code class="fe lx ly lz ma b">init</code>命令后，将打开一个交互式CLI。使用空格键选择“Firestore”和“Functions”，然后按回车键。接下来，通过选择“使用现有项目”选项来选择我们新创建的Firebase项目。之后，只需按照说明完成即可。顺便说一下，我使用TypeScript作为项目语言。</p><p id="fc90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们将使用Firestore来存储我们的数据，所以我们需要<a class="ae ky" href="https://github.com/firebase/firebase-admin-node" rel="noopener ugc nofollow" target="_blank"> firebase-admin </a>包。运行以下命令进行安装:</p><pre class="kj kk kl km gt nj ma nk nl aw nm bi"><span id="d774" class="nn mj it ma b gy no np l nq nr">cd functions<br/>npm i firebase-admin</span></pre><p id="4e66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜你。我们都准备好了。现在我们可以开始编码了。</p><p id="81c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将编写一个Firebase HTTP函数，以JSON格式接受POST请求主体中的数据。然后，我们将解析这些数据并将其存储在Firestore中。</p><p id="21ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">获取以下代码，并将其放入<code class="fe lx ly lz ma b">functions/index.ts</code>文件中。您可以浏览代码，看看发生了什么。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="b27b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，是时候部署了。运行以下命令进行部署。</p><pre class="kj kk kl km gt nj ma nk nl aw nm bi"><span id="ea7b" class="nn mj it ma b gy no np l nq nr">npx firebase-tools deploy</span></pre><p id="10ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">部署之后，您将在终端中看到该功能的已部署端点。或者，您也可以访问Firebase控制台中的“函数”部分来查看它。把它带走，存放在方便的地方。我们在寻找捷径时会用到它。</p><p id="5adc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦有了数据，就可以进行查询和提取，如下所示:</p><pre class="kj kk kl km gt nj ma nk nl aw nm bi"><span id="8fab" class="nn mj it ma b gy no np l nq nr">collection('apple-health').where('type', '==', 'Steps').get()<br/>collection('apple-health').where('type', '==', 'Active Caloriies').get()<br/>...</span></pre></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="7b22" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">快捷指令</h1><p id="c072" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我创建了一个从健康应用程序导出每日数据的快捷方式。首先，下载到你的手机上。然后，我们可以根据您的需要进行调整。</p><div class="ns nt gp gr nu nv"><a href="https://www.icloud.com/shortcuts/1617296a8c8546b49be47740be2550b3" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">捷径</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">编辑描述</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">www.icloud.com</p></div></div></div></a></div><p id="3b9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">快捷方式配置为导出您当天的步数和活动卡路里。您可以配置这些设置来添加更多数据或更改时间范围。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/941715c7776342bbfefe2927194856c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7VONdzjcPoTtu1cxPQEY3A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">以快捷方式添加健康类型和更改时间范围</p></figure><p id="f5f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最重要的设置是Firebase函数URL。我们需要提供它来发送导出的健康数据。当快捷方式运行时，它会将健康数据导出为JSON，然后发布到提供的URL。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/b40cbbe092b337bd25b89b4dff0280ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*napVtwxusmiQS_CumWsiMQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在快捷方式中设置Firebase函数URL</p></figure><p id="3870" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成设置后，运行快捷方式将数据存储在Firestore中。然后转到Firebase控制台中的“Firestore”部分，查看导出的数据。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="5ae9" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">结论</h1><p id="9b80" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">作为创建生活跟踪仪表板的第一步，我很满意。解决方案非常简单，但功能强大。Firestore SDK很棒。你可以每天使用Siri运行快捷方式，或者你可以尝试在快捷方式应用程序的“自动化”部分自动化它。</p><p id="efd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想在空闲时间找一个项目，这里就是。我在黑客马拉松模式下开发了这个。接受并改进它以适应您的项目。</p><p id="e46f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想完成这个仪表板项目，并写下每个步骤。如果你感兴趣，请继续关注。</p><p id="1b81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="aaef" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">资源</h1><div class="ns nt gp gr nu nv"><a href="https://github.com/emreyilmaz7c6/apple-health-api" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">emreyilmaz7c6/apple-health-api</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">一个Firebase项目，用于解析和存储来自iPhone的苹果健康数据。使用Firebase HTTP函数解析…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">github.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok ks nv"/></div></div></a></div><div class="ns nt gp gr nu nv"><a href="https://support.apple.com/en-in/guide/shortcuts/welcome/ios" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">快捷方式用户指南</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">快捷方式是使用应用程序完成一项或多项任务的快捷方式。快捷方式应用程序可让您创建自己的…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">support.apple.com</p></div></div><div class="of l"><div class="ol l oh oi oj of ok ks nv"/></div></div></a></div><div class="ns nt gp gr nu nv"><a href="https://firebase.google.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">重火力点</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">Firebase为您提供了分析、数据库、消息传递和崩溃报告等功能，因此您可以快速移动并…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">firebase.google.com</p></div></div><div class="of l"><div class="om l oh oi oj of ok ks nv"/></div></div></a></div></div></div>    
</body>
</html>