<html>
<head>
<title>4 Delta Lake Metadata Queries You Should Know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你应该知道的4个三角洲湖元数据查询</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/4-delta-lake-metadata-queries-you-should-know-ca7489c13483?source=collection_archive---------9-----------------------#2022-10-26">https://betterprogramming.pub/4-delta-lake-metadata-queries-you-should-know-ca7489c13483?source=collection_archive---------9-----------------------#2022-10-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="890e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">获得所有你想要的关于你的湖边小屋的元数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/a3adae768efd2c5099ed2ea9e5830b00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*6oNE5oCiddsL01fkMHISVg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">来自<a class="ae ku" href="https://github.com/delta-io/delta" rel="noopener ugc nofollow" target="_blank"> GitHub </a>的三角洲湖标志</p></figure><p id="5eea" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">本文的主题都集中在Delta Lake表的高级元数据查询上。如果您是Delta表的新手，我强烈建议您浏览一下开源社区提供的关于Delta Lake的文档。</p><p id="93c6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在本文中，我将展示一些高级元数据查询，我发现这些查询在实现数据湖库时非常有用。</p><p id="fe36" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">本文的所有代码都可以在<a class="ae ku" href="https://github.com/sjrusso8/delta-tables-metadata-queries" rel="noopener ugc nofollow" target="_blank">这里</a>找到。我使用Databricks Workspace和运行DBR 11.1的集群。</p><h2 id="956d" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">设置</h2><p id="4bb6" class="pw-post-body-paragraph kv kw it kx b ky mk ju la lb ml jx ld le mm lg lh li mn lk ll lm mo lo lp lq im bi translated">本文的数据可以在大多数Databricks工作区的目录<code class="fe mp mq mr ms b">/databricks-datasets/nyctaxi/sample/json/</code>下找到。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">加载数据</p></figure><p id="edf9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我正在加载纽约市出租车数据集的样本，并将其作为托管增量表保存在我的Databricks工作区中。</p><h2 id="baf6" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">描述历史</h2><p id="161c" class="pw-post-body-paragraph kv kw it kx b ky mk ju la lb ml jx ld le mm lg lh li mn lk ll lm mo lo lp lq im bi translated">关于增量表，您应该知道的最重要的操作是检查表的变化历史的能力。对于审计操作、监控随时间的变化和数据版本控制来说，历史记录更安全。每次修改增量表都会创建一个新的表版本，并且更新<code class="fe mp mq mr ms b">delta_log</code>。</p><p id="8492" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">新创建的增量表总是以0的<code class="fe mp mq mr ms b">delta_log</code>版本开始。语句<code class="fe mp mq mr ms b">DESCRIBE HISTORY</code>将给出一个表上所有更改的输出。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">在新创建的表上描述历史</p></figure><p id="207b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在运行插入新数据和删除数据的两条语句后，您将看到两个新版本被添加到了<code class="fe mp mq mr ms b">delta_log</code>历史中，现在表版本是2。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">查看版本历史</p></figure><p id="8e4f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果遇到对数据执行了不正确修改的情况，可以使用<code class="fe mp mq mr ms b">RESTORE TABLE</code>快速将整个增量表恢复到以前的版本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">将增量表恢复到以前的版本</p></figure><h2 id="ac47" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">描述表格</h2><p id="89b5" class="pw-post-body-paragraph kv kw it kx b ky mk ju la lb ml jx ld le mm lg lh li mn lk ll lm mo lo lp lq im bi translated">由于增量表在其日志中保留了所有的元数据，所以您可以使用<code class="fe mp mq mr ms b">DESCRIBE TABLE</code>查询大多数元数据信息。该操作中包含的信息与列名、类型和注释、表属性以及分区规范有关。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">使用描述表查看表元数据</p></figure><p id="ebad" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">一个有用的选项是<code class="fe mp mq mr ms b">DESCRIBE TABLE EXTENDED</code>，它提供了更多的元数据信息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">使用扩展的描述表查看更多表元数据</p></figure><h2 id="b1c1" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">描述细节</h2><p id="fb37" class="pw-post-body-paragraph kv kw it kx b ky mk ju la lb ml jx ld le mm lg lh li mn lk ll lm mo lo lp lq im bi translated">该查询提供了一条记录，其中包含关于增量表的所有最新元数据。单行包括以下详细信息:</p><ul class=""><li id="5474" class="mv mw it kx b ky kz lb lc le mx li my lm mz lq na nb nc nd bi translated">文件的数量</li><li id="e697" class="mv mw it kx b ky ne lb nf le ng li nh lm ni lq na nb nc nd bi translated">桌子的位置</li><li id="a784" class="mv mw it kx b ky ne lb nf le ng li nh lm ni lq na nb nc nd bi translated">创建和上次修改日期</li><li id="fe48" class="mv mw it kx b ky ne lb nf le ng li nh lm ni lq na nb nc nd bi translated">数据量</li><li id="4044" class="mv mw it kx b ky ne lb nf le ng li nh lm ni lq na nb nc nd bi translated">表格属性</li></ul><p id="6cfb" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">更多信息可以在<a class="ae ku" href="https://docs.delta.io/latest/delta-utility.html#detail-schema" rel="noopener ugc nofollow" target="_blank">文档</a>中找到。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="0eaa" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我经常使用这个查询来收集关于数据大小的信息，而不需要跳转到AWS S3存储桶或ADLS存储帐户。</p><h2 id="7c45" class="lr ls it bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">显示创建表格</h2><p id="b8c0" class="pw-post-body-paragraph kv kw it kx b ky mk ju la lb ml jx ld le mm lg lh li mn lk ll lm mo lo lp lq im bi translated">我发现自己需要与其他团队共享DDL语句来重新创建表模式或记录已经创建的增量表的细节。查询<code class="fe mp mq mr ms b">SHOW CREATE TABLE</code>生成这些需求所需的精确DDL语句。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="f8fe" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">它也适用于视图！如果您在一个视图上运行相同的查询，它将返回用于创建它的SQL语句。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="dbfe" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您可以使用这些信息来执行沿袭操作，并为需要验证视图逻辑细节的最终用户提供信息。</p><h1 id="5f8f" class="nj ls it bd lt nk nl nm lw nn no np lz jz nq ka mc kc nr kd mf kf ns kg mi nt bi translated">包扎</h1><p id="f890" class="pw-post-body-paragraph kv kw it kx b ky mk ju la lb ml jx ld le mm lg lh li mn lk ll lm mo lo lp lq im bi translated">在本文中，我甚至没有涉及到整个增量表操作的世界。像<code class="fe mp mq mr ms b">OPTIMIZE</code>、<code class="fe mp mq mr ms b">ZORDER</code>、<code class="fe mp mq mr ms b">VACUUM</code>等操作可以极大地改善增量表上的查询时间，并节省存储成本。我计划在以后的文章中介绍这些操作！敬请关注！</p><p id="3c74" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我希望你能从这篇文章中学到一些新的东西。三角洲湖生态系统发展迅速，每次发布都会出现新的功能。</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt ob ms oc od aw oe bi"><span id="113e" class="lr ls it ms b gy of og l oh oi">Want to Connect?</span><span id="d161" class="lr ls it ms b gy oj og l oh oi">Please enjoy more of my <a class="ae ku" href="https://medium.com/@sjrusso" rel="noopener">Medium articles</a> if you found this post helpful<strong class="ms iu"><em class="ok">.</em></strong> I write about data engineering, books, tutorials, and more!</span><span id="3d4d" class="lr ls it ms b gy oj og l oh oi">I'm also on <a class="ae ku" href="https://www.linkedin.com/in/stevenjosephrusso/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</span></pre></div></div>    
</body>
</html>