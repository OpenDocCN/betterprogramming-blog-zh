<html>
<head>
<title>Discord Bots and State Management</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不和谐机器人和国家管理</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/discord-bots-and-state-management-22775c1f7aeb?source=collection_archive---------2-----------------------#2020-08-14">https://betterprogramming.pub/discord-bots-and-state-management-22775c1f7aeb?source=collection_archive---------2-----------------------#2020-08-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bf28" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">确保你的机器人可以随着你的用户扩展</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7047a4f1092bdeba6a904a16f3811dad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BIg5EYoHiFWhI8ze"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> chuttersnap </a>拍摄</p></figure><h1 id="7c1b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">预警</strong></h1><p id="1422" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这篇文章不会只谈论不和谐的机器人，也不是要对他们进行适当的介绍。如果你正在寻找，或者甚至如何创建你自己的机器人，看看<a class="ae ky" href="https://discordjs.guide/" rel="noopener ugc nofollow" target="_blank">https://discordjs.guide/</a>或者看看这个<a class="ae ky" href="https://www.quora.com/What-is-a-discord-bot-What-is-a-discord-server" rel="noopener ugc nofollow" target="_blank"> Quora主题</a>中的一些回复。</p><p id="da8e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要完全理解本文，您需要对JavaScript、MongoDB、Mongoose ODM、Node.js、Promises和Async/Await有所了解，并且需要一些通用编程知识来理解所使用的一些语法。</p><p id="8a85" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我也不会真的触及MongoDB和Mongoose的设置。<br/>如果你需要了解更多，这里有一些链接:</p><ul class=""><li id="db3e" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">了解关于<a class="ae ky" href="https://javascript.info/" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>的更多信息</li><li id="74dd" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">了解更多关于<a class="ae ky" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>和<a class="ae ky" href="https://mongoosejs.com/" rel="noopener ugc nofollow" target="_blank">mongose ODM</a>的信息</li></ul><p id="5747" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，我要深入谈谈我在创建<a class="ae ky" href="https://www.jeetbot.com" rel="noopener ugc nofollow" target="_blank">截拳道</a>时遇到的几个问题。</p><p id="73d3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是一个很长的阅读，所以我把一个TL；博士在最后。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="5e81" class="kz la it bd lb lc nn le lf lg no li lj jz np ka ll kc nq kd ln kf nr kg lp lq bi translated"><strong class="ak">那么，有什么问题吗？</strong></h1><p id="29d1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我为Discord用户和我自己创建一个有用的Discord bot的过程中，我从MongoDB数据库中检索数据的次数太多了。在一个快乐的、自由之地类型的互联网中，所有的读/写都不会花我一分钱。但是在互联网上来回传输数据有时需要钱，我想适当地扩展这个机器人，所以我需要在机器人内部本地保存一些数据。</p><p id="e2ac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">机器人必须关注的事情之一是改变数据库的用户输入。这意味着用户正在主动变更/改变某些选项，这是与机器人所在的其他Discord服务器异步发生的。</p><h2 id="398e" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">这听起来并不难解决…</h2><p id="2858" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我认为我需要在bot初始化时建立一个哈希映射数据结构，并在数据库发生变化时对本地缓存进行更改。但是没那么容易。下面让我描述一下我在尝试这个过程中遇到的情况。</p><p id="898a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我有一个命令处理程序，它接收来自不和谐用户的消息并将其识别为命令:</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="4ad7" class="ns la it of b gy oj ok l ol om">client.on("message", async (msg) =&gt; {<br/>  commandHandler(msg);<br/>});</span></pre><p id="4220" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当一个消息被发送到机器人时，它通过<code class="fe on oo op of b">commandHandler</code>运行消息，然后在特定命令所在的地方结束。但是，它对发送的每条消息都是异步的。</p><p id="3a16" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因此，命令流如下所示:</p><p id="49b1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> index.js → commandHandler →具体命令。</strong></p><p id="8e62" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当我最初设置hashmap，即<code class="fe on oo op of b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map" rel="noopener ugc nofollow" target="_blank">new Map()</a></code>时，它将包含以下数据:</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="9bff" class="ns la it of b gy oj ok l ol om">{<br/>  guild.id: guildDataObject<br/>}</span></pre><p id="a333" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="oq">注:我交替使用“公会”和“不和服务器”。</em></p><p id="7e92" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">但是当我发送包含所有公会信息的<code class="fe on oo op of b">Map</code>对象时，它返回错误。数据没有按时返回，或者卡在栈上等着卸载承诺。</p><p id="ba70" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="oq">注意:目前在1.1.2版本的Jeetbot </em>中，它被赋值为j.edit而不是j.welcomeEdit。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/6ac5a28e198ab8dd2facc7005b395146.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*tBqXzTI-5m3dG06kJr5Dng.jpeg"/></div></figure><p id="25f7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">例如:</p><ol class=""><li id="66a1" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm os my mz na bi translated">不和谐版主在不和谐频道输入<code class="fe on oo op of b">j.welcomeEdit</code>。</li><li id="9a09" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm os my mz na bi translated">机器人识别命令。</li><li id="9f5d" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm os my mz na bi translated">Bot会提示用户输入欢迎消息的新信息。</li><li id="e4a5" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm os my mz na bi translated">Bot等待新的欢迎消息，但是其他消息和新命令堆积在上面。</li><li id="11d4" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm os my mz na bi translated">Discord版主发送响应以更改欢迎消息。</li><li id="347a" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm os my mz na bi translated">Bot接受消息，但承诺不立即按时返回使用。它在队列中等待其他承诺完成。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/c43a32a388cc70833f3a1352db0429ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gbVonU8iUbMfeUXcZEYRLQ.jpeg"/></div></div></figure><p id="ddac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">❌ <code class="fe on oo op of b"><strong class="lt iu">Error: Not Returning The Right Welcome Message.</strong></code> ❌</p><p id="99be" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了让机器人真正使用新消息，我不得不多次调用<code class="fe on oo op of b">j.welcomeEdit</code>,新的欢迎消息才会回到正确的位置。</p><p id="b4e2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">承诺越来越多，却没有一件事按时兑现。在生产环境中，这是不可接受的。</p><h2 id="56f6" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">我有两个主要问题</h2><ol class=""><li id="9bdc" class="ms mt it lt b lu lv lx ly ma ou me ov mi ow mm os my mz na bi translated">每次发送消息时，对数据库进行过多的读取/写入。</li><li id="1b54" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm os my mz na bi translated">我的机器人不会正确返回本地缓存，所以当用户更新他们的数据时，它不会立即更新。</li></ol><p id="4168" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我的直觉是我需要像ReactJS的<code class="fe on oo op of b">useState()</code>这样的东西。由于我没有在这个机器人中制作web应用程序，所以我唯一想到的就是尝试一下Redux.js。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="87c9" class="kz la it bd lb lc nn le lf lg no li lj jz np ka ll kc nq kd ln kf nr kg lp lq bi translated">Redux.js来拯救</h1><p id="7878" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我的一位导师曾在<a class="ae ky" href="https://codechrysalis.io/" rel="noopener ugc nofollow" target="_blank">Code chrysis</a>教我如何编程，他曾经告诉我，“总有一天你会真正需要使用Redux.js。”</p><p id="27b1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当然，我曾经一起使用过ReactJS和Redux.js。我熟悉React应用程序中的钩子和处理状态。但是这个机器人完全独立于Jeetbot团队为其构建的网页运行。因此，花时间看看关于React应用程序如何在JavaScript中构建的文章和架构，我觉得我可能必须用Redux.js做一些类似的事情，以同样的方式处理状态。</p><p id="6e64" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Redux非常适合处理不断变化和异步的全局状态。</p><p id="bb49" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当我规划出我希望机器人如何工作时，控制流最终看起来是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/f2a02ab9a3c226803959da084e16ffee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*kGf8aZAR78QN_cLz6LxHHg.jpeg"/></div></figure><p id="90da" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我的Jeetbot条目从index.js开始，它将初始化redux存储，并将MongoDB上的所有现有数据存储在存储中。</p><p id="b2dc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Jeetbot启动后，它开始监听Discord服务器上发送的事件或命令，而Jeetbot位于不同的服务器上。所有事件目前都在index.js中处理，所有命令都将传递给命令处理程序，然后再传递给命令。</p><p id="74a4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">不和谐服务器→ Index.js → CommandHandler →命令</strong></p><p id="6381" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当触发一个命令来更改存储中的当前数据时，本地存储会更新，MongoDB数据库也会更新。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="841a" class="kz la it bd lb lc nn le lf lg no li lj jz np ka ll kc nq kd ln kf nr kg lp lq bi translated"><strong class="ak">太好了——我们有了一个可行的想法</strong></h1><p id="0ec2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">但是，我如何编写实现这一目标所需的代码呢？我们需要了解Redux是如何工作的。我并不是在做一个React-Redux网站，也不是在试图做一个需要状态来呈现和显示在屏幕上的小应用程序。</p><p id="2baa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在经历了许多痛苦和汗水之后，我找到了Redux Toolkit <strong class="lt iu"> — </strong>的解决方案，这是一个官方的、固执己见的、包含电池的工具集，用于高效的Redux开发。</p><p id="1cf2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你知道口袋妖怪卡片，它本质上是一个预先设定的增强包，里面有你知道如果你正确使用它们会很有用的卡片。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="23aa" class="kz la it bd lb lc nn le lf lg no li lj jz np ka ll kc nq kd ln kf nr kg lp lq bi translated"><strong class="ak">高级视图</strong></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/a3ec92fecf3887b0c407d0cd5c60d393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*MCnEAppefaZm93Wyskmcaw.jpeg"/></div></figure><h2 id="3e9b" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">冗余逻辑</h2><p id="2e82" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这是我们处理所有突变逻辑的地方。在这里，我创建了一些通用的选择器和缩减器来导入程序的其余部分。您很快就会看到我是如何使用它们的。</p><p id="0082" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我在遵循Redux建议的“<a class="ae ky" href="https://github.com/erikras/ducks-modular-redux" rel="noopener ugc nofollow" target="_blank">鸭子</a>”方法论。<em class="oq">(本质上将一个特征的所有冗余逻辑放入一个文件中)。</em></p><p id="505a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> store.js </strong> —这是我们配置商店的地方。它将包括我们的减速器和我们打算使用的任何中间件。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="ba86" class="kz la it bd lb lc nn le lf lg no li lj jz np ka ll kc nq kd ln kf nr kg lp lq bi translated"><strong class="ak">guildslice . js</strong></h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="f1a7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Redux工具包带有漂亮的函数，比如<code class="fe on oo op of b"><a class="ae ky" href="https://redux-toolkit.js.org/api/createEntityAdapter" rel="noopener ugc nofollow" target="_blank">createEntityAdapter</a></code>和<code class="fe on oo op of b"><a class="ae ky" href="https://redux-toolkit.js.org/api/createSlice" rel="noopener ugc nofollow" target="_blank">createSlice</a></code>。这两个函数都使得创建适当的Redux逻辑更加容易。这里我们需要这两种功能，所以我将一起讨论它们。</p><p id="ad93" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">本质上，<code class="fe on oo op of b"><a class="ae ky" href="https://redux-toolkit.js.org/api/createEntityAdapter#crud-functions" rel="noopener ugc nofollow" target="_blank">createEntityAdapter</a></code>附带了针对Redux存储中的突变的CRUD操作(创建、读取、更新、删除),并且附带了<code class="fe on oo op of b">Selector</code>以便您可以在存储中获取数据。</p><p id="4bb1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，我创建了一个<code class="fe on oo op of b">createEntityAdapter</code>的实例或副本，并将其命名为<code class="fe on oo op of b">guildsAdapter</code>。现在，<code class="fe on oo op of b">guildsAdapter</code>可以访问<code class="fe on oo op of b">createEntityAdapter</code>中的其他功能。</p><p id="7f7a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我将使用的方法如下:</p><ul class=""><li id="310e" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated"><code class="fe on oo op of b">guildsAdapter.<a class="ae ky" href="https://redux-toolkit.js.org/api/createEntityAdapter#selector-functions" rel="noopener ugc nofollow" target="_blank">getSelectors()</a></code></li><li id="c6a7" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><code class="fe on oo op of b">guildsAdapter.<a class="ae ky" href="https://redux-toolkit.js.org/api/createEntityAdapter#getinitialstate" rel="noopener ugc nofollow" target="_blank">getInitialState()</a></code></li><li id="4a72" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><code class="fe on oo op of b">guildsAdapter.<a class="ae ky" href="https://redux-toolkit.js.org/api/createEntityAdapter#crud-functions" rel="noopener ugc nofollow" target="_blank">addOne()</a></code></li><li id="241e" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><code class="fe on oo op of b">guildsAdapter.<a class="ae ky" href="https://redux-toolkit.js.org/api/createEntityAdapter#crud-functions" rel="noopener ugc nofollow" target="_blank">removeOne()</a></code></li></ul><p id="141c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在guildsSlice.js的第4行，我创建了自己的<code class="fe on oo op of b">guildsSelector</code>来访问存储中的特定数据。我将这个函数从guildsSlice.js中导出，稍后再导入index.js中使用。</p><p id="ea5a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">看一下第6行，我在那里做了一个<code class="fe on oo op of b">const guildsSlice = createSlice({});</code>。<code class="fe on oo op of b"><a class="ae ky" href="https://redux-toolkit.js.org/api/createSlice" rel="noopener ugc nofollow" target="_blank">createSlice</a></code>功能需要以下输入才能正常工作:</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="d27a" class="ns la it of b gy oj ok l ol om">// A name, used in action types<br/><strong class="of iu">name</strong>: string,</span><span id="4dcb" class="ns la it of b gy pb ok l ol om">// The initial state for the reducer<br/><strong class="of iu">initialState</strong>: any,</span><span id="74bb" class="ns la it of b gy pb ok l ol om">// An object of "case reducers". <br/>// Key names will be used to generate actions.<br/><strong class="of iu">reducers</strong>: Object&lt;string, ReducerFunction | ReducerAndPrepareObject&gt;</span></pre><p id="e1ab" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，我可以通过<code class="fe on oo op of b">guildsAdapter.</code>访问<code class="fe on oo op of b">createEntityAdapter</code>中的所有功能</p><p id="6ac7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们正在处理discord服务器，它们被称为Discord.js中的公会。</p><p id="8dd7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe on oo op of b"><a class="ae ky" href="https://redux-toolkit.js.org/api/createSlice#initialstate" rel="noopener ugc nofollow" target="_blank">initialState</a>: guildsAdapter.getInitialState()</code>——记得我之前说过的<code class="fe on oo op of b"><a class="ae ky" href="https://redux-toolkit.js.org/api/createEntityAdapter#getinitialstate" rel="noopener ugc nofollow" target="_blank">getInitialState()</a></code>方法。它为我们创建了以下数据结构:</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="6082" class="ns la it of b gy oj ok l ol om">{<br/>  // The unique IDs of each item. Must be strings or numbers<br/>  ids: [],<br/>  // A lookup table mapping entity IDs to the corresponding entity<br/>  // objects<br/>  entities: {}<br/>}</span></pre><p id="8eea" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于每个<code class="fe on oo op of b">id</code>，它将引用一个<code class="fe on oo op of b">entity.id</code>，并有一个对象连接到那个<code class="fe on oo op of b">entity.id</code>。</p><p id="b6bd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是我在index.js中使用<code class="fe on oo op of b">store.getState()</code>时数据的样子:</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="f711" class="ns la it of b gy oj ok l ol om">{<br/>  guilds: {<br/>    ids: [<br/>      '276775249180360704', // discord server ID<br/>      '428518913144520704',<br/>      // additional IDs<br/>    ],<br/>    entities: {<br/>      '276775249180360704': [Object], // discord server ID<br/>      '428518913144520704': [Object],<br/>      // additional { IDs: Objects }<br/>    }<br/>  }<br/>}</span></pre><p id="9416" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">接下来，对于<code class="fe on oo op of b">createSlice</code>对象，我们需要我们的<a class="ae ky" href="https://redux-toolkit.js.org/api/createSlice#reducers" rel="noopener ugc nofollow" target="_blank">减速器</a>。</p><p id="a63d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe on oo op of b">guildAdded()</code>、<code class="fe on oo op of b">guildRemoved()</code>和<code class="fe on oo op of b">guildWelcomeMessageUpdated()</code>取当前状态和一个动作。在这个动作中，有一个<code class="fe on oo op of b">action.payload</code>,它实际上是我们在别处调用这个函数时发送的任何东西。<em class="oq">(稍后将详细介绍)</em></p><p id="2681" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在<code class="fe on oo op of b">guildAdded()</code>和<code class="fe on oo op of b">guildRemoved()</code>内有以下内容:</p><ol class=""><li id="252d" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm os my mz na bi translated">我从有效载荷中析构了<code class="fe on oo op of b">_id</code>。</li><li id="fafe" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm os my mz na bi translated">我把它重新命名为<code class="fe on oo op of b">action.payload.id = _id</code>。</li><li id="7a46" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm os my mz na bi translated">我使用<code class="fe on oo op of b">guildsAdapter.addOne</code>(或<code class="fe on oo op of b">.removeOne</code>)以便在数据库中添加了新的Discord服务器(另一个用户添加了Jeetbot)或从数据库中删除了Discord服务器(有人将Jeetbot踢出了他们的服务器)时，商店会更新。</li></ol><p id="8d96" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在<code class="fe on oo op of b">guildWelcomeMessageUpdated()</code>中，我还分解了<code class="fe on oo op of b">_id</code>并寻找<code class="fe on oo op of b">const guild = state.entities[_id]</code>中引用的discord服务器。</p><p id="f175" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">之后，我应用我的逻辑来更新商店中的公会欢迎消息。</p><p id="9d7a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我们将对我们的动作进行更多的分解，以便以后在我们的文件中使用它们。让我们<code class="fe on oo op of b">module.exports</code>一切准备就绪:</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="6f47" class="ns la it of b gy oj ok l ol om">const {<br/>    guildAdded,<br/>    guildRemoved,<br/>    guildWelcomeMessageUpdated,<br/>} = guildsSlice.actions // destructure the actions to use later</span><span id="296f" class="ns la it of b gy pb ok l ol om">module.exports = {<br/>    guildsSelector, // our selector to access the data<br/>    guildsSlice, // our slice adding to the config of the store<br/>    guildAdded, <br/>    guildRemoved,<br/>    guildWelcomeMessageUpdated,<br/>}</span></pre></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="c57e" class="kz la it bd lb lc nn le lf lg no li lj jz np ka ll kc nq kd ln kf nr kg lp lq bi translated"><strong class="ak"> store.js </strong></h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="8a64" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是我们设置配置的地方。大多数架构和逻辑工作都是在guildsSlice.js中完成的。当我们在index.js中设置商店时，它每次都会有这个商店配置。</p><p id="cd9a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们来剖析一下这个。</p><p id="c8cb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">从Redux工具包中，我得到了<code class="fe on oo op of b"><a class="ae ky" href="https://redux-toolkit.js.org/api/configureStore" rel="noopener ugc nofollow" target="_blank">configureStore</a></code>和<code class="fe on oo op of b"><a class="ae ky" href="https://redux-toolkit.js.org/api/getDefaultMiddleware" rel="noopener ugc nofollow" target="_blank">getDefaultMiddleware</a></code>函数。我从guildsSlice.js文件中导入<code class="fe on oo op of b">guildsSlice</code>。</p><p id="5c17" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这里最重要的部分是，我们为商场正确设置了减速器:</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="9160" class="ns la it of b gy oj ok l ol om">module.exports = configureStore({<br/>  reducer: {<br/>   guilds: guildsSlice.reducer<br/>  },<br/>  // other code<br/>});</span></pre><p id="57f2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当在Index.js中初始化存储时，我们将从guildsSlice.js中导出reducers，以便在存储<em class="oq">中识别。</em></p><blockquote class="pc"><p id="3afd" class="pd pe it bd pf pg ph pi pj pk pl mm dk translated">guildslice . js→store . js→index . js是流程。</p></blockquote><p id="47a4" class="pw-post-body-paragraph lr ls it lt b lu pm ju lw lx pn jx lz ma po mc md me pp mg mh mi pq mk ml mm im bi translated">出于开发的目的，<code class="fe on oo op of b">immutableCheck</code>、<code class="fe on oo op of b">serializableCheck</code>和<code class="fe on oo op of b">devTools</code>是很好的选择(你不必在那里写false，因为如果你省略<code class="fe on oo op of b">getDefaultMiddleware()</code>和<code class="fe on oo op of b">devTools</code>，它们将默认为true)。)因为它们为每个被分派的动作花费时间，所以我把它关掉，这样我的程序可以运行得更快。不过，戴上它们来检查你是否坚持Redux方法论还是不错的！</p><p id="1af0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe on oo op of b">module.exports</code>所有这些，我们准备开始在JeetBot的index.js中使用Redux Toolkit。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="c1ed" class="kz la it bd lb lc nn le lf lg no li lj jz np ka ll kc nq kd ln kf nr kg lp lq bi translated"><strong class="ak"> index.js </strong></h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="693b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是Discord.js和Redux.js的有趣之处。</p><p id="548b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">基本上，这段代码执行以下操作:</p><ol class=""><li id="65fb" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm os my mz na bi translated">Jeetbot用Discord检查Jeetbot是否已经被添加到新的服务器中。</li><li id="9940" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm os my mz na bi translated">如果有，新的公会信息被添加到数据库和本地<code class="fe on oo op of b">store</code>。</li><li id="9650" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm os my mz na bi translated">如果bot发现服务器已经存在于数据库中，它会将信息从MongoDB缓存到本地<code class="fe on oo op of b">store</code>以备后用。</li></ol><p id="f22f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">简单吧？但是这里有一条对我们商店来说很重要的线:</p><p id="796e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe on oo op of b">store.dispatch(guildAdded(serverCache(guildInfo)));</code></p><p id="21b7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="oq">注意:我的</em> <code class="fe on oo op of b"><em class="oq">serverCache</em></code> <em class="oq">函数正在返回一个包含Discord服务器ID为</em> <code class="fe on oo op of b"><em class="oq">_id</em></code> <em class="oq">的对象。这没什么特别的，只是我处理数据库的方式——它不是那里的主键。</em></p><ul class=""><li id="67ed" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated"><code class="fe on oo op of b">store</code>是我们拥有一切的全球状态。</li><li id="a9b6" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><code class="fe on oo op of b">store.dispatch</code>是商店上的一个方法，它说“嘿，我们想运行一个动作。”</li><li id="54b9" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">是我在guildsSlice.js中创建的一个reducer。</li><li id="0814" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><code class="fe on oo op of b">guildInfo</code>是我收到的数据，正在传递给减速器。</li></ul><p id="7f67" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">从那里，对于我们的bot中发生的任何命令，我们可以使用我们的<code class="fe on oo op of b">guildsSelector</code>来检查<code class="fe on oo op of b">store</code>。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="7819" class="kz la it bd lb lc nn le lf lg no li lj jz np ka ll kc nq kd ln kf nr kg lp lq bi translated"><code class="fe on oo op of b"><strong class="ak">guildAdded</strong></code>和<code class="fe on oo op of b"><strong class="ak">guildRemoved</strong></code>的例子</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="bc6f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是我们添加一个不和谐公会到商店的另一个例子:</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="b45a" class="ns la it of b gy oj ok l ol om">store.dispatch(guildAdded(serverCache(serverInfo)));</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="9a18" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是另一个公会被移除的例子:</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="781d" class="ns la it of b gy oj ok l ol om">store.dispatch(guildRemoved(serverCache(guildInfo)));</span></pre><p id="91ff" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">太好了，我们现在可以添加到Redux商店了！</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="6e9e" class="kz la it bd lb lc nn le lf lg no li lj jz np ka ll kc nq kd ln kf nr kg lp lq bi translated"><strong class="ak">能够从商店中阅读怎么样？</strong></h1><p id="50cf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这是第一种情况，我们将访问存储中的数据，而不仅仅是从存储中添加/删除数据。在Redux Toolkit文档中，您会看到我们在guildsSlice.js中创建了<code class="fe on oo op of b">guildsSelector</code>。请参考此处的<a class="ae ky" href="https://redux-toolkit.js.org/api/createEntityAdapter#selector-functions" rel="noopener ugc nofollow" target="_blank">以查看可用的选择器方法。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="eecd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在第3行，我们可以在商店里抓取一个不和谐公会的深层克隆。</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="17ae" class="ns la it of b gy oj ok l ol om">guildsSelector.selectById(store.getState(), member.guild.id));</span></pre><p id="ff9a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe on oo op of b">guildsSelector</code> —我们之前从guildsSlice.js中导入的内容。它是createEntityAdapter的一部分，其中有一个方法叫做…</p><p id="aa94" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe on oo op of b">.selectById(state, entity.id)</code> —它需要两个参数。我们想要获取的对象的当前状态和不一致服务器ID。</p><p id="3290" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe on oo op of b">store.getState()</code>是我们检索商店当前状态的方式。</p><p id="e7f5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe on oo op of b">member.guild.id</code>是一个Discord.js对象，用于查找成员的消息和他们发送消息的Discord服务器ID。</p><p id="7562" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在我获得特定Discord服务器的数据后，我可以运行我的逻辑来查看是否有Discord服务器的管理员或版主设置的欢迎消息。</p><p id="fc08" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">太好了！现在，我可以从我的存储中读取我的机器人所在的所有discord服务器的欢迎消息。但是如果用户想要定制一条消息呢？</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="c1f9" class="kz la it bd lb lc nn le lf lg no li lj jz np ka ll kc nq kd ln kf nr kg lp lq bi translated">状态管理时间</h1><p id="e70d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">继续下面的代码是Redux.js的真正魅力。如果不能管理全局状态，我将很难找到所有这些的解决方案。</p><p id="d2c5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你还和我在一起，让我们继续！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="9973" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是我最初的问题所在。在普通的JavaScript中，或者至少在我使用Discord.js的应用程序的当前结构中，我在之前存储变量的位置发送了一个对象。即使我这样做了<code class="fe on oo op of b">await commandHandler(msg, localStore)</code>，也无法及时返回以让新数据出现在本地。所以这一次，我将发送<code class="fe on oo op of b">async (msg)</code>和<code class="fe on oo op of b">store</code>。</p><p id="d4ed" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> commandHandler文件夹(index.js) </strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="2b81" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">机器人检查是否有正确的命令被发送到机器人。如果是，则继续执行此调用中发送的特定命令。</p><p id="28be" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe on oo op of b">PREFIX = j.</code>和<code class="fe on oo op of b">command = welcomeEdit</code></p><p id="738c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">用户在<code class="fe on oo op of b">j.welcomeEdit</code>中输入，这个流程将把用户带到代码的编辑命令。</p><p id="5f72" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="oq">注意:在1.1.2版本的Jeetbot </em>中，它目前被指定为j.edit而不是j.welcomeEdit。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/9f1850df2c2cdd295f4cecf3e7378f01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*YHzN6nrXr83XETACnxzCug.jpeg"/></div></figure><h2 id="b47b" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated"><strong class="ak"> edit.js </strong></h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="e1e2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这一点上，我们离index.js文件有一点距离，除此之外，更多的消息正在飞向<code class="fe on oo op of b">commandHandler</code>文件，以检查它们是否是合法的命令。当我们等待用户输入消息时，其他服务器上的承诺正在建立，需要解决！</p><p id="ef63" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当我先前输入一个常规对象并试图返回它时，在用户完成输入新的欢迎消息的提示后，我的本地缓存没有更新。</p><p id="ab8f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这一次，我导入了动作<code class="fe on oo op of b">guildWelcomeMessageUpdated</code>，我们在商店上分派了动作，我们基本上完成了我们想要做的事情。</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="ce8a" class="ns la it of b gy oj ok l ol om">store.dispatch(guildWelcomeMessageUpdated(serverCache(guildInfo)));</span></pre><p id="006a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这里有很多不同的事情在进行，但最重要的是，这个程序按预期工作！通过向我的商店发送一个动作，它更新了全局状态，我可以立即使用用户输入的新数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/c311eaea54262150cdf30ea1dd3db73f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*cb5L29vbHFv72f76zWXYVQ.jpeg"/></div></figure><p id="7159" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">咻！</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><p id="5697" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你已经到了这一步，我希望我能够传授一些知识或者重申一些你一直在思考的事情。</p><p id="844a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我非常感谢维护<a class="ae ky" href="https://discord.js.org/#/" rel="noopener ugc nofollow" target="_blank"> Discord.js </a>和<a class="ae ky" href="https://redux-toolkit.js.org/" rel="noopener ugc nofollow" target="_blank"> Redux ToolKit </a>的团队。还要特别感谢Discord上的<a class="ae ky" href="https://discord.gg/reactiflux" rel="noopener ugc nofollow" target="_blank">react flux</a>社区，特别是phryneas#4779和acemarke#9340在建立Redux商店时指引了我正确的方向。</p><p id="bb55" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">不久前，我还不知道如何正确编码，但谢天谢地，在<a class="ae ky" href="https://www.codechrysalis.io/" rel="noopener ugc nofollow" target="_blank">代码蛹</a>和他们沉浸式编码训练营的帮助下。我能够找到自信和能力来批判性地思考我的代码，并在出现问题时迅速寻求解决方案。</p><p id="70e4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为你的应用程序创建你自己的redux商店时，试着遵循<a class="ae ky" href="https://redux.js.org/style-guide/style-guide" rel="noopener ugc nofollow" target="_blank"> Redux风格指南</a>。这是格式化Redux商店的好方法。一旦点击，它就会像盒子里的任何工具一样。需要的时候就用。</p><p id="e72a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我希望这是一个教育职位的人需要它。</p><p id="07f2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果有另一种解决方案，我很乐意深入研究，再尝试一些。但是通过这次经历，我觉得我在成为一名更好的程序员的道路上又前进了一步。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="3f74" class="kz la it bd lb lc nn le lf lg no li lj jz np ka ll kc nq kd ln kf nr kg lp lq bi translated">TL；博士——我有两个大问题</h1><ol class=""><li id="fe22" class="ms mt it lt b lu lv lx ly ma ou me ov mi ow mm os my mz na bi translated">对数据库的读取/写入太多。</li><li id="f30f" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm os my mz na bi translated">异步状态突变没有正确返回。</li></ol><p id="0777" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我用Redux工具包解决了这些问题。</p><p id="8807" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我的机器人缓存本地数据并正确处理全局状态。</p></div></div>    
</body>
</html>