# 2021 年创业公司快速发展的 9 条 DevOps 规则

> 原文：<https://betterprogramming.pub/9-devops-rules-for-startups-to-move-fast-in-2021-5fca2158b001>

## 使用这些规则快速行动，重新思考传统的精益创业智慧

![](img/3198f5ab71dd2bae0927953a7049cb65.png)

马里奥·高在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

# 快速行动势在必行

我最近读了杰夫·迈耶森的《[快速行动:脸书如何构建软件](https://www.amazon.com/Move-Fast-Facebook-Builds-Software-ebook/dp/B093HMJ4KB)》，书中介绍了脸书如何构建软件。特别是，它着眼于脸书如何不同于其他公司，如谷歌。这本书的主要观点(你可能已经从标题中推断出)是，脸书成功的关键是优化速度，有时是以极端的方式。这种想法最极端的表现是*脸书直到 2009 年*都没有任何单元测试。事后看来，他们可能等得太久了，但是他们能够在没有测试自动化的情况下茁壮成长的事实与传统的软件工程智慧背道而驰。

这本书最后鼓励其他人重新思考今天的最佳实践，以便他们能够比上一代公司走得更快。然而，迈耶森把这个问题留给了读者。这个问题是任何一个在 2021 年创业的人都特别感兴趣的。在这里，我们从 DevOps 的角度来研究它，并讨论传统的精益创业智慧是如何走得太远的。然后，我们从今天开始为公司提出新的目标，并为构建良好的自动化和基础设施提供实用指南。遵循这里的规则，创业公司将能够比以往任何时候都走得更快。

# 精益创业哪里出错了

精益创业中的传统创业智慧指出，你应该构建一个最小可行产品(MVP)来了解客户想要什么，并尽快实现产品/市场匹配。一个真正的最低可行产品被认为是令人尴尬的低质量或者甚至不是真正的软件(例如，展示软件如何运行的视频)。这一想法彻底改变了初创公司，并大幅减少了浪费性的开发。

从概念上讲，避免不在吸引客户的关键路径上的工作是正确的做法。当人们走得太远，制造出如此小的产品，以至于增加了失败的风险时，问题就来了。如果没有通过自动化手动任务和使用可伸缩的基础设施来优化开发周期时间，就会出现这种情况。对于星际迷来说，这就像只建造小狗(最弱但最便宜的单位)而没有投资更先进的技术。刚开始会比较快，但是时间短了很快就让你处于劣势。

DevOps 技术的最新进展也使得从一开始就在软件中构建自动化和可伸缩性变得前所未有的容易。当精益创业在 2011 年首次发布时，在 MVP 中不包括太多自动化是有意义的，因为它很可能会在吸引客户的道路上净减速。对于今天刚刚起步的创业公司来说，这个等式已经改变了。从第一天开始使用最新 DevOps 技术的开销就足够低，这更有可能降低到达跑道尽头的风险。在 2021 年，我们需要一种快速发展的新模式:*最少的功能，强大的自动化和基础设施。*

# DevOps 规则

使用 DevOps，您可以做很多事情，并且很容易就能进入兔子洞。与此同时，也很容易以保持精益的名义踢罐子。取得恰当的平衡是困难的。以下目标是一个很好的起点，对于一家新公司来说，通过适度的努力应该可以实现:

*   自动化开发人员在达到产品/市场适合度之前将多次执行的手动任务。
*   优化最短的开发周期时间。
*   在对应用程序进行更改时，尽量减少开发人员在基础设施和部署方面的工作量。
*   避免开发和生产之间的任何滞后或批量变更。
*   在吸引客户之前，降低可能需要重大重构的风险。
*   避免在增加更多开发人员时导致生产力显著下降的架构。
*   不要让自己暴露在可能搞垮公司的安全风险中。

这些目标是抽象的，但是你可以通过下面的九条规则来实现它们。

# 1.使用基础设施即代码

基础设施即代码背后的想法是使用像 [Terraform](https://www.terraform.io/) 这样的系统，用声明性语言编写所有的基础设施配置。这允许您使用版本控制并享受它的所有好处，包括代码审查、变更跟踪等。

然而，基础设施即代码对于初创公司的最大优势在于，它允许您在几分钟内重建整个基础设施。成熟的公司不经常需要这样做，但通常在早期会想吹走并重新启动一切，或者建立一个环境的副本来进行测试。

使用 Terraform 开发您的基础设施比在 AWS 或其他云提供商中手动设置更多工作，但这种努力将很快获得回报，因为通常会变得繁琐和容易出错的更改仍然很简单。

使用基础设施即代码还有另一个微妙但强大的好处:它迫使您精通 DevOps。起初，这可能会让你感觉慢下来，但是学习用代码构建基础设施将会让你快速迭代。

# 2.无服务器运行

直到最近，没有管理服务器就无法运行服务。AWS Lambda 改变了这一点。现在可以完全通过代码部署服务，并将基础设施管理委托给云提供商。

这省去了设置扩展配置和更新系统的大量麻烦。它还提供了开箱即用的良好安全性和可靠性。

尽管有其优势，无服务器技术仍处于初级阶段，可能很难用 Terraform 建立复杂的应用程序。

[组织大型无服务器应用程序的最佳实践](https://aws.amazon.com/blogs/compute/best-practices-for-organizing-larger-serverless-applications/)描述了一些设计大型无服务器应用程序的方法。为每个 API 端点设置单独的 Lambda 会带来管理和部署方面的挑战，而让单个 Lambda 路由到不同的 API 端点会失去无服务器技术的许多优势。

尽管如此，对于新的应用程序，你应该强烈地考虑使用无服务器，因为技术也会随着时间的推移而改进。

除了 API 端点之外，您应该认真考虑放弃用于登录页面和内容管理的服务器。 [Gatsby](https://www.gatsbyjs.com/) 、 [Netlify](https://www.netlify.com/) 和 [Netlify CMS](https://www.netlifycms.org/) 让构建 React 网站变得前所未有的简单，该网站的内容可由非开发人员通过实时预览进行编辑。

每当 GitHub 中有提交时，Netlify 就会在其 CDN 中部署更新(这将在 CMS 更新的后端自动发生，无需编辑人员访问 GitHub)，甚至可以在不同的分支之间运行 A/B 测试。

这种设置可自动适应大量流量，而无需管理任何基础设施。Gatsby 有一个丰富的入门网站库，允许你在一天中以非常高的页面速度分数开始运行。

# 3.使用容器

在你需要管理服务器的情况下， [Docker](https://www.docker.com/) 让快速构建和更新系统变得前所未有的简单。Docker 允许您快速建立复杂的基础设施，并在进行更改时在几秒钟内重建容器。AWS [最近宣布](https://aws.amazon.com/blogs/aws/new-for-aws-lambda-container-image-support/)你现在可以在 Lambda 上使用自定义 Docker 镜像，这也允许你不用服务器。

# 4.编写至少一个单元、集成和端到端测试

当构建 MVP 时，自动化测试通常是砧板上的第一件事。这不一定是坏事，因为编写测试需要时间，而且客户不会购买测试。

然而，对于开发人员来说，能够为新产品编写测试是非常重要的。这可以通过使开发人员能够编写测试来立即节省时间，因为这样做比重复的手动运行更快，这只有在测试基础设施到位的情况下才有可能。

如果您没有测试基础设施，您还会冒构建不可测试的软件的风险，这可能会产生严重的问题。很难预测什么时候你需要好的测试，你最不希望的就是在达到产品/市场匹配之前需要痛苦的重构。

最后，也是最重要的，零测试将会阻止您真正的自动化部署。在《快速行动》一书中，迈耶森描述了脸书的开发人员受到了不好的“报应”,因为他们在推动变更后无法修复错误。要真正快速地前进，开发人员不应该在大部分时间里担心部署。为此，他们需要编写测试的能力。

首先从测试金字塔的每一层至少实现一个测试:单元、集成和端到端。这应该不会太难，并且将使开发人员能够对测试做出更好的成本/收益决策，从而逐步加快未来的迭代。

# 5.使用 CI/CD 系统进行部署

大多数软件从手动部署开始。设置持续集成/持续部署(CI/CD)系统需要一些工作，并且单个部署可能只需要几分钟。

然而，这个时间很快就会累积起来，现在是开发人员可以花时间来构建新功能的时候了。与其一开始就浪费时间，不如硬着头皮马上设置 CI/CD。(这不适用于“基础设施即代码”,在这种情况下，CI/CD 对于当前的技术来说可能太难了。)这也将暴露出架构或构建稳定性的潜在问题，等待的时间越长就越难修复。

# 6.在当地发展

随着最近像 [LocalStack](https://github.com/localstack/localstack) 这样的系统的进步，现在可以在本地运行相当复杂的架构，包括 AWS 提供的大部分服务。这种方法有许多好处:

*   **资源隔离** : 本地开发保证了开发者在共享资源的情况下不互相踩对方的脚趾。这进一步降低了由应用程序实例之间的干扰导致的不确定的应用程序行为和不可靠的测试的风险。
*   更容易的基础设施变更:如果基础设施在本地运行，开发人员有充分的权限进行变更，并且可以更有效地进行变更。
*   **更好的性能**:在本地工作可以避免网络瓶颈，网络瓶颈会显著降低开发速度，尤其是在互联网连接缓慢或断断续续的情况下。
*   **更轻松的入职** : 在本地运行系统消除了为每个新开发人员配置云基础设施的需要，从而加快了入职速度。
*   **默认安全** : 您应该已经将生产和测试环境分开，并遵循其他安全实践，但是本地开发默认提供了安全性，因为您没有访问云。

虽然本地开发可能有所帮助，但这项技术仍处于起步阶段。在某些情况下，您可能仍然希望使用云服务，包括:

*   **与生产的对等性不足** : 像 LocalStack 这样的工具试图忠实地表示 AWS 中的真实服务，但是有一些特质。性能自然也会有所不同。如果您的工作需要真正的奇偶校验(例如，负载测试)，您可能仍然需要基于云的环境，尽管这并不妨碍您在本地环境中执行其他任务。
*   **连接到 AWS 之外的第三方服务**:大多数服务没有本地仿真。但是，您可能希望创建第三方服务的模拟版本来实现一些本地开发，这也有助于在构建过程中进行端到端测试，而无需外部依赖。(当构建由于不可靠的第三方服务而失败时，这真的很糟糕。)
*   **存储第三方服务的共享凭证**:如果您使用共享凭证连接到第三方服务，那么您需要将它们存储在某个地方。像 AWS Secrets Manager 这样的工具比手动管理机密要容易得多，当然，也比将机密签入存储库要好。(您可以使用 LocalStack 运行 Secrets Manager，但是这样您就必须将秘密本身存储在本地，这仍然是一个问题。)
*   **获取测试数据集**:如果您的应用程序需要太大的测试数据集，以至于不能作为固定设备签入到存储库中，那么将它们存储在一个共享的位置是有意义的，比如 S3 桶。
*   **资源密集型应用**:如果你正在开发一个由于缺乏资源而无法在本地计算机上运行的应用，那么你可能不得不在云中运行它。

您应该避免的一件事是，在不同的人需要访问应用程序的开发版本的演示或场景中，依赖基于云的开发。相反，CI/CD 系统应该能够为此目的创建分段构建。

# 7.使用自动错误监控和通知

MVP 有很多错误，错误会赶走客户。最好是在客户(或者更糟，投资者)之前发现错误。早期的团队经常定期检查他们的分析仪表板，以确保一切正常。

不断地轮询信息会浪费宝贵的时间，而这些时间可以用于特性迭代，并且在错误发生和检测之间仍然会留下潜在的巨大差距。

从一开始，新产品就应该推出关于重要错误条件的信息。开发人员应该对沉默感到舒服，并相信事情正在进行，而不需要主动检查任何日志或报告。这使他们能够不间断地工作，同时在出现问题时仍能快速响应。

像自动化的其他领域一样，错误监控和检测很容易走得太远。以下检查相对容易设置，是一个很好的起点:

*   使用像 [CloudWatch](https://aws.amazon.com/cloudwatch/) 这样的服务对所有可能关闭服务的关键资源发出警报，如 CPU、内存、磁盘空间等。(如果您选择无服务器，就可以避免这种情况。)
*   前端和后端异常跟踪系统，如 [NewRelic](http://newrelic.com/) 和 [TrackJS](https://trackjs.com/) 。为了减少噪音，您需要设置阈值并过滤不重要的异常。(参见[如何大规模管理例外](/how-to-manage-exceptions-at-scale-c0ee5bef05e1)，了解我们如何将此与 Collage.com 的通知流程相集成。)
*   服务错误率警报，特别是 5xx，它为异常跟踪提供了支持。
*   外部服务 ping 使用类似于 [NewRelic](http://newrelic.com/) 的东西来确保即使没有内部警报，您的服务也是可达的。

设置这些错误监控工具的一种方法是让它们向电子邮件推送警报。不要这样。要求开发人员检查他们的电子邮件(或者更糟，打开电子邮件通知)并不比必须检查仪表板好多少。

即使只有一个开发人员，也值得建立一个像[page duty](https://www.pagerduty.com/)这样的通知系统。这将使重要的错误冒泡到顶部，同时最小化噪声。随着团队的成长，它还可以防止向多人发送垃圾邮件警报，同时仍然通过回退通知提供安全性。

# 8.隔离生产

当您获得第一批客户时，将生产数据用于开发的想法非常诱人。真实数据更丰富，使用它可以让您看到您的功能在客户眼中是什么样的。

以任何方式将开发与生产连接起来(即使在开发系统上拥有仅用于读取数据的凭证)的明显缺点是，它有发生灾难性错误或安全事故的风险。然而，更大的问题是，真实数据是不稳定的，可能会改变或消失，这可能会让你处于不利的境地。

投资于一个好的测试数据集(它可能从生产中复制匿名信息)并完全切断开发和生产之间的任何接口，将使您从可能在关键时刻减慢您速度的约束和风险中解放出来。

# 9.遵循良好的安全实践

在构建 MVP 时，安全性可能是任何人都不会想到的事情。在所有导致初创公司死亡的原因中，数据泄露和勒索软件可能不会排在前列。但是，由于实现适当的安全实践很容易，为什么要冒这个风险呢？如果您的任何客户是企业，您可能还需要回答有关安全性的问题，或者在将来的某个时候接受审计。匆忙清理不良做法远比从一开始就保持干净要困难得多。以下是一些基本的安全实践，您可以毫不费力地遵循:

*   对所有提供双因素身份验证的服务使用双因素身份验证。
*   使用密码管理器和随机生成的密码。
*   永远不要将凭据、API 令牌或机密签入代码。使用本地文件或系统，比如 AWS Secrets Manager 。
*   选择像 [AWS 身份和访问管理(IAM)](https://aws.amazon.com/iam/) 这样的系统，它们提供有时间限制的凭证，而不是使用基本的密码认证。
*   加密一切。这包括所有本地系统的全磁盘加密、数据库加密以及所有连接的 SSL/TLS 或 SSH。在配置这些服务时，加密只是一个检查框，对性能的影响可以忽略不计
*   除非绝对必要，否则不要允许对系统的任何直接网络访问。请改用堡垒配置，并要求登录时进行双因素身份验证。如果您必须允许第三方 ETL 提供者之类的外部数据库连接，那么只将单个 IP 地址列入白名单。
*   如果开发不完全是本地的，使用单独的 AWS 帐户进行开发。即使您尝试在生产帐户中创建单独的资源和有限的开发凭据，也难免会出错，因此单独的帐户更安全。

# 这真的值得吗？

上面概述的规则是可以通过适度的努力实现的。对于一个简单的应用程序，一个经验丰富的 DevOps 工程师可能需要几周的时间来实现这些实践。

对于无法接触到这类人的初创公司，一名普通工程师可能需要几周时间来学习和实施这些指导方针。

虽然几周时间不算长，但也不是免费的。一家初创公司不遵循这里列出的任何实践当然也有可能成功，而且许多风险不太可能成为现实。毕竟，像脸书这样的初创公司在没有任何最新技术的情况下也能生存下来。

在健壮的 DevOps 上投入宝贵的资源真的值得吗？

这种观点的第一个问题是，与成功相比，尸体的踪迹更难被发现。缓慢的开发周期和技术债务可能已经杀死了许多公司，但我们很少看到失败的事后证明，尽管事实上它们更常见。

同样重要的是，要考虑精益创业背后的动机，并构建一个最小可行的产品。您应该避免过度构建质量的原因是，如果客户不想要 MVP，它将被扔掉。如果为每个产品实现 DevOps 需要几个星期的时间，那么这样做很可能是个坏主意。

然而，进入 DevOps 的工作从根本上不同于浪费的产品开发工作，因为它大部分是建立*组织*的能力，而不是产品。

如果你转而卖汉堡包，那么这一切可能都是浪费。但是，如果客户不喜欢一家初创公司的第一个网络应用，下一个产品可能仍然会涉及某种云软件。

在实现这里的实践所需的工作中，只有一小部分(可能 10–20%)是特定于应用程序的，其余的将帮助您在下一次转向后立即投入运行。

遵循良好的 DevOps 实践可能会拯救公司，并让它在*快速行动*的书中书写下一章。