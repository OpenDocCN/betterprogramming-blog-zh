<html>
<head>
<title>Schedule Cron Jobs With GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub操作调度Cron作业</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/schedule-cron-jobs-with-github-actions-d279e8519cec?source=collection_archive---------9-----------------------#2022-11-21">https://betterprogramming.pub/schedule-cron-jobs-with-github-actions-d279e8519cec?source=collection_archive---------9-----------------------#2022-11-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7e9d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们过去常常使用我们非常熟悉的工具，不考虑缺点或成本，但现在，我们可以访问帮助我们的惊人平台</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8ac5d231e99a363ac2bb166dcaec72e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ajEFELTAQdrffd9x"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@okcdz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">陈奕迅</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="b703" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通常，当我和同事谈论计划任务时，首先想到的是芹菜。我必须承认这是一个强大的工具，但在许多情况下，它可能会太强大，或者需要太多的资源。这就是为什么不久前，我开始测试标准队列解决方案的替代方案。在我的上一篇文章中，我向您展示了如何使用Kubernetes来替换您当前的配置，这次我想使用GitHub Actions再做一次。</p><h1 id="2886" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">GitHub操作</h1><p id="1d9d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">GitHub action是微软创建的一个CI/CD平台，提供自动化的管道(工作流)来构建、测试和部署你的应用。在本文中，我想向您展示如何使用GHA来替换您当前的cron配置。最显著的优势之一是免费使用动作(有限制)。</p><h2 id="2db3" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">管道</h2><p id="9670" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">简而言之，管道是我们需要执行的一系列步骤，以交付新版本的应用程序。管道通常包含构建、自动化测试和代码分析器(持续集成)等步骤，但也包含将我们的应用程序部署到服务器的自动化方式(持续部署)。</p><h2 id="a3d7" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">工人</h2><p id="edd0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">它只是一台用于运行您的工作流程的机器。默认GitHub works没有持久内存，运行过程中所有数据都可用。稍后我会告诉你如何处理它。</p><h2 id="c4d1" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">句法</h2><p id="1404" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">GitHub工作流程是使用YAML文件创建的。每个工作流都定义了我们管道的一些重要属性:</p><ul class=""><li id="2771" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated"><code class="fe nk nl nm nn b">on</code>(触发器)</li><li id="c339" class="nb nc iq ky b kz no lc np lf nq lj nr ln ns lr ng nh ni nj bi translated"><code class="fe nk nl nm nn b">jobs</code>(步骤——我们工作流程的操作)</li><li id="309f" class="nb nc iq ky b kz no lc np lf nq lj nr ln ns lr ng nh ni nj bi translated"><code class="fe nk nl nm nn b">names</code>等。</li></ul><p id="5fe2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完整语法可在此处获得:<a class="ae kv" href="https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions" rel="noopener ugc nofollow" target="_blank">https://docs . github . com/en/actions/using-workflows/workflow-syntax-for-github-actions</a>。</p><h2 id="8ff1" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">扳机</h2><p id="b71d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在我们开始之前，让我们谈谈触发器。GitHub提供了多种类型的触发器，可以用来启动管道。如果你熟悉事件，可能你见过类似于<code class="fe nk nl nm nn b">push</code>或<code class="fe nk nl nm nn b">commit</code>的触发器。为了达到我们的目标，我们将使用<code class="fe nk nl nm nn b">schedule</code> — <a class="ae kv" href="https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#schedule" rel="noopener ugc nofollow" target="_blank">基于GitHub文档</a>，使用POSIX cron语法，您可以定义您的cron将被启动的时间，例如<code class="fe nk nl nm nn b">*/10 * * * *</code>将每十分钟运行您的作业。</p><p id="8f58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您需要cron扩展方面的帮助，请查看—<a class="ae kv" href="https://crontab.guru/" rel="noopener ugc nofollow" target="_blank">https://crontab.guru/</a>。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="ce61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好吧！理论够了。让我们创建我们的第一个工作流。</p><h1 id="22d6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">你好世界</h1><p id="1678" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们从一些基础开始。我们将首先创建一个管道来向命令行显示消息。看起来是这样的:</p><pre class="kg kh ki kj gt oa nn ob bn oc od bi"><span id="36f2" class="oe lt iq nn b be of og l oh oi">---<br/>name: "Workflow example"<br/>on:<br/>  schedule:<br/>    - cron: '*/10 * * * *'<br/><br/>jobs:<br/>  hello:<br/>    name: "Say hello"<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - name: Display message<br/>        run: echo "Hello from GitHub Actions!"</span></pre><p id="c51d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看起来很简单，对吧？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/533029952c55398e28d81fb4466f7327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_lLynqGL3SPS2zguw_ARGg.png"/></div></div></figure><h1 id="c620" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">计算机编程语言</h1><p id="a154" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在，我们将使它变得复杂一点。这次我们想运行我们的Python脚本。</p><pre class="kg kh ki kj gt oa nn ob bn oc od bi"><span id="7920" class="oe lt iq nn b be of og l oh oi">from datetime import datetime<br/><br/>with open('file.txt', 'w') as f:<br/>    f.write(f"JOB DONE {datetime.now()}")<br/></span></pre><p id="7c69" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的工作流程需要几个额外的步骤。首先，我们需要将我们的存储库克隆到我们的worker中。为此，我们可以使用<a class="ae kv" href="https://github.com/marketplace" rel="noopener ugc nofollow" target="_blank"> GitHub Marketplace </a>上可用的操作之一。</p><pre class="kg kh ki kj gt oa nn ob bn oc od bi"><span id="19d4" class="oe lt iq nn b be of og l oh oi">- name: Checkout repository<br/>  uses: actions/checkout@v2</span></pre><p id="6be0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步需要设置和配置Python。使用action，我们可以选择计划使用的Python版本。在这一步之后，您可以安装额外的需求(包)。最后一步是运行我们的脚本。</p><pre class="kg kh ki kj gt oa nn ob bn oc od bi"><span id="c759" class="oe lt iq nn b be of og l oh oi"> - name: Setup python<br/>   uses: actions/setup-python@v2<br/>   with:<br/>    python-version: '3.10.6'<br/> #Optional, you can also update pip before installing dependencies<br/> - name: Install dependencies<br/>   run: pip install -r requirements.txt<br/> - name: Run python script<br/>   run: python job.py</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/fd1f9910401807f80845c5a98ef5392f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TxDS7czHDMIzp1VSQL58sA.png"/></div></div></figure><p id="624a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">厉害！我们的管道正在工作，我们可以在命令行中看到结果，但是缺少了一些东西。因此，我们应该得到一个文件。怎么才能拿到？</p><p id="3709" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我想给你介绍一些艺术品。这些允许您在工作完成后保存工作流程的结果。每个工作流(成功的或失败的)都可以包含运行过程中产生的工件。您还可以使用工件在作业之间共享数据，但是在我们的例子中并不需要。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/cb97142e188be075a4587a2a6d18f548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RLBT1G6le1C--V789IssPA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">您可以下载zip文件形式的工件。</p></figure><p id="36aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一切都按预期运行，因此我们最终的工作流将如下所示:</p><pre class="kg kh ki kj gt oa nn ob bn oc od bi"><span id="90ca" class="oe lt iq nn b be of og l oh oi">---<br/>name: "Workflow example"<br/>on:<br/>  schedule:<br/>    - cron: '*/10 * * * *'<br/><br/>jobs:<br/>  python-job:<br/>    name: "Python job"<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - name: Checkout repository<br/>        uses: actions/checkout@v2<br/>      - name: Setup python<br/>        uses: actions/setup-python@v2<br/>        with:<br/>          python-version: '3.10.6'<br/>#     If you need to install extra packages<br/>#     - name: Install dependencies<br/>#       run: pip install -r requirements.txt<br/>      - name: Run python script<br/>        run: python job.py<br/>      - name: Upload file as artifact<br/>        uses: actions/upload-artifact@v3<br/>        with:<br/>          name: job-result<br/>          path: file.txt</span></pre><h1 id="cb6f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="6055" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如你所见，这并不困难。最重要的是你可以免费测试。GitHub允许你用一个免费账户运行长达2000分钟的动作，无需添加任何支付信息。那么，你还在等什么？</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="78e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">敬请关注更多内容。我希望你喜欢我的其他文章。</p></div></div>    
</body>
</html>