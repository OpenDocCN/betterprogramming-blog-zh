<html>
<head>
<title>Parallel Sentence Alignment in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的平行句对齐</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/parallel-sentence-alignment-in-python-3ca022d7d3d7?source=collection_archive---------8-----------------------#2021-10-12">https://betterprogramming.pub/parallel-sentence-alignment-in-python-3ca022d7d3d7?source=collection_archive---------8-----------------------#2021-10-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="25ca" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用基于机器翻译的句子对齐工具</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/70e5b64161215a8ed3df7f5459e5f580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nkm-Hy6WHR9tzbrFU-LOBQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@poloska25?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> michal dziekonski </a>在<a class="ae ky" href="https://unsplash.com/s/photos/align?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="8856" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过阅读这篇文章，你将学会对齐两个单语文件中的平行句子(有序的句子，但没有正确对齐)。假设你有下面的英语句子(摘自弗朗兹·卡夫卡的《变形记》的英译本)</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ef3a" class="ma mb it lw b gy mc md l me mf">One morning, as Gregor Samsa was waking up from anxious dreams, he discovered that in bed he had been changed into a monstrous verminous bug.</span><span id="931a" class="ma mb it lw b gy mg md l me mf">He lay on his armour-hard back and saw, as he lifted his head up a little, his brown, arched abdomen divided up into rigid bow-like sections.</span><span id="47a0" class="ma mb it lw b gy mg md l me mf">From this height the blanket, just about ready to slide off completely, could hardly stay in place.</span><span id="e3e6" class="ma mb it lw b gy mg md l me mf">His numerous legs, pitifully thin in comparison to the rest of his circumference, flickered helplessly before his eyes.</span><span id="b2ea" class="ma mb it lw b gy mg md l me mf">"What's happened to me," he thought.</span><span id="0238" class="ma mb it lw b gy mg md l me mf">It was no dream.</span></pre><p id="1922" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和相应的意大利语句子如下:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1b6e" class="ma mb it lw b gy mc md l me mf">Gregorio Samsa, svegliandosi un mattino da sogni agitati, si trovòtrasformato, nel suo letto, in un enorme insetto immondo.</span><span id="4be5" class="ma mb it lw b gy mg md l me mf">Giacevasulla schiena, dura come una corazza e, sollevando un po' latesta, vide un addome arcuato, scuro, attraversato da numerosenervature.</span><span id="f280" class="ma mb it lw b gy mg md l me mf">La coperta, in equilibrio sulla sua punta, minacciavadi cadere da un momento all'altro; mentre le numerose zampe,pietosamente sottili rispetto alla sua mole, gli ondeggiavanoconfusamente davanti agli occhi.</span><span id="5a7d" class="ma mb it lw b gy mg md l me mf">"Che mi è successo?" pensò.</span><span id="2527" class="ma mb it lw b gy mg md l me mf">Non era un sogno.</span><span id="f103" class="ma mb it lw b gy mg md l me mf">La sua camera, unavera camera per esseri umani, anche se un po' piccola, stava benferma e tranquilla tra le sue quattro note pareti.</span></pre><p id="35d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我注意到英语和意大利语的句子都没有逐行对齐，因为翻译的版本使用了分号(；)把两个句子合二为一。</p><p id="5449" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果您打算训练机器翻译模型，这个数据集是不可用的，因为翻译的句子偏移了一行。在正常情况下，您总是可以手动修复它，但对于以数百万句计算的大型语料库来说，这可能是压倒性的。</p><p id="dd25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来探索如何通过一个名为<a class="ae ky" href="https://github.com/rsennrich/bleualign" rel="noopener ugc nofollow" target="_blank"> Bleualign </a>的Python包创建包含对齐句子的原始数据集的子集。</p><h1 id="81bb" class="mh mb it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">Bleualign</h1><p id="5ac8" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">这个Python包有助于在句子级别上对齐和配对源文本及其翻译的目标文本。然而，它要求源文本事先被自动翻译，以便与翻译文本进行比较。此外，句子不能被打乱，要按顺序排列。</p><h2 id="3464" class="ma mb it bd mi nd ne dn mm nf ng dp mq li nh ni ms lm nj nk mu lq nl nm mw nn bi translated">设置</h2><p id="fbec" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">强烈建议您在继续之前设置一个虚拟环境。激活它并运行以下命令通过<code class="fe no np nq lw b">pip install</code>进行安装:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="cd78" class="ma mb it lw b gy mc md l me mf">pip install git+<a class="ae ky" href="https://github.com/rsennrich/Bleualign.git" rel="noopener ugc nofollow" target="_blank">https://github.com/rsennrich/Bleualign.git</a></span></pre><p id="5553" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是将以下文件复制到您的目录中:</p><ul class=""><li id="f922" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated"><a class="ae ky" href="https://github.com/rsennrich/Bleualign/blob/master/command_utils.py" rel="noopener ugc nofollow" target="_blank"> command_utils.py </a>:从命令行解析输入参数的实用模块</li><li id="2478" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><a class="ae ky" href="https://github.com/rsennrich/Bleualign/blob/master/bleualign.py" rel="noopener ugc nofollow" target="_blank"> bluealign.py </a>:执行句子对齐的主脚本</li></ul><h2 id="662d" class="ma mb it bd mi nd ne dn mm nf ng dp mq li nh ni ms lm nj nk mu lq nl nm mw nn bi translated">概念</h2><p id="79d3" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在此之前，让我们探索一下执行一次句子对齐的底层过程。它的工作原理如下:</p><ol class=""><li id="98dc" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu of nx ny nz bi translated">使用任何机器翻译API(谷歌翻译等)翻译源文本。).翻译文本必须逐行与源文本相对应。两个文件中不应有任何换行符或空行。</li><li id="59d0" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu of nx ny nz bi translated">运行脚本来计算目标文本和自动翻译的源文本之间的相似性(修改的BLEU)。</li><li id="72a8" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu of nx ny nz bi translated">系统将根据相似性得分排列句子</li></ol><p id="2bf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果同时翻译源文本和目标文本，Bleualign也可以工作。然后，它将简单地获得两个结果的交集作为最终输出。这提供了高质量的对齐。</p><h2 id="0023" class="ma mb it bd mi nd ne dn mm nf ng dp mq li nh ni ms lm nj nk mu lq nl nm mw nn bi translated">资料组</h2><p id="7227" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">出于实验目的，我从一本小说中提取了文本，并通过正则表达式将其拆分成句子。最终数据集由以下数字行组成:</p><ul class=""><li id="4b06" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">英语源句子:6149行</li><li id="0e08" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">意大利语目标句子:5579行</li></ul><p id="2504" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我通过Google Translate翻译内容(行数必须与源句或目标句相同):</p><ul class=""><li id="61f0" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">翻译的源句子:6，149行</li><li id="f333" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">翻译的目标句子:5579行</li></ul><h2 id="34d2" class="ma mb it bd mi nd ne dn mm nf ng dp mq li nh ni ms lm nj nk mu lq nl nm mw nn bi translated">句子对齐</h2><p id="f193" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">假设数据集(源、目标、翻译源)位于与<code class="fe no np nq lw b">bluealign.py</code>脚本相同的目录中，运行以下脚本开始句子对齐过程:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b3e9" class="ma mb it lw b gy mc md l me mf">python bleualign.py -s sourcetext.txt -t targettext.txt --srctotarget sourcetranslation.txt --targettosrc targettranslation.txt -o outputfile</span></pre><p id="8264" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它接受以下参数:</p><ul class=""><li id="b8c2" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated"><code class="fe no np nq lw b">-s</code>:源文件路径</li><li id="b1f8" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq lw b">-t</code>:目标文件路径</li><li id="a492" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq lw b">--srctotarget</code>:翻译后的源文件路径</li><li id="2f14" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq lw b">--targettosrc</code>:翻译后的目标文件路径(可选)</li><li id="f93b" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq lw b">-o</code>:输出文件前缀</li></ul><p id="94e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更准确，您必须翻译目标文本并执行以下命令:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e340" class="ma mb it lw b gy mc md l me mf">python bleualign.py -s sourcetext.txt -t targettext.txt --srctotarget sourcetranslation.txt --targettosrc targettranslation.txt -o outputfile</span></pre><p id="062a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该在终端上看到以下输出:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ea59" class="ma mb it lw b gy mc md l me mf">reading in article 0:<br/>processing<br/>computing alignment between srctotarget (file 0) and target text<br/>Evaluating sentences with bleu<br/>finished<br/>searching for longest path of good alignments<br/>finished<br/>filling gaps<br/>finished<br/>computing alignment between targettosrc (file 0) and source text<br/>Evaluating sentences with bleu<br/>finished<br/>searching for longest path of good alignments<br/>finished<br/>filling gaps<br/>finished<br/>intersecting both directions</span><span id="9bdf" class="ma mb it lw b gy mg md l me mf">finished with article</span></pre><h1 id="3744" class="mh mb it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结果</h1><p id="0e4d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">除此之外，它还会根据您设置的前缀生成另外两个文件:</p><ul class=""><li id="57f1" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated"><code class="fe no np nq lw b">output-s</code>:句子对齐后输出源文本</li><li id="4499" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq lw b">output-t</code>:句子对齐后输出目标文本</li></ul><p id="c1f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果并不完美，但作为初始并行数据集已经足够好了。在这种情况下，该脚本仅用几秒钟就对齐了4442行平行句子(忽略翻译源句子和目标句子所需的时间)。想象一下，如果您自己手动调整它，需要多长时间。您需要做的只是验证并对输出进行一些最后的润色，以确保机器翻译模型的高质量并行数据集。</p><p id="0276" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当短句没有被正确分解时，这种算法并不能很好地工作。例如，会出现以下问题:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="eb16" class="ma mb it lw b gy mc md l me mf"># English<br/>Yes.<br/>Go ahead. I'll wait for you.</span><span id="4968" class="ma mb it lw b gy mg md l me mf"># Italian<br/>Sí. Allora vai.<br/>Ti aspetto.</span></pre><h1 id="970a" class="mh mb it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">成批处理方式</h1><p id="5492" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">还有<a class="ae ky" href="https://github.com/rsennrich/Bleualign/blob/master/batch_align.py" rel="noopener ugc nofollow" target="_blank">一个脚本</a>批量处理文件。假设您具备以下条件:</p><ul class=""><li id="19f5" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated"><code class="fe no np nq lw b">raw_files</code>:名为的文件夹，包含所有数据集</li><li id="f2b7" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq lw b">0.en</code>:源文件</li><li id="d91a" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq lw b">0.it</code>:目标文件</li><li id="b7c3" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq lw b">0.trans</code>:翻译后的源文件</li><li id="3fdb" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq lw b">1.en</code>:源文件</li><li id="635d" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq lw b">1.it</code>:目标文件</li><li id="fc90" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe no np nq lw b">1.trans</code>:翻译后的源文件</li></ul><p id="4736" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需运行以下命令:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="80aa" class="ma mb it lw b gy mc md l me mf"># syntax<br/>python batch_align.py directory source_suffix target_suffix translation_suffix</span><span id="8772" class="ma mb it lw b gy mg md l me mf"># example<br/>python batch_align.py raw_files en it trans</span></pre><p id="8c0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将生成以下文件作为输出:</p><ul class=""><li id="0c8d" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">0.en .对齐</li><li id="fb35" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">0 .对齐</li><li id="b121" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">1 .对齐</li><li id="8449" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">1 .信息技术</li></ul><h1 id="be74" class="mh mb it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">笔记</h1><p id="e8d3" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">一个主要的缺点是，在执行句子对齐之前，您需要获得源句子的翻译版本。除了使用外部API(如Google Translate)进行自动翻译之外，您还可以使用开源数据集来训练简单的机器翻译，以协助初始翻译。</p><p id="4329" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关该算法的更多信息，请阅读以下文章:</p><blockquote class="og oh oi"><p id="a10f" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">Rico Sennrich，Martin Volk(2010):OCR生成的平行文本的基于机器翻译的句子对齐。在:2010年AMTA会议录，丹佛，科罗拉多州。</p><p id="f50e" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">里科·森里奇；Martin Volk (2011):迭代的、基于机器翻译的平行文本句子对齐。载于:NODALIDA 2011，北欧计算语言学会议，里加。</p></blockquote><h1 id="4bc9" class="mh mb it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="a00a" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">让我们回顾一下你今天所学的内容。</p><p id="220a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文从一个简单的问题陈述开始，强调了为机器翻译模型构建平行语料库时所面临的问题。</p><p id="853c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它转移到安装和数据准备步骤，要求源句子事先翻译。</p><p id="5a21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，探讨了Bleualign背后的基本概念，它计算目标句子和翻译的源句子之间的相似度(修正的BLEU)。</p><p id="6b83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，介绍了示例命令和句子对齐的结果。此外，Bleualign支持通过它的一个脚本批量处理文件。</p><p id="7721" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢你阅读这篇文章。祝你有美好的一天！</p><h1 id="20a7" class="mh mb it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">参考</h1><ol class=""><li id="77e5" class="nr ns it lb b lc my lf mz li on lm oo lq op lu of nx ny nz bi translated"><a class="ae ky" href="https://github.com/rsennrich/bleualign" rel="noopener ugc nofollow" target="_blank"> GitHub — Bleualign </a></li><li id="8c58" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu of nx ny nz bi translated"><a class="ae ky" href="https://www.kafka-online.info/the-metamorphosis.html" rel="noopener ugc nofollow" target="_blank">弗兰茨·卡夫卡。(1915)变形记</a></li></ol></div></div>    
</body>
</html>