<html>
<head>
<title>Creating a Custom Font Picker in and for SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在SwiftUI中为swift ui创建自定义字体选择器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/creating-a-custom-font-picker-in-and-for-swiftui-f4722a5ed99e?source=collection_archive---------11-----------------------#2021-03-23">https://betterprogramming.pub/creating-a-custom-font-picker-in-and-for-swiftui-f4722a5ed99e?source=collection_archive---------11-----------------------#2021-03-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4d56" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在SwiftUI应用程序中利用UIViewControllerRepresentable</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bc90c47b15766351db6559a4e8f044ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GbSkTuVg_Z5fU7uWNeJIOQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SwiftUI应用程序中的自定义字体。作者照片。</p></figure><p id="1ed2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在过去的一年里，SwiftUI变得比几年前更加健壮和成熟。然而，SwiftUI中仍然缺少相当多的UIKit元素——其中之一就是<code class="fe lr ls lt lu b">UIFontPickerViewController</code>。这个UIKit类是<code class="fe lr ls lt lu b">UIViewController</code>的子类，用于允许用户选择预先安装在设备上的字体。这提供了一个全新的可定制性维度，这也是我在更新<a class="ae lv" href="https://apps.apple.com/us/app/id1522226018" rel="noopener ugc nofollow" target="_blank">贴纸卡</a>时正在做的事情。</p><p id="72fc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本教程中，我们将构建一个简单的桥，将这一强大的特性引入SwiftUI。激动吗？让我们开始吧。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="7de8" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">配置内容视图</h1><p id="6d48" class="pw-post-body-paragraph kv kw iq kx b ky mv jr la lb mw ju ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">在我们的示例应用程序的<code class="fe lr ls lt lu b">ContentView</code>，这是应用程序的根视图，我们将创建一个<code class="fe lr ls lt lu b">Text</code>视图和一个<code class="fe lr ls lt lu b">Button</code>视图。<code class="fe lr ls lt lu b">Text</code>视图将显示一个样本文本，我们将在其上应用用户从<code class="fe lr ls lt lu b">UIFontPickerViewController</code>中选择的自定义字体。<code class="fe lr ls lt lu b">Button</code>将用于呈现这个字体选择器控制器。<code class="fe lr ls lt lu b">ContentView</code>应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="f9fd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个视图除了显示我们上面讨论过的两个视图之外什么也不做。在我们向<code class="fe lr ls lt lu b">ContentView</code>添加任何功能之前，让我们创建一个将<code class="fe lr ls lt lu b">UIFontPickerViewController</code>引入SwiftUI的桥梁。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="fc3c" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">CustomFontPicker</h1><p id="3710" class="pw-post-body-paragraph kv kw iq kx b ky mv jr la lb mw ju ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">创建一个新的Swift文件并将其命名为<code class="fe lr ls lt lu b">CustomFontPicker</code>。这个文件将包含我们的桥梁。首先导入<code class="fe lr ls lt lu b">UIKit</code>和<code class="fe lr ls lt lu b">SwiftUI</code>框架。我们现在将创建一个新的可表示的视图控制器结构，名为<code class="fe lr ls lt lu b">CustomFontPicker</code>。我们将使这个结构符合<code class="fe lr ls lt lu b">UIViewControllerRepresentable</code>协议。您的<code class="fe lr ls lt lu b">CustomFontPicker</code>结构现在应该是这样的:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="aee9" class="ng me iq lu b gy nh ni l nj nk"><strong class="lu ir">struct</strong> CustomFontPicker: UIViewControllerRepresentable {<br/>}</span></pre><p id="39b3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦你添加了协议一致性，Xcode不会对你满意的，除非你添加了协议存根。所以让我们现在就开始吧。将这两个方法添加到<code class="fe lr ls lt lu b">CustomFontPicker</code>结构中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="cb19" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在继续之前，让我们创建一个动作处理程序，当用户从字体列表中选择一个新的字体时，这个动作处理程序将被触发。我们还将添加一个<code class="fe lr ls lt lu b">Environment</code>属性包装器，一旦字体被成功选取，该包装器将用于关闭该视图。现在将这两个属性添加到<code class="fe lr ls lt lu b">CustomFontPicker</code>结构中:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="6a46" class="ng me iq lu b gy nh ni l nj nk">@Environment(\.presentationMode) <strong class="lu ir">var</strong> presentationMode<br/><strong class="lu ir">private</strong> <strong class="lu ir">let</strong> onFontPick: (UIFontDescriptor) -&gt; Void</span></pre><p id="f71a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe lr ls lt lu b">onFontPick</code>是一个简单的动作处理程序，一旦被触发就会提供一个<code class="fe lr ls lt lu b">UIFontDescriptor</code>回调。现在让我们在结构体的初始化器中使用一个转义闭包来初始化它。将此代码添加到<code class="fe lr ls lt lu b">CustomFontPicker</code>:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="4344" class="ng me iq lu b gy nh ni l nj nk"><strong class="lu ir">init</strong>(onFontPick: @escaping (UIFontDescriptor) -&gt; Void) {<br/>        <strong class="lu ir">self</strong>.onFontPick = onFontPick<br/>}</span></pre><p id="e669" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在是时候创建<code class="fe lr ls lt lu b">Coordinator</code>类了——你猜对了——它将协调整个操作。这个类将包含对<code class="fe lr ls lt lu b">UIFontPickerViewController</code>的委托的委托回调。在<code class="fe lr ls lt lu b">CustomFontPicker</code>结构内部，创建一个名为<code class="fe lr ls lt lu b">Coordinator</code>的嵌套类。使<code class="fe lr ls lt lu b">Coordinator</code>符合<code class="fe lr ls lt lu b">NSObject</code>和<code class="fe lr ls lt lu b">UIFontPickerViewControllerDelegate</code>。<code class="fe lr ls lt lu b">Coordinator</code>类现在应该看起来像这样:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="10dc" class="ng me iq lu b gy nh ni l nj nk"><strong class="lu ir">class</strong> Coordinator: NSObject, UIFontPickerViewControllerDelegate {<br/>}</span></pre><p id="a8d5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这个类中，创建两个属性:<code class="fe lr ls lt lu b">parent</code>和<code class="fe lr ls lt lu b">onFontPick</code>。我们需要访问协调器的父级(在本例中，就是<code class="fe lr ls lt lu b">CustomFontPicker</code>结构),以便能够在用户选择新字体时关闭控制器。我们还将引用<code class="fe lr ls lt lu b">onFontPick</code>动作处理程序，因为我们将连接这个类中的代理。将这两个属性添加到您的<code class="fe lr ls lt lu b">Coordinator</code>类中:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="4291" class="ng me iq lu b gy nh ni l nj nk"><strong class="lu ir">var</strong> parent: SUIFontPicker<br/><strong class="lu ir">private</strong> <strong class="lu ir">let</strong> onFontPick: (UIFontDescriptor) -&gt; Void</span></pre><p id="1345" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们首先初始化这两个属性。将此添加到<code class="fe lr ls lt lu b">Coordinator</code>类:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="722b" class="ng me iq lu b gy nh ni l nj nk"><strong class="lu ir">init</strong>(<strong class="lu ir">_</strong> parent: SUIFontPicker, onFontPick: @escaping (UIFontDescriptor) -&gt; Void) {<br/>    <strong class="lu ir">self</strong>.parent = parent<br/>    <strong class="lu ir">self</strong>.onFontPick = onFontPick<br/>}</span></pre><p id="0354" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe lr ls lt lu b">UIFontPickerViewControllerDelegate</code>由这两个可选协议存根定义:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="b2d9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本教程中，我们将使用<code class="fe lr ls lt lu b">fontPickerViewControllerDidPickFont</code>方法。首先将这个方法添加到您的<code class="fe lr ls lt lu b">Coordinator</code>类中:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="9cd3" class="ng me iq lu b gy nh ni l nj nk"><strong class="lu ir">func</strong> <strong class="lu ir">fontPickerViewControllerDidPickFont</strong>(<strong class="lu ir">_</strong> viewController: UIFontPickerViewController) {<br/>}</span></pre><p id="e763" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个方法将为我们提供一个类型为<code class="fe lr ls lt lu b">UIFontPickerViewController</code>的视图控制器。这个视图控制器有一个名为<code class="fe lr ls lt lu b">descriptor</code>的属性。我们将用这个描述符构造一个<code class="fe lr ls lt lu b">UIFont</code>,然后将它传递给我们的动作处理程序。将这两行添加到<code class="fe lr ls lt lu b">fontPickerViewControllerDidPickFont</code>方法中:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="184d" class="ng me iq lu b gy nh ni l nj nk"><strong class="lu ir">guard</strong> <strong class="lu ir">let</strong> descriptor = viewController.selectedFontDescriptor <strong class="lu ir">else</strong> { <strong class="lu ir">return</strong> }<br/>onFontPick(descriptor)</span></pre><p id="76c8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于用户现在已经选择了字体，并且我们已经将它传递给了我们的操作处理程序，我们可以简单地使用:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="cc31" class="ng me iq lu b gy nh ni l nj nk">parent.presentationMode.wrappedValue.dismiss()</span></pre><p id="a62e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，在所有这些之后，<code class="fe lr ls lt lu b">fontPickerViewControllerDidPickFont</code>方法应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="5ad4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们回到<code class="fe lr ls lt lu b">parent</code>结构并配置视图控制器。在<code class="fe lr ls lt lu b">makeUIViewController</code>方法中，添加以下几行:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="6d92" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">创建一个<code class="fe lr ls lt lu b">makeCoordinator</code>方法来创建我们刚刚创建的<code class="fe lr ls lt lu b">Coordinator</code>类的一个实例:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="8094" class="ng me iq lu b gy nh ni l nj nk"><strong class="lu ir">func</strong> <strong class="lu ir">makeCoordinator</strong>() -&gt; CustomFontPicker.Coordinator {<br/>    <strong class="lu ir">return</strong> Coordinator(<strong class="lu ir">self</strong>, onFontPick: <strong class="lu ir">self</strong>.onFontPick)<br/>}</span></pre><p id="c063" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就是这样！我们已经成功地配置了我们的桥。剩下要做的就是在我们的应用程序中测试它。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="1e39" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">返回内容视图</h1><p id="49b4" class="pw-post-body-paragraph kv kw iq kx b ky mv jr la lb mw ju ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">我们将首先创建一个新的<code class="fe lr ls lt lu b">@State</code>属性作为我们的字体。这将是类型<code class="fe lr ls lt lu b">UIFont</code>，我们将在<code class="fe lr ls lt lu b">Text</code>的修饰符内把它转换成<code class="fe lr ls lt lu b">Font</code>。将该属性添加到<code class="fe lr ls lt lu b">ContentView</code>:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="aa65" class="ng me iq lu b gy nh ni l nj nk">@State <strong class="lu ir">private</strong> <strong class="lu ir">var</strong> customFont: UIFont = UIFont.preferredFont(forTextStyle: .body)</span></pre><p id="6dbb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，将这个修饰符添加到<code class="fe lr ls lt lu b">Text</code>视图中，它将把我们的自定义字体应用到文本中:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="331f" class="ng me iq lu b gy nh ni l nj nk">.font(Font(customFont))</span></pre><p id="10b8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们把<code class="fe lr ls lt lu b">customFont</code>转换成了<code class="fe lr ls lt lu b">Font</code>，所以我们让SwiftUI很开心！现在剩下要做的就是给<code class="fe lr ls lt lu b">VStack</code>添加一个sheet修饰符来呈现<code class="fe lr ls lt lu b">CustomFontPicker</code>视图。我们还需要向<code class="fe lr ls lt lu b">ContentView</code>添加一个<code class="fe lr ls lt lu b">@State</code>属性，这样我们就可以跟踪工作表的显示状态。将该附加属性添加到<code class="fe lr ls lt lu b">ContentView</code>:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="cef3" class="ng me iq lu b gy nh ni l nj nk">@State <strong class="lu ir">private</strong> <strong class="lu ir">var</strong> isShowingFontPicker = <strong class="lu ir">false</strong></span></pre><p id="5794" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">给你的<code class="fe lr ls lt lu b">VStack</code>添加一个表单修改器。使用动作处理程序的闭包从<code class="fe lr ls lt lu b">CustomFontPicker</code>获取描述符，并将其分配给<code class="fe lr ls lt lu b">ContentView</code>的<code class="fe lr ls lt lu b">customFont</code>状态属性，如下所示:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="aee3" class="ng me iq lu b gy nh ni l nj nk">.sheet(isPresented: $isShowingFontPicker) {<br/>    CustomFontPicker { descriptor <strong class="lu ir">in</strong><br/>        customFont = UIFont(descriptor: descriptor, size: <strong class="lu ir">18</strong>)<br/>     }<br/>}</span></pre><p id="31e8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，我们将使用<code class="fe lr ls lt lu b">Button</code>来切换<code class="fe lr ls lt lu b">isShowingFontPicker</code>的状态。将这行代码添加到<code class="fe lr ls lt lu b">Button</code>的动作处理程序中:</p><pre class="kg kh ki kj gt nc lu nd ne aw nf bi"><span id="5f9e" class="ng me iq lu b gy nh ni l nj nk">isShowingFontPicker.toggle()</span></pre><p id="0eae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们都做完了。现在运行应用程序，你应该可以点击按钮来显示<code class="fe lr ls lt lu b">CustomFontPicker</code>，让你选择一个自定义字体。一旦选中，该自定义字体将被设置为您的<code class="fe lr ls lt lu b">Text</code>视图的字体样式。难以置信的东西。下面这张GIF图展示了这款应用的运行情况:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/9b156fff643f60c13b68ef812a2fee61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/1*vLuOdwwTuL1nTYUhCfzArA.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">应用程序在运行</p></figure><p id="b762" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我已经把这座桥打包成了一个快捷的包裹。可以在GitHub 上查看<a class="ae lv" href="https://github.com/SwapnanilDhol/SUIFontPicker" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="8fb0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢您通读这整个教程。如果你有任何问题，请在评论区留言。</p></div></div>    
</body>
</html>