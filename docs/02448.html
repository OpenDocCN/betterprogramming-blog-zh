<html>
<head>
<title>Handling iOS 13 Quick Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理iOS 13快速操作</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/handling-ios-13-quick-actions-67f9e304dcc6?source=collection_archive---------17-----------------------#2019-12-01">https://betterprogramming.pub/handling-ios-13-quick-actions-67f9e304dcc6?source=collection_archive---------17-----------------------#2019-12-01</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="5a08" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">了解如何配置上下文菜单快捷方式和小部件</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/5d0a9b5970fbb45e53b55b1fe9187ba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FH4cGp6hVDFHAUhh"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@yamaicle?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迈克·尤克丹科</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="d93d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">iOS 13通过摆脱3D触摸，支持触觉触摸手势，标准化了所有设备的主屏幕快速操作。这一变化的一个积极方面是消除了长按和强制触摸按压手势之间的手势冲突。</p><p id="c2f6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在过去，这很棘手，因为打开快速动作需要用力触摸，而卸载应用程序需要正常的按压才能产生抖动效果。现在，3D触摸不再存在，访问快速操作比以往任何时候都更加流畅和快速。</p><p id="4ed7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">主屏幕快速操作通过设置快捷菜单来提供导航到应用程序特定部分的便捷方式，长按应用程序的启动器图标即可查看快捷菜单。在iOS 13中，快速操作现在在每个快速操作菜单中隐式提供删除、重新排列和共享应用程序操作。</p><p id="d3c6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，我们可以通过显示带有快速操作菜单的小部件来进一步增强用户体验。小部件扩展有助于向用户显示有用的信息(如标题、钱包金额或股票价格)，同时还提供了添加到当前小部件屏幕的能力。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="a2b8" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">我们的目标</h1><p id="6e8c" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在接下来的几节中，我们将探索创建快速动作的不同方法以及处理菜单选择的方法。</p><p id="bfa3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，我们将在我们的操作菜单旁边集成一个小部件，这是iOS 13应用程序中相当常见的设计。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="adca" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">快速操作菜单</h1><p id="92a7" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">快速动作菜单有两种类型——静态或动态。</p><p id="1242" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">静态的永远不会改变，它们被定义在<code class="fe na nb nc nd b">UIApplicationShortcutItems</code>下的<code class="fe na nb nc nd b">Info.plist</code>文件中——这个键为菜单项保存了一个字典数组。另一方面，当您的菜单动作是特定于用户或会话的，如显示最常访问或最后访问的屏幕时，使用动态菜单动作。</p><p id="626f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们看看这些快速动作类型是如何在iOS应用程序中实现的。创建一个新的Xcode项目来开始。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="e158" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">静态快速动作</h1><p id="ab58" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">静态快速动作在<code class="fe na nb nc nd b">Info.plist</code>文件中定义如下:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ne"><img src="../Images/20166446e718e9ba5f96dab0be8ba4a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y2QHS-3CpnPz20copva5Ew.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Info.plist以及XML版本</p></figure><p id="4010" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">字典的<code class="fe na nb nc nd b">UIApplicationShortcutItems</code>数组中的每一项都必须定义自己的<code class="fe na nb nc nd b">UIApplicationShortcutItemTitle</code>和<code class="fe na nb nc nd b">UIApplicationShortcutItemType</code>属性。</p><p id="d14d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">可选地，使用<code class="fe na nb nc nd b">UIApplicationShortcutItemSubtitle</code>进行描述。<code class="fe na nb nc nd b">IconType</code>或<code class="fe na nb nc nd b">IconFile</code>可用于设置菜单项的图标。图标颜色是单色的，因此建议不要在菜单中使用表情图标。</p><p id="d4bb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，我们可以将每个条目的数据保存在<code class="fe na nb nc nd b">UIApplicationShortcutItemUserInfo</code>字典中。<code class="fe na nb nc nd b">userInfo</code>值需要符合<code class="fe na nb nc nd b"><a class="ae kz" href="https://developer.apple.com/documentation/foundation/nssecurecoding" rel="noopener ugc nofollow" target="_blank">NSSecureCoding</a></code>协议。</p><p id="4c46" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下图展示了我们在上面定义的<code class="fe na nb nc nd b">Info.plist</code>的静态快速动作示例:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nf"><img src="../Images/c167f0c5d5aae9eed526610edf036a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*H65tA0_pD8iiO-F5v8DnOg.png"/></div></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="ed5a" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">动态快速动作</h1><p id="94c6" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">动态快速操作要求应用程序至少加载一次。通常，这些动作应该在用户返回主屏幕时触发的<code class="fe na nb nc nd b">AppDelegate</code>中创建，从而检索任何必要的应用程序数据并相应地将其转换成动态动作。</p><p id="c12a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们可以在这里为每个上下文菜单项创建<code class="fe na nb nc nd b">UIApplicationShortcutItem</code>，并将数组设置为<code class="fe na nb nc nd b">UIApplication</code>的<code class="fe na nb nc nd b">shortcutItems</code>属性，如下所示:</p><pre class="kk kl km kn gu ng nd nh ni aw nj bi"><span id="9712" class="nk me iu nd b gz nl nm l nn no">func applicationWillResignActive(_ application: UIApplication) {</span><span id="9673" class="nk me iu nd b gz np nm l nn no">application.shortcutItems = [<br/>UIApplicationShortcutItem(</span><span id="7a4f" class="nk me iu nd b gz np nm l nn no">type: "DynamicAction",<br/>localizedTitle: "Name",<br/>localizedSubtitle: nil,<br/>icon: UIApplicationShortcutIcon(type: .contact),<br/>userInfo: nil</span><span id="0ac9" class="nk me iu nd b gz np nm l nn no">)]</span><span id="3c17" class="nk me iu nd b gz np nm l nn no">}</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="d92b" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">响应快速动作选择</h1><p id="0c08" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">当按下“快速动作”上下文菜单中的项目时，会发生以下任一情况:</p><ul class=""><li id="5e1e" class="nq nr iu lc b ld le lg lh lj ns ln nt lr nu lv nv nw nx ny bi translated">如果应用程序没有运行，调用<code class="fe na nb nc nd b">AppDelegate</code>类中的<code class="fe na nb nc nd b">didFinishLaunchingWithOptions</code>方法。我们可以通过键<code class="fe na nb nc nd b">UIApplication.LaunchOptionsKey.shortcutItem</code>从<code class="fe na nb nc nd b">launchOptions</code>字典中检索<code class="fe na nb nc nd b">shortcutItem</code>来处理菜单项的动作。</li><li id="9225" class="nq nr iu lc b ld nz lg oa lj ob ln oc lr od lv nv nw nx ny bi translated">如果应用程序已经在运行——对于iOS 13，<code class="fe na nb nc nd b">SceneDelegate</code>会完成所有繁重的工作。所以被点击的<code class="fe na nb nc nd b">shortcutItem</code>会触发<code class="fe na nb nc nd b">SceneDelegate</code>类的以下方法:</li></ul><pre class="kk kl km kn gu ng nd nh ni aw nj bi"><span id="653d" class="nk me iu nd b gz nl nm l nn no">func windowScene(_ windowScene: UIWindowScene, performActionFor shortcutItem: UIApplicationShortcutItem, completionHandler: @escaping (Bool) -&gt; Void){</span><span id="904b" class="nk me iu nd b gz np nm l nn no">//Handle actions based on shortcutItem.type</span><span id="1e98" class="nk me iu nd b gz np nm l nn no">}</span></pre><p id="87ba" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于iOS 12和更老的版本，等效的<code class="fe na nb nc nd b">AppDelegate</code>方法被触发。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="57e5" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">集成当今的小部件扩展</h1><p id="ee06" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">小部件通过在主应用程序之外提供某些实时显示视图来提供对应用程序的快速访问。我们将在我们的应用程序中添加一个今天的小部件扩展，以便用快速动作菜单来显示它。</p><p id="6073" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要设置扩展，点击<code class="fe na nb nc nd b">+</code>在Xcode中添加一个新目标，并选择今天的扩展。这将为扩展创建相关的文件(一个ViewController、storyboard和<code class="fe na nb nc nd b">Info.plist</code>文件)。</p><p id="37af" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">接下来，在主应用程序的目标中添加一个URL类型。我们将使用这个URL方案从小部件启动应用程序。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oe"><img src="../Images/5c66e7e4bc144ccc98553d92f50c99a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*PPOQm4_K54ORygZ3lI0ILg.png"/></div></figure><p id="2f20" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们的TodayViewController.swift文件中，我们用UIButton替换了UILabel。为了从小部件启动包含的应用程序，我们需要点击按钮打开URL，如下所示:</p><pre class="kk kl km kn gu ng nd nh ni aw nj bi"><span id="9fc7" class="nk me iu nd b gz nl nm l nn no">import UIKit<br/>import NotificationCenter</span><span id="d8f3" class="nk me iu nd b gz np nm l nn no">class TodayViewController: UIViewController, NCWidgetProviding {</span><span id="6f20" class="nk me iu nd b gz np nm l nn no">override func viewDidLoad() {<br/>        super.viewDidLoad()<br/>    }<br/>    <br/>    @IBAction func onButtonTap(_ sender: Any) {<br/>        self.extensionContext?.open(URL(string: "iOS13QuickActions://")!)<br/>    }<br/>   <br/>    func widgetPerformUpdate(completionHandler: (@escaping (NCUpdateResult) -&gt; Void)) {<br/>        completionHandler(NCUpdateResult.newData)<br/>    }   <br/>}</span></pre><p id="dd5f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们甚至可以在Xcode中启用应用程序组的功能，以便在widget和iOS应用程序之间共享数据。</p><p id="0583" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">作为回报，当我们长按图标时，我们从应用程序中得到以下结果:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj of"><img src="../Images/f80f408b9944601a2a4d30ded6dd5e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*_aDOs57hwcDygfIRvQv2jQ.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">结果</p></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="7341" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">结论</h1><p id="9945" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">快速操作菜单仅对App Store中可用的应用程序显示“共享应用程序”操作。此外，我们看到了今天的扩展和快速动作菜单如何提供对应用程序内容的快速访问。你可以从<a class="ae kz" href="https://github.com/anupamchugh/iowncode/tree/master/iOS13QuickActions" rel="noopener ugc nofollow" target="_blank"> Github库</a>下载完整的源代码。</p></div></div>    
</body>
</html>