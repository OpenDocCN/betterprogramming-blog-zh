<html>
<head>
<title>Data Scraping in Node.js 101</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js 101中的数据抓取</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/data-scraping-in-node-js-101-c549cf400af1?source=collection_archive---------7-----------------------#2019-09-03">https://betterprogramming.pub/data-scraping-in-node-js-101-c549cf400af1?source=collection_archive---------7-----------------------#2019-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5c2f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">不用那些讨厌的数据库收集数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/72221e7a58ffe94a74330450953c33a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x9g-raNtNtmNFeTqchI9Ew.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@markusspiske?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae kv" href="https://unsplash.com/search/photos/data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="3aea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Web抓取是创建动态网站的一种很好的方式，而不必联系数据库来获取信息。</p><p id="2994" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要开始网络抓取，你应该知道一个网站是如何构建的。如果你右击一个页面，点击inspect(在Chrome上)，你可以看到开发者工具。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/38806881f838c815a010854e503baec5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XFwzEYvZPkTQg9gw.png"/></div></div></figure><p id="ea07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这向您展示了网站的HTML/CSS/JavaScript代码的结构，以及网络性能、错误、安全性等等。</p><p id="1bcb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，假设我想在JavaScript控制台中以编程方式抓取你在Twitter上看到的第一张图片。</p><p id="b39b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">嗯，我可以右键单击图像，单击inspect，右键单击dev工具中的元素，然后复制CSS选择器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/112db9ae1ca4edb028f5e48941d10f45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6kXuOx-aWS1f8_mq.png"/></div></div></figure><p id="ecfb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我可以做一个<code class="fe lt lu lv lw b">document.querySelector(&lt;&lt;SELECTOR&gt;&gt;).src</code>操作，这将给出我想要的图像的URL，我可以在网页上使用它，例如:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/85dab2dd11e8045263e1d3ce970df1a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l3wxdeskt7L4S_hc.png"/></div></div></figure><p id="8e7e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个<em class="lx">就是</em>网页抓取！我能够在不访问数据库的情况下从网站上收集数据(一张图片)。但是这非常冗长乏味，所以为了更有效地抓取网页，我使用Node.js和Puppeteer。</p><p id="9c1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您还不知道，<a class="ae kv" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>是一个允许JavaScript在服务器端运行的运行时环境。而<a class="ae kv" href="https://github.com/GoogleChrome/puppeteer" rel="noopener ugc nofollow" target="_blank"> Puppeteer </a>是Google写的一个‘无头Chrome node API’(基本上就是让你在服务器上写DOM JavaScript代码)。</p><p id="c2d0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">仅供参考，因为我喜欢打字稿，我将在这个项目中使用这种语言。如果您想使用TypeScript，请在您的系统上安装它。如果在终端中运行<code class="fe lt lu lv lw b">tsc -v</code>有效，就可以开始了！</p><p id="9bf7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好的，首先，确保您的系统上安装了Node.js和npm(节点包管理器)。如果您通过运行以下程序之一得到了一个<code class="fe lt lu lv lw b">command not found</code>或其他相关的东西，我建议您看看这篇关于如何安装Node的文章。</p><pre class="kg kh ki kj gt ly lw lz ma aw mb bi"><span id="a454" class="mc md iq lw b gy me mf l mg mh">$ npm -v # should be 6.0.0 or higher $ node -v # should be 9.0.0 or higher</span></pre><p id="7a5a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了！让我们开始一个新项目并安装依赖项:</p><pre class="kg kh ki kj gt ly lw lz ma aw mb bi"><span id="0c60" class="mc md iq lw b gy me mf l mg mh">$ mkdir Web-Scraping-101 &amp;&amp; cd Web-Scraping-101 <br/>$ npm init # go through all defaults <br/>$ npm i puppeteer # the google npm scraping package <br/>$ tsc --init # initialize typescript <br/>$ npm i @types/puppeteer # type declarations</span></pre><p id="2576" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在您选择的文本编辑器中打开该文件夹。将<code class="fe lt lu lv lw b">tsconfig.json</code>文件中的<code class="fe lt lu lv lw b">outDir</code>选项编辑为<code class="fe lt lu lv lw b">./build</code>，并取消对该行的注释，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/58e7ab701a07c19ae675330c3fa0b042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cgOSmi-XxIckUJoS.png"/></div></div></figure><p id="e150" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在文件夹的根目录下创建一个新文件:</p><pre class="kg kh ki kj gt ly lw lz ma aw mb bi"><span id="90a5" class="mc md iq lw b gy me mf l mg mh">$ touch app.ts</span></pre><p id="5233" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe lt lu lv lw b">app.ts</code>中添加:</p><pre class="kg kh ki kj gt ly lw lz ma aw mb bi"><span id="f72d" class="mc md iq lw b gy me mf l mg mh">console.log("Twitter, here we come");</span></pre><p id="c1f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要运行它，在终端中，写下:<code class="fe lt lu lv lw b">tsc &amp;&amp; node build/app.js</code></p><p id="970e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:<code class="fe lt lu lv lw b">tsc</code>将所有的类型脚本文件构建到配置文件中定义的<code class="fe lt lu lv lw b">outDir</code>目录中，<code class="fe lt lu lv lw b">node</code>运行一个JavaScript文件。</p><p id="5bf3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你看到<em class="lx"/>Twitter，我们来了<em class="lx"/>出现在终端，你已经让它工作了！</p><p id="733f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们将开始实际刮使用木偶师。将这个样板木偶代码添加到<code class="fe lt lu lv lw b">app.ts</code>文件中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="372e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请通读上面注释的代码，感受一下正在发生的事情。</p><p id="28e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您可以看到我们如何访问一个网页，使用DOM操作收集信息，并将这些信息返回到Node js程序，我们已经准备好抓取Twitter了。</p><p id="5901" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，将<code class="fe lt lu lv lw b">await page.goto("https://example.com")</code>编辑成<code class="fe lt lu lv lw b">await page.goto("https://twitter.com")</code>。</p><p id="2475" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们需要能够从中间栏(实际的Twitter提要)获取帖子。经过一些调查，我发现这个选择器实际上是选择中间列提要的<code class="fe lt lu lv lw b">div</code>:</p><pre class="kg kh ki kj gt ly lw lz ma aw mb bi"><span id="3832" class="mc md iq lw b gy me mf l mg mh">document.querySelector("#react-root &gt; div &gt; div &gt; div &gt; main &gt; div &gt; div.css-1dbjc4n.r-aqfbo4.r-1niwhzg.r-16y2uox &gt; div &gt; div.css-1dbjc4n.r-14lw9ot.r-1tlfku8.r-1ljd8xs.r-13l2t4g.r-1phboty.r-1jgb5lz.r-1ye8kvj.r-13qz1uu.r-184en5c &gt; div &gt; div &gt; div.css-1dbjc4n.r-1jgb5lz.r-1ye8kvj.r-6337vo.r-13qz1uu &gt; div &gt; section &gt; div &gt; div &gt; div");<br/>// the above returns the div for the middle column twitter feed</span></pre><p id="37d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个代表什么的图像:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/67db8498703d53db4f9e55cf6e225ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bbkSdLy4nW1cvZAO.png"/></div></div></figure><p id="b083" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了从中间一列获取所有的图像，我最终为<code class="fe lt lu lv lw b">page.evaluate()</code>函数做了如下工作:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="f052" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，如果我想编译一个所有图像源的列表并将它们打印到控制台，我所要做的就是在<code class="fe lt lu lv lw b">page.evaluate()</code>函数之外编写这个:</p><pre class="kg kh ki kj gt ly lw lz ma aw mb bi"><span id="e12b" class="mc md iq lw b gy me mf l mg mh">console.log(dimensions.sources);</span></pre><p id="4d27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就对了。您刚刚从Twitter feed中抓取了图像数据。</p><p id="337c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后一个挑战是将这些数据集成到Express.js服务器中，这样当用户访问根站点时，就可以看到所有这些抓取的图像。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="882a" class="ms md iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">资源</h1><ul class=""><li id="7989" class="nj nk iq ky b kz nl lc nm lf nn lj no ln np lr nq nr ns nt bi translated"><a class="ae kv" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a></li><li id="829b" class="nj nk iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated"><a class="ae kv" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank">打字稿</a></li><li id="c5e7" class="nj nk iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated"><a class="ae kv" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express.js </a></li></ul><p id="547f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>