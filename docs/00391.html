<html>
<head>
<title>I Wrote a Python Web Scraper That Sends Me Text Messages About Job Postings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我写了一个Python Web Scraper，它可以给我发送关于招聘信息的短信</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/so-i-wrote-a-py-web-scraper-that-sends-me-scpt-text-messages-about-job-postings-34ffef9a1128?source=collection_archive---------3-----------------------#2019-05-12">https://betterprogramming.pub/so-i-wrote-a-py-web-scraper-that-sends-me-scpt-text-messages-about-job-postings-34ffef9a1128?source=collection_archive---------3-----------------------#2019-05-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6a6e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">因为有时候你必须提高自己的水平才能被录用</h2></div><p id="530c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，让我给你一些关于这个小Python/AppleScript二人组是如何产生的背景。</p><p id="7d8f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我是通过一个恶作剧认识AppleScripts的。一个朋友写了一个脚本，通过iMessage给我发短信。我承认——这很有趣。我对他是怎么写的很感兴趣，看了一眼他的代码，然后就忘了。然后，大约一周后，我和FlatIron(我是那里的学生)的一名教师进行了一次有趣的谈话，内容是他如何在计划购买一辆卡车时，创建了一个web scraper来检查卡车的价格。我决定研究刮痧，亲自尝试一下，也许还可以顺便学习一些Python。</p><p id="c8ac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我开始试图为复仇者联盟的结局剧透刮红迪网。然后，在休息时间浏览Indeed.com上的工作时，我有了一个想法。为什么不写一个web scraper，当一个特定的子串出现在一个招聘信息的标题中时，它会给我发一条短信呢？我不知道“Junior”或“Jr”这两个词在开发人员的职位名称中出现的频率有多高，所以我认为尝试一下会是一件有趣的事情。</p><p id="ff24" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我不知道如何在Python文件中运行AppleScript文件——我甚至不知道Python！然而，我很自豪地说，我能够让它工作——通过黑客攻击、谷歌搜索、使用pip和阅读文档。我学到了很多，但最重要的是<em class="lb">我走出了自己的舒适区</em>。</p><p id="f942" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里有一个关于我如何创建我的刮刀的快速教程。在页面底部有一个到该项目的Github资源库的链接。</p><h1 id="f278" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated"><strong class="ak">快速设置</strong></h1><p id="7c0c" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如果你没有安装Python，我建议你点击这里<a class="ae lz" href="https://realpython.com/installing-python/" rel="noopener ugc nofollow" target="_blank">。</a> <br/> pip随Python一起安装，但如果您需要安装它，请点击这里<a class="ae lz" href="https://pip.pypa.io/en/stable/installing/" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="06ec" class="mj ld iq mf b gy mk ml l mm mn">pip install beautifulsoup<br/>pip install apscheduler</span></pre><p id="c41e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在终端中您想要创建两个脚本的目录下运行这些脚本。然后，我们将创建您需要的两个文件。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="7409" class="mj ld iq mf b gy mk ml l mm mn">touch scrape.py<br/>touch sentMessage.scpt</span></pre><p id="7538" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在您最喜欢的文本编辑器中打开这些，让我们开始吧！我们将首先从python文件开始，我们需要导入一些东西。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="dc46" class="mj ld iq mf b gy mk ml l mm mn"># scrape.py</span><span id="9db7" class="mj ld iq mf b gy mo ml l mm mn">import os<br/>import requests</span></pre><p id="48da" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们导入的第一个模块是<code class="fe mp mq mr mf b">os</code>。这使我们的Python脚本能够与运行它的操作系统交互——因为脚本是AppleScript，它将<em class="lb">让</em> <em class="lb">到</em>与OS X交互。第二个模块导入<code class="fe mp mq mr mf b">requests</code>是一个Apache2许可的HTTP库，它允许我们访问所有HTTP动词。这很有用，因为它可以自动向URL添加查询字符串和添加参数。接下来，我们将导入我们安装的pip包以及Python附带的一个名为datetime的包。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="433c" class="mj ld iq mf b gy mk ml l mm mn"># scrape.py</span><span id="86a3" class="mj ld iq mf b gy mo ml l mm mn">from BeautifulSoup import BeautifulSoup<br/>from apscheduler.schedulers.blocking import BlockingScheduler<br/>from datetime import datetime<br/>sch = BlockingScheduler()</span></pre><p id="7118" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe mp mq mr mf b">BeautifulSoup</code>从我们想要抓取的HTML页面中提取信息。<code class="fe mp mq mr mf b">apscheduler</code>允许我们每隔24小时运行一次脚本，进行每日更新。<code class="fe mp mq mr mf b">datetime</code>让我们在脚本执行期间访问当前的时间和日期。最后一行让我们通过sch变量访问<code class="fe mp mq mr mf b">apscheduler</code>模块。</p><p id="2bb7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们准备开始设置我们的铲运机！这是目前为止代码的样子:</p><figure class="ma mb mc md gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="3a33" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们编写<code class="fe mp mq mr mf b">main()</code>函数，我们将使用<code class="fe mp mq mr mf b">BlockingScheduler</code>来设置刮刀以我们选择的时间间隔运行。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="9fbf" class="mj ld iq mf b gy mk ml l mm mn"># scrape.py</span><span id="f29e" class="mj ld iq mf b gy mo ml l mm mn">def main():</span><span id="ac47" class="mj ld iq mf b gy mo ml l mm mn">return;</span></pre><p id="537c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">main内部是我们设置正在抓取的页面、get请求对url的响应以及通过响应进入的页面的HTML的地方。我刚去了indeed.com，搜索“web developer ”,用丹佛，CO作为我的过滤器。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="7094" class="mj ld iq mf b gy mk ml l mm mn">url = 'https://www.indeed.com/jobs?q=web%20developer&amp;l=Denver%2C%20CO&amp;vjk=0c0f7c56b3d79b4c'<br/>response = requests.get(url)<br/>html = response.content</span></pre><p id="c483" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要可读格式的HTML(或者至少对于Python是可读的),以便对其进行排序并挑选出我们需要的数据。因此，让我们把它扔进BeautifulSoup并在HTML中搜索！</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="90bb" class="mj ld iq mf b gy mk ml l mm mn">soup = BeautifulSoup(html)<br/>matches = soup.findAll(name='div', attrs={'class': 'title'})</span></pre><figure class="ma mb mc md gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/30f781018fb4e0891b385e8d54ff1839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5rE6MceuHC81ifm_4ZXWbg.png"/></div></div></figure><p id="d961" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们的soup变量保存了漂亮的HTML，我们需要对它进行排序。正如你在上面的截图中看到的，使用chrome dev tools的inspect元素(<code class="fe mp mq mr mf b">CMD + option + i</code>)，我能够确定职位发布的类名仅仅叫做‘title’。然后，我们用<code class="fe mp mq mr mf b">soup.findAll</code>搜索HTML，找到所有带有<code class="fe mp mq mr mf b">name='div'</code>的HTML元素，以及一个值为title: <code class="fe mp mq mr mf b">attrs={'class': 'title'}).</code>的class元素属性</p><p id="afba" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是目前为止我们的代码在Python文件中的样子:</p><figure class="ma mb mc md gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="fc9d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当这样做的时候，我做了很多控制台日志记录，但是我在main的底部添加了一个打印，所以如果你正在跟踪，你可以看到我们到目前为止所做的。</p><p id="23a9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要查看输出，导航到您创建两个脚本文件的目录并键入<code class="fe mp mq mr mf b">python scrape.py</code> —您应该会得到indeed.com首页上所有职位的列表。它看起来会像这样:</p><figure class="ma mb mc md gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nc"><img src="../Images/f00c097c41461d7aedb893d766e7ed26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pJz8DrBDYjDA4PMQUOBe7A.png"/></div></div></figure><p id="9ac2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们需要设置它，这样当有相关的工作发布时，我们就会收到一条短信！导航到Python脚本所在目录中的<code class="fe mp mq mr mf b">sendMessage.scpt</code>文件，我们将从一些简单的AppleScript开始。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="52d5" class="mj ld iq mf b gy mk ml l mm mn"># sendMessage.scpt</span><span id="c0e6" class="mj ld iq mf b gy mo ml l mm mn">on run {targetPhoneNumber, targetMessageToSend}</span><span id="d519" class="mj ld iq mf b gy mo ml l mm mn">end run</span></pre><p id="0083" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个on run函数接受两个参数，一个电话号码和一条消息，当我们决定是否要从py脚本生成一条文本消息时，它将被包含在内(这就是为什么我们在Python文件的顶部放了<code class="fe mp mq mr mf b">import 'os'</code>——这在后面会更有意义)。</p><p id="0a39" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们将告诉OSx应用程序“消息”，我们想向一个“服务类型”为iMessage的电话号码发送一条文本消息。</p><figure class="ma mb mc md gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="4ee9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Messages应用程序需要知道您发送消息的服务类型，所以我们告诉它<code class="fe mp mq mr mf b">targetPhoneNumber</code>(传递到函数中的)服务是im message。然后，我们将同样传递给函数的<code class="fe mp mq mr mf b">targetMessageToSend,</code>设置为一个变量。最后，我们告诉Messages将消息发送到我们提供的电话号码。下面是我们的<code class="fe mp mq mr mf b">sendMessage.scpt</code>看起来的样子——已经完成了！让我们回到Python脚本，告诉它何时发送文本消息。</p><p id="5167" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还记得我们在漂亮的HTML上做了一个<code class="fe mp mq mr mf b">.findAll</code>并得到了一个职位列表吗？我们现在需要做的就是对这个列表进行排序，看看是否有任何部分的职位和初级开发人员的职位相匹配。我们将在我们的主功能中执行这个逻辑。</p><figure class="ma mb mc md gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="3f5b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用for循环迭代职称，看看字符串“Junior”或“Jr”是否存在。如果其中一个或两个都有，那么我们使用操作系统模块从Python脚本中执行终端操作。<code class="fe mp mq mr mf b">os.system("osascript sendMessage.scpt YOUR_NUMBER_HERE ‘YOUR_MESSAGE_HERE' “)</code>用你的电话号码和你想发送的信息替换占位符(我用页面的原始网址替换了信息，这样我就可以直接通过短信打开它)。这些将是我们传递到AppleScript文件中的参数(如果您还记得的话)。然后，在每场比赛结束时，如果我们至少有一场比赛，我们就打破循环——以确保如果页面上有多场比赛，我们不会收到垃圾短信。</p><p id="6a5b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">到目前为止，我们的刮锉是这样的:</p><figure class="ma mb mc md gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="fdae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后要做的是为它的运行设置一个时间间隔。这就是<code class="fe mp mq mr mf b">BlockingScheduler</code>和我们的sch变量派上用场的地方。对于主函数，在返回之后，我们添加这两行代码:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e132" class="mj ld iq mf b gy mk ml l mm mn">sch.add_job(main, 'interval', seconds=3)<br/>print('Press Ctrl+{0} to exit'.format('Break' if os.name == 'nt' else 'C'))</span></pre><p id="c637" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一行为调度程序添加一个作业，在<code class="fe mp mq mr mf b">seconds=3</code>的<code class="fe mp mq mr mf b">'interval'</code>上运行<code class="fe mp mq mr mf b">main()</code>功能。3秒仅用于测试目的-具有不同整数值的<code class="fe mp mq mr mf b">hours=12</code>和<code class="fe mp mq mr mf b">minutes=10</code>也是可接受的参数。我们有一个简单的try/exception语句来启动调度程序！</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="3b55" class="mj ld iq mf b gy mk ml l mm mn">try:<br/>    sch.start()<br/>except (KeyboardInterrupt, SystemExit):<br/>    pass</span></pre><p id="5be7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好吧……我知道，的确已经提供了类似这样的服务，可能还包括电子邮件！尽管如此，学习和构建这个小脚本还是很有趣的。作为一名开发人员，我的旅程才刚刚开始，但是，如果这段经历值得一提的话，我非常乐意继续下去！</p><p id="2420" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我们完成的<code class="fe mp mq mr mf b">scraper.py</code>文件。</p><figure class="ma mb mc md gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="ed4f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样！你现在可以在改变值后在你的终端中输入<code class="fe mp mq mr mf b">python scraper.py</code>，并看到你的scraper给你发送文本。</p><p id="3310" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想改变你正在抓取的网页和你正在寻找的内容，BeautifulSoup文档在这里<a class="ae lz" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank">。</a>逻辑都在那里，你可能需要比我做更多的排序。</p><p id="1e3a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">再一次，我在做这件事的时候获得了很多乐趣。我希望这篇文章信息丰富，也许对其他人有用。</p><h1 id="344f" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">资源</h1><ul class=""><li id="3d67" class="nd ne iq kh b ki lu kl lv ko nf ks ng kw nh la ni nj nk nl bi translated">这个作品的<a class="ae lz" href="https://github.com/yeah-right/py-scraper-texter" rel="noopener ugc nofollow" target="_blank"> GitHub项目</a></li></ul></div></div>    
</body>
</html>