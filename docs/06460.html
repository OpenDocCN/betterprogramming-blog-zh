<html>
<head>
<title>Composition Over Inheritance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">继承之上的组合</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/composition-over-inheritance-9929af861546?source=collection_archive---------0-----------------------#2020-10-04">https://betterprogramming.pub/composition-over-inheritance-9929af861546?source=collection_archive---------0-----------------------#2020-10-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4378" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用科特林为作曲提供动力</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e7103e8e4f909cd5bde673a107b1f276.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*29KzhfL8h85O-pllhs1zVA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@xavi_cabrera" rel="noopener ugc nofollow" target="_blank">哈维·卡夫雷拉</a>在<a class="ae kv" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="5738" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转向单活动架构包括将代码从活动转移到片段，以确保最大的可重用性和可读性。应用继承<code class="fe ls lt lu lv b">BaseFragment</code>是这样开始的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">碱基片段</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/94beee33f7db2359d0da53d24adac3b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*zcF_gFZ_iBZ7BBiaNMKueg.png"/></div></figure><h2 id="61c2" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated"><strong class="ak">这些片段的功能行为</strong></h2><ul class=""><li id="6e43" class="ms mt iq ky b kz mu lc mv lf mw lj mx ln my lr mz na nb nc bi translated">订单明细片段:有静态数据</li><li id="e9ae" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated">订单帮助片段:必须进行网络调用来填充数据</li><li id="0074" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated">跟踪片段:必须进行网络调用来填充数据</li></ul><h2 id="b14d" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated"><strong class="ak">这些片段的视觉行为</strong></h2><ul class=""><li id="4d94" class="ms mt iq ky b kz mu lc mv lf mw lj mx ln my lr mz na nb nc bi translated">订单细节片段:修改状态栏颜色</li><li id="a9c6" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated">Order Help片段:修改状态栏的颜色，当软键盘出现时，可以调整布局的大小</li><li id="6c5f" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated">跟踪片段:没有额外的视觉要求</li></ul></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><h1 id="9951" class="np ma iq bd mb nq nr ns me nt nu nv mh jw nw jx mk jz nx ka mn kc ny kd mq nz bi translated"><strong class="ak">攻关</strong></h1><h2 id="477c" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">可能的解决方案</h2><div class="kg kh ki kj gt ab cb"><figure class="oa kk ob oc od oe of paragraph-image"><img src="../Images/87e22be5f77da69aa00bf3eec6f19d7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*D8qaHl1XY071j0fADMeyTw.png"/></figure><figure class="oa kk og oc od oe of paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/2a760ede7f37e366ba5b7d5b42683f0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*Z63OqmR-EE8dEb3KPFx2Nw.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk oh di oi oj translated">(照片由<a class="ae kv" href="https://unsplash.com/@carsonarias" rel="noopener ugc nofollow" target="_blank">卡森·阿里亚斯</a>在<a class="ae kv" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure></div><div class="ab cb"><figure class="oa kk ok oc od oe of paragraph-image"><img src="../Images/c53e4213929537bb6d9d2bca13d3ffbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*mtSS7zU-IXA0c3vzd76j2w.png"/></figure><figure class="oa kk ol oc od oe of paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/3602261e385f9ef05599100e1bac177e.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*gRih5doPAqIZAngMGpJIJQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk om di on oj translated">通用行为定义(可读性噩梦)(由<a class="ae kv" href="https://drawception.com/player/737219/alisondrawsstuff/" rel="noopener ugc nofollow" target="_blank"> AlisonDrawsStuff </a>绘制)</p></figure></div><p id="65dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem" rel="noopener ugc nofollow" target="_blank">致命的钻石问题</a>平息了你对为什么Java不允许多重继承的思考。</p><p id="7c7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这仅仅是开始，我们还有几个令人惊讶的需求片段随时准备扑向我们。</p><p id="08a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除此之外，我们还必须采用像<a class="ae kv" href="https://dagger.dev/#:~:text=Dagger%20is%20a%20fully%20static,have%20plagued%20reflection-based%20solutions" rel="noopener ugc nofollow" target="_blank"> Dagger </a>和数据绑定这样的框架，能够在访问频率较高的页面上应用框架之前，先在访问频率较低的页面上测试框架</p><blockquote class="oo"><p id="bf4a" class="op oq iq bd or os ot ou ov ow ox lr dk translated"><em class="oy"/><strong class="ak"><em class="oy">来继承遗产的人往往要支付丧葬费。</em> </strong></p></blockquote></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><h1 id="b1e7" class="np ma iq bd mb nq nr ns me nt nu nv mh jw nw jx mk jz nx ka mn kc ny kd mq nz bi translated"><strong class="ak">科特林接口来救援</strong></h1><p id="79a9" class="pw-post-body-paragraph kw kx iq ky b kz mu jr lb lc mv ju le lf oz lh li lj pa ll lm ln pb lp lq lr ij bi translated"><a class="ae kv" href="https://kotlinlang.org/" rel="noopener ugc nofollow" target="_blank"> Kotlin </a>中的<a class="ae kv" href="https://kotlinlang.org/docs/reference/interfaces.html" rel="noopener ugc nofollow" target="_blank">接口</a>与Java 8中的接口非常相似。它们可以包含抽象方法以及方法实现的声明。</p><p id="9819" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">听起来很有希望？让我们试一试。</p><p id="8548" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是修改状态栏颜色的样板文件:</p><pre class="kg kh ki kj gt pc lv pd pe aw pf bi"><span id="9f13" class="lz ma iq lv b gy pg ph l pi pj"><strong class="lv ir">interface </strong>StatusBarModificationBehavior {<br/><br/>    <strong class="lv ir">var oldStatusBarColor</strong>: Int<br/>    <strong class="lv ir">val statusBarColor</strong>: Int<br/>    <br/>    <strong class="lv ir">fun </strong>getContext(): Context?<br/>    <br/>   <strong class="lv ir">fun </strong>onAttach() {<br/>        getContext?.<em class="pk">takeIf </em><strong class="lv ir">{ </strong>context <strong class="lv ir">is </strong>FragmentActivity <strong class="lv ir">}</strong>?.<em class="pk">apply </em><strong class="lv ir">{<br/>            oldStatusBarColor </strong>= StatusBarUtils.changeStatusBarColor(ContextCompat.getColor(<strong class="lv ir">this</strong>, <strong class="lv ir">statusBarColor</strong>), <strong class="lv ir">this as </strong>FragmentActivity)<br/>        <strong class="lv ir">}<br/>    </strong>}<br/><br/>    <strong class="lv ir">fun </strong>onDetach() {<br/>        getContext()?.<em class="pk">takeIf </em><strong class="lv ir">{ it is </strong>FragmentActivity <strong class="lv ir">}</strong>?.<em class="pk">apply </em><strong class="lv ir">{<br/>            </strong>StatusBarUtils.changeStatusBarColor(<strong class="lv ir">oldStatusBarColor</strong>, <strong class="lv ir">this as </strong>FragmentActivity)<br/>        <strong class="lv ir">}<br/>    </strong>}<br/>}</span></pre><p id="80d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是正确处理Rx订阅的样板文件:</p><pre class="kg kh ki kj gt pc lv pd pe aw pf bi"><span id="cf1d" class="lz ma iq lv b gy pg ph l pi pj"><strong class="lv ir">interface </strong>RXSubscriptionBehavior {<br/><br/>    <strong class="lv ir">var subscriptions</strong>: CompositeDisposable<br/><br/>    <strong class="lv ir">fun </strong>onDestroy(){<br/>        <strong class="lv ir">subscriptions</strong>.clear()<br/>    }<br/><br/>}</span></pre><div class="kg kh ki kj gt ab cb"><figure class="oa kk pl oc od oe of paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/5e361b4d9faf38e6d1940cb5a99cfd39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*QxUmguQUDTqXHKp2IgZQfw.png"/></div></figure><figure class="oa kk pm oc od oe of paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/ffd602da2b0c3eb09a5f588802ebfaae.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*_ogxN0faFgVOAHv_m2qHZg.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk pn di po oj translated">精确和可扩展的行为定义。(图片来源:<a class="ae kv" href="https://www.pinterest.com.au/pin/650910952367828421/?autologin=true" rel="noopener ugc nofollow" target="_blank"> Pinterest </a>)</p></figure></div><p id="00e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用合成的片段:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">订单详细信息片段</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">订单帮助片段</p></figure><p id="987b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着时间的推移，我们已经在架构和外观方面创建了许多这样的接口，我们的一些片段定义看起来类似于以下内容:</p><pre class="kg kh ki kj gt pc lv pd pe aw pf bi"><span id="308f" class="lz ma iq lv b gy pg ph l pi pj"><strong class="lv ir">class </strong>OrderHelpFragment : Fragment(),<br/>    DataBindingViewModelArchitecture&lt;FragmentOrderHelpBinding, OrderHelpViewModel&gt;,<br/>    DependencyInjectionArchitecture,<br/>    ToolbarBehavior, StatusBarModificationBehavior, RXSubscriptionBehavior, SnackbarBehavior</span></pre></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><h1 id="fe5b" class="np ma iq bd mb nq nr ns me nt nu nv mh jw nw jx mk jz nx ka mn kc ny kd mq nz bi translated">内部构件</h1><p id="0f9e" class="pw-post-body-paragraph kw kx iq ky b kz mu jr lb lc mv ju le lf oz lh li lj pa ll lm ln pb lp lq lr ij bi translated">Kotlin是如何实现这个超级接口语法糖的？反编译Kotlin字节码揭示了一个使用静态类成员的简单解决方案。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">StatusBarModificationBehavior生成的类</p></figure><p id="cdf7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种方法为我们提供了与通用定义方法相当的可伸缩性，并极大地增加了可读性。</p></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="0fb3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:本文虽然是在Android应用程序架构的背景下撰写的，但概述了可以使用Kotlin等现代编程语言应用的一般设计原则。</p></div></div>    
</body>
</html>