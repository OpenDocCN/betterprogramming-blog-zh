<html>
<head>
<title>Build a Gatsby Authentication Flow with Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Firebase构建一个Gatsby认证流</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-gatsby-authentication-flow-with-firebase-72b9514f6c9b?source=collection_archive---------4-----------------------#2022-07-26">https://betterprogramming.pub/build-a-gatsby-authentication-flow-with-firebase-72b9514f6c9b?source=collection_archive---------4-----------------------#2022-07-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="62cd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Firebase身份验证保护您的Gatsby应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6a9d1ca767fce44dfd44bcf2faeb497d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8alaO84QxTWl_S5cIkLXAQ.jpeg"/></div></div></figure><h1 id="9640" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="7078" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">本指南将带您了解如何在Gatsby应用程序中使用Firebase建立一个认证流，并将其部署到Netlify主机。遵循本指南后，您将拥有一个可用的Gatsby应用程序，包括:</p><ul class=""><li id="8846" class="mi mj it lo b lp mk ls ml lv mm lz mn md mo mh mp mq mr ms bi translated">成熟的登录和注册流程。</li><li id="9892" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh mp mq mr ms bi translated">安全电子邮件/密码认证。</li><li id="bfaf" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh mp mq mr ms bi translated">重置密码</li><li id="c482" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh mp mq mr ms bi translated">安全的用户配置文件页面。</li><li id="0c05" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh mp mq mr ms bi translated">部署到网络</li></ul><p id="6917" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">这里有一个可用的演示应用程序<a class="ae nb" href="https://eloquent-raindrop-845523.netlify.app" rel="noopener ugc nofollow" target="_blank"/>。提供了完整的源代码。</p><h1 id="14fe" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">关于盖茨比</h1><p id="2f35" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><a class="ae nb" href="https://www.gatsbyjs.com/" rel="noopener ugc nofollow" target="_blank"> Gatsby </a>创建于2015年，是一个基于Node.js使用React和GraphQL构建的开源静态站点生成器。它提供了超过2500个插件来创建基于Markdown文档、MDX、图像和众多内容管理系统(如WordPress、Drupal等)的静态站点。它的速度快得像闪电一样，因为服务器端将JavaScript渲染到静态站点文件中，这些文件被缩小，可以通过内容交付网络提供服务。</p><p id="f63c" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">由于Gatsby中的所有页面都呈现为静态内容，所以Gatsby站点的用户身份验证不能在服务器上执行，而必须通过客户端路由进行保护。</p><p id="607e" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">本教程将带您在Gatsby中使用一个健壮的解决方案(如Firebase)来设置客户端身份验证，以及如何在您的Gatsby应用程序中管理登录的用户。</p><h1 id="7dd3" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">出发点</h1><p id="be66" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们从Gatsby examples文件夹中的简单认证流程开始。我已经分叉了Gatsby项目，并在这里用简单的auth创建了一个起点:【https://github.com/mlomboglia/simple-auth<a class="ae nb" href="https://github.com/mlomboglia/simple-auth" rel="noopener ugc nofollow" target="_blank"/></p><p id="9d17" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">只需克隆项目:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="8cea" class="nh kv it nd b gy ni nj l nk nl">$ git clone <a class="ae nb" href="https://github.com/mlomboglia/simple-auth" rel="noopener ugc nofollow" target="_blank">https://github.com/mlomboglia/simple-auth</a></span><span id="4b0f" class="nh kv it nd b gy nm nj l nk nl">$ cd simple-auth</span></pre><p id="1088" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">我假设您已经安装了NodeJS。如果没有，您可以在此安装它:</p><div class="nn no gp gr np nq"><a href="https://nodejs.org/en/download/" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd iu gy z fp nv fr fs nw fu fw is bi translated">下载| Node.js</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">Node.js是基于Chrome的V8 JavaScript引擎构建的JavaScript运行时。</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">nodejs.org</p></div></div><div class="nz l"><div class="oa l ob oc od nz oe ks nq"/></div></div></a></div><h2 id="98de" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">升级至Gatsby的最新版本</h2><p id="ed83" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在项目根文件夹中</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="7566" class="nh kv it nd b gy ni nj l nk nl">$ npm install gatsby@latest --legacy-peer-deps</span></pre></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><h1 id="73bc" class="ku kv it bd kw kx ox kz la lb oy ld le jz oz ka lg kc pa kd li kf pb kg lk ll bi translated">Firebase设置</h1><p id="a2ef" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">Firebase Authentication提供后端服务、易于使用的SDK和现成的UI库，用于向您的应用程序验证用户。它支持使用密码、电话号码、流行的联合身份提供商(如谷歌、脸书和Twitter)等进行身份认证。</p><p id="b2a0" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">Firebase身份验证与其他Firebase服务紧密集成，它利用了OAuth 2.0和OpenID Connect等行业标准，因此可以轻松地与您的自定义后端集成。</p><p id="9dec" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">在这个演示中，我将设置一个电子邮件/密码身份验证提供者。许多其他选项是可用的。</p><p id="4816" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">打开Firebase控制台。</p><p id="55b7" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">添加新项目，选择名称，并创建项目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/aff525bedea56932885d0ed344cd2030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*82fNhV4fRz5sGvobbZNySQ.png"/></div></div></figure><p id="5c21" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">点击Web图标，添加新的Web应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/15c46de2f44cd6b1d4c307482599c13d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bD-L3UofzbvsNzRgBmGqww.png"/></div></div></figure><p id="0eb2" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">复制Firebase配置项目，并保存它们以备后用。</p><p id="9c48" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">我将把它们作为环境变量添加进来。</p><p id="c4db" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">点击认证。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/a3a170fe2f093e6a80ea17fb2a3413cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GIbKy9oIeeWNDKTztvIMcQ.png"/></div></div></figure><p id="e6ff" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">启用电子邮件/密码选项。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/cf99358ea824c64306de7bbe7655d7f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*56EP7tGnNTUrdovDhMYiug.png"/></div></div></figure><p id="e256" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">在您的项目根文件夹中，安装Firebase SDK</p><p id="2ba2" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated"><code class="fe pg ph pi nd b">$ npm i firebase</code></p><h2 id="b26d" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">燃烧基成分</h2><p id="4e35" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在，让我们创建Firebase组件。</p><p id="5fec" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">打开你最喜欢的IDE。我用的是Visual Studio代码。</p><p id="c37a" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">在你的<code class="fe pg ph pi nd b">src/components</code>上创建一个文件夹<code class="fe pg ph pi nd b">Firebase</code>。</p><p id="b354" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">创建<code class="fe pg ph pi nd b">Firebase.js</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><h2 id="5c29" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">环境变量</h2><p id="7915" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">Gatsby内置了将环境变量加载到浏览器和函数中的支持。</p><p id="670a" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">要将这些加载到Node.js中，请将以下代码片段添加到您的<code class="fe pg ph pi nd b">gatsby-config.js</code>文件的顶部:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="a8c1" class="nh kv it nd b gy ni nj l nk nl">require("dotenv").config({<br/>   path: `.env.${process.env.NODE_ENV}`,<!-- --> <br/>})</span></pre><p id="2981" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">在开发中，Gatsby将从名为<code class="fe pg ph pi nd b">.env.development</code>的文件中加载环境变量。对于构建，它将从<code class="fe pg ph pi nd b">.env.production</code>开始加载。</p><p id="327f" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">在项目的根文件夹中创建一个文件<code class="fe pg ph pi nd b"><strong class="lo iu">env.development</strong></code>。</p><p id="11de" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">添加以下变量:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="04e3" class="nh kv it nd b gy ni nj l nk nl">GATSBY_FIREBASE_API_KEY=&lt;from firebase console config&gt;<br/>GATSBY_FIREBASE_AUTH_DOMAIN=<!-- -->&lt;from firebase console config&gt;<br/>GATSBY_FIREBASE_DATABASE_URL=<!-- -->&lt;from firebase console config&gt;<br/>GATSBY_FIREBASE_PROJECT_ID=<!-- -->&lt;from firebase console config&gt;<br/>GATSBY_FIREBASE_STORAGE_BUCKET=<!-- -->&lt;from firebase console config&gt;<br/>GATSBY_FIREBASE_MESSAGING_SENDER_ID=<!-- -->&lt;from firebase console config&gt;<br/>GATSBY_FIREBASE_APP_ID=<!-- -->&lt;from firebase console config&gt;<br/>GATSBY_FIREBASE_MEASUREMENT_ID=<!-- -->&lt;from firebase console config&gt;</span></pre><h2 id="59ed" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">将<code class="fe pg ph pi nd b">.env*</code>文件添加到。gitignore</h2><p id="24fc" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">环境变量文件不应该提交给Git，因为它们通常包含秘密，添加到Git是不安全的。相反，将<code class="fe pg ph pi nd b">.env.*</code>添加到您的<code class="fe pg ph pi nd b">.gitignore</code>文件中，并在Gatsby Cloud和本地手动设置环境变量。</p></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><h1 id="5b4a" class="ku kv it bd kw kx ox kz la lb oy ld le jz oz ka lg kc pa kd li kf pb kg lk ll bi translated">反应上下文API</h1><p id="16e8" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">为了在Gatsby站点的全局级别上管理我们的<code class="fe pg ph pi nd b">user</code>的状态，我们将实现React上下文API。让我们将Gatsby根元素包装在我们的上下文提供程序中，以确保我们的上下文值对我们应用程序中的所有消费组件都可用。</p><p id="8230" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">在<a class="ae nb" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank"> React文档</a>中可以找到更多相关信息。</p><h2 id="72de" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">语境</h2><p id="211a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在components文件夹中创建一个Auth文件夹。</p><p id="90df" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">创建<code class="fe pg ph pi nd b">AuthContext.js</code>文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="4c68" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">为了让我们应用程序中的所有组件成为<strong class="lo iu">上下文消费者</strong>，我们需要将我们的自定义<code class="fe pg ph pi nd b">&lt;AuthProvider&gt;</code>组件包装在Gatsby根元素周围。</p><p id="6af2" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">让我们在我们的<code class="fe pg ph pi nd b">AuthContext.js</code>文件中使用一个辅助函数<code class="fe pg ph pi nd b">wrapRootElement</code>组件，它导出了我们的<code class="fe pg ph pi nd b">&lt;AuthProvider&gt;</code>组件，该组件包装了将被传递给我们的<code class="fe pg ph pi nd b">wrapRootElement</code>函数的<code class="fe pg ph pi nd b">{ element }</code>属性。我们现在需要做的就是使用<code class="fe pg ph pi nd b">gatsby-browser.js</code>来导入(并立即导出)我们的<code class="fe pg ph pi nd b">wrapRootElement</code>函数。</p><p id="7996" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">打开项目目录中的<code class="fe pg ph pi nd b">gatsby-browser.js</code>,添加:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><h2 id="0175" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">状态</h2><p id="cdf5" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">状态组件将显示是否经过身份验证的用户。</p><p id="99bf" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">编辑状态文件夹中的<code class="fe pg ph pi nd b">index.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><h1 id="43b7" class="ku kv it bd kw kx ox kz la lb oy ld le jz oz ka lg kc pa kd li kf pb kg lk ll bi translated">按指定路线发送</h1><p id="d693" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">要创建一个内容受限的网站，仅限认证用户，我们可以使用<a class="ae nb" href="https://www.gatsbyjs.com/docs/client-only-routes-and-user-authentication/" rel="noopener ugc nofollow" target="_blank">客户端专用路由</a>的概念来定义用户只有在登录后才能查看哪些页面。</p><p id="5b5a" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">使用<a class="ae nb" href="https://reach.tech/router/" rel="noopener ugc nofollow" target="_blank"> @reach/router </a>库，你可以创建只对登录用户可用的路线。这个库是盖茨比引擎盖下用的，你甚至不用安装。</p><p id="c379" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">首先，在项目的根目录下创建<code class="fe pg ph pi nd b">gatsby-node.js</code>。您将定义任何以<code class="fe pg ph pi nd b">/app/</code>开头的路线都是您的受限内容的一部分，页面将按需创建:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="e9f2" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">现在，我们将在我们的<code class="fe pg ph pi nd b">./src/pages/</code>文件夹中创建一个名为<code class="fe pg ph pi nd b">app.js</code>的页面，它将导入我们的组件，并使用<code class="fe pg ph pi nd b">@reach/router</code>库中的一个助手来处理客户端专用的动态路由。在<code class="fe pg ph pi nd b">./src/pages/app.js</code>中创建如下所示的文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><h2 id="d8ff" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">登录路线</h2><p id="2453" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">对于登录组件，我将使用<code class="fe pg ph pi nd b">firebase/auth</code>库中可用的<code class="fe pg ph pi nd b">signInWithEmailAndPassword</code>方法:</p><p id="0880" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">在组件文件夹中创建<code class="fe pg ph pi nd b">Login.js</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><h2 id="df68" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">注册路线</h2><p id="96f8" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">要注册用户，我们可以使用firebase/auth组件中可用的<code class="fe pg ph pi nd b">createUserWithEmailAndPassword</code>方法:</p><p id="5e72" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">在组件文件夹中创建<code class="fe pg ph pi nd b">Register.js</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><h2 id="b2a6" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">重置密码路由</h2><p id="e93f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">类似于密码重置，我将使用<code class="fe pg ph pi nd b">sendPasswordResetEmail</code></p><p id="19d6" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">创建<code class="fe pg ph pi nd b">Reset.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="d5ab" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">Firebase允许您自定义您的电子邮件域，以及用于密码重置的电子邮件模板消息。</p><h2 id="befa" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">专用路由组件</h2><p id="f58d" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><code class="fe pg ph pi nd b">&lt;PrivateRoute /&gt;</code>组件将验证用户是否通过认证。如果当前用户存在，它将加载门控组件。</p><p id="278e" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">在组件文件夹中创建<code class="fe pg ph pi nd b">PrivateRoute.js</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><h2 id="9b7d" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">安全配置文件路由</h2><p id="f765" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">如果用户通过身份验证，将加载配置文件路由。</p><p id="7530" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">在<code class="fe pg ph pi nd b">components</code>文件夹中创建<code class="fe pg ph pi nd b">Profile.js</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><h2 id="56de" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">页眉</h2><p id="2364" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在您的<code class="fe pg ph pi nd b">Header/index.js</code>上将链接调整到<code class="fe pg ph pi nd b">&lt;Link to=”/app/profile” className={header__link}&gt;</code></p><h1 id="da96" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">测试</h1><p id="d25c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在，我们准备测试应用程序</p><p id="1872" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">使用<code class="fe pg ph pi nd b">$ gatsby develop</code>运行您的应用程序</p><p id="cb53" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">打开<code class="fe pg ph pi nd b"><a class="ae nb" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/</a></code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/80eb87591d92fd4b3567f8190a485f3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H5WQJ-Y3KZ4y5dzvbme_tQ.png"/></div></div></figure><p id="221c" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">注册新用户，登录以导航到配置文件屏幕。</p><p id="77e1" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">此处 有可用的演示应用<a class="ae nb" href="https://eloquent-raindrop-845523.netlify.app" rel="noopener ugc nofollow" target="_blank"> <strong class="lo iu"/></a></p><p id="c84d" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">完整的源代码可从以下网址获得:</p><div class="nn no gp gr np nq"><a href="https://github.com/mlomboglia/gatsby-auth-firebase" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd iu gy z fp nv fr fs nw fu fw is bi translated">GitHub-mlomboglia/gatsby-auth-firebase:带有Firebase的Gatsby认证流</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">基于Firebase的Gatsby认证流程。为mlomboglia/Gatsby-auth-firebase开发做出贡献，创建一个…</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">github.com</p></div></div><div class="nz l"><div class="pm l ob oc od nz oe ks nq"/></div></div></a></div><h1 id="841f" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">网络部署</h1><p id="d724" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">让我们将应用程序部署到Netlify。</p><p id="7ddd" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">在你最喜欢的Git提供者中提交你的所有代码，比如Github。</p><p id="8e8f" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">如果你没有的话，创建一个Netlify帐户(注册是免费的)。</p><h2 id="8b78" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">步骤1:添加新站点</h2><p id="acbe" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">点击<strong class="lo iu">添加新站点</strong> →从模板导入选项</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/268f8a83ce5c14c254b8a9b14b91d978.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3_rbykK4k8KEVlxw5HZtJw.png"/></div></div></figure><h2 id="6169" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">第2步:链接到您的Git提供者(或者选择支持的版本控制工具)</h2><p id="b74b" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我用的是GitHub。将您的回购推送到GitHub，这样我们需要做的就是将Netlify链接到GitHub。点击GitHub按钮，如上图所示。</p><h2 id="acb8" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">步骤3:授权网络生活</h2><p id="f05b" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">如果未授权，请通过单击授权选项允许Netlify和GitHub相互对话。</p><h2 id="4ef6" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">第四步:选择你的回购</h2><p id="0ae2" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在您已经连接了Netlify和GitHub，您可以看到您的Git repos列表。从列表中选择要部署的存储库。点击<strong class="lo iu">部署站点</strong></p><p id="e104" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">几分钟后，你应该你的新网站上市。</p><h2 id="ff63" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">步骤5:配置您的设置</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/0346fd67af565eba534783f266772a86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qzVJMmjvd2q07-NdyB_zWQ.png"/></div></div></figure><p id="3502" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">单击站点设置→构建和部署→环境</p><p id="a8f4" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">添加您的环境变量，因为它们在<code class="fe pg ph pi nd b">env.development</code>文件中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/8eda85e7a91fa842592622701cf3cac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*29YuF_kPe5xAJBRkfJsnPw.png"/></div></figure><h2 id="ce56" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">第六步:建立你的网站</h2><p id="8296" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">重建你的网站！</p><h2 id="7a41" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">步骤7:在Firebase中授权您的域</h2><p id="ff45" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在，我们需要在Firebase中授权新的域</p><p id="9b3b" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">转到Firebase控制台→身份验证→设置</p><p id="2c20" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">单击添加域，将您的Netlify部署的应用程序域添加到授权列表中</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/148647340d99979eb9cf6b1217c4461a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UFGydhnvmzM9sbYTmfxWhA.png"/></div></div></figure><h2 id="3319" class="nh kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">步骤8:在Netlify中测试你的应用</h2><p id="d3a7" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在Netlify中单击您的应用程序URL，您应该有一个部署了Firebase的Gatsby身份验证流程的完整工作版本</p><p id="3a33" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">搞定了。</p></div></div>    
</body>
</html>