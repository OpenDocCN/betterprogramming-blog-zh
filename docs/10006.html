<html>
<head>
<title>Build an Easy Popin System With React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React构建一个简单的Popin系统</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-an-easy-popup-system-with-react-8858370cf700?source=collection_archive---------3-----------------------#2021-11-12">https://betterprogramming.pub/build-an-easy-popup-system-with-react-8858370cf700?source=collection_archive---------3-----------------------#2021-11-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="db5b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">揭秘用React创建一个简单、可定制和可访问的popin系统的方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2267b0b06fc176f8cd48b67fd45f271d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NKT6xWanCWaVCVCo9tit6w.jpeg"/></div></div></figure><h1 id="0460" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">对现有系统的担忧</h1><p id="b017" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">有很多popin系统，但是它们通常不能满足我对用户界面和开发简单性的高质量要求。</p><p id="f25c" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">当我将popin添加到网站时，对我来说重要的是系统:</p><ul class=""><li id="81a2" class="mn mo it lo b lp mi ls mj lv mp lz mq md mr mh ms mt mu mv bi translated"><strong class="lo iu">简单易用</strong>:作为一名开发者，我不想花时间创建大量的组件和状态来激活弹出窗口。开发人员最好把时间花在领域特性上，而不是无脑的任务上</li><li id="3af5" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated"><strong class="lo iu">可定制</strong>:这通常是我的主要复杂点，因为popin系统几乎总是带有样式化组件，这使得它们看起来更难像你的UI设计师想象的那样。</li><li id="6f7e" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">可访问性(Accessible):可访问性通常被从系统中分离出来，因为它需要更多的工作，即使它不需要那么多的工作。</li></ul><p id="9978" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">根据这些需求，我总是发现很难找到我需要的库，而且阻塞点常常太痛苦而无法解决。</p><p id="f7f8" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">即使这可能不是直观的，最后一个站得住脚的选择是创建我们自己的系统，这样将确保与我们的需求完美匹配</p><p id="65b3" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">说够了，让我们开始创建一个popin组件系统。</p><h1 id="5cd2" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">我们在建造什么</h1><p id="5b63" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在这个弹出系统中，我们需要一些东西:</p><ul class=""><li id="7433" class="mn mo it lo b lp mi ls mj lv mp lz mq md mr mh ms mt mu mv bi translated">将负责popin样式的自定义模式组件，包括背景、位置和关闭按钮</li><li id="070b" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">一个易于使用的模式组件，带有一个简单的切换系统，将负责popin的功能部分。</li><li id="ef9b" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">使CSS模态柔和出现的过渡状态</li><li id="3c81" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">支持人们拥有一个激活了减少运动的浏览器</li><li id="d55d" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">处理模式上的可访问性，以告诉残障人士弹出窗口已经出现，并告诉他们单击哪里，这样弹出窗口将被关闭</li><li id="6c47" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">当我们点击时，一个可点击的背景覆盖关闭弹出窗口</li><li id="61ee" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">使用退出键关闭popin</li></ul><p id="c5b6" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">有很多事要做，所以我们最好开始做。</p><h1 id="c6ef" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">要求</h1><p id="cd44" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">拥有模态系统的第一件事是要有一个模态根，系统将在那里发生。为此，我们只需要在根文档中有一个新的<code class="fe nb nc nd ne b">div#modal-root</code>元素。</p><p id="2552" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这一部分很重要，因此可以很容易地设计模态。有了一个单独的根元素，我们就可以确定modal的父元素没有样式，这使得我们很难达到完美的样式。</p><p id="bde5" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">为了确保模态总是在文档的顶部，我们只需要在应用程序根和模态根上添加正确的<code class="fe nb nc nd ne b">z-index</code>。</p><p id="8752" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">此外，由于模态行为将被打开并直接占据整个浏览器的页面，我们向模态系统添加了一个<a class="ae nf" href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Live_Regions" rel="noopener ugc nofollow" target="_blank"> ARIA live region </a>，这样它就可以向用户公布了。</p><p id="4521" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">aria-live区域被设置为assertive，因为我们希望读者具有与浏览器相同的行为，浏览器将popin置于所有其他内容之上。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h1 id="55bc" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">模态分量</h1><p id="437c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">模态分量分为三个不同的分量:</p><ul class=""><li id="3df4" class="mn mo it lo b lp mi ls mj lv mp lz mq md mr mh ms mt mu mv bi translated">一个<code class="fe nb nc nd ne b">ModalPortal</code>组件，它将我们的模态链接到<code class="fe nb nc nd ne b">div#modal-root</code>元素</li><li id="6368" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">一个旨在处理组件可见部分的<code class="fe nb nc nd ne b">ModalView</code>组件</li><li id="ac55" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">一个<code class="fe nb nc nd ne b">ModalAnimated</code>组件，它将处理popin域和popin系统的CSS外观效果</li></ul><h2 id="071c" class="ni kv it bd kw nj nk dn la nl nm dp le lv nn no lg lz np nq li md nr ns lk nt bi translated">ModalPortal组件</h2><p id="b4b3" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><code class="fe nb nc nd ne b">ModalPortal</code>组件的存在是为了将我们的弹出窗口链接到我们已经创建的<code class="fe nb nc nd ne b">div#modal-root</code>元素。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="9a53" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">它由四部分组成:</p><ul class=""><li id="d999" class="mn mo it lo b lp mi ls mj lv mp lz mq md mr mh ms mt mu mv bi translated">一个<code class="fe nb nc nd ne b">ref</code>对应于一个简单的<code class="fe nb nc nd ne b">div</code>元素，目标是保存弹出内容。我们不直接使用根元素，所以如果我们想堆叠它们，我们可以创建两个或者更多不同的弹出窗口。</li><li id="be13" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">创建<code class="fe nb nc nd ne b">div</code>元素的第一个<code class="fe nb nc nd ne b">useEffect</code>钩子。这是一种安全措施，使系统也能在诸如NextJs或Gatsby等SSR系统上工作。</li><li id="0e25" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">另一个<code class="fe nb nc nd ne b">useEffect</code>钩子，用于在活动时将之前创建的<code class="fe nb nc nd ne b">div</code>添加到门户中，在不活动时将其移除。这将防止<code class="fe nb nc nd ne b">div#modal-root</code>元素包含大量的空div。</li><li id="475d" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">呈现部分，如果创建的<code class="fe nb nc nd ne b">div</code>元素不存在或者popin当前不活动，则该部分为空。</li></ul><h2 id="eff6" class="ni kv it bd kw nj nk dn la nl nm dp le lv nn no lg lz np nq li md nr ns lk nt bi translated">ModalView组件</h2><p id="8eb8" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">这个基本上是一个布局组件，所以我们可以用我们想要的方式来设计pop。</p><p id="ad52" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">即使我只展示了一个模板，您也可以根据需要使用它，例如:</p><ul class=""><li id="d147" class="mn mo it lo b lp mi ls mj lv mp lz mq md mr mh ms mt mu mv bi translated">人口信息系统</li><li id="9542" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">原生<code class="fe nb nc nd ne b">alert</code>和<code class="fe nb nc nd ne b">confirm</code>模态的设计替代品</li><li id="98d1" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">通知系统</li><li id="b663" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">无论你能想象到什么</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="e0d6" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">当前组件只是一堆具有某些样式的本地元素，分为两个部分:</p><ul class=""><li id="43b8" class="mn mo it lo b lp mi ls mj lv mp lz mq md mr mh ms mt mu mv bi translated">一个覆盖按钮，所以弹出窗口可以在点击时关闭</li><li id="10cd" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">popin内容本身，包括一个关闭按钮</li></ul><p id="cf4d" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这两个块是兄弟，因为我们不希望点击事件从一个传播到另一个。</p><p id="3723" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">出于可访问性的原因，覆盖和关闭按钮都是带有<code class="fe nb nc nd ne b">aria-label</code>属性的本地按钮元素。</p><p id="5e11" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在CSS部分，我使用了各种positionnement技术，您可以根据自己的需要自由调整。</p><h2 id="b530" class="ni kv it bd kw nj nk dn la nl nm dp le lv nn no lg lz np nq li md nr ns lk nt bi translated">ModalAnimated组件</h2><p id="6968" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">系统的最后一部分，我们需要一个组件，它是一个模态控制器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="196e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">该组件有几个任务要处理:</p><ul class=""><li id="aab2" class="mn mo it lo b lp mi ls mj lv mp lz mq md mr mh ms mt mu mv bi translated">它必须加载<code class="fe nb nc nd ne b">ModalView</code>组件。我选择默认使用<code class="fe nb nc nd ne b">ModalView</code>组件，但是我也给了这个组件一个道具来改变它</li><li id="4638" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">它还必须管理模态门户组件，以便将我们的内容包含在<code class="fe nb nc nd ne b">div#modal-root</code> DOM元素中</li><li id="9c1f" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">它为我们提供了一个退出键来关闭模式。</li><li id="239d" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">最后，它处理一个非强制性的但很好的过渡效果。</li></ul><p id="579f" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">CSS有一个奇怪的CSS模块语法来处理全局类，但也使用<code class="fe nb nc nd ne b">prefers-reduced-motion</code>媒体查询来关闭人们要求的动画。</p><p id="4403" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">如果最后一部分可以对所有元素进行全局设置，那么在组件中进行说明会更好。</p><h2 id="08cb" class="ni kv it bd kw nj nk dn la nl nm dp le lv nn no lg lz np nq li md nr ns lk nt bi translated">使用转义钩</h2><p id="b8cd" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">为了提高可用性，我们可以通过添加一个可以关闭popin的转义监听器来为我们的popin系统添加另一个很棒的特性。</p><p id="8e16" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">为此，ModalAnimated组件中有一个<code class="fe nb nc nd ne b">useEscape(active, onClose);</code>代码，但这还没有实现。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="c99d" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">钩子很简单:它由两块积木组成:</p><ul class=""><li id="6d12" class="mn mo it lo b lp mi ls mj lv mp lz mq md mr mh ms mt mu mv bi translated">一个<code class="fe nb nc nd ne b">onEscape</code>回调函数，通过监听<code class="fe nb nc nd ne b">keyCode</code>中的退出键<code class="fe nb nc nd ne b">27</code>来记忆键盘事件</li><li id="20b2" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">一个<code class="fe nb nc nd ne b">useEffect</code>方法，将它绑定到窗口文档，并在模态被卸载后立即解除绑定</li></ul><h2 id="ef7b" class="ni kv it bd kw nj nk dn la nl nm dp le lv nn no lg lz np nq li md nr ns lk nt bi translated">用法</h2><p id="ef71" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">用法非常简单:如果我们想要一个定制的<code class="fe nb nc nd ne b">ModalView</code>组件，我们需要带有2个道具的<code class="fe nb nc nd ne b">ModalAnimated</code>组件。</p><p id="6366" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">popin本身的内容只是传递给<code class="fe nb nc nd ne b">ModalAnimated</code>的子元素。我通常将内容放在另一个组件中，以使页面尽可能轻便。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h1 id="957e" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">结论</h1><p id="b5fa" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">通过创建3个light组件和一个简单的定制钩子，我们能够得到一个非常模块化和可定制的popin系统。</p><p id="aa9e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">如果还可以改进的话，我们已经实现了一个让你的UI设计者满意的系统，它实现了可访问性基础。</p><p id="2a8e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们检查了所有的初始需求了吗？</p><ul class=""><li id="deed" class="mn mo it lo b lp mi ls mj lv mp lz mq md mr mh ms mt mu mv bi translated">简单易用:是</li><li id="8156" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">可定制:我们可以非常容易地定制视图</li><li id="92c9" class="mn mo it lo b lp mw ls mx lv my lz mz md na mh ms mt mu mv bi translated">可访问性:我们确实在代码中包含了a11y</li></ul><p id="fd24" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">任务完成！现在轮到你在你的项目中使用和改进它了。</p><p id="700e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">编码快乐！</p></div></div>    
</body>
</html>