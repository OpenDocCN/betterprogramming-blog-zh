<html>
<head>
<title>Build a Line-By-Line Receipt Parser Using Google Vision and the Google Sheets API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google Vision和Google Sheets API构建一个逐行收据解析器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/google-vision-and-google-sheets-api-line-by-line-receipt-parsing-2e2661261cda?source=collection_archive---------4-----------------------#2020-03-02">https://betterprogramming.pub/google-vision-and-google-sheets-api-line-by-line-receipt-parsing-2e2661261cda?source=collection_archive---------4-----------------------#2020-03-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f77c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何利用人工智能分析你的购物行为使用Python的简单方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/822cdc478781cf73b0e2329ccc57f608.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0OUBwnv1dhNLtuZ__4tArQ.png"/></div></div></figure><h1 id="a0ec" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="d2ad" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如何使用Google Vision API逐行解析收据，逐步提取包含价格、商店名称和购买日期的单个商品。结果通过API存储在Google Sheets中。</p><p id="b873" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><a class="ae mk" href="https://github.com/tesseract-ocr/tesseract/wiki" rel="noopener ugc nofollow" target="_blank"> GitHub链接</a>。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="4209" class="kr ks iq bd kt ku ms kw kx ky mt la lb jw mu jx ld jz mv ka lf kc mw kd lh li bi translated">动机</h1><p id="2234" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">星期四是我和妻子通常去购买食品杂货的日子。我们提前准备了一份物品清单，试图购买一周所需的所有物品。</p><p id="4304" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">对于两个人的家庭来说，这应该不会太难吧？尽管如此，我发现自己下班后还是会跑到商店去——有时和每天一样——一件一件地购买我们错过的东西。我们总是忘记那些不在每周日程上的事情。就像我们每两周需要一罐蜂蜜，或者每四周需要一包咖啡。当然，我们可以生成并维护一个包含这些商品的表，并估计购买时间，但这似乎很繁琐。</p><p id="b6b2" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我们想出了一个数据驱动的解决方案:有了我们过去购买的所有杂货产品的清单，估计我们下次去商店需要什么应该相对容易。我们的杂货列表模型将预测在下一周内需要购买某项商品的概率，前提是有一个以前购买的所有商品的列表，以及日期、杂货店名称、一年中的时间等附加信息。</p><h2 id="d696" class="mx ks iq bd kt my mz dn kx na nb dp lb ls nc nd ld lw ne nf lf ma ng nh lh ni bi translated">目标解决方案</h2><p id="68dd" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">最终，我们决定将所有购买的杂货存储在Google Sheets中。对于后续的数据自动分析来说，这并不是最佳选择，但它有足够的优势使这种权衡变得有用:</p><ul class=""><li id="dabd" class="nj nk iq ll b lm mf lp mg ls nl lw nm ma nn me no np nq nr bi translated">可以轻松地手动或通过API添加数据</li><li id="ed2c" class="nj nk iq ll b lm ns lp nt ls nu lw nv ma nw me no np nq nr bi translated">我们可以在电子表格中进行简单的即席分析</li><li id="4f08" class="nj nk iq ll b lm ns lp nt ls nu lw nv ma nw me no np nq nr bi translated">我那不擅长技术的妻子可以在没有我帮助的情况下访问数据</li></ul><p id="a6f2" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">就完整性而言，这种情况的主要缺点是:</p><ul class=""><li id="bfc3" class="nj nk iq ll b lm mf lp mg ls nl lw nm ma nn me no np nq nr bi translated">写数据是有速率限制的。批量扫描收据时，您必须不时暂停</li><li id="23d6" class="nj nk iq ll b lm ns lp nt ls nu lw nv ma nw me no np nq nr bi translated">与将数据存储在实际的数据库中相比，您需要处理更多的事情。例如，在插入时，您需要确定下一个空闲点。如果你做错了，你可能会覆盖掉一些珍贵的数据。</li></ul><p id="5540" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">然而，由于我们在这里处理的是非业务关键的小数据，这仍然是一个公平的解决方案。更好的解决方案是将数据存储在BigQuery中，并在Google Sheets中使用BigQuery连接器。但是连接器附带了我们没有的G套件业务。</p><p id="7cb6" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">当数据需要保存在Google Sheets中时，保存扫描收据的自然位置是Google Drive。Google Drive中的文档扫描功能附带了一些图像增强功能，这是一个很好的优势。因为你可以在你的桌面电脑上安装你的驱动文件夹，它可以真正快速的集成到你的Python工作流程中。</p><p id="0050" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">如果说我在咨询业学到了一件事，那就是在开展任何实际工作之前先画一幅画。所以现在你有了:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/6cc0c3561395101dee92b5f6a54167ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6X6OFVWS_vOgTs4j1u9R6A.png"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">从纸质收据发放到准备数据的完整工作流程</p></figure></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="f264" class="kr ks iq bd kt ku ms kw kx ky mt la lb jw mu jx ld jz mv ka lf kc mw kd lh li bi translated">获取数据</h1><p id="9062" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">剩下要做的就是将数据输入到Google Sheets中。在深入研究这个问题之后，很明显它并不像看起来那么简单。当然，将每张收据手工输入笔记本电脑不是一种选择，因为这很快就会变成一种训练。而且，毕竟我们生活在深度学习的时代，所以我们不妨利用它。</p><p id="5a41" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">一些关于收据解析的项目已经发布，它们在从收据中找到总计和商店名称方面做得很好。有趣的是，我看到的所有例子都使用德国收据。需要在电子表格中组织收据是德国人最熟悉的感觉。</p><p id="9ef1" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">但是有了总数并不能得到我们想要的。我们甚至可以从我们的信用卡账单中得到这些数字，这些账单已经以数字形式为我们准备好了。</p><p id="a641" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">总体方法非常相似:</p><ul class=""><li id="7e93" class="nj nk iq ll b lm mf lp mg ls nl lw nm ma nn me no np nq nr bi translated">扫描和预处理收据</li><li id="02c7" class="nj nk iq ll b lm ns lp nt ls nu lw nv ma nw me no np nq nr bi translated">使用OCR解析扫描</li><li id="3f02" class="nj nk iq ll b lm ns lp nt ls nu lw nv ma nw me no np nq nr bi translated">从文本响应中提取购买的商品</li><li id="408f" class="nj nk iq ll b lm ns lp nt ls nu lw nv ma nw me no np nq nr bi translated">写入Google工作表</li></ul><p id="052e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">现在，我们将进入每一步，看看如何轻松完成。</p><h2 id="5b3b" class="mx ks iq bd kt my mz dn kx na nb dp lb ls nc nd ld lw ne nf lf ma ng nh lh ni bi translated">扫描和预处理收据</h2><p id="7690" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">只需在手机上安装Google Drive应用程序，并使用扫描功能。在本地安装你的谷歌硬盘。</p><p id="02c2" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在Ubuntu上，这在<code class="fe oc od oe of b">google-drive-ocamlfuse</code>的帮助下效果最好。</p><pre class="kg kh ki kj gt og of oh oi aw oj bi"><span id="1cad" class="mx ks iq of b gy ok ol l om on">sudo add-apt-repository ppa:alessandro-strada/ppa<br/>sudo apt update &amp;&amp; sudo apt install google-drive-ocamlfuse<br/>mkdir ~/grive<br/>google-drive-ocamlfuse ~/grive</span></pre><h2 id="41b2" class="mx ks iq bd kt my mz dn kx na nb dp lb ls nc nd ld lw ne nf lf ma ng nh lh ni bi translated">使用OCR解析扫描</h2><p id="84da" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我对OCR的了解源于前段时间在Kaggle上复制MNIST CNN的例子。</p><p id="272a" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在此基础上，我觉得OCR是一个已经解决的问题。但是当你从测试数据变成真实数据时，很多事情同时发生。</p><p id="f161" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir">宇宙魔方</strong></p><p id="2eeb" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">对于开源的本地工作，Tesseract似乎仍然是最突出的OCR解决方案。用Python很好用。</p><p id="5ecb" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">您需要通过包管理器安装Tesseract，通过pip安装pytesseract。不要忘记加入你选择的语言，你需要把它作为一个单独的包来安装。在这里看一个例子<a class="ae mk" href="https://github.com/tesseract-ocr/tesseract/wiki" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="856b" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">设置好一切并扫描好收据后，是时候试驾了。下面，左边是示例收据，右边是Tesseract输出。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">Pytesseract示例</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/da64c59a5f9c1e0c9d9160c1e8277b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ODTPi2VcGSRdWkPzwqBJLg.png"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">收据示例</p></figure><pre class="kg kh ki kj gt og of oh oi aw oj bi"><span id="af0f" class="mx ks iq of b gy ok ol l om on">LIDL </span><span id="ced9" class="mx ks iq of b gy or ol l om on">EUR <br/>rrische Alpenmilch 0,37 “ <br/>bier aus Bayern ber 0,32 A <br/>Merlot IGP d’üc 1,9x 2 3,98 6 <br/>Schwammtuch Ser 0,56 <br/>Topfschwanm 0,70 8 <br/>Pfandrückgabe -1,258B</span><span id="b218" class="mx ks iq of b gy or ol l om on">zu zahlen ” 6,16</span><span id="0b88" class="mx ks iq of b gy or ol l om on">Kreditkarte 0,16 <br/>MUST% MUST + Netto 2 Brutto 7% 0,13 1,85 1,32 B 19% 0,67 3,51 4,18 Summe . 0,80 5,36 6,16</span><span id="dd05" class="mx ks iq of b gy or ol l om on">|||</span><span id="50bb" class="mx ks iq of b gy or ol l om on">I! I I</span><span id="d5b5" class="mx ks iq of b gy or ol l om on">2014 879145/01 02.29 12:45 <br/>UST-ID-NR: DEBI4034176 <br/>-K-U-N-D-E-N-B-E-L-E-G-</span></pre><p id="a83d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">虽然它做了很多正确的事情，但结果仍然远远低于我们的需求。有些价格是乱的，这在试图提取文章和价格时会是一个巨大的问题。我试着玩了一会儿宇宙魔方选项，但是除了PSM选项之外的所有选项都让事情变得更糟。</p><p id="79f4" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">要改进作为OCR引擎的Tesseract，需要预先识别文本块，然后对每个块单独运行Tesseract。但是识别图片中的文本块是一个完全不同的问题，我不想有这个问题。</p><p id="c8fc" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">此外，示例图片质量很好。我们大多数家庭扫描的收据看起来要差得多，所以质量预计会从这里下降。</p><p id="a8c8" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir">谷歌视觉API </strong></p><p id="db9f" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">对于一般的图像分析，尤其是文本识别，有几种API解决方案。但由于我们目前只使用谷歌产品，我们不妨继续使用它们，让生活变得更轻松。</p><p id="b4b7" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">要做到这一点，我们需要做一些事情，但我保证，一旦一切准备就绪，生活将变得超级简单。我正在根据记忆重现这些步骤，所以如果你因为我错过了什么而卡住了，请告诉我。</p><ul class=""><li id="7bdd" class="nj nk iq ll b lm mf lp mg ls nl lw nm ma nn me no np nq nr bi translated">如果你还没有谷歌云平台账户，<a class="ae mk" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">创建一个</a></li><li id="860d" class="nj nk iq ll b lm ns lp nt ls nu lw nv ma nw me no np nq nr bi translated">创建新项目。这是页面左上角的按钮。</li><li id="849e" class="nj nk iq ll b lm ns lp nt ls nu lw nv ma nw me no np nq nr bi translated"><a class="ae mk" href="https://cloud.google.com/billing/docs/how-to/modify-project" rel="noopener ugc nofollow" target="_blank">为项目</a>启用计费。我还没有产生任何费用，因为我们不怎么使用Vision API，但是您需要启用它。</li><li id="faa0" class="nj nk iq ll b lm ns lp nt ls nu lw nv ma nw me no np nq nr bi translated">在您的项目上启用Google Vision API，并添加一个具有凭据的服务帐户。只要遵循这个指南就可以了。</li><li id="cba4" class="nj nk iq ll b lm ns lp nt ls nu lw nv ma nw me no np nq nr bi translated">保存凭证文件，并将其路径设置为环境变量</li></ul><pre class="kg kh ki kj gt og of oh oi aw oj bi"><span id="be77" class="mx ks iq of b gy ok ol l om on">export GOOGLE_APPLICATION_CREDENTIALS=”&lt;path&gt;”</span></pre><ul class=""><li id="f55b" class="nj nk iq ll b lm mf lp mg ls nl lw nm ma nn me no np nq nr bi translated">安装Python包</li></ul><pre class="kg kh ki kj gt og of oh oi aw oj bi"><span id="7ed3" class="mx ks iq of b gy ok ol l om on">pip install --upgrade google-cloud-vision</span></pre><p id="24c9" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">如果你刚到GCP，你应该已经收集了一些丰厚的免费试用积分。让我们再次尝试上面的收据，但这次是在谷歌视觉的神奇帮助下。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">对Google Vision API的示例请求</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/da64c59a5f9c1e0c9d9160c1e8277b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ODTPi2VcGSRdWkPzwqBJLg.png"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">收据示例</p></figure><pre class="kg kh ki kj gt og of oh oi aw oj bi"><span id="d0dc" class="mx ks iq of b gy ok ol l om on">LODL<br/><br/>EUR<br/>Frische Alpenmilch 0,99 A<br/>Eier aus Bayern 6er 1,99 x 2 0,99 A<br/>Merlot IGP d’Üc 3,98 B<br/>Schwammtuch 5er <br/>0,75 B<br/>Topfschwamm 0,70 B<br/>Pfandrückgabe -1,25 B<br/>zu zahlen 6,16<br/>Kreditkarte 6,16<br/><br/>MWST% MWST + Netto Brutto<br/>A7 % 0,13 1,85 1,98<br/>B 19 % 0,67 3,51  4,18<br/>Summe 0,80 5,36 6,16<br/><br/>2014 879145/01<br/>08.02.20 12:45<br/>UST-ID-NR: DE814034176<br/>-K-U-N-D-E-N-B-E-L-E-G-</span></pre><p id="111e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我们绝对可以用这个工作！只有两个字是错的，即使对人类来说也很难读懂。</p><h2 id="4289" class="mx ks iq bd kt my mz dn kx na nb dp lb ls nc nd ld lw ne nf lf ma ng nh lh ni bi translated">从文本回复中提取购买的商品</h2><p id="a221" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">接下来，我们必须从响应中确定单篇文章及其相应的价格。这一部分并不令人兴奋——事实上，相当乏味。您需要捕捉打印收据中可能出现的所有边缘情况，这种情况有很多。</p><p id="dfad" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">如果你对此感兴趣，请告诉我。不然我就只参考<a class="ae mk" href="https://github.com/lutzkuen/receipt-parser" rel="noopener ugc nofollow" target="_blank">这个代号</a>。</p><h2 id="596d" class="mx ks iq bd kt my mz dn kx na nb dp lb ls nc nd ld lw ne nf lf ma ng nh lh ni bi translated">向Google Sheets写信</h2><p id="977f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">所以我们设法把现实生活中怪异物品的收据放到一个列表中。最后一步是将内容写入Google Sheets。我遇到了比我想承认的更多的麻烦，因为要得到正确的细节有点棘手。</p><ul class=""><li id="6503" class="nj nk iq ll b lm mf lp mg ls nl lw nm ma nn me no np nq nr bi translated">转到你的Google Drive，创建你想写结果的工作表。记下纸张ID。你可以在URL中找到它——这是我在下面的截图中标记的部分。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/e533f364cef3c6e1416f98f655e2e333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gd6O_vJb7IulogUUZve46w.png"/></div></div></figure><ul class=""><li id="0813" class="nj nk iq ll b lm mf lp mg ls nl lw nm ma nn me no np nq nr bi translated">安装所需的客户端库</li></ul><pre class="kg kh ki kj gt og of oh oi aw oj bi"><span id="9747" class="mx ks iq of b gy ok ol l om on">pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib</span></pre><ul class=""><li id="2c2d" class="nj nk iq ll b lm mf lp mg ls nl lw nm ma nn me no np nq nr bi translated"><a class="ae mk" href="https://developers.google.com/sheets/api/quickstart/python" rel="noopener ugc nofollow" target="_blank">为您的项目启用Google Sheets API </a>，并下载客户端密码。</li></ul><p id="bdb5" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">您将获得另一个包含OAuth客户机秘密的JSON文件。我花了一点时间把这个和Google Vision服务帐户的证书JSON混淆了。所以一定要给这些文件起一个清晰的名字，以便你明天还能记得它们属于哪里。</p><p id="fc65" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">现在，让我们在继续之前测试一下这个东西是否有效。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">在Google Sheets中进行测试更新</p></figure><p id="e4b5" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">如果你在谷歌表单中看到了测试更新，那你就万事俱备了。由于Python API包装器的这一部分没有得到很好的记录，所以计算更新函数有点困难。但是，最后，它像微风一样工作。</p><h2 id="58e9" class="mx ks iq bd kt my mz dn kx na nb dp lb ls nc nd ld lw ne nf lf ma ng nh lh ni bi translated">把所有的放在一起</h2><p id="bc5c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">一旦你的谷歌云项目建立起来，所有的关键文件都准备好了，你就快成功了。</p><p id="0f4c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">克隆<code class="fe oc od oe of b">git</code>:</p><pre class="kg kh ki kj gt og of oh oi aw oj bi"><span id="1fa2" class="mx ks iq of b gy ok ol l om on">git clone <a class="ae mk" href="https://github.com/lutzkuen/receipt-parser.git" rel="noopener ugc nofollow" target="_blank">https://github.com/lutzkuen/receipt-parser.git</a></span></pre><p id="a7c1" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">准备设置文件:</p><pre class="kg kh ki kj gt og of oh oi aw oj bi"><span id="8c75" class="mx ks iq of b gy ok ol l om on">vim ~/receipt_parser.conf</span></pre><p id="54b3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">设置文件应该如下所示:</p><pre class="kg kh ki kj gt og of oh oi aw oj bi"><span id="8010" class="mx ks iq of b gy ok ol l om on">[sheets]<br/>spreadsheet_id = 1lKnQ1nqVViIDG4Kww_XiDm8U51AWzhb1dA63gyuuAJY<br/>spreadsheet_range = Sheet1!A:L<br/>oauth_token = ../client_secret_oauth.com.json<br/>oauth_pickle = ../token.pickle<br/>[drive]<br/>receipts_path = ../grive/Belege</span></pre><p id="6516" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在配置文件中，它必须是OAuth客户端机密，不要与Vision API的服务帐户凭证混淆。</p><p id="b31a" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">确保服务帐户凭据存储在正确的环境变量中。</p><pre class="kg kh ki kj gt og of oh oi aw oj bi"><span id="9d1c" class="mx ks iq of b gy ok ol l om on">export GOOGLE_APPLICATION_CREDENTIALS=”$HOME/service_account.json”<br/>echo $GOOGLE_APPLICATION_CREDENTIALS</span></pre><p id="5066" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">现在只需使用Google Drive应用程序扫描您的收据，并将其存储在作为<code class="fe oc od oe of b">receipts_path</code>提供的文件夹中。对我来说，是<code class="fe oc od oe of b">Belege</code>。</p><p id="836f" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">然后，运行<code class="fe oc od oe of b">parse_all.py</code>脚本。</p><pre class="kg kh ki kj gt og of oh oi aw oj bi"><span id="b182" class="mx ks iq of b gy ok ol l om on">cd receipt-parser<br/>python parse_all.py --settings ~/receipt_parser.conf</span></pre><p id="ddc3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">现在，您应该可以看到您的表单是如何被来自收据的条目填充的。</p><p id="6d95" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">同一文件中的记录只写一次，所以把旧收据放在文件夹中是安全的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/9b80685424ad43d57783ea8527aac37c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*AKkNUuUQbT2UZivGkQJOcA.gif"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">由于速率限制，看着你的杂货被逐行解析</p></figure><p id="579e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">大获成功！从现在开始。各种可能性出现了。最简单的方法是按周计算你的购买量，以了解你每周的消费习惯。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="ec0e" class="kr ks iq bd kt ku ms kw kx ky mt la lb jw mu jx ld jz mv ka lf kc mw kd lh li bi translated">后续步骤</h1><p id="ba67" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">现在我们有了一些数据。我们可以疯狂使用你在大学里学到的任何数据科学方法。我将把它留给另一篇文章，因为我还没有深入研究它。</p><p id="2dda" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">此外，文本解析需要不断修正和更新错误。我最近去了一家五金店，当然，他们的收据看起来与我隔壁的杂货店大相径庭，我需要重新设计解析核心。</p><p id="576f" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我希望你喜欢这篇文章，并且和我一样喜欢这篇文章。</p></div></div>    
</body>
</html>