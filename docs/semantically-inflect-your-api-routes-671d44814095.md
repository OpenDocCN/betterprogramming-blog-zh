# 语义上改变你的 API 路由

> 原文：<https://betterprogramming.pub/semantically-inflect-your-api-routes-671d44814095>

## 为什么所有的复数都是错的

![](img/256ede37e5cab05d00c04764e134cc3b.png)

学前儿童识别名词屈折错误；成年人也应该如此。(指定 thing #3 时，没有“s”。)图片来源:作者

暧昧。程序员经常发现自己重写代码，因为“需求”被证明是误导的，可能是错误的*——有时描述的东西与涉众的意思完全不同。人与人之间的交流很难。开发者接受这一点；我们重写；软件创造周期向前旋转。计算机之间的通信应该工作得更好。然而，许多关于 API 路由命名的建议都包含了同样的问题，模糊性。*

*鼓励“在任何地方都使用复数”会引起混乱。“处处用单数”也一样。这两种方法都高估了对简单性值得称赞的渴望，忽略了失去语义机会的长期技术债务。解决方法很简单:正确使用字母“s”。*

*卷首，用它的学前字母块尝试路线`/things/3`，展示。这条路线应该代表什么？(任何)3 个街区？有显示数字 3 的街区吗？离太阳第三个街区？答案应该是:以上都不是。这种方法既违反语法，也不符合语义。我花了一段时间才明白为什么。*

***叶开了先例***

*我们店禁止复数桌名。我没意见。单数传递[1]。复数名称也可以。在我的职业生涯中，在多个单数和复数商店中，我从未遇到可用性差异；这两种方法几乎同样有效。对于表命名，我的感觉是有一个标准远比哪个标准重要。*

*对于路线命名，我期望一些等价的方向，但是什么也没找到。我们精心编制的车间标准[3]没有提到应用程序编程接口(API)的任何方面。*

*我怀疑我不是一个人。也许表命名规则本质上比路由命名规则简单，所以更容易编写。也许学习创建表的人比学习如何连接端点的人多。也许更多的商店需要数据库而不是定制 API。不管什么原因，至少在我的经验中，很少遇到 API 商店标准。*

*不知所措的程序员(在理解之前陶醉于广阔的空间)寻找线索。这种遗漏是怎么发生的？人们可能会考虑时间线的可能性:也许数据库已经存在了更长时间。或许不会。从 e . f . Codd 1974 年的开创性论文[4]发表后不久，主流编程已经完全接受了关系数据库近半个世纪。六年前，1968 年关于计算机图形学的会议论文引入了术语“应用程序[ *原文如此*]接口”[5]。这个想法，API 的基本概念，它们的*存在理由*——标准化过程——开始于几十年前，诞生于 20 世纪 40 年代真空管计算机的光辉中[6]。*

*也许我们的标准作者只是认为他们已经涵盖了它，同样的“无复数”规则同样适用于数据库和路由。人们普遍认为。我对这个看似合乎逻辑的结论的谬误的探索扩展到了这篇文档中。*

***全面叛乱***

*我的探索始于构建 API 的任务。我为几个以前的雇主写过 API，所以我确信我知道所有的事情。事实证明，对于超过 100 个端点的系统，查询字符串参数是不够的。路线发芽了。*

*最初，我采用了与数据库相同的方法。我服从了一再的告诫，以避免多元化。当我读到“数据库名应该是单数”时，我相信通过扩展、逻辑和先例，复数禁止适用于路由。*

*这有一段时间奏效了。除了我唯一的、符合标准的路线引发了可用性问题和模糊性。漏洞变得太大了。我试过其他选择。我完全反其道而行之:我尝试了所有的复数，有意识地违反商店规则。彻底的反叛很有趣，而且在一瞬间取得了惊人的成功。我所有的初始问题都消失了；不幸的是，同样多的新问题出现了。我试图忽略这个问题(好像那样会有用)。*

*在挫折(或灵感)中，我恢复了一套更基本的语法标准，幼儿园前的复数名词:一个项目的单数名词，一堆的复数名词。它成功了，非常成功。观察学龄前多元化规则[7]解决了所有的歧义。这次是以内疚和担忧为代价的。为了避免想象中的未来对职场叛逆的警告(或更糟)，我准备了一个解释:“应该是单数”的合理化并没有特别挑出路线。弱是一种轻描淡写。*

***编程不是科学***

```
*Query filenames in a singular shop
 — — — — — — — — — — — — — — — — — -
get_thing_x.sql   (Yes!)
get_things.sql    (plural violation)
get_my_things.sql (plural violation)
get_all_things.sql(plural, ambiguous, and redundant)*
```

*我知道我需要更好的东西，于是我接触了科学。我做了一个思想实验:路由通常是伪装的数据库查询，那么一组类似路由的查询的逻辑文件名是什么呢？对于特定的行，`get_thing_x.sql`看起来完全可以接受，都是单数。对于每个多行查询，文件名测试都失败。每次都是复数。违反了全部车间标准。*

*我不相信实验结果(也不相信编程足够科学，可以依赖实验)，于是我寻找更好的答案。*

*通常提供更好答案的网站(也许是在编程问题上)，很难令人满意地回答这个问题，而是提出了多个排名靠前、理由充分且强烈冲突的论点[8]。讨论超越了单数或复数。*

*总是有第三种方式，一种允许复数和单数的混合，只是通常不是设计出来的。在数据库领域，大多数被迫使用单复数表名的商店都归咎于遗留的技术债务；很少有人赞同这种聚集。*

***拥抱非二元***

*路线不一样。他们行动了。(更正确的说法，端点作用；路线仅仅是识别目标。)表格很好的存储数据；但是用这些数据做一些有用的事情通常需要外部代码；做不是数据库的重点。相比之下，API 本质上体现了做。他们的端点存在是为了表演，他们的超能力比任何桌子飞得都远，引发推特风暴，旋转望远镜，分析 DNA。不足为奇的是，表命名约定证明是不够的。*

*与数据库不同，在数据库中意见基本上是一分为二的——略微占多数的人倾向于所有单数表名，而其余的人则推崇复数——路由命名分为三种可能性。与表格不同，路由命名多数偏好复数名词[9]。单个表与多个路由之间的这种最佳实践断开是有参考价值的。它承认旧的规则不适用。它揭示了也许是最显著的路线命名分歧，的包容性非二元性。与数据库不同，路线命名合法地赋予了第三种方式，由一个规模较小但相当热情的群体支持:复数和单数“视情况而定”[10]。*

*与其要求一致性，不如添加语义。*

*不是我开始的地方。*

***还会出什么问题？***

```
*All plural examples
— — — — — — — — —
GET /things     (get every) (Yes!)
GET /things/3   (get #3)    (poor English grammar; ambiguous;)
GET /things/all (get every) (redundant; DRY violation;)*
```

*多数人对所有多元路线的偏好开始得很好:`GET /things`起作用。这是它唯一的成功。它很快就失败了，将返回一个条目的 routes 视为滥用英语语法的人，“Get one things[*sic*]”。无法接受。程序员严格遵守我们权限内每种语言的每一条语法规则。除了英语。*

*我们的 TL；世界博士分担责任；它鼓励一些对形式的漠视；但是，一次性短信快捷方式不是故意设计令人担忧的路线的借口。API 应该为未来用户的需求做更长时间的规划。明确要求根深蒂固的语法违反值得怀疑，“还有什么会出错？”*

***反模式全部***

*一些推荐 all 复数的人，在 all 的概念上走极端，在路线中使用这个词。“All”是一个反模式。虽然看起来很直观，但并没有什么帮助。“all”不是添加信息，而是引诱路线作者进入神秘的冗余，将这个词视为神奇的咒语，调用`GET /things/all`。大多数人(大概是正确)将该端点解释为“发送每一行”。然而，两次陈述复数，“事物”和“所有”，几乎和双重否定一样糟糕。“不要重复自己”不愧为程序员的口头禅[11]。一次指定多个:`GET /things`。*

***单数更惨***

```
*All singular examples
 — — — — — — — — — —
GET /thing/3   (get #3)    (Yes!)
GET /thing     (get every) (poor grammar; ambiguous;)
GET /thing/all (get every) (poor grammar; magic word; ambiguous;)*
```

*少数人对所有单一路线的偏好，我首先尝试的方案，结果更糟。它要么需要已经受到严厉批评的神奇的“所有”，因为它违反了语法，“所有的东西[*原文如此*]”，要么神奇地将单数“东西”重新定义为突然包含一切。同样不能接受。支持者经常引用他们现有的单一表命名标准。重新定位标准并不总是有效的。*

***债务人绕道***

*技术债务笼罩着程序员，威胁着我们的生活，我们的冲刺，我们的生活。糟糕的路线名称会产生更多的技术债务。几个月后，几年后，当一些新员工试图使用你的路线时，他们对名词复数的直觉期望是什么？(就算他们 RTFM。)普通英语。“得到(所有)东西[ *原文* ]”不会是首选。所有大写变量和三字符操作码的时代已经过去了。我们可以提供更多的信息代码。*

*维护可能是软件开发中最大的支出。不明确的路线花费真实的美元。*

***正如你已经知道的***

```
*As appropriate examples
 — — — — — — — — — —
GET /thing/3 (get #3)   (Yes!)
GET /things  (get every)(Yes!)*
```

*“适当地”匹配复数解决了语法问题。更重要的是，它增加了可理解性。不含糊。“视情况而定”的方法是直观的，易于解释和理解:当针对特定对象时，使用单数；当目标集合时，使用复数[12]。*

*“酌情”很棒；但是缺少这个术语。修饰(屈折)词以区分单复数的正式名称是:名词数屈折。*

```
*Inflection Rules (You Already Know)
— — — — — — — — — — — — — — — —
IF singular THEN suffix = NULL
IF plural   THEN suffix = “s”*
```

*如果名词是单数，则词尾变化为零，没有后缀；如果名词是复数，词形变化是附加的词素“s”。这个简单的规则在英语中很突出(在航线中也越来越普遍)。*

*有趣的异常不会改变这个简单的 K 前规则的编程有用性。*

***不定期的娱乐活动***

*“人”、“老鼠”和“数据”展示了英语对不合逻辑的，或者充其量是不明显的词法的偏好。虽然大多数英语名词通过添加“s”来实现复数，但变异词比比皆是。偶然的不规则促使一些路线作者完全避免复数名词。这是一个拙劣的论点。选择一个不规则屈折的名词通常表明早期的设计缺陷。*

*名词选择很重要。而不是人/人们选择一些信息更丰富、更具体的东西:顾客/顾客、用户/用户、公民/公民。如果你必须，创造你自己的复数，“人”，“老鼠”，“数据”。使用这种人为变化的路线名称的人可能会窃笑；但是他们会理解我的意图。为所有人多元化。*

*“谋杀”是不明智的。无论如何，这个代表众多乌鸦的术语很大程度上是诗意的。动物——也许是因为我们的祖先认为它们是商品，是一个单一的概念，而不是独特的个体——主宰着不规则复数的列表[13]。我们的动物本性甚至可以解释人的不规则性。一些不规则的复数不是谋杀直觉简单性的理由:一个是单数，所有是复数。*

***单数*和*复数(和超人)***

*著名的符号字母“S”印在他服装的胸前，实际上并不代表“超人”。根据(修正主义)漫画传说，这是氪星人对美好明天的希望的象征。*

*“明天”当然是(另一个)不太好的路线名词选择，部分原因是其模糊的复数形式。它可能意味着今天之后的一天，或者一个漫长的，不确定的未来(不公正地拒绝了氪星)。*

*语义路线值得同样的“s”——闪闪发光的象征主义；他们让明天更美好。未来的程序员可能不会感谢你；他们甚至可能不会想到像所有复数这样粗糙的事物的可能性。非常好。最好的系统不会引起注意；他们只是工作。*

*Routes 有点像超人:比每次重写 SQL 都要快，比任何表都要强大，能够一次跳过许多查询。当你给它们起好名字的时候。*

*![](img/040a69c5ba2cecc21ca63e4932ef0182.png)*

# *参考文献和注释*

*[1] I. Mackinnon，表格命名困境:单数与复数名称(2017)。检索自 stack overflow . org:[https://stack overflow . com/questions/338156/table-naming-dilemma-singular-vs-plural-names](https://stackoverflow.com/questions/338156/table-naming-dilemma-singular-vs-plural-names)。"我更喜欢用非屈折名词，它在英语中恰好是单数."*

*[2]严格来说，单数表名提供了两个一般来说很小的优点:琐碎，少了一个需要键入的字符；并且不一定是微不足道的，这与更大的专业领域中对单数表名的轻微多数偏好相一致。*

*[3]姓名保密，标准和惯例(2016)。"数据库名应该是单数…表名是单数…列名是单数."*

*[4] E. F. Codd，大型共享数据库的数据关系模型(1970 年)。对所有单数表名持续流行的解释从 master 开始。E. F. Codd 在他对关系模型的开创性描述中专门使用了单数表名。*

*[5] I. Cotton，F. Greatorex，远程计算机制图的数据结构和技术(1968 年)。从[https://dl.acm.org/doi/10.1145/1476589.1476661.](https://dl.acm.org/doi/10.1145/1476589.1476661.)检索到的被认为是首次公开使用的术语“应用程序[ *原文如此*]接口”。*

*[6] N. Metropolis，《二十世纪的计算机历史》(1980 年)。1949 年在剑桥大学读研究生时，David J. Wheeler 构建了世界上第一个应用程序编程接口。惠勒的术语是“协调订单”。*

*[7] S. Kouider，J. Halberda，J.Wood，S. Carey，英语数字标记的习得:单复数区分(2006)，检索自[https://www . harvardlds . org/WP-content/uploads/2018/05/kou ider-et-al..-2006.-Acquisition-of-English-Number-Marking-The-Singular-Plural-Distinction-copy . pdf .](https://www.harvardlds.org/wp-content/uploads/2018/05/Kouider-et-al..-2006.-Acquisition-of-English-Number-Marking-The-Singular-Plural-Distinction-copy.pdf.)声明，“对这些子集的测试表明，36 个月大的婴儿在单数和复数测试中均获得成功”*

*[8] J. Au-Yeung，R. Donovan，REST API 设计的最佳实践(2020)。检索自 stack overflow . org:[https://stack overflow . blog/2020/03/02/best-practices-for-rest-API-design/。作者声明，“用复数名词命名集合”。许多评论者表达了更广泛的观点。](https://stackoverflow.blog/2020/03/02/best-practices-for-rest-api-design/.)*

*[9a] J. Au-Yeung，R. Donovan，REST API 设计的最佳实践(2020)。作者告诫说，所有的路由都使用“复数以与我们数据库中的一致”，这显然是假设每个人都有复数名称的表。*

*[9b] M-Way 解决方案*，*更好的 RESTful APIs 的 10 个最佳实践(2014)。"不要混淆单数和复数名词…所有资源都使用复数名词."我不同意。*

*[9c] Y. Katz，在 JSON 中构建 API 的规范(2013)。从 jsonapi.org 检索:[https://jsonapi.org/format/#fetching-resources](https://jsonapi.org/format/#fetching-resources)。这个开源项目要求所有路由“类型”的复数它假设了类似“GET /articles/1”的路由。我认为“Get articles[*sic*]1”是不可接受糟糕的英语。*

*[10] L. Lustig，REST API 设计的最佳实践(2020)。检索自 stack overflow . org:[https://stack overflow . blog/2020/03/02/best-practices-for-rest-API-design/。](https://stackoverflow.blog/2020/03/02/best-practices-for-rest-api-design/.) Lustig 对 Au-Yeang 文章的评论认为，“单数/复数[路由名]应该由端点返回单个对象还是集合来决定。”这种反向逻辑是正确的，只要单个记录(或空)集合不会通过返回一个对象来缩短多条路径。*

*[11] A. Hunt，D. Thomas,《实用程序员:从熟练工到大师》( 1999)。用一个故事介绍了 DRY 原则:“给计算机两个相互矛盾的知识是詹姆斯·t·柯克船长使一个掠夺性的人工智能丧失能力的首选方法。”*

*[12]更准确地说，有一个*具体的*记录。对非特定记录的请求应该使用带有查询字符串限制器的复数。*

*[13] F. Toupin，关于复数形态和游戏动物:从古英语到当代英语(2015)。https://journals.openedition.org/lexis/964.论述了“盎格鲁-撒克逊文化中游戏动物的心理凸显……”。*

*[14] M. Waid，《超人与生俱来的权利:超人：钢铁之躯的起源》(2005 年)。介绍了“s”的深层含义。*