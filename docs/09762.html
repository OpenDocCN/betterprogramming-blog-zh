<html>
<head>
<title>6 SQL Queries Every Data Engineer Should Be Aware of</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">每个数据工程师都应该知道的6个SQL查询</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/6-sql-queries-every-data-engineer-should-be-aware-of-2d0a2cc5986e?source=collection_archive---------0-----------------------#2021-10-07">https://betterprogramming.pub/6-sql-queries-every-data-engineer-should-be-aware-of-2d0a2cc5986e?source=collection_archive---------0-----------------------#2021-10-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1427" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">它可能已经有超过45年的历史了，但是SQL仍然完成了它的工作</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3ee3dc6769b0673101778b281206670c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ac2RviUeM2tkQyEMcEyQgg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@markusspiske?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae ky" href="https://unsplash.com/s/photos/software-engineer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="e2dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论您是开始工程生涯的初学者，还是经验丰富的数据工程师或数据分析师，高级SQL语法知识都是必须的。</p><p id="ed2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着数据呈指数级增长，超快速地分析这些数据变得越来越重要。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/8ab5cc34234481d30291399e8268ca87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*SMZcPiBLxN2pJs-wVJlNBg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://www.statista.com/statistics/871513/worldwide-data-created/" rel="noopener ugc nofollow" target="_blank"> <em class="lw"> Statista </em> </a></p></figure><p id="c8ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个图中的单位是zettabytes。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="1e7f" class="mc md it ly b gy me mf l mg mh">1 zettabyte = 1 trillion gigabytes</span></pre><p id="9a4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">人们可能会说SQL已经死了，但现实是目前没有任何系统可以取代它。有许多非常有能力的NoSQL商店做得非常好，以低成本支持大规模扩展。然而，它们不会取代高质量的基于SQL的存储——而是对它们的补充。SQL的ACID属性使其成为相对自然地建模数据的高度可靠的方法。</p><p id="8d3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名数据工程师，我使用SQL已经有一段时间了，我知道更快地编写复杂查询的重要性。因此，这里有一些高级SQL语法，肯定会派上用场。</p><p id="7341" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于下面的例子，我使用了下表的内容。这个表叫做<em class="mi">账单</em>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/a17c04d74cd5c3fae987181c286be5bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*67bjRTMeEDzCX6TNXf0AKA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="bdac" class="mk md it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">累计总数</h1><p id="1948" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">您经常会遇到必须从表中计算累计的情况。这是为了了解每一个值是什么，与运行总数进行比较。</p><p id="0ac7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">累计是指特定列中下一个单元格之前的列中所有单元格的值的总和。</p><p id="0ada" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个查询可以做到这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">累计总数。由作者添加</p></figure><p id="bab8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是输出的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/18750d5d2533c8bd7bf071f881347a7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L1A22MhHjEXWkJ5mxoTXfA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="0be7" class="mk md it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">常用表表达式</h1><p id="9091" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">通用表表达式(简称CTE)用于简化复杂连接和子查询的可读性。</p><p id="c986" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它基本上是一个临时命名的结果集，您可以在一个<code class="fe nj nk nl ly b">SELECT</code>、<code class="fe nj nk nl ly b">INSERT</code>、<code class="fe nj nk nl ly b">UPDATE</code>或<code class="fe nj nk nl ly b">DELETE</code>语句中引用它。</p><p id="e32e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑这个简单的查询，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">cte的git。由作者添加</p></figure><p id="1a8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在想象一下，如果我们在随后的查询中多次使用这个子查询。如果我们能把那用作临时桌子，不是更容易吗？CTE解决了这个问题。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">cte的git。由作者添加</p></figure><p id="93f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个小例子，但是对于更大更复杂的子查询来说，这通常非常有用。</p><h1 id="7e62" class="mk md it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">对数据进行排序</h1><p id="63ed" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">数据工程师和分析师会同意，根据一些参数(如工资或费用等)对值进行排序是非常常见的。对数据进行排序的知识唾手可得，可以为您节省大量查找精确查询的时间。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">排名的一个片段。由作者添加</p></figure><p id="03fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的查询中，我根据amount列对数据集进行了排名。</p><p id="eb16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以使用类似于<code class="fe nj nk nl ly b">RANK()</code>的<code class="fe nj nk nl ly b">DENSE_RANK()</code>，除了如果两行具有相同的值，它不会跳过后续的等级。</p><h1 id="33b9" class="mk md it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">添加小计</h1><p id="f4ab" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">对于数据工程师和分析师来说，这又是一个超级重要的查询。在我作为业务/数据分析师的10年职业生涯中，我使用这个查询进行了大量的分析。小计有助于您从总体的角度来看待数据。</p><p id="e8d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它是一个<code class="fe nj nk nl ly b">GROUP BY</code>子句的扩展，能够向数据添加小计和总计。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">rollup的一个片段。由作者添加</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/a6ef0db506cc87e8ee7830bc336c0acd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*or6K6zfUR138KnGxV3kc6A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7d48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mi">注意:</em>以上查询是在MySQL中。其他人的汇总语法可能会有所不同。</p><p id="cb3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的查询中，type和id都为null的行就是总计的行。无论id列是什么，都有小计。这由第4行和倒数第二行表示。</p><h1 id="790d" class="mk md it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">临时功能</h1><p id="f114" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">临时函数允许您轻松地修改数据，而无需编写大量的case语句。</p><p id="cdd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，一个临时函数用于将类型转换为性别。这可以通过在查询中使用case语句来实现，但是读起来会很混乱</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">临时函数的一个片段。由作者添加</p></figure><h1 id="5c64" class="mk md it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">方差和标准差</h1><p id="78e0" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">对于数据科学家和分析师来说，获得方差和标准差的能力至关重要。幸运的是，有函数可以获取这些值。</p><p id="bad7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl ly b">VARIANCE</code>、<code class="fe nj nk nl ly b">VAR_POP</code>和<code class="fe nj nk nl ly b">VAR_SAMP</code>是集合函数，即对数据进行分组。这些用来分别确定数据集合的方差、组方差和样本方差。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">方差和标准差的片段。由作者添加</p></figure><p id="5103" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl ly b">VAR_POP</code>:这是总体方差<br/> <code class="fe nj nk nl ly b">VAR_SAMP</code>:这是样本方差<br/> <code class="fe nj nk nl ly b">STDDEV_SAMP</code>:这是样本标准差<br/> <code class="fe nj nk nl ly b">STDDEV_POP</code>:这是总体标准差</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="492b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是我在数据工程职业生涯中经常使用的一些顶级SQL命令。这些对解决许多商业问题非常有用。<a class="ae ky" href="https://thenewstack.io/sql-is-dead-right/" rel="noopener ugc nofollow" target="_blank"> Stats </a>表示，SQL工具生态系统包括从Excel和Tableau到SparkSQL的任何东西，被超过60% 的组织使用<a class="ae ky" href="https://scalegrid.io/blog/2019-database-trends-sql-vs-nosql-top-databases-single-vs-multiple-database-use/" rel="noopener ugc nofollow" target="_blank">。令人印象深刻的壮举，尤其是考虑到它的年龄。</a></p><p id="5175" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果您是一名数据工程师，我相信您会发现这些命令非常有用。如果我错过了什么，请在评论区告诉我。</p></div></div>    
</body>
</html>