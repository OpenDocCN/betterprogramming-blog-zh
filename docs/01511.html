<html>
<head>
<title>Replace Everything With Pikachu Chrome Extension</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用皮卡丘Chrome扩展替换一切</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/replace-everything-with-pikachu-chrome-extension-de40497c7f5a?source=collection_archive---------20-----------------------#2019-09-19">https://betterprogramming.pub/replace-everything-with-pikachu-chrome-extension-de40497c7f5a?source=collection_archive---------20-----------------------#2019-09-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d65f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">学习如何制作你的第一个Chrome扩展——第1部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0a9acb905c56faa625e40e25a0bc99f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nfV2tpL0ZwXxwkJXjUO_Vg.png"/></div></div></figure><p id="d888" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个由两部分组成的系列是为那些想用浏览器扩展做些酷的东西的人写的。具体来说，任何人都希望在网上冲浪时抓住口袋妖怪。这是第一部分，这里是第二部分。</p><p id="2f69" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以，各位。</p><p id="fa5a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">十有八九，你使用浏览器扩展的唯一目的就是打广告。<em class="lo">也许</em>你有数独或省钱宝贝，但几乎可以肯定你有AdBlock——更好浏览的卓越动力。</p><p id="4398" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我的希望是，在这两篇文章结束时，你会受到启发，去创造同样无处不在和强大的东西。</p><p id="452f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在第一篇文章中，我们将学习浏览器扩展的基本原理，然后构建一个小项目，让我们可以将页面上的所有图像转换成皮卡丘。</p><p id="415f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在第2部分-<a class="ae ln" href="https://medium.com/@jdprince555/d51a8b6813fd" rel="noopener"><em class="lo">Catch ' Em All Chrome Extension</em></a><strong class="kt ir"/>-我们继续我们的主要项目:为我们访问的每个新网页提供可捕捉的口袋妖怪。</p><p id="c22a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将把我的代码写成一个Google Chrome扩展，但是要知道所有的浏览器扩展共享一种通用语言。</p><p id="a3f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">文章大纲:</p><ol class=""><li id="56ce" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated">什么是扩展？</li><li id="4271" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">为什么要延期？</li><li id="e60a" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">如何构建扩展？</li><li id="e748" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">我们的第一个扩展(用皮卡丘代替一切)。</li></ol><p id="1fd7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果一切按计划进行，这就是我们在本文结束时的情况:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="b868" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，基本面…</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="4448" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">什么是扩展？</h1><h2 id="d61e" class="ne mn iq bd mo nf ng dn ms nh ni dp mw la nj nk my le nl nm na li nn no nc np bi translated">额外的技能</h2><p id="ca31" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">你的网络浏览器是你电脑上最强大的软件。它比你拥有的任何东西都知道得多，在点击一下鼠标就能得到的范围内，包含了大量的难以置信的具体数据。</p><p id="71d4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，它足够谦虚地意识到它并不知道所有的事情。</p><p id="2105" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它不知道你更喜欢你的<a class="ae ln" href="https://chrome.google.com/webstore/detail/custom-cursor-for-chrome/ogdlpmhglpejoiomcodnpjnfgcpmgale" rel="noopener ugc nofollow" target="_blank">光标是披萨</a>。当你在网上购物时，它也不知道如何帮你省下一大笔钱。它本身也不会屏蔽公司付钱让你的浏览器显示的广告(这将构成一种合理的利益冲突)。</p><p id="cd07" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">取而代之的是，这些精确的、特定的技能被作为“扩展”提供</p><p id="0ebc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但那是什么？</p><h2 id="0282" class="ne mn iq bd mo nf ng dn ms nh ni dp mw la nj nk my le nl nm na li nn no nc np bi translated">这只是代码</h2><p id="5ba1" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">像网络上的所有东西一样，扩展只是代码。当你从一个网址浏览到另一个网址时，你正在给你的浏览器增加几行功能来增强它的能力。</p><p id="720f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">也许你写的代码把页面上的一切都改成了小猫。也许它检测广告并阻止它们进入DOM。也许它会根据你大概的地理位置把你的浏览器导航条变成天空的颜色(不知道是否存在，但会很酷，而且很有可能)。</p><p id="f030" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在一个扩展中，几乎任何事情都是可能的，因为在它的核心，它只是JavaScript、HTML和CSS，以及所有需要的功能。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="9e35" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">为什么是一件事？</h1><p id="0813" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">延期符合所有人的最佳利益。</p><h2 id="b205" class="ne mn iq bd mo nf ng dn ms nh ni dp mw la nj nk my le nl nm na li nn no nc np bi translated">为什么是我们的最佳利益？</h2><p id="e49e" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">它们符合我们的最佳利益，因为我们可以个性化和增强我们的网络体验。</p><p id="0edf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以指定视觉外观、玩游戏、即时访问特定的网络服务(例如谷歌翻译)、通过点击单词来查找单词(字典)…所有这些都无需离开当前页面。</p><p id="4d6d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">太棒了。</p><p id="955f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">作为一名开发人员，这真是太棒了，因为我可以写出自己想要的浏览体验，然后通过公开发布来测试它的价值。首先，他们基本上完全免费。无成本。所有利益。</p><h2 id="5bdc" class="ne mn iq bd mo nf ng dn ms nh ni dp mw la nj nk my le nl nm na li nn no nc np bi translated">为什么t <em class="nv">继承人</em>最有利益？</h2><p id="e4a5" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">与此同时，他们也符合谷歌的最大利益，因为我们，用户，对我们的网络体验拥有更多的个人所有权，因此，更喜欢谷歌的产品。我们的幸福就是他们的幸福。</p><p id="5d85" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">更不用说开源思想，它是网络精神和坚持不懈的基础，带来更大的创新和更好的<em class="lo">产品。谷歌绝不会在内部开发chrome网上商店的所有功能。</em></p><p id="12d3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">扩展还通过消除原本不是绝对必要的代码来为浏览器提供整体服务。</p><p id="c757" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过提供一个“附加浏览选项”库，浏览器减轻了它们的基线计算负荷，同时仍然为那些想要或需要它们的人提供所需的服务。</p><p id="2881" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">高效。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="db3f" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">如何编写扩展代码？</h1><p id="46b7" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">扩展带有一种不必要的令人生畏的复杂气氛。好像他们的代码有些“不同”。事实上，如果你用JavaScript、HTML和CSS制作了一个网页，那么你就已经赢得了90%的胜利。</p><p id="34e8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">只有三个外来概念需要特别注意。把这些植入你的大脑，你就很棒:</p><h2 id="b97f" class="ne mn iq bd mo nf ng dn ms nh ni dp mw la nj nk my le nl nm na li nn no nc np bi translated">1.您正在处理三个独立的网页</h2><p id="58d7" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">我怎么强调这个事实都不为过。我的第一个发现！构建Chrome扩展的那一刻，我意识到我正在与三个独立的网页一起工作，这三个网页对彼此一无所知，除非我们指示它们进行交流。</p><p id="55b3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是给你的那几页，第一页你已经非常熟悉了:</p><ul class=""><li id="c004" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm nw lv lw lx bi translated">我们的网页:</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/b276d367c6022f6c99e11d875ee3d41e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2-zWAHB95_D2IB4fgALGVw.png"/></div></div></figure><p id="69bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以上是一个正规的老网页。它很可能是亚马逊、Medium或Reddit。</p><ul class=""><li id="af25" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm nw lv lw lx bi translated">我们的弹出窗口:</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/9465820c7b4542a9de51405a3dba47f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4GuU5zTDyVvDEDl2avKCKw.png"/></div></div></figure><p id="1002" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你看到的广告拦截弹出窗口是一个完整的网页。它不是谷歌主页的<em class="lo">部分</em>。它对B.B .金一无所知。也不是任何其他网页的一部分。它是自己的实体，包含HTML、CSS和JavaScript，完全独立运行。</p><p id="82b3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当您到达一个新的URL时，浏览器会加载相应的HTML、CSS和JavaScript，同样，当您单击AdBlock图标并看到一个小页面出现时，也会发生这种情况。您的浏览器将HTML、CSS和JavaScript加载到该弹出屏幕中。</p><p id="8b5e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不同之处在于，你的浏览器只是一直带着那些文件，而不是去<em class="lo">通过网络请求找到</em>那些文件。当你在浏览器中加载一个新的Chrome扩展时，代码总是可以立即使用的。</p><p id="517c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:AdBlock当然知道当前的网页，否则它将无法完成它的工作。但它只知道网页和B.B. King，因为有JavaScript文件指示这两个页面进行通信。</p><p id="2a58" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它们没有内在联系。我们迟早会对此有深刻的理解。现在，把他们之间的互动想象成隔着栅栏大喊大叫，而不是分享一个家。</p><p id="979a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后一页是三页中最重要也是我最喜欢的一页:</p><ul class=""><li id="6d81" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm nw lv lw lx bi translated">我们的背景页面/脚本:</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/ac85ae20c720ea8f9d3d0ef1155cb37e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5I6hl2FuVtLEmaFaDY_sPA.png"/></div></div></figure><p id="e162" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">没有图片，因为它在背景中看不见。</p><p id="31fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们使用这个页面来监控与浏览器本身相关的事件，例如，当我们的扩展的图标被按下或者<em class="lo"> </em>检索和存储信息直到弹出窗口调用它。</p><p id="0145" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">(提示:我们将使用后台脚本检索口袋妖怪。)</p><p id="3099" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你能意识到在一个扩展中有三个独立的网页在工作，你就差不多成功了。你不需要使用所有三个。如果你只需要其中一页就能完成工作，那当然可以。用那个。</p><p id="6326" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本系列的课程中，我们将学习并使用这三种方法。这意味着我们将在<em class="lo">三个独立的开发人员控制台上工作！</em></p><p id="df7b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">展示这是三个独立的网页的最好方法就是调出三个独立运行的控制台。这是一张动态静态照片:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/0770d327f7418e0c5f75c9681115dd4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uGsZ92U8KtTR1mNtNpVKRQ.png"/></div></div></figure><p id="99de" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你看到的是三个不同的控制台，每个都完全不知道其他两个。左边是背景，右边是弹出窗口，下面是网页。</p><p id="5370" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果这让你觉得奇怪和混乱，那就让我感到安慰，因为它对我来说也是如此。但是，好消息是:你已经熬过了最艰难的部分。</p><p id="112e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">剩下的就是肉汁了。</p><h2 id="e38b" class="ne mn iq bd mo nf ng dn ms nh ni dp mw la nj nk my le nl nm na li nn no nc np bi translated">2.您可以引导您的扩展网页之间的对话</h2><p id="8f87" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">同样，你的扩展的三个页面(网页，弹出窗口，背景)是独立拥有和操作的。为了让他们交流，你将使用Chrome API。</p><p id="c881" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们忽略这样一个事实:API是所有编程中最糟糕的缩写(“应用程序编程接口”不是指什么？).</p><p id="b258" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">把短语<em class="lo"> Chrome API </em>想成:“Chrome提供给做扩展的人的功能”。或者说<em class="lo"> Chrome-Speak </em>，这也是我在本文剩余部分中提到它的方式。</p><p id="9932" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是一些Chrome语言的例子:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="3f0d" class="ne mn iq oc b gy og oh l oi oj">chrome.tabs.sendMessage()</span></pre><p id="d152" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">翻译:</p><p id="ae67" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe ok ol om oc b">chrome</code>的扩展函数列表中，让我们抓住一个叫做<code class="fe ok ol om oc b">tabs</code>的函数，它属于当前窗口的标签。现在，从选项卡的根函数开始，让我们使用“发送”一条“消息”的函数。</p><p id="3634" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个函数说明的是，我们必须不怕麻烦地在我们的三个页面之间发送和接收信息。我们稍后将使用这个函数从我们的后台向我们的网页发送一条消息。</p><p id="c6d9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">学习Chrome-Speak的最好工具是Chrome的<a class="ae ln" href="https://developer.chrome.com/extensions/devguide" rel="noopener ugc nofollow" target="_blank">文档</a>，这很好，但不太好。但它完成了任务。</p><h2 id="a17f" class="ne mn iq bd mo nf ng dn ms nh ni dp mw la nj nk my le nl nm na li nn no nc np bi translated">3.你需要一份清单</h2><p id="392a" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">扩建的最后一个奇怪之处是你需要一个叫做清单的东西。<em class="lo"> Manifest </em>又是一个比它需要的要长两倍又晦涩难懂的词。扩展清单是一个列表。</p><p id="7196" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这份名单说明了两件事:</p><ul class=""><li id="147b" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm nw lv lw lx bi translated">这是我的扩展中的关键文件。</li><li id="e985" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm nw lv lw lx bi translated">以下是一些默认行为(例如，“我想要弹出页面”或“我不想要弹出页面”)。</li></ul><p id="4e42" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就是这样。</p><p id="a157" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您的浏览器要求您在您的扩展中包含一个清单，这样它就可以更好地组织它的思想并定位自己来接收和实现您的代码。</p><p id="5720" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请记住，您的浏览器并没有为您在扩展中编写的任何代码做好准备。因此，你的浏览器处理好你的代码的唯一方法是告诉你的浏览器你的代码中有什么，以及你期望你的浏览器如何处理它。</p><p id="0373" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这个示例清单中，我们告诉浏览器绝对最小值:名称和版本号。</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="c693" class="ne mn iq oc b gy og oh l oi oj">{<br/>  "name": "Everything Pikachu",<br/>  "version": "1.0", <br/>  "manifest_version": 2 <br/>}</span></pre><p id="ae9f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:必须写成<code class="fe ok ol om oc b">“manifest_version”: 2</code>。不知道为什么。顺其自然吧。</p><p id="8060" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就浏览器所知，基于这个清单，我们的整个扩展只是一个名称和几个版本号。没有JavaScript。没有HTML。没有CSS。</p><p id="eaf8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不管你的扩展文件夹中实际上有多少精彩的脚本，如果不先告诉你的浏览器它们的存在，它们都不会出现或运行。</p><p id="82bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们现在就开始吧:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="92bd" class="ne mn iq oc b gy og oh l oi oj">{<br/>  "name": "Everything Pikachu",<br/>  "version": "1.0", <br/>  "manifest_version": 2,<br/>  "browser_action": {<br/>    "default_popup": "popup.html"<br/>  }<br/>}</span></pre><p id="d1ac" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">很好。你的浏览器现在知道了一些以前没有的重要信息。</p><p id="293c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它知道你的扩展名为<code class="fe ok ol om oc b">“Everything Pikachu”</code>，这是这个扩展的第一个版本；当你点击扩展的图标时(你的浏览器认为它是一个<code class="fe ok ol om oc b">“browser_action”</code>，因为它是一个直接发生在浏览器中的动作)，你的扩展文件中名为<code class="fe ok ol om oc b">“popup.html”</code>的页面就会出现。</p><p id="52b5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不言自明。只要我们让浏览器知道发生了什么，它就会遵从。</p><p id="2b7b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就要回顾的重要总体概念而言，就是这样。我们现在处于开始建设的有利位置。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="ef4f" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">我们的第一个扩展(皮卡丘的一切)</h1><p id="e3fa" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">目标:点击屏幕角落的Pokeball图标，立即可以看到当前网页的图片被皮卡丘所取代。</p><p id="9df1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">没有弹出窗口(我们将在下一篇文章中创建一个弹出窗口)。我们所有的工作将包括后台脚本和网页之间的通信。</p><p id="8aa0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:我假设您对JavaScript有基本的了解。如果没有也没关系。</p><h2 id="8ded" class="ne mn iq bd mo nf ng dn ms nh ni dp mw la nj nk my le nl nm na li nn no nc np bi translated">创建并加载扩展</h2><p id="b281" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">首先在你的计算机上创建一个新目录，用你想要的扩展名命名，并在里面导航，这样我们就可以开始创建新文件了。</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="3db3" class="ne mn iq oc b gy og oh l oi oj">$ mkdir everythingPikachu<br/>$ cd everythingPikachu</span></pre><p id="1b58" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">还记得我上面提到的我们需要的清单吗？让我们首先创建该文档，并添加上面的前几行。</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="b4f6" class="ne mn iq oc b gy og oh l oi oj">$ touch manifest.json<br/>$ atom .</span><span id="1a3a" class="ne mn iq oc b gy on oh l oi oj">// Within manifest.json =&gt;</span><span id="5a1e" class="ne mn iq oc b gy on oh l oi oj">{<br/>  "name": "Everything Pikachu", <br/>  "version": "1.0", <br/>  "manifest_version": 2<br/>}</span></pre><p id="aebc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">再次注意:如果清单版本值不是2，Chrome就不能加载我们的扩展。</p><p id="5e62" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您应该会看到这样的设置:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/0c05702e54c14e31d6700ce48bfd2e1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*5lXbTt_Lr-wj93STmSpPKg.png"/></div></figure><p id="c57e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你猜怎么着？那是一种延伸。一个空的，但仍然是一个扩展。让我们把它载入系统。</p><p id="61c0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在您的URL中导航至<code class="fe ok ol om oc b">chrome://extensions</code>…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/8bf21bda18ce66727e9589faa23daa2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XCB7EFssieAKZFW_EsS6pA.png"/></div></div></figure><p id="c649" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">…确保<em class="lo">开发者模式</em>(右上角)已打开…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/aac67cf228e41b3a0089242c93103518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*akVUeFeovfw-Mbg-xO6SFQ.png"/></div></div></figure><p id="d2c0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">…点击<em class="lo"> load unpacked </em>并选择您的<em class="lo"> everythingPikachu </em>目录。如果您完成了这些操作，您应该会看到您的新扩展已经加载:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/41b6f066e54f3612f65bab8a44163b96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Om06oTHXgKy5ApXtZ1d29g.png"/></div></div></figure><p id="4ab6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">每当我们对清单和脚本进行修改时，我们都会返回到这个页面。</p><p id="ed96" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">构建Chrome扩展的一个不幸的必要性是，您需要不断地将扩展重新上传到浏览器中(popup的CSS和HTML除外)。好消息是只需要一秒钟。</p><h2 id="7996" class="ne mn iq bd mo nf ng dn ms nh ni dp mw la nj nk my le nl nm na li nn no nc np bi translated">添加图标</h2><p id="6b87" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">返回到<code class="fe ok ol om oc b">everythingPikachu/</code>目录。让我们给目前令人厌烦的“E”扩展添加一个图标(见浏览器工具栏中新添加的灰色图标)。</p><p id="d264" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">寻找一个好的。png你喜欢的在线(皮卡丘或者口袋球)并且确保它的尺寸是正方形的。如果你能找到一个透明的背景就更好了。我救了这个家伙。</p><p id="8152" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您的文件结构应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi or"><img src="../Images/97718372d067b65038e9cbb5600312f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*1mvWzBxSTp83XJpY5ZdN2w.png"/></div></figure><p id="2c0a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">记住，我们需要告诉货单所有的关键信息。让我们让它知道我们希望这个扑克球成为我们的图标…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi os"><img src="../Images/ac41019604a204c8da8f29770a0f5743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*nVrZkjozvgXl0gsaI1o0Sw.png"/></div></figure><p id="feb2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">…返回到<code class="fe ok ol om oc b">chrome://extensions</code>并按下<em class="lo">重新加载</em>按钮。现在，您应该会在屏幕的一角看到以下内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/ddef5d57e86f044251aed69358e4d0c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:334/format:webp/1*fb6o4nMWvOY2sy169GFWcA.png"/></div></figure><p id="73db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">看到那个球了吗？你站起来了。点击它。什么都没发生。但是这个小小的连锁反应让你知道Chrome已经准备好创造奇迹了。</p><h2 id="4d6c" class="ne mn iq bd mo nf ng dn ms nh ni dp mw la nj nk my le nl nm na li nn no nc np bi translated">到处展示皮卡丘</h2><p id="f524" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">到目前为止，我已经提到有三个页面，其中一个是网页。确实如此。在Chrome-Speak中，我们将该页面称为<em class="lo">内容</em>。网页包含了我们在浏览网页时所接触到的内容。所以这是有道理的。</p><p id="1e6b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们想要访问这些内容，我们就创建一个所谓的<code class="fe ok ol om oc b">content_script</code>。事实上，您可以创建许多不同的脚本来操作网页内容。只要你声明他们都是<code class="fe ok ol om oc b">content_script</code>的，你就没事了。</p><p id="25a0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们创建并声明一个。</p><p id="c167" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从我们的<code class="fe ok ol om oc b">everythingPikachu/</code>目录…</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="85dc" class="ne mn iq oc b gy og oh l oi oj">$ touch content.js</span><span id="61db" class="ne mn iq oc b gy on oh l oi oj">// Within content.js =&gt; </span><span id="53b2" class="ne mn iq oc b gy on oh l oi oj">console.log('content script is running')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/94c53471b8370a88ee98ebcb5ca0e528.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*JRlQ9xzPFAaiY882GeDO2Q.png"/></div></figure><p id="4eb6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们告诉Chrome正确的信息，我们应该看到<em class="lo">内容脚本正在我们的网页开发控制台中运行</em>,无论何时我们进入一个新的网页。也就是说，每当我们加入新内容时。</p><p id="6bb0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们在清单中做出这些断言:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/22668f6af80083505cde95ec58623827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*DIB-iQ-AY6od89Z7bODAgA.png"/></div></figure><p id="cb46" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Chrome，这里是我们加载“任何”新网页(即“所有URL”)时想要运行的<em class="lo"> content_scripts </em>。第一个用“JavaScript”写的叫做<code class="fe ok ol om oc b">“content.js”</code>。帮我找到它。它在这个目录里。</p><p id="dfbc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">确保在您的管理页面中点击<em class="lo">重新加载</em>(右下角):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/922495b660976add5f51f2321c9a51bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*G0x6ZuyOi0_eZoyTQVV_OA.png"/></div></figure><p id="06b2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过打开新选项卡或刷新当前选项卡来测试新脚本。打开开发人员控制台。您应该看到<em class="lo">内容脚本正在运行</em>已记录…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/211b2e7567b208052b786dc732215f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Z1FRe7u-B-FAcX0ywJXsHg.png"/></div></figure><p id="7592" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们知道我们的扩展可以访问我们的网页，让我们开始操纵它们，把所有可用的图像都改成这张<a class="ae ln" href="https://steemitimages.com/0x0/https://vignette.wikia.nocookie.net/pokemon/images/c/cd/PLEEI_Pikachu_Thunderbolt.png/revision/latest/scale-to-width-down/639?cb=20141209160531" rel="noopener ugc nofollow" target="_blank">皮卡丘</a>在愤怒的电流中爆炸的图像。</p><ul class=""><li id="0a6c" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm nw lv lw lx bi translated"><code class="fe ok ol om oc b">content.js</code>更新了…</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/36428e75c403e84ebdcec74dc16c65a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qZ4cLrxkI-HwazS96e4H3A.png"/></div></div></figure><p id="e36f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们正在遍历网页的图像集合并改变它们的来源。</p><p id="7efa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在扩展管理器页面中重新加载扩展，然后打开一个新网页。《纽约时报》是一个特别有趣的例子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0a9acb905c56faa625e40e25a0bc99f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nfV2tpL0ZwXxwkJXjUO_Vg.png"/></div></div></figure><p id="2cd7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不错！您刚刚成功地创建了一个处理网页上图像的扩展。</p><p id="d68b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，让我们练习我们的“内容脚本”(与网页相关联的脚本)和“后台脚本”之间的通信，后台脚本不断地在幕后运行，监听浏览器的动作。</p><h2 id="564b" class="ne mn iq bd mo nf ng dn ms nh ni dp mw la nj nk my le nl nm na li nn no nc np bi translated">背景脚本</h2><p id="166f" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">在我们做任何事之前猜猜我们要去哪里？回到我们无所不知的清单。</p><p id="9e0e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们必须首先让Chrome知道我们正在添加一个后台脚本，然后再尝试向我们的文件添加一个新文档:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/b7f018042f88598c9d348b6c695f3f6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*Hu47HMYs5z9zwlTbJvrFmg.png"/></div></figure><p id="1dc9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">检查底部的条目<code class="fe ok ol om oc b">“background”</code>……它非常简单明了。我们正在给<code class="fe ok ol om oc b">“background”</code>添加一个名为<code class="fe ok ol om oc b">“background.js”</code>的<code class="fe ok ol om oc b">“script”</code>。</p><p id="931c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在管理控制台中重新加载扩展之前，让我们创建一个登录到控制台的<code class="fe ok ol om oc b">background.js</code>…</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="a46e" class="ne mn iq oc b gy og oh l oi oj">$ touch background.js </span><span id="9c42" class="ne mn iq oc b gy on oh l oi oj">// Within everythingPikachu =&gt; </span><span id="b264" class="ne mn iq oc b gy on oh l oi oj">console.log('background script is running')</span></pre><p id="2e5e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">…在文件树中应该是这样的…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/4e88105c802b931928383a8a780f3ba9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*sUpLazRj2m7vZT4ZcWcZdw.png"/></div></figure><p id="a6b5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请确保重新加载您的扩展。对后台脚本的更改需要重新加载。</p><p id="9551" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">刷新你当前的网页或加载一个新的，然后打开开发者控制台…你应该看到…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/388ebebd1c23d35c99df761c9773e7cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*KCu6-sXtIlPNGkSnwY1ctA.png"/></div></figure><p id="ef86" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">没什么！</p><p id="483a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">记住，<em class="lo">后台脚本和后台页面在后台静默运行，独立于内容脚本和网页。</em></p><p id="b911" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们想要访问后台脚本的控制台日志，我们需要<em class="lo">检查后台页面</em>，这是在<code class="fe ok ol om oc b">chrome://extensions</code>提供给我们的一个选项:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/06229d79b270399a949c1018bf0db117.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*ShZty2ISVPPg02gFy79QkA.png"/></div></figure><p id="9a60" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">点击<em class="lo">背景页面</em>，你会看到一个弹出窗口。该窗口是您专用的后台脚本开发控制台。在它的控制台中有几个字<em class="lo">后台脚本正在运行</em>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/9997d4dd53e0ba06fbe317e3dcc1fc9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*UPS6pGIkh15ZJ5heCF2QIw.png"/></div></figure><p id="ae6d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:如果您重新加载或访问新的网页，<em class="lo">后台脚本正在运行</em>将不会重新登录到控制台。</p><p id="f3e9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">只要Chrome打开，后台脚本就会一直运行。只要Chrome是活动的，扩展也是激活的，它的后台脚本就会不停地运行，不断地监听正在发生的动作。</p><p id="aa2c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们测试一下，每当我们单击扩展图标时，后台脚本都会通过控制台日志记录<code class="fe ok ol om oc b">“pokeball icon was pressed”</code>来监听事件。这将需要一些受欢迎Chrome用户:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/5f654270ce7e3f54ea77bbdece2bc3ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eiz8CICeZvF94vc0LwQndw.png"/></div></div></figure><p id="ced0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">翻译:"<code class="fe ok ol om oc b">chrome</code>，"你有一堆"<code class="fe ok ol om oc b">browserActions</code>"可以发生，其中之一是我"点击"图标的事件…"听"当那发生的时候。当它出现时，将<code class="fe ok ol om oc b">‘pokeball icon was pressed’</code>记录到控制台。</p><p id="d045" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">记住，这个脚本属于不可见的后台<em class="lo"> </em>页面，所以所有的控制台日志都会出现在我们刚刚重新发现的后台控制台中。</p><p id="ed75" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果我们单击屏幕顶部的图标18次，我们应该会看到相同的消息在后台的控制台中出现18次:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/487b3e6da6544818f663344ec9d36b76.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*i_ZMzeEqutGU2iNj_Eu0FQ.png"/></div></figure><p id="d750" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们很接近了。</p><p id="b234" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们的目标是能够通过点击Pokeball图标来触发皮卡丘图像级联。我们已经独立完成了这两件事。现在，我们将它们组合成一系列的呼叫和响应。</p><p id="81d9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">沟通流程:</p><ol class=""><li id="923e" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated">后台脚本将检测到图标已被按下。</li><li id="1ea0" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">按下时，它会提醒内容脚本。</li><li id="5bd6" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">内容脚本将接收消息。</li><li id="5ff2" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">如果消息正确，内容脚本将转换所有图像。</li></ol></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="dc56" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">把所有的放在一起</h1><p id="a5b2" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">我们已经完成了第一点。让我们做第二点。</p><p id="6995" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我们按下图标时，不要在控制台记录文本，而是让后台脚本向当前选项卡发送一条消息(使用我们在<em class="lo">您引导您的扩展的网页之间的对话</em>一节中演示的相同Chrome-Speak)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/9cf1c87862e00a3bb4753f4b2fe01b61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5JpUvQPiSv7NqTO2flmkXA.png"/></div></div></figure><p id="f27b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Ln 1翻译:</p><p id="0535" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当图标被点击时，运行函数<code class="fe ok ol om oc b">tellContentScript</code>，该函数接受当前<code class="fe ok ol om oc b">tab</code>的一个参数(当前标签被Chrome隐式检索和传递)。</p><p id="4c1d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Ln 3+ translate: " <code class="fe ok ol om oc b">chrome</code>"给我所有的"标签页"和"发送消息"到当前标签页(我们知道是哪一个，因为当前的<code class="fe ok ol om oc b">tab</code>对象正通过<code class="fe ok ol om oc b">tellContentScript</code>函数隐式传递)。</p><p id="e10b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:<code class="fe ok ol om oc b">sendMessage</code>默认情况下接受两个参数:一个ID和一个对象形式的消息。</p><p id="9116" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此时，我们每次点击图标都会发送一条消息，但是<em class="lo"> </em>什么也收不到。我们需要建立双方的沟通。</p><p id="878e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">返回我们的<code class="fe ok ol om oc b">content.js</code>文件，准备Chrome从后台脚本接收消息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ph"><img src="../Images/2ce47a9005503bc090c71e694bdc0192.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1xOXMbFaDyUhoiB_RqMgA.png"/></div></div></figure><p id="4cd4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Translate: " <code class="fe ok ol om oc b">chrome</code>"当您"运行"这个内容脚本时，"倾听"来自后台脚本的"消息"。收到后，运行功能<code class="fe ok ol om oc b">gotMessage</code>。</p><p id="bd1c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:<code class="fe ok ol om oc b">gotMessage</code>(或者任何您决定命名的函数)默认接受三个参数。</p><p id="03e0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第一个是从后台脚本收到的消息，第二个是发送者的身份，第三个是一个回调函数，您可以使用它向后台脚本返回一个响应，也许是感谢它发出的警报。</p><p id="04e7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe ok ol om oc b">gotMessage</code>中，我们检查收到的消息是否是我们期望的(“发送它，伙计”)——如果是，继续将所有图像更改为皮卡丘。</p><p id="c346" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我们测试我们的工作之前:从我们的扩展管理器页面重新加载扩展。</p><p id="d279" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完成后，您应该能够这样做:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="9b8c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">强大。使用这种格式，我们可以改变页面上的任何内容:文本、按钮、视频等。</p><p id="0ef9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这非常有趣，而且代码非常少。我们将在下一篇文章中改进我们的项目，创建一个弹出窗口，对其进行样式化，并使其与后台脚本进行交互，以模拟随机的口袋妖怪遭遇(使用有史以来最棒的<a class="ae ln" href="https://pokeapi.co/" rel="noopener ugc nofollow" target="_blank"> PokeAPI </a>):</p><p id="36ae" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://medium.com/@jdprince555/d51a8b6813fd" rel="noopener"> <em class="lo">【捉迷藏】全铬扩展</em>T3】</a></p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="4807" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">结论</h1><p id="3bb7" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">如果你在这里停下来，我希望你已经学到了一些好的新技能，并且正在为你自己的浏览器扩展酝酿一些好的想法。</p><h2 id="2c28" class="ne mn iq bd mo nf ng dn ms nh ni dp mw la nj nk my le nl nm na li nn no nc np bi translated">开源代码库</h2><p id="7498" class="pw-post-body-paragraph kr ks iq kt b ku nq jr kw kx nr ju kz la ns lc ld le nt lg lh li nu lk ll lm ij bi translated">本文项目的GitHub repo可从以下网址获得:</p><p id="4ef2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/SwanHub/everythingPikachu" rel="noopener ugc nofollow" target="_blank">皮卡丘</a></p><p id="ab62" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">快乐编码，</p><p id="9e27" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">杰克逊</p></div></div>    
</body>
</html>