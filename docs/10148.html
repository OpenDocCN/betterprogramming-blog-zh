<html>
<head>
<title>Writing Your Own TypeScript CLI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写您自己的类型脚本CLI</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/writing-your-own-typescript-cli-6f9c5688ad34?source=collection_archive---------3-----------------------#2021-12-06">https://betterprogramming.pub/writing-your-own-typescript-cli-6f9c5688ad34?source=collection_archive---------3-----------------------#2021-12-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="82f1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">写CLI感觉像是超能力</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a1665b52bead073b75410764a8b5bef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dckgllYi2EJomfuaKvcmxQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="ad97" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">TL；速度三角形定位法(dead reckoning)</h1><ul class=""><li id="4df8" class="lq lr it ls b lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">🍳您可以轻松编写CLI。比你想象的要简单:)</li><li id="5e41" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">🗼我们将一起编写一个CLI来生成Lighthouse性能报告。</li><li id="dae3" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">🔦您将看到如何配置TypeScript、ESLint和更漂亮的。</li><li id="46a1" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">📚您将看到如何使用一些很棒的库，如<code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/chalk/chalk" rel="noopener ugc nofollow" target="_blank">chalk</a></code>和<code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/tj/commander.js" rel="noopener ugc nofollow" target="_blank">commander</a></code>。</li><li id="113e" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">🧑‍🔬您将看到如何生成多个进程。</li><li id="be07" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">🚀您将看到如何在GitHub操作中使用您的CLI。</li></ul></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="aa1f" class="ky kz it bd la lb mz ld le lf na lh li jz nb ka lk kc nc kd lm kf nd kg lo lp bi translated">真实世界的用例</h1><p id="a0de" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated"><a class="ae mr" href="https://developers.google.com/web/tools/lighthouse/" rel="noopener ugc nofollow" target="_blank"> Lighthouse </a>是最流行的开发工具之一，可以洞察网页性能。它提供了一个CLI和节点模块，因此我们可以通过编程来运行它。然而，您会注意到，如果您在同一网页上多次运行Lighthouse，得分会有所不同。这是因为存在已知的<a class="ae mr" href="https://developers.google.com/web/tools/lighthouse/variability" rel="noopener ugc nofollow" target="_blank">可变性</a>。有许多因素会影响灯塔的可变性。处理方差的一个推荐策略是多次运行Lighthouse。</p><p id="6b8f" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">在本文中，我们将使用CLI来实现这一策略。实施将包括:</p><ul class=""><li id="e62a" class="lq lr it ls b lt nr lv ns lx nw lz nx mb ny md me mf mg mh bi translated">运行多个灯塔分析</li><li id="3285" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">汇总数据并计算中值分数</li></ul><p id="bc0a" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">我希望你很兴奋！</p><h1 id="599a" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">使项目的文件结构达到顶峰</h1><p id="e2d6" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">这是配置工具后文件结构的样子。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="1cf7" class="od kz it mq b gy oe of l og oh">my-script<br/>├── .eslintrc.js<br/>├── .prettierrc.json<br/>├── package.json<br/>├── tsconfig.json<br/>├── bin<br/>└── src<br/>    ├── utils.ts<br/>    └── index.ts</span></pre><p id="947d" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">源文件位于<code class="fe mn mo mp mq b">/src</code>目录中。我们将编译它们并在<code class="fe mn mo mp mq b">/bin</code>目录下输出<code class="fe mn mo mp mq b">.js</code>文件。</p><p id="5a0d" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">当您的用户使用CLI时，<code class="fe mn mo mp mq b">/bin</code>目录将是该命令的入口点。稍后您将了解如何配置它。</p><h1 id="c91f" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">配置工具</h1><p id="bd81" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">我们将使用<a class="ae mr" href="https://yarnpkg.com/" rel="noopener ugc nofollow" target="_blank">纱</a>作为我们这个项目的包装经理。如果你愿意，可以随意使用<a class="ae mr" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>。</p><p id="490f" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">让我们启动这个项目。我们将创建一个名为<code class="fe mn mo mp mq b">my-script</code>的目录:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="d2d3" class="od kz it mq b gy oe of l og oh">$ mkdir my-script &amp;&amp; cd my-script</span></pre><p id="aea1" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">在项目根，让我们用Yarn创建一个<code class="fe mn mo mp mq b">package.json</code>:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="c8d4" class="od kz it mq b gy oe of l og oh">$ yarn init</span></pre><h2 id="2242" class="od kz it bd la oi oj dn le ok ol dp li lx om on lk lz oo op lm mb oq or lo os bi translated">配置TypeScript</h2><p id="076b" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">要安装<a class="ae mr" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>和<a class="ae mr" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> NodeJS </a>的类型，运行:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="ae7d" class="od kz it mq b gy oe of l og oh">$ yarn add --dev typescript @types/node</span></pre><p id="314e" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">现在我们准备在项目中配置TypeScript。我们可以用<code class="fe mn mo mp mq b">tsc</code>启动<code class="fe mn mo mp mq b">tsconfig.json</code>:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="b81f" class="od kz it mq b gy oe of l og oh">$ npx tsc --init</span></pre><p id="3202" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">为了编译TypeScript代码并将结果输出到<code class="fe mn mo mp mq b">/bin</code>目录，我们需要在<code class="fe mn mo mp mq b">tsconfig.json</code>的<code class="fe mn mo mp mq b">compilerOptions</code>中指定。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="6e3e" class="od kz it mq b gy oe of l og oh">// tsconfig.json</span><span id="a892" class="od kz it mq b gy ot of l og oh">{<br/>  "compilerOptions": {<br/>+    "outDir": "./bin"<br/>    /* rest of the default options */<br/>  }<br/>}</span></pre><p id="8e93" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">就是这样！我们来测试一下。</p><p id="f62f" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">在项目根目录下，运行下面的命令在<code class="fe mn mo mp mq b">/src</code>中创建一个<code class="fe mn mo mp mq b">index.ts</code>文件。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="f840" class="od kz it mq b gy oe of l og oh">$ mkdir src &amp;&amp; touch src/index.ts</span></pre><p id="8147" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">在<code class="fe mn mo mp mq b">index.ts</code>中，我们将放置一个简单的<code class="fe mn mo mp mq b">console.log</code>并运行TypeScript编译器来查看编译后的文件是否在<code class="fe mn mo mp mq b">/bin</code>目录中。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="3a6d" class="od kz it mq b gy oe of l og oh">// src/index.ts</span><span id="a070" class="od kz it mq b gy ot of l og oh">console.log('Hello from my-script👋')</span></pre><p id="0f53" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">添加一个脚本，用<code class="fe mn mo mp mq b">tsc</code>编译TypeScript。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="b91d" class="od kz it mq b gy oe of l og oh">// package.json</span><span id="a82b" class="od kz it mq b gy ot of l og oh">+ "scripts": {<br/>+   "tsc": "tsc"<br/>+ },</span></pre><p id="9155" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">然后运行:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="d8ba" class="od kz it mq b gy oe of l og oh"># compile `/src`<br/>$ yarn tsc</span></pre><p id="9632" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">您应该会在<code class="fe mn mo mp mq b">/bin</code>目录中看到一个<code class="fe mn mo mp mq b">index.js</code>文件。</p><p id="7276" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">让我们从项目根目录执行<code class="fe mn mo mp mq b">/bin</code>目录，</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="4ccd" class="od kz it mq b gy oe of l og oh">$ node bin</span><span id="7ab6" class="od kz it mq b gy ot of l og oh"># Hello from my-script 👋</span></pre><h2 id="4879" class="od kz it bd la oi oj dn le ok ol dp li lx om on lk lz oo op lm mb oq or lo os bi translated">配置ESLint</h2><p id="69e6" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">现在我们准备好去T21了。我们可以继续安装它:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="293d" class="od kz it mq b gy oe of l og oh">$ yarn add --dev eslint</span></pre><p id="e119" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">ESLint是一种非常强大的棉绒。它没有类型脚本支持，所以我们将安装一个<a class="ae mr" href="https://github.com/typescript-eslint/typescript-eslint/tree/6e159ee7cf8ef2028792cb8ee636cf6143fa967f/packages/parser" rel="noopener ugc nofollow" target="_blank">类型脚本解析器</a>:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="c40b" class="od kz it mq b gy oe of l og oh">$ yarn add --dev @typescript-eslint/parser @typescript-eslint/eslint-plugin</span></pre><p id="2527" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">我们还安装了<code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/typescript-eslint/typescript-eslint/tree/6e159ee7cf8ef2028792cb8ee636cf6143fa967f/packages/eslint-plugin" rel="noopener ugc nofollow" target="_blank">@typescript-eslint/eslint-plugin</a></code>。这是因为我们需要它来为特定于TypeScript的特性扩展ESLint规则。</p><p id="8273" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">让我们在项目中配置eslint。我们将在项目根目录下创建一个<code class="fe mn mo mp mq b">.eslintrc.js</code>:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="2190" class="od kz it mq b gy oe of l og oh">touch .eslintrc.js</span></pre><p id="0687" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">在<code class="fe mn mo mp mq b">.eslintrc.js</code>中，我们可以如下配置eslint:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="1702" class="od kz it mq b gy oe of l og oh">// .eslintrc.js</span><span id="322e" class="od kz it mq b gy ot of l og oh">module.exports = {<br/>  parser: '@typescript-eslint/parser',<br/>  plugins: ['@typescript-eslint'],<br/>  extends: ['plugin:@typescript-eslint/recommended'],<br/>}</span></pre><p id="0393" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">为了更好地理解配置，我们首先使用<code class="fe mn mo mp mq b">@typescript-eslint/parser</code>来启用ESLint理解TypeScript语法的能力。然后我们应用<code class="fe mn mo mp mq b">@typescript-eslint/eslint-plugin</code>插件来扩展规则。最后，我们启用了所有推荐的规则表单<code class="fe mn mo mp mq b">@typescript-eslint/eslint-plugin</code>。</p><p id="3983" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">如果你有兴趣了解更多关于配置的信息，你可以查看<a class="ae mr" href="https://github.com/typescript-eslint/typescript-eslint/tree/main/packages/eslint-plugin#usage" rel="noopener ugc nofollow" target="_blank">官方文档</a>了解更多细节。</p><p id="95e8" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">我们现在可以给<code class="fe mn mo mp mq b">package.json</code>添加一个林挺脚本:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="60e4" class="od kz it mq b gy oe of l og oh">// package.json</span><span id="5375" class="od kz it mq b gy ot of l og oh">{<br/>  "scripts": {<br/>+    "lint": "eslint '**/*.{js,ts}' --fix",<br/>  }<br/>}</span></pre><p id="1af3" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">要运行脚本:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="f629" class="od kz it mq b gy oe of l og oh">$ yarn lint</span></pre><h2 id="6d27" class="od kz it bd la oi oj dn le ok ol dp li lx om on lk lz oo op lm mb oq or lo os bi translated">配置更漂亮</h2><p id="e9a2" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">漂亮的是一个非常强大的格式化程序。它附带了一套规则来格式化我们的代码。有时这些规则会与ESLint规则冲突，所以我将向您展示如何配置它们。</p><p id="e087" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">首先安装Prettier并在项目根目录下创建一个<code class="fe mn mo mp mq b">.prettierrc.json</code>文件来保存配置，</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="e8b2" class="od kz it mq b gy oe of l og oh">$ yarn add --dev --exact prettier &amp;&amp; touch .prettierrc.json</span></pre><p id="30c2" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">您可以编辑<code class="fe mn mo mp mq b">.prettierrc.json</code>并添加您的自定义规则。你可以在官方文件中找到<a class="ae mr" href="https://prettier.io/docs/en/options.html" rel="noopener ugc nofollow" target="_blank">选项。</a></p><p id="98db" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">这里有一个例子:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="41c4" class="od kz it mq b gy oe of l og oh">// .prettierrc.json</span><span id="5e99" class="od kz it mq b gy ot of l og oh">{<br/>  "trailingComma": "all",<br/>  "singleQuote": true<br/>}</span></pre><p id="480f" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">Prettier提供了与ESLint的便捷集成。我们将遵循官方文档中的<a class="ae mr" href="https://github.com/prettier/eslint-plugin-prettier#recommended-configuration" rel="noopener ugc nofollow" target="_blank">推荐配置</a>。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="4a2b" class="od kz it mq b gy oe of l og oh">$ yarn add --dev eslint-config-prettier eslint-plugin-prettier</span></pre><p id="914e" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">我们将在<code class="fe mn mo mp mq b">extensions</code>数组的最后一个位置添加插件。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="2d9f" class="od kz it mq b gy oe of l og oh">// .eslintrc.js</span><span id="003e" class="od kz it mq b gy ot of l og oh">module.exports = {<br/>  extends: [<br/>    'plugin:@typescript-eslint/recommended',<br/>+    'plugin:prettier/recommended',<br/>  ],<br/>}</span></pre><p id="fcd3" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">很重要的一点，漂亮是最后一个分机。通过应用last，它禁用了所有与格式相关的ESLint规则，因此冲突将退回到更漂亮。</p><p id="685f" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">我们现在可以给<code class="fe mn mo mp mq b">package.json</code>添加一个<code class="fe mn mo mp mq b">prettier</code>脚本:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="70e0" class="od kz it mq b gy oe of l og oh">// package.json</span><span id="8fb5" class="od kz it mq b gy ot of l og oh">{<br/>  "scripts": {<br/>+    "prettier": "prettier --write ."<br/>  }<br/>}</span></pre><p id="5f99" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">要运行脚本:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="8fe9" class="od kz it mq b gy oe of l og oh">$ yarn prettier</span></pre><h1 id="96e9" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">配置<code class="fe mn mo mp mq b">package.json</code></h1><p id="2c25" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">我们几乎准备好了我们的配置。唯一缺少的是像执行命令一样执行项目的方法。我们希望能够直接调用命令，而不是用<code class="fe mn mo mp mq b">node</code>执行<code class="fe mn mo mp mq b">/bin</code>:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="03bb" class="od kz it mq b gy oe of l og oh"># instead of "node bin", we want to call the command by its name like this:<br/>$ my-script</span></pre><p id="2b6e" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">我们如何做到这一点？首先，我们需要在我们的<code class="fe mn mo mp mq b">src/index.ts</code>顶部添加一个<a class="ae mr" href="https://en.wikipedia.org/wiki/Shebang_(Unix)" rel="noopener ugc nofollow" target="_blank"> Shebang </a>。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="cb82" class="od kz it mq b gy oe of l og oh">+ #!/usr/bin/env node</span><span id="f766" class="od kz it mq b gy ot of l og oh">console.log('Hello from my-script👋')</span></pre><p id="8256" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">Shebang通知类Unix操作系统这是NodeJS可执行文件。所以我们可以不指定<code class="fe mn mo mp mq b">node</code>直接调用脚本。</p><p id="e649" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">我们重新编译一下，</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="fa88" class="od kz it mq b gy oe of l og oh">$ yarn tsc</span></pre><p id="da1d" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">在一切正常之前我们还需要一样东西。我们需要将可执行权限分配给<code class="fe mn mo mp mq b">bin/index.js</code>:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="4f5a" class="od kz it mq b gy oe of l og oh">$ chmod u+x ./bin/index.js</span></pre><p id="0306" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">让我们试一试:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="8406" class="od kz it mq b gy oe of l og oh"># execute directly<br/>$ ./bin/index.js</span><span id="ec94" class="od kz it mq b gy ot of l og oh"># Hello from my-script👋</span></pre><p id="e450" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">很好，我们快到了。最后一件事是在命令和可执行文件之间创建一个符号链接。首先，我们需要在<code class="fe mn mo mp mq b">package.json</code>中指定<code class="fe mn mo mp mq b">bin</code>属性，并将命令指向<code class="fe mn mo mp mq b">bin/index.js</code>。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="8ee7" class="od kz it mq b gy oe of l og oh">// package.json</span><span id="a840" class="od kz it mq b gy ot of l og oh">{<br/>+  "bin": {<br/>+    "my-script": "./bin/index.js"<br/>+  }<br/>}</span></pre><p id="1e40" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">其次，在项目根创建一个带有Yarn的符号链接:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="8153" class="od kz it mq b gy oe of l og oh">$ yarn link</span><span id="54bb" class="od kz it mq b gy ot of l og oh"># You can always unlink: "yarn unlink my-script"</span></pre><p id="7e0c" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">让我们看看它是否有效。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="81c9" class="od kz it mq b gy oe of l og oh">$ my-script</span><span id="950e" class="od kz it mq b gy ot of l og oh"># Hello from my-script👋</span></pre><p id="9462" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">它工作了🎉</p><p id="9fd5" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">为了使开发更容易，我们将在<code class="fe mn mo mp mq b">package.json</code>中添加几个脚本:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="c942" class="od kz it mq b gy oe of l og oh">// package.json</span><span id="a0a6" class="od kz it mq b gy ot of l og oh">{<br/>  "scripts": {<br/>+    "build": "yarn tsc &amp;&amp; yarn chmod",<br/>+    "chmod": "chmod u+x ./bin/index.js",<br/>  }<br/>}</span></pre><p id="1f89" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">现在我们可以运行<code class="fe mn mo mp mq b">yarn build</code>来编译并自动分配入口文件的可执行权限。</p><h1 id="4941" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">编写CLI来运行Lighthouse</h1><p id="1e78" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">是时候实现我们的核心逻辑了。我们将探索几个方便的npm包来帮助我们编写CLI，并深入了解Lighthouse的魔力。</p><h2 id="6b22" class="od kz it bd la oi oj dn le ok ol dp li lx om on lk lz oo op lm mb oq or lo os bi translated">用<code class="fe mn mo mp mq b">chalk</code>给<code class="fe mn mo mp mq b">console.log</code>着色</h2><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="98fa" class="od kz it mq b gy oe of l og oh">$ yarn add <!-- -->chalk@4.1.2</span></pre><p id="c34e" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">确保您正在安装<code class="fe mn mo mp mq b">chalk 4</code>。<code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/chalk/chalk/releases/tag/v5.0.0" rel="noopener ugc nofollow" target="_blank">chalk 5</a></code> <a class="ae mr" href="https://github.com/chalk/chalk/releases/tag/v5.0.0" rel="noopener ugc nofollow" target="_blank">是纯ESM </a>在TypeScript 4.6发布之前我们不能用TypeScript <a class="ae mr" href="https://github.com/microsoft/TypeScript/issues/46452" rel="noopener ugc nofollow" target="_blank">来使用它。</a></p><p id="91b1" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated"><code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/chalk/chalk" rel="noopener ugc nofollow" target="_blank">chalk</a></code>给你的<code class="fe mn mo mp mq b">console.log</code>赋予色彩。例如:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="f16a" class="od kz it mq b gy oe of l og oh">// src/index.ts</span><span id="49a1" class="od kz it mq b gy ot of l og oh">import chalk from 'chalk'</span><span id="b1af" class="od kz it mq b gy ot of l og oh">console.log(chalk.green('Hello from my-script👋'))</span></pre><p id="796b" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">现在在项目根目录下运行<code class="fe mn mo mp mq b">yarn build &amp;&amp; my-script</code>并查看日志。</p><p id="1fcf" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">让我们用更有意义的方式来使用<code class="fe mn mo mp mq b">chalk</code>。<a class="ae mr" href="https://web.dev/performance-scoring/#color-coding" rel="noopener ugc nofollow" target="_blank"> Lighthouse表演分数用颜色编码</a>。我们可以编写一个效用函数，用基于性能分数的颜色来显示显示值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="279e" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">在<code class="fe mn mo mp mq b">src/index.ts</code>中使用它，并尝试用<code class="fe mn mo mp mq b">draw()</code>记录一些东西以查看结果。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="3632" class="od kz it mq b gy oe of l og oh">// src/index.ts</span><span id="56e8" class="od kz it mq b gy ot of l og oh">import { draw } from './utils'</span><span id="b4e1" class="od kz it mq b gy ot of l og oh">console.log(`Perf score is ${draw(0.64, 64)}`)</span></pre><h2 id="26d8" class="od kz it bd la oi oj dn le ok ol dp li lx om on lk lz oo op lm mb oq or lo os bi translated">使用<code class="fe mn mo mp mq b">commander</code>设计命令</h2><p id="0a18" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">为了使我们的CLI具有交互性，我们需要能够读取用户输入并解析它们。<code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/tj/commander.js" rel="noopener ugc nofollow" target="_blank">commander</a></code>是定义接口的描述性方式。我们可以用一种非常简洁和文档化的方式实现我们的接口。</p><p id="1422" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">我们希望用户如何与CLI交互是简单地传递一个运行Lighthouse的URL。我们还想传入一个选项来指定Lighthouse应该在URL上运行多少次。像这样:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="cb7e" class="od kz it mq b gy oe of l og oh"># without an option<br/>$ my-script https://dawchihliou.github.io/</span><span id="2ffa" class="od kz it mq b gy ot of l og oh"># with an option<br/>$ my-script https://dawchihliou.github.io/ --iteration=3</span></pre><p id="c358" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">让我们看看用<code class="fe mn mo mp mq b">commander</code>实现我们的设计有多快。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="4259" class="od kz it mq b gy oe of l og oh">$ yarn add commander</span></pre><p id="2910" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">让我们清除<code class="fe mn mo mp mq b">src/index.ts</code>并重新开始:</p><p id="8ec9" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated"><code class="fe mn mo mp mq b">src/index.ts</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="d091" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">我们首先实例化了一个<code class="fe mn mo mp mq b">Command</code>，并使用实例<code class="fe mn mo mp mq b">program</code>来定义:</p><ul class=""><li id="6547" class="lq lr it ls b lt nr lv ns lx nw lz nx mb ny md me mf mg mh bi translated">我们给它起了一个名字<code class="fe mn mo mp mq b">url</code>和一个描述</li><li id="e17a" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">一个<code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/tj/commander.js#options" rel="noopener ugc nofollow" target="_blank">option</a></code>:我们给了它一个短标志、一个长标志、一个描述和一个默认值</li></ul><p id="dba1" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">为了使用参数和选项，我们首先解析命令并记录变量。</p><p id="a9c6" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">现在我们可以运行命令并观察日志。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="0184" class="od kz it mq b gy oe of l og oh">$ yarn build</span><span id="229c" class="od kz it mq b gy ot of l og oh"># without an option<br/>$ my-script https://dawchihliou.github.io/</span><span id="8949" class="od kz it mq b gy ot of l og oh"># url: https://dawchihliou.github.io/, iteration: 5</span><span id="cbc6" class="od kz it mq b gy ot of l og oh"># with an option<br/>$ my-script https://dawchihliou.github.io/ --iteration=3<br/># or<br/>$ my-script https://dawchihliou.github.io/ -i 3</span><span id="1f47" class="od kz it mq b gy ot of l og oh"># url: https://dawchihliou.github.io/, iteration: 3</span></pre><p id="3d14" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">很酷吧？！另一个很酷的功能是<code class="fe mn mo mp mq b">commander</code>自动生成一个<code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/tj/commander.js#automated-help" rel="noopener ugc nofollow" target="_blank">help</a></code>来打印帮助信息。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="7421" class="od kz it mq b gy oe of l og oh">$ my-script --help</span></pre><h2 id="42d2" class="od kz it bd la oi oj dn le ok ol dp li lx om on lk lz oo op lm mb oq or lo os bi translated">在单独的操作系统进程中运行多个Lighthouse分析</h2><p id="6ea0" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">在前一节中，我们学习了如何解析用户输入。是时候深入CLI的核心了。</p><p id="c35d" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">运行多个Lighthouse的建议是在<a class="ae mr" href="https://github.com/GoogleChrome/lighthouse/issues/7187" rel="noopener ugc nofollow" target="_blank">单独的进程</a>中运行它们，以消除干扰的风险。<code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/moxystudio/node-cross-spawn" rel="noopener ugc nofollow" target="_blank">cross-spawn</a></code>是一个针对产卵过程的跨平台解决方案。我们将使用它同步生成新的进程来运行Lighthouse。</p><p id="8b9c" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">要安装<code class="fe mn mo mp mq b">cross-spawn</code>:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="820e" class="od kz it mq b gy oe of l og oh">$ yarn add cross-spawn<br/>$ yarn add --dev @types/cross-spawn</span><span id="27c9" class="od kz it mq b gy ot of l og oh"># Let's install lighthouse too✨<br/>$ yarn add lighthouse</span></pre><p id="03c9" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">我们来编辑一下<code class="fe mn mo mp mq b">src/index.ts</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="8d10" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">在代码中，我们基于用户输入多次生成新流程。在每个过程中，我们使用headless Chrome运行Lighthouse性能分析，并收集JSON数据。<code class="fe mn mo mp mq b">result</code>变量将在一个字符串中保存一组独立的性能数据。下一步是汇总数据并计算最可靠的性能得分。</p><p id="86f8" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">如果你执行上面的代码，你会看到一个关于<code class="fe mn mo mp mq b">require</code>的林挺错误。<code class="fe mn mo mp mq b">require.resolve</code>解析模块的路径，而不是模块本身。在本文中，我们将允许编译<code class="fe mn mo mp mq b">.eslintrc.js</code>中的<code class="fe mn mo mp mq b">@typescript-eslint/no-var-requires</code>规则。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="b3bf" class="od kz it mq b gy oe of l og oh">// .eslintrc.js</span><span id="b5ea" class="od kz it mq b gy ot of l og oh">module.exports = {<br/>+  rules: {<br/>+    // allow require<br/>+    '@typescript-eslint/no-var-requires': 0,<br/>+  },<br/>}</span></pre><h2 id="8235" class="od kz it bd la oi oj dn le ok ol dp li lx om on lk lz oo op lm mb oq or lo os bi translated">计算可靠的灯塔分数</h2><p id="a858" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">一种策略是通过计算中位数来汇总报告。Lighthouse提供内部功能<code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/GoogleChrome/lighthouse/blob/master/lighthouse-core/lib/median-run.js" rel="noopener ugc nofollow" target="_blank">computeMedianRun</a></code>。让我们使用它。</p><p id="fb80" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated"><code class="fe mn mo mp mq b">src/index.ts</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="cf86" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">在引擎盖下，<code class="fe mn mo mp mq b">computeMedianRun</code>返回最接近第一个内容丰富的绘画的中值和交互时间的中值的分数。这是因为它们代表了页面初始化生命周期中最早和最晚的时刻。这是一种比简单的方法更可靠的确定中位数的方法，即从单个测量值中找出中位数。</p><p id="f7ea" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">现在再次尝试该命令，看看结果！</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="9e21" class="od kz it mq b gy oe of l og oh">$ yarn build &amp;&amp; my-script https://dawchihliou.github.io --iteration=3</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/0a4d154080eadf4876a66e5c8065e707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*UMvjO60iN_xJaFZv1LPNeQ.png"/></div></figure><p id="eaef" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">瓦拉🎉</p><h1 id="3ebd" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">在GitHub操作中使用CLI</h1><p id="c5a5" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">我们的实现已经完成。让我们在自动化工作流中使用CLI，这样我们就可以在CD/CI管道中进行性能基准测试。</p><p id="2e28" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">首先，让我们在npm上发布这个包(假设)。</p><p id="c605" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">我发布了一个npm包<code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/DawChihLiou/dx-scripts/" rel="noopener ugc nofollow" target="_blank"><strong class="ls iu">dx-scripts</strong></a></code>，其中包含了<code class="fe mn mo mp mq b">my-script</code>的生产就绪版本。我们将使用<code class="fe mn mo mp mq b">dx-scripts</code>编写GitHub Actions工作流来演示我们的CLI的应用。</p><h1 id="80f9" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">在国家预防机制上发布(一个例子)</h1><p id="dad5" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">我们将在<code class="fe mn mo mp mq b">package.json</code>中添加一个<code class="fe mn mo mp mq b">files</code>属性来发布<code class="fe mn mo mp mq b">/bin</code>目录。</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="c7a3" class="od kz it mq b gy oe of l og oh">// package.json</span><span id="31c4" class="od kz it mq b gy ot of l og oh">{<br/>+  "files": ["bin"],<br/>}</span></pre><p id="09b4" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">然后简单地运行:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="06b2" class="od kz it mq b gy oe of l og oh">$ yarn publish</span></pre><p id="e309" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">现在包在npm上(假设)！</p><h1 id="6471" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">编写工作流</h1><p id="d682" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">我们来讨论一下工作流程。我们希望工作流程能够:</p><ul class=""><li id="5d0a" class="lq lr it ls b lt nr lv ns lx nw lz nx mb ny md me mf mg mh bi translated">当有更新时，根据拉请求运行</li><li id="cf42" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">根据功能分支预览URL运行Lighthouse性能分析</li><li id="9602" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">用分析报告通知拉取请求</li></ul><p id="2e2f" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">因此，在工作流程成功完成后，您将看到GitHub Action Bot的评论，其中包含您的Lighthouse分数。</p><p id="51d5" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">为了关注我们的CLI的应用，我将在工作流中硬编码特性分支预览URL。</p><p id="ee59" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">在您的应用程序存储库中，安装<code class="fe mn mo mp mq b">dx-scripts</code>:</p><pre class="kj kk kl km gt nz mq oa ob aw oc bi"><span id="bb14" class="od kz it mq b gy oe of l og oh">$ yarn add --dev dx-scripts</span></pre><p id="0ff2" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">将<code class="fe mn mo mp mq b">lighthouse-dev-ci.yaml</code>添加到您的GitHub工作流目录:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="7106" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">在“Run Lighthouse”步骤中，我们运行了<code class="fe mn mo mp mq b">dx-script lighthouse</code> CLI，替换了特殊字符以便打印多行输出，并且我们在变量<code class="fe mn mo mp mq b">lighthouse_report</code>中设置了输出。在“Notify PR”步骤中，我们用“Run Lighthouse”步骤的输出编写了一个注释，并使用<code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/marketplace/actions/auto-comment" rel="noopener ugc nofollow" target="_blank">wow-actions/auto-comment</a></code> <a class="ae mr" href="https://github.com/marketplace/actions/auto-comment" rel="noopener ugc nofollow" target="_blank"> </a>动作来发布注释。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/9ded29e5ac1024bdbe40674d26d46d76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*7ejNUKrokHdsXNXeF-WigQ.png"/></div></figure><p id="81b8" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">就是这样！多好的旅程啊。令人惊讶的是你一路跟随。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="069e" class="ky kz it bd la lb mz ld le lf na lh li jz nb ka lk kc nc kd lm kf nd kg lo lp bi translated">综上</h1><p id="2b24" class="pw-post-body-paragraph ne nf it ls b lt lu ju ng lv lw jx nh lx ni nj nk lz nl nm nn mb no np nq md im bi translated">写个CLI也不算太差吧？让我们来看看我们已经讨论过的所有内容:</p><ul class=""><li id="5294" class="lq lr it ls b lt nr lv ns lx nw lz nx mb ny md me mf mg mh bi translated">配置TypeScript</li><li id="d8be" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">配置ESLint</li><li id="109a" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">配置更漂亮</li><li id="71b8" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">在本地执行您的命令</li><li id="dc79" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">用<code class="fe mn mo mp mq b">chalk</code>给原木着色</li><li id="bfdb" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">用<code class="fe mn mo mp mq b">commander</code>定义您的命令</li><li id="f4b3" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">产卵过程</li><li id="6c19" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">执行灯塔CLI</li><li id="865c" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">使用Lighthouse的内部库来计算中值性能分数</li><li id="ffcd" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">将您的命令发布为npm包</li><li id="3655" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated">将您的命令应用到GitHub动作工作流程</li></ul><p id="f80b" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">现在超能力也是你的了</p><h1 id="2473" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">资源</h1><ul class=""><li id="449b" class="lq lr it ls b lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><a class="ae mr" href="https://developers.google.com/web/tools/lighthouse" rel="noopener ugc nofollow" target="_blank">灯塔官网</a></li><li id="7b39" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated"><a class="ae mr" href="https://web.dev/performance-scoring/#color-coding" rel="noopener ugc nofollow" target="_blank">灯塔绩效评分</a></li><li id="4108" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated"><a class="ae mr" href="https://developers.google.com/web/tools/lighthouse/variability" rel="noopener ugc nofollow" target="_blank">灯塔可变性</a></li><li id="c9de" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated"><code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/tj/commander.js" rel="noopener ugc nofollow" target="_blank">commander</a></code> <a class="ae mr" href="https://github.com/tj/commander.js" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a></li><li id="8d58" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated"><code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/chalk/chalk" rel="noopener ugc nofollow" target="_blank">chalk</a></code> <a class="ae mr" href="https://github.com/chalk/chalk" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a></li><li id="3673" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated"><code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/moxystudio/node-cross-spawn" rel="noopener ugc nofollow" target="_blank">cross-spawn</a></code> <a class="ae mr" href="https://github.com/moxystudio/node-cross-spawn" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a></li><li id="1804" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated"><code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/typescript-eslint/typescript-eslint/tree/main/packages/parser" rel="noopener ugc nofollow" target="_blank">@typescript-eslint/parser</a></code> GitHub资源库</li><li id="5994" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated"><code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/typescript-eslint/typescript-eslint/tree/main/packages/eslint-plugin#usage" rel="noopener ugc nofollow" target="_blank">@typescript-eslint/eslint-plugin</a></code> GitHub仓库</li><li id="7853" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated"><code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/DawChihLiou/dx-scripts/" rel="noopener ugc nofollow" target="_blank">dx-scripts</a></code> <a class="ae mr" href="https://github.com/DawChihLiou/dx-scripts/" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a></li><li id="c42b" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated"><a class="ae mr" href="https://github.com/prettier/eslint-plugin-prettier#recommended-configuration" rel="noopener ugc nofollow" target="_blank">更漂亮&amp; ESLint在GitHub上推荐的配置</a></li><li id="e945" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated"><code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/GoogleChrome/lighthouse/blob/master/lighthouse-core/lib/median-run.js" rel="noopener ugc nofollow" target="_blank">lighthouse/lighthouse-core/lib/median-run.js</a></code>GitHub上</li><li id="92d4" class="lq lr it ls b lt mi lv mj lx mk lz ml mb mm md me mf mg mh bi translated"><code class="fe mn mo mp mq b"><a class="ae mr" href="https://github.com/marketplace/actions/auto-comment" rel="noopener ugc nofollow" target="_blank">wow-actions/auto-comment </a></code> <a class="ae mr" href="https://github.com/marketplace/actions/auto-comment" rel="noopener ugc nofollow" target="_blank"> GitHub行动市场</a></li></ul></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><p id="dc4d" class="pw-post-body-paragraph ne nf it ls b lt nr ju ng lv ns jx nh lx nt nj nk lz nu nm nn mb nv np nq md im bi translated">这篇文章最初发布在<a class="ae mr" href="https://dawchihliou.github.io/articles/writing-your-own-typescript-cli" rel="noopener ugc nofollow" target="_blank">道智的网站</a>。</p></div></div>    
</body>
</html>