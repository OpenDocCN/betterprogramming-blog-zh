# 创建一个微服务需要多少微？

> 原文：<https://betterprogramming.pub/microservice-macroservice-f483f9797246>

## 避免将项目扔进垃圾桶的简单规则

![](img/3462ed6460fc67793249cd6635aea0df.png)

查尔斯·德鲁维奥在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

微服务是建筑设计更大的趋势之一。在过去的几年里，大多数软件都是建立在这个支柱之上的，很多人都体验到了非常好的结果。微服务可以提高性能和可扩展性，并降低维护成本。总之，正如我在文章[中描述的，“微服务不是银弹。学习为什么，"](/microservice-pros-cons-69ffe8c39faf)有一个阴暗面。如果您没有以正确的方式实现微服务，您可能会失去所有的优势，并保留单片应用程序的所有问题。这是一个难以理解的概念，但我们必须把事情弄清楚。

在本文中，我将尝试给出一些关于微服务实现中最重要的因素之一的信息:范围。换句话说，微服务应该有多“微”？

# 为什么关注尺寸

微服务架构是一种连接数据模型和业务模型的技术。这使得用单独的团队开发不同的业务 aria 成为可能。正如 *divide et impera* 法则所教导的，拥有多个小代码库比管理一个巨大的单片应用程序更容易。因此，乍一看，这似乎是一个简单的问题:只需拼接应用程序代码。

> 切割错误是最常见的错误，也是微服务失败的首要原因。

事实上，当你有一个独立的、独立的应用程序构建在一个特定的域或子域上时，微服务工作得很好。

> 通常，定义模型边界更多的是一种赌博，而不是一门科学。

在下一节中，我们将看到范围过大或过小的副作用，以及如何为我们的应用程序定义最合适的大小。

# 太大了不好

要证明拥有太大的应用程序域是不好的，只需想一想当您拥有像您的单片应用程序一样大的微服务时的情况。你可能会说这根本不是微服务！嗯，微服务领域很大怎么办？很明显，微服务越庞大，你就越会失去管理小应用程序的好处。这不仅是代码量问题，也是管理复杂性的问题。所以，明确地说，如果你有一个对于你的数据模型来说太大的范围，你不是在使用微服务，你只是给你的项目加了一个很酷的标签。

这不是我们作为软件架构师的目标。我们应该找到实施可靠解决方案的方法，而不是在同事面前装模作样。所以，我们都同意一个巨大的应用程序域是不好的，所以更容易的解决方案是把它分割成更小的部分，但是有多小呢？越小越好，你会告诉。让我们在下一节看看，你夸大的时候会出现哪些问题。

# 太小是不好的

为了将事情发挥到极致，您可以考虑让单个微服务尽可能小。你可以想象一个 CRUD 应用程序，一个在单个实体上运行的 API。您可能会告诉我，划分单个操作(读取、创建、更新……)将是一个更“小”的解决方案，但是我不需要深入证明拥有一个小的应用程序会带来问题。

回到我们的 CRUD 微服务，假设微服务管理实体“设置”。这可能是一个包含应用程序设置的简单密钥对表。这非常简单而且有效，因为域与应用程序的范围完全匹配。但是现在考虑两个不同的 API 应用程序，一个管理 ordered，另一个管理 order 行。可以想象，这样使用它们是很麻烦的，因为您应该添加订单，然后添加订单行，然后用总数更新订单。

这很难使用，因为您隐式地将您的业务逻辑委托给调用者。根据调用方对 API 的使用，这可能会导致不同的行为。例如，用户可以在更改订单项目行后任意更新或不更新订单总数。此外，订单添加不是 ACID，所以如果您在订单写入过程中破坏了一些东西(记住:添加订单，添加行，然后更新总计…)，您可能会有不一致的数据。

> 这个例子解释了分割域模型也会分割业务逻辑，从而导致复杂性和不必要的麻烦。

我们已经看到，太大不好，但太小也不好。那么合适的尺寸是多少呢？只需跳到下一部分就能发现它。

# 适合所需的领域

给出的一个规则是保持数据模型自动一致。换句话说，永远不要分割领域模型。当然，我们不是在谈论整个应用领域。例如，如果您在微服务上创建电子商务，您可能有不同的应用范围域(CRM、CMS、电子商务),您可以将大问题分成小问题。更成问题的是把 CMS 部分分成两个不同的微服务，一个是类别，一个是页面。这太多了，会导致不可管理的软件。

> 将领域模型作为边界的方法非常好，但是并不总是“微观的”

为了打破这个僵局，程序员创造了一个新术语:宏服务。这可能有助于保持他们内心的平静，并带来巨大的成果，因为这证明了我们在领域应用程序缩小化方面已经尽了最大的努力。

好了，我们终于明白了微服务的合适规模。但是我要告诉你还有一个问题。只需阅读下一部分来发现它。

# 对自己撒谎是不好的

现在，我们已经明确了微服务应用的正确范围，只需了解我们能发现什么问题。以下是根据我的经验列出的一个清单(如果你有其他一些警告点，请在本文中添加回复以做出贡献！):

*   **臣服于领域模型:**很容易看出我有一个铁板一块的领域，没办法分割。因此，真的要问问你的组件之间的依赖关系是否真的牢不可破，你是否可以重构领域使它们自治。
*   **改变领域模型:**如果您的业务需求需要一个复杂的范围，试图分割它可能会导致学术上的练习，但不会提高质量和可维护性
*   **将苹果和橘子混合在一起:**如果你的领域模型是由苹果和橘子组成的，你可以将这两种水果分别放到两个不同的篮子里。但是如果你把它们放在篮子里的时候把它们混在一起，你就不会有任何好处。
*   **隐瞒自己不使用微服务的事实:**不使用微服务并不丢人。唯一的问题是，当你认为你正在使用它，你设置你的应用程序，如果你这样做。这可能会在开发团队中导致过度的解决方案或误解。

# 带回家的信息

不是强迫你使用微服务。微服务是一种可以帮助您的应用程序更易于维护和扩展的方法。无论如何，这种方法并不总是适用的。一些限制可能来自团队(不是这种方法的专家，没有技能)，项目的规模(项目可能很小，以至于没有任何实质性的好处)，或者领域模型。在本文中，我们讨论了域模型的正确大小以及如何处理单个微服务的范围。

同样，没有任何书面规定。唯一要记住的是永远不要改变商业模式，也不要害怕规模，而是根据你的领域模式来尝试分割整体。