<html>
<head>
<title>Fast Prototyping With TDD and Azure Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TDD和Azure功能的快速原型开发</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/fast-prototyping-with-azure-functions-6e0e24ef2bff?source=collection_archive---------9-----------------------#2019-09-06">https://betterprogramming.pub/fast-prototyping-with-azure-functions-6e0e24ef2bff?source=collection_archive---------9-----------------------#2019-09-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e62d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">接受达里奥有史以来最好的生日祝福</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1a9889f36f463f52d50bd28766c6be7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cv9VCZbW08xHYdZnM2aV7Q.png"/></div></div></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="bf2a" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">我有个主意</h1><p id="26a9" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">我有一个同事，达里奥，他给我很棒的生日祝福。</p><p id="76e2" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">办公室里的每个人都很高兴收到来自达里奥的语音问候。他们说，“直到达里奥向你问好，这才算生日。”</p><p id="f776" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">那么，为什么不让世界上的每个人在生日那天都受到达里奥的问候呢？你想试试吗？</p><div class="mu mv gp gr mw mx"><a href="https://telegram.me/HappyDarioBot" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">快乐机器人</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">大米预示着一个完整的达里奥！写下你的名字，并注意他的声音信息！！！</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">电报.我</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl ks mx"/></div></div></a></div><p id="d33e" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">目前它只有意大利语版本(抱歉)。</p><p id="5938" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">Github储存库在这里:</p><div class="mu mv gp gr mw mx"><a href="https://github.com/lucapiccinelli/HappyDarioBot" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">lucapiccinelli/HappyDarioBot</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">从达里奥那里得到生日快乐的祝福！快乐达里奥机器人在这里工作https://telegram.me/HappyDarioBot达里奥很有趣…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">github.com</p></div></div><div class="ng l"><div class="nm l ni nj nk ng nl ks mx"/></div></div></a></div></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="f253" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">好的。怎么会？</h1><p id="d561" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">我需要一种简单的方式让人们向我问好。网站？平台时代谁还用一个网站？那么站台。哪一个？脸书？推特？或者电报？通常，达里奥使用WhatsApp发布他的音频笔记。我想让他呆在他的舒适区，但你可能知道WhatsApp对bot开发设置了许多限制。所以，电报是选择！</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="f394" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">好的。在哪里？</h1><p id="ab71" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">在哪里托管机器人？答案取决于业务需求和技术选择。在项目的这个阶段，我需要快！我不想把时间花在可能没人会用的东西上。我需要尽快知道是否有人要用它。因此，速度是重中之重。目前，我正在用Kotlin开发，但是由于我用C#开发了很多年，它仍然是我最有效的语言。</p><p id="6636" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">我还需要存储音频文件和一些简单的非结构化信息。</p><p id="f67a" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">用C#写的东西，访问简单的存储，有什么更快的方法？答案是无服务器托管。对于C#，Azure函数。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="db19" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">质量</h1><p id="c233" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">我说快，那不代表我接受低质量的代码。在幸运的情况下，有人会使用它，我想让它增长，而不是重写一切。</p><p id="ab82" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">如何快速并保持可接受的代码质量水平？测试驱动开发是答案。总而言之，习惯它需要一些时间和练习，但是一旦你投入其中，这是在现实世界中开发和运输东西的最快方式。</p><p id="8995" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">实际上，提高速度不仅仅是关于TDD。这是一套黄金组合的技术:</p><ul class=""><li id="d84d" class="nn no it lv b lw mp lz mq mc np mg nq mk nr mo ns nt nu nv bi translated">TDD →保存您的商业价值</li><li id="c860" class="nn no it lv b lw nw lz nx mc ny mg nz mk oa mo ns nt nu nv bi translated">渐进式方法→只做你已经知道的有价值的事情</li><li id="f891" class="nn no it lv b lw nw lz nx mc ny mg nz mk oa mo ns nt nu nv bi translated">简单设计→保持简单和模块化</li></ul><p id="5829" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">那些是相关的。TDD支持增量方法。增量方法改进简单设计。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="f6c7" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">如何用Azure函数进行TDD</h1><p id="4221" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">TDD一点也不平凡。最难回答的问题之一是“考什么？”</p><p id="e660" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">HappyDarioBot Azure函数正在通过Telegram webhook接收电报更新。然后，它处理更新并发回一条电报消息。这个回答消息依赖于一些业务逻辑。</p><p id="a0b0" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">似乎我既没有输入也没有输出。</p><p id="0eeb" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">那要考什么呢？我是否应该通过HTTP向bot发送请求，然后使用一些Telegram API来确保消息已经被实际接收到？需要多长时间？这个测试代码会有多复杂？</p><p id="9533" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">我们不是QA。我们是开发商。我们的重点不是为测试而测试，而是为开发而测试。</p><p id="2c6c" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">让我们开始切掉一些东西。因为我使用的是无服务器架构，所以我可以非常确定这个基础架构能够正常工作。所以，我不需要通过HTTP执行一个真正的post来确保我的函数会像预期的那样被触发。我可以直接通过Azure函数的类来调用它。这省去了我发现应该如何在本地调用Azure函数来通过HTTP应答的努力。</p><p id="7e37" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">我不拥有输入格式，因为它是通过webhook从Telegram来的。我如何获得一些输入来测试？</p><p id="f6e6" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">请看下面代码的第6行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="4d01" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">这是机器人的第一个版本。</p><p id="c179" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">在第6行，我记录了HTTP请求。我将它部署在Azure上，注册了webhook，并通过Telegram向机器人发送了一条消息。然后我去了Azure portal的日志监控。在那里，我有我的输入样本。我复制并粘贴到测试中，它就完成了。对您期望的每种输入类型重复这个过程(对一些意外的表单也是如此)。</p><h2 id="de80" class="od lc it bd ld oe of dn lh og oh dp ll mc oi oj ln mg ok ol lp mk om on lr oo bi translated">产量呢？</h2><p id="f046" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">这里也要简化。通常，在测试第三方API时，您无法检查您的调用在他们的系统上触发的状态变化。你依赖的事实是，如果API回答OK，那么就OK。</p><p id="73fe" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">这里也一样。在这个级别的测试中，我对<em class="op">工作</em>的定义是函数回答OK。仅此而已。</p><p id="46b5" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">商业逻辑呢？我怎么知道它实际上在做我期望的事情？通过单元测试。</p><p id="08fb" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">发现业务逻辑将被转移到一个合作者是很容易的。业务逻辑不能依赖于任何基础设施。这样，就很容易用单元测试来测试它。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="d86e" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">结论</h1><p id="c861" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">我没有记录开发HappyDarioBot花了多长时间。然而，我估计总共需要25到30个小时。一些注意事项:</p><ul class=""><li id="d4cc" class="nn no it lv b lw mp lz mq mc np mg nq mk nr mo ns nt nu nv bi translated">我以前从未在Azure上开发过任何东西。</li><li id="6c70" class="nn no it lv b lw nw lz nx mc ny mg nz mk oa mo ns nt nu nv bi translated">我以前从未开发过电报机器人。</li><li id="062a" class="nn no it lv b lw nw lz nx mc ny mg nz mk oa mo ns nt nu nv bi translated">我每天花一小时完成大部分工作。这和8小时专注是不一样的。</li></ul><p id="1bfd" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">总而言之，我想说的是，作为无服务器架构的第一次测试，我对结果很满意。你必须学会如何使用平台的工具，但是作为一名开发人员，你可以100%专注于开发。</p><p id="0d13" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">如果你想尽快用你的产品的可用原型/alpha版本达到你的目标，去无服务器是我建议考虑的一个选择。如果你是一个C#开发者，那么在Azure上你会有宾至如归的感觉。</p></div></div>    
</body>
</html>