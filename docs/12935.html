<html>
<head>
<title>A Beginner’s Guide to Implementing the Singleton Design Pattern in Ruby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Ruby中实现单例设计模式的初学者指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/design-pattern-1-singleton-308c896801d7?source=collection_archive---------7-----------------------#2022-07-12">https://betterprogramming.pub/design-pattern-1-singleton-308c896801d7?source=collection_archive---------7-----------------------#2022-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ebb2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">设计模式#1</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5ea28276162ca101fa683546cc03bb0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2tnhZp_YOzRF2pC1"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Henrik dnnestad在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="d360" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当使用面向对象编程时，你有没有想过为什么我们总是要创建一个类的实例？有时，基于用例，我们可能只需要一个实例，它可以在初始化后全局使用。</p><p id="991d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我见过这样的情况，人们声明一个类的实例，在项目启动时将它赋给一个全局变量，并在整个项目中使用它。除了使用全局变量，还有更好的方法吗？是的，单例类！</p><p id="a3d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Singleton是一种创造性的设计模式，最初是四种设计模式的<a class="ae kv" href="https://www.journaldev.com/31902/gangs-of-four-gof-design-patterns" rel="noopener ugc nofollow" target="_blank">帮的一部分。</a></p><h1 id="79c5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是单例设计模式？</h1><p id="6e85" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Gangs of Four收集了《设计模式:可重用面向对象软件的元素》一书中的23种设计模式。正如书中提到的，模式可以分为三个主要类别:创造的、行为的和结构的。单例模式是一种创造性的模式，因为它处理对象的创建。</p><p id="bb3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该模式基本上限制了类的初始化，以确保在整个应用程序中只能创建和使用该类的一个实例。</p><h2 id="c608" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">单一模式的用例</h2><p id="093a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如前所述，单例模式确保了一个类的整个实现都围绕着唯一的实例，这在设计某些用例时非常有用。</p><p id="d2ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在很多情况下，这种模式非常有用，但是我在下面强调了三种最广泛使用的用例:</p><ol class=""><li id="062f" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated">日志服务</li><li id="2a9d" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">缓存服务</li><li id="f8ba" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">数据库服务</li></ol><p id="601f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上述所有情况下，在项目初始化期间不需要定义单个实例，并且可以通过预定义的实例访问该类的方法，该实例可以在整个应用程序中用于执行定义的操作。因为在任何给定时间都只有一个类实例，所以节省了大量内存。</p><h1 id="d7e8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">例子</h1><p id="d0d5" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">案例1:类的基本实现</p><p id="eb5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们实现单例模式之前，让我们看看如何在整个应用程序中创建和使用一个类的实例。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="a10f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如上所示，每当需要在类中执行一个动作时，可以创建config类的一个实例。</p><p id="5780" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">案例2:单例模式</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="fac2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如上所示，您可以通过使用singleton 来实现Singleton模式</p><p id="226d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然看起来很有趣，实现起来也很简单，但是Singletons也有一些缺点:</p><p id="7999" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">难以测试——由于Singleton类的构造函数是抽象的，您将不得不在单元测试期间模拟初始化。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="0a37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要小心处理多线程情况</p><h2 id="5fef" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">不符合标准—不能一次解决一个问题</h2><p id="60bf" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><strong class="ak">参考文献</strong></p><p id="32f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.youtube.com/watch?v=oeQWxhlnCHM" rel="noopener ugc nofollow" target="_blank">单例设计模式|实现细节&amp;代码</a></p><p id="b959" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.tutorialspoint.com/design_pattern/singleton_pattern.htm" rel="noopener ugc nofollow" target="_blank"> TutorialsPoint — Singleton </a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="24c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://github.com/ruby/ruby/blob/master/lib/singleton.rb" rel="noopener ugc nofollow" target="_blank"> Ruby Singleton </a></p><h1 id="58d4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi"><strong class="ak">Cons of Using Singleton</strong></h1><p id="3a14" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi">Though it looks fun and simple to implement, Singletons come with a few cons too:</p><ol class=""><li id="d31b" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi">Difficult to test — As the constructor of the Singleton class is abstracted, you will have to mock the initialization during unit testing.</li><li id="6f01" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi">Need to handle multi-threading cases carefully</li><li id="8c96" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi">Not SOLID compliant — Does not solve one problem at a time</li></ol><h1 id="640d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi"><strong class="ak">References</strong></h1><ol class=""><li id="ac3d" class="nb nc iq ky b kz mk lc ml lf nr lj ns ln nt lr ng nh ni nj bi"><a class="ae kv" href="https://www.youtube.com/watch?v=oeQWxhlnCHM" rel="noopener ugc nofollow" target="_blank">Singleton Design Pattern | Implementation with details &amp; code</a></li><li id="d6e2" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi"><a class="ae kv" href="https://www.tutorialspoint.com/design_pattern/singleton_pattern.htm" rel="noopener ugc nofollow" target="_blank">TutorialsPoint — Singleton</a></li><li id="932d" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi"><a class="ae kv" href="https://github.com/ruby/ruby/blob/master/lib/singleton.rb" rel="noopener ugc nofollow" target="_blank">Ruby Singleton</a></li></ol></div></div>    
</body>
</html>