<html>
<head>
<title>Secure iOS Apps Through App Pinning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过应用锁定保护iOS应用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/secure-ios-apps-through-app-pinning-4106d31c5d7d?source=collection_archive---------6-----------------------#2019-08-30">https://betterprogramming.pub/secure-ios-apps-through-app-pinning-4106d31c5d7d?source=collection_archive---------6-----------------------#2019-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5993" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在iOS中提供高级别的API安全性</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/9ed97f765da82536da73772aa354f965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*sKqmd6K9fM7EV-Kk1zpAqg.png"/></div></figure><p id="66e8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">SSL pin可以帮助您构建安全的移动应用程序，即使用户选择使用不安全的(麦当劳，有人吗？)无线网络。使用应用程序锁定有助于避免中间人攻击。</p><p id="ab76" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">难度:简单|普通| <strong class="ks iu">挑战</strong></p></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="0d4d" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">先决条件</h1><ul class=""><li id="f8be" class="ml mm it ks b kt mn kw mo kz mp ld mq lh mr ll ms mt mu mv bi translated">对iOS应用从完成到生产的一些了解</li><li id="c29e" class="ml mm it ks b kt mw kw mx kz my ld mz lh na ll ms mt mu mv bi translated">使用<a class="ae nb" href="https://github.com/Alamofire/Alamofire" rel="noopener ugc nofollow" target="_blank">阿拉莫菲尔</a></li><li id="5126" class="ml mm it ks b kt mw kw mx kz my ld mz lh na ll ms mt mu mv bi translated">下载iOS版<a class="ae nb" href="https://www.charlesproxy.com/documentation/ios/" rel="noopener ugc nofollow" target="_blank">查理斯</a></li></ul></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="f377" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">术语</h1><p id="9e51" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated"><em class="nf">中间人</em>:攻击者坐在用户和<strong class="ks iu">【漏字】之间的攻击。</strong></p><p id="8f94" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><em class="nf">公钥加密</em>:使用两个密钥的加密系统:一个大家都知道的公钥和一个私钥。私钥可以用来读取用公钥加密的<strong class="ks iu"> </strong>未加密的消息，反之则不成立。</p><p id="e051" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><em class="nf">公钥基础设施(PKI) </em>:分发、使用、存储和撤销数字证书以及管理公钥加密所需的一组角色、策略、硬件、软件和过程。</p><p id="7d36" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><em class="nf">安全套接字层(SSL)</em>:HTTP上的加密客户端-服务器通信(由HTTPS规定)。</p></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="8b07" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">问题是</h1><p id="1bf1" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">SSL通信被认为是安全的，通过最合理的措施，如花费的时间打破；对128位SSL加密字符串的暴力攻击需要数年时间。中间人攻击可以通过地址解析协议(ARP)缓存中毒或DNS欺骗来实现。ARP缓存中毒利用ARP的性质(将IP地址映射到设备的MAC地址)，而DNS欺骗是一种破坏名称服务器域名映射的攻击，其方式是返回不正确的IP地址，并将流量转移到非预期的计算机。</p><p id="a76f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在iOS应用程序中，iOS信任商店中的证书用于建立连接并确定信任哪些证书。但是，如果攻击者将自签名证书注入信任存储，就可能发生中间人攻击，即应用程序与它认为是受信任目的地的服务器进行通信。</p><p id="fda0" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">另一种可能的方法是破解根CA证书。</p><h2 id="325b" class="ng lu it bd lv nh ni dn lz nj nk dp md kz nl nm mf ld nn no mh lh np nq mj nr bi translated">SSL固定</h2><p id="ff65" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">这是一种确保应用程序只与指定服务器通信的方法。目标的服务器SSL证书保存在app bundle中，并在定义固定证书时使用。</p><p id="7f0a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这是苹果应用传输安全(ATS)的基础，自iOS 9以来，该应用一直是iOS的一项功能，因为该设备仍然容易受到使用黑客或自签名证书的攻击。</p></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="7280" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">我们如何知道证书是有效的？</h1><p id="e26a" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">这是一个有趣的问题。我们如何知道来自证书颁发机构的证书是有效的？我们有一个信任链，它是通过验证每个证书直到根证书来建立的。换句话说，根CA最终必须是可信的。</p><p id="da55" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们如何相信一个人的身份是有效的？我们看他们的护照，但最终我们不得不相信护照签发机构，以及他们如何验证护照持有人的身份。应用程序验证评估日期和数字签名。</p></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="aec6" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">履行</h1><h2 id="aab2" class="ng lu it bd lv nh ni dn lz nj nk dp md kz nl nm mf ld nn no mh lh np nq mj nr bi translated">起点</h2><p id="25fb" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">我们有一个简单的应用程序，在一个ui table视图中显示来自<a class="ae nb" href="https://havibeenpwned.com/api/v2i" rel="noopener ugc nofollow" target="_blank">https://haveibeenpwned.com/api/v2</a>的违规列表</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/dbff87660c0865445e61566f04c45aba.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/format:webp/1*hAfwNLNUSmQo0dYqkp4Zsw.png"/></div></figure><p id="f13b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们要确保haveibeenpwned.com就是那个网站。</p><p id="0612" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这段代码使用Alamofire使证书锁定变得更加容易。作为一种替代方案，可以用<a class="ae nb" href="https://github.com/AFNetworking/AFNetworking" rel="noopener ugc nofollow" target="_blank"> AFNetworking </a>甚至<code class="fe nt nu nv nw b">NSURLSession</code>来实现这一点(尽管后者比较棘手，需要使用C API)。</p><p id="4dd3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">AF请求的代码非常简单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="c06a" class="ng lu it bd lv nh ni dn lz nj nk dp md kz nl nm mf ld nn no mh lh np nq mj nr bi translated">访问证书</h2><p id="a3bf" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">从终端，我们可以输入以下内容</p><p id="efaf" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe nt nu nv nw b">$ openssl s_client -connect haveibeenpwned.com:443 &lt;/dev/null</code></p><p id="19f0" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这提供了一个证书列表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi nz"><img src="../Images/45ada98eb9b70d8e258782ec3ddba027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UOyxvRWdrbWIldiEvoWCEw.png"/></div></div></figure><p id="d00e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">当然，还有将要使用的证书:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/99a75d0f6dd66f9a42995e86bb0799ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*skNgMJ-VLPifi4b4pm5LSA.png"/></div></figure><p id="822a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们可以使用终端命令将其复制到一个文件中。</p><p id="b217" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe nt nu nv nw b">openssl s_client -connect haveibeenpwned.com:443 &lt;/dev/null | openssl x509 -outform DER -out haveibeenpwned.com.der</code></p><p id="37d0" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这将生成。finder中的der文件。然后，您可以将它复制到应用程序的根目录:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/164c80adc92be91b19096cd13146559a.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*EP2NzFBkDvay9Apy8nWSpw.png"/></div></figure><p id="f04d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">然后我们需要将这个复制到应用程序中。拖放就可以了:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/66d642195bebe874f8ceb666014db715.png" data-original-src="https://miro.medium.com/v2/resize:fit:534/format:webp/1*qeWoit3AbENYUzHoSPfEuw.png"/></div></figure><h2 id="0d22" class="ng lu it bd lv nh ni dn lz nj nk dp md kz nl nm mf ld nn no mh lh np nq mj nr bi translated">陷害查尔斯</h2><p id="108c" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">你应该已经有了查尔斯代理服务器，但是如果你没有，下载它吧！</p><p id="0301" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">从多项代理菜单中选择SSL代理设置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/cc62680ad33179d85d015fbc03446d13.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*hHAK4RuxIpBxRLST2fYoLw.png"/></div></figure><p id="5931" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">输入haveibeenpwned.com并勾选启用SSL代理复选框:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/ca7fcdbee8a4d972753e4110fd2091bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*vZESIYjKvKrYqdO-pa_WyA.png"/></div></figure><h2 id="c96c" class="ng lu it bd lv nh ni dn lz nj nk dp md kz nl nm mf ld nn no mh lh np nq mj nr bi translated">设置模拟器</h2><p id="43cd" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">您需要通过菜单帮助&gt; SSL代理&gt;在iOS模拟器中安装查尔斯根证书，在iOS模拟器中安装查尔斯根证书:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi oj"><img src="../Images/bf338af0836aa6844e01aa762b75ee84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c2lOrnEaQUI9cv4dLkNVKw.png"/></div></div></figure><p id="830d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在模拟器上，您需要通过菜单General &gt; About &gt; Certificate Trust Settings安装证书，并启用Charles Proxy。</p><p id="1e7b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这使得应用程序通过Charles代理运行，就像中间人攻击一样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/64268b74d26f5da3b78c3286e1e07db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*eVkX4kY6jm7Svj6VULDGPg.png"/></div></figure></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><p id="1854" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">当查尔斯运行时，我们得到一个错误。否则，应用程序会正常运行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/354c04ad2c7a748d74aed31b8ae00a41.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*tfBYDVtYHKPkhweS_IEd5g.png"/></div></figure></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><p id="44b3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">要重置模拟器，您需要重置。为此，菜单项是硬件&gt;清除所有内容和设置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/48c9b5e4dbaa9284af0e9068f21ee7e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*bYeHPzLB3oIX-cGfClMUkw.png"/></div></figure></div><div class="ab cl lm ln hx lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="im in io ip iq"><h1 id="d495" class="lt lu it bd lv lw lx ly lz ma mb mc md jz me ka mf kc mg kd mh kf mi kg mj mk bi translated">结论</h1><p id="539f" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">中间人攻击是一种真实的可能性，尤其是在移动设备上使用金融应用时。</p><p id="0830" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">是时候让开发人员认真对待这种风险了。尽管对于大型团队来说，这可能很难实现，但是没有理由不认真对待这一点并采取预防措施！</p></div></div>    
</body>
</html>