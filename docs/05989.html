<html>
<head>
<title>Phone Number Authentication With Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Firebase的电话号码认证</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/phone-number-authentication-with-firebase-5a28ec959dca?source=collection_archive---------6-----------------------#2020-08-24">https://betterprogramming.pub/phone-number-authentication-with-firebase-5a28ec959dca?source=collection_archive---------6-----------------------#2020-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c959" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用FirebaseAuth库对用户进行身份验证</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ec23c3d7c743ede0b46580f52cb43004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JC9ab00cecc3u4CC"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@cebbbinghaus?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯托弗·罗宾·艾宾浩斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="b749" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">介绍</h1><p id="f790" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">自从<a class="ae ky" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase </a>推出以来，我认为它将对移动开发产生重大影响。Firebase的制造商已经通过身份验证、实时数据库、机器学习、分析等等证明了这一点。</p><p id="de50" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在本文中，我们将学习如何使用FirebaseAuth库通过带有重发特性的OTP使用电话号码认证来认证用户。</p><p id="f65f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">让我们开始吧。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="06ca" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">为什么要进行电话号码认证？</h1><p id="9138" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">使用基于电话号码的身份验证有几个好处:</p><ul class=""><li id="217b" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated">避免重复账户:<strong class="ma iu"> </strong>当你根据一个唯一的电话号码创建一个账户时，很难创建多个账户。</li><li id="c237" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">安全性:通过电话号码验证，用户将没有任何密码，所以每次登录时，可以通过直接发送到他们手机的动态验证码来完成。</li><li id="a325" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated">用户体验:电话号码验证减少了用户登录时的摩擦，因为他们不必记住任何密码。</li></ul></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="124a" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">为什么选择Firebase？</h1><p id="c18a" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">实施电话号码认证包括向用户的手机发送SMS。为此，我们需要为短信服务付费。但是通过Firebase，我们可以免费发送短信。根据免费计划，Firebase每月提供10，000次验证。</p><p id="e988" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">除此之外，Firebase还在几个用例中为开发人员提供了帮助，例如实现实时数据库，通过社交媒体平台和电话号码认证用户，监控分析，发送通知等等。</p><p id="9960" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">前端开发人员可以在不了解服务器端代码的情况下完成所有这些工作。这是使用Firebase的核心优势之一。我们还可以在Android、IOS和web上无缝实现Firebase。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="fab2" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">综合</h1><p id="5742" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Android开发正在迅速采用Kotlin，因此在本文中，我们将通过Kotlin实现Firebase身份验证。要添加支持ktx的FirebaseAuth库，请在<code class="fe nn no np nq b">build.gradle</code>文件的模块级的Dependencies选项卡下添加下面一行:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="f349" class="nv lh it nq b gy nw nx l ny nz">implementation 'com.google.firebase:firebase-auth-ktx:19.3.1'</span></pre><p id="3a09" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">然后，我们需要在Firebase控制台的Authentication选项卡下启用电话号码登录方法。一旦你完成了，我们就可以开始编码了。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="f8c5" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">发送验证码</h1><p id="98e4" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">首先，我们需要创建一个回调监听器，以获得用户验证是否成功的通知。为此，我们需要使用<code class="fe nn no np nq b">PhoneAuthProvider.OnVerificationStateChangedCallbacks()</code>，如下图所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">回调监听器</p></figure><ul class=""><li id="d454" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated"><code class="fe nn no np nq b">onVerificationCompleted</code> : <strong class="ma iu"> </strong>该回调在两种情况下被调用:</li></ul><ol class=""><li id="0cb3" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt oc nf ng nh bi translated">在少数情况下，手机无需验证码即可自动验证。</li><li id="2198" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt oc nf ng nh bi translated">在某些设备上，Google Play服务会检测收到的短信，并在用户不采取任何行动的情况下调用验证过程。</li></ol><ul class=""><li id="d88f" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated"><code class="fe nn no np nq b">onVerificationFailed</code>:由于各种原因调用此回调:如果手机号码格式不正确，当应用程序超过短信限额，或当用户输入错误的验证码。</li><li id="867f" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><code class="fe nn no np nq b">onCodeSent</code>:当代码已经发送到用户的手机号码时，调用这个回调。</li></ul><ol class=""><li id="2016" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt oc nf ng nh bi translated"><code class="fe nn no np nq b">verificationId</code>:我们将把它作为回调函数中的一个参数，我们应该用它和验证码结合起来构建凭证。</li><li id="3bb4" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt oc nf ng nh bi translated"><code class="fe nn no np nq b">resendtoken</code>:与此同时，我们还会收到<code class="fe nn no np nq b">resendtoken</code>，用于稍后重新发送代码。</li></ol><p id="b933" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在我们已经创建了一个回调监听器，我们需要收集用户的手机号码并发送验证码。我们可以通过调用带有必要参数的<code class="fe nn no np nq b">PhoneAuthProvider</code>实例上的<code class="fe nn no np nq b">verifyPhoneNumber</code>函数来发送验证码。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">向用户手机发送验证短信的代码</p></figure><p id="7b57" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">Firebase不会发送多个验证短信，直到前一个请求超时。因此，我们需要在活动<code class="fe nn no np nq b">onSaveInstanceState</code>中维护一个标志，并从<code class="fe nn no np nq b">onRestoreInstanceState</code>中检索它，以避免任何混淆。</p><p id="ddba" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">当我们创建通用应用程序时，支持不同的语言至关重要。为了用特定的语言发送验证消息，我们可以在<code class="fe nn no np nq b">auth</code>实例上使用<code class="fe nn no np nq b">setLanguageCode</code>，如下所示:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="dda0" class="nv lh it nq b gy nw nx l ny nz">auth.<strong class="nq iu">setLanguageCode</strong>("fr")</span></pre></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="9a6a" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">创建PhoneAuthCredential</h1><p id="9dea" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">当用户输入验证码时，我们需要使用验证码和之前在<code class="fe nn no np nq b">onCodeSent</code>回调中收到的<code class="fe nn no np nq b">verificationid</code>创建一个<code class="fe nn no np nq b">PhoneAuthCredential</code>。</p><p id="b3d6" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">要创建<code class="fe nn no np nq b">PhoneAuthCredential</code>对象，调用<code class="fe nn no np nq b">PhoneAuthProvider.getCredential</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="b9ad" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">通过OTP验证</h1><p id="2d56" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">现在是验证手机号码的时候了。为此，我们需要使用<code class="fe nn no np nq b">signInWithCredential</code>。我们可以添加一个监听器来观察状态变化，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">OTP验证</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="4e7d" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">重新发送OTP</h1><p id="3144" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如果一切顺利，用户现在可能已经登录了。但是如果他们没有收到OTP呢？为了解决这个问题，开发人员通常在超时后启用重新发送代码按钮。</p><p id="199e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在，问题是如何用FirebaseAuth重新发送代码。同样的请求(<code class="fe nn no np nq b">verifyPhoneNumber</code>)，但是在这种情况下，我们需要添加在<code class="fe nn no np nq b">onCodeSent</code>回调中得到的<code class="fe nn no np nq b">resendToken</code>。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">重新发送OTP代码</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="6de2" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">结论</h1><p id="c4f2" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">要了解有关Firebase提示和新功能的更多信息，请阅读以下文章:</p><ul class=""><li id="006b" class="mz na it ma b mb mu me mv mh nb ml nc mp nd mt ne nf ng nh bi translated"><a class="ae ky" href="https://medium.com/@sgkantamani/firebase-a-perfect-database-for-your-app-c74ad19f98d0" rel="noopener">“Firebase——您的应用程序</a>的完美数据库”</li><li id="8847" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><a class="ae ky" href="https://medium.com/@sgkantamani/machine-learning-in-android-2e4cec40cc21" rel="noopener">“基于Firebase的Android中的机器学习</a>”</li></ul><p id="1e29" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">目前就这些。希望你学到了有用的东西。感谢阅读！</p></div></div>    
</body>
</html>