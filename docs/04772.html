<html>
<head>
<title>Follow the Law of Demeter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">遵循德米特里的法律</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/follow-the-law-of-demeter-bf9a683bb5fd?source=collection_archive---------11-----------------------#2020-05-07">https://betterprogramming.pub/follow-the-law-of-demeter-bf9a683bb5fd?source=collection_archive---------11-----------------------#2020-05-07</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="e804" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">毕竟这是法律</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/6b725bb8eea32d164b82bec4b5656dc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*drjFVpwnFqf9_8nc"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">塞巴斯蒂安·皮克勒在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="e3a1" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">介绍</h1><p id="6f11" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">也许你听说过得墨忒耳定律(LoD)。但是到底是什么呢？严格定义是这样的:</p><blockquote class="mo mp mq"><p id="122e" class="ls lt mr lu b lv ms jv lx ly mt jy ma mu mv md me mw mx mh mi my mz ml mm mn in bi translated"><a class="ae kz" href="http://haacked.com/archive/2009/07/14/law-of-demeter-dot-counting.aspx" rel="noopener ugc nofollow" target="_blank"> <strong class="lu iv">德米特里定律</strong> </a></p><p id="8afb" class="ls lt mr lu b lv ms jv lx ly mt jy ma mu mv md me mw mx mh mi my mz ml mm mn in bi translated">对象的方法只能调用以下方法:</p><p id="243b" class="ls lt mr lu b lv ms jv lx ly mt jy ma mu mv md me mw mx mh mi my mz ml mm mn in bi translated">物体本身。</p><p id="3ad1" class="ls lt mr lu b lv ms jv lx ly mt jy ma mu mv md me mw mx mh mi my mz ml mm mn in bi translated">方法的争论。</p><p id="f9ab" class="ls lt mr lu b lv ms jv lx ly mt jy ma mu mv md me mw mx mh mi my mz ml mm mn in bi translated">方法中创建的任何对象。</p><p id="04a8" class="ls lt mr lu b lv ms jv lx ly mt jy ma mu mv md me mw mx mh mi my mz ml mm mn in bi translated">对象的任何直接属性/字段。</p></blockquote></div><div class="ab cl na nb hy nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="in io ip iq ir"><h1 id="7d8b" class="la lb iu bd lc ld nh lf lg lh ni lj lk ka nj kb lm kd nk ke lo kg nl kh lq lr bi translated">现实世界</h1><p id="628b" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">这有点正式，所以这里有一个真实的例子:</p><p id="6c08" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">假设你走进一家商店。你买了一堆东西，总共是25美元。当你去付款的时候，你会怎么做？如果你是LoD的信徒，那你就掏出钱包，把25美元交给店员——就这些钱，别无其他。</p><p id="5e40" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">但是不，你是一个藐视法律的人，害怕你的钱包和其他人的深度耦合，因此你认为LoD是弱者的，所以你拿出你的钱包，把整个事情交给店员，让他决定如何付款。</p><p id="58b8" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">当然，你打算用现金支付，但是，相反，店员拿走了你的钱包，用信用卡支付，把你的借书证扔在地板上，通过消磁机运行你的<a class="ae kz" href="http://www.buy-more.net/" rel="noopener ugc nofollow" target="_blank"> BuyMore </a>忠诚卡，并且<a class="ae kz" href="http://finercut.com/wp-content/uploads/2011/02/reeses-stache.jpg" rel="noopener ugc nofollow" target="_blank">在你配偶的照片上画了胡子</a>。你付了钱，但是，哇，真是一团糟！</p><p id="fa46" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">简而言之，这就是为什么您应该遵循LoD。它的基本前提是你应该只交出(另一方面，只要求)你需要交出(或要求)的东西。东西应该用尽可能细的绳子连在一起。说明类之间的联系的文氏图应该有尽可能小的重叠。在这个例子中，你可能甚至不想让店员知道你<em class="mr">有</em>一个钱包，对吗？</p><p id="66f9" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">或者在另一个例子中，你不会把你的钱包给报童，或者让他在你的房子里到处找零钱。</p></div><div class="ab cl na nb hy nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="in io ip iq ir"><h1 id="f257" class="la lb iu bd lc ld nh lf lg lh ni lj lk ka nj kb lm kd nk ke lo kg nl kh lq lr bi translated">编码示例</h1><p id="7595" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">例如，在代码中，你可能有一个<code class="fe nm nn no np b">Transaction</code>类，它需要一种支付形式来完成。嘿，你看！<code class="fe nm nn no np b">Customer</code>类有不同的支付形式，所以你传递一个<code class="fe nm nn no np b">Customer</code>给<code class="fe nm nn no np b">Transaction</code>。当然，一开始一切都很好，因为你非常小心，你所做的就是从顾客那里拿到付款方式并使用它。会出什么问题呢？</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nq"><img src="../Images/965bcbe1b1b8154e889008a15a279fb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*UHXNN-aiOy13CBpH9qeNhg.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">如果你不遵循LoD会发生什么</p></figure><p id="b437" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">但是几个月过去了，那个(咳，咳)<em class="mr">没什么经验的</em>开发者走过来说，“嘿，看！这里有一个<code class="fe nm nn no np b">Customer</code>对象！我想我会把他的地址改在这里，而不是那边！”一切都失控了。</p><p id="23e8" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">很快，您就可以修复<code class="fe nm nn no np b">Transaction</code>类中的一个错误，并且<code class="fe nm nn no np b">Customer</code>数据会发生变化。您修复了一个<code class="fe nm nn no np b">Customer</code> bug，当您试图向数据库提交事务时，访问冲突开始激增。</p><p id="b5fe" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">接下来你知道的是，改变一个<code class="fe nm nn no np b">Customer</code>地址会给你的办公室清洁服务送去大笔现金奖励。不知不觉中，那个无辜地坐在<code class="fe nm nn no np b">Transaction</code>类中的小<code class="fe nm nn no np b">Customer</code>对象所造成的破坏永无止境。</p><p id="41dc" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">当然，正确的做法是简单地传递<code class="fe nm nn no np b">FormOfPayment</code>本身，或者更好的是，忘记<code class="fe nm nn no np b">FormOfPayment</code>而只以某种形式传递钱本身。这个想法是你的班级应该要求尽可能少，拒绝接受超过他们需要的。如果你有这样的代码…</p><p id="c811" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated"><code class="fe nm nn no np b">Transaction.Customer.FormOfPayment.CreditCardNumber.ProcessCreditCard();</code></p><p id="9afe" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">…也就是说，代码似乎深入到了类的层次结构中，那么你可能会因为违反了LoD而被警察开罚单。你在兔子洞里搜寻你应该一开始就要求的东西。</p><p id="965b" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">经典名言是“只和你的朋友说话，不要和陌生人说话。”“管好你自己的事情”也浮现在脑海里。</p></div><div class="ab cl na nb hy nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="in io ip iq ir"><h1 id="197b" class="la lb iu bd lc ld nh lf lg lh ni lj lk ka nj kb lm kd nk ke lo kg nl kh lq lr bi translated">更苛刻的条件</h1><p id="c78a" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">或者让我们用更直白的话来说:假设你写的每一门课都是一个干净整洁的房间，里面没有细菌、灰尘或任何其他令人作呕的东西——并且你打算保持这种状态。</p><p id="aef0" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">你会让一个因为新冠肺炎病毒打喷嚏而走过马厩的送货员走进你的房间，递给你一个包裹吗？</p><p id="1529" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">见鬼不！你要让他在进入之前淋浴，擦洗，消毒，净化，或者除虱。见鬼，你也许应该让这个家伙在你让他进来之前穿上某种<a class="ae kz" href="http://3.bp.blogspot.com/_XNPD380IpBQ/THMbcjQrm4I/AAAAAAAALWA/ym3nWv6bFNc/s1600/P307_23.jpg" rel="noopener ugc nofollow" target="_blank">生化服</a>。或者更好的是，根本不要让他进来，只让他通过门上的安全槽进入他想给你的东西。</p><p id="3204" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">这就是你应该如何对待任何想要混进当前类的外部类。</p></div><div class="ab cl na nb hy nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="in io ip iq ir"><h1 id="08cd" class="la lb iu bd lc ld nh lf lg lh ni lj lk ka nj kb lm kd nk ke lo kg nl kh lq lr bi translated">关于LoD的提示和想法</h1><p id="f8d8" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">LoD可以成为你的好朋友。以下是一些对您的代码有帮助的提示:</p><ul class=""><li id="b393" class="nr ns iu lu b lv ms ly mt mb nt mf nu mj nv mn nw nx ny nz bi translated">限制您的<code class="fe nm nn no np b">import</code>或<code class="fe nm nn no np b">using</code>子句中的项目数量。如果你有一个很长的项目列表，这是一个很强的迹象，事情是紧密联系在一起的。</li><li id="3e93" class="nr ns iu lu b lv oa ly ob mb oc mf od mj oe mn nw nx ny nz bi translated">如果您的语言允许使用友元类，就不要利用这种违背OOP的特性</li><li id="fe16" class="nr ns iu lu b lv oa ly ob mb oc mf od mj oe mn nw nx ny nz bi translated">如上所述，只要在一行中有一系列点状属性，就应该检查是否违反了LoD</li><li id="40cf" class="nr ns iu lu b lv oa ly ob mb oc mf od mj oe mn nw nx ny nz bi translated">每当您创建大量临时对象时，这可能意味着不必要的依赖</li><li id="105b" class="nr ns iu lu b lv oa ly ob mb oc mf od mj oe mn nw nx ny nz bi translated">检查您的构造函数。如果他们创建了很多东西或者将很多其他类作为参数，那么同样的事情也适用:太多耦合的可能性。</li></ul></div><div class="ab cl na nb hy nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="in io ip iq ir"><h1 id="299d" class="la lb iu bd lc ld nh lf lg lh ni lj lk ka nj kb lm kd nk ke lo kg nl kh lq lr bi translated">结论</h1><p id="3ca3" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">请注意，这些不是铁定的规则，而是供检查和考虑的建议。它不需要成为<a class="ae kz" href="http://haacked.com/archive/2009/07/14/law-of-demeter-dot-counting.aspx" rel="noopener ugc nofollow" target="_blank">一个点数练习</a>。这个想法是为了减少耦合，从而限制任何一个修改对整个系统的损害。</p><p id="6967" class="pw-post-body-paragraph ls lt iu lu b lv ms jv lx ly mt jy ma mb mv md me mf mx mh mi mj mz ml mm mn in bi translated">遵循LoD是创建干净、易于维护的代码的关键。</p></div></div>    
</body>
</html>