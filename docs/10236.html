<html>
<head>
<title>Create Flexible Components in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Swift中创建灵活的组件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-flexible-components-in-swift-dc50a1742bb3?source=collection_archive---------9-----------------------#2021-12-15">https://betterprogramming.pub/create-flexible-components-in-swift-dc50a1742bb3?source=collection_archive---------9-----------------------#2021-12-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ae2c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这些可以用视图模型更新</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/532673ada8e88531b06b6c8f534e2f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*64Ca6GgsAkEbWMhd_ykVDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7400" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你知道吗，我想创建可重用的组件。你知道，在你的生产应用程序中，无论你在哪里使用它们，你都将使用一个有几个状态的可靠的<code class="fe lu lv lw lx b">UIButton</code>子类。</p><p id="5c96" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，在深入研究一个特定的实现之前，我该如何构建组件呢？</p><p id="9edd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我创建一个<code class="fe lu lv lw lx b">UILabel</code>作为一个很好的例子会怎么样？</p><p id="93db" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你在看那个调查的结果！</p><p id="17fd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想看这个的视频版本，那就来吧！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="24ac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">难度:初级|简单| <strong class="la iu">普通</strong> |挑战</p><p id="a393" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文是使用Xcode 12.5和Swift 5.4开发的</p><h2 id="8549" class="mb mc it bd md me mf dn mg mh mi dp mj lh mk ml mm ll mn mo mp lp mq mr ms mt bi translated">先决条件:</h2><ul class=""><li id="0235" class="mu mv it la b lb mw le mx lh my ll mz lp na lt nb nc nd ne bi translated">您应该知道如何在Swift中制作一个<a class="ae nf" href="https://medium.com/swlh/your-first-ios-application-using-xcode-9983cf6efb71" rel="noopener">单视图应用程序</a>。</li><li id="c790" class="mu mv it la b lb ng le nh lh ni ll nj lp nk lt nb nc nd ne bi translated">需要熟悉以下概念:<a class="ae nf" href="https://medium.com/macoclock/type-alias-for-readability-in-swift-b5d60de4aee1" rel="noopener">类型别名</a>，一些<a class="ae nf" href="https://stevenpcurtis.medium.com/core-concepts-of-combine-71d6b13d43e2" rel="noopener">组合</a>，<a class="ae nf" href="https://stevenpcurtis.medium.com/extensions-in-swift-68cfb635688e" rel="noopener">扩展</a>，<code class="fe lu lv lw lx b"><a class="ae nf" href="https://stevenpcurtis.medium.com/what-is-intrinsiccontentsize-anyway-c77f2bcd30d7" rel="noopener">intrinsicContentSize</a></code>，<a class="ae nf" href="https://stevenpcurtis.medium.com/public-getters-and-private-setters-in-swift-4f90d90bb05f" rel="noopener">获取器和设置器</a>，<a class="ae nf" href="https://medium.com/swlh/clickable-link-on-a-swift-label-or-textview-98bbb067451d" rel="noopener">可点击链接</a>，当然还有<a class="ae nf" href="https://stevenpcurtis.medium.com/mvvm-in-swift-19ba3f87ed45" rel="noopener"> MVVM </a></li></ul><h2 id="4ff1" class="mb mc it bd md me mf dn mg mh mi dp mj lh mk ml mm ll mn mo mp lp mq mr ms mt bi translated">关键词和术语</h2><p id="0a0f" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">模型:存储数据和操作数据的逻辑的地方。也许模型对象或网络代码存储在这里。把这看作是应用程序的本质。</p><h1 id="cc31" class="no mc it bd md np nq nr mg ns nt nu mj jz nv ka mm kc nw kd mp kf nx kg ms ny bi translated">整体观点</h1><h2 id="9bee" class="mb mc it bd md me mf dn mg mh mi dp mj lh mk ml mm ll mn mo mp lp mq mr ms mt bi translated"><strong class="ak">标准</strong></h2><ul class=""><li id="5e09" class="mu mv it la b lb mw le mx lh my ll mz lp na lt nb nc nd ne bi translated">创建一个简单的<code class="fe lu lv lw lx b">UILabel</code>子类，它也可以处理链接</li><li id="f6bc" class="mu mv it la b lb ng le nh lh ni ll nj lp nk lt nb nc nd ne bi translated">在视图模型中初始化组件视图模型</li><li id="a6f5" class="mu mv it la b lb ng le nh lh ni ll nj lp nk lt nb nc nd ne bi translated">将ViewModel传递回视图，以便更新它</li></ul><h2 id="c3cc" class="mb mc it bd md me mf dn mg mh mi dp mj lh mk ml mm ll mn mo mp lp mq mr ms mt bi translated"><strong class="ak">描述</strong></h2><p id="4641" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">我将为我的<code class="fe lu lv lw lx b">Label</code>创建一个模型，它将提供我的<code class="fe lu lv lw lx b">Label</code>用来显示文本的信息。与应用程序中的模型对象非常相似，它提供了视图显示所需的数据。</p><p id="d2e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">视图本身将出现在viewController中(这很幸运，因为viewController应该控制视图)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz ma l"/></div></figure><p id="def7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，我们将标签和标签模型都呈现到视图控制器中(实际上在视图控制器的<code class="fe lu lv lw lx b">viewDidLoad</code>函数中)，这样我们就可以使用以前的视图模型来更新它，而不必在视图控制器中保留<code class="fe lu lv lw lx b">viewmodel</code>——这很好！</p><p id="5da9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们能做到这一点吗？好吧，让我们意识到，如果我不知道这已经开始工作了，我是不会发表这篇文章的！</p><h1 id="f885" class="no mc it bd md np nq nr mg ns nt nu mj jz nv ka mm kc nw kd mp kf nx kg ms ny bi translated">实施</h1><p id="e531" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">这个模型将会浮出水面，和我们的视图控制器中的视图一起。</p><p id="d433" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此处复制了该模型，以下是帮助您解决问题的完整内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz ma l"/></div></figure><p id="34b6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">标签本身是<code class="fe lu lv lw lx b">UILabel</code>的子类，也许最重要的部分是我们有一个用模型更新<code class="fe lu lv lw lx b">Label</code>的函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz ma l"/></div></figure><p id="1caa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在这里有一些细节和一个<a class="ae nf" href="https://medium.com/swlh/clickable-link-on-a-swift-label-or-textview-98bbb067451d" rel="noopener">可点击的链接</a>，你可以跳过(反正都是在一个扩展中)，仍然可以完全理解这段代码。然而，我也覆盖了<code class="fe lu lv lw lx b">intrinsicContentSize</code>来设置接收视图的自然大小。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz ma l"/></div></figure><p id="32a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">实际上，我们正在将大小传递给超类，如果没有文本，我们将返回一个零边界框。</p><p id="ed93" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们应该什么时候初始化这个<code class="fe lu lv lw lx b">viewmodel</code>，在哪里初始化？我们应该在我们的视图模型中这样做，并在视图控制器点击了<code class="fe lu lv lw lx b">viewDidLoad()</code>之后，当<code class="fe lu lv lw lx b">viewcontroller</code>准备好了的时候初始化我们的<code class="fe lu lv lw lx b">labelModel</code>。</p><p id="6a91" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，我需要知道<code class="fe lu lv lw lx b">UIViewController</code>的生命周期。我可以把这个作为<code class="fe lu lv lw lx b">UIViewController</code>的扩展来写。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz ma l"/></div></figure><p id="5cb5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将需要监听标签中的变化，我们可以使用Combine的<code class="fe lu lv lw lx b"><a class="ae nf" href="https://stevenpcurtis.medium.com/core-concepts-of-combine-71d6b13d43e2" rel="noopener">@Published</a></code>来做到这一点，然后将它添加到视图模型中，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz ma l"/></div></figure><h1 id="c577" class="no mc it bd md np nq nr mg ns nt nu mj jz nv ka mm kc nw kd mp kf nx kg ms ny bi translated">所以…</h1><p id="e882" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">唷。那是相当多的东西。让我们看完整的代码！</p><h1 id="7476" class="no mc it bd md np nq nr mg ns nt nu mj jz nv ka mm kc nw kd mp kf nx kg ms ny bi translated">代码</h1><h2 id="f5e3" class="mb mc it bd md me mf dn mg mh mi dp mj lh mk ml mm ll mn mo mp lp mq mr ms mt bi translated">标签</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz ma l"/></div></figure><h2 id="3ff2" class="mb mc it bd md me mf dn mg mh mi dp mj lh mk ml mm ll mn mo mp lp mq mr ms mt bi translated">标签模型</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz ma l"/></div></figure><h2 id="d213" class="mb mc it bd md me mf dn mg mh mi dp mj lh mk ml mm ll mn mo mp lp mq mr ms mt bi translated">发布者扩展</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz ma l"/></div></figure><h2 id="66e6" class="mb mc it bd md me mf dn mg mh mi dp mj lh mk ml mm ll mn mo mp lp mq mr ms mt bi translated">UIViewController上的生命周期状态扩展</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz ma l"/></div></figure><h1 id="4dbe" class="no mc it bd md np nq nr mg ns nt nu mj jz nv ka mm kc nw kd mp kf nx kg ms ny bi translated">回购</h1><p id="d967" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">我很乐意让你看一看回购协议的全文。</p><h1 id="8e7d" class="no mc it bd md np nq nr mg ns nt nu mj jz nv ka mm kc nw kd mp kf nx kg ms ny bi translated">结论</h1><p id="a50f" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">这是您可能希望考虑在项目中创建组件的一种方式。这是唯一的方法吗？它不是，但它肯定是这样做的一种方法，我很乐意听到你对此的想法，最好是在<a class="ae nf" href="https://twitter.com/stevenpcurtis" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上，因为你可以保证我会在那里看到它。</p></div></div>    
</body>
</html>