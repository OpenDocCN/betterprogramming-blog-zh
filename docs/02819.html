<html>
<head>
<title>Tips and Tricks for Handling Logging Files in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python处理日志文件的技巧和诀窍</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/tips-and-tricks-for-handling-logging-files-in-python-b48be3d553ad?source=collection_archive---------2-----------------------#2020-01-03">https://betterprogramming.pub/tips-and-tricks-for-handling-logging-files-in-python-b48be3d553ad?source=collection_archive---------2-----------------------#2020-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fea4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用内置日志模块生成调试用的日志文件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ee5650f63b5c2f91a1843d3a1fee030d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ikkiar2teCizr06fDxN7ig.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@iammrcup?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">杯先生/杨奇煜·巴勒</a>在<a class="ae ky" href="https://unsplash.com/s/photos/file?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="f238" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过阅读这篇文章，你将学会实现你自己的定时日志系统，为你的<a class="ae ky" href="http://flask.palletsprojects.com/" rel="noopener ugc nofollow" target="_blank"> Flask </a>或<a class="ae ky" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>服务器输出每日日志文件。</p><p id="31d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拥有一个日志系统对于调试来说是非常有益的。您肯定希望生成每日日志文件来跟踪错误，以及收集数据，如使用情况和经常调用的API。</p><p id="f111" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用名为<em class="lv">日志</em>的内置模块，这是一个强大的模块。这个模块的主要优点之一是它是一个标准的库模块，这意味着所有的Python模块都可以参与日志记录。</p><p id="77ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程有三个部分。</p><ol class=""><li id="9f3b" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">基本用法</li><li id="781c" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">高级组件</li><li id="0f53" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">结论</li></ol><p id="7348" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始吧。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="ad17" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">1.基本用法</h1><h2 id="5e4c" class="nj ms it bd mt nk nl dn mx nm nn dp nb li no np nd lm nq nr nf lq ns nt nh nu bi translated">导入</h2><p id="f258" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">您需要先导入该模块，然后才能使用它。添加以下导入语句:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="e62d" class="nj ms it ob b gy of og l oh oi">import logging</span></pre><p id="0a9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您可以通过利用基于严重性级别的可用功能来记录消息。</p><h2 id="cf1a" class="nj ms it bd mt nk nl dn mx nm nn dp nb li no np nd lm nq nr nf lq ns nt nh nu bi translated">日志记录级别</h2><p id="ec60" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">总共提供了五个级别:</p><ul class=""><li id="bc73" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu oj mc md me bi translated"><code class="fe ok ol om ob b">DEBUG</code> —详细信息，通常仅在诊断问题时感兴趣。</li><li id="539e" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu oj mc md me bi translated"><code class="fe ok ol om ob b">INFO</code> —确认事情按预期运行。</li><li id="286f" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu oj mc md me bi translated"><code class="fe ok ol om ob b">WARNING</code> —表示发生了意想不到的事情，或者预示着不久的将来会出现一些问题(例如，“磁盘空间不足”)。该软件仍按预期工作。</li><li id="1f6e" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu oj mc md me bi translated"><code class="fe ok ol om ob b">ERROR</code> —由于更严重的问题，软件无法执行某些功能。</li><li id="91e2" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu oj mc md me bi translated"><code class="fe ok ol om ob b">CRITICAL</code> —严重错误，表明程序本身可能无法继续运行。</li></ul><p id="6ac0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以按如下方式调用它们:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="bbd1" class="nj ms it ob b gy of og l oh oi">logging.debug('Debug')<br/>logging.info('Info')<br/>logging.warning('Warning')<br/>logging.error('Error')<br/>logging.critical('Critical')</span></pre><p id="3e47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过设置一个简单的Flask服务器并运行日志消息来测试它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="5805" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将上面的代码保存在一个名为<code class="fe ok ol om ob b">log_test.py</code>的文件中。打开一个终端，将其指向目录，并通过以下命令运行它:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="b544" class="nj ms it ob b gy of og l oh oi">python log_test.py</span></pre><p id="fbb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开浏览器并输入<code class="fe ok ol om ob b">localhost:5000</code>，您应该能够在控制台中看到<code class="fe ok ol om ob b">Hello world</code>响应和以下输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/419e5636ff1820572be0147e8cab89a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LTYkX3CjgeBzM1p-Y1jvZA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3f8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您会注意到<code class="fe ok ol om ob b">“Called hello_world”</code> <strong class="lb iu"> </strong>没有被记录。这主要是因为日志记录级别已经默认为警告及以上。不会记录调试和信息消息。</p><p id="e99b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在初始化期间，我们可以通过<code class="fe ok ol om ob b">basicConfig</code>函数轻松地更改日志级别。让我们通过在<code class="fe ok ol om ob b">app.route</code>装饰器的正上方和<code class="fe ok ol om ob b">app = Flask(__name__) initialization</code>的正下方添加以下代码来测试它。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="6f69" class="nj ms it ob b gy of og l oh oi">logging.basicConfig(level=logging.INFO)</span></pre><p id="2c5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该能够看到以下输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/7c302f2408f9c625704aab619a2354df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SKXGoyrsQIVCOFGM-fFSOg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="00a9" class="nj ms it bd mt nk nl dn mx nm nn dp nb li no np nd lm nq nr nf lq ns nt nh nu bi translated">通过basicConfig初始化</h2><p id="7910" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated"><code class="fe ok ol om ob b">basicConfig</code>函数还接受一个文件名参数，该参数指示它应该使用一个<code class="fe ok ol om ob b">FileHandler</code>将它记录到一个文件中，而不是控制台中。</p><p id="298a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个名为<code class="fe ok ol om ob b">log</code>的新目录，并将<code class="fe ok ol om ob b">basicConfig</code>代码修改如下:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="3a41" class="nj ms it ob b gy of og l oh oi">logging.basicConfig(filename='log/flask_server.log' ,level=logging.INFO)</span></pre><p id="1ab2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在网络浏览器中访问<code class="fe ok ol om ob b">localhost:5000</code>后，将会生成一个名为<code class="fe ok ol om ob b">flask_server.log</code>的文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/1202980f021bb40a42e5e4989dc62ee7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t7q5BLPANEgj-5PKBJnrow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c268" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">日志记录系统会将日志消息附加到文件中，以便后续调用该URL。</p><h2 id="9f88" class="nj ms it bd mt nk nl dn mx nm nn dp nb li no np nd lm nq nr nf lq ns nt nh nu bi translated">可变数据</h2><p id="26f3" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">您可以使用格式字符串来记录变量数据。示例如下:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="cc80" class="nj ms it ob b gy of og l oh oi">data = 'hello_world'<br/>logging.error('An exception occurred at %s', data)</span></pre><h2 id="2f1a" class="nj ms it bd mt nk nl dn mx nm nn dp nb li no np nd lm nq nr nf lq ns nt nh nu bi translated">格式</h2><p id="6cb9" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">您可以根据自己的喜好指定输出的格式。下面的示例将记录时间、消息的严重级别以及最后的输出消息。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="dd08" class="nj ms it ob b gy of og l oh oi">logging.basicConfig(filename='log/flask_server.log' ,level=logging.INFO, format="%(asctime)s - %(levelname)s - %(message)s")</span></pre><p id="3d6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该得到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/d5c62baaedf8e36d0845b973e55ed335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qx9EXL2EogWYX0Ja2HGtew.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2dd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一节中，我们将探索日志模块的另外两个主要组件。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="fa86" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">2.高级组件</h1><p id="feff" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">上一节中的函数是logger组件的一部分，它公开了应用程序代码直接使用的接口。除了记录器组件之外，还有另外两个主要组件:</p><ul class=""><li id="94a0" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu oj mc md me bi translated"><code class="fe ok ol om ob b">Handlers</code> —将日志记录(由记录器创建)发送到适当的目的地。</li><li id="3b64" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu oj mc md me bi translated"><code class="fe ok ol om ob b">Formatters</code> —指定日志记录在最终输出中的布局。</li></ul><p id="2547" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个组件是<code class="fe ok ol om ob b">logger</code>组件配置的一部分。</p><p id="40f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以利用这两个组件来实现一个高级日志记录系统，比如根据文件大小、容量或日期在不同的文件之间轮换。</p><p id="c4bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过复制相同的功能来测试它，但是这一次，同时使用<code class="fe ok ol om ob b">Handler</code>和<code class="fe ok ol om ob b">Formatter</code>组件。</p><h2 id="c0ee" class="nj ms it bd mt nk nl dn mx nm nn dp nb li no np nd lm nq nr nf lq ns nt nh nu bi translated">格式程序</h2><p id="0834" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">另一方面，formatter接受一个简单的样式字符串，该字符串决定消息的格式。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="bc1f" class="nj ms it ob b gy of og l oh oi">formatter = logging.Formatter("%(asctime)s - %(levelname)s - %(message)s")</span></pre><h2 id="2e4d" class="nj ms it bd mt nk nl dn mx nm nn dp nb li no np nd lm nq nr nf lq ns nt nh nu bi translated">处理者</h2><p id="e5a5" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">到目前为止，我们测试的是<code class="fe ok ol om ob b">StreamHandler</code>和<code class="fe ok ol om ob b">FileHandler</code>。除了默认处理程序之外，该模块还附带了以下处理程序:</p><ol class=""><li id="8b6e" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.StreamHandler" rel="noopener ugc nofollow" target="_blank">StreamHandler</a></code>实例向流(类似文件的对象)发送消息。</li><li id="ce01" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.FileHandler" rel="noopener ugc nofollow" target="_blank">FileHandler</a></code>实例向磁盘文件发送消息。</li><li id="5ea7" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.handlers.BaseRotatingHandler" rel="noopener ugc nofollow" target="_blank">BaseRotatingHandler</a></code>是在某一点轮换日志文件的处理程序的基类。它并不意味着被直接实例化。而是用<code class="fe ok ol om ob b">RotatingFileHandler</code>或者<code class="fe ok ol om ob b">TimedRotatingFileHandler</code>。</li><li id="6774" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.handlers.RotatingFileHandler" rel="noopener ugc nofollow" target="_blank">RotatingFileHandler</a></code>实例将消息发送到磁盘文件，支持最大日志文件大小和日志文件轮换。</li><li id="edd5" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.handlers.TimedRotatingFileHandler" rel="noopener ugc nofollow" target="_blank">TimedRotatingFileHandler</a></code>实例将消息发送到磁盘文件，以一定的时间间隔旋转日志文件。</li><li id="4f63" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.handlers.SocketHandler" rel="noopener ugc nofollow" target="_blank">SocketHandler</a></code>实例向TCP/IP套接字发送消息。从3.4开始，还支持Unix域套接字。</li><li id="54e5" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.handlers.DatagramHandler" rel="noopener ugc nofollow" target="_blank">DatagramHandler</a></code>实例向UDP套接字发送消息。从3.4开始，还支持Unix域套接字。</li><li id="2947" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.handlers.SMTPHandler" rel="noopener ugc nofollow" target="_blank">SMTPHandler</a></code>实例向指定的电子邮件地址发送消息。</li><li id="d848" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.handlers.SysLogHandler" rel="noopener ugc nofollow" target="_blank">SysLogHandler</a></code>实例向Unix系统日志守护程序发送消息，可能在远程机器上。</li><li id="1042" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.handlers.NTEventLogHandler" rel="noopener ugc nofollow" target="_blank">NTEventLogHandler</a></code>实例向Windows NT/2000/XP事件日志发送消息。</li><li id="3afc" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.handlers.MemoryHandler" rel="noopener ugc nofollow" target="_blank">MemoryHandler</a></code>实例将消息发送到内存中的缓冲区，只要满足特定条件，缓冲区就会被刷新。</li><li id="9335" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.handlers.HTTPHandler" rel="noopener ugc nofollow" target="_blank">HTTPHandler</a></code>实例使用<code class="fe ok ol om ob b">GET</code>或<code class="fe ok ol om ob b">POST</code>语义向HTTP服务器发送消息。</li><li id="f566" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.handlers.WatchedFileHandler" rel="noopener ugc nofollow" target="_blank">WatchedFileHandler</a></code>实例监视它们正在记录的文件。如果文件更改，它将关闭并使用文件名重新打开。这个处理程序只在类似Unix的系统上有用；Windows不支持使用的底层机制。</li><li id="299a" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.handlers.QueueHandler" rel="noopener ugc nofollow" target="_blank">QueueHandler</a></code>实例将消息发送到队列，例如在队列或多处理模块中实现的那些。</li><li id="1a1e" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><code class="fe ok ol om ob b"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#logging.NullHandler" rel="noopener ugc nofollow" target="_blank">NullHandler</a></code>实例不处理错误消息。它们由想要使用日志记录的库开发人员使用，但是想要避免在库用户没有配置日志记录的情况下显示的<code class="fe ok ol om ob b">No handlers could be found for logger XXX</code>消息。</li></ol><p id="e44a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">初始化后，可以使用<em class="lv">为处理程序设置格式化程序</em>。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="21d7" class="nj ms it ob b gy of og l oh oi">handler = logging.FileHandler(filename='log/flask_server.log')<br/>handler.setFormatter(formatter)</span></pre><h2 id="00f8" class="nj ms it bd mt nk nl dn mx nm nn dp nb li no np nd lm nq nr nf lq ns nt nh nu bi translated">记录器</h2><p id="60f2" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">记录器允许我们设置日志记录级别以及添加或删除处理程序。以下示例将日志记录级别设置为<code class="fe ok ol om ob b">INFO</code>，将处理程序设置为我们之前定义的<code class="fe ok ol om ob b">FileHandler</code>。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="8933" class="nj ms it ob b gy of og l oh oi">logger = logging.getLogger()<br/>logger.setLevel(logging.INFO)<br/>logger.addHandler(handler)</span></pre><p id="a5ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于后续的日志调用，你必须使用<code class="fe ok ol om ob b">logger.info</code>而不是<code class="fe ok ol om ob b">logging.info</code>。</p><p id="9be6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面我们来看看完整的代码，以供参考。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="f181" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管同一个实现的完整代码与前面通过<code class="fe ok ol om ob b">basicConfig</code>调用的部分相比冗长了许多，但是拥有这样一个结构的好处是允许我们轻松地实现我们想要的日志记录系统。</p><p id="d6a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看下面的例子，它利用<code class="fe ok ol om ob b">TimedRotatingFileHandler</code>来记录日常文件。</p><h2 id="5029" class="nj ms it bd mt nk nl dn mx nm nn dp nb li no np nd lm nq nr nf lq ns nt nh nu bi translated">TimedRotatingFileHandler</h2><p id="12f3" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">我们将在顶部导入模块，以提醒这个Flask应用程序使用了<code class="fe ok ol om ob b">TimedRotatingFileHandler</code>。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="6ee4" class="nj ms it ob b gy of og l oh oi">import logging<br/>from logging.handlers import TimedRotatingFileHandler</span></pre><p id="1f9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在初始化期间，您可以确定<code class="fe ok ol om ob b">when</code>参数。输入字符串不区分大小写。</p><ul class=""><li id="301e" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu oj mc md me bi translated"><code class="fe ok ol om ob b">S</code> —秒</li><li id="3366" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu oj mc md me bi translated"><code class="fe ok ol om ob b">M</code> —分钟</li><li id="1f7e" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu oj mc md me bi translated"><code class="fe ok ol om ob b">H</code> —小时</li><li id="b834" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu oj mc md me bi translated"><code class="fe ok ol om ob b">D</code> —天数</li><li id="485f" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu oj mc md me bi translated"><code class="fe ok ol om ob b">W0-W6</code> —工作日(0 =星期一)</li><li id="80e8" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu oj mc md me bi translated"><code class="fe ok ol om ob b">midnight</code> —午夜滚动</li></ul><p id="e0a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下示例将在五秒钟后将日志记录到一个新文件中。只有存在日志事件时，才会生成文件。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="97a0" class="nj ms it ob b gy of og l oh oi">handler = TimedRotatingFileHandler('log/flask_server.log', when="s", interval=5)<br/>handler.suffix = "%Y-%m-%d_%H-%M-%S"</span></pre><p id="cbe1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ok ol om ob b">suffix</code>将作为生成新文件时的参考。它将始终将日志数据存储在<code class="fe ok ol om ob b">flask_server.log</code>中。一旦满足条件，当前文件将根据后缀进行重命名。</p><p id="88cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您发送垃圾邮件<code class="fe ok ol om ob b">localhost:5000</code>时，您将获得以下输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/9fd6b5cbd4ace176cfff3d4285e9e0de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6B-XTBR8I68tQSwLLUqj_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b619" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下代码是生成每日日志文件的完整代码。只需将参数设置为<code class="fe ok ol om ob b">midnight</code>，间隔为<code class="fe ok ol om ob b">1</code>。</p><p id="761a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您记录的是unicode或另一种编码形式，请在初始化时设置它。<code class="fe ok ol om ob b">encoding</code>参数接受字符串输入，如<code class="fe ok ol om ob b">utf8</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="8bd6" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">3.结论</h1><p id="81b4" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">让我们回顾一下今天所学的内容。</p><p id="0fda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们从探索日志模块的基本功能开始。我们学会了通过<code class="fe ok ol om ob b">basicConfig</code>函数将日志数据输出到文件中。</p><p id="0fec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们继续讨论两个主要组件，即<code class="fe ok ol om ob b">Formatter</code>和<code class="fe ok ol om ob b">Handler</code>。我们用它们实现了相同的功能，并将它们公开给模块中可用的其他处理程序。</p><p id="04e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们还测试了用于每日日志系统的<code class="fe ok ol om ob b">TimedRotatingFileHandler</code>。您可以自行测试其他处理程序。</p><p id="c796" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读，下次教程再见。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="5865" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">参考</h1><ol class=""><li id="e26d" class="lw lx it lb b lc nv lf nw li ou lm ov lq ow lu mb mc md me bi translated"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.html" rel="noopener ugc nofollow" target="_blank">登录Python文档</a>。</li><li id="2504" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><a class="ae ky" href="https://docs.python.org/3.8/howto/logging.html#logging-basic-tutorial" rel="noopener ugc nofollow" target="_blank">伐木，基础教程</a></li><li id="af74" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><a class="ae ky" href="https://docs.python.org/3.8/howto/logging.html#logging-advanced-tutorial" rel="noopener ugc nofollow" target="_blank">伐木高级教程</a></li><li id="8bb5" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><a class="ae ky" href="https://docs.python.org/3.8/library/logging.handlers.html#module-logging.handlers" rel="noopener ugc nofollow" target="_blank"> Python文档:模块日志处理程序</a></li></ol></div></div>    
</body>
</html>