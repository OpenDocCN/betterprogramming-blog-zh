<html>
<head>
<title>Overcoming List Performance Problems In React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">克服“反应自然”中的列表性能问题</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/overcoming-list-performance-problems-in-react-native-fad40d87b14f?source=collection_archive---------2-----------------------#2022-04-16">https://betterprogramming.pub/overcoming-list-performance-problems-in-react-native-fad40d87b14f?source=collection_archive---------2-----------------------#2022-04-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="901e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用我自己的定制NPM套餐</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/50e42a8a085b9a505bdf8d15cbbc12a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UFNZ6-l8-XJOrnYNbyvOpQ.jpeg"/></div></div></figure><p id="ba82" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在React Native中处理复杂的屏幕时，很容易出现性能问题。大列表可能是性能问题最常见的原因，甚至FlatList组件也不能平滑地处理包含成千上万项的列表。</p><p id="ce0b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有一些库可以帮助处理大的列表，它们有很好的性能。例如:</p><ul class=""><li id="9fe1" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><a class="ae lw" href="https://www.npmjs.com/package/react-native-big-list" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/react-native-big-list</a></li><li id="54f3" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" href="https://www.npmjs.com/package/react-native-largelist" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/react-native-largelist</a></li><li id="85f7" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" href="https://www.npmjs.com/package/recyclerlistview" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/recyclerlistview</a></li></ul><p id="dff1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是在我上一个项目中尝试了这些选项后，面对一些问题，我决定研究一个新的解决方案，叫做<a class="ae lw" href="https://www.npmjs.com/package/react-native-speedy-list" rel="noopener ugc nofollow" target="_blank">快速列表</a>。</p><h1 id="d732" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">快速列表组件</h1><p id="f24f" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated"><a class="ae lw" href="https://www.npmjs.com/package/react-native-speedy-list" rel="noopener ugc nofollow" target="_blank">快速列表</a>背后的想法实际上与<code class="fe mz na nb nc b"><a class="ae lw" href="https://www.npmjs.com/package/recyclerlistview" rel="noopener ugc nofollow" target="_blank">RecyclerListView</a></code>相同，一旦用户向下滚动列表，它会重用列表中的现有项目来呈现新项目。</p><p id="1ae1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">假设您的屏幕高度为1920像素，每个列表元素的高度为192像素，因此20个项目就足以容纳两倍于整个屏幕的大小。一旦您开始滚动列表，第一项将隐藏在顶部，用户看不到。<a class="ae lw" href="https://www.npmjs.com/package/react-native-speedy-list" rel="noopener ugc nofollow" target="_blank">快速列表</a>将利用这一点，将该隐藏项目重新定位在位置21，并将其内容更改为项目21的内容，这比每次滚动屏幕时呈现新组件更快。</p><p id="313a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">另一个很好的改进是在第一次渲染时。代替一次渲染20个元素，Speedy List将以可配置的批次数量渲染这些元素，这使得导航更加柔和。</p><h1 id="8ba0" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">安装和使用</h1><p id="12c0" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">您可以使用下面的命令将<a class="ae lw" href="https://www.npmjs.com/package/react-native-speedy-list" rel="noopener ugc nofollow" target="_blank">快速列表</a>添加到您的反应原生项目中:</p><pre class="kg kh ki kj gt nd nc ne nf aw ng bi"><span id="39fa" class="nh md iq nc b gy ni nj l nk nl">yarn add react-native-speedy-list </span></pre><p id="0a29" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">或者</p><pre class="kg kh ki kj gt nd nc ne nf aw ng bi"><span id="badd" class="nh md iq nc b gy ni nj l nk nl">npm install --save react-native-speedy-list</span></pre><p id="9783" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面你可以看到一个<a class="ae lw" href="https://www.npmjs.com/package/react-native-speedy-list" rel="noopener ugc nofollow" target="_blank">快速列表</a>组件用法的小例子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><blockquote class="no np nq"><p id="7f65" class="kr ks nr kt b ku kv jr kw kx ky ju kz ns lb lc ld nt lf lg lh nu lj lk ll lm ij bi translated">这个例子是用TypeScript写的，所以你可能会认为这个接口<strong class="kt ir">用户</strong>是在某处声明的，其他类型来自Speedy List。</p></blockquote><p id="d617" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">像任何其他列表组件一样，<a class="ae lw" href="https://www.npmjs.com/package/react-native-speedy-list" rel="noopener ugc nofollow" target="_blank"> Speedy List </a>需要一个要呈现的项目列表，一个呈现方法，以及唯一标识每个项目的方法。除了这些通常的属性，列表还需要通过属性<code class="fe mz na nb nc b">itemHeight</code>知道每个项目的高度，这有助于布局计算和回收周期。</p><p id="3179" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要记住的一个重要细节是，这个组件的所有性能都来自于回收已经渲染的组件的能力，所以你必须尝试在项目渲染器方法中始终保持相同的组件树，并且还要避免使用key prop，因为它已经由<a class="ae lw" href="https://www.npmjs.com/package/react-native-speedy-list" rel="noopener ugc nofollow" target="_blank"> Speedy List </a>管理。</p><h1 id="4837" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">动态项目高度</h1><p id="1f7e" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">固定的项目高度可以很好地处理简单列表，并带来很好的性能。</p><p id="d998" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是对于更复杂的布局，您可能需要根据一些逻辑来设置每个项目的高度。通过使用函数而不是静态整数，可以很容易地将其存档，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="067d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意，也可以通过函数动态设置item key属性。</p><h1 id="dd34" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">高级道具</h1><p id="2d27" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated"><a class="ae lw" href="https://www.npmjs.com/package/react-native-speedy-list" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">极速清单</strong> </a>还有一套有趣的道具来控制回收过程:</p><pre class="kg kh ki kj gt nd nc ne nf aw ng bi"><span id="8a92" class="nh md iq nc b gy ni nj l nk nl">// Used to detect when an item changes<br/>itemEquals (a: T, b: T) =&gt; boolean</span><span id="edb4" class="nh md iq nc b gy nv nj l nk nl">// Batch size for the very first render. <br/>// A small value may show your screen layout faster, <br/>// but the user might see the items being rendered.<br/>initialBatchSize: number</span><span id="6a6d" class="nh md iq nc b gy nv nj l nk nl">// Amount of recyclable items to render. <br/>// Try to use a value greater enough to fill the screen height.<br/>recyclableItemsCount: number</span><span id="81f9" class="nh md iq nc b gy nv nj l nk nl">// Interval in milliseconds between list updates.<br/>recyclingDelay: number</span></pre><p id="bbeb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">尝试这些值，找到最适合您需求的配置。您可以在这里查看所有可用的房产:<a class="ae lw" href="https://github.com/FSPinho/react-native-speedy-list" rel="noopener ugc nofollow" target="_blank">https://github.com/FSPinho/react-native-speedy-list</a></p><h1 id="860c" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">结论</h1><p id="afb8" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">这个组件帮助我克服了React本地项目中最大的性能问题，我希望它能满足您的需求。</p><p id="5c5c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我很乐意阅读您的意见和建议，请随时联系我们！</p></div></div>    
</body>
</html>