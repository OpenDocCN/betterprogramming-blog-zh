<html>
<head>
<title>This Is Why You Should Use Tortoise-ORM in Your Python Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这就是为什么您应该在Python项目中使用Tortoise-ORM</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/this-is-why-you-should-use-tortoise-orm-in-your-python-projects-a3897dc5309e?source=collection_archive---------8-----------------------#2022-06-17">https://betterprogramming.pub/this-is-why-you-should-use-tortoise-orm-in-your-python-projects-a3897dc5309e?source=collection_archive---------8-----------------------#2022-06-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e8c8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">像老板一样管理您的数据库！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/97507e346f701f4f64529129070d3dee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Kt7BB1O5oN1EkejZ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://unsplash.com/@wolfgang_hasselmann" rel="noopener ugc nofollow" target="_blank">沃尔夫冈·哈塞尔曼</a>在<a class="ae kv" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> unsplash </a>拍摄</p></figure><p id="9bd7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将关系数据库集成到我们的代码中可能会很麻烦，但是使用ORM会更容易。</p><p id="b71c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将向大家介绍一个名为乌龟ORM的前沿Python ORM包，并给出一个实际操作的例子。</p><h1 id="7339" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么是ORM？</h1><p id="4fd5" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">对象关系映射将关系数据库表结构映射到对象中。</p><p id="b36c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这使得我们可以避免在代码中编写显式的SQL查询，而这些查询可能很难阅读、调试和维护。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="5141" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个简单的例子中，我们创建一个名为<code class="fe mr ms mt mu b">db1</code>的<code class="fe mr ms mt mu b">sqlite</code>数据库，然后创建一个名为employees的表，该表有三个字段:<code class="fe mr ms mt mu b">ID</code>、<code class="fe mr ms mt mu b">NAME</code>和<code class="fe mr ms mt mu b">AGE</code>，然后我们在这个表中插入一行，提交更改并关闭连接。</p><p id="54f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们可以在Visual Studio代码的SQLite扩展中查看表格内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/9e0f9554498bcd7caa0c5ef81f3611a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rPHJKL2KiLTLxb8M-23UUQ.png"/></div></div></figure><p id="d0e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，这段代码可以工作，但是维护起来很糟糕。</p><p id="b9f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尤其是当有几十个表，它们之间有复杂的关系，并且它们经常被修改并需要迁移时。</p><p id="00cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用ORM将会用对象和函数调用代替所有的查询，这将会带来更好的组织和可读性。</p><h1 id="58bf" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么是乌龟？</h1><p id="c2fc" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">乌龟ORM的关键优势是它对asyncio的本地支持。大多数其他Python ORM包需要一些变通方法来使用asyncio代码。对乌龟来说，这是天生的！</p><p id="8747" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这太棒了，不是吗？</p><p id="12c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，让我们重构上面的例子来处理乌龟和asyncio！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="4d16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在代码的可读性大大提高了！</p><h1 id="908f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">并发</h1><p id="550c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如上所述，Tortoise ORM支持原生异步。</p><p id="7e8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大家好好利用一下:)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="5728" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在这个例子中，我创建了30个用户，同时，我执行了10秒钟的睡眠(这可以是任何其他有意义的任务)。</p><p id="66e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，如果这是一个常规的顺序代码，我们应该预计运行时间为300秒。</p><p id="d7f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是对于并发，这只需要10秒钟:)</p><p id="9223" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看输出:</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="1ec4" class="na lt iq mu b gy nb nc l nd ne">total_time= 10.03 seconds</span></pre><p id="fff4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们看看这张表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/839f4b0246a28d8e10858059f711c5d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/1*JGvembjAsVHYjm_WXpYnBw.png"/></div></figure><p id="8392" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了！</p><h1 id="9642" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">更多精彩内容！</h1><p id="a5b6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Tortoise很容易集成到异步web服务器框架(ASGI)中，例如fastapi、quart或Starlette。</p><p id="adb2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它可以在运行时轻松地从ORM模型中创建pydantic模型。</p><p id="2e6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它带有一个内置的迁移工具来跟踪数据库的变化；它支持事务、触发器(称为信号)甚至路由器将查询路由到不同的数据库实例。</p><p id="78d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它为数据库管理和操作带来了完整的工具链，并提供了令人惊叹的开发人员体验。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="4330" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nn">感谢阅读。敬请关注更多内容。</em></p></div></div>    
</body>
</html>