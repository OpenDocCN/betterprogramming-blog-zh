<html>
<head>
<title>Stop Using Print to Debug Your Python Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止使用Print来调试Python代码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/stop-using-print-to-debug-your-python-code-2ace9217f501?source=collection_archive---------9-----------------------#2020-09-21">https://betterprogramming.pub/stop-using-print-to-debug-your-python-code-2ace9217f501?source=collection_archive---------9-----------------------#2020-09-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4c95" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">开始使用内置的日志模块</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/33c9524a5d3f0f86e0fba8edeaaf8093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IDLNwgZpzg50nyVJ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@etiennegirardet?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">艾蒂安·吉拉尔代</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="df9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我从Bash脚本转向Python已经有一段时间了。来自操作世界，我在编写更复杂的代码时会犯一些错误。代码越复杂，调试起来就越复杂。直到最近，我还在使用与Bash相同的东西进行调试:语句<code class="fe lv lw lx ly b">print</code>。</p><p id="9288" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在AWS中，成本管理是一件大事。在我个人的工作中，我们在下班后关闭所有非生产环境中的数据库，以节省资金。基本上，这是由GitLab CI管道触发的，它关闭应用程序堆栈，然后停止数据库。</p><p id="8383" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能知道，Python默认缓冲输出(这可以用<code class="fe lv lw lx ly b">-u</code>参数设置为无缓冲模式)。因此，当我停止数据库时，我无法在作业结束前获得输出——除非我使用了这个技巧。我没有修改Python exec的行为，而是寻找一种更好的方法来处理消息。这时我发现了日志模块。</p><blockquote class="lz ma mb"><p id="3d96" class="kz la mc lb b lc ld ju le lf lg jx lh md lj lk ll me ln lo lp mf lr ls lt lu im bi translated">"这个模块定义为应用程序和库实现灵活事件记录系统的函数和类。</p><p id="b984" class="kz la mc lb b lc ld ju le lf lg jx lh md lj lk ll me ln lo lp mf lr ls lt lu im bi translated">使用标准库模块提供的日志API的主要好处是，所有Python模块都可以参与日志记录，因此您的应用程序日志可以包含您自己的与来自第三方模块的消息相集成的消息。”— <a class="ae ky" href="https://docs.python.org/3/library/logging.html" rel="noopener ugc nofollow" target="_blank"> Python的官方文档</a></p></blockquote><p id="b84f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，让我们看看如何实现它，以获得可读性更好的代码！</p><p id="f139" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先要理解的是如何配置模块。我不会在这里解析所有可用的选项，但我将只谈论要知道的主要三元组:</p><ul class=""><li id="18da" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">默认日志记录模式(参数级别)</li><li id="3e2a" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">日志格式(格式参数)</li><li id="f7eb" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">日志输出(<code class="fe lv lw lx ly b">stdout</code>，文件…)(文件名参数)</li></ul><pre class="kj kk kl km gt mu ly mv mw aw mx bi"><span id="b9d0" class="my mz it ly b gy na nb l nc nd">import logging</span><span id="517e" class="my mz it ly b gy ne nb l nc nd">logging.basicConfig(level=logging.DEBUG, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', filename='myFirstLog.log')</span></pre><p id="2e8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很容易初始化。这里，我们只是向日志记录对象传递一些参数来调试详细信息，用一些有趣的值格式化输出，并将我们的日志重定向到一个专用文件(默认为<code class="fe lv lw lx ly b">stdout</code>)。</p><p id="5448" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谁不喜欢举重？我确定没有人。基于此，我创建了下面这个使用日志模块的类(注意，我没有使用本教程的filename选项来获得<code class="fe lv lw lx ly b">stdout</code>上的所有输出) :</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="238c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们能注意到什么？上面的代码中使用了一些不同的<code class="fe lv lw lx ly b">prints</code>:<code class="fe lv lw lx ly b">DEBUG</code>-<code class="fe lv lw lx ly b">INFO</code>-<code class="fe lv lw lx ly b">ERROR</code>。如果您检查第16行和第19行，日志选项被设置为<code class="fe lv lw lx ly b">DEBUG</code>。这基本上是我们不想拥有的信息，如果我们要用这个代码来戳。同样的事情也适用于所有的日志语句。您可以选择在日志文件中包含什么内容！</p><p id="0422" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的一个快速优化在第27行:</p><pre class="kj kk kl km gt mu ly mv mw aw mx bi"><span id="d018" class="my mz it ly b gy na nb l nc nd">logging.info("Your barbell is now %s", self.total_weight)</span></pre><p id="11bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以写:</p><pre class="kj kk kl km gt mu ly mv mw aw mx bi"><span id="0af3" class="my mz it ly b gy na nb l nc nd">logging.info("Your barbell is now {}".format(self.total_weight))</span></pre><p id="4ac7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两种说法有什么区别？只有当你的日志等级为<code class="fe lv lw lx ly b">INFO</code>或更低(即<code class="fe lv lw lx ly b">DEBUG</code>)时，才会调用第一个函数，<code class="fe lv lw lx ly b">%s</code>翻译只在这种情况下进行。第二个每次都会变换(调用<code class="fe lv lw lx ly b">str</code> ) <code class="fe lv lw lx ly b">{}</code>，即使日志级别设置为<code class="fe lv lw lx ly b">ERROR</code>。请注意，我这里只说的是<code class="fe lv lw lx ly b">{}</code>替换——而不是打印日志。因此，如果您有适当的日志级别，第一个问题只涉及一个操作，反之则没有。对于第二个，如果您有正确的日志级别，每次都有一个操作<em class="mc"/>—<em class="mc"/>两个。</p><p id="f1ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们调用我们的类，看看如果我们将光标一次放在<code class="fe lv lw lx ly b">DEBUG</code>上，一次放在<code class="fe lv lw lx ly b">ERROR</code>上，会发生什么:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="420c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">DEBUG</code>模式输出:</p><pre class="kj kk kl km gt mu ly mv mw aw mx bi"><span id="402e" class="my mz it ly b gy na nb l nc nd">2020-09-17 14:18:54,075 - root - DEBUG - You're a woman<br/>2020-09-17 14:18:54,075 - root - INFO - Your barbell's weight is 15<br/>2020-09-17 14:18:54,075 - root - INFO - Your barbell is now 35<br/>2020-09-17 14:18:54,075 - root - INFO - Congrats, you've jerked 35 easily<br/>2020-09-17 14:18:54,075 - root - ERROR - You forgot to init your barbell, please call genderBarbell function first !<br/>2020-09-17 14:18:54,076 - root - ERROR - Cannot clean and jerk here, please init your barbell, please call genderBarbell function first !<br/>2020-09-17 14:18:54,076 - root - DEBUG - You're a man<br/>2020-09-17 14:18:54,076 - root - INFO - Your barbell's weight is 20<br/>2020-09-17 14:18:54,076 - root - INFO - Your barbell is now 140<br/>2020-09-17 14:18:54,076 - root - ERROR - Weight is too high for you ! Decrease weight even if there is no function for that because it is a tutorial !</span></pre><p id="a5bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">ERROR</code>模式输出:</p><pre class="kj kk kl km gt mu ly mv mw aw mx bi"><span id="8705" class="my mz it ly b gy na nb l nc nd">2020-09-17 14:20:36,809 - root - ERROR - You forgot to init your barbell, please call genderBarbell function first !<br/>2020-09-17 14:20:36,809 - root - ERROR - Cannot clean and jerk here, please init your barbell, please call genderBarbell function first !<br/>2020-09-17 14:20:36,809 - root - ERROR - Weight is too high for you ! Decrease weight even if there is no function for that because it is a tutorial !</span></pre><p id="1b18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，这里没有什么复杂的，但这将使你的代码更具可读性和可理解性！</p><p id="2776" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢这个快速教程。下一集再见！</p></div></div>    
</body>
</html>