# 使用“git-等分”快速发现问题

> 原文：<https://betterprogramming.pub/use-git-bisect-to-find-problems-fast-2cc02653cd37>

## 缩小您的提交范围

![](img/ee0a5e824c82efdc6ddc759772cdc476.png)

纪尧姆·伊萨利在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

今天我注意到一个自定义组件的一个样式被搞乱了。该组件由两个图标之间的一段文本组成。以前图标和文本之间有足够的空间，但是现在没有了。

![](img/2d81bb041c07173f39032f849029c321.png)

我先是怀疑某个班级被改了。也许它有一些填充，但现在没有了，但在 Chrome 开发者工具中快速检查显示，在生产版本中没有这样的填充(看起来仍然正确)。

很明显，在过去的一周左右，我在某个地方把它弄坏了。我经常提交，所以浏览每一次提交将是费力和费时的。如果有一种方法可以缩小提交的范围，并且有条不紊地有条不紊地完成它们就好了。

嗯，有了 git-平分，就有了！

# git-平分救援

什么是 git-平分？这是一个很聪明但很少使用的实用程序，它可以让你通过将提交分成两半，测试应用程序，然后重复这个过程来完成一系列提交。

下面是它的工作原理，以及我是如何使用它的。

首先，在过去的某个地方找到一个提交，在那里你知道代码是有效的。复制此提交的哈希。这将是你的起点。等分线的另一端是你的大脑，你知道它坏掉了。

我不得不查看我的 git 日志来找到最初包含我的代码的提交。我运行“git log — oneline | head -25”来查看我最近的 25 次提交。我找到了我第一次实现代码的地方，它现在已经坏了，记得当时它还在工作。我记下了它的提交散列 2d8cf845。

有了这些信息，我输入了以下命令:

第一个命令初始化 git-biquite，但除此之外不做任何事情。第二个命令告诉 git 我知道提交是好的。我的最后一个命令指示了一个我知道不起作用的提交:我的错误提交。我没有提供提交散列，而是简单地使用了 HEAD，这是我最近的一次提交。

git-biquite 的输出告诉我，在这两次修改或提交之间有 6 次修改或提交，我需要 3 个步骤才能找到问题的根源。

# 运行应用程序

现在该运行应用程序了，看看问题是否存在。我的问题是可视化，所以我必须建立和运行应用程序，并检查输出。

![](img/9445982175eff910a87536b5292129e7.png)

看起来很完美。您可以看到数字 1 和图标之间的间距。

所以，现在我告诉 git 这是一个很好的提交。

请注意，我只需要告诉 git-bi section 这个提交是好的。然后，它会自动在这个提交和我的错误提交之间选择一个提交，并为我检查出来。

我重建刷新了 app，那个也不错。

这个也不错，所以我重复了上面的命令。

请注意，它说还有 0 个修订和 0 个步骤，所以这最好是坏的一个，它是。

![](img/a6ad8498fec6f0b2877681dfd7f2ee6d.png)

有了 git-bi section 的帮助，我只需要尝试三次提交就可以找到问题的根源。

如果这不是我的最终提交，我会用 **git 平分 bad** 来标记它，然后 git 会继续缩小更改范围，直到我们最终找到违规者。

# 找到窃听器

现在我有了提交，我可以查看差异，并找出我可能做了什么来破坏它。

我将项目加载到 GitHub 中，并导航到该提交。幸运的是，我的提交不是很大，我很快就发现了问题。自定义组件使用第三方 flex 布局库，这是组件正确呈现所必需的。出于某种我不记得的原因，我已经从我的主脚本集中删除了这个库。

替换删除的那一行解决了我的问题。作为一名优秀的团队成员，我创建了一个新的 fix 分支，并通过单行更改打开了一个 pull 请求。

# 结论

发现一个意想不到的 bug 从来都不是一种好的感觉。更糟糕的是，当你不记得曾经接触过被破坏的代码时。在我的例子中，我随意地进行了更改，认为我正在删除一个未使用的导入。我错了。

幸运的是，我能够使用 git-section 找到问题提交，识别导致中断的更改，并发布更正。整个经历，从开始到结束，花了我大约半个小时，包括我记笔记和写解释的时间。

除了我在这里展示的内容，还有很多东西需要一分为二。如果您有单元测试，并且您试图找到破坏了其中一个或多个单元测试的提交，甚至有可能让 git-bi section 为您完成大部分工作。它可以运行您的测试，并自行决定提交是好是坏。这是另一天的高级主题。

希望下次你发现自己处于类似的困境时，你会记得这篇文章，并试着把自己一分为二。

# 👉想要更多像这样的内容来提高你的技术和专业技能吗？

请看看我收藏的书籍和课程，或者注册我的电子邮件列表，在 https://walkingriver.gumroad.com[的](https://walkingriver.gumroad.com)📱