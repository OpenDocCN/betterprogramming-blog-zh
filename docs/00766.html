<html>
<head>
<title>Making a Real World Application With SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SwiftUI制作真实世界的应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/making-a-real-world-application-with-swiftui-cb40884c1056?source=collection_archive---------0-----------------------#2019-07-11">https://betterprogramming.pub/making-a-real-world-application-with-swiftui-cb40884c1056?source=collection_archive---------0-----------------------#2019-07-11</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ded1" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">第一部分:数据流和冗余</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/ff4ffdd4f823ec41186be0f054b28650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*88tB-Fj_iBKe_NbVa-jjUw.png"/></div></div></figure><p id="77e2" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">自从2019年WWDC的国情咨文会议以来，我一直专注于<a class="ae lr" href="https://developer.apple.com/xcode/swiftui/" rel="noopener ugc nofollow" target="_blank"> SwiftUI </a>。我几乎把所有的业余时间都用来玩了。现在，我决定做一个真实世界的应用程序。</p><p id="abb4" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">但是什么定义了真实世界的应用程序呢？</p><p id="aeeb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">好吧，让我深入研究一下我专门用SwiftUI开发的一个开源应用程序的细节。这是<a class="ae lr" href="https://github.com/Dimillian/MovieSwiftUI" rel="noopener ugc nofollow" target="_blank">movieswiftui</a>——一个使用<a class="ae lr" href="https://developers.themoviedb.org/3" rel="noopener ugc nofollow" target="_blank"> TMDB API </a> ️.浏览、收集和发现电影的应用程序我一直很喜欢电影，很久以前我就围绕着电影做了一个公司。虽然效果不是很好，但是这个应用(一个围绕电影的社交网络)非常棒！</p><p id="dc7d" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">回到正题，MovieSwiftUI技术上是做什么的？</p><ul class=""><li id="d941" class="ls lt iu kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">它与API对话，这是目前大多数客户端应用程序所做的事情。</li><li id="96ce" class="ls lt iu kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">它按需加载异步数据，并使用<a class="ae lr" href="https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types" rel="noopener ugc nofollow" target="_blank"> Codable </a>将JSON解析成Swift模型。</li><li id="cb3c" class="ls lt iu kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">它显示按需下载的图像，并缓存它们。</li><li id="a9dc" class="ls lt iu kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">这是一个单一目标iOS、iPadOS和macOS应用程序，具有条件UI实现，可在iOS、iPadOS和macOS上提供最佳UX。将来可能会转移到特定的macOS目标。</li><li id="285c" class="ls lt iu kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">用户可以生成数据并创建自己的电影列表。该应用程序将保存和恢复用户数据。</li><li id="eb77" class="ls lt iu kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">由于应用程序使用Redux模式的自定义实现，视图、组件和模型被清晰地分离。它是真实的单一来源，是整个应用程序状态的单向数据流。它可以完全缓存、恢复和倒带。</li><li id="522d" class="ls lt iu kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">它使用基本的SwiftUI组件，TabbedView，SegmentedControl，NavigationView，Form，Modal等。它还提供非常定制的视图，手势和UI/UX。是的，它也是一个SwiftUI游乐场/演示，因为它是一个全功能的应用程序。</li></ul><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj mg"><img src="../Images/927a08604a981a3118976a61630a2abf.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/1*3N5iaqWCqjsH8mePoErw-Q.gif"/></div><p class="mh mi gk gi gj mj mk bd b be z dk translated">动画在现实中是流畅的，这只是一个低劣的GIF在这里:)</p></figure><p id="5519" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">到目前为止，这是一次非常成功的经历。我已经能够编写一个全功能的应用程序，我将在9月份iOS 13发布时在App Store上发布。</p><h2 id="3f0a" class="ml mm iu bd mn mo mp dn mq mr ms dp mt le mu mv mw li mx my mz lm na nb nc nd bi translated">Redux、ObservableObject和EnvironmentObject</h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ne"><img src="../Images/4ede8ff19449370f5ac13f9feb6b1e71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-5TBPgIKsJpWzpt5_5xCYw.png"/></div></div><p class="mh mi gk gi gj mj mk bd b be z dk translated">Redux流程图来自<a class="ae lr" href="https://engineering.wework.com/reading-redux-easy-38d2d30d6972" rel="noopener ugc nofollow" target="_blank">https://engineering . we work . com/reading-redux-easy-38d 2d 30d 6972</a></p></figure><p id="3e3a" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我已经和<a class="ae lr" href="https://redux.js.org/" rel="noopener ugc nofollow" target="_blank"> Redux </a>合作两年了，所以我对这种模式相当熟悉。我们在所有的前端、我们的<a class="ae lr" href="http://reactjs.org" rel="noopener ugc nofollow" target="_blank"> React </a>网站以及我们的原生iOS (Swift)和Android (Kotlin)应用程序上使用它。</p><p id="b67d" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">对于SwiftUI，选择Redux作为数据流架构是完全正确的。在UIKit应用程序中使用Redux时，一些最复杂的部分是如何订阅您的商店，以及如何从您的状态中导出和提取数据，并将它们映射到您的视图/组件属性。为此，我们必须构建一种连接器库(在ReSwift和ReKotlin之上)。它工作得很好，但是代码相当多。遗憾的是，还没有开源。</p><p id="449a" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">好消息。使用SwiftUI，如果您想使用Redux模式，您唯一需要担心的是您的存储、状态和reducers。由于<code class="fe nf ng nh ni b">@<a class="ae lr" href="https://developer.apple.com/documentation/swiftui/environmentobject" rel="noopener ugc nofollow" target="_blank">EnvironmentObject</a></code>属性包装器和我们的商店是<code class="fe nf ng nh ni b"><a class="ae lr" href="https://developer.apple.com/documentation/combine/observableobject" rel="noopener ugc nofollow" target="_blank">ObservableObject</a></code>，订阅部分完全由SwiftUI处理。</p><p id="ec35" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我做了一个简单的Swift包，<a class="ae lr" href="https://github.com/Dimillian/SwiftUIFlux" rel="noopener ugc nofollow" target="_blank"> SwiftUIFlux </a>，它提供了Redux的一个非常基本的实现。我用这个作为MovieSwiftUI的一部分。我还在<a class="ae lr" href="https://github.com/Dimillian/SwiftUIFlux/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">自述文件中添加了一个关于如何使用它的全面的逐步指南</a>。</p><p id="3a4c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">它是如何工作的？</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nj nk l"/></div><p class="mh mi gk gi gj mj mk bd b be z dk translated">我的SwiftUIFlux库中Store.swift的一个非常小的摘录。</p></figure><p id="3648" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">每当你发出一个动作，你就会触发你的减速器。它会根据你当前的应用状态评估你的操作，并根据你的操作类型和数据返回新的修改状态。</p><p id="4676" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">因为<code class="fe nf ng nh ni b">Store</code>是一个<code class="fe nf ng nh ni b"><a class="ae lr" href="https://developer.apple.com/documentation/combine/observableobject" rel="noopener ugc nofollow" target="_blank">ObservableObject</a></code>，并且<code class="fe nf ng nh ni b">state</code>属性被包装在一个<code class="fe nf ng nh ni b"><a class="ae lr" href="https://developer.apple.com/documentation/combine/published" rel="noopener ugc nofollow" target="_blank">@Published</a></code>属性包装器中，所以只要设置了<code class="fe nf ng nh ni b">state</code>属性，SwiftUI就会得到通知。这是Combine框架中一个非常强大的助手。SwiftUI将调用您的视图主体，并根据您状态的变化对其进行区分。从您的状态获得不同数据的视图部分将相应地重新呈现。</p><p id="30ba" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这就是SwiftUI + Redux的用心和神奇之处。现在，在任何订阅了store.state属性的视图中，视图将根据它从状态中获得的数据和更改的内容重新呈现。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nj nk l"/></div><p class="mh mi gk gi gj mj mk bd b be z dk translated">一个SwiftUI应用程序的非常基本的例子，其中注入了redux store。</p></figure><p id="4bcd" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">当应用程序启动时，商店作为一个<code class="fe nf ng nh ni b">EnvironmentObject</code>被注入，然后使用<code class="fe nf ng nh ni b">@EnvironmentObject</code>属性包装器在任何视图中可用。如果从应用程序状态中快速提取或计算您的派生属性，不会对性能造成影响。</p><p id="c99c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在上面的代码中，如果电影海报发生变化，图像也会相应地更新。</p><p id="d355" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">你的观点实际上与你的状态一致。您只编写了一行代码来连接它，还编写了一行代码来将属性提取/映射到视图属性。如果你在iOS上使用过<a class="ae lr" href="https://github.com/ReSwift/ReSwift" rel="noopener ugc nofollow" target="_blank">RES swift</a>，甚至在React上使用过@connect，你会很快明白SwiftUI为何如此神奇。</p><p id="d6bf" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">那么，如何触发一个动作并发布一个新的状态呢？让我们看一个更复杂的例子。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nj nk l"/></div></figure><p id="fc2a" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在上面的代码中，我对每个API使用SwiftUI中的<code class="fe nf ng nh ni b">.onDelete</code>动作。它允许列表中的行显示要删除的标准iOS滑动。因此，当用户触摸删除按钮时，它会在我的状态上触发一个动作，并从列表中删除该电影。</p><p id="575b" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">由于列表属性是从状态中派生出来的，状态是一个<code class="fe nf ng nh ni b">ObservableObject</code>并被注入为一个<code class="fe nf ng nh ni b">EnvironmentObject</code>，SwiftUI将更新列表，因为<code class="fe nf ng nh ni b"><a class="ae lr" href="https://developer.apple.com/documentation/swiftui/foreach" rel="noopener ugc nofollow" target="_blank">ForEach</a> </code>被绑定到了<code class="fe nf ng nh ni b">movies </code>计算属性。</p><p id="db2e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这里是<code class="fe nf ng nh ni b">MoviesState</code>的减速器的一部分:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nj nk l"/></div></figure><p id="ff6b" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如上所述，当您调度一个动作并返回一个新状态时，reducer就会被执行。</p><p id="1142" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我不会深究SwiftUI实际上是如何知道要呈现什么的，但是视图差异是在视图级别完成的。它比较了以前的版本和新版本。因此，它将保持非常高效，无论你的国家的大小！重要的是如何从状态和视图的复杂性中提取属性，而不是状态的大小。</p><p id="73bf" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我希望这篇文章能启发你如何用SwiftUI构建你的数据流。当然还有很多其他有效的架构，苹果提供了很多SwiftUI和Combine的工具。没有什么能像Redux那样强迫你将整个应用程序状态放入一个大结构中。这只是方法之一，在我看来，它在SwiftUI中很有意义。</p><p id="6e07" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我邀请您观看这个关于SwiftUI中数据流的宝贵的<a class="ae lr" href="https://developer.apple.com/videos/play/wwdc2019/226/" rel="noopener ugc nofollow" target="_blank"> WWDC会议</a>。这是一个很好的解释，有助于理解为什么以及何时恰当地使用<code class="fe nf ng nh ni b">@State</code>、<code class="fe nf ng nh ni b">@Binding</code>、<code class="fe nf ng nh ni b">@ObservedObject</code>和<code class="fe nf ng nh ni b">EnvironmentObject </code>。</p><p id="dc39" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如果您有任何问题或反馈，请告诉我。我很乐意回答他们，并相应地更新文章。</p><div class="nl nm gq gs nn no"><a href="https://medium.com/@dimillian/making-a-real-world-application-with-swiftui-ba9e9682889c" rel="noopener follow" target="_blank"><div class="np ab fp"><div class="nq ab nr cl cj ns"><h2 class="bd iv gz z fq nt fs ft nu fv fx it bi translated">使用SwiftUI制作真实世界的应用程序</h2><div class="nv l"><h3 class="bd b gz z fq nt fs ft nu fv fx dk translated">第二部分:异步数据和远程映像</h3></div><div class="nw l"><p class="bd b dl z fq nt fs ft nu fv fx dk translated">medium.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc kt no"/></div></div></a></div></div></div>    
</body>
</html>