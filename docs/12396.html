<html>
<head>
<title>The Vices of DTO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DTO的罪恶</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/sins-of-dto-b612160ef936?source=collection_archive---------8-----------------------#2022-06-02">https://betterprogramming.pub/sins-of-dto-b612160ef936?source=collection_archive---------8-----------------------#2022-06-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c9f8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">对于避免为模型编写方法的开发人员来说</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/958b8c4a1208eb8e0ae864c05e24f0fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0ExRNlrVSgUqb2oe"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">卡斯帕·卡米尔·鲁宾在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h2 id="0660" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">什么是DTO？</h2><p id="ab31" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated"><a class="ae kv" href="https://martinfowler.com/eaaCatalog/dataTransferObject.html" rel="noopener ugc nofollow" target="_blank"> Martin Fowler </a>将DTO定义为在进程间传送数据的对象，以减少方法调用的数量。</p><p id="b06e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">代表DTO的类没有方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">DTO的例子</p></figure><p id="bc86" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">但是DTO的缺点是什么呢？</p><h2 id="ae92" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">第一:代码复制</h2><p id="9a93" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">代码重复是广泛使用dto的应用程序最常见的疾病。</p><p id="6826" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">看看下面的图表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/fafc705b8cfe8f4f3f52b8d0c6d98832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*CcJkdMQI08Ggzwot5QELFA.png"/></div></div></figure><p id="e2aa" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">只要<code class="fe mt mu mv mw b">Product</code>类是DTO，你很可能会产生与另一个开发人员甚至是你不久前在另一个类中编写的代码相同的代码。</p><p id="f981" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">通常，我们既没有时间也没有意愿去查看每一个使用DTO的类，以找到我们需要的私有方法，并把它移到其他地方。</p><p id="39e7" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">也不可能使用多态性，这会导致代码重复，看起来像重复的when (if)表达式。</p><h2 id="5f03" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">第二:大而复杂的依赖类</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/91708cb20164531d8b65b6ecd37e087a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x3K5bpdQwHomkR0cid3IvA.png"/></div></div></figure><p id="9b9e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">DTO没有方法。所有基于DTO成员进行计算的方法都在依赖类中。</p><p id="b91e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">依赖类依赖的dto越多，该类拥有的私有方法就越多。类的私有方法越多，理解代码和编写单元测试就越难。</p><h2 id="0c5a" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">第三:传输/存储数据不是一种责任</h2><p id="edba" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">我问过使用DTO的开发者，他们为什么要这么做。最常见的问题是:“因为dto传输/存储数据。根据单一责任原则(后来的SRP)，这是他们的责任。DTO的职责是传输/存储数据。”</p><p id="1915" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">我真的相信他们误解了SRP的意思，即一个类应该只有改变的理由。</p><p id="c401" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">另一个原则是，一个方法应该做一件事，并且只做一件事，而且要做好。</p><p id="3caa" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">这两个原理乍一看很相似。这就是人们困惑的原因。</p><p id="283a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">他们更关注“责任”一词，而不是SRP的定义。他们认为一个类有一个责任意味着这个类做一件事。但那是完全错误的结论。<em class="my">一个责任意味着一个类应该对一个且只有一个actor </em>负责。据我理解，SRP更多的是关于人，而不是一个对象做什么。</p><p id="2906" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">dto什么都不做，因为他们没有方法。这就是为什么他们没有行为。这就是为什么他们没有责任。</p><h2 id="eb57" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">什么时候可以使用DTO</h2><p id="8b1c" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">使用DTO来解析从REST API获得的JSON对象是可以的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="6bce" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">使用DTO将数据传递给视图来显示某些东西是可以的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="5b84" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">如果服务器做所有的计算，使用DTO是可以的。</p><p id="57da" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">如果一个类完全没有逻辑，使用DTO也是可以的。</p><h2 id="7a7f" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">如何减少DTO的使用？</h2><ul class=""><li id="6c24" class="mz na iq lu b lv lw ly lz lf nb lj nc ln nd mk ne nf ng nh bi translated">为类编写方法。</li><li id="29c1" class="mz na iq lu b lv ni ly nj lf nk lj nl ln nm mk ne nf ng nh bi translated">不要让客户端代码在类之外进行计算。</li><li id="2396" class="mz na iq lu b lv ni ly nj lf nk lj nl ln nm mk ne nf ng nh bi translated">将使用类成员的逻辑移到该类的方法中。尽你所能去做。但是请记住将<strong class="lu ir">关注点分离原则</strong>考虑在内。</li></ul><h2 id="4251" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">如何理解逻辑应该属于什么类？</h2><p id="f97b" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated"><a class="ae kv" href="https://medium.com/@ruberoid55/grasp-principles-lead-by-examples-for-android-development-part-1-ed9e087b5fe1" rel="noopener">应应用信息专家原则</a>。</p></div></div>    
</body>
</html>