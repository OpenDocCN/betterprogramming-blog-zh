<html>
<head>
<title>3 Common Mistakes With React Keys</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应键的3个常见错误</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/common-mistakes-with-react-keys-384ec8c8044d?source=collection_archive---------13-----------------------#2020-09-04">https://betterprogramming.pub/common-mistakes-with-react-keys-384ec8c8044d?source=collection_archive---------13-----------------------#2020-09-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fb46" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用钥匙的关键</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fc28d6337624722fae9d8aede59d877e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TM1LfiGQ10l9OOwW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@jasondeblooisphotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jason D </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="eda2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">刚开始学习时，很容易被简单的错误绊倒。即使是经验丰富的开发人员也会犯错误。</p><p id="3344" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个经常被误解的地方是当迭代UI中要显示的项目时如何使用<code class="fe lv lw lx ly b">key</code>。</p><p id="8c86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将研究React键的三个错误以及如何避免它们。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="1517" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">为什么需要钥匙？</h1><p id="2507" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">首先，让我们确定我们理解为什么我们使用钥匙。</p><p id="888a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://reactjs.org/docs/lists-and-keys.html#keys" rel="noopener ugc nofollow" target="_blank"> React文档</a>解释说“关键字有助于React识别哪些项目已经更改、添加或删除。应该给数组内部的元素赋予键，以给元素一个稳定的标识。</p><p id="1d0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，键有助于识别元素，尤其是当React执行它的diffing算法来记录UI中的变化时。</p><p id="ee13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这个基本的理解，让我们看看我们的第一个错误。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="2821" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">错误1:不使用钥匙</h1><p id="0c96" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如果您正在迭代一个项目数组，可能是用<code class="fe lv lw lx ly b">Array.map</code> helper方法，然后在UI中显示这些项目，您必须为每个项目添加一个键。</p><p id="7db1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，这个购物清单组件遍历一组食品杂货:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="93f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，我们忘了给我们的<code class="fe lv lw lx ly b">&lt;li&gt;</code>元素添加一个键！React将帮助我们解决这个问题，当忘记一个键时，它实际上会向JavaScript控制台添加一个警告:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/90e42ebe1b000c26cba72f8043d4d425.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ta8cUIrkjWZgmchNa18UbQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">忘记添加密钥时的错误消息</p></figure><p id="40dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单解决方法是在第9行的<code class="fe lv lw lx ly b">&lt;li&gt;</code>元素上添加键，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="1350" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">错误2:在错误的地方添加了密钥</h1><p id="124b" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">即使在使用键的时候，有时候开发人员也会误解键应该放在哪里。例如，如果我们把购物清单分成两个独立的部分:清单本身和清单项目，会怎么样？</p><p id="bc27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能会想这样做:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="0bed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所看到的，这个键被添加到第3行的<code class="fe lv lw lx ly b">ShoppingListItem</code>组件中的<code class="fe lv lw lx ly b">&lt;li&gt;</code>元素上。</p><p id="50f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，添加键的正确位置是映射或迭代发生的地方。所以在第11行添加密钥会更合适:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="1e8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好多了！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="a50f" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">错误3:不使用稳定的标识符作为键，尤其是在处理动态列表时</h1><p id="a280" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">既然我们知道需要添加一个键以及添加到哪里，那么是时候处理最关键的部分了:键应该是什么。</p><p id="1cec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">理想情况下，密钥应该是一个不会改变的唯一标识符。如果您正在迭代从后端检索的对象数组，每个对象可能都有一个您可以使用的<code class="fe lv lw lx ly b">id</code>属性。在上面的购物清单中，每个购物清单项目的名称都是唯一的，所以名称本身就很好。</p><p id="23e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果数据本身没有唯一的标识符，那么使用索引作为键是可以接受的。例如，具有非唯一名称的学生列表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="016b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">泰勒是一个如此伟大的名字，我们的同学名单上有两个泰勒。在没有唯一ID的情况下，使用索引作为键是一个可接受的解决方案。</p><p id="ed3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是！这里有一个问题:如果我们的数据是动态的，我们需要小心。例如，如果我们的列表可以排序或过滤，当使用索引作为键时，我们会遇到一些问题。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="f731" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们想象一下，我们的同学名单是用来上课点名的。每个学生的名字旁边都会有一个复选框，为了方便老师，名单可以按字母顺序(A-Z)或倒字母顺序(Z-A)排序。</p><p id="3a6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c067" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们看看当我们试着选中一些复选框，然后对我们的列表进行排序时会发生什么。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/05cd593d8b8f4b0386831373ffa26520.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*FVfq0_DDvjCt-t9672JgSQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">不稳定的键会导致意外的用户体验</p></figure><p id="b912" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哦不！选中的复选框不能随学生姓名正确移动！首先亚当和约翰在场，但在名单排序后，Z-A，只有泰勒夫妇在场！</p><p id="0ff8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们使用了一个索引作为我们的键，所以列表中的前两个条目保持被检查，即使实际的条目数据和文本内容已经改变。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="a3ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了解决这个问题，我们需要使用一个稳定的标识符作为我们的密钥。我将修改我们的数据，以便每个学生都有一个我们可以使用的唯一ID。</p><p id="1306" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的代码现在看起来像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="4080" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们的字符串数组现在是一个对象数组，每个学生都有一个名字和一个ID，ID被用作第37行的键。</p><p id="6bfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是最终的用户体验:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/5f0a5f476d41e974d8e585daa7c380f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*tUfIckmHEVjvxLpLX8EnQQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">复选框现在会保留正确的名称</p></figure><p id="fff2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整洁！现在，列表排序时，复选框会随着学生姓名一起移动。无论列表如何排序，亚当和约翰都被标记为出席。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="9ab1" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="b73e" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">这就是了。React键的三个错误和正确使用它们的三种方法。编码快乐！</p></div></div>    
</body>
</html>