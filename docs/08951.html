<html>
<head>
<title>Put a Stop to Data Swamps With Event-Driven Data Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用事件驱动的数据测试来停止数据沼泽</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/put-a-stop-to-data-swamps-with-event-driven-data-testing-203d9c1be073?source=collection_archive---------11-----------------------#2021-06-29">https://betterprogramming.pub/put-a-stop-to-data-swamps-with-event-driven-data-testing-203d9c1be073?source=collection_archive---------11-----------------------#2021-06-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="81f8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python、AWS Lambda、SNS和Great Expectations确保S3数据湖中的数据质量</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e55541fe8ebfd9ac178294728b7ee86b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2OMR-Fzb1IvVqi8pWLo5ew.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://www.pexels.com/photo/pen-business-eyewear-research-6801648/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a> | <a class="ae ky" href="https://www.annageller.com/disclosure" rel="noopener ugc nofollow" target="_blank">品牌内容披露</a>Anna Nekrashevich的照片。</p></figure><p id="fe2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据湖曾经在数据质量方面名声不佳。与数据仓库相反，在我们加载数据之前，数据不需要遵循任何预定义的模式。如果没有适当的测试和治理，您的数据湖很容易变成数据沼泽。</p><p id="d004" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将研究如何构建自动数据测试，这些测试将在新数据加载到数据湖时执行。我们还将配置基于SNS的警报，以便在数据偏离我们的<em class="lv">预期</em>时得到通知。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="35f7" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated"><strong class="ak">目录</strong></h1><p id="4138" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><a class="ae ky" href="#e55b" rel="noopener ugc nofollow">用于数据质量的Python库</a> <br/> <a class="ae ky" href="#38bf" rel="noopener ugc nofollow">使用远大前程</a> <br/> <a class="ae ky" href="#8c40" rel="noopener ugc nofollow">使用远大前程进行事件驱动的数据测试</a> <br/> <a class="ae ky" href="#cace" rel="noopener ugc nofollow">演示:生成用于测试的时间序列数据</a> <br/> <a class="ae ky" href="#5412" rel="noopener ugc nofollow">使用远大前程实现数据测试</a> <br/> ∘ <a class="ae ky" href="#2ee7" rel="noopener ugc nofollow">我们可以为这些数据运行哪些测试？</a> <br/> ∘ <a class="ae ky" href="#5e5a" rel="noopener ugc nofollow">如何实现数据测试？∘如何在本地运行数据测试？</a> <br/> ∘ <a class="ae ky" href="#3fcc" rel="noopener ugc nofollow">如何在AWS Lambda上运行数据测试？</a> <br/> ∘ <a class="ae ky" href="#085f" rel="noopener ugc nofollow">通过上传新文件到数据湖来测试AWS流程</a> <br/> <a class="ae ky" href="#d291" rel="noopener ugc nofollow">如何监控这个流程？</a> <br/> <a class="ae ky" href="#7e81" rel="noopener ugc nofollow">结论</a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="e55b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">用于数据质量的Python库</h1><p id="9ef2" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">有如此多的工具用于数据分析和数据测试。仅列举其中一些:</p><ul class=""><li id="f88f" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><a class="ae ky" href="https://pandas-profiling.github.io/pandas-profiling/docs/master/index.html" rel="noopener ugc nofollow" target="_blank"> Pandas Profiling </a>允许我们生成一个HTML报告，显示分位数统计、直方图、相关性、空值分布、文本分析、高基数分类变量等等。</li><li id="b934" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><a class="ae ky" href="https://docs.getdbt.com/docs/building-a-dbt-project/tests" rel="noopener ugc nofollow" target="_blank"> dbt测试</a>让我们验证惟一性、可接受值、空值，并构建任何自定义数据测试，通过使用SQL查询来检测异常。</li><li id="945a" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><a class="ae ky" href="https://bulwark.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">壁垒</a>为返回熊猫<code class="fe no np nq nr b">DataFrames</code>(例如<code class="fe no np nq nr b">@dc.HasNoNans()</code>)的函数提供装饰器。</li><li id="af7d" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><a class="ae ky" href="https://ubisoft.github.io/mobydq/" rel="noopener ugc nofollow" target="_blank"> mobyDQ </a>是Ubisoft的一个工具，用于生成基于GraphQL的web应用程序进行数据验证。</li><li id="0539" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><a class="ae ky" href="https://www.tensorflow.org/tfx/guide/tfdv" rel="noopener ugc nofollow" target="_blank"> TensorFlow数据验证</a>检测训练和模型服务数据中的异常。</li></ul><p id="1f35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将关注用于验证和分析数据的开源Python库，名为<a class="ae ky" href="https://greatexpectations.io/" rel="noopener ugc nofollow" target="_blank">远大前程</a>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="38bf" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">利用巨大的期望</h1><p id="143b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">使用远大前程的建议方式是:</p><ul class=""><li id="105c" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">安装包:<code class="fe no np nq nr b">pip install great_expectations</code>。</li><li id="fc12" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">初始化一个项目:<code class="fe no np nq nr b">great_expectations --v3-api init</code>。</li><li id="33b6" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">配置到您的数据源的连接(例如，您的数据仓库或pandas的平面文件或Pyspark验证):<code class="fe no np nq nr b">great_expectations --v3-api datasource new</code>。</li><li id="6977" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">手动创建一个初始的期望套件，使用一批数据交互地创建，或者使用一个内置的分析器自动创建:<code class="fe no np nq nr b">great_expectations --v3-api suite new</code>。</li><li id="5738" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">在Jupyter笔记本中编辑这个期望套件(<code class="fe no np nq nr b">great_expectations --v3-api suite edit suite_name</code>)或者直接通过修改JSON文件(<code class="fe no np nq nr b">great_expectations/expectations/&lt;suite_name&gt;.json</code>)。</li><li id="884a" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">创建一个检查点，将期望套件映射到一个<code class="fe no np nq nr b">data_asset_name</code>，这是您想要测试的实际数据:<code class="fe no np nq nr b">great_expectations --v3-api checkpoint new checkpoint_name</code>。</li><li id="acb7" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">对新的一批数据运行验证过程:<code class="fe no np nq nr b">great_expectations --v3-api checkpoint run checkpoint_name</code>。</li><li id="6f8c" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">最后，弄清楚如何部署它并按计划运行它。比如通过创建一个Python脚本:<code class="fe no np nq nr b">great_expectations --v3-api checkpoint script suite_name</code>。</li></ul><p id="1ae1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想实现所有这些步骤，你可以遵循<a class="ae ky" href="https://docs.greatexpectations.io/en/latest/guides/tutorials/getting_started_v3_api.html" rel="noopener ugc nofollow" target="_blank">官方教程</a>。整个文档中最重要的一页列出了你可以使用的所有期望。</p><p id="abe4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您查看上面的要点，您可能会注意到这个设置相当复杂。它甚至没有涵盖如何打包和部署代码以使其为生产做好准备，如何设置失败警报，如何托管和共享数据文档，或者如何围绕它构建可重复的过程以在数据管道中进行数据测试。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8c40" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">对事件驱动的数据测试寄予厚望</h1><p id="f19c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">让我们试着用一种更“Pythonic化”的方式来接近它。我们希望对存储在S3自动气象站的数据寄予厚望。我们希望数据测试在新文件到达S3时自动运行。虽然Great Expectations为Athena 提供了一个<a class="ae ky" href="https://docs.greatexpectations.io/en/latest/guides/how_to_guides/configuring_datasources/how_to_configure_an_athena_datasource.html" rel="noopener ugc nofollow" target="_blank">数据源连接器，但是它需要在整个Athena表上运行验证，而不是只验证加载到数据湖中的特定一批数据。因此，很难跟踪哪个S3 PUT操作导致了相应数据源中的异常。</a></p><p id="e45c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为Athena数据源的替代方案，我们可以使用pandas和平面文件作为数据源来配置expectations suite，但即使这样，整个过程似乎还是有点麻烦。</p><p id="596b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何只使用Python来实现它——没有配置文件。最终目标是将这个脚本部署到AWS Lambda，并配置函数，使其在每个S3 PUT操作中触发到我们的S3数据湖中的期望路径。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="cace" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">演示:生成用于测试的时间序列数据</h1><p id="8128" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们将从生成一个每小时的时间序列开始，这个时间序列有一个精心选择的值范围。生成合成数据集将允许我们方便地插入额外的“坏值”,并查看我们的数据测试是否检测到这些异常。以下是我们将使用的数据集示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/56a8e8da267154190d4e87cb19445b2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*HVDrHKX8xIamYRDXy99-wQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例数据集-按作者分类的图像</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="5412" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用远大期望实现数据测试</h1><h2 id="2ee7" class="nv me it bd mf nw nx dn mj ny nz dp mn li oa ob mp lm oc od mr lq oe of mt og bi translated">我们可以对这些数据进行哪些测试？</h2><p id="a0a0" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">总的来说，任何潜在的异常都可以(并且<em class="lv">应该</em>)被测试。例如，我们可以验证:</p><ul class=""><li id="9278" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">列的顺序。</li><li id="16b3" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">行数(即我们的时间序列的粒度)。因为我们处理的是每小时的时间序列数据，所以如果没有数据丢失(<em class="lv">并且没有夏令时，我们可以期望每天有24行！</em>)。</li><li id="ae24" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">任何潜在的空值的存在。</li><li id="13ec" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">数据类型。时间戳应该是一个<code class="fe no np nq nr b">datetime</code>列，而值应该是一个<code class="fe no np nq nr b">integer</code>列。</li><li id="bc99" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">价值观的范围是否符合我们的期望。在这个例子中，它必须在<code class="fe no np nq nr b">0</code>和<code class="fe no np nq nr b">100</code>之间。</li></ul><h2 id="5e5a" class="nv me it bd mf nw nx dn mj ny nz dp mn li oa ob mp lm oc od mr lq oe of mt og bi translated">如何实现数据测试</h2><p id="a770" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">下面是在单个类中实现这些测试的示例。它允许您单独运行每个数据测试，也可以一次运行所有的测试。此外，<code class="fe no np nq nr b">parse_data_test_result()</code>方法会在任何失败的数据测试时发送SNS电子邮件警报。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="a114" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建电子邮件提醒的SNS主题，您可以运行下面的代码。然后，按照AWS电子邮件中的链接确认您的产品升级和技术支持服务电子邮件订阅。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h2 id="487a" class="nv me it bd mf nw nx dn mj ny nz dp mn li oa ob mp lm oc od mr lq oe of mt og bi translated">如何在本地运行数据测试</h2><p id="f01d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在进入生产之前，您可能希望在本地测试您的数据。来自<code class="fe no np nq nr b">TimeseriesDataTestRunner</code>的数据测试可以在本地开发机器上执行。下面的代码片段实现了:</p><ul class=""><li id="46cf" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">一个快乐路径测试将会成功，因为它生成的数据符合我们的预期。</li><li id="f740" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">与先前定义的测试用例相对应的七个失败测试。通过故意生成有偏差的数据，我们可以确保我们的测试工作正常，并检测出偏离我们预期的数据。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="69a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们在本地运行时，我们应该会收到七封类似的电子邮件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/5fa61f6dae67109f2afea5dfce0f92ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sb4zA56vADDC7d-a5M8TNg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">关于数据测试失败的电子邮件-作者图片</p></figure><h2 id="3fcc" class="nv me it bd mf nw nx dn mj ny nz dp mn li oa ob mp lm oc od mr lq oe of mt og bi translated">如何在AWS Lambda上运行数据测试</h2><p id="c623" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">自动运行这些测试的最有效的方法是构建一个Lambda函数，使用S3 PUT对象事件触发器。这样，每当一个新文件被上传到指定的S3位置，Lambda函数就会被自动触发来测试我们的数据。</p><p id="a122" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们需要一个Lambda函数，它将从事件元数据中读取S3键，将上传的文件读入pandas <code class="fe no np nq nr b">DataFrame</code>，并最终运行测试。这是一个简单的实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="e8bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了构建这个Lambda函数，我们需要:</p><ul class=""><li id="de3e" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><code class="fe no np nq nr b">requirements.txt</code>:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><ul class=""><li id="b9cf" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><code class="fe no np nq nr b">Dockerfile</code>:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><ul class=""><li id="00ac" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">构建Docker映像并将其推送到ECR的几个shell命令:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="6db3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意<code class="fe no np nq nr b">timeseries_data_test_runner.py</code>、<code class="fe no np nq nr b">timeseries_data_generator.py</code>和<code class="fe no np nq nr b">lambda.py</code>位于<code class="fe no np nq nr b">src</code>文件夹中。如果你想使用上面显示的<code class="fe no np nq nr b">Dockerfile</code>，这很重要。项目结构如下所示(最后一个文件将在下一节解释):</p><pre class="kj kk kl km gt oi nr oj ok aw ol bi"><span id="adf7" class="nv me it nr b gy om on l oo op">|-- Dockerfile<br/>|-- requirements.txt<br/>|-- src<br/>|   |-- lambda.py<br/>|   |-- timeseries_data_generator.py<br/>|   `-- timeseries_data_test_runner.py<br/>`-- upload_new_timeseries_to_s3.py</span></pre><p id="19a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在剩下要做的就是:</p><ol class=""><li id="d022" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu oq ng nh ni bi translated">创建你的Lambda函数。</li><li id="5e62" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu oq ng nh ni bi translated">根据您的用例调整内存和超时设置(默认值对于数据测试来说太小，您可以为Lambda函数分配高达10GB的内存，并将超时设置为15分钟)。</li><li id="68b0" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu oq ng nh ni bi translated">配置S3触发器。</li><li id="5c53" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu oq ng nh ni bi translated">为Lambda函数设置IAM权限，以便它可以从S3读取文件并触发SNS警报。</li><li id="02b9" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu oq ng nh ni bi translated">通过上传新文件到您的数据湖来测试这个过程。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/f07e6909c87f04ae600c02f4ad9de03d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GjWdzi27Zu9RmUaI0F8zNQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建您的Lambda函数—作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/bfeb23891bf8f249b6eea220aa56f6ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FGUVB0Qui-wVLNTufZPgfg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更改内存和超时设置-图片作者</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/ecd257db6c32fc4c3b85f4a9f8be65f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OWcnqkTcwv0B5lLDVslJNA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设置S3触发器-作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/8d73e80d5fb576239cf886e6a730feb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*0ahjVRpV9sbLv5cpJK7H9w.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/c628810a4cc9084c525882c32e763d46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZCuC9tYsDpkkf9nFyzK2dA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设置IAM权限-按作者分类的图像</p></figure><h2 id="085f" class="nv me it bd mf nw nx dn mj ny nz dp mn li oa ob mp lm oc od mr lq oe of mt og bi translated">通过向数据湖上传新文件来测试AWS流程</h2><p id="3008" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">类似于我们如何在本地运行数据测试，我们现在可以开始将我们的数据上传到S3，并查看由于AWS上失败的数据测试而触发的警报。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="e9d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您执行了上述所有测试，您应该会收到来自AWS的七封电子邮件，类似于下面的邮件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/cc31ee493ab3860a22fa53074da3ebba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Agg7wDkNipfzNAbrtzneIA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">失败的数据测试结果会在每次上传到S3时自动触发—图片由作者提供</p></figure><p id="c139" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的自定义警报的最大优点是，它们准确地显示了哪个S3文件上传导致了特定数据测试失败。当使用Great Expectations的默认实现时，这似乎很难完成。</p><p id="d502" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，使用纯粹基于pandas的期望使测试更容易，并且似乎比使用配置文件和Jupyter笔记本更“Pythonic化”。然而，这种方法的缺点是缺少数据文档。如果你关心那些，可以看看<a class="ae ky" href="https://docs.greatexpectations.io/en/latest/guides/tutorials/getting_started_v3_api.html" rel="noopener ugc nofollow" target="_blank">官方的《远大前程》教程</a>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="d291" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">如何监控这一过程</h1><p id="d065" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">可以想象，如果你用Lambda为大量S3数据集构建数据测试，监控会变得难以承受。<a class="ae ky" href="https://dashbird.io/" rel="noopener ugc nofollow" target="_blank"> Dashbird </a>是一个解决这个问题的平台，它通过提供仪表板和格式良好的日志来监控、警告和观察AWS上的无服务器资源。下图显示了<a class="ae ky" href="https://dashbird.io/" rel="noopener ugc nofollow" target="_blank"> Dashbird </a>如何帮助检测无服务器数据测试中的问题和瓶颈:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/a7af53e35c70d019f80a9f152c32c8dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-TnbGf00le5GfuBLnE7VVw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Dashbird中无服务器功能的监控——图片由作者提供</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/7ca6c3946bac12a96be1acfa7cfe5916.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kxd24PnfFMy8H3_nmU07hQ.png"/></div></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="7e81" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="ca81" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在本文中，我们研究了用于数据分析和测试的各种Python库。我们研究了使用Great Expectations的两种方法:传统的基于配置文件的方法，以及使用定制测试运行程序和电子邮件提醒的更“Pythonic化”的自己动手的方法。然后，我们研究了如何在本地执行数据测试，以及如何在任何新文件上传到S3后确保自动测试运行。</p><p id="d7c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>