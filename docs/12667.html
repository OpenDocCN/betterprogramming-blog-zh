<html>
<head>
<title>10 JavaScript Closure Challenges Explained With Diagrams</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用图表解释10个JavaScript闭包挑战</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/10-javascript-closure-challenges-explained-with-diagrams-c964110805e7?source=collection_archive---------0-----------------------#2022-06-21">https://betterprogramming.pub/10-javascript-closure-challenges-explained-with-diagrams-c964110805e7?source=collection_archive---------0-----------------------#2022-06-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5c3f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">破解面试问题</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cf8f9c69d9f89a8c9a25f27424b829e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SuMJFAftgtgWgwQIOYSjZQ.png"/></div></div></figure><p id="e56c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">闭包是函数式编程的核心概念之一，是每个JavaScript开发人员必备的知识。在这里，我准备了10个结束挑战，其中许多是在面试中经常被问到的。</p><p id="bc4e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">准备好了吗，挑战者？享受这次旅程吧！</p><p id="b35e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">每个挑战都是一段代码，你需要说出这段代码的输出是什么。</p><h1 id="0fe0" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">1.范围</h1><p id="fc35" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">在谈论闭包之前，我们必须了解作用域的概念，这是理解闭包的基石。</p><p id="f6b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码的输出是什么？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="3257" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这很简单。相信所有挑战者都知道输出结果是<code class="fe mp mq mr ms b">10</code>。</p><ul class=""><li id="df22" class="mt mu it kw b kx ky la lb ld mv lh mw ll mx lp my mz na nb bi translated">默认情况下，有一个全局范围。</li><li id="9a7e" class="mt mu it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">局部作用域是由函数或代码块创建的。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/688a85f0891a13f6c6a9679f49ae316d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OV3jQDTmy0ASNRrGz9pjSw.png"/></div></div></figure><p id="2cf0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当执行<code class="fe mp mq mr ms b">console.log(a)</code>时，JavaScript引擎将首先在由函数<code class="fe mp mq mr ms b">foo</code>创建的本地范围内寻找<code class="fe mp mq mr ms b">a</code>。当JavaScript引擎找不到<code class="fe mp mq mr ms b">a</code>时，它会尝试在它的外部作用域，也就是全局作用域中寻找<code class="fe mp mq mr ms b">a</code>。然后发现<code class="fe mp mq mr ms b">a</code>的值是10。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni mo l"/></div></figure><h1 id="144a" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">2.本地范围</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="6fdc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这段代码中，变量<code class="fe mp mq mr ms b">a</code>也存在于<code class="fe mp mq mr ms b">foo</code>的范围内。所以当执行<code class="fe mp mq mr ms b">console.log(a)</code>时，JavaScript引擎可以直接从本地范围获取<code class="fe mp mq mr ms b">a</code>的值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/f1226e51992b99d451dddc5c23d18b49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MVSsemPwf2vTpWRPU1bCCA.png"/></div></div></figure><p id="d0e5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以输出是<code class="fe mp mq mr ms b">20</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni mo l"/></div></figure><p id="5f9c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">记住:当JavaScript引擎需要查询一个变量的值时，它会先在局部范围内查找，如果没有找到该变量，它会继续在上层范围内查找。</p><h1 id="f04f" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">3.词法范围</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="9842" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个问题容易出错，也是面试中经常出现的问题。你可以考虑一下。</p><p id="f4ee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">简单地说，JavaScript实现了一个名为<em class="nj">词法作用域</em>的作用域机制(或者静态作用域)。之所以称之为<em class="nj">词法</em>(或<em class="nj">静态</em>)是因为引擎仅仅通过查看JavaScript源代码来确定作用域的嵌套，而不管它在哪里被调用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/1a182623bbfbbd7c269bba61e09a0e96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*675YjrNIItedvhzq9Fwk4A.png"/></div></div></figure><p id="0c87" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以输出是<code class="fe mp mq mr ms b">10</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni mo l"/></div></figure><h1 id="8a1e" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">4.修改的词法范围</h1><p id="5562" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">如果我们将代码片段更改为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="aecb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">产量是多少？</p><p id="b2c4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mp mq mr ms b">foo</code>作用域成为<code class="fe mp mq mr ms b">bar</code>作用域的子作用域:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/3f808a796bc77bfd9d17d58f81fdf2d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yAtKLS5DcylR15g-sLKQ5A.png"/></div></div></figure><p id="2283" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当JavaScript引擎在<code class="fe mp mq mr ms b">Foo</code>作用域中没有找到<code class="fe mp mq mr ms b">a</code>时，它会先从<code class="fe mp mq mr ms b">Foo</code>作用域的父作用域，也就是<code class="fe mp mq mr ms b">Bar</code>作用域中寻找<code class="fe mp mq mr ms b">a</code>，它确实找到了<code class="fe mp mq mr ms b">a</code>。</p><p id="4cc9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以输出是<code class="fe mp mq mr ms b">20</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni mo l"/></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="a7f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好了，以上是关于scope的一些基础挑战，相信你能顺利通过。现在我们开始进入收尾部分。</p><h1 id="41ec" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">5.关闭</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="7840" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">产量是多少？这段代码会抛出异常吗？</p><p id="4b26" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有了词法范围，<code class="fe mp mq mr ms b">innerFunc</code>仍然可以访问<code class="fe mp mq mr ms b">a</code>，即使是在其词法范围之外执行。</p><p id="0188" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">换句话说，<code class="fe mp mq mr ms b">innerFunc</code> <strong class="kw iu">从其词法范围记忆(或关闭)</strong>变量<code class="fe mp mq mr ms b">a</code>。</p><p id="8830" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">换句话说，<code class="fe mp mq mr ms b">innerFunc</code>是一个<strong class="kw iu">闭包</strong>，因为它从词法范围封闭了变量a。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/3b4c77e59613993a0d51d27a650f14cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3N_ISF7wV_FghkpTsHt6Yw.png"/></div></div></figure><p id="bd39" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以这段代码不是抛出异常，而是输出10。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni mo l"/></div></figure><h1 id="04ae" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">6.生活</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="0e21" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个代码片段使用JavaScript即时调用函数表达式(IIFE)。</p><p id="39c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以简单地将这段代码翻译成这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="3679" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以输出是<code class="fe mp mq mr ms b">0</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni mo l"/></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="947b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">闭包的一个经典应用是隐藏变量。</p><p id="5532" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">比如你现在想写一个计数器，基本的写法是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="0ad0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">可以这样写，但是全局范围内会多一个变量<code class="fe mp mq mr ms b">i</code>，不好。</p><p id="6c1b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这时候我们可以用闭包来隐藏这个变量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="c83b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这样变量<code class="fe mp mq mr ms b">i</code>隐藏在局部范围内，不会污染全局环境。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="e3e3" class="lq lr it bd ls lt nu lv lw lx nv lz ma jz nw ka mc kc nx kd me kf ny kg mg mh bi translated">7.多重声明和用法</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="7c58" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这段代码中，有两个<code class="fe mp mq mr ms b">count</code>的声明和三个<code class="fe mp mq mr ms b">count</code>的用法。这是一个难题，你应该仔细考虑一下。</p><p id="fa8a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先我们要知道<code class="fe mp mq mr ms b">if</code>代码块也创建了一个局部作用域，上面的作用域大致是这样的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/354089384b386cf5afccc8747b99310e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-x6V1JX77oi3ZaA5YdVNVQ.png"/></div></div></figure><ul class=""><li id="2d31" class="mt mu it kw b kx ky la lb ld mv lh mw ll mx lp my mz na nb bi translated">函数作用域没有声明自己的<code class="fe mp mq mr ms b">count</code>，所以我们在这个作用域中使用的<code class="fe mp mq mr ms b">count</code>就是全局作用域的<code class="fe mp mq mr ms b">count</code>。</li><li id="2805" class="mt mu it kw b kx nc la nd ld ne lh nf ll ng lp my mz na nb bi translated">If作用域声明了自己的<code class="fe mp mq mr ms b">count</code>，所以我们在这个作用域中使用的<code class="fe mp mq mr ms b">count</code>就是当前作用域的<code class="fe mp mq mr ms b">count</code>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/cf36ff0325c7be30c269452661cc209b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V4gOy26_d-jYvIkWDOZAlw.png"/></div></div></figure><p id="6303" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">或者在这个图表中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/126cca8e0037549e4e03e1a67ab72cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gu1fA8RCEvyJWRoazNHQeQ.png"/></div></div></figure><p id="b87d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以输出是<code class="fe mp mq mr ms b">1</code>，<code class="fe mp mq mr ms b">0</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni mo l"/></div></figure><h1 id="2936" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">8.调用多个闭包</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="d4d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里需要注意的是，<code class="fe mp mq mr ms b">increase1</code>和<code class="fe mp mq mr ms b">increase2</code>是由对<code class="fe mp mq mr ms b">createCounter</code>的不同函数调用创建的，它们不共享内存，它们的<code class="fe mp mq mr ms b">i</code>是独立的不同的。</p><p id="c556" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以输出是<code class="fe mp mq mr ms b">1</code>、<code class="fe mp mq mr ms b">2</code>、<code class="fe mp mq mr ms b">1</code>、<code class="fe mp mq mr ms b">2</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni mo l"/></div></figure><h1 id="e707" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">9.返回函数</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="1c44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码很好理解，但是有一个陷阱:<code class="fe mp mq mr ms b">message</code>其实是一个静态字符串，它的值固定为<code class="fe mp mq mr ms b">Count is 0</code>，在我们调用<code class="fe mp mq mr ms b">increase</code>或者<code class="fe mp mq mr ms b">log</code>的时候不会改变。</p><p id="57fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以每次调用<code class="fe mp mq mr ms b">log</code>函数，输出结果总是<code class="fe mp mq mr ms b">Count is 0</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni mo l"/></div></figure><p id="b42a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果想让<code class="fe mp mq mr ms b">log</code>功能及时检查<code class="fe mp mq mr ms b">count</code>的值，将<code class="fe mp mq mr ms b">message</code>移入<code class="fe mp mq mr ms b">log</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni mo l"/></div></figure><h1 id="c211" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">10.异步闭包</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="a22d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">产量是多少？</p><p id="327d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码相当于:</p><pre class="kj kk kl km gt oc ms od oe aw of bi"><span id="bd1c" class="og lr it ms b gy oh oi l oj ok">var i = 0;<br/>setTimeout(function(){<br/>  console.log(i);<br/>},0)</span><span id="7b0a" class="og lr it ms b gy ol oi l oj ok">i = 1;<br/>setTimeout(function(){<br/>  console.log(i);<br/>},0)</span><span id="4be9" class="og lr it ms b gy ol oi l oj ok">i = 2;<br/>setTimeout(function(){<br/>  console.log(i);<br/>},0)</span><span id="06df" class="og lr it ms b gy ol oi l oj ok">i = 3;<br/>setTimeout(function(){<br/>  console.log(i);<br/>},0)</span><span id="b50c" class="og lr it ms b gy ol oi l oj ok">i = 4;<br/>setTimeout(function(){<br/>  console.log(i);<br/>},0)</span><span id="3807" class="og lr it ms b gy ol oi l oj ok">i = 5</span></pre><p id="3865" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">而且我们知道JavaScript会先执行同步代码，再执行异步代码。所以每次执行<code class="fe mp mq mr ms b">console.log(i)</code>的时候，<code class="fe mp mq mr ms b">i</code>的值就已经变成5了。</p><p id="6d33" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以输出是<code class="fe mp mq mr ms b">5</code>、<code class="fe mp mq mr ms b">5</code>、<code class="fe mp mq mr ms b">5</code>、<code class="fe mp mq mr ms b">5</code>、<code class="fe mp mq mr ms b">5</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni mo l"/></div></figure><p id="58e6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们想要代码输出<code class="fe mp mq mr ms b">0</code>、<code class="fe mp mq mr ms b">1</code>、<code class="fe mp mq mr ms b">2</code>、<code class="fe mp mq mr ms b">3</code>、<code class="fe mp mq mr ms b">4</code>，我们该怎么做？</p><p id="1102" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用闭包的解决方案是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni mo l"/></div></figure><p id="f649" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码相当于:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="6a9a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们通过JavaScript直接调用函数表达式来创建函数作用域。并通过闭包保存<code class="fe mp mq mr ms b">i</code>的值。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="77c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">恭喜你，聪明的挑战者！</p><p id="bb3e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您已成功完成挑战。相信在代码面试的时候，闭包相关的问题不会再困扰你了。</p><div class="om on gp gr oo"><div role="button" tabindex="0" class="ab bv gv cb fp op oq bn or ks ex"><div class="os l"><div class="ab q"><div class="l di"><img alt="bytefish" class="l de bw ot ou fe" src="../Images/743f175620c9b16012604fb316b07c94.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*XYGoKrb1w5zdWZLOIEevZg.png"/><div class="fb bw l ot ou fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://bytefish.medium.com/?source=post_page-----c964110805e7--------------------------------" rel="noopener follow" target="_top">字节鱼</a></p></div></div><div class="ox oy gw l"><h2 class="bd iu ui mt fp uj fr fs uk fu fw is bi translated">代码挑战</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi ul au um un uo qr up an eh ei uq ur us el em eo de bk ep" href="https://bytefish.medium.com/list/code-chanllenge-0b76b6b40281?source=post_page-----c964110805e7--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ut l fo"><span class="bd b dl z dk">6 stories</span></div></div></div><div class="pk dh pl fp ab pm fo di"><div class="di pc bv pd pe"><div class="dh l"><img alt="" class="dh" src="../Images/ce8c30dad1da5ea7c909f23934f6d155.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*Y2xYjpFhfBZE1KU7KwQZCQ.png"/></div></div><div class="di pc bv pf pg ph"><div class="dh l"><img alt="" class="dh" src="../Images/8145bdfa6b9e6e337f7e29dedbc214da.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*MwzhMcgh0temRk4B5jbIyQ.png"/></div></div><div class="di bv pi pj ph"><div class="dh l"><img alt="" class="dh" src="../Images/8bc4ef15a3276489d08617dc5abf26bb.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*SuMJFAftgtgWgwQIOYSjZQ.png"/></div></div></div></div></div></div></div>    
</body>
</html>