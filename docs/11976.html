<html>
<head>
<title>When to Use Angular ControlValueAccessor and What’s the Difference Without It?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么时候使用Angular ControlValueAccessor，没有它有什么区别？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/angular-with-controlvalueaccessor-and-without-less-boilerplate-da27f0a16639?source=collection_archive---------5-----------------------#2022-05-02">https://betterprogramming.pub/angular-with-controlvalueaccessor-and-without-less-boilerplate-da27f0a16639?source=collection_archive---------5-----------------------#2022-05-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="f578" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">角形</h2><div class=""/><div class=""><h2 id="e081" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">带ControlValueAccessor和不带less样板文件的Angular。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/6c4d2c512a0869f9403b36d3d2432466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L39XMxf0AI_Jq5b7gsSqFQ.jpeg"/></div></div></figure><p id="28a6" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">今天我们来研究一下<code class="fe lw lx ly lz b">ControlValueAccessor</code>的用法，什么时候应该使用，什么时候是多余的。</p><p id="f565" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe lw lx ly lz b">ControlValueAccessor</code>提供了将<code class="fe lw lx ly lz b">FormControl</code>用于任何实现该接口的组件的能力。这提供了很大的开发灵活性，是<code class="fe lw lx ly lz b">Angular Forms</code>中的一个有用特性。</p><p id="697a" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">有几种方法可以用样板文件来控制装饰和使用。我们来看一下，用一个例子找出不同之处。</p><h2 id="5735" class="ma mb iq bd mc md me dn mf mg mh dp mi lj mj mk ml ln mm mn mo lr mp mq mr iw bi translated">例子</h2><p id="373b" class="pw-post-body-paragraph la lb iq lc b ld ms ka lf lg mt kd li lj mu ll lm ln mv lp lq lr mw lt lu lv ij bi translated">假设我们需要创建一个计数器组件，并通过<code class="fe lw lx ly lz b">FormControl</code>使用它的值。</p><p id="9e26" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">带<code class="fe lw lx ly lz b">ControlValueAccessor</code>的计数器组件代码:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="812b" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">很多代码，是吗？</p><p id="f814" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">用在这种情况下太复杂了。什么更好——用<code class="fe lw lx ly lz b">ControlValueAccessor</code>样板文件创建一个抽象类并继承它。但这个时候其实没那个必要。</p><p id="c8ab" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们能不能简化组件？当然可以:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="af14" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">非常简单的组件。但是这种简单性给我们带来了什么限制呢？</p><ul class=""><li id="b258" class="mz na iq lc b ld le lg lh lj nb ln nc lr nd lv ne nf ng nh bi translated">首先，我们要直接传递控制，而不是用<code class="fe lw lx ly lz b">FormControlName</code>或<code class="fe lw lx ly lz b">ngModel</code>:</li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mx my l"/></div></figure><ul class=""><li id="a2e3" class="mz na iq lc b ld le lg lh lj nb ln nc lr nd lv ne nf ng nh bi translated">第二，我们失去了模板验证器，不能像这样使用它:</li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mx my l"/></div></figure><h2 id="1217" class="ma mb iq bd mc md me dn mf mg mh dp mi lj mj mk ml ln mm mn mo lr mp mq mr iw bi translated">丰富</h2><p id="d25f" class="pw-post-body-paragraph la lb iq lc b ld ms ka lf lg mt kd li lj mu ll lm ln mv lp lq lr mw lt lu lv ij bi translated">我们怎样才能让我们的代码变得更好？</p><p id="b644" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">让我们将<code class="fe lw lx ly lz b">formControl</code>直接传递给<code class="fe lw lx ly lz b">@Input</code>用作角度指令。但是，如果我们这样做，将会出现一个错误，错误:没有带有未指定名称属性的表单控件的值访问器。这个错误可以用另一个指令<code class="fe lw lx ly lz b">ngDefaultControl</code>修复:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="5133" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在它可以很好地与模板验证器一起工作，并且没有错误。</p><p id="8ab1" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">另一个技巧是，如果控件在<code class="fe lw lx ly lz b">FormGroup</code>中使用，我们必须用函数传递控件。但是不要这样，只要使用一个纯的<code class="fe lw lx ly lz b">pipe</code>就可以了，每次<code class="fe lw lx ly lz b">ChangeDetection</code>通过都不需要重新计算。例如:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="9a48" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">最后，我们的反控制变成了:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="7656" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">希望这篇文章对你有帮助。</p><p id="72b7" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">谢了。</p></div></div>    
</body>
</html>