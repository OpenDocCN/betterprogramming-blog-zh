<html>
<head>
<title>How to Handle Exceptions in Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何处理Flask中的异常</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-handle-exceptions-in-flask-b1d9c151875b?source=collection_archive---------6-----------------------#2020-09-02">https://betterprogramming.pub/how-to-handle-exceptions-in-flask-b1d9c151875b?source=collection_archive---------6-----------------------#2020-09-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="09b5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更好的警报处理有助于更好的编程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5c63acf00277c662fb96b2ff7fafea0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1X0-98EiQNkwBJj2vnTTqQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯·里德在<a class="ae ky" href="https://unsplash.com/s/photos/coding-flask?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="e1b9" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">什么是Python异常？</strong></h1><p id="605b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">本教程将向您介绍异常以及如何在Flask中处理异常。本教程结束时，您将能够为您的代码创建自定义异常。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="5143" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">运行程序，输入字符串而不是数字作为输入。如果你运行这个程序，只要输入是一个整数，它就会工作。如果你输入一个字符串而不是一个数字，你会得到一个<code class="fe mu mv mw mx b">ValueError</code>，如下所示。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="2b2a" class="nc la it mx b gy nd ne l nf ng">Please enter a number between 1 and 10: fur<br/>Traceback (most recent call last):<br/>File “main.py”, line 9, in &lt;module&gt;<br/>number = int(input(‘Please enter a number between 1 and 10: ‘))<br/>ValueError: invalid literal for int() with base 10: ‘b’</span></pre><p id="1aa2" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">上面的程序计算用户输入的数字的平方。但是假设用户输入一个字符串或一个特殊字符，如果程序不检查输入是否是一个有效的整数，程序将抛出一个异常。</p><p id="19f9" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">因此，重要的是在错误发生的地方捕获错误，而不是等待整个程序崩溃。我们将包含<code class="fe mu mv mw mx b">try</code> / <code class="fe mu mv mw mx b">except</code>子句来捕捉程序中可能出现的任何错误。该程序将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="ee9a" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">在Python中，我们使用<code class="fe mu mv mw mx b">try</code>和<code class="fe mu mv mw mx b">except</code>块来捕捉和处理异常。<code class="fe mu mv mw mx b">try</code>语句后的代码是Python作为程序的正常部分执行的。在<code class="fe mu mv mw mx b">except</code>语句之后，代码是程序对前面try子句中任何异常的响应。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="289e" class="kz la it bd lb lc no le lf lg np li lj jz nq ka ll kc nr kd ln kf ns kg lp lq bi translated">为什么在Flask中处理异常很重要？</h1><ul class=""><li id="6c86" class="nt nu it lt b lu lv lx ly ma nv me nw mi nx mm ny nz oa ob bi translated"><strong class="lt iu">实现程序的平稳运行:</strong>在每一个可能的方面处理异常可以让你的代码平稳运行，不管有什么错误</li><li id="87f6" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated"><strong class="lt iu">安全目的:</strong>从安全角度处理异常也有助于保护您的程序，因为您不太可能将您的代码配置泄露或暴露给随机的人</li></ul><h2 id="0e8a" class="nc la it bd lb oh oi dn lf oj ok dp lj ma ol om ll me on oo ln mi op oq lp or bi translated">烧瓶支架API示例</h2><p id="27e1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您将使用Flask API来实现您自己的可浏览API。</p><p id="93f7" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">您将为库存储开发一个REST API。API将能够:</p><ul class=""><li id="d224" class="nt nu it lt b lu mp lx mq ma os me ot mi ou mm ny nz oa ob bi translated">添加新的图书条目</li><li id="6b20" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">查看图书馆中所有可用的书籍</li></ul><h2 id="37f5" class="nc la it bd lb oh oi dn lf oj ok dp lj ma ol om ll me on oo ln mi op oq lp or bi translated">先决条件</h2><p id="6309" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">该项目将使用以下依赖项</p><ul class=""><li id="b5f9" class="nt nu it lt b lu mp lx mq ma os me ot mi ou mm ny nz oa ob bi translated">计算机编程语言</li><li id="9de2" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">瓶</li><li id="77dc" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">烧瓶化学</li><li id="cd64" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">烧瓶API</li></ul><ol class=""><li id="a6b9" class="nt nu it lt b lu mp lx mq ma os me ot mi ou mm ov nz oa ob bi translated">创建新项目。</li></ol><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="2b03" class="nc la it mx b gy nd ne l nf ng">mkdir library</span></pre><p id="deb0" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">2.创建并激活虚拟环境。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="2396" class="nc la it mx b gy nd ne l nf ng">cd library<br/>python3.6 -m venv env<br/>source env/bin/activate</span></pre><p id="19db" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">3.安装所有依赖项。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="6959" class="nc la it mx b gy nd ne l nf ng">(env)$ pip install flask<br/>(env)$ pip install flask-sqlalchemy<br/>(env)$ pip install flask-api<br/>(env)$ pip freeze &gt; requirements.txt</span></pre><p id="8f17" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">4.创建文件和文件夹以匹配如下所示的目录结构:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/35039673637414cd90dafed45efa7753.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RmIPxzmKYSLDs2GKyZG56g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">目录</p></figure><h2 id="4f3b" class="nc la it bd lb oh oi dn lf oj ok dp lj ma ol om ll me on oo ln mi op oq lp or bi translated">数据库配置</h2><p id="e437" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您将使用SQLite数据库和Flask-SQLAlchemy。SQLAlchemy是一个Flask扩展，为SQLAlchemy提供支持。</p><p id="02ce" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">定义数据库的配置。</p><p id="bf92" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">在<code class="fe mu mv mw mx b">app/__init__.py</code>文件中，添加以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="fd45" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated"><strong class="lt iu">型号</strong></p><p id="f01e" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">将以下内容添加到<code class="fe mu mv mw mx b">models.py</code>文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="ef35" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">接下来，定义启动应用程序的入口点。在<code class="fe mu mv mw mx b">run.py</code>文件中，添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="b47d" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated"><code class="fe mu mv mw mx b">db.create.all()</code>首次运行应用程序时，会创建数据库表格。设置<code class="fe mu mv mw mx b">debug = true</code>对于调试应用程序很重要，但不建议在生产中使用。</p><p id="7030" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">在终端中运行以下命令:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="bc0a" class="nc la it mx b gy nd ne l nf ng">(env)$ python run.py</span></pre><p id="a18e" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">让我们定义第一条路由，看看如何处理异常。在<code class="fe mu mv mw mx b">run.py</code>文件中，添加以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="fc90" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">现在再次运行应用程序:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="c2e9" class="nc la it mx b gy nd ne l nf ng">python run.py</span></pre><p id="2477" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">在浏览器上导航到<code class="fe mu mv mw mx b"><a class="ae ky" href="http://localhost:5000/books/" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/books/</a></code>，您应该会看到一个空的图书列表，因为您还没有添加任何图书条目。添加几个图书条目，并刷新页面。</p><p id="54d3" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated"><strong class="lt iu">处理异常</strong></p><p id="0bd7" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">POST请求需要来自用户的数据。然而，如果没有任何输入数据要发送，这个程序可能会出错。代码将抛出一个错误，如堆栈跟踪所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/3cb4d2e949665db8ecab152e7f5a4356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1oDDITxo8VGYptqJ2jEYvA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">堆栈跟踪错误</p></figure><p id="b84f" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">因此，如果POST请求中没有数据，您将需要引发一个异常。Flask带有内置异常，您可以引发这些异常。也可以使用<code class="fe mu mv mw mx b">APIException</code>的子类。如果POST请求中没有数据，我们将使用<code class="fe mu mv mw mx b">APIException</code>类引发一个异常。</p><ol class=""><li id="f149" class="nt nu it lt b lu mp lx mq ma os me ot mi ou mm ov nz oa ob bi translated">在app目录中创建一个文件<code class="fe mu mv mw mx b">error.py</code>，并添加下面的代码。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="4e85" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">2.编辑POST请求以引发<code class="fe mu mv mw mx b">InvalidParameter</code>异常。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="9390" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">3.现在，当您在没有数据的情况下执行POST请求时，响应将如下所示:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="1700" class="nc la it mx b gy nd ne l nf ng">HTTP 404 NOT FOUND<br/>Content-Type: application/json<br/>{<br/>“message”: “Invalid parameters”<br/>}</span></pre><h2 id="4286" class="nc la it bd lb oh oi dn lf oj ok dp lj ma ol om ll me on oo ln mi op oq lp or bi translated">自定义错误</h2><p id="7389" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">有时，如果一条路线不存在，您可能希望返回404错误—例如，一本书的ID号是这样的:<code class="fe mu mv mw mx b"><a class="ae ky" href="http://127.0.0.1:5000/books" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000/books</a>/20000</code>可能存在<strong class="lt iu">。</strong>如果用户试图访问此类URL，则会执行一个路由，并返回如下404错误:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="6b25" class="nc la it mx b gy nd ne l nf ng">Not Found<br/>The requested URL was not found on the server. If you entered the URL manually, please check your spelling and try again.</span></pre><p id="ad85" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">每当找不到页面时，就会显示404错误；每当用户导航到一个不存在的页面时，拥有一个定制的错误页面是非常重要的。</p><p id="6c09" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">您可以创建一个定制的404页面来处理这种错误。您需要在<code class="fe mu mv mw mx b">__init__.py</code>文件中创建一个404模板文件和一个404函数。</p><ol class=""><li id="8ece" class="nt nu it lt b lu mp lx mq ma os me ot mi ou mm ov nz oa ob bi translated">在<code class="fe mu mv mw mx b">app</code>目录下的<code class="fe mu mv mw mx b">templates</code>文件夹中创建一个名为<code class="fe mu mv mw mx b">404.html</code>的新文件，并添加以下内容:</li></ol><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="29a2" class="nc la it mx b gy nd ne l nf ng">{% block body %}<br/>&lt;h1&gt;Page Not Found&lt;/h1&gt;<br/>&lt;p&gt;Woops, that page doesn’t exist! (404)&lt;/p&gt;<br/>&lt;p&gt;Take me back &lt;a href=”{{ url_for(‘index’) }}”&gt;HOME&lt;/a&gt;<br/>{% endblock %}</span></pre><p id="a40f" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">2.接下来，将错误处理程序包装添加到<em class="oy"> </em> <code class="fe mu mv mw mx b">__init__.py</code>文件中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="76a8" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">3.不要忘记渲染模板的导入。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="75e1" class="nc la it mx b gy nd ne l nf ng">from flask import request, render_template</span></pre><p id="91a3" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">4.现在，当用户导航到不存在的页面时，他们会看到以下消息:</p><blockquote class="oz pa pb"><p id="723e" class="lr ls oy lt b lu mp ju lw lx mq jx lz pc mr mc md pd ms mg mh pe mt mk ml mm im bi translated">找不到页面</p><p id="2ef7" class="lr ls oy lt b lu mp ju lw lx mq jx lz pc mr mc md pd ms mg mh pe mt mk ml mm im bi translated">Woops，那个页面不存在！(404)</p><p id="c0bc" class="lr ls oy lt b lu mp ju lw lx mq jx lz pc mr mc md pd ms mg mh pe mt mk ml mm im bi translated">带我回<a class="ae ky" href="http://127.0.0.1:5000/books" rel="noopener ugc nofollow" target="_blank">家</a></p></blockquote></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="6126" class="kz la it bd lb lc no le lf lg np li lj jz nq ka ll kc nr kd ln kf ns kg lp lq bi translated">结论</h1><p id="498e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">希望本文已经帮助您理解了如何处理异常。你可以在Flask <a class="ae ky" href="http://flask.pocoo.org/docs/0.12/patterns/apierrors/l" rel="noopener ugc nofollow" target="_blank">文档</a>网站上找到更多信息。</p></div></div>    
</body>
</html>