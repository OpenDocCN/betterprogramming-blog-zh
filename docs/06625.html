<html>
<head>
<title>Animating Your Bar Chart With Combine Messages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用组合消息制作条形图动画</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/animating-your-bar-chart-with-combine-messages-d703c4266273?source=collection_archive---------14-----------------------#2020-10-19">https://betterprogramming.pub/animating-your-bar-chart-with-combine-messages-d703c4266273?source=collection_archive---------14-----------------------#2020-10-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="22fa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">“在SwiftUI中将动画链接在一起以构建条形图”的第2部分</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/593b173794c2abf7fb3aaf62a5e71b14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Tceu9u9T_zQA33eFwLFzRg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原生Swift UI动画条形图</p></figure><p id="767e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">前几天我写了一篇文章，其中我谈到了构建基本的条形图:“<a class="ae lu" href="https://medium.com/better-programming/linking-animations-together-to-build-bar-charts-in-swiftui-6a51e3c9bb94" rel="noopener">在SwiftUI </a>中将动画链接在一起以构建条形图。”我不会再发布最终代码，但我会展示我们成功构建的内容。</p><p id="834e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">简而言之，这是一个动画，自动着色，数据刷新的条形图。我保持了甜蜜和简短，但不禁觉得我想做得更多。</p><p id="3a7d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们根据条形图主题做一个新的简报。这里有一个愿望清单:</p><ul class=""><li id="3805" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">目前，值是标签。我想添加第二个文本标签。</li><li id="99f5" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">目前，我没有任何轴上的图例。我们试着加一个。</li><li id="e62a" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">我希望能够动态删除酒吧留下其他地方。</li><li id="9547" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">我希望能够动态插入酒吧离开其他地方。</li><li id="a2ad" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">我希望能够呈现排序的酒吧，最大的第一或最后(视觉上，理想)。</li><li id="ebf2" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">我希望能够改变用于酒吧的颜色(即，覆盖自动着色。)</li></ul><p id="22d6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些事情有些很容易，有些不那么容易——至少有一件是几乎不可能的——所以让我们开始吧。</p><p id="fc6f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将从文本标签开始，因为仅显示值的条形图并不那么有用。我也想添加一个轴标签。我们在找这个。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4280a97a2baf213b78af93d812210a8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*WMP8QzT-hYjV1fM_dd1wDw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带轴和标签的动画条形图</p></figure><p id="34c4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好吧，它并不完美…轴心真的不应该被动画化成那样，但这是一个进步。我是怎么做到的？显然，它基于上一篇文章中的代码，只是我交换了轴，添加了一个文本字段作为第二个发布对象，并对布局代码做了一些小的修改。</p><p id="a182" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Bon，这已经是愿望清单的一半了——告诉你有些愿望并不难。后半段呢？为此，我将使用SwiftUI 1.0中可用的Combine框架，并用它创建一个动作集合。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="9097" class="mo mp it mk b gy mq mr l ms mt">var hideColumn = PassthroughSubject&lt;String,Never&gt;()<br/>var showColumn = PassthroughSubject&lt;String,Never&gt;()<br/>var changeColumn = PassthroughSubject&lt;(String,String),Never&gt;()<br/>var changeFigure = PassthroughSubject&lt;(String,Int),Never&gt;()</span></pre><p id="1e15" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">实际上，添加代码来匹配这些操作，并更改我们的条形图。现在我使用switch语句来测试一切(仅限SwiftUI 2.0)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="7acb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">代码将告诉条形图隐藏两列，将一列带回来，更改几个列名，然后更改葡萄、菠萝和桃子类别的一些值。让我们来看看它的作用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a2fc463fb33693789fb44a3cf989021f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*QbaO_mnLp-Dlk5B_oQCBTg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有名称更改、值更改、列更改的动画条形图</p></figure><p id="91cb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">仍有工作要做，但我们正在取得进展。几个悬而未决的问题:</p><ul class=""><li id="1312" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">当我们隐藏一列时，除非我们删除它，否则它会继续占用空间。</li><li id="d93d" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">显然，如果我们隐藏并删除了一个列，那么不幸的是，还没有办法将它重新插入。</li><li id="e9e0" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">当我们改变棒线的值时，指数的移动不仅非常明显，而且非常烦人。</li></ul><p id="2126" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们继续吧。继续沿着这条路走下去，我可以使用Combine框架向我们的代码中再添加三个动作。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="0681" class="mo mp it mk b gy mq mr l ms mt">enum sortDirection {<br/>  case accending, decending<br/>}</span><span id="1e5c" class="mo mp it mk b gy mw mr l ms mt">var changeColour = PassthroughSubject&lt;(String, Color),Never&gt;()<br/>var insertColumn = PassthroughSubject&lt;(String,Bool),Never&gt;()<br/>var sortColumns = PassthroughSubject&lt;sortDirection,Never&gt;()</span></pre><p id="2ff2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尽管等等——这显示了我们设计中的一个缺陷。您看，尽管您可以轻松地插入列和/或对它们进行排序，但当前的数据模型将这两项视为单独的元素，即字符串和整数。旧代码如下所示:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="e97d" class="mo mp it mk b gy mq mr l ms mt">final class Figures: ObservableObject {<br/>  @Published var text = ["Apples","Apricot","Bananas","Blueberry","Figs","Papaya","Pears","Pineapples","Peaches","Plums"]<br/>  @Published var numbers = [90,80,70,60,50,40,30,20,10]<br/>  static var shared = Figures()<br/>}</span></pre><p id="d260" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我们需要重构的代码；显然，这也对我们代码的其余部分有一点影响。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="2d67" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">鉴于数字现在包含在描述旁边的结构中，我们可以很容易地对它们进行排序。让我们使用case语句进行更多的测试。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="57f6" class="mo mp it mk b gy mq mr l ms mt">case 0:<br/>  insertColumn.send(("Cherries",45))<br/>case 1:<br/>  sortColumns.send(.accending)<br/>case 2:<br/>  changeColour.send(("Cherries",.yellow))</span></pre><p id="7e38" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第一次点击将告诉我们的应用程序在图表中添加一个樱桃条。第二次点击将告诉它对条形图进行数字排序，第三次点击将手动改变新樱桃条的颜色。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/90e2cc2d6587ae46e454476241df8e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ooG3t89DSjG9aUWy4l3lkA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示添加的列、排序的列、更改的列颜色的动画条形图</p></figure><p id="e6be" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">和以前一样，它并不完美。理想情况下，我们希望对屏幕上的条形进行排序，并且我们仍然让该轴在屏幕上移动。尽管如此，我担心我又没有时间了。我们确实设法初步实现了愿望清单上的所有六个项目。相当不错。</p><p id="70b4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里是该项目的完整代码，供您浏览和使用。我可能还会考虑做更多的图表，不同类型的图表。跟着我，保持联系。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="83d4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作业:排序是纯数字的，但是你可以创建一个字母排序。排序只是对升序值进行排序，因此您可以添加一个降序选项。轴上的标签需要固定，这样它们就不会乱动了。屏幕排序也许是可能的，尽管我还不确定如何实现——也许你能找到一个解决方案。颜色与值相关联，最好将它们与文本标签相关联。</p><p id="9851" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">保持冷静，继续编码。</p></div></div>    
</body>
</html>