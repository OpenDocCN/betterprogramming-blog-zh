<html>
<head>
<title>Android App Bundles vs. APKs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android应用捆绑包与apk</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/android-app-bundles-vs-apks-8b0306b38436?source=collection_archive---------1-----------------------#2020-04-26">https://betterprogramming.pub/android-app-bundles-vs-apks-8b0306b38436?source=collection_archive---------1-----------------------#2020-04-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="538b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">AABs和APKs:它们是什么，有什么区别？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dcb39b115fd091af87fc50ea81c0171b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xBhXp0EkJx1PkO6yL-SfGw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@iammrcup?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">杯先生/杨奇煜·巴拉</a>在<a class="ae ky" href="https://unsplash.com/s/photos/archive?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="d549" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当构建Android应用程序时，你会面临无数不同的文件格式和术语。尤其是在导出应用程序的最终版本时，您会看到两种主要的输出格式。在本文中，我们将比较Android应用捆绑包和APK，后者由DEX文件组成。但是所有这些缩写是什么意思呢？</p><h2 id="3ec6" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">缩写含义</h2><p id="79d3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在深入探讨这些主题之前，了解上述每种格式的定义非常重要:</p><ul class=""><li id="7a08" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">AAB: 安卓应用捆绑包</li><li id="ee93" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><strong class="lb iu"> APK: </strong>安卓应用包</li><li id="7943" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">达尔维克可执行文件</li></ul></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="92e1" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">APK:安卓应用包</h1><p id="6931" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">让我们从回顾这种格式开始，因为它是最广为人知的格式，也是存在时间最长的格式。如上所述，APK代表<em class="nz">安卓应用包</em>。APK基本上是一个可以安装在用户设备上的文件。</p><p id="8917" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">apk里面有所有的应用程序文件和代码。你可以把它想象成一个<code class="fe oa ob oc od b">.zip</code>文件，但是有自己特定的扩展名。就像你可以在<code class="fe oa ob oc od b">.rar</code>或者<code class="fe oa ob oc od b">.zip</code>中找到带扩展名的压缩文件一样，你可以拥有<code class="fe oa ob oc od b">.apk</code>。它主要由Android平台理解，但是如果其他平台拥有与Android相同的底层架构，它们也可以支持它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/d9238b5fca845ea5eb2429be5c5364a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*etu_IEvroMhPG8I3P1Cwpw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">查尔斯·德鲁维奥在<a class="ae ky" href="https://unsplash.com/s/photos/up?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="d7e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">APK已经用该应用的证书进行了签名，该证书是一个标识Play Store中每个应用的文件。这个文件必须由开发人员在应用程序的整个生命周期中保存，因为不可能再次生成它。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="e7cc" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">AAB:安卓应用捆绑包</h1><p id="6579" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">AAB，代表安卓应用捆绑包T21，是一种更新的安卓分发格式。<a class="ae ky" href="https://developer.android.com/guide/app-bundle" rel="noopener ugc nofollow" target="_blank"> Android的官方文档</a>给出了如下定义:</p><blockquote class="of og oh"><p id="ca64" class="kz la nz lb b lc ld ju le lf lg jx lh oi lj lk ll oj ln lo lp ok lr ls lt lu im bi translated"><em class="it">“一个</em> Android应用捆绑包<em class="it">是一种发布格式，包括你的应用的所有编译代码和资源，并将APK的生成和签署委托给Google Play。”</em></p></blockquote><p id="bcf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些应用捆绑包相当新——它们是在Google I/O 2018中引入的。他们快两岁了。但从那以后，它们成了发布Android应用的官方格式。</p><p id="9414" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如APK是扩展名一样，AAB文件也有扩展名<code class="fe oa ob oc od b">.aab</code>。Android文档提供了解释aab如何组成的图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/946b8444e633560a776e01f5cb8fbf8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P61J7xJHlgsXyqASTbvLuw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://developer.android.com/guide/app-bundle" rel="noopener ugc nofollow" target="_blank"> Android </a>文档</p></figure><p id="6fe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有一个APK，你只会有应用程序的橙色部分，它将拥有所有的资产，这意味着你只能有一个包，没有动态功能。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="51bd" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">资产包</h1><p id="5ef3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">资产包是针对一组设备的文件组。当使用传统的APK时，应用程序将接收所有的资产，并只选择和使用特定设备所需的资产。</p><p id="27a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，当使用AAB时，Play Store会选择用户下载应用程序时需要的资源。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="b6ac" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">动态特征</h1><p id="bd21" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这些功能是首次安装应用程序时可能不需要的模块。您可以在用户请求添加该功能时下载它们，或者下载应用程序，然后在后台开始下载它们，让用户在使用您的应用程序时有一个良好的开端。</p><p id="6b97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了安装动态特性，我们有SplitInstallManager，它将由<a class="ae ky" href="https://developer.android.com/guide/playcore" rel="noopener ugc nofollow" target="_blank"> Play核心库</a>管理，后者直接与Play Store通信。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="7c74" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">Android应用捆绑包相对于APK的优势</h1><p id="5471" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Android强调了使用apk的几个缺点:</p><ul class=""><li id="e01d" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">较低的转化率</li><li id="027c" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">下载速度较慢</li><li id="08ea" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">更高的卸载</li><li id="68b7" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">更低的更新率</li></ul><h2 id="3386" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">大小</h2><p id="9c80" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">第一个优点是尺寸减小。有了资产包和动态特性，应用程序平均缩小了35%。但是一些应用程序的大小减少了50%左右。</p><p id="f3c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AABs推出后，一个app的最大大小是150 MB。通过使用APK，您可以轻松超越这一要求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/9b34e956b3f5dde984c3c47471c81746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dO0kC51jCHv73uiMcZA-cg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">罗布·汉普森在<a class="ae ky" href="https://unsplash.com/s/photos/users?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="52d3" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">未压缩的本地库</h2><p id="eff8" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">出于某种原因，当你有一个APK时，应用程序会以压缩格式获得所需的所有本地库的副本。下载后，设备通过创建一个副本来解压缩这些库，因为没有解压缩它就不能使用它们。最后，你会有两个库的副本。</p><p id="4e14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当比较Android应用捆绑包和APK时，你会注意到AAB默认获得未压缩的原生库，这将帮助你避免最终有两个副本。</p><p id="ec14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能想知道为什么APK既保留了压缩版本的副本，又保留了未压缩版本的副本。如上所述，这是因为库有时是特定于设备的。您可能需要为每个设备准备一个不同的，如果您提供AAB，Play Store可以在下载时将它发送到设备。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="f48c" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">德克斯的文件呢？</h1><p id="09b1" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">apk和aab内部都包含DEX文件。这些文件是执行代码的关键。这些文件是<em class="nz"> Dalvik可执行文件</em>,因为在Android的核心内部，有一个叫做Dalvik虚拟机的东西。更简单地说，这个虚拟机执行Android中的应用程序代码，使它们对您可用。</p><h2 id="855d" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">专业提示:DEX文件出错</h2><p id="b918" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Android Studio在构建项目时有一个常见错误。这个错误很容易修复，但如果你不知道它在说什么，可能会令人沮丧。尝试运行应用程序时，您会收到如下消息:</p><blockquote class="of og oh"><p id="2159" class="kz la nz lb b lc ld ju le lf lg jx lh oi lj lk ll oj ln lo lp ok lr ls lt lu im bi translated">无法将请求的类放入单个dex文件中</p></blockquote><p id="6a26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你也得到这个错误，转到<code class="fe oa ob oc od b">build.gradle(Module: app)</code>，在<code class="fe oa ob oc od b">defaultConfig</code>的括号内，添加下面一行:</p><p id="055e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oa ob oc od b">multiDexEnabled true</code></p><p id="f6c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Android Studio会请求同步项目，就像每次你在Gradle文件中做更改时一样。做梯度同步，并运行应用程序。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="83cb" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">结论</h1><p id="77d2" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">正如你所看到的，比较Android应用捆绑包和APK并不复杂。应用捆绑包已经存在将近两年了，它们对于给用户提供更好的体验非常有用——所以为什么不试一试呢？我希望你把这个加入到你的下一个项目中。</p><p id="22f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下次见！</p></div></div>    
</body>
</html>