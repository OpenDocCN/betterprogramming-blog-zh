<html>
<head>
<title>How To Use Regression Modeling With Time Series</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对时间序列使用回归建模</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-regression-with-time-series-5a0a6a8ba7de?source=collection_archive---------11-----------------------#2021-01-28">https://betterprogramming.pub/using-regression-with-time-series-5a0a6a8ba7de?source=collection_archive---------11-----------------------#2021-01-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1277" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我在预测多元时间序列数据时遇到的障碍以及如何克服它们</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/49aacded58877c2755f58a9f4c94f00d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YFBjy4fbrzHcEjo7nuKJ_A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@opeleye?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">乔丹·欧宝</a>在<a class="ae ky" href="https://unsplash.com/s/photos/progression?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="beb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您是否遇到过包含多元列的时间序列，在这种时间序列中，您的列不在相同的大小范围内，甚至不在相同的数据类型中，从而导致无法应用ARIMA、萨里文或自动ARIMA模型？</p><p id="9a1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近遇到了一个类似的问题，我需要用建筑物的室内温度、室外温度和二元锅炉状态信息的分钟快照来预测建筑物的室内温度。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/9a59f8458c432851287e029b36a22d75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s9g4gEkT9YY20J55I6St2w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用于建模的时间序列</p></figure><p id="a5f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我尝试的第一件事是仅使用室内温度，用ARIMA预测未来的室内温度。我的模型预测未来几分钟的温度值是一样的。我还将我的数据分成室内温度的五分钟快照，用于预测。这也不是很有希望。从探索性的数据分析中，我确认了室内温度、室外温度和二元锅炉状态信息之间存在关系。我不能只忽略这两列，继续只用室内温度建模。</p><p id="4504" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面我得到的结果来看，我决定从头开始。我想使用室内温度、室外温度和二元锅炉状态信息来预测建筑物的室内温度。对此的一个解决方案是使用<a class="ae ky" href="https://github.com/alan-turing-institute/sktime" rel="noopener ugc nofollow" target="_blank"> sktime </a>，一个用于时间序列预测、分类和回归的scikit-learn库。当时我还没有学会使用sktime，所以我决定使用我的数据科学家工具包中的任何东西。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="b21d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面我分享我在想出一个工作模型之前所经历的所有步骤。在建模过程之前，我清理了我的数据，检查了平稳性，应用了Dickey-Fuller测试，并确认我的数据对于建模来说是平稳的，没有季节性或趋势。</p><p id="7f08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我决定给我之前陈述的目标设定一些界限。下面你可以看到我更新后的目标:</p><p id="6276" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用室内温度、室外温度和二元锅炉状态信息的五分钟快照，预测未来五分钟内建筑物的室内温度。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="64b6" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">1.创建预测变量</h1><p id="abee" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我决定用我的三篇专栏文章作为我的预测。为了创建五分钟的预测值，我使用了<a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a> ' <code class="fe na nb nc nd b">.<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.shift.html" rel="noopener ugc nofollow" target="_blank">shift</a></code>方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="7df7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用上面的代码片段，我创建了一个包含15列的数据集。这将创建包含前四分钟数据和当前一分钟数据的列，总共有五分钟的数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/00dd64d96fc2fdd84acaf576e3de4ea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q9NcDI6i2dGO1XN85d7DZA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">预言者</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="269b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">2.创建目标变量</h1><p id="7a71" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我的目标变量是接下来五分钟的室内温度。为了创建这个，我使用了<code class="fe na nb nc nd b">.shift</code>方法将数据移动五分钟，周期= -5。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/60768b799fca16e5de5c0707c093bcb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*5WhPiuGzdglM8Nq9cNzeYQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">目标</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="34f1" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">3.列车测试分离</h1><p id="cb6b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">由于移位周期的数量，预测数据和目标数据有可能长度不同。检查数据集的长度总是一个好主意。如果长度不同，请检查开始和结束日期。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/c972f8e7e485a63113225f3250f6adbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*vAiLSG0bqFziYHtFYaYsxA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">检查数据集的长度</p></figure><h2 id="3681" class="nj me it bd mf nk nl dn mj nm nn dp mn li no np mp lm nq nr mr lq ns nt mt nu bi translated">通过训练测试分割方法</h2><p id="23f2" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Scikit-learn的<code class="fe na nb nc nd b">train_test_split</code>函数将随机分割数据。在我的例子中，我创建了一个包含五分钟预测值的数据框架。因为这些是我唯一的预测，所以我不关心索引顺序。</p><pre class="kj kk kl km gt nv nd nw nx aw ny bi"><span id="cb27" class="nj me it nd b gy nz oa l ob oc">X = ts.copy()</span><span id="955b" class="nj me it nd b gy od oa l ob oc">y = target.copy()<br/></span><span id="0330" class="nj me it nd b gy od oa l ob oc">X_train, X_test, y_train, y_test = train_test_split(X, y,  test_size=.25, random_state=123)</span></pre><h2 id="8622" class="nj me it bd mf nk nl dn mj nm nn dp mn li no np mp lm nq nr mr lq ns nt mt nu bi translated">通过切片。iloc</h2><p id="fc77" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果你用<code class="fe na nb nc nd b">.iloc</code>使用切片，这将按顺序分割你的数据集。这将确定前75%的数据作为您的训练集，后25%作为您的测试数据。</p><pre class="kj kk kl km gt nv nd nw nx aw ny bi"><span id="eb19" class="nj me it nd b gy nz oa l ob oc">train_size = 0.75</span><span id="d0b5" class="nj me it nd b gy od oa l ob oc">split_idx = round(len(ts)* train_size)</span><span id="d1cc" class="nj me it nd b gy od oa l ob oc"># Split predictors</span><span id="a015" class="nj me it nd b gy od oa l ob oc">X_train = ts.iloc[:split_idx]<br/>X_test = ts.iloc[split_idx:]</span><span id="a35c" class="nj me it nd b gy od oa l ob oc"># Split target</span><span id="db44" class="nj me it nd b gy od oa l ob oc">y_train = target.iloc[:split_idx]<br/>y_test = target.iloc[split_idx:]</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6a16" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated"><strong class="ak"> 4。建模</strong></h1><p id="7017" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我创建了我的基本模型(我选择了<code class="fe na nb nc nd b">LassoLarsCV</code>回归模型)并且应用了不同的回归模型，主要是集合方法。每当我用新的回归模型得到更好的结果时，我就改变我的最佳模型假设。</p><p id="6714" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于详细的回归建模，你可以参考我的文章<a class="ae ky" href="https://medium.com/better-programming/step-by-step-regression-modeling-7940bdce070e" rel="noopener">回归建模的逐步指南</a>。从这篇文章中可以期待什么:</p><ul class=""><li id="99a4" class="oe of it lb b lc ld lf lg li og lm oh lq oi lu oj ok ol om bi translated">数据预处理(一键编码、数据标准化、列转换、递归特征消除)</li><li id="410b" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">实例化回归算法</li><li id="96c0" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">创建<code class="fe na nb nc nd b">GridSearchCV</code></li><li id="053c" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">应用管道</li><li id="c56f" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">拟合模型</li><li id="204a" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">通过R2评分和均方误差进行模型检查</li><li id="007a" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">绘制特征重要性(对于树和集合方法)</li><li id="0678" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">模型调整的想法</li></ul><p id="04cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在尝试了许多方法后，我选择了具有最佳R2分数和MSE的模型，并对该模型进行了调优。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="aea4" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">5.模型调整</h1><p id="b3ff" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">模型调优是最重要的步骤之一，在这一步中，您可以发挥作为数据科学家的直觉。如果您的基本模型和网格搜索结果不令人满意，您需要尝试不同的方法。我开始问不同的问题，尝试不同的模型，通过改变一个参数，一个超参数，一种数据预处理方法，每次都改变预测因子或目标，在每一步都采用模型。</p><p id="357f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面你可以看到我在模型调整过程中问自己的一些问题。</p><h2 id="aaaa" class="nj me it bd mf nk nl dn mj nm nn dp mn li no np mp lm nq nr mr lq ns nt mt nu bi translated">如果我将目标变量从室内温度改为随着时间推移室内温度的<em class="os">变化</em>，会发生什么？</h2><p id="ad78" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这是一个关键的问题。通过这种方式，我能够消除不提供任何温度变化的行，并使用具有关于温度变化的洞察力的行。所以我重新开始了我的建模，并以此作为我的新基地。</p><h2 id="72e3" class="nj me it bd mf nk nl dn mj nm nn dp mn li no np mp lm nq nr mr lq ns nt mt nu bi translated">如果我应用不同滞后的差分会发生什么？</h2><p id="ae68" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在创建预测因子之前，对我的室内和室外数据进行差分，改进了我的模型。在尝试了不同的延迟之后，我发现对于相同的数据集来说,<code class="fe na nb nc nd b">periods=1</code>是最好的选择。我采用了滞后1的差分来继续模型调整。</p><h2 id="599e" class="nj me it bd mf nk nl dn mj nm nn dp mn li no np mp lm nq nr mr lq ns nt mt nu bi translated">我的标准化方法对我的数据来说是最好的吗？</h2><p id="ebe3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我使用了<code class="fe na nb nc nd b">StandardScaler</code>进行归一化，并尝试了<code class="fe na nb nc nd b">MinMaxScaler</code>，这提高了我的R2分数和MSE值。</p><h2 id="9ddd" class="nj me it bd mf nk nl dn mj nm nn dp mn li no np mp lm nq nr mr lq ns nt mt nu bi translated">如果我不使用五分钟的数据作为预测值，而是使用十分钟的数据，会发生什么？</h2><p id="ed9f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">用十分钟的数据创建预测器并不能改善模型。事实上，我的测试分数降低了，MSE值增加了。所以我重新使用五分钟的数据作为预测。</p><h2 id="3ed7" class="nj me it bd mf nk nl dn mj nm nn dp mn li no np mp lm nq nr mr lq ns nt mt nu bi translated">我的模型更擅长预测近期还是远期？</h2><p id="7518" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我一直在预测未来的五分钟。我尝试使用1分钟和10分钟预测，结果更好。所以我适应了，预测十分钟后的未来。</p><p id="0334" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，我采用了这个作为我的工作模式。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="2929" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我看来，最重要的一步是探索性的数据分析。在开始建模之前，我花了大量的时间进行探索性的数据分析，并非常熟悉手头的数据集。这给了我开始开发机器学习阶段所需的所有见解。</p><p id="8741" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名数据科学家，每当我面临挑战时，我都学会采用新的方法，问更多的问题，用新的视角看待数据。我研究问题的新解决方案，学习新方法的机制。即使我最终没有使用它，我也可以将一项新技能放入我的数据科学家工具箱中。</p><p id="fb05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，在我需要使用多元时间序列建模之前，我并不知道sktime。我了解了这个库，研究了所有的方法，并在艾伦图灵研究所GitHub repo上用给定的数据集进行了第一手尝试。当要将它应用到我自己的数据集时，由于数据文件类型的原因，我无法做到。后来，我了解了转换程序。csv文件到。ts /。飞机救援消防，然后能够利用sktime。虽然当时我无法利用这一技能，但它给了我一个想法，即使用以前的数据为我的回归模型创建预测器。</p></div></div>    
</body>
</html>