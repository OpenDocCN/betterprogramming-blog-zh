<html>
<head>
<title>Improve Python Code Quality Automatically Using Sourcery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Sourcery自动提高Python代码质量</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/improve-python-code-quality-automatically-using-sourcery-ee2d44d4f841?source=collection_archive---------7-----------------------#2021-12-16">https://betterprogramming.pub/improve-python-code-quality-automatically-using-sourcery-ee2d44d4f841?source=collection_archive---------7-----------------------#2021-12-16</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="eea9" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">如何使用人工智能工具Sourcery自动重构代码</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/d786f77b17958cfd1b21145bef7f93c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pVRTrXMBl0qjS09L"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">亚历杭德罗·埃斯卡米拉在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="5c21" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">代码分析工具帮助我们识别代码库中的问题。这样，我们就知道应该修复什么来提高整体代码质量。</p><p id="c123" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">很有可能，你已经遇到过这样的建议——不赋值就立即返回变量，删除多余的异常处理程序，等等。通常，这些问题很容易修复，但是重构仍然是一项耗时的任务。如果有人能为我们做这些不是很好吗？</p><p id="f5a8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">幸运的是，这个问题有一个解决方案。<a class="ae kz" href="https://docs.sourcery.ai/" rel="noopener ugc nofollow" target="_blank"> Sourcery </a>是一个人工智能驱动的工具，可以代替我们重写代码。目前，它支持Python。您可以在IDE中运行它，并在编码时接受建议。或者您可以分析您的GitHub存储库并合并建议的更改。</p><p id="fe99" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本文中，我们将介绍Sourcery的基本特性。您将学习如何从修复重复的代码问题中腾出时间。</p><p id="41b4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们开始吧！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="6148" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">Sourcery功能概述</h1><p id="902a" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">Sourcery是一个免费增值工具——你可以注册一个免费计划，并在公共项目中使用它进行基本的重构。如果你想把它用在有更高级建议的私人项目上，你必须付费。查看<a class="ae kz" href="https://sourcery.ai/pricing/" rel="noopener ugc nofollow" target="_blank">定价</a>了解更多信息。我一直在用免费计划做我的爱好项目，我很满意。</p><h2 id="1b3f" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">综合</h2><p id="b3ca" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">有几种方法可以使用Sourcery——在您的IDE中，比如PyCharm，在GitHub中，或者通过CLI(一个付费选项)。</p><h2 id="167a" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">它是如何工作的</h2><p id="96f8" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">Sourcery扫描代码以寻找改进的可能性，并自动从您的分支创建一个Pull请求。如果您对这些更改感到满意，您可以合并它们。您也可以触发对特定分支的扫描。默认情况下，该工具会分析每个新的PR。</p><p id="52ea" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您还可以将它作为插件集成到您的IDE中，并在编码时查看/接受建议。</p><h2 id="a241" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">重构建议</h2><p id="d992" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">有一个为什么要改代码的详细解释。下面是一个代码改进的例子:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nm"><img src="../Images/ff4dcdcb86feac58e6998431fcb47af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RSuCvG1nV8-vsX91ln0yuA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">sourcery.ai上的重构规则示例</p></figure><p id="a219" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要查看所有重构的列表，请访问<a class="ae kz" href="https://docs.sourcery.ai/refactorings/" rel="noopener ugc nofollow" target="_blank">文档</a>。注意，有些需要付费版本。</p><h2 id="77cc" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">质量报告</h2><p id="ef07" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在每个PR的末尾，你可以找到一个<a class="ae kz" href="https://docs.sourcery.ai/GitHub/Quality-Report/" rel="noopener ugc nofollow" target="_blank">质量报告</a>，它显示合并变更后代码质量是会下降还是会上升。</p><h2 id="50d0" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">自定义配置</h2><p id="13d1" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">您可以将Sourcery配置为:</p><ul class=""><li id="f548" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated">忽略特定的重构建议</li><li id="f8b0" class="nn no iu lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated">自定义质量指标</li><li id="1b7f" class="nn no iu lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated">为PRs设置默认分支名称</li><li id="1c47" class="nn no iu lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated">向某人请求审查</li><li id="0950" class="nn no iu lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated">禁用对文件或路径的检查</li></ul><p id="b9de" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它从项目目录的<code class="fe ob oc od oe b">.sourcery.yaml </code>中读取这些设置。</p><p id="ccbc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如，要请求所有者进行审查，配置应该如下所示:</p><pre class="kk kl km kn gu of oe og oh aw oi bi"><span id="2323" class="na me iu oe b gz oj ok l ol om">github:<br/>request_review: owner</span></pre><p id="828b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">查看<a class="ae kz" href="https://docs.sourcery.ai/Configuration/" rel="noopener ugc nofollow" target="_blank">配置文件</a>了解所有可能性。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="b76b" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">演示</h1><p id="a4d2" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在本文中，我将在GitHub上使用它来演示重构功能。</p><p id="a8bf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要使用Sourcery，首先，注册一个免费帐户。</p><p id="1249" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然后使用这个<a class="ae kz" href="https://github.com/settings/installations/21241999" rel="noopener ugc nofollow" target="_blank">直接链接</a>来添加用于分析的Python存储库。</p><p id="7eb1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我有一个Python库，Sourcery在那里找到了改进的机会。例如，考虑以下建议:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj on"><img src="../Images/a8662ab2e995263e5cae36b8b2693a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5TIWimr8APRulfGaUqWnbg.png"/></div></div></figure><p id="14b4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如您所见，间距已被更正，行内变量已被立即返回。</p><p id="dccb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以在GitHub的<strong class="lc iv"> Pull requests </strong>部分找到自动创建的PR:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oo"><img src="../Images/9883f87f487ab3ee2568a76dda51e511.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ONSCW2qH_hWkYFOWvaNkTw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Sourcery bot发出的拉请求</p></figure><p id="1897" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要从Sourcery仪表板管理存储库扫描，请导航到<strong class="lc iv"> Github Code Review </strong>:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj op"><img src="../Images/27728814cf4b789ba8ddba840d6b9806.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/1*xn4y9pe6Y1ROoUeaVc_54A.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Github代码审查</p></figure><p id="4f31" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以下是git存储库仪表板的概述:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oq"><img src="../Images/66bfd33118b177d3cf9d2eff55cbd419.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VHQNt72kyMJ2NrV-tymN5A.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">源文件库仪表板</p></figure><p id="836c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">正如你在上面看到的，这个工具在我的<strong class="lc iv">测试</strong>分支上运行。我可以在另一个上触发分析，然后单击<strong class="lc iv">重构</strong>。这次选了<strong class="lc iv">大师</strong>。不久，我的GitHub上出现了一个新的PR:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj or"><img src="../Images/e9c17bc4a2ec0c9a4952b19bb2018837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*smUb4QTpYWv5iWdIJtN6-A.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">按源提取主测试分支的请求</p></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="9963" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">结论</h1><p id="8a2a" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在本文中，您了解了如何配置Sourcery来扫描Python代码，以获得可能的改进。即使是免费计划也可以节省你大量的重构时间，因此你可以专注于你的开发任务。</p><p id="8fb7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，我们应该始终小心自动生成的代码建议。我会小心翼翼地审查每一份公关，以避免在生产中出现任何意外。</p><p id="36b5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我希望你喜欢这篇文章。感谢您的阅读，下次再见！</p></div></div>    
</body>
</html>