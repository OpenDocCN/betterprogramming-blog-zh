<html>
<head>
<title>How to locally run Python on Google Sheets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Google Sheets上本地运行Python</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-enable-pythons-access-to-google-sheets-e4264cdb545b?source=collection_archive---------7-----------------------#2020-07-16">https://betterprogramming.pub/how-to-enable-pythons-access-to-google-sheets-e4264cdb545b?source=collection_archive---------7-----------------------#2020-07-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1f9e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">继续使用Python管理在线电子表格内容</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d96753a30790d8b90f9a4328f1e3f2c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Xm241Ai_hqJiDJU2"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">埃米尔·达坎在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="7b7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你点击了这篇文章，你可能已经使用Python来管理Excel文件内容。作为一个广泛使用的工具，当使用电子表格时，Excel是一个非常好的选择。即使微软已经推出了OneDrive，许多人仍然在本地使用Excel和Google Drive的选项Google Sheets，用于云。</p><div class="lv lw gp gr lx ly"><a href="https://towardsdatascience.com/automating-personal-investments-with-excel-and-python-6f6a95898522" rel="noopener follow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">使用Excel和Python实现个人投资自动化</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">如你所愿，随时更新你自己的股票投资数据</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="7278" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论哪种方式，使用云服务最重要的好处是远离本地文件。它们需要本地存储，很难与朋友分享，版本控制是一场噩梦。</p><p id="c6a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mn">在这篇文章中，我将带你经历一些必要的步骤，以便你能够使用Python访问你的Google Sheets电子表格并管理它们的内容。</em></p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="a84c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能知道，谷歌本身提供了一个Google Sheets脚本编辑器的本地选项，<a class="ae ky" href="https://developers.google.com/apps-script/reference/spreadsheet" rel="noopener ugc nofollow" target="_blank">电子表格服务</a>，作为<a class="ae ky" href="https://developers.google.com/apps-script" rel="noopener ugc nofollow" target="_blank"> Google Apps脚本</a>的一部分。有一些方法和属性确实非常有用。它还允许你通过谷歌的平台管理你的项目执行历史和其他相关信息。</p><p id="8240" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，作为一名Python爱好者，您可能意识到这种语言有多简单。我们来列举一下好处:</p><ul class=""><li id="0b0b" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu na nb nc nd bi translated">您已经将Python用于其他现有的应用程序——学习一门新语言的语法并探索其方法和属性需要时间。</li><li id="5443" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">Python拥有庞大、活跃的社区和丰富的库。所以，只要你能连接到这个新的数据源(Google Sheets)，你就能继续做很多事情。</li></ul><p id="3df2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有一个好消息:从现在开始，您可以检查设置所需访问权限所需的步骤。其余的，你可以照常保留。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="4211" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">1.支持外部访问Google Sheets</h1><p id="b61d" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">在这一节中，我们将介绍授权外部应用程序访问Google Sheets所需的步骤。这里的主要目标是将您的Google项目凭证分配给Google Sheets和Google Drive APIs。</p><p id="452a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">流程是这样的:</p><ol class=""><li id="5acf" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu og nb nc nd bi translated">在谷歌云平台上建立你的项目。</li><li id="f352" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu og nb nc nd bi translated">创建您的项目凭据。</li><li id="e2e5" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu og nb nc nd bi translated">启用Google Sheets API和Google Drive API。</li><li id="3541" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu og nb nc nd bi translated">将您的项目凭据分配给Google Sheets API和Google Drive API。</li></ol><p id="32eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看每一个。</p><h2 id="0bc4" class="oh nk it bd nl oi oj dn np ok ol dp nt li om on nv lm oo op nx lq oq or nz os bi translated">1.1.在谷歌云平台上建立你的项目</h2><p id="7e93" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">登录<a class="ae ky" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>后，如果您是第一次登录该平台，您会在<a class="ae ky" href="https://console.cloud.google.com/projectselector2" rel="noopener ugc nofollow" target="_blank">主页</a>部分看到以下页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/1ed9cc6e4d35aecfb12db9bf42adcf78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i8lBujlAtyXuM9S5RsMb3Q.png"/></div></div></figure><p id="d2f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过点击"创建项目"，您设置您的项目主要信息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/64a226a3cc8db9e212fc0d1e0dd5e98e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BcjQI3cfW-Wv4Jk_Ko64wQ.png"/></div></div></figure><p id="05ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，您的项目已经创建好了。</p><h2 id="fb10" class="oh nk it bd nl oi oj dn np ok ol dp nt li om on nv lm oo op nx lq oq or nz os bi translated">1.2.创建您的项目凭据</h2><p id="7f2d" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">现在你需要搜索“APIs &amp; Services”。然后，单击“创建凭据”，然后单击“服务帐户”选项:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/09dad99d87a2f140cd00a8acd1fe3a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k43LTGh6VpfiNTnEYAqwYQ.png"/></div></div></figure><p id="5f42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您需要输入一些基本信息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/333eaad275c78ee0c79f19b2c4d6a908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dGjC9leWaOzjedzKbBkFmQ.png"/></div></div></figure><p id="cc4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击“创建”后，在“项目”选项下，点击“所有者”选项:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/b537ab4a2f7eb4fd4ef74f732e5c6eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KeYNXwMHGc-l4IFQnj2b2A.png"/></div></div></figure><p id="dc01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在页面底部，单击您的服务帐户电子邮件链接:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/4e9e90075139ba7171fac8e51269e995.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u3PQbIWLsY_5kp3vQABq3g.png"/></div></div></figure><p id="6f1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，点击“添加密钥”选项和“创建新密钥”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/351b55ea5d38bb11d6409fd75689300d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kJykYPRPWC2tAmwNhM4E1Q.png"/></div></div></figure><p id="b509" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择JSON选项:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/a6d8c0093ca42d61846d6f14bfc3d759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mmJhIOWigpZb0o8WNDYT4w.png"/></div></div></figure><p id="780f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您已经下载了JSON项目的凭证文件。</p><h2 id="7646" class="oh nk it bd nl oi oj dn np ok ol dp nt li om on nv lm oo op nx lq oq or nz os bi translated">1.3.启用Google Sheets API和Google Drive API</h2><p id="ca4d" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">你需要搜索“Google Sheets API”和“Google Drive API”(顺序不重要)。</p><p id="ce51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，看看“Google Sheets API”页面。在这里，您必须单击“启用”按钮(确保您也为Google Drive API执行此操作):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/c568ac1c829346b5e9e283c7e64f4c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wO4cnmyFP43sbs-D3mLiPg.png"/></div></div></figure><p id="47ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">两个API都已启用。</p><h2 id="6bfa" class="oh nk it bd nl oi oj dn np ok ol dp nt li om on nv lm oo op nx lq oq or nz os bi translated">1.4.将您的项目凭据分配给Google Sheets API和Google Drive API</h2><p id="36a1" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">启用API后，单击两者右上角的“CREATE CREDENTIALS”(再次强调，下面我只打印了Google Sheets API):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/bd5c2071e911fd401a403ba669ca8245.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-Xy8Em4xTOo6LWUm11vcQ.png"/></div></div></figure><p id="a660" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将被重定向到以下两个屏幕(针对每个API):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/aa146008dd0de3690d593604ee57ff84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nNPPDavEVfHVo6JkS0XtMQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/f61f5ff200e5d290b829639702eca8e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oJG3HpI2qC5DZXG-4kbliw.png"/></div></div></figure><p id="a752" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择显示的选项后，Google Cloud Platform将识别您已经创建的项目证书，并将其用于API:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/eb55dc753e40570f63cf65aa2e411887.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wk8oAZM_tHgoDICbiRfSTw.png"/></div></div></figure><p id="f660" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击“DONE ”,现在两个API都已被正确识别。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="016f" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">2.Python脚本</h1><p id="fab8" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">到目前为止，您已经允许外部应用程序通过两个Google API连接到Google Sheets。现在，让我们来看看在Python脚本中需要考虑什么:</p><ol class=""><li id="316f" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu og nb nc nd bi translated">需求和依赖性</li><li id="2215" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu og nb nc nd bi translated">认证和授权</li><li id="2a19" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu og nb nc nd bi translated">应用程序脚本</li></ol><h2 id="affd" class="oh nk it bd nl oi oj dn np ok ol dp nt li om on nv lm oo op nx lq oq or nz os bi translated">2.1.需求和依赖性</h2><p id="5b6e" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">你可能认为这是整个流程中最无聊的部分。你错了。</p><p id="7266" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里就直说了吧。您只需要满足一个要求，即导入两个库:<code class="fe ox oy oz pa b"><a class="ae ky" href="https://pypi.org/project/gspread/" rel="noopener ugc nofollow" target="_blank">gspread</a></code>和<code class="fe ox oy oz pa b"><a class="ae ky" href="https://pypi.org/project/oauth2client/" rel="noopener ugc nofollow" target="_blank">oauth2client</a></code>。确保您已经在本地下载了它们，然后这将是您的Python脚本的第一部分:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="50a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">依赖关系呢？还记得在创建项目凭证时下载的JSON文件吗？这是依赖性之一。它主要包括您的私钥，这是身份验证过程所需要的。</p><p id="c0ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一种方式是通过你的服务账户电子邮件共享对你的Google Sheets电子表格的访问，就像你对朋友做的那样。你可以在Google Cloud Platform中的凭证会话上或者在最后一段提到的JSON文件(“client_email”)上查阅。</p><h2 id="8033" class="oh nk it bd nl oi oj dn np ok ol dp nt li om on nv lm oo op nx lq oq or nz os bi translated">2.2.认证和授权</h2><p id="b09a" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">因此，如果JSON文件在同一个目录中，您将执行您的。py文件，您可以考虑以下情况:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="a3aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果出于某种原因，您更愿意将JSON文件保存在不同的目录中，只需确保您指明了指向它的完整路径。</p><p id="9be5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是认证和授权会话的全部内容。</p><h2 id="d33c" class="oh nk it bd nl oi oj dn np ok ol dp nt li om on nv lm oo op nx lq oq or nz os bi translated">2.3.应用程序脚本</h2><p id="1208" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">我称之为“应用脚本”的是你在Google Sheets上对你的数据所做的事情。</p><p id="3e3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个简单的例子，让我们检查你是否既能导入数据Google Sheets又能从中读取数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="7a67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/814aabde2286681364026008816a4a57.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*2K42IQPSJQml4IAyDtuTww.png"/></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="1121" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在管理Google Sheets上的在线内容时，您可以继续使用Python。</p></div></div>    
</body>
</html>