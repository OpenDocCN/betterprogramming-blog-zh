<html>
<head>
<title>What Exactly Is Database Sharding?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">到底什么是数据库分片？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/what-exactly-is-database-sharding-ca618a2cbb9a?source=collection_archive---------9-----------------------#2021-03-22">https://betterprogramming.pub/what-exactly-is-database-sharding-ca618a2cbb9a?source=collection_archive---------9-----------------------#2021-03-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="116b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">理解何时和何时不共享数据库的5分钟指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/98fe59179c76bef2db6daa454c703f79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O4edx2AHSpSlu6WJn1rRQw.jpeg"/></div></div></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="fc93" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">概观</h1><p id="3b17" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated"><em class="mp">分片</em>指的是将我们的数据分成块(碎片)。分片的好处是它允许我们为大规模系统扩展数据库。</p><p id="651c" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">分片可以在应用程序级别实现，其中代码将决定读取或写入哪个数据库分片。分片也可能是数据库的一个固有特性。例如，<a class="ae mv" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>，一个流行的NoSQL数据库，支持开箱即用的分片。</p><p id="1b68" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">现在，让我们来看看它是如何工作的。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="d90a" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">分片的工作原理</h1><p id="4095" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">有许多方法可以实现分片。我们来看一些常见的方式。</p><h2 id="1ead" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">基于密钥的分片</h2><p id="1d82" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">在这个方法中，我们选择一个特定的惟一列并对其进行散列。产生的散列可用于确定读或写操作需要进入的碎片。</p><p id="d92d" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">例如，如果我们试图访问用户A的配置文件，它有一个用户id <code class="fe ni nj nk nl b">user123</code>，那么我们首先散列它。假设我们获得了一个简单的值100。我们现在可以根据我们拥有的碎片数量对这个值使用模运算。如果我们有七个碎片，那么100 % 7 = 2。我们的读取操作将触及碎片2。</p><p id="4b15" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">这种简单的基于哈希的分片有助于我们始终如一地将条目指向各自的分片。</p><h2 id="a386" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">基于范围的分片</h2><p id="1d4a" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">在基于范围的分片中，我们为条目创建范围。例如，名称以A到L开头的所有客户将进入Shard 1，其余的进入Shard 2。</p><p id="2da7" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">我们将只保留一个散列表(一个映射),来捕获什么去哪里的逻辑。当请求到来时，我们检查客户的名字，并确定我们需要点击的相应碎片。</p><h2 id="b93c" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">一致哈希分片</h2><p id="45e6" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">基于键的分片的一个常见问题是，如果我们拥有的分片或数据库服务器的数量发生变化，那么我们需要重新映射所有条目。当数据库服务器的数量发生变化时，为了减轻工作量，我们可以使用一致散列机制。这将只需要我们重新映射<code class="fe ni nj nk nl b">n/m</code>个密钥，其中<code class="fe ni nj nk nl b">n</code>是密钥的数量，<code class="fe ni nj nk nl b">m</code>是服务器的数量。一致性散列本身就是一个完整的主题，我们将避免在这里涉及太多的细节。要了解更多，你可以阅读这篇伟大的Toptal <a class="ae mv" href="https://www.toptal.com/big-data/consistent-hashing" rel="noopener ugc nofollow" target="_blank">文章</a>。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="31b4" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">分片的优势</h1><h2 id="b6d1" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">水平缩放</h2><p id="5d33" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">分片有助于我们横向扩展数据库(横向扩展)。这与垂直扩展(纵向扩展)形成对比，在垂直扩展中，我们通过以RAM、CPU等形式添加更多计算能力来升级现有的数据库实例。</p><p id="1b5d" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">然而，垂直缩放是有限的。您的升级只有一定的限制，继续垂直升级会变得越来越昂贵。水平扩展解决了这个问题，它允许您根据数据库需求自由扩展。设置也很灵活。</p><h2 id="5b5a" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">查询次数</h2><p id="48bd" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">分片帮助我们减少查询中的延迟。现在，我们可以将查询搜索集中在行数较少的特定片上，而不是搜索所有行。这意味着我们可以更快地获得结果。</p><h2 id="5abd" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">可靠性</h2><p id="e813" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">分片可以帮助我们减少停机。如果发生中断，单个数据库可能会导致整个应用程序失败。在分片数据库中，停机可能只影响特定的分片，因此只有一部分应用程序和用户会受到影响。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="034b" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">分片的缺点</h1><h2 id="4c68" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">复杂性</h2><p id="1b1e" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">分片是一项需要完美完成的复杂任务。我们最不想处理的问题是数据丢失或损坏。这将影响数据库的一致性，这是ACID的属性之一。</p><p id="aae9" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">随之而来的是管理形式的复杂性。管理单个数据库比管理多个分片的数据要容易得多。</p><h2 id="7803" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">热点</h2><p id="ead0" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">当我们开始过载单个碎片时，就会出现数据库热点。例如，如果我们基于城市划分景点数据库，那么某些城市的某些旅游景点可能更受欢迎。因此，某些碎片在读写方面会过载，这使得我们的数据库容易崩溃或失败。</p><h2 id="0b1e" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">难以撤销</h2><p id="51ab" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">分片是一个需要谨慎做出的决定。一旦实现了分片，就很难将数据库恢复成一个整体。您需要合并多行和多列，以及各种备份、分区等。，可能都不同步。这在经济上也很昂贵，需要时间和精力。</p><h2 id="66ba" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">难度取决于数据库</h2><p id="8fcc" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">虽然一些数据库支持开箱即用的分片(例如MongoDB)，但其他流行的数据库，如<a class="ae mv" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>，需要手动操作来实现分片。</p><h2 id="fbcf" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">需要未来规划</h2><p id="b4ce" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">我们需要计划的一个场景是，如果我们将来需要增加碎片的数量，该怎么办？当前的实现能轻松做到这一点吗？</p><p id="c90a" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">这些问题非常重要，因为我们最不希望的就是陷入进一步扩展应用的困境。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="ea76" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">结论</h1><p id="1aa8" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">分片是一种强大的扩展方式，但它也有自己的复杂性和问题。因此，通常应该在尝试了一些主要的缩放方式之后使用分片，例如:</p><h2 id="4693" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">垂直缩放</h2><p id="0f3e" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">垂直扩展对我们来说仍然是有用的，并且可以被认为是第一解决方案。如果只是简单的升级RAM或CPU就能解决你的性能问题，那么为什么要使用shard呢？当垂直扩展涉及太多成本或者不能解决长期问题时，应该使用分片。</p><h2 id="b6c6" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">使用缓存</h2><p id="3674" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">如果我们的数据库是读取密集型的，那么提高性能的最简单和首要的方法就是利用基于缓存的机制。我们可以将频繁请求的数据临时存储到缓存中，避免重复读取数据库。</p><h2 id="ca14" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">副本集</h2><p id="632a" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">我们可以使用数据库副本集来解决读取密集型性能。副本集镜像主数据库服务器，在负载平衡器的帮助下，我们可以将查询定向到不同的副本，而不是同一个数据库。</p><p id="6a01" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">这里的另一个优势是冗余，这有助于我们减少停机，因为副本集可以接管发生故障的主数据库服务器。</p><h2 id="10c1" class="mw lc it bd ld mx my dn lh mz na dp ll mc nb nc ln mg nd ne lp mk nf ng lr nh bi translated">优化查询</h2><p id="7b77" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">另一种提高性能的方法是优化我们的查询，使其更加高效。如果您有分片，但是您的查询涉及复杂的连接，那么您并没有真正解决问题的根源。</p><p id="9e81" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">就这些了，伙计们！分片是一项非常强大的技术，几乎所有大型科技公司都需要这项技术，这样它们才能扩大全球活动规模，为数百万人提供服务。明智地使用它！</p><p id="d6ae" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">快乐的切分！</p></div></div>    
</body>
</html>