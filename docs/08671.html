<html>
<head>
<title>React State Management With Zustand</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Zustand反应状态管理</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/react-state-management-with-zustand-b816472b4be7?source=collection_archive---------1-----------------------#2021-05-28">https://betterprogramming.pub/react-state-management-with-zustand-b816472b4be7?source=collection_archive---------1-----------------------#2021-05-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bfe9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于Zustand API，您需要知道的是</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d02a0d4b4801c1bd7eafff6118d3cac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nzQbvMNrylM_33L8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://unsplash.com/@skenb" rel="noopener ugc nofollow" target="_blank">塞巴斯蒂安·诺尔</a>在<a class="ae ky" href="http://unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上</p></figure><h1 id="7bdb" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="610c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们首先讨论一下为什么首先应该使用状态管理库。</p><h2 id="2fa6" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">状态管理的重要性</h2><p id="3f74" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">简单来说，由于React臭名昭著的道具钻取问题，开发者需要一个状态管理系统。让我通过一个代码示例向您解释一下。</p><p id="27e7" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">看看下面的片段:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="4698" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">我们在这里所做的是基于<code class="fe ng nh ni nj b">company</code>道具渲染一个图标。相当简单。让我们试着把事情复杂化一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="158b" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">在上面这段代码中，我们还呈现了一个<code class="fe ng nh ni nj b">Message</code>组件，它显示了<code class="fe ng nh ni nj b">firm</code>道具的当前值。</p><p id="4d4c" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">然而，有一个问题。注意，我们必须输入两次<code class="fe ng nh ni nj b">apple</code>属性值。这打破了编程的枯燥规则。结果，这在代码审查期间留下了不好的印象。让我们试着解决这个问题:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="f542" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">虽然我们的代码是完全有效的，现在很容易遵循，但有一个主要问题。要获得<code class="fe ng nh ni nj b">company</code>道具并将其发送给相关组件，您必须将其传递给<code class="fe ng nh ni nj b">FullPage</code>组件。即使<code class="fe ng nh ni nj b">FullPage</code>不需要<code class="fe ng nh ni nj b">company</code>道具来运行，我们仍然必须传递它，因为它的子组件需要它。</p><p id="87aa" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">因为我们的代码很简单，所以没有问题。然而，如果您的项目规模扩大，从而变得更加复杂，该怎么办呢？你将不得不通过多个层和组件“钻”下你的道具。</p><p id="69be" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">为了减轻这样的问题，开发者为他们的应用程序使用状态管理库。Zustand就是这样一个例子。</p><h2 id="1338" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">Zustand是什么，为什么要用？</h2><p id="949c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Redux是国家管理图书馆的一个家喻户晓的名字。但是让我们解决房间里的大象:它需要太多的样板文件来开始。必须有一个不需要大量代码就能工作的替代库。</p><p id="2c76" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">进入Zustand，这是一个不仅不需要太多样板文件而且还有其他优点的库。其中包括:</p><ul class=""><li id="3363" class="nk nl it lt b lu mz lx na ma nm me nn mi no mm np nq nr ns bi translated">简单易懂的代码</li><li id="0f69" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">使用钩子。由于钩子在React中风靡一时，这是一个巨大的优势。</li><li id="9ee6" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">不需要在上下文提供者中包装您的状态。这解决了<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/reacts-context-api-explained-baebcee39d2f"> React的上下文API </a>中的一个小缺陷，你需要将你的状态包装在<code class="fe ng nh ni nj b">Context.Provider</code>标签中。因此，这会降低代码的可读性。</li></ul><p id="7a1d" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">既然已经谈了它的成果，那就开始吧！</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="3986" class="kz la it bd lb lc of le lf lg og li lj jz oh ka ll kc oi kd ln kf oj kg lp lq bi translated">Zustand:简单用法</h1><h2 id="b8f1" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">装置</h2><p id="563d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要在React项目中安装Zustand，请运行以下终端命令:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="98e1" class="mn la it nj b gy oo op l oq or">npm install zustand</span></pre><h2 id="f031" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">创建商店</h2><p id="1beb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要入门，Zustand首先需要一个<em class="os">店</em>。这是您放置所有状态及其功能的地方。现在，我们将只存储状态变量。</p><p id="da24" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">创建一个名为<code class="fe ng nh ni nj b">states.js</code>的单独文件，并编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/380194ce18fb7cf75d455838e1974c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8FrO8P9OuZv7Mednytsf-Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在state.js中编写的代码</p></figure><ul class=""><li id="8c61" class="nk nl it lt b lu mz lx na ma nm me nn mi no mm np nq nr ns bi translated">第3行:创建一个名为<code class="fe ng nh ni nj b">useStore</code>的定制钩子。<code class="fe ng nh ni nj b">create</code>函数告诉Zustand为我们创建一个商店。<code class="fe ng nh ni nj b">create</code>接受一个回调函数作为它的第一个参数，它接受一个用于操作状态的<code class="fe ng nh ni nj b">set</code>函数。</li><li id="5dc3" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第4行:我们的<code class="fe ng nh ni nj b">useStore</code>变量只有一个状态，叫做<code class="fe ng nh ni nj b">dollars</code>。它的初始值将是<code class="fe ng nh ni nj b">0</code>。</li><li id="3676" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第5行:声明另一个名为<code class="fe ng nh ni nj b">broke</code>的状态。它的初始值将是<code class="fe ng nh ni nj b">false</code>。</li></ul><p id="aefb" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">太好了，你终于创建了一个简单的商店！是时候渲染了。</p><h2 id="2bcc" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">显示状态</h2><p id="b5a2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在让我们显示状态变量的值。在<code class="fe ng nh ni nj b">App.js</code>中，首先像这样引入你的<code class="fe ng nh ni nj b">useStore</code>变量:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="05ae" class="mn la it nj b gy oo op l oq or">import useStore from "./state"</span></pre><p id="b99d" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">然后像这样获得你的<code class="fe ng nh ni nj b">dollars</code>和<code class="fe ng nh ni nj b">broke</code>状态变量:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/f669c5e46802fdb1c029db5579697d07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iQ2TQlnPeFQcuGX2nXqetQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在App.js中编写的代码</p></figure><ul class=""><li id="21f3" class="nk nl it lt b lu mz lx na ma nm me nn mi no mm np nq nr ns bi translated">第1行:从<code class="fe ng nh ni nj b">useStore</code>钩子获取<code class="fe ng nh ni nj b">dollars</code>状态。</li><li id="1eb2" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第2行:获取<code class="fe ng nh ni nj b">broke</code>布尔值的值。</li></ul><p id="088e" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">我们快完成了！您可以像这样显示它们:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="0a56" class="mn la it nj b gy oo op l oq or">return (<br/>  &lt;div className="App"&gt;<br/>    &lt;p&gt; You currently have: {dollars} &lt;/p&gt;<br/>    &lt;p&gt; {broke? "You are broke" : "You are not broke" } &lt;/p&gt;<br/>  &lt;/div&gt;<br/>);</span></pre><p id="3190" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">在这段代码中，我们显示了<code class="fe ng nh ni nj b">dollar</code>和<code class="fe ng nh ni nj b">broke</code>状态的值。</p><p id="161a" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">这将是结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/838957cb973cd3a4a6ffb0389fb13073.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*KsoxxhrMQ-0_IRWmRaK6sw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="9aa8" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">就是这样！没有过多的样板代码。没有争论，没有大惊小怪。只有几行代码完成了这项工作。</p><p id="80ad" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">您甚至可以声明多个商店。我们将在下一节讨论这个问题。</p><h2 id="73c6" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">多家商店</h2><p id="b5a4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Zustand具有灵活性，允许您创建多个商店。这有助于组织状态变量。</p><p id="1175" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">在<code class="fe ng nh ni nj b">state.js</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><ul class=""><li id="f232" class="nk nl it lt b lu mz lx na ma nm me nn mi no mm np nq nr ns bi translated">第3–6行:这是我们之前定义的<code class="fe ng nh ni nj b">useStore</code>钩子。</li><li id="e57f" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第8行:创建一个<code class="fe ng nh ni nj b">useCountry</code>钩子，它有一个叫做<code class="fe ng nh ni nj b">country</code>的状态变量。它的初始值将是<code class="fe ng nh ni nj b">US</code>。</li><li id="c63d" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第12行:出口<code class="fe ng nh ni nj b">useStore</code>和<code class="fe ng nh ni nj b">useCountryStore</code>挂钩。</li></ul><p id="2e81" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">您现在已经创建了两家商店。让我们使用它们。</p><p id="22a5" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">在<code class="fe ng nh ni nj b">App.js</code>中，首先找到以下代码行:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="872d" class="mn la it nj b gy oo op l oq or">import useStore from "./state"</span></pre><p id="da26" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">像这样改变它:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="7e3a" class="mn la it nj b gy oo op l oq or">import { useStore, useCountryStore } from "./state"</span></pre><p id="8540" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">您现在需要进入<code class="fe ng nh ni nj b">country</code>状态。为此，在<code class="fe ng nh ni nj b">App.js</code>中编写以下代码行:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="9d6a" class="mn la it nj b gy oo op l oq or">const country = useCountryStore((state) =&gt; state.country);</span></pre><p id="ee3d" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">最后，您必须呈现它的值:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="068c" class="mn la it nj b gy oo op l oq or">&lt;p&gt; You currently live in {country} &lt;/p&gt;</span></pre><p id="d7bb" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">运行代码。这将是输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/a6a9d106537d8fca41d3877bfdc6baf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*laQ-IddTkz522Pr4JTF6hA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="234b" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">太好了！我们的代码有效。如您所见，Zustand库很容易使用。</p><p id="67df" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">在本文的下一部分，您将了解Zustand的更高级的概念。</p><p id="8f8c" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">最后，<code class="fe ng nh ni nj b">App.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="ff9f" class="kz la it bd lb lc of le lf lg og li lj jz oh ka ll kc oi kd ln kf oj kg lp lq bi translated">Zustand:高级用法</h1><h2 id="7dac" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">行动</h2><p id="751c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">简而言之，动作是改变状态值的函数。你可以把它们想象成<code class="fe ng nh ni nj b">useState</code>钩子中的<code class="fe ng nh ni nj b">setValue</code>函数。在这一节中，我们将为我们的状态编写动作。</p><p id="9648" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">在<code class="fe ng nh ni nj b">state.js</code>中，找到下面这段代码:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="4b1b" class="mn la it nj b gy oo op l oq or">const useStore = create((set) =&gt; ({<br/>  dollars: 0,<br/>  broke: false<br/>}));</span></pre><p id="6ae4" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">像这样改变它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/c54a1fc62fa4c82a9b144c503ec33831.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y2acPmElojjaurx_V1bKIQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在state.js中编写的代码</p></figure><ul class=""><li id="3f42" class="nk nl it lt b lu mz lx na ma nm me nn mi no mm np nq nr ns bi translated">第4–5行:创建一个增加和减少<code class="fe ng nh ni nj b">dollars</code>变量的<code class="fe ng nh ni nj b">increaseDollars</code>和<code class="fe ng nh ni nj b">decreaseDollars</code>动作。</li><li id="9959" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第6行:创建一个接受<code class="fe ng nh ni nj b">input</code>参数的<code class="fe ng nh ni nj b">setBroke</code>函数。这将把<code class="fe ng nh ni nj b">broke</code>状态的值更改为该参数。</li></ul><p id="7505" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">完成后，转到<code class="fe ng nh ni nj b">App.js</code>并编写以下代码:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="6223" class="mn la it nj b gy oo op l oq or">const setBroke = useStore((state) =&gt; state.setBroke);<br/>const increaseDollars = useStore((state) =&gt; state.increaseDollars);<br/>const decreaseDollars = useStore((state) =&gt; state.decreaseDollars);</span></pre><p id="d10a" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">在上面这段代码中，我们已经将<code class="fe ng nh ni nj b">setBroke</code>、<code class="fe ng nh ni nj b">increaseDollars</code>和<code class="fe ng nh ni nj b">decreaseDollars</code>动作导入到项目中。您现在可以使用它们了。</p><p id="8b85" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">最后，转到<code class="fe ng nh ni nj b">App.js</code>中的<code class="fe ng nh ni nj b">return</code>块，添加以下代码行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><ul class=""><li id="81fc" class="nk nl it lt b lu mz lx na ma nm me nn mi no mm np nq nr ns bi translated">第1–8行:创建一个<code class="fe ng nh ni nj b">button</code>元素，单击它将调用<code class="fe ng nh ni nj b">setBroke</code>函数。这将翻转<code class="fe ng nh ni nj b">broke</code>变量的值。</li><li id="cc99" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第9–15行:单击时，运行<code class="fe ng nh ni nj b">increaseDollars</code>动作。</li><li id="5d8a" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第16–23行:呈现一个运行<code class="fe ng nh ni nj b">decreaseDollars</code>函数的<code class="fe ng nh ni nj b">button</code>组件。</li></ul><p id="51e4" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">运行代码。这将是结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/49f41b1d4854ac39c5e6cca76777d361.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/1*1UxF1U7jYqB4Yq-_Ah-exg.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="dfd3" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">如您所见，我们的按钮运行良好，代码输出也符合预期！在下一节中，您将了解到一个叫做<em class="os">的概念。</em></p><p id="77d6" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">最后，<code class="fe ng nh ni nj b">App.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h2 id="d5e8" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">国家订户</h2><p id="febb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">有时候你可能需要在不改变状态变量的情况下获取它们的值。为此，您需要使用订户。它们是使用<code class="fe ng nh ni nj b">subscribe</code>方法完成的。</p><p id="7e4c" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">在<code class="fe ng nh ni nj b">state.js</code>中，添加以下代码块:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/8d56ceeec44a4cd837e483d8c1c30997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P3IEUSywdO9VkBLupyFJnw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在state.js中编写的代码</p></figure><ul class=""><li id="4071" class="nk nl it lt b lu mz lx na ma nm me nn mi no mm np nq nr ns bi translated">第1行:使用<code class="fe ng nh ni nj b">subscribe</code>方法告诉Zustand为我们的<code class="fe ng nh ni nj b">useStore</code>钩子设置一个订阅者。</li><li id="06ac" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第2行:<code class="fe ng nh ni nj b">subscribe</code>函数将给我们两个参数，它们返回我们指定的状态变量的旧值和新值。</li><li id="f307" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第6行:告诉Zustand只在检测到<code class="fe ng nh ni nj b">dollars</code>状态发生变化时运行代码。</li></ul><p id="7630" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">运行代码。这将是结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/e0049b7f8f078ef2d6e7f260a89d7bb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/1*7_RYNi6WCoc0FQg6JTdrEQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="dca2" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">注意，在输出中，Zustand记录了我们的<code class="fe ng nh ni nj b">dollar</code>状态的旧值和新值。这意味着我们的代码是成功的！</p><p id="0921" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">在本文的下一部分，您将了解Zustand的中间件功能。</p><p id="ee6a" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">最后，<code class="fe ng nh ni nj b">state.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h2 id="e452" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">中间件</h2><p id="02a7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">与Express类似，Zustand的中间件是一段代码，在每次状态改变之前运行。一些使用案例包括:</p><ul class=""><li id="9477" class="nk nl it lt b lu mz lx na ma nm me nn mi no mm np nq nr ns bi translated">验证:如果新的状态值不符合特定的格式，则抛出一个错误。</li><li id="fca3" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">边界值:不要让我们的状态变量超过某个值。比如我们的<code class="fe ng nh ni nj b">dollar</code>变量不应该大于<code class="fe ng nh ni nj b">10</code>或者小于<code class="fe ng nh ni nj b">0</code>。</li></ul><p id="7101" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">对于中间件，Zustand开发者推荐使用<code class="fe ng nh ni nj b">immer</code>模块来设置状态值。这将考虑到代码的整洁。为此，运行以下终端命令:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="c248" class="mn la it nj b gy oo op l oq or">npm install immer</span></pre><p id="51ab" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">现在让我们为我们的中间件函数写一些代码。在<code class="fe ng nh ni nj b">state.js</code>中，首先从<code class="fe ng nh ni nj b">immer</code>导入<code class="fe ng nh ni nj b">produce</code>函数，如下所示:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="72fe" class="mn la it nj b gy oo op l oq or">import produce from "immer";</span></pre><p id="6094" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">接下来，添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><ul class=""><li id="1857" class="nk nl it lt b lu mz lx na ma nm me nn mi no mm np nq nr ns bi translated">第1行:创建<code class="fe ng nh ni nj b">limit</code>函数。<code class="fe ng nh ni nj b">set</code>参数是一个改变状态值的函数，而<code class="fe ng nh ni nj b">get</code>函数检索我们商店的状态和它们的值。</li><li id="e27d" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第5–7行:如果<code class="fe ng nh ni nj b">euros</code>状态的当前值大于<code class="fe ng nh ni nj b">10</code>，则将<code class="fe ng nh ni nj b">euros</code>变量设置为<code class="fe ng nh ni nj b">10</code>，然后退出该功能。</li><li id="c54a" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第8-10行:如果<code class="fe ng nh ni nj b">euros</code>的当前值小于<code class="fe ng nh ni nj b">0</code>(负值)，则将其设置回<code class="fe ng nh ni nj b">0</code>。</li><li id="b2ea" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第17行:<code class="fe ng nh ni nj b">immer</code>函数将改变我们的状态变量的值。</li></ul><p id="f195" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">我们将使用一个单独的商店来演示中间件功能。在<code class="fe ng nh ni nj b">state.js</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><ul class=""><li id="9930" class="nk nl it lt b lu mz lx na ma nm me nn mi no mm np nq nr ns bi translated">第1行:声明我们的<code class="fe ng nh ni nj b">useEuroStore</code> React钩子。</li><li id="4c9e" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第2行和第3行:告诉Zustand在这个商店上应用我们的中间件功能。</li><li id="5f59" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">第4–6行:创建我们的<code class="fe ng nh ni nj b">euros</code>状态及其相关动作。</li></ul><p id="56bd" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">我们现在需要将<code class="fe ng nh ni nj b">useEuroStore</code>添加到我们的出口中。在<code class="fe ng nh ni nj b">state.js</code>中找到以下行:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="9d4f" class="mn la it nj b gy oo op l oq or">export { useStore, useCountryStore};</span></pre><p id="34fb" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">像这样改变它:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="e4c8" class="mn la it nj b gy oo op l oq or">export { useStore, useCountryStore, useEuroStore};</span></pre><p id="eee6" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">我们现在已经完成了<code class="fe ng nh ni nj b">state.js</code>文件。</p><p id="a731" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">回到<code class="fe ng nh ni nj b">App.js</code>并获取您的<code class="fe ng nh ni nj b">euros</code>状态及其功能，如下所示:</p><pre class="kj kk kl km gt ok nj ol om aw on bi"><span id="d4d0" class="mn la it nj b gy oo op l oq or">//all states<br/>const euros = useEutoStore((state) =&gt; state.euros);</span><span id="7ede" class="mn la it nj b gy pb op l oq or"><em class="os">//all actions<br/></em>const increaseEuros = useEutoStore((state) =&gt; state.increaseEuros);<br/>const decreaseEuros = useEutoStore((state) =&gt; state.decreaseEuros);</span></pre><p id="f73b" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">最后，在<code class="fe ng nh ni nj b">App.js</code>文件的<code class="fe ng nh ni nj b">return</code>块中添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="381f" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">我们的代码终于完成了！运行它以查看它的运行情况:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/b78f09278388aa8a47bc4e906c18277c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/1*r35N82v0mDLXxGN0GoPG9w.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="5950" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">太神奇了。我们的代码像预期的那样工作！</p><p id="3848" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">最后，<code class="fe ng nh ni nj b">state.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0c47" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">而<code class="fe ng nh ni nj b">App.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="219e" class="kz la it bd lb lc of le lf lg og li lj jz oh ka ll kc oi kd ln kf oj kg lp lq bi translated">额外资源</h1><ul class=""><li id="86f2" class="nk nl it lt b lu lv lx ly ma pc me pd mi pe mm np nq nr ns bi translated">利用Zustand简化国家管理 — LogRocket博客</li><li id="e6e8" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=Ggb2nPEXahs" rel="noopener ugc nofollow" target="_blank"> Zustand教程</a>—YouTube上的Redhwan</li><li id="ee91" class="nk nl it lt b lu nt lx nu ma nv me nw mi nx mm np nq nr ns bi translated">Zustand:一个简单、快速的带挂钩的状态管理解决方案</li></ul></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="d49f" class="kz la it bd lb lc of le lf lg og li lj jz oh ka ll kc oi kd ln kf oj kg lp lq bi translated">结论</h1><p id="d462" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Zustand是一个易于使用的库，几乎没有任何样板文件。其微小的尺寸和较少的膨胀导致更快的应用程序。API非常干净，这意味着您的项目更容易维护。在我即将到来的项目中，我将使用Zustand进行全局状态管理，而不是Context或Redux。</p><p id="dd43" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">非常感谢你坚持到最后！</p></div></div>    
</body>
</html>