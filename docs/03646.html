<html>
<head>
<title>Ethereum DApps: How to Load the Blockchain</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊DApps:如何加载区块链</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ethereum-dapps-how-to-load-the-blockchain-8756ca0fa0d1?source=collection_archive---------20-----------------------#2020-02-24">https://betterprogramming.pub/ethereum-dapps-how-to-load-the-blockchain-8756ca0fa0d1?source=collection_archive---------20-----------------------#2020-02-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="febd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用<a class="ae ki" href="https://www.trufflesuite.com/" rel="noopener ugc nofollow" target="_blank">松露</a>、React、Redux、<a class="ae ki" href="https://web3js.readthedocs.io/en/v1.2.6/" rel="noopener ugc nofollow" target="_blank"> Web3 </a>和<a class="ae ki" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank">元掩码</a>的良好用户体验实践</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/9dd6e687fd0e3846e9712e0cfa973aa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-RrbWQH-R72evjrWr_LDFQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">由<a class="ae ki" href="https://pixabay.com/users/tumisu-148124/" rel="noopener ugc nofollow" target="_blank"> Tumisu </a>在<a class="ae ki" href="https://www.needpix.com/photo/1213172/blockchain-block-chain-technology-digital-finance-business-cryptocurrency-electronic" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄的图像</p></figure><h1 id="5fb7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="658d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><em class="mn">先决条件:了解</em> <a class="ae ki" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> <em class="mn">反应</em> </a> <em class="mn">、</em> <a class="ae ki" href="https://redux.js.org/introduction/getting-started/" rel="noopener ugc nofollow" target="_blank"> <em class="mn">重复、</em> </a> <em class="mn">以及基本的区块链/DApp概念。</em></p><p id="8b4f" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">Truffle使开发人员能够创建具有区块链后端的全栈应用程序。在这个例子中，我使用Truffle来实现React和Redux前端，以及区块链后端。</p><p id="70b0" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">由于这个领域还处于起步阶段，而且与所有网络用户相比，用户基数很小，所以在浏览器中与Web3交互还没有一个被广泛接受的标准。这里有一个简单的方法来确保用户在使用以太坊DApp时有良好的体验。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="d02f" class="kz la it bd lb lc na le lf lg nb li lj jz nc ka ll kc nd kd ln kf ne kg lp lq bi translated">加载区块链</h1><p id="f183" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">默认情况下，页面一加载，<a class="ae ki" href="https://www.trufflesuite.com/boxes/react" rel="noopener ugc nofollow" target="_blank"> React Truffle框</a>就会尝试连接到Web3。如果用户未登录元掩码或配置到未部署DApp的区块链，这会抑制用户体验。</p><h2 id="c150" class="nf la it bd lb ng nh dn lf ni nj dp lj ma nk nl ll me nm nn ln mi no np lp nq bi translated">提议:➼帐户➼互动区块链</h2><p id="7038" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我建议采用以下模式来加载DApp，而不是一次性加载所有内容:➼➼区块链账户交互。每一步都与其他步骤截然不同，为用户提供了清晰的视觉反馈。</p><ul class=""><li id="6209" class="nr ns it lt b lu mo lx mp ma nt me nu mi nv mm nw nx ny nz bi translated">步骤1:加载区块链</li><li id="7277" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated">第2步:加载帐户</li><li id="b9f5" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated">第三步:实现互动</li></ul><p id="f2bd" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">在本例中，有一个合同，以及该合同的DApp前端。在用户可以与合同交互之前，他们需要连接到区块链(我这里使用的是<code class="fe of og oh oi b">localhost</code>区块链，由<a class="ae ki" href="https://www.trufflesuite.com/ganache" rel="noopener ugc nofollow" target="_blank"> Ganache </a>提供)。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="213b" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">这里发生了几件事:</p><ul class=""><li id="2257" class="nr ns it lt b lu mo lx mp ma nt me nu mi nv mm nw nx ny nz bi translated">当页面加载时，不会加载Web3</li><li id="e8cc" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated"><strong class="lt iu">区块链</strong> —用户点击“连接区块链”将网页连接到他们在MetaMask中选择的区块链</li><li id="d0d8" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated"><strong class="lt iu">账户</strong> —一旦加载，应用程序提供第二个按钮来连接他们的钱包</li><li id="0dc2" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated"><strong class="lt iu">交互</strong> —用户现在能够与DApp交互</li></ul><h2 id="0cbd" class="nf la it bd lb ng nh dn lf ni nj dp lj ma nk nl ll me nm nn ln mi no np lp nq bi translated">连接区块链</h2><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ol"><img src="../Images/a680133d3ca7bfffbb89464df1e5bfba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ScdFl10ksSDpJvU1vVcCFw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图1: React渲染“连接区块链”按钮</p></figure><p id="b08c" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">使用<a class="ae ki" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank"> Bootstrap </a>，我们可以向用户提供关于他们选择的区块链是否连接的视觉反馈。在图1中，<code class="fe of og oh oi b">className</code>包括尚未加载的<code class="fe of og oh oi b">btn-danger</code>和已加载的<code class="fe of og oh oi b">btn-success</code>和<code class="fe of og oh oi b">disabled</code>类。Web3代表一个Redux状态选择器。</p><p id="feef" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">在图1中，<code class="fe of og oh oi b">connectBlockchain</code> <code class="fe of og oh oi b">onSubmit</code>动作通过交互获取Web3实例，如图2所示。它调度<code class="fe of og oh oi b">web3Loaded(web3)</code>缩减器，该缩减器将Web3实例保存到状态。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi om"><img src="../Images/03d7adf39f2a42f359d3b77bb2ac28e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*qTVk68xDgYpDGaxVAyIj_g.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图2:将Web3加载到状态</p></figure><h2 id="29e1" class="nf la it bd lb ng nh dn lf ni nj dp lj ma nk nl ll me nm nn ln mi no np lp nq bi translated">连接账户</h2><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi on"><img src="../Images/79d6fd35ed119f2dab4385ba092c3a8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1t8paUkU9C_5yc8infw1rQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图3:连接钱包</p></figure><p id="8715" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">图3显示了一个类似的渲染，其中我们根据是否已经加载了一个帐户，对“Connect Wallet”按钮应用了类似的规则。但是，这一次，如果加载了Web3，我们将对是否加载帐户应用一个额外的条件:</p><pre class="kk kl km kn gt oo oi op oq aw or bi"><span id="c658" class="nf la it oi b gy os ot l ou ov">(account !== null) ? “btn-success” : “btn-warning”</span></pre><p id="cab9" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><code class="fe of og oh oi b">connectWallet</code> <code class="fe of og oh oi b">onSubmit</code>动作是一个调用名为<code class="fe of og oh oi b">loadBlockchainData()</code>的交互的函数，如图4所示。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ow"><img src="../Images/d8824a454e5fb89f1029b03a9d1f18ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hNtZA0w-Nen8xlJFwJaBIA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图4:加载区块链数据</p></figure><p id="a72a" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">图4显示了<code class="fe of og oh oi b">loadBlockchainData()</code>，它依次在其第一行调用<code class="fe of og oh oi b">loadAccount()</code>。该函数获取MetaMask提供的帐户，并调度一个名为<code class="fe of og oh oi b">accountLoaded()</code>的动作，该动作通过一个reducer将帐户存储在我们的状态中。</p><p id="dc3d" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">一旦这些步骤完成，界面的其余部分就启用了，用户可以自由地与DApp交互。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="0b3d" class="kz la it bd lb lc na le lf lg nb li lj jz nc ka ll kc nd kd ln kf ne kg lp lq bi translated">结论</h1><p id="c28a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">将MetaMask与DApps一起使用可能会带来紧张的体验，这会阻止用户与您的DApp进行交互。使用类似<code class="fe of og oh oi b"><em class="mn">Blockchain-Account-Interaction</em></code> <strong class="lt iu"> </strong>的简单流程来构建你的DApps。</p><p id="c4aa" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">感谢阅读！</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><div class="kk kl km kn gt ox"><a href="https://medium.com/blockcentric/blockchain-development-resources-b44b752f3248" rel="noopener follow" target="_blank"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd iu gy z fp pc fr fs pd fu fw is bi translated">区块链开发资源马上跟进</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">学习区块链、以太坊和DApp开发的资源列表</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">medium.com</p></div></div><div class="pg l"><div class="ph l pi pj pk pg pl kt ox"/></div></div></a></div></div></div>    
</body>
</html>