<html>
<head>
<title>How To Implement a Custom MapKit Callout in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在iOS中实现自定义地图工具包标注</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-implement-a-custom-mapkit-callout-in-ios-e452cda98278?source=collection_archive---------4-----------------------#2022-03-30">https://betterprogramming.pub/how-to-implement-a-custom-mapkit-callout-in-ios-e452cda98278?source=collection_archive---------4-----------------------#2022-03-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="648a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于自定义地图工具包标注,“互联网”没有告诉您什么</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ab98de34198fef67f868cbb31c25c57c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ckETPNl7h8c_oXbIUbw5w.png"/></div></div></figure><p id="a8d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不久前，我不得不实现一个自定义的地图包标注。没什么特别的，它应该尽可能依赖于本机实现。</p><p id="3193" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我把我的经历写下来留给后人，希望可以让其他人不用花太多时间去研究如何实现自定义的地图工具包标注UI，同时仍然保持标记固定的原始外观。</p><p id="ec5e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，我开始钻研Apple文档来寻找解决方案，但是没有多少关于如何为标注构造和使用自定义UI的讨论。</p><p id="afdb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以，下一站，一些关于这个话题的谷歌搜索。正如所料，搜索开始产生一些方法，包括建议覆盖<code class="fe lq lr ls lt b">hitTest</code>然后提供一些相当复杂的逻辑的方法，但我不会在这里谈论这种方法。</p><p id="4ed5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一是因为<code class="fe lq lr ls lt b">hitTest</code>被弃用；第二，因为这种方法的复杂性实际上没有意义，即使最终结果是一样的。</p><p id="2949" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我的搜索过程中，有一种方法确实吸引了我的眼球，它的逻辑非常简单，非常有意义。这就是我在这篇文章中想要谈论的:它的优点是什么，缺点是什么，以及为什么它没有达到我的目的，我必须想出一种改进方法。</p><h1 id="6ac9" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">让我们编码</h1><p id="3c76" class="pw-post-body-paragraph ku kv it kw b kx mm ju kz la mn jx lc ld mo lf lg lh mp lj lk ll mq ln lo lp im bi translated">例如，假设我们在地图上有两个固定的地方:一个在白金汉宫，另一个在大本钟。为了填充这些数据，我创建了以下枚举:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="7a0a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦我们有了硬编码的应用数据，我们就可以定义我们的<code class="fe lq lr ls lt b">annotation</code>模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="fd0a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的准备工作还需要添加一个组件:标注的实际定制UI。它是<code class="fe lq lr ls lt b">UIView</code>的一个子视图，在顶部显示了两个标签:一个是注释名，另一个代表实际地址。在底部，我们有一个伦敦景点的图像。这就是我们定制UI的全部内容。下面是它的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="6df1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请再忍耐一会儿。我们完成了所有繁重的编码工作，将定制视图和注释数据放置到位。接下来，我将讨论两种不同的方法:一种是通过子类化<code class="fe lq lr ls lt b">MKPinAnnotationView</code>，另一种是我在之前的搜索中发现的，它实现了<code class="fe lq lr ls lt b">viewForAnnotation</code>委托方法。</p><h1 id="1ece" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">子类化<code class="fe lq lr ls lt b">MKPinAnnotationView Approach</code></h1><p id="255f" class="pw-post-body-paragraph ku kv it kw b kx mm ju kz la mn jx lc ld mo lf lg lh mp lj lk ll mq ln lo lp im bi translated">我们将通过子类化pin annotation视图并提供一个定制的<code class="fe lq lr ls lt b">detailCalloutAccessoryView</code>来创建我们的定制标注:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="771d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这看起来很好，很容易理解。接下来我们要补充的是如何利用这个<code class="fe lq lr ls lt b">AnnotationView</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="6e7e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的代码片段中，我在故事板中创建了我的<code class="fe lq lr ls lt b">mapView</code>来使事情变得简单。在<code class="fe lq lr ls lt b">viewDidLoad()</code>工作之后，我创建了我的注释，将它们添加到<code class="fe lq lr ls lt b">mapView</code>，然后注册我新创建的<code class="fe lq lr ls lt b">AnnotationView</code>。这就是显示自定义标注视图所需的全部实现。让我们看看它是如何工作的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/c9c3b083b1e40e3af9e16f5ce78b9a78.png" data-original-src="https://miro.medium.com/v2/resize:fit:560/1*sewpnmLl1EG8FEJ6S_NvLw.gif"/></div></figure><p id="7969" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当我点击批注时，标注显示良好；唯一让我抓狂的是展示的老式胸针。<code class="fe lq lr ls lt b">MKPinAnnotationView</code>的每一个子类都带有这个老式的别针。</p><p id="3ec8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我想要一个新的大头针样式，当你点击它的时候会有一个跳跃的动画。如果这是我对这种方法的唯一质疑。这就是我想出的第二种方法，它既易于实现，又利用了原生pin外观的优点。</p><h2 id="9938" class="mu lv it bd lw mv mw dn ma mx my dp me ld mz na mg lh nb nc mi ll nd ne mk nf bi translated"><strong class="ak">更新</strong></h2><p id="7e8c" class="pw-post-body-paragraph ku kv it kw b kx mm ju kz la mn jx lc ld mo lf lg lh mp lj lk ll mq ln lo lp im bi translated">基于<a class="ng nh ep" href="https://medium.com/u/232868446381?source=post_page-----e452cda98278--------------------------------" rel="noopener" target="_blank"> Gerd Castan </a>的评论，<code class="fe lq lr ls lt b">MKPinAnnotationView</code>被弃用，这解释了为什么引脚视图看起来很旧。这个旧注释视图的替代品是<code class="fe lq lr ls lt b">MKMarkerAnnotationView</code>。子类化标记注释视图将带有新的大头针外观和动画。</p><h1 id="d2db" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">实现视图注释方法</strong></h1><p id="0148" class="pw-post-body-paragraph ku kv it kw b kx mm ju kz la mn jx lc ld mo lf lg lh mp lj lk ll mq ln lo lp im bi translated">我将继续编码。没有必要对在<code class="fe lq lr ls lt b">viewController</code>中完成的所有实现进行子类化。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="954a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">变化很小，但影响很大。我们没有注册一个<code class="fe lq lr ls lt b">MKPinAnnotationView</code>子类，而是遵循<code class="fe lq lr ls lt b">MKMapViewDelegate</code>并在给定的注释上提供必要的修饰。现在，让我们看看这种方法是如何工作的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/40ff55f29871c90ab44d45662c66c8b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:560/1*es289uCo9hGb-eLyOa7i3w.gif"/></div></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="b124" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是我实现自定义标注视图的经验。我希望你喜欢这个故事，找到有用的信息，甚至一些指导。</p><p id="26a6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你想访问完整的代码，<a class="ae np" href="https://github.com/iOSifMol/CustomCallout" rel="noopener ugc nofollow" target="_blank">这里是链接</a>。</p></div></div>    
</body>
</html>