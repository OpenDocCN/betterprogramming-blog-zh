<html>
<head>
<title>Create a Simple npm Library to Use in and Out of the Browser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个简单的npm库，以便在浏览器内外使用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-simple-npm-library-to-use-in-and-out-of-the-browser-700f207eb73?source=collection_archive---------28-----------------------#2020-02-24">https://betterprogramming.pub/create-a-simple-npm-library-to-use-in-and-out-of-the-browser-700f207eb73?source=collection_archive---------28-----------------------#2020-02-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3c58" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">共享一些可重用的JavaScript很难——如果您试图在node和浏览器之间共享它，就更难了</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0c8c15fc4cc5b7c595447629b447211f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tkrmmsDqnSucIdeOgWIYqw.png"/></div></div></figure><p id="c4fc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">共享一些可重用的JavaScript很难——如果试图在node和浏览器之间共享，就更难了。我想做的只是分享10行代码——为什么要花一天多的时间来弄清楚呢？在这种时候，我不得不说服自己不要复制/粘贴。我知道这是错误的，可重复使用的包装更好，但以什么为代价？</p><ul class=""><li id="0d8a" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">有些JavaScript代码可以在浏览器中运行，有些只能在服务器端运行。</li><li id="e3ac" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">es6！= es2016，es5！= 2015，esNext/es8，(<em class="mb">这个多久换一次？！我发现这个解释很有帮助。</em></li><li id="dd1f" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">Webpack？巴贝尔？我没想到我会为了分享一些代码而不得不处理这些！</li></ul><p id="d972" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="mb">为什么我需要147 MB的node_modules来共享10行代码？</em></p><p id="90d3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在最近的工作中，我试图将20多行javascript代码提取到一个可重用的npm库中，以便在几个项目之间共享。我以为这很简单明了。当我发现事实并非如此时，我开始整理这篇文章来帮助指导人们如何构建一个可重用的npm包。</p><p id="2c8e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本指南中，我将创建一个react应用程序，加载狗、猫和山羊的随机图像——这只是我在<a class="ae mc" href="https://github.com/public-apis/public-apis" rel="noopener ugc nofollow" target="_blank">public-API</a>上找到的三个随机图像。然后我会将这些代码转换成一个可重用的npm包，它可以在浏览器和节点中与webpack、Babel和TypeScript一起使用。</p><p id="4b84" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我还在这里加入了<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo" rel="noopener ugc nofollow" target="_blank">intrinciate cloud/reusable-js-demo repo</a>，这样你就可以看看这个项目了。最好的跟进方式是<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commits/master" rel="noopener ugc nofollow" target="_blank">查看每个提交</a>以查看我所做的每个更改(它们也在每个部分之后被链接)。为了简洁起见，我编辑了其中的一些内容。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="8a7e" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">构建随机动物演示</h1><h2 id="fc5d" class="nc ml iq bd mm nd ne dn mq nf ng dp mu la nh ni mw le nj nk my li nl nm na nn bi translated">第一步。创建应用程序并运行它</h2><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="6a60" class="nc ml iq np b gy nt nu l nv nw">$ npx create-react-app random-animal-demo<br/>$ cd random-animal-demo<br/>$ npm start</span></pre><p id="7a85" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commit/582d2b1c7a3aafdc678f91a70e9f4de025765c84" rel="noopener ugc nofollow" target="_blank">完全提交582d2b </a>。</p><h2 id="745c" class="nc ml iq bd mm nd ne dn mq nf ng dp mu la nh ni mw le nj nk my li nl nm na nn bi translated">步骤2:将它连接到一些API</h2><p id="66eb" class="pw-post-body-paragraph kr ks iq kt b ku nx jr kw kx ny ju kz la nz lc ld le oa lg lh li ob lk ll lm ij bi translated">在应用程序中，我将显示一只狗、一只猫和一只山羊的图片。我将调整React演示应用程序中的一些样板文件。我采用了默认的React内容，并对其进行了重构，以显示一个图像和一些文本。现在我将集成这些免费的API，使用<code class="fe oc od oe np b">axios</code>来发出请求(它在浏览器和node中都有效)。</p><p id="f95e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用以下API，这些API允许我们从浏览器中调用它们:</p><ul class=""><li id="d305" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><a class="ae mc" href="https://aws.random.cat/meow" rel="noopener ugc nofollow" target="_blank">https://aws.random.cat/meow</a></li><li id="18bc" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><a class="ae mc" href="https://random.dog/woof.json" rel="noopener ugc nofollow" target="_blank">https://random.dog/woof.json</a></li><li id="4b8b" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><a class="ae mc" href="http://placegoat.com/200" rel="noopener ugc nofollow" target="_blank">http://placegoat.com/200</a></li></ul><p id="8d55" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您会注意到每个API的工作方式略有不同。cat API返回一个带有file属性的JSON对象，dog API返回一个带有URL属性的JSON对象，goat API返回图像本身。我给<code class="fe oc od oe np b">componentDidMount()</code>添加了一些逻辑，让它在计时器上运行，这样它每隔几秒就循环一次</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="0e39" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commit/3dd98c59542c0cb083802db871fdf66a1d8c10e0" rel="noopener ugc nofollow" target="_blank">完全提交3dd98c5 </a>。</p><h2 id="8391" class="nc ml iq bd mm nd ne dn mq nf ng dp mu la nh ni mw le nj nk my li nl nm na nn bi translated">步骤3:选择导入文件的方式</h2><p id="190c" class="pw-post-body-paragraph kr ks iq kt b ku nx jr kw kx ny ju kz la nz lc ld le oa lg lh li ob lk ll lm ij bi translated">一旦您想要将逻辑提取到另一个文件中，您必须决定如何导入它。有几个选项:</p><p id="700a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> ES6导入—如果你想使用</strong>T1】</p><p id="64c3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe oc od oe np b">animal-api.js</code></p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="b5bb" class="nc ml iq np b gy nt nu l nv nw">export default {<br/>  getDog: () =&gt; ...<br/>  getCat: () =&gt; ...<br/>  getGoat: () =&gt; ....<br/>}</span></pre><p id="887c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> ES6析构导入——如果你想使用</strong>T3】</p><p id="0814" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe oc od oe np b">animal-api.js</code></p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="4bb1" class="nc ml iq np b gy nt nu l nv nw">export const getCat = () =&gt; ...<br/>export const getDog = () =&gt; ...<br/>export const getGoat = () =&gt; ...</span></pre><p id="bfb6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">CommonJS——如果要用</strong>T5】</p><p id="6917" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe oc od oe np b">animal-api.js</code></p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="a45b" class="nc ml iq np b gy nt nu l nv nw">module.exports = {<br/>  getDog, getCat, getGoat<br/>}</span></pre><p id="80d9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你什么时候会选择一个而不是另一个？</p><p id="85cb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你的应用只需要在浏览器中工作，并且只在React(或Angular2+或使用ES6模块的环境)的上下文中工作，那么ES6导入就可以了。</p><p id="a4c4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你的库是要在浏览器中使用的，你需要把它包含在一个普通的JS HTML应用程序中，你需要使用一个捆绑器，比如webpack，把你的应用程序捆绑成一个库。</p><p id="42c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您使用webpack并利用代码分割和树抖动，您可以使用ES6析构导入。这意味着，你可以只包含你想要的功能，而不是在你的应用中包含所有的lodash，这样你就会有一个更小的内置应用。</p><p id="8e93" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您正在编写一个需要在浏览器<em class="mb">和节点</em>中运行的应用程序或库，那么您将需要生成几个不同版本的库——一个用于浏览器(作为脚本标签)，一个作为es6模块，一个用于节点。</p><p id="0f6e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于本指南，我们将编写一个ES6模块，因此我们可以使用<code class="fe oc od oe np b">import AnimalApi from 'animal-api'</code>作为目标。</p><p id="c9a5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你真的会把这些拿出来放入lib吗？大概不会。但这是一个例子，说明看起来如此简单的事情可以变得多么复杂。所以请容忍我。</p><p id="9676" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我可以修改我的<code class="fe oc od oe np b">App.js</code>文件来使用这个新文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="b6c4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe oc od oe np b">src/animal-api.js</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="55bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commit/37c3a3ab56c7f23db43d0b34bffdfc1b911b9f44" rel="noopener ugc nofollow" target="_blank">完全提交37c3a3a </a></p><p id="a5ad" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我们将把这个逻辑移到它自己的npm包中。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="0e04" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">如何打包您的库以供使用</h1><h2 id="1c0b" class="nc ml iq bd mm nd ne dn mq nf ng dp mu la nh ni mw le nj nk my li nl nm na nn bi translated">在本地创建新的npm库</h2><p id="ca34" class="pw-post-body-paragraph kr ks iq kt b ku nx jr kw kx ny ju kz la nz lc ld le oa lg lh li ob lk ll lm ij bi translated">在React项目之外为我们正在创建的npm包创建一个新文件夹:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="91da" class="nc ml iq np b gy nt nu l nv nw">$ mkdir animal-api<br/>$ cd animal-api<br/>$ npm init</span></pre><p id="7443" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以使用npm <code class="fe oc od oe np b">init</code>命令的所有默认设置，它会创建一个<code class="fe oc od oe np b">package.json</code>文件，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="aa07" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后我们将<code class="fe oc od oe np b">random-animal-demo</code>中的所有代码复制粘贴到<code class="fe oc od oe np b">animal-api/index.js</code>中，准备与<code class="fe oc od oe np b">import AnimalApi from 'animal-api'</code>一起使用。</p><p id="facc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为这是一个库，我们想添加一些测试来使它工作。我喜欢用jest，所以我们把它拉进来:<code class="fe oc od oe np b">npm install --save-dev jest</code></p><p id="d693" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后我们创建<code class="fe oc od oe np b">animal-api/spec/index.spec.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="373b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commit/6d797c27855dde59161c699b0a3c24885dd53a43" rel="noopener ugc nofollow" target="_blank">完全提交6d797c </a></p><p id="55fc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在运行<code class="fe oc od oe np b">jest</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="6627" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我认为这是最简单的部分，但是显然<code class="fe oc od oe np b">jest</code>不喜欢使用<code class="fe oc od oe np b">import</code>语句。</p><p id="de6c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">目前，只有一个<code class="fe oc od oe np b">index.js</code>文件和jest，它将运行在一个<code class="fe oc od oe np b">node.js</code>环境中，在那里<code class="fe oc od oe np b">import</code>还不被支持。(本演练使用节点10)。</p><p id="991a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是<code class="fe oc od oe np b">babel</code>发挥作用的地方。<code class="fe oc od oe np b">babel</code>将从<code class="fe oc od oe np b">node.js</code>支持的ES6(你可以使用<code class="fe oc od oe np b">import</code>)和ES5中转换(“翻译/编译”)你的js文件。Jest在这里有一个关于启用<a class="ae mc" href="https://jestjs.io/docs/en/getting-started#using-babel" rel="noopener ugc nofollow" target="_blank">巴别塔支持的章节</a>。我们将不得不安装更多的软件包和一些配置。</p><p id="9a26" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行<code class="fe oc od oe np b">npm install --save-dev babel-jest @babel/core @babel/preset-env</code>然后添加<code class="fe oc od oe np b">babel.config.js</code>。</p><p id="990d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe oc od oe np b">babel.config.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="b523" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，当您运行<code class="fe oc od oe np b">jest</code>时，您会看到下一个错误:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="6fef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">进步！它知道如何读取<code class="fe oc od oe np b">import</code>语句并运行测试。现在我少了一个依赖:<code class="fe oc od oe np b">axios</code>。运行<code class="fe oc od oe np b">npm install --save axios</code>并重新运行<code class="fe oc od oe np b">jest</code>——一切都是绿色的！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="80f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commit/fafc23a29290be2a13e9fae71810d6178cf9d451" rel="noopener ugc nofollow" target="_blank">完全提交fafc23a </a>。</p><p id="629c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我们将经历一些将这个包包含在另一个项目中的场景</p><h2 id="6849" class="nc ml iq bd mm nd ne dn mq nf ng dp mu la nh ni mw le nj nk my li nl nm na nn bi translated">场景1:一个只需要在浏览器中工作的库，并且你正在使用React/Angular2+ (ES6模块)</h2><p id="fff5" class="pw-post-body-paragraph kr ks iq kt b ku nx jr kw kx ny ju kz la nz lc ld le oa lg lh li ob lk ll lm ij bi translated">我现在处于一个很好的位置，可以尝试在我的React应用程序中包含这个库。我不会公开发布npm包，而是从我机器上的文件夹中“安装”它。我将切换回我的react应用程序并运行<code class="fe oc od oe np b">npm install ../animal-api</code>。</p><p id="c439" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe oc od oe np b">package.json</code>现在看起来是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="2dcb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我可以尝试从React应用程序中使用它。第回<code class="fe oc od oe np b">App.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="1998" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commit/a80289849ed9845286372e72db87192cb4aa2a44" rel="noopener ugc nofollow" target="_blank">完全提交a802898 </a>。</p><p id="2dda" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一切正常！太棒了，我现在有了一个可发布的包。巧合的是，已经有一个<code class="fe oc od oe np b">animal-api</code>发布到npm，所以我不会再添加一个了。如果你需要做的只是分享一些将要在React/Angular框架中使用的代码(在这里你可以使用<code class="fe oc od oe np b">import</code>)，那么你可以就此打住。继续你的生活，感激你不需要阅读场景2…</p><h2 id="51d4" class="nc ml iq bd mm nd ne dn mq nf ng dp mu la nh ni mw le nj nk my li nl nm na nn bi translated">场景2:在带有脚本标签的浏览器中使用库</h2><p id="f48c" class="pw-post-body-paragraph kr ks iq kt b ku nx jr kw kx ny ju kz la nz lc ld le oa lg lh li ob lk ll lm ij bi translated">这是我们想要创建一个文件作为脚本标签的地方。</p><p id="e933" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在您的<code class="fe oc od oe np b">animal-api</code>目录中，创建<code class="fe oc od oe np b">index.html</code>，使用<code class="fe oc od oe np b">npx http-server</code>运行本地web服务器，并访问<code class="fe oc od oe np b"><a class="ae mc" href="http://localhost:8080:" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></code> <a class="ae mc" href="http://localhost:8080:" rel="noopener ugc nofollow" target="_blank"> : </a></p><p id="5168" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe oc od oe np b">index.html</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="c3a1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commit/df79f052f82ecfacb266824d61eabdd570c790f9" rel="noopener ugc nofollow" target="_blank">完全提交df79f05 </a>。</p><p id="bc5e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是我遇到的第一个错误:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="9d3f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这意味着浏览器不能运行你的文件，因为它包含了导入语句。之前，我们使用了<code class="fe oc od oe np b">babel</code>，所以<code class="fe oc od oe np b">jest</code>可以使用<code class="fe oc od oe np b">import</code>关键字。我们必须在这里做一些类似的事情。唯一的区别是我们需要保存transpiled输出，这样我们就可以将它包含在浏览器中。因为我们在<code class="fe oc od oe np b">animal-api</code>中已经有了<code class="fe oc od oe np b">babel</code>作为依赖项，我们可以用它来转换成UMD模块:</p><p id="d15a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe oc od oe np b">npm install --save-dev @babel/plugin-transform-modules-umd @babel/core @babel/cli</code></p><p id="6198" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后我们运行<code class="fe oc od oe np b">babel index.js -d lib</code>，这将创建一个<code class="fe oc od oe np b">lib/index.js</code>文件，可以在您的浏览器中作为脚本标签使用。现在，我可以更新我的脚本标记，以指向另一个文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="03af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我刷新页面时，一个错误消失了，另一个留下了。</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="5f93" class="nc ml iq np b gy nt nu l nv nw">index.html:11 Uncaught ReferenceError: AnimalApi is not defined<br/>    at index.html:11</span></pre><p id="f52d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还没有配置创建UMD模块的巴别塔插件来使用我们想要的名字。因为我们的文件被命名为<code class="fe oc od oe np b">index.js</code>，我们将把<code class="fe oc od oe np b">babel.config.js</code>更新为:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="3c26" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">重新运行<code class="fe oc od oe np b">babel index.js -d lib</code>并刷新页面。</p><p id="3e4f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我得到一个新的错误！进步！</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="39ab" class="nc ml iq np b gy nt nu l nv nw">TypeError: AnimalApi.getDog is not a function<br/>    at index.html:8</span></pre><p id="7843" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个让人挠头。不管Babel对这个文件做了什么，我都无法访问我的函数了。让我们看看transpiled文件— <code class="fe oc od oe np b">lib/index.js</code> —是什么样子的。在这个文件中，我注意到两件事:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="dbd7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这表明在我的<code class="fe oc od oe np b">AnimalApi</code>全局对象上有一个<code class="fe oc od oe np b">.default</code>属性。这是一个小细节，当你使用<code class="fe oc od oe np b">import axios from 'axios'</code>语法时通常是看不见的。ES6包将提供默认导出，当您使用<code class="fe oc od oe np b">import</code>语句时，它知道为您查看<code class="fe oc od oe np b">.default</code>属性，因此您不需要编写它。</p><p id="234f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们更新我们的代码来匹配它:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="c288" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，当我们刷新浏览器时，我们得到下一个错误:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="7d64" class="nc ml iq np b gy nt nu l nv nw">index.js:36 Uncaught TypeError: Cannot read property 'get' of undefined<br/>    at Object.getDog (index.js:36)<br/>    at index.html:8</span></pre><p id="22ef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commit/5da97d81bda90d5e8d2e16415bfc7c5bf12b28f3" rel="noopener ugc nofollow" target="_blank">完全提交5da97d8 </a>。</p><p id="61eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是调用<code class="fe oc od oe np b">axios.get</code>失败，因为<code class="fe oc od oe np b">axios</code>未定义。我们所做的只是传输了<code class="fe oc od oe np b">index.js</code>文件。这里没有<code class="fe oc od oe np b">axios</code>的代码，浏览器不知道它应该在你的<code class="fe oc od oe np b">node_modules</code>目录中搜索它(也不能)。</p><p id="430e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要做的是创建一个JavaScript文件，其中内置了该库的所有依赖项，这样您只需要向您的站点添加一个脚本标签。巴别塔处理不了你的依赖，它只会翻译。</p><p id="938b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们现在需要介绍我们的第二个工具:webpack！</p><p id="209f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用webpack来查看我们的文件，所有导入和需要的内容都将打包到一个文件中:<code class="fe oc od oe np b">npm install --save-dev webpack webpack-cli</code></p><p id="cc70" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">将以下内容添加到<code class="fe oc od oe np b">webpack.config.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="bd12" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个配置将查看<code class="fe oc od oe np b">./index.js</code>并创建<code class="fe oc od oe np b">./lib/animal-api.js</code>，这将使用<code class="fe oc od oe np b">var</code>目标使变量<code class="fe oc od oe np b">AnimalApi</code>在JavaScript中可用。</p><p id="aee8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在运行<code class="fe oc od oe np b">webpack</code>,你会注意到<code class="fe oc od oe np b">lib/animal-api.js</code>变大了很多，有更多的胡言乱语。</p><p id="bebb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">回到您的<code class="fe oc od oe np b">index.html</code>并更新脚本标签:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="3d57" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commit/8f865c50ee9184e6fdd316076d41f1450cecd3b0" rel="noopener ugc nofollow" target="_blank">完全提交8f865c5 </a>。</p><p id="eb78" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">刷新页面。成功！数据显示出来了！如果这就是你所需要的，那么很好——你可以就此打住。否则，请继续阅读。</p><h2 id="a5c2" class="nc ml iq bd mm nd ne dn mq nf ng dp mu la nh ni mw le nj nk my li nl nm na nn bi translated">场景3:在浏览器和节点中使用库</h2><p id="7b55" class="pw-post-body-paragraph kr ks iq kt b ku nx jr kw kx ny ju kz la nz lc ld le oa lg lh li ob lk ll lm ij bi translated">我将创建一个普通的JavaScript文件，用node: <code class="fe oc od oe np b">node node-test.js</code>运行</p><p id="be2f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe oc od oe np b">node-test.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="d86d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我得到这个错误:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="2675" class="nc ml iq np b gy nt nu l nv nw">/Users/dperez/workspace/animal-api/index.js:1<br/>(function (exports, require, module, __filename, __dirname) { import axios from 'axios';                                                                     ^^^^^ </span><span id="19c0" class="nc ml iq np b gy oh nu l nv nw">SyntaxError: Unexpected identifier</span></pre><p id="a5ec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在使用Babel之前，当我们试图用<code class="fe oc od oe np b">jest</code>运行我们的<code class="fe oc od oe np b">index.spec.js</code>文件时，我们看到了这一点。我们试图导入一个带有<code class="fe oc od oe np b">require</code>的ES6模块，但这不会起作用，因为<code class="fe oc od oe np b">import</code>是ES6的一部分，而节点运行在ES5上(至少对于节点10是这样)。我们在场景1中使用Babel构建了一个<code class="fe oc od oe np b">lib/index.js</code>，它包含一个ES5模块(从ES6转换而来)。让我们用那个来代替。</p><p id="b8b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我现在得到这个错误:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="812f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们之前在浏览器中看到了这一点，并看到我们需要添加<code class="fe oc od oe np b">AnimalApi.default.getCat()</code>，因为babel将你的ES6模块转换成UMD模块的方式。一旦我们更新它:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="3cf7" class="nc ml iq np b gy nt nu l nv nw">☁  animal-api [master] ⚡ node node-test.js<br/>{ logo: 'https://purr.objects-us-east-1.dream.io/i/v0SoPzk.jpg',  text: 'CAT' }</span></pre><p id="beef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看一下<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commit/3cdea8737f6db1593e48678f2f0e5e61a1198aa2" rel="noopener ugc nofollow" target="_blank">完全提交3cdea87 </a>。</p><p id="3430" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">成功！为了使用<code class="fe oc od oe np b">node.js</code>中的库，我们可以使用由Babel创建的ES5模块<code class="fe oc od oe np b">lib/index.js</code>。</p><h2 id="9aa4" class="nc ml iq bd mm nd ne dn mq nf ng dp mu la nh ni mw le nj nk my li nl nm na nn bi translated">场景4:您希望在您的库中使用Typescript，但是仍然像平常一样将其包含在React/node项目中</h2><p id="47cb" class="pw-post-body-paragraph kr ks iq kt b ku nx jr kw kx ny ju kz la nz lc ld le oa lg lh li ob lk ll lm ij bi translated">如果您喜欢使用TypeScript并且更愿意使用TypeScript创建您的库，但是仍然在其他非TypeScript项目中使用它，该怎么办？别担心，有一个简单的解决办法。</p><p id="8a39" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将添加一个包含库的<code class="fe oc od oe np b">index.ts</code>文件，只使用TypeScript。这是它与我们的<code class="fe oc od oe np b">index.js</code>文件相比的样子。我们加了一个<code class="fe oc od oe np b">interface</code>，加了一个函数签名:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="560f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们尝试通过添加以下内容直接从react运行这个<code class="fe oc od oe np b">.ts</code>文件:</p><p id="c0cc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe oc od oe np b">App.js</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="ca97" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我们刷新应用程序时，我们看到以下错误:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="4196" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">问题是React不知道怎么处理你的<code class="fe oc od oe np b">.ts</code>文件。现在您需要将您的<code class="fe oc od oe np b">index.ts</code>文件转换成React可以读取的东西ES6模块或ES5模块。</p><p id="435b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">TypeScript能够在没有Babel帮助的情况下做到这一点。我们可以将我们的文件编译成ES5模块，然后我们可以<code class="fe oc od oe np b">import</code>或<code class="fe oc od oe np b">require</code>。首先安装typescript: <code class="fe oc od oe np b">npm install --save-dev typescript</code>。</p><p id="946e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">添加一个<code class="fe oc od oe np b">tsconfig.js</code>来配置您的TypeScript编译器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="a616" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我们运行<code class="fe oc od oe np b">tsc</code>时，我们得到<code class="fe oc od oe np b">dist/index.js</code>和我们可以从React项目或<code class="fe oc od oe np b">node-test.js</code>文件中包含的文件。</p><p id="1ae3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe oc od oe np b">index.html</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="b465" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commit/26251248f2e6a4de43eb853db7ddb10203153dbb" rel="noopener ugc nofollow" target="_blank">完全提交2625124 </a>。</p><p id="9802" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，当你刷新你的页面时，成功了！</p><h2 id="06f9" class="nc ml iq bd mm nd ne dn mq nf ng dp mu la nh ni mw le nj nk my li nl nm na nn bi translated">场景5:您希望使用Typescript构建一个作为脚本标记包含的库</h2><p id="c40f" class="pw-post-body-paragraph kr ks iq kt b ku nx jr kw kx ny ju kz la nz lc ld le oa lg lh li ob lk ll lm ij bi translated">当我们想要使用脚本标签包含一个库或项目时，我们需要使用捆绑器来确保我们的项目的依赖项包含在我们的库中。早些时候，我们使用webpack来做到这一点。没有太多的麻烦，我们能够产生一个可以作为<code class="fe oc od oe np b">&lt;script src="./lib/animal-api.js"&gt;</code>包含的JavaScript包。</p><p id="0c3d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将更新<code class="fe oc od oe np b">webpack.config.js</code>来添加一个可以读取你的脚本文件并对其进行处理的脚本加载器。我们还是会用webpack来捆绑它。</p><p id="5ee3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行<code class="fe oc od oe np b">npm install --save-dev ts-loader</code>安装加载程序，然后更新webpack配置。</p><p id="f112" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe oc od oe np b">webpack.config.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="2e14" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是我们要添加到我们的webpack配置中以构建和捆绑这个项目所要做的一切。一旦你运行了<code class="fe oc od oe np b">webpack</code>，你将得到一个新的文件<code class="fe oc od oe np b">./lib/animal-api.js</code>。回到你的测试<code class="fe oc od oe np b">index.html</code>文件来测试它。就是这样！</p><p id="ce65" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">检查最后一次<a class="ae mc" href="https://github.com/intricatecloud/reusable-js-demo/commit/cc18f80383093e00451b990bebd9dfdcce1e08b8" rel="noopener ugc nofollow" target="_blank">完全提交cc18f80 </a>。</p><p id="dbf8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有几件事需要注意。我们简单的库有多个需要维护的入口点。</p><ul class=""><li id="9159" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">如果你可以使用<code class="fe oc od oe np b">import AnimalApi from 'animal-api'</code>消费ES6模块，那么这将依赖于你的<code class="fe oc od oe np b">./index.js</code>文件。</li><li id="a08e" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">如果你想在浏览器中使用你的ES6模块，你需要使用<code class="fe oc od oe np b">./lib/animal-api.js</code>文件，这将使<code class="fe oc od oe np b">AnimalApi</code>通过Babel插件全球可用，并通过webpack捆绑所有的依赖项。</li><li id="d945" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">如果你想在node中使用你的ES6模块，那么你需要使用<code class="fe oc od oe np b">./lib/index.js</code>，我们用babel构建的UMD模块。</li><li id="5404" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">如果你想从另一个TypeScript项目中使用你的TypeScript文件，你需要使用<code class="fe oc od oe np b">./lib/index.ts</code>。</li><li id="f272" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">如果您想在node.js环境中使用您的TypeScript文件，您必须使用<code class="fe oc od oe np b">tsc</code>将其编译成一个ES5模块，然后您可以重用它。</li><li id="110f" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">如果您想在<code class="fe oc od oe np b">&lt;script src="mylib.js"&gt;</code>中使用您的类型脚本文件，您需要使用<code class="fe oc od oe np b">webpack</code>和<code class="fe oc od oe np b">ts-loader</code>来编译您的类型脚本，捆绑所有的依赖项，并生成一个UMD包。</li></ul><p id="4259" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您的源文件和构建文件都可以随您的npm包一起分发，让用户选择他们需要的文件。但是它确实需要您在适当的位置放置大量的工具来创造这种便利。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="2682" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">包扎</h1><p id="bfdb" class="pw-post-body-paragraph kr ks iq kt b ku nx jr kw kx ny ju kz la nz lc ld le oa lg lh li ob lk ll lm ij bi translated">请记住，您可以通过查看这里的repo来逐个提交。</p><p id="fcb5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢您的阅读。我希望这有助于您理解不同模块类型之间的区别，以及如何从我们的应用程序中提取一个我们可以在浏览器内外使用的库。</p><p id="957e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你对react的更多内容感兴趣，请查看我的深入指南<a class="ae mc" href="https://www.intricatecloud.io/2019/08/adding-google-sign-in-to-your-webapp-a-react-example/" rel="noopener ugc nofollow" target="_blank">将谷歌登录添加到React应用</a>，或者我的指南<a class="ae mc" href="https://www.intricatecloud.io/2018/04/creating-your-serverless-website-in-terraform-part-2/" rel="noopener ugc nofollow" target="_blank">使用S3 + Cloudfront和terraform部署静态网站</a>。</p></div></div>    
</body>
</html>