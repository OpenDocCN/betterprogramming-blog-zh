<html>
<head>
<title>Combine SwiftUI With Alamofire</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">结合SwiftUI和Alamofire</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/combine-swiftui-with-alamofire-abb4cd4a0aca?source=collection_archive---------3-----------------------#2019-11-06">https://betterprogramming.pub/combine-swiftui-with-alamofire-abb4cd4a0aca?source=collection_archive---------3-----------------------#2019-11-06</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="14d9" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">用声明式和反应式框架联网</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/620956970435e7f307a62596da73f402.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7SYBgrbNOfbD45I3NRxeKA.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图片来自<a class="ae kz" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3228704" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae kz" href="https://pixabay.com/users/sumanley-2265479/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3228704" rel="noopener ugc nofollow" target="_blank"> Sumanley xulx </a></p></figure><p id="90ea" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在WWDC 2019期间，除了SwiftUI，苹果还推出了自己的反应式编程框架Combine。它是在RxSwift框架已经成熟的时候出现的。尽管在Combine中有一点很突出，那就是对背压的支持。</p><p id="3be5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">本文的目标是将Alamofire与SwiftUI连接起来，同时利用Combine框架。</p><p id="bb3a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们混合这三个要素来构建一个完美的配方之前，让我们快速浏览一下<a class="ae kz" href="https://developer.apple.com/documentation/combine" rel="noopener ugc nofollow" target="_blank">联合收割机框架</a>。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="36e1" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">什么是联合？</h1><p id="9b87" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">Combine Framework将功能性、反应性和声明性的编程范式引入了苹果的生态系统。概括地说，它由三个核心组件组成:</p><ul class=""><li id="8424" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated"><strong class="lc iv">出版商</strong> —他们发布数据(比如说，媒体作者)。</li><li id="4c09" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated"><strong class="lc iv">订阅者</strong> —他们收听数据(假设是中等读者)。</li><li id="1212" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated"><strong class="lc iv">操作符</strong> —这些操作符处理发出的数据(我们称之为媒体编辑器。)</li></ul><h2 id="3bde" class="no me iu bd mf np nq dn mj nr ns dp mn lj nt nu mp ln nv nw mr lr nx ny mt nz bi translated">可观察对象和被观察对象</h2><p id="009f" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">协议是联合框架的一部分。具有需要SwiftUI观察的属性的类必须符合<code class="fe oa ob oc od b">ObservableObject</code>协议。</p><p id="f45a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">属性需要标记为<code class="fe oa ob oc od b">@Published</code>，基本上是一个属性包装器，用于根据值的变化更新SwiftUI中的视图。</p><p id="de02" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe oa ob oc od b">ObservedObject</code>用于将<code class="fe oa ob oc od b">ObservableObject</code>实例绑定到视图。</p><p id="ac67" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">总而言之:</p><ul class=""><li id="ec09" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated"><code class="fe oa ob oc od b">ObservedObjects</code>是<code class="fe oa ob oc od b">Publishers</code>。</li><li id="e964" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">SwiftUI视图是<code class="fe oa ob oc od b">Subscribers</code>。</li></ul><p id="86e1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在我们已经对Combine框架的组成有了一个概念，让我们将Alamofire引入其中，并构建我们酷的iOS应用程序。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="42a0" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">最终目的地</h1><p id="d3aa" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">我们将开发一个基于SwiftUI的应用程序，使用著名的<a class="ae kz" href="http://www.icndb.com/api/" rel="noopener ugc nofollow" target="_blank"> Chuck Norris API </a>显示笑话列表。以下是我们计划实现的目标:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oe"><img src="../Images/b8aeaed328af4f37cfc3d9d88d01915e.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/1*nwrW0CZtKgNNrrDk2REkjA.gif"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">最终目标</p></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="ce30" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">将Alamofire添加到我们的项目中</h1><p id="e24e" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">启动一个新的基于Xcode、SwiftUI的项目，并添加<a class="ae kz" href="https://github.com/Alamofire/Alamofire" rel="noopener ugc nofollow" target="_blank"> Alamofire </a>依赖项。你可以使用Cocoapods，Swift Package Manager或者Carthage，哪个最适合你。</p><p id="c07b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">完成后，只需将Alamofire导入到您的Swift类中。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="6b19" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">隐私权限</h1><p id="4ac4" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">确保您已经在<code class="fe oa ob oc od b">info.plist</code>文件中添加了App Transport Security，如下所示，因为我们正在处理一个HTTP网络请求。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj of"><img src="../Images/06ca63946d342c4c83d4b2d5da892eb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*TNt0-zNUezFf_b97K1Uriw.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><code class="fe oa ob oc od b">Info.plist</code>文件</p></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="8568" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">设置我们的模型结构</h1><p id="3f1e" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">我们的模型需要为列表实现<code class="fe oa ob oc od b">Identifable</code>协议，以将每一行标识为唯一的一行。在下面的代码中，我们只存储字符串消息和id:</p><pre class="kk kl km kn gu og od oh oi aw oj bi"><span id="53d6" class="no me iu od b gz ok ol l om on">struct JokesData : Identifiable{</span><span id="2d6d" class="no me iu od b gz oo ol l om on">public var id: Int<br/>public var joke: String</span><span id="ad13" class="no me iu od b gz oo ol l om on">}</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="1ace" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">设置我们的观察者类</h1><p id="d045" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">如前所述，我们需要符合我们类中的<code class="fe oa ob oc od b">ObservableObject</code>，并将属性设置为<code class="fe oa ob oc od b">Published</code>，用于通知SwiftUI视图的更新。下面的代码实现了这一点，并将API响应添加到模型结构中。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="op oq l"/></div></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="e192" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">构建我们的内容视图</h1><p id="c507" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">最后，我们将<code class="fe oa ob oc od b">ObservedObject</code>中的published属性设置到列表中，如下面的代码所示:</p><pre class="kk kl km kn gu og od oh oi aw oj bi"><span id="7c1c" class="no me iu od b gz ok ol l om on">struct ContentView: View {<br/>    @ObservedObject var observed = Observer()<br/>    <br/>    var body: some View {<br/>        NavigationView{<br/>            List(observed.jokes){ i in<br/>                HStack{Text(i.joke)}<br/>                }.navigationBarItems(<br/>                  trailing: Button(action: addJoke, label: { Text("Add") }))<br/>            .navigationBarTitle("SwiftUI Alamofire")<br/>        }<br/>    }<br/>    <br/>    func addJoke(){<br/>        observed.getJokes(count: 1)<br/>    }<br/>}</span></pre><p id="8080" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在上面的代码中，我们还添加了一个导航栏按钮，为从API响应收到的每个新笑话更新SwiftUI列表。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj or"><img src="../Images/e12cb65d4909cc721592cd357070dca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QMNt2Nnutkf7D0FKbfW5gw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">API响应的实时预览。</p></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="118a" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">结论</h1><p id="73ea" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">由于SwiftUI预览，我们不再需要依赖模拟器来模拟API请求和响应。这一切都发生在预览本身。完整的源代码可以在这个<a class="ae kz" href="https://github.com/anupamchugh/iowncode/tree/master/SwiftUIAlamofire" rel="noopener ugc nofollow" target="_blank"> Github库</a>中找到。</p><p id="c02c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这就结束了。我希望你喜欢阅读，也能开怀大笑。</p></div></div>    
</body>
</html>