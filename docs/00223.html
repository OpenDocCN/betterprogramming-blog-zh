<html>
<head>
<title>How to Deploy Your Flask App to Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Flask应用程序部署到Heroku</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-get-your-flask-app-running-on-heroku-892030811c0f?source=collection_archive---------0-----------------------#2018-11-07">https://betterprogramming.pub/how-to-get-your-flask-app-running-on-heroku-892030811c0f?source=collection_archive---------0-----------------------#2018-11-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b6ff" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">本教程假设您正在将一个现有的应用程序部署到Heroku，该应用程序是使用Flask和Python 3开发的，没有数据库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/e412bd276b5c9c5588bb855dea53ffa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*CzmBRJORFaYCXrMZ8aPVyg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">照片由<a class="ae ku" href="https://unsplash.com/s/photos/launch?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ku" href="https://unsplash.com/@centelm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">clment Falize</a>拍摄</p></figure><p id="4d52" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">部署是复杂的，需要了解许多移动部件。不幸的是，通常没有一个适合所有人的分步指南来部署给定的应用程序。在整篇文章中，我链接了重要的背景信息，如果出现问题，这些信息可能有助于您进行调试。</p><p id="22dc" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我和很多学生一起工作，将Flask项目部署到Heroku，所以我非常熟悉边缘案例和您可能会忘记的事情。常见的遗漏步骤已被收录为<strong class="kx iu">注释</strong>，请密切关注！</p><p id="56da" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">本教程假设您正在将一个现有的应用程序部署到Heroku，该应用程序是使用Flask和Python 3开发的，没有数据库。如果您的应用程序使用数据库，本教程可能会对非数据库部分有所帮助。如果你正在使用Postgres，阅读关于这个主题的Heroku指南。</p><div class="lr ls gp gr lt lu"><a href="https://devcenter.heroku.com/articles/heroku-postgresql#provisioning-heroku-postgres" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab fo"><div class="lw ab lx cl cj ly"><h2 class="bd iu gy z fp lz fr fs ma fu fw is bi translated">Heroku Postgres</h2><div class="mb l"><h3 class="bd b gy z fp lz fr fs ma fu fw dk translated">Heroku Postgres是由Heroku直接提供的托管SQL数据库服务。您可以访问Heroku Postgres…</h3></div><div class="mc l"><p class="bd b dl z fp lz fr fs ma fu fw dk translated">devcenter.heroku.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi ko lu"/></div></div></a></div></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="d775" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">瓶</h1><h2 id="bce8" class="ni mr it bd ms nj nk dn mw nl nm dp na le nn no nc li np nq ne lm nr ns ng nt bi translated">虚拟</h2><p id="8e10" class="pw-post-body-paragraph kv kw it kx b ky nu ju la lb nv jx ld le nw lg lh li nx lk ll lm ny lo lp lq im bi translated">如果你还没有在<code class="fe nz oa ob oc b">virtualenv</code>中开发你的应用，现在就做一个(否则跳到下一部分):</p><p id="e865" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在项目目录中，运行:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="2764" class="ni mr it oc b gy oh oi l oj ok">$ virtualenv -p python3 env</span></pre><p id="92f8" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然后，激活它:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="8f56" class="ni mr it oc b gy oh oi l oj ok">$ source env/bin/activate</span></pre><p id="efc0" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">注意:</strong>如果您关闭外壳/终端窗口，请确保重新激活virtualenv！</p><p id="4b93" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">检查以确保你的<code class="fe nz oa ob oc b">virtualenv</code>和<code class="fe nz oa ob oc b">pip</code>使用的是Python 3:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="011b" class="ni mr it oc b gy oh oi l oj ok">$ pip --version &amp;&amp; python --version</span></pre><p id="4238" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">你不应该在任何地方看到Python 2.7。如果你这样做了，你的虚拟能力就有问题，你需要在继续前进之前解决它。</p><p id="fd40" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">运行您的应用程序。您可能会丢失依赖错误，所以您需要<code class="fe nz oa ob oc b">pip install</code>那些。例如:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="2855" class="ni mr it oc b gy oh oi l oj ok">$ pip install flask</span></pre><p id="6113" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果这是你第一次使用<code class="fe nz oa ob oc b">virtualenv</code>，我强烈推荐你在这里阅读它们。</p><h2 id="31ac" class="ni mr it bd ms nj nk dn mw nl nm dp na le nn no nc li np nq ne lm nr ns ng nt bi translated">要安装的软件包</h2><p id="3ecc" class="pw-post-body-paragraph kv kw it kx b ky nu ju la lb nv jx ld le nw lg lh li nx lk ll lm ny lo lp lq im bi translated">你将需要<a class="ae ku" href="https://gunicorn.org/" rel="noopener ugc nofollow" target="_blank"> Gunicorn </a>:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="de39" class="ni mr it oc b gy oh oi l oj ok">$ pip install gunicorn</span></pre><p id="8e0b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">Gunicorn是一个<a class="ae ku" href="https://www.fullstackpython.com/wsgi-servers.html" rel="noopener ugc nofollow" target="_blank"> WSGI </a> HTTP服务器，当你的应用被部署时，它将处理对你的应用的请求。大多数人都用它来部署Python应用程序。</p><p id="c934" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">完成后，确保pip安装了所有正确的依赖项，并且<code class="fe nz oa ob oc b">virtualenv</code>处于活动状态，然后运行:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="2842" class="ni mr it oc b gy oh oi l oj ok">$ touch requirements.txt<br/>$ pip freeze &gt; requirements.txt</span></pre><p id="a36c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这个命令会将你的应用程序的所有依赖项添加到一个文件中，这个文件会告诉Heroku它需要安装什么。仔细检查您的新<code class="fe nz oa ob oc b">requirements.txt</code>文件。确保Flask和Gunicorn在那里，并且你没有意外地<code class="fe nz oa ob oc b">pip freeze</code>你的整个本地Python环境(如果你有，Heroku会对你非常不满意)。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="8e45" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">赫罗库的文件</h1><p id="a633" class="pw-post-body-paragraph kv kw it kx b ky nu ju la lb nv jx ld le nw lg lh li nx lk ll lm ny lo lp lq im bi translated">将以下文件放在主应用程序所在的目录中:</p><h2 id="db37" class="ni mr it bd ms nj nk dn mw nl nm dp na le nn no nc li np nq ne lm nr ns ng nt bi translated"><strong class="ak">过程文件</strong></h2><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="3b04" class="ni mr it oc b gy oh oi l oj ok">web: gunicorn -w 4 app_file:app_name</span></pre><p id="dfed" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这个档案是专门给Heroku的。将这里的<code class="fe nz oa ob oc b">app_file</code>替换为你的主应用文件的名称。我通常只给我的取名为<code class="fe nz oa ob oc b">app.py</code>，所以<code class="fe nz oa ob oc b">app</code>可以。</p><p id="105b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe nz oa ob oc b">app_name</code>是你对Flask应用程序的命名，所以如果你的应用程序在一个名为<code class="fe nz oa ob oc b">salmon.py</code>的文件中，有一行看起来像<code class="fe nz oa ob oc b">aardvark = Flask(__name__)</code>，那么最后一行看起来像<code class="fe nz oa ob oc b">salmon:aardvark</code>。</p><p id="6c35" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然而，您很可能有一个名为<code class="fe nz oa ob oc b">app.py</code>的文件，其中有一行类似于<code class="fe nz oa ob oc b">app = Flask(__name__)</code>的内容。在这种情况下，您的Procfile应该只包含:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="e4a9" class="ni mr it oc b gy oh oi l oj ok">web: gunicorn -w 4 app:app</span></pre><p id="d9e9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe nz oa ob oc b">-w 4</code>指定我们想要四个<a class="ae ku" href="https://en.wikipedia.org/wiki/Thread_pool" rel="noopener ugc nofollow" target="_blank">工作线程</a>。一个Procfile也可以有很多其他的设置，你可以在这里读到<a class="ae ku" href="https://devcenter.heroku.com/articles/python-gunicorn" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="df1f" class="ni mr it bd ms nj nk dn mw nl nm dp na le nn no nc li np nq ne lm nr ns ng nt bi translated"><strong class="ak"> runtime.txt </strong></h2><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="d6cb" class="ni mr it oc b gy oh oi l oj ok">python-3.6.6</span></pre><p id="a14a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">Heroku需要知道使用哪个Python版本。不幸的是，它并不支持每一个版本，所以你通常应该在开发中使用一个支持的版本。如何做到这一点超出了本教程的范围，所以我们只是要选择一个版本。要找出您本地有哪个运行时，请执行<code class="fe nz oa ob oc b">python --version</code>。然后，检查H <a class="ae ku" href="https://devcenter.heroku.com/articles/python-support#supported-runtimes" rel="noopener ugc nofollow" target="_blank"> eroku支持的运行时，</a>并选择最接近你的运行时(但不要使用2.7)。</p><h2 id="d4cb" class="ni mr it bd ms nj nk dn mw nl nm dp na le nn no nc li np nq ne lm nr ns ng nt bi translated"><strong class="ak">。gitignore </strong></h2><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="d13f" class="ni mr it oc b gy oh oi l oj ok">env<br/>*.pyc</span></pre><p id="b79e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">拥有一个<code class="fe nz oa ob oc b">.gitignore</code>并不是严格要求的，但是强烈推荐。如果你没有，你会从你的开发环境中上传不必要的东西。</p><p id="2aef" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">注意:</strong>如果你在开发中使用SQLite，你会很想添加那个文件，因为Heroku不需要它。另外，在您的生产环境中有您不需要的文件会导致奇怪的错误。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="10bf" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">饭桶</h1><p id="651f" class="pw-post-body-paragraph kv kw it kx b ky nu ju la lb nv jx ld le nw lg lh li nx lk ll lm ny lo lp lq im bi translated">如果您还没有使用Git进行版本控制，您将需要使用它来部署到Heroku <a class="ae ku" href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" rel="noopener ugc nofollow" target="_blank">(安装说明</a>)。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="8e85" class="ni mr it oc b gy oh oi l oj ok">$ git init<br/>$ git add -A<br/>$ git commit -m "deploying to heroku"</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="936a" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">赫罗库</h1><p id="ac11" class="pw-post-body-paragraph kv kw it kx b ky nu ju la lb nv jx ld le nw lg lh li nx lk ll lm ny lo lp lq im bi translated"><a class="ae ku" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank">注册Heroku，</a>和<a class="ae ku" href="https://devcenter.heroku.com/articles/heroku-cli" rel="noopener ugc nofollow" target="_blank">如果你还没有安装CLI </a>。确保您位于正在部署的应用程序的顶层目录中，并运行:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="4ae9" class="ni mr it oc b gy oh oi l oj ok">$ heroku login<br/>$ heroku create example-app-name<br/>$ git push heroku master</span></pre><p id="8ab9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">很有可能出现了一些错误。如果有，查看底部的调试提示。一旦你得到这个工作，运行:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="f81d" class="ni mr it oc b gy oh oi l oj ok">$ heroku open</span></pre><p id="46d9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">希望这行得通，并且您已经部署了您的应用程序！请在评论中告诉我你哪里出了问题，以及你是如何解决的。</p><h2 id="4378" class="ni mr it bd ms nj nk dn mw nl nm dp na le nn no nc li np nq ne lm nr ns ng nt bi translated">调试Heroku</h2><p id="3f70" class="pw-post-body-paragraph kv kw it kx b ky nu ju la lb nv jx ld le nw lg lh li nx lk ll lm ny lo lp lq im bi translated">在你急着让你的应用在Heroku上运行之前，要确保你的应用在本地运行。</p><p id="d4ea" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当我第一次部署Python应用程序时，最常见的错误消息似乎是<code class="fe nz oa ob oc b">pip install</code>错误。它们看起来有点像这样:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="d3fd" class="ni mr it oc b gy oh oi l oj ok"><strong class="oc iu">remote:          Could not find a version that satisfies the requirement pkg-resources==0.0.0 (from -</strong>r/tmp/build_1b06c0323986c42337cfd16a42542c2a/requirements.txt (line 11)) (from versions: )<br/>remote:        No matching distribution found for pkg-resources==0.0.0 (from -r /tmp/build_1b06c0323986c42337cfd16a42542c2a/requirements.txt (line 11))<br/>remote:  !     Push rejected, failed to compile Python app.</span></pre><p id="525f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果发生这种情况，请尝试编辑您的<code class="fe nz oa ob oc b">requirements.txt</code>文件中的版本号。上面的错误原来是与我的操作系统有关的错误，所以我只是从<code class="fe nz oa ob oc b">requirements.txt</code>中删除了<code class="fe nz oa ob oc b">pkg-resources==0.0.0</code>，然后再试一次。</p><p id="776e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">注:</strong>另一种真的很常见(而且很难诊断！)错误是您的某个模块/文件/文件夹与Heroku正在使用的某个模块具有相同的名称。你可以通过跟随<code class="fe nz oa ob oc b">traceback</code>来判断这正在发生。试着找出不是你写的代码抛出的错误，因为它试图调用你写的代码。不幸的是，解决这个问题的方法是重命名冲突的文件夹/文件。</p><p id="7885" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果您正在部署数据科学项目<strong class="kx iu">(例如</strong>像tweet generators)，您可能会在某个时候看到这样的错误:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="d649" class="ni mr it oc b gy oh oi l oj ok">Error R14 (Memory quota exceeded)</span></pre><p id="978e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这意味着你的应用程序使用了太多的Heroku内存，你要么需要优化你的代码，要么增加Heroku允许它使用的内存量。</p><p id="2e02" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">查看最近的错误信息:</strong></p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="0c01" class="ni mr it oc b gy oh oi l oj ok">heroku logs --tail</span></pre><p id="78b2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">Heroku日志可能看起来令人困惑，但是请寻找那些熟悉的Python回溯。寻找类似于<code class="fe nz oa ob oc b">Python can not find Flask</code>的消息，这些消息可能表明您的<code class="fe nz oa ob oc b">requirements.txt</code>有问题。</p><p id="8149" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您也可以尝试关闭并再次打开它。</p><p id="cb38" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">重启你的app </strong>:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="18bb" class="ni mr it oc b gy oh oi l oj ok">heroku restart</span></pre><p id="fcbc" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当我想到更多的技巧时，我会更新这篇文章。</p></div></div>    
</body>
</html>