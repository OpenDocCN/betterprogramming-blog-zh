<html>
<head>
<title>Build a Cloud-Native Multiprocessing Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建云原生多处理框架</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-cloud-native-multiprocessing-framework-b33cfc2c02b9?source=collection_archive---------12-----------------------#2022-07-04">https://betterprogramming.pub/build-a-cloud-native-multiprocessing-framework-b33cfc2c02b9?source=collection_archive---------12-----------------------#2022-07-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="be83" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何将本地多处理框架转换到云</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/64fe0536def8a5c8fb6e6d04f2d7555a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YQeva6peKdv1IvPo"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卢卡·布拉沃在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="d7ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">云技术继续困扰着我。功能、易用性和成本都是有利的—工作负载完成速度提高了100倍，web界面和编程交互性为新手和专家提供了手段，免费的层级、培训和示例降低了前期成本和学习曲线。有许多云平台，亚马逊网络服务(AWS)可能是最好的起点。</p><h1 id="8351" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">目录</h1><ol class=""><li id="fdaa" class="mn mo it lb b lc mp lf mq li mr lm ms lq mt lu mu mv mw mx bi translated">回顾</li><li id="a4e1" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">背景</li><li id="f16f" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">两个服务</li><li id="2b57" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">AWS入门</li><li id="6281" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">设置SQS</li><li id="0807" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">设置λ</li><li id="77ff" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">总和</li></ol><h1 id="e3ac" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">1.回顾</h1><p id="38a9" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在本文中，我们将介绍如何在云中创建一个多处理框架。我希望扩展我以前写的一篇文章的内容，在那篇文章中，我讨论了PC或笔记本电脑上的多处理。您可能会发现，首先阅读那篇文章会给您带来额外的背景，它被称为<a class="ae ky" href="https://towardsdatascience.com/a-simple-multiprocessing-framework-within-python-9497bdf9b42b" rel="noopener" target="_blank">Python</a>中的一个简单的多处理框架。</p><h1 id="85f4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2.背景</h1><p id="9874" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">AWS提供了两种服务，当串联使用时，就像一个多处理引擎，可以完全自动化——如果您的工作足够小，那么您将不会因为它们的免费层而支付一分钱。</p><h2 id="376f" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">PC上的多重处理</h2><p id="86a7" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">假设您的笔记本电脑或PC最多只有4个内核和8个逻辑处理器。这将允许你(如果你不同时在你的电脑上做任何事情)同时运行8个任务。因此，您只能使用逻辑处理器。更不用说，根据您要实现的目标，您还可能会遇到内存(RAM)限制。让我们假设你的电脑也有8 GB内存。</p><h2 id="5b15" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">云中的多重处理</h2><p id="7655" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">关于云中的“处理器”和RAM，您被限制为同时运行1K个“处理器”和每个“处理器”10 GB的内存——也就是10K GB。你在任何地方都比不上。</p><p id="f249" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，从速度的角度来看，云版本的多处理是有利的，因为如果您必须处理100K个独特的任务，并且每个任务需要两分钟完成，那么PC进程将需要大约17天才能完成，而云进程最多需要三个小时才能完成。</p><h1 id="d6ea" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3.两个服务</h1><h2 id="df18" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">一个队列</h2><p id="fcb0" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">你听说过排队服务吗？如果不是，就想象一下像赌场发牌员一样的排队服务。庄家收到一副新牌开始游戏。她/他向每个玩家分发预先定义的纸牌子集。按照规则的规定，玩家可以随心所欲地使用这些牌来增加成功的可能性。一旦所有必要的牌都发了，所有的玩家都玩了他们的牌，玩家将向庄家展示他们的牌，最后，他/她决定谁赢了谁输了。</p><p id="2866" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">队列服务的工作方式类似于我们的类比。在收到消息之前，队列服务处于空闲状态。然后，队列服务将消息传递给“处理器”，就像庄家分发一副牌一样。基于预定义的逻辑步骤，处理器只对它们接收到的消息做它们被允许做的事情，然后它们将信息发送回队列以了解它是否成功。如果成功，太好了。如果失败了，可以采取其他步骤来重试或警告用户。</p><h2 id="b94c" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">我们将讨论的第一个服务是一个队列服务，称为简单队列服务(简称SQS)</h2></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h2 id="90c1" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">一个λ</h2><p id="807d" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">从个人计算机的角度来看，处理器是一种硬件，它运行由应用程序或编程语言定义的一系列代码，向硬件发送启动、运行和停止信号。处理器是一种服务或技术，它按照用户(你和我)的定义简单地处理数据/信息。</p><p id="7505" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在AWS云世界中，处理器被称为Lambda。它们做的正是PCs处理器的设计目的:运行由应用程序或编程语言定义的一系列代码。</p><h2 id="5f37" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">我们将讨论的第二个服务是AWS中一个名为Lambda的处理器服务。</h2><h2 id="7748" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">视觉</h2><p id="d830" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">视觉帮助我，可能你也是。这里有一个流程图，展示了我们今后将努力做的事情(我们将按一口大小讨论这些组件):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/78265a670f61496f57bc7c3d70273f8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/0*oprQPJsqJH2YAMur"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">📸由<a class="ae ky" href="https://www.linkedin.com/in/dylancunningham/" rel="noopener ugc nofollow" target="_blank">我</a></p></figure><h1 id="f04b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">4.AWS入门</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/aa734e6f623f9e4bef4810ea4fc5581e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*66_9EU3ONL211zsk8iN0aw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">📸由<a class="ae ky" href="https://www.linkedin.com/in/dylancunningham/" rel="noopener ugc nofollow" target="_blank">我</a></p></figure><p id="5561" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你需要一个AWS账户。请遵循以下步骤:</p><ol class=""><li id="70d4" class="mn mo it lb b lc ld lf lg li ob lm oc lq od lu mu mv mw mx bi translated">打开Chrome或其他网络浏览器，输入这个网址:【https://aws.amazon.com/console/<a class="ae ky" href="https://aws.amazon.com/console/" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="9906" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">单击“登录控制台”(右上角)。</li><li id="7f06" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">单击“创建新的AWS帐户”。</li><li id="6b40" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">完成所有必要的步骤，从他们注册，验证电子邮件，所有这一切。</li></ol><p id="3968" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">遇到困难，或者这些步骤足够了吗？请在评论中告诉我。</p><h1 id="cb31" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">5.设置SQS</h1><p id="11af" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">有多种方法可以浏览到SQS设置页面。这是我的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/e61a91953799a129a19f3c54ea93d67f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3rssh87b7Z_AQiBn1a0hVw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">📸由<a class="ae ky" href="https://www.linkedin.com/in/dylancunningham/" rel="noopener ugc nofollow" target="_blank">我</a></p></figure><p id="5e26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您没有看到简单队列服务选项卡、按钮或链接吗？当你做的时候，点击一个。您应该看到一个“创建队列”选项，单击该按钮。现在，请遵循以下步骤:</p><ol class=""><li id="f813" class="mn mo it lb b lc ld lf lg li ob lm oc lq od lu mu mv mw mx bi translated">在细节和类型下:选择“标准”选项(我们不担心FIFO选项)。</li><li id="87be" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">在Details and Name下:给你的队列起一个独特的名字，这个名字与它将要发送给Lambdas(即“处理器”)的独特消息相关。</li><li id="5bee" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">在“配置和可见性超时”下:将选项更改为15分钟。(为简单起见，将此设置为您希望Lambdas运行的最大时间。Lambda的最长时间是15分钟，仅供参考。)</li><li id="b510" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">在“配置和消息保留期”下:将选项更改为1小时。(这告诉队列在设定的时间内保留消息；你需要时间来处理所有的信息。)</li><li id="0e57" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">滚动到页面底部，然后单击“创建队列”。</li></ol><h2 id="18ea" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">如何给SQS发信息</h2><p id="ff6f" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">让我们假设你希望从你的笔记本电脑或个人电脑发送消息到SQS。</p><p id="862c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，导入Python库boto3。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="001b" class="ng lw it og b gy ok ol l om on">import boto3</span></pre><p id="6786" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我总是有一个settings.json文件，我将它作为Python中的一个字典导入。它看起来像这样:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="cea7" class="ng lw it og b gy ok ol l om on">{<br/>    "local": true,<br/>    "account": "123456789012",<br/>    "role": "developer"<br/>}</span></pre><p id="092f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本地键告诉我的进程我正在从我的机器上运行，如果我想把这个本地进程转换成AWS，那么我已经准备好这样做了。帐户密钥位于AWS页面的右上角。角色是另一种动物，它可以单独成为一篇文章:<a class="ae ky" href="https://medium.com/panther-labs/aws-identity-and-access-management-iam-fundamentals-a4f0e80b87fd" rel="noopener">这里有一篇</a>供参考。(如果你喜欢我解释事情的方式，并且想要一篇文章来讲述这个过程，那么请在评论中告诉我。)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/f9c642280d2349160e2a5d14df73c6ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*9ZLgepu-7soD9WVNY-cJvw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">📸由<a class="ae ky" href="https://www.linkedin.com/in/dylancunningham/" rel="noopener ugc nofollow" target="_blank">我</a></p></figure><p id="03be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们需要一种本地认证的方法(向AWS显示我们应该向我们的队列发送消息。这里有一个函数可以帮助你。</p><p id="57d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅供参考，AWS有一个特性，您可以在给定区域创建资源。在上图中，你会看到单词Ohio。俄亥俄州是us-east-2地区，如下面的代码所示(小箭头帮助您了解这一点)。根据您的情况进行必要的调整。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="f2ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们需要向队列发送消息的功能。这里有两个携手合作的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="0762" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的send_message_to_sqs函数由下面的create _ messages _ and _ send _ to _ SQS函数使用。你也可以看到上面的send_message_to_sq函数使用了我们刚才讨论过的get_resource函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="0acf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此功能以10条或更少的数量批量发送消息。我在我的过程中使用这个函数来查询来自<a class="ae ky" href="https://share.public.com/dylanstorm" rel="noopener ugc nofollow" target="_blank"> Public </a>，或<a class="ae ky" href="https://a.webull.com/8ksM6IWDJzPqU4WyiX" rel="noopener ugc nofollow" target="_blank"> Webull </a>，或<a class="ae ky" href="https://join.robinhood.com/dylanc150" rel="noopener ugc nofollow" target="_blank"> Robinhood </a>等平台的股票行情数据；然而，我使用<a class="ae ky" href="https://www.tiingo.com/" rel="noopener ugc nofollow" target="_blank"> Tiingo </a>作为我所有的股票价格/基本面数据(日内和日末)。因此，这个函数接受一个tickers列表，这就是为什么您将它视为函数的一个参数。根据您的过程进行必要的更改，但是在我的例子中，这个列表是一个字典列表。每个字典都包含SQS将发送给Lambda的核心信息，以便Lambda处理ticker数据(从Tiingo查询并保存到另一个名为简单存储服务(Simple Storage Service，简称S3)的AWS服务)。</p><p id="3b03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您的最后一步是使用create _ messages _ and _ send _ to _ SQS函数，如前所述，将您的消息发送到您的队列。</p><p id="a936" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除非你把Lambda函数和SQS连接起来，否则什么都不会发生。请继续阅读，了解如何访问本文的第二部分，了解如何配置Lambda。</p><h1 id="9a62" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">6.设置λ</h1><p id="2383" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">让您的AWS Lambda为部署做好准备可能需要很多时间，但也可能很快。根据您对使用容器、CDK、CI/CD和其他自动部署方法的需求，您将需要进一步探索。在本文中，我将向您展示如何通过AWS的在线门户/GUI浏览重要的部分。</p><p id="17ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有多种方法可以浏览Lambda设置页面。这是我的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/e61a91953799a129a19f3c54ea93d67f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3rssh87b7Z_AQiBn1a0hVw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">📸由<a class="ae ky" href="https://www.linkedin.com/in/dylancunningham/" rel="noopener ugc nofollow" target="_blank">我</a></p></figure><p id="edbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你没看到Lambda标签、按钮或链接吗？当你做的时候，点击一个。您应该看到一个“创建函数”选项，单击该按钮。现在，请遵循以下步骤:</p><ol class=""><li id="63b4" class="mn mo it lb b lc ld lf lg li ob lm oc lq od lu mu mv mw mx bi translated">选择“从头开始创作”选项(我们不会担心其他选项)。</li><li id="a53f" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">在基本信息下:命名您的函数。</li><li id="17f2" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">在基本信息下:选择运行时下拉列表，然后选择Python 3.7。</li><li id="eb6a" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">滚动到页面底部，点击“创建功能”。</li><li id="00f6" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">在下一个窗口，一直滚动到底部，到层部分，并点击“添加层”</li><li id="8429" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">在“选择图层”下:选择“指定ARN”。</li><li id="c6b5" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">在“选择图层:将此ARN粘贴到”下的文本框中:arn:AWS:lambda:us-east-2:113088814899:layer:Klayers-python 37-pandas:22。</li><li id="bcac" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">滚动到页面底部，然后单击“添加”。</li></ol><h2 id="de99" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">如何将SQS与Lambda联系起来</h2><p id="83cc" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">为了让您的lambda接收和处理消息，您必须通过选择Function overview部分下的“+ Add trigger”来添加一个触发器。一旦你遵循这些步骤:</p><ol class=""><li id="829d" class="mn mo it lb b lc ld lf lg li ob lm oc lq od lu mu mv mw mx bi translated">在触发器配置下:选择下拉菜单，输入SQS，然后点击“SQS”。</li><li id="3722" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">出现更多选项后，在SQS队列下:选择您之前创建的队列名称。</li><li id="bc8a" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">在批次大小下:键入数字1。(我们将假设每个lambda只处理一条消息。如果需要，你可以增加。)</li><li id="d1d2" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">滚动到页面底部，然后单击“添加”。</li></ol><h2 id="c264" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">如何配置Lambda</h2><p id="5017" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我只在我的lambdas的Configuration选项卡中调整了两个设置:常规配置和环境变量。在常规配置下，我编辑内存大小和超时。对于这两者，我高估了我的lambdas需求，只有一点点。在这里运用你的判断力。在环境变量下，我一般只添加API键等。在这里运用你的判断力。</p><h2 id="1ae4" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">如何设置您的代码</h2><p id="d5ec" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">当你的lambda在收到SQS消息后执行时，它将运行一个lambda_handler方法。确保您已经定义了这个方法。这是我的lambda，我称之为worker _ lambda _ daily _ EOD _ historical。这个函数遍历来自SQS的消息——同样，它遍历ticker——从<a class="ae ky" href="https://www.tiingo.com/" rel="noopener ugc nofollow" target="_blank"> Tiingo </a>的API为每个ticker检索数据，将数据写入AWS的简单存储解决方案(S3 ),最后返回200或400作为响应。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="78ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的函数中的另一个方法是我如何将数据保存回S3。见下文:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><p id="ba95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用我在这一节中教授的内容作为一个框架，而不是作为一个终极的方法。我介绍的概念是lambda调用运行的方法，你可以添加和引用任何类、函数、全局变量、环境变量等等。，你需要从你的<code class="fe or os ot og b">lambda_handler</code>方法。最后要指出的是，这个方法应该以事件和上下文作为参数。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="2953" class="lv lw it bd lx ly ou ma mb mc ov me mf jz ow ka mh kc ox kd mj kf oy kg ml mm bi translated">总和</h1><p id="60a6" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在本文中，我们讨论了如何帮助您在云中应用多处理，并释放所有必要的功能——增强的计算能力、易用性，以及零到极低的成本。我们讨论了AWS SQS(一种排队服务)，如何向SQS发送消息，如何设置AWS Lambda(一种处理服务)，以及如何将队列连接到Lambda。最终，您可以在云中轻松实现多处理。</p></div></div>    
</body>
</html>