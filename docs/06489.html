<html>
<head>
<title>Deploy Your Gatsby Site With GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用GitHub操作部署您的Gatsby站点</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deploy-your-gatsby-site-with-github-actions-e761ea93813f?source=collection_archive---------11-----------------------#2020-10-06">https://betterprogramming.pub/deploy-your-gatsby-site-with-github-actions-e761ea93813f?source=collection_archive---------11-----------------------#2020-10-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5c8d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将Travis CI部署平台迁移到GitHub Actions</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/66401a3519771083cbe64309f0d3483b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZ_jv-xjX_FfJR5fQH_6UQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片来自GitHub博客。</p></figure><p id="3716" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在过去的几周里，我和<a class="ae ky" href="https://www.gatsbyjs.com/" rel="noopener ugc nofollow" target="_blank">盖茨比</a>进行了一次有趣的学习之旅。到目前为止，我已经<a class="ae ky" href="https://medium.com/javascript-in-plain-english/from-jekyll-to-gatsby-7-simple-steps-98e0b7a5ead2" rel="noopener">将我的旧Jekyll博客迁移到Gatsby </a>并创建了一个管道，不断地将它部署到GitHub页面。为了创建CD管道，我使用了<a class="ae ky" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>，这在我的<a class="ae ky" href="https://medium.com/javascript-in-plain-english/gatsby-up-running-creating-a-cd-pipeline-68e561bb5f8e" rel="noopener">上一篇文章</a>中已经详细讨论过了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5779" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">介绍… GitHub操作</h1><p id="4cb7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">GitHub一直在努力扩展其平台，以支持开箱即用的存储库工作流。</p><blockquote class="mz"><p id="161a" class="na nb it bd nc nd ne nf ng nh ni lu dk translated"><em class="nj">“GitHub Actions是您的工作流程:由您构建，由我们运行。”—</em><a class="ae ky" href="https://github.blog/2018-10-16-future-of-software/" rel="noopener ugc nofollow" target="_blank"><em class="nj">GitHub博客</em> </a></p></blockquote><p id="185e" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">这意味着GitHub平台本身现在支持这些功能，而不是让我的构建运行在Travis CI这样的外部CI服务器上。</p><p id="f7db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Actions已经进行了几年，GitHub的团队一直在寻求和迭代社区反馈:</p><ul class=""><li id="b38b" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated"><a class="ae ky" href="https://github.blog/2018-10-16-future-of-software/" rel="noopener ugc nofollow" target="_blank">有限公测</a>于2018年末在GitHub Universe公布。</li><li id="e21b" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated"><a class="ae ky" href="https://github.blog/2019-08-08-github-actions-now-supports-ci-cd/" rel="noopener ugc nofollow" target="_blank">公测版</a>于2019年8月发布，支持CI/CD、自定义事件和建议工作流。</li><li id="5bbf" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">actions<a class="ae ky" href="https://github.blog/2019-11-13-universe-day-one/" rel="noopener ugc nofollow" target="_blank">于2019年11月在GitHub Universe</a>全面发售。</li><li id="67dc" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">GitHub Enterprise 的<a class="ae ky" href="https://enterprise.github.com/releases/2.22.0/notes" rel="noopener ugc nofollow" target="_blank">测试版于2020年9月推出。</a></li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dfa4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么选择GitHub Actions？</h1><p id="5449" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我在Travis CI中有一个运行良好的CD管道。</p><p id="9776" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题？链条中的另一个可能失败的环节，我需要监控和跟踪其状态的另一个第三方工具，我的SaaS账单中的另一个行项目，我的数据流经的另一项服务，我需要向我的合规团队报告。你明白了。</p><p id="e4ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有趣的是，当我试图为我的博客设置它时，Travis CI报告了性能下降，这让我开始质疑我的理智，因为我甚至在几次尝试后都无法让它工作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/6f3533c48941b7e9aa2bd741c07daa2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bx8fDn3XUlxFBbcGu3-XdQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">关于<a class="ae ky" href="https://www.traviscistatus.com/" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>的降级服务通知</p></figure><p id="b1b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GitHub Actions在一定程度上缓解了这些问题:</p><ul class=""><li id="cc2f" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">避免引入第三方工具，并防止数据流经另一个服务。</li><li id="bf7a" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">提供比CI/CD单独服务更低的<a class="ae ky" href="https://docs.github.com/en/free-pro-team@latest/github/setting-up-and-managing-billing-and-payments-on-github/about-billing-for-github-actions#about-billing-for-github-actions" rel="noopener ugc nofollow" target="_blank">定价计划</a>。它对公共存储库是免费的，对私人存储库是按需付费的。</li><li id="d8d3" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">允许重复使用共享工作流。这一点尤其重要，因为它避免了开发人员不得不一遍又一遍地解决相同的问题。相反，公共工作流创建了一个动作生态系统，开发者可以派生、编辑、迭代和改进，就像代码一样。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5b19" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Travis CI是如何构建的？</h1><p id="581d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在我的<a class="ae ky" href="https://medium.com/javascript-in-plain-english/gatsby-up-running-creating-a-cd-pipeline-68e561bb5f8e" rel="noopener">上一篇文章</a>中，我回顾了我是如何配置我的博客的GitHub库来使用Travis CI的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/4815c2dfb3897b9aa1a70421874f5fa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4XjwJUxQsf5BEXT3EIZtrw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在travis-ci.org上启用知识库的构建</p></figure><p id="2aaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我在Travis CI dashboard中为构建启用我的存储库时，它在Github上的存储库中设置了一个webhook配置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/d39614df40d3b56373a3b1fe021c01c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RsP70irqTQz4vBVry6uH-w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Travis CI在我的Github存储库设置中创建的Webhook配置</p></figure><p id="ec45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个配置导致在这个存储库上生成的事件被推送到Travis CI托管的webhook，该web hook触发了基于我的<code class="fe og oh oi oj b">.travis.yml</code>文件中定义的步骤的构建。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3ca2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用GitHub操作触发Travis CI构建</h1><p id="bc9b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这种方法对改进我的工作流没有多大帮助，因为它只是改变了GitHub和Travis CI之间的集成点。</p><p id="9fb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/travis-ci/actions" rel="noopener ugc nofollow" target="_blank"> Travis-CI GitHub动作</a>使用<a class="ae ky" href="https://github.com/travis-ci/actions/blob/master/create-build.js#L19" rel="noopener ugc nofollow" target="_blank"> Travis CI v3 api </a>触发Travis CI上的构建以响应GitHub上的事件，而不是Travis托管的webhook监听GitHub事件。</p><p id="17df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">依赖性依然存在，与之相关的问题也是如此。不过，人们很快就明白了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0cf0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用GitHub操作部署到GitHub页面(再见，Travis)</h1><p id="3e28" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了消除对Travis CI的依赖，我开始寻找一个GitHub动作，它可以执行与我的Travis CI构建和部署管道相同的功能:运行一个构建，运行一些测试(尚不存在)，将生成的站点推送到我的GitHub存储库的<code class="fe og oh oi oj b">gh-pages</code>分支。</p><p id="21d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实证明，找到一个为此目的的社区构建的动作并将其与我的存储库集成并不难:</p><ul class=""><li id="5027" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">首先，我在我的<a class="ae ky" href="https://travis-ci.org/account/repositories" rel="noopener ugc nofollow" target="_blank"> Travis CI设置</a>中禁用了Travis CI构建，这在Github中禁用了相应的webhook。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/97d8bf4ec7f5e75d54000284efccac46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O3tPOEM4BPY0zA2VwfdsAg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">travis-ci.org的残疾人建筑</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/3ade45847a232ecada2c26d588e98899.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gT3fbTS0fxJg1T2juZnOVQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在我的GitHub存储库中禁用了Travis CI webhook</p></figure><ul class=""><li id="8469" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">然后我在<a class="ae ky" href="https://github.com/marketplace" rel="noopener ugc nofollow" target="_blank"> GitHub Actions Marketplace </a>上搜索一个<a class="ae ky" href="https://github.com/marketplace/actions/gatsby-publish" rel="noopener ugc nofollow" target="_blank">合适的action </a>来部署一个Gatsby站点到GitHub页面。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/01214953d0b0769cbd2edd1de437ba81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I1PL1sWKh3FYAF-9XUGZ0Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">盖茨比出版行动</p></figure><ul class=""><li id="5e6d" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">我手动将该动作添加到我的存储库中的一个YAML文件中，位于<code class="fe og oh oi oj b"><a class="ae ky" href="https://github.com/Deborah-Digges/deborah-digges.github.io/blob/master/.github/workflows/build_and_publish.yml" rel="noopener ugc nofollow" target="_blank">.github/workflows</a></code>下。我对这一步有点失望，因为我希望市场上有一个单击选项，允许我将工作流文件直接提交到我的存储库中。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><ul class=""><li id="bf27" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">为了让工作流能够推送至我的存储库，我将GitHub存储库<code class="fe og oh oi oj b">Secrets</code>中的<code class="fe og oh oi oj b">ACCESS_TOKEN</code>环境变量设置为个人<a class="ae ky" href="https://github.com/settings/tokens/" rel="noopener ugc nofollow" target="_blank"> GitHub令牌</a>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/ef23c363086cabb9b3cc55d158560e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*USuLHYK1tYHraQfl55WSEQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub存储库设置中的秘密部分</p></figure><ul class=""><li id="b738" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">有了这些，我就能够通过合并到我的存储库的主分支来触发我的第一次构建了！</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/9132a62bd831ff06cf929392fb136157.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AqAJ5mygdds3ujPkZPjoEw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub操作构建正在进行</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="78d1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">收获利益</h1><p id="3255" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">即使是这个小项目，我也收获了GitHub操作的好处:</p><ul class=""><li id="eaa9" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">我的博客的构建过程不再依赖于第三方工具Travis CI。我可以禁用Travis CI上的存储库，还可以删除我的Travis CI帐户。</li><li id="f45e" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">我能够重用一个共享的工作流，并从我的项目中删除代码和关于如何部署到GitHub页面的知识。这避免了我不得不再次解决同样的问题，而是使用社区构建的解决方案！</li></ul><p id="ebc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我很高兴探索了GitHub动作，以及它通过重用现有工作流所能做的事情。在我的下一篇文章中，和我一起探索如何从头开始编写一个定制的工作流！</p><p id="1b16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="op">原载于</em><a class="ae ky" href="https://deborah-digges.github.io/2020/09/24/gatsby-deploy/" rel="noopener ugc nofollow" target="_blank"><em class="op">https://Deborah-digges . github . io</em></a></p></div></div>    
</body>
</html>