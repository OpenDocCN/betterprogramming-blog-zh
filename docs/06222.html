<html>
<head>
<title>JavaScript: String.replaceAll has Landed in All Major Browsers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript: String.replaceAll已经登陆所有主流浏览器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/javascript-string-replaceall-has-landed-in-all-major-browsers-9417e2f831d4?source=collection_archive---------7-----------------------#2020-09-10">https://betterprogramming.pub/javascript-string-replaceall-has-landed-in-all-major-browsers-9417e2f831d4?source=collection_archive---------7-----------------------#2020-09-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3038" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们应该重构吗？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b915d76ce593279e27d9985b5aace043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YBn5vHcBXUlwtE1ZUVD-BQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="c5cb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有了最新版本的v8，我们现在在所有主流浏览器中都有了几个新的JavaScript特性——其中之一是<code class="fe lu lv lw lx b">String.prototype.replaceAll</code>。它用于用另一个字符串替换给定字符串或正则表达式的所有匹配项。看起来是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="ff4e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它是对<code class="fe lu lv lw lx b">String.prototype.replace</code>的一个非常简单的补充。作为一个微优化极客，我决定看看这个新特性与它的替代品相比表现如何。因此，本文的目的是展示这一新特性，并鼓励读者从不同的角度来了解新特性。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="64f1" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">到目前为止有什么选择？</h1><p id="dc32" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">追溯到JavaScript的早期，<code class="fe lu lv lw lx b">String</code>的原型为我们提供了一个名为<code class="fe lu lv lw lx b">replace</code>的函数，它本质上与<code class="fe lu lv lw lx b">replaceAll</code>做同样的事情，但它只是取代了第一次出现的<code class="fe lu lv lw lx b">searchValue</code>。示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="189d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是有用的，但如果您想要替换文本的所有出现，这是不可取的。该问题的一个解决方案是使用RegExp来定义<code class="fe lu lv lw lx b">searchValue</code>。上面的例子可以很容易地用RegExp重写，以实现与<code class="fe lu lv lw lx b">replaceAll</code>相同的行为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="4cc5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这对我们的情况很有用。对于任何对正则表达式有一些基本知识的人来说，这也是显而易见的。</p><p id="634a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们把事情变得复杂一点。假设我们有一个案例，我们需要我们的<code class="fe lu lv lw lx b">searchValue</code>是动态的。例如，假设我们将<code class="fe lu lv lw lx b">searchValue</code>作为一个参数，而不是硬编码它。在这种情况下，从这个变量创建一个正则表达式变得有点复杂。一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="5aec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个管用。代码做什么也很清楚。但是动态生成正则表达式并不总是简单明了的。给定字符串中的特殊字符很容易扰乱正则表达式:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="7e87" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它仍然有效，但是现在它的工作方式更加神秘了。该函数的用户必须知道，他们必须在将字符串传递给该函数之前对其进行净化。另一种方法是让<code class="fe lu lv lw lx b">removeFromText()</code>净化接收到的输入。然而，在这种情况下，我们使<code class="fe lu lv lw lx b">removeFromText()</code>的实现变得不必要的复杂。</p><p id="f897" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">解决上述问题的最后一个替代方案是将<code class="fe lu lv lw lx b">.split()</code>和<code class="fe lu lv lw lx b">.join()</code>链接起来，以实现与<code class="fe lu lv lw lx b">replaceAll</code>相同的行为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="0b90" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在这一个涵盖了我们所有的用例。这种方法的缺点是代码做的事情不太明显。将一个字符串拆分成一个数组，然后再次合并，这看起来很浪费，并且没有告诉我们任何关于替换字符串的事情。与其说是直接做我们想做的事，不如说是黑。</p><p id="f8e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">出于所有这些原因，我们现在有了我们的语法糖<code class="fe lu lv lw lx b">replaceAll()</code>。我认为它应该比它的替代品更有性能，考虑到它最接近的替代品是创建和销毁数组。所以我做了一些基准测试。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="ae50" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">让我们比较一下性能</h1><p id="c03a" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">我首先使用Lorem Ipsum生成器生成一个1300个字符长的字符串。然后，我创建了几种替换字符串中所有文本的测试用例。然后我使用<a class="ae ne" href="https://jsben.ch/EWf2l" rel="noopener ugc nofollow" target="_blank"> jsben.ch </a>对这些测试用例进行基准测试。我是在Chrome、Safari和Firefox上这样做的。结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/19903bf10fec38c4129bb6af2b446d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V6BsjCSEtiV-HFTN.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Chrome中的基准测试</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/c28a1c8a3495390ade91d2b244164f4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2EIlgMl4Bsql64Kp.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Safari中的基准测试</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/ec6965fd52050e460bd2c3c8e10f7cfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Nei0LOmW641X4kzQ.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Firefox中的基准测试</p></figure><p id="0f55" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我预计<code class="fe lu lv lw lx b">replaceAll()</code>会比其他选择稍微快一点。你可以想象，当我看到每个浏览器的结果都有显著变化时，我感到非常惊讶。然而，<code class="fe lu lv lw lx b">replaceAll()</code>并不是所有浏览器中最快的。令人失望的是，一个被添加为辅助功能的特性实际上比它的替代品要慢。</p><p id="7f64" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae ne" href="https://jsben.ch/EWf2l" rel="noopener ugc nofollow" target="_blank">您可以运行</a>我亲自运行的相同基准测试。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="78eb" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">裁决</h1><p id="8674" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">那么，我们应该重构我们所有的代码吗？</p><p id="6025" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您的代码被认为是高性能的，以至于您正在对代码执行微优化，那么您可能应该使用替代方案。当用JavaScript编码时，通常不需要高性能的代码，但是如果你正在开发一个实用程序库或框架，它仍然可能发生。</p><p id="8de8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，如果您正在开发面向用户的应用程序，如果您使用更明显的函数来实现您的目标，您的代码将更具可读性。因此，最好使用<code class="fe lu lv lw lx b">replaceAll()</code>和类似的帮助器，让读者更清楚地了解您代码的目的。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="6f01" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">— <a class="ae ne" href="https://medium.com/@ozantunca" rel="noopener">奥赞通卡</a></p><h2 id="d7a2" class="nh mi it bd mj ni nj dn mn nk nl dp mr lh nm nn mt ll no np mv lp nq nr mx ns bi translated">订阅更多</h2><p id="4d7d" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">如果你喜欢这篇文章，并希望得到类似的其他文章的通知，<a class="ae ne" href="https://ozantunca.org/subscribe" rel="noopener ugc nofollow" target="_blank">你可以在这里订阅我</a>。我还会不时地给你发送免费的课程和电子书。我保证永远不会给你发垃圾邮件👍</p></div></div>    
</body>
</html>