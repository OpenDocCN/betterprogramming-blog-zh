<html>
<head>
<title>Reactive MVVM and the Coordinator Pattern Done Right</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应式MVVM和协调模式做对了</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/reactive-mvvm-and-the-coordinator-pattern-done-right-88248baf8ca5?source=collection_archive---------4-----------------------#2020-01-16">https://betterprogramming.pub/reactive-mvvm-and-the-coordinator-pattern-done-right-88248baf8ca5?source=collection_archive---------4-----------------------#2020-01-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="71c8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Swift 5、RxSwift和RxDataSources</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f88667905dfb6d8a76161c4e2b1e7ef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PnO80ahC-f79_Y3s"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约翰·汤纳在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="7396" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">介绍</h1><p id="baac" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">所以，你已经在你的iOS应用中多次实现了<a class="ae ky" href="https://medium.com/better-programming/this-is-how-you-implement-mvc-architecture-in-2020-b39d65b4212f" rel="noopener"> MVC架构</a>，探索了<a class="ae ky" href="https://medium.com/better-programming/implement-a-model-view-presenter-architecture-in-swift-5-dfa21bbb8e0b" rel="noopener"> MVP </a>作为替代，听说了一些关于<a class="ae ky" href="https://medium.com/better-programming/how-to-implement-viper-architecture-in-your-ios-app-rest-api-and-kingfisher-f494a0891c43" rel="noopener"> VIPER </a>的事情，并且(可能)喜欢上了MVVM。</p><p id="2448" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在怎么办？是时候将您的MVVM知识提升到一个全新的水平了——带协调员的反应式MVVM！</p><p id="dc0f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在本文中，我将演示如何用<a class="ae ky" href="https://github.com/ReactiveX/RxSwift" rel="noopener ugc nofollow" target="_blank"> RxSwift </a>、<a class="ae ky" href="https://github.com/RxSwiftCommunity/RxDataSources" rel="noopener ugc nofollow" target="_blank"> RxDataSources </a>、<a class="ae ky" href="https://github.com/RxSwiftCommunity/RxAlamofire" rel="noopener ugc nofollow" target="_blank"> RxAlamofire </a>实现MVVM-协调器模式。</p><p id="477a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们还将使用我自己的CocoaPod，它提供了ReactiveCoordinator的基本实现，可以在我的<a class="ae ky" href="https://github.com/zafarivaev/ReactiveCoordinator" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中找到。</p><p id="738a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">演示应用程序使用一个免费的<a class="ae ky" href="https://holidayapi.com" rel="noopener ugc nofollow" target="_blank">假日API </a>来获取国家列表，并获取所选国家去年的假日。</p><p id="4c83" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">该项目的源代码可在GitHub 上获得<a class="ae ky" href="https://github.com/zafarivaev/Reactive-MVVM-C-DemoApp" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="6dbf" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">演示应用程序</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/0fea3bdf1e9c9e4946654e591a40f11f.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*DOFAm8DJsVOBEI_GP53CTg.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/44cb8b4fa76a5abdfb33c28391837924.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*Aidcx0oG0GcXQ7ATu8SHkg.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/d3be4916a6286ebb61c39f6b19d3fb1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*QRy5wvd_WUSR11bhea25vA.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/9269209b43d7167366718db424e67a78.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*b2F6_G_8-WT52fqTGQjJpw.png"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="0130" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">项目结构</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/b039d0410668de152c6896b566ec1959.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*sZ-Xp2Mq_8HDO3vX9YHbHQ.png"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3fe6" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">快速设置</h1><p id="5aa4" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">为了成功获取假日和国家，我们需要获得一个免费的<a class="ae ky" href="https://holidayapi.com" rel="noopener ugc nofollow" target="_blank">假日API </a>密钥:</p><ol class=""><li id="3b5d" class="nb nc it ma b mb mu me mv mh nd ml ne mp nf mt ng nh ni nj bi translated">去https://holidayapi.com。</li><li id="e0cb" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt ng nh ni nj bi translated">按<em class="np">开始使用</em>并创建您的帐户。</li><li id="8252" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt ng nh ni nj bi translated">复制您的API密钥。</li></ol><p id="654f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在，只需将<code class="fe nq nr ns nt b">APIManager.swift</code>中的“在此粘贴您的API密钥”替换为您从仪表板上复制的密钥:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="e441" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">要完成设置，导航到项目的目录并运行<code class="fe nq nr ns nt b">pod install</code>来安装所有需要的依赖项:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/564ef0b6683b02443749b733ce5e6bdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KqVCPxqmJb-rwhhoMlj1jw.png"/></div></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="fa26" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">我们开始吧</h1><h2 id="1ecf" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak">协调人</strong></h2><p id="0842" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">首先，让我们看看<a class="ae ky" href="https://github.com/zafarivaev/ReactiveCoordinator" rel="noopener ugc nofollow" target="_blank"> ReactiveCoordinator </a>框架中的协调器实现。</p><ul class=""><li id="3f6e" class="nb nc it ma b mb mu me mv mh nd ml ne mp nf mt oj nh ni nj bi translated">我们指定<code class="fe nq nr ns nt b">CoordinationResult</code>来代替将来视图控制器之间的委托。</li><li id="201c" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt oj nh ni nj bi translated">泛型<code class="fe nq nr ns nt b">store&lt;T&gt;</code>方法用于将我们的协调器存储在<code class="fe nq nr ns nt b">childCoordinators</code>字典中。</li><li id="059f" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt oj nh ni nj bi translated">通用的<code class="fe nq nr ns nt b">release&lt;T&gt;</code>方法负责释放未使用的坐标。</li><li id="f1b1" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt oj nh ni nj bi translated">通用的<code class="fe nq nr ns nt b">coordinate&lt;T&gt;</code>方法用于提供屏幕间的导航。</li><li id="2fc9" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt oj nh ni nj bi translated">我们还有一个强制的<code class="fe nq nr ns nt b">start()</code>方法，在这个方法中，我们将构建并连接视图控制器和它们的视图模型。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="3963" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">以下是我们如何在应用程序中使用ReactiveCoordinator的示例。假设我们有两个协调人:<code class="fe nq nr ns nt b">AppCoordinator</code>和<code class="fe nq nr ns nt b">HolidaysCoordinator</code>。两者都继承自ReactiveCoordinator。工作流程:</p><ol class=""><li id="0ca7" class="nb nc it ma b mb mu me mv mh nd ml ne mp nf mt ng nh ni nj bi translated"><code class="fe nq nr ns nt b">AppCoordinator</code>触发它的<code class="fe nq nr ns nt b">start()</code>方法。</li><li id="478a" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt ng nh ni nj bi translated">调用<code class="fe nq nr ns nt b">coordinate(to: )</code>方法，该方法协调<code class="fe nq nr ns nt b">HolidaysCoordinator</code>并触发自己的<code class="fe nq nr ns nt b">start()</code>方法，该方法构造并连接<code class="fe nq nr ns nt b">HolidaysViewController</code>及其<code class="fe nq nr ns nt b">ViewModel</code>。</li><li id="944d" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt ng nh ni nj bi translated">因此，我们将<code class="fe nq nr ns nt b">HolidaysViewController</code>呈现在屏幕上。</li></ol><h2 id="67ac" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak">联网</strong></h2><p id="b396" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我们使用RxAlamofire创建一个基本的通用<code class="fe nq nr ns nt b">get&lt;T&gt;</code>请求。</p><p id="1a6c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><code class="fe nq nr ns nt b">APIClient.swift</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="f4b5" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated">模型</h2><p id="7921" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated"><code class="fe nq nr ns nt b">ObjectMapper</code>用于从我们从Holiday API接收的JSON中构造对象。</p><p id="d934" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><code class="fe nq nr ns nt b">Holidays.swift</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="6505" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><code class="fe nq nr ns nt b">Countries.swift</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="49eb" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">有了这些，我们就可以开始培养我们的协调员了。</p><h2 id="6259" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak"> AppCoordinator.swift </strong></h2><p id="f509" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这个类负责为<code class="fe nq nr ns nt b">window</code>设置<code class="fe nq nr ns nt b">rootViewController</code>。</p><p id="7470" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在其启动方法中，我们指定<code class="fe nq nr ns nt b">window</code>的<code class="fe nq nr ns nt b">rootViewController</code>为<code class="fe nq nr ns nt b">HolidaysViewController</code>，嵌入在一个<code class="fe nq nr ns nt b">UINavigationController</code>中。最后，我们协调到<code class="fe nq nr ns nt b">HolidaysCoordinator</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="c47f" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><code class="fe nq nr ns nt b">AppDelegate.swift</code></h2><p id="838a" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在这里，我们创建并开始我们的<code class="fe nq nr ns nt b">AppCoordinator</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="fbf4" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们已经成功地设置了我们的应用程序的初始流程。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="0dfe" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">假日模块</h1><p id="f202" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如果选择了一个国家，此模块将显示假日列表。否则，它会显示一条占位符消息“首先选择您的国家”。</p><h2 id="b876" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak">holidays coordinator . swift</strong></h2><p id="db97" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这里，类似于我们在<code class="fe nq nr ns nt b">AppCoordinator</code>中所做的，我们设置了<code class="fe nq nr ns nt b">HolidaysViewController</code>，并为它提供了一个<code class="fe nq nr ns nt b">HolidaysViewModel</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="f7d6" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在<code class="fe nq nr ns nt b">start()</code>方法中，我们订阅视图模型的<code class="fe nq nr ns nt b">selectedHoliday</code>和<code class="fe nq nr ns nt b">chooseCountry</code>属性。</p><p id="cd6b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">当事件被发送到这些属性时，(即用户点击<em class="np">选择国家</em>按钮或选择一个单元格)，协调器知道是时候导航了。</p><h2 id="6fa7" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak">holidays view controller . swift</strong></h2><p id="1aed" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">它唯一的职责是布局视图，并将UI元素绑定到<code class="fe nq nr ns nt b">HolidaysViewModel</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="4ee4" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">仔细看看我们如何使用<code class="fe nq nr ns nt b">UITableView</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="94e6" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">首先，我们使用RxDataSources将<code class="fe nq nr ns nt b">viewModel</code>的<code class="fe nq nr ns nt b">holidays</code>属性绑定到<code class="fe nq nr ns nt b">tableView</code>。它超级短和简单，我们甚至不必使用这些冗长的<code class="fe nq nr ns nt b">UITableViewDelegate</code>和<code class="fe nq nr ns nt b">UITableViewDataSource</code>实现！</p><p id="b182" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">接下来，我们将特定<code class="fe nq nr ns nt b">tableView</code>单元格的选择绑定到<code class="fe nq nr ns nt b">viewModel</code>的<code class="fe nq nr ns nt b">selectedHoliday</code>属性。这样，我们就避免了使用<code class="fe nq nr ns nt b">didSelectRow(at: )</code> <code class="fe nq nr ns nt b">UITableViewDelegate</code>方法。</p><p id="d356" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这只用了三行代码就完成了——太棒了！</p><p id="9f26" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">最后，我们订阅选择事件，通过接收选择的<code class="fe nq nr ns nt b">indexPath</code>并调用<code class="fe nq nr ns nt b">deselectRow(at: )</code>方法，将单元格的背景恢复到以前的状态。</p><h2 id="ca6e" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak">holidays view model . swift</strong></h2><p id="8030" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在这里，所有的奇迹都会发生。这个视图模型负责接受来自视图的输入并获取假期。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="a090" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak">holidaytableviewcell . swift</strong></h2><p id="4ab3" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">单元格有自己的<code class="fe nq nr ns nt b">HolidayViewModel</code>，在分配时我们调用<code class="fe nq nr ns nt b">configure()</code>方法用模型更新单元格的UI。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="eeef" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak"> HolidayViewModel.swift </strong></h2><p id="ac84" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">用在<code class="fe nq nr ns nt b">HolidayTableViewCell</code>中来表示它的属性。稍后我们将使用<code class="fe nq nr ns nt b">Holiday Detail</code>模块中的<code class="fe nq nr ns nt b">didClose</code>属性在<code class="fe nq nr ns nt b">HolidayDetailViewController</code>弹出时发送一个信号:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="0c1e" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">选择国家模块</h1><p id="9057" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">此模块显示国家列表。在选择特定国家时，<code class="fe nq nr ns nt b">ChooseCountryViewController</code>被取消，将所选择的国家转发回<code class="fe nq nr ns nt b">HolidaysViewModel</code>。</p><h2 id="fd98" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated">choose country coordinator . swift</h2><p id="d1c8" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这里是我们将使用我们的<code class="fe nq nr ns nt b">CoordinationResult</code>的地方。当我们点击<em class="np">关闭</em>按钮时，<code class="fe nq nr ns nt b">HolidaysCoordinator</code>接收<code class="fe nq nr ns nt b">nil</code>。当一个单元格被选中时，它接收选中的<code class="fe nq nr ns nt b">country</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="d611" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak">选择countryviewcontroller . swift</strong></h2><p id="9d15" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">和以前一样，控制器只是显示UI并将动作事件发送到视图模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="326e" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak">country table viewcell . swift</strong></h2><p id="17ad" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">具有与<code class="fe nq nr ns nt b">HolidayTableViewCell</code>相同的功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="2217" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak">选择CountryViewModel.swift </strong></h2><p id="2eed" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这里，我们执行两个重要的任务:获取国家和基于来自<code class="fe nq nr ns nt b">searchBar</code>的文本进行过滤:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="a742" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak"> CountryViewModel.swift </strong></h2><p id="445d" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">表示包含国家的<code class="fe nq nr ns nt b">name</code>及其<code class="fe nq nr ns nt b">code</code>的单元格:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="0952" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">假日详细信息模块</h1><p id="c725" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">该模块显示特定假日的详细信息，显示其<code class="fe nq nr ns nt b">title</code>、<code class="fe nq nr ns nt b">date</code>、<code class="fe nq nr ns nt b">country</code>和<code class="fe nq nr ns nt b">isPublic</code>状态。</p><h2 id="9c6a" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak">holidaydetailcoordinator . swift</strong></h2><p id="fa41" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">构建<code class="fe nq nr ns nt b">HolidaysViewController</code>并为其提供一个<code class="fe nq nr ns nt b">HolidayViewModel</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="5911" class="nx lh it bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw oi bi translated"><strong class="ak">holidaydetailviewcontroller . swift</strong></h2><p id="d05b" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">与其他视图控制器的工作完全相同:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="7aed" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">包扎</h1><p id="8fe5" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">现在，随着反应式MVVM协调器设计模式的成功实现，我们看到了以下好处:</p><ol class=""><li id="735c" class="nb nc it ma b mb mu me mv mh nd ml ne mp nf mt ng nh ni nj bi translated">视图控制器只负责布局它们的视图，并向视图模型发送动作，使它们变得纤细简洁。即使您看到一个300行的视图控制器，您也知道它主要具有设置约束、执行布局和绑定到视图模型的方法。</li><li id="23f4" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt ng nh ni nj bi translated">协调者监听由视图控制器发出的视图模型中的导航事件，从而清楚地划分他们之间的职责。</li><li id="6a9d" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt ng nh ni nj bi translated">视图模型处理应用程序的所有业务逻辑，并且独立于UIKit，这使得为它们编写单元测试很容易。</li><li id="5a79" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt ng nh ni nj bi translated">视图控制器相互不了解，所有的导航都在协调器内部处理。</li><li id="84fd" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt ng nh ni nj bi translated">代码很简洁，因为我们使用了RxDataSources，所以没有冗长的委托方法。</li><li id="4797" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt ng nh ni nj bi translated">如果我们发现出现了错误的屏幕，我们知道问题出在协调器内部。如果视图没有按照我们想要的方式显示，我们直接跳到视图控制器。如果一个API请求失败，或者，例如，过滤没有按预期工作，我们知道要在视图模型中寻找问题。</li></ol><p id="4f9e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">您可以通过以下链接了解其他人是如何实现反应式MVVM协调器模式的:</p><ul class=""><li id="34bb" class="nb nc it ma b mb mu me mv mh nd ml ne mp nf mt oj nh ni nj bi translated"><a class="ae ky" href="https://academy.realm.io/posts/mobilization-lukasz-mroz-mvvm-coordinators-rxswift/" rel="noopener ugc nofollow" target="_blank">协调人— RxSwift </a>。我发现这个演讲对了解RxSwift、MVVM和协调员模式非常有用。</li><li id="e610" class="nb nc it ma b mb nk me nl mh nm ml nn mp no mt oj nh ni nj bi translated"><a class="ae ky" href="https://hackernoon.com/how-to-use-mvvm-coordinators-and-rxswift-7364370b7b95" rel="noopener ugc nofollow" target="_blank">如何使用MVVM协调员</a>。</li></ul><p id="6813" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果你对不同的建筑模式感到好奇，请随意查看我的其他相关作品:</p><div class="ok ol gp gr om on"><a href="https://medium.com/better-programming/implement-a-model-view-presenter-architecture-in-swift-5-dfa21bbb8e0b" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd iu gy z fp os fr fs ot fu fw is bi translated">在Swift 5中实施模型-视图-演示者架构</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">使用领域数据库作为业务逻辑层</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">medium.com</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb ks on"/></div></div></a></div><div class="ok ol gp gr om on"><a href="https://medium.com/better-programming/this-is-how-you-implement-mvc-architecture-in-2020-b39d65b4212f" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd iu gy z fp os fr fs ot fu fw is bi translated">新MVC:单一责任原则和委托</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">苹果的模型视图控制器，终于做对了</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">medium.com</p></div></div><div class="ow l"><div class="pc l oy oz pa ow pb ks on"/></div></div></a></div><div class="ok ol gp gr om on"><a href="https://medium.com/better-programming/implement-a-service-oriented-architecture-in-swift-5-fc70b8117616" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd iu gy z fp os fr fs ot fu fw is bi translated">在Swift 5中实施面向服务的架构</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">为什么只用MVC/MVVM/蝰蛇还不够</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">medium.com</p></div></div><div class="ow l"><div class="pd l oy oz pa ow pb ks on"/></div></div></a></div><div class="ok ol gp gr om on"><a href="https://medium.com/better-programming/how-to-implement-viper-architecture-in-your-ios-app-rest-api-and-kingfisher-f494a0891c43" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd iu gy z fp os fr fs ot fu fw is bi translated">如何使用Swift 5在您的iOS应用中实现VIPER架构</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">使用方便的Xcode模板和参考报告</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">medium.com</p></div></div><div class="ow l"><div class="pe l oy oz pa ow pb ks on"/></div></div></a></div><p id="4eb7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">非常感谢您的阅读！</p></div></div>    
</body>
</html>