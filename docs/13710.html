<html>
<head>
<title>Connecting and Mapping Strava Data With Python and Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python和Django连接和映射Strava数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/connecting-and-mapping-strava-data-with-python-and-django-41456b874f3b?source=collection_archive---------4-----------------------#2022-09-19">https://betterprogramming.pub/connecting-and-mapping-strava-data-with-python-and-django-41456b874f3b?source=collection_archive---------4-----------------------#2022-09-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1ed4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建一个奇妙的交互式应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/43f0f57c506462bbf7c09f595f9c2a51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RwJRnz52RdIoZS7NWuis1g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我创建的一个Django网络应用程序，它将我和我的朋友在世界各地进行的所有Strava活动绘制成地图</p></figure><p id="609a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">今年5月，Strava达到了一个新的里程碑，注册用户达到了1亿。伴随着这些用户的是超过70亿的登录活动。如果你像我一样对探索地理数据感兴趣，你可以用这些数据做的不同分析会让你兴奋不已。</p><p id="67ff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对我们来说幸运的是，Strava是一家开发人员友好的公司，它在公共媒体博客上发布有趣的开发人员和数据科学文章，并创建易于访问的T2 API。</p><p id="801d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">显示可通过Strava API访问的数据的一种方法是使用Django用Python创建一个网站。尽管有一些很棒的资源帮助我将Strava与Python联系起来(比如马特·安布罗吉的<a class="ae lr" href="https://towardsdatascience.com/using-the-strava-api-and-pandas-to-explore-your-activity-data-d94901d9bfde" rel="noopener" target="_blank"> this </a> one)，但我找不到任何好的资源来将Strava数据与Python和Django联系起来。这篇文章是我创造这种资源的尝试。</p><p id="0876" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本教程将涵盖以下内容:</p><ul class=""><li id="ebff" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated"><a class="ae lr" href="#7e9f" rel="noopener ugc nofollow">设置Django网络应用</a></li><li id="cd90" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><a class="ae lr" href="#7bf2" rel="noopener ugc nofollow">将Web应用程序连接到Strava API </a></li><li id="52ba" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><a class="ae lr" href="#2335" rel="noopener ugc nofollow">在交互式地图上映射用户的活动数据</a></li></ul><p id="1d8b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，你将能够创建一个Django网站，如下图所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/74c4d3c61b9980aec4e64d32bda0127a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/1*c7qFehQgFhQ1G85pZL_9Ww.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">本教程的最终产品。连接到Strava并在交互式地图上绘制所有活动数据。</p></figure><h1 id="b980" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">密码</h1><p id="4703" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">如果你像我一样，从教程中获得完整的代码库会让生活变得容易得多。因此，这里使用的所有代码都可以在https://github.com/VertAdam/StravaWebsite的GitHub repo上获得。</p><h1 id="7e9f" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">设置您的Django Web应用程序</h1><p id="cc59" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">Django是一个基于Python的开源web框架。Django被许多知名网站使用，包括YouTube、Instagram和Spotify以及无数其他网站。</p><p id="72df" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你不熟悉Django，我总是建议按照官方文档教程<a class="ae lr" href="https://docs.djangoproject.com/en/4.1/intro/tutorial01/" rel="noopener ugc nofollow" target="_blank">中的步骤编写你的第一个Django应用</a>。</p><p id="aa46" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，这篇文章将告诉你所有你需要的步骤，在没有任何先验知识的情况下设置你的Django应用程序。所以，如果你时间紧迫，又不想看官方教程，不用担心，我会帮你搞定的。</p><h2 id="5d85" class="ne mi iq bd mj nf ng dn mn nh ni dp mr le nj nk mt li nl nm mv lm nn no mx np bi translated">安装Django</h2><p id="efce" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">你要做的第一件事就是安装Django。你可以在你的终端中使用<code class="fe nq nr ns nt b">pip</code>很容易地做到这一点。</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="853d" class="ne mi iq nt b gy ny nz l oa ob">$ pip install django</span></pre><h2 id="68bb" class="ne mi iq bd mj nf ng dn mn nh ni dp mr le nj nk mt li nl nm mv lm nn no mx np bi translated">创建您的Django项目</h2><p id="9016" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">安装Django之后，您可以继续创建您的Django项目。要创建您想要的项目，请导航到您想要Django项目所在的目录，并运行以下命令:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="b78e" class="ne mi iq nt b gy ny nz l oa ob">$ django-admin startproject StravaWebsite</span></pre><p id="1a37" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这将使用<code class="fe nq nr ns nt b">startproject</code>命令将一个项目命名为<code class="fe nq nr ns nt b">StravaWebsite</code> <strong class="kx ir">。</strong></p><p id="57c5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">运行此程序后，将会创建一些文件，如下图所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/c9d397240e5984054844acf4b0ac03fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*4x0KOIgP6TzIsOr4WCo3oQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由startproject命令创建的文件结构</p></figure><p id="c6e2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本教程中，我不会深入解释每个文件的作用，但是每个文件都有不同的用途。如果你还不熟悉每个文件的用途，上面链接的Django官方教程“编写你的第一个Django应用程序”有效地描述了每个文件。</p><h2 id="9821" class="ne mi iq bd mj nf ng dn mn nh ni dp mr le nj nk mt li nl nm mv lm nn no mx np bi translated">运行开发服务器</h2><p id="7011" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">现在我们已经开始了这个项目，我们可以继续运行开发服务器了。为此，我们在终端中运行以下命令:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="a274" class="ne mi iq nt b gy ny nz l oa ob">$ python manage.py runserver</span></pre><p id="edf5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果没有显示错误消息，您应该能够导航到<code class="fe nq nr ns nt b"><a class="ae lr" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/ </a></code>(或者控制台输出消息中给出的任何URL)，并且应该看到以下页面:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/d407aeced126c7fd206bdc527f8b95cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dMpYZuZDh4uHgNXDWJl5cA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">恭喜你。您已经成功地为您的项目运行了开发服务器。</p></figure><p id="6f92" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您看到这个页面，您的Django项目已经被正确设置，并且能够在本地服务器上运行。</p><h1 id="a37f" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">设置地图应用程序</h1><p id="21d3" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">我们现在想在Django项目中创建一个应用程序。在Django，一个应用程序被认为是在你的网站中做一些事情的任何东西。这可以包括创建数据库、显示信息、记录数据或网站做的无数其他事情。</p><h2 id="39a2" class="ne mi iq bd mj nf ng dn mn nh ni dp mr le nj nk mt li nl nm mv lm nn no mx np bi translated">正在初始化应用程序</h2><p id="b534" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">对于这个项目，我们将只使用一个应用程序，称为<code class="fe nq nr ns nt b">StravaMap</code>，虽然Django项目通常会有多个应用程序。</p><p id="ffc9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了创建我们的<code class="fe nq nr ns nt b">StravaMap</code>应用程序，我们使用终端输入命令:</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="5369" class="ne mi iq nt b gy ny nz l oa ob">$ python manage.py startapp StravaMap</span></pre><p id="df29" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这使用了<code class="fe nq nr ns nt b">startapp</code>命令来创建一个名为<code class="fe nq nr ns nt b">StravaMap</code>的应用。这个应用程序在<code class="fe nq nr ns nt b">StravaMap</code>目录下会有一些文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/ba6a1dc5bcfa35ad6dc3a7fafe8cbacf.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*oFbB0w3gw7WjUvxvQmoRhg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Django应用程序的文件结构。</p></figure><h2 id="79d5" class="ne mi iq bd mj nf ng dn mn nh ni dp mr le nj nk mt li nl nm mv lm nn no mx np bi translated">创建应用程序的结构</h2><p id="8c71" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">现在我们已经创建了<code class="fe nq nr ns nt b">StravaMap</code> <strong class="kx ir"> </strong>应用程序，我们需要添加一些额外的文件。</p><p id="7e40" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们创建一个名为<code class="fe nq nr ns nt b">urls.py</code>的新Python文件。在这个文件中，应该有路径<code class="fe nq nr ns nt b">StravaMap/urls.py</code>、<strong class="kx ir">、</strong>放下面的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">StravaMap/urls.py</p></figure><p id="d1d1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个<code class="fe nq nr ns nt b">urls.py</code>文件将与您的服务器通信，以便告诉它要路由到什么URL。</p><p id="065f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们现在转到类似命名的<code class="fe nq nr ns nt b">StravaWebsite/urls.py</code> <strong class="kx ir"> </strong>并添加一个额外的URL模式，以便将其连接到我们的<code class="fe nq nr ns nt b">StravaMap</code> <strong class="kx ir"> </strong>应用程序。这个<code class="fe nq nr ns nt b">urls.py</code> <strong class="kx ir"> </strong>文件应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">StravaWebsite/urls.py</p></figure><p id="d369" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们需要创建一个<code class="fe nq nr ns nt b">templates</code>文件夹。这应该在项目的根目录中。在这个文件夹中，您想要创建一个名为<code class="fe nq nr ns nt b">index.html</code>的HTML文件。如果你感到困惑，我已经附上了到目前为止你的整个项目结构应该是什么样子的图片:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/03b231b13676635e64d5a5577831a906.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*4Jj9WBE_MDnXvimKxzP-uQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">项目的完整文件结构。</p></figure><p id="a493" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，您希望将以下代码添加到<code class="fe nq nr ns nt b">index.html</code> <strong class="kx ir"> </strong>文件中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">模板/索引. html</p></figure><p id="966f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个HTML包含一个引导启动模板和导航栏。它还包括一些额外的代码，这些代码定义了连接到Strava的按钮以及地图将要到达的容器。</p><p id="cf3f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们已经创建了<code class="fe nq nr ns nt b">templates</code>文件夹，我们必须告诉我们的Django项目它在哪里。为此，我们进入<code class="fe nq nr ns nt b">StravaWebsite/settings.py</code>，在这个文件中，将<code class="fe nq nr ns nt b">TEMPLATES</code>中的更新<code class="fe nq nr ns nt b">DIRS </code>变量更改为templates文件夹的路径。在我们这里，<code class="fe nq nr ns nt b">‘DIRS’: [BASE_DIR/’templates’]</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">StravaWebsite/settings.py</p></figure><h1 id="b502" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">设置我们的Strava应用程序</h1><p id="cb8d" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">要在我们的应用程序中使用Strava，我们需要在他们的网站上注册一个API应用程序。你可以很简单地去https://strava.com/settings/api创建一个应用程序。如果你在这个过程中有任何问题，Strava开发者指南有一个标题为<a class="ae lr" href="https://developers.strava.com/docs/getting-started/#account" rel="noopener ugc nofollow" target="_blank">如何创建一个账户</a>的章节可以帮助你完成这些步骤。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/148b974668cedd616a8313eed5d84350.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zxvmd7NVS2mvuAYv0QeLpg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">当你创建了你的API应用程序后，https://strava.com/settings/api会是什么样子。</p></figure><p id="513e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦你完成了应用程序的创建，你应该会看到一个类似上面图片的页面。在这个图像中，我们需要客户端ID和客户端密码来进行下一步操作。</p><h1 id="7bf2" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">用Strava API设置Django社会认证</h1><p id="1cfd" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">现在我们有了API应用程序，我们想把它与Django项目连接起来。为此，我们使用<code class="fe nq nr ns nt b">pip</code>安装包<code class="fe nq nr ns nt b">social-auth-app-django</code>。</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="4d1f" class="ne mi iq nt b gy ny nz l oa ob">$ pip install social-auth-app-django</span></pre><p id="0d71" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们现在要回到<code class="fe nq nr ns nt b">StravaWebsite/setting.py</code> <strong class="kx ir"> </strong>文件。</p><p id="179c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们想在Django的<code class="fe nq nr ns nt b">INSTALLED_APPS</code> <strong class="kx ir"> </strong>变量中添加<code class="fe nq nr ns nt b">social_django</code> app。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">StravaWebsite/settings.py</p></figure><p id="2235" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们需要再次更改<code class="fe nq nr ns nt b">TEMPLATES</code> <strong class="kx ir"> </strong>变量，这次添加两个与<code class="fe nq nr ns nt b">social_django</code> <strong class="kx ir"> </strong>应用程序相关的额外上下文处理器。添加后，您的<code class="fe nq nr ns nt b">TEMPLATES</code>变量应该如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">StravaWebsite/settings.py</p></figure><p id="4af4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还需要向<code class="fe nq nr ns nt b">settings.py</code>文件添加各种新变量。这些变量可以放在文件中的任何地方。<code class="fe nq nr ns nt b">SOCIAL_AUTH_STRAVA_KEY</code>是来自Strava API应用程序的客户端ID，而<code class="fe nq nr ns nt b">SOCIAL_AUTH_STRAVA_SECRET</code>是来自同一个地方的客户端秘密。<code class="fe nq nr ns nt b">SOCIAL_AUTH_LOGIN_REDIRECT_URL</code>表示在成功连接Strava后，用户应该被重定向到哪个URL。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">StravaWebsite/settings.py</p></figure><p id="07ed" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你打算把这个网站直播或者把你的代码放在GitHub上。我强烈建议您将您的密钥读入一个. env文件，该文件已经添加到您的。git忽略文件以保护它。</p><p id="a7c7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">连接Strava和Django Social Auth的最后一步是在<code class="fe nq nr ns nt b">StravaMap/urls.py</code> <strong class="kx ir"> </strong>文件中。在这个文件中，我们想要添加一个<code class="fe nq nr ns nt b">urlpattern</code> <strong class="kx ir"> </strong>来告诉我们的web应用程序为了连接到Strava要重定向到什么URL。您的文件应该如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">StravaMap/urls.py</p></figure><p id="a535" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您遵循了所有这些步骤，那么您的Django项目现在就可以导入Strava数据并对其进行映射了。</p><h2 id="2d83" class="ne mi iq bd mj nf ng dn mn nh ni dp mr le nj nk mt li nl nm mv lm nn no mx np bi translated">创建底图</h2><p id="9171" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">要在地图上绘制Strava数据，我们必须首先创建一个地图对象。为此，我们返回到我们的<code class="fe nq nr ns nt b">StravaMap</code> <strong class="kx ir"> </strong>应用程序，并在<code class="fe nq nr ns nt b">views.py</code>文件中创建一个视图。</p><p id="2ba1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nq nr ns nt b">views.py</code>文件是我们创建用户将与之交互的应用程序的所有方面的地方。在这种情况下，我们希望创建一个视图来创建我们站点上使用的交互式地图。</p><p id="5b12" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于地图，我们将使用叶包。如果不是最受欢迎的交互式制图软件包，Folium也是其中之一。它还能够将其地图转换成HTML兼容格式，这对我们非常有用。要使用leav，请安装带有<code class="fe nq nr ns nt b">pip</code>的软件包。</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="d325" class="ne mi iq nt b gy ny nz l oa ob">$ pip install folium</span></pre><p id="1c91" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，让我们通过在<code class="fe nq nr ns nt b">views.py</code> <strong class="kx ir"> </strong>文件中创建视图<code class="fe nq nr ns nt b">base_map</code>在地图上放置一个交互式地图。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">StravaMap/views.py</p></figure><p id="ef83" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这段代码将创建基本地图，使用<code class="fe nq nr ns nt b">_repr_html_()</code>将其转换为HTML，然后作为变量<code class="fe nq nr ns nt b">main_map</code>输入到<code class="fe nq nr ns nt b">index.html</code>模板中。</p><p id="5a74" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了让服务器知道什么URL调用这个视图，我们必须返回到<code class="fe nq nr ns nt b">StravaMap/urls.py</code>文件并添加这个视图。更新后，它应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">StravaMap/urls.py</p></figure><p id="23bd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这将调用基本路径的<code class="fe nq nr ns nt b">base_map</code>视图。</p><p id="a739" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此时，您应该能够最终在您的服务器上看到一些东西。只需转到<code class="fe nq nr ns nt b"><a class="ae lr" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/</a></code>(或者你的开发服务器URL是什么)，你应该会看到我下面看到的一样的东西:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/e897e09aa0c7fe0d9d9232eb36226afb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hBIt4fqxStXZ8lKuzz12tw.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">哇，一张地图！</p></figure><h1 id="2335" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">连接和映射您的Strava数据</h1><p id="ceb4" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">因为我们已经设置好了一切，我们的蓝色按钮“连接到Strava”应该已经开始工作了。但是，连接后会弹出一个错误，因为Django将尝试重定向到URL /connected，而该URL当前没有任何与之关联的视图。</p><p id="483a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们现在想要创建一个视图<code class="fe nq nr ns nt b">connected_map</code>，它将读入Strava数据，将Strava数据放在一个地图上，并将地图显示到URL <code class="fe nq nr ns nt b">/connected</code>。</p><p id="d5f4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，让我们进入<code class="fe nq nr ns nt b">StravaMap/views.py</code>并创建我们的<code class="fe nq nr ns nt b">connected_map</code>视图。</p><p id="92dc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个地图和第一个地图的区别在于，对于这个地图，我们必须导入Strava数据。幸运的是，Django为我们提供了方便。在这里，我不会详细介绍我是如何使用Strava API的，但是我强烈推荐阅读这篇伟大的文章，这篇文章讲述了Strava API与Python的不同用例<a class="ae lr" href="https://towardsdatascience.com/using-the-strava-api-and-pandas-to-explore-your-activity-data-d94901d9bfde" rel="noopener" target="_blank">在这里</a>。</p><p id="9c2c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个<code class="fe nq nr ns nt b">connected_map</code>视图将从已连接的用户Strava帐户中获取我的所有活动数据，并将折线(构成活动的线条组合)绘制到一个folium地图上。我们通过检索用户数据，使用该用户数据检索活动数据，最后将折线解码为可用的坐标并绘制到地图上来实现这一点。所有这些的代码应该放入<code class="fe nq nr ns nt b">StravaMap/views.py</code> <strong class="kx ir"> </strong>中，可以在这里看到:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">StravaMap/views.py</p></figure><p id="180c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，在运行这个之前，我们需要安装一些新的包。你可以使用<code class="fe nq nr ns nt b">pip</code>来安装这些。</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="9d6f" class="ne mi iq nt b gy ny nz l oa ob">$ pip install pandas<br/>$ pip install polyline<br/>$ pip install requests</span></pre><p id="eac7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">类似于我们的<code class="fe nq nr ns nt b">base_map</code>视图，我们必须更新<code class="fe nq nr ns nt b">StravaMap/urls.py</code> <strong class="kx ir"> </strong>来告诉我们的服务器何时使用这个视图。在这种情况下，当服务器将我们发送到<code class="fe nq nr ns nt b">/connected</code> <strong class="kx ir"> </strong> URL时，我们希望使用<code class="fe nq nr ns nt b">connected_map</code>视图。为此，我们将代码<code class="fe nq nr ns nt b">path(‘connected/’, connected_map, name=’Connect Map View’)</code>添加到urlpatterns中，生成一个如下所示的文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">StravaMap/urls.py</p></figure><p id="3013" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在保存您的文件，返回到您的服务器，并享受您的地图！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/c11c7589bd3fa912c8a22f4f73125d60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*oJqZ3liktZbkaeCE51KyKg.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的最终产品！</p></figure><h1 id="a0a0" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">最后的想法</h1><p id="7afa" class="pw-post-body-paragraph kv kw iq kx b ky mz jr la lb na ju ld le nb lg lh li nc lk ll lm nd lo lp lq ij bi translated">Strava API拥有令人难以置信的数据量，我只是触及了它的皮毛。我希望本教程能够展示如何使用Django向更广泛的受众显示这些数据。</p><p id="81be" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是我写的第一篇文章，我很享受把我的知识转移到这种格式的过程。如果这能帮助哪怕一个人，我的期望就会被超越！</p><pre class="kg kh ki kj gt nu nt nv nw aw nx bi"><span id="c5cf" class="ne mi iq nt b gy ny nz l oa ob"><strong class="nt ir">Want to Connect?</strong></span><span id="b531" class="ne mi iq nt b gy ok nz l oa ob">You can find me on LinkedIn at <a class="ae lr" href="https://www.linkedin.com/in/adam-vert/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/adam-vert/</a>. I’m always looking to meet more people involved in data science, so feel free to reach out!</span></pre></div></div>    
</body>
</html>