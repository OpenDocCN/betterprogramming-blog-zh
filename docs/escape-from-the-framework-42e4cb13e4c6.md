# 逃离框架

> 原文：<https://betterprogramming.pub/escape-from-the-framework-42e4cb13e4c6>

## 或者如罗伯特·马丁所说:“不要和框架结婚”

![](img/eeb92eddb144bffc00fa2dc78417389a.png)

由 [geraldo stanislas](https://unsplash.com/@pixelsucker?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

曾几何时，我曾经学习框架，并将所学直接应用于项目，无需过多解释。

虽然它挽救了这一天，但从长远来看，它对可维护性、可测试性、可读性、枯燥的原则和任何东西都没有任何好处。我想知道为什么用可重用的业务逻辑组件编写 web 应用程序如此困难。

在 ASP.NET MVC 上进行数据库操作的典型教程代码如下所示:

教程教你的方式是最基本的，非抽象的编码方式。您可以直接从表示层(本例中是控制器层)访问数据库。

我开始像教程认为的那样编码。我估计这是大部分新人程序员长期以来的做法。对于一些简单的应用程序和学习新的框架来说，使用这种方法是可以的，但是总有一天，当你一次又一次地面对同样的问题时，你会感到有挑战性。代码变得杂乱，业务逻辑被复制在许多文件周围，与框架(`ModelState`、`ViewBag`、Http 查询字符串等)完全耦合。).

您的核心业务逻辑不应该是 HTTP 请求、查询字符串和其他 web 噱头。它应该完全是关于业务需求的。核心业务模块不应该关心数据如何输入或结果如何输出。它可以来自一个 web 表单、一个查询字符串、一个 windows 表单、一个 web 服务、一个控制台应用程序，或者一个 VR 界面，如果你喜欢冒险的话。所有这些问题的解决方案是将业务逻辑从周围的框架中分离出来。

# 分离业务逻辑

![](img/8847e0c46fb73b3eed84f80e28a66ffb.png)

照片由[加拉·罗德里格斯](https://unsplash.com/@gala?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

一会儿，就把自然想成一个类比。水果带着皮和壳长在树上。它们需要它们的皮和壳来健康地生长，保护它们免受外界的影响和危险。他们不会向外界暴露他们的核心。就像水果一样，你的应用需要一个外壳才能健康成长。

当您直接将业务逻辑嵌入控制器时，您就暴露了果实的核心。但是当你把它分成另一层时，你就把框架当成了果皮。你可以随时把果皮换成外壳或塑料盖，但里面的果核会保持安全。您正在对核心逻辑进行未来验证。然而，这并不是一件容易的事情。

你需要开始思考你正在使用的框架之外的东西(在我们的例子中是 ASP.NET MVC ),并把你的业务逻辑从你的框架代码中分离出来。这使得您的业务逻辑与您正在使用的框架分离。您可以设计一个服务类来封装控制器中的业务逻辑。当然，直接访问服务类并不是首选。相反，它通常被抽象在一个接口之后，以使其单元可测试和可互换。数据通过数据传输对象或[dto](https://en.wikipedia.org/wiki/Data_transfer_object)进行交换。dto 是不包含任何业务逻辑的普通对象，只有可以序列化的数据。

让我们试着将业务逻辑与前面的例子分开:

图书创建和查询的服务接口和实现。

MVC 控制器代码变成这样:

这是您可能希望控制器代码看起来的样子。

您甚至可以从命令行界面调用相同的业务逻辑:

有了抽象之后，就可以从任何类型的应用程序中调用业务逻辑。

在这些例子中使用接口似乎毫无意义，因为我们是手动构造的，你是对的。因为为了简洁起见，我省略了依赖注入。

你绝对应该使用依赖注入库将接口的实现注入到构造函数中，而不是像`new BookService()`那样手工构造它们。它对于可维护性和可测试性至关重要，应该在实际应用中使用。例如，这就是`BookController`注入依赖项而不是手动创建的样子:

注入的依赖项。

通过依赖接口和 dto 而不是具体的类和业务逻辑对象，我们的代码是面向未来的。这样，如果我们将来决定将我们的一些服务分解到另一个流程中，如 web 服务或任何其他 RPC 方法，我们可以轻松完成:

BookService 作为 REST api 闯入另一个进程。我们的 MVC 应用程序不受这个变化的影响。如果我们使用依赖注入库，我们可以在一行代码中交换 IBookService 的实现。

## 引人深思的事

*   我们只抽象出了一层逻辑。这一层仍然通过实体框架直接访问数据库，因此它仍然与框架紧密耦合。如果您需要将数据存储在文件中，或者存储在实体框架不支持的数据库中，会发生什么情况？你如何克服这个问题？
*   抛出 BusinessException 会发生什么？需要办理吗，应该在哪里办理？
*   将像 HttpRequest 或 ViewBag 这样的 web 构造直接泄漏到您的服务层中是一个好主意吗？当您泄漏 web 构造时，如果您想在控制台应用程序而不是 web 应用程序中使用此业务服务，会发生什么情况？

# 结论

这是对一个非常广泛的主题的一种非常通用的方法。我强烈推荐阅读像*罗伯特·c·马丁*写的*干净的架构:软件结构和设计的工匠指南*这样的书来更深入地探究这个主题。正如罗伯特·c·马丁在书中所说:*“不要和框架结婚！”*