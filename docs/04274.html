<html>
<head>
<title>How to Automate Screenshots in Your Flutter Publishing Workflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在你的Flutter发布工作流程中自动截图</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-automate-screenshots-in-your-flutter-publishing-workflow-d9002206710b?source=collection_archive---------8-----------------------#2020-04-02">https://betterprogramming.pub/how-to-automate-screenshots-in-your-flutter-publishing-workflow-d9002206710b?source=collection_archive---------8-----------------------#2020-04-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f4c0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在部署新版本的应用程序时自动截图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6f343bc5df31f4f12eb55b3df8501105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JoKaJeC7cZJIxBJK"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://unsplash.com/@olloweb?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">agency followeb</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="eb22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嘿，大家好！在这篇文章中，我们将看看如何用我们的Flutter应用程序自动截图。原因很简单:每次我们更新应用程序，我们可能会花几个小时<em class="lv"> </em>拍摄新的截图等等。如果我们能自动化这个过程，那不是很好吗？</p><p id="fb56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，我们可以！让我们继续读下去，找出答案。</p><p id="9399" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将了解:</p><ul class=""><li id="9b25" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">编写集成测试。</li><li id="026a" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">使用截图包来截图。</li><li id="cdff" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">设置不同的模拟器来代表不同的设备，并在这些设备上截取屏幕截图。</li><li id="4e89" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">使用截图运行集成测试。</li></ul></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="f461" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">设定期望</h1><p id="90ae" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在我个人看来，这种特殊的前进方式有点随意，也不像应该的那样容易。说到软件开发，我是“有话直说”的超级粉丝如果有些东西易于阅读，那么在未来很长一段时间内，排除故障/调试/改进将会很容易。反之亦然:如果某样东西很难读懂，那么将来也很难继续努力。人们会回避触摸它，等等。</p><p id="427f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，当谈到核心应用程序时，这非常重要。你希望它易于理解和使用。它在较小程度上适用于您编写的测试，或者在这种情况下，您编写的截屏代码。如果你在你的应用程序中写了可怕的代码，事情会变得很糟糕——你应该预料到这一点。</p><p id="a64b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是你为你的测试写的代码呢？你应该用同等的标准来衡量自己吗？我不这么认为。你只是告诉电脑如何浏览你的应用程序，按什么按钮，等多长时间。如果你的测试有点乱，也不是特别优雅，只要他们完成了他们设定的目标(即测试应用程序)，那就没问题。</p><p id="314a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么我一直在说这个？嗯，目前在Flutter中编写自动化测试需要一些非常奇怪的变通方法。但好处是不用手动获取自己的截图。</p><p id="54d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以让我们继续努力。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="b7bc" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">克隆我们的示例应用程序</h1><p id="d8da" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我知道你想用自己的应用程序来实现这一点，但我鼓励你先克隆我的示例应用程序并让它与它一起工作。如果它确实能做到这一点，那么你就有更好的机会让它与你的应用程序一起工作。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="24c5" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">开始设置我们的第一个集成测试</h1><p id="dbe1" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我们将要测试的应用程序如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/55f012f315f232bca78cd5a69909d03b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/0*xUMhK29AaRhqZorm.png"/></div></figure><p id="dcbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">集成测试在GitHub 上<a class="ae ky" href="https://github.com/flutterfromscratch/sonder/blob/master/test_driver/main_test.dart" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="3cd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个测试我们点击体验按钮，然后截图结果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="b66e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这大部分是有意义的，但是在上面的函数中有一些奇怪的部分。可能引起您注意的两个参数是<code class="fe nr ns nt nu b">driver.runUnsynchronized</code>和<code class="fe nr ns nt nu b">screenshot</code>函数上的<code class="fe nr ns nt nu b">waitUntilNoTransientCallbacks</code>参数。这个故事的简短版本是，如果我没有在我的测试中包括这些，要么驱动程序无法找到我的部件进行交互，要么截图包将无限期挂起，不会产生结果。</p><p id="fadb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你真的想，你可以在<code class="fe nr ns nt nu b">runUnsynchronized</code>上阅读<a class="ae ky" href="https://api.flutter.dev/flutter/flutter_driver/FlutterDriver/runUnsynchronized.html" rel="noopener ugc nofollow" target="_blank">文档</a>。是的，我真的不明白为什么会有这种行为。</p><p id="7ac1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nr ns nt nu b">waitUntilNoTransientCallbacks</code>也是类似的故事。在截图包中，当这为真时(默认情况下如此)，它调用<code class="fe nr ns nt nu b">waitUntilNoTransientCallbacks</code>，最终(总是)超时。理论上来说，<a class="ae ky" href="https://api.flutter.dev/flutter/flutter_driver/FlutterDriver/waitUntilNoTransientCallbacks.html" rel="noopener ugc nofollow" target="_blank">文档</a>听起来不错，而且它特别指出这些在用截图做事情时很好用。</p><p id="0e99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，这有点像查字典对“土豆”的定义，看到的定义只是“土豆”。文档(无益地)说这个函数只是“等待，直到队列中不再有瞬态回调。”你知道什么是短暂回调吗？我真的不知道，但是话说回来，也许我只是一个超级普通的开发人员，你完全知道这意味着什么。</p><p id="a982" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是我们如何在本地运行呢？</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="e6ba" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">正在设置</h1><p id="f0e6" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我们将使用<a class="ae ky" href="https://github.com/mmcc007/screenshots" rel="noopener ugc nofollow" target="_blank">截图包</a>开始。超快速设置指南是这样的(在Windows上)。</p><ol class=""><li id="e9f1" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu nv mc md me bi translated">安装<a class="ae ky" href="https://chocolatey.org/" rel="noopener ugc nofollow" target="_blank">巧克力糖</a>。</li><li id="6a78" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu nv mc md me bi translated">安装ImageMagick。</li></ol><pre class="kj kk kl km gt nw nu nx ny aw nz bi"><span id="a93a" class="oa ms it nu b gy ob oc l od oe">choco install imagemagick.app</span></pre><p id="c6b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.激活<strong class="lb iu"> </strong>截图包。您必须直接从GitHub repo中激活软件包:</p><pre class="kj kk kl km gt nw nu nx ny aw nz bi"><span id="2e02" class="oa ms it nu b gy ob oc l od oe">flutter pub global activate -sgit <a class="ae ky" href="https://github.com/mmcc007/screenshots" rel="noopener ugc nofollow" target="_blank">https://github.com/mmcc007/screenshots</a></span></pre><p id="fc53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.在示例app中，看<code class="fe nr ns nt nu b">screenshots.yaml</code>。它包含在哪些设备上运行截图的配置。</p><p id="c2fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.接下来，创建您想要创建截图的设备，并将其命名为与<code class="fe nr ns nt nu b">screenshots.yaml</code>中的设备完全相同的名称。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/3b6f760286a50c0c4373f69797f9d5ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*8lzY_n-UwMhlWbIP34Mg4w.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/bf7a12f82ef0df6afca4458f1387a682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tIT8y6Ll7v23Z_Wk00Mojg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">请注意，模拟器的名称与它们在screenshots.yaml文件中的名称完全相同。</p></figure><p id="35a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">6.启动所有仿真器至少一次<strong class="lb iu"> </strong>并保存一个状态。有时，如果设备启动时间过长，测试/截图包会超时并失败。</p><p id="450d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">7.打开命令提示符，键入<code class="fe nr ns nt nu b">screenshots</code>，然后按回车键。您应该会看到所有的模拟器都启动了，截屏开始了，过程结束了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/348958d62fe88878620121dc192554fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFbMxsZ9A-CpVS9iNWaijA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图是按设备拆分的。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/fe2e7ed7b808d4ffcfbca102eb1a57e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KrbpTf8dGeJjRdgzlA98Hw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截屏遵循设备名称-方向-测试Name.png惯例。</p></figure><h2 id="8e55" class="oa ms it bd mt oj ok dn mx ol om dp nb li on oo nd lm op oq nf lq or os nh ot bi translated">常见问题</h2><p id="fd42" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我在运行屏幕截图时出现以下错误:</p><pre class="kj kk kl km gt nw nu nx ny aw nz bi"><span id="0bbe" class="oa ms it nu b gy ob oc l od oe">Unhandled exception:<br/>type ‘List&lt;dynamic&gt;’ is not a subtype of type ‘String’</span></pre><p id="ecec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出现此错误是因为您激活了已发布的<strong class="lb iu"> </strong>版本的截图，而您本应激活截图的主分支<strong class="lb iu"> </strong>。<code class="fe nr ns nt nu b">configuration.yaml</code>的用法略有变化。</p><p id="3ef7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“但我做到了！而且还是不行。”</p><p id="5774" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能需要核选项。</p><p id="7243" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按照Git存储库上的说明，我已经在我的机器上设置了到<code class="fe nr ns nt nu b">pub</code>的本地路径，它位于我的<code class="fe nr ns nt nu b">%APPDATA%</code>目录中。我不得不删除这些添加的东西，只使用<code class="fe nr ns nt nu b">flutter pub</code> <strong class="lb iu"> </strong>而不是直接使用<code class="fe nr ns nt nu b">pub</code> <strong class="lb iu"> </strong>命令。然后一切开始运转。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="c70c" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">感谢阅读</h1><p id="7f77" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">这是一个相当脆弱的过程。所以如果你遇到了困难，请在评论中告诉我，我会尽全力帮助你。</p><p id="dfbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自动截图，呜呜！</p></div></div>    
</body>
</html>