<html>
<head>
<title>Hello, Kubernetes Spring Boot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你好，库伯内特·Spring Boot</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/hello-kubernetes-spring-boot-a20e47d57872?source=collection_archive---------3-----------------------#2020-10-06">https://betterprogramming.pub/hello-kubernetes-spring-boot-a20e47d57872?source=collection_archive---------3-----------------------#2020-10-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6730" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们构建一个最简单的Java Spring Boot应用程序，它作为一个pod在Kubernetes集群中运行</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f06495ed9ab4b4be56cd9b313a4e734e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2AHHvVqK6_tz7C7kQyR3-g.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:<a class="ae kv" href="https://dev.to/sandrogiacom" rel="noopener ugc nofollow" target="_blank">桑德罗·贾科莫齐</a></p></figure><h1 id="a230" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">项目的结构:</h1><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="1053" class="lt kx iq lp b gy lu lv l lw lx">├── Dockerfile<br/>├── build.gradle<br/>├── gradle<br/>│   └── wrapper<br/>│       ├── gradle-wrapper.jar<br/>│       └── gradle-wrapper.properties<br/>├── gradlew<br/>├── k8s<br/>│   └── depl.yaml<br/>├── settings.gradle<br/>└── src<br/>    └── main<br/>        └── java<br/>            └── hello<br/>                ├── App.java<br/>                └── HelloWorldCtrl.java</span></pre><p id="fc2b" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">我们的<code class="fe mu mv mw lp b">App.java</code>是应用程序的入口点:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="60b8" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">上面的代码包含创建Spring Boot应用程序所需的最少几行代码。</p><p id="34a1" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated"><code class="fe mu mv mw lp b">HelloWorldCtrl.java</code>包含一个简单的控制器，它映射根路径<code class="fe mu mv mw lp b">(“/”)</code>并返回一个问候字符串:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="6a09" class="kw kx iq bd ky kz ng lb lc ld nh lf lg jw ni jx li jz nj ka lk kc nk kd lm ln bi translated">构建应用程序</h1><p id="4e8c" class="pw-post-body-paragraph ly lz iq ma b mb nl jr md me nm ju mg mh nn mj mk ml no mn mo mp np mr ms mt ij bi translated">我使用Gradle作为我的构建工具。<code class="fe mu mv mw lp b">build.gradle</code>文件也是最小的，由以下几行组成:</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="a7e9" class="lt kx iq lp b gy lu lv l lw lx">plugins {<br/>    id 'org.springframework.boot' version '2.3.3.RELEASE'<br/>    id 'io.spring.dependency-management' version '1.0.8.RELEASE'<br/>    id 'java'<br/>}<br/><br/>group = 'com.test'<br/>version = '0.0.1-SNAPSHOT'<br/>sourceCompatibility = '1.8'<br/><br/>repositories {<br/>    mavenCentral()<br/>}<br/><br/>dependencies {<br/>    implementation 'org.springframework.boot:spring-boot-starter-web'<br/>}</span></pre></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="918a" class="kw kx iq bd ky kz ng lb lc ld nh lf lg jw ni jx li jz nj ka lk kc nk kd lm ln bi translated">创建K8s资源</h1><p id="254a" class="pw-post-body-paragraph ly lz iq ma b mb nl jr md me nm ju mg mh nn mj mk ml no mn mo mp np mr ms mt ij bi translated">为了创建K8s部署，我们需要一个Docker映像。让我们在我们的<code class="fe mu mv mw lp b">Dockerfile</code>中添加以下几行:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="4ebd" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">我们Docker文件中的步骤:</p><ul class=""><li id="ebeb" class="nq nr iq ma b mb mc me mf mh ns ml nt mp nu mt nv nw nx ny bi translated">将项目复制到<code class="fe mu mv mw lp b">/app</code></li><li id="7033" class="nq nr iq ma b mb nz me oa mh ob ml oc mp od mt nv nw nx ny bi translated">使用Gradle构建项目</li><li id="c581" class="nq nr iq ma b mb nz me oa mh ob ml oc mp od mt nv nw nx ny bi translated">使用上一步的结果运行应用程序</li></ul><p id="dba4" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">我们现在可以构建映像并推送到中心:</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="f86a" class="lt kx iq lp b gy lu lv l lw lx">docker build -t marounbassam/hello-spring .<br/>docker push marounbassam/hello-spring</span></pre><p id="7e47" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">K8s部署很简单。它由<a class="ae kv" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank">部署</a>和<a class="ae kv" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank">服务</a>组成:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="8623" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">部署定义了pod的两个副本，这两个副本将运行从image属性中指定的映像构建的容器。</p><p id="c77b" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">服务的类型是<code class="fe mu mv mw lp b">ClusterIP</code>(默认的Kubernetes服务)。它在我们的集群中为我们提供了一项服务，其他应用也可以访问这项服务。</p><p id="e96c" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">在集群中创建资源:</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="0ed7" class="lt kx iq lp b gy lu lv l lw lx">kubectl create -f &lt;yaml_file&gt;</span></pre><p id="b5da" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">资源可以按如下方式可视化:</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="5384" class="lt kx iq lp b gy lu lv l lw lx">+---------------------+<br/>| hello-world-service |<br/>|                     |<br/>|    10.15.242.210    |<br/>+---------O-----------+<br/>          |<br/>          +-------------O--------------------------O<br/>                        |                          |<br/>              +---------O-----------+    +---------O-----------+<br/>              |        pod 1        |    |        pod 2        |<br/>              |                     |    |                     |<br/>              |     hello-world     |    |     hello-world     |<br/>              +---------------------+    +---------------------+</span></pre></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="5bb7" class="kw kx iq bd ky kz ng lb lc ld nh lf lg jw ni jx li jz nj ka lk kc nk kd lm ln bi translated">在集群内部</h1><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="6a10" class="lt kx iq lp b gy lu lv l lw lx">$ kubectl get pods<br/>NAME                         READY     STATUS    RESTARTS   AGE<br/>hello-world-5bb87c95-6h4kh   1/1       Running   0          7h<br/>hello-world-5bb87c95-bz64v   1/1       Running   0          7h<br/>$ kubectl get svc<br/>NAME                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE<br/>hello-world-service   ClusterIP   10.15.242.210   &lt;none&gt;        8080/TCP   5s<br/>kubernetes            ClusterIP   10.15.240.1     &lt;none&gt;        443/TCP    7h<br/>$ kubectl exec -it hello-world-5bb87c95-6h4kh bash<br/>$ (inside the pod) curl 10.15.242.210:8080<br/>$ (inside the pod) Greetings from Spring Boot!</span></pre><p id="e6b6" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">我们可以看到服务器已经启动，正在pod内部运行。根据您的云提供商，您可以设置类型为<code class="fe mu mv mw lp b">LoadBalancer</code>的服务，并从集群外部访问应用程序。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="f493" class="kw kx iq bd ky kz ng lb lc ld nh lf lg jw ni jx li jz nj ka lk kc nk kd lm ln bi translated">结论</h1><p id="1607" class="pw-post-body-paragraph ly lz iq ma b mb nl jr md me nm ju mg mh nn mj mk ml no mn mo mp np mr ms mt ij bi translated">我们创建了一个简单的Spring Boot应用程序，将其包装在Docker容器中，并在K8s pod中使用该容器，该pod由K8s部署进行编排，并通过服务公开。</p><p id="7ad7" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">该服务为两个创建的pod提供了一个简单的负载平衡器，并且可以根据应用程序需求轻松扩展。</p></div></div>    
</body>
</html>