# 高级 Python:在定义 Python 函数时，请考虑这 10 个元素

> 原文：<https://betterprogramming.pub/advanced-python-consider-these-10-elements-when-you-define-python-functions-61c0be8a10ed>

## Python 中函数声明的最佳实践——尤其是公共 API

![](img/6d3428987f1f65c5509a5ba19a65e5af.png)

里卡多·弗兰茨在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

无论编程语言使用什么样的实现机制，它们都为函数预留了一个位置。函数是任何代码项目的重要组成部分，因为它们负责准备和处理数据以及配置用户界面元素。毫无例外，Python 虽然被定位为面向对象的编程语言，但它依赖函数来执行与数据相关的操作。因此，编写好的函数对于构建弹性代码库至关重要。

在一个小项目中定义几个简单的函数很简单。随着项目范围的扩大，功能会变得更加复杂，对更多功能的需求也呈指数级增长。即使对于有经验的程序员来说，让所有的功能一起工作而没有任何混乱也是一件令人头疼的事情。随着项目范围的扩大，将最佳实践应用于函数声明变得更加重要。在本文中，我想谈谈声明函数的最佳实践——这是我多年编码积累的知识。

# 1.一般准则

您可能对这些通用准则很熟悉，但是我想先讨论一下，因为它们是许多程序员不欣赏的高级、良好的实践。当开发人员不遵循这些指导方针时，他们会付出代价——代码很难维护。

## **明确而意味深长的名字**

我们必须给我们的函数起一个有意义的名字。如你所知，函数也是 Python 中的对象，所以当我们定义一个函数时，我们基本上创建了一个函数类型的变量。因此，变量名(即函数名)必须反映它所执行的操作。

尽管可读性在现代编码中变得越来越重要，但它主要是在注释中讨论的——相对于代码本身，它很少被讨论。所以，如果你必须写大量的注释来解释你的函数，很可能你的函数没有好名字。不要担心函数名太长——几乎所有的现代 ide 都有很好的自动完成提示，这将使您不必键入完整的长名称。

功能名称

好的命名规则也应该适用于函数的参数和函数中的所有局部变量。还有一点要注意的是，如果你的函数打算在你的类或模块中使用，你可能想在名字前面加一个下划线(例如，`def _internal_fun():`)来表示这些函数是私有的，它们不是公共的 API。

# **小而单一用途**

你的功能应该尽量小，这样更容易管理。想象你正在建造一座房子(不是一座大厦)。然而，你用的砖块是一米的立方。它们容易使用吗？可能不会——它们太大了。同样的原则也适用于函数。这些函数是项目的砖块。如果这些功能的规模都很大，你的构建就不会尽可能顺利地进行。当他们很小的时候，他们更容易适应不同的地方，如果需要的话可以四处移动。

让你的函数为单一目的服务也很重要，这可以帮助你保持你的函数小。单一用途函数的另一个好处是，您会发现命名这样的函数要容易得多。您可以简单地根据预期的单一用途来命名您的函数。下面是我们如何重构我们的函数，使每个函数只服务于一个目的。另一件要注意的事情是，通过这样做，您可以最大限度地减少需要编写的注释——因为所有的函数名称都说明了问题。

单一目的

## **不要多此一举**

你没有无限的精力和时间为你需要的每个操作编写函数，所以熟悉标准库中的常用函数是必不可少的。在定义自己的功能之前，请考虑特定的业务需求是否是常见的——如果是，那么这些特定的相关需求很可能已经得到了满足。

例如，如果您处理 CSV 格式的数据，您可以查看 [CSV 模块](https://docs.python.org/3/library/csv.html)中的功能。或者， [pandas 库](https://pandas.pydata.org/)可以优雅地处理 CSV 文件。再举一个例子，如果您想对列表中的元素进行计数，您应该考虑集合模块中的`Counter`类，它是专门为这些操作设计的。

# 2.默认参数

## 相关场景

当我们第一次定义一个函数时，它通常有一个特定的用途。但是，当您向项目中添加更多功能时，您可能会意识到一些密切相关的功能可以合并。唯一的区别是合并函数的调用有时涉及传递另一个参数或设置稍微不同的参数。在这种情况下，您可以考虑为参数设置默认值。

另一种常见的情况是，当您声明一个函数时，您已经期望您的函数有多种用途，函数调用使用不同的参数，而其他一些参数只需要很少的变化。您应该考虑为变化较小的参数设置一个默认值。

## 设置默认参数

设置默认参数的好处很简单——在大多数情况下，您不需要设置不必要的参数。但是，在函数签名中保留这些参数的可用性允许您在需要时更灵活地使用函数。例如，对于内置的`sorted()`函数，有几种方法可以调用该函数，但在大多数情况下，我们只使用基本形式:`sorted(the_iterable)`，它将按照升序字典顺序对 iterable 进行排序。然而，当你想改变升序或默认的字典顺序时，我们可以通过指定`reverse`和`key`参数来覆盖默认设置。

我们应该对我们自己的函数声明应用相同的实践。就我们应该设置什么值而言，经验法则是您应该选择用于大多数函数调用的默认值。因为这是一个可选参数，所以您(或者您的 API 的用户)在大多数情况下都不想设置它。考虑下面的例子:

默认参数

## 避免可变默认参数的陷阱

设置默认参数有一个问题。如果你的参数是一个可变对象，重要的是不要使用默认的构造函数来设置它——因为函数是 Python 中的对象，它们是在定义时创建的。副作用是默认参数是在函数声明时计算的，因此创建了一个默认可变对象，并成为函数的一部分。每当您使用默认对象调用函数时，您实际上是在访问与该函数相关联的同一个可变对象，尽管您的意图可能是让该函数为您创建一个全新的对象。以下代码片段向您展示了设置默认可变参数的不良副作用:

默认可变对象

如上所示，尽管我们打算创建两个不同的购物列表，但是第二个函数调用仍然访问相同的底层对象，这导致了将`Soccer`项添加到相同的列表对象中。要解决这个问题，我们应该使用下面的实现。具体来说，您应该使用`None`作为可变参数的默认值:

无作为可变参数的默认值

# 3.考虑返回多个值

## 元组中的多个值

当您的函数执行复杂的操作时，这些操作可能会生成两个或更多的对象，所有这些都是您后续数据处理所需要的。理论上，您可以创建一个类来包装这些对象，这样您的函数就可以将类实例作为输出返回。然而，在 Python 中，一个函数可能会返回多个值。更准确地说，这些多个值作为一个元组对象返回。以下代码向您展示了一个简单的示例:

多个返回值

如上所示，返回值简单地用逗号分隔，这实际上创建了一个 tuple 对象，由`type()`函数检查。

## 但不超过三个

需要注意的一点是，虽然 Python 函数可以返回多个值，但是您不应该滥用这个特性。一个值(当一个函数没有显式地返回任何东西时，它实际上隐式地返回了`None`)是最好的——因为一切都很简单，大多数用户通常期望一个函数只返回一个值。在某些情况下，返回两个值是可以的，返回三个值可能也可以，但是请不要返回四个值。这可能会给用户造成很多混淆。如果发生这种情况，这是一个很好的迹象，表明你应该重构你的函数——你的函数可能有多种用途，你应该创建更小的函数来承担更专门的职责。

# 4.使用 Try…除了

当您将函数定义为公共 API 时，您不能总是假设用户为函数设置了所需的参数。即使我们自己使用这些函数，也有可能有些参数是在我们的控制之外创建的，它们与我们的函数不兼容。在这些情况下，我们应该在函数声明中做什么呢？

首先要考虑的是使用`try…except`语句，这是典型的异常处理技术。您将可能出错的代码(即引发某些异常)嵌入到`try`子句中，可能的异常在`except`子句中处理。

让我们考虑下面的场景。假设特定的业务需求是您的函数采用一个文件路径，如果该文件存在并被成功读取，您的函数对该文件进行一些数据处理操作并返回结果，否则返回`-1`。*【2011 年 5 月 23 日编辑(详见回复):当文件无法读取时，抛出一个异常，这更能说明问题，也更明确。虽然这里没有讨论，但是如果您想给出更具体的信息，定义特定于您的工具的自定义异常通常是一个好主意。]* 实现这种需求有多种方式。下面的代码向您展示了一个可能的解决方案:

Try…Except 语句

换句话说，如果您希望函数的用户可以设置一些导致代码异常的参数，您可以定义处理这些可能的异常的函数。然而，这应该与用户清楚地沟通，除非它是示例中所示特性的一部分(当文件无法读取时返回`-1`)。

# 5.考虑参数验证

使用`try…except`语句的前一个函数有时被称为 EAFP(请求原谅比请求允许容易)编码风格。另一种编码风格叫做 LBYL(三思而后行)，它强调在运行特定代码块之前进行健全性检查。

根据前面的例子，在将 LBYL 应用于函数声明方面，另一个考虑是验证函数的参数。参数验证的一个常见用例是检查参数的数据类型是否正确。众所周知，Python 是一种动态类型语言，它不强制类型检查。例如，函数的参数应该是整数或浮点数。然而，通过设置字符串来调用函数(调用本身)不会提示任何错误消息，直到函数被执行。

下面的代码显示了如何在运行代码之前验证参数:

参数验证

## 讨论:EAFP 对 LBYL

应该指出的是，EAFP 和 LBYL 都可以应用到不仅仅是处理函数的论点。它们可以应用于函数中的任何地方。尽管 EAFP 是 Python 世界中首选的编码风格，但根据您的用例，您也应该考虑使用 LBYL，它可以提供比 EAFP 风格得到的一般内置错误消息更用户友好的特定于函数的错误消息。

# 6.将 Lambda 函数视为备选函数

## 作为其他函数参数的函数

一些函数可以接受另一个函数(或者一般来说是可调用的)来执行特定的操作。例如，`sorted()`函数有`key`参数，允许我们定义更多的自定义排序行为。以下代码片段向您展示了一个用例:

使用函数自定义排序

## λ作为替代函数

值得注意的是，`sorting_grade`函数只使用过一次，而且是一个简单的函数——在这种情况下，我们可以考虑使用 lambda 函数。

如果你不熟悉 lambda 函数，这里有一个简单的描述。lambda 函数是使用 lambda 关键字声明的匿名函数。它接受零到多个参数，并有一个适用于操作的表达式，其形式为:`lambda arguments: expression`。以下代码向您展示了我们如何在`sorted()`函数中使用 lambda 函数，这看起来比上面的解决方案更简洁:

使用 Lambda 自定义排序

与许多数据科学家相关的另一个常见用例是在使用 pandas 库时使用 lambda 函数。下面的代码是一个简单的例子，说明了`lambda`函数如何使用`map()`函数协助数据操作，该函数操作熊猫`Series`对象中的每一项:

使用`map()`和`Lambda`进行数据操作

# 7.考虑装修工

## 装修工

装饰器是修改其他函数的行为而不影响其核心功能的函数。换句话说，它们提供了修饰功能的修饰。如果不太了解装修工，可以随意参考我之前的文章( [1](https://medium.com/better-programming/how-to-write-python-decorators-that-take-parameters-b5a07d7fe393) 、 [2](https://towardsdatascience.com/why-you-should-wrap-decorators-in-python-5ac3676835f9) 、 [3](https://medium.com/swlh/three-decorators-commonly-used-in-python-custom-classes-acc34a145dcf) )。这里有一个关于装饰者如何在 Python 中工作的小例子。

基本装饰

如图所示，decorator 函数简单地运行被修饰的函数两次。要使用装饰器，我们只需将装饰器函数名放在带有前缀`@`的装饰函数之上。可以看出，修饰函数确实被调用了两次。

## 在函数声明中使用装饰符

例如，一个有用的装饰器是可以在自定义类中使用的属性装饰器。下面的代码向您展示了它是如何工作的。本质上，`@property` decorator 转换一个实例方法，使其行为像一个常规属性，这允许使用点符号访问。

装饰者:属性

装饰器的另一个微不足道的用例是时间记录装饰器，当您的函数的效率受到关注时，它会特别方便。以下代码向您展示了这种用法:

记录时间

# 8.使用*args 和* * kwargs——但要少用

在上一节中，您看到了在定义我们的装饰函数时使用了`*args`和`**kwargs`，使用它们允许装饰函数装饰任何函数。本质上，我们使用`*args`来捕获所有(或者更一般地说，不确定数量的)位置参数，而`**kwargs`来捕获所有(或者更一般地说，不确定数量的)关键字参数。具体来说，位置参数基于函数调用中传递的参数的位置，而关键字参数基于为特定命名的函数参数设置参数。

如果你不熟悉这些术语，这里有一个内置`sorted()`函数的签名:`sorted(*iterable*, ***, *key=None*, *reverse=False*)`。`iterable`参数是位置参数，而`key`和`reverse`参数是关键字参数。

使用`*args`和`**kwargs`的主要好处是让你的函数声明看起来干净，或者对于同样的事情来说噪音更小。下面的例子向您展示了在函数声明中合法使用`*arg`，它允许您的函数接受任意数量的位置参数。

*参数的使用

以下代码向您展示了在函数声明中合法使用`**kwargs`。同样，带有`**kwargs`的函数允许用户设置任意数量的关键字参数，使你的函数更加灵活。

**kwargs 的使用

但是，大多数情况下，不需要使用`*args`或`**kwargs`。虽然它可以使你的声明更干净一点，但是它隐藏了函数的签名。换句话说，函数的用户必须准确地计算出函数的参数。所以我的建议是，如果没有必要，就避免使用它们。例如，我可以使用字典参数来替换`**kwargs`吗？同样的，我可以用列表或者元组对象来代替`*args`吗？在大多数情况下，这些替代方案应该没有任何问题。

# 9.参数的类型批注

如前所述，Python 是一种动态类型的编程语言，也是一种解释语言，这意味着 Python 在编码时不检查代码有效性，包括类型兼容性。直到您的代码实际执行，才会出现与您的函数不兼容的类型(例如，当需要一个整数时，向函数发送一个字符串)。

由于这些原因，Python 不强制声明输入和输出参数的类型。换句话说，当您创建函数时，您不需要指定它们应该具有什么类型的参数。然而，在最近的 Python 版本中，这已经成为可能。使用类型注释的主要好处是，一些 ide(例如 PyCharm 或 Visual Studio 代码)可以使用注释来检查类型兼容性，这样当您或其他用户使用您的函数时，您就可以得到适当的提示。

另一个相关的好处是，如果 ide 知道参数的类型，它可以给出正确的自动完成建议，帮助您更快地编码。当然，当您为函数编写 docstrings 时，这些类型注释也会为代码的最终开发人员提供信息。

![](img/e27cff6942cdb5bd94f3ac75de06a641.png)

带有类型注释的有用信息(PyCharm)

# 10.负责任的文件

我把好的文档等同于负责任的文档。如果您的函数是供私人使用的，那么您不必编写非常详尽的文档——您可以假设您的代码清楚地讲述了这个故事。如果任何地方需要一些澄清，您可以写一个非常简短的注释，当您的代码被重新访问时，可以作为对您自己或其他读者的提醒。这里，关于负责任的文档的讨论更多的是关于作为公共 API 的函数的文档字符串。应包括以下几个方面:

*   **对您的职能的预期操作的简要总结。**这个应该很简洁。在大多数情况下，总结不应该超过一句话。
*   **输入参数:类型和解释。**你需要通过设置特定的选项来指定你的输入参数应该是什么类型以及它们能做什么。
*   **返回值:类型和解释。与输入参数一样，您需要指定函数的输出。如果它不返回任何东西，您可以选择指定`None`作为返回值。**

# 结论

如果你有编码经验，你会发现你的大部分时间都花在编写和重构函数上。毕竟，您的数据本身通常不会发生太大变化——处理和操作数据的是函数。如果您将数据视为身体的躯干，那么功能就是让您四处走动的胳膊和腿。因此，我们必须编写好的函数来使我们的程序敏捷。

我希望这篇文章已经传达了一些有用的信息，您可以在您的编码中使用。

感谢阅读。