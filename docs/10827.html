<html>
<head>
<title>Switching SwiftUI App Themes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">切换SwiftUI应用主题</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swiftui-app-theme-switch-241a79574b87?source=collection_archive---------0-----------------------#2022-01-29">https://betterprogramming.pub/swiftui-app-theme-switch-241a79574b87?source=collection_archive---------0-----------------------#2022-01-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ba04" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">定制不仅仅是黑暗模式</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/26c27dc0c4a6e2b9c4086a5b9c3fc137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5LMbSfTQo_8x-Y88"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@steve_j?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯蒂夫·约翰森</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="98b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇短文将解释如何动态地改变SwiftUI应用程序的主题，以及使其工作所需的所有东西。</p><p id="083e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，让我们创建Xcode项目和资源，我们将在一个简单的视图上使用它们来演示暗/亮主题之间的切换，并检查系统是否正在使用暗/亮主题。</p><p id="18f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开Xcode，新建一个类似<code class="fe ls lt lu lv b">File-&gt; New -&gt; Project</code>的项目。选择iOS作为模板。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lw"><img src="../Images/360862c53cfbdc8f9aba91f0daea2745.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JHoImM35i27Hamx-I8SKWg.png"/></div></div></figure><p id="dbed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，创建您的标识符，并选择SwiftUI作为接口，Swift作为语言。</p><p id="b249" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建完项目后，让我们将视图组织到文件夹中，并添加一些颜色资源来区分亮暗模式。</p><p id="5e0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以首先在我们项目的根目录下创建一个名为<code class="fe ls lt lu lv b">Views</code>的文件夹，并将<code class="fe ls lt lu lv b">ContentView.swift</code>移动到其中。在同一个文件夹中创建一个新的<code class="fe ls lt lu lv b">HomeView.swift</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/7e5311504e4a03c8afea09f9ce1bd4fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*A2Wj1JPpCtpYAspZ3hNg6A.png"/></div></figure><p id="8120" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，让我们创建我们的颜色<code class="fe ls lt lu lv b">Assets</code>。点击资产，并在导航栏上点击右键- &gt;新建颜色集。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/9f61647714317ee5d341f12333bc7ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*hTnykHxjzxz6y0uGknQSoQ.png"/></div></figure><p id="7b20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们把新的颜色集命名为“Accent”。让我们再添加三组颜色，并命名为:</p><ul class=""><li id="cd5a" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr me mf mg mh bi translated"><code class="fe ls lt lu lv b">BackgroundColor</code></li><li id="4c3b" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated"><code class="fe ls lt lu lv b">BackgroundColorList</code></li><li id="b670" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated"><code class="fe ls lt lu lv b">ColorPrimary</code></li><li id="7281" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated"><code class="fe ls lt lu lv b">TextColorPrimary</code></li><li id="a395" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated"><code class="fe ls lt lu lv b">TextColorSecondary</code></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mn"><img src="../Images/f9cd3b70f2df059650d89fb5175f19e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jtmaf99qK5nkGUVCdKsqmA.png"/></div></div></figure><p id="67fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们创建了我们的颜色集之后，我们必须创建一个扩展来使用我们的自定义颜色和修改器。</p><p id="4640" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建文件夹<code class="fe ls lt lu lv b">Extensions</code>并添加<code class="fe ls lt lu lv b">Color.swift</code>扩展名。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/b1520a54cbb5bd947755fd8d2e541ab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*Pa0HY1EFRG53J8eHnh8UBA.png"/></div></figure><pre class="kg kh ki kj gt mp lv mq mr aw ms bi"><span id="75c7" class="mt mu iq lv b gy mv mw l mx my"><strong class="lv ir">extension</strong> Color {<br/> <strong class="lv ir">static</strong> <strong class="lv ir">var</strong> theme: Color  {<br/>   <strong class="lv ir">return</strong> Color("theme")<br/> }</span><span id="f4c0" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir"> static</strong> <strong class="lv ir">var</strong> BackgroundColor: Color  {<br/>   <strong class="lv ir">return</strong> Color("BackgroundColor")<br/> }</span><span id="8823" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir"> static</strong> <strong class="lv ir">var</strong> BackgroundColorList: Color  {<br/>   <strong class="lv ir">return</strong> Color("BackgroundColorList")<br/> }</span><span id="f55d" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir"> static</strong> <strong class="lv ir">var</strong> ColorPrimary: Color  {<br/>   <strong class="lv ir">return</strong> Color("ColorPrimary")<br/> }</span><span id="b51b" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir"> static</strong> <strong class="lv ir">var</strong> Accent: Color  {<br/>   <strong class="lv ir">return</strong> Color("AccentColor")<br/> }</span><span id="7435" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir"> static</strong> <strong class="lv ir">var</strong> TextColorPrimary: Color  {<br/>   <strong class="lv ir">return</strong> Color("TextColorPrimary")<br/> }</span><span id="2f0f" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir"> static</strong> <strong class="lv ir">var</strong> TextColorSecondary: Color  {<br/>   <strong class="lv ir">return</strong> Color("TextColorSecondary")<br/> }<br/>}</span></pre><p id="8524" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，让我们创建一个名为<code class="fe ls lt lu lv b">Fonts</code>的新文件夹，并将我们喜欢的字体复制/粘贴到其中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/32c9b87d1bd3b4f4ee43e8f13737561f.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*q4P4sZrsG9SITX-MGtgUZw.png"/></div></figure><p id="098d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另外，创建一个名为<code class="fe ls lt lu lv b">Utils</code>的新文件夹，并在其中添加<code class="fe ls lt lu lv b">Constants.swift</code>和<code class="fe ls lt lu lv b">UserDefaultsUtils.swift</code>类文件。这些将是我们获取和设置应用程序主题的单例类。</p><p id="66aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">Constants.swift</code>:</p><pre class="kg kh ki kj gt mp lv mq mr aw ms bi"><span id="f1df" class="mt mu iq lv b gy mv mw l mx my"><strong class="lv ir">import</strong> Foundation</span><span id="3bd2" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir">class</strong> Constants {<br/>  <strong class="lv ir">public</strong> <strong class="lv ir">static</strong> <strong class="lv ir">let</strong> DARK_MODE = “DARK_MODE”<br/>  <strong class="lv ir">public</strong> <strong class="lv ir">static</strong> <strong class="lv ir">let</strong> LIGHT_MODE = “LIGHT_MODE”<br/>}</span></pre><p id="e90c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">UserDefaultsutils.swift</code>:</p><pre class="kg kh ki kj gt mp lv mq mr aw ms bi"><span id="83fe" class="mt mu iq lv b gy mv mw l mx my"><strong class="lv ir">import</strong> Foundation</span><span id="9590" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir">class</strong> UserDefaultsUtils {</span><span id="6f49" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir">static</strong> <strong class="lv ir">var</strong> shared = UserDefaultsUtils()<br/> <strong class="lv ir">func</strong> setDarkMode(enable: Bool) {<br/><strong class="lv ir">   let</strong> defaults = UserDefaults.standard<br/>   defaults.set(enable, forKey: Constants.DARK_MODE)<br/> }</span><span id="2077" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir"> func</strong> getDarkMode() -&gt; Bool {<br/><strong class="lv ir">  let</strong> defaults = UserDefaults.standard<br/><strong class="lv ir">  return</strong> defaults.bool(forKey: Constants.DARK_MODE)<br/> }<br/>}</span></pre><p id="7cd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以让我们给我们的<code class="fe ls lt lu lv b">HomeView.swift</code>添加一些代码。</p><p id="f022" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们将添加一个环境变量来表示当前使用的系统配色方案。</p><p id="815d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二，我们将使用状态属性<code class="fe ls lt lu lv b">isDarkModeOn</code>来保存窗口的主题状态，并保存到<code class="fe ls lt lu lv b">UserDefaults</code>中以备后用。</p><pre class="kg kh ki kj gt mp lv mq mr aw ms bi"><span id="59ce" class="mt mu iq lv b gy mv mw l mx my">@Environment(\.colorScheme) private <strong class="lv ir">var</strong> colorScheme: ColorScheme<br/>@State <strong class="lv ir">private</strong> <strong class="lv ir">var</strong> isDarkModeOn = <strong class="lv ir">false</strong></span></pre><p id="dd14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来让我们添加两个函数:</p><ol class=""><li id="26da" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr na mf mg mh bi translated">用于设置应用程序打开时的主题</li><li id="0c8e" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr na mf mg mh bi translated">在切换时更改主题。</li></ol><pre class="kg kh ki kj gt mp lv mq mr aw ms bi"><span id="390d" class="mt mu iq lv b gy mv mw l mx my"><strong class="lv ir">func</strong> setAppTheme(){<br/>  //<strong class="lv ir">MARK: use saved device theme from toggle<br/>  </strong>isDarkModeOn = UserDefaultsUtils.shared.getDarkMode()<br/>  changeDarkMode(state: isDarkModeOn)</span><span id="f0a6" class="mt mu iq lv b gy mz mw l mx my">  //<strong class="lv ir">MARK: or use device theme<br/>  if</strong> (colorScheme == .dark)<br/>  {<br/>    isDarkModeOn = <strong class="lv ir">true<br/>  </strong>}</span><span id="aaed" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir">  else</strong>{<br/>    isDarkModeOn = <strong class="lv ir">false<br/>  </strong>}<br/>  changeDarkMode(state: isDarkModeOn)*/<br/>}</span><span id="e6a9" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir">func</strong> changeDarkMode(state: Bool){<br/>  (UIApplication.shared.connectedScenes.first <strong class="lv ir">as</strong>? <br/>  IWindowScene)?.windows.first!.overrideUserInterfaceStyle = state ?   .dark : .light<br/>  UserDefaultsUtils.shared.setDarkMode(enable: state)<br/>}</span></pre><p id="490a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后是我们的HomeView.swift body。</p><pre class="kg kh ki kj gt mp lv mq mr aw ms bi"><span id="e2da" class="mt mu iq lv b gy mv mw l mx my"><strong class="lv ir">var</strong> ToggleThemeView: <strong class="lv ir">some</strong> View {</span><span id="227b" class="mt mu iq lv b gy mz mw l mx my">Toggle("Dark Mode", isOn: $isDarkModeOn).onChange(of: isDarkModeOn) { (state)  <strong class="lv ir">in</strong></span><span id="e416" class="mt mu iq lv b gy mz mw l mx my">changeDarkMode(state: state)</span><span id="e7ea" class="mt mu iq lv b gy mz mw l mx my">}.labelsHidden()</span><span id="8ca0" class="mt mu iq lv b gy mz mw l mx my">}</span><span id="5201" class="mt mu iq lv b gy mz mw l mx my"><strong class="lv ir">var</strong> body: <strong class="lv ir">some</strong> View {<br/>  NavigationView {<br/>   ZStack {<br/>    Color.BackgroundColorList.edgesIgnoringSafeArea(.all)<br/>    VStack(alignment: .leading) {<br/>      Text("Switch   theme").foregroundColor(Color.TextColorSecondary).padding(10).font(F  ont.custom("Baloo-Regular", size: 15))<br/>      ToggleThemeView<br/> }<br/> .background(Color.BackgroundColorList)<br/> .font(Font.custom("Baloo-Regular", size: 20))<br/> .navigationBarTitle("", displayMode: .inline)<br/> .navigationBarItems(<br/> leading:<br/>   Text("DarkModeSwitch").font(Font.custom("Baloo-Regular", size: 20)))<br/>   .navigationBarBackButtonHidden(<strong class="lv ir">true</strong>)<br/>   foregroundColor(Color.TextColorPrimary)<br/>  }<br/> }<br/>  .background(Color.BackgroundColorList)<br/>  .navigationViewStyle(StackNavigationViewStyle())<br/>  .onAppear(perform: {<br/>  setAppTheme()<br/> })<br/>}</span></pre><p id="581f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，如果我们打开我们的应用程序，第一个主题将是光。我们可以切换到黑暗，或使用默认的设备主题。</p><div class="kg kh ki kj gt ab cb"><figure class="nb kk nc nd ne nf ng paragraph-image"><img src="../Images/cbc9cd9eca9f3ee715207c043035c284.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*OInbzzf4DJEOymkOrNx3ww.png"/></figure><figure class="nb kk nc nd ne nf ng paragraph-image"><img src="../Images/fdd94975ca0dba42c487d369ea3dbdcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*cRnuLdWPYLOsDSGfdlu9gw.png"/></figure></div><p id="f62d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样。该代码可以在GitHub存储库中找到:</p><div class="nh ni gp gr nj nk"><a href="https://github.com/kenagt/SwiftUI_DarkMode_Medium" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">GitHub-kenagt/swift ui _ dark mode _ Medium:swift ui黑暗模式主题开关，使用设备配色方案…</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">github.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny kp nk"/></div></div></a></div></div></div>    
</body>
</html>