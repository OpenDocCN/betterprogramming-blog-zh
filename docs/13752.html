<html>
<head>
<title>Building an Internet-Controllable LED Strip</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建可通过互联网控制的LED灯条</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-an-internet-controllable-led-strip-cdbe1c846cd5?source=collection_archive---------4-----------------------#2022-09-23">https://betterprogramming.pub/building-an-internet-controllable-led-strip-cdbe1c846cd5?source=collection_archive---------4-----------------------#2022-09-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a62e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">当你让你的同事控制你的照明时会发生什么</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f6f136a3a4e477ffea9ee4511b6b1822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-nzOfb0reeUxsM0Cv6LqMA.jpeg"/></div></div></figure><p id="cc03" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我想通过添加一些照明来美化我办公室的背景，我想有什么比可控的RGB LEDs更好的呢？我还认为让我的同事能够改变我的照明颜色会很有趣，而且可能很有意思——我想直到我们在会议中过于分心。</p><h1 id="5046" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">它是如何工作的</h1><p id="7adb" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">起初，我想做一个轮询方法，我会轮询服务器，看看最新的颜色选择是什么，然后在本地更新点星。我对这个想法的主要不满是，这种方法的效率会有多低，因为需要几秒钟才能看到反映出来的变化(对本地用户和其他潜在用户都是如此)。</p><p id="5ee1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我看来，最好的方法是使用WebSocket。这样，每个人都可以立即看到变化，消除任何延迟。这也简化了服务器端的设置，因为我只需要托管一个简单的WebSocket服务器，不需要数据库或路由。</p><p id="9d62" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用WebSocket，每当用户发送一种新颜色时，服务器接收该消息并验证该颜色，然后将其转播给其他WebSocket客户端，以便它们知道所选择的新颜色。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div><p class="mn mo gj gh gi mp mq bd b be z dk translated">显示系统如何工作的GIF</p></figure><h2 id="f758" class="mr lo iq bd lp ms mt dn lt mu mv dp lx la mw mx lz le my mz mb li na nb md nc bi translated">硬件设置</h2><p id="bf8f" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我选择的<a class="ae mk" href="https://www.adafruit.com/product/2240?length=1" rel="noopener ugc nofollow" target="_blank"> DotStar带</a>两端都带有JST SM连接器，所以我也购买了<a class="ae mk" href="https://www.adafruit.com/product/578" rel="noopener ugc nofollow" target="_blank">匹配连接器</a>，以便更容易地连接到我的设备。我在末端焊接并卷曲了母<a class="ae mk" href="https://www.mattmillman.com/why-do-we-call-these-dupont-connectors/" rel="noopener ugc nofollow" target="_blank">杜邦连接器</a>，这样我就可以很容易地从安装中移除设备，例如，如果我需要纠正一些代码的话。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/38cd4ade6a6f274f6ef1f9c53b243586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4OFzpff3PkigQYEsHEAD_Q.jpeg"/></div></div><p class="mn mo gj gh gi mp mq bd b be z dk translated">带有杜邦母接头的JST-SM连接器+焊接有公接头的D1 Mini</p></figure><p id="a67c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于DotStar支持<a class="ae mk" href="https://learn.sparkfun.com/tutorials/serial-peripheral-interface-spi/all" rel="noopener ugc nofollow" target="_blank"> SPI </a>，我选择了这种方式——阿达果<a class="ae mk" href="https://learn.adafruit.com/adafruit-dotstar-leds/python-circuitpython#python-computer-wiring-3004880" rel="noopener ugc nofollow" target="_blank">提到</a>这是首选方法，因为它比<a class="ae mk" href="https://circuitdigest.com/article/introduction-to-bit-banging-spi-communication-in-arduino-via-bit-banging" rel="noopener ugc nofollow" target="_blank"> bit-bang方法</a>更快。我用的是<a class="ae mk" href="https://diyi0t.com/esp8266-wemos-d1-mini-tutorial/" rel="noopener ugc nofollow" target="_blank"> D1迷你</a> ( <a class="ae mk" href="https://medium.com/@makvoid/experimenting-with-esp32-esp8266-microcontrollers-1a6e27ef15ca" rel="noopener"> ESP8266 </a>)，所以我把SCLK(黄色)接到了D5，把MOSI(绿色)接到了D7，但这将根据你使用的设备而有所不同。</p><h2 id="6b90" class="mr lo iq bd lp ms mt dn lt mu mv dp lx la mw mx lz le my mz mb li na nb md nc bi translated">电源要求</h2><p id="1835" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">由于我们有这么多的led，需要一个足够安培数的好电源，因为微控制器不会提供足够的电流。Adafruit <a class="ae mk" href="https://learn.adafruit.com/adafruit-dotstar-leds/power-and-connections#powering-dotstar-leds-3004522" rel="noopener ugc nofollow" target="_blank">建议</a>如果你在全白和全亮度的情况下，估计每颗星的峰值电流为60毫安。我购买的灯带总共有60个led，所以我最多只需要3.6A。</p><p id="21a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Adafruit销售一款<a class="ae mk" href="https://www.adafruit.com/product/352" rel="noopener ugc nofollow" target="_blank"> 12V 5A电源</a>，我将使用它为项目供电，但我们需要一个降压调节器将12V电源转换为5V，因为DotStars只接受5V电压。我在亚马逊上找到了这个<a class="ae mk" href="https://www.amazon.com/gp/product/B00J3MHT1E/" rel="noopener ugc nofollow" target="_blank">转换器</a>，到目前为止效果很好，如果需要的话，还会给我一些空间来添加额外的部分。Adafruit还出售一个<a class="ae mk" href="https://www.adafruit.com/product/368" rel="noopener ugc nofollow" target="_blank">螺丝终端适配器</a>，这样你就可以轻松地将你的电源连接到你的项目上，这也是我为这个项目挑选的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/a141de216f3ceac0e3e6dc8a37f2c842.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JN3WxvZxznOC4qWuenOHnA.jpeg"/></div></div><p class="mn mo gj gh gi mp mq bd b be z dk translated">12V至5V降压稳压器</p></figure><h2 id="c12b" class="mr lo iq bd lp ms mt dn lt mu mv dp lx la mw mx lz le my mz mb li na nb md nc bi translated">软件设置</h2><p id="f10f" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">正如我以前的一篇文章所提到的，我们能够在ESP8266上使用MicroPython，所以我选择在这个项目中再次使用它。对我来说幸运的是，已经为MicroPython创建了一个<a class="ae mk" href="https://github.com/danni/uwebsockets" rel="noopener ugc nofollow" target="_blank"> WebSocket库</a>和<a class="ae mk" href="https://github.com/mattytrentini/micropython-dotstar" rel="noopener ugc nofollow" target="_blank"> DotStar库</a>，所以我可以轻松地加载这些库，这大大加快了我的开发速度。</p><h2 id="0e79" class="mr lo iq bd lp ms mt dn lt mu mv dp lx la mw mx lz le my mz mb li na nb md nc bi translated">计算机网络服务器</h2><p id="67cb" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我使用Node.JS中的<a class="ae mk" href="https://www.npmjs.com/package/ws" rel="noopener ugc nofollow" target="_blank"> ws </a>库设置了一个简单的WebSocket服务器。使用<a class="ae mk" href="https://www.freedesktop.org/wiki/Software/systemd/" rel="noopener ugc nofollow" target="_blank"> systemd </a>，我将服务器设置为一个服务，这样它将无限期运行并为我们收集日志。当用户第一次连接时，服务器会转发上次选择的颜色，这样所有用户都会同步。因为只有我的微控制器将使用非安全服务器，所以来自该连接的消息不会转播到安全服务器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf mm l"/></div></figure><h2 id="1c44" class="mr lo iq bd lp ms mt dn lt mu mv dp lx la mw mx lz le my mz mb li na nb md nc bi translated">微控制器</h2><p id="ced2" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">该脚本首先处理网络连接和启动WebSocket客户端。它试图每五秒钟读取一条消息，如果由于某种原因服务器打嗝，它无法阻止它等待消息，它将超时。不管它是否收到消息，它还会向服务器发回一条空消息，以帮助保持连接，帮助发现任何连接问题，并在需要时重新连接。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf mm l"/></div></figure><h2 id="11e7" class="mr lo iq bd lp ms mt dn lt mu mv dp lx la mw mx lz le my mz mb li na nb md nc bi translated">用户界面</h2><p id="bade" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">用户界面非常简单，因为它没有做太多事情，所以我使用<a class="ae mk" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular </a>和<a class="ae mk" href="https://www.npmjs.com/package/ngx-color" rel="noopener ugc nofollow" target="_blank"> ngx-color </a>来提供颜色样本组件。它连接到同一个WebSocket服务器，获取所选的颜色，并将其转换为RGB值(因为这是DotStar最终使用的颜色)。这也使得验证更加容易，因为我们知道值只能是特定数字(0–255)之间的特定格式。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/14d2ffcf58b3d1e7192581d934ca0fd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*_TQ_1_VexsuMdq8dyO8Qaw.png"/></div><p class="mn mo gj gh gi mp mq bd b be z dk translated">色样显示给用户以帮助他们选择新的颜色</p></figure><h1 id="c7ed" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">结论</h1><p id="0ec6" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">虽然这个项目进行得很快，但它仍然非常有趣！这个项目有很大的扩展空间，比如混合颜色、图案、颜色历史等等。我会继续修改这个想法，但我很有兴趣听听你对此有什么想法！</p><h1 id="6ee4" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">资源</h1><ul class=""><li id="f89d" class="nh ni iq kt b ku mf kx mg la nj le nk li nl lm nm nn no np bi translated"><a class="ae mk" href="https://github.com/makvoid/Blog-Articles/tree/main/Interactive-LED-Strip" rel="noopener ugc nofollow" target="_blank">代码库</a></li></ul></div></div>    
</body>
</html>