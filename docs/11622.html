<html>
<head>
<title>How to Easily Extend Pylint With Plugins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用插件轻松扩展Pylint</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-easily-extend-pylint-with-plugins-d8ead26a68ac?source=collection_archive---------11-----------------------#2022-04-04">https://betterprogramming.pub/how-to-easily-extend-pylint-with-plugins-d8ead26a68ac?source=collection_archive---------11-----------------------#2022-04-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dc08" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为您的特定业务目标定制静态Python代码分析</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6e1292709028e99f63def4bfeeb87bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UNj2EKIYhasfEZ1c"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://unsplash.com/@paulando" rel="noopener ugc nofollow" target="_blank">保利乌斯·安德里库斯</a>在<a class="ae kv" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> unsplash </a>拍摄</p></figure><p id="2e45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">静态代码分析和林挺是软件开发成功的基础。python最常用的静态代码分析器之一是<code class="fe ls lt lu lv b">pylint</code></p><p id="89ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将向您展示使用Pylint的内置插件架构来扩展它是多么容易。</p><h1 id="4f9e" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">什么是静态代码分析？</h1><p id="5c0b" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">静态代码分析是在不运行代码的情况下自动评估代码质量的尝试，而动态代码分析是在运行时自动分析代码质量的尝试。</p><p id="b70a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以静态代码分析工具的输入要么是源代码本身，要么是它的字节码表示(如果存在的话)，而它的输出取决于我们要达到的目标。</p><h1 id="ef8f" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">什么是棉绒？</h1><p id="d769" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">Linters是静态代码分析器的一个子类型，旨在检测潜在的bug、错误、弊端和风格问题。</p><p id="34d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以像所有静态代码分析器一样，linters将源代码作为输入和输出，它提供了一个可疑代码语句的列表，开发者应该改进这些语句。</p><h1 id="7b99" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">什么是Pylint？</h1><p id="cd33" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">Pylint可以说是python编程语言中最流行的linter。</p><p id="7a26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于python是一种解释型语言，所以它没有编译时间。<br/>因此，没有内置的错误检测机制。<br/>林挺是python开发者在执行前验证代码的唯一方式。</p><p id="576a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除此之外，pylint执行样式检查以确保代码符合<a class="ae kv" href="https://peps.python.org/pep-0008/" rel="noopener ugc nofollow" target="_blank"> pep8 </a>。</p><h1 id="4853" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">动手示例</h1><p id="6042" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">让我们来看一个简短的代码示例:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="0d57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个非常简单的例子，它以写权限打开<code class="fe ls lt lu lv b">somefile.txt</code>，它将“hello world”写入文件。</p><p id="aac1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们运行这段代码:</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="2cfc" class="mz lx iq lv b gy na nb l nc nd">python example.py</span></pre><p id="eaac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们得到一个写着“hello world”的文件。</p><p id="d118" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们用pylint来lint这段代码，首先我们必须从PyPI仓库安装pylint:</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="a57b" class="mz lx iq lv b gy na nb l nc nd">pip install pylint</span></pre><p id="d81a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们在代码上运行<code class="fe ls lt lu lv b">pylint</code>:</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="83ea" class="mz lx iq lv b gy na nb l nc nd">pylint example.py</span></pre><p id="a723" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">输出:</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="9559" class="mz lx iq lv b gy na nb l nc nd">************* Module example<br/>example.py:1:0: C0114: Missing module docstring (missing-module-docstring)<br/>example.py:1:7: W1514: Using open without explicitly specifying an encoding (unspecified-encoding)<br/>example.py:1:7: R1732: Consider using 'with' for resource-allocating operations (consider-using-with)</span><span id="9005" class="mz lx iq lv b gy ne nb l nc nd">------------------------------------------------------------------<br/>Your code has been rated at 0.00/10 (previous run: 0.00/10, +0.00)</span></pre><p id="54ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们得到了3个提示:</p><p id="70a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1-没有模块docstring。<br/>这“只是”一个约定提示，对运行时没有影响，但是使用docstrings来确保代码的可通信性和可读性是非常重要的。</p><p id="61a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2-打开文件而不显式指定编码。<br/>默认编码是<a class="ae kv" href="https://en.wikipedia.org/wiki/UTF-8" rel="noopener ugc nofollow" target="_blank"> utf-8 </a>，但是没有明确指定编码可能会有问题。</p><p id="7690" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3 —重构建议在打开文件时使用<code class="fe ls lt lu lv b">with</code>语句，这实际上是至关重要的重构！<br/>在这段代码中，我使用了open语句而没有关闭文件，我有<a class="ae kv" href="https://en.wikipedia.org/wiki/Resource_leak" rel="noopener ugc nofollow" target="_blank">泄漏资源</a>的风险！</p><p id="0ce4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了这些错误，我的代码得了0分(满分10分)——是的，就是这么糟糕！</p><p id="4868" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以让我们快速重构代码来解决这3个问题</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="b9f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们lint这段代码:</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="da5b" class="mz lx iq lv b gy na nb l nc nd">pylint example.py</span></pre><p id="5463" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果是:</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="0aa6" class="mz lx iq lv b gy na nb l nc nd">--------------------------------------------------------------------<br/>Your code has been rated at 10.00/10 (previous run: 10.00/10, +0.00)</span></pre><p id="7944" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了！代码没有错误，分数是10/10！</p><h1 id="2590" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">用插件扩展pylint</h1><p id="5828" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">Pylint有一个插件架构，允许您轻松扩展它的功能。</p><p id="acb0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了演示这样一个插件的使用，让我们写一个简短的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="3cb3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个非常简单的脚本，有3个未使用的导入，我不想让pylint检查(因此提示pylint忽略未使用的导入错误)</p><p id="f561" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是正如您所看到的，我有2个来自sys模块的import语句，它们可以合并成一个。</p><p id="8ef4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们用pylint对这个文件进行lint:</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="b4eb" class="mz lx iq lv b gy na nb l nc nd">pylint ./app/__main__.py</span></pre><p id="0e65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">输出:</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="6c12" class="mz lx iq lv b gy na nb l nc nd">-------------------------------------------------------------------<br/>Your code has been rated at 10.00/10 (previous run: 8.57/10, +1.43)</span></pre><p id="1490" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">没有错误。</p><p id="6fd7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是因为pylint没有用于重复导入的检查器。</p><p id="9b11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以让我们创造一个我们自己的:)</p><p id="ed17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们需要创建一个插件模块:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="70c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我已经决定把它写在<code class="fe ls lt lu lv b">__init__.py</code>文件中，这样当模块被加载时代码就会运行。<br/><code class="fe ls lt lu lv b">register</code>函数由pylints的插件管理器识别，它用于将检查器注册到pylints的检查器列表中。</p><p id="038f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们创建我们的检查器，检查是否有来自导入的重复项:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="825c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Pylint checker有几个组件:</p><ol class=""><li id="0120" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated"><code class="fe ls lt lu lv b">msgs</code> —一个字典，其中的键是一个标准的pylint提示索引。<br/>提示索引以c(约定)、r(重构)、w(警告)、e(错误)、f(致命)开始，然后是不与任何其他<code class="fe ls lt lu lv b">pylint</code>数字冲突的4位数字。<br/>字典的值是3个元素的元组，即要显示的消息、消息查找名称和建议。</li><li id="68f0" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><code class="fe ls lt lu lv b">__init__</code>我们实例化一个集合的方法。</li><li id="d838" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">和<code class="fe ls lt lu lv b">astroid</code>协议方法。</li></ol><p id="fd2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">星形线是一个<a class="ae kv" href="https://en.wikipedia.org/wiki/Visitor_pattern" rel="noopener ugc nofollow" target="_blank">访问者</a>，他为每个节点类型都指定了钩子方法。<br/>每种节点类型有两种方法，要么是visit，要么是leave，通过格式:<code class="fe ls lt lu lv b">visit_&lt;node_type&gt;</code>或<code class="fe ls lt lu lv b">leave_&lt;node_type&gt;</code>来识别。</p><p id="ff3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如所料，当pylints解析器访问一个节点时调用visit方法，当它离开该节点时调用leave方法。</p><p id="ff2c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的例子中，我们有两个这样的方法:</p><ol class=""><li id="2d32" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated"><code class="fe ls lt lu lv b">leave_module</code> —每次当我们离开一个模块时，我们都希望清除这个集合，这样它就不会将聚集的内容从一个模块传递到另一个模块。</li><li id="46b3" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><code class="fe ls lt lu lv b">visit_importfrom</code> —这是验证发生的地方，当我们到达import from语句时，我们想要检查我们是否已经遇到了来自具有相同模块名称的语句的导入，并建议开发人员将两个导入语句合并成1个。<br/>我们将首先检查模块名是否在类的集合成员中，如果是，那么我们将发送一个类型为<code class="fe ls lt lu lv b">duplication-module-imports</code> <br/>的消息，否则将模块名添加到集合中并继续。<br/>这是我们选择一个集合的原因，因为它不允许重复，并且它具有常数[O(1)] <a class="ae kv" href="https://en.wikipedia.org/wiki/Time_complexity" rel="noopener ugc nofollow" target="_blank">时间复杂度</a>用于查找。</li></ol><p id="0b5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们需要使用pylints <code class="fe ls lt lu lv b">load-plugin</code>选项运行我们的插件<code class="fe ls lt lu lv b">pylint</code>。</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="9c14" class="mz lx iq lv b gy na nb l nc nd">set PYTHONPATH=.</span><span id="b636" class="mz lx iq lv b gy ne nb l nc nd">pylint --load-plugins pylint_plugins.duplicated_imports_plugin app\__main__.py</span></pre><p id="4c47" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果:</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="9a37" class="mz lx iq lv b gy na nb l nc nd">************* Module __main__<br/>app\__main__.py:6:0: W8801: Import from 'sys' module is duplicated (duplication-module-imports)</span><span id="a489" class="mz lx iq lv b gy ne nb l nc nd">-------------------------------------------------------------------<br/>Your code has been rated at 8.57/10 (previous run: 10.00/10, -1.43)</span></pre><p id="0f03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">酷！<code class="fe ls lt lu lv b">pylint</code>使用了插件提供的规则，检测到了我们想要它检测的错误！</p><p id="475f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们重构代码，合并重复的导入语句。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="7138" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">又是棉绒:</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="0cac" class="mz lx iq lv b gy na nb l nc nd">set PYTHONPATH=.</span><span id="d5bf" class="mz lx iq lv b gy ne nb l nc nd">pylint --load-plugins pylint_plugins.duplicated_imports_plugin app\__main__.py</span></pre><p id="4582" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果是:</p><pre class="kg kh ki kj gt mv lv mw mx aw my bi"><span id="a8cc" class="mz lx iq lv b gy na nb l nc nd">--------------------------------------------------------------------<br/>Your code has been rated at 10.00/10 (previous run: 10.00/10, +0.00)</span></pre><p id="fd54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">厉害！</p></div></div>    
</body>
</html>