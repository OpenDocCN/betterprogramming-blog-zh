<html>
<head>
<title>Create a Lightning Animation Using SpriteKit in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SwiftUI中的SpriteKit创建闪电动画</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/rain-lightning-animation-using-spritekit-in-swiftui-part-ii-837ee74f6bd3?source=collection_archive---------5-----------------------#2022-07-17">https://betterprogramming.pub/rain-lightning-animation-using-spritekit-in-swiftui-part-ii-837ee74f6bd3?source=collection_archive---------5-----------------------#2022-07-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ec7d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用SpriteKit药水在SwiftUI中创建闪电体验</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/14ac383522c8cbf8454db01f780dddb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VvUIw4OSMsT1wNab"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Johannes Plenio 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="d20d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个系列的第一部分可以在这里访问<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/rain-lightning-animation-using-spritekit-in-swiftui-part-1-️-e2cf489e5d25">。在开始给闪电编码之前，我们将尝试描绘一道闪电。每一个闪电都会发光，然后消失，大部分是一组锯齿状的线条。大多数情况下，闪电组是一组没有分支的锯齿状线条，很少会有分支。对于那些错过了第一部分的人来说，这里的</a>就是。</p><p id="5db4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们看看我们将如何使用SKScene来设置我们的螺栓节点。<br/>sk scene的坐标系大概如下图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/1fb64a9b5fd8a54034e4c514d593e02c.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*7UAdo4_f2b4hKXBHYsD1hw.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">坐标系</p></figure><p id="a8e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我相信你可能已经有了一些想法，我们将在哪里开始我们的闪电和结束我们的闪电。</p><p id="4702" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始吧！！！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="a7a9" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">拉博尔特⚡️</h2><p id="af3c" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">为了让闪电发生，我们需要从闪电开始。然后通过添加越来越多的螺栓使其更加真实。让我们编写第一个函数来创建螺栓。我们将该函数命名为<code class="fe my mz na nb b">addBolt</code>，该函数将接受2个输入<code class="fe my mz na nb b">currentPoint</code>和<code class="fe my mz na nb b">latestPoint</code>。<br/>我们将使用<code class="fe my mz na nb b">currentPoint</code>来设置绘图笔的位置。我们将使用<code class="fe my mz na nb b">latestPoint</code>来设置从<code class="fe my mz na nb b">currentPoint</code>到<code class="fe my mz na nb b">latestPoint</code>所画直线的端点。通过使用<code class="fe my mz na nb b">currentPoint</code>和<code class="fe my mz na nb b">latestPoint</code>我们得到螺栓路径。</p><p id="c307" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但这还不够，我们还需要划清界限。为此，我们将使用<code class="fe my mz na nb b">SKShapeNode</code>并将螺栓路径设置为<code class="fe my mz na nb b">SKShapeNode</code>。为了详细说明，我们将赋予形状节点一个<code class="fe my mz na nb b">glowWidth</code>和一个<code class="fe my mz na nb b">strokeColor</code>。一旦完成，我们将添加形状节点作为我们的SKScene的子节点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="f207" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">为螺栓生成随机点🎲</h2><p id="9adf" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">现在我们已经看到了如何创建一个螺栓节点。我们将看到如何为螺栓生成随机点，使它们看起来更进步，更真实。为此，我们将使用两个随机化器，一个用于螺栓长度，另一个用于下一个螺栓角度。</p><p id="0ab5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于螺栓角度，我将给出一些单位圆上的起始包信息- <br/>在单位圆中，对于任何角度θ，我们可以将坐标为(x，y)的单位圆上的点P表示为:</p><pre class="kg kh ki kj gt ne nb nf ng aw nh bi"><span id="4503" class="ma mb iq nb b gy ni nj l nk nl">y = sinθ<br/>x = cosθ</span></pre><p id="d0f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果这个圆不是单位圆，它的半径是r，我们就写</p><pre class="kg kh ki kj gt ne nb nf ng aw nh bi"><span id="9561" class="ma mb iq nb b gy ni nj l nk nl">y = r*sinθ<br/>x = r*cosθ</span></pre><p id="4059" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们不能保持一个固定的角度来生成(x，y)点，因为它看起来像一个镜像的曲折线。因此，我们将使用一个随机函数来生成下一个螺栓角度，而不是保持一个固定的角度，如下所示。</p><pre class="kg kh ki kj gt ne nb nf ng aw nh bi"><span id="4e0b" class="ma mb iq nb b gy ni nj l nk nl">let randomAngle = Double.random(in: -180..&lt;180)</span></pre><p id="b50e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们有了一个随机的角度，我们将生成我们的(x，y)点。同样和我们的角度一样，我们也必须随机化<strong class="ky ir">螺栓</strong>的长度。我们将保持随机数发生器的范围为最小值=5，最大值=30。</p><pre class="kg kh ki kj gt ne nb nf ng aw nh bi"><span id="6bf6" class="ma mb iq nb b gy ni nj l nk nl">let randomBoltLength = Double.random(in: 5..&lt;30)</span></pre><p id="fa32" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了得到我们的<strong class="ky ir"> x </strong>点，我们将把<code class="fe my mz na nb b">cos(randomAngle)</code>值与生成的<code class="fe my mz na nb b">randomBoltLength</code>相乘，并加上最后一个螺栓点的<strong class="ky ir"> x </strong>值<br/>为了得到我们的<strong class="ky ir"> y </strong>点，我们将需要一个相乘的<code class="fe my mz na nb b">randomBoltLength</code>和<code class="fe my mz na nb b">sin(randomAngle)</code>的正值，并从最后一个螺栓点的<strong class="ky ir"> y </strong>值中减去该值。为什么递减，因为就像我之前说的，在开始的时候，顶部的点会是<code class="fe my mz na nb b">UIScreenHeight</code>，随着我们往下走，它会递减。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="28ca" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">启动闪电⚡️</h2><p id="4ea9" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">至此，我们已经具备了启动闪电的所有必要功能。我们将创建输入参数为<code class="fe my mz na nb b">currentPoint</code>、<code class="fe my mz na nb b">isBranchNode</code>和<code class="fe my mz na nb b">currentIteration</code>的<code class="fe my mz na nb b">startLightning</code>函数。我们将递归地使用<code class="fe my mz na nb b">startLightning</code>函数来生成完整的闪电。该函数将有一个名为<code class="fe my mz na nb b">latestPoint</code>的变量，它将保存<code class="fe my mz na nb b">randomly generated bolt points</code>。另一个名为<code class="fe my mz na nb b">randomedBranchNode</code>的变量将被赋予一个0…100之间的随机整数值。我们稍后将回到这一点。</p><p id="ccd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在继续之前，我们将注释掉这部分<br/> <code class="fe my mz na nb b">self.addChild(rainEmitter)</code> <br/>，这样我们就可以完全专注于创建闪电。🙂</p><p id="badc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了使闪电渐进，我们将使用随机生成时间的<code class="fe my mz na nb b">asyncAfter</code>。</p><pre class="kg kh ki kj gt ne nb nf ng aw nh bi"><span id="b72d" class="ma mb iq nb b gy ni nj l nk nl">DispatchQueue.main.asyncAfter(deadline: .now() + Double.random(in: 0..&lt;0.03))</span></pre><p id="1dcb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">核心逻辑</strong> <br/>现在我们将设置递归逻辑，我们还将设置分支逻辑。这里作为一个基本检查，我们将检查闪电点<strong class="ky ir"> y </strong>是否越过小于0，这意味着闪电已经到达地面或完成。如果螺栓点<strong class="ky ir"> y </strong>没有达到或越过0值，那么我们将重复该函数调用。</p><p id="c663" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">分支逻辑</strong> <br/>一个闪电可以有多个分支。为了选择分支节点，我们将使用从<code class="fe my mz na nb b">randomedBranchNode</code>变量生成的值。如果<code class="fe my mz na nb b">currentIteration</code>和<code class="fe my mz na nb b">randomedBranchNode</code>持有相同的值，那么我们将再次调用<code class="fe my mz na nb b">startLightning</code>函数，其中<code class="fe my mz na nb b">isBranchNode</code>参数为真。对于分支节点，我们肯定不能不使用<code class="fe my mz na nb b">currentPoint</code>，因为它已经被非分支节点消耗了。如果它是一个分支节点，那么我们将不断更新一个名为<code class="fe my mz na nb b">lastBranchNodePoint</code>的变量。并且<code class="fe my mz na nb b">lastBranchNodePoint</code>将保存<code class="fe my mz na nb b">latestPoint</code>作为其值。下面是整个设置的简介。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/c0b22e717bb22bf1870db1f7916f96dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0J3QqLT5WroTykN5WAJuGQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">分支和不分支</p></figure><p id="7cf4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe my mz na nb b">startLightning</code>功能的最终功能如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="b8e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这一点上，最终的动画将看起来像下面的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/1992cb7f5e3b0fce18558acdf1792c0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/1*R5fiTXbi0PH0QLtXfOSKcQ.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在设置了闪电之后</p></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="205d" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">添加闪电闪光器和闪电闪光器🔦</h2><p id="25b2" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">为此，我们将使用<code class="fe my mz na nb b">SKAction</code>序列运行闪电闪光器和闪电闪光器动画。为了闪烁螺栓，我们将在重复时将SKScene的<code class="fe my mz na nb b">alpha</code>值从1切换到0.5。我们将这个函数称为<code class="fe my mz na nb b">boltFlasher</code>。该功能将以<code class="fe my mz na nb b">glowCount</code>作为其输入。<code class="fe my mz na nb b">glowCount</code>将是重复持续时间的因子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="84b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加完<code class="fe my mz na nb b">boltFlasher</code>后，我们将在<code class="fe my mz na nb b">startLightning</code>函数中再次调用这个函数，为<code class="fe my mz na nb b">glowCount</code>使用一个随机生成器。</p><pre class="kg kh ki kj gt ne nb nf ng aw nh bi"><span id="80b0" class="ma mb iq nb b gy ni nj l nk nl">let randomBlinkCounter = Int.random(in: 0...5)</span><span id="69a4" class="ma mb iq nb b gy no nj l nk nl">self.boltFlasher(glowCount: randomBlinkCounter)</span></pre><p id="6d37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在这一级别的最终动画将如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/39b4250396b0cf12e996e3cfc55e3553.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/1*zahcmklLXUYgAgwKZV6X3A.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">添加闪电图标动画后</p></figure><p id="e3cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们将添加闪电闪光器逻辑。<br/>为此我们将把SKScene的背景色从<code class="fe my mz na nb b">black</code>改为<code class="fe my mz na nb b">white</code>，其<code class="fe my mz na nb b">alpha</code>值为<strong class="ky ir"> 0.7 </strong>。我们也不会每次都做flash。如果我们这样做，看起来会很糟糕。因此，我们将使用<code class="fe my mz na nb b">currentIteration</code>计数来切换闪电闪烁动画，而不是每次都闪烁。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="cfd0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将添加下面的代码行添加闪电闪光器。<br/>在<strong class="ky ir"> 11 </strong>的倍数上，我们将增加闪电闪光器。</p><pre class="kg kh ki kj gt ne nb nf ng aw nh bi"><span id="fa2c" class="ma mb iq nb b gy ni nj l nk nl">if currentIteration % 11 == 0 {<br/>self.lightningFlasher(flashCount: 1)<br/>}</span></pre><p id="5188" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在这一级别的最终动画将如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/103f36ccad7ef8311bb493e63f6ac291.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/1*Tx00PzQ5e-E1zZTga9dScA.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">添加闪电动画后</p></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="ca7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你明白如何使用递归算法创建闪电效果，同时考虑闪电分支。在下一篇文章(第三部分)中，我们将把我们在第一部分创建的雨动画和我们刚刚创建的闪电动画连接起来。</p><p id="7e25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">谢谢你，祝你有美好的一天。❤</p></div></div>    
</body>
</html>