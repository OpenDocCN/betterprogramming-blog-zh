<html>
<head>
<title>Creating a Complete GitHub Workflow for Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Flutter创建完整的GitHub工作流</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/creating-a-complete-github-workflow-for-flutter-529f6bd7bb10?source=collection_archive---------3-----------------------#2022-05-31">https://betterprogramming.pub/creating-a-complete-github-workflow-for-flutter-529f6bd7bb10?source=collection_archive---------3-----------------------#2022-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0526" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建和测试你的Flutter应用的最快最简单的方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f90244525cf5570c46f1018cb83bd81f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l-2ZIAFjoE8lwp8ayeq5fQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/photo/woman-jumping-wearing-green-backpack-214574/" rel="noopener ugc nofollow" target="_blank"> Sebastian Voortman </a>在<a class="ae ky" href="https://www.pexels.com/" rel="noopener ugc nofollow" target="_blank"> Pexels </a>拍摄</p></figure><p id="70af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将展示如何设置一个简单易用的Flutter工作流，它将:</p><ul class=""><li id="7035" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">构建您的源代码</li><li id="5a9f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">运行单元测试</li><li id="cc0d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">上传代码覆盖率</li><li id="ef28" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">运行集成测试</li><li id="eeec" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">生成并上传APK文件</li><li id="7946" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">拍摄集成测试截图并上传文件</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="b9df" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">创建我们的Flutter示例应用程序</h2><p id="ee23" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在创建我们的工作流程之前，我们需要一个应用程序，现在，默认模板就足够了</p><p id="263c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个新的Flutter应用程序，并在android模拟器或物理设备上运行它。</p><p id="6dec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将我的项目命名为<code class="fe no np nq nr b">flutter_workflow_example</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/2de0d7583d5ee443729d37b159b8ed64.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*bkcz2GVaB3bHa765tORo7A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">颤振默认应用程序</p></figure><p id="94c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，创建一个新的GitHub存储库，并将所有代码推送到其中。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="9bd1" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">Git Hub操作</h2><p id="6afc" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">一个<a class="ae ky" href="https://docs.github.com/pt/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Action </a>是一个免费的CI/CD平台，允许为构建、测试、发布和许多其他完全与GitHub集成的可能性创建工作流。</p><p id="6421" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户可以在平台上协作地创建和共享新的动作，这是一种促进协作和代码重用的聪明而有效的方式。</p><p id="4aaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为你的Flutter应用程序创建一个GitHub动作是简单明了的，它可以在几秒钟内完成，所以让我们创建我们的工作流程，然后我将一步一步地解释它是如何工作的:</p><p id="02a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，创建<code class="fe no np nq nr b">.github/workflows/main.yml</code>文件，并将下面的代码粘贴到上面:</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="6fe1" class="mq mr it nr b gy nx ny l nz oa">name: Flutter Workflow<br/><br/>on: [push, workflow_dispatch]<br/>jobs:<br/>  build:<br/>    runs-on: macos-latest<br/>    steps:<br/>      - name: Checkout code<br/>        uses: actions/checkout@v3<br/><br/>      - name: Install Flutter<br/>        uses: subosito/flutter-action@v2<br/>        with:<br/>          flutter-version: '2.10.0'<br/>          channel: 'stable'<br/><br/>      - name: Install dependencies<br/>        run: flutter pub get</span></pre><p id="6f63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将它推送到您的存储库，它就完成了，您已经有了一个工作流。</p><p id="f12b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面我们可以看到推送后运行的工作流。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/1e75a41275640f37b80f10d1a5c0d0f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ss56YfqjepGZdJolPGpxpA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">回购主页中的Flutter工作流选项</p></figure><p id="ea57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它成功地完成了，干得好。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/a1618632d14396ca95aac892456c1dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AZCopv8lmQwQHj8scTcLqg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">工作流已执行并返回成功</p></figure><p id="4872" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就足够了，你的第一个行动是构建和测试你的代码，这就是所有的人，感谢您的阅读，并有一个伟大的一周，再见，下次见。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="68aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Ops，开个玩笑，要做的事情还有很多，那么，我们来一步一步的检查一下刚才做了什么。</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="8e58" class="mq mr it nr b gy nx ny l nz oa">name: Flutter Workflow</span></pre><p id="6c26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一行非常简单，<code class="fe no np nq nr b">name</code>属性将定义工作流标题，在有多个工作流的情况下，提供一个好的名称来很好地举例说明它应该做什么。</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="f5e7" class="mq mr it nr b gy nx ny l nz oa">on: [push, workflow_dispatch]</span></pre><p id="cef3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe no np nq nr b">on</code>属性将定义何时启动工作流，有多个选项可供选择，<code class="fe no np nq nr b">push</code>选项将使工作流在每次执行新的推送时运行，<code class="fe no np nq nr b">workflow_dispatch</code>选项允许直接从GitHub界面启动新的工作流。</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="760b" class="mq mr it nr b gy nx ny l nz oa">jobs:<br/>  build:</span></pre><p id="6d27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe no np nq nr b">jobs</code>部分定义了将在工作流程中执行的作业，在这种情况下，第一个作业名为<code class="fe no np nq nr b">build</code></p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="dea2" class="mq mr it nr b gy nx ny l nz oa">runs-on: macos-latest</span></pre><p id="a4b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一节将定义工作流中使用的机器类型，在我们的例子中，我使用的是安装了最新macOS的机器</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="e41f" class="mq mr it nr b gy nx ny l nz oa">steps:</span></pre><p id="495a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们将定义工作流的所有步骤，我们通常提供一个<code class="fe no np nq nr b">-name</code>和一个<code class="fe no np nq nr b">uses</code>或<code class="fe no np nq nr b">run</code>选项</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="61b2" class="mq mr it nr b gy nx ny l nz oa">- name: Checkout code<br/>  uses: actions/checkout@v3</span></pre><p id="b95d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第一步中，我们执行<a class="ae ky" href="https://github.com/actions/checkout" rel="noopener ugc nofollow" target="_blank">动作/检出</a>，这是一个负责检出工作流存储库代码的动作</p><p id="9bba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe no np nq nr b">-name</code>选项中定义的文本将在工作流执行中显示。</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="25a3" class="mq mr it nr b gy nx ny l nz oa">- name: Install Flutter<br/>  uses: subosito/flutter-action@v2<br/>  with:<br/>    flutter-version: '2.10.0'<br/>    channel: 'stable'<br/><br/>- name: Install dependencies<br/>  run: flutter pub get</span></pre><p id="87de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一个动作是<a class="ae ky" href="https://github.com/subosito/flutter-action" rel="noopener ugc nofollow" target="_blank">subosito/flutter-action</a>，它负责在我们的工作流中设置Flutter环境，注意我们可以定制Flutter版本并执行Flutter命令</p><p id="4f71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在下一节中使用其他操作，请随意访问他们的存储库并检查所有可用的选项</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="15c3" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">运行单元测试</h2><p id="d0e7" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">Flutter项目的默认模板包含带有非常简单的单元测试的<code class="fe no np nq nr b">test/test_widget.dart</code>文件，但是足以在我们的工作流中运行。</p><p id="9658" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将这一行添加到您的<code class="fe no np nq nr b">main.yml</code>中，并将其推送到存储库:</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="c5eb" class="mq mr it nr b gy nx ny l nz oa">- name: Run unit tests<br/>  run: flutter test --coverage</span></pre><p id="0911" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">命令<code class="fe no np nq nr b">flutter test</code>将运行单元测试，而<code class="fe no np nq nr b">--coverage</code>选项对于生成。lcov文件，我们将在后面的代码覆盖率报告中使用</p><p id="bdda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将这个变更推送到存储库之后，工作流将再次执行，但是这一次它将运行新的单元测试步骤:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/93b81bc03f3b7fab4a00a6f7e96c10c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Js5jf6hdlqunjf7qC8u-VQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">工作流中的单元测试步骤执行</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="f41d" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">创建代码覆盖率报告</h2><p id="d929" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">创建代码覆盖报告有很多方法，我将使用<a class="ae ky" href="https://about.codecov.io/" rel="noopener ugc nofollow" target="_blank"> Codecov </a>这是一个非常简单和完整的工具来处理代码覆盖信息。</p><p id="4f02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用您的GitHub凭证登录到<a class="ae ky" href="https://app.codecov.io/gh" rel="noopener ugc nofollow" target="_blank"> Codecov </a>并允许访问以搜索您的存储库。</p><p id="b393" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击<code class="fe no np nq nr b">Not yet setup</code>选项查看您最近创建的项目，然后单击<code class="fe no np nq nr b">setup repo</code>选项。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/56b750edc1cdbba5cd697ecdc6f652c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfdVtzJdj35UfnbTyhDLcQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尚未设置选项</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/3aaffa0cb27b94ff2ec32e50f9f73e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pOPOX0t885B8hYdNFpbpIw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我最近创建的项目</p></figure><p id="e529" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二步，我们将找到如下图所示的Codecov标记:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/0c3e825b0d9fa3a6968feeee6f487b02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*nQHebD5fiqz3NWGNfLfmaw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Codecov令牌</p></figure><p id="348d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在GitHub资源库页面，点击<code class="fe no np nq nr b">Settings</code>-&gt;-<code class="fe no np nq nr b">Secrets</code>-&gt;-<code class="fe no np nq nr b">Actions</code>，点击<code class="fe no np nq nr b">New repository secret</code>按钮</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/336a2ece337fe4d336d41f7b4613bd41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5BKm2ADJrXyU3acq5U3_OA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub的新秘密选项</p></figure><p id="8337" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，将<a class="ae ky" href="https://github.com/codecov/codecov-action" rel="noopener ugc nofollow" target="_blank"> codecov/action </a>添加到您的<code class="fe no np nq nr b">main.yml</code>文件中:</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="e512" class="mq mr it nr b gy nx ny l nz oa">- name: Upload to code coverage<br/>  uses: codecov/codecov-action@v1.2.2<br/>  with:<br/>    token: ${{secrets.CODECOV_TOKEN}}<br/>    file: coverage/lcov.info</span></pre><p id="5f5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">推送之后，管道将再次执行，但是这一次在运行您的单元测试之后，它将把覆盖信息上传到Codecov，并且它将生成一个新的覆盖报告。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/9979e4ce1f637be20301c233dee543ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n8fJVAtg7z0-V6ZW7jf1Mg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Codecov上载操作正在执行</p></figure><p id="d58b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">刷新Codecov门户，您将能够看到关于您的项目代码覆盖率的新报告和统计数据</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/11db98b3d4a2fff1fd08a0f279e39a6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3nOAurxJmzn3rsHLMUjo1w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码覆盖率报告和统计数据</p></figure><p id="3450" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Codecov项目的settings部分中，您将找到要添加到项目readme.md文件中的覆盖率徽章</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/9f4afc98ece8e6c8a41a7d3ea6e26728.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fgwoiHc_L-qDBjF5W0KQxQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Codecov徽章设置</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/e0df42a988e0c345a7d2a7b2fbf2a1d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*V633HV60_f9_jLzeCGtTdg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">readme.md文件中的代码覆盖率徽章</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="10cc" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">运行集成测试</h2><p id="d727" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">与单元测试不同，集成测试不会测试一段简单的代码，相反，他们会执行整个应用程序，并像测试用户一样进行测试，在我们的情况下，集成测试必须打开应用程序，点击加号按钮，并检查屏幕上的数字是否增加。</p><p id="a416" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，让我们创建我们的集成测试:</p><p id="44fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe no np nq nr b">pubspec.yaml</code>中添加<code class="fe no np nq nr b">integration_test</code>依赖关系</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="25d2" class="mq mr it nr b gy nx ny l nz oa">dev_dependencies:<br/>  integration_test:<br/>    sdk: flutter<br/>  flutter_test:<br/>    sdk: flutter</span></pre><p id="8180" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，向文件<code class="fe no np nq nr b">integration_test/app_test.dart</code>添加一个新的测试</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="ec60" class="mq mr it nr b gy nx ny l nz oa">import 'package:flutter_test/flutter_test.dart';<br/>import 'package:integration_test/integration_test.dart';<br/><br/>import '../lib/main.dart' as app;<br/><br/>void main() {<br/>  IntegrationTestWidgetsFlutterBinding.<em class="ol">ensureInitialized</em>();<br/>  group('end-to-end test', () {<br/>    testWidgets('tap on the floating action button, verify counter', (tester) async {<br/>      app.main();<br/>      await tester.pumpAndSettle();<br/>      <br/>      // Verify the counter starts at 0.<br/>      expect(find.text('0'), findsOneWidget);<br/>      <br/>      // Finds the floating action button to tap on.<br/>      final Finder fab = find.byTooltip('Increment');<br/><br/>      // Emulate a tap on the floating action button.<br/>      await tester.tap(fab);<br/><br/>      // Trigger a frame.<br/>      await tester.pumpAndSettle();<br/><br/>      // Verify the counter increments by 1.<br/>      expect(find.text('1'), findsOneWidget);<br/>    });<br/>  });<br/>}</span></pre><p id="d120" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Flutter提供了一种非常简单的方式来使用<a class="ae ky" href="https://chromedriver.chromium.org/home" rel="noopener ugc nofollow" target="_blank"> ChromeDriver </a>运行集成测试，我们可以按照<a class="ae ky" href="https://docs.flutter.dev/cookbook/testing/integration/introduction" rel="noopener ugc nofollow" target="_blank"> Flutter cookbook集成测试介绍</a>(我在上面的测试中得到的)使用它，但是在我们的例子中，我们将使用不同的东西，而不是使用假设备，我们将在我们的工作流中启动一个android仿真器，然后执行我们的测试。</p><p id="74d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们将使用<a class="ae ky" href="https://github.com/ReactiveCircus/android-emulator-runner" rel="noopener ugc nofollow" target="_blank">react ive circus/Android-emulator-runner</a>动作，提供我们项目的api级别，以及模拟器可用时要执行的集成测试脚本。</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="6647" class="mq mr it nr b gy nx ny l nz oa">- name: Run integration tests<br/>  uses: reactivecircus/android-emulator-runner@v1<br/>  with:<br/>    api-level: 29<br/>    script: flutter test integration_test</span></pre><p id="1f6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按下它后，我们可以在日志中看到仿真器的引导和测试的执行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/9648fc98b01271e04fc1044dc69c7b86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zSGIJjREzWjrdi0mxKc40A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">集成测试开始</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/163930b6e7156b4d7a306d53455f832b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lWGxSd0AZcToRh-g1hS6Wg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">集成测试成功执行</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="f386" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">构建和上传APK</h2><p id="ccbb" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">对于每个构建，都会生成一个Flutter APK文件，如果您想下载并安装在任何Android设备或仿真器上，您可以利用工作流并在构建中上传这个APK。</p><p id="673c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们首先需要对已经定义的suposito flutter动作运行<code class="fe no np nq nr b">flutter build apk</code>命令</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="5e87" class="mq mr it nr b gy nx ny l nz oa">- name: Install Flutter<br/>  uses: subosito/flutter-action@v2<br/>  with:<br/>    flutter-version: '2.10.0'<br/>    channel: 'stable'<br/>- run: flutter build apk</span></pre><p id="8228" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，添加<a class="ae ky" href="https://github.com/actions/upload-artifact" rel="noopener ugc nofollow" target="_blank">上传工件</a>动作，并提供APK物理路径</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="6d7b" class="mq mr it nr b gy nx ny l nz oa">- name: Upload APK<br/>  uses: actions/upload-artifact@v3<br/>  with:<br/>    name: release-apk<br/>    path: build/app/outputs/apk/release/app-release.apk</span></pre><p id="59ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在工作流执行日志中，我们可以看到上传操作的详细信息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/298d37a29a11e9e564b6f19a71d3b16a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5NW5e9djX-a7Okf22VKYSA.png"/></div></div></figure><p id="6e2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在作业执行的工件部分找到APK文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/5b2d70078078dd5c0b40a19e1ff6a98c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2C6DjfHjvNvrsd9FeQu_qQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作业摘要和上传的工件</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="7dba" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">参加测试截图</h2><p id="8898" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">为了在我们的集成测试中截屏，我们需要一个测试驱动程序，因此，将文件<code class="fe no np nq nr b">test_driver/main_test.dart</code>添加到您的项目中，并粘贴以下代码:</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="e987" class="mq mr it nr b gy nx ny l nz oa">import 'dart:io';<br/><br/>import 'package:integration_test/integration_test_driver_extended.dart';<br/><br/>Future&lt;void&gt; main() async {<br/>  try {<br/>    await integrationDriver(<br/>      onScreenshot: (String screenshotName, List&lt;int&gt; screenshotBytes) async {<br/>        final File image = await File('screenshots/$screenshotName.png').create(recursive: true);<br/><br/>        image.writeAsBytesSync(screenshotBytes);<br/>        return true;<br/>      },<br/>    );<br/>  } catch (e) {<br/>    print('onScreenshot - error - $e');<br/>  }<br/>}</span></pre><p id="5b35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们调整集成测试，以便在执行测试时获取屏幕截图:</p><p id="e445" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，将这条语句添加到<code class="fe no np nq nr b">main</code>方法的第一行</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="1af8" class="mq mr it nr b gy nx ny l nz oa">final binding = IntegrationTestWidgetsFlutterBinding();</span></pre><p id="b25d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将下面的<code class="fe no np nq nr b">takeScreenshot</code>方法添加到测试文件中</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="bad1" class="mq mr it nr b gy nx ny l nz oa">takeScreenshot(tester, binding, name) async {<br/>  if (Platform.<em class="ol">isAndroid</em>) {<br/>    try {<br/>      await binding.convertFlutterSurfaceToImage();<br/>    } catch (e) {<br/>      print("TakeScreenshot exception $e");<br/>    }<br/>    await tester.pumpAndSettle();<br/>  }<br/><br/>  await binding.takeScreenshot(name);<br/>}</span></pre><p id="aeed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你还需要导入<code class="fe no np nq nr b">dart.io</code>包</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="bf90" class="mq mr it nr b gy nx ny l nz oa">import 'dart:io';</span></pre><p id="f773" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以随时调用方法<code class="fe no np nq nr b">takeScreenshot</code>，我在下面的现有测试中添加了两次:</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="38a0" class="mq mr it nr b gy nx ny l nz oa">testWidgets('tap on the floating action button, verify counter', (tester) async {<br/>  app.main();<br/>  await tester.pumpAndSettle();<br/><br/>  // Verify the counter starts at 0.<br/>  expect(find.text('0'), findsOneWidget);<br/>  await takeScreenshot(tester, binding, 'shot-1');<br/><br/>  // Finds the floating action button to tap on.<br/>  final Finder fab = find.byTooltip('Increment');<br/><br/>  // Emulate a tap on the floating action button.<br/>  await tester.tap(fab);<br/><br/>  // Trigger a frame.<br/>  await tester.pumpAndSettle();<br/>  await takeScreenshot(tester, binding, 'shot-2');<br/><br/>  // Verify the counter increments by 1.<br/>  expect(find.text('1'), findsOneWidget);<br/>});</span></pre><p id="205e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，在操作脚本参数中，将其更改为执行以下新脚本:</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="db46" class="mq mr it nr b gy nx ny l nz oa">- name: Run integration tests<br/>  uses: reactivecircus/android-emulator-runner@v1<br/>  with:<br/>    api-level: 29<br/>    script: flutter drive --driver=test_driver/main_test.dart --target integration_test/app_test.dart</span></pre><p id="3130" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行集成测试，因此，启动仿真器或在本地连接一个物理设备，并执行上面的脚本来测试是否会生成屏幕截图。</p><p id="f06a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，但同样重要的是，添加代码将截图上传到工件部分</p><pre class="kj kk kl km gt nt nr nu nv aw nw bi"><span id="5c42" class="mq mr it nr b gy nx ny l nz oa">- name: Upload Screenshoots<br/>  uses: actions/upload-artifact@v3<br/>  with:<br/>    name: Test result screenshots<br/>    path: screenshots/*.png</span></pre><p id="ecf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在将它推送到存储库之后，我们可以检查工件部分，并查看截图zip文件，其中包含集成测试期间生成的所有截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/dbd2d03220c2679c2174b5ccb2a5b682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZvR5KlJSDQXiRNRy919kw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有测试结果截图的工件部分</p></figure><p id="c8cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下载文件，解压并检查结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/376f5e6ba4ea3142ff1bef5c6bf11fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1LJhErsfsWo0Nd7vN1aobA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">生成的screnshot文件</p></figure><p id="6f8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，我们完整的<code class="fe no np nq nr b">main.yml</code>文件必须如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">完整的main.yml文件</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="99c1" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">现在…就这样</h2><p id="80b4" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">如果你想检查我创建的项目，请随意将它<a class="ae ky" href="https://github.com/edsondiasalves/flutter_workflow_example" rel="noopener ugc nofollow" target="_blank">复制到我的GitHub页面</a>。</p><p id="7f49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有许多其他方法可以为Flutter设置工作流或管道，但是使用GitHub动作是免费的、简单的和快速的——我强烈推荐它。</p><p id="a344" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我真的希望它能对你的项目有所帮助，感谢你的阅读，下次再见。</p></div></div>    
</body>
</html>