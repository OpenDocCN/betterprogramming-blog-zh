<html>
<head>
<title>Deno: Create Your First Web Application in Oak</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Deno:在Oak中创建您的第一个Web应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deno-create-your-first-web-application-in-oak-884868f8b30e?source=collection_archive---------10-----------------------#2020-10-07">https://betterprogramming.pub/deno-create-your-first-web-application-in-oak-884868f8b30e?source=collection_archive---------10-----------------------#2020-10-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6761" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解Deno中的静态文件服务、路由和错误处理</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/06907692dbd3fef09af89c35078fc607.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3t_PtZtkEvOSn290A1j4mg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者照片。</p></figure><p id="96af" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">看起来，在大肆宣传之后，现在是一片寂静。然而，<a class="ae lr" href="https://deno.land/" rel="noopener ugc nofollow" target="_blank"> Deno </a>社区仍在快速发展，所以如果你有兴趣学习Deno的后端，现在正是时候。</p><p id="d7ed" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Deno出现在Node.js之后，node . js是Ryan Dahl创建的另一个JavaScript运行时。它内置于Rust中，支持TypeScript，默认情况下是安全的。</p><p id="2d84" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你想知道达尔为什么创建另一个图书馆吗？查看Deno和Node.js 之间的<a class="ae lr" href="https://medium.com/better-programming/deno-vs-node-js-key-differences-8b2f4f63e2c7" rel="noopener">关键区别。</a></p><p id="ff91" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">总之，在这篇文章中，你将学习如何用GitHub最流行的Deno框架<a class="ae lr" href="https://github.com/oakserver/oak" rel="noopener ugc nofollow" target="_blank"> Oak </a>来设置和创建一个web应用程序。由于Deno是面向服务器端的，我们将创建一个能够提供静态文件、提供API和处理错误的web应用。</p><p id="7bf8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了跟随和编码，你需要在你的计算机上安装Deno。查看官方文件中的<a class="ae lr" href="https://deno.land/#installation" rel="noopener ugc nofollow" target="_blank">安装指南，并遵循说明。</a></p><p id="4f7d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是我们将要构建的GitHub repo的完整版本。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0d09" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">设置环境</h1><p id="d7a5" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">所以首先在你的工作目录中，创建名为<code class="fe mw mx my mz b">src</code>和<code class="fe mw mx my mz b">public</code>的新文件夹。在<code class="fe mw mx my mz b">src</code>中，让我们创建一个名为<code class="fe mw mx my mz b">mod.ts</code>的新文件，它将是我们的主文件。</p><p id="ae0e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们使用TypeScript扩展的原因是Deno支持现成的TypeScript。这也是Node的主要优势之一。现在到编码部分。</p><p id="6076" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据Oak的文档，我们可以通过编写几行代码来创建一个非常简单的Hello World应用程序:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><ul class=""><li id="6ec7" class="nc nd iq kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated">我们通过使用URL作为来源从Oak导入<code class="fe mw mx my mz b">Application</code>。这是Deno中的标准实现。</li><li id="115f" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated">您也可以通过用<code class="fe mw mx my mz b">oak@v.6.3.0</code>替换Oak来使用特定版本的包。通过这种方式，您可以确保所有的依赖项都是兼容的，并且不包含任何重大更改。</li><li id="e9de" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated">导入后，我们创建一个<code class="fe mw mx my mz b">Application</code>的引用。</li><li id="ba78" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated">请记住，Oak的架构是基于中间件概念的。但稍后会详细介绍。</li><li id="6cc7" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated">现在，当我们使用<code class="fe mw mx my mz b">app.use()</code>时，它期望<code class="fe mw mx my mz b">ctx</code>作为第一个参数。<code class="fe mw mx my mz b">ctx</code>代表上下文，你可以在<a class="ae lr" href="https://github.com/oakserver/oak" rel="noopener ugc nofollow" target="_blank"> Oak的文档</a>中了解更多。</li><li id="d0c3" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated">上下文可以有不同的属性，比如<code class="fe mw mx my mz b">ctx.response</code>，其中我们可以在响应中发送一些东西(文本或静态文件)。</li><li id="96e3" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated">如果文件作为程序使用<code class="fe mw mx my mz b">app.listen()</code>方法运行，我们使用来自Deno标准库的<code class="fe mw mx my mz b">log</code>记录文本并监听给定的地址和端口。</li><li id="176a" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated">当在本地机器上导航到<code class="fe mw mx my mz b">http://localhost:8000/</code>时，您应该在浏览器中看到<code class="fe mw mx my mz b">Hello world!</code>消息。</li></ul><p id="5380" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，回到核心问题。什么是中间件？</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="14d0" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">解释中间件概念</h1><p id="1788" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">中间件只是一种特殊类型的功能，它运行在进入API的请求和从API出来的响应的中间。</p><p id="767b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当然，您的链中可以有多个中间件，但是它们应该以可预测的顺序执行。它们每个看起来都像这样:</p><pre class="kg kh ki kj gt nq mz nr ns aw nt bi"><span id="465b" class="nu ma iq mz b gy nv nw l nx ny">app.use(async (ctx, next) =&gt; {})</span></pre><ul class=""><li id="06fd" class="nc nd iq kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated">中间件总是返回一个承诺，所以它是异步的。</li><li id="a20c" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated">作为第一个参数，<code class="fe mw mx my mz b">ctx</code>是一个对象，它包括具有适当属性和方法的请求和响应对象。</li><li id="92de" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated">作为第二个参数(可选)，<code class="fe mw mx my mz b">next()</code>指示应用程序应该继续执行链中的其他中间件。</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="2d10" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">服务静态文件</h1><p id="d197" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">当然，在我们的应用程序中只显示“Hello World”文本是很无聊的。我们也可以提供HTML。</p><p id="519f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们创建一个你自己的或者从GitHub repo中复制一个并保存在文件夹中。命名为<code class="fe mw mx my mz b">index.html</code>。</p><p id="0fcb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了提供静态文件，我们可以创建一个中间件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="a731" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在中间件中，我们通过<a class="ae lr" href="https://en.wikipedia.org/wiki/Whitelisting" rel="noopener ugc nofollow" target="_blank">允许实体列表</a>的原则来提高安全性，这样就没有人能够使用其他恶意文件。Deno将只接受<code class="fe mw mx my mz b">fileWhiteList</code>数组中的文件。再往后，应该还有CSS，JavaScript文件，favicon等。</p><p id="c121" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果文件存在于数组中，我们将使用Oak的<code class="fe mw mx my mz b">send()</code>函数，该函数需要上下文、文件的文件路径和具有<code class="fe mw mx my mz b">root</code>属性的对象。</p><p id="fd12" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，这应该可以了。让我们通过运行<code class="fe mw mx my mz b">deno run src/mod.ts</code>命令来测试它。</p><p id="dc72" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">哎呦！之后，您将在控制台中看到以下权限错误:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/78b6511d3f85350a088300f0e48b5988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*94UJRnzwX7UMbTx0RGtfCw.png"/></div></div></figure><p id="1871" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">那是因为Deno牢记安全因素。您需要使用<code class="fe mw mx my mz b">--allow-net</code>标志授予应用程序网络访问权限，使用<code class="fe mw mx my mz b">--allow-read</code>标志授予文件系统读取权限:</p><pre class="kg kh ki kj gt nq mz nr ns aw nt bi"><span id="9fee" class="nu ma iq mz b gy nv nw l nx ny">deno run --allow-net --allow-read src/mod.ts</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5848" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">使用路由器中间件进行路由</h1><p id="31bc" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">在每个后端应用程序中，我们应该根据前端的请求应用端点来提供各种数据。现在，如果我们想将“Hello World”文本保留在主<code class="fe mw mx my mz b">/</code>路线上，该怎么办呢？</p><p id="a726" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为此，我们可以使用<code class="fe mw mx my mz b">Router</code>中间件。</p><p id="b49a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，让我们在<code class="fe mw mx my mz b">src</code>文件夹中创建一个名为<code class="fe mw mx my mz b">api.ts</code>的新文件。顾名思义，您可以在那里存储所有的API:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="e914" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们的路由中，我们使用了一个<code class="fe mw mx my mz b">GET</code>方法，并返回一个文本作为响应。简单吧？</p><p id="3867" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，回到我们的<code class="fe mw mx my mz b">mod.ts</code>文件，我们需要导入我们的API并使用路由器中间件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="d681" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe mw mx my mz b">app.use(api.routes())</code>告诉Deno通过我们的路由器包含所有路由(目前，我们只有一个)。下一行告诉Deno允许该路径的所有方法，比如<code class="fe mw mx my mz b">GET</code>、<code class="fe mw mx my mz b">POST</code>、<code class="fe mw mx my mz b">PUT</code>和<code class="fe mw mx my mz b">DELETE</code>。</p><p id="e142" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，如果您尝试运行应用程序(不要忘记权限)，您应该会在<code class="fe mw mx my mz b">/</code>端点上看到文本。但是坚持住。如果服务器出了问题，我们得到一个错误，该怎么办？我们如何处理这样的错误？</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="bec4" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">错误处理</h1><p id="b1f4" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">在Oak中，实现起来非常简单。我们需要:</p><ol class=""><li id="db59" class="nc nd iq kx b ky kz lb lc le ne li nf lm ng lq oa ni nj nk bi translated">添加用于处理错误的事件侦听器。</li><li id="face" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq oa ni nj nk bi translated">创建一个中间件，用于在发生错误时向客户端发送响应。</li></ol><p id="5da2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，在<code class="fe mw mx my mz b">mod.ts</code>中，让我们在文件的开头编写以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="59f5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在中间件本身，<code class="fe mw mx my mz b">await next()</code>是说如果没有错误发生，继续按顺序执行另一个中间件。否则，它将记录一条错误消息。</p><p id="cec2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当然，如果您愿意，可以根据错误代码随意定制处理方式。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="34b4" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">摘要</h1><p id="d18d" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">构建一个web应用程序非常简单，对吗？</p><p id="e25f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">只需几分钟，您就可以构建一个简单的web应用程序，并在此基础上进行改进和开发。</p><p id="db26" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我真的很喜欢Oak框架，因为它有一个适中的学习曲线，易于使用，默认情况下是安全的。虽然Deno社区有点小，而且到目前为止没有公司在使用Deno，但是每项技术都需要时间在市场上立足。</p><p id="c279" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>