<html>
<head>
<title>Site Reliability Engineering Best Practices for Data Pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据管道的现场可靠性工程最佳实践</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/site-reliability-engineering-best-practices-for-data-pipelines-44a78e91f6f0?source=collection_archive---------9-----------------------#2019-10-07">https://betterprogramming.pub/site-reliability-engineering-best-practices-for-data-pipelines-44a78e91f6f0?source=collection_archive---------9-----------------------#2019-10-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="28b1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以谷歌的方式管理生产数据管道</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/444e6cb69bc774bc606238f6e64744d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2Crp7X7nP7PxlfjEzcKEQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@jjying?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> JJ英</a>在<a class="ae ky" href="https://unsplash.com/s/photos/pipelines?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="cc93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，你们中的大多数人可能已经听说过站点可靠性工程的概念。如果没有，这里有一个简单的定义—</p><p id="0a42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你把操作当成一个软件问题时，你就会得到SRE。</p><p id="1cee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谷歌长期以来一直使用这些原则管理其生产系统。他们出版了几本关于这个主题的书:</p><ul class=""><li id="cc5f" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">网站可靠性工程:谷歌如何运行生产系统</li><li id="52e4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">站点可靠性工作手册:实施SRE的实用方法</li></ul><p id="a08d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将讨论《站点可靠性工作手册:实施SRE的实用方法》一书的第13章中讨论的最佳实践的摘要。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="91c1" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">数据管道</h1><p id="33c7" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">如今，我们在生产系统中运行各种类型的数据管道。</p><h2 id="1632" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated"><strong class="ak">数据转换/事件处理管道</strong></h2><ul class=""><li id="3e89" class="lv lw it lb b lc nj lf nk li oa lm ob lq oc lu ma mb mc md bi translated">提取、转换、加载(ETL)模型是数据处理中的一种常见模式:从源中提取数据，对其进行转换，并可能进行反规范化，然后将其“重新加载”为特定的格式。</li><li id="8025" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">转换阶段可以服务于各种用例，例如更改数据格式以添加或删除字段、聚合跨数据源的计算功能，以及对数据应用索引以使其具有更好的特征来服务于使用数据的作业。</li></ul><h2 id="33e1" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">机器学习管道</h2><p id="332a" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">机器学习(ML)应用程序用于各种目的，如帮助预测癌症，对垃圾邮件进行分类，以及为用户提供个性化的产品推荐。</p><p id="e297" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">典型地，ML系统具有以下阶段:</p><ul class=""><li id="d81a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">从更大的数据集中提取数据要素及其标注。</li><li id="b58e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">ML算法在提取的特征上训练模型。</li><li id="47c0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">该模型在一组测试数据上进行评估。</li><li id="71fa" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">该模型可供其他服务使用。</li><li id="b6ac" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">其他系统使用模型提供的响应做出决策。</li></ul><p id="2b5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了维护这些管道，这里有一些在书中讨论过的最佳实践。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="0aff" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">管道最佳实践</h1><p id="bed3" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">通常，在处理数据管道时，应遵循以下最佳实践。</p><h2 id="8d95" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">定义和衡量服务级别目标</h2><p id="134c" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">SRE实践基于一些重要的概念，如服务级别目标(SLO)、服务级别指标(SLI)和错误预算。</p><p id="c0d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于数据管道，我们可以考虑用以下约束来定义SLO。</p><p id="ae87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据新鲜度:</p><ul class=""><li id="3dbd" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">Y <em class="mj"> </em>【秒、日、分】中处理的数据的X%。</li><li id="301d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">最旧的数据不会早于Y <em class="mj"> </em>【秒、天、分】。</li><li id="6cc1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">管道作业已在Y <em class="mj"> </em>【秒、天、分钟】内成功完成</li></ul><p id="9938" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据正确性:</p><ul class=""><li id="3ee6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">很难定义。</li><li id="e897" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">对于数据接收，您可以比较源和目标。</li><li id="b9b8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">回顾性分析。例如，从管道输出数据提供坏数据或错误的小时数或天数。</li></ul><p id="fbe2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据隔离/负载平衡:</p><ul class=""><li id="0fac" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">数据段:高/中/低。</li><li id="44d7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">它可以使用不同的队列、硬件、网络层等来实现。</li><li id="1aea" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">端到端测量非常重要。</li><li id="0393" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">即使管道有几个阶段，建议测量端到端交付的SLO，而不是每个阶段。在每个阶段，SLO不会对客户价值产生太大影响。</li></ul><h2 id="f925" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated"><strong class="ak">依赖故障计划</strong></h2><ul class=""><li id="59c1" class="lv lw it lb b lc nj lf nk li oa lm ob lq oc lu ma mb mc md bi translated">一旦你定义了你的SLO，首先检查你是否没有过度依赖那些不能满足SLO的产品。</li><li id="1cea" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在谷歌，为了鼓励考虑到依赖性失败的管道开发，SREs实施了计划停机。</li><li id="1a67" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">即使是最好的产品也会出现故障和停机。</li><li id="58fb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">定期练习灾难恢复场景，以确保您的系统能够应对常见和不常见的故障。</li><li id="7e1a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">评估您的依赖性并尽可能自动化您的系统响应。</li></ul><h2 id="f77f" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated"><strong class="ak">创建和维护管道文件</strong></h2><ul class=""><li id="26e2" class="lv lw it lb b lc nj lf nk li oa lm ob lq oc lu ma mb mc md bi translated">精心编写和维护的系统文档可以帮助工程师可视化数据管道及其依赖性，理解复杂的系统任务，并有可能在停机时缩短停机时间。</li><li id="9517" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">这本书推荐了三种类型的文档。</li></ul><p id="2160" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.系统图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/73f7b6fd3c3d549c99f1e45af9021f9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*XiTZSU-EtUWbcYXXFFWR0w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例系统图</p></figure><p id="6c4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.流程文件:</p><ul class=""><li id="eabc" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">例如，如何将管道发布到生产中。</li><li id="8925" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">一旦记录了所有任务，就要寻找自动化的机会。</li></ul><p id="b1a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.剧本条目:</p><ul class=""><li id="7790" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">系统中的每个警报状况都应该有相应的行动手册条目，描述恢复步骤。</li></ul><h2 id="9a34" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">绘制您的开发生命周期</h2><p id="8e29" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">数据管道的开发周期应计划如下:</p><ul class=""><li id="17e2" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">原型制作。</li><li id="4c21" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">用1%的干运行进行测试。</li><li id="f5d9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">分期付款。</li><li id="f587" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">金丝雀。</li><li id="ad95" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">执行部分部署。</li><li id="53d7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">部署到生产环境。</li></ul><h2 id="b17a" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">减少热点和工作负载模式</h2><ul class=""><li id="db47" class="lv lw it lb b lc nj lf nk li oa lm ob lq oc lu ma mb mc md bi translated">当资源因过度访问而过载，导致操作失败时，就会发生热点。</li><li id="9242" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">为了避免热点，建议重新构造您的数据或访问模式，以平均分配负载。</li><li id="a5cd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">降低锁粒度以避免数据锁争用。</li></ul><h2 id="8467" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">实施自动缩放和资源规划</h2><ul class=""><li id="e457" class="lv lw it lb b lc nj lf nk li oa lm ob lq oc lu ma mb mc md bi translated">工作负载峰值很常见，如果您没有做好准备，可能会导致服务中断。</li><li id="0b9a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">自动缩放可以帮助您处理这些峰值。</li><li id="1f11" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">预测系统的未来增长并相应地分配容量，可以确保您的服务不会耗尽资源。</li></ul><h2 id="1654" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">遵守访问控制和安全策略</h2><p id="19f9" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">遵循以下隐私、安全和数据完整性原则:</p><ul class=""><li id="214e" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">避免在临时存储中存储个人身份信息(PII)。如果需要临时存储PII，请确保数据已正确加密。</li><li id="0af4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">限制对数据的访问。仅授予每个管道级从上一级读取输出数据所需的最低访问权限</li><li id="3c19" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">对日志和PII设置生存时间(TTL)限制。</li></ul><h2 id="9a8a" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">幂等和两相突变</h2><p id="4328" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">管道可以处理大量数据。当管道出现故障时，必须重新处理一些数据。您可以使用<em class="mj">幂等突变</em>设计模式来防止存储重复或不正确的数据</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/894f78bab0fafd729e73cb5b4b11fc67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8UJp6GlYW3peKxjSzYAgLw.png"/></div></div></figure><p id="6c9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，在进行数据摄取时，首先写入阶段表，只有当阶段表检查正确时，才将数据写入实际表。</p><h2 id="e3c4" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">实现检查点</h2><ul class=""><li id="d4ed" class="lv lw it lb b lc nj lf nk li oa lm ob lq oc lu ma mb mc md bi translated">检查点是一种技术，它使长时间运行的流程(如管道)能够定期将部分状态保存到存储中，以便它们可以在以后恢复该流程。</li><li id="9ae1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">虽然检查点通常用于失败的情况，但它在任务需要被抢占或重新调度时也很有用。</li><li id="0fc1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">检查点还有一个额外的好处，它使管道能够跳过潜在的昂贵的读取或计算，因为它已经知道工作已经完成。</li></ul></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="e3a5" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">参考</h1><ul class=""><li id="aa28" class="lv lw it lb b lc nj lf nk li oa lm ob lq oc lu ma mb mc md bi translated"><a class="ae ky" href="https://landing.google.com/sre/books/" rel="noopener ugc nofollow" target="_blank">网站可靠性工程:谷歌如何运行生产系统</a></li><li id="01c1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://www.amazon.com/Site-Reliability-Workbook-Practical-Implement/dp/1492029505" rel="noopener ugc nofollow" target="_blank">网站可靠性工作手册:实施SRE的实用方法</a></li><li id="b86e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://landing.google.com/sre/workbook/chapters/data-processing/" rel="noopener ugc nofollow" target="_blank">第13章—数据处理</a></li></ul></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="b715" class="no ms it og b gy ok ol l om on">Hey, if you enjoyed this story, check out <a class="ae ky" href="https://deshpandetanmay.medium.com/membership" rel="noopener">Medium Membership</a>! Just $5/month!</span><span id="f0ce" class="no ms it og b gy oo ol l om on"><em class="mj">Your membership fee directly supports me and other writers you read. You’ll also get full access to every story on Medium.</em></span></pre></div></div>    
</body>
</html>