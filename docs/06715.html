<html>
<head>
<title>Using Envoy Proxy to Improve Reliability, Security, and Observability of Microservices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Envoy代理提高微服务的可靠性、安全性和可观察性</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-envoy-proxy-to-improve-reliability-security-and-observability-of-microservices-85032e08d3f4?source=collection_archive---------2-----------------------#2020-10-28">https://betterprogramming.pub/using-envoy-proxy-to-improve-reliability-security-and-observability-of-microservices-85032e08d3f4?source=collection_archive---------2-----------------------#2020-10-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6d84" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在您的堆栈中开始使用Envoy</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a5f99c672663ff250ad7457cc95575a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kGq6hhDYzOqJlrsaqhItJw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片鸣谢:<a class="ae ky" href="https://www.envoyproxy.io" rel="noopener ugc nofollow" target="_blank">https://www . envoy proxy . io</a></p></figure><p id="35d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.envoyproxy.io" rel="noopener ugc nofollow" target="_blank"> Envoy </a>是Lyft创建的一个开源代理。随着世界朝着分布式微服务架构的方向发展，从业者在两个主要领域观察到运行操作的困难:</p><ul class=""><li id="92ae" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">建立工作关系网</li><li id="037a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">可观察性</li></ul><p id="7ae9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Envoy试图通过使网络对应用程序更加透明来解决这些问题。它还提供了一种更好地收集统计数据的方法，以便更容易地调试和跟踪问题。</p><p id="21a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，最常见的部署特使代理的方式是将应用程序作为一个边车。万一你不知道边车模式，那么你可以在<a class="ae ky" href="https://medium.com/better-programming/modern-day-architecture-design-patterns-for-software-professionals-9056ee1ed977#4c49" rel="noopener">我以前的文章</a>中读到它。</p><p id="e325" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将讨论如何通过DIY教程开始使用Envoy代理，以及如何使用Envoy的各种功能来提高应用程序的可靠性、安全性和可观察性。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="b225" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">特使介绍</h1><p id="abf9" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">特使是一个独立的过程。当远程客户端调用特使代理时，请求会通过各种特使模块。让我们试着去理解这些。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/7fb9afd9ebac1453ee5db25385aa0f80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GCPmtneaopIRx15N2ISNng.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">特使代理(图片由作者提供)</p></figure><ul class=""><li id="e533" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">下游— </strong>连接到特使的远程客户端</li><li id="af00" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">监听器</strong>—负责接受新连接和绑定IP/端口的特使模块。</li><li id="1732" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">过滤器</strong> —负责处理请求的特使模块。一个请求可能需要通过一连串的过滤器。</li><li id="e0f8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">上游</strong> —端点特使将请求转发给。在sidecar模型中，这是一个应用程序或一群应用程序/服务。</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="0e98" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">行动中的特使</h1><p id="2ea9" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated"><a class="ae ky" href="https://www.envoyproxy.io/docs/envoy/latest/start/start" rel="noopener ugc nofollow" target="_blank">特使网站</a>列出了各种Docker图片样本，自己试试。在本教程中，我试图将Envoy放在一个示例REST API前面。如果你不想在Docker容器中使用Envoy，那么你可以简单地从<a class="ae ky" href="https://www.getenvoy.io/" rel="noopener ugc nofollow" target="_blank">https://www.getenvoy.io/</a>获得二进制文件。</p><p id="96c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我正在使用来自Spring Boot的现成服务，它将作为我的主要应用/微服务。</p><p id="4592" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您运行下面给出的命令时，您应该能够看到工作的API。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="6d3d" class="nt mr it np b gy nu nv l nw nx">java -jar -d complete/target/rest-service-0.0.1-SNAPSHOT.jar</span><span id="5ad4" class="nt mr it np b gy ny nv l nw nx">$curl http://localhost:8080/greeting</span><span id="4e92" class="nt mr it np b gy ny nv l nw nx">{"id":2,"content":"Hello, World!"}</span></pre><p id="7a3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您需要编写如下所示的特使代理配置YAML:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="13fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种配置规定了以下事项:</p><ul class=""><li id="e58c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">它在端口8585上创建一个HTTP侦听器。</li><li id="e811" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">它创建了一个过滤器链，试图将任何请求与<code class="fe ob oc od np b">/greeting</code>请求匹配，并将其转发给<code class="fe ob oc od np b">greetingservice</code>集群。</li><li id="31a0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在<code class="fe ob oc od np b">greetingservice</code>集群中，有一个端点将请求重定向到<code class="fe ob oc od np b">0.0.0.0:8080.</code></li><li id="cecc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在集群包含多个端点的情况下，<code class="fe ob oc od np b">greetingservice</code>集群预计会使用<code class="fe ob oc od np b">ROUND_ROBIN</code>技术对请求进行负载平衡。</li><li id="2257" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">它在端口9901上运行特使管理服务。</li></ul><p id="2d16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我使用Get Envoy版本1.15.0来做这个练习。以下命令将使用上面给出的配置启动特使代理。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="e039" class="nt mr it np b gy nu nv l nw nx">$getenvoy run standard:1.15.0 -- --config-path simple.yaml</span></pre><p id="c5cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当你点击<code class="fe ob oc od np b"><a class="ae ky" href="http://localhost:8585/greeting," rel="noopener ugc nofollow" target="_blank">http://localhost:8585/greeting</a></code>时，你会看到Envoy开始充当你原来的问候服务的代理。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="e35a" class="nt mr it np b gy nu nv l nw nx">curl http://localhost:8585/greeting</span><span id="d495" class="nt mr it np b gy ny nv l nw nx">{"id":6,"content":"Hello, World!"}</span></pre><p id="7ee0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还应该能够访问<code class="fe ob oc od np b">http://localhost:9901/</code>上的特使管理门户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/6498e178fc0345b6e46737f4f988b252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l6ScRjypjEE1uVE4KvJCYg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">特使管理门户</p></figure><p id="5381" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有管理服务也可以作为API使用。</p><p id="6fa0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您转到<code class="fe ob oc od np b">http://localhost:9901/stats</code>，您应该能够看到关于这个代理服务的请求的大量信息。</p><p id="2de1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果你想知道:</p><ul class=""><li id="a7bb" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">总连接数</li><li id="ae5f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">销毁的连接总数</li><li id="6163" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">活动连接总数</li><li id="64b5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">为各种请求提供的HTTP响应</li><li id="8f42" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">等等。</li></ul><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="a1bd" class="nt mr it np b gy nu nv l nw nx">listener.0.0.0.0_8585.downstream_cx_active: 2<br/>listener.0.0.0.0_8585.downstream_cx_destroy: 4<br/>listener.0.0.0.0_8585.downstream_cx_total: 6<br/>listener.0.0.0.0_8585.downstream_pre_cx_active: 0<br/>listener.0.0.0.0_8585.downstream_pre_cx_timeout: 0<br/>listener.0.0.0.0_8585.http.ingress.downstream_rq_1xx: 0<br/>listener.0.0.0.0_8585.http.ingress.downstream_rq_2xx: 3<br/>listener.0.0.0.0_8585.http.ingress.downstream_rq_3xx: 0<br/>listener.0.0.0.0_8585.http.ingress.downstream_rq_4xx: 2<br/>listener.0.0.0.0_8585.http.ingress.downstream_rq_5xx: 0<br/>listener.0.0.0.0_8585.http.ingress.downstream_rq_completed: 5<br/>listener.0.0.0.0_8585.no_filter_chain_match: 0</span></pre><p id="8734" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过在同一台主机上将Docker作为一个容器运行，也可以获得相同的结果。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="f35e" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">特使功能</h1><p id="2496" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">现在您已经知道如何使用Envoy运行基本代理，让我们来看看一些关键特性:</p><ul class=""><li id="0252" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">贮藏</li><li id="34da" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">故障注入</li><li id="4249" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">外部授权</li><li id="e2e9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">断路</li><li id="3c98" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">统计、访问日志记录和跟踪</li><li id="c187" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">安全性</li></ul><h2 id="1255" class="nt mr it bd ms of og dn mw oh oi dp na li oj ok nc lm ol om ne lq on oo ng op bi translated">贮藏</h2><p id="7043" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">像典型的反向代理一样，Envoy允许缓存响应。如果您知道某些对象不经常更改，那么您可以使用此过滤器。</p><p id="15a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它允许您实现各种缓存技术，如下所示:</p><ul class=""><li id="58ec" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe ob oc od np b">no-cache</code> —在这种情况下，缓存将在处理请求之前向原始服务器发送验证请求。</li><li id="6411" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe ob oc od np b">private</code> —在这种情况下，响应被标记为私有，它不应该存储在公共/共享缓存中。</li><li id="f8bd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe ob oc od np b">valid-for-time</code> —在这种情况下，在从原始服务器重新验证响应之前，响应会在缓存中保持新鲜一段时间。</li></ul><p id="bc0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过实现缓存，您可以改善微服务的响应延迟。这确实需要用应用程序/业务逻辑进行硬编码。</p><h2 id="ffdc" class="nt mr it bd ms of og dn mw oh oi dp na li oj ok nc lm ol om ne lq on oo ng op bi translated">故障注入</h2><p id="a3ec" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">如果你听说过<a class="ae ky" href="https://medium.com/better-programming/why-every-software-developer-needs-to-learn-chaos-engineering-ef08992f4354" rel="noopener">混沌工程</a>，你就会知道故障注入是测试微服务弹性的技术之一。</p><p id="3d78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Envoy的运行时允许注入延迟，中止具有指定用户响应的服务请求。这有助于在出现问题、故障或过载的情况下测试服务的能力。它可以被限制到一组特定的上游服务，而无需修改应用程序代码。</p><p id="1f33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以创建一个虚拟文件系统(<code class="fe ob oc od np b">/etc/config/v1</code>)，Envoy可以使用它来动态挑选故障注入配置。以下是这种配置的一个示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="cf0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Envoy stats还使您能够给出关于注入的错误的细节，以便了解应用程序的行为。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="2f7e" class="nt mr it np b gy nu nv l nw nx">http.ingress_http.fault.aborts_injected: 6<br/>http.ingress_http.fault.active_faults: 0<br/>http.ingress_http.fault.delays_injected: 0<br/>http.ingress_http.fault.faults_overflow: 0<br/>http.ingress_http.fault.response_rl_injected: 0</span></pre><h2 id="e2ca" class="nt mr it bd ms of og dn mw oh oi dp na li oj ok nc lm ol om ne lq on oo ng op bi translated">外部授权</h2><p id="f538" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">您可以使用Envoy将请求授权委托给外部授权服务器。如果您使用Envoy作为辅助工具，这很容易帮助将应用程序业务逻辑从您使用的授权服务器中分离出来。</p><p id="2967" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你熟悉开放策略代理，这里有一个<a class="ae ky" href="https://www.openpolicyagent.org/docs/latest/envoy-authorization/" rel="noopener ugc nofollow" target="_blank">很好的例子</a>，展示了如何使用这个特性。</p><h2 id="23ca" class="nt mr it bd ms of og dn mw oh oi dp na li oj ok nc lm ol om ne lq on oo ng op bi translated">断路</h2><p id="8761" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在我的上一篇文章中，我谈到了<a class="ae ky" href="https://medium.com/better-programming/modern-day-architecture-design-patterns-for-software-professionals-9056ee1ed977#4c75" rel="noopener">断路器</a>模式，它可以用来自动识别服务降级或服务中断，并开始从代理本身返回响应，而不是耗尽原始服务资源。</p><p id="088a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前，Envoy支持基于以下参数的断路:</p><ul class=""><li id="9e6b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">最大集群连接数</li><li id="35ef" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">最大挂起请求数</li><li id="31e5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">最大请求数</li><li id="fb9b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">最大重试次数</li><li id="de33" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">每个群集的最大连接池数量</li><li id="df73" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">等等。</li></ul><p id="efd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果达到任何阈值，那么特使打开电路。可以使用如下所示的统计数据监控电路开路:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="1855" class="nt mr it np b gy nu nv l nw nx">cluster.local_service.circuit_breakers.default.cx_open: 0<br/>cluster.local_service.circuit_breakers.default.cx_pool_open: 0<br/>cluster.local_service.circuit_breakers.default.rq_open: 0<br/>cluster.local_service.circuit_breakers.default.rq_pending_open: 0<br/>cluster.local_service.circuit_breakers.default.rq_retry_open: 0<br/>cluster.local_service.circuit_breakers.high.cx_open: 0<br/>cluster.local_service.circuit_breakers.high.cx_pool_open: 0<br/>cluster.local_service.circuit_breakers.high.rq_open: 0<br/>cluster.local_service.circuit_breakers.high.rq_pending_open: 0<br/>cluster.local_service.circuit_breakers.high.rq_retry_open: 0</span></pre><h2 id="870e" class="nt mr it bd ms of og dn mw oh oi dp na li oj ok nc lm ol om ne lq on oo ng op bi translated">统计、访问日志记录和跟踪</h2><p id="4faa" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">正如我前面提到的，Envoy不断发布大量的统计数据，使网络变得易于理解。它发出三种类型的统计数据</p><ul class=""><li id="dab2" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">上游统计</li><li id="a63a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">下游统计</li><li id="1f58" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">服务器统计</li></ul><p id="c77a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有些过滤器，如HTTP连接管理器，支持可扩展的访问日志记录。您可以使用像file或gRPC访问日志接收器这样的接收器来捕获访问日志。</p><p id="5a92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Envoy支持本地和外部的跟踪提供者，如Jaeger、LightStep、Zipkin等。分布式跟踪对于分布式微服务架构师理解服务流、延迟、序列化等非常重要。</p><p id="fb77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总的来说，这些特性提高了应用程序/服务的可观察性。</p><h2 id="2da9" class="nt mr it bd ms of og dn mw oh oi dp na li oj ok nc lm ol om ne lq on oo ng op bi translated">安全性</h2><p id="4653" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">像许多其他代理一样，Envoy可以用来提高应用程序的整体安全性。它支持如下各种过滤器:</p><ul class=""><li id="efd9" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank"> CORS滤波</a></li><li id="d1c7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://owasp.org/www-community/attacks/csrf" rel="noopener ugc nofollow" target="_blank"> CSRF滤波</a></li><li id="ed6f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/rbac/v3/rbac.proto" rel="noopener ugc nofollow" target="_blank">基于角色的访问控制(RBAC) </a></li><li id="7ec0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/oauth2/v3alpha/oauth.proto.html" rel="noopener ugc nofollow" target="_blank"> OAuth </a></li><li id="f8b9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">等等。</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="4133" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="bc45" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">特使代理是一个很好的工具，正在被广泛采用。有很多基于Envoy的<a class="ae ky" href="https://www.envoyproxy.io/community" rel="noopener ugc nofollow" target="_blank">开源和商业项目</a>。有很多Envoy支持的很酷的过滤器，您可能想探索和使用。</p><p id="8dca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有些人可能会说，我们可以使用一些现有的工具，甚至使用内置的语言框架来实现这一点，那么为什么要使用Envoy呢？这是一个公平的论点。我认为Envoy的最大用途是在运行遗留应用程序的企业中。通过将Envoy用作侧边代理或前端代理，您可以轻松地提高几乎任何(旧/新)应用程序的安全性、可靠性和可观察性，甚至无需接触应用程序代码。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="7fd5" class="nt mr it np b gy nu nv l nw nx">Hey, if you enjoyed this story, check out <a class="ae ky" href="https://deshpandetanmay.medium.com/membership" rel="noopener">Medium Membership</a>! Just $5/month!</span><span id="f0ce" class="nt mr it np b gy ny nv l nw nx"><em class="oq">Your membership fee directly supports me and other writers you read. You’ll also get full access to every story on Medium.</em></span></pre></div></div>    
</body>
</html>