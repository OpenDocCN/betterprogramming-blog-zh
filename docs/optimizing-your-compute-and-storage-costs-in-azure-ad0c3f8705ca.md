# 在 Azure 中优化您的计算和存储成本

> 原文：<https://betterprogramming.pub/optimizing-your-compute-and-storage-costs-in-azure-ad0c3f8705ca>

## 在 Azure 中省钱的策略

![](img/093ecd55ff3bd4c70639e835af95432e.png)

在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上由[Towfiqu barb huya](https://unsplash.com/@towfiqu999999?utm_source=medium&utm_medium=referral)拍摄的照片

# 介绍

云计算不再是软件世界的热门话题。现在，它是一种古老但久经考验的应用程序开发、部署和维护方法。云已经成为组织创造价值和更快实现业务成果的使能因素。每个大型组织都有云采用战略，其中一个支柱是**成本节约**。在传递价值和实现目标的竞赛中，它成为战略中最容易被忽视的部分，直到一位高管问道，“*我们为什么要支付这么多钱*？”。

如果你看到一个水龙头开着，却没有人在使用从里面流出来的水，你会怎么做？你的本能会是关掉它，以免浪费水。想象一下，一个运行在云中的虚拟机没有被任何人使用。我可以向你保证；它会继续运行并被浪费掉。从水龙头流出的水非常明显，而运行在云中的虚拟机却不明显。我不认为任何人会因为忽视你策略中的成本节约部分而受到责备。这一切都是为了正确确定优先级，并主动减少云环境中的浪费。

# 减少浪费的策略

Azure 架构良好的框架[的支柱之一是成本优化。这是交付价值和适当使用云中资源之间的平衡。最大限度地利用您的资金是您的云运营战略的重要组成部分。云不仅仅是降低您的资本支出，还能优化您的 OPEX。](https://docs.microsoft.com/en-us/azure/architecture/framework/)

## 设计

使用 Azure 的一个关键部分是利用开发/测试和生产的独立订阅。Microsoft 为您提供了大幅降低的开发/测试工作负载价格，并且没有为其制定 SLA。我建议每个人都沿着这条路走下去，从定价中受益，并将生产与较低的环境隔离开来。接下来是你的架构。它与您当前和未来的 Azure 成本最相关。作为架构设计和审查的一部分，选择正确的 Azure 服务，为您现在和未来的成功做好准备。与此同时，它必须提供最高性价比。云提供了弹性和可伸缩性，所以你要明智地使用它。

## 包含

成本意识是减少浪费的重要组成部分。除非你深入了解你的日常开支，否则你无法优化你的成本。Azure 内置的成本管理是评估你日常和每月支出的一个很好的起点。您可以根据多个参数对成本进行筛选和分组，以确定最昂贵的资源。您甚至可以查看您的日常使用情况，了解偶尔峰值的趋势，以便更好地了解您的工作负载。Azure 提供了与 PowerBI 的集成，以在计费数据的基础上创建定制的仪表板。

这个练习将帮助你在 Azure 中设置预算和警报，并防止在你的计费周期结束时的账单冲击。您还可以在 Azure 之外创建管道来监控某个计划的成本，并将其与同一时期发生的成本进行比较。添加 x%的容差可以防止对使用和成本的持续警告。

## 实施

Azure 在计算和存储方面有很多服务产品，从节约成本的角度来看，几乎不可能提供每个产品的最佳实践。我将重点介绍 Azure 中一些使用最广泛的服务。

这是适用于 Azure 中大多数资源的通用指南。

*   使用 [Azure 价格计算器](https://azure.microsoft.com/en-us/pricing/calculator/)获得服务的估计成本。改变不同的设置，以了解它们对定价的影响。这个练习将指导您为您的用例选择最佳配置。
*   在开发环境的最低层部署您的服务。它可以节省您的成本，并为您提供设计中任何潜在瓶颈的指示。此外，您可以评估生产的基线配置，注意纵向扩展和横向扩展点。
*   使用 Azure Advisor 获取节省成本的建议。它们非常好，如果您对工作负载有更长远的看法，您可以采取行动。
*   使用灵活/弹性的产品，而不是传统的部署服务。许多 Azure 服务都提供了两者的选择，在你对工作负载有更深刻的了解之前，使用起来会更好更便宜。
*   尽可能利用保留价格。预付服务费可以节省很多钱。此外，其中一些允许你每月支付。
*   利用 Azure 混合优势，尤其是当您将现有的 Microsoft 工作负载从内部迁移到云时。
*   在你的团队中安排一个季度清理活动，从你的 Azure 开发/测试订阅中删除未使用的资源，其中服务为峰值和 POC 而启动并保持运行。

## **蔚蓝电脑**

*   选择 FaaS 而不是 PaaS 而不是 IaaS，这样您就不必经常使用最新版本的补丁和更新来保持更新。使用微软的决策流程图[。](https://docs.microsoft.com/en-us/azure/architecture/guide/technology-choices/compute-decision-tree#choose-a-candidate-service)
*   如果使用虚拟机，请在不使用时关闭机器。Azure 可以关闭虚拟机，但这不是一个按计划启动虚拟机的简单方法。您可以编写一个 DevOps 管道，在非业务时间关闭它们，并在开发/测试订阅中的虚拟机业务开始之前打开它们。
*   尽可能使用现场虚拟机。它们只需要很少的费用，却可以达到同样的效果。
*   如果您使用应用服务并需要专用环境，请使用独立的 V2(用于 ASEv3)而不是旧版本。新版本没有基本的邮票成本。
*   根据您想要实施和支持的灾难恢复计划，您对 Azure 服务的选择将决定您节省成本的策略。

## **蔚蓝储**

*   为您的工作负载选择正确的存储类型。不合适或配置不当的存储服务会让你付出很大代价。使用微软的决策[流程图。](https://docs.microsoft.com/en-us/azure/architecture/guide/technology-choices/data-store-decision-tree)
*   对于 ADLS 第二代，使用具有所需复制级别的正确层级别(热/冷/归档)。在开发/测试中，您可以选择 LRS，以节省存储和复制成本。没有两个用例是相同的，所以确保您从当前需求开始，而不是为未来过度设计。
*   MySQL 和 PGSQL 现在提供了灵活的服务器选项，所以你现在不必保留实例；相反，根据需要对它们进行缩放。它使您不必预测新解决方案的未来负载。
*   随着时间的推移，存储备份的成本会越来越高，因此请确保您有一个符合灾难恢复计划的策略，以防止存储不相关的数据。
*   确保考虑交易成本。您可能只存储了几个 GB 的数据，但每分钟向数据库发出一百万个请求，导致需要为服务选择更高的层。

> “云计算让个人可以从几乎任何互联网接入点访问数据和应用程序，为企业提供了一种全新的方式来削减技术基础设施的成本，并为大型计算机公司提供了一个潜在的巨大硬件和服务市场。”贾迈斯·卡斯西欧

本文仅从较高的层面介绍了存储和计算成本节约。合乎逻辑的下一步是查看微软关于优化您的云成本的指南。Azure 有很多关于这方面的文档，如果你正在 Azure 上构建应用程序&解决方案，我强烈推荐你阅读。不要忘记成本节约是您的云战略的支柱。