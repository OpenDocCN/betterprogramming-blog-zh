<html>
<head>
<title>A Simple MongoDB Injection: Little Bobby Collections</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个简单的MongoDB注入:小鲍比集合</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/little-bobby-collections-how-to-write-a-mongodb-injection-ad58a4e2d754?source=collection_archive---------0-----------------------#2018-11-13">https://betterprogramming.pub/little-bobby-collections-how-to-write-a-mongodb-injection-ad58a4e2d754?source=collection_archive---------0-----------------------#2018-11-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2de7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数据库注入以及如何避免它们</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/51c5559c3579b0ef103b1c932ea4cfb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fFfszmkthMr6aDQCao1_YA.png"/></div></div></figure><p id="a640" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">像MySQL和PostgreSQL这样的SQL数据库已经在web开发人员中流行多年了。你正在阅读的文本几乎肯定是由一个web应用程序从SQL数据库中检索出来的。这是有充分理由的:SQL数据库很棒！</p><p id="5b87" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它们不太好的一点是，你可以在一些数据上附加代码，让它们做一些它们不应该做的事情。数据库注入仍然是最危险的——也是最常见的——安全漏洞。世界上许多最严重的数据泄露都是附加在普通数据上的小型秘密SQL命令。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="c509" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">NoSQL</h1><p id="7aa1" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">就在上个月，我第一次与MongoDB合作。Mongo是一个NoSQL数据库，这意味着它使用不同于MySQL和Postgres等数据库的存储和查找数据的方法。它们之间的关键区别是SQL使用一个<em class="mu">模式</em>来结构化数据。Mongo将数据存储为单个且通常不相连的Javascript对象。SQL看起来像一个电子表格，而NoSQL更像一个装满揉成一团的纸片的桶。</p><p id="d162" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">自数据库出现以来，SQL一直主导着市场，而NoSQL相对来说是个新来者。Mongo最近几年在Node.js人群中特别流行。那么，这是否意味着我们也将开始看到NoSQL注射？他们会是什么样子？这部XKCD漫画是我最喜欢的SQL注入笑话。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/918f9f32fb743ef02c11850fb3532941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/0*O2aFfzYDZZYkbwj5"/></div><p class="mw mx gj gh gi my mz bd b be z dk translated">她的女儿叫救命我被困在驾照工厂了</p></figure><p id="9997" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Robinson夫人的儿子名叫<code class="fe na nb nc nd b">Robert’); DROP TABLE Students; —</code> —这是一个SQL命令，将删除表<code class="fe na nb nc nd b">Students</code>。她知道她的儿子最终会被一所用SQL数据库跟踪学生的学校录取。</p><p id="2953" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果Robinson夫人计划让她的儿子进入一所使用Mongo数据库的学校，她会给他取什么名字？要回答这个问题，我们必须推测学校会如何组织他们的数据。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="5934" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">注射</h1><p id="41dd" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">Mongo与表最接近的是集合。这些只是较大数据库桶中的较小桶。删除名为“学生”的集合的语法应该是<code class="fe na nb nc nd b">db.students.drop()</code>。我们的最终目标是让学校的记录保存应用程序告诉其数据库运行该命令。我们如何包装它来做到这一点？</p><p id="ed09" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个应用程序可能会告诉它的数据库运行类似<code class="fe na nb nc nd b">db.students.insert({ name: “Robert”})</code>的东西来添加一个名为“Robert”的学生。为了混进我的命令，我可能会尝试将“Robert”替换为类似以下的内容:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="256f" class="ni ly it nd b gy nj nk l nl nm">Robert”}).then(db.students.drop())</span></pre><p id="94d2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们就叫他小鲍比收藏。这个表达式有三个部分:</p><ol class=""><li id="2308" class="nn no it kw b kx ky la lb ld np lh nq ll nr lp ns nt nu nv bi translated">首先我给程序它所期望的，在这个例子中:<code class="fe na nb nc nd b">Robert</code></li><li id="fd31" class="nn no it kw b kx nw la nx ld ny lh nz ll oa lp ns nt nu nv bi translated">接下来添加一些代码，告诉它结束表达式:<code class="fe na nb nc nd b">“}).then()</code></li><li id="b9b9" class="nn no it kw b kx nw la nx ld ny lh nz ll oa lp ns nt nu nv bi translated">最后，我将我的有效负载<code class="fe na nb nc nd b">db.students.drop()</code>放在一个回调函数中，这样它在将‘Robert’添加到数据库中后会立即运行。在这里，我假设他们用名称db调用他们的数据库，并且他们有一个允许我访问的名为“students”的集合。如果我在这些事情上有任何错误，注射就不会起作用。</li></ol></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="b441" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">如何预防这种注射</h1><p id="d890" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">幸运的是，大多数使用Mongo的开发人员将通过对象关系映射器或ORM(如Mongoose)与它交流。除非使用eval()语句，否则使用预处理语句可以避免这样的注入。所以要小心那些评估！</p></div></div>    
</body>
</html>