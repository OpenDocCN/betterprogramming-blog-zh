<html>
<head>
<title>How to Build a REST API in Rust — A Step-by-Step Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Rust中构建REST API分步指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/rest-api-in-rust-step-by-step-guide-b8a6c5fcbff0?source=collection_archive---------0-----------------------#2020-04-17">https://betterprogramming.pub/rest-api-in-rust-step-by-step-guide-b8a6c5fcbff0?source=collection_archive---------0-----------------------#2020-04-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="adbc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在堆栈溢出的基础上，用过去四年中最受欢迎的语言构建你的API</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2b901df7b9365dc09a0734fa0123937c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eFZbze9r4KBhehYstA3LPA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.rust-lang.org/" rel="noopener ugc nofollow" target="_blank"> Mozilla Rust </a></p></figure><p id="f284" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你好，我是阿赛尔。今天，我将向您展示如何在<a class="ae ky" href="https://www.rust-lang.org/" rel="noopener ugc nofollow" target="_blank"> Rust </a>中创建一个简单的REST API。</p><p id="47ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们将为API使用<a class="ae ky" href="https://rocket.rs/" rel="noopener ugc nofollow" target="_blank"> Rocket框架</a>，为持久化特性使用<a class="ae ky" href="http://diesel.rs/" rel="noopener ugc nofollow" target="_blank"> Diesel ORM框架</a>。这个框架将涵盖下面提到的所有内容。所以，这比从零开始实现要容易得多。</p><ul class=""><li id="066b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">启动web服务器并打开一个端口。</li><li id="1684" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在此端口上侦听请求。</li><li id="cc83" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如果有请求进来，查看HTTP头中的路径。</li><li id="2e2e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">根据路径将请求路由到<code class="fe mj mk ml mm b">handler</code>。</li><li id="213f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">帮助您从请求中提取信息。</li><li id="6029" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将生成的<code class="fe mj mk ml mm b">data</code>(由你创建)打包，形成一个<code class="fe mj mk ml mm b">response</code>。</li><li id="59ea" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将<code class="fe mj mk ml mm b">response</code>发送回发送方。</li></ul></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="54aa" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">每夜安装铁锈</h1><p id="1c2a" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">因为Rocket充分利用了Rust的语法扩展和其他高级的、不稳定的特性，我们必须安装<code class="fe mj mk ml mm b">nightly</code>。</p><pre class="kj kk kl km gt nr mm ns nt aw nu bi"><span id="aa75" class="nv mv it mm b gy nw nx l ny nz">rustup default nightly</span></pre><p id="0102" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您希望将<code class="fe mj mk ml mm b">nightly</code>只安装在您的项目目录中，您可以使用以下命令:</p><pre class="kj kk kl km gt nr mm ns nt aw nu bi"><span id="556d" class="nv mv it mm b gy nw nx l ny nz">rustup override set nightly</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="3bb0" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">属国</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="aba1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们使用这些板条箱，我会解释的。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="c4c4" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">设置柴油</h1><p id="0abf" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">所以，接下来我要做的是设置<a class="ae ky" href="http://diesel.rs/guides/getting-started/" rel="noopener ugc nofollow" target="_blank">柴油</a>。Diesel提供了自己的CLI，所以我们必须先安装它。(假设你用的是<a class="ae ky" href="http://postgresql.org/download/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>。)</p><pre class="kj kk kl km gt nr mm ns nt aw nu bi"><span id="4a14" class="nv mv it mm b gy nw nx l ny nz">cargo install diesel_cli — no-default-features — features postgre</span></pre><p id="6913" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您需要告诉Diesel您的DB凭证是什么。该命令将生成一个<code class="fe mj mk ml mm b">.env</code>文件。</p><pre class="kj kk kl km gt nr mm ns nt aw nu bi"><span id="6bc3" class="nv mv it mm b gy nw nx l ny nz">echo DATABASE_URL=postgres://username:password@localhost:port/diesel_demo &gt; .env</span></pre><p id="660d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，运行以下命令:</p><pre class="kj kk kl km gt nr mm ns nt aw nu bi"><span id="c490" class="nv mv it mm b gy nw nx l ny nz">diesel setup</span></pre><p id="3ff5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建我们的数据库(如果它还不存在的话)，并创建一个空的迁移目录，我们可以用它来管理我们的模式(稍后将详细介绍)。</p><p id="9ff2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行上述代码时可能会出现几个错误。</p><pre class="kj kk kl km gt nr mm ns nt aw nu bi"><span id="9ce5" class="nv mv it mm b gy nw nx l ny nz">= note: LINK : fatal error LNK1181: cannot open input file ‘libpq.lib’</span></pre><p id="52e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过将<code class="fe mj mk ml mm b">PG lib folder</code>路径添加到环境变量中，可以很容易地解决这个问题。</p><pre class="kj kk kl km gt nr mm ns nt aw nu bi"><span id="200a" class="nv mv it mm b gy nw nx l ny nz">setx PQ_LIB_DIR “[path to pg lib folder]”</span></pre><p id="26f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我很惊讶那些错误没有在<a class="ae ky" href="http://diesel.rs/guides/getting-started/" rel="noopener ugc nofollow" target="_blank">柴油机文件</a>中被提及。</p><p id="4ba7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我强烈建议在CMD或Powershell中运行这些命令。如果你正在使用IDE的终端，你不会得到任何这样的错误，你会浪费两个小时试图弄清楚到底发生了什么。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/d609783182454c7f11dd625f656e8e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Eq4z1KMxu11GeE3--Q97w.png"/></div></div></figure><p id="97e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要解决这个问题，您可以将PG的bin文件夹路径添加到path变量中。问题解决了？很好！</p><p id="145d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个用户表，并为其创建一个迁移:</p><pre class="kj kk kl km gt nr mm ns nt aw nu bi"><span id="6a1d" class="nv mv it mm b gy nw nx l ny nz">diesel migration generate users</span></pre><p id="1ac2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行该命令后，您将看到在迁移文件夹中生成了两个文件。</p><p id="1604" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将编写用于迁移的SQL:</p><p id="19ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mj mk ml mm b">up.sql</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="ce6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mj mk ml mm b">down.sql</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="bc7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要应用我们的迁移，您可以使用:</p><pre class="kj kk kl km gt nr mm ns nt aw nu bi"><span id="4205" class="nv mv it mm b gy nw nx l ny nz">diesel migration run</span></pre><p id="6f88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最好确保<code class="fe mj mk ml mm b">down.sql</code>是正确的。通过<em class="od">重做</em>迁移，您可以快速确认您的<code class="fe mj mk ml mm b">down.sql</code>正确回滚了您的迁移:</p><pre class="kj kk kl km gt nr mm ns nt aw nu bi"><span id="f499" class="nv mv it mm b gy nw nx l ny nz">diesel migration redo</span></pre><p id="55cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到数据库中有一个用户表。对！</p><p id="4d8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我忘了说，如果你已经注意到，有一个文件是在你运行Diesel设置后生成的，名为<code class="fe mj mk ml mm b">schema.rs</code>。应该是这样的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="493a" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">酷，生锈的部分来了</h1><p id="0a66" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">既然我们要使用ORM，显然我们必须将用户表映射到Rust中的某个东西。在Java中，我们使用类来映射表。在<strong class="lb iu"> </strong> Java <strong class="lb iu">，</strong>我们通常称之为<em class="od">bean</em>。在Rust中，我们使用<code class="fe mj mk ml mm b">struct</code> s。让我们创建一个<code class="fe mj mk ml mm b">struct</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="7f19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，你可能想知道这些注释是什么，就像上面的结构定义。</p><p id="7cc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它们被称为衍生产品。因此，该行将派生出<em class="od">序列化的</em>和<em class="od">可查询的</em>特征。<code class="fe mj mk ml mm b">#[derive(Serialize)]</code>和<code class="fe mj mk ml mm b">#[derive(Deserialize)]</code>用于将数据映射到响应和请求。</p><p id="c2f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我要再创建两个结构体。你以后会得到它们的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="d473" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来我们要做的是实现<code class="fe mj mk ml mm b">User</code>。所以它会有一些方法来做数据库操作。</p><p id="c047" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，正如您所看到的，我们已经将连接传递给了方法，并返回了一个向量<code class="fe mj mk ml mm b">User</code> s。我们正在获取用户表中的所有行，并将它们映射到<code class="fe mj mk ml mm b">User</code>结构。</p><p id="3b4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，我们预计会有错误。如果出现紧急情况，将会打印出“错误”消息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="359b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经创建了一个表和映射该表的结构。接下来我们要做的是创建使用它的方法。因此，我们将创建一个<code class="fe mj mk ml mm b">routes</code>文件。我们通常称之为<em class="od">处理程序</em>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="650c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们要做的就是建立连接池。这里有一个来自<a class="ae ky" href="https://rocket.rs/v0.4/guide/state/#databases" rel="noopener ugc nofollow" target="_blank">火箭文档</a>的关于连接池的简单解释。</p><blockquote class="oe of og"><p id="8ff4" class="kz la od lb b lc ld ju le lf lg jx lh oh lj lk ll oi ln lo lp oj lr ls lt lu im bi translated">“Rocket包含内置的、与ORM无关的数据库支持。特别是，Rocket提供了一个过程宏，允许您通过连接池轻松地将Rocket应用程序连接到数据库。</p><p id="45dd" class="kz la od lb b lc ld ju le lf lg jx lh oh lj lk ll oi ln lo lp oj lr ls lt lu im bi translated">数据库连接池是一种数据结构，它维护活动的数据库连接，供以后在应用程序中使用。"</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="439c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们需要在<code class="fe mj mk ml mm b">main</code>文件中启动我们的服务器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="4f02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的项目中，我也添加了棱角分明的前端。我也会用我们生锈的后端来为它服务。</p><p id="cc63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行应用程序→ <code class="fe mj mk ml mm b">cargo run</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/78b4935ce34fa57024d9ca83c830c57c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DYW6tncTDuZ0NLmzEkT7WQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">启动服务器</p></figure><p id="0461" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用<a class="ae ky" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">失眠</a>来测试我们的服务器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/e4be1be509493767e4a83b5e63607ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o4g6EggMn4_5QXNib-aLgw.png"/></div></div></figure><p id="5640" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这有所帮助。干杯！</p></div></div>    
</body>
</html>