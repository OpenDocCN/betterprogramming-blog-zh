<html>
<head>
<title>Build a Decentralized Ticket Exchange Using the Flow Blockchain</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用流量区块链构建去中心化的票据交换</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-decentralized-ticket-exchange-using-the-flow-blockchain-ed0eaf7745d0?source=collection_archive---------1-----------------------#2021-07-29">https://betterprogramming.pub/build-a-decentralized-ticket-exchange-using-the-flow-blockchain-ed0eaf7745d0?source=collection_archive---------1-----------------------#2021-07-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="aca5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Dapper Labs前景广阔的新平台为NFTs添加实用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2c87b08706c8cacd115f9e2e622a54cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RuAw75ZRPaofAaasZI6YHg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">艺术家帕克的作品《立方体》(<a class="ae kw" href="https://niftygateway.com/itemdetail/primary/0xc7cc3e8c6b69dc272ccf64cbff4b7503cbf7c1c5/4" rel="noopener ugc nofollow" target="_blank">来源</a>)</p></figure><p id="ee99" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">自2017年ERC-721标准问世以来，不可替代令牌(NFT)已经从一个交易虚拟猫的实验平台发展成为一个主流采用的大规模产业。</p><p id="80e5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae kw" href="https://www.nba.com/news/dapper-labs-creators-of-nba-top-shot-get-305m-in-funding" rel="noopener ugc nofollow" target="_blank"> NBA Top Shot已经筹集了3.05亿美元</a>向其80多万用户出售代表篮球集锦的NFT，<a class="ae kw" href="https://www.sothebys.com/en/articles/17-million-realized-in-sothebys-first-nft-sale-with-digital-creator-pak" rel="noopener ugc nofollow" target="_blank">苏富比刚刚以1700万美元的价格拍卖了一件数字艺术品</a>。</p><p id="f18e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">很明显，NFT会一直存在，但即使作为一个加密迷，我仍然对数字艺术模型的价值定位感到困惑。</p><p id="577b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当你购买NBA顶级投篮收藏品时，你并不拥有该集锦的商业权利。你甚至没有独家分享的权利。事实上，这是一件价值1700万美元的艺术品，免费赠送。</p><p id="0ec7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">但是让我们来谈谈你用NFT得到了什么:一个独特资产的可加密验证的所有权和出售或转移所述资产的智能合同定义的能力。</p><p id="c6ec" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">许多资产类型将受益于可加密验证的所有权:成绩单、证书和知识产权浮现在脑海中(想象一下用区块链取代美国专利商标局……跳过律师，以先到先得的方式提交申请)。</p><p id="f13c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">正是在一个朋友的建议下，我开始考虑将活动门票作为NFT资产类别的候选品种，这很有意义。机票市场最大的问题是什么？仅举几个例子:</p><ul class=""><li id="d503" class="lu lv iq kz b la lb ld le lg lw lk lx lo ly ls lz ma mb mc bi translated">仿冒品</li><li id="b2a3" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls lz ma mb mc bi translated">巨额交易费(我们都知道看到标价50美元的门票，但不知何故在Ticketmaster拿到提成时花了72.5美元的感觉)</li><li id="ae2e" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls lz ma mb mc bi translated">不受监管的二级市场</li></ul><p id="2798" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果我们使用智能合约来管理我们的资产，这些问题就会消失。确定NFT的真实性是微不足道的。如果我们使用正确的区块链，交易费用可以大大减少。</p><p id="247d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">对我来说，最令人兴奋的好处是票据发行商能够设定二级市场的条款。你可以让你的资产不可转让，确保它们只能以低于标价的价格出售，甚至在任何二次销售中给表演者提成。</p><p id="45fc" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这个去中心化的系统中，每个人都有更公平、更透明的体验。所以让我们开始建造吧。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="43ea" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">概观</h1><p id="e90e" class="pw-post-body-paragraph kx ky iq kz b la nh jr lc ld ni ju lf lg nj li lj lk nk lm ln lo nl lq lr ls ij bi translated">我们必须做出的第一个决定是使用哪个区块链平台。我们可以使用以太坊，但是交易费用可能会有点高(尽管随着ETH 2.0的推出，这种情况会有很大的改变)。</p><p id="c30a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Flow是一个新的区块链，有一个对开发者友好的生态系统，交易费用可以忽略不计，这听起来是一个很好的起点。</p><p id="ba22" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">事实上，Dapper Labs的NBA Top Shot使用了<a class="ae kw" href="https://github.com/dapperlabs/nba-smart-contracts/tree/master/contracts" rel="noopener ugc nofollow" target="_blank"> Flow smart contracts </a>，与我们将在这里部署的没有什么不同。</p><p id="158e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">从较高的层面来看，下面是我们创建一个基本但功能性的票证“市场”所要做的事情(我们不会实现完整的购买/销售功能，但这有望成为未来演示的主题)。</p><ol class=""><li id="a6c5" class="lu lv iq kz b la lb ld le lg lw lk lx lo ly ls nm ma mb mc bi translated">在Flow smart合同中定义我们的不可转让“不可替换票证”的条款</li><li id="6d65" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls nm ma mb mc bi translated">创建虚拟账户，允许发行人和参与者与我们的NFTs互动</li><li id="6495" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls nm ma mb mc bi translated">使用事务安全地演示常见功能，如铸造和转让门票</li><li id="277e" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls nm ma mb mc bi translated">用React.js为一个简单的web界面构建一个准系统前端</li></ol></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="f3c0" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">设置</h1><p id="5da2" class="pw-post-body-paragraph kx ky iq kz b la nh jr lc ld ni ju lf lg nj li lj lk nk lm ln lo nl lq lr ls ij bi translated">我使用了来自<a class="ae kw" href="https://docs.onflow.org/cadence/tutorial/01-first-steps/" rel="noopener ugc nofollow" target="_blank">流程文档</a>的教程，作为熟悉他们的智能合约编程语言、Cadence和他们的标准NFT模板的一个很好的起点。如果您继续进行，您将需要<a class="ae kw" href="https://docs.onflow.org/flow-cli/install/" rel="noopener ugc nofollow" target="_blank">为您的操作系统安装Flow CLI </a>。</p><p id="0f46" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当然，我们可以将我们的合同部署到Flow mainnet或testnet，但是我们将利用<a class="ae kw" href="https://docs.onflow.org/emulator#gatsby-focus-wrapper" rel="noopener ugc nofollow" target="_blank"> Flow emulator </a>进行快速本地开发。使用以下命令启动模拟器:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="ae46" class="ns mq iq no b gy nt nu l nv nw">flow emulator start</span></pre></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="725c" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">不可替换的票证智能合同</h1><p id="e528" class="pw-post-body-paragraph kx ky iq kz b la nh jr lc ld ni ju lf lg nj li lj lk nk lm ln lo nl lq lr ls ij bi translated">我们的不可替代票证智能合同需要定义我们的NFT的特征，以及铸造、存储、传输和检查它们的功能。</p><p id="3b4b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">一些功能将被公开，如存款(即，我不需要您的明确许可就可以向您发送票证)或获取元数据，而其他功能，如提取和铸造，将被授予特权(原因显而易见)。</p><p id="d128" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我还想确保我们的票是不可转让的，所以我们将应用一个条件，不允许它被存放超过一次。让我们看看我们的Cadence智能合同。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="ce23" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">流文档将提供比我更清晰的解释，但在高层次上，Cadence使用称为资源和能力的概念来定义谁可以访问什么。</p><p id="4d05" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">例如，我们将<code class="fe nz oa ob no b">NFTCollection</code>和<code class="fe nz oa ob no b">NFTMinter</code>资源保存到部署帐户的<code class="fe nz oa ob no b">/storage/</code>路径中，这意味着它们是私有的，但是我们在<code class="fe nz oa ob no b">/public/</code>路径中发布了一个到<code class="fe nz oa ob no b">NFTReceiver</code>功能的链接。还要注意，我们的NFT只是由它们的整数ID和一个<code class="fe nz oa ob no b">numTransfers</code>计数器定义的，这个计数器将在每次存放NFT时进行迭代。</p><p id="e4a9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这种情况下，如果有人试图第二次转让我们的机票，交易将失败。将合同保存到名为<code class="fe nz oa ob no b">cadence/contracts/</code>的目录中。</p><p id="83eb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在我们部署我们的契约之前，我们需要创建我们的<code class="fe nz oa ob no b">flow.json</code>文档来指定正在部署什么，由谁部署，以及它将在哪里结束(例如在模拟器中)。要在项目目录中初始化该文件，请运行以下命令:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="77ee" class="ns mq iq no b gy nt nu l nv nw">flow init</span></pre><p id="2af3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这也给了我们一个初始帐户和一个私钥。我们一会儿会看一下<code class="fe nz oa ob no b">flow.json</code>文件，但是首先，我们需要为我们的与会者创建第二个帐户。运行以下代码以获取公钥/私钥对:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="c2a3" class="ns mq iq no b gy nt nu l nv nw">flow keys generate</span></pre><p id="1148" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">保存两个密钥，然后运行:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="a148" class="ns mq iq no b gy nt nu l nv nw">flow accounts create ATTENDEE_PUB_KEY</span></pre><p id="0528" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">用您刚刚生成的公钥替换<code class="fe nz oa ob no b">ATTENDEE_PUB_KEY</code>。</p><p id="f187" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">记下地址，从0x开始。现在我们拥有了完成<code class="fe nz oa ob no b">flow.json</code>文件所需的一切。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="8d26" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">注意:按照惯例，您永远不应该共享您的私钥。在这种情况下，您看到的任何键只在我的模拟器会话的特定实例上有效。</p><p id="75a4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您将看到我们添加了一个指向我们的<code class="fe nz oa ob no b">NonFungibleTicket</code>合同的指针，我们的新参与者帐户，以及模拟器帐户(代表我们的票据发行者)对模拟器的合同部署。此时，我们可以部署我们的合同:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="3947" class="ns mq iq no b gy nt nu l nv nw">flow project deploy</span></pre><p id="7cbe" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果一切顺利，您应该会看到如下输出:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="9f0e" class="ns mq iq no b gy nt nu l nv nw">Deploying 1 contracts for accounts: emulator-account</span><span id="9e99" class="ns mq iq no b gy oc nu l nv nw">NonFungibleTicket -&gt; 0xf8d6e0586b0a20c7</span><span id="31e6" class="ns mq iq no b gy oc nu l nv nw">✨  All contracts deployed successfully</span></pre></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="89b7" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">铸造我们的NFT</h1><p id="8799" class="pw-post-body-paragraph kx ky iq kz b la nh jr lc ld ni ju lf lg nj li lj lk nk lm ln lo nl lq lr ls ij bi translated">现在是时候真正创造我们的第一个NFT了。同样，我们将使用Cadence，但我们将使用事务，而不是定义合同。交易是我们如何使用智能合约中定义的功能来对区块链进行更改。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="2267" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">对我来说，有趣的部分是NFT元数据。我创建了一个演示票，带有一些属性，如section和row，以及一个链接到票图像的URI。</p><p id="6e05" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这提出了一个问题，我不知道很多NFT的普通用户是否了解他们是如何工作的。</p><p id="7824" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">区块链将出色地追踪NFT及其相关元数据的所有者。但是，数字资产的常见做法是使用外部存储来存储它们所代表的实际内容。</p><p id="5402" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">作为存储图像的S3存储桶的所有者，没有什么能阻止我删除或更新文件！</p><p id="f873" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">想象一下，如果你花了30，000美元买了一个斯蒂芬·库里赢得比赛的三分球，而Dapper Labs决定用它换来亚历克斯·卡鲁索的罚球。希望像IPFS这样的分散存储选项能解决这类问题。</p><p id="19a5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们的票证发行帐户部署了该合同，因此，他们的私有存储中有NFTMinter资源。所以这个账户必须是签署这个交易的账户:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="3f85" class="ns mq iq no b gy nt nu l nv nw">flow transactions ./cadence/transactions/MintTicket.cdc send --signer emulator-account</span></pre><p id="953a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果我们尝试与<code class="fe nz oa ob no b">attendee-account</code>签约，交易将会失败。接下来，让我们使用Cadence脚本(一个只读事务)来检查我们的发卡行帐户的余额。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="0879" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">使用以下命令运行脚本:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="f4c5" class="ns mq iq no b gy nt nu l nv nw">flow scripts execute ./cadence/scripts/CheckTicketBalance.cdc</span></pre><p id="3ebb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您应该看到一个数组，其中包含所有拥有的NFT的ID:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="cd03" class="ns mq iq no b gy nt nu l nv nw">Result: [1]</span></pre><p id="902b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这意味着发行者现在拥有我们新铸造的NFT！</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="4563" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">转移我们的NFT</h1><p id="bde9" class="pw-post-body-paragraph kx ky iq kz b la nh jr lc ld ni ju lf lg nj li lj lk nk lm ln lo nl lq lr ls ij bi translated">现在我们只需要把我们的票交到一个热切的音乐会观众手中。首先，我们将在与会者的存储中创建一个<code class="fe nz oa ob no b">NFTCollection</code>资源。</p><p id="a9d0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这带来了Flow基础设施的一个有用的方面。</p><p id="4e8b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在以太坊，如果你发送ETH到一个无效的钱包地址，它就会消失。有了Flow，资源就不能在没有明确目的地的情况下被挂起，否则整个事务就会恢复。如果我们不小心把这张票送到一个无效的地址，我们不会丢失它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="f202" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">使用以下命令运行上述事务:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="93e7" class="ns mq iq no b gy nt nu l nv nw">flow transactions send .\cadence\transactions\SetupEmptyCollection.cdc --signer attendee-account</span></pre><p id="bd4d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在，我们的与会者已经准备好领取门票了。我们将通过Cadence交易来实现这一点，在该交易中，发卡行帐户从其存储中提取NFT，并将其存入参与者的集合中。</p><p id="bd87" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">请记住，每次存款时，它都会迭代存储在NFT中的<code class="fe nz oa ob no b">numTransfers</code>参数。本次交易后，<code class="fe nz oa ob no b">numTransfers = 1</code>。这份合同是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="fe81" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">使用下面给出的命令转移票证:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="fbbd" class="ns mq iq no b gy nt nu l nv nw">flow transactions send ./cadence/transactions/TransferTicket.cdc --signer emulator-account</span></pre><p id="2a82" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您可以为两个帐户再次运行<code class="fe nz oa ob no b">CheckTicketBalance</code>脚本，并验证<code class="fe nz oa ob no b">getIDs()</code>为发卡行帐户返回一个空数组，而<code class="fe nz oa ob no b">[1]</code>为我们的参与者返回一个空数组！让我们看看，如果我试图将票<em class="lt">转让回</em>给发行人(或任何其他人)，会发生什么:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="6b3f" class="ns mq iq no b gy nt nu l nv nw">❌ Transaction Error<br/>execution error code 100: Execution failed:<br/>error: panic: Ticket is non-transferrable!<br/>  --&gt; f8d6e0586b0a20c7.NonFungibleTicket:59:16<br/>   |<br/>59 |                 panic("Ticket is non-transferrable!")<br/>   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></pre><p id="4dd7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们的智能合同正在被正确执行。我们的票不能在二级市场上转让。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="fb7b" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">React应用</h1><p id="e1c0" class="pw-post-body-paragraph kx ky iq kz b la nh jr lc ld ni ju lf lg nj li lj lk nk lm ln lo nl lq lr ls ij bi translated">我不打算深入讨论前端应用程序的细节(我是JS新手，所以代码很大程度上改编自<a class="ae kw" href="https://medium.com/pinata/how-to-display-your-nft-collection-like-nba-top-shot-with-flow-and-ipfs-6ba75048bf8a" rel="noopener">这篇优秀的博客</a>)，它利用Flow Javascript库与我们的契约进行交互。</p><p id="9455" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们实际上是在应用程序中运行Cadence事务。在这个基本示例中，我们将只检索元数据，但是任何Cadence代码都可以以这种方式执行。</p><p id="2ef6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这是它的样子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="b44d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">通过以下方式在本地运行我们的应用:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="93c6" class="ns mq iq no b gy nt nu l nv nw">npm run start</span></pre><p id="9268" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们将被引导到简单而强大的分散式购票网页。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/1aee73f0d6db7e57acbd1fae36d9ab46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c3ee9RVNUsU87H76_YXDmA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="2b2e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">完整的项目代码可在<a class="ae kw" href="https://github.com/evandiewald/flow-ticket-transfer" rel="noopener ugc nofollow" target="_blank">这里</a>获得。我希望你喜欢它。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="f1ed" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">参考</h1><p id="8b24" class="pw-post-body-paragraph kx ky iq kz b la nh jr lc ld ni ju lf lg nj li lj lk nk lm ln lo nl lq lr ls ij bi translated"><a class="ae kw" href="https://docs.onflow.org/cadence/tutorial/04-non-fungible-tokens/" rel="noopener ugc nofollow" target="_blank">流转单据</a></p><p id="eed7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae kw" href="https://medium.com/pinata/how-to-display-your-nft-collection-like-nba-top-shot-with-flow-and-ipfs-6ba75048bf8a" rel="noopener">如何展示你的NFT收藏品，如NBA顶级投篮和IPFS </a></p></div></div>    
</body>
</html>