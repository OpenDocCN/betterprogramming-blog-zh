<html>
<head>
<title>Build a Custom SwiftUI Search Bar Using LazyVStack With Sections and Section Index</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用LazyVStack构建一个自定义的SwiftUI搜索栏，包含部分和部分索引</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swiftui-custom-search-bar-lazyvstack-with-sections-and-section-index-6091da436c83?source=collection_archive---------4-----------------------#2022-03-24">https://betterprogramming.pub/swiftui-custom-search-bar-lazyvstack-with-sections-and-section-index-6091da436c83?source=collection_archive---------4-----------------------#2022-03-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="89da" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们创建一个国家采摘iOS应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ec93f3b8f7d1c28c9ac9bc3d6098378b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pLkDhW6S28_dj3zo"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·温克勒在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="4840" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个简短的教程中，我们将实现我们的自定义搜索栏LazyVStack，它包含带有节和节索引的数据—灵感来自于<a class="ae kv" href="https://stackoverflow.com/questions/58809357/swiftui-list-with-section-index-on-right-hand-side" rel="noopener ugc nofollow" target="_blank"> this StackOverflow问题</a>。</p><p id="8db0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，让我们解释一下我们想要达到的目标。假设我们需要实现一个可搜索或过滤的值列表，用户需要从中选择一个。</p><p id="57f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个例子中，我们实现了一个国家代码选择器，其中我们的列表包含了一个国家列表以及它们各自的国家代码。用户从列表中选择一项，然后返回输入电话号码。</p><p id="2284" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的成品将是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/211e25b63c77a0a8a40b1571e02d4255.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*HlF0Gv2IsdQKXjt8oaFe1w.png"/></div></figure><p id="aa08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所看到的，我们有一个包含部分的项目列表。每个部分在屏幕右侧都有一个索引，当我们点击索引值时，我们的列表就会滚动到所选的部分。此外，当我们在搜索栏中输入文本时，带有部分的项目列表会被过滤。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/4a1206648f72973ec469a4cd30f4ab81.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*QleHVssnPaYL30eqoSYfLQ.png"/></div></figure><p id="3d2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，让我们创建我们的项目。我们项目的结构将如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/c594dfe286f9032f6950ef5bc11d60d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*FDJIStFD27XK7x462MHQLw.png"/></div></figure><p id="82b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们需要添加<code class="fe lu lv lw lx b"><strong class="ky ir">CountryCodes.json</strong></code>文件。文件的结构如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/ef6f5a36775df05d16b647c6f69d2c15.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*26OMxiCPQoUQPeJUMyRqCA.png"/></div></figure><p id="4636" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，让我们创建我们的<code class="fe lu lv lw lx b">CountryModel.swift</code>来保存来自JSON文件的数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="9e3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们将实现<code class="fe lu lv lw lx b">CountryCodeViewModel.swift</code>，它负责从JSON文件中获取数据，并创建节。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="f008" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们在前面的代码部分中看到的，当我们初始化视图模型时，我们从JSON文件中初始化数组或国家。</p><p id="c03c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们将添加代表可点击列表项的<code class="fe lu lv lw lx b">CountryItemView.swift</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="6410" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，剩下要实现的最后一件事就是<code class="fe lu lv lw lx b">CountryCodeView.swift</code>。它结合了所有以前的代码。因此，让我们将视图主体分成多个部分。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="a719" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">搜索栏是自定义创建的，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="2731" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一个重要部件是<code class="fe lu lv lw lx b">countriesListView</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="c7df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们就此打住，解释一下这个应用程序最重要的部分。</p><p id="84e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们在<code class="fe lu lv lw lx b">ScrollView</code>和<code class="fe lu lv lw lx b">ScrollViewReader</code>里面加上了<code class="fe lu lv lw lx b">LazyVStack</code>和段。在<code class="fe lu lv lw lx b">LazyVStack</code>内的每个子视图部分都用<code class="fe lu lv lw lx b">pinnedViews:[.sectionHeaders]</code>钉住。</p><p id="fa73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们遍历sections数组中的每个section或字母，并将section添加为<code class="fe lu lv lw lx b">CountrySectionHeaderView</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="645e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用的第一个过滤器是section过滤器，它通过调用<code class="fe lu lv lw lx b">searchForSection</code>函数并根据用户输入的搜索栏文本的第一个字母来过滤我们的section数组:</p><pre class="kg kh ki kj gt mb lx mc md aw me bi"><span id="b8be" class="mf mg iq lx b gy mh mi l mj mk"><strong class="lx ir">self</strong>.searchForSection($0)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="759d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，当我们遍历各个部分时，我们通过获取每个国家的第一个字母并将其与当前部分的字母进行比较来过滤视图模型中的国家名称。该过滤器将过滤后的国家添加到所需的部分。</p><pre class="kg kh ki kj gt mb lx mc md aw me bi"><span id="f83e" class="mf mg iq lx b gy mh mi l mj mk">(countryModel) -&gt; Bool <strong class="lx ir">in</strong> countryModel.name.prefix(1) == letter</span></pre><p id="2105" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同时，我们为搜索栏输入使用另一个过滤器，通过调用<code class="fe lu lv lw lx b">searchForCountry</code>函数来过滤视图模型中的国家。这个函数根据用户在搜索栏中输入的字符串过滤国家。</p><pre class="kg kh ki kj gt mb lx mc md aw me bi"><span id="69f9" class="mf mg iq lx b gy mh mi l mj mk"><strong class="lx ir">self</strong>.searchForCountry(countryModel.name)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="9c14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe lu lv lw lx b">scrollProxy</code> from <code class="fe lu lv lw lx b">ScrollViewReader</code>允许我们滚动到我们点击的索引列表项目的每个部分的顶部。</p><pre class="kg kh ki kj gt mb lx mc md aw me bi"><span id="355d" class="mf mg iq lx b gy mh mi l mj mk">scrollProxy.scrollTo(target, anchor: .topLeading)</span></pre><p id="ca3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们通过监听状态变量<code class="fe lu lv lw lx b">scrollTarget</code>的值来做到这一点。该变量在<code class="fe lu lv lw lx b">lettersListView</code>索引列表中变化，每次我们点击列表中的字母按钮项目。</p><pre class="kg kh ki kj gt mb lx mc md aw me bi"><span id="f045" class="mf mg iq lx b gy mh mi l mj mk">Button(action: {<br/>   <strong class="lx ir">if</strong> countryCodeViewModel.countryCodes.first(where: {    $0.name.prefix(1) == letter }) != <strong class="lx ir">nil</strong> {<br/>         scrollTarget = letter<br/>   }<br/>}</span></pre><p id="60f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后一部分是<code class="fe lu lv lw lx b">lettersListView</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="47e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样，希望你喜欢这个教程，并期待更多的内容。</p><p id="1d9d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码可从下面的GitHub库获得:</p><div class="ml mm gp gr mn mo"><a href="https://github.com/kenagt/CustomSearchbarIOS" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd ir gy z fp mt fr fs mu fu fw ip bi translated">GitHub-kenagt/CustomSearchbarIOS:带有LazyVStack、过滤和…</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">github.com</p></div></div><div class="mx l"><div class="my l mz na nb mx nc kp mo"/></div></div></a></div></div></div>    
</body>
</html>