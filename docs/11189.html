<html>
<head>
<title>Go(lang) and AWS Lambda: Trigger a Lambda Function Through an API Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Go(lang)和AWS Lambda:通过API网关触发Lambda函数</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/go-lang-and-aws-lambda-trigger-a-lambda-function-through-an-api-gateway-44fc12bb855c?source=collection_archive---------11-----------------------#2022-02-24">https://betterprogramming.pub/go-lang-and-aws-lambda-trigger-a-lambda-function-through-an-api-gateway-44fc12bb855c?source=collection_archive---------11-----------------------#2022-02-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a1f6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从Go应用程序的URL中删除不需要的HTML标签</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9c9c550a0940267e2c42e3e202c7c6a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aPZtCSVZlMSD5oVt"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@jacksonsophat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰克逊·索</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="08a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我们用Go编写了一个应用程序，它接收一个URL并删除不需要的HTML标签以使其可读。然后我们将它部署到AWS Lambda，并配置AWS API网关与我们的Lambda函数进行交互。</p><h1 id="8754" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">先决条件</h1><p id="412e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">请在您的系统上安装并配置以下软件包。</p><ul class=""><li id="e955" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">安装<a class="ae kv" href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a></li><li id="c5b7" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">安装<a class="ae kv" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html" rel="noopener ugc nofollow" target="_blank"> AWS SAM CLI </a></li><li id="6813" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">安装Go</li></ul><h1 id="3462" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">我们学到了什么</h1><ul class=""><li id="caa1" class="mp mq iq ky b kz mk lc ml lf nd lj ne ln nf lr mu mv mw mx bi translated">如何在Go中编写一个AWS Lambda函数</li><li id="7ccb" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">构建和部署Lambda函数</li><li id="926b" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">使用API网关触发Lambda函数</li></ul><h1 id="7a8e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Go可读性API</h1><p id="2594" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为了让本教程有点用处，我决定用一个API来接收一个URL并返回其内容的可读版本，这正是已经由<a class="ae kv" href="http://getpocket.com/" rel="noopener ugc nofollow" target="_blank"> Pocket </a>完成的任务。</p><p id="c821" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在开始编写代码之前，请安装以下Go包:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="a58d" class="nl lt iq nh b gy nm nn l no np">$ go get github.com/go-shiori/go-readability<br/>$ go get github.com/aws/aws-lambda-go/events<br/>$ go get github.com/aws/aws-lambda-go/lambda</span></pre><p id="841c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nh b">go-readability</code>通过删除不需要的HTML标签将文章转换成可读版本。<code class="fe nq nr ns nh b">aws-lambda-go/lambda</code>负责通过传递所需的参数来执行处理函数，并将返回的响应发送回AWS Lambda API。而<code class="fe nq nr ns nh b">aws-lambda-go/events</code>帮助我们访问请求的主体，并发回适当的响应。</p><p id="2fca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装包后，创建目录并命名为<code class="fe nq nr ns nh b">go-readable</code>:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="9072" class="nl lt iq nh b gy nm nn l no np">$ mkdir go-readable &amp;&amp; cd go-readable<br/>$ go mod readability</span></pre><p id="07dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个文件<code class="fe nq nr ns nh b">main.go</code>，并在其中添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="d99b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nh b">main</code>函数调用AWS SDK提供的<code class="fe nq nr ns nh b">lambda.Start</code>函数，它接收一个处理函数，执行它，并将响应发送回AWS运行时API。</p><p id="2137" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nh b">handler</code>函数接收两个参数，<code class="fe nq nr ns nh b">ctx</code>给出函数的一些信息，request包含请求的信息。<code class="fe nq nr ns nh b">handler</code>函数可以有以下签名之一:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="3add" class="nl lt iq nh b gy nm nn l no np">func ()<br/>func () error<br/>func (TIn) error<br/>func () (TOut, error)<br/>func (context.Context) error<br/>func (context.Context, TIn) error<br/>func (context.Context) (TOut, error)<br/>func (context.Context, TIn) (TOut, error)</span></pre><p id="36ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如您所看到的，这个函数非常简单，它接收请求体，并在将其转换为<code class="fe nq nr ns nh b">Event</code>结构后，将<code class="fe nq nr ns nh b">Url</code>传递给<code class="fe nq nr ns nh b">readability</code>，并将输出附加到响应中。</p><h1 id="c333" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">构建和部署Lambda函数</h1><p id="22ec" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为了触发这个功能，我们将使用AWS API Gateway创建一个API端点。在您项目的根目录下，创建一个文件<code class="fe nq nr ns nh b">template.yaml</code>，并在其中添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="7ee1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe nq nr ns nh b">Resources</code>下，有一个我们希望由AWS SAM CLI创建的AWS服务列表。在这种情况下，我们只有一个资源，即Lambda函数。Lambda函数资源具有一些属性:</p><ul class=""><li id="432c" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><code class="fe nq nr ns nh b">CodeUrl</code>表示其中是项目的根目录。在我们的例子中，<code class="fe nq nr ns nh b">.</code>表示当前目录。</li><li id="c7be" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nq nr ns nh b">Handler</code>是Lambda运行时API将查找并执行的函数的名称。</li><li id="756a" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nq nr ns nh b">Runtime</code>被设置为<code class="fe nq nr ns nh b">go1.x</code>，这意味着我们正在使用Go运行时。</li><li id="8afc" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nq nr ns nh b">Policies</code>向Lambda函数添加一个或多个IAM策略。</li><li id="8db9" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nq nr ns nh b">Events</code>指定该函数可以由以下事件触发，在我们的例子中，我们希望通过一个<code class="fe nq nr ns nh b">API</code>请求来触发我们的函数。</li><li id="4c27" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nq nr ns nh b">Events</code>下的<code class="fe nq nr ns nh b">Properties</code>表示我们API的<code class="fe nq nr ns nh b">Path</code>，它是我们的端点，必须是一个<code class="fe nq nr ns nh b">POST</code>请求，不需要任何认证。</li></ul><p id="bfd6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建此模板后，运行<code class="fe nq nr ns nh b">sam build</code>和<code class="fe nq nr ns nh b">sam deploy -g</code>并回答问题:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/a81c6125f9f1c6839d011d644c0dd0c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yXYyF0FyIA_js7rgRVgMtg.png"/></div></div></figure><p id="664e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它会在您的根目录下创建一个名为<code class="fe nq nr ns nh b">samconfig.toml</code>的文件，并在其中存储所有提供的信息。下一次，您只需要运行<code class="fe nq nr ns nh b">sam deploy</code>来部署您的功能。它还会创建一个CloudFormation堆栈，将您的代码上传到AWS Lambda，并在API Gateway中创建一个API资源。</p><h1 id="5f36" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">部署我们的API</h1><p id="cb1d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在是时候部署我们的API了。打开AWS管理控制台并转到API网关服务。您应该会看到类似这样的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/14376fbf18e0c7036abc4114d2e26693.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ajntw6UrK2tcB1XJJbc_3Q.png"/></div></div></figure><p id="32cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击<code class="fe nq nr ns nh b">go-readable-lambda-app</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/bb438110b539e65d75d7933d923f6db6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*icetBT0T36Kf2y8ODLEPtw.png"/></div></div></figure><p id="4d53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如您所见，我们在左侧栏中有一个资源，它只接受<code class="fe nq nr ns nh b">POST</code>请求。在页面的右侧，您可以看到我们的API的流程。它接收请求，将其传递给Lambda_PROXY，然后触发我们的LAMBDA函数，然后从我们的LAMBDA函数接收响应，并在进行一些集成后，将响应发送回来。为了访问这个端点，我们需要部署它。点击页面顶部的<code class="fe nq nr ns nh b">Action</code>按钮，选择部署API</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/8cb2acd20a2b1861468fdaea6ed870bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u2c2PHdXU4LCY0vxr4Ha4w.png"/></div></div></figure><p id="ee3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后选择一个阶段来部署API:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/0412df69a5f35a38d5bb6c49f8491e32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9sQTF9ZOXbTxWWAbVx4hmQ.png"/></div></div></figure><p id="19ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">部署之后，您将获得一个指向您的API的URL。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/439c4590abae3cb11d31aa68ea93b8b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_4nLG6CfoIVP5Tcyvfc8w.png"/></div></div></figure><p id="7949" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们测试我们的API:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="f673" class="nl lt iq nh b gy nm nn l no np">$ curl --header "Content-Type: application/json" \<br/>  --request POST \<br/>  --data '{"url":"<a class="ae kv" href="https://smoqadam.me/posts/books-i-loved-most-in-2021/" rel="noopener ugc nofollow" target="_blank">https://smoqadam.me/posts/books-i-loved-most-in-2021/</a>"}' <a class="ae kv" href="https://763w7zdo8g.execute-api.eu-central-1.amazonaws.com/Prod/readable" rel="noopener ugc nofollow" target="_blank">https://763w7zdo8g.execute-api.eu-central-1.amazonaws.com/Prod/readable</a></span></pre><p id="d4c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你做了所有正确的事情，你会看到给定URL的可读结果。</p><p id="9715" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就这些，如果你有任何反馈或问题，请告诉我。</p></div></div>    
</body>
</html>