<html>
<head>
<title>How To Create Modern NPM Packages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建现代NPM包</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-modern-npm-packages-7c41cf610156?source=collection_archive---------5-----------------------#2022-01-18">https://betterprogramming.pub/how-to-create-modern-npm-packages-7c41cf610156?source=collection_archive---------5-----------------------#2022-01-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="aba9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">掌握从创建基本包到CI/CD和ES6支持的所有方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b654f93998e40584b682ac004177af4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GPTaTM69l65XPBvYSoprng.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://www.freepik.com/vectors/icons" rel="noopener ugc nofollow" target="_blank"> Freepik </a></p></figure><p id="a083" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NPM让javascript生态系统中的代码共享和重用变得容易。NPM包也允许你在你的私有项目之间共享代码。因此，您不必在多个项目中复制/粘贴和维护代码。</p><p id="c449" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程将帮助您了解您是在创建您的第一个包，还是想要增强您现有的包。</p><p id="a8c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在继续之前，我假设您对javascript、git和npm有基本的了解。另外，如果您没有npm帐户，<a class="ae ky" href="https://www.npmjs.com/signup" rel="noopener ugc nofollow" target="_blank">现在就创建一个</a>。</p><h1 id="730d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">教程的要点</h1><ul class=""><li id="42f6" class="mn mo it lb b lc mp lf mq li mr lm ms lq mt lu mu mv mw mx bi translated">创建一个基本包</li><li id="e21c" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">本地测试包(包链接)</li><li id="55fa" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">将包发布到npm</li><li id="150e" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">管理包更新、版本控制和重新发布</li><li id="c40a" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">ES6支持</li><li id="e5b8" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">发布的CI/CD工作流</li></ul><h1 id="711a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建基本包</h1><p id="972d" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">创建一个基本包相当简单，由以下步骤组成。</p><h2 id="2a5e" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">1.创建包目录</h2><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="1817" class="ng lw it nt b gy nx ny l nz oa">mkdir test-package</span></pre><p id="b1c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">切换到根目录</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="633d" class="ng lw it nt b gy nx ny l nz oa">cd test-package</span></pre><h2 id="a704" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">2.初始化git</h2><p id="68b1" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">使用git不是必须的，但它使包更容易维护，并让其他人检查您的代码并做出贡献。我们将在教程的后面使用GitHub动作，所以我建议你也使用GitHub。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="963e" class="ng lw it nt b gy nx ny l nz oa">git init<br/>git remote add origin git://git-remote-url</span></pre><p id="550d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在npm包初始化之前初始化git，以便npm在执行<code class="fe ob oc od nt b">npm init</code>时自动为<code class="fe ob oc od nt b">package.json</code>选择git远程URL，并最终将其显示在npm的包页面上。</p><h2 id="d8ce" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">3.初始化npm</h2><p id="cb48" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">json是告诉NPM你的包是做什么的方法。<code class="fe ob oc od nt b">name</code>和<code class="fe ob oc od nt b">main</code>字段为必填项。每个包名应该是唯一的。如果您想要的软件包名称已经存在，那么您可以创建一个以您的npm用户名为前缀的作用域软件包。例如</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="c883" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将创建一个作用域包</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="41da" class="ng lw it nt b gy nx ny l nz oa">npm init --scope @your-npm-username</span></pre><p id="0cf4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想创建一个未打包的包，您也可以这样做。</p><p id="96fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用上面的命令，让我们给我们的包命名为<code class="fe ob oc od nt b">test-package</code>，入口点为<code class="fe ob oc od nt b">index.js</code>。package.json将如下所示</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="c214" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当我们发布我们的包时，它将在以下URL可用。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="fa0f" class="ng lw it nt b gy nx ny l nz oa"><a class="ae ky" href="https://npmjs.com/package/@your-npm-username/test-package" rel="noopener ugc nofollow" target="_blank">https://npmjs.com/package/@your-npm-username/test-package</a></span></pre><h2 id="939c" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">4.添加自述文件</h2><p id="5b11" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这不是必须的，但是要加上去，这样别人才能理解你的包装。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="8c13" class="ng lw it nt b gy nx ny l nz oa">touch README.md</span></pre><p id="c130" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">增加以下内容</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="35ac" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">5.添加包装代码</h2><p id="5c14" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我们已经用git和npm配置了我们的包。是时候将实际功能添加到我们的包中了。</p><p id="0f87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简单起见，我们将只添加两个函数。在您的包的根目录下创建一个文件<code class="fe ob oc od nt b">index.js</code>,并将下面的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="6297" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记住，在上一步中，我们将入口点设置为<code class="fe ob oc od nt b">index.js</code>。所以当有人从我们的包中导入任何东西时，npm会查看这个文件。</p><p id="9f9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的包的功能很简单，但这并不重要，因为对于任何类型的javascript包，过程都是一样的。</p><p id="9461" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的文件夹结构应该如下所示</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><h1 id="167f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">本地测试包(包链接)</h1><p id="2083" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">如果你想马上发布你的包，你可以跳过这一部分。通常，您应该在发布到npm之前进行测试。</p><p id="ee41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">若要在本地测试包，请从包的根目录运行以下命令。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="7064" class="ng lw it nt b gy nx ny l nz oa">npm link</span></pre><p id="840a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在全局文件夹中创建一个符号链接，链接到执行<code class="fe ob oc od nt b">npm link</code>命令的包。简单地说，您的包代码将被移动到您的全局node_modules所在的目录中，但是作为一个到包的原始位置的快捷方式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/c1750f8479fe84c2522d83449c2de748.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pDUHCgOj3eCc_OkcwPxq1g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">NPM包装链接</p></figure><p id="7385" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，假设你有另一个应用程序，你想使用你的<code class="fe ob oc od nt b">test-package</code>作为依赖。你要做的就是</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="3bf2" class="ng lw it nt b gy nx ny l nz oa">npm link test-package</span><span id="8b70" class="ng lw it nt b gy oh ny l nz oa">// OR, if you created a scoped package in the previous step</span><span id="111e" class="ng lw it nt b gy oh ny l nz oa">npm link @your-npm-username/test-package</span></pre><p id="5a84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将告诉npm在全局node_modules文件夹中寻找一个包<code class="fe ob oc od nt b">@your-npm-username/test-package</code>，如果找到了，NPM将使用它。</p><p id="1d05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后你可以在你的应用中使用它</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例应用程序中的test.js文件</p></figure><p id="321a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们没有发布/安装我们的包，只是链接了它。所以运行<code class="fe ob oc od nt b">node test.js</code>会在控制台中打印3。这就是在发布之前测试包的方式。</p><h1 id="14de" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">将包发布到NPM</h1><p id="63e5" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">现在，我们已经创建了我们的包并在本地测试了它。是时候发布到npm注册表了。为此，运行以下命令</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="4bac" class="ng lw it nt b gy nx ny l nz oa"><em class="oi">// By default, npm tries to publish a private package</em><br/>npm publish --access public</span></pre><p id="acb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦上面的命令完成。您可以像使用其他npm软件包一样下载和使用该软件包</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="4722" class="ng lw it nt b gy nx ny l nz oa">npm i @your-username/your-pacakge-name</span></pre><h1 id="258f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">管理更新、版本控制和重新发布</h1><p id="2ad8" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">每次对包进行更新时，都应该在package.json文件中发布一个包含更新版本的新版本。</p><p id="afeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们更新一下代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">索引. js</p></figure><p id="ef01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提交您的更改并更新package.json中的<code class="fe ob oc od nt b">version</code>属性。您可以从编辑器中手动更新该属性，但是npm提供了一种更好的方法。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="42e0" class="ng lw it nt b gy nx ny l nz oa">npm version patch</span></pre><p id="f4c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的命令会将package.json中的包版本从<code class="fe ob oc od nt b">1.0.0</code>更新为<code class="fe ob oc od nt b">1.0.1</code>，并且还会提交一个git。</p><p id="edd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，运行<code class="fe ob oc od nt b">npm publish</code>来重新发布包，运行<code class="fe ob oc od nt b">git push</code>来将更改推送到GitHub。</p><h2 id="c393" class="ng lw it bd lx nh ni dn mb nj nk dp mf li nl nm mh lm nn no mj lq np nq ml nr bi translated">语义版本控制</h2><p id="8d30" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">NPM遵循<a class="ae ky" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">语义版本化</a>。下面是如何使用语义版本化来指定包的更新类型</p><ul class=""><li id="044c" class="mn mo it lb b lc ld lf lg li oj lm ok lq ol lu mu mv mw mx bi translated">补丁发布:当你修复一个bug时使用它，例如，它将<code class="fe ob oc od nt b">1.2.1</code>更新为<code class="fe ob oc od nt b">1.2.2</code></li><li id="f769" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">次要版本:当您添加新功能并确保它不会破坏任何以前的功能时，请使用此版本。例如，它将<code class="fe ob oc od nt b">1.2.2</code>更新为<code class="fe ob oc od nt b">1.3.0</code></li><li id="ac1e" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">主要版本:当你对你的包做突破性的改变时使用它。例如，它将<code class="fe ob oc od nt b">1.3.0</code>更新为<code class="fe ob oc od nt b">2.0.0</code></li></ul><p id="b843" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以使用以下npm命令来实现这一点。</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="ed50" class="ng lw it nt b gy nx ny l nz oa">npm version major|minor|patch</span></pre><h1 id="98c0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">添加ES6支持</h1><p id="ae76" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我们可能希望在源代码中使用最新的JavaScript特性，比如ES6模块的<code class="fe ob oc od nt b">import/export</code>语法。</p><p id="56d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，我们要做的是</p><ul class=""><li id="cc1a" class="mn mo it lb b lc ld lf lg li oj lm ok lq ol lu mu mv mw mx bi translated">创建一个<code class="fe ob oc od nt b">src</code>文件夹来保存我们的ES6代码</li><li id="0f31" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">在名为<code class="fe ob oc od nt b">lib</code>的文件夹中添加babel，将我们的ES6代码转换成ES5</li><li id="db42" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">添加<code class="fe ob oc od nt b">.npmignore</code>，类似于<code class="fe ob oc od nt b">.gitignore</code>，但忽略<code class="fe ob oc od nt b">src</code>目录而不是<code class="fe ob oc od nt b">lib</code></li></ul><p id="6e9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个新目录<code class="fe ob oc od nt b">src</code>并将我们的<code class="fe ob oc od nt b">index.js</code>文件移到这里。修改该文件的内容以使用ES6语法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有ES6代码的src/index.js</p></figure><p id="808a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们将babel安装为一个开发依赖项</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="b41a" class="ng lw it nt b gy nx ny l nz oa">npm i -D @babel/core @babel/cli @babel/preset-env</span></pre><p id="20dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在包的根目录下添加一个<code class="fe ob oc od nt b">.babelrc</code>文件，内容如下。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。巴勒克</p></figure><p id="df89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将以下脚本添加到package.json中。我们告诉babel获取我们<code class="fe ob oc od nt b">src/index.js</code>中的所有内容，将其转换为ES5，并将输出放在名为<code class="fe ob oc od nt b">lib</code>的新目录中</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="fffc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们的入口点现在将指向编译后的es5代码。</p><p id="3179" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，设置。吉西诺和。npmignore文件</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。gitignore</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。npmignore</p></figure><p id="eec3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要发布更新的包，请执行以下操作</p><ul class=""><li id="d7ec" class="mn mo it lb b lc ld lf lg li oj lm ok lq ol lu mu mv mw mx bi translated">运行<code class="fe ob oc od nt b">npm run build</code>,你会看到一个目录<code class="fe ob oc od nt b">lib</code>,里面有你的ES5代码</li><li id="7470" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">提交您的更改并运行<code class="fe ob oc od nt b">npm version patch</code></li><li id="74f9" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">运行<code class="fe ob oc od nt b">npm publish</code>将包发布到npm，运行<code class="fe ob oc od nt b">git push</code>将更改推送到GitHub</li></ul><h1 id="15b4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">发布包的CI/CD工作流</h1><p id="8df5" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">为了避免每次更新我们的包时都创建build并运行<code class="fe ob oc od nt b">npm publish</code>,我们可以使用CI/CD管道来完成这项工作。</p><p id="6aef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其思想是，每当我们将任何提交推送到主分支时，我们将触发一个工作流，该工作流将获取我们的包的最新源代码，并尝试将其推送到npm。</p><p id="5a7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在你的项目根目录下添加<code class="fe ob oc od nt b">.github</code>目录，在里面创建一个<code class="fe ob oc od nt b">workflows</code>目录，并制作一个文件<code class="fe ob oc od nt b">publish.yml</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">文件夹结构</p></figure><p id="8036" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并在其中添加以下内容。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="4ccb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第31行，你可以看到我们使用了npm秘密，这个秘密告诉NPM我们在工作流环境中的身份。在以下位置为您自己生成发布访问令牌</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="f4f6" class="ng lw it nt b gy nx ny l nz oa"><a class="ae ky" href="https://www.npmjs.com/settings/haseebanwar/tokens/create" rel="noopener ugc nofollow" target="_blank">https://https://www.npmjs.com/settings/your-username/tokens/create</a></span></pre><p id="a8d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于令牌是敏感信息，我们没有将它硬编码到我们的工作流文件中，而是保存在GitHub的存储库secrets中。因此，GitHub可以安全地将其传递到我们的工作流中。</p><p id="4034" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在这里为您的存储库创建新的密码</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="9aeb" class="ng lw it nt b gy nx ny l nz oa"><a class="ae ky" href="https://github.com/haseebanwar/test-pkg/settings/secrets/actions/new" rel="noopener ugc nofollow" target="_blank">https://github.com/your-username/repository-name/settings/secrets/actions/new</a></span></pre><p id="fe8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在这样做之后，提交您的更改，运行<code class="fe ob oc od nt b">npm version patch</code>，并将更改推送到GitHub，转到Actions选项卡，您将看到一个正在运行的工作流，它会将我们的包发布到npm。</p><p id="82f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:不要忘记在你的文件夹中添加<code class="fe ob oc od nt b">.github/</code>文件夹。npmignore文件。</p></div><div class="ab cl om on hx oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="im in io ip iq"><p id="71ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是我们刚刚制作的包的<a class="ae ky" href="https://github.com/haseebanwar/test-package" rel="noopener ugc nofollow" target="_blank">代码库</a>和<a class="ae ky" href="https://www.npmjs.com/package/@haseebanwar/test-package" rel="noopener ugc nofollow" target="_blank"> npm页面</a>。</p><h1 id="abfc" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">下一步是什么？</h1><p id="f35f" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">对于更高级的包，我们可以设置ESLint，或者不同种类的构建，比如UMD，但是这些需求会随着你创建的包的性质而变化。很多时候，我们所做的都是必须的。</p><p id="26be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在这里提到了它们，所以如果你愿意，你可以深入研究它们。也许我以后会写那些。所以，请继续关注，并在评论中让我知道你的反馈。</p><p id="d450" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p></div></div>    
</body>
</html>