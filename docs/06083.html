<html>
<head>
<title>Xcode Command-Line Tools: Use Cases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Xcode命令行工具:用例</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/xcode-command-line-tools-use-cases-6eb331eda99d?source=collection_archive---------7-----------------------#2020-09-01">https://betterprogramming.pub/xcode-command-line-tools-use-cases-6eb331eda99d?source=collection_archive---------7-----------------------#2020-09-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a2aa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建、归档、测试、创建XCFramework、注入通知和模拟深度链接</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e7834c1b6168a448fd6366d1a644f971.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eH4DDaCBLTUSVOFxNfkVSg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="bfd3" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">介绍</h1><p id="6de5" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">在这个简短的教程中，我将向您介绍一些有用的<a class="ae mt" href="https://developer.apple.com/documentation/" rel="noopener ugc nofollow" target="_blank"> Xcode </a>命令行工具，并展示您可以利用其潜力的有用用例。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="391d" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">1.用例:构建工作流</h1><p id="a13b" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">CI/CD现在很流行，你可以对你的库设置的一个基本检查是确保你的所有目标都被构建。让我们来看看一些有用的命令。但是首先，打开您的终端并运行<code class="fe mu mv mw mx b">cd path_to_your_project_folder</code>。</p><h2 id="5c28" class="my lg it bd lh mz na dn ll nb nc dp lp mg nd ne lr mk nf ng lt mo nh ni lv nj bi translated">显示生成设置</h2><p id="bba4" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">以下命令将输出包含所有项目设置的列表:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="1474" class="my lg it mx b gy no np l nq nr">xcodebuild -project MyProject.xcodeproj -showBuildSettings</span></pre><p id="fb38" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated">如果你正在寻找一个特别的，使用<code class="fe mu mv mw mx b">grep</code>来过滤。例如，要查找您的构建目录(<code class="fe mu mv mw mx b">BUILD_DIR</code>):</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="4fef" class="my lg it mx b gy no np l nq nr">xcodebuild -project MyProject.xcodeproj -showBuildSettings | grep -m 1 "BUILD_DIR" | grep -oEi "\/.*"</span></pre><p id="03d1" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated"><strong class="lz iu">注:</strong>也可以用<code class="fe mu mv mw mx b">-workspace MyWorkspace.xcworkspace</code>代替<code class="fe mu mv mw mx b">-project MyProject.xcproject</code>。这也适用于以下所有命令。</p><h2 id="8587" class="my lg it bd lh mz na dn ll nb nc dp lp mg nd ne lr mk nf ng lt mo nh ni lv nj bi translated">建立一个计划</h2><p id="c2a4" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">要构建您的方案，您可以运行:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="f865" class="my lg it mx b gy no np l nq nr">xcodebuild clean -scheme MyScheme \<br/>                 -project MyProject.xcodeproj \<br/>                 -destination SomeDeviceOrSimulator</span></pre><p id="58f4" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated">如果你想要一个全新的版本，在<code class="fe mu mv mw mx b">build</code>前加上<code class="fe mu mv mw mx b">clean</code>:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="48fd" class="my lg it mx b gy no np l nq nr">xcodebuild clean build  -scheme MyScheme \<br/>                        -project MyProject.xcodeproj \<br/>                        -destination "platform=macOS"</span></pre><p id="99de" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated">以下是一些您可以选择的目的地:</p><ul class=""><li id="02d7" class="nx ny it lz b ma ns md nt mg nz mk oa mo ob ms oc od oe of bi translated"><code class="fe mu mv mw mx b">"platform=macOS"</code></li><li id="d122" class="nx ny it lz b ma og md oh mg oi mk oj mo ok ms oc od oe of bi translated"><code class="fe mu mv mw mx b">"platform=macOS,variant=Mac Catalyst"</code></li><li id="5e3d" class="nx ny it lz b ma og md oh mg oi mk oj mo ok ms oc od oe of bi translated"><code class="fe mu mv mw mx b">"platform=iOS"</code></li><li id="1a1f" class="nx ny it lz b ma og md oh mg oi mk oj mo ok ms oc od oe of bi translated"><code class="fe mu mv mw mx b">"platform=tvOS"</code></li><li id="350c" class="nx ny it lz b ma og md oh mg oi mk oj mo ok ms oc od oe of bi translated"><code class="fe mu mv mw mx b">"platform=watchOS"</code></li><li id="b256" class="nx ny it lz b ma og md oh mg oi mk oj mo ok ms oc od oe of bi translated"><code class="fe mu mv mw mx b">"platform=iOS Simulator"</code></li><li id="4cc8" class="nx ny it lz b ma og md oh mg oi mk oj mo ok ms oc od oe of bi">…</li></ul><p id="2e89" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated">也可以选择具体的架构:<code class="fe mu mv mw mx b">"platform=macOS,arch=arm64"</code>。</p><h2 id="cf41" class="my lg it bd lh mz na dn ll nb nc dp lp mg nd ne lr mk nf ng lt mo nh ni lv nj bi translated">行动中的用例</h2><p id="0c46" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">这就是你如何在CI工作流程中利用<code class="fe mu mv mw mx b">xcodebuild</code>来构建你的所有目标:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="1cce" class="my lg it mx b gy no np l nq nr">SCHEMES=( Target1_iOS Target1_macOS Target2 )<br/>PLATFORMS=( "platform=iOS" "generic/platform=macOS" "generic/platform=iOS" )</span><span id="ee80" class="my lg it mx b gy ol np l nq nr">DIR=$(xcodebuild -project MyProject.xcodeproj -showBuildSettings | grep -m 1 "BUILD_DIR" | grep -oEi "\/.*")</span><span id="2e21" class="my lg it mx b gy ol np l nq nr">for i in ${!SCHEMES[@]}; do<br/>  xcodebuild clean build  -scheme ${SCHEMES[$i]} \<br/>                          -project MyProject.xcodeproj \<br/>                          -destination "${PLATFORMS[$i]}"</span><span id="7a22" class="my lg it mx b gy ol np l nq nr">  COUNT=$(find $DIR -maxdepth 1 -type d | wc -l)</span><span id="1750" class="my lg it mx b gy ol np l nq nr">  if [ $COUNT -eq 2 ]; then<br/>    echo "$(tput setaf 2)Build succeded for target ${SCHEMES[$i]}$(tput sgr0)"<br/>  else<br/>    echo "$(tput setaf 1)Build failed for target ${SCHEMES[$i]}$(tput sgr0)"<br/>  exit 1<br/>  fi</span><span id="92eb" class="my lg it mx b gy ol np l nq nr">done</span></pre><p id="fcaf" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated">这个脚本执行一个<code class="fe mu mv mw mx b">for</code>循环来构建所有的目标，并验证构建是否成功。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="e627" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">2.用例:生成XCFramework</h1><p id="868b" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">CI工作流中的另一个常见操作是，一旦您发布了您的发行版并将生成的二进制文件附加到其上，就生成一个XCFramework，以支持手动安装(在文章<a class="ae mt" href="https://medium.com/better-programming/continuous-integration-with-github-actions-fccc5a339b75" rel="noopener">与GitHub操作的持续集成</a>中了解更多信息)。</p><h2 id="ef4c" class="my lg it bd lh mz na dn ll nb nc dp lp mg nd ne lr mk nf ng lt mo nh ni lv nj bi translated">存档方案</h2><p id="2f6f" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">要存档一个方案，使用<code class="fe mu mv mw mx b">xcodebuild</code>:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="7bff" class="my lg it mx b gy no np l nq nr">xcodebuild archive -scheme MyScheme \<br/>                   -destination "platform=macOS" \<br/>                   -archivePath "./MyScheme.macOS.xcarchive" \<br/>                   SKIP_INSTALL=NO \<br/>                   BUILD_LIBRARY_FOR_DISTRIBUTION=YES</span></pre><p id="5937" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated">该命令将在与所选目标兼容的所选路径中生成一个<code class="fe mu mv mw mx b">.archive</code>文件。和以前一样，你也可以加上<code class="fe mu mv mw mx b">clean</code>:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="53df" class="my lg it mx b gy no np l nq nr">xcodebuild clean archive -scheme MyScheme \<br/>                         -destination "platform=macOS" \<br/>                         -archivePath "./MyScheme.macOS.xcarchive" \<br/>                         SKIP_INSTALL=NO \<br/>                         BUILD_LIBRARY_FOR_DISTRIBUTION=YES</span></pre><h2 id="44dd" class="my lg it bd lh mz na dn ll nb nc dp lp mg nd ne lr mk nf ng lt mo nh ni lv nj bi translated">创建XCFramework</h2><p id="71bc" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">要创建一个XCFramework，<em class="om"> </em>在归档您的方案后使用<code class="fe mu mv mw mx b">-create-xcframework</code>，并传递归档路径:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="26d1" class="my lg it mx b gy no np l nq nr">xcodebuild -create-xcframework \<br/>           -framework "path_to_archived_framework_1" \<br/>           -framework "path_to_archived_framework_2"<br/>           -output "MyProject.xcframework"</span></pre><p id="24ff" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated">您可以使用这两个命令非常容易地创建另一个脚本来在您的CI工作流中运行，类似于前面看到的脚本。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="1972" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">3.用例:运行测试</h1><p id="7ed6" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">与前面的用例类似，Xcode允许您从命令行运行测试。</p><h2 id="68a7" class="my lg it bd lh mz na dn ll nb nc dp lp mg nd ne lr mk nf ng lt mo nh ni lv nj bi translated">运行测试方案</h2><p id="8c58" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">如果您的项目或工作区有特定的测试方案，那么您可以从命令行运行它们:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="facf" class="my lg it mx b gy no np l nq nr">xcodebuild test -scheme MyScheme \<br/>                -project MyProject.xcodeproj \<br/>                -destination 'platform=OS X,arch=x86_64'</span></pre><h2 id="bb3f" class="my lg it bd lh mz na dn ll nb nc dp lp mg nd ne lr mk nf ng lt mo nh ni lv nj bi translated">对您的Swift包运行测试</h2><p id="d81e" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">如果您没有项目文件，但有Swift包，您可以运行:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="230a" class="my lg it mx b gy no np l nq nr">swift test</span></pre></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="344c" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">4.用例:模拟深度链接和通知</h1><p id="97fc" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">深度链接和通知是一些更难在设备中测试的功能。幸运的是，Xcode命令行工具有一个解决方案。</p><h2 id="56cb" class="my lg it bd lh mz na dn ll nb nc dp lp mg nd ne lr mk nf ng lt mo nh ni lv nj bi translated">深层链接</h2><p id="550a" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">在代码中的任何地方，您都可以运行:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="1616" class="my lg it mx b gy no np l nq nr">xcrun simctl openurl booted &lt;INSERT_URL_HERE&gt;</span></pre><p id="8046" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated"><strong class="lz iu">注意:</strong>URL应该包含一个你的应用可以识别的方案。参见文章<a class="ae mt" href="https://medium.com/better-programming/deep-links-universal-links-and-the-swiftui-app-life-cycle-e98e38bcef6e#Setting-App-Deep-Links" rel="noopener">深度链接、通用链接和SwiftUI应用生命周期</a>中的如何设置您的deeplink(或通用链接)。</p><h2 id="843a" class="my lg it bd lh mz na dn ll nb nc dp lp mg nd ne lr mk nf ng lt mo nh ni lv nj bi translated">通知</h2><p id="4cae" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">从11.4开始，Xcode增加了一种模拟通知的方式。您只需使用通知的有效负载创建一个APNS文件:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="2f51" class="my lg it mx b gy no np l nq nr">{    <br/>  "aps": {        <br/>    "alert": {<br/>      "title": "Test",<br/>      "body": "Testing notifications in the simulator"<br/>    },<br/>    "sound": "default",<br/>    "badge": 1<br/>}</span></pre><p id="53fb" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated">并运行:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="7e54" class="my lg it mx b gy no np l nq nr"><em class="om">xcrun simctl push &lt;device&gt; &lt;bundle identifier&gt; &lt;APNS file&gt;</em></span></pre><p id="04ef" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated">要获取所有可用设备，您可以运行:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="1a4f" class="my lg it mx b gy no np l nq nr">instruments -s devices</span></pre><p id="43af" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated">或者，如果它已经启动，运行:</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="855d" class="my lg it mx b gy no np l nq nr">xcrun simctl list | grep 'Booted' # Phone: iPhone Xs (AB165068-87DC-43EC-A513-893860CF0615) (Booted)</span></pre><p id="09f2" class="pw-post-body-paragraph lx ly it lz b ma ns ju mc md nt jx mf mg nu mi mj mk nv mm mn mo nw mq mr ms im bi translated">并复制括号中的ID。</p><pre class="kj kk kl km gt nk mx nl nm aw nn bi"><span id="d05e" class="my lg it mx b gy no np l nq nr"><em class="om">xcrun simctl push </em>AB165068-87DC-43EC-A513-893860CF0615 <em class="om">com.example.app push-notification.apns</em></span></pre></div></div>    
</body>
</html>