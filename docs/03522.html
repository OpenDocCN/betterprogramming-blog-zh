<html>
<head>
<title>Containers: Portainer Review</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">集装箱:集装箱审查</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/portainer-review-382575dabb76?source=collection_archive---------3-----------------------#2020-02-15">https://betterprogramming.pub/portainer-review-382575dabb76?source=collection_archive---------3-----------------------#2020-02-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0c1f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Docker容器和群服务的开源管理器</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c104114c4a37e74403a770f5c25d2b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DVNOK9nWjOaxIjKu"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@isaacmsmith?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">艾萨克·史密斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="29ca" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">什么是Portainer？</h1><p id="3435" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated"><a class="ae ky" href="https://github.com/portainer/portainer" rel="noopener ugc nofollow" target="_blank"> Portainer </a>是一个轻量级的管理UI，允许您轻松管理不同的Docker环境。</p><p id="4d12" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">Portainer <strong class="ma iu"> </strong>为通过web界面管理Docker容器和群服务提供了一个简单易行的解决方案。Portainer支持多种用于管理Docker容器的特性，例如管理群服务的创建和删除、用户认证、授权、连接、在运行容器的控制台中执行命令以及查看容器的日志。</p><p id="0b21" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在本文中，我将尝试对Portainer支持的一些特性进行概述和回顾。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="b0d2" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">安装在Swarm上</h1><p id="d2df" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">为了能够在Swarm集群上运行Portainer，您需要部署两个服务。第一个是代理服务，它应该运行在Swarm集群的每个节点上。第二个服务是<code class="fe mz na nb nc b">portainer-ui</code>，这个服务必须只部署在管理器节点上，以便能够按预期运行Portainer。这个事实可以被认为是一个缺点，因为它会阻止以<code class="fe mz na nb nc b">DRAIN </code>模式运行管理器，这是Swarm推荐的模式。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="f74b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">上面的文件是<code class="fe mz na nb nc b">docker-compose</code>文件，可以用来在Docker Swarm集群中部署Portainer。要执行部署，请确保替换了所有占位符，然后执行以下命令。</p><pre class="kj kk kl km gt nf nc ng nh aw ni bi"><span id="bb12" class="nj lh it nc b gy nk nl l nm nn">$&gt; docker stack deploy -c docker-compose.yml p<!-- -->ortainer</span></pre></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="5da9" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">顶级功能</h1><h2 id="066a" class="nj lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">证明</h2><p id="4a32" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Portainer支持三种不同的用户认证方法。第一种是<code class="fe mz na nb nc b">internal</code>方法，用户管理由Portainer <strong class="ma iu"> <em class="nz"> </em> </strong>处理，存储在Portainer data文件夹中。第二种方法是<code class="fe mz na nb nc b">LDAP</code>，用户由外部LDAP服务器管理，比如ActiveDirectory。我认为<code class="fe mz na nb nc b">LDAP</code>认证的唯一缺点是它不能使用环境变量进行配置。最终的认证方法是使用<code class="fe mz na nb nc b">OAuth</code>来执行认证。(此功能需要购买一个付费扩展。)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/375ee7f5b683e35df993cbb825adc2f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r_6Q2_Le9J87Er6TanXHWQ.png"/></div></div></figure><h2 id="2f55" class="nj lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">管理多个集群(端点)</h2><p id="5163" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如下图所示，Portainer支持使用其用户界面管理多个Docker Swarm集群(称为<em class="nz">端点</em>)。如果您希望在单个用户界面中管理不同环境(如测试、试运行和生产)的集群，这个特性非常有用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/26501ce87f77420070a46c055612da45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lIakz6pMdntLCNk-VB-sfA.png"/></div></div></figure><h2 id="ecf0" class="nj lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">模板</h2><p id="7899" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Portainer允许最终用户从预定义的模板中部署通用Docker群服务或Docker容器。这些模板要么是Portainer自带的，要么是最终用户自己定义的。用户定义的模板可用于通过三种模式部署服务:</p><ul class=""><li id="e397" class="oc od it ma b mb mu me mv mh oe ml of mp og mt oh oi oj ok bi translated">单Docker容器—通过定义创建容器所需的所有配置</li><li id="f1fd" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">Docker群服务——通过提供堆栈或服务文件的链接</li><li id="6e31" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">Docker容器——使用一个<code class="fe mz na nb nc b">docker-compose</code>文件</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/c82bd84d364bdce2d21d74c28fe2cd7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F8sQFdMUbmgSAateN6ZlGg.png"/></div></div></figure><h2 id="a8a8" class="nj lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">查看Docker资源</h2><p id="282e" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Portainer提供的另一个重要特性是能够查看、交互和管理Docker群资源，如群服务、Docker网络、群堆栈、容器和Docker图像。</p><p id="1172" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">Portainer允许最终用户以一种简单、直观的方式查看这些资源并与之交互。因此，最终用户不需要连接到群集群并从一个节点移动到另一个节点来验证和检查服务和容器。例如，最终用户可以列出部署到给定集群的所有服务，更新这些服务的配置项，并根据需要从web界面停止和启动服务。</p><h2 id="6bde" class="nj lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">对容器执行操作</h2><p id="fda0" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这个特性与前一个特性高度相关，但是因为可以在容器上执行的操作非常重要和有用，所以我想强调这些特性。</p><p id="bc75" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">通常在Docker Swarm集群中，如果工程师想要检查给定的容器，检查容器日志，或者连接到Docker容器内部的shell，他们需要执行以下操作。首先，连接到一个管理器节点。然后检查服务的容器部署在哪里(在哪个worker节点)。之后，连接到worker节点并在容器上执行所需的操作。</p><p id="9ca0" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">托管Portainer时，不需要所有这些操作。同样的目标可以直接从web界面实现，不需要连接到任何集群节点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/66e93d99cfb408600edf1d719d189a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hzh7jK6v3GW4d-Hz7j2KHw.png"/></div></div></figure><p id="eed7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如上图所示，最终用户能够对运行在Swarm集群上的任何容器执行以下操作:</p><ul class=""><li id="e0dd" class="oc od it ma b mb mu me mv mh oe ml of mp og mt oh oi oj ok bi translated">执行部署命令(启动、停止、终止、重启)</li><li id="e475" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">查看容器的日志</li><li id="0c41" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">检查容器的配置</li><li id="c0a4" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">查看容器资源使用情况，如CPU使用情况和内存使用情况</li><li id="a136" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">打开正在运行的Docker容器中的控制台或shell(您可以指定一个自定义命令)</li><li id="7e52" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">连接到正在运行的Docker容器，并观察日志的实时视图</li></ul><h2 id="29e8" class="nj lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">用户授权和资源所有权</h2><p id="9818" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Portainer允许我们配置Portainer管理的每个资源的所有者，例如堆栈、Docker服务和Docker容器。Portainer提供了三个选项，用于选择这些资源的所有者。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/7bf868d06856ca7bdcf7e0e7a789efbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLy9_WtIqbd-LZOxVGa4mw.png"/></div></div></figure><ul class=""><li id="1398" class="oc od it ma b mb mu me mv mh oe ml of mp og mt oh oi oj ok bi translated">第一个选项是<code class="fe mz na nb nc b">administrators</code>，这意味着只有admin用户能够管理这个资源。</li><li id="e2a7" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">第二个是<code class="fe mz na nb nc b">restricted</code>选项。此选项允许将管理资源的权限限制在一组特定的用户。允许向单个用户或团队授予访问权限。</li><li id="1487" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">第三个选项是<code class="fe mz na nb nc b">public</code>，这意味着任何访问Docker端点的用户都能够管理资源。</li></ul><p id="04e4" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">Portainer包含和支持的功能比上面介绍的更多。然而，上述特性是Portainer支持的最有用的特性。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="8125" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">付费延期</h1><p id="ca27" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Portainer可以通过购买和启用额外的插件来扩展。可用的Portainer插件列表如下所述。</p><h2 id="9488" class="nj lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">注册表管理器扩展</h2><p id="7cfc" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这个插件扩展了Portainer，并为最终用户提供了浏览已定义的外部Docker注册表和管理其资源的能力。一旦安装并启用了插件，用户就能够浏览注册表、探索存储库和Docker图像、操作附加到存储库和图像的标签、添加新标签、重新标记图像以及删除现有标签。</p><p id="6426" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">注册表管理器插件有一个简单直观的图形用户界面，使得管理Docker注册表和Swarm集群更加容易，可以从一个界面完成。另一方面，插件还有改进的空间。例如，该插件不支持自动清理Docker注册表和删除旧的和不需要的Docker图像。如果在开发过程中使用Docker注册表，并且工程师正在从应用程序的特性分支构建Docker映像，那么这个特性就非常重要。在这种情况下，插件中最好有一个功能，可以在30天后删除属于该功能分支的所有图像。</p><h2 id="797e" class="nj lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">基于角色的访问控制扩展</h2><p id="2f66" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">基于角色的访问控制扩展(RBAC)扩展了Portainer授权功能，并允许最终用户向一个端点或一组端点内的用户或团队分配角色。安装并启用插件后，有多个不同的预定义角色可用。这些角色描述如下。</p><ul class=""><li id="5b53" class="oc od it ma b mb mu me mv mh oe ml of mp og mt oh oi oj ok bi translated">端点管理员:该角色提供对给定端点内部署的资源的完全控制(仅不包括资源和Portainer内部设置)。</li><li id="f35b" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">标准用户:该角色对用户自己或用户所属团队成员部署的资源拥有完全的控制权。</li><li id="aeaa" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">帮助台:该角色提供对所选端点内所有资源的只读权限。</li><li id="529b" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">只读用户:该角色为选定端点内的资源子集提供只读权限。</li></ul><p id="5da7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">除了上述角色，Portainer还定义了一个内置的管理员角色，该角色不仅授予对端点资源的访问权限，还授予对Portainer设置和所有已定义端点中的所有资源的访问权限。</p><p id="4a77" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在我看来，这个插件是对Portainer web界面的一个很好的补充，然而，我缺少了以下可以进一步改进这个插件的特性。</p><ul class=""><li id="76be" class="oc od it ma b mb mu me mv mh oe ml of mp og mt oh oi oj ok bi translated">创建自定义角色的能力</li><li id="0659" class="oc od it ma b mb ol me om mh on ml oo mp op mt oh oi oj ok bi translated">授予用户对端点内资源子集的管理权限的能力</li></ul><h2 id="2ea4" class="nj lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">外部身份验证扩展</h2><p id="9918" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这个插件可以用来扩展Portainer支持的认证方法。如果认为内部用户管理工作量太大，并且LDAP服务器不可用，那么可以使用这个插件来管理使用OAuth服务的用户认证。</p><p id="2109" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">一旦插件安装并启用，Portainer设置中的额外认证选项将可用。OAuth选项增加了将Portainer连接到Microsoft Azure AD、Google Suite/Cloud身份验证和GitHub身份验证的能力。此外，该插件允许使用自定义选项，通过输入正确的URI字段，您可以连接到任何OAuth提供者。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="16d1" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">结论</h1><p id="4319" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Portainer是一个很棒的工具，可以用来从一个简单直观的web用户界面管理Docker容器、群服务和其他资源。Portainer提供了几个免费功能和付费插件，可以增强用户管理Docker集群的体验。另一方面，一些付费插件仍然有一些限制或缺失的功能，可以改善产品。</p><p id="e12e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">感谢阅读！</p></div></div>    
</body>
</html>