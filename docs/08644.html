<html>
<head>
<title>How To Make Your Static Website Interactively Searchable</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何让你的静态网站可以交互式搜索</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-make-your-static-website-interactively-searchable-ab0091db63b1?source=collection_archive---------6-----------------------#2021-05-25">https://betterprogramming.pub/how-to-make-your-static-website-interactively-searchable-ab0091db63b1?source=collection_archive---------6-----------------------#2021-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1aed" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们创建一个客户端搜索索引</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/060f3d1e8933c9afebebf2895fbb1136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P1CRb_qzzSmZ94Ms"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@markuswinkler?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马库斯·温克勒</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="2237" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，你<em class="lv">可以</em>在你的静态网站上拥有交互式搜索功能！这里不需要服务器或付费订阅。感谢开源的<a class="ae ky" href="https://lunrjs.com/" rel="noopener ugc nofollow" target="_blank"> Lunr </a>和<a class="ae ky" href="https://gohugo.io/" rel="noopener ugc nofollow" target="_blank"> Hugo静态站点生成器</a>的强大功能，你只需要一个模板和一些JavaScript就可以创建一个客户端搜索索引。</p><p id="b652" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的一些读者很友好地告诉我，你觉得我的博客很有用，但是有些事情你不知道。在我最近实现搜索功能之前，我一直是自己最不开心的用户。</p><p id="4fe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的博客供所有人阅读，但它也是我个人的互联网大脑。当我试图重新发现一些我可能有先见之明记录下来的知识时，我经常会打开我写的一篇文章。没有搜索，再次找到它需要几次点击和更多的猜测。现在，我以前的所有发现都唾手可得，随时可以投入到未来更多的工作中。</p><p id="c6c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想让你自己的互联网大脑更有用，下面是你如何在你的静态Hugo网站上实现你自己的搜索功能。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4b92" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">获取Lunr</h1><p id="645b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">虽然您可以<a class="ae ky" href="https://lunrjs.com/guides/getting_started.html" rel="noopener ugc nofollow" target="_blank">通过npm安装lunr.js </a>或者从CDN中包含它，但是我选择出售它以最小化对网络的影响。这意味着我将库放在Hugo的<code class="fe na nb nc nd b">static</code>目录中，从我自己的站点文件中托管它。</p><p id="06f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通过缩小<code class="fe na nb nc nd b">lunr.js</code>来为你的访问者节省一些带宽，我就是通过<a class="ae ky" href="https://github.com/olivernn/lunr.js" rel="noopener ugc nofollow" target="_blank">从源文件</a>下载lunr.js并在文件上使用<a class="ae ky" href="https://github.com/olback/es6-css-minify" rel="noopener ugc nofollow" target="_blank">JS&amp;CSS Minifier Visual Studio代码扩展</a>来做到这一点的。这使得大小从97.5 KB下降到39.35 KB，降幅约为60%。</p><p id="293d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将此另存为<code class="fe na nb nc nd b">static/js/lunr.min.js</code>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="457a" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">创建部分搜索表单</h1><p id="606c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">要轻松地将您的搜索表单放在网站上您喜欢的任何位置，请在<code class="fe na nb nc nd b">layouts/partials/search-form.html</code>将表单创建为部分模板:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="8582" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在其他模板中包含您的搜索表单，包括:</p><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="014f" class="nk me it nd b gy nl nm l nn no">{{ partial "search-form.html" . }}</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="c726" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">创建搜索页面</h1><p id="ca87" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为了让你的搜索有用，你需要一个触发搜索的方法。您可以创建一个(静态！)<code class="fe na nb nc nd b">/search</code>响应GET请求、运行搜索并显示结果的页面。</p><p id="80ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是如何为一个搜索页面创建Hugo模板文件，并让它呈现出来。</p><p id="deee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用下面最少的标记创建<code class="fe na nb nc nd b">layouts/search/list.html</code>，假设您是从基础模板继承而来的<a class="ae ky" href="https://gohugo.io/templates/base" rel="noopener ugc nofollow" target="_blank">:</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="565e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了让Hugo呈现模板，必须有一个匹配的内容文件。创造<code class="fe na nb nc nd b">content/search/_index.md</code>来满足这个要求。文件只需要最少的<a class="ae ky" href="https://gohugo.io/content-management/front-matter" rel="noopener ugc nofollow" target="_blank">前置素材</a>渲染:</p><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="570f" class="nk me it nd b gy nl nm l nn no">---<br/>title: Search me!<br/>---</span></pre><p id="a949" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以运行<code class="fe na nb nc nd b">hugo serve</code>并导航到<code class="fe na nb nc nd b">/search</code>来查看是否一切如预期构建。</p><p id="3ca1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有几个库可以帮助您构建搜索索引和实现Lunr。你可以在Hugo网站找到它们<a class="ae ky" href="https://gohugo.io/tools/search/" rel="noopener ugc nofollow" target="_blank">。然而，如果你想完全理解这个过程，你会发现，由于Hugo的静态站点处理能力，没有额外的依赖，这样做并不复杂。</a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8b42" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">构建您的搜索索引</h1><p id="a5d6" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">下面是如何使用Hugo的模板渲染能力为Lunr构建一个索引进行搜索。使用<code class="fe na nb nc nd b">range</code>循环浏览您想要搜索的页面，并在一系列文档中获取您想要的参数。一种方法是创建<code class="fe na nb nc nd b">layouts/partials/search-index.html</code>,使用:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="a3cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当Hugo渲染你的站点时，它会像构建列表页面一样构建你的搜索索引，用它的参数为每个页面创建一个文档。</p><p id="105c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拼图的最后一块是处理搜索过程的代码:接受搜索查询，让Lunr执行搜索，并显示结果。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8ad6" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">执行搜索并显示结果</h1><p id="e8ee" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">创建<code class="fe na nb nc nd b">static/js/search.js</code>来保存将它们联系在一起的JavaScript。这个文件有三个主要任务:获取搜索查询，用Lunr执行搜索，并显示结果。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a429" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">用JavaScript获取查询参数</h1><p id="db59" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">感谢<code class="fe na nb nc nd b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams" rel="noopener ugc nofollow" target="_blank">URLSearchParams</a></code>，这部分很简单:</p><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="2c0b" class="nk me it nd b gy nl nm l nn no">const params = new URLSearchParams(window.location.search)<br/>const query = params.get('q')</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2ccc" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用Lunr搜索查询</h1><p id="89c3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为Lunr 定义并配置一个<a class="ae ky" href="https://lunrjs.com/guides/getting_started.html#creating-an-index" rel="noopener ugc nofollow" target="_blank">索引。这告诉Lunr你想搜索什么，你可以选择更重要的元素。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="31ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以使用以下命令执行搜索并存储结果:</p><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="68d9" class="nk me it nd b gy nl nm l nn no">const results = idx.search(query)</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4408" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">显示结果</h1><p id="2fab" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">您将需要一个函数来构建一个结果列表，并将它们显示在您的搜索页面上。回忆一下您在<code class="fe na nb nc nd b">layouts/search/list.html</code>中赋予<code class="fe na nb nc nd b">ul</code>元素的<code class="fe na nb nc nd b">id</code>，并将其存储为一个变量:</p><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="cc46" class="nk me it nd b gy nl nm l nn no">const searchResults = document.getElementById('results')</span></pre><p id="ff77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一个搜索产生了一些结果，您可以对它们进行迭代，并为每个结果构建一个<code class="fe na nb nc nd b">&lt;li&gt;</code>元素:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="4c86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于您的每个结果，这会生成一个类似于以下内容的列表项:</p><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="1516" class="nk me it nd b gy nl nm l nn no">&lt;li&gt;<br/>&lt;p&gt;<br/>&lt;a href=".../blog/add-search-to-hugo-with-lunr/"&gt;<br/>Add search to Hugo static sites with Lunr<br/>&lt;/a&gt;<br/>&lt;/p&gt;<br/>&lt;p&gt;Yes, you can have an interactive search feature on your static site!...&lt;/p&gt;<br/>&lt;/li&gt;</span></pre><p id="66d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果没有结果，则插入一条消息:</p><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="7f49" class="nk me it nd b gy nl nm l nn no">else {<br/>searchResults.innerHTML = 'No results found.'<br/>}</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4868" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">search.js的完整代码</h1><p id="529d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">下面是<code class="fe na nb nc nd b">static/js/search.js</code>的完整版:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="26b9" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">让它走</h1><p id="4f59" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">现在已经有了Lunr、搜索索引和显示结果的代码。因为这些都包含在<code class="fe na nb nc nd b">layouts/partials/search-index.html</code>中，所以用一个搜索表单在所有页面上添加这个部分。在您的页脚中，放置:</p><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="d23e" class="nk me it nd b gy nl nm l nn no">{{ partial "search-index.html" . }}</span></pre><p id="8123" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通过在我的博客上试用<a class="ae ky" href="https://victoria.dev/blog" rel="noopener ugc nofollow" target="_blank">来看看这是什么样子。</a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a4a3" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">让它跑得更快</h1><p id="9e64" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">因为你的站点是静态的，所以可以把你的搜索索引<a class="ae ky" href="https://lunrjs.com/guides/index_prebuilding.html" rel="noopener ugc nofollow" target="_blank">预先构建成一个JSON数据文件供Lunr加载。这就是前面提到的那些库</a><a class="ae ky" href="https://gohugo.io/tools/search/" rel="noopener ugc nofollow" target="_blank">可能有用的地方，因为JSON格式的搜索索引需要在运行<code class="fe na nb nc nd b">hugo</code>之外构建，以生成您的站点。</a></p><p id="31af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过缩小资产和最小化计算开销或在代码中阻止JavaScript来最大化您的搜索速度。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="224f" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">静态网站也可以搜索！</h1><p id="5658" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我希望这能帮助你让你的互联网大脑对自己和他人更有用！如果您今天没有时间实现搜索功能，也不要担心。当你访问<a class="ae ky" href="https://victoria.dev/blog" rel="noopener ugc nofollow" target="_blank">我的博客</a>并搜索这篇文章时，你可以再次找到这篇教程！</p></div></div>    
</body>
</html>