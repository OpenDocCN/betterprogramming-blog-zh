<html>
<head>
<title>An Alternative to Python Dictionaries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python字典的替代品</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/an-alternative-to-python-dictionaries-5d54aa4c5a6?source=collection_archive---------1-----------------------#2021-04-06">https://betterprogramming.pub/an-alternative-to-python-dictionaries-5d54aa4c5a6?source=collection_archive---------1-----------------------#2021-04-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5af7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为什么应该在Python中使用defaultdict</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1a7122fac2b51b7f8643a15cfa1cfa9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dFHcAy2masYialx1"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Sigmund </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="004f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">情况是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/ef0f5ecc0d425f1e375ad23d7f282bfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bvUm7gBpVNGPzgRCbfK3Ng.png"/></div></div></figure><p id="6787" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有一个数字列表，我们想找出列表中每个数字出现的次数。</p><p id="0bca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我通常的做法是用包含所有可能数字的键创建一个字典，并将它们都递增。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/e197e4c2cf4db24da1f6a367b828ce3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5YUypGx4TPF2joua2a1wKA.png"/></div></div></figure><p id="4c8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请密切注意下面的代码片段:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="f466" class="mc md it ly b gy me mf l mg mh">if number not in dict_:<br/>    dict_[number] = 0</span></pre><p id="02ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，在给它赋值之前，我们必须先检查字典中是否存在这个值。如果我们不采取这一步，我们将会在增加键的数量时得到一个错误。</p><p id="4100" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">错误示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="f680" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当字典中不存在相应的键时，就会出现上面的错误。</p><p id="fb87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码的结果:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="2ea6" class="mc md it ly b gy me mf l mg mh">{7: 3, 2: 9, 4: 5, 5: 3, 10: 1, 9: 2, 8: 3, 3: 1, 1: 2, 6: 1}</span></pre><p id="e889" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们肯定可以做得更好。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="2cc6" class="ms md it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">默认字典</h1><p id="13c1" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">通过在字典的基础上构建来处理我们之前的错误。它不像普通词典那样给出一个<code class="fe no np nq ly b">KeyError</code>。但是，每当您试图访问或“分配”一个不存在的键时，它将创建那个键并给它一个已经指定的默认值。</p><p id="454e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们试一试:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="9161" class="mc md it ly b gy me mf l mg mh">from collections import defaultdict</span></pre><p id="d103" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe no np nq ly b">defaultdict</code>是一个来自藏书包的图书馆。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="496c" class="mc md it ly b gy me mf l mg mh">def<!-- --> <!-- -->default_value():</span><span id="853c" class="mc md it ly b gy nr mf l mg mh">return<!-- --> <!-- -->"Not Present Yet"</span></pre><p id="fdff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe no np nq ly b">defaultdict</code>需要一个函数来告诉它，如果键最初不在那里，该分配什么值。在这种情况下，<code class="fe no np nq ly b">Not Present Yet</code>将是默认值:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="a618" class="mc md it ly b gy me mf l mg mh">mydict = defaultdict(<!-- -->default_value<!-- -->)</span></pre><p id="4043" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe no np nq ly b">defaultdict</code>接受一个参数:返回默认值的函数名。</p><p id="0519" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们在<code class="fe no np nq ly b">defaultdict</code>中赋值:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="9036" class="mc md it ly b gy me mf l mg mh">mydict["cat"] = 2</span><span id="46e8" class="mc md it ly b gy nr mf l mg mh">mydict["dog"] = 4</span></pre><p id="edab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们试着调用这些键并获取它们相应的值:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="b225" class="mc md it ly b gy me mf l mg mh">print(mydict["cat"])</span><span id="8ca1" class="mc md it ly b gy nr mf l mg mh">print(mydict["dog"])</span></pre><p id="7840" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="fb5e" class="mc md it ly b gy me mf l mg mh">2<br/>4</span></pre><p id="2403" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，我们看到它与普通字典没有什么不同。</p><p id="7a10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们尝试查找未分配的已添加条目:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="897d" class="mc md it ly b gy me mf l mg mh">print(mydict["pig"])</span><span id="f114" class="mc md it ly b gy nr mf l mg mh">print(mydict["rabbit"])</span></pre><p id="23ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="e8d5" class="mc md it ly b gy me mf l mg mh">2<br/>4<br/>Not Present Yet<br/>Not Present Yet</span></pre><p id="4e7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们走吧！对于未赋值的两个(<code class="fe no np nq ly b">2</code>)条目，它返回<code class="fe no np nq ly b">Not Present Yet</code>。</p><p id="824a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们打印出<code class="fe no np nq ly b">mydict</code>的内容，您会注意到<code class="fe no np nq ly b">pig</code>和<code class="fe no np nq ly b">dog</code>被赋予了值<code class="fe no np nq ly b">Not Present Yet</code>:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="f6f3" class="mc md it ly b gy me mf l mg mh">defaultdict(&lt;function default_value at 0x0000019579608708&gt;, {'cat': 2, 'dog': 4, 'pig': 'Not Present Yet', 'rabbit': 'Not Present Yet'})</span></pre><p id="b7a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，每当您试图访问或“分配”一个不存在的键时，它将创建那个键并给它一个已经指定的默认值。</p><p id="532d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认值为<code class="fe no np nq ly b">Not Present Yet</code>。这将被分配给不在我们的<code class="fe no np nq ly b">defaultdict</code>中的键。</p><p id="d32b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/4f920f383462c3fe9de6c6be1e877cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nw4I75l-H0WCT6x7gTzBNA.png"/></div></div></figure><p id="0052" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码片段中，我只想改变一件事。我不认为像<code class="fe no np nq ly b">default_value</code>这样的功能只使用一次有什么意义。</p><p id="4864" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们把它变成一个匿名函数，如下所示:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="28f6" class="mc md it ly b gy me mf l mg mh">mydict = defaultdict(lambda: "Not Present Yet" )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/4e893266ee30377a00f8230e9284816f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3i-SPO-D8lUS_u83PcyNiA.png"/></div></div></figure><p id="dff2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经了解了默认字典，我们可以在下面的代码片段中试用它们。</p><p id="e742" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回忆:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/e197e4c2cf4db24da1f6a367b828ce3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5YUypGx4TPF2joua2a1wKA.png"/></div></div></figure><p id="4704" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，使用默认词典:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/bd0e5e37ed03eacf95d1afa3f05fa680.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Rve2dll80fKKR_RfLpq-w.png"/></div></div></figure><p id="5a43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为有了默认的字典，我们能够缩短并使上面的实现更容易。</p><p id="c036" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们不需要检查我们的值是否不存在来避免一个<code class="fe no np nq ly b">KeyError</code>，我们只是让默认的字典做它们的事情。它会自动将<code class="fe no np nq ly b">0</code>分配给任何键。这让我们很容易积累我们的价值观。</p><p id="3bb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mi">注:</em> <code class="fe no np nq ly b"><em class="mi">defaultdict(lambda: 0)</em></code> <em class="mi">有个简写。可以用</em> <code class="fe no np nq ly b"><em class="mi">defaultdict(int)</em></code> <em class="mi">。这些是可以互换的。</em></p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="7f2d" class="ms md it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">结论</h1><p id="ba2e" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">如您所见，<code class="fe no np nq ly b">defaultdict</code>已经被证明是字典的一个有用的替代品——尤其是在累加值的时候。试试上面的例子，自己测试一下。</p></div></div>    
</body>
</html>