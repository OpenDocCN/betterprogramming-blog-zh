# 像你希望别人对待你的代码一样对待别人的代码

> 原文：<https://betterprogramming.pub/treat-others-code-as-you-want-your-code-to-be-treated-8839891cd3dc>

## 关于如何进行彻底的代码审查的思考

![](img/e20a4806186f1398b1694a6d7769530e.png)

[由 benzoix / Freepik 设计](http://www.freepik.com/)

关于代码评审有很多观点:做还是不做？如果要做，怎么做？在我心目中，它是— *总是这样！*

想想吧。你写了一些代码。你认为代码是高质量的——非常棒。现在让一个朋友确保它和你想象的一样高质量(并一路上吹嘘你的技能)。

现在，如果*你*是那个朋友，我有一些关于如何对你傲慢的同事的代码进行彻底审查的想法。

这篇文章是关于代码审查的。具体来说，它将进行*质量*评审。这也是我上一篇文章“禅与代码处理艺术”的续篇。

我想从我自己的一个事实开始。我最喜欢的两本书是刘易斯·卡罗尔写的:《爱丽丝漫游奇境记》和《透过镜子，爱丽丝在那里发现了什么》当我还是个孩子的时候，我妈妈经常在睡觉前给我读这些书。在一个深思熟虑的年龄，我再次阅读这些书——这些书不是普通的东西。

也许你已经猜到我在说什么。每个开发人员都有自己的代码审查策略——我通过刘易斯笔下的人物来审查代码。

我在代码审查中看到了这种冒险，它应该帮助我的朋友改进他的代码。我将以爱丽丝的身份开始这次冒险。爱丽丝通情达理，彬彬有礼。她有强烈的好奇心，但同时也有克制和适度。像爱丽丝一样，我质疑一切。

三个问题引导我走向我的目标。

# 这种代码符合常见的编码惯例吗？

在我的乌托邦世界里，每个团队都有编码约定。当我在验证习俗时，我是红心皇后，一个脾气暴躁的君主。对于最轻微的违反编码标准的行为，我很快就会宣判死刑(拒绝审查)。我正在研究准则，以确保我的同事没有违反任何约定，如果他违反了，我会验证他是否有充分的理由，否则就是:

> 砍掉他们的头！
> 
> —刘易斯·卡罗尔，《爱丽丝梦游仙境》

顺便说一下，如果打破常规的理由足够充分，它可以促成对现有标准的修改。

审查意见应该不仅仅是简单的“不符合惯例”这一条。可能开发者和你一样不知道(或者不记得)具体的标准(虽然不情有可原，但这是可以理解的)。当你留下评论时，一定要解释你的理由。

# 你知道这是怎么回事吗？

要进行彻底的复习，你要了解变化的主要逻辑。

> “如果有些事情能让改变变得有意义，那该多好。”——刘易斯·卡罗尔，爱丽丝梦游仙境

根据[维基百科](https://en.wikipedia.org/wiki/Understanding)，理解是认知者和理解对象之间的关系。你是知者，逻辑是知识的对象。你知道知识就是力量(T4))，对吧？。这是你可以用这种力量做的事情。

*   **确保没有错误的(或隐藏的)假设和未处理的边缘情况。**例如，您知道一个对象可以为空，但是没有值存在验证——这可能导致空指针异常。另一个例子:默认行为没有在一个开关案例中定义，但是您知道将会添加额外的案例。
*   考虑类和方法名。在我之前的文章中(在“选择可读的名称”一节中)，我写了为你的方法选择一个好的名称是多么的重要。这是一个可以检查名字的地方。顺便说一句，当你考虑名字的质量时，确保没有错别字。编译器会警告输入错误，然而，有些开发人员(不是你)会忽略这些警告。

> "如果他们不回答，他们有名字有什么用？"“对他们没有用，”爱丽丝说；“但我想这对给它们起名字的人是有用的。如果不是，为什么事物都有名字？”
> 
> —刘易斯·卡罗尔，透过镜子，爱丽丝在那里发现了什么

如果你不能理解其中的逻辑或具体的代码，拒绝评审，告诉你的朋友他的代码毫无用处！我在开玩笑——注意你的举止，冷静下来，礼貌地要求开发人员解释他的代码是关于什么的。这是提出可以增加可读性的替代语义的好时机。

> **“说英语！”小鹰说。“我不知道那些长词的一半是什么意思，我相信你也不知道！”——**刘易斯·卡罗尔，爱丽丝梦游仙境

实际上，我总是做实现回顾，即使我理解逻辑。我真的很感激我的同事向我建议替代方案。我认为这是向其他开发者学习的机会。我总是寻找机会清理一些代码——但这只是我自己！

# 代码有测试覆盖率吗？

我们努力争取更大的测试覆盖率，对吗？遗漏测试是拒绝代码的合理理由。

当您评审时，确保代码被测试覆盖，并且测试断言一个有价值的行为。也许你认为这很明显。我要给你一个惊喜。我多次遇到这样的情况，测试似乎存在，但测试的是“真空”，而不是真实的业务结果。好尴尬！

> “有时候，早餐前我会相信多达六件不可能的事。”— 刘易斯·卡罗尔，通过镜子和爱丽丝在那里发现的东西

如果你发现了糟糕的测试，建议改进的方法。好的开发者会欣赏的。如果你不想深入测试，只要确保对增加或改变的逻辑有足够的测试覆盖率。已经足够好了(不完美)。

或许，读完以上所有内容，你会想:“加油，吉恩！这种审查会没完没了！”。你将会部分正确。您在评审上投入的时间及其质量与拉动式请求的大小成反比。

> 爱丽丝:“永远有多长？”
> 白兔:“有时候，就一秒钟。”—刘易斯·卡罗尔，《爱丽丝梦游仙境》

因此，这里有一个给提交代码供审查的开发人员的提示:尽量保持你的拉取请求尽可能小。较短的代码促进了更定性的评审(并且——次要的细节——将更容易找到评审的志愿者)。

对同意审查代码的英雄的另一个建议是:你可以信任你的朋友，但是你必须检查他的代码！即使您正在审查最有经验的开发人员的代码。(善意地)质疑一切。假设代码中有您需要捕捉的错误。

就是这样！在我看来，这是完全可行的。

> 爱丽丝:“这是不可能的”
> 疯帽匠:“除非你相信它是。”—刘易斯·卡罗尔，《爱丽丝梦游仙境》