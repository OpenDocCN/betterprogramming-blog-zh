<html>
<head>
<title>How to Automate Your Emails With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python自动处理电子邮件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-automate-your-emails-with-python-386b4e2d5395?source=collection_archive---------0-----------------------#2020-05-11">https://betterprogramming.pub/how-to-automate-your-emails-with-python-386b4e2d5395?source=collection_archive---------0-----------------------#2020-05-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9210" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Gmail API将收集到的数据发送到电子邮件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7191b5bd682fc7cb3ba866a3f7c593f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bej1ovORO8YkhxIESRZSZA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@webaroo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">webaro</a>在<a class="ae ky" href="https://unsplash.com/s/photos/gmail?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="0e11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Python自动执行日常任务非常简单。通过结合使用API和易于理解的库，您可以轻松地设置系统来清理网站、发送电子邮件以及管理数据和分析。</p><p id="ef01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在企业领域，需要实现自动化的一个非常常见的任务是能够收集公共政府数据。这些信息通常来自data.gov等网站和其他终端，目的是获取医疗保健、贸易、交通、法律等方面的信息。</p><p id="f2d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，有很多政府机构网站都处于某种程度的隐蔽状态，但它们仍然能够生成大量有价值的数据，供价值数十亿美元的公司进行数百万美元的决策时使用。</p><p id="c180" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将概述如何编写Python脚本，以便下载一组特定的政府数据，然后将这些数据上载到电子邮件中，并将其发送给任何人。</p><p id="2aad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将让您在使用Gmail API的同时，还能放心地使用<a class="ae ky" href="https://requests.readthedocs.io/en/master/" rel="noopener ugc nofollow" target="_blank"> Python请求库</a>。因此，如果您希望使用Python自动处理未来的电子邮件，这是一个很好的起点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c55e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用Python下载文件</h1><p id="0b2b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于第一步，我们实际上需要使用HTTP请求下载数据文件。</p><p id="b825" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python的伟大之处在于，编写类似HTTP请求这样的代码的复杂性已经被消除。相反，您可以导入Requests库并使用它来发布和获取请求。</p><p id="a3ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们要下载的文件甚至在下面的链接处有一个简单的结束点。因此，您不需要使用像Selenium这样的<a class="ae ky" href="https://medium.com/better-programming/4-basic-python-tips-to-automate-your-workflow-befabe140b83" rel="noopener">库来尝试单击下载按钮</a>。</p><p id="25de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使有一个下载按钮，您也应该考虑检查它是否附有URL。通常情况下，如果有一个URL，那么使用一个链接下载要比创建一个寻找要单击的按钮的网络爬虫简单得多。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="57dc" class="ne md it na b gy nf ng l nh ni">https://data.medicaid.gov/api/views/u72p-j37s/rows.json?accessType=DOWNLOAD</span></pre><p id="ca00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此文件提供有关Medicaid和个人登记者的信息。这对于医疗保健提供商来说很有价值，他们可以将其与内部数据绑定，以帮助更好地了解自己的市场。</p><p id="b644" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了下载，我们将使用函数<code class="fe nj nk nl na b"> requests.get()</code>。这将允许我们使用HTTP请求将数据拉至我们指定的URL。</p><p id="3e50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，您可以查看下面的脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="fce4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它简短明了，将把CSV作为您现在设置为变量的请求的一部分返回。我们将在稍后创建电子邮件时使用它。但是接下来，我们需要为Gmail API设置凭证。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="155a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置您的Gmail API</h1><p id="6232" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Google让你设置API变得非常容易。你可以去<a class="ae ky" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌API控制台</a>。在那里，您可以选择启用API和服务，然后搜索Gmail API。</p><p id="5497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">API控制台如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/39d193073be9187965b75799af33eaeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ItjixTKtJ1rNVFlHthXx6Q.png"/></div></div></figure><p id="3cab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击该按钮后，您将获得一个搜索引擎，允许您搜索各种API。它将看起来像下面的图像。</p><p id="e91e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在Gmail中输入，它应该是唯一显示的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/aef17eff20bb2da5600855e35967683a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xN9uc9wFQiZBBsHLchWgnw.png"/></div></div></figure><p id="ca25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后你可以选择Gmail API，它旁边会有一个启用按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/9997c19eea0a750dd8539aaff5d8778d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RnWqFEVe-Qi9hsWrpiV13g.png"/></div></div></figure><p id="25ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击Gmail API上的启用后，您可以下载您的凭据或使用API密钥和密码。</p><p id="ddce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的代码将使用JSON下载，但是如果您喜欢的话，可以将其转换成pickle。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/375dbbc0db5c238a838b6b87825a2f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qv1nCYGfiN-ajiXsEyp8Fg.png"/></div></div></figure><p id="5efd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置完成后，我们现在可以开始构建您的函数来设置并自动发送您的电子邮件。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d3b3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用Gmail API发送电子邮件</h1><p id="9363" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">既然我们已经找到了提取这些数据的方法，我们需要弄清楚如何实际发送电子邮件。</p><p id="986b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了做到这一点，我们将使用<a class="ae ky" href="https://docs.python.org/3/library/email.examples.html" rel="noopener ugc nofollow" target="_blank">电子邮件</a>库。这个库将让我们建立电子邮件的各个部分:发件人、收件人、主题等。</p><p id="5b76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在电子邮件中使用<code class="fe nj nk nl na b"><a class="ae ky" href="https://docs.python.org/2/library/email.mime.html" rel="noopener ugc nofollow" target="_blank">MIMEBase</a></code>类来实现这一点，这使得设置正确的数据点变得容易，并为Gmail API提供了一个简单的类，以便在将来解析。</p><p id="7b87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe nj nk nl na b">MIMEBase</code>类非常简单，因为您可以启动一个新类，然后引用许多所需的组件，如:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="bc02" class="ne md it na b gy nf ng l nh ni">message[‘from’] = test@gmail.com</span></pre><p id="b134" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在下面看到我们设置这些参数的整个功能。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="219e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你会注意到在最后，我们使用了函数<code class="fe nj nk nl na b">urlsafe_b64encode</code>。这将把消息设置为字节。这将用于轻松地将电子邮件数据传输到Gmail API。所以很容易传递下去。</p><p id="384a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在终于到了发送你的第一封自动邮件的时候了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1eae" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用Python发送您的第一封自动电子邮件</h1><p id="39bb" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在，您已经设置了Gmail API凭据，我们可以发送第一封电子邮件了。</p><p id="8cdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用我们为Gmail API和凭证设置的服务变量。</p><p id="99f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这在下面的功能<code class="fe nj nk nl na b">send_message</code>中显示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="820a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从这里开始，我们需要做的就是传递消息并执行。</p><p id="52fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至此，我们发出了第一封电子邮件。</p><p id="6492" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整个脚本看起来像下面的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="baf1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">是时候开始自动化了</h1><p id="1037" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们希望这个脚本能帮助你用Python自动化未来的电子邮件，以及寻找你可以自动化的其他任务。</p><p id="526d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的例子中，我们手动安排这个脚本。然而，在未来，如果你想更有效地自动化这个<a class="ae ky" href="https://www.theseattledataguy.com/data-engineering-101-writing-your-first-pipeline/" rel="noopener ugc nofollow" target="_blank">，你可以使用一个像气流</a>这样的框架。然后，您可以每天运行该脚本，而不是手动运行该脚本。</p><p id="ab22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们不建议尝试构建您的自动化框架，尤其是当有这么多好的选择时。这就是为什么我们只展示剧本。</p><p id="b2c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，祝你好运和快乐的自动化！</p></div></div>    
</body>
</html>