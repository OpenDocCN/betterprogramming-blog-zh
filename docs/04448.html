<html>
<head>
<title>SwiftUI — MVI Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">斯威夫特ui——MVI建筑</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/mvi-architecture-for-swiftui-apps-cff44428394?source=collection_archive---------4-----------------------#2020-04-14">https://betterprogramming.pub/mvi-architecture-for-swiftui-apps-cff44428394?source=collection_archive---------4-----------------------#2020-04-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e17d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">iOS的模型-视图-意图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9cfd711e70dc223698391ef09af5e968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-qu7N_0quaZeuiap"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杰里米·珀金斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b9ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模型-视图-意图(MVI)是Android世界中一个流行的架构。它是由汉尼斯·多尔夫曼介绍的。这里可以找到<a class="ae ky" href="http://hannesdorfmann.com/android/mosby3-mvi-1" rel="noopener ugc nofollow" target="_blank">。就本文而言，下面是对MVI的简要介绍。</a></p><p id="b9d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MVI是一个循环的单向数据流架构。</p><ul class=""><li id="8df1" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu"> <em class="me">模式</em> </strong> <em class="me"> </em>代表应用的状态。它包含呈现屏幕所需的属性。</li><li id="d00c" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated"><strong class="lb iu"> <em class="me">意图</em> </strong>是改变系统状态的事件——例如，用户点击是改变系统状态的事件。还有，叫它[ <strong class="lb iu">互动</strong> ]。</li><li id="ec2e" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated"><strong class="lb iu"> <em class="me">视图</em> </strong> <em class="me"> </em>观察状态变化并相应更新自身。</li></ul><h2 id="5d71" class="mk ml it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated"><strong class="ak">图形表示:</strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/f76cdd9fbaff8b312de738c195f47571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6i4EBK-J7ZGFQIpQGtpozg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MVI建筑设计</p></figure><ol class=""><li id="cd65" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ne mb mc md bi translated">用户与视图交互以创建意图。</li><li id="fdd6" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ne mb mc md bi translated">意图改变应用程序的状态。</li><li id="f870" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ne mb mc md bi translated">状态的变化会更新视图。循环重复。</li></ol><p id="8079" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>另外，API和推送通知也会改变应用的状态。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="97dc" class="nm ml it bd mm nn no np mp nq nr ns ms jz nt ka mv kc nu kd my kf nv kg nb nw bi translated">SwiftUI中的MVI实施</h1><p id="ccd8" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">出于演示的目的，我们将实现一个电影搜索屏幕。它有一个<code class="fe oc od oe of b">TextField</code>来输入要搜索的关键字。以下是与关键字匹配的电影列表。</p><h2 id="417a" class="mk ml it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated">型号<strong class="ak">(应用状态)</strong></h2><p id="b0a8" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">首先，让我们考虑应用程序的可能状态。在任何给定的时间，应用程序将处于下列状态之一。稍后，您将看到我们有一个对应于每个状态的视图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/9b493a85baaa1d6041b89c8ad6c256fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g82aZqvkzI_PayV9KMP8Bw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">视图的详尽状态列表</p></figure><ul class=""><li id="996b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe oc od oe of b">InitState</code>:初始状态。没有查询到任何内容。</li><li id="1edc" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated"><code class="fe oc od oe of b">Loading</code>:关键字已经输入，正在从API中取电影</li><li id="a8ef" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated"><code class="fe oc od oe of b">SuccessfullyFetched</code>:API返回匹配电影时</li><li id="5a3f" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated"><code class="fe oc od oe of b">NoMatchingResults</code>:查询未找到结果时</li><li id="b95c" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated"><code class="fe oc od oe of b">ApiError</code>:HTTP请求失败或API返回错误</li></ul><p id="8f59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用Swift的<code class="fe oc od oe of b">Enum</code>来保持状态。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="f025" class="mk ml it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated">SearchPageViewModel(业务层)</h2><ul class=""><li id="751e" class="lv lw it lb b lc nx lf ny li oj lm ok lq ol lu ma mb mc md bi translated">它包含应用程序的状态。</li><li id="8561" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated">从视图接收意图并更新状态。</li><li id="ff07" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated">将更新后的状态发布到视图。</li></ul><p id="1425" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看它的实现。<code class="fe oc od oe of b">SearchPageViewModel</code>是一个保存应用程序状态的数据保存类。它符合<code class="fe oc od oe of b">ObservableObject</code>协议。<code class="fe oc od oe of b">ObservableObject</code>协议中的任何东西都可以在它的值发生变化时发出通知，这样SwiftUI视图就可以自我更新。</p><p id="3049" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它有一个名为<code class="fe oc od oe of b">uiState</code>的变量，类型为<code class="fe oc od oe of b">SearchPageState</code>。它用<code class="fe oc od oe of b">Published</code>属性包装器包装。这样，当它的值改变时，它可以通知视图。</p><p id="65aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该类接收意图，进行API调用以获取数据，并更新应用程序的状态。</p><p id="4acb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oc od oe of b">loadMovies</code>当想要获取匹配的电影时调用的函数。下面的注释显示了该函数如何更新应用程序的状态。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">SearchPageView的数据持有者。这也显示了进行API调用的业务逻辑。</p></figure></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="70d2" class="mk ml it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated">视角</h2><p id="d2d8" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">我们显示一个<code class="fe oc od oe of b">TextField</code>来输入关键字。在它的下面，我们有一个显示应用程序状态视图的组。</p><p id="0ae1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">演示:当我们提交(点击搜索按钮)时，它向<code class="fe oc od oe of b">SearchPageViewModel</code>发送一个intent <strong class="lb iu"> </strong>来更新状态。<code class="fe oc od oe of b">SearchPageViewModel</code>然后制作一个API来更新状态。</p><p id="e91c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">初始化→加载→ [ <code class="fe oc od oe of b">SuccessfullyFetched</code> | <code class="fe oc od oe of b">NoResultsFound</code> | <code class="fe oc od oe of b">ApiError</code> ]</p><p id="9a85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该小组拥有<code class="fe oc od oe of b">SearchPageState</code>的详尽案例，以及应用程序每个状态的对应视图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">搜索页面视图——它上面的交互创造了意图</p></figure></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="f136" class="mk ml it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated">目的</h2><p id="e110" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">它是视图上的交互。意图被传播到<code class="fe oc od oe of b">SearchPageViewModel</code>，从而改变其状态。示例:输入查询后按下搜索图标是为了加载匹配的电影。</p><p id="a3cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oc od oe of b">vm.loadMovies(query: self.query)</code>是一个意向。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将意图通知给SearchPageViewModel</p></figure><p id="3069" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里找到完整的代码</p><div class="om on gp gr oo op"><a href="https://github.com/AnupAmmanavar/Mvi-SwiftUI/tree/master/MovieSearch/search" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">AnupAmmanavar/Mvi-SwiftUI</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">github.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd ks op"/></div></div></a></div></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="7d7c" class="nm ml it bd mm nn no np mp nq nr ns ms jz nt ka mv kc nu kd my kf nv kg nb nw bi translated"><strong class="ak">关闭点</strong></h1><p id="4a0d" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">现在您已经了解了MVI及其实现，我们将询问<em class="me">为什么这与SwiftUI相关？</em></p><p id="9508" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像移动应用程序这样的UI应用程序总是试图使视图与应用程序的状态保持同步。例子:想象一下驾驶一辆汽车。仪表盘上的速度读数无非就是车的状态(速度)。如果仪表板显示一个错误的读数，那么它是不一致的。</p><p id="12e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SwiftUI有一个基础设施，其中数据被绑定到UI(数据绑定)。在SwiftUI中，显示警报是通过绑定来控制的。框架<strong class="lb iu">处理数据更改后重新呈现(无效)视图的性能影响。</strong>所以用数据驱动UI (data-driven UI)会消除数据和UI之间存在的不一致。</p></div></div>    
</body>
</html>