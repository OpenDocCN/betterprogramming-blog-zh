<html>
<head>
<title>Hello Codex: Build an OpenAI Telegram Bot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你好抄本:建立一个开放的电报机器人</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/hello-codex-openai-gpt-3-telegram-bot-362d93ea6959?source=collection_archive---------1-----------------------#2022-03-06">https://betterprogramming.pub/hello-codex-openai-gpt-3-telegram-bot-362d93ea6959?source=collection_archive---------1-----------------------#2022-03-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c894" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">循序渐进的Python教程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6f40fe4c2b09ae3c269a95c2b36f24d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SISD8-ry1_eac_sw0G1yyw.jpeg"/></div></div></figure><p id="34ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">厌倦了等待Github副驾驶的邀请，我决定自己动手。</p><p id="c31e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">OpenAI的Codex是一个GPT 3发电站，将简单的英语转换成可运行的代码。它还可以完成许多其他与代码相关的任务，比如将代码从一种语言翻译成另一种语言，生成文档字符串，以及解释已经编写好的代码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ln"><img src="../Images/2f45d8d2339065fa5c73cbff5eb9bd49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yfxfvwdlLBoGlmyU.gif"/></div></div></figure><p id="1f5b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是创建你自己的密码电报机器人的步骤。</p><blockquote class="lo lp lq"><p id="2ee2" class="kr ks lr kt b ku kv jr kw kx ky ju kz ls lb lc ld lt lf lg lh lu lj lk ll lm ij bi translated"><strong class="kt ir">先决条件:</strong>要访问Codex API，你需要获得OpenAI的邀请。这是免费的，大约一周后我得到了批准。在这里加入等候名单<a class="ae lv" href="https://openai.com/blog/openai-codex/" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote><p id="2fd7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你还没有这样做，请<a class="ae lv" href="https://telegram.org/" rel="noopener ugc nofollow" target="_blank">下载</a> Telegram，他们还提供了一个很棒的桌面应用程序。</p><p id="565b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">请求一个机器人<br/> </strong>这个，你跟<a class="ae lv" href="https://t.me/botfather" rel="noopener ugc nofollow" target="_blank">机器人爸爸</a>说。他是你所有机器人方面的专家，从创造到设置等等。</p><p id="da5d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">键入<code class="fe lw lx ly lz b">/newbot</code>开始。<br/>机器人父亲会让你选择一个机器人名称(必须是唯一的)和一个用户名，然后它会为你的新机器人生成一个认证令牌。</p><p id="9d98" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> Codex Key </strong> <br/>接下来，继续从OpenAI中获取您的<a class="ae lv" href="https://beta.openai.com/account/api-keys" rel="noopener ugc nofollow" target="_blank"> API key </a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://beta.openai.com/account/api-keys"><div class="gh gi ma"><img src="../Images/0280585a7d293611f238ee830007c44e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DvYEvEmk_HEF1Pjp"/></div></a></figure><p id="3d10" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">记下你刚拿到的两把钥匙，我们很快就会用到它们。</p><p id="fc08" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">提示:处理跨环境的秘密可能会很麻烦。多普勒公司(T21)的人提供了一个很棒的(免费)产品来处理这一切。</p><p id="04cc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> Python代码<br/> </strong>启动你最喜欢的编辑器(对我来说是<a class="ae lv" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank"> VS代码</a>)，让我们来点乐子吧！</p><p id="e5b0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们pip安装以下两个库:</p><pre class="kg kh ki kj gt mb lz mc md aw me bi"><span id="ba01" class="mf mg iq lz b gy mh mi l mj mk">pip install openai<br/>pip install pyTelegramBotAPI</span></pre><p id="1754" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">像这样开始:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="8215" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用API时，启用日志记录总是一个好主意。最终，我们会希望在某个地方举办这个活动，这样我们记录的越多，我们就越不会被蒙在鼓里。</p><blockquote class="lo lp lq"><p id="03a3" class="kr ks lr kt b ku kv jr kw kx ky ju kz ls lb lc ld lt lf lg lh lu lj lk ll lm ij bi translated">注意我是如何从os导入environ的。使用env['BOT_API_KEY']比os.environ更漂亮/简洁。</p></blockquote><p id="48cb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，让我们建立我们闪亮的新机器人和法典之间的公报。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="4390" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上面，我们首先建立了bot的装饰器，将我们的消息传递给它下面的函数。</p><p id="ce14" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在第7行，我们将<code class="fe lw lx ly lz b">max_tokens</code>设置为<code class="fe lw lx ly lz b">1200</code>,这是因为虽然Codex允许每个调用最多4096个令牌(包括您的提示),但电报机器人每条消息最多4096个UTF 8字符。一个令牌大约相当于4个字符。</p><p id="e979" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">了解更多关于各种<code class="fe lw lx ly lz b">openai.Completion.create</code>参数<a class="ae lv" href="https://beta.openai.com/docs/api-reference/completions/create" rel="noopener ugc nofollow" target="_blank">这里</a>，他们的文档很牛逼。</p><p id="213f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在第14行中，我们利用了Telegram提供强大的降价支持的事实，因此代码显示得很好，并且还允许点击复制。</p><p id="f6c2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，<code class="fe lw lx ly lz b">bot.infinity_polling()</code>对新来的消息保持开放的耳朵。</p><blockquote class="lo lp lq"><p id="51db" class="kr ks lr kt b ku kv jr kw kx ky ju kz ls lb lc ld lt lf lg lh lu lj lk ll lm ij bi translated">电报机器人还可以做很多其他很酷的事情，pyTelegramBotAPI在<a class="ae lv" href="https://github.com/eternnoir/pyTelegramBotAPI" rel="noopener ugc nofollow" target="_blank">中详细介绍了这些事情。</a></p></blockquote><p id="9d80" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在运行脚本之前，在当前目录下创建一个<code class="fe lw lx ly lz b">.env</code>文件(注意前面的点),如下所示:</p><pre class="kg kh ki kj gt mb lz mc md aw me bi"><span id="3068" class="mf mg iq lz b gy mh mi l mj mk">BOT_API_KEY = bot-key-here<br/>OPENAI_API_KEY = openai-key-here</span></pre><p id="ad6b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您的完整脚本应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="34b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">恭喜你。你现在有你自己的法典总是在你的指尖。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/ae75a4383d30dcb3a7c87b75db479ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*2aXp8dANpDZT-I_HuynenQ.jpeg"/></div></figure><p id="8a71" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了让你的机器人总是可访问的，你需要把它托管在云中。不管是AWS还是Heroku，跟自己喜欢的走；请记住<code class="fe lw lx ly lz b">bot.infinity_polling()</code>需要一个服务器设置(即Flask)来正确运行。为了避免持续的计算时间，我们可以设置一个webhook来代替轮询。在下一篇文章中，我将向你展示作为一个Azure Function应用程序我是如何做到这一点的。</p><p id="f482" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">喜欢这篇文章吗？来吧，为它鼓掌…👏</p></div></div>    
</body>
</html>