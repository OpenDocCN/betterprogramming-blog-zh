<html>
<head>
<title>Loading Location History Places From Google Timeline Into Pandas and CSV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从谷歌时间线加载位置历史地点到熊猫和CSV</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/loading-location-history-places-from-google-timeline-into-pandas-and-csv-c26cb0ac5e89?source=collection_archive---------8-----------------------#2022-06-16">https://betterprogramming.pub/loading-location-history-places-from-google-timeline-into-pandas-and-csv-c26cb0ac5e89?source=collection_archive---------8-----------------------#2022-06-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e46a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">知道你去超市喝咖啡的频率，你上下班的时间，以及需要多长时间。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3fb4a63cbe5e671d29a1eb16bd76f9cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tu610Y5_fEVbQOkJ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">索尔·阿尔维斯在Unsplash<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">上的照片</a></p></figure><p id="f339" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你在智能手机上启用了谷歌时间线位置历史，你就可以获得特定日期你去了哪里，你开车、步行或乘坐公共交通工具多长时间的信息。</p><p id="a001" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我从2013年就戴着它，所以我可以在谷歌地图上使用谷歌时间轴工具访问我9年的位置历史。例如，这是我2022年6月5日的时间表。正如你所看到的，那天我正开车，逛超市，走路，乘渡船从新西兰南到北岛。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/3a7a49df4de282cb4b390f323b62da1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5d28NyNVoiugThs5d1-wDQ.png"/></div></div></figure><p id="14b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然Google Timeline提供了一个直观易用的界面，但作为一个对分析这些数据感兴趣的人，我希望以熊猫数据帧和CSV文件的形式获得一个我访问过的所有地方的列表。有了这些数据，我可以对自己这些年的旅行进行一些有趣的可视化。</p><p id="d601" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我来演示一下如何做到这一点。</p><h1 id="76f0" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">第一步。使用谷歌外卖下载位置历史</h1><p id="9886" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">谷歌外卖允许你将谷歌账户中的所有数据作为一个文件加载。包括你的邮件、照片、视频等。位置历史也可以作为ZIP文件下载。</p><p id="e482" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要获取它，请转到<a class="ae kv" href="https://takeout.google.com/settings/takeout" rel="noopener ugc nofollow" target="_blank">https://takeout.google.com/settings/takeout</a>，检查“位置历史记录”并点击“下一步”按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/c43c7c54e70c9cf078e7d10fee7f2c60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ojx7ZmKgYADVL-Pf8VtO2w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">d</p></figure><p id="b022" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选择ZIP作为文件格式，然后点击“创建导出”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/a23dfbc86f2899efc884ea63514ad439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BYqUjvXc6Ead4bV1UTIRVQ.png"/></div></div></figure><p id="bee2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Google将创建一个新文件，并在可以下载时通知您。文件挺小的，9年才59 MB。</p><p id="1f8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在ZIP文件中，位置历史存储在以下文件中。我们需要从位于“语义位置历史”目录的JSON文件中加载数据</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/4e693d82b189f4438f100024540d7731.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*Q2oolwEX2VupjVnIERUePg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">谷歌位置历史外卖压缩文件内容</p></figure><h1 id="78cd" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">第二步。正在处理位置历史ZIP文件</h1><p id="a035" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们需要安装以下库来处理该文件:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="911b" class="my lu iq mu b gy mz na l nb nc">pip install timezonefinder<br/>pip install numba</span></pre><p id="7f64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">进口:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="66cc" class="my lu iq mu b gy mz na l nb nc">from zipfile import ZipFile<br/>import pandas as pd<br/>import json<br/>from timezonefinder import TimezoneFinder</span></pre><p id="6dc0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以打开每个JSON文件并将数据追加到place _ visits数组中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="3b73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果将如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c953" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该条目包含以下信息:</p><ul class=""><li id="855b" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">Google Place ID。使用这个ID，您可以通过调用Google Place API来加载关于一个地方的附加信息。<a class="ae kv" href="https://developers.google.com/maps/documentation/places/web-service/place-id" rel="noopener ugc nofollow" target="_blank">更多详情</a></li><li id="ef37" class="nf ng iq ky b kz nr lc ns lf nt lj nu ln nv lr nk nl nm nn bi translated"><code class="fe no np nq mu b">locationConfidence</code>。在某些情况下，坐标可能不太精确，附近可能还有其他地方。那样的话，<code class="fe no np nq mu b">locationConfidence</code>会更低</li><li id="2951" class="nf ng iq ky b kz nr lc ns lf nt lj nu ln nv lr nk nl nm nn bi translated"><code class="fe no np nq mu b">startTimestamp</code>和<code class="fe no np nq mu b">endTimestamp</code>当你到达和离开这个地方的时候。UTC时区的日期和时间。</li><li id="b86a" class="nf ng iq ky b kz nr lc ns lf nt lj nu ln nv lr nk nl nm nn bi translated"><code class="fe no np nq mu b">latitudeE7</code>和<code class="fe no np nq mu b">longitudeE7</code>处的地理坐标乘以100万。所以纬度值-338656941转换成-33.8656941。对南半球来说是负面的。</li></ul><p id="bfca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，这个数组可以转换成熊猫数据框:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="dbb7" class="my lu iq mu b gy mz na l nb nc">place_visits_df = pd.DataFrame(place_visits)</span></pre><p id="5ed5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了更方便地处理数据，我想:</p><ul class=""><li id="dabc" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">将日期时间转换为当地时区</li><li id="cd27" class="nf ng iq ky b kz nr lc ns lf nt lj nu ln nv lr nk nl nm nn bi translated">将年、月、日、小时和分钟作为单独的列</li><li id="2dd7" class="nf ng iq ky b kz nr lc ns lf nt lj nu ln nv lr nk nl nm nn bi translated">添加访问持续时间列</li><li id="57ff" class="nf ng iq ky b kz nr lc ns lf nt lj nu ln nv lr nk nl nm nn bi translated">将坐标转换成十进制值</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/b35b27e18f85af80a640ef51e9f48d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4xA_G7s5Xq7L2Yj_Yirt8g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">放置数据帧</p></figure><p id="04ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后一步，让我们将这些数据保存为CSV文件:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="5705" class="my lu iq mu b gy mz na l nb nc">place_visits_df.to_csv("place_visits.csv", index=False)</span></pre><h1 id="726f" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">第三步。浏览访问过的地点数据</h1><p id="e7ff" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在地图上显示给定日期范围内所有去过的地方:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/98a94c44516625877e02bc3a06032daf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EdO0vkrVlsB1ktcG-Rtdtw.png"/></div></div></figure><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="f4e9" class="my lu iq mu b gy mz na l nb nc"># To find most northern place I’ve visited <br/># (Berlin Tegel airport for me)<br/>place_visits_df[place_visits_df.latitude == place_visits_df.latitude.max()]</span><span id="9c07" class="my lu iq mu b gy ny na l nb nc"># To find most southern place I’ve visited place_visits_df[place_visits_df.latitude == place_visits_df.latitude.min()]</span></pre><p id="c04d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在使用这个数据集，你可以知道你去超市买咖啡的频率，你通常上下班的交通时间，以及需要多长时间。</p><p id="5398" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想知道这是怎么做到的吗？我将在下一篇文章中添加一些如何可视化这些数据的例子。</p></div></div>    
</body>
</html>