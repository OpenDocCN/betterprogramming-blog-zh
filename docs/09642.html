<html>
<head>
<title>Android Keyboard Handling Using Jetpack Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Jetpack Compose处理Android键盘</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/android-keyboard-handling-using-jetpack-compose-c478f7afaae0?source=collection_archive---------4-----------------------#2021-09-21">https://betterprogramming.pub/android-keyboard-handling-using-jetpack-compose-c478f7afaae0?source=collection_archive---------4-----------------------#2021-09-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3bab" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在你的Android应用中有效地处理键盘事件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/16929160186f0e89e6d63385adbd83dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VSKeZhSqpIn6rD9C"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@zanilic?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Zan </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="5661" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将学习如何在jetpack compose中管理Android键盘。我们将更加关注IME动作、键盘类型、焦点监听器等。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="52c7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">介绍</h1><p id="0033" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Jetpack Compose是谷歌最近试图让Android开发者轻松构建UI的尝试之一。</p><blockquote class="mz na nb"><p id="1ed4" class="kz la nc lb b lc ld ju le lf lg jx lh nd lj lk ll ne ln lo lp nf lr ls lt lu im bi translated"><em class="it">“Jetpack Compose是一个用于构建原生Android UI的现代工具包。Jetpack Compose以更少的代码、强大的工具和直观的Kotlin APIs简化并加速了Android上的UI开发。”— </em> <a class="ae ky" href="https://developer.android.com/jetpack/compose/tutorial" rel="noopener ugc nofollow" target="_blank"> <em class="it">安卓开发者</em> </a></p></blockquote><p id="1746" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Jetpack Compose的稳定版本1.0最近发布，这意味着它的生产就绪。因此，这将是学习如何使用下一代UI套件进行Android开发的大好时机。</p><p id="e247" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要安装Android Studio —北极狐(2020.3.1) <strong class="lb iu"> </strong>版本才能使用Jetpack Compose。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e4f3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">先决条件</h1><p id="4aac" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在进一步学习之前，您必须具备如何使用Jetpack Compose的基本知识。如果你是作曲新手，我强烈推荐阅读以下文章:</p><ul class=""><li id="d0bd" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">"<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/jetpack-compose-components-part-1-a80717dbfb59">喷气背包构成组件(第一部分)</a>"</li><li id="d62d" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/explore-android-bottom-sheets-in-jetpack-compose-50eff0257231">“探索Jetpack Compose中的Android底层表单”</a></li><li id="b198" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">"<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/build-android-layouts-in-jetpack-compose-bda2e0837f5e">在JetPack Compose中构建Android布局</a>"</li><li id="cb18" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/android-bottom-navigation-bar-with-jetpack-compose-8c2aa02b933d">“使用Jetpack撰写的Android底部导航栏”</a></li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="aa97" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">项目设置</h1><p id="56ac" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">通常在android中，当屏幕上有输入栏时，键盘就会出现。</p><p id="83c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个编写示例中，我们将使用<code class="fe nu nv nw nx b">OutlinedTextField</code>来探索键盘动作。我们将有两个输入字段。一个指示<code class="fe nu nv nw nx b">name</code>，另一个指示<code class="fe nu nv nw nx b">amount</code>。我们将<code class="fe nu nv nw nx b">Scaffold</code>作为根，然后<code class="fe nu nv nw nx b">Column</code>垂直排列<code class="fe nu nv nw nx b">OutlinedTextFields</code>。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6ba2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">键盘选项</h1><p id="cab8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe nu nv nw nx b">KeyboardOptions</code>是一个不可变的Kotlin类，通过它可以配置软件键盘中的选项。它可以作为参数传递给Jetpack Compose中的<code class="fe nu nv nw nx b">TextFields</code>。</p><p id="72d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nu nv nw nx b">KeyboardOptions</code>主要有<code class="fe nu nv nw nx b">capitalization</code>、<code class="fe nu nv nw nx b">autoCorrect</code>、<code class="fe nu nv nw nx b">keyboardType</code>、<code class="fe nu nv nw nx b">imeAction</code>四种选择。每一个都有其独特的重要性。让我们看看:</p><ul class=""><li id="13a7" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated"><code class="fe nu nv nw nx b">capitalization</code> : <strong class="lb iu"> </strong>根据<strong class="lb iu"> — </strong> <code class="fe nu nv nw nx b"><strong class="lb iu"> </strong>KeyboardCapitalization.Characters</code> <strong class="lb iu">、</strong> <code class="fe nu nv nw nx b">KeyboardCapitalization.Sentences</code> <strong class="lb iu">、</strong> <code class="fe nu nv nw nx b">KeyboardCapitalization.Words</code> <strong class="lb iu">、</strong>、<strong class="lb iu"> </strong> <code class="fe nu nv nw nx b">KeyboardCapitalization.None</code>四种类型，用于键盘字符的大写。</li><li id="645b" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><code class="fe nu nv nw nx b">autoCorrect</code> : <strong class="lb iu"> </strong>这是一个布尔参数。如果为真，它会根据用户键盘历史自动纠正输入，否则它不会纠正任何东西。</li><li id="101b" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><code class="fe nu nv nw nx b">keyboardType</code> : <strong class="lb iu"> </strong>用于向用户显示特定类型的键盘，如带<code class="fe nu nv nw nx b">KeyboardType.Email</code>的电子邮件键盘或带<code class="fe nu nv nw nx b">KeyboardType.Number</code>的纯数字键盘等。</li><li id="9b12" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><code class="fe nu nv nw nx b">imeAction</code> : <strong class="lb iu"> </strong>这个IME动作会被键盘兑现，并在键盘上显示特定的图标。例如，如果是<code class="fe nu nv nw nx b">ImeAction.Search</code>，那么它会在键盘上显示一个搜索图标。</li></ul><pre class="kj kk kl km gt oa nx ob oc aw od bi"><span id="7031" class="oe md it nx b gy of og l oh oi">OutlinedTextField(<br/>    value = name,<br/>    onValueChange = updateName ,<br/>    label = <strong class="nx iu">{ </strong>Text(<strong class="nx iu">"</strong>Name<strong class="nx iu">"</strong>) <strong class="nx iu">}</strong>,<br/>    placeholder = <strong class="nx iu">{ </strong>Text(text = <strong class="nx iu">"</strong>Name<strong class="nx iu">"</strong>) <strong class="nx iu">}</strong>,<br/>    singleLine = true,<br/>    <strong class="nx iu">keyboardOptions = KeyboardOptions.Default.copy(<br/>        capitalization = KeyboardCapitalization.Sentences,<br/>        autoCorrect = false,<br/>        keyboardType = KeyboardType.Text,<br/>        imeAction = ImeAction.Next<br/>    ),</strong><br/>    modifier = Modifier<br/>        .fillMaxWidth()<br/>)</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2a11" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">键盘操作</h1><p id="661e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe nu nv nw nx b">KeyboardActions</code>是compose foundation库中的Kotlin类，它帮助开发人员执行任务，以响应用户与软件键盘中的IME选项的交互。</p><p id="b4d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们有六个可用的键盘操作— <code class="fe nu nv nw nx b">onDone</code>、<code class="fe nu nv nw nx b">onGo</code>、<code class="fe nu nv nw nx b">onNext</code>、<code class="fe nu nv nw nx b">onPrevious</code>、<code class="fe nu nv nw nx b">onSearch</code>和<code class="fe nu nv nw nx b">onSend</code>、<strong class="lb iu">。</strong>在compose风格中处理键盘交互的方法比传统的方法更简洁。看一看:</p><pre class="kj kk kl km gt oa nx ob oc aw od bi"><span id="6113" class="oe md it nx b gy of og l oh oi">OutlinedTextField(<br/>    value = name,<br/>    onValueChange = updateName ,<br/>    label = <strong class="nx iu">{ </strong>Text("Name") <strong class="nx iu">}</strong>,<br/>    placeholder = <strong class="nx iu">{ </strong>Text(text = "Name") <strong class="nx iu">}</strong>,<br/>    singleLine = true,<br/>    keyboardOptions = KeyboardOptions.Default.copy(<br/>        capitalization = KeyboardCapitalization.Sentences,<br/>        autoCorrect = true,<br/>        keyboardType = KeyboardType.Number,<br/>        imeAction = ImeAction.Search<strong class="nx iu"><br/>    </strong>),<br/>    <strong class="nx iu">keyboardActions = KeyboardActions(onNext = {<br/>        // TODO you're action goes here<br/>    }),</strong><br/>    modifier = Modifier<br/>        .fillMaxWidth()</span><span id="4c6b" class="oe md it nx b gy oj og l oh oi">)</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="37ba" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><em class="ok"> LocalFocusManager </em></h1><p id="96c0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">既然我们已经完成了键盘选项的设置，并且找到了一种捕获用户与键盘交互的方法，那么是时候对交互执行自定义操作了。</p><p id="211b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个最常见的用例是当用户与<code class="fe nu nv nw nx b">onNext</code> IME选项交互时，将一个输入字段的焦点移到下一个。</p><p id="c7b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Jetpack Compose中，我们使用了<code class="fe nu nv nw nx b">LocalFocusManager</code>来控制composable中的焦点。首先，我们需要获得焦点管理器的<code class="fe nu nv nw nx b">current</code>实例，如下所示:</p><pre class="kj kk kl km gt oa nx ob oc aw od bi"><span id="5086" class="oe md it nx b gy of og l oh oi">val focusManager = LocalFocusManager.current</span></pre><p id="b0fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们需要使用在前面章节中实现的<code class="fe nu nv nw nx b">onNext</code> <code class="fe nu nv nw nx b">KeyboardAction</code>中的<code class="fe nu nv nw nx b">focusManager</code>来将焦点转移到下一个<code class="fe nu nv nw nx b">TextField</code>:</p><pre class="kj kk kl km gt oa nx ob oc aw od bi"><span id="d825" class="oe md it nx b gy of og l oh oi">keyboardActions = KeyboardActions(onNext = <strong class="nx iu">{<br/>    focusManager.moveFocus(FocusDirection.Down)</strong><br/><strong class="nx iu">}</strong>),</span></pre><p id="ad1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用这个<code class="fe nu nv nw nx b">LocalFocusManager</code>来聚焦任何视图而不仅仅是<em class="nc"> </em> <code class="fe nu nv nw nx b">TextField</code>。我们还可以向多个方向转移焦点— <code class="fe nu nv nw nx b">Up</code>、<code class="fe nu nv nw nx b">Down</code>、<code class="fe nu nv nw nx b">Next</code>、<code class="fe nu nv nw nx b">Previous</code>、<code class="fe nu nv nw nx b">In</code>、<code class="fe nu nv nw nx b">Out</code>、<code class="fe nu nv nw nx b">Left</code>、<code class="fe nu nv nw nx b">Right</code>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c6b1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><em class="ok">键盘控制器</em></h1><p id="6bdf" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们有两个<code class="fe nu nv nw nx b">TextFields</code>，对于第一个字段，我们使用<code class="fe nu nv nw nx b">onNext</code> ime选项，因为它必须将焦点转移到下一个视图，但是在第二个字段中，我们将使用<code class="fe nu nv nw nx b">onDone</code> ime选项。</p><p id="79df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当用户点击<code class="fe nu nv nw nx b">onDone</code>时，我们需要将焦点从<code class="fe nu nv nw nx b">TextField</code>上移开并关闭键盘，如下所示:</p><pre class="kj kk kl km gt oa nx ob oc aw od bi"><span id="bdb0" class="oe md it nx b gy of og l oh oi">keyboardOptions = KeyboardOptions.Default.copy(<br/>    capitalization = KeyboardCapitalization.Sentences,<br/>    autoCorrect = true,<br/>    keyboardType = KeyboardType.Number,<br/>    imeAction = ImeAction.Done<strong class="nx iu"><br/></strong>),<br/><strong class="nx iu">keyboardActions = KeyboardActions(onNext = {<br/>    focusManager.clearFocus()<br/>}),</strong></span></pre><p id="a6e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将移除<code class="fe nu nv nw nx b">TextField</code>上的焦点并关闭键盘。但是可能会有一种情况，你需要手动关闭键盘，这时我们使用<code class="fe nu nv nw nx b">KeyboardController</code>。</p><p id="2fbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要得到如下所示的<code class="fe nu nv nw nx b">current</code>实例:</p><pre class="kj kk kl km gt oa nx ob oc aw od bi"><span id="e868" class="oe md it nx b gy of og l oh oi">val keyboardController = LocalSoftwareKeyboardController.current</span></pre><p id="fa55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们需要调用<code class="fe nu nv nw nx b">hide</code>函数来关闭键盘:</p><pre class="kj kk kl km gt oa nx ob oc aw od bi"><span id="de5f" class="oe md it nx b gy of og l oh oi">keyboardController?.hide()</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="241c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们把所有的拼图放在一起时，它看起来如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e4c3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最终输出</h1><p id="b44e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这是我们正在运行的Android应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/3f81f8b964487224425990d910deba26.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*Dpfy2RzWQ-hZsYTiGpP7DQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">最终输出</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9f47" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="1c1e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">目前就这些。希望你学到了有用的东西。感谢阅读。</p></div></div>    
</body>
</html>