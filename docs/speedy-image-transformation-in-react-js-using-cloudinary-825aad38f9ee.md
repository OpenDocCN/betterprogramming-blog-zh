# 使用 Cloudinary 在 React.js 中快速转换图像

> 原文：<https://betterprogramming.pub/speedy-image-transformation-in-react-js-using-cloudinary-825aad38f9ee>

## 在 React 应用中快速轻松地转换图像

![](img/85ea9a713d0aed207e45d3e380707259.png)

在 [Unsplash](https://unsplash.com/s/photos/clouds?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上由 [Rodion Kutsaev](https://unsplash.com/@frostroomhead?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 拍照

# 介绍

图像是现代 web 应用程序中非常常见和重要的元素，因此，需要对其进行适当的处理，以适应应用程序的设计。这篇文章教你如何处理和转换图像，提供了详细的描述，并展示了常用转换的用例。

Cloudinary 允许您轻松地将图像动态转换为任何所需或合适的格式、样式和尺寸。它还能以最小的文件大小提供优化的图像，同时保持高视觉质量，即使使用最小的带宽也能获得出色的用户体验。

所有这些都可以通过实现动态图像转换和交付 URL 来完成。您还可以随时更改所需的转换。所有转换后的映像都是按需(延迟)创建的，并通过具有优化缓存的快速 CDN 交付给最终用户。

# 云雾缭绕

媒体管理的云提供商 Cloudinary 提供了多种图像转换选项。

例如，您可以调整图像大小和裁剪图像。然后，您可以使用符合您需求的图像格式来交付它们，同时还可以应用各种滤镜和效果。

你也可以使用 Cloudinary 的智能裁剪技术，包括人脸检测或自动重力，根据上传照片的最相关部分进行裁剪。对于复杂的转换，您可以使用管理控制台或管理 API 来定义命名转换，甚至可以在您的映像上运行一组链式转换。您还可以使用管理控制台查看您的交付使用情况报告和优化见解。

要使用上述所有功能，拥有一个 Cloudinary 帐户是必不可少的。

# 创建云账户

要上传将被转换并交付到您的 web 应用程序的图像，Cloudinary 帐户是必不可少的。要创建一个，请登录 https://www.cloudinary.com 的[，并遵循以下步骤:](https://www.cloudinary.com)

*   单击注册按钮
*   用适当的信息填写字段
*   将云名称编辑为您喜欢的名称，并勾选验证码框进行验证
*   单击创建帐户按钮提交注册表单
*   弹出欢迎模式后，选择适当的字段，然后继续

# 上传图像

图片可以通过多种方式上传。你可以从你的本地计算机拖放它们或者浏览到图像本身。其他选项包括使用 URL 地址、社交媒体链接、Dropbox 地址和谷歌图片地址。

*   在仪表板中，选择媒体库选项卡。
*   选择上传媒体选项。
*   选择高级选项，并为图像的公共 ID 输入一个唯一的名称。公共 ID 是图像的唯一标识符。
*   选择一个方便的视频上传选项:在这种情况下，拖放选项用于获取视频，因为它在本地可用。

完成最后一步后，图像会自动上传到 Cloudinary 服务器。

**注意这些参数:** `cloudname`和`publicId`。`cloudname`是用户在开立云二进制账户时的唯一名称。这是评估用户在 Cloudinary 上上传图片所需要的，而`publicId`参数是用户上传图片的唯一标识符。

# 使用反应堆

为了使用 React 集成图像转换，Cloudinary 指定了其 React SDK，该 SDK 使用与您现有的 React 应用程序无缝集成的代码轻松执行智能图像操作，并向您的用户提供优化的响应媒体。

## **React SDK 特性**

*   构建用于图像和视频转换和操作的 URL
*   用于嵌入和转换图像的辅助元素，等等

## **反应大写和数据类型准则**

根据 Cloudinary 的官方文档，在使用 React SDK 时，记住以下准则非常重要:

*   参数名称:`camelCase`。比如`publicId`。
*   类别:`PascalCase`。比如`ImageTag`。
*   方法:`camelCase`。比如`toHTML`。
*   将参数数据作为对象传递

# 安装和设置

要将 Cloudinary 图像转换集成到您现有的 React 项目中，请注意以下几点。

## **1。安装 React SDK**

Cloudinary React SDK 作为 Cloudinary 的 JavaScript (cloudinary-core)库之上的一层。通过运行以下命令安装 SDK:

```
npm install cloudinary-react --save
```

## **2。在你的代码中包含 cloudinary-react 库的必需元素**

图像转换需要以下三个要素:

*   `CloudinaryContext` —允许您定义应用于所有子元素的共享参数
*   `Image` —定义一个模糊的图像标签
*   `Transformation` —允许您在父元素上定义附加转换

## **3。设置云二进制配置参数**

要使用 Cloudinary React 元素，您必须至少配置您的 Cloudinary 帐户云名称。如果相关，您还可以定义几个可选的配置参数。Y

您可以在管理控制台的仪表板中找到特定于帐户的配置凭据。您可以将这些设置直接应用于每个元素，或者使用一个`CloudinaryContext`元素将它们应用于所有子元素。

例如:

*   直接在元素中配置:

*   带有`CloudinaryContext`的配置适用于所有子元素:

# 对图像操作做出反应

您上传到 Cloudinary 的图像资产可以通过动态 URL 传送到 web 应用程序。您可以在动态 URL 中包含指令，告诉 Cloudinary 使用一组转换参数来操作图像资产。

所有操作都在云中自动执行，转换后的资产也在通过快速 CDN 发送给最终用户之前自动优化，以获得最佳用户体验。

例如，您可以调整大小和裁剪、添加叠加图像、模糊或像素化面部、应用各种特殊效果和滤镜，以及应用设置来优化您的图像并提供响应。

Cloudinary 的 React 库简化了转换 URL 的生成，便于在 React 应用程序中嵌入资产。

# 传递和转换图像

可以使用`Image`组件传送上传的图像。输出是一个完整的 HTML `<img>`标签，其`src`指向相关的 Cloudinary 转换 URL。

比如说…

…由 React to 编译:

您还可以添加可选的`Transformation`元素，用作链式转换(每个转换都应用于前一个转换的结果)。

例如，以下代码将图像裁剪为“150x150”，圆角，应用棕褐色效果，将文本添加到调整后的图像的顶部中心，然后将整个结果旋转 20 度。

# 使用 React 应用常见的图像变换

## **调整大小和裁剪**

有多种不同的方法来调整图像的大小和/或裁剪图像，以及控制在裁剪过程中保留的图像区域。

以下示例使用`fill`裁剪方法来生成并交付一个填充所请求的 300x300 大小的图像。它使用面部检测重力来确保图像中的所有面部在图像被裁剪时被保留并居中:

原始图像的原始尺寸为 1000x667

![](img/8649f2b2baa5c82d0f4871f425f2f917.png)

照片由 Hart Tan 根据[番茄照片](http://www.tomato.sg)创作

![](img/226d8c4d4c9b2daafd76f71ca788c505.png)

优化的图像(300 x 300 ),带有表面重力和填充裁剪

## **转换成另一种图像格式**

您可以交付上传到 Cloudinary 的任何图像，基本上可以是任何图像格式。以另一种格式转换和交付有三种主要方式:

*   用所需的扩展名指定图像的公共 ID
*   使用`fetchFormat` 参数明确设置所需格式
*   使用值`**auto**`指示 Cloudinary 为每个请求图像的浏览器提供最佳格式的图像。

例如:

交付一个`.gif`格式的`.jpg`文件:

下面的代码让 Cloudinary 为每个浏览器选择最佳格式。例如，在 Chrome 浏览器中，这张图片以`.webp`格式呈现。

## **应用图像效果和滤镜**

有大量的图像效果、增强和滤镜可供选择，可应用于您的图像。

Cloudinary 中可用的效果包括各种色彩平衡和色阶效果、着色、模糊、像素化、锐化、自动改善效果、艺术滤镜、图像和文本叠加、变形和形状改变效果、轮廓、背景、阴影等等。

例如，下面的代码应用了卡通效果、圆角效果和背景色效果(然后将图像缩小到 300 像素的高度)。

![](img/a9eb606ea05f9cb33266d519c61771c3.png)

[赤池亲王](https://unsplash.com/@princearkman)在 [Unsplash](https://unsplash.com/photos/i2hoD-C2RUA) 上的原始照片

![](img/afe7bd15dbb2e9584af0bb031faec743.png)

变换图像

## **图像优化**

默认情况下，Cloudinary 会自动对所有转换后的图像执行某些优化。但是，有几个额外的特性可以让您进一步优化 React 应用程序中使用的图像。其中包括对图像质量、格式和大小的优化。

例如，您可以使用`fetchFormat` 和`quality`属性的`auto`值，以最小化文件大小同时满足所需质量水平的格式和质量自动交付图像。

下面应用了这两个参数，结果文件大小减少了近 50%(286 kb 对 151KB)，质量没有明显变化。

![](img/7fef9e43e627f3b01b2f851de0eef209.png)

使用自动格式和自动质量功能，文件大小优化了近 50%。由 [Andrea Cau](https://unsplash.com/@andreacau) 在 [Unsplash](https://unsplash.com/photos/nV7GJmSq3zc) 上拍摄的原始照片。

要深入了解优化图像的多种方法，请参阅 Cloudinary 的[图像优化](https://cloudinary.com/documentation/image_optimization)文档

## **响应图像设置**

响应式 web 设计是一种网页创建方法，它利用灵活的布局、灵活的图像和级联样式表媒体查询来提供最佳的查看体验，而不管屏幕大小和方向如何。

响应式设计的目标是构建能够检测访问者屏幕大小和方向的网页，并相应地改变布局。

确保最佳体验意味着您应该避免发送在客户端调整大小的高分辨率图像，这对小显示器的用户来说是很大的带宽浪费。相反，您应该始终为每种设备和屏幕尺寸提供正确尺寸的图像。

Cloudinary 有助于降低动态图像转换的复杂性。您可以根据特定的设备分辨率和窗口大小，简单地构建任何图像宽度或高度的图像 URL。这意味着您不必重新创建图像——根据需要动态调整大小。

例如，您可以使用`dpr` 和`width`属性的`auto` 值，确保每个用户以适合其设备的大小和设备像素比率(DPR)接收图像。根据实际的浏览器设置和窗口宽度，`auto`值被替换为客户端的实际值:

# 结论

在本文中，我们讨论了使用 Cloudinary 转换图像的各种方法，以获得更好的应用程序和站点性能。

然而，还有很多其他的转换效果和方法在本文中无法讨论，可以在这里查看。