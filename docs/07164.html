<html>
<head>
<title>Building a Sentiment-Classifier App With CreateML and SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用CreateML和SwiftUI构建情感分类器应用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-sentiment-analyser-app-with-createml-and-swiftui-1a24071b6894?source=collection_archive---------0-----------------------#2020-12-12">https://betterprogramming.pub/create-a-sentiment-analyser-app-with-createml-and-swiftui-1a24071b6894?source=collection_archive---------0-----------------------#2020-12-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9187" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将NLP模型整合到iOS开发中非常简单，是探索机器学习的好方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fafd55cfde6e908558ab10b284316b8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DJwImDciI9gYWvJgs_L5MA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@tengyart?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">腾雅特</a>在<a class="ae kv" href="https://unsplash.com/s/photos/emotion?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="a885" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今天，我们将制作一个基本的应用程序，它将能够使用自然语言处理(NLP)来预测一个陈述是积极的还是消极的。</p><p id="2456" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这听起来令人印象深刻，但使用苹果的CreateML框架创建机器学习模型并将其集成到应用程序中是非常简单的。下面的应用程序非常简单，但是这种训练和创建机器学习模型的工作流程可以用来创建更加复杂和有趣的机器学习项目</p><h2 id="9d89" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">完成的应用程序预览</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/a9a1e9468867136df2709a9f789fd2ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/1*tHKlqwOE5tuMh45jWeM10g.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">该应用程序将能够预测简短的陈述是积极的还是消极的</p></figure></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="aaa0" class="mt lt iq bd lu mu mv mw lx mx my mz ma jw na jx md jz nb ka mg kc nc kd mj nd bi translated">收集数据</h1><p id="0949" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ng lh li lj nh ll lm ln ni lp lq lr ij bi translated">有许多数据集是为训练情感分析模型而设计的。我使用了<a class="ae kv" href="http://help.sentiment140.com/" rel="noopener ugc nofollow" target="_blank">sensition 140</a>，这是一个标记为积极、消极或中立的推文的大集合。你可以在这里下载<a class="ae kv" href="http://help.sentiment140.com/for-students/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="a2e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要做一些数据清理，为CreateML准备好数据集。出于这个非常简单的应用程序的目的，我们将只有正面(<code class="fe nj nk nl nm b">4</code>)和负面(<code class="fe nj nk nl nm b">0</code>)推文，并且我们将把每个推文的示例限制在100，000个以下(这将足以训练一个简单的模型，而不会让我的笔记本电脑着火)。</p><p id="01b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以将标签改为数据中的<code class="fe nj nk nl nm b">negative</code>和<code class="fe nj nk nl nm b">positive</code>，而不是<code class="fe nj nk nl nm b">4</code>和<code class="fe nj nk nl nm b">0</code>，但我们将在应用程序中解释这些标签(我的问题内存将很难更新CSV文件中的100k+行)。</p><p id="ca65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">CreateML可以将JSON、CSV和文本文件作为训练数据，但关键的是我们需要使用列标题<code class="fe nj nk nl nm b">label</code>(例如<code class="fe nj nk nl nm b">0</code> / <code class="fe nj nk nl nm b">4 </code> — <code class="fe nj nk nl nm b">negative</code> / <code class="fe nj nk nl nm b">positive</code>)和<code class="fe nj nk nl nm b">text</code>(即tweet)来指导CreateML如何划分我们对每条tweet的分类。准备好的表格如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/cf9dca0ba04564a78e8bee40a72d8205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gGnAIixfgrpLBeJ4rPUf4w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的CSV文件，显示一些“负面”(“0”)推文</p></figure></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="71a5" class="mt lt iq bd lu mu mv mw lx mx my mz ma jw na jx md jz nb ka mg kc nc kd mj nd bi translated">训练我们的模型</h1><p id="87f3" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ng lh li lj nh ll lm ln ni lp lq lr ij bi translated">接下来，我们可以创建我们的CreateML项目。您可以通过Playground在代码中实现这一点，但最简单的方法是使用CreateML应用程序(Xcode 11及更高版本附带了该应用程序)。您可以获得各种各样的项目类型(图像分类器、文本分类器，甚至声音分类器)。这将是一个文本分类器项目。</p><p id="d65e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为训练数据选择CSV文件，并将验证数据保留为自动。您还可以使用在训练数据中没有使用的tweets创建一个较小的CSV文件，作为测试数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/289fa7582dba941650848d1ebe51ef9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8xaKdAWyoC-72CejnE-WmQ.png"/></div></div></figure><p id="8898" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">CreateML应该正确地识别我们有两个类的事实:<code class="fe nj nk nl nm b">0</code>和<code class="fe nj nk nl nm b">4</code>。接下来，我们可以选择要使用哪种算法来训练我们的模型。我们有三种选择:最大熵、条件随机场和迁移学习。不同的算法最适合不同的用途，但是对于这个非常简单的分类器，我们将坚持使用最大熵。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/436be731d6116cb41bfc61704bfdb95f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*XzlChqBD8U2AgGFz35EBaA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">您可以选择模型应该使用的算法</p></figure><p id="352a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们只需点击右上角的“火车”按钮。这将使用我们的数据和我们选择的算法来训练模型。这可能需要一段时间，但是您可以看到它的准确性随着数据的多次迭代而提高:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/4b122c1ed3914fdcbfb58f42ed7f6153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bk9xI1ww_JLON_Gpr9Gg0w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">CreateML显示了被训练的模型</p></figure><p id="0eb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦完成，我们可以在预览选项卡中旋转模型。输入一些消极或积极的东西，看看模型是怎么想的，有多自信:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/d5056c121ad1ab4cfe0bc160a47a60e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*edK3CD27-JkRaZgzN7j0bw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">您可以在CreateML中测试您的训练模型。在这个模型中，4 =正，所以我们看起来不错！</p></figure><p id="4bac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用CreateML训练文本分类器模型就是这么简单。</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="2b88" class="mt lt iq bd lu mu mv mw lx mx my mz ma jw na jx md jz nb ka mg kc nc kd mj nd bi translated">构建应用程序</h1><p id="9a5f" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ng lh li lj nh ll lm ln ni lp lq lr ij bi translated">当我们使用CreateML创建一个模型时，输出的<code class="fe nj nk nl nm b">.mlmodel</code>文件包含了一个表示我们模型的类。这是我们在应用程序中与模型互动的方式。在output选项卡上，点击“Xcode”按钮，您将看到一个新的Xcode画布，详细描述您的新<code class="fe nj nk nl nm b">CoreML</code>类。要将您的模型类添加到您的应用程序中，您只需将它拖到项目文件中。</p><p id="54bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们可以创建一个类来处理我们的模型(<code class="fe nj nk nl nm b">SentimentIdentifier</code>)——您还必须导入<code class="fe nj nk nl nm b">CoreML</code>和<code class="fe nj nk nl nm b">NaturalLanguage </code>模块。这个类将管理我们的应用程序的机器学习方面。这个类应该符合<code class="fe nj nk nl nm b">ObservableObject</code>协议，因为我们将发布我们的预测结果，供视图更新。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="b1fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个类相当简单。对于我们的视图感兴趣的数据，它有两个已发布的属性—预测[正(<code class="fe nj nk nl nm b">4</code>)或负(<code class="fe nj nk nl nm b">0</code> )]和预测的置信度，如果它是两种可能性中最有可能的，则它将在0.5和0.999之间，等等。</p><p id="4ed8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的类初始化器中，我们从导入的<code class="fe nj nk nl nm b">SentimentModel</code>类初始化我们的模型，然后使用我们的模型创建一个<code class="fe nj nk nl nm b">NLModel</code> ( <code class="fe nj nk nl nm b">SentimentPredictor</code>)。<code class="fe nj nk nl nm b">NLModel</code>是我们实际上用来做预测的，使用它的内置方法。</p><p id="a70d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们创建预测函数。这需要一个字符串(即我们想要分类的内容)，并使用我们的<code class="fe nj nk nl nm b">NLModel</code>来进行预测。我们也可以用<code class="fe nj nk nl nm b">predictedLayoutHypothesis</code>来看预测的置信度。该函数返回一个<code class="fe nj nk nl nm b">[String : Double]</code>字典，其中包含分类以及模型在每个分类中的可信度。</p><p id="1342" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以通过使用它作为访问相关置信度值的键来访问预测的置信度。更有效的方法是调用<code class="fe nj nk nl nm b">predictedLayoutHypothesis()</code>并通过使用排序字典来提取置信度最高的预测(以避免两次预测)，但是我们现在所做的更具可读性。</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="8a30" class="mt lt iq bd lu mu mv mw lx mx my mz ma jw na jx md jz nb ka mg kc nc kd mj nd bi translated">将它链接到视图</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="017a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们希望我们的视图允许用户在一个<code class="fe nj nk nl nm b">TextField</code>中键入一些文本，然后调用我们的模型来预测它是积极的还是消极的。我们所需要做的就是创建一个<code class="fe nj nk nl nm b">SentimentIdentifer</code>类的<code class="fe nj nk nl nm b">ObservedObject </code>实例，允许我们做出预测并监听结果。</p><p id="d036" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将变得时髦，使用表情符号来代表积极或消极的情绪，我们将缩放表情符号，并增加相对于预测置信度得分的不透明度。</p><p id="39a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们的应用程序可以预测情绪，并在用户键入时动画显示表情符号的变化，而不是用户在完成键入后按下按钮，那将非常酷。为此，我们需要调用我们的预测模型来响应用户编辑<code class="fe nj nk nl nm b">TextField</code>的输入。我们可以在我们的<code class="fe nj nk nl nm b">TextField</code>上使用<code class="fe nj nk nl nm b">.onChange()</code>修改器来做到这一点。</p><p id="9a30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，我们不希望用户每增加一个字符就做一个新的预测，只是每一个单词。当输入的最后一个字符是一个空格时，我们可以通过调用<code class="fe nj nk nl nm b">predict()</code>方法来实现这一点，这表明用户刚刚完成了一个单词的编写。</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="7795" class="mt lt iq bd lu mu mv mw lx mx my mz ma jw na jx md jz nb ka mg kc nc kd mj nd bi translated">结论</h1><p id="0ee1" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ng lh li lj nh ll lm ln ni lp lq lr ij bi translated">这显然是机器学习和NLP的一个非常基本的用途。但我希望它显示了机器学习工具是多么容易获得——即使对于没有经验的iOS程序员和刚刚掌握机器学习的人来说也是如此。</p></div></div>    
</body>
</html>