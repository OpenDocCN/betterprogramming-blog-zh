<html>
<head>
<title>Testing Your Components in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中测试您的组件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/testing-your-components-in-react-967abda02396?source=collection_archive---------5-----------------------#2020-05-12">https://betterprogramming.pub/testing-your-components-in-react-967abda02396?source=collection_archive---------5-----------------------#2020-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3392" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">测试工具、测试渲染器和React测试库的演练</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a0c11e167ebb5d8442a7a3de51d1fbe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zu7uOIIxaN3rVmYz3ksj9w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由watirmelon.blog提供</p></figure><p id="cbac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">软件测试提供了关于被测试软件质量的信息。</p><p id="bbc6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">测试有很多种。单元测试隔离程序的每个部分，并验证各个部分是正确的——它具有最窄的范围和最大数量的测试用例。集成测试是将单个软件模块作为一个组进行组合和测试的阶段——它的范围最广，测试用例最少。</p><p id="cf15" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上图的<a class="ae lu" href="https://watirmelon.blog/melon-of-knowledge/testing-pyramids/" rel="noopener ugc nofollow" target="_blank">中，左边是推荐测试金字塔，右边是测试雪糕筒，要避开。</a></p><p id="4d41" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们已经写了一个关于如何测试和模拟异步调用的单元测试用例的指南。本文重点介绍如何用React测试库测试React组件，它涵盖了单元测试和集成测试。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7d93" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">历史</strong></h1><p id="3ac8" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated"><a class="ae lu" href="https://github.com/facebook/jest" rel="noopener ugc nofollow" target="_blank"> Jest </a>是一个JavaScript测试框架，确保任何JavaScript代码库的正确性。因为Jest和React都是由脸书创建和维护的，所以使用Jest测试框架来测试React代码是一种常见的做法。</p><p id="40dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">React团队提供了两种测试React组件的方法:<a class="ae lu" href="https://reactjs.org/docs/test-utils.html" rel="noopener ugc nofollow" target="_blank">测试工具</a> ( <code class="fe mz na nb nc b">react-dom/test-utils</code>)和<a class="ae lu" href="https://reactjs.org/docs/test-renderer.html" rel="noopener ugc nofollow" target="_blank">测试呈现器</a> ( <code class="fe mz na nb nc b">react-test-renderer</code>)。这些包不足以进行生产级测试，但是它们是更高级的测试库和框架的良好基础。</p><p id="bcd2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">React团队推荐<a class="ae lu" href="https://airbnb.io/enzyme/" rel="noopener ugc nofollow" target="_blank">酶</a>和<a class="ae lu" href="https://testing-library.com/react" rel="noopener ugc nofollow" target="_blank"> React测试库</a>。</p><ul class=""><li id="3a02" class="nd ne it la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">Enzyme是一个JavaScript测试工具，用于测试React组件。它促进了单元和集成测试。它有内置的方法来操作和遍历虚拟DOM，以及模拟动作和事件。它允许我们断言呈现的组件按预期工作。它提供了三种测试方式:浅层、挂载和渲染。</li><li id="3567" class="nd ne it la b lb nm le nn lh no ll np lp nq lt ni nj nk nl bi translated">React测试库通过软件的使用方式来测试React组件。它促进了单元和集成测试。测试用例对代码变化是健壮的。由于React测试库没有为独立的测试提供API，所以模仿通常是浅层测试的方式。<a class="ae lu" href="https://medium.com/better-programming/10-fun-facts-about-create-react-app-eb7124aa3785" rel="noopener">创建React App </a>预配置了React测试库。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="abf6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">测试实用程序</h1><p id="670d" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">以下是Create React App提供的<code class="fe mz na nb nc b">App.test.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="09a4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Test utilities ( <code class="fe mz na nb nc b">react-dom/test-utils</code>)提供了16个实用API来帮助测试。在下面的代码中，我们在第六行使用<code class="fe mz na nb nc b">renderIntoDocument</code>来替换上面<code class="fe mz na nb nc b">App.test.js</code>中的第六到第七行。第七行验证<code class="fe mz na nb nc b">&lt;App /&gt;</code>是否为元素，第八行验证<code class="fe mz na nb nc b">&lt;App /&gt;</code>是否为元素，类型是否为<code class="fe mz na nb nc b">App</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="af3b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您的代码执行状态更新，您必须将代码包装在<code class="fe mz na nb nc b">act()</code>中:</p><pre class="kj kk kl km gt nt nc nu nv aw nw bi"><span id="2326" class="nx md it nc b gy ny nz l oa ob">act(() =&gt; {<br/>  renderIntoDocument(&lt;App /&gt;, div);<br/>});</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a391" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">测试渲染器</h1><p id="5c3a" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">测试渲染器(<code class="fe mz na nb nc b">react-test-renderer</code>)用于将React组件渲染为纯JavaScript对象，而不依赖于DOM或原生移动环境。它提供了19个API。</p><p id="6444" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了使用测试渲染器，<code class="fe mz na nb nc b">react-test-renderer</code>需要作为<code class="fe mz na nb nc b"><a class="ae lu" href="https://medium.com/better-programming/package-jsons-dependencies-in-depth-a1f0637a3129" rel="noopener">devDependencies</a></code>安装在<code class="fe mz na nb nc b">package.json</code>中:</p><pre class="kj kk kl km gt nt nc nu nv aw nw bi"><span id="55eb" class="nx md it nc b gy ny nz l oa ob">"devDependencies": {<br/>  "react-test-renderer": "^16.13.1"<br/>}</span></pre><p id="8412" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是修订后的App.test.js，带有测试渲染器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="0afa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第七行打印出呈现的树:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="a2b8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第八行打印出代表被渲染的树的对象:</p><pre class="kj kk kl km gt nt nc nu nv aw nw bi"><span id="5be7" class="nx md it nc b gy ny nz l oa ob">{ type: 'div',<br/>  props: { className: 'App' },<br/>  children: [{ type: 'header', props: [Object], children: [Array] }]<br/>}</span></pre><p id="4650" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">测试渲染器是快照测试的基础。一个典型的快照测试用例渲染一个UI组件，拍摄快照，保存在<code class="fe mz na nb nc b">__snapshots__</code>目录下作为引用。一个测试用例将新的快照与引用进行比较，并验证UI没有意外更改。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2ea0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">反应测试库</h1><p id="9706" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">React测试库建立在<code class="fe mz na nb nc b">react-test-renderer</code>之上。比较快照的测试，以下语法比测试渲染器略简单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="cd04" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了使用React测试库，<code class="fe mz na nb nc b">@testing-library/react</code>和<code class="fe mz na nb nc b">@testing-library/jest-dom</code>通常被添加到<code class="fe mz na nb nc b">package.json</code>文件中的<code class="fe mz na nb nc b">devDependencies</code>中。</p><pre class="kj kk kl km gt nt nc nu nv aw nw bi"><span id="cc55" class="nx md it nc b gy ny nz l oa ob">"devDependencies": {<br/>  "@testing-library/jest-dom": "^5.5.0",<br/>  "@testing-library/react": "^10.0.2",<br/>}</span></pre><ul class=""><li id="6277" class="nd ne it la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated"><code class="fe mz na nb nc b">@testing-library/react</code>在<code class="fe mz na nb nc b">react-dom</code>和<code class="fe mz na nb nc b">react-dom/test-utils</code>之上提供照明实用功能。</li><li id="f37b" class="nd ne it la b lb nm le nn lh no ll np lp nq lt ni nj nk nl bi translated"><code class="fe mz na nb nc b">@testing-library/jest-dom</code>提供了一组自定义的笑话匹配器，如<code class="fe mz na nb nc b">toBeDisabled</code>、<code class="fe mz na nb nc b">toHaveAttribute</code>、<code class="fe mz na nb nc b">toHaveFormValues</code>。这些匹配器关注元素的属性、文本内容、CSS类等等。它使得expect语句更具声明性、可读性和可维护性。</li></ul><h2 id="db87" class="nx md it bd me oc od dn mi oe of dp mm lh og oh mo ll oi oj mq lp ok ol ms om bi translated">例子</h2><p id="85ec" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们创建一个例子来说明如何使用React测试库。</p><p id="2dc0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是UX的设计为例。最初，当前值为0。如果点击<code class="fe mz na nb nc b">Add 1</code>按钮，当前值增加1。如果点击<code class="fe mz na nb nc b">Add 2</code>按钮，当前值增加2。如果点击<code class="fe mz na nb nc b">Add 3</code>按钮，当前值上升3。如果点击<code class="fe mz na nb nc b">Reset</code>按钮，当前值被重置为0。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/2d034a30b76689d97c178c2f7a6cd743.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*V8_7epc9R-5uFpvxI7w69Q.png"/></div></figure><h2 id="2eff" class="nx md it bd me oc od dn mi oe of dp mm lh og oh mo ll oi oj mq lp ok ol ms om bi translated">源代码</h2><p id="c8ff" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们修改了<code class="fe mz na nb nc b">App.js</code>来实现这个例子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="cccf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的代码中，按钮和实用程序被定义在单独的文件中，以模拟真实世界的复杂性。</p><p id="ab62" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mz na nb nc b">AddButton.js</code>导出默认组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="cae2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mz na nb nc b">ResetButton.js</code>使用命名导出:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="b24b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Utils.js还使用命名导出:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h2 id="b89e" class="nx md it bd me oc od dn mi oe of dp mm lh og oh mo ll oi oj mq lp ok ol ms om bi translated">快照测试</h2><p id="54c7" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们为修改后的<code class="fe mz na nb nc b">App.js</code>写一个快照测试。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="7f47" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是生成的快照内容，包含所有DOM元素:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="90a1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们添加了<code class="fe mz na nb nc b">AddButton</code>和<code class="fe mz na nb nc b">ResetButton</code>的模拟:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="e1e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从下面生成的快照内容中，我们可以看到内容已经从34行缩短到22行。这就是我们如何做浅层渲染来隔离测试。你可以想象如果<code class="fe mz na nb nc b">AddButton</code>和<code class="fe mz na nb nc b">ResetButton</code>都是复杂的组件，我们会节省多少时间。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h2 id="749a" class="nx md it bd me oc od dn mi oe of dp mm lh og oh mo ll oi oj mq lp ok ol ms om bi translated">互动测试</h2><p id="2299" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">React测试库测试代码的方式与用户使用代码的方式相同。它提供API来模拟操作。下面的测试用例点击<code class="fe mz na nb nc b">Add 1</code>、<code class="fe mz na nb nc b">Add 2</code>和<code class="fe mz na nb nc b">Add 3</code>按钮，并验证结果为<code class="fe mz na nb nc b">6</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="1eb0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的测试用例中，它使用<code class="fe mz na nb nc b">getByTestId</code>来检索<code class="fe mz na nb nc b">resultDiv</code>。按钮是在其他JavaScript源代码中定义的，其中可能没有提供测试id。<code class="fe mz na nb nc b">getByText</code>用于检索元素。</p><p id="18b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里，<code class="fe mz na nb nc b">getByTestId</code>和<code class="fe mz na nb nc b">getByText</code>从渲染结果中被析构。</p><p id="0eb7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在下面的测试用例中，我们从<code class="fe mz na nb nc b">@testing-library/react</code>模块中导入<code class="fe mz na nb nc b">getByTestId</code>和<code class="fe mz na nb nc b">getByText</code>。然后调用需要指定确切的容器。这个测试用例点击<code class="fe mz na nb nc b">Add 2</code>和<code class="fe mz na nb nc b">Reset</code>按钮，并验证结果为<code class="fe mz na nb nc b">0</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="bc65" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的例子中，我们嘲讽了<code class="fe mz na nb nc b">AddButton</code>和<code class="fe mz na nb nc b">RestButton</code>。<code class="fe mz na nb nc b">Utils</code>功能怎么样？也可以嘲笑它们来简化逻辑:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ab79" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="3b79" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">React附带了测试实用程序和测试渲染器。React测试库是React团队推荐的。我们修改了Create React应用程序，以提供快照测试用例和交互式测试的示例。这些测试用例在Create React应用程序存储库中运行。您可以用调用<code class="fe mz na nb nc b">react-scripts test</code>的<code class="fe mz na nb nc b">npm run test</code>来执行它们。</p><p id="bb65" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">享受React测试库的乐趣！</p><p id="f349" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读。我希望这有所帮助。你可以在这里看到我的其他媒体出版物<a class="ae lu" href="https://medium.com/@jenniferfubook/jennifer-fus-web-development-publications-1a887e4454af" rel="noopener">。</a></p></div></div>    
</body>
</html>