<html>
<head>
<title>JavaScript Tips #3: Convert Error-First Callback Functions to Promises</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript技巧#3:将错误优先回调函数转换为承诺</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/javascript-tips-3-convert-error-first-callback-functions-to-promises-f2561d2aaefd?source=collection_archive---------7-----------------------#2019-09-05">https://betterprogramming.pub/javascript-tips-3-convert-error-first-callback-functions-to-promises-f2561d2aaefd?source=collection_archive---------7-----------------------#2019-09-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="da5e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">JavaScript异步概述和保证错误优先回调的实用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/276fb56f68dfef6e8a8ba5ff36698ad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5ia5TFaJ8-Qfc0uT"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@the_roaming_platypus?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> timJ </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="8440" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">问题是</h1><p id="7cab" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">异步是JavaScript中的一个核心概念。我们知道处理异步函数的不同技术，异步函数出现在我们程序的许多操作中，尤其是当我们需要处理AJAX请求时。</p><p id="9464" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">让我们回顾一下其中的一些。</p><h2 id="4f89" class="mz lh it bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw nk bi translated">错误-第一次回调</h2><p id="b23f" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">错误优先模式包括在异步操作结束时执行一个函数(比如传入的AJAX响应),该函数将错误(如果发生了错误)作为第一个参数，并将请求的结果作为额外的参数。</p><p id="c3f5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下面是一个使用Node.js的文件系统模块中的<code class="fe nl nm nn no b">.readFile</code> <strong class="ma iu"> </strong>的示例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/018f000a12a7f4242ca6f69a6ffc5e92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5tGFCFsfpW9Bf0HdhX1p8A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">错误-第一次回调模式</p></figure><p id="dbaf" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">主要问题？复试地狱！如果我们开始嵌套异步操作，我们的代码会变得非常混乱。</p><h2 id="c0c1" class="mz lh it bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw nk bi translated"><strong class="ak">承诺</strong></h2><p id="8cbf" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在ES6中引入的这个API帮助开发人员更好地处理异步操作。</p><p id="297e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">承诺的一个强大特性是我们可以将异步操作链接起来。这篇文章没有深入讨论承诺是如何起作用的，但是我们可以通过一个简单的例子来理解它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/1be37c067ca04a71f80b504fa446cde8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XTkQ4Df8eLv2JbRXy02izA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用承诺处理异步请求</p></figure><h2 id="eaaf" class="mz lh it bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw nk bi translated"><strong class="ak">异步/等待</strong></h2><p id="2992" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在ES7中，这是一个关于承诺的包装器，使用异步<strong class="ma iu"> </strong>函数，使我们的代码执行看起来像同步执行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/3b4cdcb9aed732d7b7e2c330d4ecf8ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BpKsvsr7RRqil2d-xTcMRg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ES7中引入了异步/等待模式</p></figure><p id="8938" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">使用承诺使我们的代码更干净，可读性更好，但不幸的是，一些API仍然只能使用错误优先的回调模式。</p><p id="8533" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们如何让他们接受承诺去工作？</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="4028" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">解决方案</h1><p id="ef8a" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">网上有大量的实用程序和现成的库来保证一个功能。但是，对于学习来说，我更喜欢写一些代码，如果你面对一个没有集成承诺支持的API，这些代码将来会有用。</p><p id="3c74" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">让我们写一个可能的解决方案:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/0359425676153855e091f624921a0da8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k5ngV_mm4R5TlXeCnEwqsQ.png"/></div></div></figure><p id="76fe" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们来评论一下是怎么回事:</p><ol class=""><li id="cdc6" class="nt nu it ma b mb mu me mv mh nv ml nw mp nx mt ny nz oa ob bi translated">该实用程序创建了一个闭包，返回一个新函数，这将是我们承诺的版本。</li><li id="a9ed" class="nt nu it ma b mb oc me od mh oe ml of mp og mt ny nz oa ob bi translated">当被调用时，promisified函数返回一个新的<code class="fe nl nm nn no b">promise</code>。</li><li id="fca9" class="nt nu it ma b mb oc me od mh oe ml of mp og mt ny nz oa ob bi translated">在promise构造函数回调中，我们调用异步函数，我们转换该函数来处理promises，我们用错误优先回调来处理异步操作。</li><li id="6f86" class="nt nu it ma b mb oc me od mh oe ml of mp og mt ny nz oa ob bi translated">如果出现错误，它将被拒绝。</li><li id="5390" class="nt nu it ma b mb oc me od mh oe ml of mp og mt ny nz oa ob bi translated">否则，承诺会解决结果。</li></ol><p id="914a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">希望你喜欢这篇文章，感谢阅读！</p></div></div>    
</body>
</html>