# 如何在 Kotlin 中正确使用可空类型

> 原文：<https://betterprogramming.pub/how-to-use-nullable-types-correctly-in-kotlin-42ca3443eb85>

## 了解处理空元素的不同机制

![](img/d95b6da778baf148daf0914c6483fe7a.png)

迈克尔·泽兹奇在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

用 Java 编写代码最烦人的一点是处理空元素。为了让我们的代码空安全，不得不到处设置空检查条件，这可能是我们大多数人经常遇到的事情。

Kotlin 提供了不同的机制来帮助解决这个问题。让我们先过一遍。

# 不可为空的类型

默认情况下，Kotlin 类型是不可空的，这意味着不可能给它们赋值 null。这绝对是避免在我们的语言中处理空值的最好方法；虽然这总是可能的吗？

不总是这样，我们的服务中可能会有一个`findEmployee`方法，我们希望通过使用可空类型来表达找不到雇员的可能性。

如果我们以我们在[上一篇 Kotlin 文章中使用的关于](https://theboreddev.com/kotlins-either-bye-bye-exceptions/)的例子为例:

我们可以稍微修改一下，以包括找不到雇员的可能性；为了实现这一点，我们将使用可空类型。我们也可以为此使用一个`Problem`,但这将取决于您是否希望将其表示为有效的业务案例或例外案例。在我们的例子中，我们选择使用可空类型。那么它会是什么样子呢？

正如您所看到的，我们已经将 404 (NOT_FOUND)响应映射到一个空的`Employee`,作为可空的`Employee`响应。

如何从客户端处理这个问题？让我们快速浏览一下。

# 处理可空类型

Kotlin 初学者倾向于做的一件事是，每当需要解决可空类型和不可空类型之间的编译问题时，使用`!!`操作符。这是一个很大的错误，应该避免；如果实例为空,`!!`将抛出一个`NullPointerException`。**根据经验，除非非常必要，否则总是避免使用** `**!!**` **操作符。**

如果我们以我们的`PayrollService`为例，我们可以这样举例:

这很简单，但不幸的是，当我们的雇员为空时，它会引发一个`NullPointerException`；如果你想抓住它，然后用它做其他事情，请不要！

那么，我们怎样才能避免使用`!!`操作符呢？让我们看看还有什么别的选择。

# 无效支票

其中一个选项当然是用一个`if`条件检查实例是否为空。`If`检查有点冗长，而且会严重污染我们的代码。我们可以以我们的`PayrollService`为例，看看所有这些选项看起来会是什么样子；一旦我们引入空检查，它将会是这样的。

虽然这个选项是一个不错的处理方式，但是使用 if 条件的一个问题是，仅仅做一个非常简单的检查就需要多行代码，这最终会在多个地方污染我们的代码。在我们的例子中，这可能不是很明显，但是如果我们只想记录一个字段呢？我们必须在 logger 语句中嵌入一个完整的 if 条件，或者在调用它之前做一些检查。所以理想情况下，我们需要更简洁的东西，以便能够在一行程序中使用它。

![](img/4565b0b2d3cd048727e2b099cea98b18.png)

空检查的另一个问题是，它不是一个原子操作，所以在我们处理可变实例的情况下，由于值在空检查后立即改变，我们可能会陷入大问题。

我们还可以使用更简洁的`if`条件，尽管这也不理想，也不能解决空支票带来的一些问题。

让我们看看在科特林还能做些什么。

# 安全通话

Kotlin 提供的一个好工具是安全调用。我们可以通过使用操作**来使用安全调用？。**；这将安全地访问空实例或其属性。我们还可以通过使用 [let 方法](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/let.html)对实例执行任何操作来对实例应用操作。

值得一提的是，如果实例为 null，安全调用将返回 null。例如，如果 employee 实例为 null，那么`employee?.name`将“安全地”返回 null，而不是引发`NullPointerException`。

例如，假设我们想在一个日志语句中记录雇员姓名。我们可以很容易地做到这一点，如下所示；在我们的员工为空的情况下，`null`将被打印在我们的日志中。

这就引出了下一个问题；如果我们想在日志中为员工姓名提供一个默认值，该怎么办？

# Elvis 操作员

[elvis 运算符](https://kotlinlang.org/docs/null-safety.html#elvis-operator)允许我们定义一个不可为空的值，以便在左侧返回空值的情况下使用。

例如，在中，我们想在日志语句中定义一个默认值，我们可以这样做:

就这么简单！

现在知道了我们所学的一切，从我们的`PayrollService`中处理可空类型的最好方法是什么？

# 把所有的放在一起

有了所有的选项，我们现在有了一个干净、简洁、安全和富有表现力的方法来处理一个可空的`Employee`类型，可能是这样的:

那看起来简洁干净；可能会有一些反对它的论点，因为它不是“人类可读的”，但我可以保证，一旦你习惯了使用安全调用和`let`方法，你会毫不费力地阅读它。

同样值得一提的是，如果您正在处理可变变量(这是我不推荐的)，使用`let`比使用`if`条件更安全。这是因为在`let`方法中传递给 lambda 的值不会改变，即使原始变量改变了它的值；这将使你的街区在这种特殊情况下更加安全。

# 结论

Kotlin 对 Java 因其引发的所有问题而备受批评的领域之一进行了重大改进。像[东尼·霍尔](https://en.wikipedia.org/wiki/Tony_Hoare)这样的人甚至已经首先为发明 *null* 道歉，所以我们不是在讨论一个微不足道的问题；由于各种原因，这在许多语言中都是昂贵而痛苦的。

![](img/6a14aa2ae771090b6b6b1bf40fbb3d81.png)

暂时就这样吧！我们希望你这次真的喜欢并学到了有用的东西！最后一件事，如果你觉得你需要提高你的科特林知识，需要一本好书，我们建议看看[科特林在行动](https://geni.us/f4BI)或[头先科特林](https://geni.us/VumcB)。我们认为这些是开始学习 Kotlin 的好资源，并对用它编写应用程序有了基本的了解。

感谢阅读我们，如果你喜欢我们的内容，请订阅！