<html>
<head>
<title>How to Pick an Image From Your Camera or Photo Library in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在SwiftUI中从您的相机或照片库中挑选图像</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-pick-an-image-from-camera-or-photo-library-in-swiftui-a596a0a2ece?source=collection_archive---------1-----------------------#2020-05-03">https://betterprogramming.pub/how-to-pick-an-image-from-camera-or-photo-library-in-swiftui-a596a0a2ece?source=collection_archive---------1-----------------------#2020-05-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="787b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将手机照片添加到SwiftUI应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3cb008ceb072e75412153794dbe2fb33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Itdjt0pPvXrMPwkBYI0qag.png"/></div></div></figure><p id="ef3e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">SwiftUI是WWDC19的一个精彩预告。由于SwiftUI是一个不到一年的框架，我们没有丰富的声明式API来满足许多基本需求，如从图片库或相机、地图等中选择图像。</p><p id="46d4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于苹果总是以这样或那样的方式提供多种选择来实现我们的需求，我们在SwiftUI中确实有一些东西来集成我们现有的来自UIKit的<code class="fe ln lo lp lq b">UIView</code>和<code class="fe ln lo lp lq b">UIViewControllers</code>与SwiftUI。</p><p id="bd69" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这些被称为<code class="fe ln lo lp lq b"><a class="ae lr" href="https://developer.apple.com/documentation/swiftui/uiviewrepresentable" rel="noopener ugc nofollow" target="_blank">UIViewRepresentable</a></code>和<code class="fe ln lo lp lq b"><a class="ae lr" href="https://developer.apple.com/documentation/swiftui/uiviewcontrollerrepresentable" rel="noopener ugc nofollow" target="_blank">UIViewControllerRepresentable</a></code>协议。</p><ul class=""><li id="0e66" class="ls lt iq kt b ku kv kx ky la lu le lv li lw lm lx ly lz ma bi translated"><code class="fe ln lo lp lq b">UIViewRepresentable</code>协议用于集成UIKit视图和SwiftUI。</li><li id="00b8" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated"><code class="fe ln lo lp lq b">UIViewControllerRepresentable</code>协议用于将UIKit <code class="fe ln lo lp lq b">ViewController</code>与SwiftUI集成。</li></ul><p id="14ef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们今天不打算详细谈论这些协议，WWDC19上有一个很好的演讲，请查看<a class="ae lr" href="https://developer.apple.com/videos/play/wwdc2019/231/" rel="noopener ugc nofollow" target="_blank">这个视频</a>了解更多细节。</p><p id="daa6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用<code class="fe ln lo lp lq b">UIViewControllerRepresentable</code>，因为我们需要将<code class="fe ln lo lp lq b">UIImagePickerController</code>(ui kit中的<code class="fe ln lo lp lq b">ViewController</code>)与SwiftUI集成，以便从照片库中访问照片或从相机中捕捉实时照片。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="dae3" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">决赛成绩</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="6b59" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">什么是UIViewControllerRepresentable？</h1><ul class=""><li id="4801" class="ls lt iq kt b ku nh kx ni la nj le nk li nl lm lx ly lz ma bi translated">我们需要在自定义SwiftUI视图中采用一个协议来集成UIKit <code class="fe ln lo lp lq b">ViewController</code> s。</li><li id="2e1b" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated"><code class="fe ln lo lp lq b">UIViewControllerRepresentable</code>有两个必须遵守的方法，<code class="fe ln lo lp lq b">makeUIViewController(…)</code>和<code class="fe ln lo lp lq b">updateUIViewController(…)</code>。</li><li id="923e" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated"><code class="fe ln lo lp lq b">ViewController</code>初始化逻辑将进入<code class="fe ln lo lp lq b">makeUIViewController(…)</code>方法。我们需要在这个方法中初始化<code class="fe ln lo lp lq b">UIImagePickerController</code>，我们一会儿就去做。</li><li id="4493" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated">每当SwiftUI请求在屏幕上呈现视图以响应状态变化时，我们都需要更新<code class="fe ln lo lp lq b">updateUIViewController(…)</code>方法中已初始化的<code class="fe ln lo lp lq b">ViewController</code>的实例。</li><li id="1a49" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated">在这个协议中我们还有一个可选的方法叫做<code class="fe ln lo lp lq b">makeCoordinator()</code>。协调器管理<code class="fe ln lo lp lq b">ViewController</code>和SwiftUI之间的通信，例如<code class="fe ln lo lp lq b">ViewController</code>的目标、动作、代理等。</li><li id="a66b" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated">我们将很快看到上述所有方法的实际应用。请检查下面的代码，我会解释里面的内容。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm ng l"/></div><p class="nn no gj gh gi np nq bd b be z dk translated">SUImagePickerView.swift</p></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="ee40" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">说明</h1><ul class=""><li id="a6df" class="ls lt iq kt b ku nh kx ni la nj le nk li nl lm lx ly lz ma bi translated">第11行:<code class="fe ln lo lp lq b">SUImagePickerView</code>是自定义的视图结构，有三个属性，采用了<code class="fe ln lo lp lq b">UIViewControllerRepresentable</code>协议。</li><li id="5289" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated">第13行到第15行:我已经声明了一个属性来引用<code class="fe ln lo lp lq b">PickerController</code>的<code class="fe ln lo lp lq b">sourceType</code>和两个绑定属性来在用户选择图像或取消时通知初始化<code class="fe ln lo lp lq b">SUImagePickerView</code>的视图。</li></ul><p id="6c3c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:<code class="fe ln lo lp lq b">@Binding</code>属性包装器用于在视图之间共享公共数据。</p><ul class=""><li id="2940" class="ls lt iq kt b ku kv kx ky la lu le lv li lw lm lx ly lz ma bi translated">第17行:<code class="fe ln lo lp lq b">makeCoordinator()</code>。这里我们已经初始化并返回了我们的自定义协调器类。</li><li id="ddc0" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated">第21行:我们用适当的<code class="fe ln lo lp lq b">sourceType</code>初始化<code class="fe ln lo lp lq b">UIImagePickerController</code>，并将代理设置为协调者。这是我们的自定义协调器，它将管理图像拾取器委托，并返回初始化的图像拾取器控制器。</li><li id="c0a6" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated">第28行:由于我们在图像拾取器控制器中没有任何要更新的东西，我们可以让它为空。如果移除此方法，可能会出现错误。</li><li id="adb7" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated">第34行:这是我们的定制协调器，它处理图像拾取器控制器的委托方法，提取用户选择的图像，并在共享图像绑定属性中设置它。</li><li id="a374" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated">第44行到第53行:您可能知道图像拾取器控制器委托方法，当用户拾取图像或单击取消按钮时，我们将在这里得到一个回调。</li><li id="df38" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated">第46行:我们使用从picker控制器返回的<code class="fe ln lo lp lq b">UIImage</code>创建SiwftUI的<code class="fe ln lo lp lq b">Image</code>，并将其分配给一个共享的<code class="fe ln lo lp lq b">@Binding</code>属性。</li><li id="9029" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated">第52行和第48行:重要的是设置<code class="fe ln lo lp lq b">self.isPresented = false</code>来解除呈现的<code class="fe ln lo lp lq b">SUImagePickerView</code>。</li></ul></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="582d" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">密码</h1><p id="cc2f" class="pw-post-body-paragraph kr ks iq kt b ku nh jr kw kx ni ju kz la nr lc ld le ns lg lh li nt lk ll lm ij bi translated">请查看下面的代码片段，了解我们如何从<code class="fe ln lo lp lq b">ContentView</code>初始化并呈现我们的自定义<code class="fe ln lo lp lq b">SUImagePickerView</code> <strong class="kt ir"> <em class="nu"> </em> </strong>的详细信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm ng l"/></div><p class="nn no gj gh gi np nq bd b be z dk translated">ContentView.swift(初始化SUImagePickerView的视图)</p></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="cdf0" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">说明</h1><p id="a483" class="pw-post-body-paragraph kr ks iq kt b ku nh jr kw kx ni ju kz la nr lc ld le ns lg lh li nt lk ll lm ij bi translated">在<code class="fe ln lo lp lq b">ContentView.swift</code>中，我已经添加了逻辑，当用户点击图像以询问相机或照片库选项时，呈现出<code class="fe ln lo lp lq b">ActionSheet</code>。</p><p id="f69b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦用户点击任何选项，我将向<code class="fe ln lo lp lq b">SUImagePickerView</code>展示相应的<code class="fe ln lo lp lq b">sourceType</code>。</p><p id="ea10" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以下载并在您的项目中使用<code class="fe ln lo lp lq b">SUImagePickerView.swift</code>。完整代码请看<a class="ae lr" href="https://github.com/karthironald/SUImagePickerView" rel="noopener ugc nofollow" target="_blank">我的GitHub repo </a>。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="0491" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">结论</h1><p id="a8fa" class="pw-post-body-paragraph kr ks iq kt b ku nh jr kw kx ni ju kz la nr lc ld le ns lg lh li nt lk ll lm ij bi translated">你几乎可以将任何<code class="fe ln lo lp lq b">UIViewController</code>与SwiftUI集成。</p><p id="06e5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您在不了解绑定、状态和视图修饰符等属性包装器的情况下阅读本文，<code class="fe ln lo lp lq b">ContentView.swift</code>和<code class="fe ln lo lp lq b">SUImagePickerView.swift</code>中的代码会有点混乱。</p><p id="374d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">阅读关于这些主题的一些基本细节可能有助于理解这个流程。</p><p id="3e09" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">谢谢！</p></div></div>    
</body>
</html>