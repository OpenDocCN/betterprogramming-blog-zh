<html>
<head>
<title>Implement Touch Events in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在SwiftUI中实现触摸事件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/implement-touch-events-in-swiftui-b3a2b0700fd4?source=collection_archive---------3-----------------------#2020-07-10">https://betterprogramming.pub/implement-touch-events-in-swiftui-b3a2b0700fd4?source=collection_archive---------3-----------------------#2020-07-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5df5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">当你能有一个的时候为什么要有两个按钮？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5f563c3e055ab735e2a7c4927397b7a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*CGKXsL_dusCc4uku9JeRCA.gif"/></div></div></figure><p id="9151" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">TLDR:这是代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lq lr l"/></div></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><p id="8970" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">SwiftUI是一个非常新的、快速发展的框架——这很好，但这也意味着它缺少很多好的功能，包括触摸事件。</p><p id="8062" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那么什么是<em class="lz">触摸事件呢？如果你来自UIKit，你可能对它们很熟悉。真的，它们只是“检测到压力”的一种奇特说法</em></p><p id="aafb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，由于iPhones和iPads是先进的多点触摸设备，有时会“检测到按压！”还不够。你可能想检测用户什么时候第一次触地，或者什么时候释放……或者什么时候拖动和释放。</p><p id="0d29" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">回到UIKit故事板，这些触摸事件很容易处理。s附带了一个庞大的触摸事件列表，包括<code class="fe ma mb mc md b">Touch Up Inside</code>、<code class="fe ma mb mc md b">Touch Down</code>、<code class="fe ma mb mc md b">Touch Up Outside</code> …还有更多，所有这些事件加在一起可以接收到<em class="lz">你手指可以执行的每一个动作</em>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi me"><img src="../Images/8d4805c6cb65d446ebd26742372079e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:434/format:webp/1*fAD8EazGMOUPcv_aQkvCUw.png"/></div></figure><p id="fa97" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是SwiftUI呢？呃…没那么多。默认情况下，你只能得到一个触摸事件:<code class="fe ma mb mc md b">Touch Up Inside</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="f9ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这意味着按钮动作只有在<em class="lz">这两个</em>条件都满足时才会被调用:</p><ul class=""><li id="c0ba" class="mf mg it kw b kx ky la lb ld mh lh mi ll mj lp mk ml mm mn bi translated">用户<em class="lz">举起</em>他们的手指</li><li id="0186" class="mf mg it kw b kx mo la mp ld mq lh mr ll ms lp mk ml mm mn bi translated">用户的手指被<em class="lz">内的</em> <strong class="kw iu"> <em class="lz"> </em> </strong>按钮的界限解除时</li></ul><p id="d766" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在今天的应用程序中，<code class="fe ma mb mc md b">Touch Up Inside</code>是最常用的触摸事件，因为它给用户时间来取消。如果他们决定不想按下按钮，他们需要做的就是把手指移开——这是一个简单的方法。</p><p id="d620" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以SwiftUI的按钮只支持开箱即用的<code class="fe ma mb mc md b">Touch Up Inside</code>是有道理的…但是如果你想访问所有其他的触摸事件呢？</p><p id="49b8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">假设你正在做一个有油门踏板的赛车游戏。按下时，汽车应该会跑得更快。放开的时候应该会慢下来。这需要三个触摸事件— <code class="fe ma mb mc md b">Touch Down</code>、<code class="fe ma mb mc md b">Touch Up Inside</code>和<code class="fe ma mb mc md b">Touch Up Outside</code>。(没有<code class="fe ma mb mc md b">Touch Up</code>触摸事件，但是<code class="fe ma mb mc md b">Touch Up Inside</code>和<code class="fe ma mb mc md b">Touch Up Outside</code>组合起来效果一样。)</p><p id="ca1c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是如果SwiftUI的按钮只支持<code class="fe ma mb mc md b">Touch Up Inside</code>、<em class="lz">你要怎么</em>做出这些赛车游戏？当然，你可以牺牲很多UX，用一个切换按钮——按下加速，按下减速，然后再按下加速:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/1339cdce274d952dde9c1fc6d70f704d.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/1*og78NXr3hHpKEdRIJxjOJQ.gif"/></div><p class="mu mv gj gh gi mw mx bd b be z dk translated"><strong class="bd my">备选项#1: </strong>切换式按钮</p></figure><p id="4cf5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">或者，您还可以牺牲用户界面，采用多按钮方式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/2aa385cbb2b8124412a9e673b033a982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BKWd3sShNf4Cqf3sJzgnUw.png"/></div></div><p class="mu mv gj gh gi mw mx bd b be z dk translated"><strong class="bd my">备选项#2: </strong>多个按钮</p></figure><p id="be14" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">按钮越多越好！对吗？等等…看起来好可怕！</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="1235" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">SwiftUI只是对游戏不好吗？</h1><p id="a053" class="pw-post-body-paragraph ku kv it kw b kx ns ju kz la nt jx lc ld nu lf lg lh nv lj lk ll nw ln lo lp im bi translated">可能SwiftUI不适合游戏。也许它只是不喜欢复杂的触摸事件。也许是时候回UIKit了。</p><p id="7858" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不，<strong class="kw iu"> </strong> SwiftUI对于游戏来说还不错。它对复杂的触摸事件没有问题。当然也不是回到UIKit的时候。苹果知道SwiftUI需要时间来赶上UIKit的功能水平，所以他们用<em class="lz">视图修改器来简化定制。</em>在本文中，我们将使用视图修改器来复制由内置手势驱动的触摸事件。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="5895" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">我们的演示游戏</h1><p id="0349" class="pw-post-body-paragraph ku kv it kw b kx ns ju kz la nt jx lc ld nu lf lg lh nv lj lk ll nw ln lo lp im bi translated">制作一个赛车游戏会花费太多时间，但是我们可以把它减到最少——我们所需要的是:</p><ul class=""><li id="e8be" class="mf mg it kw b kx ky la lb ld mh lh mi ll mj lp mk ml mm mn bi translated">跟踪油门踏板状态的属性</li><li id="d1a0" class="mf mg it kw b kx mo la mp ld mq lh mr ll ms lp mk ml mm mn bi translated">一个按钮</li><li id="cfee" class="mf mg it kw b kx mo la mp ld mq lh mr ll ms lp mk ml mm mn bi translated">显示油门踏板状态的标签</li></ul><p id="750b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这并不过分，所以让我们首先坚持使用默认的<code class="fe ma mb mc md b">Touch Up Inside</code>并制作一个切换按下/释放状态的按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/1339cdce274d952dde9c1fc6d70f704d.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/1*og78NXr3hHpKEdRIJxjOJQ.gif"/></div><p class="mu mv gj gh gi mw mx bd b be z dk translated"><strong class="bd my">备选项#1: </strong>切换式按钮</p></figure><p id="14eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="3ee5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这种情况下，逻辑工作正常——按下按钮切换按下/释放状态——但这不是一个很好的用户体验。这个按钮不只有一个用途，它有两种用途。这意味着有人可能会不小心刹车而不是加速，让他们输掉比赛——也让你损失一个差评。</p><p id="3810" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是为什么触摸事件在这里会工作得很好:按下以加速，释放以减速。触地，触地。让我们在SwiftUI中重现那些触摸事件吧！我们可以使用视图修改器和手势来实现这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="1ed4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，声明一个<code class="fe ma mb mc md b">@State</code>属性来跟踪拖动手势的变化。这将存储触摸事件的状态(真=按下，假=释放)。然后，我们将使用一个<code class="fe ma mb mc md b">DragGesture</code>来检测手指。</p><p id="bada" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后我们给手势附加一个<code class="fe ma mb mc md b">.onChanged()</code>修饰符，每当手指触地或移动手指时，系统都会调用这个修饰符。在这里，我们将<code class="fe ma mb mc md b">dragged</code>设置为<code class="fe ma mb mc md b">true</code>。一旦手指被释放，<code class="fe ma mb mc md b">onEnded()</code>将被调用，我们将<code class="fe ma mb mc md b">dragged</code>设置回<code class="fe ma mb mc md b">false</code>。</p><p id="61df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，将原来的切换按钮替换为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="c680" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用普通的<code class="fe ma mb mc md b">Text</code>标签，而不是使用<code class="fe ma mb mc md b">Button</code>(视图修改器在所有SwiftUI视图上都有效)！结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/401112897e78bcaed2198e54b5e6332f.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/1*x3AzXMg7506qR0xQ1ksJig.gif"/></div></div></figure><p id="f106" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">GIF里看不出来，但是标签改成了“油门踩下！”当我按下按钮，和“油门踏板没有按下！”当我释放时。但这是个问题。不像默认的<code class="fe ma mb mc md b">Button</code>，我们没有得到一个免费的指示按钮被按下。</p><p id="784b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个很容易解决！我们可以添加另一个视图修改器来改变它的比例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="e523" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/d4130fcebd4e027318ede55ad5f81368.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/1*ItUcpjB-g-G31T41ck_tTw.gif"/></div></div></figure><p id="5c65" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">圆滑！</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="2867" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">结论</h1><p id="9246" class="pw-post-body-paragraph ku kv it kw b kx ns ju kz la nt jx lc ld nu lf lg lh nv lj lk ll nw ln lo lp im bi translated">按钮太多，或者有多种用途的按钮都不是好主意。相反，为了一致性和易用性，请使用触摸事件。SwiftUI中没有内置触摸事件，但是您可以使用视图修改器和手势来复制它们。您还可以将自定义视图修改器包装到一个扩展中，使其更易于使用。</p><p id="82b1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读！</p></div></div>    
</body>
</html>