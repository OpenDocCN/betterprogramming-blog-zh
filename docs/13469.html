<html>
<head>
<title>Modularization of Terraform.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地形的模块化。</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/lets-create-modularization-of-terraform-37fb44f78624?source=collection_archive---------21-----------------------#2022-08-29">https://betterprogramming.pub/lets-create-modularization-of-terraform-37fb44f78624?source=collection_archive---------21-----------------------#2022-08-29</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="1db3" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">让我们创造吧！</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/3ba82bdf677a23a566b59d1ee2af1602.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nZKjkWRfn-T1Czlk0pEbmQ.png"/></div></div></figure><p id="ead0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">对于本周的项目，我们将采用现有的Terraform文档，并将其转换为可重复使用的模块！</p><p id="6828" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><strong class="kx iv">。问题中的tf </strong>文件，是一个简单的EC2生成器。有AWS作为提供者，ec2_instance作为资源，瞧！但是我们想把它变成一个模块，这样我们就可以通过简单地引用模块，在未来的任何项目中快速使用它。</p><h2 id="0143" class="lr ls iu bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">我们需要什么:</h2><ul class=""><li id="e325" class="mk ml iu kx b ky mm lb mn le mo li mp lm mq lq mr ms mt mu bi translated">Git/GitHub帐户</li><li id="6a1c" class="mk ml iu kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated">AWS管理员用户帐户</li><li id="83a0" class="mk ml iu kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated">终端/IDE</li><li id="ebc1" class="mk ml iu kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated">安装了Terraform的工作站。</li></ul><h1 id="f56c" class="na ls iu bd lt nb nc nd lw ne nf ng lz ka nh kb mc kd ni ke mf kg nj kh mi nk bi translated">我们开始吧！</h1><p id="5acc" class="pw-post-body-paragraph kv kw iu kx b ky mm jv la lb mn jy ld le nl lg lh li nm lk ll lm nn lo lp lq in bi translated">首先，我们的任务是将我们的<strong class="kx iv"> ec2.tf </strong>文件分支到我们自己的GitHub账户…</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj no"><img src="../Images/a913c0964aff185c1d490fa5ff234415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eEdbTY51bPBgwCKe5Rj5kw.png"/></div></div></figure><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj np"><img src="../Images/3019f3f08e8a05094344e303e7f8ae3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8YGgeLkjFBKxhxkK42jA6g.png"/></div></div></figure><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nq"><img src="../Images/9d29dd7f18568bced9968a8bf76d86da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ugKb6lBD33W19qHSEwf9Hw.png"/></div></div></figure><p id="01bb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">然后，将其克隆到我们的环境中(对您来说可能是本地的，我使用的是AWS Cloud9环境。)</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nr"><img src="../Images/5ab505ff06a24b21b5b12ac7303e6fc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rfGjDhNLCYO2kWBbLv10Iw.png"/></div></div></figure><p id="18e2" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">安装完成！</p><h1 id="4d25" class="na ls iu bd lt nb nc nd lw ne nf ng lz ka nh kb mc kd ni ke mf kg nj kh mi nk bi translated">让我们开始吧！</h1><p id="dd78" class="pw-post-body-paragraph kv kw iu kx b ky mm jv la lb mn jy ld le nl lg lh li nm lk ll lm nn lo lp lq in bi translated">这就是它变得漂亮的地方！</p><p id="c530" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我在刚刚克隆的这个repo中创建了一个新文件夹:ec2_create。这将是我们模块的名称。在这个文件夹中，我们将创建一个新的main.tf和variables.tf。为了创建这个模块，我从原来的ec2.tf中复制了资源块，并将其粘贴到我们模块的main.tf中。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ns nt l"/></div></figure><p id="e580" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">…以及我们的变量:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ns nt l"/></div></figure><p id="ab91" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">最后，我们将原始ec2.tf文件中的“资源”块转换成一个模块:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ns nt l"/></div></figure><p id="b101" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这里最重要的是模块的“源”元素。这告诉Terraform在哪里可以找到你的模块。这可以在您的本地目录中(如我的例子所示，带有。/)，或者可以从公共或私有注册表中提取。</p><p id="3cf4" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这是一个非常简单的例子，但是有希望展示模块化是多么有用！接下来…</p><h1 id="c273" class="na ls iu bd lt nb nc nd lw ne nf ng lz ka nh kb mc kd ni ke mf kg nj kh mi nk bi translated">让我们确保它有效！</h1><p id="ad0b" class="pw-post-body-paragraph kv kw iu kx b ky mm jv la lb mn jy ld le nl lg lh li nm lk ll lm nn lo lp lq in bi translated">和所有事情一样，我们应该经常检查我们的工作，确保一切都按计划进行！那是！先不说俗气，我们将首先运行我们的<code class="fe nu nv nw nx b">terraform init</code>,以便TF知道我们的模块，并相应地构建基础设施。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ny"><img src="../Images/5b1c1790c4fc18db425e14c3c0cca42a.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*qKcWznMjNkx50UIq3Oohdg.png"/></div><p class="nz oa gk gi gj ob oc bd b be z dk translated"><strong class="bd od">瞧！</strong></p></figure><p id="85a1" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">继续，如果你感觉很辣，你可以跳过“计划”阶段，直接去<code class="fe nu nv nw nx b">terraform apply</code>:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oe"><img src="../Images/3b472bc984ccae4a5eaa0ee071c24204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W6Y6ZZ2wL7KzC2O5RY6Ndw.png"/></div></div></figure><p id="640e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">看来成功了！但只是为了开心，让我们看看我们的AWS控制台:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj of"><img src="../Images/d02ac68ae850a5f7ee1872e6c1d194c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-8OqgmgYbNYbI_K1v3qtVg.png"/></div></div></figure><p id="a455" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在你知道了！创建EC2实例的简单模块，现在可以在任何未来的项目中轻松重用！</p><h1 id="6900" class="na ls iu bd lt nb nc nd lw ne nf ng lz ka nh kb mc kd ni ke mf kg nj kh mi nk bi translated">结论</h1><p id="d3d8" class="pw-post-body-paragraph kv kw iu kx b ky mm jv la lb mn jy ld le nl lg lh li nm lk ll lm nn lo lp lq in bi translated">这个项目很简单，但我发现它非常有帮助，不仅展示了如何构建我自己的模块，还展示了如何将一些现有的TF配置转换成模块。</p><p id="3680" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">谢谢你留下来！下次见！</p></div></div>    
</body>
</html>