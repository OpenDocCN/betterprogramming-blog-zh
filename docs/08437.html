<html>
<head>
<title>How To Use Jenkins for Automated Builds of Docker Images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Jenkins自动构建Docker映像</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-jenkins-for-automated-builds-of-docker-images-3d8693b04be8?source=collection_archive---------8-----------------------#2021-04-29">https://betterprogramming.pub/how-to-use-jenkins-for-automated-builds-of-docker-images-3d8693b04be8?source=collection_archive---------8-----------------------#2021-04-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9e7a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建Jenkins作业以在Docker Hub上构建和发布图像的指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/35ed6e1e636610a0e154ab27175fb213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gn7FAn4fGPzZyrVT1ui7Cg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://unsplash.com/@markusspiske" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae kv" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="fd0f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">构建工作是<a class="ae kv" href="https://www.jenkins.io/" rel="noopener ugc nofollow" target="_blank"> Jenkins </a>构建流程的核心。您可以将Jenkins作业视为构建过程中的特定任务或步骤。构建可能涉及编译源代码、运行测试、打包和发布。</p><p id="fa44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将创建一个Jenkins作业:</p><ul class=""><li id="5dce" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">推断给定项目的远程分支</li><li id="9dfd" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">编译代码</li><li id="9f0a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">使用Docker打包代码</li><li id="aedc" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">将图像发布到Docker Hub</li></ul><p id="3780" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程结束时，您应该会看到如下内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/09a133f9bb96e49293d1b49d80da534b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cDMwcw8j63mxIYYDbFO47Q.png"/></div></div></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="7d81" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">在詹金斯创造一份工作</h1><p id="bdab" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">在Jenkins主页上，通过单击“新建项目”创建一个新项目:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/255e1135245d4bee65ee241132111fc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*kd2BToxYm43R7YVh9mHS7A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建新项目</p></figure><p id="e531" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为您的项目命名，并选择“自由式项目”选项作为新项目的类型。</p><blockquote class="nm nn no"><p id="0f0f" class="kw kx np ky b kz la jr lb lc ld ju le nq lg lh li nr lk ll lm ns lo lp lq lr ij bi translated">“Jenkins的‘自由式’作业支持简单的持续集成，允许您在应用程序生命周期中定义顺序任务。”—詹金斯<a class="ae kv" href="https://www.jenkins.io/pipeline/getting-started-pipelines/" rel="noopener ugc nofollow" target="_blank">文档</a></p></blockquote><p id="5477" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您应该进入新创建项目的配置页面。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="6b27" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">参数化您的项目</h1><p id="b757" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">选择“此项目已参数化”,以便配置要用于构建应用程序的输入参数:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/f70bff1572b3053a6acd7a95cbebdd80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A-ttHEg8rIM4Fl4GoMSIqw.png"/></div></div></figure><p id="b578" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们要添加的第一个参数是应用程序名称。单击添加参数并选择活动选择参数。让我们将这个参数命名为“app”，它将代表我们想要构建的应用程序。</p><p id="38a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，我们将对应用程序进行硬编码，因此我们将使用您能想象到的最简单的Groovy脚本:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="91b7" class="nz mp iq nv b gy oa ob l oc od">return ['first_application', 'second_application'] </span></pre><p id="55d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦您应用了更改，您应该能够看到<a class="ae kv" href="https://github.com/proteantecs/devops/pull/487/files" rel="noopener ugc nofollow" target="_blank">应用程序</a>下拉列表已被上述应用程序填充。</p><p id="4722" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们希望根据所选的应用程序动态检索Git分支。为此，我们将添加一个额外的参数“branch”，它将包含所选应用程序的所有分支。</p><p id="f25d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击添加参数，并选择<a class="ae kv" href="https://plugins.jenkins.io/uno-choice/" rel="noopener ugc nofollow" target="_blank">有功选择无功参数</a>:</p><blockquote class="nm nn no"><p id="a1ae" class="kw kx np ky b kz la jr lb lc ld ju le nq lg lh li nr lk ll lm ns lo lp lq lr ij bi translated">“活动选择插件用于参数化的自由式Jenkins作业，以创建脚本化、动态和交互式作业参数。主动选择参数可以动态更新，并可以呈现为组合框、复选框、单选按钮或丰富的HTML UI小部件。”— Jenkins <a class="ae kv" href="https://plugins.jenkins.io/uno-choice/" rel="noopener ugc nofollow" target="_blank">主动选择文档</a></p></blockquote><p id="32bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用这种类型的参数，因为我们希望在前面的“app”选项中根据所选的应用程序名称显示分支。为此，我们应该告诉Jenkins我们想要引用“app”变量。将“app”添加到“引用参数”选项中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/79530d4f256de9b8b12d18cda28fe988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UJZ7p15VxmoNIWA1TuU_ug.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">引用的参数“app”</p></figure><p id="7d5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们写一些Groovy！选择“Groovy脚本”选项，并将以下代码粘贴到文本框中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="7dc1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">解释:</p><ul class=""><li id="2927" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><code class="fe oh oi oj nv b">list_branches</code>是我们用来列出给定存储库的远程分支的命令。</li><li id="ed44" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe oh oi oj nv b">awk</code>和<code class="fe oh oi oj nv b">cut</code>命令用于从上面的Git命令中提取特定的分支名称。</li><li id="b793" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">在第7–10行中，我们通过管道传输命令来获得结果，split来创建数组，最后是结果。</li></ul><p id="fc06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们应该支持的最后一个参数是标签，它将允许我们知道在我们的图像上应该有哪个标签。为此，添加一个字符串参数类型的新参数—一个简单的自由文本输入选项。将其命名为“标签”</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="f151" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">创建构建脚本</h1><p id="d0f1" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">现在我们有了编译和构建所选项目所需的所有信息。</p><p id="d808" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在构建步骤中选择“执行shell ”:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/cf932c62642566a0818c0d69ecd66615.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-PS4wscwCVEIpHxN_8FBCA.png"/></div></div></figure><p id="e3c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">传递以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="957b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">解释:</p><ul class=""><li id="922c" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">首先克隆选定的应用程序。</li><li id="8863" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">运行build命令来编译源代码。</li><li id="d322" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">使用提供的docker文件打包代码(在存储库中)</li><li id="64e9" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">将图像发布到中心。</li></ul><p id="cd30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>如果两个项目以相同的方式构建，可以省略条件，将它们合并。</p><p id="7665" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据您的构建工具和源代码，这个过程可能与上面的不同。然而，这里重要的是理解过程本身，而不是要运行的特定命令。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="eb7c" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">结论</h1><p id="ac3f" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">使用Jenkins，我们创建了一个简单的作业，任何想要从他们的分支构建特定应用程序的人都可以使用它。上面的过程可以更一般化，并且可以集成到更大的管道中，以提供完整的CI/CD。</p></div></div>    
</body>
</html>