<html>
<head>
<title>How to Use Kotlin Sealed Classes for State Management</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Kotlin密封类进行状态管理</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-kotlin-sealed-classes-for-state-management-c1cfb81abc6a?source=collection_archive---------3-----------------------#2020-02-03">https://betterprogramming.pub/how-to-use-kotlin-sealed-classes-for-state-management-c1cfb81abc6a?source=collection_archive---------3-----------------------#2020-02-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4b1f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用密封类简化复杂的数据流</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3515c50036af70a32766b2958baec15b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i9vMw3UCmC1Qn1t0"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@cowomen?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">女同胞</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><h1 id="550a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="018e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">当产品增长时，状态管理是任何平台的关键方面之一。</p><p id="5809" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我在Google Play商店的一个应用程序有一个带有多个支付网关的支付屏幕。用户可以通过任何网关进行支付。</p><p id="77ac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">付款后，会弹出一个确认窗口，说明购买状态。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="40af" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">问题</h1><p id="cb13" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一开始，我们只有Google Play计费(针对应用内购买)。在那个时候，很容易维护像<code class="fe ne nf ng nh b">success</code>、<code class="fe ne nf ng nh b">failure</code>、<code class="fe ne nf ng nh b">retry</code>、<code class="fe ne nf ng nh b">acknowledgment</code>这样的状态。最近，我们决定增加PayU和Stripe作为额外的支付网关，这就是状态管理问题的开始。</p><p id="4486" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们可以肯定的一点是，我们将在未来添加更多的支付网关，因此为每个网关维护不同的流程将耗尽代码管理系统。因此，我们决定创建一个适用于所有网关的独特流程。</p><p id="656b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这时我们发现了帕特里克·考辛斯(Patrick Cousins)在2018年科特林大会上的一次精彩演讲(资源添加在文章末尾)，内容是关于密封类以及他如何在自己的应用程序登录期间使用它们来维护状态。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="d8e8" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">解决办法</h1><p id="2a10" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">所以我们确信我们需要处理密封类的状态管理。在讨论我们如何实现它之前，您应该了解一下密封类。</p><h2 id="346b" class="ni la it bd lb nj nk dn lf nl nm dp lj ma nn no ll me np nq ln mi nr ns lp nt bi translated">科特林的定义</h2><blockquote class="nu nv nw"><p id="7e47" class="lr ls nx lt b lu mn ju lw lx mo jx lz ny mp mc md nz mq mg mh oa mr mk ml mm im bi translated">当值可以具有有限集合中的一种类型，但不能具有任何其他类型时，密封类用于表示受限的类层次结构。在某种意义上，它们是枚举类的扩展:枚举类型的值集也是受限制的，但每个枚举常量只作为单个实例存在，而密封类的子类可以有多个包含状态的实例。</p></blockquote><p id="2e56" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如Cousins所说，这个定义本身在理解密封类在处理复杂流时如何有用方面非常清楚。</p><p id="dd75" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，让我们看一个如何使用密封类的简单例子。下面是发起网络请求时维护状态的密封类。这里有两种状态:<code class="fe ne nf ng nh b">Loading</code>和<code class="fe ne nf ng nh b">Error</code>。</p><p id="9f14" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ne nf ng nh b">Loading</code>:如果出现真正的加载，这个状态返回一个布尔值——否则，它是隐藏的。<br/> <code class="fe ne nf ng nh b">Error</code>:该状态以字符串形式返回错误信息。当一个错误被触发时，加载被隐藏，一个带有错误信息的弹出窗口将出现。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="ea83" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，在另一边，我们必须使用Kotlin中的<code class="fe ne nf ng nh b">when</code>语句来处理不同的状态，如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="8628" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">既然我们已经在如何使用密封类的问题上达成一致，那么让我们看看我们是如何使用它们来解决购买状态流的。</p><p id="9e1a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这里我们要在两个地方进行API调用:</p><ol class=""><li id="4a23" class="od oe it lt b lu mn lx mo ma of me og mi oh mm oi oj ok ol bi translated">去购物。</li><li id="68dc" class="od oe it lt b lu om lx on ma oo me op mi oq mm oi oj ok ol bi translated">确认购买成功。</li></ol><p id="a030" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们创建了一个密封类来处理请求的所有状态。以下是购买的密封类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="a8d6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然后，如果购买成功，我们将确认购买，并在弹出窗口中向用户显示结果。对于确认流状态，我们创建了以下类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="0823" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这两个密封的类可以处理所有支付网关的购买和确认流。但是我们过去把所有的类放在一个类中，就像一个树形结构。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="f44a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这里，我们使用了嵌套的密封类概念，并在每个支付网关中使用了嵌套的确认，所以另一方面，很容易评估确认是从哪个网关完成的。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="1fcc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这在我们的情况下似乎更好，因为我们有需要触发的网关特定功能。</p><p id="f3bc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">但是我们也可以在单个文件中以不同的方式维护密封的类，而不需要任何树结构，如上所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="f968" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然后，您可以访问这些状态，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="72a1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当您没有特定于网关的事情要做时，这是使它工作的一个简单方法。务实一点，选择适合自己的。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="609c" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">有用的链接</h1><div class="or os gp gr ot ou"><a href="https://medium.com/@sgkantamani/sealed-classes-in-kotlin-e48e072daca8" rel="noopener follow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">科特林的密封课堂</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">了解如何在Android中使用密封类</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">medium.com</p></div></div></div></a></div><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pd oc l"/></div></figure></div></div>    
</body>
</html>