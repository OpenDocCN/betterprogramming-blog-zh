<html>
<head>
<title>Detecting if a User Is Online or Offline With JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript检测用户是在线还是离线</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/detecting-if-a-user-is-online-or-offline-with-javascript-2fcf5eb90c12?source=collection_archive---------5-----------------------#2020-09-23">https://betterprogramming.pub/detecting-if-a-user-is-online-or-offline-with-javascript-2fcf5eb90c12?source=collection_archive---------5-----------------------#2020-09-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ad16" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">显示您的用户是否有可靠的互联网连接</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3fc41e99dd77929462f2659c38ae75c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oEg8k6TD8TPIBAZT"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@andrewtneel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">安德鲁·尼尔</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="3029" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为开发人员，我们有时会习惯办公室的宽带，而localhost是有史以来最快的网站，没有网络问题。</p><p id="86e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很多人忘记的是，超过一半的互联网流量是通过手机传输的，除非你在一个繁荣的城市，否则持续的互联网连接是不正常的。</p><p id="d26a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个系列的第一部分，在这个系列中，我将介绍一些提示和技巧，以便轻松地为网络连接不好的人创造更好的体验。如果您正在构建面向消费者的应用程序，这可能是您的用户的一大部分。</p><p id="3d40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将看到一种超级简单的方法来检查用户是否连接到互联网，并检测他们是否失去连接或重新连接，以便您可以根据互联网状态适当地更新您的UI。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/d983eaceb8072e0dd8abf802bf5914b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8_IO9vUi8lWg9mTl.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="1b1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到本文结束时，您将拥有根据用户是否有互联网而变化的卡。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="1268" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">一点样板文件</h1><p id="702e" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><code class="fe na nb nc nd b">index.html</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="57f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">style.css</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="43e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加一个空的<code class="fe na nb nc nd b">app.js</code>文件。那是我们将做所有工作的地方。</p><p id="e6b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，您的文件夹应该如下所示:</p><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="40c3" class="nk me it nd b gy nl nm l nn no">├── app<br/>│   ├── index.html<br/>│   └── style.css<br/>│   └── app.js</span></pre><p id="0153" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先创建一个函数，根据用户是否有连接来操作DOM。我们将传递给它一个<code class="fe na nb nc nd b">boolean</code>值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="9fa0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来是有趣的部分。</p><p id="b530" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将首先使用<code class="fe na nb nc nd b">navigator.online</code>来检查页面初始加载时用户是否有互联网。<code class="fe na nb nc nd b">navigator.online</code>从IE9开始就受到支持，并返回一个<code class="fe na nb nc nd b">boolean</code>值。</p><p id="62ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重要的是要记住浏览器实现这个特性的方式是不同的。有关更多详细信息，请查看<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/onLine#Example" rel="noopener ugc nofollow" target="_blank">MDN文档</a>。</p><blockquote class="np nq nr"><p id="00e5" class="kz la ns lb b lc ld ju le lf lg jx lh nt lj lk ll nu ln lo lp nv lr ls lt lu im bi translated">“在Chrome和Safari中，如果浏览器无法连接到局域网(LAN)或路由器，它就是离线的；所有其他条件返回true。因此，虽然当浏览器返回一个假值时，你可以假设它处于离线状态，但你不能假设一个真值就一定意味着浏览器可以访问互联网。”— <a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/onLine#Example" rel="noopener ugc nofollow" target="_blank"> MDN网络文档</a></p></blockquote><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="d70a" class="nk me it nd b gy nl nm l nn no">// Listen for the page to be finished loading<br/>window.addEventListener("load", () =&gt; {<br/>  hasNetwork(navigator.onLine);<br/>});</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="490e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">注意</h1><p id="ed02" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">起初，这似乎是毫无意义的一步，但是根据web开发工具和最佳实践的当前状态，您会发现用户通常会将网页缓存起来，并且仍然能够脱机访问您的站点。因此，如果他们启动你的应用程序，并意识到他们的内容可能已经过时，这种初步检查可能会很好。</p><p id="07b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来我们要做的是为在线和离线事件添加事件侦听器，以便我们可以检查用户的网络状态何时发生变化。</p><p id="83ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们关心的事件有两个:<code class="fe na nb nc nd b">online</code>和<code class="fe na nb nc nd b">offline</code>。我相信你能猜到，当用户在离线和在线之间切换时，这些都会被触发。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e7cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当我们进入我们的应用程序时，当用户改变他们的网络状态时，我们将获得实时反馈。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/d71e4253d7c673d00ce3d636f661cd5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*BjDU8Kg0EWiAT5Vq.gif"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f0c2" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">什么时候用这个</h1><p id="a775" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">也许你需要告诉用户他们不能上传文件，因为他们离线了，他们看到的实时数据可能不再是最新的，因为他们离线了，或者其他任何事情。您可能需要检测网络状态的原因有很多，作为web开发人员，我们应该努力让web成为每个人更友好的体验。</p><p id="d51b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇技巧有所帮助，直到下一篇，祝编码愉快！</p><p id="3d25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里看我的视频解释:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx nf l"/></div></figure></div></div>    
</body>
</html>