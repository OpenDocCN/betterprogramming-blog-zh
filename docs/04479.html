<html>
<head>
<title>How to Design a RESTful API With Node.js and Express in 5 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Node.js和Express在5分钟内设计一个RESTful API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-design-a-restful-api-with-node-js-and-express-in-5-minutes-f0346b1a319d?source=collection_archive---------13-----------------------#2020-04-15">https://betterprogramming.pub/how-to-design-a-restful-api-with-node-js-and-express-in-5-minutes-f0346b1a319d?source=collection_archive---------13-----------------------#2020-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3cc6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">旋转一个简单的CRUD应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1bbcbba3778ee2b5f5e4f262576462e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Axe_gU0Fnk9HZlb9"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@srosinger3997?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">萨曼莎·加德斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="e06a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将设计一个基于REST API的应用程序来创建一个电影数据库。所有的操作，比如创建、更新、读取和删除(CURD ),都将使用REST调用来完成。</p><p id="7d41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">先决条件:我假设您对Node.js、MongoDB和Express(node . js平台)有相当好的了解。</p><p id="0dc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不了解HTTP协议，比如GET、POST等等，我强烈推荐你阅读这篇文章来更好地理解它们。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ab04" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置</h1><h2 id="34bf" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">确认节点安装</h2><p id="426a" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在继续操作之前，请使用以下命令确认您的系统中已经安装了节点和npm程序包:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="04cb" class="mu md it nm b gy nq nr l ns nt">$ node -v                                                          <br/>$ npm -v</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="e00b" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">初始化新应用程序</h2><p id="577f" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">太好了。现在让我们创建一个空目录，并在其中初始化一个新的应用程序:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="39d9" class="mu md it nm b gy nq nr l ns nt">$ mkdir CURD_using_node<br/>$ cd CURD_using_node<br/>$ npm init</span></pre><p id="fdc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成设置后，一个名为<code class="fe nu nv nw nm b">package.json</code>的文件将在您当前的文件夹中生成。默认的主文件名将是<code class="fe nu nv nw nm b">index.js</code>，但是我们已经将它更新为<code class="fe nu nv nw nm b">app.js</code>。</p><p id="d3ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们需要将Express安装在我们当前的项目文件夹中:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="5ed8" class="mu md it nm b gy nq nr l ns nt">$ npm install express --save</span></pre><h2 id="bc4e" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">创建数据库</h2><p id="b2e4" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我假设您已经在操作系统上安装了MongoDB。如果没有，请安装它。您可以使用以下命令检查是否安装了MongoDB:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="802c" class="mu md it nm b gy nq nr l ns nt">$ mongo</span></pre><p id="cf39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装了Mongo吗？是的。完美。现在让我们在Mongo中创建新的数据库，名为<code class="fe nu nv nw nm b">my_db</code>:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="adea" class="mu md it nm b gy nq nr l ns nt">$ db my_db</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4561" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.创建应用程序</h1><p id="709a" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">让我们首先创建一个名为<code class="fe nu nv nw nm b">app.js</code>(或<code class="fe nu nv nw nm b">index.js</code>)的文件，并创建一个Express服务器。将以下代码复制到<code class="fe nu nv nw nm b">app.js</code>文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="fdd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您使用以下命令运行此代码，并尝试浏览到<a class="ae ky" href="http://localhost:3000," rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>，如果一切正常，您将看到浏览器屏幕上显示“nlogn.in says hello ”:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="1780" class="mu md it nm b gy nq nr l ns nt">$ node app.js</span></pre><p id="52c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果它不起作用，那么您的节点安装可能有一些问题。</p><p id="f217" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设一切正常，用下面的代码更新<code class="fe nu nv nw nm b">app.js</code>文件的内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="38a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你从<code class="fe nu nv nw nm b">app.js</code>文件中看到的，我们包含了一个名为<code class="fe nu nv nw nm b">movies.js</code>的文件。这个文件将包含处理所有REST调用的代码。</p><p id="0f43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建<code class="fe nu nv nw nm b">movies.js</code>并将以下代码复制粘贴到其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="a50c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是否显得势不可挡？让我来给你分析一下:</p><ol class=""><li id="73b5" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated">正在连接MongoDB。</li><li id="69e2" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">第一条语句是在我们的应用程序中导入<a class="ae ky" href="https://mongoosejs.com/docs/" rel="noopener ugc nofollow" target="_blank">mongose模块</a>(用于在Express中连接到MongoDB)。</li><li id="04f8" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">这就建立了到Mongo数据库的连接。mongodb://localhost/my_db是连接URL，<code class="fe nu nv nw nm b">my_db</code>是您将在其中创建集合的数据库的名称。</li><li id="bb72" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">这为集合定义了一个模式。它指出了你将要存储的变量以及它们的数据类型。</li><li id="8d0f" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">最后一行用前面提到的模式在<code class="fe nu nv nw nm b">my_db</code>数据库中创建一个集合，并返回存储在<code class="fe nu nv nw nm b">movies</code>变量中的连接实例。</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e442" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.设计GET方法</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="d6ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个方法处理<a class="ae ky" href="https://nlogn.in/http-request-methods-rest-api-verbs/" rel="noopener ugc nofollow" target="_blank"> GET请求</a>。每当用户访问URL<a class="ae ky" href="http://localhost:3000/movies" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/movies</a>时，都会返回JSON格式的所有电影及其相关信息。</p><p id="adde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nu nv nw nm b">movies.find({},{‘_id’:0, ‘__v’:0})</code>对数据库进行查询，如果没有错误，它将获取所有记录并存储在响应变量中。这里，<code class="fe nu nv nw nm b">‘_id’:0, ‘__v’:0</code>表示我们不希望这些参数出现在响应中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/995f06069ca69c9fb412ba740bd3d2cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C1XY9wOIecYHcXma7FrIPw.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="6683" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这类似于上面的GET方法，除了现在我们在URL中传递参数以允许在结果中过滤。例如，您可以获得该年所有电影的详细信息。该应用程序支持基于电影id、名称、年份和分级的过滤。</p><p id="4bd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设你想过滤掉所有评分为8.3的电影。为此，您将提出以下请求:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="e9b0" class="mu md it nm b gy nq nr l ns nt">CURL -X GET localhost:3000/movies/rating/8.3 <em class="oo">results in all movies published in 1996</em><br/> CURL -X GET localhost:3000/movies/year/1996 <em class="oo">results in all movies published in 1996</em></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/c4e1ba242e40bbee2dcac97230209633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nCB-SA2wxzcHwtJrVhMfcA.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8788" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.设计POST方法</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="d948" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以顾名思义，这个方法支持在数据库中创建新资源。但是它是如何工作的呢？</p><p id="5bbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当用户使用电影名称、年份和评级等参数发出格式良好的POST请求时，我们从<code class="fe nu nv nw nm b">Movies</code>模型创建一个<code class="fe nu nv nw nm b">newMovie</code>文档，并使用<code class="fe nu nv nw nm b">newMovie.save()</code>函数将其保存到我们的DB中。但是如果我们收到任何空字段或者没有收到任何字段，我们将发送一个错误响应。</p><p id="b884" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:用户没有在参数中发送电影id。我们自己在制造它。</p><p id="8b2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于成功的POST请求，用户收到的响应将是JSON格式的，包含电影id、名称、年份和分级以及成功消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/ce694d5e97f46365e98802d8be8db905.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*MB6mBrkzNbvDj7JzH6whng.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9322" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.设计PUT方法</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="483d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PUT请求用于更新数据库中已经存在的文档(记录)。在Express中有许多方法可以更新数据库记录。这里，我们将使用<code class="fe nu nv nw nm b">findOneAndUpdate</code>方法。</p><p id="95b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nu nv nw nm b">findOneAndUpdate</code>方法(条件、更新、回调)接受三个参数:</p><ul class=""><li id="bd30" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu or of og oh bi translated">一个条件。这里，我们将使用电影id来查找需要更新的文档。</li><li id="c7d3" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu or of og oh bi translated">update参数包含一个用于<code class="fe nu nv nw nm b">Movie</code>模型的文档，其中包含需要更新的参数。这里，我们正在更新电影名称、年份和等级，如果在更新的请求中没有提供参数，我们将它标记为null/empty。</li><li id="1a8c" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu or of og oh bi translated">如果更新不成功，回调函数返回一个错误，或者返回一个包含JSON格式的更新结果的响应。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/a7e071e0ccaf68f88a9bf45ac5400c6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*n_QqnO7ujtqwMVvJWiFKow.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f9f6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">5.设计删除方法</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="dda6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，我们已经讨论了创建、读取和更新。现在我们将设计一个从MongoDB中删除记录的方法。要删除一条记录，我们将使用<code class="fe nu nv nw nm b">deleteOne()</code>方法。</p><p id="d68f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nu nv nw nm b">deleteOne</code>函数将接受两个参数(条件、回调)。第一个是删除条件(即删除成功应满足的条件)。可以基于电影id、名称、年份或分级来执行删除。如果许多结果都符合删除条件，那么只有第一条记录会被删除。如果你想改变这种行为，你可以使用<code class="fe nu nv nw nm b">deleteMany</code>(条件，回调)。</p><p id="40de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功删除后，您将收到一个200OK状态和一个包含被删除条目的JSON响应。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/e6b6bd4a5fa51f09e557407fbceddac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pc8g-4EiYNT8AtTlMFcA9A.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5274" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="f246" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">恭喜你，你在Node.js和Express中成功设计了一个基于REST API的应用。</p><p id="a250" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢这篇文章。完整的代码可以在GitHub 上找到<a class="ae ky" href="https://github.com/dermayank/CURD-app-with-node-js" rel="noopener ugc nofollow" target="_blank">。如果您发现任何不正确的地方或想补充一些东西，请评论。</a></p><p id="c3cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>