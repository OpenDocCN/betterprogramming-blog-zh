<html>
<head>
<title>Build a Federation of Multiple Kubernetes Clusters With Kubefed V2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Kubefed建立多个Kubernetes集群的联盟</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-federation-of-multiple-kubernetes-clusters-with-kubefed-v2-8d2f7d9e198a?source=collection_archive---------0-----------------------#2020-07-11">https://betterprogramming.pub/build-a-federation-of-multiple-kubernetes-clusters-with-kubefed-v2-8d2f7d9e198a?source=collection_archive---------0-----------------------#2020-07-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6a9c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建Kubernetes联盟的分步指南，使用KubeFed管理多个地区的集群</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d9bf50768ef8f8b05190297ddd8b8ee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eDJS2AH9HN0wYxAu1FbUdw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供</p></figure></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="6f8d" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">库伯菲德是什么？</h1><p id="7020" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">KubeFed (Kubernetes集群联盟)允许您使用单个<a class="ae mt" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>集群来协调多个Kubernetes集群。它可以在不同的区域部署多集群应用程序，并为灾难恢复而设计。</p><p id="5907" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">了解更多关于kube fed:<em class="mz"/><a class="ae mt" href="https://github.com/kubernetes-sigs/kubefed" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes-sigs/kubefed</a></p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="58ab" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">先决条件</h1><p id="196f" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">Kubernetes集群必须启动并运行:<code class="fe na nb nc nd b">kubernetes v1.13+</code>。</p><p id="7869" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">在本文中，我们将有三个Kubernetes集群。一种是安装联合控制面板作为主机群集(名为lab)。其他的用于部署名为lab-a和lab-b的应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/1c5df070a5310de468acede7e82154b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i5yzChdwrlb3E9OJUhh3Fw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Kubernetes集群准备</p></figure></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="69d5" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">KubeFed CLI安装</h1><p id="ef1c" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated"><code class="fe na nb nc nd b">kubefedctl</code>是KubeFed命令行实用程序。现在它只支持Linux和OSX。在主机集群中，您可以查看以下链接来获取发布版本并运行命令进行安装:<a class="ae mt" href="https://github.com/kubernetes-sigs/kubefed/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes-sigs/kubefed/releases</a></p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="45b0" class="nj lg it nd b gy nk nl l nm nn">#Replace KUBEFEDVERSION, OSTYPE</span><span id="4dd0" class="nj lg it nd b gy no nl l nm nn">VERSION=KUBEFEDVERSION &lt;latest-version, e.g. 0.1.0-rc3&gt;<br/>OS=OSTYPE &lt;darwin/linux&gt;<br/>ARCH=amd64<br/>curl -LO https://github.com/kubernetes-sigs/kubefed/releases/download/v${VERSION}/kubefedctl-${VERSION}-${OS}-${ARCH}.tgz<br/>tar -zxvf kubefedctl-*.tgz<br/>chmod u+x kubefedctl<br/>sudo mv kubefedctl /usr/local/bin/ #make sure the location is in the PATH</span></pre><p id="80bd" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">您可以通过以下方式查看您的<code class="fe na nb nc nd b">kubefedctl</code>版本:</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="c12b" class="nj lg it nd b gy nk nl l nm nn">kubefedctl version</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/6f7c400f1c0662422e9fd62dff4fb3e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vL33zkb2psRpUZUAfdhB7A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Kubefedctl版本</p></figure></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="2356" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">KubeFed装置</h1><p id="a39c" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">KubeFed安装使用<a class="ae mt" href="https://helm.sh/" rel="noopener ugc nofollow" target="_blank">舵</a>图进行部署。在<strong class="lz iu"> </strong>主机集群中，可以使用以下命令安装Helm CLI <code class="fe na nb nc nd b">Helm v2.10+</code>:</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="5ba1" class="nj lg it nd b gy nk nl l nm nn">curl -LO <a class="ae mt" href="https://git.io/get_helm.sh" rel="noopener ugc nofollow" target="_blank">https://git.io/get_helm.sh</a><br/>chmod 700 get_helm.sh<br/>./get_helm.sh</span></pre><p id="c7cd" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">然后在Kubernetes集群上安装舵柄:</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="cae9" class="nj lg it nd b gy nk nl l nm nn">cat &lt;&lt; EOF | kubectl apply -f -<br/>apiVersion: v1<br/>kind: ServiceAccount<br/>metadata:<br/>  name: tiller<br/>  namespace: kube-system<br/>---<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>kind: ClusterRoleBinding<br/>metadata:<br/>  name: tiller<br/>roleRef:<br/>  apiGroup: rbac.authorization.k8s.io<br/>  kind: ClusterRole<br/>  name: cluster-admin<br/>subjects:<br/>  - kind: ServiceAccount<br/>    name: tiller<br/>    namespace: kube-system<br/>---<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  labels:<br/>    app: helm<br/>    name: tiller<br/>  name: tiller-deploy<br/>  namespace: kube-system<br/>spec:<br/>  progressDeadlineSeconds: 600<br/>  replicas: 1<br/>  revisionHistoryLimit: 10<br/>  selector:<br/>    matchLabels:<br/>      app: helm<br/>      name: tiller<br/>  template:<br/>    metadata:<br/>      creationTimestamp: null<br/>      labels:<br/>        app: helm<br/>        name: tiller<br/>    spec:<br/>      automountServiceAccountToken: true<br/>      containers:<br/>        - env:<br/>            - name: TILLER_NAMESPACE<br/>              value: kube-system<br/>            - name: TILLER_HISTORY_MAX<br/>              value: '0'<br/>          image: 'gcr.io/kubernetes-helm/tiller:v2.16.9'<br/>          imagePullPolicy: IfNotPresent<br/>          livenessProbe:<br/>            failureThreshold: 3<br/>            httpGet:<br/>              path: /liveness<br/>              port: 44135<br/>              scheme: HTTP<br/>            initialDelaySeconds: 1<br/>            periodSeconds: 10<br/>            successThreshold: 1<br/>            timeoutSeconds: 1<br/>          name: tiller<br/>          ports:<br/>            - containerPort: 44134<br/>              name: tiller<br/>              protocol: TCP<br/>            - containerPort: 44135<br/>              name: http<br/>              protocol: TCP<br/>          readinessProbe:<br/>            failureThreshold: 3<br/>            httpGet:<br/>              path: /readiness<br/>              port: 44135<br/>              scheme: HTTP<br/>            initialDelaySeconds: 1<br/>            periodSeconds: 10<br/>            successThreshold: 1<br/>            timeoutSeconds: 1<br/>          resources: {}<br/>          terminationMessagePath: /dev/termination-log<br/>          terminationMessagePolicy: File<br/>      dnsPolicy: ClusterFirst<br/>      restartPolicy: Always<br/>      schedulerName: default-scheduler<br/>      securityContext: {}<br/>      serviceAccount: tiller<br/>      serviceAccountName: tiller<br/>      terminationGracePeriodSeconds: 30<br/>EOF</span></pre></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="03ed" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">什么是头盔？</h1><p id="6689" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">Helm是Kubernetes的包装经理。它可以帮助您管理Kubernetes应用程序，通过Helm Charts轻松安装和升级。</p><p id="c399" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">了解更多关于赫尔姆的信息:<a class="ae mt" href="https://helm.sh/" rel="noopener ugc nofollow" target="_blank">https://helm.sh/</a></p><p id="7f89" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">运行以下命令检查KubeFed图表版本:</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="340f" class="nj lg it nd b gy nk nl l nm nn">helm init --service-account tiller</span><span id="3c72" class="nj lg it nd b gy no nl l nm nn">helm repo add kubefed-charts <a class="ae mt" href="https://raw.githubusercontent.com/kubernetes-sigs/kubefed/master/charts" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/kubernetes-sigs/kubefed/master/charts</a></span><span id="8c24" class="nj lg it nd b gy no nl l nm nn">helm search kubefed</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/a2ea8fa29f6c3f9fff186dd498a7e403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pkgSg5hqoCUMup9vCzeGxA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Kubefed图表版本</p></figure><p id="8cb6" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">使用以下命令在<code class="fe na nb nc nd b">kube-federation-system</code> <em class="mz"> </em>名称空间(默认)<em class="mz"> </em>中安装KubeFed v0.3.0:</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="1aa7" class="nj lg it nd b gy nk nl l nm nn">helm install  kubefed-charts/kubefed  --name=kubefed  --version=0.3.0 --namespace kube-federation-system --devel --debug</span><span id="c1da" class="nj lg it nd b gy no nl l nm nn"># Check if kubefed is ready<br/>kubectl get pod  -n kube-federation-system</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/2e67022960db38ed5215aa10f8a9ac0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ot6Vp1W2-JbZjcqBpqX53A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Kubefed安装状态</p></figure></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="4240" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">聚类注册</h1><p id="da43" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">在<strong class="lz iu"> </strong>主机集群中，为lab-a和lab-b设置<code class="fe na nb nc nd b">Kubectl config</code>，以便我们能够通过上下文切换访问这些集群，并使用上下文加入联盟:</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="8b43" class="nj lg it nd b gy nk nl l nm nn">#Replace CLUSTERNAME, CLUSTERIP, USERNAME, TOKEN, CONTEXTNAME</span><span id="3359" class="nj lg it nd b gy no nl l nm nn">kubectl config set-cluster CLUSTERNAME --server=CLUSTERIP<br/>kubectl config set-credentials USERNAME --token="TOKEN"<br/>kubectl config set-context CONTEXTNAME --cluster=CLUSTERNAME --user=USERNAME</span></pre><p id="022c" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">检查所有集群的上下文:</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="ae4e" class="nj lg it nd b gy nk nl l nm nn">kubectl config get-contexts</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/0e9e42e57a7fa114b2210d7acfd4d966.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*87AUJ58YmnIDgmoLL-Q9aQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">库伯内特语境</p></figure><p id="252f" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">使用<code class="fe na nb nc nd b">kubefedctl join</code> <strong class="lz iu"> </strong>将集群注册到主机集群中:</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="57b8" class="nj lg it nd b gy nk nl l nm nn">#Replace JOINED_CLUSTER_NAME, HOST_CLUSTER_NAME, HOST_CLUSTER_CONTEXT, JOINED_CLUSTER_CONTEXT</span><span id="f959" class="nj lg it nd b gy no nl l nm nn">kubefedctl join JOINED_CLUSTER_NAME --host-cluster-name=HOST_CLUSTER_NAME --host-cluster-context=HOST_CLUSTER_CONTEXT --cluster-context=JOINED_CLUSTER_CONTEXT</span><span id="58f8" class="nj lg it nd b gy no nl l nm nn"># --kubefed-namespace string<br/>If you install kubefed into specific namespace instead of default (default "kube-federation-system") You should provide the specific namespace in the host cluster where the KubeFed system components are installed</span><span id="28b1" class="nj lg it nd b gy no nl l nm nn">#example. <br/>kubefedctl join lab-a-us-west-2 --host-cluster-name=lab --host-cluster-context=eks-admin@lab.us-west-2.eksctl.io --cluster-context=eks-admin@lab-a.us-west-2.eksctl.io</span></pre><p id="99aa" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">加入集群后，您可以通过以下命令检查状态:</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="3869" class="nj lg it nd b gy nk nl l nm nn">kubectl -n kube-federation-system get kubefedclusters</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/7d96badfd4301e96308f1344965cac3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*phnpVg_LfEXD93weYRxFSw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Kubefed加入了集群</p></figure><p id="760e" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">您的联盟集群现在已经准备好了。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="1bef" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">部署服务</h1><p id="f5c5" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">请注意，您必须首先在主机集群中创建一个名称空间，然后联合到加入的集群。</p><p id="3894" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">在主机集群中，使用以下命令为主机集群和其他集群创建名称空间和nginx部署。您可以将集群更改为加入时使用的集群名称。</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="162c" class="nj lg it nd b gy nk nl l nm nn">cat &lt;&lt; EOF | kubectl apply -f -<br/>apiVersion: v1<br/>kind: Namespace<br/>metadata:<br/>  name: test-namespace<br/>EOF</span><span id="b23d" class="nj lg it nd b gy no nl l nm nn">cat &lt;&lt; EOF | kubectl apply -f -<br/>apiVersion: types.kubefed.io/v1beta1<br/>kind: FederatedNamespace<br/>metadata:<br/>  name: test-namespace<br/>  namespace: test-namespace<br/>spec:<br/>  placement:<br/>    clusters:<br/>    - name: <strong class="nd iu">lab-a-us-west-2</strong> <br/>    - name: <strong class="nd iu">lab-b-ap-northeast-1</strong><br/>EOF</span><span id="7c67" class="nj lg it nd b gy no nl l nm nn">cat &lt;&lt; EOF | kubectl apply -f -<br/>apiVersion: types.kubefed.io/v1beta1<br/>kind: FederatedDeployment<br/>metadata:<br/>  name: test-deployment<br/>  namespace: test-namespace<br/>spec:<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: nginx<br/>    spec:<br/>      replicas: 3<br/>      selector:<br/>        matchLabels:<br/>          app: nginx<br/>      template:<br/>        metadata:<br/>          labels:<br/>            app: nginx<br/>        spec:<br/>          containers:<br/>          - image: nginx<br/>            name: nginx<br/>  placement:<br/>    clusters:<br/>    - name: <strong class="nd iu">lab-a-us-west-2 </strong><br/>    - name: <strong class="nd iu">lab-b-ap-northeast-1</strong><br/>EOF</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/992430844a056549c66bf01526bd4e9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FJoW3IWnM15xO93Z_BusrQ.png"/></div></div></figure><p id="e107" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">部署之后，您将能够看到nginx部署在两个集群中启动并运行。</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="e3cf" class="nj lg it nd b gy nk nl l nm nn">#Check for lab-a</span><span id="3215" class="nj lg it nd b gy no nl l nm nn">kubectl get deployment -n test-namespace --context <a class="ae mt" href="mailto:eks-admin@lab-a.us-west-2.eksctl.io" rel="noopener ugc nofollow" target="_blank">eks-admin@lab-a.us-west-2.eksctl.io</a>  </span><span id="e213" class="nj lg it nd b gy no nl l nm nn">#Check for lab-b</span><span id="a669" class="nj lg it nd b gy no nl l nm nn">kubectl get deployment -n test-namespace --context <a class="ae mt" href="mailto:eks-admin@lab-b.ap-northeast-1.eksctl.io" rel="noopener ugc nofollow" target="_blank">eks-admin@lab-b.ap-northeast-1.eksctl.io</a></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/0a5a876ad160683c16adfc2d55a66773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AaocS9_UDt1oD2Ye7vHqPg.png"/></div></div></figure><p id="84bf" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">您还可以覆盖应用程序部署版本等。，仅适用于通过在YAML文件中定义覆盖的特定群:</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="8ed1" class="nj lg it nd b gy nk nl l nm nn">cat &lt;&lt; EOF | kubectl apply -f -<br/>apiVersion: types.kubefed.io/v1beta1<br/>kind: FederatedDeployment<br/>metadata:<br/>  name: test-deployment<br/>  namespace: test-namespace<br/>spec:<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: nginx<br/>    spec:<br/>      replicas: 3<br/>      selector:<br/>        matchLabels:<br/>          app: nginx<br/>      template:<br/>        metadata:<br/>          labels:<br/>            app: nginx<br/>        spec:<br/>          containers:<br/>          - image: nginx<br/>            name: nginx<br/>  placement:<br/>    clusters:<br/>    - name: <strong class="nd iu">lab-a-us-west-2 </strong><br/>    - name: <strong class="nd iu">lab-b-ap-northeast-1</strong><br/>  overrides:<br/>  - clusterName: <strong class="nd iu">lab-a-us-west-2 </strong><br/>    clusterOverrides:<br/>    - path: "/spec/replicas"<br/>      value: 5<br/>    - path: "/spec/template/spec/containers/0/image"<br/>      value: "nginx:1.17.0-alpine"<br/>    - path: "/metadata/annotations"<br/>      op: "add"<br/>      value:<br/>        foo: bar<br/>    - path: "/metadata/annotations/foo"<br/>      op: "remove"<br/>EOF</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/5a49574f51dfb962fe3669173def2cd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IHEgE4di6RnVWautKFlYiQ.png"/></div></div></figure><p id="bfc0" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">部署之后，您将能够看到nginx部署的副本、镜像版本等。实验室-a中的现已修改。</p><pre class="kj kk kl km gt nf nd ng nh aw ni bi"><span id="706c" class="nj lg it nd b gy nk nl l nm nn">kubectl describe deployment -n test-namespace --context <a class="ae mt" href="mailto:eks-admin@lab-a.us-west-2.eksctl.io" rel="noopener ugc nofollow" target="_blank">eks-admin@lab-a.us-west-2.eksctl.io</a></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/13dbe01606f880245b38d362773e6538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AVmXFv1m4_pxyyrnKd6k1w.png"/></div></div></figure><p id="2b07" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">应用程序部署测试到此结束。</p><p id="eced" class="pw-post-body-paragraph lx ly it lz b ma mu ju mc md mv jx mf mg mw mi mj mk mx mm mn mo my mq mr ms im bi translated">现在，您将能够使用联盟来管理您的集群和应用程序！</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="e83a" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">我的工作版本</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/b3d87830e013a90b807f8f3a310a2ca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*USW7ao_pfsM3hlpbqyEN9w.png"/></div></div></figure></div></div>    
</body>
</html>