<html>
<head>
<title>Tired of Troubleshooting Idle Search Resources? Use OpenSearch Benchmark for Performance Tuning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">厌倦了对闲置的搜索资源进行故障排除？使用OpenSearch基准进行性能调优</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/tired-of-troubleshooting-idle-search-resources-use-opensearch-benchmark-for-performance-tuning-d4277c9f724?source=collection_archive---------8-----------------------#2022-11-14">https://betterprogramming.pub/tired-of-troubleshooting-idle-search-resources-use-opensearch-benchmark-for-performance-tuning-d4277c9f724?source=collection_archive---------8-----------------------#2022-11-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9c72" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何安装OpenSearch Benchmark，创建“工作负载”，并在计算设备之间对它们进行基准测试</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/997ff2c13040a5521cfcf1bfa0876c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T4_rKbsHcFdUxn48"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@benwhitephotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">本·怀特</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="7c21" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">OpenSearch用户经常想知道他们的搜索在各种环境、主机类型和集群配置中的表现。OpenSearch Benchmark是一个社区驱动的开源的Rally分支，是实现这一目的的理想工具。</p><p id="672a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">OpenSearch-benchmark通过优化OpenSearch资源使用来帮助您降低基础设施成本。该工具还使您能够通过运行定期基准测试来发现性能退化并提高性能。在进行基准测试之前，您应该尝试其他几个步骤来提高性能——这是我在之前的一篇文章中讨论的主题。</p><p id="8cb9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将带领您设置OpenSearch基准测试并运行搜索性能基准测试，将一个广泛使用的EC2实例与一个新的计算加速器——由<a class="ae kv" href="https://www.searchium.ai/" rel="noopener ugc nofollow" target="_blank"> Searchium.ai </a>开发的关联处理单元(APU)进行比较。</p><h1 id="3836" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">步骤1:安装Opensearch-benchmark</h1><p id="6288" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们将使用一台m5.4xlarge (us-west-1) EC2机器，我在上面安装了OpenSearch并索引了一个名为laion_text的9.1 M大小的向量索引。该索引是大型<a class="ae kv" href="https://laion.ai/projects/" rel="noopener ugc nofollow" target="_blank"> laion数据集</a>的一个子集，在那里我将文本字段转换为一个矢量表示(使用<a class="ae kv" href="https://openai.com/blog/clip/" rel="noopener ugc nofollow" target="_blank">剪辑</a>模型):</p><p id="bc4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装Python 3.8+，包括pip3，git 1.9+，以及一个<a class="ae kv" href="https://github.com/opensearch-project/OpenSearch-Benchmark/blob/main/DEVELOPER_GUIDE.md" rel="noopener ugc nofollow" target="_blank">合适的JDK来运行OpenSearch。</a>确保JAVA_HOME指向那个JDK。然后运行以下命令:</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="14d3" class="mu lt iq mq b be mv mw l mx my">sudo python3.8 -m pip install opensearch-benchmark</span></pre><p id="5031" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">提示:你可能需要手动安装每个依赖项。</p><ul class=""><li id="22d6" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr ne nf ng nh bi translated"><code class="fe ni nj nk mq b">sudo apt install python3.8-dev</code></li><li id="d1a3" class="mz na iq ky b kz nl lc nm lf nn lj no ln np lr ne nf ng nh bi translated"><code class="fe ni nj nk mq b">sudo apt install python3.8-distutils</code></li><li id="69dc" class="mz na iq ky b kz nl lc nm lf nn lj no ln np lr ne nf ng nh bi translated"><code class="fe ni nj nk mq b">python3.8 -m pip install multidict –upgrade</code></li><li id="b922" class="mz na iq ky b kz nl lc nm lf nn lj no ln np lr ne nf ng nh bi translated"><code class="fe ni nj nk mq b">python3.8 -m pip install attrs — upgrade</code></li><li id="5e74" class="mz na iq ky b kz nl lc nm lf nn lj no ln np lr ne nf ng nh bi translated"><code class="fe ni nj nk mq b">python3.8 -m pip install yarl –upgrade</code></li><li id="179d" class="mz na iq ky b kz nl lc nm lf nn lj no ln np lr ne nf ng nh bi translated"><code class="fe ni nj nk mq b">python3.8 -m pip install async_timeout –upgrade</code></li><li id="b5bd" class="mz na iq ky b kz nl lc nm lf nn lj no ln np lr ne nf ng nh bi translated"><code class="fe ni nj nk mq b">python3.8 -m pip install aiosignal — upgrade</code></li></ul><p id="66e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行以下命令验证安装是否成功:</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="14d7" class="mu lt iq mq b be mv mw l mx my">opensearch-benchmark list workloads</span></pre><p id="d759" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您应该会看到以下详细信息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/e2516ae3bd99747c27632141322edeee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9aReKOfObNKYX4f9yyAK-Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者截图</p></figure><h1 id="802e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">步骤2:配置保存结果的位置</h1><p id="5210" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">默认情况下，OpenSearch基准测试报告“内存中”如果设置为“内存中”，则在运行基准测试时，所有指标都将保存在内存中。如果设置为“opensearch”，所有指标都将被写入一个持久的指标存储中，并且数据将可用于进一步的分析。</p><p id="79d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要将报告的结果保存在您的OpenSearch集群中，请打开位于<code class="fe ni nj nk mq b">~/.benchmark</code>文件夹中的<code class="fe ni nj nk mq b">opensearch-benchmark.ini</code>文件，然后修改突出显示区域中的结果发布部分，以写入OpenSearch集群:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/203d91d5daec91f2fc57f9724acb4470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*10PXFgTWh9kkAgurN3uj3g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者截图</p></figure><h1 id="5049" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">步骤3:构建搜索“工作负载”</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/300cd1b849e1ba788aa228145750ab1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5PB1kdBzeoz0sthF"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">斯科特·布莱克在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="f4e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然我们已经正确安装了OpenSearch基准测试，那么是时候开始基准测试了！</p><p id="186a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">计划是使用OpenSearch Benchmark来比较两个计算设备之间的搜索。您可以使用下面的方法对任何实例进行基准测试和比较。在这个例子中，我们将测试一个常用的KNN平面搜索(一个使用IVF和HNSW的ANN例子将在我的下一篇文章中介绍),并将一个m5.4xlarge EC2实例与APU进行比较。</p><p id="3b11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以通过从Searchium.ai的SaaS平台下载的插件来访问APU。您可以在自己的环境和数据上测试以下基准测试过程。可以免费试用，注册也很简单。</p><p id="c378" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">OpenSearch基准测试中的每个测试/跟踪被称为一个“工作负载”我们将在m5.4xlarge上创建一个搜索工作负载，作为我们的基准。我们还将在同一个EC2上的APU上创建一个搜索工作负载，它将充当我们的竞争者。稍后，我们将比较两种工作负载的性能。</p><p id="e714" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们首先使用<code class="fe ni nj nk mq b">laion_text</code>索引为m5.4xlarge (CPU)和APU创建一个工作负载(确保从<code class="fe ni nj nk mq b">.benchmark</code>目录中运行这些命令):</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="7771" class="mu lt iq mq b be mv mw l mx my">opensearch-benchmark create-workload --workload=laion_text_cpu --target-hosts=localhost:9200 --indices="laion_text”</span></pre><pre class="nt mp mq mr bn ms mt bi"><span id="3dfe" class="mu lt iq mq b be mv mw l mx my">opensearch-benchmark create-workload --workload=laion_text_apu --target-hosts=localhost:9200 --indices="laion_text”</span></pre><p id="4695" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="nu">注意</em> </strong> <em class="nu">:如果工作量保存在</em> <code class="fe ni nj nk mq b"><em class="nu">home</em></code> <em class="nu">文件夹下的</em> <code class="fe ni nj nk mq b"><em class="nu">workloads</em></code> <em class="nu">文件夹中，则需要将其复制到</em> <code class="fe ni nj nk mq b"><em class="nu">.benchmark/benchmarks/workloads/default</em></code> <em class="nu">目录下。</em></p><p id="9b09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再次运行<code class="fe ni nj nk mq b">opensearch-benchmark list</code>工作负载，注意<code class="fe ni nj nk mq b">laion_text_cpu</code>和<code class="fe ni nj nk mq b">laion_text_apu</code>都被列出。</p><p id="8d9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们将向测试计划中添加操作。在本节中，您可以添加任意数量的基准测试。将每个测试添加到<code class="fe ni nj nk mq b">workload.json</code>文件的时间表中，该文件可以在您希望进行基准测试的索引名文件夹中找到。</p><p id="7c0f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的案例中，可以在以下领域找到它:</p><ul class=""><li id="61d5" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr ne nf ng nh bi translated"><code class="fe ni nj nk mq b">./benchmark/benchmarks/workloads/default/laion_text_apu</code></li><li id="3d14" class="mz na iq ky b kz nl lc nm lf nn lj no ln np lr ne nf ng nh bi translated"><code class="fe ni nj nk mq b">./benchmark/benchmarks/workloads/default/laion_text_cpu</code></li></ul><p id="2c42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们想测试一下我们的OpenSearch搜索。创建一个名为“single vector search”(或任何其他名称)的操作，并包含一个查询向量。我剪掉了向量本身，因为512维向量会有点长…添加所需的查询向量，并确保将相同的向量复制到m5.4xlarge (CPU)和APU <code class="fe ni nj nk mq b">workload.json</code>文件中！</p><p id="72ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，添加您想要的任何参数。在这个例子中，我将坚持使用默认的八个客户端和1000次迭代。</p><p id="500d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">m 5.4x大型(CPU) <code class="fe ni nj nk mq b">workload.json</code>:</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="0cc1" class="mu lt iq mq b be mv mw l mx my">"schedule":[<br/>      {<br/>         "operation":{<br/>            "name":"single-vector-search",<br/>            "operation-type":"search",<br/>            "body":{<br/>               "size":"10",<br/>               "query":{<br/>                  "script_score":{<br/>                     "query":{<br/>                        "match_all":{}<br/>                     },<br/>                     "script":{<br/>                        "source":"knn_score",<br/>                        "lang":"knn",<br/>                        "params":{<br/>                           "field":"vector",<br/>                           "query_value":[INSERT VECTOR HERE],<br/>                           "space_type":"cosinesimil"<br/>                        }<br/>                     }<br/>                  }<br/>               }<br/>            }<br/>         },<br/>         "clients":8,<br/>         "warmup-iterations":1000,<br/>         "iterations":1000,<br/>         "target-throughput":100<br/>      }<br/>   ]</span></pre><p id="f9c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">辅助动力装置<code class="fe ni nj nk mq b">workload.json</code>:</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="0235" class="mu lt iq mq b be mv mw l mx my">"schedule":[<br/>      {<br/>         "operation":{<br/>            "name":"single-vector-search",<br/>            "operation-type":"search",<br/>            "body":{<br/>               "size":"10",<br/>               "query":{<br/>                  "gsi_knn":{<br/>                     "field":"vector",<br/>                     "vector":[INSERT VECTOR HERE],<br/>                     "topk":"10"<br/>                  }<br/>               }<br/>            }<br/>         },<br/>         "clients":8,<br/>         "warmup-iterations":1000,<br/>         "iterations":1000,<br/>         "target-throughput":100<br/>      }<br/>   ]</span></pre><h1 id="296e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">步骤4:运行我们的工作负载</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/5ef2b9f8017c1167daa650c184f85123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*G4KKLS2tQQw5pyx8"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/es/@punttim?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Tim Gouw </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="b13f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是时候运行我们的工作负载了！我们有兴趣在正在运行的OpenSearch集群上运行我们的搜索工作负载。我给<code class="fe ni nj nk mq b">execute_test</code>命令添加了几个参数:</p><p id="2b42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ni nj nk mq b">Distribution-version </code> —确保添加正确的OpenSearch版本。</p><p id="a295" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ni nj nk mq b">Workload</code> —我们的工作量名称。</p><p id="6f4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其他参数也是可用的。我增加了<code class="fe ni nj nk mq b">pipeline</code>、<code class="fe ni nj nk mq b">client-options</code>、<code class="fe ni nj nk mq b">on-error</code>，简化了整个流程。</p><p id="7c15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">继续运行以下命令，这将运行我们的工作负载:</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="8f54" class="mu lt iq mq b be mv mw l mx my">opensearch-benchmark execute_test --distribution-version=2.2.0 --workload=laion_text_apu --pipeline=benchmark-only --client-options=verify_certs:false,use_ssl:false --on-error=abort --client-options="timeout:320"</span></pre><pre class="nt mp mq mr bn ms mt bi"><span id="7725" class="mu lt iq mq b be mv mw l mx my">opensearch-benchmark execute_test --distribution-version=2.2.0 --workload=laion_text_cpu --pipeline=benchmark-only --client-options=verify_certs:false,use_ssl:false --on-error=abort --client-options="timeout:320"</span></pre><p id="a777" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们等待…</p><blockquote class="nw nx ny"><p id="0292" class="kw kx nu ky b kz la jr lb lc ld ju le nz lg lh li oa lk ll lm ob lo lp lq lr ij bi translated"><strong class="ky ir">奖金基准:</strong>我很想看看在基于Arm的亚马逊Graviton2处理器上的结果，所以我也在r6g.8xlarge EC2上运行了完全相同的过程。</p></blockquote><p id="154f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的结果应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/882309c7f6ee1b3c93b7c58feef93585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X4uOojcQvbbqAy012A76Pg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="od"> laion_text_apu ( </em> APU)结果</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/a5bab3cd3390d700f0ef3a99def29d2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l1Kux_1jyD-Z2-WzmtuMTw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">m5.4xlarge <em class="od"> (C </em> PU)结果</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/79eb6e5d4f909a776781b60c38844e2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_C4OYnJ1GOxDYpJy9F7Ljg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">r6g.8xlarge <em class="od"> (C </em> PU)结果</p></figure><h1 id="d560" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">第五步:比较我们的结果</h1><p id="5393" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们终于准备好查看我们的测试结果了。请敲鼓… 🥁</p><p id="8022" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们注意到每个工作负载的运行时间是不同的。m5.4xlarge工作负载用时9小时，r6g.8xlarge工作负载用时6.96小时，APU工作负载用时2.78分钟。这是因为APU还支持查询聚合，允许更大的吞吐量。</p><p id="f86f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们希望对我们的工作负载进行更全面的比较。OpenSearch Benchmark使我们能够生成一个CSV文件，在该文件中我们可以轻松地比较工作负载。</p><p id="c26c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们需要找到每个案例的工作量id。这可以通过查看open search benchmark-test-executions索引(在步骤2中创建)或<code class="fe ni nj nk mq b">benchmarks</code>文件夹来完成:</p><p id="530d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用工作负载id，运行以下命令来比较两个工作负载，并在CSV文件中显示输出:</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="8926" class="mu lt iq mq b be mv mw l mx my">opensearch-benchmark compare --results-format=csv --show-in-results=search --results-file=data.csv --baseline=ecb4af7a-d53c-4ac3-9985-b5de45daea0d --contender=b714b13a-af8e-4103-a4c6-558242b8fe6a</span></pre><p id="43e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里有一个简短的总结，比较了我们的三个工作负载结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/425667dde6c99a1a591da1b23226d785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VtTq0JvGtrlXcFh8fPoq4g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="a709" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">表中结果的简要说明:</p><ol class=""><li id="e02a" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr oh nf ng nh bi translated">吞吐量:OpenSearch在一定时间内可以执行的操作数量，通常是每秒。</li></ol><p id="09ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.延迟:提交请求和收到完整响应之间的时间。它还包括等待时间，即请求等待OpenSearch处理的时间。</p><p id="2fed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.服务时间:发送请求和接收相应响应之间的时间。这一指标很容易与延迟混淆，但不包括等待时间。这就是大多数负载测试工具错误地称为“延迟”的东西</p><p id="ae80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4.测试执行时间:从启动工作负载到完成的总运行时间。</p><h1 id="26ca" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="9020" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在查看我们的结果时，我们可以看到APU工作负载的服务时间比m5.4xlarge工作负载快197倍，比r6g.8xlarge快151倍。从成本角度来看，在APU上运行相同的工作负载的成本为0.23美元，而m5.4xlarge的成本为8.87美元(便宜38倍)，r6g.8xlarge的成本为13.02美元(便宜56倍)，我们在近9个小时(m5.4xlarge)内得到我们的搜索结果</p><p id="58bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，想象一下当扩展到更大的数据集时，这些好处有多大，在我们这个数据驱动、快节奏的世界中，情况很可能就是这样。</p><p id="f319" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这有助于您了解OpenSearch基准测试工具的强大功能，以及如何使用它来测试您的搜索性能。</p><p id="2260" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有关Searchium.ai的插件和APU的更多信息，请访问<a class="ae kv" href="http://www.searchium.ai/" rel="noopener ugc nofollow" target="_blank"> www.searchium.ai. </a>他们甚至提供免费试用！</p><p id="3e33" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">非常感谢Dmitry Sosnovsky和<a class="ae kv" href="https://medium.com/@yaniv.vaknin" rel="noopener"> Yaniv Vaknin </a>的帮助！</p></div></div>    
</body>
</html>