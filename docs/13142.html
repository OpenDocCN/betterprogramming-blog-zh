<html>
<head>
<title>Want to Create Robust Pull Requests? Use the “Danger” Build Tool in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">想要创建健壮的拉请求吗？使用Swift中的“危险”构建工具</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-implement-danger-in-swift-fb8ea070ceb6?source=collection_archive---------17-----------------------#2022-08-01">https://betterprogramming.pub/how-to-implement-danger-in-swift-fb8ea070ceb6?source=collection_archive---------17-----------------------#2022-08-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="87e0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关注代码，让危险保持拉请求的形状</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7157ee5fb7d65c4a8647ca4abddcd3ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ewi7X0CzOlxfjKtL"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/es/@nelly13?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">耐莉·安东尼娅杜</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="d802" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近接了一个项目，在这个项目中，我是唯一的iOS应用程序开发人员，这意味着如果我发出<a class="ae ky" href="https://cctplus.dev/3-ways-to-make-better-pull-request-descriptions/" rel="noopener ugc nofollow" target="_blank">拉请求</a> (PR)，那么我就必须自己审查自己的代码。这对于代码质量来说并不理想，但是我想出了如何通过问“我如何确保我记住了最佳实践？”答案是使用<a class="ae ky" href="https://danger.systems/" rel="noopener ugc nofollow" target="_blank">危险</a>。Danger是一个构建工具，它检查您的PRs是否符合您或您的团队定义的规则。</p><h1 id="312e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">什么是危险？</h1><p id="34f4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Danger是一个构建工具，它检查您的pull请求是否遵循某些规则。可以实现的规则是“使用拉请求添加变更日志条目”，或者拉请求只能有这么多变更。它通常作为CI/CD中的一个步骤来运行，<a class="ae ky" href="https://cctplus.dev/continuous-integration-and-continuous-deployment-for-ios-and-ipados-apps/" rel="noopener ugc nofollow" target="_blank">持续集成/持续部署</a>，这样如果一个规则被破坏，构建将会失败，并且PR不会被合并。</p><p id="7ec1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Danger可以在本地和CI/CD工具中工作，如<a class="ae ky" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub actions </a>和<a class="ae ky" href="http://bitrise.io" rel="noopener ugc nofollow" target="_blank"> BitRise </a>。它可以在不同的远程git服务器上运行，如GitHub、BitBucket、Gitlab和PRs上的comments。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/08431f0d5193b1b14888dd97c197e291.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6BBlqUKLSGCcXLEl.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PR上的危险注释</p></figure><p id="2488" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有多种类型的危险:危险-JS，危险-Ruby和危险-Swift。在这篇博客中，我们将讨论危险-迅捷。</p><h1 id="8a10" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">如何设置危险-迅捷</h1><p id="fab7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">设置危险只需要三个步骤。这些文档会更深入一点，但最终要做起来，这里是你需要的三个步骤。</p><h1 id="fed2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">1.局部安装危险</h1><p id="5a27" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我建议用自制安装Danger，如果你没有，那就弄<a class="ae ky" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">自制</a>。</p><p id="49f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行<code class="fe mt mu mv mw b">brew install danger/tap/danger-swift</code></p><p id="9946" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可能需要一段时间，所以要有点耐心。</p><h1 id="4840" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2.创建您的危险文件</h1><p id="0de9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在项目的根repo中，添加文件<code class="fe mt mu mv mw b">Dangerfile.swift</code>。在该文件中，包括以下内容:</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="7081" class="nb lw it mw b gy nc nd l ne nf">import Foundation<br/>import Danger</span><span id="33a1" class="nb lw it mw b gy ng nd l ne nf">let danger = Danger()</span><span id="03c8" class="nb lw it mw b gy ng nd l ne nf">let allSourceFiles = danger.git.modifiedFiles + danger.git.createdFiles</span></pre><p id="280c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你做了什么？好了，您已经导入了danger并创建了一个保存所有git文件的常量。现在，如果您想查看某个文件是否被更改，那么您可以在<code class="fe mt mu mv mw b">allSourceFiles</code>上使用<code class="fe mt mu mv mw b">.contains("filename.extension)"</code>，然后在pull请求的注释中输出它是否被更改，或者如果在本地运行，则在您的终端中输出。这里有一个例子来检查<code class="fe mt mu mv mw b">Changelog.md</code>是否改变了。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="8c81" class="nb lw it mw b gy nc nd l ne nf">import Foundation<br/>import Danger  </span><span id="506d" class="nb lw it mw b gy ng nd l ne nf">let danger = Danger()</span><span id="26f8" class="nb lw it mw b gy ng nd l ne nf">let allSourceFiles = danger.git.modifiedFiles + danger.git.createdFiles</span><span id="e6e3" class="nb lw it mw b gy ng nd l ne nf">let changelogChanged = allSourceFiles.contains("CHANGELOG.md")</span><span id="3e22" class="nb lw it mw b gy ng nd l ne nf">if !changelogChanged {<br/>  warn("No CHANGELOG entry added.")<br/>}</span></pre><ul class=""><li id="f00c" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><code class="fe mt mu mv mw b">fail("message goes here")</code> —将使构建失败，并将消息放入表中</li><li id="6d1a" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><code class="fe mt mu mv mw b">message("message goes here")</code>——允许你在表格中输入信息</li><li id="4442" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><code class="fe mt mu mv mw b">markdown("#message goes here")</code> —将把markdown放在表格的底部</li></ul><h1 id="7be0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3.获取一个GitHub API令牌并将其从您的。zshrc文件</h1><p id="4e3d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这一步是可选的，但这是它处理私有回购的唯一方式。获取一个GitHub令牌，确保设置了查看您的回购的权限，并将<code class="fe mt mu mv mw b">export DANGER_GITHUB_API_TOKEN='token_here'</code>添加到您的<code class="fe mt mu mv mw b">.zshrc file</code>中。之后，您将能够在本地进行测试。您唯一需要的是一个拉请求链接。</p><p id="ca3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行<code class="fe mt mu mv mw b">danger-swift pr {paste pr link without brackets}</code>，在您的终端中，您应该看到类似如下的输出:</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="a724" class="nb lw it mw b gy nc nd l ne nf">$ danger-swift pr https://github.com/maeganwilson/ios-template/pull/2<br/>$ Starting Danger PR on maeganwilson/ios-template#2<br/></span><span id="c314" class="nb lw it mw b gy ng nd l ne nf">Danger: ✓ passed review, received no feedback.</span></pre><p id="1510" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一篇文章中，我将解释我是如何设置GitHub actions来运行Danger，并让我自己的Danger Bot来发布我的Pull请求的。</p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="f66a" class="nb lw it mw b gy nc nd l ne nf"><strong class="mw iu">Want to Connect?</strong></span><span id="cd43" class="nb lw it mw b gy ng nd l ne nf">Let me know if you have any comments or questions on Twitter, <a class="ae ky" href="https://twitter.com/maeganwilson_" rel="noopener ugc nofollow" target="_blank">@maeganwilson_</a>, and follow me there.</span></pre></div></div>    
</body>
</html>