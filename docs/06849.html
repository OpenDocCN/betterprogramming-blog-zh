<html>
<head>
<title>Becoming Root Via a Misconfigured PATH</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过错误配置的路径成为根</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/becoming-root-via-a-misconfigured-path-720a52981c93?source=collection_archive---------2-----------------------#2020-11-11">https://betterprogramming.pub/becoming-root-via-a-misconfigured-path-720a52981c93?source=collection_archive---------2-----------------------#2020-11-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a856" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用错误配置的路径变量提升Linux权限</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/be139d383245bccb89cee981e3f88fa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6bm1dvjqRWW-YULi"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">凯文·霍尔瓦特在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="60f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">欢迎回到Linux安全系列！在本系列中，我们将讨论影响Linux系统的安全问题以及导致这些问题的常见错误配置。我们开始吧！</p><p id="5f43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">权限提升是攻击者提升系统权限的一种方式。例如，假设一个攻击者已经获得了对您的web服务器的访问权，但只是作为一个低特权用户。他们不能读写敏感文件、执行脚本或更改系统配置。他们如何危害您的服务器并保持对服务器的访问？</p><p id="0695" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果他们可以找到一种方法来欺骗系统，使其认为自己是根用户，攻击者就可以进行更强大的攻击，如读写敏感文件和在系统中插入永久性后门。这就是特权升级的由来。</p><p id="1027" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，我们来谈谈攻击者如何利用配置错误的路径变量来利用根用户运行具有根权限的脚本。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3d02" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">什么是路径变量？</strong></h1><p id="8ae1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">环境变量是系统环境中影响程序运行方式的变量。例如，一些常见的环境变量包括当前用户的主目录、当前用户的默认shells和可执行文件的路径。您可以使用以下命令查看您的环境变量:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="da6a" class="ne md it na b gy nf ng l nh ni">$ printenv</span></pre><p id="0f91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl na b">PATH</code>变量是一个环境变量，包含一个由冒号分隔的路径列表。每次执行命令时，Unix都会在这些目录中搜索与命令名匹配的可执行文件。如果执行存储在这些位置中的任何文件，则在运行该文件时不必指定其绝对路径。</p><p id="3d16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，<code class="fe nj nk nl na b">ls</code>命令用于列出当前目录中的文件。而<code class="fe nj nk nl na b">ls</code>命令的二进制文件通常位于<code class="fe nj nk nl na b">/bin</code>目录中。但是您不必键入<code class="fe nj nk nl na b">/bin/ls</code>来执行命令，因为<code class="fe nj nk nl na b">/bin</code>目录被添加到您的<code class="fe nj nk nl na b">PATH</code>变量中。当您在没有指定绝对路径的情况下键入一个命令名时，您的shell将搜索<code class="fe nj nk nl na b">PATH</code>列表中的每个目录，以查找具有该名称的可执行文件。然后，shell将运行它找到的第一个匹配程序。</p><p id="cb16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过执行以下命令来显示您的<code class="fe nj nk nl na b">PATH</code>变量:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9442" class="ne md it na b gy nf ng l nh ni">$ echo $PATH</span></pre><p id="0da5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用以下命令更新您的<code class="fe nj nk nl na b">PATH</code>变量:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c184" class="ne md it na b gy nf ng l nh ni">$ export PATH=”new-path-here”</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="60b8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">问题是</h1><p id="7a31" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">那么这个功能有什么问题呢？</p><p id="8988" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Linux文件路径中，单个点(<code class="fe nj nk nl na b">.</code>)表示当前目录。你可以通过输入<code class="fe nj nk nl na b">./script_name</code>来运行当前目录下的程序。有时，用户将<code class="fe nj nk nl na b">.</code>添加到他们的<code class="fe nj nk nl na b">PATH</code>变量中，这样他们就可以在当前目录下运行程序，而不需要输入额外的<code class="fe nj nk nl na b">./</code>。例如，如果您将<code class="fe nj nk nl na b">.</code>添加到您的<code class="fe nj nk nl na b">PATH</code>变量中，您可以通过键入<code class="fe nj nk nl na b">maintenance.sh</code>而不是<code class="fe nj nk nl na b">./maintenance.sh</code>来运行当前目录中名为<code class="fe nj nk nl na b">maintenance.sh</code>的shell脚本。</p><p id="f224" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当在可执行文件的原始路径前添加“点”路径时，shell将在命令运行时首先搜索当前目录，然后再查找其他目录。这意味着攻击者可以用命令名来命名他们的脚本，并使用户执行恶意脚本而不是合法命令。</p><p id="e025" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，假设一个具有root权限的管理员在他们的路径中有一个点目录。当他们执行<code class="fe nj nk nl na b">ls</code>命令时，在寻找位于<code class="fe nj nk nl na b">/bin/ls</code>的合法程序之前，shell将首先在当前目录中搜索名为<code class="fe nj nk nl na b">ls</code>的可执行文件。这给了攻击者一个独特的机会:如果攻击者可以在一个目录中植入一个名为<code class="fe nj nk nl na b">ls</code>的恶意可执行文件，并诱使管理员在该目录中执行该命令，他们就可以诱使管理员以root权限执行该恶意脚本！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ef9c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">袭击</h1><p id="f6f9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设攻击者想要将自己添加为系统的root用户，并且他们知道具有root权限的管理员在他们的<code class="fe nj nk nl na b">PATH</code>变量中有“点”路径。他们可以将这个恶意脚本植入一个公开可写的目录，比如<code class="fe nj nk nl na b">/tmp</code>目录，并将其命名为<code class="fe nj nk nl na b">ls</code>。现在，当管理员用户执行<code class="fe nj nk nl na b">ls</code>命令和<code class="fe nj nk nl na b">/tmp</code>目录时，他们将执行这个脚本，而不是实际的<code class="fe nj nk nl na b">/bin/ls</code>二进制文件:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b382" class="ne md it na b gy nf ng l nh ni">echo “vickie::0:0:System Administrator:/root/root:/bin/bash” &gt;&gt; /etc/passwd</span><span id="6e04" class="ne md it na b gy nm ng l nh ni">/bin/ls</span></pre><p id="1653" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该脚本的第一行向<code class="fe nj nk nl na b">/etc/passwd</code>文件添加了一个新的root用户。由于<code class="fe nj nk nl na b">0</code>是root用户的UID，添加一个UID为<code class="fe nj nk nl na b">0</code>的用户将会给这个用户root权限。该用户将拥有用户名<code class="fe nj nk nl na b">vickie</code>和一个空密码。这个命令对于普通用户来说通常是不可能的，因为只有特权用户才能修改<code class="fe nj nk nl na b">/etc/password</code>文件。然后，脚本执行合法的<code class="fe nj nk nl na b">/bin/ls</code>命令来列出目录内容，并欺骗管理员认为他们执行了正确的命令。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="edd1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">注意安全！</h1><p id="4dae" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">将“点”路径添加到您的<code class="fe nj nk nl na b">PATH</code>变量是非常危险的，您可能会意外地给攻击者机会来提升您系统上的权限。相反，花时间在命令中输入额外的<code class="fe nj nk nl na b">./</code>来执行当前目录中的程序！</p><p id="dade" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！下一次，我们将深入探讨攻击者可以用来危害您的系统的更多特权提升技术。</p></div></div>    
</body>
</html>