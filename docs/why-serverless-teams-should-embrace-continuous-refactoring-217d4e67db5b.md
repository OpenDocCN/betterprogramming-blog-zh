# 为什么无服务器团队应该接受持续重构

> 原文：<https://betterprogramming.pub/why-serverless-teams-should-embrace-continuous-refactoring-217d4e67db5b>

## 在无服务器中重新停留

![](img/85ff4ffb835b98e669a72ce5f21b8958.png)

图片由[皮克斯拜](https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=3286018)的 Gerd Altmann 提供

无服务器的采用给许多组织带来了希望！成本效率、工程效率和业务效率的承诺。然而，无服务器技术一旦被成功采用，就不能任其生锈。

采用无服务器的动机永远不应该是*完成工作，永不回头*。如果您以这种态度接受它，您将不可避免地陷入遗留迁移的困境，这将比您预期的更快地困扰您。

为什么会这样呢？

# 进化的生态系统

无服务器生态系统在不断发展。有时，这种发展如此之快，以至于团队很难跟上。通常，它会让人感觉像一支强大的队伍，行进得越来越快，每一步都越来越有力。挑战是成为其中的一部分，以某种方式跟上无情的步伐，而不是成为旁观者。

你现在可能会扬起眉毛，带着调皮的微笑想，这项现代技术有什么了不起的，它对你的要求如此之高，让你一直跟着它跑？这不是适得其反吗？这不是颠覆性的开发实践吗？

对此类问题的简单回答是，视情况而定:

*   在您的无服务器思维模式下
*   你的团队有多敏捷
*   你对增量和迭代开发的信念
*   你想和无服务器保持多新鲜
*   你是否想保护你的技术投资
*   你是否想留住你最好的工程师
*   关于您企业的加速目标
*   你提供给顾客的服务
*   你有多关心你的顾客

是的，看情况！

> 无服务器需要新的思维方式、新的工作方式和新的应用程序运行方式。也就是说，我们需要改变我们的思维方式、工作方式和运行应用程序的方式！

# 为什么要持续重构？

在这个拥挤的*连续事物*的世界里，持续重构并不是一个新奇的术语。现在已经用了好几年了。

人们经常将*重构*与*遗留*联系在一起。传统思维会带来过去可怕的经历——请不要。而是要思考“持续改进”或者“持续更新”。

持续重构是为了让你能够继续为你的客户提供最好的服务，无论是现在还是将来。

提供最佳服务需要构建最佳解决方案；构建最佳解决方案需要最佳技术；最好的技术——无服务器或其他——不会在第一天就出现。成熟需要时间，这是一个普遍的事实，因此不断重构！

# 无服务器才刚刚开始！

人类的经验是通过在行业中的年数、飞行小时数、出版物数、出现次数等等来衡量的。多年来，我们发现自己的错误、缺点、效率低下等等，并找到改进的方法。这是我们生活中不断重构和改进的行动。

云和无服务器技术也是如此，它们的周期更短，但速度更快。大量的使用指标不断挖掘服务行为。源源不断的客户反馈和体验报告带来了痛点。所有这些以及更多的信息被收集、分析，并成为新功能和新服务诞生的灵感。

在最近的一次问答中，亚马逊网络服务副总裁兼首席传道者杰夫·巴尔被问及无服务器之后会发生什么——以下是他的回答:

> “我们才刚刚开始使用无服务器，它还有几十年的寿命”
> 
> ——杰夫·巴尔。

![](img/9c8558cb3edf4e730cfa2832d35c98cd.png)

杰夫·巴尔的问答。图片由作者提供。

# 为什么无服务器重构与众不同？

虽然术语“重构”保持不变，但它的含义和应用随着时间的推移而改变。

我过去最喜欢的一本书是马丁·福勒的《重构》。自第一次出版以来，二十多年过去了，它仍然在软件工程方面教授有价值的课程。它将重构作为改变软件系统的过程来讨论。回想当年，重构深受面向对象原则和编程语言的影响。

> 无服务器重构不仅仅是代码重写。它还涉及到服务重新布线。

即使在无服务器环境中，我们也可以说所有的东西都是代码——功能代码、基础设施代码、管道代码等等。然而，这些代码结构之间的区别变得模糊了。

> 如果你重构一个 lambda 函数来增加它的超时，你会把它归因于函数还是基础设施？

# 如何整合无服务器重构

敏捷团队面临的挑战之一是来自业务涉众的不切实际的期望。

> 随着交付周期的缩短和成果的持续可见性，涉众要求越来越多。这迫使团队成为“特性工厂”

许多团队努力为任何重构工作争取时间。这伤害了工程师，也没有简单的解决方案。只有那些在工程和产品团队之间有良好关系的组织才能成功地管理它。

这里有一些方法可以让它发生。

## 将工程需求转化为业务目标

克服这一点的一个方法是将您的服务重构需求转化为业务目标。

例如，如果工程团队认为重构一个特定的服务会获得几毫秒的延迟，那么就把它转换成一个可测量的站点性能或客户满意度指标。利益相关者会喜欢它，它比向他们扔技术术语更有效。

## 让重构成为开发过程的一部分

在我的演讲“如何培养一个无服务器的团队”中，我提出了一个更新阶段，因为这在自然界是随着季节的变化而发生的。

每季度安排一两次冲刺，专门用于包括重构在内的工程活动。向管理层陈述你的情况，重申好处并获得他们的认可。这对你的团队会有很多好处。

## 作为技术动力

频繁的无服务器重构避免了传统的陷阱，即由于功能黑客、范围爬行、使用不太合适的技术、工程能力不足等原因而堆积技术债务。

无服务器的情况就不那么可怕了，尤其是如果您遵循域驱动设计(DDD)和微服务原则，并且[将您的服务开发为独立的、事件驱动的和解耦的套件](https://medium.com/lego-engineering/think-and-develop-serverless-applications-as-set-pieces-4fa36d79ac3f)。

> 无服务器环境下的重构包括学习新的技能，整合新的服务和特性，以及实现新的模式。对工程师来说，这些都是技术动机。

将现有服务重写为新服务并扼杀旧服务是一种非常有效的常见做法。

# 重构的示例案例

## 消息批处理

如果您一直使用 SQS 作为 Lambda 的事件源，那么对于标准队列，您必须面对最大 10 条消息的批量。这种情况已经改变，现在已经达到 1 万人。

想象一个缓冲重要客户信息的队列。通过将限制使用到所需的水平并优化资源，服务可以减少处理时间。这会带来更好的客户体验。

## 索引

如果您的数据模型自您第一次创建 DynamoDB 表以来有所增长，请不要犹豫，创建全局辅助索引(GSI)来执行高效的查询。与上一代数据库不同，创建新索引不会造成性能损失或停机。

> 如果理解并给予应有的尊重，DynamoDB 可能是最友好的数据存储。

## 无功能

*Destination* 是 AWS 中的一个重载术语。例如，API Destination 有助于将 API 直接集成到 AWS Step 函数和 Amazon EventBridge 中。

在上述特性发布之前开发的应用程序中可能存在重构的可能性。它有助于消除不必要功能的使用。

## 精益和单一用途功能

Lambda 函数的特性在过去几年中有所改进。更大的内存、更长的超时和毫秒级定价可以在许多方面影响您的生态系统。

例如，如果您过去因为成本而使用[多用途 lambda 函数](https://medium.com/lego-engineering/lambda-vs-lambdas-de88a33f8536)，现在使用毫秒级定价，也许是时候进行重构，使它们变得精简和单一用途了？这样的可能性有很多。

以上是几个例子，向你展示改进的可能性和机会。

> 不管框架、工具、语言、提供商和业务领域如何，让自己跟上无服务器开发的步伐。这样，您就可以识别、评估和使用正确的无服务器技术，不断实现其伟大的承诺！

# 结论

正如人类生活一样，技术永远不会停滞不前。无服务器也不例外。我们迭代和创新得越多，它就变得越好。

任何今天是最好的技术很快就会成为明天的障碍。随着技术格局的变化，我们必须跟上，避免远远落后和过时。将持续重构视为无服务器开发的一部分！