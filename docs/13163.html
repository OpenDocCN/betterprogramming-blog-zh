<html>
<head>
<title>How to Integrate API Gateway and SQS With AWS CDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将API Gateway和SQS与AWS CDK集成</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-integrate-api-gateway-and-sqs-with-aws-cdk-14e74e7de5ba?source=collection_archive---------6-----------------------#2022-08-03">https://betterprogramming.pub/how-to-integrate-api-gateway-and-sqs-with-aws-cdk-14e74e7de5ba?source=collection_archive---------6-----------------------#2022-08-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="a6fe" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">如何使用AWS CDK部署堆栈</h2><div class=""/><div class=""><h2 id="af4b" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">API Gateway和AWS SQS之间的直接集成</h2></div><p id="827a" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">大家好。在过去的一个月里，我一直在学习CDK框架。很不可思议，很强大。让我们来看看吧！</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/54a05f322e8a5cdda5552090ea65a891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A2U-pd0CkiAam5eF"/></div></div><p class="lw lx gj gh gi ly lz bd b be z dk translated">由<a class="ae ma" href="https://unsplash.com/@mrpeker?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">穆罕默德·阿里·皮克</a>在<a class="ae ma" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="5826" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">什么是CDK？</h1><p id="35e0" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">根据AWS页面的概述，“AWS云开发工具包(AWS CDK)是一个开源软件开发框架，使用熟悉的编程语言来定义您的云应用程序资源。”</p><p id="97bc" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">对于开发人员来说，从应用程序的同一种语言创建AWS的基础设施更自然，而不是切换到JSON或YAML。</p><p id="6c69" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">由于构造编程模型(CPM ),您可以更容易地开发您的基础设施。每个构造都是一个AWS资源，一个构造有三个级别:</p><ul class=""><li id="5e6b" class="my mz iq kq b kr ks ku kv kx na lb nb lf nc lj nd ne nf ng bi translated">L1——这些是低层次的资源，比如云形成资源。该层中的类定期从AWS CloudFormation资源规范中生成，类的名称以Cfn前缀开头。</li><li id="d4da" class="my mz iq kq b kr nh ku ni kx nj lb nk lf nl lj nd ne nf ng bi translated">L2 —这些是AWS的高级资源，由L1构件创建。它们包括带有默认值、样板文件和实用程序的功能。推荐这些开始开发栈。</li><li id="ebce" class="my mz iq kq b kr nh ku ni kx nj lb nk lf nl lj nd ne nf ng bi translated">L3 —这些结构被称为模式。它们包括多个构造，以创建一个随时可用的构造。第三级构造的一个例子是<code class="fe nm nn no np b">ecs_patterns</code>，它包括许多ECS模式，这些模式将创建许多资源。</li></ul><h1 id="0ae0" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">建立一个堆栈</h1><p id="d8b3" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">我想给你们看一个CDK是如何工作的小例子。我们将使用API Gateway来推送SQS队列中的元素。我们正试图建造一个三级建筑。</p><h2 id="dc09" class="nq mc iq bd md nr ns dn mh nt nu dp ml kx nv nw mn lb nx ny mp lf nz oa mr iw bi translated">什么是直接集成？</h2><p id="b8b6" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">这个小例子演示了如何在不使用lambda函数的情况下创建一个端点来推送SQS队列中的元素。</p><p id="683a" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">API Gateway和SQS之间不通过lambda函数的直接集成有利于延迟、成本和您的心理健康。</p><h2 id="59c7" class="nq mc iq bd md nr ns dn mh nt nu dp ml kx nv nw mn lb nx ny mp lf nz oa mr iw bi translated">利益</h2><p id="a684" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">延迟更低，因为您不需要启动新的lambda函数(如果是第一次，则使用冷启动)，因此您只有API gateway的延迟和从SQS发送消息的延迟。</p><p id="cb47" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">成本。我说过，你不需要lambda函数，所以成本和执行时间为零。然后，您将只支付API网关和SQS请求。我知道这个费用对无服务器的人来说很荒谬，但是如果你有很多电话，你可以在上面花很多钱。使用此解决方案，您可以保持低成本。</p><p id="4b09" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">心理健康是最重要的，因为你不需要每天更新代码，维护和更新SDK，或者检查lambda函数崩溃的原因，因为该服务完全由AWS管理。</p><h1 id="7315" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">我们来钻研一些代码吧！</h1><p id="041a" class="pw-post-body-paragraph ko kp iq kq b kr mt ka kt ku mu kd kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">从AWS CDK开始的第一步是建立CDK。您可以使用NPM(或Yarn)在您的环境中安装global，代码如下:</p><p id="6234" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe nm nn no np b">npm install -g aws-cdk</code></p><p id="288b" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">要创建您的第一个项目，您必须创建一个新文件夹，然后执行以下操作:</p><p id="aec4" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><code class="fe nm nn no np b">cdk init app --language=typescript</code></p><p id="d1da" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这样，CDK将使用TypeScript语言建立您的项目。在<code class="fe nm nn no np b">lib/</code>文件夹中，你可以找到你想要部署的当前栈。</p><p id="032d" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我做这个堆栈是为了方便API网关和SQS的直接集成。</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="609b" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">让我解释一下这些代码:</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="cda0" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在上面的代码片段中，您可以看到我创建了一个由AWS管理加密的SQS队列和一个API网关角色。您可以看到CDK有一个授予角色权限的方法。这样，你就不需要写保单了。只需调用这个方法，它就会为您做到这一点！最佳实践是使用grant方法来授予正确的权限。</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="69c2" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这是堆栈的核心。这里我们定义了API网关Rest API和直接集成。如您所见，我们与SQS集成，然后将端点主体作为消息发送。是的，我知道它有点脏，但是对于这个例子来说，它会做得很好。</p><p id="8bf0" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在您的AWS帐户中部署之前，您必须引导环境。环境是来自地区/客户的一对夫妇。要引导您的环境，请执行以下操作:</p><pre class="ll lm ln lo gt od np oe of aw og bi"><span id="a5e5" class="nq mc iq np b gy oh oi l oj ok">cdk bootstrap</span></pre><p id="4a7e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">引导完成后，您可以使用以下命令部署堆栈:</p><pre class="ll lm ln lo gt od np oe of aw og bi"><span id="4698" class="nq mc iq np b gy oh oi l oj ok">cdk deploy</span></pre><p id="88a9" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">部署完成后，您可以获得URL来调用您的新端点并向SQS发送消息。</p><p id="4cc8" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">AWS CDK是部署基础设施的绝佳工具。最近一个月，我一直在了解它，和同事讨论它，并将其用于新的项目。</p><p id="9386" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">今天到此为止。我希望你觉得这篇文章很有趣。</p><p id="89e8" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">回头见！</p></div></div>    
</body>
</html>