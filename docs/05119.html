<html>
<head>
<title>Optional Views With SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI的可选视图</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/optional-views-with-swiftui-ab551030296d?source=collection_archive---------7-----------------------#2020-06-10">https://betterprogramming.pub/optional-views-with-swiftui-ab551030296d?source=collection_archive---------7-----------------------#2020-06-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c068" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更好地处理条件渲染</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bfd98b08b34dac4874cd5f1137cdbb97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V-7wv8w7HxoDHbJg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">丹尼尔·明库克·金在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="29e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经在<a class="ae ky" href="https://medium.com/better-programming/swift-optional-views-with-the-proxy-and-abstract-factory-patterns-5f24f8cf84b8" rel="noopener">之前的文章</a>中看到可选视图有多常见。我们还看到，处理可选性的逻辑可以有不同的所有者。最后，我们看到了如何用Swift + UIKit实现可重用的可选视图。</p><p id="f6b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一次，我们将跳过介绍，通过一个例子直接进入如何用SwiftUI做同样的事情。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a504" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Go Premium Widget</h1><p id="2dad" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设我们有一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Freemium" rel="noopener ugc nofollow" target="_blank">免费增值</a>应用程序，用户不需要付费使用该应用程序，但我们希望让他们充分了解我们的高级计划，其中包括额外的功能。</p><p id="5c02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在应用程序的不同部分显示一个“Go Premium”小部件，用户可以点击它来启动这个过程。但是，由于显而易见的原因，当用户已经是高级用户时，不应该显示Go Premium小部件。</p><p id="1d28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先以非可选的方式展示Go Premium小部件。我们将使用一个简单的<code class="fe mz na nb nc b">Text</code>,这样我们就不会迷失在细节中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3ca9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使小部件成为可选的</h1><p id="bf20" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了让这个小部件成为可选的，我们需要做一些改动。</p><p id="640e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先从<code class="fe mz na nb nc b">ContainerView</code>中提取小部件的实例化，并使用一个协议来注入它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="4c33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以重构<em class="nf"> </em> <code class="fe mz na nb nc b">view</code>属性，根据用户是否已经是高级用户，返回<code class="fe mz na nb nc b">self</code>或<code class="fe mz na nb nc b">EmptyView</code>。</p><p id="ed33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，<code class="fe mz na nb nc b">view</code>属性的返回类型有一个问题，因为<code class="fe mz na nb nc b">SwiftUI.View</code>不能被用作<code class="fe mz na nb nc b">PremiumWidget</code>的抽象。<em class="nf"> </em>它用的是<code class="fe mz na nb nc b">Self</code>，所以不能当铅字用。我们也不能返回<code class="fe mz na nb nc b">some View</code>，因为<a class="ae ky" href="https://docs.swift.org/swift-book/LanguageGuide/OpaqueTypes.html" rel="noopener ugc nofollow" target="_blank">不透明类型</a>不能是协议需求的返回类型。</p><p id="2f04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，SwiftUI至少提供了几种方法来实现这一点。一个是使用一个删除类型的视图<em class="nf"> — </em> <code class="fe mz na nb nc b"><a class="ae ky" href="https://developer.apple.com/documentation/swiftui/anyview" rel="noopener ugc nofollow" target="_blank">AnyView</a></code>。另一种方法是使用<a class="ae ky" href="https://developer.apple.com/documentation/swiftui/group" rel="noopener ugc nofollow" target="_blank">组</a>。有些人声称<code class="fe mz na nb nc b">AnyView</code>有性能影响，但是你应该先阅读<a class="ae ky" href="https://medium.com/swlh/swiftui-performance-battle-anyview-vs-group-55bf852158df" rel="noopener">这篇文章</a>，然后做出你自己的决定。无论如何，我们将展示如何用<code class="fe mz na nb nc b">AnyView</code>来实现，但是你可以随意使用其中任何一个。代码中的差异应该是最小的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="99c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们有了一个基于用户是否是高级用户的可选小部件，但这里有几个重要问题:</p><ul class=""><li id="2b25" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated"><code class="fe mz na nb nc b">PremiumWidget</code>正在被实例化。</li><li id="61ee" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><code class="fe mz na nb nc b">PremiumWidget</code>阶层不应该有责任知道什么时候该展示什么时候不该展示。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6e9e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将实例化提取到工厂类</h1><p id="a9dd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们将把<code class="fe mz na nb nc b">PremiumWidget</code>的实例化转移到一个工厂类，同时考虑到以下前提:</p><ul class=""><li id="a235" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">因为我们已经提取了<code class="fe mz na nb nc b">PremiumWidget</code>的实例化，所以<code class="fe mz na nb nc b">ContainerView</code>不应该被修改。</li><li id="9de4" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">我们不想让<code class="fe mz na nb nc b">ContainerView</code>知道我们正在使用一个工厂类。</li></ul><p id="6601" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是为什么我们要使用<a class="ae ky" href="https://en.wikipedia.org/wiki/Proxy_pattern" rel="noopener ugc nofollow" target="_blank">代理模式</a>的原因:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="d421" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于<code class="fe mz na nb nc b">PremiumWidget</code>和<code class="fe mz na nb nc b">PremiumWidgetFactory</code>都符合<code class="fe mz na nb nc b">PremiumWidgetProtocol</code>，我们可以在<code class="fe mz na nb nc b">ContainerView</code>不知道正在使用哪一个的情况下注入其中任何一个。这将允许我们在不改变任何正在使用<code class="fe mz na nb nc b">PremiumWidget</code>的容器的情况下移除可选性。</p><p id="284d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这在a <code class="fe mz na nb nc b">PremiumWidget</code>的具体例子中可能没有太大意义，但在A/B测试、可选特性可能变成非可选特性等情况下会有意义。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4c26" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="2c54" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">感谢您的阅读。让我知道你的想法。</p><p id="8527" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢<a class="ae ky" href="https://twitter.com/rmenezes89" rel="noopener ugc nofollow" target="_blank"> Raul Menezes </a>审阅文章并建议使用<code class="fe mz na nb nc b">EmptyView</code>而不是optionals。</p></div></div>    
</body>
</html>