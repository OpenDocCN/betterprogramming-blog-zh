<html>
<head>
<title>Demystifying Kubernetes — 4 Reasons Why It’s So Successful</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭开Kubernetes的神秘面纱——它如此成功的4个原因</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/demystifying-kubernetes-why-is-it-so-successful-dbd74a14ea3?source=collection_archive---------19-----------------------#2022-04-19">https://betterprogramming.pub/demystifying-kubernetes-why-is-it-so-successful-dbd74a14ea3?source=collection_archive---------19-----------------------#2022-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fad6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">#3 —可扩展的功能和组件</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a5310302b8abee4c8baa687ba18407d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gWGjY3cn8swHqJI_"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kv" href="https://unsplash.com/@kalvisuals?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> KAL视觉</a>拍摄的照片</p></figure><p id="f4b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章是多部分系列的第一篇。在这个系列中，我想深入研究Kubernetes，但我不打算谈论部署、Pod或Kubelet、KubeProxy等技术细节。我想谈论的是，讨论Kubernetes为什么重要，它与现代应用程序有什么关系，它与开发人员有什么关系，以及它最初为什么成功。</p><p id="7835" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我首先定义Kubernetes是什么(是的，我必须这样做，不要笑)。</p><p id="9227" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kubernetes是一个容器编排器，或者总的来说，我们认为Kubernetes是一个容器编排器。这是Kubernetes首先存在的原因(参考资料部分有一个很棒的纪录片。还没看的话就看吧)。</p><p id="39a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它被设计成一个容器编排器，并在一次Docker会议上与许多其他容器编排器一起发布。我们甚至可以说是当年的docker orchestrator(想想docker有多占优势)。</p><p id="00c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是什么让Kubernetes在Docker Swarm、Mesos、Nomad和许多其他容器编排器中生存下来？它不仅幸存下来，还主宰了云原生时代。大众甚至以某种方式远离了许多Docker产品，Kubernetes已经成为云原生世界最大的旗舰项目。</p><p id="45e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我看来，这四个原因是Kubernetes成功故事的主要部分；开源并得到大型社区的支持(再次观看纪录片了解它是如何开源的)，微服务式的分布式架构，可扩展的功能和组件，处理其目标领域中的问题的优化设计。毫无疑问，它包括了云本身的特性，这就像是现代应用程序的定义。</p><p id="403a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如今，它不仅是一个容器编制器，还是一个虚拟机编制器(参见<a class="ae kv" href="https://kubevirt.io/" rel="noopener ugc nofollow" target="_blank"> Kubevirt </a>)、webassembly编制器(参见<code class="fe ls lt lu lv b"><a class="ae kv" href="https://github.com/containers/crun/blob/main/docs/wasm-wasi-example.md" rel="noopener ugc nofollow" target="_blank">crun</a></code>、K <a class="ae kv" href="https://krustlet.dev/" rel="noopener ugc nofollow" target="_blank"> rustlet </a>)、云基础设施编制器(参见<a class="ae kv" href="https://cloud.google.com/config-connector/docs" rel="noopener ugc nofollow" target="_blank"> Google Config Connector </a>、<a class="ae kv" href="https://github.com/aws-controllers-k8s/community" rel="noopener ugc nofollow" target="_blank"> Amazon Controllers </a>、<a class="ae kv" href="https://github.com/Azure/azure-service-operator" rel="noopener ugc nofollow" target="_blank"> Azure Service Operator </a>、<a class="ae kv" href="https://crossplane.io/" rel="noopener ugc nofollow" target="_blank"> Crossplane </a>、<a class="ae kv" href="https://cluster-api.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank"> Cluster Api </a>)、持续交付编制器(参见<a class="ae kv" href="https://fluxcd.io/" rel="noopener ugc nofollow" target="_blank"> Flux 【T16 无服务器应用协调器(参见</a><a class="ae kv" href="https://knative.dev/docs/" rel="noopener ugc nofollow" target="_blank"> Knative </a>、<a class="ae kv" href="https://docs.microsoft.com/en-us/azure/container-apps/overview" rel="noopener ugc nofollow" target="_blank"> Azure Container Apps </a>、<a class="ae kv" href="https://cloud.google.com/anthos/run" rel="noopener ugc nofollow" target="_blank"> Cloud Run For Anthos </a>)等等。</p><p id="caa0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将尝试解释Kubernetes成功的四个原因。</p><h1 id="0d5f" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">开源并得到大型社区的支持</h1><p id="a8cb" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">容器的出现让我们可以灵活地将应用程序部署到任何有容器运行时的环境中。有了容器，我们获得了许多能力，包括可移植性、不变性等等。</p><p id="d469" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有许多文章解释了它们的好处，但这完全是另一回事。在docker主导生态系统的容器大爆炸之后，出现了对容器编排的需求，并且出现了许多容器编排器。Kubernetes就是其中之一。</p><p id="5be1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kubernetes是由乔·贝达、布伦丹·伯恩斯和克雷格·麦克卢奇<strong class="ky ir">发明的。谷歌的经验首先加速了它的实现。在这个引导阶段之后，Google决定让Kubernetes成为一个开源项目。</strong></p><p id="3b02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">谷歌让Kubernetes成为开源项目的决定获得了巨大的回报。这个决定是Kubernetes在其他管弦乐队中脱颖而出的原因之一。CNCF也是在2015年作为Linux基金会项目与Kubernetes 1.0一起成立的，以支持容器技术。库伯内特也被捐赠给CNCF，CNCF成为库伯内特的决策者。</p><p id="5873" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如今，除了Kubernetes之外，CNCF还是许多流行的开源项目的所在地。Kubernetes是Github中最活跃的项目之一。聚集在Kubernetes周围的社区很快解决了许多问题。上面提到的项目(如Keda、Knative、Argo、Flux等)都是社区驱动的项目，其中大多数是由一家公司启动并捐赠给CNCF的。Kubernetes的捐赠过程已经成为新项目的一个很好的榜样，其中许多项目都遵循同样的道路。</p><h1 id="29d7" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">微服务式分布式架构</h1><p id="135f" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">Kubernetes没有单一的架构。它由多个组件组成。在控制平面上，它有一个Kube控制器管理器、Kube调度器、Kube API服务器和云控制器管理器。它把ETCD作为州商店。在worker节点上，它有Kube代理、容器运行时和<code class="fe ls lt lu lv b">kubelet</code>。这些部分之间非常和谐。</p><p id="c4de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kube API服务器是Kubernetes的主要组件。所有期望的状态读、写操作都由服务器处理。</p><p id="2cf5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当通过<code class="fe ls lt lu lv b">kubectl</code>创建一个新资源时，请求也被API服务器接受并存储到ETCD。然而，Kube API服务器不是将期望的状态应用到工作节点的服务器。这是Kube管理员的责任。</p><p id="a344" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果资源是部署，则由部署控制器负责。部署控制器定期检查pod计数是否与所需状态匹配。如果资源是<code class="fe ls lt lu lv b">statefulset</code>，那么<code class="fe ls lt lu lv b">statefulset</code>控制器负责。</p><p id="cc6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">提到的控制器负责它们的资源，但是它们也不发送pod创建命令给工作节点(特别是给<code class="fe ls lt lu lv b">kubelet</code>)。他们将命令发送到Kube API服务器，Kube调度器决定哪个工作节点适合放置pod。这种协同工作和工作分配使每个组件都具有高度的响应能力，并防止了单点故障。即使Kube API服务器不可用，您的工作负载仍然可以正常工作。</p><p id="8f4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于其分布式架构，许多这些组件可以根据需求轻松地替换为不同的组件。例如，如果需要的话，Kube scheduler可以替换为另一个具有不同调度算法的调度器(参考资料中有示例调度器的链接)。Kube API服务器不能被另一个API服务器替代，但是它也可以通过定制资源和聚合层进行扩展(我将在下面讨论)。</p><h1 id="1bd2" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">可扩展的功能和组件</h1><p id="e289" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">Kubernetes不是一个非常固执己见的工具。它的设计是相反的。不固执己见是Kubernetes成功的原因之一(顺便说一句，固执己见不是一件好事也不是坏事。这是一种选择，可以用它的后果来评价)。Kubernetes可以用来构建更高级别的平台和自以为是的产品。</p><p id="0a4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">扩展Kubernetes功能的最常见方式是扩展Kube API服务器和Kube控制器。</p><p id="5994" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有两种方法可以扩展Kubernetes API:聚合层和自定义资源定义(有关详细信息，链接在下面的参考资料中)。</p><p id="6772" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这两者中最流行的是CRDs(因为它们更容易实现和维护)。CRD与定制控制器一起形成操作员模式。定制控制器也由Kube控制器管理器管理，它们也订阅Kubernetes事件并等待关于它们资源的事件。事件发布后，他们做他们的工作。事实上，我们上面提到的很多工具(像Argo CD、Flux、Keda、Knative、Crossplane等等)都是操作符。</p><p id="dae0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还有许多其他不同的方法来扩展Kubernetes的功能。例如，要协调容器之外的工作负载，可以使用其他代理。<code class="fe ls lt lu lv b">Krustlet</code>是管理web组装流程的一个很好的例子。<code class="fe ls lt lu lv b">Krustlet</code>可以在工作节点的子集上工作，<code class="fe ls lt lu lv b">kubelet</code>可以在另一个子集上运行。</p><p id="2d7a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ETCD是最难被类似技术取代的地方。但是即使是ETCD也可以被取代，正如K3S团队通过使用SQLite为他们的轻量级Kubernetes发行版所实现的那样。顺便说一下，取代ETCD不是一个简单的过程，但是大社区可以解决大问题(见<a class="ae kv" href="https://github.com/k3s-io/kine" rel="noopener ugc nofollow" target="_blank"> Kine </a>)。</p><p id="9dab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您需要额外的功能，您还可以部署插件，如Kubernetes dashboard、网络策略提供商和核心DNS。您还可以通过使用Kubernetes部署、<code class="fe ls lt lu lv b">daemonsets</code>和statefulsets添加其他组件来扩展集群的功能。日志传送器、度量代理、遥测代理、API网关、服务网格和许多其他组件也可以根据您的需求与您的工作负载一起部署。</p><p id="d186" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kubernetes动态准入控制是扩展Kubernetes功能的另一种方式。Kubernetes策略(包括pod安全策略、RBAC策略和网络策略)也用于扩展Kubernetes功能和安全强化您的集群。</p><p id="38a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于Kubernetes扩展模式的参考资料有一个很棒的文档。</p><h1 id="eefb" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">处理目标领域问题的优化设计</h1><p id="374c" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">Kubernetes在某种程度上是一个抽象工具。它隐藏了容器管理操作和基础设施细节。容器编排包含管理容器的生命周期、提供从集群内部和外部对容器的可访问性、在需要时提供持久卷、提供必要的配置数据、提供部署过程等等。Kubernetes很好地定义了该领域的问题，使用了现有的最佳实践，并提供了正确的解决方案。</p><p id="e2aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kubernetes不做过度工程，不推极限。它将许多领域留给了采纳者和社区。举几个例子，Kubernetes没有提供可观测性堆栈的解决方案。因此，每个云供应商都可以使用自己的解决方案。即使在CNCF的保护伞下，也有很多可观测性的开源替代方案。这些产品也可以和Kubernetes一起使用。这种方法类似于消息流产品等。</p><h1 id="0971" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">结论</h1><p id="f21f" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">我已经谈到了Kubernetes的成功故事，但是众所周知，在软件行业没有放之四海而皆准的解决方案。</p><p id="ea92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kubernetes的成功故事是真实的，但我们在Kubernetes的采用故事中处于什么位置？Kubernetes是一个复杂的工具，尽管它抽象了许多复杂的基础设施细节，但对我们许多人来说很难学习。我们所有的it团队有必要把它掌握到炉火纯青吗？有必要让他们所有人在日常工作中使用它吗？</p><p id="a12f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的下一篇文章将是关于处理云原生空间的复杂性，我将谈论固执己见的平台、平台工程范例、作为产品概念的基础设施、应用程序开发平台等等。正如Kelsey Hightower在他的tweet中所言,“Kubernetes是一个搭建平台的平台。这是一个更好的起点；不是终局”。</p><h1 id="bf69" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">参考</h1><ul class=""><li id="7c8c" class="mt mu iq ky b kz mo lc mp lf mv lj mw ln mx lr my mz na nb bi translated"><a class="ae kv" href="https://www.youtube.com/watch?v=BE77h7dmoQU" rel="noopener ugc nofollow" target="_blank"> Kubernetes纪录片第1部分</a></li><li id="1d9a" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><a class="ae kv" href="https://www.youtube.com/watch?v=318elIq37PE" rel="noopener ugc nofollow" target="_blank"> Kubernetes纪录片第二部</a></li><li id="eb6c" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><a class="ae kv" href="https://en.wikipedia.org/wiki/Cloud_Native_Computing_Foundation" rel="noopener ugc nofollow" target="_blank"> CNCF维基</a></li><li id="12f7" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><a class="ae kv" href="https://github.com/kubernetes/kubernetes/graphs/commit-activity" rel="noopener ugc nofollow" target="_blank"> Kubernetes Github统计数据</a></li><li id="eb6f" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><a class="ae kv" href="https://volcano.sh/en/docs/schduler_introduction/" rel="noopener ugc nofollow" target="_blank">调度火山</a></li><li id="120a" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><a class="ae kv" href="https://github.com/IBM/Kube-Safe-Scheduler" rel="noopener ugc nofollow" target="_blank">调度器Kube安全调度器</a></li><li id="a310" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><a class="ae kv" href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/apiserver-aggregation/" rel="noopener ugc nofollow" target="_blank">库伯内特聚集层</a></li><li id="933f" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><a class="ae kv" href="https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/" rel="noopener ugc nofollow" target="_blank"> Kubernetes自定义资源定义</a></li><li id="a20e" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><a class="ae kv" href="https://kubernetes.io/docs/concepts/extend-kubernetes/#extension-patterns" rel="noopener ugc nofollow" target="_blank">扩展模式</a></li></ul></div></div>    
</body>
</html>